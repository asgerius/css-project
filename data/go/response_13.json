[{"tags": ["exception", "go", "try-catch", "null"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1428542399, "post_id": 29525368, "comment_id": 47210317, "body": "Write tests to check for such panics occurring. In non-test code a <code>panic</code> is the correct thing to do for incorrect code; just as with out of bound errors, etc."}], "answers": [{"comments": [{"owner": {"reputation": 5808, "user_id": 659590, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gacpu.jpg?s=128&g=1", "display_name": "Zikes", "link": "https://stackoverflow.com/users/659590/zikes"}, "edited": false, "score": 2, "creation_date": 1428531603, "post_id": 29525471, "comment_id": 47207131, "body": "And one thing I would add to this is that as a second line of defense many packages offer a New constructor, e.g. <code>dog.New()</code> or <code>animals.NewDog()</code>, which ensures the struct is properly initialized along with all of its properties."}], "tags": [], "owner": {"reputation": 76487, "user_id": 34218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f657c6adf1e623cd6f8818408ecd8f75?s=128&d=identicon&r=PG", "display_name": "Jason Coco", "link": "https://stackoverflow.com/users/34218/jason-coco"}, "is_accepted": false, "score": 4, "last_activity_date": 1428527698, "creation_date": 1428527698, "answer_id": 29525471, "question_id": 29525368, "link": "https://stackoverflow.com/questions/29525368/golang-defensive-interfaces-for-nil-types/29525471#29525471", "title": "Golang: Defensive interfaces for nil types", "body": "<p>You can check for nil and then do whatever:</p>\n\n<pre><code>func (d *Dog) canBark bool {\n    if d == nil {\n        // do something useful, maybe? Like log\n        // a stack trace for debugging later\n        log.Print(\"Attempt to bark a nil dog!\")\n        return false\n    }\n    // do the regular things\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "edited": false, "score": 0, "creation_date": 1428533701, "post_id": 29525551, "comment_id": 47207854, "body": "where is &quot;dogFace&quot; coming from... i assume that would be a compile error, right?"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1428533848, "last_edit_date": 1428533848, "creation_date": 1428527990, "answer_id": 29525551, "question_id": 29525368, "link": "https://stackoverflow.com/questions/29525368/golang-defensive-interfaces-for-nil-types/29525551#29525551", "title": "Golang: Defensive interfaces for nil types", "body": "<p>Sure:</p>\n\n<pre><code>func ( d *Dog ) bool {\n    if d ==  nil {\n        // a nil dog can't bark\n        return false\n    }\n}\n</code></pre>\n\n<p>It's entirely possible to use methods on a nil struct. However, a nil interface is another story. You can't defend against that, because there's no type to call a method on.</p>\n\n<pre><code>type Barker interface {\n    CanBark() bool\n}\n\nvar dog Barker\n//panics\ndog.CanBark()\n</code></pre>\n\n<p>In go, it's a programming error to improperly initialize a data structure, and methods can panic. If a type value is returned to you from a function or a method, there is generally an error value returned as well indicating whether the first value can be used. </p>\n"}], "owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1428533848, "creation_date": 1428527217, "question_id": 29525368, "link": "https://stackoverflow.com/questions/29525368/golang-defensive-interfaces-for-nil-types", "title": "Golang: Defensive interfaces for nil types", "body": "<p>I recently found some go code was running in a test framework where there were some uninitialized variables.</p>\n\n<p>This lead to a panic, which had a stack trace containing some c code at the top.</p>\n\n<p>Is there a way, in functions, that we can concisely detect wether the struct which is referenced as the implementing member is nil? i.e. </p>\n\n<pre><code>func ( d *Dog ) canBark Bool {\n      //if d is nil, cryptic exception is thrown.\n      //is there a way to defend against this?\n}\n</code></pre>\n\n<p>The error which is thrown is </p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference \n[signal 0xb code=0x1 addr=0x0 pc=0x4ec83a] \ngoroutine 16 [running]:   \nruntime.panic(0x9b7400, 0xf7ddf3) \n</code></pre>\n\n<p>It seems that in go, such lower level errors should occur very rarely, maybe never at all...</p>\n\n<p>There might be a Golang way to deal with nil references which don't clutter the code too much with if/else logic.  For example, in java, you can wrap a large code segment in a null pointer exception handler.</p>\n"}, {"tags": ["winapi", "go"], "comments": [{"owner": {"reputation": 154, "user_id": 4720984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb57548fd9bab19cdaea8ec54eeac28e?s=128&d=identicon&r=PG&f=1", "display_name": "sutol", "link": "https://stackoverflow.com/users/4720984/sutol"}, "edited": false, "score": 0, "creation_date": 1428528505, "post_id": 29525363, "comment_id": 47205686, "body": "use _get_osfhandle - error, this is absolute unrelated func here"}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 2, "creation_date": 1428582694, "post_id": 29525363, "comment_id": 47229086, "body": "You are using <code>WSARecv</code> in asynchronous mode, sort of anyway. If you want <code>WSARecv</code> to block until data is read, pass <code>nil</code> as the <i>lpOverlapped</i> parameter."}, {"owner": {"reputation": 263, "user_id": 1825951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9c30a36ac42be226b0b23c1ad0464356?s=128&d=identicon&r=PG", "display_name": "b00stfr3ak", "link": "https://stackoverflow.com/users/1825951/b00stfr3ak"}, "reply_to_user": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 0, "creation_date": 1428685635, "post_id": 29525363, "comment_id": 47283474, "body": "@IInspectable you were absolutely right.  I&#39;ve changed that flag to a nil but for some reason it doesn&#39;t grab the entire data stream from the server.  Some times it does some times it doesn&#39;t.  Once the four bytes are received, I take that value which is the length of the data (770000 bytes) but it doesn&#39;t seem to write all the data from the server to the buffer"}, {"owner": {"reputation": 263, "user_id": 1825951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9c30a36ac42be226b0b23c1ad0464356?s=128&d=identicon&r=PG", "display_name": "b00stfr3ak", "link": "https://stackoverflow.com/users/1825951/b00stfr3ak"}, "edited": false, "score": 0, "creation_date": 1428697354, "post_id": 29525363, "comment_id": 47289564, "body": "@llnspectable I figured it out.  I had to keep calling WSARecv to get more of the data."}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 0, "creation_date": 1428786889, "post_id": 29525363, "comment_id": 47314419, "body": "No, you don&#39;t. You just have to pass a larger buffer."}], "owner": {"reputation": 263, "user_id": 1825951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9c30a36ac42be226b0b23c1ad0464356?s=128&d=identicon&r=PG", "display_name": "b00stfr3ak", "link": "https://stackoverflow.com/users/1825951/b00stfr3ak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 455, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1428527188, "creation_date": 1428527188, "question_id": 29525363, "link": "https://stackoverflow.com/questions/29525363/windows-syscall", "title": "Windows syscall", "body": "<p>So I'm trying to get the File Handle on a socket in windows.</p>\n\n<p>Using like the following: </p>\n\n<pre><code>            address, err := net.ResolveTCPAddr(\"tcp\", \"192.168.9.144:8080\")                                                                                                                                     \n            if err != nil {                                                                                                                                                                                     \n                    fmt.Println(err)                                                                                                                                                                            \n            }                                                                                                                                                                                                   \n            conn, err := net.DialTCP(\"tcp\", nil, address)                                                                                                                                                       \n            fmt.Println(\"Connected\")                                                                                                                                                                            \n            // conn, err := net.DialTCP(\"tcp\", nil, address)                                                                                                                                                    \n            if err != nil {                                                                                                                                                                                     \n                    fmt.Println(\"Can't conenct\")                                                                                                                                                                \n                    log.Fatal(err)                                                                                                                                                                              \n     }\n     conn.File() \n     conn.Fd()\n</code></pre>\n\n<p>conn.File() Fails and states it's not supported by windows</p>\n\n<p>Next I tried to use the windows api function _get_osfhandle</p>\n\n<pre><code>var (\n        procGetOSfHandle = msvcrt.NewProc(\"_get_osfhandle\")                                                                                                                                                                                                                                                                                                         \n)                                                                                                                                                                                                           \n\nfunc GetOSfHandle(fd uintptr) (uintptr, error) {                                                                                                                                                            \n        value, _, err := procGetOSfHandle.Call(fd)                                                                                                                                                          \n        return value, err                                                                                                                                                                                   \n} \nhand, _ := GetOSfHandle(uintptr(unsafe.Pointer(conn)))\n</code></pre>\n\n<p>hand returns 4294967295 which turns out to be not real as in \"xff\\xff\\xff\\xff\"</p>\n\n<p>I then tried just to use the windows API for socket and ran into an issue with WSARecv.  This is the following code used:</p>\n\n<pre><code>       var d syscall.WSAData                                                                                                                                                                           \n       syscall.WSAStartup(uint32(0x202), &amp;d)                                                                                                                                                           \n       fd, _ := syscall.Socket(syscall.AF_INET, syscall.SOCK_STREAM, 0)                                                                                                                                \n       addr := syscall.SockaddrInet4{Port: 8080, Addr: [4]byte{192, 168, 9, 144}}                                                                                                                      \n       var buf [4]byte                                                                                                                                                                                 \n       syscall.Connect(fd, &amp;addr)                                                                                                                                                                      \n       dataBuf := syscall.WSABuf{Len: uint32(4), Buf: &amp;buf[0]}                                                                                                                                         \n       o := syscall.Overlapped{}                                                                                                                                                                       \n       flags := uint32(0)                                                                                                                                                                              \n       qty := uint32(0)                                                                                                                                                                                \n       syscall.WSARecv(fd, &amp;dataBuf, 1, &amp;qty, &amp;flags, &amp;o, nil)                                                                                                                                         \n       fmt.Println(buf)    \n</code></pre>\n\n<p>The code connects but I don't see and data received.  It seems I don't seem to have the WSARecv options correct.</p>\n\n<p>Any help would be greatly appreciated.              </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7031, "user_id": 28855, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8a62c5134a4ff7b618582d8dd267d2b5?s=128&d=identicon&r=PG", "display_name": "Jaime Soriano", "link": "https://stackoverflow.com/users/28855/jaime-soriano"}, "edited": false, "score": 0, "creation_date": 1428525757, "post_id": 29524912, "comment_id": 47204263, "body": "How are the IP ranges provided? as network IP + mask?"}, {"owner": {"reputation": 587, "user_id": 2239242, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l0IPl.jpg?s=128&g=1", "display_name": "Kartik Sura", "link": "https://stackoverflow.com/users/2239242/kartik-sura"}, "reply_to_user": {"reputation": 7031, "user_id": 28855, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8a62c5134a4ff7b618582d8dd267d2b5?s=128&d=identicon&r=PG", "display_name": "Jaime Soriano", "link": "https://stackoverflow.com/users/28855/jaime-soriano"}, "edited": false, "score": 0, "creation_date": 1428526656, "post_id": 29524912, "comment_id": 47204749, "body": "Right now I am thinking of Start IP address: End IP Address"}, {"owner": {"reputation": 7031, "user_id": 28855, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8a62c5134a4ff7b618582d8dd267d2b5?s=128&d=identicon&r=PG", "display_name": "Jaime Soriano", "link": "https://stackoverflow.com/users/28855/jaime-soriano"}, "edited": false, "score": 0, "creation_date": 1428527268, "post_id": 29524912, "comment_id": 47205070, "body": "You could work with the ordered IPs converted to numbers, take a look to this question <a href=\"http://stackoverflow.com/questions/26296761/check-if-a-number-exists-in-a-given-set-of-ranges\" title=\"check if a number exists in a given set of ranges\">stackoverflow.com/questions/26296761/&hellip;</a>"}, {"owner": {"reputation": 587, "user_id": 2239242, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l0IPl.jpg?s=128&g=1", "display_name": "Kartik Sura", "link": "https://stackoverflow.com/users/2239242/kartik-sura"}, "reply_to_user": {"reputation": 7031, "user_id": 28855, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8a62c5134a4ff7b618582d8dd267d2b5?s=128&d=identicon&r=PG", "display_name": "Jaime Soriano", "link": "https://stackoverflow.com/users/28855/jaime-soriano"}, "edited": false, "score": 0, "creation_date": 1428528060, "post_id": 29524912, "comment_id": 47205455, "body": "The link specifies that it just finds whether the number is present in the range. I would like all the ranges which have this number. The segment tree seems to be right, but it just does integers, whereas IPv6 is much larger than an int"}, {"owner": {"reputation": 7031, "user_id": 28855, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8a62c5134a4ff7b618582d8dd267d2b5?s=128&d=identicon&r=PG", "display_name": "Jaime Soriano", "link": "https://stackoverflow.com/users/28855/jaime-soriano"}, "edited": false, "score": 0, "creation_date": 1428529055, "post_id": 29524912, "comment_id": 47205946, "body": "Umm, I see, in any case ordering the ranges would speed up the searches, it is more or less what the stree does. Maybe you can adapt this stree library to use bigint <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow noreferrer\">golang.org/pkg/math/big</a>, or byte arrays. In any case yes, you&#39;re right, the stree looks as the way to do it."}, {"owner": {"reputation": 39201, "user_id": 274, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/a4040b3cd8ee723e93f1c95ddeb0b5bc?s=128&d=identicon&r=PG", "display_name": "Xetius", "link": "https://stackoverflow.com/users/274/xetius"}, "edited": false, "score": 0, "creation_date": 1428532851, "post_id": 29524912, "comment_id": 47207591, "body": "Some clarification of how the definition of the ranges.  given 192.168.0.50 - 192.168.0.150 then 192.168.0.100 would be in the range.  However, 192.168.0.90 - 192.168.10.100, then depending on the definition, 192.168.5.80 may or may not be in the range. if it is in range, then you can treat IPv4 as a 4 digit base 256 number, otherwise will have to treat it as 4 discreet ranges (192-192, 168-168, 0-10 and 90-100)"}], "owner": {"reputation": 587, "user_id": 2239242, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l0IPl.jpg?s=128&g=1", "display_name": "Kartik Sura", "link": "https://stackoverflow.com/users/2239242/kartik-sura"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1428525538, "creation_date": 1428525538, "last_edit_date": 1495542493, "question_id": 29524912, "link": "https://stackoverflow.com/questions/29524912/given-a-set-of-ip-address-ranges-which-all-the-ranges-which-contain-the-given-i", "title": "Given a set of IP address ranges, which all the ranges which contain the given IP address", "body": "<p>I have a set of IP address ranges, which correspond to some conditions.</p>\n\n<p>Given an input IP address, I want to know all the sets of the IP ranges which contain this input IP address.</p>\n\n<p>So far a segment tree seems to be suitable \n<a href=\"https://github.com/toberndo/go-stree\" rel=\"nofollow noreferrer\">https://github.com/toberndo/go-stree</a> but it takes only integers whereas I need IPv4 and IPv6 ranges.</p>\n\n<p>Any suggestions on the algorithm suitable for this kind of a problem? Maybe an extension to <a href=\"https://stackoverflow.com/questions/19882961/go-golang-check-ip-address-in-range\">Go/GoLang check IP address in range</a></p>\n"}, {"tags": ["html", "templates", "go"], "answers": [{"comments": [{"owner": {"reputation": 933, "user_id": 2658831, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/306579a1eb46b133663c09beef80a879?s=128&d=identicon&r=PG", "display_name": "Nickl", "link": "https://stackoverflow.com/users/2658831/nickl"}, "edited": false, "score": 0, "creation_date": 1428525493, "post_id": 29524754, "comment_id": 47204123, "body": "that worked, thank you very much. i actually missed that field exporting thing, where can i read about it?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 933, "user_id": 2658831, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/306579a1eb46b133663c09beef80a879?s=128&d=identicon&r=PG", "display_name": "Nickl", "link": "https://stackoverflow.com/users/2658831/nickl"}, "edited": false, "score": 2, "creation_date": 1428526349, "post_id": 29524754, "comment_id": 47204593, "body": "@Nickl In the <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">Language specification: Exported Identifiers</a>. The template engine is in a different package (<code>html&#47;template</code>), so the rules apply to it too."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1471955217, "last_edit_date": 1471955217, "creation_date": 1428524974, "answer_id": 29524754, "question_id": 29524706, "link": "https://stackoverflow.com/questions/29524706/golang-html-template-doesnt-display-anything/29524754#29524754", "title": "golang html template doesn&#39;t display anything", "body": "<p>The <code>Page.test</code> field is not exported, it starts with a lowercase letter. The template engine (just like everything else) can only access exported fields.</p>\n\n<p>Change it to:</p>\n\n<pre><code>type Page struct {\n    Test [3]Person\n    Test2 string\n}\n</code></pre>\n\n<p>And all the other places where you refer to it, e.g. <code>p:= Page{Test: a}</code>. And also in the template:</p>\n\n<pre><code>{{range .Test}}\n    item\n{{end}}\n</code></pre>\n\n<p><strong>And also: never omit checking errors!</strong> The least you can do is panic:</p>\n\n<pre><code>c, err := ioutil.ReadFile(\"welcome.html\") \nif err != nil {\n    panic(err)\n}\ns := string(c)\n\nt := template.New(\"\")\nt, err = t.Parse(s)\nif err != nil {\n    panic(err)\n}\nerr = t.Execute(os.Stdout, p)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/Mj1IBgd3il\" rel=\"nofollow\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 933, "user_id": 2658831, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/306579a1eb46b133663c09beef80a879?s=128&d=identicon&r=PG", "display_name": "Nickl", "link": "https://stackoverflow.com/users/2658831/nickl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 852, "favorite_count": 0, "accepted_answer_id": 29524754, "answer_count": 1, "score": 0, "last_activity_date": 1471955217, "creation_date": 1428524789, "question_id": 29524706, "link": "https://stackoverflow.com/questions/29524706/golang-html-template-doesnt-display-anything", "title": "golang html template doesn&#39;t display anything", "body": "<p>I have this code for html/template, and it won't run. I want to display each element in the array and it will return nothing. Please ignore the ioutil file reading. </p>\n\n<pre><code>type Person struct {\n    Name string\n    Age int\n}\n\ntype Page struct {\n    test [3]Person\n    test2 string\n}\n\nfunc main() {\n    var a [3]Person\n    a[0] = Person{Name: \"test\", Age: 20}\n    a[1] = Person{Name: \"test\", Age: 20}\n    a[2] = Person{Name: \"test\", Age: 20}\n\n    p:= Page{test: a}\n\n    c, _ := ioutil.ReadFile(\"welcome.html\")    \n    s := string(c)\n\n    t := template.New(\"\")\n    t, _ = t.Parse(s)\n    t.Execute(os.Stdout, p)\n}\n</code></pre>\n\n<p>and welcome.html:</p>\n\n<pre><code>{{range .test}}\n    item\n{{end}}\n</code></pre>\n"}, {"tags": ["go", "datastore"], "comments": [{"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 1, "creation_date": 1428523813, "post_id": 29521715, "comment_id": 47203249, "body": "How do you know it is not picking it up? What error(s) are you getting?"}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "reply_to_user": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1428545666, "post_id": 29521715, "comment_id": 47211221, "body": "I get  <code>data: no rows in result set</code> although the rows are supposed to exist"}, {"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1428602903, "post_id": 29521715, "comment_id": 47243153, "body": "Can you show some code, perhaps your index.yaml file?"}], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1428515104, "creation_date": 1428515104, "question_id": 29521715, "link": "https://stackoverflow.com/questions/29521715/how-to-test-a-package-which-requires-composite-index-go-datastore", "title": "How to test a package which requires Composite index? Go Datastore", "body": "<p>How can I test a package which requires a composite index? I have the index.yaml file in the package but it seems goapp doesn't pick it. Is there any way that I can tell to goapp to read the index.yaml file?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11, "user_id": 14856863, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0857292189f3d81cf139a05b7c90380e?s=128&d=identicon&r=PG&f=1", "display_name": "Arnau", "link": "https://stackoverflow.com/users/14856863/arnau"}, "edited": false, "score": 0, "creation_date": 1611325528, "post_id": 29520676, "comment_id": 116422251, "body": "I recommend to check <a href=\"https://stackoverflow.com/questions/30716354/how-do-i-do-a-literal-int64-in-go/30716481#answer-30716481\">this extensive answer</a> to a very similar question."}], "answers": [{"comments": [{"owner": {"reputation": 4065, "user_id": 354222, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1e2881af9cfcb757041a5702c05ece26?s=128&d=identicon&r=PG", "display_name": "MushinNoShin", "link": "https://stackoverflow.com/users/354222/mushinnoshin"}, "edited": false, "score": 1, "creation_date": 1428512060, "post_id": 29520732, "comment_id": 47196289, "body": "Gross.  Any thoughts as to why not?  Is it just too difficult to implement to remove an occasionally noisy line?"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 4065, "user_id": 354222, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1e2881af9cfcb757041a5702c05ece26?s=128&d=identicon&r=PG", "display_name": "MushinNoShin", "link": "https://stackoverflow.com/users/354222/mushinnoshin"}, "edited": false, "score": 4, "creation_date": 1428512251, "post_id": 29520732, "comment_id": 47196407, "body": "@MushinNoShin: a pointer is the address of some thing, so you need that <i>thing</i>."}, {"owner": {"reputation": 4065, "user_id": 354222, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1e2881af9cfcb757041a5702c05ece26?s=128&d=identicon&r=PG", "display_name": "MushinNoShin", "link": "https://stackoverflow.com/users/354222/mushinnoshin"}, "reply_to_user": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 1, "creation_date": 1428513983, "post_id": 29520732, "comment_id": 47197386, "body": "@maerics: that was already understood, this was asking if there&#39;s any convenient ways to automatically do the memory allocation in the background and keep the unnecessary noise out of my code.  See the accepted answer."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1428524242, "post_id": 29520732, "comment_id": 47203480, "body": "Pointers to ints are not that common and pointers to literal ints are very uncommon, so why bother with syntactical sugar?"}, {"owner": {"reputation": 636, "user_id": 564872, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e7b460f32c77fa753907bb4c2631459c?s=128&d=identicon&r=PG", "display_name": "Civilian", "link": "https://stackoverflow.com/users/564872/civilian"}, "edited": false, "score": 0, "creation_date": 1430777986, "post_id": 29520732, "comment_id": 48197887, "body": "@Volker you should take a look at <code>aws-sdk-golang</code>, they&#39;ve got pointers to literal ints for days."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 5, "last_activity_date": 1428511913, "creation_date": 1428511913, "answer_id": 29520732, "question_id": 29520676, "link": "https://stackoverflow.com/questions/29520676/easy-way-to-assign-int-pointer-values/29520732#29520732", "title": "Easy way to assign int pointer values?", "body": "<p>No this is not possible to do in one line.</p>\n"}, {"comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1428514700, "post_id": 29520834, "comment_id": 47197820, "body": "You can also do <code>instance := foo{ i: new(int) }; foo.i = 1;</code> if you don&#39;t want to write a separate function."}, {"owner": {"reputation": 22059, "user_id": 112196, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e34b0f9e6f02cc448b42093ef14d22b0?s=128&d=identicon&r=PG", "display_name": "Pero P.", "link": "https://stackoverflow.com/users/112196/pero-p"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1428517020, "post_id": 29520834, "comment_id": 47199200, "body": "That&#39;s not right @FUZxxl, you can&#39;t assign <code>1</code> as a type <code>int</code> to <code>*int</code>. You end up back in the same situation as the OP."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 2, "creation_date": 1428517869, "post_id": 29520834, "comment_id": 47199689, "body": "Sorry, try <code>instance := foo{i : new(int) }; *foo.i = 1;</code>"}, {"owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1488564905, "post_id": 29520834, "comment_id": 72303798, "body": "@fuz I get this: <code>type \u2018foo\u2019 has no method \u2018i\u2019</code>"}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "reply_to_user": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "edited": false, "score": 0, "creation_date": 1488575360, "post_id": 29520834, "comment_id": 72309115, "body": "@exebook Please ask a new question for that if you can&#39;t solve it yourself."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 9, "last_activity_date": 1428512237, "creation_date": 1428512237, "answer_id": 29520834, "question_id": 29520676, "link": "https://stackoverflow.com/questions/29520676/easy-way-to-assign-int-pointer-values/29520834#29520834", "title": "Easy way to assign int pointer values?", "body": "<p>As pointed in the <a href=\"https://groups.google.com/d/msg/golang-nuts/YcfJzrj0Lec/4LHLVpt-xSAJ\">mailing list</a>, you can just do this:</p>\n\n<pre><code>func intPtr(i int) *int {\n    return &amp;i\n}\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>instance := foo { i: intPtr(1) }\n</code></pre>\n\n<p>if you have to do it often. <code>intPtr</code> gets inlined (see <code>go build -gcflags '-m'</code> output), so it should have next to no performance penalty.</p>\n"}], "owner": {"reputation": 4065, "user_id": 354222, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1e2881af9cfcb757041a5702c05ece26?s=128&d=identicon&r=PG", "display_name": "MushinNoShin", "link": "https://stackoverflow.com/users/354222/mushinnoshin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2022, "favorite_count": 1, "accepted_answer_id": 29520834, "answer_count": 2, "score": 5, "last_activity_date": 1428512237, "creation_date": 1428511731, "question_id": 29520676, "link": "https://stackoverflow.com/questions/29520676/easy-way-to-assign-int-pointer-values", "title": "Easy way to assign int pointer values?", "body": "<p>Given a <code>struct</code> that looks like</p>\n\n<pre><code>type foo struct {\n i *int\n}\n</code></pre>\n\n<p>if I want to set <code>i</code> to 1, I must</p>\n\n<pre><code>throwAway := 1\ninstance := foo { i: &amp;throwAway }\n</code></pre>\n\n<p>Is there any way to do this in a single line without having to give my new <code>i</code> value it's own name (in this case <code>throwaway</code>)?</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 830, "user_id": 770719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/Z6Bzq.jpg?s=128&g=1", "display_name": "jjude", "link": "https://stackoverflow.com/users/770719/jjude"}, "edited": false, "score": 0, "creation_date": 1428547280, "post_id": 29528803, "comment_id": 47211625, "body": "1. It has to be lowercase because I have to integrate with existing systems.     2. Agreed. I may have to write this piece in python. But I wanted to explore if there are options."}], "tags": [], "owner": {"reputation": 818, "user_id": 870828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879e95dc92f8370f79b78747ad16b3f5?s=128&d=identicon&r=PG", "display_name": "chaseadamsio", "link": "https://stackoverflow.com/users/870828/chaseadamsio"}, "is_accepted": false, "score": 1, "last_activity_date": 1428547201, "creation_date": 1428547201, "answer_id": 29528803, "question_id": 29520593, "link": "https://stackoverflow.com/questions/29520593/lowercase-methods-for-gorilla-xmlrpc/29528803#29528803", "title": "Lowercase methods for Gorilla xmlrpc", "body": "<p>I think the first question is \"why does it need to be [lowercase] \"say\" and the second question would need to be, if it needed to be that way, why use Go?</p>\n\n<p>It's a convention that Uppercase methods and properties are exported and lowercase methods and properties are private.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 3230028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/776aa3d1c41bf4d4c425bc484b0a2025?s=128&d=identicon&r=PG&f=1", "display_name": "Will Saxon", "link": "https://stackoverflow.com/users/3230028/will-saxon"}, "is_accepted": false, "score": 1, "last_activity_date": 1485060275, "creation_date": 1485060275, "answer_id": 41787440, "question_id": 29520593, "link": "https://stackoverflow.com/questions/29520593/lowercase-methods-for-gorilla-xmlrpc/41787440#41787440", "title": "Lowercase methods for Gorilla xmlrpc", "body": "<p>I encountered the same issue today. This problem was <a href=\"https://github.com/divan/gorilla-xmlrpc/commit/32b6cdbb2f3807e15a28571dbc86735ee0451665\" rel=\"nofollow noreferrer\">solved</a> in gorilla-xmlrpc a couple of years ago. Now you can register an alias on the xmlrpc codec:</p>\n\n<pre><code>myCodec := xml.NewCodec()\nmyCodec.RegisterAlias(\"MyType.lowerCaseMethod\", \"MyType.UpperCaseMethod\")\n</code></pre>\n\n<p>Input with e.g. <code>&lt;methodName&gt;MyType.lowerCaseMethod&lt;/methodName&gt;</code> will be recognized as expected.</p>\n\n<p>This function is noted in the godoc but not mentioned in the project README or related examples.</p>\n"}], "owner": {"reputation": 830, "user_id": 770719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/Z6Bzq.jpg?s=128&g=1", "display_name": "jjude", "link": "https://stackoverflow.com/users/770719/jjude"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1485060275, "creation_date": 1428511444, "last_edit_date": 1428519177, "question_id": 29520593, "link": "https://stackoverflow.com/questions/29520593/lowercase-methods-for-gorilla-xmlrpc", "title": "Lowercase methods for Gorilla xmlrpc", "body": "<p>I'm using <a href=\"https://github.com/divan/gorilla-xmlrpc\" rel=\"nofollow\">Gorilla XMLRPC</a>. As per the example,</p>\n\n<pre><code>func (h *HelloService) Say(r     *http.Request, \n                           args  *struct{Who string}, \n                           reply *struct{Message string}) error {\n    reply.Message = \"Hello, \" + args.Who + \"!\"\n    return nil\n}\n</code></pre>\n\n<p>and <code>RPC.RegisterService(new(HelloService), \"\")</code> gives me a service <code>HelloService.Say()</code>. I would like to have <code>helloService.say()</code>. I was able to get the first part by modifying the register function to <code>RPC.RegisterService(new(HelloService), \"helloService\")</code>. But I'm not able to make lowercase methods exported.</p>\n\n<p>I understand golang allows only uppercase methods to be exported. So is there any work-around for lowercase methods?</p>\n"}, {"tags": ["javascript", "go", "template-engine"], "comments": [{"owner": {"reputation": 3470, "user_id": 700188, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/5a36298e900c18a2b8dfc1659d347796?s=128&d=identicon&r=PG", "display_name": "someone1", "link": "https://stackoverflow.com/users/700188/someone1"}, "edited": false, "score": 0, "creation_date": 1428511381, "post_id": 29519958, "comment_id": 47195866, "body": "Can you be more specific? Lowercase properties in Go are privately scoped, so no 3rd party templating engine will be able to read them. You can maybe try converting your struct to a map and ensuring your key&#39;s are all lower cased to pass into the default Go template library?"}, {"owner": {"reputation": 1664, "user_id": 1833511, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/ab0c9cc3bb28498a3e83e5862ab2f5b4?s=128&d=identicon&r=PG", "display_name": "Dirk", "link": "https://stackoverflow.com/users/1833511/dirk"}, "reply_to_user": {"reputation": 3470, "user_id": 700188, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/5a36298e900c18a2b8dfc1659d347796?s=128&d=identicon&r=PG", "display_name": "someone1", "link": "https://stackoverflow.com/users/700188/someone1"}, "edited": false, "score": 0, "creation_date": 1428511494, "post_id": 29519958, "comment_id": 47195940, "body": "I know they are private, but libraries like <code>encoding&#47;json</code> and MGo (MongoDB), support using lowercase identifiers as in the example I gave in my original post, but as far as I know, there isn&#39;t a library for Mustache that can do that, and the default template library won&#39;t work because there isn&#39;t a browser port of it"}, {"owner": {"reputation": 22059, "user_id": 112196, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/e34b0f9e6f02cc448b42093ef14d22b0?s=128&d=identicon&r=PG", "display_name": "Pero P.", "link": "https://stackoverflow.com/users/112196/pero-p"}, "edited": false, "score": 0, "creation_date": 1428513152, "post_id": 29519958, "comment_id": 47196922, "body": "<code>encoding&#47;json</code> can&#39;t marshal properties with lowercase names. Your example is using uppercase struct properties."}, {"owner": {"reputation": 1664, "user_id": 1833511, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/ab0c9cc3bb28498a3e83e5862ab2f5b4?s=128&d=identicon&r=PG", "display_name": "Dirk", "link": "https://stackoverflow.com/users/1833511/dirk"}, "edited": false, "score": 0, "creation_date": 1428515410, "post_id": 29519958, "comment_id": 47198245, "body": "It indeed can&#39;t marshal properties with lowercase names, but by adding the custom &quot;tag&quot; (or whatever it&#39;s named), you can specify a custom (lowercase) name, but as far as I know, there isn&#39;t a mustache library supporting that"}], "answers": [{"comments": [{"owner": {"reputation": 1664, "user_id": 1833511, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/ab0c9cc3bb28498a3e83e5862ab2f5b4?s=128&d=identicon&r=PG", "display_name": "Dirk", "link": "https://stackoverflow.com/users/1833511/dirk"}, "edited": false, "score": 0, "creation_date": 1428692343, "post_id": 29566974, "comment_id": 47287022, "body": "Thanks for your help, with some help from the documentation and by looking at the <code>structs</code> library you pointed me to, I&#39;ve written my own struct-&gt;map converter that can handle flags"}], "tags": [], "owner": {"reputation": 3470, "user_id": 700188, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/5a36298e900c18a2b8dfc1659d347796?s=128&d=identicon&r=PG", "display_name": "someone1", "link": "https://stackoverflow.com/users/700188/someone1"}, "is_accepted": true, "score": 0, "last_activity_date": 1428685521, "creation_date": 1428685521, "answer_id": 29566974, "question_id": 29519958, "link": "https://stackoverflow.com/questions/29519958/go-templating-engine-that-also-runs-in-the-browser/29566974#29566974", "title": "Go templating engine that also runs in the browser", "body": "<p>As the comments above state, you can't expect any 3rd party library to be able to read lowercase properties on your struct, but it appears you are trying to use tags to represent alternative representations of your struct (as you can with the <code>encoding/json</code> library).</p>\n\n<p>What you can do is use something like <code>github.com/fatih/structs</code> to convert your structs to maps and then range through to lowercase all of your keys (copying the values and removing the uppercase versions) and pass it into <code>mustache.Render()</code> as your context. If you want to use struct tags like the <code>encoding/json</code> library does, you'd have to use the <code>reflect</code> package and write a struct-to-map function that takes into account the tags on the struct (basic example given in the documentation <a href=\"http://golang.org/pkg/reflect/#StructTag\" rel=\"nofollow\">here</a>). There are some SO answers on how to write a struct-to-map function using reflection, which you can improve upon to add struct tag handling as you need.</p>\n\n<p>To answer your question, I don't think this is something a current templating library does that also works with javascript, but it shouldn't be too hard to get working with mustache given the idea above.</p>\n"}], "owner": {"reputation": 1664, "user_id": 1833511, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/ab0c9cc3bb28498a3e83e5862ab2f5b4?s=128&d=identicon&r=PG", "display_name": "Dirk", "link": "https://stackoverflow.com/users/1833511/dirk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 29566974, "answer_count": 1, "score": 0, "last_activity_date": 1428685521, "creation_date": 1428509645, "last_edit_date": 1428511681, "question_id": 29519958, "link": "https://stackoverflow.com/questions/29519958/go-templating-engine-that-also-runs-in-the-browser", "title": "Go templating engine that also runs in the browser", "body": "<p>I'm developing a web application with Go on the server, and the router will use PushState, so the server will also have to be able to render my templates. That means that I'll need a templating engine that works with Go and Javascript. The only one I've come across so far is Mustache, but it doesn't seem to be able to handle lowercase properties of structs, and there also doesn't seem to be a possibility to provide custom names like JSON:</p>\n\n<pre><code>type Person struct {\n    Name string `json:\"name\"`\n    Age  int    `json:\"age\"`\n}\n</code></pre>\n\n<p>So, is there a templating engine that is available in both Go and JavaScript, and that can handle lowercase struct properties?</p>\n"}, {"tags": ["go", "orientdb"], "comments": [{"owner": {"reputation": 1, "user_id": 4764801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fe636e30dcff8c2e1b0fff2ae6e28f?s=128&d=identicon&r=PG&f=1", "display_name": "whitewitcher", "link": "https://stackoverflow.com/users/4764801/whitewitcher"}, "edited": false, "score": 0, "creation_date": 1428507495, "post_id": 29519156, "comment_id": 47193384, "body": "orientdb version: 2.0.4, windows 64 bit, golang 1.4.1"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 4764801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fe636e30dcff8c2e1b0fff2ae6e28f?s=128&d=identicon&r=PG&f=1", "display_name": "whitewitcher", "link": "https://stackoverflow.com/users/4764801/whitewitcher"}, "edited": false, "score": 0, "creation_date": 1428559295, "post_id": 29520222, "comment_id": 47215203, "body": "thank you so much, i set req.close=true before client.do and things are ok. but will that get fixed after that issue is closed? or this is a good practice to apply in application when we have one request-response trip? and this may be basic question but why database wants to keep connection alive?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1, "user_id": 4764801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fe636e30dcff8c2e1b0fff2ae6e28f?s=128&d=identicon&r=PG&f=1", "display_name": "whitewitcher", "link": "https://stackoverflow.com/users/4764801/whitewitcher"}, "edited": false, "score": 0, "creation_date": 1428586372, "post_id": 29520222, "comment_id": 47231855, "body": "The server keeps the connection alive because it&#39;s using http/1.1, and that&#39;s the most efficient way to use connections. If this only happens with synthetic benchmarks, then you probably don&#39;t need to worry about it, but you could also handle the EOF like I mentioned."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 0, "last_activity_date": 1428514355, "last_edit_date": 1428514355, "creation_date": 1428510315, "answer_id": 29520222, "question_id": 29519156, "link": "https://stackoverflow.com/questions/29519156/golang-request-to-orientdb-http-interface-error/29520222#29520222", "title": "golang request to Orientdb http interface error", "body": "<p>The keepalive connections are getting closed on you for some reason. You might be overwhelming the server, or going past the max number of connections the database can handle.</p>\n\n<p>Also, the current http.Transport connection pool doesn't work well with synthetic benchmarks that make connections as fast as possible, and can quickly exhaust available file descriptors or ports (<a href=\"http://golang.org/issue/6785\" rel=\"nofollow\">issue/6785</a>).</p>\n\n<p>To test this, I would set <code>Request.Close = true</code> to prevent the Transport from using the keepalive pool. If that works, one way to handle this with keepalive, is to specifically check for an io.EOF and retry that request, possibly with some backoff delay.</p>\n"}], "owner": {"reputation": 1, "user_id": 4764801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fe636e30dcff8c2e1b0fff2ae6e28f?s=128&d=identicon&r=PG&f=1", "display_name": "whitewitcher", "link": "https://stackoverflow.com/users/4764801/whitewitcher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 228, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1428514355, "creation_date": 1428507438, "question_id": 29519156, "link": "https://stackoverflow.com/questions/29519156/golang-request-to-orientdb-http-interface-error", "title": "golang request to Orientdb http interface error", "body": "<p>I am playing wit golang and orientdb to test them. i have written a tiny web app which uppon a request fetches a single document from local orientdb instance and returns it. when i bench this app with apache bench, when concurrency is above 1 it get following error:</p>\n\n<p>2015/04/08 19:24:07 http: panic serving [::1]:57346: Get <a href=\"http://localhost:2480/d\" rel=\"nofollow\">http://localhost:2480/d</a>\nocument/t1/9:1441: EOF</p>\n\n<p>when i bench Orientdb itself, it runs perfectley OK with any cuncurrency factor.\nalso when i change the url to fetch from this document to anything (other program whritten in golang, some internet site etc) the app runs OK.\nhere is the code:</p>\n\n<pre><code>func main() {\n    fmt.Println(\"starting ....\")\n\n    var aa interface{}\n    router := gin.New()\n    router.GET(\"/\", func(c *gin.Context) {\n        ans := getdoc(\"http://localhost:2480/document/t1/9:1441\")\n        json.Unmarshal(ans, &amp;aa)\n        c.JSON(http.StatusOK, aa)\n    })\n\n    router.Run(\":3000\")\n}\nfunc getdoc(addr string) []byte {\n    client := new(http.Client)\n    req, err := http.NewRequest(\"GET\", addr, nil)\n    req.SetBasicAuth(\"admin\",\"admin\")\n    resp, err := client.Do(req)\n    if err != nil {\n        fmt.Println(\"oops\", resp, err)\n        panic(err)\n    }\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        panic(err)\n    }\n    return body\n}\n</code></pre>\n\n<p>thanks in advance</p>\n"}, {"tags": ["go", "deferred-execution"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 8, "last_activity_date": 1428504966, "creation_date": 1428504966, "answer_id": 29518220, "question_id": 29518109, "link": "https://stackoverflow.com/questions/29518109/why-does-defer-recover-not-catch-panics/29518220#29518220", "title": "Why does `defer recover()` not catch panics?", "body": "<p>The <a href=\"http://golang.org/ref/spec#Handling_panics\">Handling panic</a> section mentions that </p>\n\n<blockquote>\n  <p>Two built-in functions, <code>panic</code> and <code>recover</code>, assist in reporting and handling run-time panics</p>\n  \n  <p>The <code>recover</code> function allows a program to manage behavior of a panicking goroutine. </p>\n  \n  <p>Suppose a function <code>G</code> <strong>defers a function <code>D</code></strong> that calls <code>recover</code> and a <code>panic</code> occurs in a function on the same goroutine in which <code>G</code> is executing.  </p>\n  \n  <p>When the running of deferred functions reaches <code>D</code>, the return value of <code>D</code>'s call to <code>recover</code> will be the value passed to the call of panic.<br>\n  If D returns normally, without starting a new panic, the panicking sequence stops.</p>\n</blockquote>\n\n<p>That illustrates that <code>recover</code> is meant to be called in a deferred function, not directly.<br>\nWhen it panic, the \"deferred function\" cannot be the built-in <code>recover()</code> one, but one specified in a <strong><a href=\"http://golang.org/ref/spec#Defer_statements\">defer statement</a></strong>.</p>\n\n<pre><code>DeferStmt = \"defer\" Expression .\n</code></pre>\n\n<blockquote>\n  <p>The expression must be a function or method call; it cannot be parenthesized.<br>\n  <strong>Calls of built-in functions are restricted as for <a href=\"http://golang.org/ref/spec#Expression_statements\">expression statements</a></strong>. </p>\n  \n  <p><strong>With the exception of specific built-in functions</strong>, function and method calls and receive operations can appear in statement context.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1428519470, "post_id": 29518404, "comment_id": 47200674, "body": "And why they specified <code>recover()</code> that way: maybe it&#39;d be additional implementation work to allow bare <code>defer recover()</code>, and more importantly, silently swallowing all <code>panic</code>s is risky in the way ignoring <code>err</code> is: it makes it much easier to have a problem that stops your program from doing what you want and not know what it is."}, {"owner": {"reputation": 1851, "user_id": 762175, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b0aa8cfe6ad2d1060dd861c28343c38c?s=128&d=identicon&r=PG", "display_name": "Ethan Reesor", "link": "https://stackoverflow.com/users/762175/ethan-reesor"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1458088240, "post_id": 29518404, "comment_id": 59700411, "body": "@twotwotwo In one of my applications, I&#39;m writing to a channel, and I don&#39;t want to panic if it&#39;s closed. Hence <code>defer recover()</code>. The entire routine is basically <code>defer recover(); ch1 &lt;- &lt;- ch2</code>."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 1851, "user_id": 762175, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b0aa8cfe6ad2d1060dd861c28343c38c?s=128&d=identicon&r=PG", "display_name": "Ethan Reesor", "link": "https://stackoverflow.com/users/762175/ethan-reesor"}, "edited": false, "score": 0, "creation_date": 1458108020, "post_id": 29518404, "comment_id": 59705928, "body": "@EthanReesor; noted, but usually the rule is that &quot;<a href=\"https://groups.google.com/forum/#!topic/golang-nuts/RmfHSHE9e30\" rel=\"nofollow noreferrer\">Only the sole/final sender (or some delegate thereof) should ever close a channel</a>&quot; (so no sending after the close). Some things achieve this by signalling shutdown some other way (like closing a <code>quit</code> or <code>cancel</code> channel on one end, then checking quit status with a <code>select { case &lt;-quit: &#47;* ...do shutdown stuff... *&#47; default: }</code> on the other). More narrowly, I can&#39;t change the spec; if you want to catch &#39;em all <code>defer func() { recover() }</code> is the only way."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 1851, "user_id": 762175, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b0aa8cfe6ad2d1060dd861c28343c38c?s=128&d=identicon&r=PG", "display_name": "Ethan Reesor", "link": "https://stackoverflow.com/users/762175/ethan-reesor"}, "edited": false, "score": 0, "creation_date": 1458108404, "post_id": 29518404, "comment_id": 59706081, "body": "@EthanReesor Graceful shutdown of parallel stuff really deserves more attention than I can give it now or fits in a comment; what you want to do, and how you do it (closing a channel, <code>close(quit)</code>, <code>sync.WaitGroup</code>, etc), sometimes need some thought specific to your situation."}, {"owner": {"reputation": 1851, "user_id": 762175, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b0aa8cfe6ad2d1060dd861c28343c38c?s=128&d=identicon&r=PG", "display_name": "Ethan Reesor", "link": "https://stackoverflow.com/users/762175/ethan-reesor"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1458148643, "post_id": 29518404, "comment_id": 59734023, "body": "@twotwotwo Do you have a reading recommendation for learning good parallel/asynchronous practices for a language like Go? Which is to say, a language that has co/goroutines and channels, not threads."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1458164024, "post_id": 29518404, "comment_id": 59743308, "body": "<a href=\"https://gist.github.com/twotwotwo/fe5c5020a2bb5f7f0ce3\" rel=\"nofollow noreferrer\">Here are some links and vague statements.</a> Not like you have to read all that to make progress, but lots of things to snack on over time. If you have a particular scenario you think might be possible to improve on, SO may be able to help with some info on what you&#39;ve done and the problem you&#39;re solving (not a promise that I have the time, or that any of us will necessarily improve on your approach!)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 12, "last_activity_date": 1471849485, "last_edit_date": 1471849485, "creation_date": 1428505436, "answer_id": 29518404, "question_id": 29518109, "link": "https://stackoverflow.com/questions/29518109/why-does-defer-recover-not-catch-panics/29518404#29518404", "title": "Why does `defer recover()` not catch panics?", "body": "<p>Quoting from the documentation of the built-in function <a href=\"http://golang.org/pkg/builtin/#recover\" rel=\"noreferrer\"><code>recover()</code></a>:</p>\n\n<blockquote>\n  <p>If recover is called <strong>outside</strong> the deferred function it will <strong>not</strong> stop a panicking sequence.</p>\n</blockquote>\n\n<p>In your second case <code>recover()</code> itself is the deferred function, and obviously  <code>recover()</code> does not call itself. So this will not stop the panicking sequence.</p>\n\n<p>If <code>recover()</code> would call <code>recover()</code> in itself, it would stop the panicking sequence (but why would it do that?).</p>\n\n<p><strong>Another Interesting Example:</strong></p>\n\n<p>The following code also doesn't panic (try it on the <a href=\"http://play.golang.org/p/1_aFKorkTZ\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>package main\n\nfunc main() {\n    var recover = func() { recover() }\n    defer recover()\n    panic(\"panic\")\n}\n</code></pre>\n\n<p>What happens here is we create a <code>recover</code> variable of function type which has a value of an anonymous function calling the built-in <code>recover()</code> function. And we specify calling the value of the <code>recover</code> variable to be the deferred function, so calling the builtin <code>recover()</code> from that stops the panicing sequence.</p>\n"}, {"tags": [], "owner": {"reputation": 5468, "user_id": 89233, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/a36afadc530a6936e9e336a729f7ecf3?s=128&d=identicon&r=PG", "display_name": "Jon Watte", "link": "https://stackoverflow.com/users/89233/jon-watte"}, "is_accepted": false, "score": 3, "last_activity_date": 1551379142, "last_edit_date": 1551379142, "creation_date": 1551378454, "answer_id": 54932040, "question_id": 29518109, "link": "https://stackoverflow.com/questions/29518109/why-does-defer-recover-not-catch-panics/54932040#54932040", "title": "Why does `defer recover()` not catch panics?", "body": "<p>An observation is that the real problem here is the design of <code>defer</code> and thus the answer should say that.</p>\n\n<p>Motivating this answer, <code>defer</code> currently needs to take exactly one level of nested stack from a lambda, and the runtime uses a particular side effect of this constraint to make a determination on whether <code>recover()</code> returns nil or not.</p>\n\n<p>Here's an example of this:</p>\n\n<pre><code>func b() {\n  defer func() { if recover() != nil { fmt.Printf(\"bad\") } }()\n}\n\nfunc a() {\n  defer func() {\n    b()\n    if recover() != nil {\n      fmt.Printf(\"good\")\n    }\n  }()\n  panic(\"error\")\n}\n</code></pre>\n\n<p>The <code>recover()</code> in <code>b()</code> should return nil.</p>\n\n<p>In my opinion, a better choice would have been to say that <code>defer</code> takes a function BODY, or block scope (rather than a function call,) as its argument. At that point, <code>panic</code> and the <code>recover()</code> return value could be tied to a particular stack frame, and any inner stack frame would have a <code>nil</code> pancing context. Thus, it would look like this:</p>\n\n<pre><code>func b() {\n  defer { if recover() != nil { fmt.Printf(\"bad\") } }\n}\n\nfunc a() {\n  defer {\n    b()\n    if recover() != nil {\n      fmt.Printf(\"good\")\n    }\n  }\n  panic(\"error\")\n}\n</code></pre>\n\n<p>At this point, it's obvious that <code>a()</code> is in a panicking state, but <code>b()</code> is not, and any side effects like \"being in the first stack frame of a deferred lambda\" aren't necessary to correctly implement the runtime.</p>\n\n<p>So, going against the grain here: The reason this doesn't work as might be expected, is a mistake in the design of the <code>defer</code> keyword in the go language, that was worked around using non-obvious implementation detail side effects and then codified as such.</p>\n"}], "owner": {"reputation": 330, "user_id": 1513002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6906bc00afec4223ab90b27024a2de99?s=128&d=identicon&r=PG&f=1", "display_name": "jinpan", "link": "https://stackoverflow.com/users/1513002/jinpan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3997, "favorite_count": 5, "accepted_answer_id": 29518220, "answer_count": 3, "score": 20, "last_activity_date": 1551379142, "creation_date": 1428504661, "last_edit_date": 1428524170, "question_id": 29518109, "link": "https://stackoverflow.com/questions/29518109/why-does-defer-recover-not-catch-panics", "title": "Why does `defer recover()` not catch panics?", "body": "<p>Why does a call to <code>defer func() { recover() }()</code> successfully recover a panicking goroutine, but a call to <code>defer recover()</code> not?</p>\n\n<p>As an minimalistic example, this code doesn't panic</p>\n\n<pre><code>package main\n\nfunc main() {\n    defer func() { recover() }()\n    panic(\"panic\")\n}\n</code></pre>\n\n<p>However, replacing the anonymous function with recover directly panics</p>\n\n<pre><code>package main\n\nfunc main() {\n    defer recover()\n    panic(\"panic\")\n}\n</code></pre>\n"}, {"tags": ["go", "redigo"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1428503027, "creation_date": 1428503027, "answer_id": 29517441, "question_id": 29517213, "link": "https://stackoverflow.com/questions/29517213/redigo-read-redis-hash-that-has-variable-keys/29517441#29517441", "title": "redigo: read redis hash that has variable keys", "body": "<p><code>ScanStruct</code> is just a convenience for when you're mapping a known struct to a redis hash.</p>\n\n<p>Use the <a href=\"http://godoc.org/github.com/garyburd/redigo/redis#StringMap\" rel=\"noreferrer\"><code>redis.StringMap</code></a> helper function to get a <code>map[string]string</code>. </p>\n\n<p>Everything is redis is a string, and the redigo library converts the values for you. You can easily convert the values as needed from their string representations. If you want the raw bytes without the first string conversion, you can use <code>redis.Values</code>, which will return alternating keys and values in a <code>[]interface{}</code>.</p>\n"}], "owner": {"reputation": 1701, "user_id": 627425, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4dd4c3d3d3f8fcc95d1a234ddc3eb4e4?s=128&d=identicon&r=PG", "display_name": "Sander Smits", "link": "https://stackoverflow.com/users/627425/sander-smits"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3032, "favorite_count": 0, "accepted_answer_id": 29517441, "answer_count": 1, "score": 1, "last_activity_date": 1428503164, "creation_date": 1428502474, "question_id": 29517213, "link": "https://stackoverflow.com/questions/29517213/redigo-read-redis-hash-that-has-variable-keys", "title": "redigo: read redis hash that has variable keys", "body": "<p>I need to read a redis hash from redigo. This hash has variable keys. This causes a problem because ScanStruct requires me to know those keys beforehand, so I can put it in a struct and unpack the HGETALL result into that struct. </p>\n\n<p>Is there a way to parse a redigo HGETALL result that has unknown keys? It does not have to be with ScanStruct (or even with redigo), as long as I can access the result from within go.  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 45496, "user_id": 436560, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/2GESV.jpg?s=128&g=1", "display_name": "Lajos Arpad", "link": "https://stackoverflow.com/users/436560/lajos-arpad"}, "edited": false, "score": 0, "creation_date": 1428496175, "post_id": 29514456, "comment_id": 47184800, "body": "Are you absolutely sure the newest version is being used?"}, {"owner": {"reputation": 2642, "user_id": 4057790, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/AwH9q.jpg?s=128&g=1", "display_name": "Mithun Shreevatsa", "link": "https://stackoverflow.com/users/4057790/mithun-shreevatsa"}, "reply_to_user": {"reputation": 45496, "user_id": 436560, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/2GESV.jpg?s=128&g=1", "display_name": "Lajos Arpad", "link": "https://stackoverflow.com/users/436560/lajos-arpad"}, "edited": false, "score": 0, "creation_date": 1428566434, "post_id": 29514456, "comment_id": 47219007, "body": "Yes i myself downloaded and extracted the files from the site : <a href=\"https://golang.org/dl/\" rel=\"nofollow noreferrer\">Golang Downloads</a>"}, {"owner": {"reputation": 7031, "user_id": 28855, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8a62c5134a4ff7b618582d8dd267d2b5?s=128&d=identicon&r=PG", "display_name": "Jaime Soriano", "link": "https://stackoverflow.com/users/28855/jaime-soriano"}, "edited": false, "score": 0, "creation_date": 1428604765, "post_id": 29514456, "comment_id": 47244235, "body": "Check with <code>which go</code> what go binary is being used when you type <code>go version</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3842449"}, "edited": false, "score": 0, "creation_date": 1558015142, "post_id": 29514456, "comment_id": 98967212, "body": "Yes! <code>$ which go</code> gives me <code>&#47;usr&#47;local&#47;go&#47;bin&#47;go</code> and <code>&#47;usr&#47;local&#47;go&#47;bin&#47;go version</code> gives me <code>go version go1.11.4 linux&#47;amd64</code>"}], "answers": [{"tags": [], "owner": {"reputation": 226, "user_id": 4627189, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-oeVJaPqW5J8/AAAAAAAAAAI/AAAAAAAACVU/lfp_hM0fZMM/photo.jpg?sz=128", "display_name": "Ravisankar Balaji", "link": "https://stackoverflow.com/users/4627189/ravisankar-balaji"}, "is_accepted": true, "score": 17, "last_activity_date": 1428993566, "last_edit_date": 1428993566, "creation_date": 1428993315, "answer_id": 29620655, "question_id": 29514456, "link": "https://stackoverflow.com/questions/29514456/go-is-printing-xgcc-version-but-not-go-installed-version/29620655#29620655", "title": "Go is printing xgcc version but not go installed version", "body": "<p>Looks like you have two versions of Go installed. One from ubuntu package manager and one you installed from source tar.</p>\n\n<p>To confirm kindly try to remove gccgo :</p>\n\n<pre><code>sudo apt-get remove gccgo\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 91, "user_id": 5686304, "user_type": "registered", "profile_image": "https://graph.facebook.com/1525891611054247/picture?type=large", "display_name": "Bi Hero", "link": "https://stackoverflow.com/users/5686304/bi-hero"}, "is_accepted": false, "score": 1, "last_activity_date": 1559790081, "creation_date": 1559790081, "answer_id": 56470397, "question_id": 29514456, "link": "https://stackoverflow.com/questions/29514456/go-is-printing-xgcc-version-but-not-go-installed-version/56470397#56470397", "title": "Go is printing xgcc version but not go installed version", "body": "<p>I got the same issue and i fixed it by this way:\nAccess to go folder: /usr/local/go (The installation folder of go)\nExecute these commands:</p>\n\n<p>Added by Go Path</p>\n\n<p><code>echo 'export GOROOT=/usr/local/go' &gt;&gt; ~/.bashrc</code></p>\n\n<p><code>echo 'export GOPATH=$HOME/go' &gt;&gt; ~/.bashrc</code>    </p>\n\n<p><code>echo 'export PATH=$PATH:$GOROOT/bin:$GOPATH/bin' &gt;&gt; ~/.bashrc</code>  </p>\n\n<p>And then go to the source folder and check go version: \n<code>go version go1.12.2 linux/amd64</code> it will be displayed the same version in go folder and you can work with go commands.</p>\n"}], "owner": {"reputation": 2642, "user_id": 4057790, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/AwH9q.jpg?s=128&g=1", "display_name": "Mithun Shreevatsa", "link": "https://stackoverflow.com/users/4057790/mithun-shreevatsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3148, "favorite_count": 1, "accepted_answer_id": 29620655, "answer_count": 2, "score": 3, "last_activity_date": 1559790081, "creation_date": 1428495635, "last_edit_date": 1428575619, "question_id": 29514456, "link": "https://stackoverflow.com/questions/29514456/go-is-printing-xgcc-version-but-not-go-installed-version", "title": "Go is printing xgcc version but not go installed version", "body": "<p>On <code>go version</code> : It prints </p>\n\n<pre><code>go version xgcc (Ubuntu 4.9.1-0ubuntu1) 4.9.1 linux/amd64\n</code></pre>\n\n<p>My installed version is the latest one and i.e 1.4.2 </p>\n\n<p>which got installed from the tar version : <code>go1.4.2.linux-amd64.tar.gz</code></p>\n\n<p>GO Environmental variables looks exactly like this:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"/home/user/coding/golang/gocnew/goc/bin\"\nGOCHAR=\"6\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/user/coding/golang/gocnew/goc\"\nGORACE=\"\"\nGOROOT=\"/home/user/go\"\nGOTOOLDIR=\"/home/user/go/pkg/tool/linux_amd64\"\nTERM=\"dumb\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-g -O2 -fPIC -m64 -pthread\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"    \n</code></pre>\n\n<p>I expect go version to be printed as 1.4.2, so how that can be achieved?</p>\n"}, {"tags": ["go", "zlib", "deflate"], "answers": [{"comments": [{"owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "edited": false, "score": 0, "creation_date": 1428494790, "post_id": 29513900, "comment_id": 47183799, "body": "Thanks for an amazing answer! I can&#39;t imagine why this aspect is not taken into account in &quot;net/http&quot; module."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "edited": false, "score": 4, "creation_date": 1428494954, "post_id": 29513900, "comment_id": 47183913, "body": "@VitalyIsaev It is, you just have to use the <a href=\"http://golang.org/pkg/compress/zlib/\" rel=\"nofollow noreferrer\"><code>compress&#47;zlib</code></a> package not the <code>compress&#47;flate</code> package. See the edited answer for properly using <code>zlib</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1471849636, "last_edit_date": 1471849636, "creation_date": 1428494114, "answer_id": 29513900, "question_id": 29513472, "link": "https://stackoverflow.com/questions/29513472/golang-compress-flate-module-cant-decompress-valid-deflate-compressed-http-b/29513900#29513900", "title": "Golang: &quot;compress/flate&quot; module can&#39;t decompress valid deflate compressed HTTP body", "body": "<p>Your input is not a simple deflated block, it's a <strong>zlib stream</strong>.</p>\n\n<p>According to the <a href=\"http://tools.ietf.org/html/rfc1950\" rel=\"nofollow\">ZLIB Compressed Data Format Specification 3.3</a> the first 2 bytes are:</p>\n\n<pre><code>-------------\n| CMF | FLG |\n-------------\n</code></pre>\n\n<p>The Compression Method and flags. Your input starts with <code>[120, 156]</code> which is <code>78 9C</code> in hexa. This is the Default Compression. Also no dictionary follows, so the subsequent data is the compressed data.</p>\n\n<p><sup>Bits 0 to 3 are CM Compression Method and bits 4 to 7 are CINFO Compression Info. In this case CINFO=7 indicates a 32K window size, CM=8 denotes the \"deflate\" compression method. FLG bit 5 tells if a dictionary is preset, which is in this case. Details of the FLG are also in the linked <a href=\"http://tools.ietf.org/html/rfc1950\" rel=\"nofollow\">RFC 1950</a>.</sup></p>\n\n<p>So your input basically tells the rest of the data was constructed using default compression, but the go <code>flate</code> package does not decode this.</p>\n\n<p>Change your decompression to omit the first 2 bytes like this and it will work:</p>\n\n<pre><code>enflated, err := ioutil.ReadAll(flate.NewReader(bytes.NewReader(content[2:])))\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/3_SwalDTLq\" rel=\"nofollow\">Go Playground</a>. But...</p>\n\n<p><strong>Use Proper ZLib decompression!</strong></p>\n\n<p>We got lucky this time because the compression level is the default and dictionary was preset. If not, you won't be able to decode it using the <code>flate</code> package. Since the input is a zlib stream, you should use the <a href=\"http://golang.org/pkg/compress/zlib/\" rel=\"nofollow\"><code>compress/zlib</code></a> package to properly decode it and not rely on luck:</p>\n\n<pre><code>r, err := zlib.NewReader(bytes.NewReader(content))\nif err != nil {\n    panic(err)\n}\nenflated, err := ioutil.ReadAll(r)\nif err != nil {\n    panic(err)\n}\nfmt.Println(string(enflated))\n</code></pre>\n\n<p>Try the <code>zlib</code> variant on the <a href=\"http://play.golang.org/p/wLa8A6Z-_S\" rel=\"nofollow\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3245, "favorite_count": 0, "accepted_answer_id": 29513900, "answer_count": 1, "score": 2, "last_activity_date": 1471849636, "creation_date": 1428492906, "last_edit_date": 1495542268, "question_id": 29513472, "link": "https://stackoverflow.com/questions/29513472/golang-compress-flate-module-cant-decompress-valid-deflate-compressed-http-b", "title": "Golang: &quot;compress/flate&quot; module can&#39;t decompress valid deflate compressed HTTP body", "body": "<p>This question continues the discussion started <a href=\"https://stackoverflow.com/questions/29502917/go-unmarshalling-json-from-compessed-http-invalid-character-looking-for-beginni\">here</a>. I found out that the HTTP response body can't be unmarshaled into JSON object because of <code>deflate</code> compression of the latter. Now I wonder how can I perform decompression with Golang. I will appreciate anyone who can show the errors in my code.</p>\n\n<p><strong>Input data</strong></p>\n\n<p>I've dumped the HTTP response body into the '<a href=\"http://www.fileconvoy.com/dfl.php?id=ga99041ebbf48e64299964773675b53e95a8effc5e\" rel=\"nofollow noreferrer\">test</a>' file. Here is it:</p>\n\n<pre><code>$ cat test\nx\ufffd\ufffdPAN\ufffd0\ufffd\n;\ufffd\ufffdNtJ\ufffdF\u04eedU\ufffd|\"oVR\ufffdC%\ufffdf\ufffd\ufffd\ufffd\ufffd\ufffdZ.\ufffd^Hs\ufffddW\ubb91\ufffd'\ufffd\ufffdDH\ufffdS\ufffdSFVC\ufffd\ufffd\ufffd\ufffdr)G,\ufffd\ufffd\ufffd\ufffd\ufffd&lt;\ufffd\ufffd\ufffdz}\ufffdx_g\ufffd+\ufffd2\ufffd\ufffdsl\ufffdr/\ufffdOy&gt;\ufffd\ufffdJ3\\\ufffdG\ufffd9\ufffd\ufffd\ufffdN\ufffd\ufffd\ufffd#[5M\ufffd^v/\ufffd2\u0494\ufffd\ufffd|\ufffdh\ufffd\ufffd[\ufffd~7\ufffd_\u5d1b&lt;D*\ufffd\ufffd\ufffd/\ufffd\ufffdi\n</code></pre>\n\n<p>Let's make sure that this file can be decompressed and even contains valid JSON:</p>\n\n<pre><code>$ zlib-flate -uncompress &lt; test\n{\"timestamp\":{\"tv_sec\":1428488670,\"tv_usec\":197041},\"string_timestamp\":\"2015-04-08 10:24:30.197041\",\"monitor_status\":\"enabled\",\"commands\":{\"REVERSE_LOOKUP\":{\"cache\":{\"outside\":{\"successes\":0,\"failures\":0,\"size\":0,\"time\":0},\"internal\":{\"successes\":0,\"failures\":0,\"size\":0,\"time\":0}},\"disk\":{\"outside\":{\"successes\":0,\"failures\":0,\"size\":0,\"time\":0},\"internal\":{\"successes\":13366,\"failures\":0,\"size\":0,\"time\":501808}},\"total\":{\"storage\":{\"successes\":0,\"failures\":0},\"proxy\":{\"successes\":13366,\"failures\":0}}},\"clients\":{}}}\n$ zlib-flate -uncompress &lt; test | python -m json.tool\n{\n    \"commands\": {\n        \"REVERSE_LOOKUP\": {\n            \"cache\": {\n               ....\n</code></pre>\n\n<p><strong>Source code</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"compress/flate\"\n    \"fmt\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    fname := \"./test\"\n    content, err := ioutil.ReadFile(fname)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(\"File content:\\n\", content)\n\n    enflated, err := ioutil.ReadAll(flate.NewReader(bytes.NewReader(content)))\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(\"Enflated:\\n\", enflated)\n}\n</code></pre>\n\n<p><strong>Error</strong></p>\n\n<pre><code>$ go run uncompress.go \nFile content:\n [120 156 181 80 65 78 195 48 16 252 10 242 57 69 118 226 166 38 247 156 64 42 42 130 107 100 156 165 88 196 118 149 93 35 160 234 223 89 183 61 112 42 226 192 109 118 118 102 103 180 123 65 62 0 146 13 59 209 237 5 189 15 8 78 116 74 215 70 27 211 174 100 85 184 124 34 111 86 82 171 67 37 144 102 31 183 195 15 167 168 165 90 46 164 94 72 115 165 100 87 235 174 145 215 39 189 168 68 72 209 83 154 7 22 83 70 86 67 180 207 19 140 188 114 41 4 27 71 44 225 155 254 169 223 60 244 195 221 122 125 251 120 95 24 103 221 43 20 144 50 161 31 143 16 179 115 128 8 108 225 114 47 214 79 121 62 15 232 191 224 8 74 51 6 92 213 71 130 57 218 233 175 78 182 142 30 223 254 35 91 53 77 219 94 118 47 165 50 210 148 18 148 232 124 128 31 104 183 151 91 176 126 55 167 143 207 95 3 15 229 180 155 60 68 42 159 231 241 27 47 165 167 25]\npanic: flate: corrupt input before offset 5\n\ngoroutine 1 [running]:\nruntime.panic(0x4a7180, 0x5)\n    /usr/lib/go/src/pkg/runtime/panic.c:266 +0xb6\nmain.main()\n    /home/isaev/side-projects/elliptics-manager/uncompress.go:20 +0x2a3\nexit status 2\n</code></pre>\n\n<p><strong>PS</strong> Ubuntu 14.10, Go 1.2.1</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 1696, "user_id": 3460555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca9131edc0800f70f343251b2979fd95?s=128&d=identicon&r=PG&f=1", "display_name": "seong", "link": "https://stackoverflow.com/users/3460555/seong"}, "edited": false, "score": 1, "creation_date": 1428492265, "post_id": 29512914, "comment_id": 47182194, "body": "Did you check for errors? Looks like you are ignoring them in your example code. If I had to guess, I&#39;d say you already have written to <code>http.ResponseWriter</code> before saving the session (headers sent)."}, {"owner": {"reputation": 202, "user_id": 4737827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc9ad34df6e85b082ecaf2c1fee6b16a?s=128&d=identicon&r=PG&f=1", "display_name": "Mrugank Dhimmar", "link": "https://stackoverflow.com/users/4737827/mrugank-dhimmar"}, "reply_to_user": {"reputation": 1696, "user_id": 3460555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca9131edc0800f70f343251b2979fd95?s=128&d=identicon&r=PG&f=1", "display_name": "seong", "link": "https://stackoverflow.com/users/3460555/seong"}, "edited": false, "score": 0, "creation_date": 1428492507, "post_id": 29512914, "comment_id": 47182352, "body": "yes, I\u2019ve checked it. got nil value -&gt;&quot; not found &lt;nil&gt;&quot; while checking condition for session in GetSession() method."}, {"owner": {"reputation": 202, "user_id": 4737827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc9ad34df6e85b082ecaf2c1fee6b16a?s=128&d=identicon&r=PG&f=1", "display_name": "Mrugank Dhimmar", "link": "https://stackoverflow.com/users/4737827/mrugank-dhimmar"}, "reply_to_user": {"reputation": 1696, "user_id": 3460555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca9131edc0800f70f343251b2979fd95?s=128&d=identicon&r=PG&f=1", "display_name": "seong", "link": "https://stackoverflow.com/users/3460555/seong"}, "edited": false, "score": 0, "creation_date": 1428492774, "post_id": 29512914, "comment_id": 47182519, "body": "according to doc (gorilla) for saving any session we&#39;ve to write session.Save(r, w).. and for multiple session they have mention sessions.Save(r,w)."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1428499000, "post_id": 29512914, "comment_id": 47186799, "body": "Correct \u2014 but you need to do this BEFORE you render a template or write any kind of response. Can you post the full <code>Login</code> function in your code?"}, {"owner": {"reputation": 202, "user_id": 4737827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc9ad34df6e85b082ecaf2c1fee6b16a?s=128&d=identicon&r=PG&f=1", "display_name": "Mrugank Dhimmar", "link": "https://stackoverflow.com/users/4737827/mrugank-dhimmar"}, "edited": false, "score": 0, "creation_date": 1428555610, "post_id": 29512914, "comment_id": 47213870, "body": "I&#39;m not rendering any templates from golang. i&#39;ve used angularJS for that. golang only handles json request from angular, process that request and give responce back to angular."}, {"owner": {"reputation": 1696, "user_id": 3460555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca9131edc0800f70f343251b2979fd95?s=128&d=identicon&r=PG&f=1", "display_name": "seong", "link": "https://stackoverflow.com/users/3460555/seong"}, "edited": false, "score": 1, "creation_date": 1428578958, "post_id": 29512914, "comment_id": 47226721, "body": "Rendering has nothing to do with it. If you are doing output in your HTTP body before you are setting the headers (where the cookie will be set), it won&#39;t work."}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "edited": false, "score": 0, "creation_date": 1473359996, "post_id": 29512914, "comment_id": 66122041, "body": "Nothing against alice nor rs/cors. But middlewares are not a pain in go as well as cors."}, {"owner": {"reputation": 6974, "user_id": 199475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f655f91b22aa5f97fc50936c8b6c0cd7?s=128&d=identicon&r=PG", "display_name": "carbocation", "link": "https://stackoverflow.com/users/199475/carbocation"}, "edited": false, "score": 0, "creation_date": 1476135106, "post_id": 29512914, "comment_id": 67213969, "body": "Does your session cookie name use spaces? If so, remove all spaces and try again. (See <a href=\"https://github.com/golang/go/issues/9758\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/9758</a> )."}], "answers": [{"tags": [], "owner": {"reputation": 351, "user_id": 6375269, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6HyWexmF0gI/AAAAAAAAAAI/AAAAAAAAABk/pvOQZH8Klcg/photo.jpg?sz=128", "display_name": "Kroksys", "link": "https://stackoverflow.com/users/6375269/kroksys"}, "is_accepted": false, "score": 1, "last_activity_date": 1477299264, "last_edit_date": 1477299264, "creation_date": 1477297940, "answer_id": 40213899, "question_id": 29512914, "link": "https://stackoverflow.com/questions/29512914/golang-gorilla-session-got-nil-value-while-checking-session/40213899#40213899", "title": "golang gorilla/session got nil value while checking session", "body": "<p>I don't know what value you what to get, but I assume you want a string value. I wrote simple <code>func GetFoo()</code> to get string value from <code>session1.Values[\"foo\"]</code>. </p>\n\n<p>Full example below: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/gorilla/sessions\"\n    \"github.com/justinas/alice\"\n    \"github.com/rs/cors\"\n)\n\nvar store = sessions.NewCookieStore([]byte(\"something-very-secret\"))\n\nconst My_UI = \"http://localhost:3000\"\n\nvar router = mux.NewRouter() //MUX Handeler\n\n//MAIN Function\nfunc init() {\n    store.Options = &amp;sessions.Options{\n        Path:     \"/\",\n        MaxAge:   3600 * 1, // 1 hour\n        HttpOnly: true,\n    }\n}\n\nfunc main() {\n    c := cors.New(cors.Options{\n        AllowedOrigins: []string{My_UI},\n    })\n    router.HandleFunc(\"/login\", Login)\n    router.HandleFunc(\"/check\", GetSession)\n    http.Handle(\"/\", router)\n    chain := alice.New(c.Handler).Then(router) //CORS enable\n    fmt.Println(\"server started at port 8080\")\n    http.ListenAndServe(\":8080\", chain)\n}\n\nfunc GetFoo(f interface{}) string {\n    if f != nil {\n        if foo, ok := f.(string); ok {\n            return foo\n        }\n    }\n    return \"\"\n}\n\nfunc GetSession(w http.ResponseWriter, r *http.Request) {\n    session1, _ := store.Get(r, \"loginSession\")\n    foo := GetFoo(session1.Values[\"foo\"])\n    if foo == \"\" {\n        fmt.Println(\"Foo is not set! Login to set value.\")\n    } else {\n        fmt.Println(\"Foo Value:\", foo, \".\")\n    }\n}\n\nfunc Login(w http.ResponseWriter, r *http.Request) {\n    // Save Foo\n    session1, _ := store.Get(r, \"loginSession\")\n    session1.Values[\"foo\"] = \"bar\"\n    session1.Save(r, w)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1529, "user_id": 2604529, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6SJdc.jpg?s=128&g=1", "display_name": "Marcel Novy", "link": "https://stackoverflow.com/users/2604529/marcel-novy"}, "is_accepted": false, "score": 2, "last_activity_date": 1477300114, "creation_date": 1477300114, "answer_id": 40214566, "question_id": 29512914, "link": "https://stackoverflow.com/questions/29512914/golang-gorilla-session-got-nil-value-while-checking-session/40214566#40214566", "title": "golang gorilla/session got nil value while checking session", "body": "<p>You got a mistake at your GetSession function. Please change <code>session</code> variable to <code>session1</code></p>\n\n<p>Also to check if session value is present better do it this way:</p>\n\n<pre><code>session, err := store.Get(r, ssid)\n    if err == nil {\n        if value, ok := session.Values[\"foo\"].(string); ok {\n            session_data = value\n        }\n    }\n</code></pre>\n"}], "owner": {"reputation": 202, "user_id": 4737827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc9ad34df6e85b082ecaf2c1fee6b16a?s=128&d=identicon&r=PG&f=1", "display_name": "Mrugank Dhimmar", "link": "https://stackoverflow.com/users/4737827/mrugank-dhimmar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1690, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1477300114, "creation_date": 1428491267, "last_edit_date": 1472889554, "question_id": 29512914, "link": "https://stackoverflow.com/questions/29512914/golang-gorilla-session-got-nil-value-while-checking-session", "title": "golang gorilla/session got nil value while checking session", "body": "<p>I have imported packages as    </p>\n\n<pre><code>import (\n    \"github.com/gorilla/sessions\"\n    \"github.com/gorilla/mux\"\n\n    //CORS\n    \"github.com/rs/cors\"\n    \"github.com/justinas/alice\"  \n)\n</code></pre>\n\n<p>and defined store and main method as follow</p>\n\n<pre><code>var store = sessions.NewCookieStore([]byte(\"something-very-secret\")) \n\nconst My_UI=\"http://localhost:3000\"\n\nfunc init() {\n    store.Options = &amp;sessions.Options{\n        Path:     \"/\",\n        MaxAge:   3600 * 1, // 1 hour\n        HttpOnly: true,\n    }\n}\n\nvar router = mux.NewRouter() //MUX Handeler\n\n//MAIN Function\n\nfunc main() {\n    c := cors.New(cors.Options{\n        AllowedOrigins: []string{My_UI},\n    })\n\n    router.HandleFunc(\"/submitted\",Login)\n    router.HandleFunc(\"/check\",GetSession)\n    http.Handle(\"/\", router)\n\n    chain := alice.New(c.Handler).Then(router) //CORS enable\n\n    fmt.Println(\"server started at port 8080\")\n    http.ListenAndServe(\":8080\", chain)\n}\n</code></pre>\n\n<p>In my method I\u2019ve created and set session value as describe in gorilla doc</p>\n\n<pre><code>func Login(w http.ResponseWriter, r *http.Request) {         \n    fmt.Println(\"In login-----------&gt;\")\n    sess := GetCon()                              //get connection session\n    defer sess.Close()                           //close session    \n    c := sess.DB(\"mydb\").C(\"users\")      //collection-&gt; select db table\n\n    session1, _ := store.Get(r, \"loginSession\")  //login session\n\n    //parse json data  \n    form := LoginUser{}\n    err := json.NewDecoder(r.Body).Decode(&amp;form)\n    if err !=nil {\n        fmt.Println(err)\n    }\n\n    //get query data\n    var result []Person\n\n    errc1 := c.Find(bson.M{\"email\":form.Email,\"password\":form.Password}).All(&amp;result)\n\n    if errc1 != nil {\n        js, err2 := json.Marshal(\"false\")\n        if err2 != nil{return}\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        w.Write(js)     \n    } else {\n        if len(result)==0 {\n            if err2 != nil {\n                return\n            }\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            w.Write(js) \n        } else {\n            fmt.Println(\"Success\")  \n            session1.Values[\"foo\"] = \"bar\"  \n            session1.Save(r, w) \n            fmt.Println(\"saved\",session1)\n            js, err2 := json.Marshal(&amp;result[0].Id)\n            if err2 != nil {return}\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            w.Write(js) \n        }       \n    }   \n}\n</code></pre>\n\n<p>Now if i want to get this session value in another method i got nil every time. don't know what goes wrong in my code.</p>\n\n<pre><code>func GetSession(w http.ResponseWriter, r *http.Request) {\n    session1, _ := store.Get(r, \"loginSession\")\n    fmt.Println(\"Session in SessionHandler\",session1)\n\n    if session.Values[\"foo\"] == nil {\n        fmt.Println(\"not found\",session.Values[\"foo\"]))\n    } else {\n        fmt.Println(\"value\",session.Values[\"foo\"])\n    }\n}\n</code></pre>\n"}, {"tags": ["javascript", "jquery", "html", "ajax", "go"], "comments": [{"owner": {"reputation": 192, "user_id": 1083135, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/650f7ee67c04d81685d76db49b385850?s=128&d=identicon&r=PG&f=1", "display_name": "VimleshS", "link": "https://stackoverflow.com/users/1083135/vimleshs"}, "edited": false, "score": 0, "creation_date": 1428486886, "post_id": 29510296, "comment_id": 47178618, "body": "Any pointers about partial rendering of go template will also help"}], "answers": [{"comments": [{"owner": {"reputation": 192, "user_id": 1083135, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/650f7ee67c04d81685d76db49b385850?s=128&d=identicon&r=PG&f=1", "display_name": "VimleshS", "link": "https://stackoverflow.com/users/1083135/vimleshs"}, "edited": false, "score": 0, "creation_date": 1428576194, "post_id": 29512785, "comment_id": 47225017, "body": "thanks @icza for your detail description. I&#39;m already populating dropdown by rendering html return via ajax in input.html    <code>$(&quot;#divPlaceholderForDropDown&quot;).empty(); $(&quot;#divPlaceholderForDropDown&quot;).append(data);\t   </code> Don&#39;t we have anything parallel to partial rendering of go templates ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 192, "user_id": 1083135, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/650f7ee67c04d81685d76db49b385850?s=128&d=identicon&r=PG&f=1", "display_name": "VimleshS", "link": "https://stackoverflow.com/users/1083135/vimleshs"}, "edited": false, "score": 0, "creation_date": 1428576492, "post_id": 29512785, "comment_id": 47225204, "body": "@VKS The easiest is if you define it as a separate template and you can simply execute only this template. This is described in my answer."}, {"owner": {"reputation": 192, "user_id": 1083135, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/650f7ee67c04d81685d76db49b385850?s=128&d=identicon&r=PG&f=1", "display_name": "VimleshS", "link": "https://stackoverflow.com/users/1083135/vimleshs"}, "edited": false, "score": 0, "creation_date": 1428577040, "post_id": 29512785, "comment_id": 47225515, "body": "Wow that means I had already done it perfectly ;) I had defined separate template for dropdown and was executing it via <code>tmpl.Executetemplate...</code> i was not happy to replace the html at the client side &amp; was looking for something like <code>{{template &quot;inner&quot;}}</code> which would do the job without me replacing it. But seems this is the only way .. I&#39;m accepting your answer.. thanks"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1428490837, "creation_date": 1428490837, "answer_id": 29512785, "question_id": 29510296, "link": "https://stackoverflow.com/questions/29510296/how-do-i-implement-cascading-dropdown-using-golangs-templates/29512785#29512785", "title": "How do I implement cascading dropdown using golang&#39;s templates", "body": "<p>On the higher level you have 2 options:</p>\n\n<ul>\n<li>Either send all the values for the dropdown lists (e.g. as a tree) and change the values on the 2nd and 3rd level when the dropdown of a higher level changes (suitable for small lists, unsuitable for large dataset)</li>\n<li>Or the one you chose: when selection changes, you make an AJAX call (triggered from <code>onchange</code>) and you populate the list from the results.</li>\n</ul>\n\n<h2>Elaborating #2: populating list from the AJAX call result</h2>\n\n<p>You also have 2 options to do this:</p>\n\n<ul>\n<li><p>Either the AJAX call returns HTML call which you can simply use to replace the inner HTML of the HTML <code>&lt;select&gt;</code> tag.</p></li>\n<li><p>Or the AJAX call may only return the data (e.g. encoded using JSON), and a Javascript code can build the content of the list.</p></li>\n</ul>\n\n<h3>AJAX returning HTML</h3>\n\n<p>The AJAX call may return the complete HTML code needed to be replaced as the inner HTML of the <code>&lt;select&gt;</code>. To achieve this at server side, you can create/separate the HTML template responsible only to generate the HTML code of this, for example:</p>\n\n<pre><code>{{define \"innerList\"}}\n    {{range .}}\n        &lt;option value=\"{{.Key}}\"&gt;{{.Text}}&lt;/option&gt;\n    {{end}}\n{{end}}\n</code></pre>\n\n<p>You can execute only this template like this:</p>\n\n<pre><code>// tmpl is the collection of your templates\nvalues := ... // Load/construct the values\ntmpl.ExecuteTemplate(w, \"innerList\", values)\n</code></pre>\n\n<p>Here <code>values</code> is a slice of the following structure:</p>\n\n<pre><code>type Pair struct {\n    Key string\n    Text string\n}\n</code></pre>\n\n<h3>Building <code>&lt;select&gt;</code> content with Javascript</h3>\n\n<p>The AJAX call may return a JSON datastructure, an array/list of <code>value;text</code> pairs from which you add the <code>&lt;option&gt;</code> child tags yourself.</p>\n\n<p>To add an <code>&lt;option&gt;</code> to a <code>&lt;select&gt;</code> tag:</p>\n\n<pre><code>var x = document.getElementById(\"mySelect\");\nvar option = document.createElement(\"option\");\noption.value = \"1234\";\noption.text = \"Kiwi\";\nx.add(option);\n</code></pre>\n\n<p>So basically what you need to do is remove current children of the <code>&lt;select&gt;</code>, iterate over the list received as the response and add a new <code>&lt;option&gt;</code> tag constructed from each.</p>\n"}], "owner": {"reputation": 192, "user_id": 1083135, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/650f7ee67c04d81685d76db49b385850?s=128&d=identicon&r=PG&f=1", "display_name": "VimleshS", "link": "https://stackoverflow.com/users/1083135/vimleshs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1902, "favorite_count": 0, "accepted_answer_id": 29512785, "answer_count": 1, "score": 2, "last_activity_date": 1428490837, "creation_date": 1428483800, "last_edit_date": 1428489899, "question_id": 29510296, "link": "https://stackoverflow.com/questions/29510296/how-do-i-implement-cascading-dropdown-using-golangs-templates", "title": "How do I implement cascading dropdown using golang&#39;s templates", "body": "<p><strong>Scenario:</strong></p>\n\n<p>I have a cascade scenario, where values in second dropdown depends upon first. I have three templates \"layout\", \"input\" and \"inner\".</p>\n\n<p><strong>Attempt:</strong></p>\n\n<p>I'm making ajax call on change of first dropdown in \"input\" template and stuck with handling the response returned. Currently I found a way to fix it by replacing html of second dropdown. But, I think this is not the better way to handle. I want something in line of rendering templates where I do not need to amend html. </p>\n\n<p>please help in acheiving the task in better way or point to some wiki. <strong>Only Standard Library</strong></p>\n\n<p>Thanks,</p>\n\n<p><strong><em>Layout.html</em>:</strong>\n<a href=\"http://play.golang.org/p/LikKy6rf3-\" rel=\"nofollow\">http://play.golang.org/p/LikKy6rf3-</a></p>\n\n<p><strong><em>Input.html</em>:</strong>\n<a href=\"http://play.golang.org/p/wM7EpPdXuM\" rel=\"nofollow\">http://play.golang.org/p/wM7EpPdXuM</a> </p>\n\n<p><strong><em>Inner.html</em>:</strong>\n<a href=\"http://play.golang.org/p/xFpInKZfFT\" rel=\"nofollow\">http://play.golang.org/p/xFpInKZfFT</a></p>\n\n<p><strong><em>Main.go</em>:</strong>\n<a href=\"http://play.golang.org/p/cxtJU-Lhi1\" rel=\"nofollow\">http://play.golang.org/p/cxtJU-Lhi1</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 249903, "user_id": 2422776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2353050223ebecb113741c29458de4b2?s=128&d=identicon&r=PG", "display_name": "Mureinik", "link": "https://stackoverflow.com/users/2422776/mureinik"}, "edited": false, "score": 3, "creation_date": 1428474728, "post_id": 29507467, "comment_id": 47171620, "body": "Are you sure <code>cksum</code> is actually installed under <code>&#47;bin</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 825, "user_id": 2278893, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Et28N.jpg?s=128&g=1", "display_name": "Akash Shinde", "link": "https://stackoverflow.com/users/2278893/akash-shinde"}, "is_accepted": false, "score": 1, "last_activity_date": 1428475341, "creation_date": 1428475341, "answer_id": 29507672, "question_id": 29507467, "link": "https://stackoverflow.com/questions/29507467/exec-cksum-executable-file-not-found-in-path-in-golang/29507672#29507672", "title": "exec: &quot;cksum&quot;: executable file not found in $PATH in golang", "body": "<blockquote>\n  <p>Most of the executable binaries are present under /usr/bin\n  directory,so you need to modify your code as below.</p>\n</blockquote>\n\n<pre><code>cmd := exec.Command(\"/usr/bin/cksum\",dst)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 3, "last_activity_date": 1428514757, "creation_date": 1428514757, "answer_id": 29521604, "question_id": 29507467, "link": "https://stackoverflow.com/questions/29507467/exec-cksum-executable-file-not-found-in-path-in-golang/29521604#29521604", "title": "exec: &quot;cksum&quot;: executable file not found in $PATH in golang", "body": "<p>From the documentation for <a href=\"https://golang.org/pkg/os/exec/#Command\" rel=\"nofollow\"><code>exec.Command</code></a>:</p>\n\n<blockquote>\n  <p>If name contains no path separators, Command uses LookPath to resolve the path to a complete name if possible. Otherwise it uses name directly.</p>\n</blockquote>\n\n<p>So it's slightly better to use <code>cmd := exec.Command(\"cksum\", \u2026)</code> and let it be found where ever it exists on the path.\nAlternatively you should have run <code>which cksum</code> which on nearly every unix system will give: <code>/usr/bin/cksum</code>.</p>\n\n<p>But better yet, make your code portable to <em>any</em> OS that can run Go and use <a href=\"https://golang.org/pkg/hash/crc32/\" rel=\"nofollow\"><code>hash/crc32</code></a>.\nOr even better, if you can remove any requirements on having to use CRC32 (which is what the ancient <code>cksum</code> uses),\npick one of the other <strong>far superior</strong> hashes from\n<a href=\"https://golang.org/pkg/hash/#pkg-subdirectories\" rel=\"nofollow\"><code>hash/\u2026</code></a>,\n<a href=\"https://golang.org/pkg/crypto/#pkg-subdirectories\" rel=\"nofollow\"><code>crypto/\u2026</code></a> (e.g.\u00a0sha256),\nor <a href=\"https://godoc.org/golang.org/x/crypto\" rel=\"nofollow\"><code>golang.org/x/crypto/\u2026</code></a> (e.g.\u00a0sha3).</p>\n"}], "owner": {"reputation": 51, "user_id": 4341584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/370e128662884710efcdfdfb8ac09486?s=128&d=identicon&r=PG&f=1", "display_name": "Gopi", "link": "https://stackoverflow.com/users/4341584/gopi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4124, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1428514757, "creation_date": 1428474561, "last_edit_date": 1428475342, "question_id": 29507467, "link": "https://stackoverflow.com/questions/29507467/exec-cksum-executable-file-not-found-in-path-in-golang", "title": "exec: &quot;cksum&quot;: executable file not found in $PATH in golang", "body": "<p>I'm trying to get the cksum of one file using Go by executing the command <code>cksum</code>.</p>\n\n<p>Getting the below error:</p>\n\n<pre><code>exec: \"cksum\": executable file not found in $PATH\n</code></pre>\n\n<p>Below is the code:</p>\n\n<pre><code>cmd := exec.Command(\"/bin/cksum\",dst)\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1428470159, "post_id": 29506339, "comment_id": 47169762, "body": "Train does server side rendering FYI."}, {"owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1428470212, "post_id": 29506339, "comment_id": 47169780, "body": "Didn&#39;t know that. Thanks!"}], "owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1428469400, "creation_date": 1428469400, "question_id": 29506339, "link": "https://stackoverflow.com/questions/29506339/go-precompile-sass-and-slim-files-into-go-html-format", "title": "Go: precompile SASS and SLIM files into Go HTML format", "body": "<p>I'd like to use SASS and SLIM for my Go project. I'd like the html files to be rendered server side.</p>\n\n<p>I know there is <a href=\"https://github.com/shaoshing/train\" rel=\"nofollow\">https://github.com/shaoshing/train</a>, but it seems like rendering occurs on the client side, which is not what I want.</p>\n\n<p>There is also <a href=\"https://github.com/yosssi/ace\" rel=\"nofollow\">https://github.com/yosssi/ace</a>, which is a native implementation of SLIM in Go. However, there is no SASS implementation. </p>\n\n<p>Does anyone have any idea on how to do this?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 0, "last_activity_date": 1428470678, "creation_date": 1428470678, "answer_id": 29506588, "question_id": 29506123, "link": "https://stackoverflow.com/questions/29506123/i-am-writing-a-chat-app-that-will-have-irc-style-commands-what-is-the-best-way/29506588#29506588", "title": "I am writing a chat app that will have irc style commands. What is the best way to structure the program to process those commands?", "body": "<p>First off, you don't need to use reflect. You can have the <code>Command</code> struct contain a member with a func type.</p>\n\n<pre><code>type Command struct {\n  name     string // the name of the command\n  f        func(string) // the function that will be called upon match\n  help     string // the help message for the command\n  regex    regexp.Regexp // the regex pattern that will run the command\n}\n\nfunc processMessage(text string){\n  for _,cmd := range(allCmds){\n    if cmd.regex.MatchString(text){\n      cmd.f(text)\n      return\n    }\n  }\n  defaultAction(text) //or just add a catch-all with a regex of `.*`\n}\n</code></pre>\n\n<p>Then you can add commands with a function of the appropriate signature:</p>\n\n<pre><code>cmd := Command{name: \"foo\",f: func(text string){fmt.Println(text)}}\n</code></pre>\n\n<p>it doesn't have to have exactly that signature. You can have it accept a connection or whatever. You also don't have to inline the function definition, you can reference any function you want that has the appropriate signature.</p>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 2005449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b52d9df5b7eed1d3700c4d4a556f957e?s=128&d=identicon&r=PG", "display_name": "user2005449", "link": "https://stackoverflow.com/users/2005449/user2005449"}, "edited": false, "score": 0, "creation_date": 1428499958, "post_id": 29506659, "comment_id": 47187516, "body": "Thanks for taking the time to respond. Using a map is an obvious improvement and a great example of exactly what I&#39;m talking about."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1449793757, "last_edit_date": 1449793757, "creation_date": 1428471032, "answer_id": 29506659, "question_id": 29506123, "link": "https://stackoverflow.com/questions/29506123/i-am-writing-a-chat-app-that-will-have-irc-style-commands-what-is-the-best-way/29506659#29506659", "title": "I am writing a chat app that will have irc style commands. What is the best way to structure the program to process those commands?", "body": "<p>In IRC style commands usually a command line looks like this:</p>\n\n<pre><code>/cmd [param1] [param2] ... [paramn]\n</code></pre>\n\n<p>When such a command is received, you can split it using <a href=\"http://golang.org/pkg/strings/#Split\" rel=\"nofollow\"><code>strings.Split()</code></a> to get the parts or tokens of the command. By this you will have the first token identifying the command.</p>\n\n<p>You can build a <code>map[string]Command</code> map where you map from text commands to their <code>Command</code> structure. In this map you can get commands by simply indexing the map, e.g.:</p>\n\n<pre><code>cmdMap := make(map[string]Command)\n// Populate map\n\ntextCmd := \"/help\"\ncmd := cmdMap[textCmd]\n</code></pre>\n\n<p>If you want to have command aliases (e.g. you want <code>/help</code> and <code>/h</code> and <code>/?</code> all to do the same), you can store the list of aliases for each command and when you build the <code>cmdMap</code>, also add entries for all aliases to point to the same <code>Command</code> structure, in which case you should define it like this:</p>\n\n<pre><code>cmdMap := make(map[string]*Command)\n\nhelpCmd := &amp;Command{...} // Create help command\ncmdMap[\"/help\"] = helpCmd\ncmdMap[\"/h\"] = helpCmd\ncmdMap[\"/?\"] = helpCmd\n</code></pre>\n\n<p>Note: you could also strip off the leading slash <code>'/'</code> and just use the rest of the command (<code>\"help\"</code>, <code>\"h\"</code> and <code>\"?\"</code> in this case) to init your map, it's up to you.</p>\n\n<p>Also you don't have to store the name of the function, functions in Go are values so you can have a function field in your <code>Command</code> struct and then you can call that function without reflection. For example:</p>\n\n<pre><code>func DoSomething() {\n    fmt.Println(\"Doing something...\")\n}\n\nvar someFv = DoSomething\n\n// And now you can do:\nsomeFv()\n</code></pre>\n\n<p>See <a href=\"http://golang.org/ref/spec#Function_types\" rel=\"nofollow\">Function types</a> and <a href=\"http://golang.org/ref/spec#Function_literals\" rel=\"nofollow\">Function literals</a> in the Go Language Specification.</p>\n"}], "owner": {"reputation": 23, "user_id": 2005449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b52d9df5b7eed1d3700c4d4a556f957e?s=128&d=identicon&r=PG", "display_name": "user2005449", "link": "https://stackoverflow.com/users/2005449/user2005449"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1449793757, "creation_date": 1428468324, "question_id": 29506123, "link": "https://stackoverflow.com/questions/29506123/i-am-writing-a-chat-app-that-will-have-irc-style-commands-what-is-the-best-way", "title": "I am writing a chat app that will have irc style commands. What is the best way to structure the program to process those commands?", "body": "<p>I am writing what is essentially a chat program. I want to include some special irc style commands in it and I just can't seem to conceptualize how to structure the program. I'm wondering if people could help me out from a high level perspective. I'm not looking for code, just ideas on how to best proceed.</p>\n\n<p>My best attempt is to have a Command struct like below:</p>\n\n<pre><code>type Command struct {\n  name     string // the name of the command\n  function string // the function that will be called upon match\n  help     string // the help message for the command\n  regex    string // the regex pattern that will run the command\n}\n</code></pre>\n\n<p>and then have a slice of Commands and just iterate over that every time I receive a message from the client. If the received data matches the regex then have the reflect (I think this will work) package call \"function\". For some reason, I feel like there has to be a better way. I'm learning to code Go on my own and don't have resources available to me to bounce ideas off of. I would very much appreciate your thoughts on this.</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc", "proto3"], "comments": [{"owner": {"reputation": 15144, "user_id": 159388, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2891cf8a08784976cf1643f5009a4f59?s=128&d=identicon&r=PG", "display_name": "murgatroid99", "link": "https://stackoverflow.com/users/159388/murgatroid99"}, "edited": false, "score": 1, "creation_date": 1428531046, "post_id": 29505302, "comment_id": 47206898, "body": "It&#39;s not about who you&#39;re &quot;reaching out to&quot;. You&#39;re asking a question about Protocol Buffers. gRPC is a different thing. Sure, they&#39;re related, but your question isn&#39;t <i>about</i> gRPC."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1430341667, "post_id": 29505302, "comment_id": 48029883, "body": "They don&#39;t seem to have said much. As a guess, maybe it cleans up the interface: gRPC <a href=\"http://godoc.org/google.golang.org/grpc#Stream\" rel=\"nofollow noreferrer\">just fills your structs</a> whereas proto <a href=\"http://godoc.org/github.com/golang/protobuf/proto#Unmarshal\" rel=\"nofollow noreferrer\">needs to give you a message to pass along</a> (and you need to actually pass it along to keep your app unknown-field-safe). They might have figured it safer to make callers and callees upgrade together, in the same way that, say, when a Go method adds a parameter its callers need to update as well. As a workaround, maybe you could use proto3 maps for new fields."}, {"owner": {"reputation": 50016, "user_id": 74865, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5c89bc294cd59812fee520aeb2e3dcd1?s=128&d=identicon&r=PG", "display_name": "Andriy Drozdyuk", "link": "https://stackoverflow.com/users/74865/andriy-drozdyuk"}, "edited": false, "score": 1, "creation_date": 1431463913, "post_id": 29505302, "comment_id": 48507925, "body": "Maybe provide a specific use-case for which you used &quot;unknown&quot; fields?"}, {"owner": {"reputation": 317, "user_id": 1392794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71efeccc7680d546c6848a1fc19052cd?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/1392794/joshua"}, "edited": false, "score": 2, "creation_date": 1431494391, "post_id": 29505302, "comment_id": 48517404, "body": "If a protobuf message is stored in a database and a client with an older version of the protobuf message type needs to make a modification without clobbering the fields written by clients with the current version of the protobuf.  Updating all clients simultaneously to have the latest protobuf message version is not a possibility. Further, there are different client types that have different update schedules, so the change would need to be coordinated across multiple codebases."}, {"owner": {"reputation": 159, "user_id": 3691917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/032cdc3885c121382e329b5038701958?s=128&d=identicon&r=PG", "display_name": "siimphh", "link": "https://stackoverflow.com/users/3691917/siimphh"}, "edited": false, "score": 0, "creation_date": 1432983339, "post_id": 29505302, "comment_id": 49163183, "body": "Sure, this makes release engineering a bit harder but it&#39;s certainly not impossible. It is sufficient to first release all components with the new proto definition built in and only in the next release start writing the new fields."}, {"owner": {"reputation": 317, "user_id": 1392794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71efeccc7680d546c6848a1fc19052cd?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/1392794/joshua"}, "edited": false, "score": 0, "creation_date": 1498238470, "post_id": 29505302, "comment_id": 76436214, "body": "Looks like this will be implemented officially now: <a href=\"https://github.com/google/protobuf/issues/272#issuecomment-286249933\" rel=\"nofollow noreferrer\">github.com/google/protobuf/issues/272#issuecomment-286249933</a> <a href=\"https://docs.google.com/document/d/1KMRX-G91Aa-Y2FkEaHeeviLRRNblgIahbsk4wA14gRk/edit#heading=h.w8dtggryroj4\" rel=\"nofollow noreferrer\">docs.google.com/document/d/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 16391, "user_id": 4690866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/854931adcbf75ac84630116123920854?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Anderson", "link": "https://stackoverflow.com/users/4690866/eric-anderson"}, "is_accepted": false, "score": 2, "last_activity_date": 1433434102, "creation_date": 1433434102, "answer_id": 30648891, "question_id": 29505302, "link": "https://stackoverflow.com/questions/29505302/how-can-unknown-field-functionality-be-replicated-in-proto3/30648891#30648891", "title": "How can unknown field functionality be replicated in proto3?", "body": "<p>Getting rid of field presence for primitives makes Protobuf more \"natural\" and efficient in many languages, since primitives in C/C++, Java, C#, and Go must be present. In such languages, if you want presence information you \"box\" the primitive by making it a pointer to a primitive.</p>\n\n<p>Protobuf 3 gets rid of presence for primitives but still has it for messages. Thus, you can use the same \"boxing\" technique for Protobuf. Protobuf now has <a href=\"https://github.com/google/protobuf/blob/master/src/google/protobuf/wrappers.proto\" rel=\"nofollow\">standard messages that box primitives</a>.</p>\n"}], "owner": {"reputation": 317, "user_id": 1392794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71efeccc7680d546c6848a1fc19052cd?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/1392794/joshua"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1275, "favorite_count": 1, "answer_count": 1, "score": 8, "last_activity_date": 1433434102, "creation_date": 1428462909, "last_edit_date": 1431464009, "question_id": 29505302, "link": "https://stackoverflow.com/questions/29505302/how-can-unknown-field-functionality-be-replicated-in-proto3", "title": "How can unknown field functionality be replicated in proto3?", "body": "<p>Google has removed unknown fields in proto3. I would love to hear the reasoning behind this choice. Also, if anyone has any way to replicate the proto2 behavior I would love to hear it.</p>\n\n<p>If it matters, we are writing our code in Go.</p>\n\n<p>As proto3 and <a href=\"http://www.grpc.io/\" rel=\"nofollow\">grpc</a> were developed in parallel, I wanted to reach out to the grpc community as well.</p>\n\n<p>Source: <a href=\"https://github.com/google/protobuf/releases/tag/v3.0.0-alpha-2\" rel=\"nofollow\" title=\"Release Protocol Buffers v3.0.0-alpha-2 \u00b7 google/protobuf\">Removal of unknown fields</a></p>\n"}, {"tags": ["go", "file-comparison", "filecompare"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 1, "creation_date": 1428549872, "post_id": 29505089, "comment_id": 47212251, "body": "Can you clarify the question? It&#39;s asking for two different things (a replacement for <code>filecmp.cmp</code> and a way to see if two files contain the same bytes)."}, {"owner": {"reputation": 1335, "user_id": 1896517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f0bdb1f3bf9cc6469bb61606284cbabf?s=128&d=identicon&r=PG", "display_name": "rvillablanca", "link": "https://stackoverflow.com/users/1896517/rvillablanca"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 1, "creation_date": 1428550452, "post_id": 29505089, "comment_id": 47212397, "body": "Sure, I write an diff tool in Python (for self learning Python) which make patches comparing files and using the filecmp.cmp function to compare the new and the old file. Right now I&#39;m writing the same tool using Go Lang and I cannot find some function like the above, thus my questions if for to find a builtin function to compare files, but, if it doesn&#39;t exist, I had suggested to use some hash function or write a byte-to-byte comparison function. Sorry my english"}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 11, "last_activity_date": 1428469779, "last_edit_date": 1428469779, "creation_date": 1428469258, "answer_id": 29506310, "question_id": 29505089, "link": "https://stackoverflow.com/questions/29505089/how-can-i-compare-two-files-in-golang/29506310#29506310", "title": "How can I compare two files in golang?", "body": "<p>I am not sure that function does what you think it does. From the <a href=\"https://docs.python.org/2/library/filecmp.html\" rel=\"noreferrer\">docs</a>, </p>\n\n<blockquote>\n  <p>Unless shallow is given and is false, files with identical os.stat() signatures are taken to be equal.</p>\n</blockquote>\n\n<p>Your call is comparing only the <a href=\"https://hg.python.org/cpython/file/2.7/Lib/filecmp.py#l59\" rel=\"noreferrer\">signature</a> of <code>os.stat</code>, which only includes:</p>\n\n<ol>\n<li>File mode</li>\n<li>Modified Time</li>\n<li>Size</li>\n</ol>\n\n<p>You can learn all three of these things in Go from the <a href=\"http://golang.org/pkg/os/#Stat\" rel=\"noreferrer\"><code>os.Stat</code></a> function. This really would only indicate that they are literally the same file, or symlinks to the same file, or a copy of that file.</p>\n\n<p>If you want to go deeper you can open both files and compare them (python version reads 8k at a time).</p>\n\n<p>You could use an crc or md5 to hash both files, but if there are differences at the beginning of a long file, you want to stop early. I would recommend reading some number of bytes at a time from each reader and comparing with <a href=\"http://golang.org/pkg/bytes/#Compare\" rel=\"noreferrer\"><code>bytes.Compare</code></a>.</p>\n"}, {"comments": [{"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 3, "creation_date": 1428547509, "post_id": 29528747, "comment_id": 47211674, "body": "Two problems with this post. 1. you are encouraging loading all data into memory. 2. DeepEqual uses reflection and is slow. It makes more sense to use bytes.Equal and if such a function did not exist, I would recommend a for loop."}, {"owner": {"reputation": 818, "user_id": 870828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879e95dc92f8370f79b78747ad16b3f5?s=128&d=identicon&r=PG", "display_name": "chaseadamsio", "link": "https://stackoverflow.com/users/870828/chaseadamsio"}, "reply_to_user": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 0, "creation_date": 1428581289, "post_id": 29528747, "comment_id": 47228157, "body": "Updated per @StephenWeinberg, 1. good point. 2. bytes.Equal does exist and you&#39;re right, it&#39;s significantly faster than reflecting, updated code snippet."}, {"owner": {"reputation": 818, "user_id": 870828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879e95dc92f8370f79b78747ad16b3f5?s=128&d=identicon&r=PG", "display_name": "chaseadamsio", "link": "https://stackoverflow.com/users/870828/chaseadamsio"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428581338, "post_id": 29528747, "comment_id": 47228197, "body": "Updated per @Dave C 3. I was &quot;lazy&quot; in this example (I also didn&#39;t have a package declaration or a main function, so this code would error if someone copy-pasted it), so I handled the errors and updated any code that wouldn&#39;t have compiled and ran. Hope that satisfies your problem with my answer."}, {"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 1, "creation_date": 1428586626, "post_id": 29528747, "comment_id": 47232027, "body": "You did not solve problem 1. You are still loading both files completely into memory. You did solve problems 2 and 3."}, {"owner": {"reputation": 818, "user_id": 870828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879e95dc92f8370f79b78747ad16b3f5?s=128&d=identicon&r=PG", "display_name": "chaseadamsio", "link": "https://stackoverflow.com/users/870828/chaseadamsio"}, "edited": false, "score": 0, "creation_date": 1428604913, "post_id": 29528747, "comment_id": 47244330, "body": "Sorry, I didn&#39;t mean to imply I solved your problem, but made it clear in the comments that it was just a trivial example on the chance that someone copy/pasted the example and had problems.  What&#39;s an alternative solution you&#39;d like to propose? I&#39;m happy to delete my response if you think it needs to be removed because it&#39;s encouraging bad conduct and it&#39;s bad enough to be worthy of down votes."}, {"owner": {"reputation": 1768, "user_id": 452281, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/abb031deb5c8c34179f02933363d6161?s=128&d=identicon&r=PG", "display_name": "jftuga", "link": "https://stackoverflow.com/users/452281/jftuga"}, "edited": false, "score": 0, "creation_date": 1588559837, "post_id": 29528747, "comment_id": 108935922, "body": "All <code>bytes.Equal()</code> does is: <code>return string(a) == string(b)</code>. See <a href=\"https://github.com/golang/go/blob/master/src/bytes/bytes.go\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/bytes/bytes.go</a>"}], "tags": [], "owner": {"reputation": 818, "user_id": 870828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879e95dc92f8370f79b78747ad16b3f5?s=128&d=identicon&r=PG", "display_name": "chaseadamsio", "link": "https://stackoverflow.com/users/870828/chaseadamsio"}, "is_accepted": false, "score": 7, "last_activity_date": 1479494460, "last_edit_date": 1479494460, "creation_date": 1428546790, "answer_id": 29528747, "question_id": 29505089, "link": "https://stackoverflow.com/questions/29505089/how-can-i-compare-two-files-in-golang/29528747#29528747", "title": "How can I compare two files in golang?", "body": "<p>How about using <code>bytes.Equal</code>?</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\"io/ioutil\"\n\"log\"\n\"bytes\"\n)\n\nfunc main() {\n    // per comment, better to not read an entire file into memory\n    // this is simply a trivial example.\n    f1, err1 := ioutil.ReadFile(\"lines1.txt\")\n\n    if err1 != nil {\n        log.Fatal(err1)\n    }\n\n    f2, err2 := ioutil.ReadFile(\"lines2.txt\")\n\n    if err2 != nil {\n        log.Fatal(err2)\n    }\n\n    fmt.Println(bytes.Equal(f1, f2)) // Per comment, this is significantly more performant.\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1430768562, "post_id": 30038571, "comment_id": 48193144, "body": "Why the overhead of a scanner? That needs to parse the bytes looking for line separators which you don&#39;t care about. It also may not do what you expect for binary files. You can just read &quot;chunks&quot; into a pair of reasonably sized buffers and use <code>bytes.Equal</code> as you go (which is what @captncraig suggests)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430769526, "post_id": 30038571, "comment_id": 48193688, "body": "BTW, it definitely won&#39;t work for binary files without frequent enough 0x0A bytes: &quot;Scanning stops unrecoverably at EOF, the first I/O error, or <b>a token too large to fit in the buffer</b>.&quot; (From <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"nofollow noreferrer\">bufio.Scanner</a>)."}, {"owner": {"reputation": 3272, "user_id": 1292605, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/knHw8.jpg?s=128&g=1", "display_name": "Pith", "link": "https://stackoverflow.com/users/1292605/pith"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430770525, "post_id": 30038571, "comment_id": 48194248, "body": "Thanks for your feedback. I edited my answer to follow your advice. Do you have an idea of a good chunk size default ?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430775668, "post_id": 30038571, "comment_id": 48196903, "body": "4k, 8k, 64k, or 128k are likely choices for &quot;real&quot; code reading from files but anything is fine as an example. In general with an <code>io.Reader</code> you&#39;d also have to handle short reads (or use <code>io.ReadFull</code> and deal with <code>io.ErrUnexpectedEOF</code>); <code>os.File</code> doesn&#39;t seem to guarantee it won&#39;t give a short read. All the corner cases start to get annoying :(. Probably not worth dealing with in an SO example, however."}, {"owner": {"reputation": 527, "user_id": 1195832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc4796b90f1b852b6efce7617f8dad94?s=128&d=identicon&r=PG", "display_name": "mat007", "link": "https://stackoverflow.com/users/1195832/mat007"}, "edited": false, "score": 0, "creation_date": 1600259190, "post_id": 30038571, "comment_id": 113030456, "body": "Readers are allowed to return a partially filled buffer even if more data will be available later as the docs say <code>If some data is available but not len(p) bytes, Read conventionally returns what is available instead of waiting for more.</code> So here <code>f1</code> and <code>f2</code> could get out of sync while reading."}], "tags": [], "owner": {"reputation": 3272, "user_id": 1292605, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/knHw8.jpg?s=128&g=1", "display_name": "Pith", "link": "https://stackoverflow.com/users/1292605/pith"}, "is_accepted": false, "score": 12, "last_activity_date": 1570706383, "last_edit_date": 1570706383, "creation_date": 1430768354, "answer_id": 30038571, "question_id": 29505089, "link": "https://stackoverflow.com/questions/29505089/how-can-i-compare-two-files-in-golang/30038571#30038571", "title": "How can I compare two files in golang?", "body": "<p>To complete the @captncraig answer, if you want to know if the two files are the same, you can use the <a href=\"http://godoc.org/os#SameFile\" rel=\"nofollow noreferrer\">SameFile(fi1, fi2 FileInfo)</a> method from the OS package.</p>\n\n<blockquote>\n  <p>SameFile reports whether fi1 and fi2 describe the same file. For example, on Unix this means that the device and inode fields of the two underlying structures are identical;</p>\n</blockquote>\n\n<p>Otherwise, if you want to check the files contents, here is a solution which checks the two files line by line avoiding the load of the entire files in memory.</p>\n\n<p>First try: <a href=\"https://play.golang.org/p/NlQZRrW1dT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NlQZRrW1dT</a></p>\n\n<hr>\n\n<p><strong>EDIT:</strong> Read by bytes chunks and fail fast if the files have not the same size. <a href=\"https://play.golang.org/p/YyYWuCRJXV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/YyYWuCRJXV</a></p>\n\n<pre><code>const chunkSize = 64000\n\nfunc deepCompare(file1, file2 string) bool {\n    // Check file size ...\n\n    f1, err := os.Open(file1)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer f1.Close()\n\n    f2, err := os.Open(file2)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer f2.Close()\n\n    for {\n        b1 := make([]byte, chunkSize)\n        _, err1 := f1.Read(b1)\n\n        b2 := make([]byte, chunkSize)\n        _, err2 := f2.Read(b2)\n\n        if err1 != nil || err2 != nil {\n            if err1 == io.EOF &amp;&amp; err2 == io.EOF {\n                return true\n            } else if err1 == io.EOF || err2 == io.EOF {\n                return false\n            } else {\n                log.Fatal(err1, err2)\n            }\n        }\n\n        if !bytes.Equal(b1, b2) {\n            return false\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1397, "user_id": 1016460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c82e30ce757f6e7e320665454544b574?s=128&d=identicon&r=PG&f=1", "display_name": "youfu", "link": "https://stackoverflow.com/users/1016460/youfu"}, "edited": false, "score": 1, "creation_date": 1518005503, "post_id": 40682880, "comment_id": 84324218, "body": "<code>const defaultMaxSize = 10000000000 &#47;&#47; Only the first 10^10 bytes are compared.</code> what the hell"}, {"owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "reply_to_user": {"reputation": 1397, "user_id": 1016460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c82e30ce757f6e7e320665454544b574?s=128&d=identicon&r=PG&f=1", "display_name": "youfu", "link": "https://stackoverflow.com/users/1016460/youfu"}, "edited": false, "score": 3, "creation_date": 1518032065, "post_id": 40682880, "comment_id": 84341876, "body": "This default max size is a protection against a possibly unlimited stream that would cause a never-ending comparison. You can override it by using the option &#39;Options.MaxSize&#39;. If you have a better strategy for handling infinite streams, please open a pull request."}], "tags": [], "owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "is_accepted": false, "score": 2, "last_activity_date": 1479490286, "creation_date": 1479490286, "answer_id": 40682880, "question_id": 29505089, "link": "https://stackoverflow.com/questions/29505089/how-can-i-compare-two-files-in-golang/40682880#40682880", "title": "How can I compare two files in golang?", "body": "<p>You can use a package like <a href=\"https://github.com/udhos/equalfile\" rel=\"nofollow noreferrer\">equalfile</a></p>\n\n<p>Main API:</p>\n\n<pre><code>func CompareFile(path1, path2 string) (bool, error)\n</code></pre>\n\n<p>Godoc: <a href=\"https://godoc.org/github.com/udhos/equalfile\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/udhos/equalfile</a></p>\n\n<p>Example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"github.com/udhos/equalfile\"\n )\n\nfunc main() {\n    if len(os.Args) != 3 {\n        fmt.Printf(\"usage: equal file1 file2\\n\")\n        os.Exit(2)\n    }\n\n    file1 := os.Args[1]\n    file2 := os.Args[2]\n\n    equal, err := equalfile.CompareFile(file1, file2)\n    if err != nil {\n        fmt.Printf(\"equal: error: %v\\n\", err)\n        os.Exit(3)\n    }\n\n    if equal {\n        fmt.Println(\"equal: files match\")\n        os.Exit(0)\n    }\n\n    fmt.Println(\"equal: files differ\")\n    os.Exit(1)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4687, "user_id": 2176740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09c0ea83bcb343688502045304a0474?s=128&d=identicon&r=PG", "display_name": "joonas.fi", "link": "https://stackoverflow.com/users/2176740/joonas-fi"}, "is_accepted": false, "score": 0, "last_activity_date": 1603448533, "creation_date": 1603448533, "answer_id": 64498218, "question_id": 29505089, "link": "https://stackoverflow.com/questions/29505089/how-can-i-compare-two-files-in-golang/64498218#64498218", "title": "How can I compare two files in golang?", "body": "<p>Here's an <code>io.Reader</code> I whipped out. You can <code>_, err := io.Copy(ioutil.Discard,  newCompareReader(a, b))</code> to get an error if two streams don't share equal contents. This implementation is optimized for performance by limiting unnecessary data copying.</p>\n<pre><code>package main\n\nimport (\n    &quot;bytes&quot;\n    &quot;errors&quot;\n    &quot;fmt&quot;\n    &quot;io&quot;\n)\n\ntype compareReader struct {\n    a    io.Reader\n    b    io.Reader\n    bBuf []byte // need buffer for comparing B's data with one that was read from A\n}\n\nfunc newCompareReader(a, b io.Reader) io.Reader {\n    return &amp;compareReader{\n        a: a,\n        b: b,\n    }\n}\n\nfunc (c *compareReader) Read(p []byte) (int, error) {\n    if c.bBuf == nil {\n        // assuming p's len() stays the same, so we can optimize for both of their buffer\n        // sizes to be equal\n        c.bBuf = make([]byte, len(p))\n    }\n\n    // read only as much data as we can fit in both p and bBuf\n    readA, errA := c.a.Read(p[0:min(len(p), len(c.bBuf))])\n    if readA &gt; 0 {\n        // bBuf is guaranteed to have at least readA space\n        if _, errB := io.ReadFull(c.b, c.bBuf[0:readA]); errB != nil { // docs: &quot;EOF only if no bytes were read&quot;\n            if errB == io.ErrUnexpectedEOF {\n                return readA, errors.New(&quot;compareReader: A had more data than B&quot;)\n            } else {\n                return readA, fmt.Errorf(&quot;compareReader: read error from B: %w&quot;, errB)\n            }\n        }\n\n        if !bytes.Equal(p[0:readA], c.bBuf[0:readA]) {\n            return readA, errors.New(&quot;compareReader: bytes not equal&quot;)\n        }\n    }\n    if errA == io.EOF {\n        // in happy case expecting EOF from B as well. might be extraneous call b/c we might've\n        // got it already from the for loop above, but it's easier to check here\n        readB, errB := c.b.Read(c.bBuf)\n        if readB &gt; 0 {\n            return readA, errors.New(&quot;compareReader: B had more data than A&quot;)\n        }\n\n        if errB != io.EOF {\n            return readA, fmt.Errorf(&quot;compareReader: got EOF from A but not from B: %w&quot;, errB)\n        }\n    }\n\n    return readA, errA\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3395, "user_id": 6164984, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/gtaJI.png?s=128&g=1", "display_name": "math2001", "link": "https://stackoverflow.com/users/6164984/math2001"}, "is_accepted": false, "score": 0, "last_activity_date": 1605587290, "creation_date": 1605587290, "answer_id": 64869366, "question_id": 29505089, "link": "https://stackoverflow.com/questions/29505089/how-can-i-compare-two-files-in-golang/64869366#64869366", "title": "How can I compare two files in golang?", "body": "<blockquote>\n<p>The standard way is to stat them and use os.SameFile.</p>\n<p>-- <a href=\"https://groups.google.com/g/golang-nuts/c/G-5D6agvz2Q/m/2jV_6j6LBgAJ\" rel=\"nofollow noreferrer\">https://groups.google.com/g/golang-nuts/c/G-5D6agvz2Q/m/2jV_6j6LBgAJ</a></p>\n</blockquote>\n<p><code>os.SameFile</code> should roughly do the same things as Python's <code>filecmp.cmp(f1, f2)</code> (ie. <code>shallow=true</code>, meaning it only compares the file infos obtained by stat).</p>\n<blockquote>\n<p><code>func SameFile(fi1, fi2 FileInfo) bool</code></p>\n<p>SameFile reports whether fi1 and fi2 describe the same file. For example, on Unix this means that the device and inode fields of the two underlying structures are identical; on other systems the decision may be based on the path names. SameFile only applies to results returned by this package's Stat. It returns false in other cases.</p>\n</blockquote>\n<p>But if you actually want to compare the file's content, you'll have to do it yourself.</p>\n"}, {"comments": [{"owner": {"reputation": 96, "user_id": 749191, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a244c5ed94d92d288444604360a919a?s=128&d=identicon&r=PG", "display_name": "Christopher", "link": "https://stackoverflow.com/users/749191/christopher"}, "edited": false, "score": 0, "creation_date": 1608578349, "post_id": 65288142, "comment_id": 115621621, "body": "This code looks good at first sight but has some issues due to the semantics of <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\">io.Reader</a>, e.g.:  1. If the first call to <code>Read</code> returns <code>io.EOF</code> and a non-zero count of bytes read - it is not necessarily true that the files are the same for files &lt; 8K. It is allowed that a read that hits EOF can return the error and a non-zero number of bytes read in the same call. So it must be compared anyway.  2. If one of the reads returns <code>io.EOF</code> and the other is not, it may not  be true that the files differ since one could be a &quot;short read&quot;."}, {"owner": {"reputation": 467, "user_id": 551495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4068939c536a97bb0874de364a0d980?s=128&d=identicon&r=PG", "display_name": "Yobert", "link": "https://stackoverflow.com/users/551495/yobert"}, "reply_to_user": {"reputation": 96, "user_id": 749191, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a244c5ed94d92d288444604360a919a?s=128&d=identicon&r=PG", "display_name": "Christopher", "link": "https://stackoverflow.com/users/749191/christopher"}, "edited": false, "score": 0, "creation_date": 1609621746, "post_id": 65288142, "comment_id": 115881366, "body": "@Christopher Aha! good catch, though I think most implementations of Read() such as the one in &quot;os&quot; for os.File will never return(n &gt; 0, EOF). They instead return(n &gt; 0, nil), and then on the next call to read they return (0, EOF). But it looks like you&#39;re right about TCP connections in the base &quot;net&quot; package-- those may return some bytes, and an error, if I understand the docs correctly."}, {"owner": {"reputation": 467, "user_id": 551495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4068939c536a97bb0874de364a0d980?s=128&d=identicon&r=PG", "display_name": "Yobert", "link": "https://stackoverflow.com/users/551495/yobert"}, "reply_to_user": {"reputation": 96, "user_id": 749191, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a244c5ed94d92d288444604360a919a?s=128&d=identicon&r=PG", "display_name": "Christopher", "link": "https://stackoverflow.com/users/749191/christopher"}, "edited": false, "score": 0, "creation_date": 1609621988, "post_id": 65288142, "comment_id": 115881435, "body": "@Christopher I updated the text to make sure to note that caveat. Thanks!"}], "tags": [], "owner": {"reputation": 467, "user_id": 551495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4068939c536a97bb0874de364a0d980?s=128&d=identicon&r=PG", "display_name": "Yobert", "link": "https://stackoverflow.com/users/551495/yobert"}, "is_accepted": false, "score": 0, "last_activity_date": 1609621962, "last_edit_date": 1609621962, "creation_date": 1607944938, "answer_id": 65288142, "question_id": 29505089, "link": "https://stackoverflow.com/questions/29505089/how-can-i-compare-two-files-in-golang/65288142#65288142", "title": "How can I compare two files in golang?", "body": "<p>Something like this should do the trick, and should be memory-efficient compared to the other answers. I looked at <code>github.com/udhos/equalfile</code> and it seemed a bit overkill to me. Before you call compare() here, you should do two <code>os.Stat()</code> calls and compare file sizes for an early out fast path.</p>\n<p>The reason to use this implementation over the other answers is because you don't want to hold the entirety of both files in memory if you don't have to. You can read an amount from A and B, compare, and then continue reading the next amount, one buffer-load from each file at a time until you are done. You just have to be careful because you may read 50 bytes from A and then 60 bytes from B because your read may have blocked for some reason.</p>\n<p>This implemention assumes a Read() call will not return N &gt; 0 (some bytes read) at the same time as an error != nil. This is how os.File behaves, but not how other implementations of Read may behave, such as net.TCPConn.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n  &quot;os&quot;\n  &quot;bytes&quot;\n  &quot;errors&quot;\n)\n\nvar errNotSame = errors.New(&quot;File contents are different&quot;)\n\nfunc compare(p1, p2 string) error {\n    var (\n        buf1 [8192]byte\n        buf2 [8192]byte\n    )\n\n    fh1, err := os.Open(p1)\n    if err != nil {\n        return err\n    }\n    defer fh1.Close()\n\n    fh2, err := os.Open(p2)\n    if err != nil {\n        return err\n    }\n    defer fh2.Close()\n\n    for {\n        n1, err1 := fh1.Read(buf1[:])\n        n2, err2 := fh2.Read(buf2[:])\n\n        if err1 == io.EOF &amp;&amp; err2 == io.EOF {\n            // files are the same!\n            return nil\n        }\n        if err1 == io.EOF || err2 == io.EOF {\n            return errNotSame\n        }\n        if err1 != nil {\n            return err1\n        }\n        if err2 != nil {\n            return err2\n        }\n\n        // short read on n1\n        for n1 &lt; n2 {\n            more, err := fh1.Read(buf1[n1:n2])\n            if err == io.EOF {\n                return errNotSame\n            }\n            if err != nil {\n                return err\n            }\n            n1 += more\n        }\n        // short read on n2\n        for n2 &lt; n1 {\n            more, err := fh2.Read(buf2[n2:n1])\n            if err == io.EOF {\n                return errNotSame\n            }\n            if err != nil {\n                return err\n            }\n            n2 += more\n        }\n        if n1 != n2 {\n            // should never happen\n            return fmt.Errorf(&quot;file compare reads out of sync: %d != %d&quot;, n1, n2)\n        }\n\n        if bytes.Compare(buf1[:n1], buf2[:n2]) != 0 {\n            return errNotSame\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 96, "user_id": 749191, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a244c5ed94d92d288444604360a919a?s=128&d=identicon&r=PG", "display_name": "Christopher", "link": "https://stackoverflow.com/users/749191/christopher"}, "is_accepted": false, "score": 0, "last_activity_date": 1609951690, "creation_date": 1609951690, "answer_id": 65599859, "question_id": 29505089, "link": "https://stackoverflow.com/questions/29505089/how-can-i-compare-two-files-in-golang/65599859#65599859", "title": "How can I compare two files in golang?", "body": "<p>After checking the existing answers I whipped up a simple package for comparing arbitrary (finite) <code>io.Reader</code> and files as a convenience method: <a href=\"https://github.com/hlubek/readercomp\" rel=\"nofollow noreferrer\">https://github.com/hlubek/readercomp</a></p>\n<p><strong>Example:</strong></p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;log&quot;\n    &quot;os&quot;\n\n    &quot;github.com/hlubek/readercomp&quot;\n)\n\nfunc main() {\n    result, err := readercomp.FilesEqual(os.Args[1], os.Args[2])\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(result)\n}\n</code></pre>\n"}], "owner": {"reputation": 1335, "user_id": 1896517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f0bdb1f3bf9cc6469bb61606284cbabf?s=128&d=identicon&r=PG", "display_name": "rvillablanca", "link": "https://stackoverflow.com/users/1896517/rvillablanca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19536, "favorite_count": 3, "accepted_answer_id": 29506310, "answer_count": 8, "score": 7, "last_activity_date": 1609951690, "creation_date": 1428461546, "question_id": 29505089, "link": "https://stackoverflow.com/questions/29505089/how-can-i-compare-two-files-in-golang", "title": "How can I compare two files in golang?", "body": "<p>With Python I can do the next:</p>\n\n<pre><code>equals = filecmp.cmp(file_old, file_new)\n</code></pre>\n\n<p>Is there any builtin function to do that in go language? I googled it but without success. </p>\n\n<p>I could use some hash function in <code>hash/crc32</code> package, but that is more work that the above Python code. </p>\n"}, {"tags": ["unit-testing", "go"], "answers": [{"comments": [{"owner": {"reputation": 425, "user_id": 1609999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9ed3aba567b518c4750e7581cc89d82?s=128&d=identicon&r=PG", "display_name": "wonderflow", "link": "https://stackoverflow.com/users/1609999/wonderflow"}, "edited": false, "score": 0, "creation_date": 1428467214, "post_id": 29505071, "comment_id": 47168783, "body": "Thank you very much for your help! It&#39;s just what I want!"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 4, "creation_date": 1428515634, "post_id": 29505071, "comment_id": 47198352, "body": "Typo in this: you need either <code>&amp;b</code> in the Display call <i>or</i> <code>b := new(bytes.Buffer)</code> since the <code>Write</code> method has a pointer receiver."}, {"owner": {"reputation": 425, "user_id": 1609999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9ed3aba567b518c4750e7581cc89d82?s=128&d=identicon&r=PG", "display_name": "wonderflow", "link": "https://stackoverflow.com/users/1609999/wonderflow"}, "edited": false, "score": 0, "creation_date": 1428540552, "post_id": 29505071, "comment_id": 47209780, "body": "Thanks Dave! I don&#39;t know it can be fixed so easy. :)"}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 27, "last_activity_date": 1428536472, "last_edit_date": 1428536472, "creation_date": 1428461441, "answer_id": 29505071, "question_id": 29504852, "link": "https://stackoverflow.com/questions/29504852/how-to-test-io-writer-in-golang/29505071#29505071", "title": "How to test io.writer in golang?", "body": "<p>You can simply pass in your own <code>io.Writer</code> and test what gets written into it matches what you expect. <code>bytes.Buffer</code> is a good choice for such an <code>io.Writer</code> since it simply stores the output in its buffer.</p>\n\n<pre><code>func TestDisplay(t *testing.T) {\n    s := newContainerStats() // Replace this the appropriate constructor\n    var b bytes.Buffer\n    if err := s.Display(&amp;b); err != nil {\n        t.Fatalf(\"s.Display() gave error: %s\", err)\n    }\n    got := b.String()\n    want := \"hello world\\n\"\n    if got != want {\n        t.Errorf(\"s.Display() = %q, want %q\", got, want)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 425, "user_id": 1609999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9ed3aba567b518c4750e7581cc89d82?s=128&d=identicon&r=PG", "display_name": "wonderflow", "link": "https://stackoverflow.com/users/1609999/wonderflow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7651, "favorite_count": 2, "accepted_answer_id": 29505071, "answer_count": 1, "score": 14, "last_activity_date": 1428536472, "creation_date": 1428460048, "question_id": 29504852, "link": "https://stackoverflow.com/questions/29504852/how-to-test-io-writer-in-golang", "title": "How to test io.writer in golang?", "body": "<p>Recently I hope to write a unit test for golang. The function is as below.</p>\n\n<pre><code>func (s *containerStats) Display(w io.Writer) error {\n    fmt.Fprintf(w, \"%s %s\\n\", \"hello\", \"world\")\n    return nil\n}\n</code></pre>\n\n<p>So how can I test the result of \"func Display\" is \"hello world\"?</p>\n"}, {"tags": ["go", "datastore"], "answers": [{"comments": [{"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1428458283, "post_id": 29504410, "comment_id": 47166513, "body": "That&#39;s really awkward isn&#39;t it? Since the python api actually supports it I&#39;m wondering if this is a go sdk bug"}, {"owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "reply_to_user": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1428458386, "post_id": 29504410, "comment_id": 47166545, "body": "@Theuserwithnohat, yes it <i>IS</i> strange and I come from Python background too. I have just started learning Go and found this limitation <i>VERY</i> annoying"}, {"owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "reply_to_user": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1428458628, "post_id": 29504410, "comment_id": 47166600, "body": "@Theuserwithnohat, by the way, shouldn&#39;t the query be more like: <code>datastore.NewQuery(...).Filter()</code>? I guess this is just a quick code that you try to demonstrate the point."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1428458949, "post_id": 29504410, "comment_id": 47166683, "body": "I&#39;m actually using a wrapper to make the api less painful  thus the reason why the code looks a bit unusual. I guess I have to add a few more lines to handle the negation filter though the std api limitation doesn&#39;t make much sense to me.."}, {"owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "reply_to_user": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1428459105, "post_id": 29504410, "comment_id": 47166724, "body": "@Theuserwithnohat, I made myself forget what I have already learnt datastore api in Python so the transition to writing code in Go is now rather smooth."}], "tags": [], "owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "is_accepted": true, "score": 1, "last_activity_date": 1428457159, "creation_date": 1428457159, "answer_id": 29504410, "question_id": 29504124, "link": "https://stackoverflow.com/questions/29504124/does-datastore-supports-inequality-filter/29504410#29504410", "title": "Does datastore supports inequality filter?", "body": "<p>In the <a href=\"https://cloud.google.com/appengine/docs/go/datastore/queries#Go_Property_filters\" rel=\"nofollow\">doc</a>, it states that filter only supports these: <code>=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>.</p>\n\n<p>So <code>!=</code> isn't supported. However you may have a workaround like this:</p>\n\n<pre><code>q.Query = q.Query.Filter(\"Field1 &gt;\", value).Filter(\"Field1 &lt;\", value)\n</code></pre>\n\n<p>which should yield the result as <code>!=</code>.</p>\n"}], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 29504410, "answer_count": 1, "score": 2, "last_activity_date": 1428457159, "creation_date": 1428454982, "question_id": 29504124, "link": "https://stackoverflow.com/questions/29504124/does-datastore-supports-inequality-filter", "title": "Does datastore supports inequality filter?", "body": "<p>I'm trying to run a query using the inequality filter but it errors out:<code>datastore: invalid operator \"!=\" in filter \"Field1 !=\"</code> \n Isn't this supported?</p>\n\n<p>I'm using Go whose documentation doesn't mention this filter but the <a href=\"https://cloud.google.com/appengine/docs/python/datastore/queries#Python_Filters\" rel=\"nofollow\">python docs</a> seem to support negation so I'm wondering if it's a go specific issue or if I'm missing something.</p>\n\n<pre><code>q.Query = q.Query.Filter(\"Field1 !=\", value)\n</code></pre>\n"}, {"tags": ["json", "http", "go", "deflate"], "comments": [{"owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "edited": false, "score": 0, "creation_date": 1428453960, "post_id": 29502917, "comment_id": 47165521, "body": "Will it be invalid json source which <b>requests</b> can tolerate but not Go? Anyway, could you try parsing directly from the response with <code>err := json.NewDecoder(res.Body).Decode(&amp;jsondata)</code> ... and see what happens?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1428509416, "post_id": 29502917, "comment_id": 47194676, "body": "The underlying problem is that the server sends an unsolicited deflate encoded response. The server should be fixed honor the encodings listed in the Accept-Encoding header."}, {"owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1428523454, "post_id": 29502917, "comment_id": 47203050, "body": "@ThunderCat, could you please provide more information about what&#39;s actually wrong with server? I&#39;ll try to inform the developers. Actually the response was generated by a tiny HTTP monitoring server built into the <a href=\"https://github.com/reverbrain/elliptics\" rel=\"nofollow noreferrer\">Elliptics</a> distributed key-value  storage."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1428538348, "post_id": 29502917, "comment_id": 47209209, "body": "The net/http client <a href=\"https://github.com/golang/go/blob/6f6512bd6002fa9a20b46c4d6a3def03d4f0b2fa/src/net/http/transport.go#L1047-L1065\" rel=\"nofollow noreferrer\">does not include deflate in the list of accepted encodings</a>.  The server ignores the client&#39;s accepted encodings by sending a deflate encoded response.  Should use on of the encodings listed in Accept-Encoding header or use the identity encoding."}], "answers": [{"comments": [{"owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "edited": false, "score": 0, "creation_date": 1428450398, "post_id": 29503039, "comment_id": 47164529, "body": "thanks for a nice advice. I&#39;ve fixed <code>Top struct</code>, but unfortunately still having the same issue"}, {"owner": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "reply_to_user": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "edited": false, "score": 0, "creation_date": 1428453308, "post_id": 29503039, "comment_id": 47165332, "body": "Can you paste the raw output from hitting that url?"}], "tags": [], "owner": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "is_accepted": false, "score": 2, "last_activity_date": 1428448428, "creation_date": 1428448428, "answer_id": 29503039, "question_id": 29502917, "link": "https://stackoverflow.com/questions/29502917/go-unmarshalling-json-from-compessed-http-invalid-character-looking-for-beginni/29503039#29503039", "title": "Go unmarshalling JSON from compessed HTTP: invalid character looking for beginning of value", "body": "<p>I don't know about 'x', but struct fields must be public (start with a capital letter) to be considered by the json Unmarshaller. Of course then the names don't match the json keys, and you have to add json annotations like so:</p>\n\n<pre><code>type Top struct {\n    Timestamp        Timestamp `json:\"timestamp\"`\n    String_timestamp string `json:\"string_timestamp\"`\n    Monitor_status   string `json:\"monitor_status\"`\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "edited": false, "score": 0, "creation_date": 1428450202, "post_id": 29503050, "comment_id": 47164471, "body": "thanks for a prompt reply and very useful explanation (code updated). But unfortunately I&#39;m facing the same error again.."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1428460125, "post_id": 29503050, "comment_id": 47166958, "body": "The unmashaler is case insensitive. Converting a []byte to a []byte is not necessary, but harmless."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 1, "last_activity_date": 1428448476, "creation_date": 1428448476, "answer_id": 29503050, "question_id": 29502917, "link": "https://stackoverflow.com/questions/29502917/go-unmarshalling-json-from-compessed-http-invalid-character-looking-for-beginni/29503050#29503050", "title": "Go unmarshalling JSON from compessed HTTP: invalid character looking for beginning of value", "body": "<p>I believe this is due to you double encoding. <code>ioutil.ReadAll(res.Body)</code> returns a <code>[]byte</code> so when you do <code>[]byte(body)</code> you're casting what is already a byte array, my guess is that first bytes UTF value is <code>x</code>. Just update this; <code>json.Unmarshal([]byte(body), &amp;jsondata)</code> to <code>json.Unmarshal(body, &amp;jsondata)</code> and I bet it will unmarshal just fine.</p>\n\n<p>Also, unrelated to your error but as pointed out in the other answer if you do not export the fields in your struct (in go this means start the field name with a capital letter) then the unmarshaler will not be able to make user of them. To make that work you need to update you type to;</p>\n\n<pre><code>type Top struct {\n    Timestamp        Timestamp `json:\"timestamp\"`\n    String_timestamp string `json:\"string_timestamp\"`\n    Monitor_status   string `json:\"monitor_status\"`\n}\n</code></pre>\n\n<p>The json annotations are required because the unmarshaler is very strict and requires exact matches (case sensitive) for field names.</p>\n"}, {"tags": [], "owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "is_accepted": true, "score": 4, "last_activity_date": 1428482080, "creation_date": 1428482080, "answer_id": 29509718, "question_id": 29502917, "link": "https://stackoverflow.com/questions/29502917/go-unmarshalling-json-from-compessed-http-invalid-character-looking-for-beginni/29509718#29509718", "title": "Go unmarshalling JSON from compessed HTTP: invalid character looking for beginning of value", "body": "<p>The Go JSON marshaller can only marshal unicode strings. It seems that your JSON is not encoded in unicode, but with some other encoding (deflate?).</p>\n\n<p>If you take your bytes stream:</p>\n\n<pre><code>[120 156 77 203 65 14 130 48 16 70 225 171 152 127 93 76 59 51 162 244 50 13 96 99 154 216 98 232 192 134 112 119 81 55 110 95 190 183 65 83 142 85 251 252 130 223 160 107 168 113 132 119 66 55 145 182 117 108 62 109 249 70 98 234 108 183 27 84 157 83 121 132 191 19 100 221 165 177 210 216 235 137 200 11 123 230 243 207 195 32 79 37 233 52 135 3 235 82 15 29 75 63 60 227 29 251 27 195 90 38 189]\n</code></pre>\n\n<p>And try to get a unicode string out of it:</p>\n\n<pre><code>body := []byte{120, 156, 77, 203, 65, 14, 130, 48, 16, 70, 225, 171, 152, 127, 93, 76, 59, 51, 162, 244, 50, 13, 96, 99, 154, 216, 98, 232, 192, 134, 112, 119, 81, 55, 110, 95, 190, 183, 65, 83, 142, 85, 251, 252, 130, 223, 160, 107, 168, 113, 132, 119, 66, 55, 145, 182, 117, 108, 62, 109, 249, 70, 98, 234, 108, 183, 27, 84, 157, 83, 121, 132, 191, 19, 100, 221, 165, 177, 210, 216, 235, 137, 200, 11, 123, 230, 243, 207, 195, 32, 79, 37, 233, 52, 135, 3, 235, 82, 15, 29, 75, 63, 60, 227, 29, 251, 27, 195, 90, 38, 189}\nfmt.Println(string(body))\n</code></pre>\n\n<p>You would see a weird (compressed?) string in the console, not JSON. </p>\n\n<p>I guess that the python http client automatically decompresses the deflated bytes while the Go http client does not (I know it does so for gzip but not sure if for deflate). You would have to read out the deflated bytes and convert them into a unicode string before you will be able to use the JSON marshaller to parse them. </p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 7783569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16288ffd7b3d5a3a9010d500f05e460f?s=128&d=identicon&r=PG&f=1", "display_name": "Lilly Wu", "link": "https://stackoverflow.com/users/7783569/lilly-wu"}, "is_accepted": false, "score": 1, "last_activity_date": 1490766952, "last_edit_date": 1490766952, "creation_date": 1490760927, "answer_id": 43084217, "question_id": 29502917, "link": "https://stackoverflow.com/questions/29502917/go-unmarshalling-json-from-compessed-http-invalid-character-looking-for-beginni/43084217#43084217", "title": "Go unmarshalling JSON from compessed HTTP: invalid character looking for beginning of value", "body": "<p>Try this please</p>\n\n<pre><code>func get_content() {\n\n    url := \"http://172.17.0.31:20000/top\"\n\n    res, err := http.Get(url)\n    if err != nil {\n        panic(err.Error())\n    }\n    defer res.Body.Close()\n\n    fmt.Println(\"res body:\", res.Body)\n\n    body, err := ioutil.ReadAll(resp=.Body)\n\n    fmt.Println(\"body:\", body)\n    re, err := zlib.NewReader(bytes.NewReader(body))\n    fmt.Println(\"zlib:\", re)\n    enflated, err := ioutil.ReadAll(re)\n    fmt.Println(\"enflated:\", string(enflated))\n\n    var jsondata Top\n    err = json.Unmarshal(body, &amp;jsondata)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    fmt.Println(jsondata)\n}\n</code></pre>\n\n<p>and ensure <code>http://172.17.0.31:20000/top</code> return json type.</p>\n"}], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12763, "favorite_count": 1, "accepted_answer_id": 29509718, "answer_count": 4, "score": 1, "last_activity_date": 1490766952, "creation_date": 1428447836, "last_edit_date": 1495535459, "question_id": 29502917, "link": "https://stackoverflow.com/questions/29502917/go-unmarshalling-json-from-compessed-http-invalid-character-looking-for-beginni", "title": "Go unmarshalling JSON from compessed HTTP: invalid character looking for beginning of value", "body": "<p>I've just written my first Go application which downloads and unmarshales simple JSON object over http. Http content is compressed:\n<code>'content-encoding': 'deflate'</code></p>\n\n<p>I used several well-known examples (like <a href=\"https://www.socketloop.com/tutorials/golang-unmarshal-json-from-http-response\" rel=\"nofollow noreferrer\">this</a>). Unfortunately the application fails to parse the desired JSON with quite rare and strange error. I wasn't able to find out what's the problem. Any help will be appreciated. </p>\n\n<p><strong>JSON input</strong> \n(Python was used for debugging)</p>\n\n<pre><code>In [8]: r = requests.get(\"http://172.17.0.31:20000/top\")\n\nIn [9]: r.text\nOut[9]: u'{\"timestamp\":{\"tv_sec\":1428447555,\"tv_usec\":600186},\"string_timestamp\":\"2015-04-07 22:59:15.600186\",\"monitor_status\":\"enabled\"}'\nIn [18]: r.headers\nOut[18]: {'content-length': '111', 'content-type': 'application/json', 'connection': 'close', 'content-encoding': 'deflate'}\n</code></pre>\n\n<p><strong>Source code</strong> (<strong>UPDATED</strong> according to the answers) </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\ntype Top struct {\n    Timestamp        Timestamp `json:\"timestamp\"`\n    String_timestamp string    `json:\"string_timestamp\"`\n    Monitor_status   string    `json:\"monitor_status\"`\n}\n\ntype Timestamp struct {\n    Tv_sec  int `json:\"tv_sec\"`\n    Tv_usec int `json:\"tv_usec\"`\n}\n\nfunc get_content() {\n\n    url := \"http://172.17.0.31:20000/top\"\n\n    res, err := http.Get(url)\n    if err != nil {\n        panic(err.Error())\n    }\n    fmt.Println(res)\n\n    body, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        panic(err.Error())\n    }\n    fmt.Println(body)\n\n    var jsondata Top\n    err = json.Unmarshal(body, &amp;jsondata)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    fmt.Println(jsondata)\n}\n\nfunc main() {\n    get_content()\n}\n</code></pre>\n\n<p><strong>Error</strong></p>\n\n<pre><code>[vitaly@thermaltake elliptics-manager]$ go run main.go \n&amp;{200 OK 200 HTTP/1.1 1 1 map[Content-Type:[application/json] Content-Length:[111] Content-Encoding:[deflate]] 0xc20803e340 111 [] true map[] 0xc208028820 &lt;nil&gt;}\n[120 156 77 203 65 14 130 48 16 70 225 171 152 127 93 76 59 51 162 244 50 13 96 99 154 216 98 232 192 134 112 119 81 55 110 95 190 183 65 83 142 85 251 252 130 223 160 107 168 113 132 119 66 55 145 182 117 108 62 109 249 70 98 234 108 183 27 84 157 83 121 132 191 19 100 221 165 177 210 216 235 137 200 11 123 230 243 207 195 32 79 37 233 52 135 3 235 82 15 29 75 63 60 227 29 251 27 195 90 38 189]\npanic: invalid character 'x' looking for beginning of value\n</code></pre>\n\n<p><strong>UPD:</strong> Thanks everyone. Now it's obvious that the reason of this issue was a <code>deflate</code> compression of HTTP response. However, it's still not clear how to perform a decompression in Golang (see <a href=\"https://stackoverflow.com/questions/29513472/golang-compress-flate-module-cant-decompress-valid-deflate-compressed-http-b\">here</a>).</p>\n"}, {"tags": ["http", "cookies", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1428435793, "post_id": 29499843, "comment_id": 47158363, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/27671061/how-to-delete-cookie\">How to delete cookie</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1327717"}, "edited": false, "score": 1, "creation_date": 1428439753, "post_id": 29499843, "comment_id": 47160512, "body": "I&#39;d eat a cookie rather than delete it. /omnomnom"}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 3896454, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa8a2a3498bf971dd352e14dfee74ce?s=128&d=identicon&r=PG", "display_name": "jjgames", "link": "https://stackoverflow.com/users/3896454/jjgames"}, "edited": false, "score": 0, "creation_date": 1428517439, "post_id": 29501701, "comment_id": 47199443, "body": "So best option is doing both MaxAge&lt;0 and Expires in the past in the same cookie?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 87, "user_id": 3896454, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa8a2a3498bf971dd352e14dfee74ce?s=128&d=identicon&r=PG", "display_name": "jjgames", "link": "https://stackoverflow.com/users/3896454/jjgames"}, "edited": false, "score": 1, "creation_date": 1428538135, "post_id": 29501701, "comment_id": 47209156, "body": "@jjgames Yeah, set the both."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1428509247, "last_edit_date": 1428509247, "creation_date": 1428442341, "answer_id": 29501701, "question_id": 29499843, "link": "https://stackoverflow.com/questions/29499843/how-do-you-delete-a-cookie-with-go-and-http-package/29501701#29501701", "title": "How do you delete a cookie with Go and http package?", "body": "<p>You delete a cookie the same way you set a cookie, but with at time in the past:</p>\n\n<pre><code>expire := time.Now().Add(-7 * 24 * time.Hour)\ncookie := http.Cookie{\n    Name:    \"name\",\n    Value:   \"value\",\n    Expires: expire,\n}\nhttp.SetCookie(w, &amp;cookie)\n</code></pre>\n\n<p>Note the <code>-7</code>.</p>\n\n<p>You can also set MaxAge to a negative value. Because older versions of IE do not support MaxAge, it's important to always set Expires to a time in the past.</p>\n"}, {"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1428509277, "post_id": 29509026, "comment_id": 47194583, "body": "Setting MaxAge works on the browsers that support the attribute. Setting Expires is better because all browsers support the attribute."}, {"owner": {"reputation": 1111, "user_id": 1131607, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/xLKUc.jpg?s=128&g=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/1131607/arun"}, "edited": false, "score": 0, "creation_date": 1597468925, "post_id": 29509026, "comment_id": 112148593, "body": "Any option to delete all cookies at once ?"}], "tags": [], "owner": {"reputation": 11, "user_id": 1203994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9c08c24315bdcb347412c5aeeafc86?s=128&d=identicon&r=PG", "display_name": "Juan", "link": "https://stackoverflow.com/users/1203994/juan"}, "is_accepted": false, "score": 1, "last_activity_date": 1428479845, "creation_date": 1428479845, "answer_id": 29509026, "question_id": 29499843, "link": "https://stackoverflow.com/questions/29499843/how-do-you-delete-a-cookie-with-go-and-http-package/29509026#29509026", "title": "How do you delete a cookie with Go and http package?", "body": "<p>According to <a href=\"https://golang.org/src/net/http/cookie.go\" rel=\"nofollow\">the doc of cookie.go</a>, MaxAge&lt;0 means delete cookie now. You can try following codes:</p>\n\n<pre><code>cookie := &amp;http.Cookie{\n    Name:   cookieName,\n    Value:  \"\",\n    Path:   \"/\",\n    MaxAge: -1,\n}\nhttp.SetCookie(w, cookie)\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 3896454, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa8a2a3498bf971dd352e14dfee74ce?s=128&d=identicon&r=PG", "display_name": "jjgames", "link": "https://stackoverflow.com/users/3896454/jjgames"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1576, "favorite_count": 0, "accepted_answer_id": 29501701, "answer_count": 2, "score": 4, "last_activity_date": 1428517372, "creation_date": 1428435412, "last_edit_date": 1428517372, "question_id": 29499843, "link": "https://stackoverflow.com/questions/29499843/how-do-you-delete-a-cookie-with-go-and-http-package", "title": "How do you delete a cookie with Go and http package?", "body": "<p>A user has a cookie set when they visit using http.SetCookie like so:</p>\n\n<pre><code>expire := time.Now().Add(7 * 24 * time.Hour)\ncookie := http.Cookie{\n    Name:    \"name\",\n    Value:   \"value\",\n    Expires: expire,\n}\nhttp.SetCookie(w, &amp;cookie)\n</code></pre>\n\n<p>If I want to remove this cookie at a later point, what is the correct way to do this?  </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1428432457, "last_edit_date": 1428432457, "creation_date": 1428431165, "answer_id": 29498566, "question_id": 29498374, "link": "https://stackoverflow.com/questions/29498374/memory-address-for-struct-not-visible/29498566#29498566", "title": "Memory address for struct not visible", "body": "<p>the <a href=\"http://golang.org/pkg/fmt/\" rel=\"noreferrer\"><code>fmt</code></a> package uses reflection to print out values, and there is a specific case to print a pointer to a struct as <code>&amp;{Field Value}</code>.</p>\n\n<p>If you want to see the memory address, use the pointer formatting verb <code>%p</code>.</p>\n\n<pre><code>fmt.Printf(\"&amp;stud is: %p\\n\", &amp;stud)\n</code></pre>\n"}], "owner": {"reputation": 343, "user_id": 1017818, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c78380a9664ac9a937aabe07ede850e8?s=128&d=identicon&r=PG", "display_name": "srock", "link": "https://stackoverflow.com/users/1017818/srock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 1, "accepted_answer_id": 29498566, "answer_count": 1, "score": 4, "last_activity_date": 1428432457, "creation_date": 1428430561, "question_id": 29498374, "link": "https://stackoverflow.com/questions/29498374/memory-address-for-struct-not-visible", "title": "Memory address for struct not visible", "body": "<p>In Go, I was confused about why the memory address for variables like int can be obtained but not for structs. As an example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\nstud1 := stud{\"name1\", \"school1\"}\na:=10\nfmt.Println(\"&amp;a is:\", &amp;a)\nfmt.Println(\"&amp;stud1 is:\",&amp;stud1)\n}\n</code></pre>\n\n<p>output is:</p>\n\n<pre><code>&amp;a is: 0x20818a220\n&amp;stud1 is: &amp;{name1 school1}\n</code></pre>\n\n<p>Why is &amp;a giving the memory address, however &amp;stud1 not giving the exact memory location. I don't have any intention of using the memory address but just was curious about the different behavior.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1428432014, "post_id": 29498353, "comment_id": 47156302, "body": "Consider pre-processing your XML files to correct them before passing them to your program.  If they are all malformed in a similar way then it should be pretty easy to correct them.  The general problem is that the XML parser cannot know exactly <i>how</i> an instance document is malformed so it can&#39;t really guess about how to interpret it loosely (the way you expect it to)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428432549, "post_id": 29498353, "comment_id": 47156626, "body": "See <a href=\"https://godoc.org/pkg/encoding/xml/#Decoder\" rel=\"nofollow noreferrer\"><code>Decoder.AutoClose</code></a>."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428433101, "post_id": 29498353, "comment_id": 47156920, "body": "Side note (although this may only be in your simplified example): don&#39;t get a reader from a <code>string</code> via <code>bytes.NewReader([]byte(stringVar))</code>; instead use <a href=\"https://golang.org/pkg/strings/#NewReader\" rel=\"nofollow noreferrer\"><code>strings.NewReader(stringVar)</code></a>."}], "answers": [{"comments": [{"owner": {"reputation": 1599, "user_id": 2623893, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/t40xu.png?s=128&g=1", "display_name": "kwolfe", "link": "https://stackoverflow.com/users/2623893/kwolfe"}, "edited": false, "score": 0, "creation_date": 1428432252, "post_id": 29498821, "comment_id": 47156451, "body": "I didn&#39;t mention that this example will not work for all examples. You&#39;ll need to tweak it if you have additional nested elements."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1428432700, "post_id": 29498821, "comment_id": 47156706, "body": "(a) You answer isn&#39;t entirely true (e.g. <code>AutoClose</code> if the set of such tags is known) but more importantly (b) link only answers are not recommend on SE, you should include at least the core of what you link to directly in the answer and (c) your comment probably should have been an edit to the answer."}], "tags": [], "owner": {"reputation": 1599, "user_id": 2623893, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/t40xu.png?s=128&g=1", "display_name": "kwolfe", "link": "https://stackoverflow.com/users/2623893/kwolfe"}, "is_accepted": false, "score": -1, "last_activity_date": 1428432051, "creation_date": 1428432051, "answer_id": 29498821, "question_id": 29498353, "link": "https://stackoverflow.com/questions/29498353/parsing-malformed-xml-file-in-go/29498821#29498821", "title": "Parsing malformed xml file in Go", "body": "<p>No ways around it. You need your own decoder: <a href=\"http://play.golang.org/p/Kr7nq64f-c\" rel=\"nofollow\">http://play.golang.org/p/Kr7nq64f-c</a></p>\n"}, {"tags": [], "owner": {"reputation": 18829, "user_id": 24998, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2c14a4f2931fa9336fdccdfe11318fef?s=128&d=identicon&r=PG", "display_name": "Jack", "link": "https://stackoverflow.com/users/24998/jack"}, "is_accepted": false, "score": 2, "last_activity_date": 1428432506, "creation_date": 1428432506, "answer_id": 29498958, "question_id": 29498353, "link": "https://stackoverflow.com/questions/29498353/parsing-malformed-xml-file-in-go/29498958#29498958", "title": "Parsing malformed xml file in Go", "body": "<p>Below worked for me, which is probably only ideal if you know the problematic tags. Although, strangely it doesn't work if I also add first-name.</p>\n\n<pre><code>dec.AutoClose = append(dec.AutoClose, \"last-name\")\ndec.AutoClose = append(dec.AutoClose, \"id\")\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 973859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vS6pl.jpg?s=128&g=1", "display_name": "Phea Duch", "link": "https://stackoverflow.com/users/973859/phea-duch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1428432506, "creation_date": 1428430485, "question_id": 29498353, "link": "https://stackoverflow.com/questions/29498353/parsing-malformed-xml-file-in-go", "title": "Parsing malformed xml file in Go", "body": "<p>I have a large number of xml files to parse that contain unclosed tags wrapped in closed tags. Something like below:</p>\n\n<pre><code>&lt;submission&gt;\n&lt;first-name&gt;Henry\n&lt;last-name&gt;Donald\n&lt;id&gt;4224\n&lt;/submission&gt;\n</code></pre>\n\n<p>I set decoder.Strict = false but it is still unable to parse the entire xml file properly.</p>\n\n<pre><code>type Submission struct {\n    FirstName string `xml:\"first-name\"`\n    LastName  string `xml:\"last-name\"`\n    ID        string `xml:\"id\"`\n}\n\nfunc main() {\n    dec := xml.NewDecoder(bytes.NewReader([]byte(sub)))\n    dec.Strict = false\n    dec.AutoClose = xml.HTMLAutoClose\n    dec.Entity = xml.HTMLEntity\n\n    var s Submission\n    err := dec.Decode(&amp;s)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/-_chEpDhzX\" rel=\"nofollow\">https://play.golang.org/p/-_chEpDhzX</a></p>\n\n<p>I know there is a html tokenizer that I may try using but I would prefer to use the XML package as the majority of the files are properly formatted.</p>\n"}, {"tags": ["go", "mutex", "sync"], "answers": [{"comments": [{"owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "edited": false, "score": 5, "creation_date": 1428428452, "post_id": 29497244, "comment_id": 47154179, "body": "Paragraphs 1 and 3 are great; paragraph 2 seems off-topic (because the concern is safety) and poor advice (because Go is such a high level language, you should write the most expressive code by default, and optimize where needed on a case-by-case basis--not by applying this rationale generally. There&#39;s no guarantee that these goroutines will even be executed by different CPUs!)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "edited": false, "score": 0, "creation_date": 1428428977, "post_id": 29497244, "comment_id": 47154486, "body": "Agree with @weberc2. While false sharing is a concern, the question is about modifying 2 variables with or without a mutex. The cache line problem with be present regardless of which answer is correct, and the solution would be the same regardless."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "reply_to_user": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "edited": false, "score": 0, "creation_date": 1428430001, "post_id": 29497244, "comment_id": 47155064, "body": "@weberc2: Funny, because one of the reasons I like Go is because it isn&#39;t such a high level language. It compiles much like C with garbage collection."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1428430907, "post_id": 29497244, "comment_id": 47155646, "body": "The second paragraph is helpful for those who are thinking of the larger question: what are the issues with concurrent access to struct fields? I have concerns with the last paragraph because it confuses the pointer with the struct itself. It is OK to modify a struct while some other goroutine happens to modify a pointer to that struct."}, {"owner": {"reputation": 3934, "user_id": 916440, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c3f3495133a7d9411b0b4c04189ecf91?s=128&d=identicon&r=PG", "display_name": "Kamil Dziedzic", "link": "https://stackoverflow.com/users/916440/kamil-dziedzic"}, "edited": false, "score": 0, "creation_date": 1428433920, "post_id": 29497244, "comment_id": 47157338, "body": "Zan, so struct members are different variables that share nothing with struct itself? Any docs as a reference?"}, {"owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "edited": false, "score": 0, "creation_date": 1428437656, "post_id": 29497244, "comment_id": 47159410, "body": "@ZanLynx *garbage collection and a goroutine scheduler, which is the key detail here--goroutines don&#39;t guarantee parallelism: <a href=\"http://blog.golang.org/concurrency-is-not-parallelism\" rel=\"nofollow noreferrer\">blog.golang.org/concurrency-is-not-parallelism</a>. It simply doesn&#39;t make sense to concern oneself with cache line sharing before one even knows if one&#39;s goroutines are executing in parallel; this is premature optimization."}, {"owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1428438268, "post_id": 29497244, "comment_id": 47159714, "body": "@ThunderCat I think this is a parallelism concern; not a concurrency concern. Usually by default, we write Go code with concurrency in mind, and we let the scheduler make parallel decisions for us. If you need to squeeze out extra performance, you can optimize for your use case, but your optimization will likely not be portable across compilers, operating systems, and architectures. Even then, you need to make sure you&#39;re actually executing in parallel. In summary, paragraph 2 seems like a footnote of a footnote at best. The word &#39;may&#39; in its first sentence can&#39;t be overemphasized."}, {"owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "reply_to_user": {"reputation": 3934, "user_id": 916440, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c3f3495133a7d9411b0b4c04189ecf91?s=128&d=identicon&r=PG", "display_name": "Kamil Dziedzic", "link": "https://stackoverflow.com/users/916440/kamil-dziedzic"}, "edited": false, "score": 1, "creation_date": 1428498393, "post_id": 29497244, "comment_id": 47186378, "body": "@KamilDziedzic Struct members occupy distinct segments of memory. If you change distinct memory segments from different threads, there is no conflict. I don&#39;t have any resources on hand, but you can Google &#39;C struct memory layout&#39; (or something like that) and get more information (Go&#39;s memory layout is very similar to C, as far as I know)."}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1540674518, "post_id": 29497244, "comment_id": 92954338, "body": "Are struct members really different objects tho? Seems like two different goroutines can modify struct fields at the same time"}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": true, "score": 28, "last_activity_date": 1428426733, "creation_date": 1428426733, "answer_id": 29497244, "question_id": 29496605, "link": "https://stackoverflow.com/questions/29496605/is-it-thread-safe-to-access-different-members-of-struct-in-go/29497244#29497244", "title": "Is it thread safe to access different members of struct in go?", "body": "<p>It should be safe to access different variables from different threads, and struct members are different variables. So yes it should be safe.</p>\n\n<p>However, it may not be fast. Variables that are close together in memory like struct members are will share a CPU cache line. A cache line is the smallest piece of memory that a CPU (well, most current models) can lock. That means that CPU-2 has to wait to write until CPU-1 has finished with that cache line even if they are writing to different variables.</p>\n\n<p>It is NOT safe to change the pointer to the struct while writing to the struct from different threads. In your example if you had a third goroutine that did <code>apple = &amp;Apple{}</code> some of the other goroutines in other threads might write to the old Apple or the new Apple and you wouldn't know.</p>\n"}], "owner": {"reputation": 3934, "user_id": 916440, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c3f3495133a7d9411b0b4c04189ecf91?s=128&d=identicon&r=PG", "display_name": "Kamil Dziedzic", "link": "https://stackoverflow.com/users/916440/kamil-dziedzic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5027, "favorite_count": 3, "accepted_answer_id": 29497244, "answer_count": 1, "score": 21, "last_activity_date": 1428430066, "creation_date": 1428424556, "question_id": 29496605, "link": "https://stackoverflow.com/questions/29496605/is-it-thread-safe-to-access-different-members-of-struct-in-go", "title": "Is it thread safe to access different members of struct in go?", "body": "<p>Is it safe to access different struct members from different goroutines?</p>\n\n<p>I understand that writing to the same variable without sync is dangareous:</p>\n\n<pre><code>package main\n\ntype Apple struct {\n    color string\n    size  uint\n}\n\nfunc main() {\n    apple := &amp;Apple{}\n    go func() {\n        apple.color = \"red\"\n    }()\n    go func() {\n        apple.color = \"green\"\n    }()\n}\n</code></pre>\n\n<p>But can you write to different struct members without any kind of synchronization? </p>\n\n<pre><code>package main\n\ntype Apple struct {\n    color string\n    size  uint\n}\n\nfunc main() {\n    apple := &amp;Apple{}\n    go func() {\n        apple.color = \"red\"\n    }()\n    go func() {\n        apple.size = 42\n    }()\n}\n</code></pre>\n\n<p>Or should I use <code>chan</code> or <code>sync.Mutex</code> for that?</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 592, "user_id": 2700499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/799381f3a3284fa92b6d6bc060047ecf?s=128&d=identicon&r=PG&f=1", "display_name": "Dylan MacKenzie", "link": "https://stackoverflow.com/users/2700499/dylan-mackenzie"}, "edited": false, "score": 0, "creation_date": 1428439684, "post_id": 29492505, "comment_id": 47160475, "body": "In your edit, you should change the 2 in the if condition to be x. That form is the simplest and probably most <a href=\"http://golang.org/doc/faq#Does_Go_have_a_ternary_form\" rel=\"nofollow noreferrer\">idiomatic</a>."}], "answers": [{"comments": [{"owner": {"reputation": 4236, "user_id": 2231905, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/0d4a1b6ef81bd93c9dd8896880995b77?s=128&d=identicon&r=PG", "display_name": "Fallen", "link": "https://stackoverflow.com/users/2231905/fallen"}, "edited": false, "score": 0, "creation_date": 1428412686, "post_id": 29492553, "comment_id": 47144262, "body": "I&#39;ve thought about this too but this one is not very general. As instead of 2 if the upper bound was <code>X</code> then we would have to run a for loop to do so."}, {"owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "edited": false, "score": 0, "creation_date": 1428412696, "post_id": 29492553, "comment_id": 47144268, "body": "Maybe a switch base on <code>len(bar)</code> is better. if <code>bar</code> is empty its will a out of range panic."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 4236, "user_id": 2231905, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/0d4a1b6ef81bd93c9dd8896880995b77?s=128&d=identicon&r=PG", "display_name": "Fallen", "link": "https://stackoverflow.com/users/2231905/fallen"}, "edited": false, "score": 1, "creation_date": 1428413078, "post_id": 29492553, "comment_id": 47144512, "body": "@Fallen, @ANIsus see edit. I&#39;ve used <code>len</code> in the <code>else</code> clause."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 3, "last_activity_date": 1428413040, "last_edit_date": 1428413040, "creation_date": 1428412499, "answer_id": 29492553, "question_id": 29492505, "link": "https://stackoverflow.com/questions/29492505/slicing-golang-slice/29492553#29492553", "title": "Slicing golang slice", "body": "<p>Just use an <code>if</code>. It's much more readable and performant, since there is no conversion between <code>int</code> and <code>float64</code>.</p>\n\n<pre><code>var foo []int\nif len(bar) &gt; 1 {\n    foo = bar[:2]\n} else {\n    foo = bar[:len(bar)]\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": false, "score": 1, "last_activity_date": 1428412984, "creation_date": 1428412984, "answer_id": 29492716, "question_id": 29492505, "link": "https://stackoverflow.com/questions/29492505/slicing-golang-slice/29492716#29492716", "title": "Slicing golang slice", "body": "<p>Go does not have a <code>math.MinInt</code>. But implementing one is as simple as:</p>\n\n<pre><code>func Min(x, y int) int {\n    if x &lt; y {\n        return x\n    }\n    return y\n}\n\n...\n\nfoo := bar[:Min(len(bar), 2)]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 0, "last_activity_date": 1428413050, "creation_date": 1428413050, "answer_id": 29492744, "question_id": 29492505, "link": "https://stackoverflow.com/questions/29492505/slicing-golang-slice/29492744#29492744", "title": "Slicing golang slice", "body": "<pre><code>bar := []int{}\nn := len(bar)\nif n &gt; 2 {\n    n = 2\n}\nfoo := bar[:n]\nfmt.Printf(\"%v\", foo)\n</code></pre>\n\n<p>Works with len(bar) = 0, 1, 2, n.. <a href=\"https://play.golang.org/p/n_FsaIOblc\" rel=\"nofollow\">Playground sample</a></p>\n"}, {"tags": [], "owner": {"reputation": 6524, "user_id": 436435, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pGWrc.jpg?s=128&g=1", "display_name": "Vadim Shender", "link": "https://stackoverflow.com/users/436435/vadim-shender"}, "is_accepted": false, "score": 0, "last_activity_date": 1428414116, "last_edit_date": 1428414116, "creation_date": 1428413594, "answer_id": 29492926, "question_id": 29492505, "link": "https://stackoverflow.com/questions/29492505/slicing-golang-slice/29492926#29492926", "title": "Slicing golang slice", "body": "<p>General (as you ask in a comment) function for arbitrary number of elements:</p>\n\n<pre><code>func strip(s []int, n int) []int {\n    if len(s) &lt; n {\n        n = len(s)\n    }\n    return s[:n]\n}\n\n...\nfoo := strip(bar, 2)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6vqkgrmcc_\" rel=\"nofollow\">Go Playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1471954904, "last_edit_date": 1471954904, "creation_date": 1428474169, "answer_id": 29507366, "question_id": 29492505, "link": "https://stackoverflow.com/questions/29492505/slicing-golang-slice/29507366#29507366", "title": "Slicing golang slice", "body": "<p>If the length of your slice is <strong>greater than 2</strong>, you can reslice it. If not, <strong>no need to reslice just use the slice itself</strong> in assignment which will automatically satisfy your needs: result will have up to a maximum of 2 elements.</p>\n\n<p>You can even \"spare\" the <code>else</code> branch of the <code>if</code>:</p>\n\n<pre><code>foo := bar\nif len(foo) &gt; 2 {\n    foo = foo[:2]\n}\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p>Slices are reference types. So even though you used <code>bar</code> to initialize <code>foo</code>, if you modify the <code>foo</code> <em>variable</em> afterwards (not the elements of the slice), that does not affect <code>bar</code> (the reference value is copied when assigned):</p>\n\n<pre><code>bar := []int{0, 1, 2, 3}\nfoo := bar\nif len(foo) &gt; 2 {\n    foo = foo[:2]\n}\nfmt.Println(foo) // Here foo is [0, 1] as expected\n\nfoo = foo[:1]    // Reslicing foo\nfmt.Println(bar) // Bar is unaffected, bar = [0 1 2 3]\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/ghVqsqPAYm\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>[0 1]\n[0 1 2 3]\n</code></pre>\n"}], "owner": {"reputation": 4236, "user_id": 2231905, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/0d4a1b6ef81bd93c9dd8896880995b77?s=128&d=identicon&r=PG", "display_name": "Fallen", "link": "https://stackoverflow.com/users/2231905/fallen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3675, "favorite_count": 0, "accepted_answer_id": 29507366, "answer_count": 5, "score": 3, "last_activity_date": 1471954904, "creation_date": 1428412333, "last_edit_date": 1428413058, "question_id": 29492505, "link": "https://stackoverflow.com/questions/29492505/slicing-golang-slice", "title": "Slicing golang slice", "body": "<p>The problem is I've a slice <code>bar</code>. I want to create another slice foo with the first two elements of bar; if there're at least 2 elements in bar or with the first element of bar if bar has at least one element.</p>\n\n<p>The idea I had:</p>\n\n<pre><code>// bar := []int{1, 2, 3...\nfoo := bar[:(int)(math.Min(float64(len(bar)), 2))]\n</code></pre>\n\n<p><strong>EDIT:</strong>\nHere's another way I tried,</p>\n\n<pre><code>x := 2\nif len(bar) &lt; 2 {\n    x = len(bar)\n}\nfoo := bar[:x]\n</code></pre>\n\n<p>Is it possible to improve the code? At least, casting twice to achieve something so simple doesn't look good to me.</p>\n"}, {"tags": ["go", "web-crawler"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428431269, "post_id": 29491795, "comment_id": 47155863, "body": "Related: <a href=\"http://stackoverflow.com/questions/12224962/exercise-web-crawler-concurrency-not-working\" title=\"exercise web crawler concurrency not working\">stackoverflow.com/questions/12224962/&hellip;</a> and <a href=\"http://stackoverflow.com/questions/13217547/trouble-with-go-tour-crawler-exercise\" title=\"trouble with go tour crawler exercise\">stackoverflow.com/questions/13217547/&hellip;</a> and <a href=\"http://stackoverflow.com/questions/27841092/when-and-where-to-check-if-channel-wont-get-any-more-data\" title=\"when and where to check if channel wont get any more data\">stackoverflow.com/questions/27841092/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2449, "user_id": 2397318, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e98da1c8bd5fc26c80a02d99a8fe35f7?s=128&d=identicon&r=PG", "display_name": "meto", "link": "https://stackoverflow.com/users/2397318/meto"}, "edited": false, "score": 0, "creation_date": 1428448451, "post_id": 29498219, "comment_id": 47163961, "body": "Thanks, this answer was really helpful! I have read multiple things about crawlers but I have to admit that concurrency is still hard for me. Also when reading others people code everything seems easier. This is why I decided to ask anyway with my own code"}, {"owner": {"reputation": 2449, "user_id": 2397318, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e98da1c8bd5fc26c80a02d99a8fe35f7?s=128&d=identicon&r=PG", "display_name": "meto", "link": "https://stackoverflow.com/users/2397318/meto"}, "edited": false, "score": 0, "creation_date": 1428456219, "post_id": 29498219, "comment_id": 47166049, "body": "Can I ask you to elaborate a little more on the garbage collection part? I don&#39;t get why <code>list[0] = nil</code> should help."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 2449, "user_id": 2397318, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e98da1c8bd5fc26c80a02d99a8fe35f7?s=128&d=identicon&r=PG", "display_name": "meto", "link": "https://stackoverflow.com/users/2397318/meto"}, "edited": false, "score": 0, "creation_date": 1428461101, "post_id": 29498219, "comment_id": 47167215, "body": "@meto it&#39;s only be needed if <code>list</code> was <code>[]*Job</code>. <code>list = list[1:]</code> re-slices to &quot;remove&quot; the entry, but the underlying array the slice points to doesn&#39;t change. It&#39;s not until <code>append</code> <i>eventually</i> hits <code>len(list) == cap(list)</code> and allocates a new underlying array (copying over only the items remaining in the old slice) that the old array becomes unreferenced and in turn any pointers it had become unreferenced. <code>list[0] = nil</code> immediately removes that reference and, as soon as the worker it&#39;s sent to also stops referencing it, the garbage collector can collect it without waiting for append."}, {"owner": {"reputation": 2449, "user_id": 2397318, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e98da1c8bd5fc26c80a02d99a8fe35f7?s=128&d=identicon&r=PG", "display_name": "meto", "link": "https://stackoverflow.com/users/2397318/meto"}, "edited": false, "score": 0, "creation_date": 1428462996, "post_id": 29498219, "comment_id": 47167700, "body": "Ok, one last question if I may (but I can open another answer if you prefer). Deciding when to stop is not trivial. Just checking if the channel is empty might not be enough (one of the workers could be busy parsing HTML). Is there a way to check if all the workers are waiting? IN that case signal over a <code>bool</code> channel could be sent."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 5, "last_activity_date": 1570723615, "last_edit_date": 1570723615, "creation_date": 1428430039, "answer_id": 29498219, "question_id": 29491795, "link": "https://stackoverflow.com/questions/29491795/webcrawler-in-go/29498219#29498219", "title": "Webcrawler in Go", "body": "<p>If you use your favourite web search for \"Go web crawler\" (or \"golang web crawler\")\nyou'll find many examples including:\n<a href=\"https://tour.golang.org/concurrency/10\" rel=\"nofollow noreferrer\">Go Tour Exercise: Web Crawler</a>.\nThere are also some talks on concurrency in Go that cover this kind of thing.</p>\n\n<p>The \"standard\" way to do this in Go does not need to involve wait groups at all.\nTo answer one of your questions, things queued with <code>defer</code> only get run when the function returns. You have a long running function so do not use <code>defer</code> in such a loop.</p>\n\n<p>The \"standard\" way is to start up however many workers you want in their own goroutines.\nThey all read \"jobs\" from the same channel, blocking if/when there is nothing to do.\nWhen fully done that channel is closed and they all exit.</p>\n\n<p>In the case of something like a crawler the workers will discover more \"jobs\" to do and want to enqueue them.\nYou don't want them writing back to the same channel since it will have some limited amount of buffering (or none!) and you'll eventually block all the workers trying to enqueue more jobs!</p>\n\n<p>A simple solution to this is to use a separate channel\n(e.g.\u00a0each worker has <code>in &lt;-chan Job, out chan&lt;- Job</code>)\nand a single queue/filter goroutine that reads these requests,\nappends them onto a slice that it either lets grow arbitrarily large or does some global limiting on,\nand also feeds the other channel from the head of the slice\n(i.e.\u00a0a simple for-select loop reading from one channel and writing to the other).\nThis code is also usually responsible for keeping track of what has been already done\n(e.g.\u00a0a map of URLs visited) and drops incoming requests for duplicates.</p>\n\n<p>The queue goroutine might look something like this (argument names excessively verbose here):</p>\n\n<pre><code>type Job string\n\nfunc queue(toWorkers chan&lt;- Job, fromWorkers &lt;-chan Job) {\n    var list []Job\n    done := make(map[Job]bool)\n    for {\n        var send chan&lt;- Job\n        var item Job\n        if len(list) &gt; 0 {\n            send = toWorkers\n            item = list[0]\n        }\n        select {\n        case send &lt;- item:\n            // We sent an item, remove it\n            list = list[1:]\n        case thing := &lt;-fromWorkers:\n            // Got a new thing\n            if !done[thing] {\n                list = append(list, thing)\n                done[thing] = true\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>A few things are glossed over in this simple example.\nSuch as termination. And if \"Jobs\" is some larger structure where you'd want to use <code>chan *Job</code> and <code>[]*Job</code> instead.\nIn that case you'd also need to change the map type to some some key you extract from the job\n(e.g.\u00a0<code>Job.URL</code> perhaps)\nand you'd want to do <code>list[0] = nil</code> before <code>list = list[1:]</code> to get rid of the reference to <code>*Job</code> pointer and let the garbage collector at it earlier.</p>\n\n<p>Edit: Some notes on terminating cleanly.</p>\n\n<p>There are several ways to terminate code like the above cleanly. A wait group could be used, but the placement of the Add/Done calls needs to be done carefully and you'd probably need another goroutine to do the Wait (and then close one of the channels to start the shutdown). The workers shouldn't close their output channel since there are multiple workers and you can't close a channel more than once; the queue goroutine can't tell when to close it's channel to the workers without knowing when the workers are done.</p>\n\n<p>In the past when I've used code very similar to the above I used a local \"outstanding\" counter within the \"queue\" goroutine (which avoids any need for a mutex or any synchronization overhead that a wait group has). The count of outstanding jobs is increased when a job is sent to a worker. It's decreased again when the worker says it's finished with it. My code happened to have another channel for this (my \"queue\" was also collecting results in addition to further nodes to enqueue). It's probably cleaner on it's own channel, but instead a special value on the existing channel (e.g.\u00a0a nil Job pointer) could be used. At any rate, with such a counter, the existing length check on the local list just needs to see there is nothing outstanding when the list is empty and it's time to terminate; just shutdown the channel to the workers and return.</p>\n\n<p>E.g.:</p>\n\n<pre><code>    if len(list) &gt; 0 {\n        send = toWorkers\n        item = list[0]\n    } else if outstandingJobs == 0 {\n        close(toWorkers)\n        return\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 89, "user_id": 7422942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f8b07bc8ee87738dd401d6501871196?s=128&d=identicon&r=PG&f=1", "display_name": "CEKim", "link": "https://stackoverflow.com/users/7422942/cekim"}, "is_accepted": false, "score": 1, "last_activity_date": 1596493680, "creation_date": 1596493680, "answer_id": 63237754, "question_id": 29491795, "link": "https://stackoverflow.com/questions/29491795/webcrawler-in-go/63237754#63237754", "title": "Webcrawler in Go", "body": "<p>I wrote a solution utilizing the mutual exclusion (Mutex) function of Go.</p>\n<p>When it runs on the concurrency, it may be important to restrict only one instance access the url map at a time. I believe I implemented it as written below. Please feel free to try this out. I would appreciate your feedback as I will be learn from your comments as well.</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;sync&quot;\n)\n\ntype Fetcher interface {\n    // Fetch returns the body of URL and\n    // a slice of URLs found on that page.\n    Fetch(url string) (body string, urls []string, err error)\n}\n\n\n\n\n// ! SafeUrlBook helps restrict only one instance access the central url map at a time. So that no redundant crawling should occur.\ntype SafeUrlBook struct {\n    book map[string]bool\n    mux  sync.Mutex\n    }\n\nfunc (sub *SafeUrlBook) doesThisExist(url string) bool {\n    sub.mux.Lock()\n    _ , key_exists := sub.book[url]\n    defer sub.mux.Unlock()\n    \n    if key_exists {\n    return true\n    }  else { \n    sub.book[url] = true\n    return false \n    }  \n}\n// End SafeUrlBook\n\n\n// Crawl uses fetcher to recursively crawl\n// pages starting with url, to a maximum of depth.\n// Note that now I use safeBook (SafeUrlBook) to keep track of which url has been visited by a crawler.\nfunc Crawl(url string, depth int, fetcher Fetcher, safeBook SafeUrlBook) {\n    if depth &lt;= 0 {\n        return\n    }\n    \n    \n    exist := safeBook.doesThisExist(url)\n    if exist { fmt.Println(&quot;Skip&quot;, url) ; return }\n    \n    \n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(&quot;found: %s %q\\n&quot;, url, body)\n    for _, u := range urls {\n        Crawl(u, depth-1, fetcher, safeBook)\n    }\n    return\n}\n\nfunc main() {\n    safeBook := SafeUrlBook{book: make(map[string]bool)}\n    Crawl(&quot;https://golang.org/&quot;, 4, fetcher, safeBook)\n}\n\n// fakeFetcher is Fetcher that returns canned results.\ntype fakeFetcher map[string]*fakeResult\n\ntype fakeResult struct {\n    body string\n    urls []string\n}\n\nfunc (f fakeFetcher) Fetch(url string) (string, []string, error) {\n    if res, ok := f[url]; ok {\n        return res.body, res.urls, nil\n    }\n    return &quot;&quot;, nil, fmt.Errorf(&quot;not found: %s&quot;, url)\n}\n\n// fetcher is a populated fakeFetcher.\nvar fetcher = fakeFetcher{\n    &quot;https://golang.org/&quot;: &amp;fakeResult{\n        &quot;The Go Programming Language&quot;,\n        []string{\n            &quot;https://golang.org/pkg/&quot;,\n            &quot;https://golang.org/cmd/&quot;,\n        },\n    },\n    &quot;https://golang.org/pkg/&quot;: &amp;fakeResult{\n        &quot;Packages&quot;,\n        []string{\n            &quot;https://golang.org/&quot;,\n            &quot;https://golang.org/cmd/&quot;,\n            &quot;https://golang.org/pkg/fmt/&quot;,\n            &quot;https://golang.org/pkg/os/&quot;,\n        },\n    },\n    &quot;https://golang.org/pkg/fmt/&quot;: &amp;fakeResult{\n        &quot;Package fmt&quot;,\n        []string{\n            &quot;https://golang.org/&quot;,\n            &quot;https://golang.org/pkg/&quot;,\n        },\n    },\n    &quot;https://golang.org/pkg/os/&quot;: &amp;fakeResult{\n        &quot;Package os&quot;,\n        []string{\n            &quot;https://golang.org/&quot;,\n            &quot;https://golang.org/pkg/&quot;,\n        },\n    },\n}\n</code></pre>\n"}], "owner": {"reputation": 2449, "user_id": 2397318, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e98da1c8bd5fc26c80a02d99a8fe35f7?s=128&d=identicon&r=PG", "display_name": "meto", "link": "https://stackoverflow.com/users/2397318/meto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2663, "favorite_count": 2, "accepted_answer_id": 29498219, "answer_count": 2, "score": 3, "last_activity_date": 1596493680, "creation_date": 1428410267, "last_edit_date": 1470222359, "question_id": 29491795, "link": "https://stackoverflow.com/questions/29491795/webcrawler-in-go", "title": "Webcrawler in Go", "body": "<p>I'm trying to build a web crawler in Go where I would like to specify the max number of concurrent workers. They will all be working as long as there are link to explore in the queue. When the queue has less elements than workers, workers should shout down, but resume in case more links are found.</p>\n\n<p>The code I have tried is</p>\n\n<pre><code>const max_workers = 6\n// simulating links with int\nfunc crawl(wg *sync.WaitGroup, queue chan int) {\n    for element := range queue {   \n        wg.Done() // why is defer here causing a deadlock?\n        fmt.Println(\"adding 2 new elements \")\n        if element%2 == 0 {\n            wg.Add(2)\n            queue &lt;- (element*100 + 11)\n            queue &lt;- (element*100 + 33)\n        }\n\n    }\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    queue := make(chan int, 10)\n    queue &lt;- 0\n    queue &lt;- 1\n    queue &lt;- 2\n    queue &lt;- 3\n    var min int\n    if (len(queue) &lt; max_workers) {\n        min = len(queue)\n    } else {\n        min = max_workers\n    }\n    for i := 0; i &lt; min; i++ {\n        wg.Add(1)\n        go crawl(&amp;wg, queue)\n    }\n    wg.Wait()\n    close(queue)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/9FYAOhTD-w\" rel=\"nofollow\">Link to playground</a></p>\n\n<p>This seems to work, but there is a catch: I have to fill the queue with more than one element when I start. I would like it to start from a (single) seed page (in my example <code>queue &lt;- 0</code>) and then grow / shrink the working pool dynamically. </p>\n\n<p>My questions are:</p>\n\n<ul>\n<li><p>how can I obtain behavior?</p></li>\n<li><p>why is defer <code>wg.Done()</code> causing deadlock? It's normal to <code>wg.Done()</code> the function when it is actually completed? I think that without the <code>defer</code> the goroutine is not waiting for the other part to finish (which could take longer in the real work example of parsing HTML).</p></li>\n</ul>\n"}, {"tags": ["printing", "go"], "comments": [{"owner": {"reputation": 1967, "user_id": 1390507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53335e2b507fd457757eee3a39323159?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1390507/alex"}, "edited": false, "score": 2, "creation_date": 1428414192, "post_id": 29491148, "comment_id": 100567949, "body": "If you don&#39;t need any formatting, you can use <a href=\"https://github.com/alexbrainman/printer\" rel=\"nofollow noreferrer\">github.com/alexbrainman/printer</a> package. Alex"}, {"owner": {"reputation": 1151, "user_id": 2241348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb155ddab6564900c4c5f35923723ff4?s=128&d=identicon&r=PG", "display_name": "abalos", "link": "https://stackoverflow.com/users/2241348/abalos"}, "edited": false, "score": 0, "creation_date": 1428498610, "post_id": 29491148, "comment_id": 100567950, "body": "Nice work. Didn&#39;t know this existed!"}, {"owner": {"reputation": 1381, "user_id": 127018, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2da6530f56d992f09eefd3a3662d7906?s=128&d=identicon&r=PG", "display_name": "tommed", "link": "https://stackoverflow.com/users/127018/tommed"}, "edited": false, "score": 0, "creation_date": 1541410771, "post_id": 29491148, "comment_id": 100567951, "body": "Caveat about this library, it&#39;ll only print plain text files - not DOCX or PDF. You could instead use something like <a href=\"https://www.compuphase.com/software_spool.htm\" rel=\"nofollow noreferrer\">compuphase.com/software_spool.htm</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1151, "user_id": 2241348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb155ddab6564900c4c5f35923723ff4?s=128&d=identicon&r=PG", "display_name": "abalos", "link": "https://stackoverflow.com/users/2241348/abalos"}, "is_accepted": false, "score": 4, "last_activity_date": 1428409730, "creation_date": 1428409730, "answer_id": 29491607, "question_id": 29491148, "link": "https://stackoverflow.com/questions/29491148/how-can-i-print-to-an-actual-printer/29491607#29491607", "title": "How can I print to an actual printer?", "body": "<p>It's possible to use Go to call the correct command line arguments to print whatever files are needed. You'd just need to print this information to a file first.</p>\n\n<p>Please see the information on <a href=\"https://technet.microsoft.com/en-us/library/cc775908%28v=ws.10%29.aspx\" rel=\"nofollow\">Microsoft TechNet</a> for this method.</p>\n\n<p>Another method I am less familiar with is to use the DLL's present in Windows through Go to invoke printing. I wasn't able to find as much information on this, but this <a href=\"https://code.google.com/p/go-wiki/wiki/WindowsDLLs\" rel=\"nofollow\">Go documentation has some pretty good examples.</a></p>\n\n<p>There are a couple directions you can look in! :)</p>\n"}, {"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 5, "last_activity_date": 1428490349, "creation_date": 1428490349, "answer_id": 29512645, "question_id": 29491148, "link": "https://stackoverflow.com/questions/29491148/how-can-i-print-to-an-actual-printer/29512645#29512645", "title": "How can I print to an actual printer?", "body": "<p>Using the answers from @abalos and @alex I was able to get this to work the way I need it to. Answering this to supply a sample of how to use it - it's pretty straightforward using alex's library:</p>\n\n<pre><code>import prt \"github.com/alexbrainman/printer\"\n\n...\n\nname, err := prt.Default() // returns name of Default Printer as string\nif err != nil {\n    log.fatal(err)\n}\np, err := prt.Open(name) // Opens the named printer and returns a *Printer\nif err != nil {\n    log.fatal(err)\n}\nerr = p.StartDocument(\"test\", \"text\") // test: doc name, text: doc type\nif err != nil {\n    log.fatal(err)\n}\nerr = p.StartPage() // begin a new page\nif err != nil {\n    log.fatal(err)\n}\nn, err := p.Write([]byte(\"Hello, Printer!\")) // Send some text to the printer\nif err != nil {\n    log.fatal(err)\n}\nfmt.Println(\"Num of bytes written to printer:\", n)\nerr = p.PageEnd() // end of page\nif err != nil {\n    log.fatal(err)\n}\nerr = p.DocumentEnd() // end of document\nif err != nil {\n    log.fatal(err)\n}\nerr = p.Close() // close the resource\nif err != nil {\n    log.fatal(err)\n}\n</code></pre>\n\n<p>More details on the Windows API can be found <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd162863(v=vs.85).aspx\" rel=\"noreferrer\">here</a></p>\n"}], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5434, "favorite_count": 6, "accepted_answer_id": 29512645, "answer_count": 2, "score": 8, "last_activity_date": 1563015978, "creation_date": 1428408295, "last_edit_date": 1563015978, "question_id": 29491148, "link": "https://stackoverflow.com/questions/29491148/how-can-i-print-to-an-actual-printer", "title": "How can I print to an actual printer?", "body": "<p>I have a messaging server written in Go. Now I have a requirement that some messages need to be printed out on paper by the server.</p>\n\n<p>How can I implement this in Go? I'm having a real hard time finding anything on the subject.</p>\n\n<p>The app will be running on Windows machines and needs to be able to print UTF8 encoded text in a fixed width font. So no fancy formatting (bold text, color etc) is needed.</p>\n\n<p>I'm rather completely in the dark on how to go about this... Can someone shed some light on this for me and point me in the right direction?</p>\n"}, {"tags": ["interface", "go", "abstraction"], "comments": [{"owner": {"reputation": 3201, "user_id": 2616179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb90669caa64288bdb5767f736152bbe?s=128&d=identicon&r=PG", "display_name": "Makpoc", "link": "https://stackoverflow.com/users/2616179/makpoc"}, "edited": false, "score": 0, "creation_date": 1428401449, "post_id": 29488764, "comment_id": 47137102, "body": "Why define a method when you can create func LoadConfig(path string) (Config, error){}?"}], "answers": [{"comments": [{"owner": {"reputation": 651, "user_id": 216695, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/79d7ee2589743eef43349a74a58bd291?s=128&d=identicon&r=PG", "display_name": "shearn89", "link": "https://stackoverflow.com/users/216695/shearn89"}, "edited": false, "score": 0, "creation_date": 1428406498, "post_id": 29489096, "comment_id": 47140155, "body": "Ahh, that makes sense! I was missing the idea of the <code>config.Path()</code> method to ensure that the config object had a path string. Nice one!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1428401581, "creation_date": 1428401581, "answer_id": 29489096, "question_id": 29488764, "link": "https://stackoverflow.com/questions/29488764/golang-interfaces-and-receivers-advice-needed/29489096#29489096", "title": "Golang interfaces and receivers - advice needed", "body": "<p>Even if you'd use <em>embedding</em> both the interfaces and the implementations, the implementation of <code>Config.LoadConfig()</code> cannot know about the type that embeds it (e.g. <code>WatcherConfig</code>).</p>\n\n<p>Best would be not to implement this as <em>methods</em> but as simple <em>helper</em> or <em>factory</em> functions.</p>\n\n<p>You could do it like this:</p>\n\n<pre><code>func LoadConfig(path string, config interface{}) error {\n    // Load implementation\n    // For example you can unmarshal file content into the config variable (if pointer)\n}\n\nfunc ReloadConfig(config Config) error {\n    // Reload implementation\n    path := config.Path() // Config interface may have a Path() method\n    // for example you can unmarshal file content into the config variable (if pointer)\n}\n</code></pre>\n"}], "owner": {"reputation": 651, "user_id": 216695, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/79d7ee2589743eef43349a74a58bd291?s=128&d=identicon&r=PG", "display_name": "shearn89", "link": "https://stackoverflow.com/users/216695/shearn89"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 29489096, "answer_count": 1, "score": 2, "last_activity_date": 1428401581, "creation_date": 1428400576, "question_id": 29488764, "link": "https://stackoverflow.com/questions/29488764/golang-interfaces-and-receivers-advice-needed", "title": "Golang interfaces and receivers - advice needed", "body": "<p>I'm trying to convert my config loader class in Golang from a specific config file structure to a more general one. Originally, I defined a struct with a set of program-specific variables, for example:</p>\n\n<pre><code>type WatcherConfig struct {\n    FileType   string\n    Flag       bool\n    OtherType  string\n    ConfigPath string\n}\n</code></pre>\n\n<p>I then defined two methods with pointer receivers:</p>\n\n<pre><code>func (config *WatcherConfig) LoadConfig(path string) error {}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>func (config *WatcherConfig) Reload() error {}\n</code></pre>\n\n<p>I'm now attempting to make this more general, and the plan was to define an interface <code>Config</code> and define the <code>LoadConfig</code> and <code>Reload</code> methods on this. I could then create a <code>struct</code> with the config layout for each module that needed it, and save myself repeating a method that basically opens a file, reads JSON, and dumps it into a struct.</p>\n\n<p>I've tried creating an interface and defining a method like this:</p>\n\n<pre><code>type Config interface {\n    LoadConfig(string) error\n}\nfunc (config *Config) LoadConfig(path string) error {}\n</code></pre>\n\n<p>But that is obviously throwing errors as <code>Config</code> is not a type, it's an interface. Do I need to add a more abstract <code>struct</code> to my class? <strong>It may be useful to know</strong> that all configuration structs will have the <code>ConfigPath</code> field, as I use this to <code>Reload()</code> the config.</p>\n\n<p>I'm fairly sure I'm going about this the wrong way, or what I'm trying to do isn't a pattern that works nicely in Go. I'd really appreciate some advice! </p>\n\n<ul>\n<li>Is what I'm trying to do possible in Go?</li>\n<li>Is it a good idea in Go?</li>\n<li>What would be the alternative Go-ism?</li>\n</ul>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 2495746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c07aca966689ef0d92d7309716c4469d?s=128&d=identicon&r=PG", "display_name": "pjoe", "link": "https://stackoverflow.com/users/2495746/pjoe"}, "edited": false, "score": 0, "creation_date": 1428409717, "post_id": 29489471, "comment_id": 47142235, "body": "Thanks, was thinking along those lines, but wondering if there was some standard or idiomatic way to do this. FWIW I played around some more and made an encapsulating PropertyInt type and added a method to also remove listeners, though I suspect adding/removing listeners would need locking to be fully threadsafe: <a href=\"http://play.golang.org/p/41ygGZ-QaB\" rel=\"nofollow noreferrer\">play.golang.org/p/41ygGZ-QaB</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 103, "user_id": 2495746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c07aca966689ef0d92d7309716c4469d?s=128&d=identicon&r=PG", "display_name": "pjoe", "link": "https://stackoverflow.com/users/2495746/pjoe"}, "edited": false, "score": 0, "creation_date": 1428409916, "post_id": 29489471, "comment_id": 47142375, "body": "@pjoe Yes, the next step would be to do just that: create a <code>PropInt</code> type with methods just as you did. I excluded it to show only the principle. Locking would also be neccessary as you mentioned, that&#39;s why in my example I &quot;pre-created&quot; the listeners before started to modify the property."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1428428026, "post_id": 29489471, "comment_id": 47153950, "body": "One issue glossed over here is blocking channels. The above makes the channels with a length of five but if a receiver goes away it will fill up and block <code>Set</code>. One strategy to avoid this is have the client provide the channel (with whatever buffering is appropriate to them, probably 0 or 1) and have the service do non-blocking sends skipping any full/un-ready channels (dropping the event)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1558608922, "last_edit_date": 1558608922, "creation_date": 1428402806, "answer_id": 29489471, "question_id": 29488010, "link": "https://stackoverflow.com/questions/29488010/property-change-notification-in-go/29489471#29489471", "title": "Property change notification in go", "body": "<p>One way could to be to utilize <a href=\"http://golang.org/ref/spec#Channel_types\" rel=\"nofollow noreferrer\">channels</a>.</p>\n\n<p>Your central code which manages/changes the property or variable that needs to be listened may provide a <code>GetChan()</code> function which returns a channel on which modifications (e.g. new values) will be broadcasted:</p>\n\n<pre><code>// The variable or property that is listened:\nvar i int\n\n// Slice of all listeners\nvar listeners []chan int\n\nfunc GetChan() chan int {\n    listener := make(chan int, 5)\n    listeners = append(listeners, listener)\n    return listener\n}\n</code></pre>\n\n<p>Whenever you change the variable/property, you need to broadcast the change:</p>\n\n<pre><code>func Set(newi int) {\n    i = newi\n    for _, ch := range listeners {\n        ch &lt;- i\n    }\n}\n</code></pre>\n\n<p>And listeners need to \"listen\" for change events, which can be done by a <code>for range</code> loop on the channel returned by <code>GetChan()</code>:</p>\n\n<pre><code>func Background(name string, ch chan int, done chan int) {\n    for v := range ch {\n        fmt.Printf(\"[%s] value changed: %d\\n\", name, v)\n    }\n    done &lt;- 0\n}\n</code></pre>\n\n<p>Here is the main program:</p>\n\n<pre><code>func main() {\n    l1 := GetChan()\n    l2 := GetChan()\n\n    done := make(chan int)\n\n    go Background(\"B1\", l1, done)\n    go Background(\"B2\", l2, done)\n\n    Set(3)\n    time.Sleep(time.Second) // Wait a little\n    Set(5)\n\n    // Close all listeners:\n    for _, listener := range listeners {\n        close(listener)\n    }\n\n    // Wait 2 background threads to finish:\n    &lt;-done\n    &lt;-done\n}\n</code></pre>\n\n<p>And its output:</p>\n\n<pre><code>[B1] value changed: 3\n[B2] value changed: 3\n[B1] value changed: 5\n[B2] value changed: 5\n</code></pre>\n\n<p>You can try the complete program on the <a href=\"http://play.golang.org/p/t2G217Ud1J\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>You may also implement a \"broker\" which realizes a subscriber model and allows broadcasting messages. See <a href=\"https://stackoverflow.com/questions/36417199/how-to-broadcast-message-using-channel/49877632#49877632\">How to broadcast message using channel</a>.</p>\n"}], "owner": {"reputation": 103, "user_id": 2495746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c07aca966689ef0d92d7309716c4469d?s=128&d=identicon&r=PG", "display_name": "pjoe", "link": "https://stackoverflow.com/users/2495746/pjoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2334, "favorite_count": 0, "accepted_answer_id": 29489471, "answer_count": 1, "score": 4, "last_activity_date": 1558608922, "creation_date": 1428398261, "question_id": 29488010, "link": "https://stackoverflow.com/questions/29488010/property-change-notification-in-go", "title": "Property change notification in go", "body": "<p>How can you signal 'property' changes to multiple receivers in go?</p>\n\n<p>Similar to how you would define a property in Qt with a notify signal.</p>\n\n<p>E.g. if you imagine having some value that needs to be shown in multiple ways, like a progress value that could be shown both as a progress bar and as textual %, where both would need to update when the underlying value changes.</p>\n"}, {"tags": ["session", "go", "registry"], "answers": [{"tags": [], "owner": {"reputation": 632, "user_id": 872227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0ddef50299354758664f679265746cd?s=128&d=identicon&r=PG", "display_name": "freeformz", "link": "https://stackoverflow.com/users/872227/freeformz"}, "is_accepted": false, "score": 0, "last_activity_date": 1428458617, "creation_date": 1428458617, "answer_id": 29504619, "question_id": 29485143, "link": "https://stackoverflow.com/questions/29485143/registry-in-session-implementation/29504619#29504619", "title": "Registry in session implementation", "body": "<p>A <code>Registry</code> hold one or more named sessions for the request. A request could use a mix of <code>CookieStore</code>s and or <code>FileSystem</code> stores (or others that they implement / import like a BoltDB Store), each holding one or more named sessions.</p>\n"}], "owner": {"reputation": 8760, "user_id": 195727, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/06237052745686cba3fcb34d056d3cad?s=128&d=identicon&r=PG", "display_name": "Dzung Nguyen", "link": "https://stackoverflow.com/users/195727/dzung-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1428458617, "creation_date": 1428388020, "question_id": 29485143, "link": "https://stackoverflow.com/questions/29485143/registry-in-session-implementation", "title": "Registry in session implementation", "body": "<p>I'm trying to understand the session implementation from gorilla. There is a concept of <code>Registry</code> in it, registry seems to be the mapping of multiple session and a request. I'm curious, what is the use case here for registry ?</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["session", "web", "go", "revel"], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 4569250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afe999a1d6e4870446aa29d7082dae0c?s=128&d=identicon&r=PG&f=1", "display_name": "anonx", "link": "https://stackoverflow.com/users/4569250/anonx"}, "is_accepted": true, "score": 1, "last_activity_date": 1428564473, "last_edit_date": 1428564473, "creation_date": 1428400769, "answer_id": 29488838, "question_id": 29482931, "link": "https://stackoverflow.com/questions/29482931/how-to-use-session-with-golang-revel-framework/29488838#29488838", "title": "How to use session with golang revel framework", "body": "<p><em>I wonder why was your absolutely valid question downvoted. The problem you have described is known. Here is a related GH issue: <a href=\"https://github.com/revel/revel/issues/792\" rel=\"nofollow\">https://github.com/revel/revel/issues/792</a></em></p>\n\n<p>Temporary workaround would be avoiding to write directly to <code>c.Response.Out</code>. Instead use a buffer and then return it using <code>RenderText</code>:</p>\n\n<pre><code>this.Response.Status = http.StatusOK\nthis.Response.ContentType = \"image/png\"\n\nvar buffer bytes.Buffer\nbase.NewImage(d, 100, 40).WriteTo(&amp;buffer)\n\nreturn this.RenderText(buffer.String())\n</code></pre>\n\n<p>Or alternatively modify your <code>GetSecurityCode</code> so you don't need <code>Session</code> there.</p>\n"}, {"tags": [], "owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "is_accepted": false, "score": 1, "last_activity_date": 1428632214, "creation_date": 1428632214, "answer_id": 29552248, "question_id": 29482931, "link": "https://stackoverflow.com/questions/29482931/how-to-use-session-with-golang-revel-framework/29552248#29552248", "title": "How to use session with golang revel framework", "body": "<p>@anonx:\nThanks\nAs you say, I fix this problem like :</p>\n\n<pre><code>// \u83b7\u53d6\u9a8c\u8bc1\u7801\u56fe\u7247\nfunc (this App) GetSecurityCode(timestamp int64) r.Result {\n// \u65f6\u95f4\u6233\u53c2\u6570\uff0c\u7b2c\u4e00\u6b21\u52a0\u8f7d\u4e3a1\uff0c\u540e\u7eed\u52a0\u8f7d\u4e3a\u5f53\u524d\u7684\u65f6\u95f4\u6233\uff0c\u53ef\u4ee5\u7528\u6765\u9a8c\u8bc1\u5ba2\u6237\u7aef\u5237\u65b0\u9891\u7387\n// \u5982\uff1a\u5237\u65b0\u9891\u7387\u8fc7\u9ad8\uff0c\u76f4\u63a5\u9650\u5236\u5f53\u524d\u5ba2\u6237\u7aef\u7b49\n//fmt.Println(\"GetSecurityCode\", timestamp)\n\nd := make([]byte, 4)\ns := base.NewLen(4)\nss := \"\"\nd = []byte(s)\n\nfor v := range d {\n    d[v] %= 10\n    ss += strconv.FormatInt(int64(d[v]), 32)\n}\n\nthis.Session[\"securityCode\"] = ss\nfmt.Println(this.Session[\"securityCode\"])\n\n//this.Response.Status = http.StatusOK\n//this.Response.ContentType = \"image/png\"\n\nbuff := &amp;bytes.Buffer{}\nbase.NewImage(d, 100, 40).WriteTo(buff)\n\nreturn this.RenderBinary(buff, \"img\", r.Attachment, time.Now())\n}\n</code></pre>\n"}], "owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1279, "favorite_count": 0, "accepted_answer_id": 29488838, "answer_count": 2, "score": 2, "last_activity_date": 1428632214, "creation_date": 1428375301, "last_edit_date": 1428375698, "question_id": 29482931, "link": "https://stackoverflow.com/questions/29482931/how-to-use-session-with-golang-revel-framework", "title": "How to use session with golang revel framework", "body": "<p>I use the golang web framework as my web framework. But the session doesn`t use. the code I write as follow :</p>\n\n<pre><code>package controllers \n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"strconv\"\n\n    \"GoRBAC/app/base\"\n    \"GoRBAC/app/models\"\n\n    r \"github.com/revel/revel\"\n)\n\ntype App struct {\n    *r.Controller\n}\n\n// \u9996\u9875\nfunc (this App) Index() r.Result {\n    userDao := models.NewUserDao()\n    user, err := userDao.QueryById(1)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(user)\n    return this.Render()\n}\n\n// \u8df3\u8f6c\u81f3\u767b\u5f55\u9875\u9762\nfunc (this App) ToLogin() r.Result {\n    return this.RenderTemplate(\"App/login.html\")\n}\n\nfunc (this App) Login() r.Result {\n\n    username := this.Params.Get(\"username\")\n    password := this.Params.Get(\"password\")\n    securityCode := this.Params.Get(\"securityCode\")\n\n    fmt.Println(this.Session[\"securityCode\"])\n    fmt.Println(username)\n    fmt.Println(password)\n    fmt.Println(securityCode)\n\n    if securityCode != this.Session[\"securityCode\"] {\n        return this.RenderText(\"error securityCode\")\n    } else {\n        userDao := models.NewUserDao()\n        user, err := userDao.QueryByUsername(username)\n        if err != nil || user == nil {\n            return this.RenderText(\"username not exsit\")\n        } else if user.Password != password {\n            return this.RenderText(\"error password\")\n        } else {\n            delete(this.Session, \"securityCode\")\n            this.RenderText(\"ok\")\n        }\n    }\n    return this.RenderText(\"ok\")\n}\n\n// \u83b7\u53d6\u9a8c\u8bc1\u7801\u56fe\u7247\nfunc (this App) GetSecurityCode(timestamp int64) r.Result {\n    // \u65f6\u95f4\u6233\u53c2\u6570\uff0c\u7b2c\u4e00\u6b21\u52a0\u8f7d\u4e3a1\uff0c\u540e\u7eed\u52a0\u8f7d\u4e3a\u5f53\u524d\u7684\u65f6\u95f4\u6233\uff0c\u53ef\u4ee5\u7528\u6765\u9a8c\u8bc1\u5ba2\u6237\u7aef\u5237\u65b0\u9891\u7387\n    // \u5982\uff1a\u5237\u65b0\u9891\u7387\u8fc7\u9ad8\uff0c\u76f4\u63a5\u9650\u5236\u5f53\u524d\u5ba2\u6237\u7aef\u7b49\n    fmt.Println(\"GetSecurityCode\", timestamp)\n\n    d := make([]byte, 4)\n    s := base.NewLen(4)\n    ss := \"\"\n    d = []byte(s)\n\n    for v := range d {\n        d[v] %= 10\n        ss += strconv.FormatInt(int64(d[v]), 32)\n    }\n\n    // \u5c06\u9a8c\u8bc1\u7801\u5b57\u7b26\u4e32\u5b58\u5165\u5230session\n    this.Session[\"securityCode\"] = ss\n    this.Session.SetNoExpiration()\n\n    fmt.Println(this.Session[\"securityCode\"])\n    fmt.Println(ss)\n\n    this.Response.Status = http.StatusOK\n    this.Response.ContentType = \"image/png\"\n\n    base.NewImage(d, 100, 40).WriteTo(this.Response.Out)\n\n    return this.Render()\n}\n</code></pre>\n\n<p>I set the securityCode value in session in the method GetSecurityCode() , this method use to generate the security Code for login verify</p>\n\n<p>I use the the securityCode value in the method Login(). But I get nothing for the value </p>\n\n<p>Anyone who can help me , how can I fix this problem ?</p>\n\n<p>thanks !!</p>\n"}, {"tags": ["go", "gorilla", "negroni"], "answers": [{"tags": [], "owner": {"reputation": 2741, "user_id": 842077, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/9b1f84f21accf057a5683c53ac0f8b59?s=128&d=identicon&r=PG", "display_name": "olif", "link": "https://stackoverflow.com/users/842077/olif"}, "is_accepted": true, "score": 1, "last_activity_date": 1428436716, "creation_date": 1428436716, "answer_id": 29500215, "question_id": 29482453, "link": "https://stackoverflow.com/questions/29482453/subrouter-issues-with-negroni-gorilla-mux/29500215#29500215", "title": "Subrouter issues with negroni / gorilla mux", "body": "<p>Yes and no. You can make the routes semi-work by adding StrictSlash(true) to the router.</p>\n\n<p>Given the following code </p>\n\n<pre><code>package main\n\n    import (\n        \"fmt\"\n        \"net/http\"\n\n        \"github.com/gorilla/mux\"\n    )\n\n    func main() {\n        mainRouter := mux.NewRouter().StrictSlash(true)\n        mainRouter.HandleFunc(\"/test\", func(w http.ResponseWriter, r *http.Request) { fmt.Fprint(w, \"test\") })\n\n        subRouter := mainRouter.PathPrefix(\"/users\").Subrouter()\n        subRouter.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) { fmt.Fprint(w, \"/users\") })\n        subRouter.HandleFunc(\"/{id:[0-9]+}\", func(w http.ResponseWriter, r *http.Request) { fmt.Fprint(w, \"/users/id\") })\n        http.ListenAndServe(\":8080\", mainRouter)\n    }\n</code></pre>\n\n<p>a request to <a href=\"http://localhost:8080/users\" rel=\"nofollow\">http://localhost:8080/users</a> will return </p>\n\n<pre><code>&lt; HTTP/1.1 301 Moved Permanently\n&lt; Location: /users/\n&lt; Date: Tue, 07 Apr 2015 19:52:12 GMT\n&lt; Content-Length: 42\n&lt; Content-Type: text/html; charset=utf-8\n&lt; \n&lt;a href=\"/users/\"&gt;Moved Permanently&lt;/a&gt;.\n</code></pre>\n\n<p>a request to <a href=\"http://localhost:8080/users/\" rel=\"nofollow\">http://localhost:8080/users/</a> returns</p>\n\n<pre><code>&lt; HTTP/1.1 200 OK\n&lt; Date: Tue, 07 Apr 2015 19:54:43 GMT\n&lt; Content-Length: 6\n&lt; Content-Type: text/plain; charset=utf-8\n\n&lt; /users\n</code></pre>\n\n<p>so if your client is a browser then perhaps this is acceptable.</p>\n"}], "owner": {"reputation": 25268, "user_id": 384016, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/845f343c1d289a3ee6ea5140fef8a25b?s=128&d=identicon&r=PG", "display_name": "ryanzec", "link": "https://stackoverflow.com/users/384016/ryanzec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 0, "accepted_answer_id": 29500215, "answer_count": 1, "score": 0, "last_activity_date": 1428436716, "creation_date": 1428371586, "question_id": 29482453, "link": "https://stackoverflow.com/questions/29482453/subrouter-issues-with-negroni-gorilla-mux", "title": "Subrouter issues with negroni / gorilla mux", "body": "<p>So I am trying to setup my router to respond to <code>/users</code> and <code>/users/{userId}</code> so I tried this code:</p>\n\n<pre><code>usersRouter := router.PathPrefix(\"/users\").Subrouter()\nusersRouter.HandleFunc(\"\", users.GetUsersRoute).Methods(\"GET\")\nusersRouter.HandleFunc(\"/{userId:[0-9]*}\", users.GetUserRoute).Methods(\"GET\")\n</code></pre>\n\n<p>The issue is that I get a 404 error when I go to <code>/users</code> (but is does respond to <code>/users/</code>)  If I do:</p>\n\n<pre><code>router.HandleFunc(\"/users\", users.GetUsersRoute).Methods(\"GET\")\nrouter.HandleFunc(\"/users/{userId:[0-9]*}\", users.GetUserRoute).Methods(\"GET\")\n</code></pre>\n\n<p>It works like I want it to.</p>\n\n<p>Is there any way to get the URLs to work like I want with Subrouters?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19482, "user_id": 1048862, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a0f604322f5a3e0b11aad4c3529f83b5?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/1048862/matt"}, "edited": false, "score": 0, "creation_date": 1428385940, "post_id": 29482343, "comment_id": 47129180, "body": "What is your question exactly? Just wondering if there&#39;s a more idiomatic way than using a switch statement?"}, {"owner": {"reputation": 1933, "user_id": 419875, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f3172ebf7d3c0ecfcc920c7dd00210cc?s=128&d=identicon&r=PG", "display_name": "Mike Flynn", "link": "https://stackoverflow.com/users/419875/mike-flynn"}, "reply_to_user": {"reputation": 19482, "user_id": 1048862, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a0f604322f5a3e0b11aad4c3529f83b5?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/1048862/matt"}, "edited": false, "score": 0, "creation_date": 1428386055, "post_id": 29482343, "comment_id": 47129219, "body": "I have the two types of posts and I&#39;d like to know the best way to pivot between those types based on user input (domain)."}, {"owner": {"reputation": 19482, "user_id": 1048862, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a0f604322f5a3e0b11aad4c3529f83b5?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/1048862/matt"}, "edited": false, "score": 0, "creation_date": 1428386546, "post_id": 29482343, "comment_id": 47129385, "body": "That&#39;s probably fine, especially If there&#39;s only the two."}], "answers": [{"tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": true, "score": 1, "last_activity_date": 1428410151, "creation_date": 1428410151, "answer_id": 29491757, "question_id": 29482343, "link": "https://stackoverflow.com/questions/29482343/go-variable-assignment-with-interfaces-and-dynamic-types/29491757#29491757", "title": "Go Variable Assignment with Interfaces and Dynamic Types", "body": "<p>Depending on the details, I believe your structure is in general sound. But some more understanding is required.</p>\n\n<p>With an interface, such as <code>Post</code>, you can only access the <em>methods</em> defined for the interface (<code>GetMetadata()</code> in this case). The value stored in the interface, eg. the <code>*YouTubeVideo</code> or <code>*InstagramPic</code>) cannot be accessed without a <strong><a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">type assertion</a></strong> or <strong><a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow\">type switch</a></strong>.</p>\n\n<p>Therefore, it is not possible to get the title using <code>thePost.title</code>.</p>\n\n<p><strong>Getting a Post's field value</strong></p>\n\n<p>Here you have two alternatives (three if you count \"type assertions\"):</p>\n\n<p><em>1) Add access to properties through Interface methods</em></p>\n\n<pre><code>type Post interface {\n  GetMetadata() bool\n  Title() string // Added Title method\n}\n\nfunc (ig *YouTubeVideo) Title() string {\n  return ig.Title     \n}\n\n...\n\nfmt.Println(thePost.Title())\n</code></pre>\n\n<p><em>2) Access the properties with a type switch</em></p>\n\n<pre><code>switch v := thePost.(type) {\ncase *YouTubeVideo:\n    fmt.Println(v.ChannelTitle)\ncase *InstagramPic:\n    fmt.Println(v.PublishedAt)\n}\n</code></pre>\n\n<p>Alternative 1) is useful if all types that implements a <code>Post</code> also should give access to a certain property. 2) allows you to access fields specific for that type, but it requires then a case for each type.</p>\n\n<p><strong>Setting a Post's field value</strong></p>\n\n<p>Just like when getting, you can't directly set an Interface value's fields. In you case you should first set the desired fields before storing it in the interface:</p>\n\n<pre><code>v := new(YouTubeVideo)\nv.ID = pid\nthePost = v // Store the *YouTubeVideo in thePost\n</code></pre>\n\n<p>Or a bit shorter:</p>\n\n<pre><code>thePost = &amp;YouTubeVideo{ID: pid}\n</code></pre>\n\n<p><strong>Final note</strong></p>\n\n<p>With some tuning, your structure should work using interfaces and type switches. But exactly how to best structure it is dependent on your specific situation which we have too little information about.</p>\n\n<p>To get a better understanding on how to use interfaces, I recommend reading: <strong><a href=\"https://golang.org/doc/effective_go.html#interfaces_and_types\" rel=\"nofollow\">Effective Go: Interfaces and Types</a></strong></p>\n"}], "owner": {"reputation": 1933, "user_id": 419875, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f3172ebf7d3c0ecfcc920c7dd00210cc?s=128&d=identicon&r=PG", "display_name": "Mike Flynn", "link": "https://stackoverflow.com/users/419875/mike-flynn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 29491757, "answer_count": 1, "score": 0, "last_activity_date": 1428410151, "creation_date": 1428370773, "last_edit_date": 1428385181, "question_id": 29482343, "link": "https://stackoverflow.com/questions/29482343/go-variable-assignment-with-interfaces-and-dynamic-types", "title": "Go Variable Assignment with Interfaces and Dynamic Types", "body": "<p>I have a script that pulls from a different data source depending on the user input with a general interface and a type for each data source. Each data source then has a method to get the meta data for that particular source. I'm struggling a bit understanding the <strong>idomatic Go implementation to switch types depending on input</strong>.</p>\n\n<p>This example does not compile, but it was the version that best illustrates what I want to do:</p>\n\n<pre><code>type Post interface {\n  GetMetadata() bool\n}\n\ntype YouTubeVideo struct {\n  ID            string\n  Title         string\n  ChannelID     string\n  ChannelTitle  string\n  PublishedAt   string\n}\n\nfunc (ig *YouTubeVideo) GetMetadata() bool {\n  // ...\n}\n\ntype InstagramPic struct {\n  ID            string\n  ShortCode     string\n  Type          string\n  Title       string\n  PublishedAt   string\n}\n\nfunc (ig *InstagramPic) GetMetadata() bool {\n  // ...\n}\n\nfunc main() {\n  var thePost Post\n\n  switch domain {\n  case \"youtube\":\n    thePost = new(YouTubeVideo)\n    thePost.ID = pid\n  case \"instagram\":\n    thePost = new(InstagramPic)\n    thePost.ShortCode = pid\n  }\n\n  thePost.GetMetadata()\n\n  fmt.Println(thePost.title)\n}\n</code></pre>\n"}, {"tags": ["linux", "vim", "go"], "comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1428369189, "post_id": 29482036, "comment_id": 47124769, "body": "How strange.. its almost like your neocomplete buffer is being inserted into the middle of your current buffer with the code? :/"}], "answers": [{"comments": [{"owner": {"reputation": 711, "user_id": 566219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/610ab0b879a1b72baf3e57bd97497b4c?s=128&d=identicon&r=PG", "display_name": "JAM", "link": "https://stackoverflow.com/users/566219/jam"}, "edited": false, "score": 0, "creation_date": 1428434179, "post_id": 29487189, "comment_id": 47157467, "body": "yes is Konsole 2.13.2.  my machine is AMD Athlon II X4 640 Processor, 8Gb Ram DDR 3"}], "tags": [], "owner": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "is_accepted": false, "score": 3, "last_activity_date": 1428451527, "last_edit_date": 1428451527, "creation_date": 1428395578, "answer_id": 29487189, "question_id": 29482036, "link": "https://stackoverflow.com/questions/29482036/characters-randomly-showing-up-on-screen-when-move-the-cursor-from-left-to-right/29487189#29487189", "title": "characters randomly showing up on screen when move the cursor from left to right in vim insert mode", "body": "<p>It looks as if you are using gnome-terminal or konsole.</p>\n\n<p>When you use cursor-keys to move around in insert-mode, the keys send escape sequences. In particular, if you happen to press the shift- or control-keys, those can send different escape sequences (with numbers), possibly with semicolons to separate the numbers. There are some limitations on vim's handling strings of that sort, and in some cases (see <a href=\"https://groups.google.com/forum/#!topic/vim_use/K6ojqyun0Bg\" rel=\"nofollow\">this discussion</a>) it will get confused and stop interpreting the string, leaving junk on the screen.</p>\n\n<p>The root of the problem is that in <code>vi</code>, the program (mis)uses the escape character for two different reasons:</p>\n\n<ul>\n<li>a special \"command\" character sent by the user to the editor</li>\n<li>the first character in the strings sent by most special keys to an application (including an editor).</li>\n</ul>\n\n<p>The latter requires the program (vim) to wait \"a while\" to determine which case to use.  If you are using a slow machine (or a slow connection) and your keyboard-repeat is fast, that defeats vim's attempt to distinguish the two cases.  Likewise, your plugins send <em>many</em> characters to the screen for each keystroke, making vim slower.</p>\n\n<p>It is aggravated by <em>modified</em> keys (using shift- or control-modifiers) since xterm and other terminals encode that information as a number.  gnome-terminal and konsole use an older variant of xterm's (see xterm FAQ <a href=\"http://invisible-island.net/ncurses/ncurses.faq.html#modified_keys\" rel=\"nofollow\">How can I use shift- or control-modifiers?</a>) which is more easily mistaken by vim as not being an escape sequence.</p>\n\n<p>If it is only a matter of timing, then moving your cursor more slowly would avoid the problem (agreeing that is only a workaround).  You can gauge the amount of output done by vim by running it in <code>script</code> to capture the output into a <em>typescript</em> file.  I do that to analyze bugs, by sending the data back to the terminal more slowly.  Some of those <em>typescript</em> files are surprisingly large, for the little apparent work done.</p>\n"}, {"tags": [], "owner": {"reputation": 711, "user_id": 566219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/610ab0b879a1b72baf3e57bd97497b4c?s=128&d=identicon&r=PG", "display_name": "JAM", "link": "https://stackoverflow.com/users/566219/jam"}, "is_accepted": true, "score": 0, "last_activity_date": 1428847520, "creation_date": 1428847520, "answer_id": 29590287, "question_id": 29482036, "link": "https://stackoverflow.com/questions/29482036/characters-randomly-showing-up-on-screen-when-move-the-cursor-from-left-to-right/29590287#29590287", "title": "characters randomly showing up on screen when move the cursor from left to right in vim insert mode", "body": "<p>I changed from neocomplete to YouCompleteMe, the random characters is not showing anymore.</p>\n"}], "owner": {"reputation": 711, "user_id": 566219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/610ab0b879a1b72baf3e57bd97497b4c?s=128&d=identicon&r=PG", "display_name": "JAM", "link": "https://stackoverflow.com/users/566219/jam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1859, "favorite_count": 0, "accepted_answer_id": 29590287, "answer_count": 2, "score": 1, "last_activity_date": 1428847520, "creation_date": 1428368429, "last_edit_date": 1428434925, "question_id": 29482036, "link": "https://stackoverflow.com/questions/29482036/characters-randomly-showing-up-on-screen-when-move-the-cursor-from-left-to-right", "title": "characters randomly showing up on screen when move the cursor from left to right in vim insert mode", "body": "<p>i have Vim with plugin <a href=\"https://github.com/fatih/vim-go\" rel=\"nofollow\">vim-go</a> and <a href=\"https://github.com/Shougo/neocomplete.vim\" rel=\"nofollow\">neocomplete</a>, when o move the cursor from left to right in insert mode <a href=\"https://drive.google.com/file/d/0B4RlDirVodiXeFZMdXd5c3llMTA/view?usp=sharing\" rel=\"nofollow\">this happens</a></p>\n\n<p><strong>Note:</strong> this only happens with go code and vim-go required binaries (such as gocode, godef, goimports, etc..)</p>\n\n<p>someone have same problem?</p>\n\n<p>i am running Ubuntu 14.04.2 LTS 64bits with Kernel 3.13.0-48 Vim 7.4.52 with lua support</p>\n\n<p>thanks in advance</p>\n"}, {"tags": ["go", "bit-manipulation", "primes"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1428361567, "last_edit_date": 1428361567, "creation_date": 1428360107, "answer_id": 29480872, "question_id": 29480420, "link": "https://stackoverflow.com/questions/29480420/bits-not-being-set-for-a-number-golang/29480872#29480872", "title": "Bits not being set for a number golang", "body": "<blockquote>\n  <p><a href=\"http://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"http://golang.org/ref/spec#Arithmetic_operators\" rel=\"nofollow\">Arithmetic operators</a></p>\n\n<pre><code>&lt;&lt;   left shift             integer &lt;&lt; unsigned integer\n&gt;&gt;   right shift            integer &gt;&gt; unsigned integer\n</code></pre>\n  \n  <p>The shift operators shift the left operand by the shift count\n  specified by the right operand. They implement arithmetic shifts if\n  the left operand is a signed integer and logical shifts if it is an\n  unsigned integer. There is no upper limit on the shift count. Shifts\n  behave as if the left operand is shifted n times by 1 for a shift\n  count of n.</p>\n</blockquote>\n\n<p>You are shifting bits off the end of 64 bits: <code>(1&lt;&lt;p)</code> where <code>p &gt; 63</code>. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    primes := ^uint64(0)\n    fmt.Println(primes)\n    for _, p := range []uint64{0, 1, 2, 62, 63, 64, 65, 99, 100} {\n        fmt.Println(p, \"\\t\", primes&amp;(1&lt;&lt;p))\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>18446744073709551615\n0    1\n1    2\n2    4\n62   4611686018427387904\n63   9223372036854775808\n64   0\n65   0\n99   0\n100  0\n</code></pre>\n"}], "owner": {"reputation": 7335, "user_id": 207072, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/503d152ffd87787eb1357a38f421f749?s=128&d=identicon&r=PG", "display_name": "sc_ray", "link": "https://stackoverflow.com/users/207072/sc-ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 1, "accepted_answer_id": 29480872, "answer_count": 1, "score": 1, "last_activity_date": 1428361567, "creation_date": 1428357719, "question_id": 29480420, "link": "https://stackoverflow.com/questions/29480420/bits-not-being-set-for-a-number-golang", "title": "Bits not being set for a number golang", "body": "<p>I am trying to solve <a href=\"https://projecteuler.net/problem=3\" rel=\"nofollow\">project euler problem 3</a> in golang:</p>\n\n<p>The problem is as follows:</p>\n\n<p><strong>The prime factors of 13195 are 5, 7, 13 and 29.\nWhat is the largest prime factor of the number 600851475143 ?</strong></p>\n\n<p>I am trying to solve it as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc primeset(n uint64) uint64 {\n    primes := uint64(0)\n    for p:= uint64(2);p &lt;= n;p++ {\n        if((primes &amp; (1 &lt;&lt; p)) == 0){\n            fmt.Println(\"Current prime\",p)\n            for j:=uint64(2)*p;j &lt;=n;j=j+p {\n                fmt.Println(\"Current num:\",j)\n                primes |= (1 &lt;&lt; j)\n                fmt.Println(\"Bitset value is:\",primes)\n            }\n        }\n    }\n    return primes\n}\n\nfunc main() {\n    n := uint64(100)\n    primes := primeset(n)\n    fmt.Println(\"Primes is\",primes)\n    j := n\n    for j &gt;= 2 {\n        s := primes &amp; (1 &lt;&lt; uint64(j))\n        if((s == 0) &amp;&amp; ((n % j) == 0)){\n            fmt.Println(\"Largest factor\",j)\n            return\n        } else {\n            j--\n        }\n    }\n\n}\n</code></pre>\n\n<p>In the function 'primeset', I start with an unsigned int called 'primes' with an initial value of 0 and then I left shift by a number(which is a composite) and set that bit of 'primes' to 1.</p>\n\n<p>The idea is that I simply check the 4th bit of 'primes' to see if it has been set. If the bit is set, its not a prime.</p>\n\n<p>For small numbers the code seems to work but when I started testing it for numbers such as 100, all of a sudden things were rather bizzare.</p>\n\n<p>I noticed that the bit shifting is not working while trying to set it for the 62nd bit onwards. The following trace can demonstrate the situation:</p>\n\n<pre><code>Current num: 48\nBitset value is: 375299968947536\nCurrent num: 50\nBitset value is: 1501199875790160\nCurrent num: 52\nBitset value is: 6004799503160656\nCurrent num: 54\nBitset value is: 24019198012642640\nCurrent num: 56\nBitset value is: 96076792050570576\nCurrent num: 58\nBitset value is: 384307168202282320\nCurrent num: 60\nBitset value is: 1537228672809129296\nCurrent num: 62\nBitset value is: 6148914691236517200\nCurrent num: 64\nBitset value is: 6148914691236517200\nCurrent num: 66\nBitset value is: 6148914691236517200\nCurrent num: 68\nBitset value is: 6148914691236517200\nCurrent num: 70\nBitset value is: 6148914691236517200\nCurrent num: 72\nBitset value is: 6148914691236517200\nCurrent num: 74\nBitset value is: 6148914691236517200\nCurrent num: 76\nBitset value is: 6148914691236517200\nCurrent num: 78\nBitset value is: 6148914691236517200\nCurrent num: 80\nBitset value is: 6148914691236517200\nCurrent num: 82\nBitset value is: 6148914691236517200\nCurrent num: 84\nBitset value is: 6148914691236517200\nCurrent num: 86\nBitset value is: 6148914691236517200\n</code></pre>\n\n<p>Can somebody point out what might be off with the way I am performing my bit operations?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "deadlock", "goroutine"], "comments": [{"owner": {"reputation": 6467, "user_id": 1565335, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/eda28448450faa27062f522ec7d62e5b?s=128&d=identicon&r=PG", "display_name": "Azat", "link": "https://stackoverflow.com/users/1565335/azat"}, "edited": false, "score": 1, "creation_date": 1428354548, "post_id": 29479562, "comment_id": 47120006, "body": "Have you tried to read the documentation?"}], "answers": [{"comments": [{"owner": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "edited": false, "score": 0, "creation_date": 1428374635, "post_id": 29482731, "comment_id": 47126139, "body": "By the way, you could remove the waitgroup altogether since the printer function will &quot;freeze&quot; and wait until either there is some value in the channel to read or it is closed."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1428403549, "post_id": 29482731, "comment_id": 47138383, "body": "No, you do need the waitgroup (or equivalent). Otherwise there&#39;s no guarantee that the sending functions will compete before you close the channel and you will get a panic. Never use a sleep for synchronization."}], "tags": [], "owner": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "is_accepted": true, "score": 1, "last_activity_date": 1428373816, "creation_date": 1428373816, "answer_id": 29482731, "question_id": 29479562, "link": "https://stackoverflow.com/questions/29479562/golang-learning-goroutine-took-me-to-a-deadlock/29482731#29482731", "title": "GOLANG: Learning goroutine took me to a deadlock", "body": "<p>The following works. By that I mean that it doesn't deadlock. \nSince you have the printer function in a range loop over the channel, it'll automatically stop after the channel is closed. I added the 3 sec delay near the end to give the try loop time to print. <a href=\"http://tour.golang.org/welcome/1\" rel=\"nofollow\">Read the documentation though. It'll explain 100% of these details.</a></p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"sync\"\n        \"time\"\n)\n\nfunc printAfterDelay(delay time.Duration, message string, wg *sync.WaitGroup) {\n        time.Sleep(delay)\n        fmt.Println(message)\n\n}\n\nfunc add(a int, b int, chan1 chan int, wg *sync.WaitGroup) {\n        c := a + b\n        chan1 &lt;- c\n        wg.Done()\n}\n\nfunc printer(chan1 chan int, wg *sync.WaitGroup) {\n        for result := range chan1 {\n                fmt.Println(result)\n        }\n}\n\nfunc main() {\n        //var wg sync.WaitGroup\n        wg := &amp;sync.WaitGroup{}\n\n        fmt.Println(\"Start...\")\n\n        go printAfterDelay(2000*time.Millisecond, \"Try\", wg)\n\n        chan1 := make(chan int)\n        wg.Add(1)\n        go add(5, 4, chan1, wg)\n\n        wg.Add(1)\n        go add(3, 1, chan1, wg)\n\n        go printer(chan1, wg)\n\n        time.Sleep(3000 * time.Millisecond)\n        wg.Wait()\n    close(chan1)\n\n        fmt.Println(\"End\")\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 1248338, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cf9f65790e176fe6c6bf6566d789355?s=128&d=identicon&r=PG", "display_name": "Noettore", "link": "https://stackoverflow.com/users/1248338/noettore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 639, "favorite_count": 0, "accepted_answer_id": 29482731, "answer_count": 1, "score": -1, "last_activity_date": 1428373816, "creation_date": 1428353806, "question_id": 29479562, "link": "https://stackoverflow.com/questions/29479562/golang-learning-goroutine-took-me-to-a-deadlock", "title": "GOLANG: Learning goroutine took me to a deadlock", "body": "<p>I'm a GO newbie and I'm trying to figure out how does goroutines work and how to synchronize them.\nThis is a simple program I wrote to learn something about them:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"sync\"\n        \"time\"\n)\n\nfunc printAfterDelay(delay time.Duration, message string, wg *sync.WaitGroup) {\n        time.Sleep(delay)\n        fmt.Println(message)\n        wg.Done()\n}\n\nfunc add(a int, b int, chan1 chan int, wg *sync.WaitGroup) {\n        c := a + b\n        chan1 &lt;- c\n        //close(chan1)\n        wg.Done()\n}\n\nfunc printer(chan1 chan int, wg *sync.WaitGroup) {\n        for result := range chan1 {\n                //result := &lt;-chan1\n                //time.Sleep(2000 * time.Millisecond)\n                fmt.Println(result)\n        }\n        close(chan1)\n        wg.Done()\n}\n\nfunc main() {\n        //var wg sync.WaitGroup\n        wg := &amp;sync.WaitGroup{}\n\n        fmt.Println(\"Start...\")\n\n        wg.Add(1)\n        go printAfterDelay(2000*time.Millisecond, \"Try\", wg)\n\n        chan1 := make(chan int)\n        wg.Add(1)\n        go add(5, 4, chan1, wg)\n\n        wg.Add(1)\n        go add(3, 1, chan1, wg)\n\n        wg.Add(1)\n        go printer(chan1, wg)\n\n        //time.Sleep(3000 * time.Millisecond)\n        wg.Wait()\n\n        fmt.Println(\"End\")\n}\n</code></pre>\n\n<p>The add function takes two int, sums them and pass the result to a chan.\nThe printer function takes the results from the chan and print them.\nThe two funtions are called in main() as goroutines, so i also passed a WaitGroup as a pointer, that is incremented before calling the goroutines and decremented when the functions end.</p>\n\n<p>Anyway when I execute the compiled program it prints:</p>\n\n<pre><code>Start...\n9\n4\nTry\nfatal error: all goroutines are asleep - deadlock!\ngoroutine 16 [semacquire]:\nsync.runtime_Semacquire(0x18334008)\n  /usr/lib/go/src/pkg/runtime/sema.goc:199 +0x37\nsync.(*WaitGroup).Wait(0x183240e0)\n  /usr/lib/go/src/pkg/sync/waitgroup.go:129 +0x12d\nmain.main()        \n  /home/ettore/go/src/example/goroutine/main.go:52 +0x1e5\n\ngoroutine 19 [finalizer wait]:\nruntime.park(0x80599e0, 0x814f000, 0x814e3e9)\n  /usr/lib/go/src/pkg/runtime/proc.c:1369 +0x94\nruntime.parkunlock(0x814f000, 0x814e3e9)       \n  /usr/lib/go/src/pkg/runtime/proc.c:1385 +0x3\nfrunfinq()        \n  /usr/lib/go/src/pkg/runtime/mgc0.c:2644 +0xc5\nruntime.goexit()        \n  /usr/lib/go/src/pkg/runtime/proc.c:1445\n\ngoroutine 23 [chan receive]:\nmain.printer(0x1831a090, 0x183240e0)        \n  /home/ettore/go/src/example/goroutine/main.go:23 +0x46\ncreated by main.main        \n  /home/ettore/go/src/example/goroutine/main.go:49 +0x1d7\n</code></pre>\n\n<p>Where and what is the problem(s)?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["json", "go", "client", "rpc"], "comments": [{"owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 0, "creation_date": 1428356740, "post_id": 29479360, "comment_id": 47121077, "body": "I suspect this has something to do with jsonrpc and id being lowercase and thus private to the Args struct. If the API you are calling expects lowercase args, you can probably use struct tags to get around that"}, {"owner": {"reputation": 49, "user_id": 4638860, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/768212f16481aed42b312f00cbc281e1?s=128&d=identicon&r=PG&f=1", "display_name": "Ganesh", "link": "https://stackoverflow.com/users/4638860/ganesh"}, "reply_to_user": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 0, "creation_date": 1428366797, "post_id": 29479360, "comment_id": 47124216, "body": "Thanks a lot. That tagging helped to certain extent in adding the params but, I need to add tags to the actual JSON itself like this - How can I add jsonrpc and edit the id value      `  &#39;{&quot;method&quot;:&quot;echo&quot;,<b>&quot;jsonrpc&quot;:&quot;2.0&quot;</b>,&quot;params&quot;:[&quot;test_params&quot;],<b>&quot;&zwnj;&#8203;id&quot;:&quot;839732f9-cf36-4&zwnj;&#8203;6ff-8b9b-6120250d9ce&zwnj;&#8203;5&quot;</b>}&#39;  `"}, {"owner": {"reputation": 49, "user_id": 4638860, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/768212f16481aed42b312f00cbc281e1?s=128&d=identicon&r=PG&f=1", "display_name": "Ganesh", "link": "https://stackoverflow.com/users/4638860/ganesh"}, "reply_to_user": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 0, "creation_date": 1428427962, "post_id": 29479360, "comment_id": 47153911, "body": "@rob74 or someone please tell me how can I edit the id value passed in the JSON RPC request or even add jsonrpc version along with the JSON (jsonrpc is required for 2.0) ?"}], "answers": [{"tags": [], "owner": {"reputation": 632, "user_id": 872227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0ddef50299354758664f679265746cd?s=128&d=identicon&r=PG", "display_name": "freeformz", "link": "https://stackoverflow.com/users/872227/freeformz"}, "is_accepted": false, "score": 1, "last_activity_date": 1428456562, "creation_date": 1428456562, "answer_id": 29504328, "question_id": 29479360, "link": "https://stackoverflow.com/questions/29479360/json-rpc-client-go/29504328#29504328", "title": "JSON RPC Client Go", "body": "<p>I don't think what you are doing is possible using the client as provided by go because the private <code>clientRequest</code> struct is currently defined as:</p>\n\n<pre><code>    type clientRequest struct {\n        Method string         `json:\"method\"`\n        Params [1]interface{} `json:\"params\"`\n        Id     uint64         `json:\"id\"`\n    }\n</code></pre>\n\n<p>What you pass into <code>Call</code> as <code>args</code> is stuck into <code>Params</code> and note how there is no \"Version `json:\"jsonrpc\"`\" inside of that struct.</p>\n\n<p>AFAICT (which may be wrong, this is my first time reading through this code) you would need to implement your own <a href=\"http://golang.org/pkg/net/rpc/#ClientCodec\" rel=\"nofollow\">ClientCodec</a>. You could probably get away with copying most (all) of the parts out of the stdlib and add the field to the <code>clientRequest</code> above. ;-) </p>\n"}], "owner": {"reputation": 49, "user_id": 4638860, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/768212f16481aed42b312f00cbc281e1?s=128&d=identicon&r=PG&f=1", "display_name": "Ganesh", "link": "https://stackoverflow.com/users/4638860/ganesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1677, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1428456562, "creation_date": 1428353081, "last_edit_date": 1428448417, "question_id": 29479360, "link": "https://stackoverflow.com/questions/29479360/json-rpc-client-go", "title": "JSON RPC Client Go", "body": "<p>I have a python server serving response through JSON-RPC. Here is a sample response from the server.</p>\n\n<pre><code>'{\"jsonrpc\": \"2.0\", \"result\": \"Peer 1: local 10.10.0.2  remote 10.10.0.1  state CONNECT\\\\nPeer 2: local 10.10.0.18  remote 10.10.0.17  state ESTABLISHED\\\\nPeer 3: local 10.10.0.10  remote 10.10.0.9  state ESTABLISHED\", \"id\": \"839732f9-cf36-46ff-8b9b-6120250d9ce5\"}'\n</code></pre>\n\n<p>Here is the request I need to send to the server:       </p>\n\n<pre><code>'{\"method\":\"echo\",\"jsonrpc\":\"2.0\",\"params\":[\"test_params\"],\"id\":\"839732f9-cf36-46ff-8b9b-6120250d9ce5\"}'\n</code></pre>\n\n<p>Here is my client with go language:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net\"\n    \"net/rpc/jsonrpc\"\n)\ntype Args struct {\n    jsonrpc, id string\n}\n\nfunc main() {\n    conn, err := net.Dial(\"tcp\", \"11.21.22.221:8080\")\n    if err != nil {\n        panic(err)\n    }\n    defer conn.Close()\n\n    args := Args{\"2.0\", \"d87198f0-af92-49f8-9a7d-ab8bed5c4d17\"}\n    var reply string\n\n    c := jsonrpc.NewClient(conn)\n\n    err = c.Call(\"echo\", args, &amp;reply)\n    if err != nil {\n        log.Fatal(\"error:\", err)\n    }\n    fmt.Printf(\"Response: %d\", reply)\n}\n</code></pre>\n\n<p>But, when I run this client, it is not sending anything in the params. Instead it is sending empty params like this:</p>\n\n<pre><code>'{\"method\":\"echo\",\"params\":[{}],\"id\":0}\\n\n</code></pre>\n\n<p>Can somebody help me telling what mistake I am making? I am a newbie to go language.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"tags": [], "owner": {"reputation": 196, "user_id": 4752457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3e44ad3132013d9ea4ed720bb5ee4a?s=128&d=identicon&r=PG", "display_name": "user4752457", "link": "https://stackoverflow.com/users/4752457/user4752457"}, "is_accepted": true, "score": 2, "last_activity_date": 1428368069, "last_edit_date": 1428368069, "creation_date": 1428362227, "answer_id": 29481217, "question_id": 29479040, "link": "https://stackoverflow.com/questions/29479040/golang-appengine-throws-operation-not-permitted-error-on-get-call/29481217#29481217", "title": "Golang: AppEngine throws operation not permitted error on Get call", "body": "<p>On App Engine, you must use a transport created by the urlfetch package. The <a href=\"https://cloud.google.com/appengine/docs/go/urlfetch/\" rel=\"nofollow\">urlfetch</a> Client function creates a client with an appropriate transport:</p>\n\n<pre><code>func createHttpClient(r *http.Request) *http.Client {\n    return urlfetch.Client(appengine.NewContext(r))\n}\n</code></pre>\n"}], "owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 855, "favorite_count": 0, "accepted_answer_id": 29481217, "answer_count": 1, "score": 1, "last_activity_date": 1428368069, "creation_date": 1428351727, "last_edit_date": 1428354556, "question_id": 29479040, "link": "https://stackoverflow.com/questions/29479040/golang-appengine-throws-operation-not-permitted-error-on-get-call", "title": "Golang: AppEngine throws operation not permitted error on Get call", "body": "<p>I've written a simple GAE app that does a Get call to an external API but I'm getting a very strange error:</p>\n\n<p><strong>Get <a href=\"http://kenyan-politicians.popit.mysociety.org/api/v0.1/persons/core_person:1290\" rel=\"nofollow\">http://kenyan-politicians.popit.mysociety.org/api/v0.1/persons/core_person:1290</a>: dial tcp: stat /etc/resolv.conf: operation not permitted</strong></p>\n\n<p>On my dev_appserver it works without any problems. So I'm wondering what could be the problem. I'm not using UrlFetch but my own package <a href=\"http://godoc.org/github.com/johnwesonga/go-mzalendo/mzalendo\" rel=\"nofollow\">http://godoc.org/github.com/johnwesonga/go-mzalendo/mzalendo</a> that uses http.NewRequest and http.DefaultClient.Do</p>\n\n<p>Because of AppEngine restrictions I'm passing my own client to the NewClient call:</p>\n\n<pre><code>func createHttpClient() *http.Client {\n    transport := http.Transport{}\n\n    client := &amp;http.Client{\n        Transport: &amp;transport,\n    }\n\n    return client\n}\n\nclient := createHttpClient()\nc := mzalendo.NewClient(client)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 196, "user_id": 4752457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3e44ad3132013d9ea4ed720bb5ee4a?s=128&d=identicon&r=PG", "display_name": "user4752457", "link": "https://stackoverflow.com/users/4752457/user4752457"}, "is_accepted": false, "score": 3, "last_activity_date": 1428349760, "last_edit_date": 1428349760, "creation_date": 1428347205, "answer_id": 29477863, "question_id": 29477505, "link": "https://stackoverflow.com/questions/29477505/golang-different-appengine-packages/29477863#29477863", "title": "Golang: Different AppEngine packages", "body": "<p>The \"google.golang.org/appengine\" packages work on both managed VMs and App Engine Classic. The \"appengine\" packages work on App Engine Classic only.</p>\n\n<p>The \"google.golang.org/appengine\" packages use the <a href=\"http://godoc.org/golang.org/x/net/context\" rel=\"nofollow\">x/net/context</a> package for passing context around.  The \"appengine\" packages use a context specific to those packages.</p>\n\n<p>See <a href=\"https://github.com/golang/appengine#3-update-code-using-deprecated-removed-or-modified-apis\" rel=\"nofollow\">https://github.com/golang/appengine#3-update-code-using-deprecated-removed-or-modified-apis</a> for a list of differences in the APIs.</p>\n"}], "owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1428349760, "creation_date": 1428345942, "question_id": 29477505, "link": "https://stackoverflow.com/questions/29477505/golang-different-appengine-packages", "title": "Golang: Different AppEngine packages", "body": "<p>What is the difference between this two AppEngine packages:\n<a href=\"https://cloud.google.com/appengine/docs/go/reference\" rel=\"nofollow\">https://cloud.google.com/appengine/docs/go/reference</a>\n<a href=\"https://godoc.org/google.golang.org/appengine\" rel=\"nofollow\">https://godoc.org/google.golang.org/appengine</a></p>\n\n<p>The only thing that stands out for me is that 2nd one has no Context type</p>\n\n<p>Which one should someone use in developing an application?</p>\n"}, {"tags": ["go", "proxy", "martini"], "comments": [{"owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "edited": false, "score": 3, "creation_date": 1428343639, "post_id": 29476611, "comment_id": 47114537, "body": "Any reason to user martini... you can do all with net/http package."}, {"owner": {"reputation": 1664, "user_id": 1833511, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/ab0c9cc3bb28498a3e83e5862ab2f5b4?s=128&d=identicon&r=PG", "display_name": "Dirk", "link": "https://stackoverflow.com/users/1833511/dirk"}, "reply_to_user": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "edited": false, "score": 0, "creation_date": 1428343803, "post_id": 29476611, "comment_id": 47114629, "body": "I know, but it will also have to do some static file serving and other things, the gateway is just a part of the application"}], "answers": [{"tags": [], "owner": {"reputation": 632, "user_id": 872227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0ddef50299354758664f679265746cd?s=128&d=identicon&r=PG", "display_name": "freeformz", "link": "https://stackoverflow.com/users/872227/freeformz"}, "is_accepted": false, "score": 10, "last_activity_date": 1428458147, "creation_date": 1428458147, "answer_id": 29504544, "question_id": 29476611, "link": "https://stackoverflow.com/questions/29476611/go-simple-api-gateway-proxy/29504544#29504544", "title": "Go simple API Gateway proxy", "body": "<p>stdlib version</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n)\n\nfunc main() {\n    target, err := url.Parse(\"http://192.168.2.8:8000\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    http.Handle(\"/users/\", http.StripPrefix(\"/users/\", httputil.NewSingleHostReverseProxy(target)))\n    http.Handle(\"/public/\", http.StripPrefix(\"/public/\", http.FileServer(http.Dir(\"./Documents\"))))\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>Wrap <code>http.StripPrefix</code> with a function that logs before calling it if you need logging.</p>\n"}], "owner": {"reputation": 1664, "user_id": 1833511, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/ab0c9cc3bb28498a3e83e5862ab2f5b4?s=128&d=identicon&r=PG", "display_name": "Dirk", "link": "https://stackoverflow.com/users/1833511/dirk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6885, "favorite_count": 3, "answer_count": 1, "score": 7, "last_activity_date": 1440005519, "creation_date": 1428342657, "last_edit_date": 1428347238, "question_id": 29476611, "link": "https://stackoverflow.com/questions/29476611/go-simple-api-gateway-proxy", "title": "Go simple API Gateway proxy", "body": "<p>I've been searching all over the internet how to do this, but I haven't been able to find it. I'm trying to build a simple API gateway using Go and Martini for my system that has a few microservices with REST interfaces running. For example, I have my <code>users</code> service running on <code>192.168.2.8:8000</code>, and I want to access it through <code>/users</code></p>\n\n<p>So my API gateway would look something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/codegangsta/martini\"\n    \"net/http\"\n)\n\nfunc main(){\n    app := martini.Classic()\n    app.Get(\"/users/:resource\", func(req *http.Request, res http.ResponseWriter){\n        //proxy to http://192.168.2.8:8000/:resource\n    })\n    app.Run()\n}\n</code></pre>\n\n<p><hr>\n<strong>edit</strong></p>\n\n<hr>\n\n<p>I've got something working, but all i see is <code>[vhost v2] release 2.2.5</code>:</p>\n\n<pre><code>package main\n\nimport(\n    \"net/url\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"github.com/codegangsta/martini\"\n    \"fmt\"\n)\n\nfunc main() {\n    remote, err := url.Parse(\"http://127.0.0.1:3000\")\n    if err != nil {\n        panic(err)\n    }\n\n    proxy := httputil.NewSingleHostReverseProxy(remote)\n    app := martini.Classic()\n    app.Get(\"/users/**\", handler(proxy))\n    app.RunOnAddr(\":4000\")\n}\n\nfunc handler(p *httputil.ReverseProxy) func(http.ResponseWriter, *http.Request, martini.Params) {\n    return func(w http.ResponseWriter, r *http.Request, params martini.Params) {\n        fmt.Println(params)\n        r.URL.Path = \"/authorize\"\n        p.ServeHTTP(w, r)\n    }\n}\n</code></pre>\n\n<p><hr>\n<strong>edit 2</strong></p>\n\n<hr>\n\n<p>This only seems to be a problem when using it directly through the browser, <code>XMLHttpRequest</code> works just fine</p>\n"}, {"tags": ["ruby-on-rails", "ruby", "encryption", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1428334043, "post_id": 29473931, "comment_id": 47109541, "body": "You can&#39;t encrypt using CFB, then decrypt using CBC. They are different modes of operation."}, {"owner": {"reputation": 9, "user_id": 4755022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b9125c3eae6bf50c4ae58bc8bdc0565?s=128&d=identicon&r=PG&f=1", "display_name": "jstinson12", "link": "https://stackoverflow.com/users/4755022/jstinson12"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1428334973, "post_id": 29473931, "comment_id": 47110048, "body": "Thanks! Changing the ruby code to CFB worked, but now the output is coming in like &quot;\\xCE\\x81\\xD3\\xB6\\x15&quot;, how do I convert it to a normal string?"}, {"owner": {"reputation": 89316, "user_id": 238886, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/8ca29123b5669b26f9b6ca2c62d9d215?s=128&d=identicon&r=PG", "display_name": "Wayne Conrad", "link": "https://stackoverflow.com/users/238886/wayne-conrad"}, "edited": false, "score": 1, "creation_date": 1428337643, "post_id": 29473931, "comment_id": 47111362, "body": "That should be asked in a new question, since it&#39;s a different problem.  In the new question, it&#39;s fair for the new and old questions to include links to each other."}, {"owner": {"reputation": 9, "user_id": 4755022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b9125c3eae6bf50c4ae58bc8bdc0565?s=128&d=identicon&r=PG&f=1", "display_name": "jstinson12", "link": "https://stackoverflow.com/users/4755022/jstinson12"}, "edited": false, "score": 0, "creation_date": 1428339719, "post_id": 29473931, "comment_id": 47112500, "body": "Ok, I&#39;ll put it in a new question, thanks"}], "owner": {"reputation": 9, "user_id": 4755022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b9125c3eae6bf50c4ae58bc8bdc0565?s=128&d=identicon&r=PG&f=1", "display_name": "jstinson12", "link": "https://stackoverflow.com/users/4755022/jstinson12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1911, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1428337712, "creation_date": 1428332894, "last_edit_date": 1428337712, "question_id": 29473931, "link": "https://stackoverflow.com/questions/29473931/wrong-final-block-length-when-ruby-decrypts-data-encrypted-by-go", "title": "&quot;wrong final block length&quot; when Ruby decrypts data encrypted by go", "body": "<p>I'm trying to encrypt a piece of data in Go and then store it into a database to be later pulled out and decrypted by Rails.</p>\n\n<p>Here is the Go encryption code:</p>\n\n<pre><code>func Encrypt(text []byte) ([]byte, error) {\n  key := []byte(\"a very very very very secret key\")\n  block, err := aes.NewCipher(key)\n\n  if err != nil {\n    return nil, err\n  }\n\n  b := base64.StdEncoding.EncodeToString(text)\n  ciphertext := make([]byte, aes.BlockSize+len(b))\n  iv := ciphertext[:aes.BlockSize]\n\n  if _, err := io.ReadFull(rand.Reader, iv); err != nil {\n    return nil, err\n  }\n\n  cfb := cipher.NewCFBEncrypter(block, iv)\n  cfb.XORKeyStream(ciphertext[aes.BlockSize:], []byte(b))\n\n  return ciphertext, nil\n}\n</code></pre>\n\n<p>And here is my Ruby code to decrypt:</p>\n\n<pre><code>def decrypt(message)\n  key = \"a very very very very secret key\"\n\n  iv = message[0, 14]\n  data = message[15, message.length+1]\n\n  key = Digest::SHA256.digest(key) if(key.kind_of?(String) &amp;&amp; 32 != key.bytesize)\n  iv = Digest::MD5.digest(iv) if(iv.kind_of?(String) &amp;&amp; 16 != iv.bytesize)\n\n  aes = OpenSSL::Cipher.new('AES-256-CBC')\n  aes.decrypt\n  aes.key = key\n  aes.iv = iv\n  aes.update(data) + aes.final\nend\n</code></pre>\n\n<p>This is giving me an error message of:</p>\n\n<pre><code>OpenSSL::Cipher::CipherError: wrong final block length\n</code></pre>\n\n<p>Can anyone help let me know what I'm doing wrong?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "exec", "stdout"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1428330603, "post_id": 29473064, "comment_id": 47107633, "body": "Show the code that prints the messages sent to the channel."}, {"owner": {"reputation": 907, "user_id": 1279730, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c143e62707810f29f4fb207c1cf797ad?s=128&d=identicon&r=PG", "display_name": "machete", "link": "https://stackoverflow.com/users/1279730/machete"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1428330819, "post_id": 29473064, "comment_id": 47107753, "body": "Done, however it <i>should</i> work, because other messages get fine through, even when sent after running git."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1428331014, "post_id": 29473064, "comment_id": 47107860, "body": "The function receives one message from a channel and then exits. Do want a <code>for</code> loop in that function?"}, {"owner": {"reputation": 907, "user_id": 1279730, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c143e62707810f29f4fb207c1cf797ad?s=128&d=identicon&r=PG", "display_name": "machete", "link": "https://stackoverflow.com/users/1279730/machete"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1428331751, "post_id": 29473064, "comment_id": 47108248, "body": "i&#39;ve updated to code to be less and better readable..check again :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1428332123, "post_id": 29473064, "comment_id": 47108465, "body": "Git doesn&#39;t print the extra output if it&#39;s not connected to a TTY, use the <code>--progress</code> option."}, {"owner": {"reputation": 907, "user_id": 1279730, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c143e62707810f29f4fb207c1cf797ad?s=128&d=identicon&r=PG", "display_name": "machete", "link": "https://stackoverflow.com/users/1279730/machete"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1428332456, "post_id": 29473064, "comment_id": 47108693, "body": "@JimB you are a scholar and a god. Thank you :)"}], "owner": {"reputation": 907, "user_id": 1279730, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c143e62707810f29f4fb207c1cf797ad?s=128&d=identicon&r=PG", "display_name": "machete", "link": "https://stackoverflow.com/users/1279730/machete"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 160, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1428332102, "creation_date": 1428329756, "last_edit_date": 1428332102, "question_id": 29473064, "link": "https://stackoverflow.com/questions/29473064/go-cant-pipe-output-from-git-to-custom-pipe", "title": "Go: Can&#39;t pipe output from git to custom pipe", "body": "<p>I'm trying to forward the Stdout of \"git clone somerepo ./\" to log. Unfortunately, only the first line gets piped and everything else discarded.</p>\n\n<pre><code>package main\n\nimport (\n    \"os/exec\"\n    \"log\"\n)\n\n\ntype pipe struct {}\n\nfunc (p *pipe) Write(d []byte) (n int, err error) {\n    log.Printf(\"Git subcommand: %s\", d)\n    return len(d), nil\n}\n\nfunc main() {\n    e := exec.Command(\"git\", \"clone\", \"https://github.com/some/repo\", \"./DATA\")\n    p := &amp;pipe{}\n    e.Stdout = p\n    e.Stderr = p\n    _ = e.Run()\n}\n</code></pre>\n\n<p>This code results in:\n    2015/04/06 16:47:19 Git subcommand: Cloning into './DATA'...</p>\n\n<p>Whilst a slight modification: </p>\n\n<pre><code>    e.Stdout = os.Stdout\n    e.Stderr = os.Stderr\n</code></pre>\n\n<p>Prints out the correct result (but in the output of the cmd line, not a custom pipe)</p>\n\n<pre><code>Cloning into 'D:\\Local\\Temp\\915593bb-0aae-4678-adf0-56930d519ee1'...\nremote: Counting objects: 118, done.\nremote: Compressing objects: 100% (16/16), done.\nrRemote: Total 118 (delta 7), reused 0 (delta 0), peceiving objects:  38% (45/\nReceiving objects:  40% (48/118)\nReceiving objects: 100% (118/118), 22.35 KiB | 0 bytes/s, done.\nResolving deltas: 100% (53/53), done.\nChecking connectivity... done.\nCloning repository was successful\n</code></pre>\n\n<p>In both cases, the repository got cloned successfully, just the output isn't being catched right.</p>\n\n<p><code>CombinedOutput()</code> as well as <code>Output()</code> have the same broken behaviour:</p>\n\n<pre><code>func main() {\n    o, err := exec.Command(\"git\", \"clone\", \"https://github.com/some/repo.git\", \"./DATA\").CombinedOutput()\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Printf(\"%s\", o)\n}\n</code></pre>\n\n<p>What am I doing wrong?</p>\n\n<hr>\n\n<p>Using scanners doesn't help either:</p>\n\n<pre><code>func main() {\n    e := exec.Command(\"git\", \"clone\", \"https://github.com/some/repo\", \"./DATA\")\n    op, _ := e.StdoutPipe()\n    ep, _ := e.StderrPipe()\n    go func() {\n        scanner := bufio.NewScanner(op)\n        for scanner.Scan() {\n            log.Printf(\"Scanner got: \", scanner.Text())\n        }\n    }()\n    go func() {\n        scanner := bufio.NewScanner(ep)\n        for scanner.Scan() {\n            log.Printf(\"Scanner got: %s\", scanner.Text())\n        }\n    }()\n    _ = e.Run()\n}\n</code></pre>\n\n<p>Results in:</p>\n\n<pre><code>2015/04/06 16:54:21 Scanner got: Cloning into './DATA'...\n</code></pre>\n"}, {"tags": ["database", "caching", "go", "revel"], "comments": [{"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 2, "creation_date": 1429703209, "post_id": 29472690, "comment_id": 47721103, "body": "Have you read the <a href=\"http://revel.github.io/manual/cache.html\" rel=\"nofollow noreferrer\">doc</a> ?    Read from cache first, if no cache, read from db, then set cache. If update,    update cache, too."}, {"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 1, "creation_date": 1429703298, "post_id": 29472690, "comment_id": 47721194, "body": "You can use <code>redis</code> or <code>memcached</code>. <a href=\"https://github.com/huacnlee/mediom/blob/master/conf/app.conf#L29\" rel=\"nofollow noreferrer\">example</a>"}, {"owner": {"reputation": 423, "user_id": 3435329, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ek5Ff.jpg?s=128&g=1", "display_name": "DLopes", "link": "https://stackoverflow.com/users/3435329/dlopes"}, "edited": false, "score": 0, "creation_date": 1446124866, "post_id": 29472690, "comment_id": 54620356, "body": "Could you try EnableCache? It&#39;s a cache lib currently used in an Brazilian e-commerce system by my team. I recently put the implementation at GitHub.  I hope to help you! Let me know whether this is lib fit to your scenario.  <a href=\"https://github.com/darciopacifico/enablecache\" rel=\"nofollow noreferrer\">github.com/darciopacifico/enablecache</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "is_accepted": false, "score": 1, "last_activity_date": 1434989382, "creation_date": 1434989382, "answer_id": 30984800, "question_id": 29472690, "link": "https://stackoverflow.com/questions/29472690/caching-database-results-in-golang-revel/30984800#30984800", "title": "Caching database results in Golang (revel)", "body": "<p>In revel add </p>\n\n<pre><code>cache.memcached = true\ncache.hosts=\"127.0.0.1:11211\n</code></pre>\n\n<p>To your conf/app.conf and make sure you have memcached installed. Then import <code>github.com/revel/revel/cache</code> and in your code you can use </p>\n\n<pre><code>var results []string\nif err := cache.Get(\"res\", &amp;results); err == nil {\n  // use results\n} else {\n  // do db query\n  cache.Set(\"results\", results, 3*time.Minute)\n}\n</code></pre>\n"}], "owner": {"reputation": 96, "user_id": 904961, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/670cba5ebdd3f44c88cf79d74a8b28f8?s=128&d=identicon&r=PG", "display_name": "NLScotty", "link": "https://stackoverflow.com/users/904961/nlscotty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2378, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1445876959, "creation_date": 1428328523, "last_edit_date": 1428328883, "question_id": 29472690, "link": "https://stackoverflow.com/questions/29472690/caching-database-results-in-golang-revel", "title": "Caching database results in Golang (revel)", "body": "<p>I am currently coding a web application in Go with the help of the revel web framework. I've come to the point where I want to serve results from a database, however there's quite an amount of rows to serve (~5000-10000). The information only changes every 3 minutes, so perhaps it's a good idea to implement some form of caching.</p>\n\n<p>The Revel framework offers a caching solution, however I have no idea how such a thing would work and if it's the best solution to my problem. Another solution could be to make a global array with the results and grab a slice once in a while (Would this work better if there are a lot of users? ).</p>\n\n<p>Could you guys help me out? I'd really appreciate it.</p>\n"}, {"tags": ["git", "github", "go", "revel"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1428327483, "post_id": 29470591, "comment_id": 47105954, "body": "Try <code>go get -u</code> to pull updates, or just <code>go install</code> (with <code>-a</code> to force rebuilding everything). Go <code>get</code> and <code>install</code> don&#39;t rebuild packages if they haven&#39;t changed."}, {"owner": {"reputation": 450, "user_id": 2280009, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/70db53232bd99a02cf70fb7222e9cd09?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Le Gall", "link": "https://stackoverflow.com/users/2280009/s%c3%a9bastien-le-gall"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1428333297, "post_id": 29470591, "comment_id": 47109144, "body": "Still no effect... :-("}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1428333950, "post_id": 29470591, "comment_id": 47109489, "body": "Other things to try; check everything that&#39;s being built with the <code>-x</code> option, invoke <code>get</code>/<code>install</code> with a full import path, and make sure there are no symlinks in your GOPATH."}], "owner": {"reputation": 450, "user_id": 2280009, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/70db53232bd99a02cf70fb7222e9cd09?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Le Gall", "link": "https://stackoverflow.com/users/2280009/s%c3%a9bastien-le-gall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1428320603, "creation_date": 1428320603, "question_id": 29470591, "link": "https://stackoverflow.com/questions/29470591/go-revel-using-importing-modified-version-of-package-an-external-package", "title": "Go / Revel : using / importing modified version of package an external package?", "body": "<p>Here is a thing I don't understand.</p>\n\n<p>I \"go get\" a go package on github. Then, I wanted to modify it. So, I forked it and change the name.</p>\n\n<p>Then, \"go get\" once more, with my new repo name.</p>\n\n<p>I changed my import lines and then : \"revel run\". My app was working. And since I removed all the older package files, I was sure my app was running my fork.</p>\n\n<p>But, if I just add this line : fmt.Println(\"executing: \", sqlStatement) the console / term will never show my sqlStatement or even the word \"executing\".</p>\n\n<p>However it does show the others \"fmt.Println\" that was already here in the original package.</p>\n\n<p>What did I do wrong?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 6, "last_activity_date": 1428320661, "creation_date": 1428320661, "answer_id": 29470610, "question_id": 29470466, "link": "https://stackoverflow.com/questions/29470466/how-the-shorthand-of-declaration-initialization-are-evaluated-in-go-lang/29470610#29470610", "title": "How the shorthand of declaration &amp; initialization are evaluated in go lang?", "body": "<p>See <a href=\"https://golang.org/ref/spec#Assignments\">here</a></p>\n\n<blockquote>\n  <p>The assignment proceeds in two phases. First, the operands of index\n  expressions and pointer indirections (including implicit pointer\n  indirections in selectors) on the left and the expressions on the\n  right are all evaluated in the usual order. Second, the assignments\n  are carried out in left-to-right order.</p>\n</blockquote>\n\n<p>Based on that a+b (0+1) is evaluated first. Then it's assigned. Thus you get the result of a = 1 and b = 1</p>\n"}], "owner": {"reputation": 18920, "user_id": 1933917, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7abf55dbb13da076d7a75637f22a74db?s=128&d=identicon&r=PG", "display_name": "Amol M Kulkarni", "link": "https://stackoverflow.com/users/1933917/amol-m-kulkarni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 1, "accepted_answer_id": 29470610, "answer_count": 1, "score": 6, "last_activity_date": 1428320661, "creation_date": 1428320062, "last_edit_date": 1428320430, "question_id": 29470466, "link": "https://stackoverflow.com/questions/29470466/how-the-shorthand-of-declaration-initialization-are-evaluated-in-go-lang", "title": "How the shorthand of declaration &amp; initialization are evaluated in go lang?", "body": "<p>The shorthand for declaration and initialization in go is </p>\n\n<pre><code>var a, b, c = 1 , 2, 3 \n</code></pre>\n\n<p>Equivalent to following way of declaration and initialization (as per <a href=\"http://golang.org/ref/spec#Variable_declarations\" rel=\"noreferrer\">specs</a>)</p>\n\n<ol>\n<li><p><code>a:=1 \n b:=2 \n c:=3</code></p></li>\n<li><p><code>var a int\n var b int \n var c int\n a=1 \n b=2 \n c=3</code></p></li>\n</ol>\n\n<p>But I am not getting the answer for the problem found in following code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var a int = 0\n    var b int = 1\n    fmt.Println(\"init a \",a)\n    fmt.Println(\"init b \",b)    \n\n    a, b = b, a+b\n    fmt.Println(\"printing a after `a, b = b, a+b`\",a) \n    fmt.Println(\"printing b after `a, b = b, a+b`\",b) \n\n}\n</code></pre>\n\n<p>Output should be:</p>\n\n<pre><code>printing a after 'a, b = b, a+b' 1 \nprinting b after 'a, b = b, a+b' 2 \n</code></pre>\n\n<p>Since the value of <code>b</code> is evaluated with <code>a + b</code> i.e <code>1+1</code> = 2. But its giving 1.</p>\n\n<p>Here is the playground links of both the working code where you can observe the difference. </p>\n\n<ul>\n<li><a href=\"https://play.golang.org/p/V6ZZMXnjQA\" rel=\"noreferrer\">a,b = b, a+b</a></li>\n<li><a href=\"https://play.golang.org/p/ihnZ10wg4z\" rel=\"noreferrer\">a=b, b=a+b</a></li>\n</ul>\n\n<p>I know I am missing something to understand, basically how the shorthand expression are evaluated especially when the same variable is involved in the expression.</p>\n\n<p>But where is the proper documentation to refer. Could anyone help on this?</p>\n"}, {"tags": ["go", "compilation", "executable"], "comments": [{"owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "edited": false, "score": 3, "creation_date": 1428315497, "post_id": 29468840, "comment_id": 47100351, "body": "You can look <a href=\"https://golang.org/cmd/go/#hdr-Compile_packages_and_dependencies\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-Compile_packages_and_dependencies</a> for details documentation and more available options."}], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1428316988, "post_id": 29468849, "comment_id": 47101013, "body": "Or just <code>go build</code> in the package you&#39;re in - provided you followed the conventions in <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a>"}], "tags": [], "owner": {"reputation": 9386, "user_id": 997813, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e917968317abb617b39d12613b1975a9?s=128&d=identicon&r=PG", "display_name": "Arjun Sreedharan", "link": "https://stackoverflow.com/users/997813/arjun-sreedharan"}, "is_accepted": true, "score": 2, "last_activity_date": 1428313716, "creation_date": 1428313716, "answer_id": 29468849, "question_id": 29468840, "link": "https://stackoverflow.com/questions/29468840/how-to-compile-a-program-in-go/29468849#29468849", "title": "How to compile a program in Go", "body": "<p>You want:</p>\n\n<pre><code>go build -o executable source.go\n</code></pre>\n"}], "owner": {"reputation": 7, "user_id": 4754006, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa68ea00550eb9bc94abf08c8769c9b9?s=128&d=identicon&r=PG&f=1", "display_name": "Makino", "link": "https://stackoverflow.com/users/4754006/makino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 29468849, "answer_count": 1, "score": -3, "last_activity_date": 1428313716, "creation_date": 1428313694, "question_id": 29468840, "link": "https://stackoverflow.com/questions/29468840/how-to-compile-a-program-in-go", "title": "How to compile a program in Go", "body": "<p>I know how to run a file in go using <code>go run file.go</code>, but I want to compile it to an executable.\nWhen I looked up, I found about <code>6g</code> and <code>6l</code> and it seems like they are outdated.</p>\n\n<p>I want something like:</p>\n\n<pre><code>go-compiler -o output file.go\n</code></pre>\n"}, {"tags": ["caching", "memory-management", "go", "mmap"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1428314802, "post_id": 29467899, "comment_id": 47100083, "body": "Elaborate on what kind of data/what kind of processing you need to do. If you don&#39;t actually need to run &quot;whole of data&quot; calculations, and/or can run calculations on sub-sets of the data and then aggregate the results, reading into a buffer, calculating/processing and then reading the next chunk of data is <i>probably</i> going to be better - e.g. <a href=\"https://github.com/djherbis/buffer\" rel=\"nofollow noreferrer\">github.com/djherbis/buffer</a>"}, {"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1428318169, "post_id": 29467899, "comment_id": 47101526, "body": "It&#39;s not for processing, it&#39;s a search engine. So lots and lots of random reads, very little or no writes after initial index creation."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428333813, "post_id": 29467899, "comment_id": 47109413, "body": "@Alasdair in that case what using a database engine of some kind? Depending on the kind of data and what you&#39;re trying to do to/with it 600 GB is small for a database and should cache in memory the a good chunk of the index(es) and very frequently accessed data."}, {"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1428338726, "post_id": 29467899, "comment_id": 47111928, "body": "It doesn&#39;t need to be in a database, any of the above options are preferable."}], "answers": [{"tags": [], "owner": {"reputation": 2911, "user_id": 702065, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/ae529fa78546d54e42c26bd3713946a2?s=128&d=identicon&r=PG", "display_name": "Johan Wikstr&#246;m", "link": "https://stackoverflow.com/users/702065/johan-wikstr%c3%b6m"}, "is_accepted": false, "score": 1, "last_activity_date": 1428440742, "creation_date": 1428440742, "answer_id": 29501292, "question_id": 29467899, "link": "https://stackoverflow.com/questions/29467899/go-best-way-to-handle-excessive-memory-application-mmap-memory-or-caching/29501292#29501292", "title": "Go: Best way to handle excessive memory application? Mmap, memory or caching?", "body": "<p>It all depends on the nature of the data access. Will the accesses to those 600GB be uniformly distributed? If that's not the case then a solution where you cache part of your content in memory and keep the rest of it on the HDD will likely be sufficient since you have enough RAM to cache more than 20% of your data. Keeping everything in virtual memory space may come with surprising drawbacks such as the need for a huge swap partition.</p>\n\n<p>To cache the data on disk you could use a DB engine as Dave suggests since they usually do a good job of caching the most frequently accessed content. You could also use <a href=\"https://github.com/bradfitz/gomemcache\" rel=\"nofollow\">memcached</a>, a library and client for caching stuff in memory.</p>\n\n<p>The bottom line is that optimizing performance without knowing the exact usage patterns is hard. Luckily, with Go you don't have to guess. You can test and measure. </p>\n\n<p>You can define an interface similar to </p>\n\n<pre><code>type Index interface{\n    Lookup(query string) Result\n}\n</code></pre>\n\n<p>And then try all of your solutions, starting with the easiest to implement.</p>\n\n<pre><code>type inMemoryIndex struct {...}\n\nfunc (*inMemoryIndex) Lookup(query string) Result {...}\n\ntype memcachedIndex struct {...}\n\ntype dbIndex struct {...}\n</code></pre>\n\n<p>Then you can use <a href=\"http://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go\" rel=\"nofollow\">Go's builtin benchmarking tools</a> to benchmark your application and see if it lives up to your standards. You can even benchmark on that machine, using real data and mocked user queries.</p>\n\n<p>You're correct to assume that mmap would require more coding so I would have saved that until I had tried all other options.</p>\n"}], "owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1428440742, "creation_date": 1428309308, "question_id": 29467899, "link": "https://stackoverflow.com/questions/29467899/go-best-way-to-handle-excessive-memory-application-mmap-memory-or-caching", "title": "Go: Best way to handle excessive memory application? Mmap, memory or caching?", "body": "<p>I have a Go application which requires around 600GB of memory. The machine on which is will run has 128GB of RAM. I'm trying to decide how best to handle this.</p>\n\n<p>The options are:</p>\n\n<ol>\n<li><p>Just load everything into the memory (pretend like I have 600GB RAM) and let the OS page out the infrequently accessed part of the memory into virtual memory. I like this idea because I don't have to do anything special in the code, the OS will just handle everything. However, I'm not sure this is a good idea.</p></li>\n<li><p>Have the data stored on disk and use mmap (memory mapped file) which I guess is similar to the above but will require a lot more coding. Also it appears to mean that the data will have to be stored as <code>[]byte</code> and then parsed every time I need to use it, rather that being already in whatever type I need it for the actual calculations.</p></li>\n<li><p>Build a caching system in which the data is kept on HDD and then loaded it when it's needed, with the most frequently accessed data being held in memory and the least frequently accessed data being purged whenever the memory limited is exceeded.</p></li>\n</ol>\n\n<p>What are the advantages and disadvantages with these? I'd prefer to go with (1) if possible due to its simplicity... is there anything wrong with that?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 4753532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ylhFHNc64MI/AAAAAAAAAAI/AAAAAAAACk0/0zrbsKGPTu8/photo.jpg?sz=128", "display_name": "Vincent Wang", "link": "https://stackoverflow.com/users/4753532/vincent-wang"}, "edited": false, "score": 0, "creation_date": 1428307977, "post_id": 29467103, "comment_id": 47097489, "body": "Thanks for the explanation! One more question, for struct type, GoLang has default implementation for stringer, if we implement an error interface, will it confuse the fmt.Println, wondering which interface to use?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1428334145, "post_id": 29467103, "comment_id": 47109586, "body": "Actually it is the other way around. <code>Error() string</code> is used before (in preference to) <code>String() error</code>."}, {"owner": {"reputation": 539, "user_id": 3665941, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zmBXz.jpg?s=128&g=1", "display_name": "Hamza Ouaghad", "link": "https://stackoverflow.com/users/3665941/hamza-ouaghad"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1505662392, "post_id": 29467103, "comment_id": 79494209, "body": "@DaveC Which is funny right? as if you define both <code>Error() string</code> there would be no use to define <code>String() string</code>, atleast not on a pointer to your type struct..."}], "tags": [], "owner": {"reputation": 1, "user_id": 4753631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59b07e595e20a59ce560b2ea50b2eb6e?s=128&d=identicon&r=PG", "display_name": "user4753631", "link": "https://stackoverflow.com/users/4753631/user4753631"}, "is_accepted": false, "score": 0, "last_activity_date": 1428305482, "last_edit_date": 1428305482, "creation_date": 1428304974, "answer_id": 29467103, "question_id": 29466918, "link": "https://stackoverflow.com/questions/29466918/golang-error-interface-mechanism/29467103#29467103", "title": "GoLang Error/Interface Mechanism", "body": "<p><code>fmt.Println</code> uses reflection to firstly check the type of the variable and if the type implements the <code>Stringer</code> interface then it calls the <code>String</code> method. Secondly if the type implements the <code>Error</code> interface it calls the <code>Error</code> method.</p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 4753532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ylhFHNc64MI/AAAAAAAAAAI/AAAAAAAACk0/0zrbsKGPTu8/photo.jpg?sz=128", "display_name": "Vincent Wang", "link": "https://stackoverflow.com/users/4753532/vincent-wang"}, "edited": false, "score": 0, "creation_date": 1428307402, "post_id": 29467242, "comment_id": 47097312, "body": "Thanks! I tested and yes."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 1, "last_activity_date": 1428305696, "creation_date": 1428305696, "answer_id": 29467242, "question_id": 29466918, "link": "https://stackoverflow.com/questions/29466918/golang-error-interface-mechanism/29467242#29467242", "title": "GoLang Error/Interface Mechanism", "body": "<p>Your code binds the Error() implementation to a pointer *MyError. </p>\n\n<p>In your code you are passing the type (a copy thereof to be precise) rather than a pointer.</p>\n\n<p>If you change </p>\n\n<pre><code>err1 := MyError{time.Now(), \"it works again\"}\n</code></pre>\n\n<p>to </p>\n\n<pre><code>err1 := &amp;MyError{time.Now(), \"it works again\"}\n</code></pre>\n\n<p>it will work as you expect.</p>\n"}], "owner": {"reputation": 13, "user_id": 4753532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ylhFHNc64MI/AAAAAAAAAAI/AAAAAAAACk0/0zrbsKGPTu8/photo.jpg?sz=128", "display_name": "Vincent Wang", "link": "https://stackoverflow.com/users/4753532/vincent-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1464, "favorite_count": 0, "accepted_answer_id": 29467242, "answer_count": 2, "score": 1, "last_activity_date": 1428309870, "creation_date": 1428304155, "last_edit_date": 1428309870, "question_id": 29466918, "link": "https://stackoverflow.com/questions/29466918/golang-error-interface-mechanism", "title": "GoLang Error/Interface Mechanism", "body": "<p>Firstly, I am not quite sure if this problem is more relevant to error, or to interface in GoLang</p>\n\n<p>I am catching up the GoLang by following the tutorial. The question came with this tutorial <a href=\"https://tour.golang.org/methods/8\" rel=\"nofollow\">page</a></p>\n\n<p>It is a basic demonstration of the error interface. When I change the code a bit like this, I got confused:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype MyError struct {\n    When time.Time\n    What string\n}\n\nfunc (e *MyError) Error() string {\n    return fmt.Sprintf (\"at %v, %s\", e.When, e.What)\n}\n\nfunc run() *MyError {\n    return &amp;MyError{\n        time.Now(), \"it didn't work\",\n    }\n}\n\nfunc main() {\n    if err := run(); err != nil {\n        fmt.Println(err)\n    }\n    err1 := MyError{time.Now(), \"it works again\"}\n    fmt.Println(err1)\n    fmt.Println(err1.Error())\n}\n</code></pre>\n\n<p>The output of this piece of code is:</p>\n\n<pre><code>at 2015-04-06 15:00:07.1541719 +0800 CST, it didn't work\n{2015-04-06 15:00:07.155172 +0800 CST it works again}\nat 2015-04-06 15:00:07.155172 +0800 CST, it works again\n</code></pre>\n\n<p>The thing confused me is under what condition the fmt will implicitly call MyError.Error() interface.</p>\n\n<p>To my understanding, the first and second fmt.Println() should have the same variable type: MyError. But obviously the first call involved an implicit call of Error() of the MyError type, while the second did not.</p>\n\n<p>What mechanism made this difference?</p>\n\n<p>Thanks for looking into this beginner's question!</p>\n"}, {"tags": ["web-applications", "go", "gorilla"], "comments": [{"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1428302653, "post_id": 29464914, "comment_id": 47095689, "body": "I think that space in your schema is actually your issue? <a href=\"http://golang.org/pkg/reflect/#StructTag\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#StructTag</a> . Check out <a href=\"http://play.golang.org/p/DIQ2XtC8C4\" rel=\"nofollow noreferrer\">this playground code</a> and add/remove that space"}, {"owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "reply_to_user": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1428340484, "post_id": 29464914, "comment_id": 47112902, "body": "It appears that when I change the input name field name=&quot;Username&quot; it works, but I&#39;m not exactly sure why though."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1428391547, "post_id": 29464914, "comment_id": 47131613, "body": "That makes sense though, your struct field is named Usename. It is finding it based off of that. Did you try the simple fix of just removing that space? ie <code>schema: &quot;name&quot;</code> --&gt; <code>schema:&quot;name&quot;</code>"}], "owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1101, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1428290576, "creation_date": 1428290576, "question_id": 29464914, "link": "https://stackoverflow.com/questions/29464914/getting-an-error-when-using-gorilla-schema", "title": "Getting an error when using Gorilla Schema", "body": "<p>I'm trying to use Gorilla's Schema decoder to read in all the post values from my form, but it's not working as expected. I get the schema: invalid path \"name\" error. </p>\n\n<p>My HTML looks something like this</p>\n\n<pre><code>&lt;form action=\"/register\" method=\"POST\"&gt;\n&lt;label&gt;Username&lt;/label&gt;\n&lt;input type=\"text\" name=\"name\" required&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>My logic for processing the registration form in Go looks something this:</p>\n\n<pre><code>err := r.ParseForm()\n    if err != nil {\n        log.Println(\"Form could not be parse\")\n                return\n    }\n\n    var regForm model.RegisterForm // Declare the registration form structure\n\n    decoder := schema.NewDecoder() // Creates a schema decoder\n    decoderr := decoder.Decode(&amp;regForm, r.PostForm)\n    if decoderr != nil {\n        log.Println(decoderr)\n                return\n    }\n    // More code goes here \n</code></pre>\n\n<p>My RegisterForm struct looks something like this: </p>\n\n<pre><code>type RegisterForm struct {\n    Username string            `schema: \"name\"`\n    Errors   map[string]string `schema: \"-\"`\n}\n</code></pre>\n\n<p>I looked at the docs, but I'm not sure how to match the values of the form properly with my struct. </p>\n"}, {"tags": ["http", "go", "channel"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428300548, "post_id": 29464686, "comment_id": 47095031, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/27236827/idiomatic-way-to-make-a-request-response-communication-using-channels\">Idiomatic way to make a request-response communication using channels</a>"}], "answers": [{"comments": [{"owner": {"reputation": 555, "user_id": 1367121, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/4a2c2d99085817b290619200cd1bf818?s=128&d=identicon&r=PG", "display_name": "Matthew Yang", "link": "https://stackoverflow.com/users/1367121/matthew-yang"}, "edited": false, "score": 0, "creation_date": 1428333432, "post_id": 29466215, "comment_id": 47109203, "body": "Thanks! This is actually what I did, but I was not sure if this is the right approach"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1428428782, "post_id": 29466215, "comment_id": 47154379, "body": "It is &#39;a&#39; right approach (but not the only one) and the obvious choice in this case. If you&#39;re mathematically interested, using channels is described by <a href=\"http://en.wikipedia.org/wiki/Communicating_sequential_processes\" rel=\"nofollow noreferrer\">CSP</a>, and exchange of channel-ends is covered by <a href=\"http://en.wikipedia.org/wiki/%CE%A0-calculus\" rel=\"nofollow noreferrer\">Pi Calculus</a>."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 2, "last_activity_date": 1428300523, "last_edit_date": 1495535052, "creation_date": 1428300523, "answer_id": 29466215, "question_id": 29464686, "link": "https://stackoverflow.com/questions/29464686/how-to-return-data-to-sender-of-a-channel/29466215#29466215", "title": "How to return data to sender of a channel", "body": "<p>See <a href=\"https://stackoverflow.com/a/27238300/55504\">this answer</a> as well.</p>\n\n<p>Channels are first class types in Go,\nyou can just include a \"response\" channel in the request itself.\nE.g.\u00a0something like:</p>\n\n<pre><code>type Request struct {\n    Input int\n    RespC chan *Responce\n}\n\ntype Response struct {\n    Result int\n    Err    error\n}\n</code></pre>\n\n<p>Service:</p>\n\n<pre><code>for req := range ReqC {\n    // start go routine or whatever\n    req.RespC &lt;- &amp;Result{Err: errors.New(\"not implemented\")}\n}\n</code></pre>\n\n<p>Requester:</p>\n\n<pre><code>c := make(chan *Response)\nReqC &lt;- &amp;Request{Input: 42, RespC: c}\nres := &lt;-c\n// check res.Err, use res.Result\n</code></pre>\n\n<p>Where <code>Request</code> and <code>Response</code> can contain whatever fields you need.\nIf the structs are small (like this example) use <code>chan Response</code> instead of <code>chan *Response</code> (and the same for <code>Request</code>).</p>\n"}], "owner": {"reputation": 555, "user_id": 1367121, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/4a2c2d99085817b290619200cd1bf818?s=128&d=identicon&r=PG", "display_name": "Matthew Yang", "link": "https://stackoverflow.com/users/1367121/matthew-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 1, "accepted_answer_id": 29466215, "answer_count": 1, "score": 1, "last_activity_date": 1428300523, "creation_date": 1428288575, "question_id": 29464686, "link": "https://stackoverflow.com/questions/29464686/how-to-return-data-to-sender-of-a-channel", "title": "How to return data to sender of a channel", "body": "<p>I am a Golang newbiew, and I am trying to implement an http server that synchronizes access to an ultra expensive computational (SAT) operation using a channel. </p>\n\n<p>So I'd have these concurrent requests coming in, they'd pass their data to a channel, and a processing goroutine would pick up the data from the channel and perform the expensive operation, but after its done, what is the best way to return the result to the sender so the sender can send the http response?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428290401, "post_id": 29464460, "comment_id": 47092686, "body": "If I understand the comment below, please edit the question (perhaps with example JSON input) to make clear that the input can have any key/value and not only &quot;Item1&quot; (e.g. it sounds like <code>{ &#47;*A&#39;s and B&#39;s *&#47;, &quot;somekey&quot;: &quot;someval&quot;, &quot;otherkey&quot;: 42 }</code> might be valid input."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1428301622, "post_id": 29464460, "comment_id": 47095358, "body": "Hey, I am not sure if you have seen this or if it is even helpful (which is why I am only writing a comment maybe someone stumbling upon this question will find this useful) but some great stuff about JSON and Go is covered in this talk: <a href=\"https://www.youtube.com/watch?v=YgnD27GFcyA\" rel=\"nofollow noreferrer\">youtube.com/watch?v=YgnD27GFcyA</a>  It seems you want to write your own Unmarshall for struct X as he discusses if I understand your question"}], "answers": [{"comments": [{"owner": {"reputation": 948, "user_id": 1715913, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b89674fac7de835c2e0d821b67531d85?s=128&d=identicon&r=PG", "display_name": "Kilise", "link": "https://stackoverflow.com/users/1715913/kilise"}, "edited": false, "score": 0, "creation_date": 1585758105, "post_id": 29465714, "comment_id": 107877080, "body": "Is there a way to do this without hardcoding &quot;things&quot; and &quot;thangs&quot;?"}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 1, "last_activity_date": 1428298522, "last_edit_date": 1428298522, "creation_date": 1428297228, "answer_id": 29465714, "question_id": 29464460, "link": "https://stackoverflow.com/questions/29464460/handling-nested-json-structs-with-custom-unmarshaller/29465714#29465714", "title": "Handling nested JSON structs with custom unmarshaller", "body": "<p>If I understand the problem correctly from your additional comment,\nthen input might contain <em>any</em> arbitrary extra fields with unknown names (and types?)\nand you want/need access to these.\nIf it's just for later re-marshalling then the <code>json.RawMessage</code> type would be of interest.</p>\n\n<p>Ideally <code>encoding/json</code> would have a special tag\n(like the <code>\",any\"</code> <code>encoding/xml</code> tag)\nthat would automatically collect any extra/unreferenced JSON items into either a\n<code>map[string]interface{}</code> or a <code>map[string]json.RawMessage</code> field.\nHowever I couldn't find any such feature nor figure out an obvious way to emulate it with anonymous structs (but I didn't try very hard).</p>\n\n<p>Edit: There is <a href=\"https://github.com/golang/go/issues/6213\" rel=\"nofollow\">an open issue in the Go project for this feature</a>. Apparently a change was submitted and partially reviewed around Go\u00a01.2 but ended up not getting accepted.</p>\n\n<p>Failing that, there are a couple of ways you can do exactly what you suggest,\nmake custom (un)marshaller for X and call back into the json package to handle <code>[]A</code> and <code>[]B</code>.</p>\n\n<p>Here is an example quickly thrown together,\nthere may be better/clearer/safer ways to do this.\n(Throughout this example, A and B can be arbitrarily complex, perhaps containing types that themselves have custom (un)marshalling methods.)</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype A struct {\n    AF1 string\n}\n\ntype B struct {\n    BF1 string\n}\n\ntype X struct {\n    Things []A\n    Thangs []B\n\n    // Or perhaps json.RawMessage if you just\n    // want to pass them through.\n    // Or map of string/int/etc if the value type is fixed.\n    Extra map[string]interface{}\n}\n\n// Marshal Way 1: call unmarshal twice on whole input\n\ntype xsub struct {\n    Things []A `json:\"things\"`\n    Thangs []B `json:\"thangs\"`\n}\n\nfunc (x *X) _UnmarshalJSON(b []byte) error {\n    // First unmarshall the known keys part:\n    var tmp xsub\n    if err := json.Unmarshal(b, &amp;tmp); err != nil {\n        return err\n    }\n\n    // Then unmarshall the whole thing again:\n    var vals map[string]interface{}\n    if err := json.Unmarshal(b, &amp;vals); err != nil {\n        return err\n    }\n\n    // Everything worked, chuck the map entries for\n    // \"known\" fields and store results.\n    delete(vals, \"things\")\n    delete(vals, \"thangs\")\n    x.Things = tmp.Things\n    x.Thangs = tmp.Thangs\n    x.Extra = vals\n    return nil\n}\n\n// Way 2:\n\nfunc (x *X) UnmarshalJSON(b []byte) error {\n    // Only partially decode:\n    var tmp map[string]json.RawMessage\n    if err := json.Unmarshal(b, &amp;tmp); err != nil {\n        return err\n    }\n\n    // Now handle the known fields:\n    var things []A\n    if err := json.Unmarshal(tmp[\"things\"], &amp;things); err != nil {\n        return err\n    }\n    var thangs []B\n    if err := json.Unmarshal(tmp[\"thangs\"], &amp;thangs); err != nil {\n        return err\n    }\n\n    // And the unknown fields.\n    var extra map[string]interface{}\n\n    // Either:\n    if true {\n        // this has more calls to Unmarshal, but may be more desirable\n        // as it completely skips over the already handled things/thangs.\n        delete(tmp, \"things\")\n        delete(tmp, \"thangs\")\n        // If you only needed to store the json.RawMessage for use\n        // in MarshalJSON then you'd just store \"tmp\" and stop here.\n\n        extra = make(map[string]interface{}, len(tmp))\n        for k, raw := range tmp {\n            var v interface{}\n            if err := json.Unmarshal(raw, &amp;v); err != nil {\n                return err\n            }\n            extra[k] = v\n        }\n    } else { // Or:\n        // just one more call to Unmarshal, but it will waste\n        // time with things/thangs again.\n        if err := json.Unmarshal(b, &amp;extra); err != nil {\n            return err\n        }\n        delete(extra, \"things\")\n        delete(extra, \"thangs\")\n    }\n\n    // no error, we can store the results\n    x.Things = things\n    x.Thangs = thangs\n    x.Extra = extra\n    return nil\n}\n\nfunc (x X) MarshalJSON() ([]byte, error) {\n    // abusing/reusing x.Extra, could copy map instead\n    x.Extra[\"things\"] = x.Things\n    x.Extra[\"thangs\"] = x.Thangs\n    result, err := json.Marshal(x.Extra)\n    delete(x.Extra, \"things\")\n    delete(x.Extra, \"thangs\")\n    return result, err\n}\n\nfunc main() {\n    inputs := []string{\n        `{\"things\": [], \"thangs\": []}`,\n\n        `\n{\n    \"things\": [\n    {\n        \"AF1\": \"foo\"\n    },\n    {\n        \"AF1\": \"bar\"\n    }\n    ],\n    \"thangs\": [\n        {\n            \"BF1\": \"string value\"\n        }\n    ],\n    \"xRandomKey\":       \"not known ahead of time\",\n    \"xAreValueTypesKnown\": 172\n}`,\n    }\n\n    for _, in := range inputs {\n        fmt.Printf(\"\\nUnmarshal(%q):\\n\", in)\n        var x X\n        err := json.Unmarshal([]byte(in), &amp;x)\n        if err != nil {\n            fmt.Println(\"unmarshal:\", err)\n        } else {\n            fmt.Printf(\"\\tas X: %+v\\n\", x)\n            fmt.Printf(\"\\twith map: %v\\n\", x.Extra)\n            out, err := json.Marshal(x)\n            if err != nil {\n                fmt.Println(\"marshal:\", err)\n                continue\n            }\n            fmt.Printf(\"\\tRemarshals to: %s\\n\", out)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/rbWLcSkSap\" rel=\"nofollow\"><kbd>Run on Playground</kbd></a></p>\n"}, {"tags": [], "owner": {"reputation": 948, "user_id": 1715913, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b89674fac7de835c2e0d821b67531d85?s=128&d=identicon&r=PG", "display_name": "Kilise", "link": "https://stackoverflow.com/users/1715913/kilise"}, "is_accepted": false, "score": 0, "last_activity_date": 1585778911, "last_edit_date": 1585778911, "creation_date": 1585764280, "answer_id": 60977450, "question_id": 29464460, "link": "https://stackoverflow.com/questions/29464460/handling-nested-json-structs-with-custom-unmarshaller/60977450#60977450", "title": "Handling nested JSON structs with custom unmarshaller", "body": "<p>As an additional answer for Dace C's answer.\nI wanted to achieve the same thing as you, however I wanted to reuse the function and not hardcode the values.</p>\n\n<p>This is what I made:</p>\n\n<pre><code>type DynamicFieldsUnmarshaller interface {\n    WithExtraFields(map[string]interface{})\n    Unmarshal([]byte) error\n}\n\ntype TestObject struct {\n    Name string `json:\"name\"`\n    CustomFields map[string]interface{} `json:\"-\"`\n}\n\nfunc (o *TestObject) Unmarshal(data []byte) error {\n    return UnmarshalCustomJSON(data,o)\n}\n\nfunc (o *TestObject) WithExtraFields(f map[string]interface{}) {\n    o.CustomFields = f\n}\n\nfunc UnmarshalCustomJSON(b []byte, o DynamicFieldsUnmarshaller) error {\n    if err := json.Unmarshal(b, &amp;o); err != nil {\n        return err\n    }\n\n    // unmarshal everything to a map\n    var vals map[string]interface{}\n    if err := json.Unmarshal(b, &amp;vals); err != nil {\n        return err\n    }\n\n    if len(vals)== 0 {\n        return nil\n    }\n\n    fields := reflect.TypeOf(o).Elem()\n    num := fields.NumField()\n    for i := 0; i &lt; num; i++ {\n        field := fields.Field(i)\n        jsonTag := field.Tag.Get(\"json\")\n        if jsonTag != \"\" &amp;&amp; jsonTag != \"-\" {\n            delete(vals, jsonTag)\n        }\n    }\n\n    o.WithExtraFields(vals)\n\n    return nil\n}\n</code></pre>\n\n<p>This should only add values not in the struct to the <code>map[string]interface{}</code> field.</p>\n\n<p>For instance:</p>\n\n<pre><code>   body := []byte(`\n        {\n            \"name\":\"kilise\",\n            \"age\": 40\n        }\n    `)\n\n    var dto TestObject\n    err := dto.Unmarshal(body)\n    if err != nil {\n        panic(err)\n    }\n</code></pre>\n\n<p>Would only add \"age\" to dto.CustomFields map.</p>\n\n<p><em>Note this solution might not always be the best, since it's not implementing json.Unmarshaler</em></p>\n"}], "owner": {"reputation": 13, "user_id": 4752973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/039361de8699339dbe76e8386eaf9ada?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/4752973/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1083, "favorite_count": 0, "accepted_answer_id": 29465714, "answer_count": 2, "score": 1, "last_activity_date": 1585778911, "creation_date": 1428286242, "question_id": 29464460, "link": "https://stackoverflow.com/questions/29464460/handling-nested-json-structs-with-custom-unmarshaller", "title": "Handling nested JSON structs with custom unmarshaller", "body": "<p>I'm dealing with a legacy system that's returning JSON with nested structs and some optional fields (and in random order). Something like this:</p>\n\n<pre><code>type A struct {\n    /* simple struct, can be unmarshalled normally */\n    AF1 string `json:\"AF1\"`\n}\n\ntype B struct {\n    /* simple struct, can be unmarshalled normally */\n    BF1 string `json:\"BF1\"`\n}\n\ntype X struct {\n    Things []A `json:\"things\"` /* mandatory */\n    Thangs []B `json:\"thangs\"` /* mandatory */\n    /* some individual string values may or may not appear, eg:\n    Item1 string\n    Item2 string\n    */         \n}\n</code></pre>\n\n<p>If Item[12] do appear, I want to stash them in a map or similar. </p>\n\n<p>Is there any elegant way to unmarshal X? Is there some way to write a custom UnmarshalJSON func for X (to handle option string fields), and then hand off to the default JSON unmarshaller for A and B? </p>\n"}, {"tags": ["arrays", "json", "parsing", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1428280328, "post_id": 29463791, "comment_id": 47090797, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/15452004/my-structures-are-not-marshalling-into-json\">My structures are not marshalling into json</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1428289955, "post_id": 29463791, "comment_id": 47092599, "body": "<b>Never</b> ignore errors (e.g. from <code>Decode</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 4752823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77878be264c5a43679fec42d9b18ef42?s=128&d=identicon&r=PG&f=1", "display_name": "BBBIan", "link": "https://stackoverflow.com/users/4752823/bbbian"}, "edited": false, "score": 0, "creation_date": 1428355327, "post_id": 29464081, "comment_id": 47120434, "body": "Thank you for the answer. I can read the file and its in the Array and map.  I have questions/challenge with the solution:  1. The file is an extract and has 15,000 + Objs; hence, the file is about 50 meg. I dont want to read the whole file into the memory before doing anything with it. So, how would I read it one obj at a time?   Thank you Again."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 31, "user_id": 4752823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77878be264c5a43679fec42d9b18ef42?s=128&d=identicon&r=PG&f=1", "display_name": "BBBIan", "link": "https://stackoverflow.com/users/4752823/bbbian"}, "edited": false, "score": 0, "creation_date": 1428355632, "post_id": 29464081, "comment_id": 47120598, "body": "@BBBIan: this answer might help - <a href=\"http://stackoverflow.com/questions/29421470/how-to-parse-an-infinite-json-array-from-stdin-in-go/29425099#29425099\" title=\"how to parse an infinite json array from stdin in go\">stackoverflow.com/questions/29421470/&hellip;</a>"}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1428282466, "creation_date": 1428282466, "answer_id": 29464081, "question_id": 29463791, "link": "https://stackoverflow.com/questions/29463791/golang-reading-an-array-of-json-objects/29464081#29464081", "title": "Golang Reading an Array of Json objects", "body": "<pre><code>// Parse the JSON.\nvar objs interface{}\njson.Unmarshal([]byte(jsonStr), &amp;objs) // Or use json.Decoder.Decode(...)\n\n// Ensure that it is an array of objects.\nobjArr, ok := objs.([]interface{})\nif !ok {\n    log.Fatal(\"expected an array of objects\")\n}\n\n// Handle each object as a map[string]interface{}.\nfor i, obj := range objArr {\n    obj, ok := obj.(map[string]interface{})\n    if !ok {\n        log.Fatalf(\"expected type map[string]interface{}, got %s\", reflect.TypeOf(objArr[i]))\n    }\n    fmt.Printf(\"i=%d, o=%T\\n\", i, obj) // Do something with the object...\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 4752823, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77878be264c5a43679fec42d9b18ef42?s=128&d=identicon&r=PG&f=1", "display_name": "BBBIan", "link": "https://stackoverflow.com/users/4752823/bbbian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2267, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1428282466, "creation_date": 1428279756, "question_id": 29463791, "link": "https://stackoverflow.com/questions/29463791/golang-reading-an-array-of-json-objects", "title": "Golang Reading an Array of Json objects", "body": "<p>I am using GoLang and want to read the file and be able to send each json object to a REST Endpoint.</p>\n\n<p>the REST endpoint aside, I am having issues parsing the file.</p>\n\n<pre><code>  package main\n\n    import (\n        \"encoding/json\"\n        \"fmt\"\n        \"io/ioutil\"\n        \"bytes\"\n        \"os\"\n    )\n\n    func main() {\n        type myjson struct {\n            myobjects []struct {\n                data map[string]string\n            }\n        }\n        file, e := ioutil.ReadFile(\"dat_one_extract.json\")\n        if e != nil {\n            fmt.Printf(\"File Error: [%v]\\n\", e)\n            os.Exit(1)\n        }\n\n        dec := json.NewDecoder(bytes.NewReader(file))\n        var d myjson\n        dec.Decode(&amp;d)\n\n\n    }\n</code></pre>\n\n<p>My Json file looks like this:</p>\n\n<pre><code>[{\n     \"NAME1\": \"Y\",\n    \"NAME2\": 1729.0,\n    \"NAME3\": \"Y\",\n    \"NAME4\": [\n        {\n             \"Contact Zip\": \"33619\",\n            \"Date of Contact\": \"01/21/2015\"\n        }\n    ],\n     \"NAME6\": \"123456789\",\n    \"NAME7\": \"Walmart\",\n    \"NAME8\": [\n        {\n            \"State\": \"xx\",\n            \"Zip Code\": \"12345\",\n            \"Address\": \"12345 main street\",\n            \"Type\": \"MAILING\",\n            \"City\": \"MyTown\"\n        },\n        {\n            \"State\": \"xx\",\n            \"Zip Code\": \"12345\",\n            \"Address\": \"12345 main street\",\n            \"Type\": \"MAILING\",\n            \"City\": \"MyTown\"\n        },\n        {\n            \"State\": \"xx\",\n            \"Zip Code\": \"12345\",\n            \"Address\": \"12345 main street\",\n            \"Type\": \"MAILING\",\n            \"City\": \"MyTown\"\n        }\n    ],\n    \"NAME11\": \"XXXXXXX\",\n    \"NAME12\": \"11/21/2014 14:01:47\",\n    \"NAME13\": \"11/15/2014\",\n    \"NAME14\": \"11/16/1992\"\n},{\n    \"NAME1\": \"Y\",\n    \"NAME2\": 1729.0,\n    \"NAME3\": \"Y\",\n    \"NAME4\": [\n        {\n             \"Contact Zip\": \"33619\",\n            \"Date of Contact\": \"01/21/2015\"\n        }\n    ],\n     \"NAME6\": \"123456789\",\n    \"NAME7\": \"Walmart\",\n    \"NAME8\": [\n        {\n            \"State\": \"xx\",\n            \"Zip Code\": \"12345\",\n            \"Address\": \"12345 main street\",\n            \"Type\": \"MAILING\",\n            \"City\": \"MyTown\"\n        },\n        {\n            \"State\": \"xx\",\n            \"Zip Code\": \"12345\",\n            \"Address\": \"12345 main street\",\n            \"Type\": \"MAILING\",\n            \"City\": \"MyTown\"\n        },\n        {\n            \"State\": \"xx\",\n            \"Zip Code\": \"12345\",\n            \"Address\": \"12345 main street\",\n            \"Type\": \"MAILING\",\n            \"City\": \"MyTown\"\n        }\n    ],\n    \"NAME11\": \"XXXXXXX\",\n    \"NAME12\": \"11/21/2014 14:01:47\",\n    \"NAME13\": \"11/15/2014\",\n    \"NAME14\": \"11/16/1992\"\n}]\n</code></pre>\n\n<p>What am I missing to access each array element and pass it to the end point?\nI don't want to process the elements, just send the json object to the endpoint 1 at time.</p>\n\n<p>Thank you in advance and apologies for being a golang noob!</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2917, "user_id": 1676890, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9nfzW.jpg?s=128&g=1", "display_name": "Ryan", "link": "https://stackoverflow.com/users/1676890/ryan"}, "edited": false, "score": 7, "creation_date": 1449703636, "post_id": 29463021, "comment_id": 56128301, "body": "+1 for the answer. Should declare err separately or else db variable will be come local other function that tried to use db connection will receive &quot;PANIC: runtime error: invalid memory address or nil pointer dereference&quot; error"}, {"owner": {"reputation": 1287, "user_id": 3048381, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1565561460/picture?type=large", "display_name": "MisterCat", "link": "https://stackoverflow.com/users/3048381/mistercat"}, "edited": false, "score": 0, "creation_date": 1548664378, "post_id": 29463021, "comment_id": 95606910, "body": "hey, do you know why we should use pointer here? insetead just var db sql.DB"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1548682994, "post_id": 29463021, "comment_id": 95617025, "body": "Yes, because <code>*sql.DB</code> represents a pool, and using a value will cause it to be copied when passed around. This will result in internal state being incorrect - idle connections untracked, etc."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 34, "last_activity_date": 1428274745, "last_edit_date": 1428274745, "creation_date": 1428273662, "answer_id": 29463021, "question_id": 29462940, "link": "https://stackoverflow.com/questions/29462940/storing-database-connection-in-a-global-variable/29463021#29463021", "title": "Storing database connection in a global variable", "body": "<p>You need to qualify the name of the type with the package name:</p>\n\n<pre><code>import(\n    \"database/sql\"\n    \"github.com/go-sql-driver/mysql\"\n)\n\nvar db *sql.DB // Note the sql package provides the namespace\n\nfunc main() {\n    var err error\n    // Make sure not to shadow your global - just assign with = - don't initialise a new variable and assign with :=\n    db, err = sql.Open(...)\n    if err != nil {\n        // Handle the error!\n    }\n\n }\n</code></pre>\n\n<p>Whether you want to have a global (easy to get started) or pass it around explicitly is up to you, but I'd suggest just keeping it simple for now. If this is going into a web application, you can safely share the <code>*sql.DB</code> connection pool across handlers/requests.</p>\n"}], "owner": {"reputation": 1338, "user_id": 1772510, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/507de10a282f571a93a2ad2193b5b9e0?s=128&d=identicon&r=PG", "display_name": "dreadiscool", "link": "https://stackoverflow.com/users/1772510/dreadiscool"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10455, "favorite_count": 1, "closed_date": 1575484134, "accepted_answer_id": 29463021, "answer_count": 1, "score": 17, "last_activity_date": 1428274745, "creation_date": 1428272952, "question_id": 29462940, "link": "https://stackoverflow.com/questions/29462940/storing-database-connection-in-a-global-variable", "closed_reason": "Duplicate", "title": "Storing database connection in a global variable", "body": "<p>I'm using the MySQL driver for Golang provided here</p>\n\n<p><a href=\"https://github.com/go-sql-driver/mysql\" rel=\"noreferrer\">https://github.com/go-sql-driver/mysql</a></p>\n\n<p>One of the things I'm trying to do is store the database variable in a global connection. According to the documentation, sql.Open() is supposed to return a pointer to a DB struct, so I tried storing it as</p>\n\n<pre><code>var db *DB\n</code></pre>\n\n<p>However, that resulted in the error</p>\n\n<pre><code>undefined: DB\n</code></pre>\n\n<p>The next thing I tried was to look at the source code for the MySQL driver, and I found a snippet of code here <a href=\"https://github.com/go-sql-driver/mysql/blob/master/driver.go\" rel=\"noreferrer\">https://github.com/go-sql-driver/mysql/blob/master/driver.go</a></p>\n\n<pre><code>func (d MySQLDriver) Open(dsn string) (driver.Conn, error) {\n</code></pre>\n\n<p>So, I tried to save the variable as driver.Conn - however, I was unable to (incorrect imports). I wasn't able to import driver either.</p>\n\n<p>The last thing I tried was to use reflect to bring the name of the variable to light</p>\n\n<pre><code>package main\n\n    import (\n        \"fmt\"\n        \"reflect\"\n)\n\nimport \"database/sql\"\nimport _ \"github.com/go-sql-driver/mysql\"\n\nfunc main() {\n        db, _ := sql.Open(\"mysql\", \"root:password@/Tracker\")\n        yt := reflect.TypeOf(db).Kind()\n        fmt.Printf(\"%T: %s\\n\", yt, yt)\n}\n</code></pre>\n\n<p>Unfortunately, that didn't work either - it shows up as pointer, and not the type of variable it's actually pointing to.</p>\n\n<p>I'm at a loss as to how to figure it out now. Thanks in advance for your help!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "edited": false, "score": 0, "creation_date": 1428271120, "post_id": 29461379, "comment_id": 47088925, "body": "tvblah, thanks for the answer, do you know if there&#39;s a way to pass multiple variables to the template? The 2nd solution below only allows me to pass the slice, what if i have other variables I&#39;d like to pass to the template, how would I go about doing that?"}], "answers": [{"tags": [], "owner": {"reputation": 196, "user_id": 4752457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3e44ad3132013d9ea4ed720bb5ee4a?s=128&d=identicon&r=PG", "display_name": "user4752457", "link": "https://stackoverflow.com/users/4752457/user4752457"}, "is_accepted": true, "score": 7, "last_activity_date": 1428285589, "last_edit_date": 1428285589, "creation_date": 1428263237, "answer_id": 29461506, "question_id": 29461379, "link": "https://stackoverflow.com/questions/29461379/golang-range-through-slice-and-generate-html-table/29461506#29461506", "title": "Golang: range through slice and generate HTML table", "body": "<p>Here's one way to create a table:</p>\n\n<pre><code>var tmpl = `&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;`\nfmt.Printf(\"&lt;table&gt;\")\nnames := []string{\"john\", \"jim\"}\nfor _, v := range names {\n      fmt.Printf(tmpl, v)\n}\nfmt.Printf(\"&lt;/table&gt;\")\n</code></pre>\n\n<p>You can also use the html/template package:</p>\n\n<pre><code>t := template.Must(template.New(\"\").Parse(`&lt;table&gt;{{range .}}&lt;tr&gt;&lt;td&gt;{{.}}&lt;/td&gt;&lt;/tr&gt;{{end}}&lt;/table&gt;`))\nnames := []string{\"john\", \"jim\"}\nif err := t.Execute(os.Stdout, names); err != nil {\n  log.Fatal(err)\n}\n</code></pre>\n\n<p>I do not have enough juice to answer the question in OP's comment above, so I'll answer it here.</p>\n\n<p>A template takes a single argument. If you want to pass multiple values to a template, then create a struct to hold the values:</p>\n\n<pre><code> var data struct{ \n    A int\n    Names []string\n }{\n    1,\n    []string{\"john\", \"jim\"},\n }\n if err := t.Execute(os.Stdout, &amp;data); err != nil {\n   log.Fatal(err)\n }\n</code></pre>\n\n<p>Use {{.A}} and {{.Name}} in the template.</p>\n"}], "owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5727, "favorite_count": 2, "accepted_answer_id": 29461506, "answer_count": 1, "score": 4, "last_activity_date": 1428285589, "creation_date": 1428262457, "question_id": 29461379, "link": "https://stackoverflow.com/questions/29461379/golang-range-through-slice-and-generate-html-table", "title": "Golang: range through slice and generate HTML table", "body": "<p>I have a string slice, I'd like to range through the slice and create a simple HTML table with the values. This is some sample code to illustrate:</p>\n\n<pre><code>var tmpl = `&lt;td&gt;%s&lt;/td&gt;`\nnames := []string{\"john\", \"jim\"}\n    for _, v := range names {\n      fmt.Printf(tmpl, v)\n    }\n</code></pre>\n\n<p>This produces: </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;td&gt;john&lt;/td&gt;&lt;td&gt;jim&lt;/td&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>I'd like to take what's returned and create a HTML table or at least be able to pass it to another HTML template that has the table structure. Any ideas how this can be done?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 12786, "user_id": 499125, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1e0971e368bdad6e495b2eafcdeb7796?s=128&d=identicon&r=PG", "display_name": "Some Noob Student", "link": "https://stackoverflow.com/users/499125/some-noob-student"}, "edited": false, "score": 0, "creation_date": 1428271808, "post_id": 29461277, "comment_id": 47089077, "body": "Does this mean every time I call Read() a new SecureReader would be passed in? Why would io.Reader impose such an awkward restriction?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 12786, "user_id": 499125, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1e0971e368bdad6e495b2eafcdeb7796?s=128&d=identicon&r=PG", "display_name": "Some Noob Student", "link": "https://stackoverflow.com/users/499125/some-noob-student"}, "edited": false, "score": 1, "creation_date": 1428272252, "post_id": 29461277, "comment_id": 47089179, "body": "@SomeNoobStudent an interface includes a pointer to the data, so copying an interface isn&#39;t a big deal. Copying a struct, in other hand, is, as it prevents mutability."}, {"owner": {"reputation": 12786, "user_id": 499125, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1e0971e368bdad6e495b2eafcdeb7796?s=128&d=identicon&r=PG", "display_name": "Some Noob Student", "link": "https://stackoverflow.com/users/499125/some-noob-student"}, "edited": false, "score": 0, "creation_date": 1428272451, "post_id": 29461277, "comment_id": 47089232, "body": "OH! How enlightening! Thank you so much! Showering you with upvotes."}, {"owner": {"reputation": 5184, "user_id": 1935631, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0e4d0d6c5ce5e9350cacc818ee350347?s=128&d=identicon&r=PG", "display_name": "Sassa NF", "link": "https://stackoverflow.com/users/1935631/sassa-nf"}, "edited": false, "score": 0, "creation_date": 1546251570, "post_id": 29461277, "comment_id": 94809657, "body": "Is it possible for some methods to have a reference as the receiver, and others to have an instance? I mean, if I need a struct to implement a certain interface, then some methods may be &quot;read&quot;, and others may be &quot;write&quot;. If this is not possible, having instance methods would appear like a really bizarre language feature."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1546252470, "post_id": 29461277, "comment_id": 94809988, "body": "I think it is technically possible, but consistency is key."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1428261772, "creation_date": 1428261772, "answer_id": 29461277, "question_id": 29461227, "link": "https://stackoverflow.com/questions/29461227/what-is-the-difference-between-pointer-and-value-receiver-types/29461277#29461277", "title": "What is the difference between Pointer and Value receiver types?", "body": "<p>A value receiver operates on a <em>copy</em> of the <code>SecureReader</code> instance <code>s</code>.</p>\n\n<p>If the method mutates any part of the <em>copy</em> of the instance (like modify <code>s.decrypted</code>), it is not visible on the original instance of the receiver, once the method exit.</p>\n\n<p>That changes with a pointer receiver, where the method operates and can mutates the actual <code>SecureReader</code> instance <code>s</code>, since a <em>copy</em> of the pointer is passed to the method.</p>\n\n<hr>\n\n<p>See more examples in \"<a href=\"http://nathanleclaire.com/blog/2014/08/09/dont-get-bitten-by-pointer-vs-non-pointer-method-receivers-in-golang/\" rel=\"nofollow\">Don't Get Bitten by Pointer vs Non-Pointer Method Receivers in Golang</a>\".</p>\n\n<blockquote>\n  <p>Simply stated: you can treat the receiver as if it was an argument being passed to the method. All the same reasons why you might want to pass by value or pass by reference apply.</p>\n  \n  <p>Reasons why you would want to pass by reference as opposed to by value:</p>\n  \n  <ul>\n  <li>You want to actually modify the receiver (\u201cread/write\u201d as opposed to just \u201cread\u201d)</li>\n  <li>The struct is very large and a deep copy is expensive</li>\n  <li>Consistency: if some of the methods on the struct have pointer receivers, the rest should too. This allows predictability of behavior</li>\n  </ul>\n  \n  <p>If you need these characteristics on your method call, use a pointer receiver.</p>\n</blockquote>\n"}], "owner": {"reputation": 12786, "user_id": 499125, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1e0971e368bdad6e495b2eafcdeb7796?s=128&d=identicon&r=PG", "display_name": "Some Noob Student", "link": "https://stackoverflow.com/users/499125/some-noob-student"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 1, "accepted_answer_id": 29461277, "answer_count": 1, "score": 3, "last_activity_date": 1428261772, "creation_date": 1428261455, "question_id": 29461227, "link": "https://stackoverflow.com/questions/29461227/what-is-the-difference-between-pointer-and-value-receiver-types", "title": "What is the difference between Pointer and Value receiver types?", "body": "<p>I was writing a program that reads data from a io.Reader and caches them in a bytes.Buffer.</p>\n\n<pre><code>type SecureReader struct {\n    pipe      io.Reader\n    shared    *[32]byte\n    decrypted bytes.Buffer\n}\n\nfunc (s SecureReader) Read(b []byte) (int, error) {\n    s.decryptPipeIntoBuffer()\n    return s.decrypted.Read(b)\n}\n\nfunc (s SecureReader) decryptPipeIntoBuffer() (int, error) {/*Lots of code...*/}\n</code></pre>\n\n<p>I first used a value receiver, because I thought they were the same. However, I noticed my method does not do anything when invoked: SecureReader.Read() would always return io.EOF.</p>\n\n<p>I banged my head around and changed the receiver type to</p>\n\n<pre><code>func (s *SecureReader) decryptPipeIntoBuffer() (int, error) {/*Lots of code...*/}\n</code></pre>\n\n<p>Now my code magically works. What is going on?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2914, "user_id": 1162491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S3MH1.jpg?s=128&g=1", "display_name": "Momer", "link": "https://stackoverflow.com/users/1162491/momer"}, "edited": false, "score": 1, "creation_date": 1428241946, "post_id": 29457856, "comment_id": 47080138, "body": "Instead of trying to bubble the panic up, why not send an error through the channel and handle it in the main goroutine?"}, {"owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "reply_to_user": {"reputation": 2914, "user_id": 1162491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S3MH1.jpg?s=128&g=1", "display_name": "Momer", "link": "https://stackoverflow.com/users/1162491/momer"}, "edited": false, "score": 0, "creation_date": 1428247254, "post_id": 29457856, "comment_id": 47081683, "body": "@Momer I have tried it but have error <code>all goroutines are asleep - deadlock</code>, please see my update above."}, {"owner": {"reputation": 13778, "user_id": 2331953, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/44369565060ca0609f3f7f9f3b46f4a6?s=128&d=identicon&r=PG", "display_name": "flx", "link": "https://stackoverflow.com/users/2331953/flx"}, "edited": false, "score": 0, "creation_date": 1428251249, "post_id": 29457856, "comment_id": 47082866, "body": "the second write (in your recover) blocks because nobody is there to read from the channels. you&#39;re about to write into them multiple times, but read only once."}, {"owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "reply_to_user": {"reputation": 13778, "user_id": 2331953, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/44369565060ca0609f3f7f9f3b46f4a6?s=128&d=identicon&r=PG", "display_name": "flx", "link": "https://stackoverflow.com/users/2331953/flx"}, "edited": false, "score": 0, "creation_date": 1428252838, "post_id": 29457856, "comment_id": 47083346, "body": "@flx why write multiple times? I write once in <code>chanErr</code> and once in <code>chanStr</code> in second recovery block: <code>chanErr &lt;- err \t\t\t\tchanStr &lt;- &quot;&quot;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 13778, "user_id": 2331953, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/44369565060ca0609f3f7f9f3b46f4a6?s=128&d=identicon&r=PG", "display_name": "flx", "link": "https://stackoverflow.com/users/2331953/flx"}, "is_accepted": false, "score": 1, "last_activity_date": 1428330670, "creation_date": 1428330670, "answer_id": 29473326, "question_id": 29457856, "link": "https://stackoverflow.com/questions/29457856/pass-recovery-to-upper-goroutine-golang/29473326#29473326", "title": "pass recovery to upper goroutine golang", "body": "<p>In your updated question, one thread is blocked by reading from <code>chanStr</code> while the other thread is blocked by writing into <code>chanErr</code>.\nSwitching the order of writes should resolve the deadlock.</p>\n\n<pre><code>defer func() {\n    if r := recover(); r != nil {\n        fmt.Println(\"internal goroutine paniced:\", r)\n        switch t := r.(type) {\n        case string:\n            fmt.Println(\"err is string\")\n            err = errors.New(t)\n        case error:\n            fmt.Println(\"err is error\")\n            err = t\n        default:\n            fmt.Println(\"err is unknown\")\n            err = errors.New(\"Unknown error\")\n        }\n        chanStr &lt;- \"\"\n        chanErr &lt;- err\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 981288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/814457e5ff613ac633852cb6a2b97216?s=128&d=identicon&r=PG", "display_name": "Hao Ding", "link": "https://stackoverflow.com/users/981288/hao-ding"}, "is_accepted": false, "score": 2, "last_activity_date": 1492103531, "last_edit_date": 1492103531, "creation_date": 1453370266, "answer_id": 34920474, "question_id": 29457856, "link": "https://stackoverflow.com/questions/29457856/pass-recovery-to-upper-goroutine-golang/34920474#34920474", "title": "pass recovery to upper goroutine golang", "body": "<p>I took panic/recover in golang as try/catch/final blocks in java or c++.</p>\n\n<p>For more detail, you can visit <a href=\"https://golang.org/ref/spec#Handling_panics\" rel=\"nofollow noreferrer\">Handling panics (from Golang spec)</a>.</p>\n\n<p>so you can pass a panic to method's caller. \na simple code is below, hope it helps </p>\n\n<p>Note: in function Foo(), I use recover() to catch things going wrong, and then re-panic in order to catch it later in outer caller.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc Foo() {\n    defer func() {\n        if x := recover(); x != nil {\n            fmt.Printf(\"Runtime panic: %v \\n\", x)\n            panic(\"Ah oh ... Panic in defer\")\n        }\n    }()\n    panic(\"Panic in Foo() !\")\n}\n\nfunc Game() {\n    defer func(){\n        fmt.Println(\"Clean up in Game()\")\n    }()\n\n    defer func() {\n        if x := recover(); x != nil {\n            fmt.Println(\"Catch recover panic !!! In Game()\")\n        }\n    }()\n    Foo()\n\n}\n\nfunc main() {\n\n    defer func() {\n        fmt.Println(\"Program Quit ... \")\n    }()\n\n    fmt.Println(\"-----------Split-------------\")\n    go Game()\n    time.Sleep(1 * time.Millisecond)\n    fmt.Println(\"-----------Split-------------\")\n}\n</code></pre>\n"}], "owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6078, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1492103531, "creation_date": 1428240976, "last_edit_date": 1592644375, "question_id": 29457856, "link": "https://stackoverflow.com/questions/29457856/pass-recovery-to-upper-goroutine-golang", "title": "pass recovery to upper goroutine golang", "body": "<p>I created an example where I  run function concurrently inside which I panic and recover:</p>\n<pre><code>package main\n\nimport &quot;fmt&quot;\n\nfunc main() {\n    // &quot;main&quot; recovery\n    defer func() {\n        if r := recover(); r != nil {\n            fmt.Println(&quot;main goroutine paniced:&quot;, r)\n        }\n    }()\n\n    // running function concurrently inside which I panic\n    chanStr := make(chan string)\n    go func() {\n        // this &quot;internal&quot; goroutin recovery\n        defer func() {\n            if r := recover(); r != nil {\n                fmt.Println(&quot;internal goroutine paniced:&quot;, r)\n            }\n            chanStr &lt;- &quot;hello world&quot;\n        }()\n        // panicking and wanting recovery not only in &quot;internal&quot; recovery but in &quot;main&quot; recovery as well\n        panic(&quot;NOT main goroutine&quot;)\n    }()\n    // waiting for chan with &quot;internal&quot; goroutine panicking and recovery\n    str := &lt;-chanStr\n    fmt.Println(str)\n\n    // panic(&quot;main&quot;)\n}\n</code></pre>\n<p>It gives output:</p>\n<pre><code>internal goroutine panicked: NOT main goroutine\nhello world\n</code></pre>\n<p>Is it possible to change my code to make pass recovery from &quot;internal&quot; to &quot;main&quot;? In other words I want it to write down to console:</p>\n<pre><code>internal goroutine paniced: NOT main goroutine\nmain goroutine paniced: main\nhello world\n</code></pre>\n<p>I tried to implement this by removing &quot;internal&quot; recovery func at all, but &quot;main&quot; recovery do not recover panic inside &quot;internal&quot; goroutine in this case.</p>\n<p><a href=\"https://play.golang.org/p/MXKSUZVzRr\" rel=\"nofollow noreferrer\">Playground</a></p>\n<h1>Update</h1>\n<p>I tried to follow @Momer's advice and  send an error through the channel and handle it in the main goroutine, instead of trying to bubble the panic up:</p>\n<pre><code>package main\n\nimport (\n    &quot;errors&quot;\n    &quot;fmt&quot;\n)\n\nfunc main() {\n    // &quot;main&quot; recovery\n    defer func() {\n        if r := recover(); r != nil {\n            fmt.Println(&quot;main goroutine paniced:&quot;, r)\n        }\n    }()\n\n    // running func concarantly inside which I panic\n    chanStr := make(chan string)\n    chanErr := make(chan error)\n    var err error\n    go func() {\n        // this &quot;internal&quot; goroutin recovery\n        defer func() {\n            if r := recover(); r != nil {\n                fmt.Println(&quot;internal goroutine paniced:&quot;, r)\n                switch t := r.(type) {\n                case string:\n                    fmt.Println(&quot;err is string&quot;)\n                    err = errors.New(t)\n                case error:\n                    fmt.Println(&quot;err is error&quot;)\n                    err = t\n                default:\n                    fmt.Println(&quot;err is unknown&quot;)\n                    err = errors.New(&quot;Unknown error&quot;)\n                }\n\n                chanErr &lt;- err\n                chanStr &lt;- &quot;&quot;\n            }\n        }()\n        // panicing and wanting recovery not only in &quot;internal&quot; recovery but in &quot;main&quot; recovery as well\n        panic(&quot;NOT main goroutine&quot;)\n        chanStr &lt;- &quot;hello world&quot;\n        chanErr &lt;- nil\n\n    }()\n    // waiting for chan with &quot;internal&quot; goroutin panicing and recovery\n    str := &lt;-chanStr\n    err = &lt;-chanErr\n    fmt.Println(str)\n    fmt.Println(err)\n\n    // panic(&quot;main&quot;)\n}\n</code></pre>\n<p>It gives error</p>\n<pre><code>all goroutines are asleep - deadlock\n</code></pre>\n<p>Full output:</p>\n<pre><code>go run /goPath/parentRecoverty2.go\ninternal goroutine paniced: NOT main goroutine\nerr is string\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan receive]:\nmain.main()\n    /goPath/parentRecoverty2.go:48 +0x1d4\n\ngoroutine 5 [chan send]:\nmain.func\u00b7002()\n    /goPath/parentRecoverty2.go:37 +0x407\nmain.func\u00b7003()\n    /goPath/parentRecoverty2.go:42 +0x130\ncreated by main.main\n    /goPath/parentRecoverty2.go:46 +0x190\nexit status 2\n</code></pre>\n<p><a href=\"https://play.golang.org/p/ZlLd79UIge\" rel=\"nofollow noreferrer\">Update playground</a></p>\n"}, {"tags": ["json", "mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 1117, "user_id": 763557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b270ca8a89f85baa6e84e016e18df635?s=128&d=identicon&r=PG&f=1", "display_name": "wgp", "link": "https://stackoverflow.com/users/763557/wgp"}, "edited": false, "score": 0, "creation_date": 1428255759, "post_id": 29454575, "comment_id": 47084288, "body": "This is the best answer but not exactly correct for my case. But that&#39;s <b>my fault</b> for not being detailed enough. I was absolutely defining my type incorrectly. I was using the SimpleJson library and my array of objects was coming back as <code>[]interface{}</code>. By changing my <code>Collection</code> to <code>[]interface{}</code> I was able to get the entire array of objects saved into Mongo in the exact same format it was given."}], "tags": [], "owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "is_accepted": true, "score": 4, "last_activity_date": 1428214881, "last_edit_date": 1428214881, "creation_date": 1428213366, "answer_id": 29454575, "question_id": 29454410, "link": "https://stackoverflow.com/questions/29454410/how-to-insert-array-of-objects-into-mongodb-using-go/29454575#29454575", "title": "How to insert array of objects into MongoDB using Go", "body": "<p>Looks you have the wrong data structure.</p>\n\n<pre><code>insertErr := c.Insert(&amp;MyData{something, collection})\n</code></pre>\n\n<p>something => <code>string</code> and collection => <code>slice</code></p>\n\n<p>You code should be like this:</p>\n\n<pre><code>insertErr := c.Insert(&amp;MyData{\"something\", []string{\"obj1\", \"value\"}})\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/Tx4zm2i0t2\" rel=\"nofollow\">Here</a> is the working code. </p>\n\n<pre><code>[{Something:something Collection:[obj1 value]} {Something:something Collection:[obj1 value]} {Something:something Collection:[obj1 value]} {Something:something Collection:[obj1 value]}]\n</code></pre>\n\n<p>For further reference, <a href=\"http://labix.org/mgo\" rel=\"nofollow\">mgo</a> has great documentation and you can find sample code and details about running mongodb queries <a href=\"http://blog.mongodb.org/post/80579086742/running-mongodb-queries-concurrently-with-go\" rel=\"nofollow\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 1117, "user_id": 763557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b270ca8a89f85baa6e84e016e18df635?s=128&d=identicon&r=PG&f=1", "display_name": "wgp", "link": "https://stackoverflow.com/users/763557/wgp"}, "edited": false, "score": 0, "creation_date": 1428256401, "post_id": 29455942, "comment_id": 47084517, "body": "Thank you, I really want to select this as the right answer but I can only choose one. I changed my JSON retrieving code to get a straight <code>[]interface{}</code> and made a simple change to my <code>Collection</code> type based on your response. Thank you so much. It wasn&#39;t the actual solution to my problem but it led me in the right direction and I was able to get it within no time."}], "tags": [], "owner": {"reputation": 825, "user_id": 2278893, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Et28N.jpg?s=128&g=1", "display_name": "Akash Shinde", "link": "https://stackoverflow.com/users/2278893/akash-shinde"}, "is_accepted": false, "score": 1, "last_activity_date": 1428226427, "creation_date": 1428226427, "answer_id": 29455942, "question_id": 29454410, "link": "https://stackoverflow.com/questions/29454410/how-to-insert-array-of-objects-into-mongodb-using-go/29455942#29455942", "title": "How to insert array of objects into MongoDB using Go", "body": "<p>Here you are not defining proper type to Collection in your MyData struct.</p>\n\n<pre><code>Collection []string    //This is what you are defining.\n</code></pre>\n\n<p>But from Json you are not getting <code>string array</code>,you are getting       <code>map[string]interface{}</code></p>\n\n<blockquote>\n  <p>This is the reason you are not filling Mydata struct properly</p>\n</blockquote>\n\n<p>Correct MyData struct will be </p>\n\n<pre><code>type MyData struct {\n Something string   \n Collection map[string]string // This actually contains more than strings but I'll be happy if I can just get strings saved \n}\n</code></pre>\n"}], "owner": {"reputation": 1117, "user_id": 763557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b270ca8a89f85baa6e84e016e18df635?s=128&d=identicon&r=PG&f=1", "display_name": "wgp", "link": "https://stackoverflow.com/users/763557/wgp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5941, "favorite_count": 0, "accepted_answer_id": 29454575, "answer_count": 2, "score": 1, "last_activity_date": 1428256262, "creation_date": 1428211651, "last_edit_date": 1428256262, "question_id": 29454410, "link": "https://stackoverflow.com/questions/29454410/how-to-insert-array-of-objects-into-mongodb-using-go", "title": "How to insert array of objects into MongoDB using Go", "body": "<p>I have JSON from an API that I want to save to MongoDB using the mgo package. My JSON looks like this:</p>\n\n<pre><code>{\n  \"something\": \"value\"\n  \"collection\": [\n    { \"obj1\": \"value\" }\n    // ... (Variable number of objects here)\n  ]\n}\n</code></pre>\n\n<p>To save this data I've created a new <code>type</code> in my Go application that looks like this:</p>\n\n<pre><code>type MyData struct {\n  Something string\n  Collection []string // This actually contains more than strings but I'll be happy if I can just get strings saved\n}\n\nmongoSess, err := mgo.Dial(\"localhost:27017\")\nif err != nil {\n  panic(err)\n}\ndefer mongoSess.Close()\n\nc := mongoSess.DB(\"mydatabase\").C(\"mycollection\")\ninsertErr := c.Insert(&amp;MyData{something, collection})\n</code></pre>\n\n<p>This code works but the problem is that it isn't saving anything in my collection field which should be an array of JSON objects. Nothing at all. I get the keys in my database and they are the right type but they have no data. Here's what the Mongo output is:</p>\n\n<pre><code>{ \"_id\" : ObjectId(\"5520c535a236d8a9a215d096\"), \"something\" : \"value\", \"collection\" : [ ] }\n</code></pre>\n\n<p>Can anyone spot what it is I'm doing wrong? I'm obviously new to Go and having trouble with types.</p>\n\n<h3>Solution</h3>\n\n<p>The answers here really helped me a lot. I'm at fault for not properly explaining things as the answers sent me on the right track but didn't solve the issue directly. Here's what the actual solution is.</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"github.com/bitly/go-simplejson\"\n  \"gopkg.in/mgo.v2\"\n  //\"gopkg.in/mgo.v2/bson\"\n  // Other packages are used as well\n)\n\ntype MyData struct {\n  Something int\n  Collection []interface{}\n}\n\nfunc main() {\n    // I'm using SimpleJson for parsing JSON\n    collection, cerr := jsonFromExternalApi.Get(\"collection\").Array()\n    if cerr != nil {\n      logger.Debug.Fatalln(cerr)\n    }\n\n    // Save response to Mongo (leaving out all the connection code)\n    c := mongoSess.DB(\"mydb\").C(\"mycollection\")\n    insertErr := c.Insert(&amp;Producer{npn, licenses })\n}\n</code></pre>\n\n<p>The issue was that SimpleJSON was returning the array of objects from my API call as a <code>[]interface{}</code>. I was not aware I could simply declare part of a struct to be an interface so instead of just correcting what Go's compiler was telling me was wrong I was making it way harder than it should have been.</p>\n\n<p>Coming from loosely typed scripting languages, stuff like this really trips me up and sometimes its hard to see the benefit but hopefully this helps someone out one day.</p>\n"}, {"tags": ["go", "sqlite", "blob"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1428352061, "post_id": 29452538, "comment_id": 47118689, "body": "You say that the sqlite gui only shows you 4 bytes, then you say you can view the images with the sqlite gui. Which is it? Also, what is your question precisely? You start by asking how to create an image, but it looks like you&#39;re just copying bytes to an http response."}, {"owner": {"reputation": 11628, "user_id": 1373105, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Wgf7P.jpg?s=128&g=1", "display_name": "Javier Cadiz", "link": "https://stackoverflow.com/users/1373105/javier-cadiz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1428353697, "post_id": 29452538, "comment_id": 47119537, "body": "I update the question with an image showing what i&#39;m saying. And sorry for being imprecise. I put my exact question at the end."}], "answers": [{"comments": [{"owner": {"reputation": 11628, "user_id": 1373105, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Wgf7P.jpg?s=128&g=1", "display_name": "Javier Cadiz", "link": "https://stackoverflow.com/users/1373105/javier-cadiz"}, "edited": false, "score": 0, "creation_date": 1428937906, "post_id": 29599494, "comment_id": 47363197, "body": "Yesssss, is working after the driver update. Probably something else is happening there since my tile_data type type is indeed a BLOB (see question update) but overall is working good. Thanks a lot for the effort."}], "tags": [], "owner": {"reputation": 1675, "user_id": 192220, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a58f3cfd3e777191d56bf5df462ca4b5?s=128&d=identicon&r=PG", "display_name": "Egon", "link": "https://stackoverflow.com/users/192220/egon"}, "is_accepted": true, "score": 1, "last_activity_date": 1428908215, "creation_date": 1428908215, "answer_id": 29599494, "question_id": 29452538, "link": "https://stackoverflow.com/questions/29452538/convert-blob-to-image-in-go/29599494#29599494", "title": "Convert Blob to Image in Go", "body": "<p>This was a bug in the sqlite3 driver. It wasn't handling strings that contain NUL characters properly. It is now fixed.</p>\n\n<p>Also the data have not been inserted correctly into the database. The datatype for them is TEXT and not BLOB as required by the schema. You can see this in the sqlite shell with: <code>SELECT typeof(tile_data) FROM tiles;</code>. <a href=\"https://github.com/mattn/go-sqlite3/issues/195#issuecomment-92038979\" rel=\"nofollow\">1</a></p>\n"}], "owner": {"reputation": 11628, "user_id": 1373105, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Wgf7P.jpg?s=128&g=1", "display_name": "Javier Cadiz", "link": "https://stackoverflow.com/users/1373105/javier-cadiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1745, "favorite_count": 0, "accepted_answer_id": 29599494, "answer_count": 1, "score": 1, "last_activity_date": 1428937764, "creation_date": 1428190188, "last_edit_date": 1428937764, "question_id": 29452538, "link": "https://stackoverflow.com/questions/29452538/convert-blob-to-image-in-go", "title": "Convert Blob to Image in Go", "body": "<p>I'm trying to create an mbtiles server in Go. The file follows the <a href=\"https://github.com/mapbox/mbtiles-spec\" rel=\"nofollow noreferrer\">mbtiles spec</a>.\nThe <code>tile_data</code> field is a <code>BLOB</code> and i'm trying to query the database and get the corresponding images (stored as blob types).</p>\n\n<p>So far the queries are OK but i'm getting corrupted <code>tile_data</code> results.\nI'm not sure how to map a SQLite BLOB to a proper Go data structure.</p>\n\n<p>So far i tried using <code>var tileData []byte</code> without success following this <a href=\"https://github.com/twpayne/gombtiles/blob/master/mbtiles/mbtiles.go\" rel=\"nofollow noreferrer\">github gombtiles sample</a>. The return value gets me an array of only 4 bytes which i suspect is kinda true since when i see the BLOB as Text type in a SQLite GUI it gets me 4 characters too (something like <code>\u00ff\u00d8\u00ff\u00e0</code>)</p>\n\n<p>To summarize:\nThe <code>tile_data</code> is a BLOB (storing an image) and i can't get a proper conversion to a Go var.\nHow can i convert a BLOB to Image in Go ?</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>The <code>\u00ff\u00d8\u00ff\u00e0</code> characters are <code>0xFF 0xD8 0xFF 0xE0</code> which are indeed the start of the JPEG file. I'm using the same MBTile file that i use in an iOS app through the Mapbox iOS SDK, so the file isn't corrupted and i can actually see the BLOB images using a SQLite GUI. The MBTiles spec says that the field is a BLOB type, and indeed, that's the field type that i'm using.\nAgain, the database is fine, is the same one used by an external iOS app. I can even query other data with success.</p>\n\n<p>For context this is my isolated code.</p>\n\n<pre><code>func TilesHandler(w http.ResponseWriter, r *http.Request) {\n\n  db, _ := sql.Open(\"sqlite3\", \"./mapSource.mbtiles\")\n  defer db.Close()\n\n  rows, _ := db.Query(\"SELECT tile_data FROM tiles WHERE zoom_level = 10 AND tile_column = 309 AND tile_row = 569\")\n  defer rows.Close()\n\n  var tileData []byte\n  for rows.Next() {\n    rows.Scan(&amp;tileData)\n  }\n\n  w.Write(tileData)\n}\n</code></pre>\n\n<p>The zoom and coordinates are hardcoded for simplicity. <code>tiledata</code> is returning the mentioned 4 bytes. </p>\n\n<p><strong>UPDATE 2:</strong>\nHere is the output of one specific record of the tiles table. Notice that the <code>tile_data</code> field is a BLOB and at the bottom the GUI shows that 4 characters. That are the exact one that i'm receiving in the <code>[]byte</code> array at my Go code.</p>\n\n<p><strong>So my question is:</strong> I have this BLOB image file in my database which is a jpeg image. How i read it and show it as an image in my web page ? I want to read that BLOB and return an image in my http request.</p>\n\n<p><strong>Tiles row sample:</strong></p>\n\n<p><img src=\"https://i.stack.imgur.com/vwCfi.png\" alt=\"enter image description here\"></p>\n\n<p><strong>Tiles fields types</strong></p>\n\n<p><img src=\"https://i.stack.imgur.com/JGL7K.png\" alt=\"enter image description here\"></p>\n"}, {"tags": ["go", "negroni"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1428196252, "post_id": 29452082, "comment_id": 47071672, "body": "See here for some examples on hijacking the ResponseWriter - <a href=\"https://justinas.org/writing-http-middleware-in-go/\" rel=\"nofollow noreferrer\">justinas.org/writing-http-middleware-in-go</a>"}, {"owner": {"reputation": 825, "user_id": 2278893, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Et28N.jpg?s=128&g=1", "display_name": "Akash Shinde", "link": "https://stackoverflow.com/users/2278893/akash-shinde"}, "edited": false, "score": 0, "creation_date": 1428226718, "post_id": 29452082, "comment_id": 47076551, "body": "you should look gin framework. <a href=\"http://gin-gonic.github.io/gin\" rel=\"nofollow noreferrer\">gin-gonic.github.io/gin</a> ,it has lot of good api to read and render json."}], "owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1159, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1428186419, "creation_date": 1428186419, "question_id": 29452082, "link": "https://stackoverflow.com/questions/29452082/let-middleware-read-response-from-http-handler", "title": "Let middleware read response from http handler", "body": "<p>I'm building a web service in Go. I use Negroni, unrolled/Render and Gorilla Mux. </p>\n\n<p>I'm trying to write some simple middleware myself for caching http responses and being completly new to Golang a few questions came up... </p>\n\n<p>Is there a way in which I can read what a handler's render.JSON(...) was when my midlleware is executed from the return of the handler. </p>\n\n<p>Demo code below...</p>\n\n<pre><code>func MyMiddleWareHandler(w http.ResponseWriter, r *http.Request,next http.HandlerFunc) {\n    // First call the next/final handler\n    next(w, r)\n    //Now read the Render.JSON(...) executed by the handler called by next method above...  \n}\n</code></pre>\n"}, {"tags": ["concurrency", "go", "producer-consumer"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428179120, "post_id": 29450820, "comment_id": 47067995, "body": "Note, you have a potential data race with access to the global <code>seq</code> variable (except that the unbuffered <code>requestChan</code> may keep them apart)."}, {"owner": {"reputation": 13, "user_id": 4750090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/450a4b3bafaf7957c5a07a0aab17abf9?s=128&d=identicon&r=PG&f=1", "display_name": "Marlon", "link": "https://stackoverflow.com/users/4750090/marlon"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428179599, "post_id": 29450820, "comment_id": 47068113, "body": "Yeah that is what i would expect Dave, some non deterministic behaviour giving me not all the numbers from 1 to 1000 but something different.  In this example chans are buffered <a href=\"http://play.golang.org/p/tq7-6Bc0hL\" rel=\"nofollow noreferrer\">play.golang.org/p/tq7-6Bc0hL</a>, still getting same results."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428179667, "post_id": 29450820, "comment_id": 47068126, "body": "Have you run with <code>GOMAXPROCS</code> &gt;1? (and perhaps with <code>-race</code>)"}, {"owner": {"reputation": 13, "user_id": 4750090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/450a4b3bafaf7957c5a07a0aab17abf9?s=128&d=identicon&r=PG&f=1", "display_name": "Marlon", "link": "https://stackoverflow.com/users/4750090/marlon"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428180326, "post_id": 29450820, "comment_id": 47068280, "body": "@DaveC Added <code>runtime.GOMAXPROCS(2)</code> in code and ran as <code>go run -race helloworld.go</code> i always get <i>1000</i> as last <code>seq</code> print but the <i>go</i> executable informs me of <b>Found 1 data race(s)</b>"}, {"owner": {"reputation": 13, "user_id": 4750090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/450a4b3bafaf7957c5a07a0aab17abf9?s=128&d=identicon&r=PG&f=1", "display_name": "Marlon", "link": "https://stackoverflow.com/users/4750090/marlon"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428180908, "post_id": 29450820, "comment_id": 47068416, "body": "@DaveC With 4 processor finally managed to get what i was expecting multiple goroutine printig the same number even with unbuffered chan. I would like to prize you with the right answer. thanks for the help!"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 4750090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/450a4b3bafaf7957c5a07a0aab17abf9?s=128&d=identicon&r=PG&f=1", "display_name": "Marlon", "link": "https://stackoverflow.com/users/4750090/marlon"}, "edited": false, "score": 0, "creation_date": 1428179463, "post_id": 29451062, "comment_id": 47068077, "body": "uhmm so if i make my chan buffered i should expect a different behavior, but that is not the case. ( <a href=\"http://play.golang.org/p/tq7-6Bc0hL\" rel=\"nofollow noreferrer\">play.golang.org/p/tq7-6Bc0hL</a> )  Still not getting it sorry :("}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428179533, "post_id": 29451062, "comment_id": 47068097, "body": "@peterSO Except that multiple workers may all try and send values on <code>requestChan</code> at &quot;the same time&quot; and it should then be possible that multiple generates can receive these individual requests at &quot;the nearly the same time&quot; (i.e. there could be multiple generators racing on <code>seq</code> which I believe is the question)."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1428179117, "creation_date": 1428179117, "answer_id": 29451062, "question_id": 29450820, "link": "https://stackoverflow.com/questions/29450820/concurrency-with-multiple-producers-multiple-consumers/29451062#29451062", "title": "Concurrency with multiple producers/multiple consumers", "body": "<blockquote>\n  <p><a href=\"http://golang.org/ref/spec#Channel_types\" rel=\"nofollow\">Channel types</a></p>\n  \n  <p>A channel provides a mechanism for concurrently executing functions to\n  communicate by sending and receiving values of a specified element\n  type. The value of an uninitialized channel is nil. </p>\n  \n  <p>A new, initialized channel value can be made using the built-in\n  function make, which takes the channel type and an optional capacity\n  as arguments:</p>\n\n<pre><code>make(chan int, 100)\n</code></pre>\n  \n  <p>The capacity, in number of elements, sets the size of the buffer in\n  the channel. If the capacity is zero or absent, the channel is\n  unbuffered and communication succeeds only when both a sender and\n  receiver are ready. Otherwise, the channel is buffered and\n  communication succeeds without blocking if the buffer is not full\n  (sends) or not empty (receives). A nil channel is never ready for\n  communication.</p>\n</blockquote>\n\n<p>You are throttling channel communications by using unbuffered channels.</p>\n\n<p>For example,</p>\n\n<pre><code>generatorChan = make(chan uint64)\nrequestChan = make(chan uint64)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 3, "last_activity_date": 1428183762, "last_edit_date": 1428183762, "creation_date": 1428183400, "answer_id": 29451654, "question_id": 29450820, "link": "https://stackoverflow.com/questions/29450820/concurrency-with-multiple-producers-multiple-consumers/29451654#29451654", "title": "Concurrency with multiple producers/multiple consumers", "body": "<p>You have multiple workers that can all run at the same time and all try and make requests at the same time. Since <code>requestChan</code> is unbuffered they all block waiting for a reader to synchronize with and take their request.</p>\n\n<p>You have multiple generators that will synchronize with a requester via <code>requestChan</code>, produce a result, and then block on the unbuffered <code>generatorChan</code> until a worker reads the result. Note it may be a different worker.</p>\n\n<p>There is no additional synchronization so everything else is non-deterministic.</p>\n\n<ul>\n<li>One generator could field all the requests.</li>\n<li>A generator could grab a request and get through incrementing <code>seq</code>\nbefore any other generator happens to get a chance to run. With only one processor this may even be likely.</li>\n<li>All the generators could grab requests and all end up wanting to increment <code>seq</code> at exactly the same time causing all kinds of problems.</li>\n<li>The workers can get responses from the same generator they happened to send to or from a completely different one.</li>\n</ul>\n\n<p>In general, without adding synchronization to force one of these behaviors there is no way you can ensure any of these actually happen.</p>\n\n<p>Note that with the data race, that itself is another non-deterministic event. It's possible to get arbitrary values, program crashes, etc. It's not safe to assume that under race conditions the value may just be off by one or some such relatively innocuous result.</p>\n\n<p>For experimenting, the best you may be able to do is crank up <code>GOMAXPROCS</code>. Either through an environment variable (e.g.\u00a0something like <code>env GOMAXPROCS=16 go run foo.go</code> or <code>env GOMAXPROCS=16 ./foo</code> after <code>go build</code>) or by calling <code>runtime.GOMAXPROCS(16)</code> from your program. The default is 1 and this means that data races or other \"strange\" behavior may be hidden.</p>\n\n<p>You can also influence things a little by adding calls to <code>runtime.Gosched</code> or <code>time.Sleep</code> at various points.</p>\n\n<p>You can also see the data race if you use the race detector (e.g.\u00a0with <code>go run -race foo.goo</code> or <code>go build -race</code>). Not only should the program show \"Found 1 data race(s)\" on exit but it should also dump out a lot of details with stack traces when the race is first detected.</p>\n\n<p>Here is a \"cleaned up\" version of your code for experimentation:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"sync\"\n    \"sync/atomic\"\n)\n\nvar seq uint64 = 0\nvar generatorChan = make(chan uint64)\nvar requestChan = make(chan uint64)\n\nfunc generator(genID int) {\n    for reqID := range requestChan {\n        // If you want to see a data race:\n        //seq = seq + 1\n        // Else:\n        s := atomic.AddUint64(&amp;seq, 1)\n        log.Printf(\"Gen: %2d, from %3d\", genID, reqID)\n        generatorChan &lt;- s\n    }\n}\n\nfunc worker(id int, work *sync.WaitGroup) {\n    defer work.Done()\n\n    for i := 0; i &lt; 5; i++ {\n        requestChan &lt;- uint64(id)\n        log.Printf(\"\\t\\t\\tWorker: %3d got %4d\", id, &lt;-generatorChan)\n    }\n}\n\nfunc main() {\n    log.SetFlags(log.Lmicroseconds)\n    const (\n        numGen    = 20\n        numWorker = 200\n    )\n    var wg sync.WaitGroup\n    for i := 0; i &lt; numGen; i++ {\n        go generator(i)\n    }\n    wg.Add(numWorker)\n    for i := 0; i &lt; numWorker; i++ {\n        go worker(i, &amp;wg)\n    }\n    wg.Wait()\n    close(requestChan)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/UxOADthEbE\" rel=\"nofollow\"><kbd>Playground</kbd></a> (but note that the timestamps on the playground won't be useful and calling <code>runtime.MAXPROCS</code> may not do anything). Further note that the playground caches results so re-running the exact same program will always show the same output, you need to make some small change or just run it on your own machine.</p>\n\n<p>Largely small changes like shunting down the generator, using <code>log</code> versus <code>fmt</code> since the former makes concurrency guarantees, removing the data race, making the output look nicer, etc.</p>\n"}], "owner": {"reputation": 13, "user_id": 4750090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/450a4b3bafaf7957c5a07a0aab17abf9?s=128&d=identicon&r=PG&f=1", "display_name": "Marlon", "link": "https://stackoverflow.com/users/4750090/marlon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1652, "favorite_count": 0, "accepted_answer_id": 29451654, "answer_count": 2, "score": 1, "last_activity_date": 1428183762, "creation_date": 1428177353, "last_edit_date": 1428178428, "question_id": 29450820, "link": "https://stackoverflow.com/questions/29450820/concurrency-with-multiple-producers-multiple-consumers", "title": "Concurrency with multiple producers/multiple consumers", "body": "<p>I'm probably missing something, or not understanding something in how Go handles concurrency (or in my knowledge of concurrency itself), i've devised a little bit of code to understand a multiple producer/consumer.</p>\n\n<p>This is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    // \"math/rand\"\n    \"sync\"\n)\n\nvar seq uint64 = 0\nvar generatorChan chan uint64\nvar requestChan chan uint64\n\nfunc makeTimestamp() int64 {\n    return time.Now().UnixNano() / int64(time.Millisecond)\n}\n\nfunc generateStuff(genId int) {\n    var crap uint64\n    for {\n        crap = &lt;-requestChan\n        // &lt;- requestChan\n        seq = seq+1\n        fmt.Println(\"Gen \", genId, \" - From : \", crap, \" @\", makeTimestamp())\n        generatorChan &lt;- uint64(seq)\n    }\n}\n\nfunc concurrentPrint(id int, work *sync.WaitGroup) {\n    defer work.Done()\n\n    for i := 0; i &lt; 5; i++ {\n        requestChan&lt;-uint64(id)\n        fmt.Println(\"Conc\", id, \": \", &lt;-generatorChan)\n    }\n}\n\nfunc main() {\n    generatorChan = make(chan uint64)\n    requestChan = make(chan uint64)\n    var wg sync.WaitGroup\n    for i := 0; i &lt; 20; i++ {\n        go generateStuff(i)\n    }\n    maximumWorker := 200\n    wg.Add(maximumWorker)\n    for i := 0; i &lt; maximumWorker; i++ {\n        go concurrentPrint(i, &amp;wg)\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>When run it prints (mostly in order) all the numbers from 1 to 1000 (200 consumers getting a number 5 times each).\nI would've expected that some consumer would print the exact same number but it seems that the <em>requestChan</em> is working like a barrier preventing this even if there are 20 goroutines serving the <em>generateStuff</em> that generate the number by increasing a global variable.</p>\n\n<p>What am i getting wrong about Go or Concurrency in general?</p>\n\n<p>I would've expected a situation in like two go routines of type <em>generateStuff</em> would've been woke up together and increase seq at the same time thus having something like two consumers printing the same number two times.</p>\n\n<p><strong>EDIT</strong> Code on playgolang: <a href=\"http://play.golang.org/p/eRzNXjdxtZ\" rel=\"nofollow\">http://play.golang.org/p/eRzNXjdxtZ</a></p>\n"}, {"tags": ["apache", "go"], "comments": [{"owner": {"reputation": 680, "user_id": 3677188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d17944f3cb838dc1b4430a584a904d17?s=128&d=identicon&r=PG&f=1", "display_name": "tobiash", "link": "https://stackoverflow.com/users/3677188/tobiash"}, "edited": false, "score": 4, "creation_date": 1428160805, "post_id": 29447931, "comment_id": 47062492, "body": "go is compiled language. Don&#39;t re-compile the same code for every access. Use the compiled result (.exe on Windows) as your cgi. See here: <a href=\"http://stackoverflow.com/questions/25325054/run-an-exe-file-on-apache\" title=\"run an exe file on apache\">stackoverflow.com/questions/25325054/run-an-exe-file-on-apac&zwnj;&#8203;he</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428176295, "post_id": 29447931, "comment_id": 47067134, "body": "Rather than starting up a new process for each &quot;cgi&quot; fetch wouldn&#39;t it be better to leave a real Go web server running (doing all the Go based stuff you want in a single server) and just arrange to have the appropriate URLs directed to it (e.g. via Apache&#39;s config)? Alternatively, maybe <a href=\"https://golang.org/pkg/net/http/fcgi/\" rel=\"nofollow noreferrer\"><code>net&#47;http&#47;fcgi</code></a>."}, {"owner": {"reputation": 21, "user_id": 3566700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1648da67dbd4c6f0dc260b02a00a5c0a?s=128&d=identicon&r=PG&f=1", "display_name": "Justalilbitnerdy", "link": "https://stackoverflow.com/users/3566700/justalilbitnerdy"}, "edited": false, "score": 0, "creation_date": 1428261149, "post_id": 29447931, "comment_id": 47086038, "body": "I am sorry Maybe I was not clear since I put .exe in the config, but I am running it on linux, and am not compiling it overtime, I compiled it into a Unix Executable File but am not sure how to add that type of file to apache.  I really want the go to handle operations on like web forms and such, probably sent from javascript, if that helps."}], "answers": [{"tags": [], "owner": {"reputation": 745, "user_id": 4547609, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/108385d869de0f7c3c4e5964d639fe5a?s=128&d=identicon&r=PG", "display_name": "Another Prog", "link": "https://stackoverflow.com/users/4547609/another-prog"}, "is_accepted": false, "score": 1, "last_activity_date": 1443340825, "last_edit_date": 1443340825, "creation_date": 1443340100, "answer_id": 32805718, "question_id": 29447931, "link": "https://stackoverflow.com/questions/29447931/golang-cgi-on-apache/32805718#32805718", "title": "Golang CGI on apache", "body": "<p>Some servers allow executing cgi programs outside of cgi-bin, other servers require them in cgi-bin folder. The permissions must be set correctly (i.e. 755 or other) </p>\n\n<p>if you do decide to execute cgi programs outside of cgi-bin and your server allows it, this may be a security issue</p>\n\n<p>On many servers you don't need to add handlers for the main cgi-bin folder, you just need to set file permissions by ftp or telnet. If you are downloading the file rather than executing it, are you sure permissions is set correct using an ftp program? Try 755, 777, and others</p>\n\n<p>Note: a go program is not a script, it's a compiled executable.   With a binary program, you don't need an interpreter so your server could be confused as to what a go program needs to be interpreted as. You just want to run it with exec permissions , not interpret it as a script.  </p>\n\n<p>Migrating servers can be a nightmare if you don't stick to standard cgi-bin folder design. Some servers don't allow all apache config modifications due to security or other concerns, so when you change hosting plans one day all your programs and folder structures could be broken if you use non standard config hacks. </p>\n\n<p>Some servers even require them to be run in jails, which complicates matters further. Figure out how your server is setup and what it allows, and study what permissions are required to execute.</p>\n"}], "owner": {"reputation": 21, "user_id": 3566700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1648da67dbd4c6f0dc260b02a00a5c0a?s=128&d=identicon&r=PG&f=1", "display_name": "Justalilbitnerdy", "link": "https://stackoverflow.com/users/3566700/justalilbitnerdy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2631, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1443340825, "creation_date": 1428160010, "question_id": 29447931, "link": "https://stackoverflow.com/questions/29447931/golang-cgi-on-apache", "title": "Golang CGI on apache", "body": "<p>I am trying to run Golang cgi scripts through apache. I can get the files compiled and am using examples i found of how to make it, but I don't know what file extension to add to apache's \"add handler\" or if that is even where I should tell apache to handle the Go compiled source. Currently when you go to the cgi-bin file in a web browser you just download the Unix Executable File.\nas you can see I have tried .exe and .go neither of which I expected to work, and didn't.</p>\n\n<pre><code>&lt;Directory \"/var/www/html/cgi\"&gt;\n    AddHandler cgi-script .cgi .py .exe .go\n    AllowOverride All\n    Options +Indexes +FollowSymLinks +ExecCGI\n    Order allow,deny\n    Allow from all\n&lt;/Directory&gt;\n</code></pre>\n\n<p>Also, does cgi vs cgi matter? I have been using both to see which ones work, but neither do with my current configuration.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 680, "user_id": 3677188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d17944f3cb838dc1b4430a584a904d17?s=128&d=identicon&r=PG&f=1", "display_name": "tobiash", "link": "https://stackoverflow.com/users/3677188/tobiash"}, "edited": false, "score": 0, "creation_date": 1428161008, "post_id": 29447807, "comment_id": 47062545, "body": "<a href=\"https://github.com/AllenDang/w32\" rel=\"nofollow noreferrer\">github.com/AllenDang/w32</a> implements the Win32 API and has all functionality you need."}], "answers": [{"comments": [{"owner": {"reputation": 651, "user_id": 1340531, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2d6c8cc62425d811bd54f0d3984feac8?s=128&d=identicon&r=PG", "display_name": "user1340531", "link": "https://stackoverflow.com/users/1340531/user1340531"}, "edited": false, "score": 0, "creation_date": 1428176139, "post_id": 29448159, "comment_id": 47067095, "body": "Thanks. Will I also be able to achieve this <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/bb688195(v=vs.85).aspx\" rel=\"nofollow noreferrer\">msdn.microsoft.com/en-us/library/windows/desktop/&hellip;</a> with the w32 go wrappers?"}, {"owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "reply_to_user": {"reputation": 651, "user_id": 1340531, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2d6c8cc62425d811bd54f0d3984feac8?s=128&d=identicon&r=PG", "display_name": "user1340531", "link": "https://stackoverflow.com/users/1340531/user1340531"}, "edited": false, "score": 0, "creation_date": 1428176363, "post_id": 29448159, "comment_id": 47067163, "body": "Looks like it&#39;s defined in the w32 library: <a href=\"http://godoc.org/github.com/AllenDang/w32#DwmExtendFrameIntoClientArea\" rel=\"nofollow noreferrer\">godoc.org/github.com/AllenDang/w32#DwmExtendFrameIntoClientA&zwnj;&#8203;rea</a>"}, {"owner": {"reputation": 651, "user_id": 1340531, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2d6c8cc62425d811bd54f0d3984feac8?s=128&d=identicon&r=PG", "display_name": "user1340531", "link": "https://stackoverflow.com/users/1340531/user1340531"}, "edited": false, "score": 0, "creation_date": 1428178653, "post_id": 29448159, "comment_id": 47067870, "body": "It returns 0 and doesn&#39;t do anything unfortunately, even after I say the frame changed w32.SetWindowPos(h, 0,0, 0, 200, 600, w32.SWP_FRAMECHANGED)"}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 4, "last_activity_date": 1428161453, "creation_date": 1428161453, "answer_id": 29448159, "question_id": 29447807, "link": "https://stackoverflow.com/questions/29447807/taking-control-of-another-window-with-go/29448159#29448159", "title": "Taking control of another window with Go", "body": "<p>Yes there are several libraries which can be found using <a href=\"http://godoc.org\" rel=\"nofollow\">godoc.org</a> or <a href=\"http://go-search.org\" rel=\"nofollow\">go-search.org</a>. In this example I'm using <a href=\"http://github.com/AllenDang/w32\" rel=\"nofollow\">w32</a> and <a href=\"http://github.com/hnakamur/w32syscall\" rel=\"nofollow\">w32syscall</a> (which supplies some additional functions):</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"strings\"\n    \"syscall\"\n\n    \"github.com/AllenDang/w32\"\n    \"github.com/hnakamur/w32syscall\"\n)\n\nfunc main() {\n    err := w32syscall.EnumWindows(func(hwnd syscall.Handle, lparam uintptr) bool {\n        h := w32.HWND(hwnd)\n        text := w32.GetWindowText(h)\n        if strings.Contains(text, \"Calculator\") {\n            w32.MoveWindow(h, 0, 0, 200, 600, true)\n        }\n        return true\n    }, 0)\n    if err != nil {\n        log.Fatalln(err)\n    }\n}\n</code></pre>\n\n<p>Both of these libraries are merely exposing the underlying win32 API with minimal wrapping, so you will have to read the <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms633534(v=vs.85).aspx\" rel=\"nofollow\">corresponding documentation</a> from Microsoft to really know how to use them.</p>\n"}], "owner": {"reputation": 651, "user_id": 1340531, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2d6c8cc62425d811bd54f0d3984feac8?s=128&d=identicon&r=PG", "display_name": "user1340531", "link": "https://stackoverflow.com/users/1340531/user1340531"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 913, "favorite_count": 0, "accepted_answer_id": 29448159, "answer_count": 1, "score": 0, "last_activity_date": 1428161453, "creation_date": 1428159177, "question_id": 29447807, "link": "https://stackoverflow.com/questions/29447807/taking-control-of-another-window-with-go", "title": "Taking control of another window with Go", "body": "<p>I'm wondering if there are any libraries that help me take control of another window. For example if user has calc.exe running, I'd like my go code to move it, resize it, maybe even remove it's frame, attach stuff to it, idk. </p>\n\n<p>Right now I only know how to do it with scripting languages like autoit or autohotkey or whatnot. </p>\n"}, {"tags": ["performance", "download", "go", "throttling", "rate"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 3, "creation_date": 1428146424, "post_id": 29445173, "comment_id": 47058586, "body": "I don&#39;t know that package, but I&#39;d limit the writer, not the reader. Also, the Content-Type and Content-Length headers should not be copied from the request but set by the file type and file length. also also, you&#39;re reading a text file and writing it as png."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1428147833, "post_id": 29445173, "comment_id": 47058910, "body": "@Not_a_Golfer it is <a href=\"https://github.com/juju/ratelimit\" rel=\"nofollow noreferrer\">github.com/juju/ratelimit</a>, although I prefer <a href=\"https://github.com/aybabtme/iocontrol\" rel=\"nofollow noreferrer\">github.com/aybabtme/iocontrol</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 1, "last_activity_date": 1428160002, "creation_date": 1428160002, "answer_id": 29447927, "question_id": 29445173, "link": "https://stackoverflow.com/questions/29445173/how-to-limit-download-speed-with-go/29447927#29447927", "title": "How to limit download speed with Go?", "body": "<p>I'm not seeing the error, but I did notice some issues with the code. For this:</p>\n\n<pre><code>w.Header().Set(\"Content-Type\", r.Header.Get(\"Content-Type\"))\n</code></pre>\n\n<p>You should use the <a href=\"http://golang.org/pkg/mime/\" rel=\"nofollow\">mime package</a>'s:</p>\n\n<pre><code>func TypeByExtension(ext string) string\n</code></pre>\n\n<p>To determine the content type. (if you end up with the empty string default to <code>application/octet-stream</code>)</p>\n\n<p>For:</p>\n\n<pre><code>w.Header().Set(\"Content-Length\", r.Header.Get(\"Content-Length\"))\n</code></pre>\n\n<p>You need to get the content length from the file itself. By using the request content length, for a <code>GET</code> this basically ends up as a no-op, but for a <code>POST</code> you're sending back the wrong length, which might explain the error you're seeing. After you open the file, do this:</p>\n\n<pre><code>fi, err := file.Stat()\nif err != nil {\n    http.Error(w, err.Error(), 500)\n    return\n}\nw.Header().Set(\"Content-Length\", fmt.Sprint(fi.Size()))\n</code></pre>\n\n<p>One final thing, when you open the file, if there's an error, you don't need to close the file handle. Do it like this instead:</p>\n\n<pre><code>file, err := os.Open(...)\nif err != nil {\n    http.NotFound(w, r)\n    return\n}\ndefer file.Close()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 4746154, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6d53c1bda7f3ce3af5b3a1a569618b1a?s=128&d=identicon&r=PG&f=1", "display_name": "Royalty", "link": "https://stackoverflow.com/users/4746154/royalty"}, "edited": false, "score": 0, "creation_date": 1429880348, "post_id": 29450292, "comment_id": 47822159, "body": "What newLRS is? EDIT: found ;)"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 35, "user_id": 4746154, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6d53c1bda7f3ce3af5b3a1a569618b1a?s=128&d=identicon&r=PG&f=1", "display_name": "Royalty", "link": "https://stackoverflow.com/users/4746154/royalty"}, "edited": false, "score": 0, "creation_date": 1501862573, "post_id": 29450292, "comment_id": 77983353, "body": "BTW, these days I&#39;d prefer using <a href=\"https://godoc.org/golang.org/x/time/rate\" rel=\"nofollow noreferrer\"><code>golang.org&#47;x&#47;time&#47;rate</code></a> over <code>github.com&#47;juju&#47;ratelimit</code>."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 2, "last_activity_date": 1428174064, "creation_date": 1428174064, "answer_id": 29450292, "question_id": 29445173, "link": "https://stackoverflow.com/questions/29445173/how-to-limit-download-speed-with-go/29450292#29450292", "title": "How to limit download speed with Go?", "body": "<p>Rather than mucking around with getting the correct the content type and length headers yourself it'd probably be much better to use <a href=\"https://golang.org/pkg/net/http/#ServeContent\" rel=\"nofollow\"><code>http.ServeContent</code></a> which will do that for you (as well as support \"If-Modified-Since\", range requests, etc. If you can supply an \"ETag\" header it can also handle \"If-Range\" and \"If-None-Match\" requests as well).</p>\n\n<p>As mentioned previously, it's often preferable to limit on the write side but it's awkward to wrap an <code>http.ResponseWriter</code> since various http functions also check for optional interfaces such as <code>http.Flusher</code> and <code>http.Hijacker</code>. It's much easier to wrap the <code>io.ReadSeeker</code> that <code>ServeContent</code> needs.</p>\n\n<p>For example, something like this perhaps:</p>\n\n<pre><code>func pathFromID(fileID string) string {\n    // replace with whatever logic you need\n    return \"../../bin/files/test.txt\"\n}\n\n// or more verbosely you could call this a \"limitedReadSeeker\"\ntype lrs struct {\n    io.ReadSeeker\n    // This reader must not buffer but just do something simple\n    // while passing through Read calls to the ReadSeeker\n    r io.Reader\n}\n\nfunc (r lrs) Read(p []byte) (int, error) {\n    return r.r.Read(p)\n}\n\nfunc newLRS(r io.ReadSeeker, bucket *ratelimit.Bucket) io.ReadSeeker {\n    // Here we know/expect that a ratelimit.Reader does nothing\n    // to the Read calls other than add delays so it won't break\n    // any io.Seeker calls.\n    return lrs{r, ratelimit.Reader(r, bucket)}\n}\n\nfunc serveFile(w http.ResponseWriter, req *http.Request) {\n    fileID := req.URL.Query().Get(\"fileID\")\n    if len(fileID) == 0 {\n        http.Error(w, \"invalid request\", http.StatusBadRequest)\n        return\n    }\n\n    path := pathFromID(fileID)\n    file, err := os.Open(path)\n    if err != nil {\n        http.NotFound(w, req)\n        return\n    }\n    defer file.Close()\n    fi, err := file.Stat()\n    if err != nil {\n        http.Error(w, \"blah\", 500) // XXX fixme\n        return\n    }\n\n    const (\n        rate     = 100 &lt;&lt; 10\n        capacity = 100 &lt;&lt; 10\n    )\n    // Normally we'd prefer to limit the writer but it's awkward to wrap\n    // an http.ResponseWriter since it may optionally also implement\n    // http.Flusher, or http.Hijacker.\n    bucket := ratelimit.NewBucketWithRate(rate, capacity)\n    lr := newLRS(file, bucket)\n    http.ServeContent(w, req, path, fi.ModTime(), lr)\n}\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 4746154, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6d53c1bda7f3ce3af5b3a1a569618b1a?s=128&d=identicon&r=PG&f=1", "display_name": "Royalty", "link": "https://stackoverflow.com/users/4746154/royalty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1752, "favorite_count": 4, "accepted_answer_id": 29447927, "answer_count": 2, "score": 2, "last_activity_date": 1501862379, "creation_date": 1428142345, "last_edit_date": 1501862379, "question_id": 29445173, "link": "https://stackoverflow.com/questions/29445173/how-to-limit-download-speed-with-go", "title": "How to limit download speed with Go?", "body": "<p>I'm currently developing a download server in Go. I need to limit the download speed of users to 100KB/s.</p>\n\n<p>This was my code:</p>\n\n<pre><code>func serveFile(w http.ResponseWriter, r *http.Request) {\n    fileID := r.URL.Query().Get(\"fileID\")\n    if len(fileID) != 0 {\n        w.Header().Set(\"Content-Disposition\", \"attachment; filename=filename.txt\")\n        w.Header().Set(\"Content-Type\", r.Header.Get(\"Content-Type\"))\n        w.Header().Set(\"Content-Length\", r.Header.Get(\"Content-Length\"))\n\n        file, err := os.Open(fmt.Sprintf(\"../../bin/files/test.txt\"))\n        defer file.Close()\n        if err != nil {\n            http.NotFound(w, r)\n            return\n        }\n        io.Copy(w, file)\n    } else {\n        io.WriteString(w, \"Invalid request.\")\n    }\n}\n</code></pre>\n\n<p>Then I found a package on github and my code became the following:</p>\n\n<pre><code>func serveFile(w http.ResponseWriter, r *http.Request) {\n    fileID := r.URL.Query().Get(\"fileID\")\n    if len(fileID) != 0 {\n        w.Header().Set(\"Content-Disposition\", \"attachment; filename=Wiki.png\")\n        w.Header().Set(\"Content-Type\", r.Header.Get(\"Content-Type\"))\n        w.Header().Set(\"Content-Length\", r.Header.Get(\"Content-Length\"))\n\n        file, err := os.Open(fmt.Sprintf(\"../../bin/files/test.txt\"))\n        defer file.Close()\n        if err != nil {\n            http.NotFound(w, r)\n            return\n        }\n        bucket := ratelimit.NewBucketWithRate(100*1024, 100*1024)\n        reader := bufio.NewReader(file)\n        io.Copy(w, ratelimit.Reader(reader, bucket))\n    } else {\n        io.WriteString(w, \"Invalid request.\")\n    }\n}\n</code></pre>\n\n<p>But I'm getting this error:</p>\n\n<blockquote>\n  <p>Corrupted Content Error</p>\n  \n  <p>The page you are trying to view cannot be shown because an error in\n  the data transmission was detected.</p>\n</blockquote>\n\n<p>Here's my code on the Go playground: <a href=\"http://play.golang.org/p/ulgXQl4eQO\" rel=\"nofollow noreferrer\">http://play.golang.org/p/ulgXQl4eQO</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "edited": false, "score": 0, "creation_date": 1428140731, "post_id": 29444890, "comment_id": 47057224, "body": "Tks! Came up with the same answer at the same time myself :)"}], "tags": [], "owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "is_accepted": true, "score": 11, "last_activity_date": 1428140396, "creation_date": 1428140396, "answer_id": 29444890, "question_id": 29444817, "link": "https://stackoverflow.com/questions/29444817/go-how-can-i-check-for-type-equality/29444890#29444890", "title": "Go - How can I check for type equality?", "body": "<p>Type assertions return two values .. the first is the converted value, the second is a bool indicating if the type assertion worked properly.</p>\n\n<p>So you could do this:</p>\n\n<pre><code>_, ok := x.(int)\n\nif ok {\n    fmt.Println(\"Its an int\")\n} else {\n    fmt.Println(\"Its NOT an int\")\n}\n</code></pre>\n\n<p>..or, shorthand:</p>\n\n<pre><code>if _, ok := x.(int); ok {\n    fmt.Println(\"Its an int\")\n}\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/OXr2yu8FnV\" rel=\"noreferrer\">See it in the playground</a></kbd></p>\n"}, {"comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1428140500, "post_id": 29444894, "comment_id": 47057175, "body": "this will work fine if you need  a specific type. If you want to decide between  many types, a type switch is of course better."}, {"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1428140555, "post_id": 29444894, "comment_id": 47057188, "body": "Ahh.. you must have already answered just as I did. Oh well, glad you found your answer :)"}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 3, "last_activity_date": 1428140450, "creation_date": 1428140450, "answer_id": 29444894, "question_id": 29444817, "link": "https://stackoverflow.com/questions/29444817/go-how-can-i-check-for-type-equality/29444894#29444894", "title": "Go - How can I check for type equality?", "body": "<p>I just figured out another way of doing this based on <a href=\"http://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">this</a>:</p>\n\n<pre><code>if _, ok := x.(int); ok {\n    fmt.Println(\"This is an int\")\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 1, "creation_date": 1428148813, "post_id": 29444964, "comment_id": 47059167, "body": "As per policy, please copy the relevant part of the linked document into your answer."}, {"owner": {"reputation": 1803, "user_id": 3531912, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/Qh3Y8.png?s=128&g=1", "display_name": "Alessandro Suglia", "link": "https://stackoverflow.com/users/3531912/alessandro-suglia"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1428660766, "post_id": 29444964, "comment_id": 47267649, "body": "@FUZxxl Thank you for your suggestion."}], "tags": [], "owner": {"reputation": 1803, "user_id": 3531912, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/Qh3Y8.png?s=128&g=1", "display_name": "Alessandro Suglia", "link": "https://stackoverflow.com/users/3531912/alessandro-suglia"}, "is_accepted": false, "score": 0, "last_activity_date": 1428660747, "last_edit_date": 1428660747, "creation_date": 1428140922, "answer_id": 29444964, "question_id": 29444817, "link": "https://stackoverflow.com/questions/29444817/go-how-can-i-check-for-type-equality/29444964#29444964", "title": "Go - How can I check for type equality?", "body": "<p>In <a href=\"https://golang.org/doc/effective_go.html#type_switch\" rel=\"nofollow\">Effective Go</a> you can find a really simple example of what you're trying to achieve. </p>\n\n<pre><code>var t interface{}\nt = functionOfSomeType()\n\nswitch t := t.(type) {\ndefault:\n    fmt.Printf(\"unexpected type %T\", t)       // %T prints whatever type t has\ncase bool:\n    fmt.Printf(\"boolean %t\\n\", t)             // t has type bool\ncase int:\n    fmt.Printf(\"integer %d\\n\", t)             // t has type int\ncase *bool:\n    fmt.Printf(\"pointer to boolean %t\\n\", *t) // t has type *bool\ncase *int:\n    fmt.Printf(\"pointer to integer %d\\n\", *t) // t has type *int\n}\n</code></pre>\n\n<p>If you have a single type that you have to check, use a simple <strong>if</strong>, otherwise use a switch for better readability.</p>\n"}], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3405, "favorite_count": 0, "accepted_answer_id": 29444890, "answer_count": 3, "score": 7, "last_activity_date": 1428660747, "creation_date": 1428139960, "question_id": 29444817, "link": "https://stackoverflow.com/questions/29444817/go-how-can-i-check-for-type-equality", "title": "Go - How can I check for type equality?", "body": "<p>Say I have the following code:</p>\n\n<pre><code>var x interface{}\ny := 4\nx = y\nfmt.Println(reflect.TypeOf(x))\n</code></pre>\n\n<p>This will print int as the type. My question is how can I test for the type? I know there is the type switch which does this, so I could do:</p>\n\n<pre><code>switch x.(type) {\ncase int:\n    fmt.Println(\"This is an int\")\n}\n</code></pre>\n\n<p>But if I only want to check for just one specific type the switch seems like the wrong tool. Is there a more direct method of doing this like</p>\n\n<pre><code>reflect.TypeOf(x) == int\n</code></pre>\n\n<p>or is the type switch the way to go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1428131937, "post_id": 29442710, "comment_id": 47055211, "body": "Note, except for special cases, in Go slices are far more common than arrays. Also, in this case consider using <code>uint16</code>."}], "answers": [{"tags": [], "owner": {"reputation": 253, "user_id": 4611478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99f943e18102d1616bccc1756ad9fe38?s=128&d=identicon&r=PG&f=1", "display_name": "user4611478", "link": "https://stackoverflow.com/users/4611478/user4611478"}, "is_accepted": false, "score": 1, "last_activity_date": 1428123331, "creation_date": 1428123331, "answer_id": 29442871, "question_id": 29442710, "link": "https://stackoverflow.com/questions/29442710/how-to-shift-byte-array-with-golang/29442871#29442871", "title": "How to shift byte array with Golang?", "body": "<p>Yep! I found a solution.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Byte [2]byte\n\n//shift left\nfunc SL(b Byte) Byte {\n    if b[0]&amp;0x80 == 0x80 {\n        b[0] &lt;&lt;= 1\n        if b[1]&amp;0x80 == 0x80 {\n            b[0] ^= 1\n            b[1] &lt;&lt;= 1\n        } else {\n            b[1] &lt;&lt;= 1\n        }\n        b[1] ^= 0x01\n    } else {\n        b[0] &lt;&lt;= 1\n        if b[1]&amp;0x80 == 0x80 {\n            b[0] ^= 1\n            b[1] &lt;&lt;= 1\n        } else {\n            b[1] &lt;&lt;= 1\n        }\n    }\n    return b\n}\n\nfunc main() {\n    //var b Byte\n    b := Byte{0x23, 0x86}\n    fmt.Printf(\"old byte %#08b %#08b\\n\", b[0], b[1]) // 00100011 10000110\n    c := SL(b)\n    fmt.Printf(\"new byte %#08b %#08b\", c[0], c[1]) // 01000111 00001100\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 253, "user_id": 4611478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99f943e18102d1616bccc1756ad9fe38?s=128&d=identicon&r=PG&f=1", "display_name": "user4611478", "link": "https://stackoverflow.com/users/4611478/user4611478"}, "edited": false, "score": 0, "creation_date": 1428133138, "post_id": 29443797, "comment_id": 47055426, "body": "Thanks, Dave C! Yes, I find later in docs about <code>uint16</code>. Confused. And your func more pretty than mine. My bad English not help me ), I mean <code>rotate</code> instead of <code>shift</code>. Sorry"}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 3, "last_activity_date": 1428131756, "creation_date": 1428131756, "answer_id": 29443797, "question_id": 29442710, "link": "https://stackoverflow.com/questions/29442710/how-to-shift-byte-array-with-golang/29443797#29443797", "title": "How to shift byte array with Golang?", "body": "<p>You appear to want to <em>rotate</em>, not shift. Any particular reason you aren't using a <code>uint16</code> type instead of <code>[2]byte</code>?</p>\n\n<p>Anyway, if you really want <code>[2]byte</code>, this is simpler and doesn't branch:</p>\n\n<pre><code>func rol(v [2]byte) [2]byte {\n    x := int(v[0])&lt;&lt;8 | int(v[1])\n    x &lt;&lt;= 1\n    v[0] = byte(x &gt;&gt; 8)\n    v[1] = byte((x &amp; 0xff) | x&gt;&gt;16)\n    return v\n}\n</code></pre>\n\n<p>If you want to do such operations on an arbitrary large number of bits you could use <code>math/big</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 957, "user_id": 3358215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7b541b809ba78476a25b4c086428add?s=128&d=identicon&r=PG", "display_name": "qin", "link": "https://stackoverflow.com/users/3358215/qin"}, "is_accepted": false, "score": 2, "last_activity_date": 1550023773, "creation_date": 1550023773, "answer_id": 54661438, "question_id": 29442710, "link": "https://stackoverflow.com/questions/29442710/how-to-shift-byte-array-with-golang/54661438#54661438", "title": "How to shift byte array with Golang?", "body": "<p>A solution to shift left 1 bit.</p>\n\n<pre><code>func shiftBytesLeft(a []byte) (dst []byte) {\n    n := len(a)\n    dst = make([]byte, n)\n    for i := 0; i &lt; n-1; i++ {\n        dst[i] = a[i] &lt;&lt; 1\n        dst[i] = (dst[i] &amp; 0xfe) | (a[i+1] &gt;&gt; 7)\n    }\n    dst[n-1] = a[n-1] &lt;&lt; 1\n    return dst\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 598, "user_id": 9552116, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Coconut", "link": "https://stackoverflow.com/users/9552116/coconut"}, "is_accepted": false, "score": 0, "last_activity_date": 1605196080, "creation_date": 1605196080, "answer_id": 64807162, "question_id": 29442710, "link": "https://stackoverflow.com/questions/29442710/how-to-shift-byte-array-with-golang/64807162#64807162", "title": "How to shift byte array with Golang?", "body": "<p>shift left by multiple bits, expanding qin's answer:</p>\n<pre><code>func shiftBytesLeft(a []byte, byBits int) (dst []byte) {\n    n := len(a)\n    dst = make([]byte, n)\n    for i := 0; i &lt; n-1; i++ {\n        dst[i] = a[i] &lt;&lt; byBits\n        dst[i] = (dst[i] &amp; (0xff - byte(byBits))) | (a[i+1] &gt;&gt; (8 - byte(byBits)))\n    }\n    dst[n-1] = a[n-1] &lt;&lt; byBits\n    return dst\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "is_accepted": false, "score": 0, "last_activity_date": 1610070873, "creation_date": 1610070873, "answer_id": 65622399, "question_id": 29442710, "link": "https://stackoverflow.com/questions/29442710/how-to-shift-byte-array-with-golang/65622399#65622399", "title": "How to shift byte array with Golang?", "body": "<p>Here's an implementation that can do both left and right shifts:</p>\n<pre><code>// ShiftLeft performs a left bit shift operation on the provided bytes.\n// If the bits count is negative, a right bit shift is performed.\nfunc ShiftLeft(data []byte, bits int) {\n    n := len(data)\n    if bits &lt; 0 {\n        bits = -bits\n        for i := n - 1; i &gt; 0; i-- {\n            data[i] = data[i]&gt;&gt;bits | data[i-1]&lt;&lt;(8-bits)\n        }\n        data[0] &gt;&gt;= bits\n    } else {\n        for i := 0; i &lt; n-1; i++ {\n            data[i] = data[i]&lt;&lt;bits | data[i+1]&gt;&gt;(8-bits)\n        }\n        data[n-1] &lt;&lt;= bits\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 253, "user_id": 4611478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99f943e18102d1616bccc1756ad9fe38?s=128&d=identicon&r=PG&f=1", "display_name": "user4611478", "link": "https://stackoverflow.com/users/4611478/user4611478"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4503, "favorite_count": 1, "accepted_answer_id": 29443797, "answer_count": 5, "score": 3, "last_activity_date": 1610070873, "creation_date": 1428121680, "question_id": 29442710, "link": "https://stackoverflow.com/questions/29442710/how-to-shift-byte-array-with-golang", "title": "How to shift byte array with Golang?", "body": "<p>Here simple working code to left shift first bit of a byte</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Byte byte\n\nfunc SL(b Byte) Byte {\n    if b&amp;0x80 == 0x80 {\n        b &lt;&lt;= 1\n        b ^= 0x01\n    } else {\n        b &lt;&lt;= 1\n    }\n    return b\n}\n\nfunc main() {\n    var b Byte\n    b = 0xD3\n    fmt.Printf(\"old byte %#08b\\n\", b) // 11010011\n    c := SL(b)\n    fmt.Printf(\"new byte %#08b\", c)   // 10100111\n}\n</code></pre>\n\n<p>What should I do to shift <strong>array</strong> of bytes, like\n<code>type Byte [2]byte</code>?</p>\n\n<p>Thanks for advance!</p>\n"}, {"tags": ["file", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 4, "creation_date": 1428115033, "post_id": 29442006, "comment_id": 47052251, "body": "<b>Never</b> ignore <code>error</code> return values! (Both from <code>os.Open</code> and check <code>scan.Err()</code> after the loop as well)."}, {"owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428115878, "post_id": 29442006, "comment_id": 47052390, "body": "I didn&#39;t know they had a scan.Err() as well, but now I see that it returns &quot;token too long.&quot;"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1428116407, "post_id": 29442006, "comment_id": 47052466, "body": "When I want to read the whole file anyway, sometimes I just use <a href=\"http://golang.org/pkg/syscall/#Mmap\" rel=\"nofollow noreferrer\"><code>syscall.Mmap</code></a>, like <a href=\"http://stackoverflow.com/a/28592330/2714852\">here</a>."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1428130261, "post_id": 29442006, "comment_id": 47054855, "body": "Yes, <a href=\"https://golang.org/pkg/bufio/#MaxScanTokenSize\" rel=\"nofollow noreferrer\"><code>const bufio.MaxScanTokenSize = 64*1024</code></a>. So you either need to use smaller tokens (e.g. a split function to tokenize on columns) or use a different reading method. BTW, do you want/need the whole contents in memory or are just doing per-line processing?"}], "answers": [{"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 5, "last_activity_date": 1428134036, "creation_date": 1428134036, "answer_id": 29444042, "question_id": 29442006, "link": "https://stackoverflow.com/questions/29442006/reading-in-very-large-files/29444042#29444042", "title": "Reading in very large files", "body": "<p>As already pointed out by @Dave C in the comments you are running into MaxScanTokenSize = 64 * 1024</p>\n\n<p>To get around that limitation, use bufio.Reader which has a ReadString(delim byte) method which seems appropriate for your case.</p>\n\n<p>From the Scanner go doc (specifically the last sentence):</p>\n\n<blockquote>\n  <p>Scanner provides a convenient interface for reading data such as a\n  file of newline-delimited lines of text. Successive calls to the Scan\n  method will step through the 'tokens' of a file, skipping the bytes\n  between the tokens. The specification of a token is defined by a split\n  function of type SplitFunc; the default split function breaks the\n  input into lines with line termination stripped. Split functions are\n  defined in this package for scanning a file into lines, bytes,\n  UTF-8-encoded runes, and space-delimited words. The client may instead\n  provide a custom split function.</p>\n  \n  <p>Scanning stops unrecoverably at EOF, the first I/O error, or a token\n  too large to fit in the buffer. When a scan stops, the reader may have\n  advanced arbitrarily far past the last token. Programs that need more\n  control over error handling or large tokens, or must run sequential\n  scans on a reader, should use bufio.Reader instead.</p>\n</blockquote>\n"}], "owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4400, "favorite_count": 2, "answer_count": 1, "score": 2, "last_activity_date": 1575278356, "creation_date": 1428113623, "last_edit_date": 1575278356, "question_id": 29442006, "link": "https://stackoverflow.com/questions/29442006/reading-in-very-large-files", "title": "Reading in very large files", "body": "<p>I'm trying to read in a file with 200+ columns and 1000+ rows. I use the following code: </p>\n\n<pre><code>var result []string\n\nfile, err := os.Open(\"t8.txt\")\nif (err != nil) {\n  fmt.Println(err)\n}\ndefer file.Close()\nscan := bufio.NewScanner(file)\nfor scan.Scan() {\n  result = append(result, scan.Text())\n\n}\n\n\nfmt.Println(scan.Err()) //token too long\n</code></pre>\n\n<p>However, when I print out the results, all I get is the first line because it says the token is too long. When I try it on smaller files, it works fine. Is there a way in Go that I could scan in large files? </p>\n"}, {"tags": ["go", "gorilla", "negroni"], "answers": [{"comments": [{"owner": {"reputation": 25268, "user_id": 384016, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/845f343c1d289a3ee6ea5140fef8a25b?s=128&d=identicon&r=PG", "display_name": "ryanzec", "link": "https://stackoverflow.com/users/384016/ryanzec"}, "edited": false, "score": 0, "creation_date": 1428142954, "post_id": 29443535, "comment_id": 47057771, "body": "This is what I was looking for.  I tweaked the route path line to look like <code>myMux.HandleFunc(&quot;&#47;static&#47;{cache_id}&#47;{filename:[a-zA-Z0-9\\\\.&zwnj;&#8203;\\\\-\\\\_\\\\&#47;]*}&quot;, FileServer)</code> so that is would be able to handle deep paths like <code>&#47;static&#47;8s7df65g87sd6f5g&#47;app&#47;test.html</code>.  I also agree that in production, I would be serving the Go application through something like nginx which would be able to better handle this type of thing but this application is designed to as a quick development server (something that works better than the python SimpleHTTPServer).  Thanks."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 3, "last_activity_date": 1428129584, "creation_date": 1428129584, "answer_id": 29443535, "question_id": 29441239, "link": "https://stackoverflow.com/questions/29441239/serving-files-from-static-url-with-go-negroni-gorilla-mux/29443535#29443535", "title": "Serving files from static url with Go / Negroni / Gorilla Mux", "body": "<p>Have you already decided on how to record/persist the \"random\" part of the URL? DB? In memory (i.e. not across restarts)? If not, <code>crypto/sha1</code> the file(s) on start-up, and store the resultant SHA-1 hash in a map/slice.</p>\n\n<p>Otherwise, a route like (assuming Gorilla) <code>r.Handle(\"/static/{cache_id}/{filename}\", YourFileHandler)</code> would work. </p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"mime\"\n    \"net/http\"\n    \"path/filepath\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc FileServer(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    id := vars[\"cache_id\"]\n\n    // Logging for the example\n    log.Println(id)\n\n    // Check if the id is valid, else 404, 301 to the new URL, etc - goes here!\n    // (this is where you'd look up the SHA-1 hash)\n\n    // Assuming it's valid\n    file := vars[\"filename\"]\n\n    // Logging for the example\n    log.Println(file)\n\n    // Super simple. Doesn't set any cache headers, check existence, avoid race conditions, etc.\n    w.Header().Set(\"Content-Type\", mime.TypeByExtension(filepath.Ext(file)))\n    http.ServeFile(w, r, \"/Users/matt/Desktop/\"+file)\n}\n\nfunc IndexHandler(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hello!\\n\"))\n}\n\nfunc main() {\n\n    r := mux.NewRouter()\n\n    r.HandleFunc(\"/\", IndexHandler)\n    r.HandleFunc(\"/static/{cache_id}/{filename}\", FileServer)\n\n    log.Fatal(http.ListenAndServe(\":4000\", r))\n}\n</code></pre>\n\n<p>That should work out of the box, but I can't promise it's production ready. Personally, I just use nginx to serve my static files and benefit from it's file handler cache, solid gzip implementation, etc, etc.</p>\n"}, {"tags": [], "owner": {"reputation": 93, "user_id": 236964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73d165a5cd45139879be2b1eeab94d2d?s=128&d=identicon&r=PG", "display_name": "Stephan Olmer", "link": "https://stackoverflow.com/users/236964/stephan-olmer"}, "is_accepted": false, "score": 1, "last_activity_date": 1566917743, "creation_date": 1566917743, "answer_id": 57677430, "question_id": 29441239, "link": "https://stackoverflow.com/questions/29441239/serving-files-from-static-url-with-go-negroni-gorilla-mux/57677430#57677430", "title": "Serving files from static url with Go / Negroni / Gorilla Mux", "body": "<p>I know it's too late but maybe my answer will help someone too. I've found a library <a href=\"https://github.com/catcombo/go-staticfiles\" rel=\"nofollow noreferrer\">go-staticfiles</a> which implements static files caching and versioning by adding a hash to the file names. Thus it is possible to set long time cache for assets files and when they changes get fresh copy instantly. Also it is easy to implement template function to convert link to static file <code>{{static \"css/style.css\"}}</code> to a real path <code>/static/css/style.d41d8cd98f00b204e9800998ecf8427e.css</code>. Read more examples in <a href=\"https://github.com/catcombo/go-staticfiles\" rel=\"nofollow noreferrer\">README</a></p>\n"}], "owner": {"reputation": 25268, "user_id": 384016, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/845f343c1d289a3ee6ea5140fef8a25b?s=128&d=identicon&r=PG", "display_name": "ryanzec", "link": "https://stackoverflow.com/users/384016/ryanzec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1702, "favorite_count": 2, "accepted_answer_id": 29443535, "answer_count": 2, "score": 0, "last_activity_date": 1566917743, "creation_date": 1428105225, "question_id": 29441239, "link": "https://stackoverflow.com/questions/29441239/serving-files-from-static-url-with-go-negroni-gorilla-mux", "title": "Serving files from static url with Go / Negroni / Gorilla Mux", "body": "<p>So I am new to Go and trying it out to build a simple web server.  One part I am having trouble with is that I want to serve static files with dynamic static urls (to enable long caching by the browser).  For example, I might have this url:</p>\n\n<p><code>/static/876dsf5g87s6df5gs876df5g/application.js</code></p>\n\n<p>But I want to serve the file located at:</p>\n\n<p><code>/build/application.js</code></p>\n\n<p>How would I go about this with Go / Negroni / Gorilla Mux?</p>\n"}, {"tags": ["xml", "go", "marshalling"], "answers": [{"tags": [], "owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "is_accepted": false, "score": 0, "last_activity_date": 1428619544, "creation_date": 1428619544, "answer_id": 29550354, "question_id": 29441029, "link": "https://stackoverflow.com/questions/29441029/golang-xml-marshal-appending-items-with-deeper/29550354#29550354", "title": "Golang xml marshal appending items with deeper?", "body": "<pre><code>type Thing struct {\n    stuff string `xml:\"stuff\"`\n}\n\ntype Staff struct {\n    XMLName xml.Name `xml:\"staff\"`\n    ID int `xml:\"id\"`\n    FirstName string `xml:\"firstname\"`\n    LastName string `xml:\"lastname\"`\n    UserName string `xml:\"username\"`\n    Thing Thing `xml:\"thing\"`\n}\n\nstuff := Thing{Stuff: \"120\"}\nv.Staffs = append(v.Staffs, Staff{ID: 108, FirstName: \"Jennifer\", LastName: \"Loh\", UserName: \"jenniferloh\", Thing: stuff})\n</code></pre>\n"}], "owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 425, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1428619544, "creation_date": 1428103573, "question_id": 29441029, "link": "https://stackoverflow.com/questions/29441029/golang-xml-marshal-appending-items-with-deeper", "title": "Golang xml marshal appending items with deeper?", "body": "<p>I am going off an example here: \n<a href=\"https://www.socketloop.com/tutorials/golang-create-new-xml-file\" rel=\"nofollow\">https://www.socketloop.com/tutorials/golang-create-new-xml-file</a></p>\n\n<p>What if it goes one more deep after Staff?</p>\n\n<pre><code>type Staff struct {\nXMLName xml.Name `xml:\"staff\"`\nID int `xml:\"id\"`\nFirstName string `xml:\"firstname\"`\nLastName string `xml:\"lastname\"`\nUserName string `xml:\"username\"`\nThing Thing `xml:\"thing\"`\n}\n</code></pre>\n\n<p>How would I append? I've tried something like this:</p>\n\n<pre><code>v.Staffs = append(v.Staffs, Staff{ID: 108, FirstName: \"Jennifer\", LastName: \"Loh\", UserName: \"jenniferloh\", Thing.tape: \"scotch\"})\n</code></pre>\n\n<p>But only making two statements that iterate with the loop worked and its ugly:</p>\n\n<pre><code>v.Staffs = append(v.Staffs, Staff{ID: 108, FirstName: \"Jennifer\", LastName:    \"Loh\", UserName: \"jenniferloh\"})\n\nv.Staffs.Thing[i] = append(v.Staffs.Thing, Thing{scotch: \"tape\"})\n</code></pre>\n\n<p>Is there a better way to do this? Thanks.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1428094032, "creation_date": 1428094032, "answer_id": 29439458, "question_id": 29439311, "link": "https://stackoverflow.com/questions/29439311/go-embedded-custom-interfaces/29439458#29439458", "title": "Go embedded custom interfaces", "body": "<p>You're not embedding the interfaces, you're making them fields in your struct.</p>\n\n<p>Embedding looks like:</p>\n\n<pre><code>type MyReader struct {\n    io.Reader\n}\n</code></pre>\n\n<p>If you want to manually delegate to the interface, you need to use the same method name</p>\n\n<pre><code>func (m MyReader) Read(b []byte) (n int, err error) {\n    return m.r.Read(b)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5954, "user_id": 230392, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uwtL7.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/230392/jeff"}, "edited": false, "score": 0, "creation_date": 1428097230, "post_id": 29439587, "comment_id": 47048755, "body": "One thing that I would eventually like to do is write something to <code>MyReadWriteCloser</code> and have <code>MyWriter</code> encrypt whatever it is I&#39;m writing.   The only way I can imagine this working is by writing my own <code>Write</code> method and calling <code>Write</code> on the underlying writer from within my custom <code>Write</code> method which is why I had <code>m.w.Write(b)</code>.  If I remove <code>w</code> from my struct then I have no way (at least I don&#39;t think I do) of writing to the underlying writer.  Hope that makes sense because I keep going in circles in my mind trying to figure this out.  Sorry if my terminology is wrong."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 5954, "user_id": 230392, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uwtL7.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/230392/jeff"}, "edited": false, "score": 0, "creation_date": 1428097401, "post_id": 29439587, "comment_id": 47048810, "body": "@Jeff I&#39;ll edit with an example doing that, the answer is here <a href=\"http://stackoverflow.com/questions/20861786/golang-struct-calling-embedded-type-methods-when-method-has-been-overloaded\" title=\"golang struct calling embedded type methods when method has been overloaded\">stackoverflow.com/questions/20861786/&hellip;</a>"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 0, "last_activity_date": 1429359533, "last_edit_date": 1429359533, "creation_date": 1428094721, "answer_id": 29439587, "question_id": 29439311, "link": "https://stackoverflow.com/questions/29439311/go-embedded-custom-interfaces/29439587#29439587", "title": "Go embedded custom interfaces", "body": "<p>Your syntax is wrong so the interfaces/types are not actually being imbedded.</p>\n\n<pre><code>type MyWriter struct {\n    w io.Writer\n}\n</code></pre>\n\n<p>should be</p>\n\n<pre><code>type MyWriter struct {\n    io.Writer\n}\n</code></pre>\n\n<p>And based on my understanding a proper embed leaves you no reason to define a method like;</p>\n\n<pre><code>func (m MyWriter) Write(b []byte) (n int, err error) {\n    m.w.Write(b)\n    return\n}\n</code></pre>\n\n<p>because the body would just be <code>m.Write(b)</code> so that just doesn't make sense. If you embed a type the embedding type will be able to call methods from the embedded type directly (it's the nearest thing to inheritance, it looks the same to a casual reader). I don't remember the resolution rules if there are conflicts between method or property names in embedded types or the embedding type an embedded type but a good rule of thumb would be to avoid embedding types that will cause naming conflicts because the behavior will not be obvious.</p>\n\n<p>EDIT:\nExample of how to override a method in the underlying type and invoke the 'base' (i quote cause some gophers might be offended by that word choice) method from inside it;</p>\n\n<pre><code>func (m MyWriter) Write(b []byte) (n int, err error) {\n     b = EncodeBFromMethodThatsInScopeHere(b)\n     return m.Writer.Write(b)\n}\n</code></pre>\n\n<p>Basically, if you want to explicitly use the embedded types method you can refer to it as a property of the type using the embedded types type as if it were a property name.</p>\n"}], "owner": {"reputation": 5954, "user_id": 230392, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uwtL7.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/230392/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 29439587, "answer_count": 2, "score": -1, "last_activity_date": 1429359533, "creation_date": 1428093270, "last_edit_date": 1428097305, "question_id": 29439311, "link": "https://stackoverflow.com/questions/29439311/go-embedded-custom-interfaces", "title": "Go embedded custom interfaces", "body": "<p>I'm trying to understand Go's interfaces and embedding.</p>\n\n<p>What I'm trying to do here is create my own custom <code>writer</code> and <code>reader</code>  where each one implements either <code>io.Writer</code> or <code>io.Reader</code> </p>\n\n<p>Now I want to take these custom structures that implement basic interfaces and embed them into another custom struct that implements <code>Read/Write/Close</code>.  The below code is what I have so far but when I run it I get the following error </p>\n\n<p><code>cannot use test (type MyReadWriteCloser) as type io.Writer in argument to fmt.Fprintf:\n    MyReadWriteCloser does not implement io.Writer (missing Write method)</code></p>\n\n<p>I thought when you embed a structure within another structure you also get the methods of the embedded structures.  Can someone tell me what I'm missing?</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\"io\"\n)\n\ntype MyWriter struct {\n    w io.Writer\n}\n\nfunc (m MyWriter) Write(b []byte) (n int, err error) {\n    // encrypt b and write to underlying writer\n    m.w.Write(b)\n    return\n}\n\ntype MyReader struct {\n    r io.Reader\n}\n\nfunc (m MyReader) Read(b []byte) (n int, err error) {\n    // decrypt b\n    m.r.Read(b)\n    return\n}\n\ntype MyReadWriteCloser struct {\n    MyWriter\n    MyReader\n}\n\nfunc (m MyReadWriteCloser) Close() error {\n    return nil\n}\n\nfunc main() {\n    fmt.Println(\"main start\")\n\n    r, w := io.Pipe()\n\n    test := MyReadWriteCloser{\n        MyWriter{w},\n        MyReader{r},\n    }\n    fmt.Fprintf(test, \"hello world\\n\")\n} \n</code></pre>\n"}, {"tags": ["object", "interface", "go", "lang"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1428093207, "post_id": 29439208, "comment_id": 47047276, "body": "If you want <code>Complex</code> to be an <code>Interval</code>, it needs to implement all the functions described in the interface definition. What are you having trouble with?"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 2, "creation_date": 1428112219, "post_id": 29439208, "comment_id": 47051858, "body": "Okan, welcome to stack overflow. This link provides help on how to ask a good question: <a href=\"http://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a> ."}, {"owner": {"reputation": 31334, "user_id": 74015, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/4b7088749adc3ec3e51982d0a3bf1b34?s=128&d=identicon&r=PG&f=1", "display_name": "Sam Axe", "link": "https://stackoverflow.com/users/74015/sam-axe"}, "edited": false, "score": 1, "creation_date": 1428236442, "post_id": 29439208, "comment_id": 47078691, "body": "Defacing your question is not acceptable."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 2116279, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/90dc7f110e8514b401a45c671633e58a?s=128&d=identicon&r=PG&f=1", "display_name": "Okan Albayrak", "link": "https://stackoverflow.com/users/2116279/okan-albayrak"}, "edited": false, "score": 0, "creation_date": 1428133447, "post_id": 29440735, "comment_id": 47055482, "body": "I want to implement the average from x and y. How should i implement it"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 0, "last_activity_date": 1428101527, "creation_date": 1428101527, "answer_id": 29440735, "question_id": 29439208, "link": "https://stackoverflow.com/questions/29439208/implementation-interfaces-in-golang/29440735#29440735", "title": "implementation interfaces in golang", "body": "<p>I can't really tell what you are actually trying to do here, but there were several issues with the code</p>\n\n<ol>\n<li>a and b were not defined, I added them to complex to get it to compile</li>\n<li>a &lt;= r &lt;= b is not valid in go, changed that</li>\n<li>You had a main, so I assume that you meant this to be the runnable app.  Package needs to be called \"main\" for it to be directly runnable.</li>\n</ol>\n\n<p>May not be what you want, but it now compiles and runs (but doesn't do anything since main is empty)</p>\n\n<p><a href=\"http://play.golang.org/p/sOA7SVJY01\" rel=\"nofollow\">Here it is on play</a></p>\n\n<pre><code>package main\n\n//import \"fmt\"\n\ntype Intervall interface {\n    contains(r float64) bool // if r is in x, then true\n    average(Y Intervall) (Intervall, error)\n    String() string                    //cast interval\"[a,b]\" to [a,b]\n    completecontains(Y Intervall) bool //if y is completely in x, give true\n    New(a, b float64) Intervall\n}\n\ntype Complex struct {\n    first int\n    a     float64\n    b     float64\n}\n\nfunc (c Complex) contains(r float64) bool {\n\n    if c.a &lt;= r &amp;&amp; r &lt;= c.b {\n        return true\n    } else {\n        return false\n    }\n}\n\nfunc (c Complex) String() string {\n    return \"a\"\n\n}\nfunc (c Complex) length() float64 {\n    return 2.3\n}\n\nfunc main() {\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1763, "user_id": 624010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2835aa961ed87f794876ae2f2e74a2b4?s=128&d=identicon&r=PG", "display_name": "SteveMcQwark", "link": "https://stackoverflow.com/users/624010/stevemcqwark"}, "reply_to_user": {"reputation": 55, "user_id": 2116279, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/90dc7f110e8514b401a45c671633e58a?s=128&d=identicon&r=PG&f=1", "display_name": "Okan Albayrak", "link": "https://stackoverflow.com/users/2116279/okan-albayrak"}, "edited": false, "score": 0, "creation_date": 1428132878, "post_id": 29442330, "comment_id": 47055380, "body": "Okay. Are there any aspects of my answer which are helpful or confusing?"}, {"owner": {"reputation": 1763, "user_id": 624010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2835aa961ed87f794876ae2f2e74a2b4?s=128&d=identicon&r=PG", "display_name": "SteveMcQwark", "link": "https://stackoverflow.com/users/624010/stevemcqwark"}, "reply_to_user": {"reputation": 55, "user_id": 2116279, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/90dc7f110e8514b401a45c671633e58a?s=128&d=identicon&r=PG&f=1", "display_name": "Okan Albayrak", "link": "https://stackoverflow.com/users/2116279/okan-albayrak"}, "edited": false, "score": 0, "creation_date": 1428133584, "post_id": 29442330, "comment_id": 47055509, "body": "I can&#39;t find any reference for an average of two intervals expressed as an interval. Do you mean, given [1,3] and [6,9], you want [4,5]?"}, {"owner": {"reputation": 1763, "user_id": 624010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2835aa961ed87f794876ae2f2e74a2b4?s=128&d=identicon&r=PG", "display_name": "SteveMcQwark", "link": "https://stackoverflow.com/users/624010/stevemcqwark"}, "reply_to_user": {"reputation": 55, "user_id": 2116279, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/90dc7f110e8514b401a45c671633e58a?s=128&d=identicon&r=PG&f=1", "display_name": "Okan Albayrak", "link": "https://stackoverflow.com/users/2116279/okan-albayrak"}, "edited": false, "score": 0, "creation_date": 1428134501, "post_id": 29442330, "comment_id": 47055709, "body": "Do you care about open vs closed intervals? Technically, between [1,3] and [6,9] is (3,6). Giving [3,6] as the answer is easier, but you could create a bunch of types representing open, closed, half open, etc... intervals to make it more precise."}], "tags": [], "owner": {"reputation": 1763, "user_id": 624010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2835aa961ed87f794876ae2f2e74a2b4?s=128&d=identicon&r=PG", "display_name": "SteveMcQwark", "link": "https://stackoverflow.com/users/624010/stevemcqwark"}, "is_accepted": false, "score": 0, "last_activity_date": 1428136769, "last_edit_date": 1428136769, "creation_date": 1428117231, "answer_id": 29442330, "question_id": 29439208, "link": "https://stackoverflow.com/questions/29439208/implementation-interfaces-in-golang/29442330#29442330", "title": "implementation interfaces in golang", "body": "<p>Not sure why the concrete interval is called \"Complex\" or what the average of two intervals might be, but this is as close as I can get. Also, not sure what the benefit of using an interface is here.</p>\n\n<p><a href=\"http://play.golang.org/p/sxFRkJZCFa\" rel=\"nofollow\">http://play.golang.org/p/sxFRkJZCFa</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Interval interface {\n    Contains(r float64) bool\n    Average(y Interval) (Interval, error)\n    String() string\n    CompletelyContains(y Interval) bool\n    CompletelyContainedBy(y Interval) bool\n}\n\ntype Complex struct {\n    a, b float64\n}\n\nfunc (c Complex) Contains(r float64) bool {\n    return c.a &lt;= r &amp;&amp; r &lt;= c.b\n}\n\nfunc (c Complex) Average(y Interval) (Interval, error) {\n    return nil, fmt.Errorf(\"What the heck is the average of two intervals?\")\n}\n\nfunc (c Complex) CompletelyContains(y Interval) bool {\n    return y.CompletelyContainedBy(c)\n}\n\nfunc (c Complex) CompletelyContainedBy(y Interval) bool {\n    return y.Contains(c.a) &amp;&amp; y.Contains(c.b)\n}\n\nfunc (c Complex) String() string {\n    return fmt.Sprintf(\"[%v,%v]\", c.a, c.b)\n}\n\nfunc main() {\n    var x Interval = Complex{a: 1, b: 5.1}\n    var y Interval = Complex{a: 1.3, b: 5}\n    fmt.Println(\"x contains 3:\", x.Contains(3))\n    fmt.Println(\"x completely contains y:\", x.CompletelyContains(y))\n\n    avg, err := x.Average(y)\n    fmt.Println(\"Average of x and y:\", avg, \"with error:\", err)\n\n    fmt.Println(\"x:\", x)\n\n}\n</code></pre>\n\n<p>Edit: Here's a sillily complex way of implementing \"Average\" the way you want it. The complexity comes from avoiding directly accessing y.a and y.b, which would defeat the purpose of using an interface (if there is one).</p>\n\n<p><a href=\"http://play.golang.org/p/Tc5YCciLWq\" rel=\"nofollow\">http://play.golang.org/p/Tc5YCciLWq</a></p>\n"}], "owner": {"reputation": 55, "user_id": 2116279, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/90dc7f110e8514b401a45c671633e58a?s=128&d=identicon&r=PG&f=1", "display_name": "Okan Albayrak", "link": "https://stackoverflow.com/users/2116279/okan-albayrak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1130, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1429660394, "creation_date": 1428092753, "last_edit_date": 1429660394, "question_id": 29439208, "link": "https://stackoverflow.com/questions/29439208/implementation-interfaces-in-golang", "title": "implementation interfaces in golang", "body": "<p>I want to implement the interface shown below. I don't know how to begin. Can someone show me how the functions should be implemented?</p>\n\n<pre><code>package interval\npackage main\n\ntype Interval interface {\n    contains(r float64) bool // if r is in x, then true\n    average(Y Intervall) (Intervall, error)\n    String() string                    //cast interval\"[a,b]\" to [a,b]\n    completecontains(Y Intervall) bool //if y is completely in x, give true\n    New(a, b float64) Intervall\n    //var a int\n}\ntype Complex struct {\n    first int\n}\n\nfunc (c Complex) contains(r float64) bool {\n    if a &lt;= r &lt;= b {\n        return true\n    } else {\n        return false\n    }\n}\n\nfunc (c Complex) String() string {\n    return \"a\"\n}\n\nfunc (c Complex) length() float64 {\n    return 2.3\n}\n\nfunc main() {\n}\n</code></pre>\n"}, {"tags": ["go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 21722, "user_id": 357705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9cb8f635bfd71c18b91e1b0ed5d2ee9?s=128&d=identicon&r=PG", "display_name": "jimt", "link": "https://stackoverflow.com/users/357705/jimt"}, "edited": false, "score": 2, "creation_date": 1428094163, "post_id": 29438982, "comment_id": 47047671, "body": "Alternaively (if available): <code>&#47;&#47; #cgo pkg-config: onelib anotherlib</code>"}, {"owner": {"reputation": 717, "user_id": 1040642, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/725aff9a1cb57a37d8502833bd607ea3?s=128&d=identicon&r=PG", "display_name": "localhost", "link": "https://stackoverflow.com/users/1040642/localhost"}, "edited": false, "score": 0, "creation_date": 1428095592, "post_id": 29438982, "comment_id": 47048157, "body": "This works for all minus <code>-L&#47;home&#47;vagrant&#47;open_jtalk&#47;mecab&#47;src -llibmecab</code> :  <b>/usr/bin/ld: cannot find -llibmecab</b>. And I have <b>libmecab</b> on that folder and in <code>&#47;usr&#47;local&#47;lib&#47;</code>, both static and dynamic."}, {"owner": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "edited": false, "score": 2, "creation_date": 1428095951, "post_id": 29438982, "comment_id": 47048292, "body": "How about -lmecab (remove the lib)?"}], "tags": [], "owner": {"reputation": 30089, "user_id": 22147, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/x74x2.png?s=128&g=1", "display_name": "Rhythmic Fistman", "link": "https://stackoverflow.com/users/22147/rhythmic-fistman"}, "is_accepted": true, "score": 12, "last_activity_date": 1428095988, "last_edit_date": 1428095988, "creation_date": 1428091674, "answer_id": 29438982, "question_id": 29438761, "link": "https://stackoverflow.com/questions/29438761/cgo-undefined-reference-in-included-files/29438982#29438982", "title": "CGO undefined reference in included files", "body": "<p>You need to add cgo linker options (<code>LDFLAGS</code>) with the path to and the name of your library. e.g.</p>\n\n<pre><code>// #cgo CFLAGS: -Iyour-include-path\n// #cgo LDFLAGS: -Lyour-library-path -lyour-library-name-minus-the-lib-part\n</code></pre>\n"}], "owner": {"reputation": 717, "user_id": 1040642, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/725aff9a1cb57a37d8502833bd607ea3?s=128&d=identicon&r=PG", "display_name": "localhost", "link": "https://stackoverflow.com/users/1040642/localhost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7907, "favorite_count": 2, "accepted_answer_id": 29438982, "answer_count": 1, "score": 3, "last_activity_date": 1428095988, "creation_date": 1428090643, "question_id": 29438761, "link": "https://stackoverflow.com/questions/29438761/cgo-undefined-reference-in-included-files", "title": "CGO undefined reference in included files", "body": "<p>Wraping up OpenJtalk in Go, files are successfully included and types are referenced without an issue, but functions trigger an <code>undefined reference</code> error.</p>\n\n<p>jtalk.go:</p>\n\n<pre><code>package main\n\n// #cgo CFLAGS: -I/home/vagrant/open_jtalk/njd [...etc]\n/*\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdarg.h&gt;\n#include &lt;string.h&gt;\n#include &lt;math.h&gt;\n\n// Main headers \n#include \"mecab.h\"\n#include \"njd.h\"\n#include \"jpcommon.h\"\n#include \"HTS_engine.h\"\n\n// Sub headers \n#include \"text2mecab.h\"\n#include \"mecab2njd.h\"\n#include \"njd_set_pronunciation.h\"\n#include \"njd_set_digit.h\"\n#include \"njd_set_accent_phrase.h\"\n#include \"njd_set_accent_type.h\"\n#include \"njd_set_unvoiced_vowel.h\"\n#include \"njd_set_long_vowel.h\"\n#include \"njd2jpcommon.h\"\n*/\nimport \"C\"\n\ntype Open_JTalk struct {\n   mecab C.Mecab           each of these struct references are fine\n   njd C.NJD \n   jpcommon C.JPCommon \n   engine C.HTS_Engine \n}\n\nfunc (open_jtalk *Open_JTalk) Open_JTalk_initialize() {\n   C.Mecab_initialize(&amp;open_jtalk.mecab)             // when any function is called the error happens\n   C.NJD_initialize(&amp;open_jtalk.njd)\n   C.JPCommon_initialize(&amp;open_jtalk.jpcommon)\n   C.HTS_Engine_initialize(&amp;open_jtalk.engine)\n}\n\nfunc main() {\n\n}\n</code></pre>\n\n<p>And the weird part is that those same functions are declared right after the types:</p>\n\n<p>mecab.h</p>\n\n<pre><code>// line 1584\ntypedef struct _Mecab{\n   char **feature;\n   int size;\n   mecab_t *mecab;\n} Mecab;\n\nBOOL Mecab_initialize(Mecab *m);\n</code></pre>\n\n<p>Project webpage: <a href=\"http://open-jtalk.sourceforge.net/\" rel=\"nofollow\">http://open-jtalk.sourceforge.net/</a></p>\n"}, {"tags": ["c", "linux", "go"], "comments": [{"owner": {"reputation": 1459, "user_id": 669567, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/VOmJA.jpg?s=128&g=1", "display_name": "holgac", "link": "https://stackoverflow.com/users/669567/holgac"}, "edited": false, "score": 0, "creation_date": 1428082991, "post_id": 29436836, "comment_id": 47043013, "body": "For example, gcc has a -I flag that when you <code>-I&#47;your&#47;new&#47;headers</code>, you&#39;d be adding this folder to the list of header directories. That&#39;s the way I&#39;ve seen in many projects. It&#39;s also easier to setup a working environment to a new system."}, {"owner": {"reputation": 717, "user_id": 1040642, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/725aff9a1cb57a37d8502833bd607ea3?s=128&d=identicon&r=PG", "display_name": "localhost", "link": "https://stackoverflow.com/users/1040642/localhost"}, "reply_to_user": {"reputation": 1459, "user_id": 669567, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/VOmJA.jpg?s=128&g=1", "display_name": "holgac", "link": "https://stackoverflow.com/users/669567/holgac"}, "edited": false, "score": 0, "creation_date": 1428086786, "post_id": 29436836, "comment_id": 47044668, "body": "This works. If you right as an answer I&#39;ll mark it as correct. Go also seems to required the include and cflags commented lines to be one line above the <code>import &quot;C&quot;</code> or else it doesn&#39;t work."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1428092564, "post_id": 29436836, "comment_id": 47046985, "body": "These requirements are documented. Please read the manual for more detail."}], "answers": [{"tags": [], "owner": {"reputation": 1459, "user_id": 669567, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/VOmJA.jpg?s=128&g=1", "display_name": "holgac", "link": "https://stackoverflow.com/users/669567/holgac"}, "is_accepted": true, "score": 1, "last_activity_date": 1428093962, "creation_date": 1428093962, "answer_id": 29439449, "question_id": 29436836, "link": "https://stackoverflow.com/questions/29436836/adding-files-to-usr-local-include/29439449#29439449", "title": "Adding files to /usr/local/include", "body": "<p>It's usually not a good idea to change locations of external libraries. Some libraries automatically put themselves in include paths of compilers but for those that don't, adding their paths to the compilers' include paths is always a better idea.</p>\n\n<p>For example, in gcc, you can <code>gcc -I/your/header/directory</code> to include your directory. Usually people put those info in the Makefile. This way, you can put external libraries' source code in your repository and just tell compiler to also look for the headers there. This way, when setting up a new working environment, all you have to do is pull from the repository.</p>\n"}], "owner": {"reputation": 717, "user_id": 1040642, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/725aff9a1cb57a37d8502833bd607ea3?s=128&d=identicon&r=PG", "display_name": "localhost", "link": "https://stackoverflow.com/users/1040642/localhost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2450, "favorite_count": 0, "accepted_answer_id": 29439449, "answer_count": 1, "score": 1, "last_activity_date": 1600309524, "creation_date": 1428081703, "question_id": 29436836, "link": "https://stackoverflow.com/questions/29436836/adding-files-to-usr-local-include", "title": "Adding files to /usr/local/include", "body": "<p>I recently installed openjtalk on a linux machine, and I want to be able to wrap it in Go. The source files for openjtalk have several subfolders with different sources, which I assume are found by the compiler because of the make files.</p>\n\n<p>Should I copy each of those sub-folders into <code>/usr/local/include</code>? Is that a \"correct\" way of fixing include dependencies. From what I tested, Go seems to find the included files if I copy them, but I'm not sure if this is the correct, linux way of doing things.</p>\n"}, {"tags": ["orm", "go", "go-gorm"], "comments": [{"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1428109911, "post_id": 29435783, "comment_id": 47051536, "body": "What&#39;s in the database? Also, did you try the <code>Related</code> function?"}, {"owner": {"reputation": 11628, "user_id": 1373105, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Wgf7P.jpg?s=128&g=1", "display_name": "Javier Cadiz", "link": "https://stackoverflow.com/users/1373105/javier-cadiz"}, "reply_to_user": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1428119044, "post_id": 29435783, "comment_id": 47052883, "body": "@robbrit I have improved the question to reflect the database sample data. No, but i tried now the <code>Related</code> function and still i haven&#39;t succeed to get the expected result."}], "answers": [{"comments": [{"owner": {"reputation": 11628, "user_id": 1373105, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Wgf7P.jpg?s=128&g=1", "display_name": "Javier Cadiz", "link": "https://stackoverflow.com/users/1373105/javier-cadiz"}, "edited": false, "score": 2, "creation_date": 1428355570, "post_id": 29479009, "comment_id": 47120569, "body": "Great. Is working now after reading this answer. Just one additional note/question. This approach seems to have a n+1 problem issue since for every place we are getting an additional query. Is this the proper behavior ?"}, {"owner": {"reputation": 2741, "user_id": 842077, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/9b1f84f21accf057a5683c53ac0f8b59?s=128&d=identicon&r=PG", "display_name": "olif", "link": "https://stackoverflow.com/users/842077/olif"}, "reply_to_user": {"reputation": 11628, "user_id": 1373105, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Wgf7P.jpg?s=128&g=1", "display_name": "Javier Cadiz", "link": "https://stackoverflow.com/users/1373105/javier-cadiz"}, "edited": false, "score": 0, "creation_date": 1428394731, "post_id": 29479009, "comment_id": 47133233, "body": "If you dont&#39;t want to specify a join yourself I am afraid that this is the only way using Gorm, and yes, then you will have a n+1 issue. Gorm does support joins as a thin wrapper over sql: <a href=\"https://github.com/jinzhu/gorm#joins\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm#joins</a> but then you have to specify the query."}, {"owner": {"reputation": 11628, "user_id": 1373105, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Wgf7P.jpg?s=128&g=1", "display_name": "Javier Cadiz", "link": "https://stackoverflow.com/users/1373105/javier-cadiz"}, "edited": false, "score": 1, "creation_date": 1428441882, "post_id": 29479009, "comment_id": 47161414, "body": "I don&#39;t have any issue about implementing a join by myself but if i do so i will need to create another struct just to handle the query result. I just want to reuse the two existing ones. Is my assumption ok ?"}], "tags": [], "owner": {"reputation": 2741, "user_id": 842077, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/9b1f84f21accf057a5683c53ac0f8b59?s=128&d=identicon&r=PG", "display_name": "olif", "link": "https://stackoverflow.com/users/842077/olif"}, "is_accepted": false, "score": 6, "last_activity_date": 1428351636, "creation_date": 1428351636, "answer_id": 29479009, "question_id": 29435783, "link": "https://stackoverflow.com/questions/29435783/gorm-golang-orm-associations/29479009#29479009", "title": "Gorm Golang orm associations", "body": "<p>You do not specify the foreign key of towns in your Place struct. Simply add TownId to your Place struct and it should work.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/mattn/go-sqlite3\"\n)\n\ntype Place struct {\n    Id     int\n    Name   string\n    Town   Town\n    TownId int //Foregin key\n}\n\ntype Town struct {\n    Id   int\n    Name string\n}\n\nfunc main() {\n    db, _ := gorm.Open(\"sqlite3\", \"./data.db\")\n    defer db.Close()\n\n    db.CreateTable(&amp;Place{})\n    db.CreateTable(&amp;Town{})\n    t := Town{\n        Name: \"TestTown\",\n    }\n\n    p1 := Place{\n        Name:   \"Test\",\n        TownId: 1,\n    }\n\n    p2 := Place{\n        Name:   \"Test2\",\n        TownId: 1,\n    }\n\n    err := db.Save(&amp;t).Error\n    err = db.Save(&amp;p1).Error\n    err = db.Save(&amp;p2).Error\n    if err != nil {\n        panic(err)\n    }\n\n    places := []Place{}\n    err = db.Find(&amp;places).Error\n    for i, _ := range places {\n        db.Model(places[i]).Related(&amp;places[i].Town)\n    }\n    if err != nil {\n        panic(err)\n    } else {\n        fmt.Println(places)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1778, "user_id": 2303988, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/VcVRc.jpg?s=128&g=1", "display_name": "Alessio", "link": "https://stackoverflow.com/users/2303988/alessio"}, "edited": false, "score": 3, "creation_date": 1433775003, "post_id": 29579994, "comment_id": 49482141, "body": "Am I wrong or Gorm does not create the FK in the DB?"}, {"owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "edited": false, "score": 0, "creation_date": 1443500140, "post_id": 29579994, "comment_id": 53506726, "body": "Alessio, did you sort that out?"}, {"owner": {"reputation": 2509, "user_id": 1629278, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/a759fb62eff73d12b00073f20148ccbc?s=128&d=identicon&r=PG", "display_name": "Rafael Reyes", "link": "https://stackoverflow.com/users/1629278/rafael-reyes"}, "edited": false, "score": 1, "creation_date": 1576028660, "post_id": 29579994, "comment_id": 104762417, "body": "Is the eager load a bad practice in terms of performance? I mean, you are retrieving all the records from the Town table every time the find function executes."}, {"owner": {"reputation": 413, "user_id": 10468419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2Cjng.jpg?s=128&g=1", "display_name": "Alveona", "link": "https://stackoverflow.com/users/10468419/alveona"}, "reply_to_user": {"reputation": 1778, "user_id": 2303988, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/VcVRc.jpg?s=128&g=1", "display_name": "Alessio", "link": "https://stackoverflow.com/users/2303988/alessio"}, "edited": false, "score": 2, "creation_date": 1588430417, "post_id": 29579994, "comment_id": 108894816, "body": "@Alessio yes, it doesn&#39;t. If you want Foreign Key in DB, you need explicitly write something like <code>db.Model(&amp;Place{}).AddForeignKey(&quot;town_id&quot;, &quot;towns(id)&quot;, &quot;RESTRICT&quot;, &quot;RESTRICT&quot;)</code> during your migrations. Yep, I know it&#39;s almost 5 years since your question, but let it be here for someone else :D"}, {"owner": {"reputation": 2219, "user_id": 8608146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3B2gl.jpg?s=128&g=1", "display_name": "Phani Rithvij", "link": "https://stackoverflow.com/users/8608146/phani-rithvij"}, "reply_to_user": {"reputation": 413, "user_id": 10468419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2Cjng.jpg?s=128&g=1", "display_name": "Alveona", "link": "https://stackoverflow.com/users/10468419/alveona"}, "edited": false, "score": 0, "creation_date": 1607596322, "post_id": 29579994, "comment_id": 115324713, "body": "@Alveona no such method in gorm v2"}], "tags": [], "owner": {"reputation": 11628, "user_id": 1373105, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Wgf7P.jpg?s=128&g=1", "display_name": "Javier Cadiz", "link": "https://stackoverflow.com/users/1373105/javier-cadiz"}, "is_accepted": true, "score": 50, "last_activity_date": 1428768436, "creation_date": 1428768436, "answer_id": 29579994, "question_id": 29435783, "link": "https://stackoverflow.com/questions/29435783/gorm-golang-orm-associations/29579994#29579994", "title": "Gorm Golang orm associations", "body": "<p><code>TownID</code> must be specified as the foreign key. The <code>Place</code> struct gets like this: </p>\n\n<pre><code>type Place struct {\n  ID          int\n  Name        string\n  Description string\n  TownID      int\n  Town        Town\n}\n</code></pre>\n\n<p>Now there are different approach to handle this. For example:</p>\n\n<pre><code>places := []Place{}\ndb.Find(&amp;places)\nfor i, _ := range places {\n    db.Model(places[i]).Related(&amp;places[i].Town)\n}\n</code></pre>\n\n<p>This will certainly produce the expected result, but notice the log output and the queries triggered.</p>\n\n<pre><code>[4.76ms]  SELECT  * FROM \"places\"\n[1.00ms]  SELECT  * FROM \"towns\"  WHERE (\"id\" = '1')\n[0.73ms]  SELECT  * FROM \"towns\"  WHERE (\"id\" = '1')\n\n[{1 Place1  {1 Town1} 1} {2 Place2  {1 Town1} 1}]\n</code></pre>\n\n<p>The output is the expected but this approach has a fundamental flaw, notice that for every place there is the need to do another db query which produce a <code>n + 1</code> problem issue. This could solve the problem but will quickly gets out of control as the amount of places grow. </p>\n\n<p>It turns out that the <strong>good</strong> approach is fairly simple using preloads.</p>\n\n<pre><code>db.Preload(\"Town\").Find(&amp;places)\n</code></pre>\n\n<p>That's it, the query log produced is:</p>\n\n<pre><code>[22.24ms]  SELECT  * FROM \"places\"\n[0.92ms]  SELECT  * FROM \"towns\"  WHERE (\"id\" in ('1'))\n\n[{1 Place1  {1 Town1} 1} {2 Place2  {1 Town1} 1}]\n</code></pre>\n\n<p>This approach will only trigger two queries, one for all places, and one for all towns that has places. This approach scales well regarding of the amount of places and towns (only two queries in all cases).</p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 1628178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a77a89eaf98779491fbf07fd626ef592?s=128&d=identicon&r=PG", "display_name": "Max", "link": "https://stackoverflow.com/users/1628178/max"}, "is_accepted": false, "score": 5, "last_activity_date": 1460918901, "creation_date": 1460918901, "answer_id": 36680738, "question_id": 29435783, "link": "https://stackoverflow.com/questions/29435783/gorm-golang-orm-associations/36680738#36680738", "title": "Gorm Golang orm associations", "body": "<p>To optimize query I use \"in condition\" in the same situation</p>\n\n<pre><code>places := []Place{}\n\nDB.Find(&amp;places)\n\nkeys := []uint{}\nfor _, value := range places {\n    keys = append(keys, value.TownID)\n}\n\nrows := []Town{}\nDB.Where(keys).Find(&amp;rows)\n\nrelated := map[uint]Town{}\nfor _, value := range rows {\n    related[value.ID] = value\n}\n\nfor key, value := range places {\n    if _, ok := related[value.TownID]; ok {\n        res[key].Town = related[value.TownID]\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1569120880, "creation_date": 1569120880, "answer_id": 58045658, "question_id": 29435783, "link": "https://stackoverflow.com/questions/29435783/gorm-golang-orm-associations/58045658#58045658", "title": "Gorm Golang orm associations", "body": "<p>No need to loop for ids, just <code>pluck</code> the ids</p>\n\n<pre><code>townIDs := []uint{}\nDB.Model(&amp;Place{}).Pluck(\"town_id\", &amp;placeIDs)\n\ntowns := []Town{}\nDB.Where(townIDs).Find(&amp;towns)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 13161879, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GgqNxSkKJMyx5r_FA7tgSg8p0vnkNi6JqKzrKQNaA=k-s128", "display_name": "Javier Ruiz", "link": "https://stackoverflow.com/users/13161879/javier-ruiz"}, "is_accepted": false, "score": 0, "last_activity_date": 1587969178, "creation_date": 1587969178, "answer_id": 61452968, "question_id": 29435783, "link": "https://stackoverflow.com/questions/29435783/gorm-golang-orm-associations/61452968#61452968", "title": "Gorm Golang orm associations", "body": "<p>First change your model:</p>\n\n<pre><code>type Place struct {\n  ID          int\n  Name        string\n  Description string\n  TownID      int\n  Town        Town\n}\n</code></pre>\n\n<p>And second, make preloading:\n<a href=\"https://gorm.io/docs/preload.html\" rel=\"nofollow noreferrer\">https://gorm.io/docs/preload.html</a></p>\n"}], "owner": {"reputation": 11628, "user_id": 1373105, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Wgf7P.jpg?s=128&g=1", "display_name": "Javier Cadiz", "link": "https://stackoverflow.com/users/1373105/javier-cadiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32773, "favorite_count": 10, "accepted_answer_id": 29579994, "answer_count": 5, "score": 31, "last_activity_date": 1587969178, "creation_date": 1428077601, "last_edit_date": 1428118988, "question_id": 29435783, "link": "https://stackoverflow.com/questions/29435783/gorm-golang-orm-associations", "title": "Gorm Golang orm associations", "body": "<p>I'm using Go with the <a href=\"https://github.com/jinzhu/gorm\">GORM ORM</a>.\nI have the following structs. The relation is simple. One Town has multiple Places and one Place belongs to one Town.</p>\n\n<pre><code>type Place struct {\n  ID          int\n  Name        string\n  Town        Town\n}\n\ntype Town struct {\n  ID   int\n  Name string\n}\n</code></pre>\n\n<p>Now i want to query all places and get along with all their fields the info of the corresponding town.\nThis is my code:</p>\n\n<pre><code>db, _ := gorm.Open(\"sqlite3\", \"./data.db\")\ndefer db.Close()\n\nplaces := []Place{}\ndb.Find(&amp;places)\nfmt.Println(places)\n</code></pre>\n\n<p>My sample database has this data:</p>\n\n<pre><code>/* places table */\nid  name    town_id\n 1  Place1        1\n 2  Place2        1\n\n/* towns Table */\nid name\n 1 Town1\n 2 Town2\n</code></pre>\n\n<p>i'm <strong>receiving</strong> this: </p>\n\n<p><code>[{1 Place1 {0 }} {2 Mares Place2 {0 }}]</code></p>\n\n<p>But i'm <strong>expecting</strong> to receive something like this (both places belongs to the same town): </p>\n\n<p><code>[{1 Place1 {1 Town1}} {2 Mares Place2 {1 Town1}}]</code></p>\n\n<p>How can i do such query ? I tried using <code>Preloads</code> and <code>Related</code> without success (probably the wrong way). I can't get working the expected result.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1428067966, "post_id": 29433160, "comment_id": 47035806, "body": "What do you want it to match? (also, why are you using a regex for this?)"}, {"owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1428069684, "post_id": 29433160, "comment_id": 47036640, "body": "I want to validate score and get all scores part at the same time. So, i search the same output as (\\d+:\\d+) as stribizhev said."}], "answers": [{"comments": [{"owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "edited": false, "score": 0, "creation_date": 1428069752, "post_id": 29433256, "comment_id": 47036678, "body": "Is it possible to validate scores string and get the result at the same time?"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "edited": false, "score": 1, "creation_date": 1428069886, "post_id": 29433256, "comment_id": 47036751, "body": "To validate, you should provide rules for validation. Actually, you asked about something else. I suggest posting another question after trying to solve that all by yourself first. On SO, we value people&#39;s own efforts."}, {"owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "edited": false, "score": 0, "creation_date": 1428070774, "post_id": 29433256, "comment_id": 47037218, "body": "I probably misunderstood regex. Think it should return [[&quot;102:72 (28:17, 27:15, 24:14, 23:26)&quot; &quot;102:72&quot; &quot;27:15&quot; &quot;24:14&quot; &quot;23:26&quot;]] if score like &quot;102:72 (28:17, 27:15, 24:14, 23:26)&quot; and return empty slice if score like &quot;70:70 (14:23, 21:21, 18:14, 17:12 overtime 5:9)&quot;"}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 3, "last_activity_date": 1428068418, "last_edit_date": 1428068418, "creation_date": 1428068109, "answer_id": 29433256, "question_id": 29433160, "link": "https://stackoverflow.com/questions/29433160/using-golangs-regex-for-parsing-sports-score/29433256#29433256", "title": "Using golangs regex for parsing sports score", "body": "<p>It returns 3 elements, as there is 0th group (the whole string), and 2 capturing groups: </p>\n\n<pre><code>1.  [0-6]   `102:72`\n2.  [29-34] `23:26`\n</code></pre>\n\n<p>Now, you should think about what you need, and only use what you need.</p>\n\n<p>Perhaps, you are looking for <code>(\\d+:\\d+)</code> that will return </p>\n\n<pre><code>102:72\n28:17\n27:15\n24:14\n23:26\n</code></pre>\n\n<p>Try this code (<a href=\"http://goo.gl/JwrO5g\" rel=\"nofollow\">sample program is available here</a>):</p>\n\n<pre><code>func main() {\n    var FirstQuarterBasketballRegexp = regexp.MustCompile(`\\d+:\\d+`)\n    fmt.Printf(\"%q\\n\", FirstQuarterBasketballRegexp.FindAllStringSubmatch(\"102:72 (28:17, 27:15, 24:14, 23:26)\", -1))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[[\"102:72\"] [\"28:17\"] [\"27:15\"] [\"24:14\"] [\"23:26\"]] \n</code></pre>\n"}], "owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 29433256, "answer_count": 1, "score": 0, "last_activity_date": 1428072320, "creation_date": 1428067802, "question_id": 29433160, "link": "https://stackoverflow.com/questions/29433160/using-golangs-regex-for-parsing-sports-score", "title": "Using golangs regex for parsing sports score", "body": "<p>I'm trying use golang regex for parsing sports score, but can't found a reason, why it doesn't parse all scores parts, but only the first and the last.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    var FirstQuarterBasketballRegexp = regexp.MustCompile(`^(\\d+:\\d+)\\s\\((?:(\\d+:\\d+)(?:,\\s)?)+\\)$`)\n    fmt.Printf(\"%q\\n\", FirstQuarterBasketballRegexp.FindAllStringSubmatch(\"102:72 (28:17, 27:15, 24:14, 23:26)\", -1))\n}\n</code></pre>\n\n<p>It prints a string</p>\n\n<pre><code>[[\"102:72 (28:17, 27:15, 24:14, 23:26)\" \"102:72\" \"23:26\"]]\n</code></pre>\n\n<p>Why it contains only 3 elem in a slice?</p>\n"}, {"tags": ["multithreading", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1428074117, "post_id": 29428546, "comment_id": 47038928, "body": "<a href=\"https://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong\" rel=\"nofollow noreferrer\">There are no benign data races</a>! Run your last example with the race detector. Just because you weren&#39;t able to induce an error or observe undefined behavior, doesn&#39;t mean it can&#39;t happen. You either have a race, or you don&#39;t."}, {"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1428120548, "post_id": 29428546, "comment_id": 47053101, "body": "Thanks for the link, it was interesting! The thing is though, there can only be potentially two results, a pointer to a struct, which will always contain the same data... or nil. In my case it makes no difference which one it is. So it doesn&#39;t matter at all if the pointer is out of date, only if an actual runtime error can occur, e.g. &quot;nil pointer dereference&quot;, which can only occur if the pointer becomes actually corrupt. As long as it is always a valid pointer (or nil) then I have no problems with that, even if it&#39;s out of date."}], "answers": [{"comments": [{"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1428050364, "post_id": 29428856, "comment_id": 47027853, "body": "For the purge I was intending on sorting by last-access and then purging the 2/3 accessed the longest time ago. It is very likely that these will all be obscure terms that rarely get searched - in which case the common terms will never be purged, as long as people keep searching them."}, {"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1428050528, "post_id": 29428856, "comment_id": 47027913, "body": "Regarding the update... it will always be the same data, as the index is created only once in the beginning. So each result will either be there, or be nil and then loaded, which from the user&#39;s perspective doesn&#39;t matter either way. The only issue would be a nil pointer dereference due to a read on a half-written write, but that does not seem to be occurring, is it possible?"}, {"owner": {"reputation": 5470, "user_id": 696130, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cd7a3d8e277219e95f304f4773518b01?s=128&d=identicon&r=PG", "display_name": "Vinay", "link": "https://stackoverflow.com/users/696130/vinay"}, "reply_to_user": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1428051908, "post_id": 29428856, "comment_id": 47028446, "body": "I&#39;ve updated my answer for the concurrency. You are correct, it is not thread safe to have the reader and writer reading/writing the same data. You must use a mutex. <a href=\"http://stackoverflow.com/questions/11063473/map-with-concurrent-access\" title=\"map with concurrent access\">stackoverflow.com/questions/11063473/map-with-concurrent-acc&zwnj;&#8203;ess</a>"}, {"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1428053058, "post_id": 29428856, "comment_id": 47028853, "body": "Then why on my test it did not matter? There were no errors, everything was fine. Please see Update 2."}], "tags": [], "owner": {"reputation": 5470, "user_id": 696130, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cd7a3d8e277219e95f304f4773518b01?s=128&d=identicon&r=PG", "display_name": "Vinay", "link": "https://stackoverflow.com/users/696130/vinay"}, "is_accepted": false, "score": 0, "last_activity_date": 1428052244, "last_edit_date": 1495539824, "creation_date": 1428050100, "answer_id": 29428856, "question_id": 29428546, "link": "https://stackoverflow.com/questions/29428546/go-thread-safe-concurrency-issue-with-sparse-array-read-write/29428856#29428856", "title": "Go: Thread-Safe Concurrency Issue with Sparse Array Read &amp; Write", "body": "<p>My top answer would be to use elasticsearch with a client like <a href=\"https://github.com/mattbaird/elastigo\" rel=\"nofollow noreferrer\">elastigo</a>.</p>\n\n<p>If that's not an option, it would really help to know how much you care about race-y behavior. If you don't care, a write could happen right after a read finishes, the user finishing the read will get stale data. You can just have a queue of write and read operations and have multiple threads feed into that queue and one dispatcher issue the operations to the map one-at-a-time as they come it. In all other scenarios, you will need a mutex if there are multiple readers and writers. Maps aren't <a href=\"https://stackoverflow.com/questions/11063473/map-with-concurrent-access\">thread safe in go</a>.</p>\n\n<p>Honestly though, I would just add a mutex to make things simple for now and optimize by analyzing where your bottlenecks actually lie. It seems like you checking a threshold and then purging 2/3 of your cache is a bit arbitrary, and I wouldn't be surprised if you kill performance by doing something like that. Here's on situation where that would break down:</p>\n\n<p>Requesters 1, 2, 3, and 4 are frequently accessing many of the same words on files A &amp; B.\nRequester 5, 6, 7 and 8 are frequently accessing many of the same words stored on files C &amp; D.</p>\n\n<p>Now when requests interleaved between these requesters and files happen in rapid succession, you may end up purging your 2/3 of your cache over and over again of results that may be requested shortly after. There are a couple other approaches:</p>\n\n<ol>\n<li>Cache words that are frequently accessed at the same time on the same box and have multiple caching boxes.</li>\n<li>Cache on a per-word basis with some sort of ranking of how popular that word is. If a new word is accessed from a file while the cache is full, see if other more popular words live in that file and purge less popular entries in the cache in hopes that those words will have a higher hit rate.</li>\n<li>Both approaches 1 &amp; 2.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 1, "last_activity_date": 1428166227, "creation_date": 1428166227, "answer_id": 29448990, "question_id": 29428546, "link": "https://stackoverflow.com/questions/29428546/go-thread-safe-concurrency-issue-with-sparse-array-read-write/29448990#29448990", "title": "Go: Thread-Safe Concurrency Issue with Sparse Array Read &amp; Write", "body": "<p>This sounds like a perfect use case for a <a href=\"http://en.wikipedia.org/wiki/Memory-mapped_file\" rel=\"nofollow\">memory mapped file</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"unsafe\"\n\n    \"github.com/edsrzf/mmap-go\"\n)\n\nfunc main() {\n    // Open the backing file\n    f, err := os.OpenFile(\"example.txt\", os.O_RDWR|os.O_CREATE, 0644)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer f.Close()\n\n    // Set it's size\n    f.Truncate(1024)\n\n    // Memory map it\n    m, err := mmap.Map(f, mmap.RDWR, 0)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer m.Unmap()\n\n    // m is a byte slice\n    copy(m, \"Hello World\")\n    m.Flush()\n\n    // here's how to use it with a pointer\n    type Coordinate struct{ X, Y int }\n    // first get the memory address as a *byte pointer and convert it to an unsafe\n    // pointer\n    ptr := unsafe.Pointer(&amp;m[20])\n    // next convert it into a different pointer type\n    coord := (*Coordinate)(ptr)\n    // now you can use it directly\n    *coord = Coordinate{1, 2}\n    m.Flush()\n    // and vice-versa\n    log.Println(*(*Coordinate)(unsafe.Pointer(&amp;m[20])))\n}\n</code></pre>\n\n<p>The memory map can be larger than real memory and the operating system will handle all the messy details for you.</p>\n\n<p>You will still need to make sure that separate goroutines never read/write to the same segment of memory at the same time.</p>\n"}], "owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 513, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1428166227, "creation_date": 1428048511, "last_edit_date": 1428050852, "question_id": 29428546, "link": "https://stackoverflow.com/questions/29428546/go-thread-safe-concurrency-issue-with-sparse-array-read-write", "title": "Go: Thread-Safe Concurrency Issue with Sparse Array Read &amp; Write", "body": "<p>I'm writing a search engine in Go in which I have an inverted index of words to the corresponding results for each word. There is a set dictionary of words and so the words are already converted into a <code>StemID</code>, which is an integer starting from 0. This allows me to use a slice of pointers (i.e. a <code>sparse array</code>) to map each <code>StemID</code> to the structure which contains the results of that query. E.g. <code>var StemID_to_Index []*resultStruct</code>. If <code>aardvark</code> is <code>0</code> then the pointer to the resultStruct for <code>aardvark</code> is located at <code>StemID_to_Index[0]</code>, which will be <code>nil</code> if the result for this word is currently not loaded.</p>\n\n<p>There is not enough memory on the server to store all of this in memory, so the structure for each <code>StemID</code> will be saved as separate files and these can be loaded into the <code>StemID_to_Index</code> slice. If <code>StemID_to_Index</code> is currently <code>nil</code> for this <code>StemID</code> then the result is not cached and needs to be loaded, otherwise it's already loaded (cached) and so can be used directly. Each time a new result is loaded the memory usage is checked and if it's over the threshold then 2/3 of the loaded results are thrown away (<code>StemID_to_Index</code> is set to <code>nil</code> for these StemIDs and a garbage collection is forced.)</p>\n\n<p>My problem is the concurrency. What is the fastest and most efficient way in which I can have multiple threads searching at the same time without having problems with different threads trying to read and write to the same place at the same time? I'm trying to avoid using mutexes on everything as that would slow down every single access attempt.</p>\n\n<p>Do you think I would get away with loading the results from disk in the working thread and then delivering the pointer to this structure to an \"updater\" thread using channels, which then updates the <code>nil</code> value in the <code>StemID_to_Index</code> slice to the pointer of the loaded result? This would mean that two threads would never attempt to write at the same time, but what would happen if another thread tried to read from that exact index of <code>StemID_to_Index</code> while the \"updater\" thread was updating the pointer? It doesn't matter if a thread is given a <code>nil</code> pointer for a result which is currently being loaded, because it will just be loaded twice and while that is a waste of resources it would still deliver the same result and since that is unlikely to happen very often, it's forgiveable.</p>\n\n<p>Additionally, how would the working thread which send the pointer to be updated to the \"updater\" thread know when the \"updater\" thread has finished updating the pointer in the slice? Should it just sleep and keep checking, or is there an easy way for the updater to send a message back to the specific thread which pushed to the channel?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I made a little test script to see what would happen if attempting to access a pointer at the same time as modifying it... it seems to always be OK. No errors. Am I missing something?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype tester struct {\n a uint\n}\n\nvar things *tester\n\nfunc updater() {\n    var a uint\n    for {\n        what := new(tester)\n        what.a = a\n        things = what\n        a++\n    }\n}\n\nfunc test() {\n    var t *tester\n    for {\n        t = things\n        if t != nil {\n            if t.a &lt; 0 {\n                fmt.Println(`Error1`)\n            }\n        } else {\n            fmt.Println(`Error2`)\n        }\n    }\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    things = new(tester)\n    go test()\n    go test()\n    go test()\n    go test()\n    go test()\n    go test()\n    go updater()\n    go test()\n    go test()\n    go test()\n    go test()\n    go test()\n    wg.Add(1)\n    wg.Wait()\n}\n</code></pre>\n\n<p><strong>UPDATE 2</strong></p>\n\n<p>Taking this further, even if I read and write from multiple threads to the same variable at the same time... it makes no difference, still no errors:</p>\n\n<p>From above:</p>\n\n<pre><code>func test() {\n    var a uint\n    var t *tester\n    for {\n        t = things\n        if t != nil {\n            if t.a &lt; 0 {\n                fmt.Println(`Error1`)\n            }\n        } else {\n            fmt.Println(`Error2`)\n        }\n        what := new(tester)\n        what.a = a\n        things = what\n        a++\n    }\n}\n</code></pre>\n\n<p>This implies I don't have to worry about concurrency at all... again: am I missing something here?</p>\n"}, {"tags": ["vim", "go", "vim-plugin", "gvm"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1428040527, "post_id": 29426855, "comment_id": 47024527, "body": "You literally need to type (while is command mode) in vim, <code>:GoInstallBinaries</code>, then press enter.  The last time I did this there was at least one dependency that had moved and I needed to install it manually."}, {"owner": {"reputation": 1760, "user_id": 3369324, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LBmEb.png?s=128&g=1", "display_name": "Cel Skeggs", "link": "https://stackoverflow.com/users/3369324/cel-skeggs"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 1, "creation_date": 1428040760, "post_id": 29426855, "comment_id": 47024586, "body": "@sberry - consider converting your comment to an answer, because it appears to be one."}, {"owner": {"reputation": 4504, "user_id": 3681199, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/70b2072de3d0d43e1af48fd2d416157f?s=128&d=identicon&r=PG&f=1", "display_name": "Nona", "link": "https://stackoverflow.com/users/3681199/nona"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1428289627, "post_id": 29426855, "comment_id": 47092548, "body": "@sberry I created $GOPATH as export GOPATH=&quot;$HOME/workspace&quot; and when I do :GoInstallBinaries I get &quot;vim-go: go executable not found&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 4504, "user_id": 3681199, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/70b2072de3d0d43e1af48fd2d416157f?s=128&d=identicon&r=PG&f=1", "display_name": "Nona", "link": "https://stackoverflow.com/users/3681199/nona"}, "edited": false, "score": 0, "creation_date": 1428289586, "post_id": 29441726, "comment_id": 47092538, "body": "I created $GOPATH as export GOPATH=&quot;$HOME/workspace&quot; and when I do :GoInstallBinaries I get &quot;vim-go: go executable not found&quot;"}, {"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "reply_to_user": {"reputation": 4504, "user_id": 3681199, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/70b2072de3d0d43e1af48fd2d416157f?s=128&d=identicon&r=PG&f=1", "display_name": "Nona", "link": "https://stackoverflow.com/users/3681199/nona"}, "edited": false, "score": 0, "creation_date": 1428331473, "post_id": 29441726, "comment_id": 47108098, "body": "You might not have Go installed properly in that case, or your <code>GOROOT</code> environment variable is not set."}], "tags": [], "owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "is_accepted": false, "score": 1, "last_activity_date": 1428110244, "creation_date": 1428110244, "answer_id": 29441726, "question_id": 29426855, "link": "https://stackoverflow.com/questions/29426855/how-do-i-get-rid-of-this-message-in-vim-when-im-working-with-golang-files-with/29441726#29441726", "title": "How do I get rid of this message in Vim when I&#39;m working with golang files with Janus vim?", "body": "<p>Do what sberry says. In command-mode, hit : and type <code>GoInstallBinaries</code>, and hit enter. That should install everything.</p>\n"}], "owner": {"reputation": 4504, "user_id": 3681199, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/70b2072de3d0d43e1af48fd2d416157f?s=128&d=identicon&r=PG&f=1", "display_name": "Nona", "link": "https://stackoverflow.com/users/3681199/nona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2061, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1497063816, "creation_date": 1428039931, "question_id": 29426855, "link": "https://stackoverflow.com/questions/29426855/how-do-i-get-rid-of-this-message-in-vim-when-im-working-with-golang-files-with", "title": "How do I get rid of this message in Vim when I&#39;m working with golang files with Janus vim?", "body": "<p>I use Vim to open up a hello.go file (using the nerdTree plugin included with <a href=\"https://github.com/carlhuda/janus\" rel=\"nofollow\">janus vim distro</a>) and get \"vim-go: could not find 'gotags'. Run :GoInstallBinaries to fix it.\".  I'm using gvm.  I can get golang to run with gvm.  How do I install <em>GoInstallBinaries</em> with gvm to get rid of this message?  I'm pretty new to golang, so I'm just trying to get up and running.</p>\n"}, {"tags": ["reflection", "go", "threadpool"], "comments": [{"owner": {"reputation": 21722, "user_id": 357705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9cb8f635bfd71c18b91e1b0ed5d2ee9?s=128&d=identicon&r=PG", "display_name": "jimt", "link": "https://stackoverflow.com/users/357705/jimt"}, "edited": false, "score": 1, "creation_date": 1428021081, "post_id": 29423914, "comment_id": 47020550, "body": "Simple is most often better. But the only way to be sure is to benchmark. Try them both and compare."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 1, "creation_date": 1428023171, "post_id": 29423914, "comment_id": 47020995, "body": "I&#39;d wager that decoding into predefined structs is faster than reflection (but measure before deciding, of course).  Also, don&#39;t forget that your struct definitions don&#39;t have to cover <i>everything</i>, you can include only the parts of the documents you care to consider and the rest will be silently ignored by the decoder."}, {"owner": {"reputation": 243, "user_id": 4639689, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/IeGRx.jpg?s=128&g=1", "display_name": "premunk", "link": "https://stackoverflow.com/users/4639689/premunk"}, "reply_to_user": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1428080328, "post_id": 29423914, "comment_id": 47041785, "body": "@maerics: That&#39;s cool. I&#39;ll look into that!"}], "answers": [{"comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 1, "creation_date": 1428041491, "post_id": 29424763, "comment_id": 47024796, "body": "Also calling functions through reflection is almost 100 time slower than doing it through a func pointer."}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 3, "last_activity_date": 1428093267, "last_edit_date": 1428093267, "creation_date": 1428022281, "answer_id": 29424763, "question_id": 29423914, "link": "https://stackoverflow.com/questions/29423914/golang-static-vs-dynamic-binding-for-objects/29424763#29424763", "title": "Golang Static vs dynamic binding for objects", "body": "<p>Downside of reflection based auto-discovery is that you forever have to be careful on what you add to the system because it can be automatically picked up.</p>\n\n<p>vs map approach where you would need to explicitly expose each function.</p>\n\n<p>Reflection is more cool and auto-magical, for sure.  But auto-magical doesn't lend it self very well to security or long term maintainability.</p>\n\n<p>Plus, a map[string]func(with specific signature) won't compile if you attempt register a non-matching function.</p>\n\n<p>Where you will find stuff with reflection and then ponder why it's a runtime fail.</p>\n"}], "owner": {"reputation": 243, "user_id": 4639689, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/IeGRx.jpg?s=128&g=1", "display_name": "premunk", "link": "https://stackoverflow.com/users/4639689/premunk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 834, "favorite_count": 0, "closed_date": 1428169806, "accepted_answer_id": 29424763, "answer_count": 1, "score": 0, "last_activity_date": 1428093267, "creation_date": 1428015799, "question_id": 29423914, "link": "https://stackoverflow.com/questions/29423914/golang-static-vs-dynamic-binding-for-objects", "closed_reason": "Opinion-based", "title": "Golang Static vs dynamic binding for objects", "body": "<p>I have this application where requests are filtered based on the string in the struct and made to execute different functions.</p>\n\n<p>My approach is to have a Map which maps the strings to the function pointers and execute them. However this approach is being contended by a teammate who wants to do this filtering by reflection. We are using Go and it is for monitoring the activity of our site.</p>\n\n<p>Teammates approach: Use reflection to switch the object based on the string, pass the string to the function and let the function call the relevant function. \nMy approach: Simple map from string to functions</p>\n\n<p>Any help is appreciated. </p>\n"}, {"tags": ["java", "android", "go", "rsa", "bouncycastle"], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 2766690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cea02fa50baafbed4f559dce7576eba2?s=128&d=identicon&r=PG&f=1", "display_name": "David L.P.", "link": "https://stackoverflow.com/users/2766690/david-l-p"}, "is_accepted": true, "score": 2, "last_activity_date": 1428846316, "creation_date": 1428846316, "answer_id": 29590125, "question_id": 29422738, "link": "https://stackoverflow.com/questions/29422738/verify-rsa-signpkcs1v15-signature-generated-in-golang-in-java/29590125#29590125", "title": "Verify rsa.SignPKCS1v15 signature generated in golang in Java", "body": "<p>In Java you don't need to hash the message before signing or verifying it. That means that the bytes being sent to sig.update shouldn't be hashedBytes, but the inputBytes.</p>\n"}, {"tags": [], "owner": {"reputation": 1085, "user_id": 3344049, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GCgWo.jpg?s=128&g=1", "display_name": "Kamiel Ahmadpour", "link": "https://stackoverflow.com/users/3344049/kamiel-ahmadpour"}, "is_accepted": false, "score": 0, "last_activity_date": 1582477929, "creation_date": 1582477929, "answer_id": 60364732, "question_id": 29422738, "link": "https://stackoverflow.com/questions/29422738/verify-rsa-signpkcs1v15-signature-generated-in-golang-in-java/60364732#60364732", "title": "Verify rsa.SignPKCS1v15 signature generated in golang in Java", "body": "<p>If you don't want to hash the content in Go and just sign the raw data, you can use this code:</p>\n\n<pre><code>signature, err := rsa.SignPKCS1v15(rand.Reader, privateKey, crypto.Hash(0), []byte(message))\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 2766690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cea02fa50baafbed4f559dce7576eba2?s=128&d=identicon&r=PG&f=1", "display_name": "David L.P.", "link": "https://stackoverflow.com/users/2766690/david-l-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1932, "favorite_count": 3, "accepted_answer_id": 29590125, "answer_count": 2, "score": 3, "last_activity_date": 1582477929, "creation_date": 1428009918, "last_edit_date": 1428010230, "question_id": 29422738, "link": "https://stackoverflow.com/questions/29422738/verify-rsa-signpkcs1v15-signature-generated-in-golang-in-java", "title": "Verify rsa.SignPKCS1v15 signature generated in golang in Java", "body": "<p>I am trying to get Java to verify a signed SHA-1 hash but it keeps returning false. I have the following code in Go which generates an RSA Key Pair and signs and returns any message that hits the /sign endpoint along with the hex encoded hash and the public key modulus and exponent:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto\"\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"encoding/hex\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"strconv\"\n)\n\nvar PrivKey *rsa.PrivateKey\n\ntype Message struct {\n    Message string `json:\"message\"`\n}\n\nfunc (msg *Message) Decode(r io.Reader) error {\n    return json.NewDecoder(r).Decode(&amp;msg)\n}\n\ntype Signature struct {\n    Hash      string `json:\"hash\"`\n    Signature string `json:\"signature\"`\n    N         string `json:\"N\"`\n    E         string `json:\"E\"`\n}\n\nfunc hash(msg string) []byte {\n    sh := crypto.SHA1.New()\n    sh.Write([]byte(msg))\n    hash := sh.Sum(nil)\n    return hash\n}\n\nfunc SignWithKey(msg Message) Signature {\n    hash := hash(msg.Message)\n    bytes, err := rsa.SignPKCS1v15(rand.Reader, PrivKey, crypto.SHA1, hash)\n    if err != nil {\n        panic(err)\n    }\n    signature := hex.EncodeToString(bytes)\n    sig := Signature{\n        hex.EncodeToString(hash),\n        signature,\n        PrivKey.PublicKey.N.String(),\n        strconv.Itoa(PrivKey.PublicKey.E),\n    }\n    return sig\n}\n\nfunc sign(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"/sign\")\n    var msg Message\n    err := msg.Decode(r.Body)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(\"Signing: \" + msg.Message)\n    signature := SignWithKey(msg)\n    js, err := json.Marshal(signature)\n    fmt.Println(string(js))\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.Write(js)\n}\n\nfunc LoadKeys() {\n    // generate private key\n    var err error\n    PrivKey, err = rsa.GenerateKey(rand.Reader, 2048)\n    if err != nil {\n        fmt.Println(err)\n    }\n}\n\nfunc main() {\n\n    fmt.Println(\"Loading Keys\")\n    LoadKeys()\n    fmt.Println(\"Keys Loaded\")\n    http.HandleFunc(\"/sign\", sign)\n\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>On the Java/Android side I have this code which after sending the relevant bits hits this function with the unparsed JSON object, but once it gets to the Signature verify part it always returns false:</p>\n\n<pre><code>protected void onPostExecute(String result) {\n            if (result == null) {\n                tv.setText(\"NULL\");\n                return;\n            }\n            JsonElement jelement = new JsonParser().parse(result);\n            JsonObject jobject = jelement.getAsJsonObject();\n            String signature = jobject.getAsJsonPrimitive(\"signature\").getAsString();\n            BigInteger N = jobject.getAsJsonPrimitive(\"N\").getAsBigInteger();\n            BigInteger E = jobject.getAsJsonPrimitive(\"E\").getAsBigInteger();\n            String hash = jobject.getAsJsonPrimitive(\"hash\").getAsString();\n            java.security.spec.RSAPublicKeySpec spec = new java.security.spec.RSAPublicKeySpec(N, E);\n\n            try {\n                KeyFactory keyFactory = KeyFactory.getInstance(\"RSA\");\n                PublicKey pk = keyFactory.generatePublic(spec);\n\n                MessageDigest digest = MessageDigest.getInstance(\"SHA1\");\n                byte[] inputBytes = msg.getBytes(\"UTF8\");\n                byte[] hashedBytes = digest.digest(inputBytes);\n\n                Signature sig = Signature.getInstance(\"SHA1withRSA\", \"SC\");\n                sig.initVerify( pk );\n                sig.update( hashedBytes );\n                boolean ret = sig.verify( Hex.decode(signature) );\n                if (ret) {\n                    tv.setText(output + \"Verified\");\n                } else {\n                    tv.setText(output + \"NOT VERIFIED\");\n                }\n            }\n            catch (Exception e) {\n                Log.i(\"error\", e.toString());\n            }  \n        }\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1428010875, "post_id": 29422602, "comment_id": 47017360, "body": "It&#39;s due to a typo: try <code>if !reflect.DeepEqual(p, want)</code>. E.g. <a href=\"https://play.golang.org/p/LkYrawkjcU\" rel=\"nofollow noreferrer\">play.golang.org/p/LkYrawkjcU</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1428011048, "post_id": 29422795, "comment_id": 47017442, "body": "Incorrect, the issue is that the first argument to DeepEqual was of type <code>string</code> (likely due to a typo). DeepEqual is documented as being able to handle slices and recursive types."}], "tags": [], "owner": {"reputation": 1, "user_id": 4744261, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/6cf0ec0d43586d74e9c338c8e2c191a0?s=128&d=identicon&r=PG", "display_name": "user4744261", "link": "https://stackoverflow.com/users/4744261/user4744261"}, "is_accepted": false, "score": -2, "last_activity_date": 1428010151, "creation_date": 1428010151, "answer_id": 29422795, "question_id": 29422602, "link": "https://stackoverflow.com/questions/29422602/golang-reflect-deepequal-returns-false/29422795#29422795", "title": "Golang: reflect.DeepEqual returns false", "body": "<p><code>DeepEqual</code> returns false because you're comparing two instances of a type which is not comparable. Type <code>ResultResponse</code> is not comparable because not all of its fields are comparable. The <code>Result</code> field is a slice and slices are specified by the language to be not comparable.</p>\n"}, {"tags": [], "owner": {"reputation": 151, "user_id": 207003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d7eec3cf5803a4346d44b12e046ec5a?s=128&d=identicon&r=PG", "display_name": "Tony Bai", "link": "https://stackoverflow.com/users/207003/tony-bai"}, "is_accepted": false, "score": 0, "last_activity_date": 1428050417, "creation_date": 1428050417, "answer_id": 29428932, "question_id": 29422602, "link": "https://stackoverflow.com/questions/29422602/golang-reflect-deepequal-returns-false/29428932#29428932", "title": "Golang: reflect.DeepEqual returns false", "body": "<p>I think it is an editing mistake.I guess that What you want to code is:  </p>\n\n<pre><code>\"reflect.DeepEqual(p, want)\"\n</code></pre>\n\n<p>but you actually wrote:</p>\n\n<pre><code>\"reflect.DeepEqual(input, want)\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "is_accepted": false, "score": 4, "last_activity_date": 1563860657, "creation_date": 1563860657, "answer_id": 57157384, "question_id": 29422602, "link": "https://stackoverflow.com/questions/29422602/golang-reflect-deepequal-returns-false/57157384#57157384", "title": "Golang: reflect.DeepEqual returns false", "body": "<p>Here is my case:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestGoogleAccountRepository_FindByClientCustomerIds(t *testing.T) {\n    type args struct {\n        ids []int\n    }\n    tests := []struct {\n        name    string\n        args    args\n        want    []cedar.GoogleAccount\n        wantErr bool\n    }{\n        {\n            name:    \"should get client customer ids correctly\",\n            args:    args{ids: []int{9258066191}},\n            want:    make([]cedar.GoogleAccount, 0),\n            wantErr: false,\n        },\n    }\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            got, err := googleAccountRepo.FindByClientCustomerIds(tt.args.ids)\n            if (err != nil) != tt.wantErr {\n                t.Errorf(\"GoogleAccountRepository.FindByClientCustomerIds() error = %v, wantErr %v\", err, tt.wantErr)\n                return\n            }\n\n            fmt.Printf(\"got = %#v, want = %#v\\n\", got, tt.want)\n            if !reflect.DeepEqual(got, tt.want) {\n                t.Errorf(\"GoogleAccountRepository.FindByClientCustomerIds() = %+v, want %+v\", got, tt.want)\n            }\n        })\n    }\n}\n</code></pre>\n\n<p>When I run this test firstly, I got below message:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>load env vars from local fs env file\n=== RUN   TestGoogleAccountRepository_FindByClientCustomerIds\n--- FAIL: TestGoogleAccountRepository_FindByClientCustomerIds (0.62s)\n=== RUN   TestGoogleAccountRepository_FindByClientCustomerIds/should_get_client_customer_ids_correctly\ngot = []cedar.GoogleAccount(nil), want = []cedar.GoogleAccount{}\n    --- FAIL: TestGoogleAccountRepository_FindByClientCustomerIds/should_get_client_customer_ids_correctly (0.62s)\n        googleAccount_test.go:64: GoogleAccountRepository.FindByClientCustomerIds() = [], want []\nFAIL\n</code></pre>\n\n<p>Take care this message:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>GoogleAccountRepository.FindByClientCustomerIds() = [], want []\n</code></pre>\n\n<p>It seems <code>got</code> and <code>want</code> are all empty <code>slice</code>, right? No, after I add below code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>fmt.Printf(\"got = %#v, want = %#v\\n\", got, tt.want)\n</code></pre>\n\n<p>It print out:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>got = []cedar.GoogleAccount(nil), want = []cedar.GoogleAccount{}\n</code></pre>\n\n<p>As you can see, <code>got</code> is not deep equal <code>want</code>.</p>\n\n<p>That's because I declare the <code>googleAccounts</code> variable in <code>googleAccountRepo.FindByClientCustomerIds</code> method like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var googleAccounts []cedar.GoogleAccount\n</code></pre>\n\n<p>After I change it to </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var googleAccounts = make([]cedar.GoogleAccount, 0)\n</code></pre>\n\n<p>The test pass:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>=== RUN   TestGoogleAccountRepository_FindByClientCustomerIds\n--- PASS: TestGoogleAccountRepository_FindByClientCustomerIds (0.46s)\n=== RUN   TestGoogleAccountRepository_FindByClientCustomerIds/should_get_client_customer_ids_correctly\ngot = []cedar.GoogleAccount{}, want = []cedar.GoogleAccount{}\n    --- PASS: TestGoogleAccountRepository_FindByClientCustomerIds/should_get_client_customer_ids_correctly (0.46s)\nPASS\n\nProcess finished with exit code 0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3759, "user_id": 1481716, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/l18HH.jpg?s=128&g=1", "display_name": "noelyahan", "link": "https://stackoverflow.com/users/1481716/noelyahan"}, "is_accepted": false, "score": 0, "last_activity_date": 1617373114, "creation_date": 1617373114, "answer_id": 66920692, "question_id": 29422602, "link": "https://stackoverflow.com/questions/29422602/golang-reflect-deepequal-returns-false/66920692#66920692", "title": "Golang: reflect.DeepEqual returns false", "body": "<p><strong>DeepEqual</strong> checks 2 criterias identical <strong>types</strong>, identical <strong>values</strong>,</p>\n<p>Here is a tricky case, think about a scenarios that's values are assigning to <code>any type</code> (interfaces) ex: <code>map[string]interface{}</code> most of the time we deal with these values with data encoders/decoders (json)</p>\n<p><strong>Scenario 1</strong></p>\n<pre><code>package main\n\nimport (\n    &quot;log&quot;\n    &quot;reflect&quot;\n)\n\nfunc main() {\n    // Scenario 1\n    log.Print(&quot;Scenario 1&quot;)\n    m1 := make(map[string]interface{})\n    m2 := make(map[string]interface{})\n\n    m1[&quot;length&quot;] = 1\n    m2[&quot;length&quot;] = 1.0\n    if !reflect.DeepEqual(m1, m2) {\n        log.Printf(&quot;returned %+v, want %+v&quot;, m1, m2)\n    }\n}\n</code></pre>\n<p><em>2009/11/10 23:00:00 returned map[length:1], want map[length:1]</em></p>\n<p>With logs the issue will be hard to debug, since values are look same unless we check the types (<strong>reflect.TypeOf(interface)</strong>)</p>\n<p><strong>Scenario 2</strong></p>\n<pre><code>package main\n\nimport (\n    &quot;encoding/json&quot;\n    &quot;log&quot;\n    &quot;reflect&quot;\n    &quot;strings&quot;\n)\n\nfunc main() {\n    // Scenario 2\n    log.Print(&quot;Scenario 2&quot;)\n    m1 := make(map[string]interface{})\n    m2 := make(map[string]interface{})\n    \n    str1 := `{&quot;length&quot;: &quot;1&quot;}`\n    str2 := `{&quot;length&quot;: 1}`\n    \n    json.NewDecoder(strings.NewReader(str1)).Decode(&amp;m1)\n    json.NewDecoder(strings.NewReader(str2)).Decode(&amp;m2)\n\n    if !reflect.DeepEqual(m1, m2) {\n        log.Printf(&quot;returned %+v, want %+v&quot;, m1, m2)\n    }\n}\n</code></pre>\n<p><em>2009/11/10 23:00:00 returned map[length:1], want map[length:1]</em></p>\n<p>Using DeepEqual API in these dynamic value scenarios should be done carefully, might need to convert in to a single data type or always try to use same structure if it's possible</p>\n<p><a href=\"https://play.golang.org/p/SBZ6T5aOPQO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/SBZ6T5aOPQO</a></p>\n"}], "owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4894, "favorite_count": 1, "answer_count": 4, "score": 1, "last_activity_date": 1617373114, "creation_date": 1428009320, "question_id": 29422602, "link": "https://stackoverflow.com/questions/29422602/golang-reflect-deepequal-returns-false", "title": "Golang: reflect.DeepEqual returns false", "body": "<p>I'm curious why this DeepEqual check is false:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"reflect\"\n    \"strings\"\n)\n\ntype Result struct {\n    Topic string `json:\"topic,omitempty\"`\n    Id    int    `json:\"id,omitempty\"`\n}\n\n// Result represents the returned collection from a topic search.\ntype ResultResponse struct {\n    Result []Result `json:\"results\"`\n}\n\nfunc main() {\n    want := ResultResponse{\n        []Result{{Topic: \"Clojure\", Id: 1000}},\n    }\n\n    input := `{\"results\": [ {\"topic\": \"Clojure\", \"id\": 1000} ]}`\n    p := ResultResponse{}\n\n    err := json.NewDecoder(strings.NewReader(input)).Decode(&amp;p)\n\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(p, want)\n\n    if !reflect.DeepEqual(input, want) {\n        log.Printf(\"returned %+v, want %+v\", p, want)\n    }\n\n\n}\n</code></pre>\n"}, {"tags": ["json", "go", "jsonstream"], "comments": [{"owner": {"reputation": 61719, "user_id": 546999, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/91a78cf1465182161a79685058d8b39b?s=128&d=identicon&r=PG", "display_name": "Nanne", "link": "https://stackoverflow.com/users/546999/nanne"}, "edited": false, "score": 0, "creation_date": 1428005134, "post_id": 29421470, "comment_id": 47014693, "body": "There&#39;s bound to be a better way, but the easiest is probably just remove the <code>,</code> from the beginning, and then use the json library to parse the rest of the line: that is just a json object, right? (and the better way was probably posted while leaving this comment, so use that instead ;) that&#39;s why this is not an answer :)  )"}, {"owner": {"reputation": 360, "user_id": 4743935, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-D0UsDqm2eGw/AAAAAAAAAAI/AAAAAAAAAJ8/lc0gehFEEdQ/photo.jpg?sz=128", "display_name": "Tristan Storch", "link": "https://stackoverflow.com/users/4743935/tristan-storch"}, "reply_to_user": {"reputation": 61719, "user_id": 546999, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/91a78cf1465182161a79685058d8b39b?s=128&d=identicon&r=PG", "display_name": "Nanne", "link": "https://stackoverflow.com/users/546999/nanne"}, "edited": false, "score": 0, "creation_date": 1428007149, "post_id": 29421470, "comment_id": 47015648, "body": "Exactly. The rest is just an json object. I can&#39;t do such hacky stuff. I would hate myself ;)"}, {"owner": {"reputation": 22993, "user_id": 1394393, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/mSjIL.jpg?s=128&g=1", "display_name": "jpmc26", "link": "https://stackoverflow.com/users/1394393/jpmc26"}, "edited": false, "score": 0, "creation_date": 1557352269, "post_id": 29421470, "comment_id": 98740446, "body": "Strictly speaking, this is not valid JSON. A valid JSON array must have a terminating right square bracket (<code>]</code>), meaning it cannot be infinite. I would not expect a JSON parsing library to be able to handle it via the normal means, though you might be able to invoke some of its parsing functionality if it exposes it."}], "answers": [{"comments": [{"owner": {"reputation": 360, "user_id": 4743935, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-D0UsDqm2eGw/AAAAAAAAAAI/AAAAAAAAAJ8/lc0gehFEEdQ/photo.jpg?sz=128", "display_name": "Tristan Storch", "link": "https://stackoverflow.com/users/4743935/tristan-storch"}, "edited": false, "score": 0, "creation_date": 1428007045, "post_id": 29421528, "comment_id": 47015599, "body": "Thanks for the quick answer. I googled now myself for Go JSON Streaming APIs, but sadly the main part is just about sending (as your link). The receiving is all about newline delimited lists (<code>{...}\\n{...}\\n{...}...</code>) and no infinite array. For this I would have just used Scanners and json unmarshaling, which seams not to be the idiomatic way in my case."}, {"owner": {"reputation": 835, "user_id": 1165727, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hG276.jpg?s=128&g=1", "display_name": "Yazad", "link": "https://stackoverflow.com/users/1165727/yazad"}, "reply_to_user": {"reputation": 360, "user_id": 4743935, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-D0UsDqm2eGw/AAAAAAAAAAI/AAAAAAAAAJ8/lc0gehFEEdQ/photo.jpg?sz=128", "display_name": "Tristan Storch", "link": "https://stackoverflow.com/users/4743935/tristan-storch"}, "edited": false, "score": 0, "creation_date": 1428010583, "post_id": 29421528, "comment_id": 47017235, "body": "I am sorry to hear that. Let&#39;s assume you have no means of controlling this infinite input as it will come in as an array and not as splits like you need. You can code a &quot;pre-processor&quot; to clean up before you ignoring the start and end box bracket is relatively trivial. Now to ignore the comma consider this create a counter with value 1, for every start { increment a counter and for every } decrement a counter - when the counter is 1 - ignore the incoming comma (and replace with a \\n as needed by the API)."}], "tags": [], "owner": {"reputation": 835, "user_id": 1165727, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hG276.jpg?s=128&g=1", "display_name": "Yazad", "link": "https://stackoverflow.com/users/1165727/yazad"}, "is_accepted": false, "score": 0, "last_activity_date": 1428005130, "creation_date": 1428005130, "answer_id": 29421528, "question_id": 29421470, "link": "https://stackoverflow.com/questions/29421470/how-to-parse-an-infinite-json-array-from-stdin-in-go/29421528#29421528", "title": "How to parse an infinite json array from stdin in go?", "body": "<p>What you are looking for is a Streaming API for JSON. There are many available a quick Google search revealed <a href=\"https://github.com/ant0ine/go-json-rest#streaming\" rel=\"nofollow\">this</a> project that does list Streaming as one of it's advance features.</p>\n"}, {"comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 1, "creation_date": 1428042006, "post_id": 29425099, "comment_id": 47024938, "body": "A basic state machine is the way to go."}, {"owner": {"reputation": 360, "user_id": 4743935, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-D0UsDqm2eGw/AAAAAAAAAAI/AAAAAAAAAJ8/lc0gehFEEdQ/photo.jpg?sz=128", "display_name": "Tristan Storch", "link": "https://stackoverflow.com/users/4743935/tristan-storch"}, "edited": false, "score": 0, "creation_date": 1428091794, "post_id": 29425099, "comment_id": 47046656, "body": "How do I get the &quot;next&quot; item? Should I just use a scanner and split with the split function on newlines?"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 360, "user_id": 4743935, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-D0UsDqm2eGw/AAAAAAAAAAI/AAAAAAAAAJ8/lc0gehFEEdQ/photo.jpg?sz=128", "display_name": "Tristan Storch", "link": "https://stackoverflow.com/users/4743935/tristan-storch"}, "edited": false, "score": 0, "creation_date": 1428162532, "post_id": 29425099, "comment_id": 47063055, "body": "@TristanStorch: just call <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Decode\" rel=\"nofollow noreferrer\"><code>json.Decoder.Decode(...)</code></a> - from the docs, it &quot;reads the next JSON-encoded value from its input&quot; and should properly handle any irrelevant whitespace."}, {"owner": {"reputation": 360, "user_id": 4743935, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-D0UsDqm2eGw/AAAAAAAAAAI/AAAAAAAAAJ8/lc0gehFEEdQ/photo.jpg?sz=128", "display_name": "Tristan Storch", "link": "https://stackoverflow.com/users/4743935/tristan-storch"}, "edited": false, "score": 0, "creation_date": 1428163257, "post_id": 29425099, "comment_id": 47063242, "body": "@maerics Nice. Thanks a lot!"}, {"owner": {"reputation": 360, "user_id": 4743935, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-D0UsDqm2eGw/AAAAAAAAAAI/AAAAAAAAAJ8/lc0gehFEEdQ/photo.jpg?sz=128", "display_name": "Tristan Storch", "link": "https://stackoverflow.com/users/4743935/tristan-storch"}, "edited": false, "score": 0, "creation_date": 1428420840, "post_id": 29425099, "comment_id": 47149705, "body": "For the record: I solved it with <a href=\"http://stackoverflow.com/questions/17676367/filtering-non-json-content-in-a-json-stream-in-go\">this</a> approach. There is a tricky bit with json.Decoder."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 6, "last_activity_date": 1428025351, "creation_date": 1428025351, "answer_id": 29425099, "question_id": 29421470, "link": "https://stackoverflow.com/questions/29421470/how-to-parse-an-infinite-json-array-from-stdin-in-go/29425099#29425099", "title": "How to parse an infinite json array from stdin in go?", "body": "<p>Write a custom reader function (or Decoder) which does a \"streaming array parse\" like so:</p>\n\n<ol>\n<li>Read and discard leading whitespace.</li>\n<li>If the next character is not a <code>[</code> then return an error (can't be an array).</li>\n<li>While true do:\n<ol>\n<li>Call <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Decode\" rel=\"noreferrer\"><code>json.Decoder.Decode</code></a> into the \"next\" item.</li>\n<li>Yield or process the \"next\" item.</li>\n<li>Read and discard whitespace.</li>\n<li>If the next character is:\n<ol>\n<li>A comma <code>,</code> then continue the for-loop in #3.</li>\n<li>A close bracket <code>]</code> then exit the for-loop in #3.</li>\n<li>Otherwise return an error (invalid array syntax).</li>\n</ol></li>\n</ol></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 39, "user_id": 11468919, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vF1mzhx-CEI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rexDCSTkxWqIaDoVkXHs_yChDiRtg/mo/photo.jpg?sz=128", "display_name": "James Welchman", "link": "https://stackoverflow.com/users/11468919/james-welchman"}, "is_accepted": false, "score": 3, "last_activity_date": 1557312420, "last_edit_date": 1557312420, "creation_date": 1557304186, "answer_id": 56036563, "question_id": 29421470, "link": "https://stackoverflow.com/questions/29421470/how-to-parse-an-infinite-json-array-from-stdin-in-go/56036563#56036563", "title": "How to parse an infinite json array from stdin in go?", "body": "<p>I'm writing my own handler for click events in i3 as well. That's how I stumbled upon this thread. </p>\n\n<p>The Golang standard library does actually do exactly what is required (Golang 1.12). Not sure it did when you asked the question or not?</p>\n\n<pre><code>// json parser read from stdin\ndecoder := json.NewDecoder(os.Stdin)\n\n// Get he first token - it should be a '['\ntk, err := decoder.Token()\nif err != nil {\n    fmt.Fprintln(os.Stderr, \"couldn't read from stdin\")\n    return\n}\n// according to the docs a json.Delim is one [, ], { or }\n// Make sure the token is a delim\ndelim, ok := tk.(json.Delim)\nif !ok {\n    fmt.Fprintln(os.Stderr, \"first token not a delim\")\n    return\n}\n// Make sure the value of the delim is '['\nif delim != json.Delim('[') {\n    fmt.Fprintln(os.Stderr, \"first token not a [\")\n    return\n}\n\n// The parser took the [ above\n// therefore decoder.More() will return\n// true until a closing ] is seen - i.e never \nfor decoder.More() {\n    // make a Click struct with the relevant json structure tags\n    click := &amp;Click{}\n\n    // This will block until we have a complete JSON object\n    // on stdin\n    err = decoder.Decode(click)\n    if err != nil {\n            fmt.Fprintln(os.Stderr, \"couldn't decode click\")\n            return\n    }\n    // Do something with click event\n}\n</code></pre>\n"}], "owner": {"reputation": 360, "user_id": 4743935, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-D0UsDqm2eGw/AAAAAAAAAAI/AAAAAAAAAJ8/lc0gehFEEdQ/photo.jpg?sz=128", "display_name": "Tristan Storch", "link": "https://stackoverflow.com/users/4743935/tristan-storch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1763, "favorite_count": 0, "accepted_answer_id": 29425099, "answer_count": 3, "score": 3, "last_activity_date": 1557312420, "creation_date": 1428004890, "last_edit_date": 1428007221, "question_id": 29421470, "link": "https://stackoverflow.com/questions/29421470/how-to-parse-an-infinite-json-array-from-stdin-in-go", "title": "How to parse an infinite json array from stdin in go?", "body": "<p>I'm trying to write a small replacement for i3status, a small programm that comunicates with i3bar conforming <a href=\"http://i3wm.org/docs/i3bar-protocol.html\" rel=\"nofollow\">this</a> protocol. They exchange messeages via stdin and stdout.</p>\n\n<p>The stream in both directions is an infinite array of json objects. The start of the stream from i3bar to i3status (which i want to replace) looks like this:</p>\n\n<pre><code>[\n{\"name\": \"some_name_1\",\"instance\": \"some_inst_1\",\"button\": 1,\"x\": 213,\"y\": 35}\n,{\"name\": \"some_name_1\",\"instance\": \"some_inst_2\",\"button\": 2,\"x\": 687,\"y\": 354}\n,{\"name\": \"some_name_2\",\"instance\": \"some_inst\",\"button\": 1,\"x\": 786,\"y\": 637}\n,{\"name\": \"some_name_3\",\"instance\": \"some_inst\",\"button\": 3,\"x\": 768,\"y\": 67}\n...\n</code></pre>\n\n<p>This is an \"array\" of objects which represent clicks. The array will never close.</p>\n\n<p>My question is now: What is the <em>right way</em> of parsing this?</p>\n\n<p>Obviously I cannot use the <code>json</code> library because this is not a vaild json object.</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1428003334, "post_id": 29420653, "comment_id": 47013776, "body": "It should work. Make sure your xml unmarshals correctly first, otherwise it will just silently fail since there&#39;s no error for valid xml that doesn&#39;t unmarshal, <a href=\"http://play.golang.org/p/xoRVF01x7X\" rel=\"nofollow noreferrer\">play.golang.org/p/xoRVF01x7X</a>"}, {"owner": {"reputation": 311, "user_id": 1268891, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/3dcafc3ee23ca20db392a1e070fce648?s=128&d=identicon&r=PG", "display_name": "matvey.co", "link": "https://stackoverflow.com/users/1268891/matvey-co"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1428005561, "post_id": 29420653, "comment_id": 47014914, "body": "Thank you! I double checked a code and found a mistake in other place. Now all works fine."}], "owner": {"reputation": 311, "user_id": 1268891, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/3dcafc3ee23ca20db392a1e070fce648?s=128&d=identicon&r=PG", "display_name": "matvey.co", "link": "https://stackoverflow.com/users/1268891/matvey-co"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 476, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1512687479, "creation_date": 1428001874, "last_edit_date": 1512687479, "question_id": 29420653, "link": "https://stackoverflow.com/questions/29420653/how-to-get-pointer-of-object-created-with-reflect-new-in-golang", "title": "How to get pointer of object created with reflect.New() in golang", "body": "<p>I have a function which must accept object type. Then it must unmarshal XML to an object of a given type.</p>\n\n<p>Getting object type with reflect:</p>\n\n<pre><code>objType := reflect.TypeOf(CustomObjectType{})\nUnmarshalWorker(objType)\n</code></pre>\n\n<p>Unmarshal function:</p>\n\n<pre><code>func UnmarshalFeedGeneric (data []byte,objType reflect.Type) {\n    unm := reflect.New(objType)\n    err := xml.Unmarshal(data, unm.Interface())\n}\n</code></pre>\n\n<p>And 'unm' always return nil value.</p>\n\n<pre><code>fmt.Println(unm)\nfmt.Println(unm.Elem())\nfmt.Println(unm.Interface())\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&lt;*main.CustomObjectType Value&gt;\n&lt;main.CustomObjectType Value&gt;\n&amp;{ &lt;nil&gt;   0}\n</code></pre>\n"}, {"tags": ["go", "pipe", "stdin"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 2, "creation_date": 1427996783, "post_id": 29418868, "comment_id": 47010330, "body": "It&#39;s not about Go exactly. Maybe named pipes FIFO(7) (<a href=\"http://man7.org/linux/man-pages/man7/fifo.7.html\" rel=\"nofollow noreferrer\">man7.org/linux/man-pages/man7/fifo.7.html</a>) can help?"}, {"owner": {"reputation": 13244, "user_id": 317915, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/86d01c87cc6f22c8445661b72b6b0d78?s=128&d=identicon&r=PG", "display_name": "topskip", "link": "https://stackoverflow.com/users/317915/topskip"}, "edited": false, "score": 0, "creation_date": 1428000377, "post_id": 29418868, "comment_id": 47012209, "body": "Perhaps use <code>&#47;dev&#47;fd3</code> as a channel? Not tried but something like that: <code>tail ... 1&gt;&amp;3 | go run ...</code> and then open <code>&#47;dev&#47;fd3</code> for tail input and stdin for keyboard. I have no idea if this works, but I don&#39;t see a reason why it shouldn&#39;t."}], "answers": [{"comments": [{"owner": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "edited": false, "score": 0, "creation_date": 1428013511, "post_id": 29420586, "comment_id": 47018434, "body": "It&#39;s not just Linux; the other Unix systems work fine with this too."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1428013700, "last_edit_date": 1428013700, "creation_date": 1428001622, "answer_id": 29420586, "question_id": 29418868, "link": "https://stackoverflow.com/questions/29418868/can-a-go-program-read-from-the-keyboard-when-stdin-is-something-else/29420586#29420586", "title": "Can a Go program read from the keyboard when stdin is something else?", "body": "<p>On linux (and POSIX in general), you can open <code>/dev/tty</code> to get the input to the controlling tty for your process.</p>\n\n<pre><code>func readStdin() {\n    buf := make([]byte, 1024)\n    for {\n        n, err := os.Stdin.Read(buf)\n        if err != nil &amp;&amp; err != io.EOF {\n            log.Fatal(err)\n        }\n        fmt.Print(\"FROM STDIN:\", string(buf[:n]))\n        if err == io.EOF {\n            return\n        }\n    }\n}\n\nfunc main() {\n    go readStdin()\n\n    buf := make([]byte, 1024)\n    tty, err := os.Open(\"/dev/tty\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer tty.Close()\n    for {\n        n, err := tty.Read(buf)\n        if err != nil &amp;&amp; err != io.EOF {\n            log.Fatal(err)\n        }\n        fmt.Print(\"FROM TTY:\", string(buf[:n]))\n        if err == io.EOF {\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>Which can output:</p>\n\n<pre><code>$ echo HELLO | ./tty_reader\nFROM STDIN:HELLO\ntyping on my keyboard\nFROM TTY:typing on my keyboard\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1428081179, "post_id": 29434775, "comment_id": 47042186, "body": "This is <i>extremely</i> shell specific (bash only?)."}], "tags": [], "owner": {"reputation": 7882, "user_id": 2722968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d0a9ce812892f03b8342c5a60be24632?s=128&d=identicon&r=PG&f=1", "display_name": "user2722968", "link": "https://stackoverflow.com/users/2722968/user2722968"}, "is_accepted": false, "score": -1, "last_activity_date": 1428073692, "creation_date": 1428073692, "answer_id": 29434775, "question_id": 29418868, "link": "https://stackoverflow.com/questions/29418868/can-a-go-program-read-from-the-keyboard-when-stdin-is-something-else/29434775#29434775", "title": "Can a Go program read from the keyboard when stdin is something else?", "body": "<p>You can use the shell to create a pipe for you to feed input to your program while leaving stdin free for other things. Something to the sound of</p>\n\n<pre><code>go run myprog.go &lt;(tail -f something.foo)\n</code></pre>\n\n<p>The shell will execute <code>tail</code> and redirect it's stdout to a new fifo. Your program receives the fifo as first argument, pointing to <code>/proc/self/fd/1234567</code></p>\n"}], "owner": {"reputation": 389, "user_id": 1566921, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9e82f5ce51b38fd69d6ccb3e215cfd7?s=128&d=identicon&r=PG", "display_name": "william", "link": "https://stackoverflow.com/users/1566921/william"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 29420586, "answer_count": 2, "score": 0, "last_activity_date": 1428073692, "creation_date": 1427995510, "question_id": 29418868, "link": "https://stackoverflow.com/questions/29418868/can-a-go-program-read-from-the-keyboard-when-stdin-is-something-else", "title": "Can a Go program read from the keyboard when stdin is something else?", "body": "<p>I have a Go process that accepts input via pipe.</p>\n\n<blockquote>\n  <p>tail -f something.foo | go run myprog.go</p>\n</blockquote>\n\n<p>Since stdin is the output of the pipe, I can't find a way to read keyboard input in myprog.go.  Is this possible?</p>\n\n<p>I considered executing the tail command inside of myprog.go, but I want to avoid creating another process in the event myprog.go crashes and fails to terminate the other one.</p>\n"}, {"tags": ["go", "frameworks", "cors", "preflight", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 2297, "user_id": 661378, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/853372c681dc96b95f42adcb88b0cb3f?s=128&d=identicon&r=PG", "display_name": "qwertmax", "link": "https://stackoverflow.com/users/661378/qwertmax"}, "edited": false, "score": 0, "creation_date": 1428129496, "post_id": 29439630, "comment_id": 47054676, "body": "Why 204? Why not 200?"}, {"owner": {"reputation": 199, "user_id": 4822520, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0bHvs.jpg?s=128&g=1", "display_name": "Billcountry", "link": "https://stackoverflow.com/users/4822520/billcountry"}, "edited": false, "score": 1, "creation_date": 1594872826, "post_id": 29439630, "comment_id": 111280422, "body": "HTTP NoContent coz duh!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8237421"}, "edited": false, "score": 0, "creation_date": 1602658172, "post_id": 29439630, "comment_id": 113786507, "body": "Almost 6 years old and still great. Fixed my problem in no time. Yet I wonder why this is not part of the official documentation on github..."}, {"owner": {"reputation": 374, "user_id": 8164339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2fe04acfd7bb971681cfd7291237cac?s=128&d=identicon&r=PG&f=1", "display_name": "Gireesh Kudipudi", "link": "https://stackoverflow.com/users/8164339/gireesh-kudipudi"}, "edited": false, "score": 0, "creation_date": 1606960597, "post_id": 29439630, "comment_id": 115124771, "body": "Thanks @Jack . Able to add this only at the root of the application. Not working only for group routes of the application for which i added some conditions based on the route url."}], "tags": [], "owner": {"reputation": 18829, "user_id": 24998, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2c14a4f2931fa9336fdccdfe11318fef?s=128&d=identicon&r=PG", "display_name": "Jack", "link": "https://stackoverflow.com/users/24998/jack"}, "is_accepted": true, "score": 50, "last_activity_date": 1428094896, "creation_date": 1428094896, "answer_id": 29439630, "question_id": 29418478, "link": "https://stackoverflow.com/questions/29418478/go-gin-framework-cors/29439630#29439630", "title": "Go gin framework CORS", "body": "<p>FWIW, this is my CORS Middleware that works for my needs.</p>\n\n<pre><code>func CORSMiddleware() gin.HandlerFunc {\n    return func(c *gin.Context) {\n        c.Writer.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n        c.Writer.Header().Set(\"Access-Control-Allow-Credentials\", \"true\")\n        c.Writer.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, accept, origin, Cache-Control, X-Requested-With\")\n        c.Writer.Header().Set(\"Access-Control-Allow-Methods\", \"POST, OPTIONS, GET, PUT\")\n\n        if c.Request.Method == \"OPTIONS\" {\n            c.AbortWithStatus(204)\n            return\n        }\n\n        c.Next()\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3317, "user_id": 3368262, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/46241f9045a40bec251e7226913d443f?s=128&d=identicon&r=PG", "display_name": "Rahul Garg", "link": "https://stackoverflow.com/users/3368262/rahul-garg"}, "is_accepted": false, "score": 3, "last_activity_date": 1510595496, "creation_date": 1510595496, "answer_id": 47270527, "question_id": 29418478, "link": "https://stackoverflow.com/questions/29418478/go-gin-framework-cors/47270527#47270527", "title": "Go gin framework CORS", "body": "<p>We created a minimal middleware.</p>\n\n<pre><code>import (\n    \"github.com/gin-gonic/gin\"\n    \"net/http\"\n)\n\ntype optionsMiddleware struct {\n\n}\n\nfunc CreateOptionsMiddleware() *optionsMiddleware{\n    return &amp;optionsMiddleware{}\n}\n\nfunc (middleware *optionsMiddleware)Response(context *gin.Context){\n    if context.Request.Method == \"OPTIONS\" {\n        context.AbortWithStatus(http.StatusNoContent)\n    }\n}\n</code></pre>\n\n<p>and register it with gin middleware :</p>\n\n<pre><code>app  := gin.New()\napp.Use(middleware.CreateOptionsMiddleware().Response).\n    Use(next-middleware)......\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3147, "user_id": 713454, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0ae8514d996b7ba615fe370f95df58f4?s=128&d=identicon&r=PG&f=1", "display_name": "Dracontis", "link": "https://stackoverflow.com/users/713454/dracontis"}, "edited": false, "score": 2, "creation_date": 1518514522, "post_id": 48763475, "comment_id": 84527523, "body": "This answer is prepared because I could still encounter this question in Google, so It could be pretty useful for people who seek solution to gin-cors problems. Also, text of the answer repeats readme from github page as pure links isn&#39;t good practice for SO answer."}], "tags": [], "owner": {"reputation": 3147, "user_id": 713454, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0ae8514d996b7ba615fe370f95df58f4?s=128&d=identicon&r=PG&f=1", "display_name": "Dracontis", "link": "https://stackoverflow.com/users/713454/dracontis"}, "is_accepted": false, "score": 12, "last_activity_date": 1518514310, "creation_date": 1518514310, "answer_id": 48763475, "question_id": 29418478, "link": "https://stackoverflow.com/questions/29418478/go-gin-framework-cors/48763475#48763475", "title": "Go gin framework CORS", "body": "<p>There is also official gin's middleware for handling CORS requests <a href=\"https://github.com/gin-contrib/cors\" rel=\"noreferrer\">github.com/gin-contrib/cors</a>.</p>\n\n<p>You could install it using <code>$ go get github.com/gin-contrib/cors</code> and then add this middleware in your application like this:\npackage main</p>\n\n<pre><code>import (\n    \"time\"\n\n    \"github.com/gin-contrib/cors\"\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n    router := gin.Default()\n    // CORS for https://foo.com and https://github.com origins, allowing:\n    // - PUT and PATCH methods\n    // - Origin header\n    // - Credentials share\n    // - Preflight requests cached for 12 hours\n    router.Use(cors.New(cors.Config{\n        AllowOrigins:     []string{\"https://foo.com\"},\n        AllowMethods:     []string{\"PUT\", \"PATCH\"},\n        AllowHeaders:     []string{\"Origin\"},\n        ExposeHeaders:    []string{\"Content-Length\"},\n        AllowCredentials: true,\n        AllowOriginFunc: func(origin string) bool {\n            return origin == \"https://github.com\"\n        },\n        MaxAge: 12 * time.Hour,\n    }))\n    router.Run()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1190, "user_id": 830979, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ffeR.jpg?s=128&g=1", "display_name": "Alexander I.Grafov", "link": "https://stackoverflow.com/users/830979/alexander-i-grafov"}, "is_accepted": false, "score": 2, "last_activity_date": 1550736587, "creation_date": 1550736587, "answer_id": 54802142, "question_id": 29418478, "link": "https://stackoverflow.com/questions/29418478/go-gin-framework-cors/54802142#54802142", "title": "Go gin framework CORS", "body": "<p>There is package <a href=\"https://github.com/rs/cors\" rel=\"nofollow noreferrer\">https://github.com/rs/cors</a>, that handles CORS requests in the right way. It has the examples for the popular routers including <code>gin</code>. That it:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/gin-gonic/gin\"\n    cors \"github.com/rs/cors/wrapper/gin\"\n)\n\nfunc main() {\n    router := gin.Default()\n\n    router.Use(cors.Default())\n    router.GET(\"/\", func(context *gin.Context) {\n        context.JSON(http.StatusOK, gin.H{\"hello\": \"world\"})\n    })\n\n    router.Run(\":8080\")\n}\n</code></pre>\n\n<p>In common case, you just add the default handling with <code>router.Use(cors.Default())</code> to your middlewares in <code>gin</code>. It is enough.</p>\n"}, {"tags": [], "owner": {"reputation": 2236, "user_id": 1027507, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/l3gfz.jpg?s=128&g=1", "display_name": "Mesut Tasci", "link": "https://stackoverflow.com/users/1027507/mesut-tasci"}, "is_accepted": false, "score": -1, "last_activity_date": 1565170222, "creation_date": 1565170222, "answer_id": 57391195, "question_id": 29418478, "link": "https://stackoverflow.com/questions/29418478/go-gin-framework-cors/57391195#57391195", "title": "Go gin framework CORS", "body": "<p>There is an official gin cors plugin <a href=\"https://github.com/gin-contrib/cors\" rel=\"nofollow noreferrer\">gin-contrib/cors</a>. You should use it</p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 10389370, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yWBWpxO6Yq0/AAAAAAAAAAI/AAAAAAAABBo/NpwJpcRGauE/photo.jpg?sz=128", "display_name": "Rahul S", "link": "https://stackoverflow.com/users/10389370/rahul-s"}, "is_accepted": false, "score": 4, "last_activity_date": 1603731347, "last_edit_date": 1603731347, "creation_date": 1599652718, "answer_id": 63811206, "question_id": 29418478, "link": "https://stackoverflow.com/questions/29418478/go-gin-framework-cors/63811206#63811206", "title": "Go gin framework CORS", "body": "<pre><code>func CORSMiddleware() gin.HandlerFunc {\n    return func(c *gin.Context) {\n\n        c.Header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)\n        c.Header(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;)\n        c.Header(&quot;Access-Control-Allow-Headers&quot;, &quot;Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, accept, origin, Cache-Control, X-Requested-With&quot;)\n        c.Header(&quot;Access-Control-Allow-Methods&quot;, &quot;POST,HEAD,PATCH, OPTIONS, GET, PUT&quot;)\n\n        if c.Request.Method == &quot;OPTIONS&quot; {\n            c.AbortWithStatus(204)\n            return\n        }\n\n        c.Next()\n    }\n}\n</code></pre>\n<p>then use it</p>\n<pre><code>router = gin.New()  \nrouter.Use(CORSMiddleware())\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 43, "user_id": 4647954, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lylwy.jpg?s=128&g=1", "display_name": "Hayden Wiltshire", "link": "https://stackoverflow.com/users/4647954/hayden-wiltshire"}, "is_accepted": false, "score": 1, "last_activity_date": 1606457360, "creation_date": 1606457360, "answer_id": 65032800, "question_id": 29418478, "link": "https://stackoverflow.com/questions/29418478/go-gin-framework-cors/65032800#65032800", "title": "Go gin framework CORS", "body": "<p>This worked for me - NOTE: the setting of header directly.</p>\n<pre><code>func CORSMiddleware() gin.HandlerFunc {\n    return func(c *gin.Context) {\n\n        c.Header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)\n        c.Header(&quot;Access-Control-Allow-Headers&quot;, &quot;*&quot;)\n        /*\n            c.Writer.Header().Set(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)\n            c.Writer.Header().Set(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;)\n            c.Writer.Header().Set(&quot;Access-Control-Allow-Headers&quot;, &quot;access-control-allow-origin, access-control-allow-headers&quot;)\n            c.Writer.Header().Set(&quot;Access-Control-Allow-Methods&quot;, &quot;GET, HEAD, POST, PUT, DELETE, OPTIONS, PATCH&quot;)\n        */\n\n        if c.Request.Method == &quot;OPTIONS&quot; {\n            c.AbortWithStatus(204)\n            return\n        }\n\n        c.Next()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2297, "user_id": 661378, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/853372c681dc96b95f42adcb88b0cb3f?s=128&d=identicon&r=PG", "display_name": "qwertmax", "link": "https://stackoverflow.com/users/661378/qwertmax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 21849, "favorite_count": 7, "accepted_answer_id": 29439630, "answer_count": 7, "score": 25, "last_activity_date": 1606457360, "creation_date": 1427994197, "last_edit_date": 1518515487, "question_id": 29418478, "link": "https://stackoverflow.com/questions/29418478/go-gin-framework-cors", "title": "Go gin framework CORS", "body": "<p>I'm using Go gin framework <a href=\"https://github.com/gin-gonic/gin\" rel=\"noreferrer\">gin</a></p>\n\n<pre><code>func CORSMiddleware() gin.HandlerFunc {\n    return func(c *gin.Context) {\n        c.Writer.Header().Set(\"Content-Type\", \"application/json\")\n        c.Writer.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n        c.Writer.Header().Set(\"Access-Control-Max-Age\", \"86400\")\n        c.Writer.Header().Set(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, PUT, DELETE, UPDATE\")\n        c.Writer.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, X-Max\")\n        c.Writer.Header().Set(\"Access-Control-Allow-Credentials\", \"true\")\n\n        if c.Request.Method == \"OPTIONS\" {\n            c.AbortWithStatus(200)\n        } else {\n            c.Next()\n        }\n    }\n}\n</code></pre>\n\n<p>I've got Status Code:200 OK, but nothing happens after OPTIONS request. \nIt looks like I miss something, but I can't understand where am I wrong.</p>\n\n<p>Can anybody help me? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1427991230, "post_id": 29417363, "comment_id": 47007316, "body": "You&#39;re probably being rate-limited, and the server just closes your connection. Put a sleep between calls and see what happens."}, {"owner": {"reputation": 4991, "user_id": 441935, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/24e14a302cb155b103f4f203f06a65a4?s=128&d=identicon&r=PG", "display_name": "Daniel Nill", "link": "https://stackoverflow.com/users/441935/daniel-nill"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1427992209, "post_id": 29417363, "comment_id": 47007843, "body": "<code>$.get(&quot;http:&#47;&#47;hacker-news.firebaseio.com&#47;v0&#47;topstories.json&quot;&zwnj;&#8203;, function(data){   for(i in data){     $.get(&quot;http:&#47;&#47;hacker-news.firebaseio.com&#47;v0&#47;item&#47;&quot; + i + &quot;.json&quot;, function(data){       console.log(data);     })   } })</code> works fine.  Unless the browser is handling a timeout for me, it doesn&#39;t appear to be a rate limit issue."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1427993302, "post_id": 29417363, "comment_id": 47008410, "body": "ha, the sleep worked by accident, since the client then had time to detect that the connections were getting closed by the server."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1427994700, "last_edit_date": 1427994700, "creation_date": 1427992974, "answer_id": 29418125, "question_id": 29417363, "link": "https://stackoverflow.com/questions/29417363/requesting-multiple-urls-in-go/29418125#29418125", "title": "Requesting multiple URLs in Go", "body": "<p>It looks like there's something wrong with their server, and it's closing connections without sending a <code>Connection: close</code> header. The client therefore tries to reuse the connection per the HTTP/1.1 specification.</p>\n\n<p>You can work around this by creating your own request, and setting <code>Close = true</code>, or using a custom Transport with <code>DisableKeepAlives = true</code></p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", url, nil)\nif err != nil {\n    return nil, err\n}\nreq.Close = true\n\nres, err := http.DefaultClient.Do(req)\nif err != nil {\n    return nil, err\n}\n</code></pre>\n"}], "owner": {"reputation": 4991, "user_id": 441935, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/24e14a302cb155b103f4f203f06a65a4?s=128&d=identicon&r=PG", "display_name": "Daniel Nill", "link": "https://stackoverflow.com/users/441935/daniel-nill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 0, "accepted_answer_id": 29418125, "answer_count": 1, "score": 1, "last_activity_date": 1427994883, "creation_date": 1427990368, "last_edit_date": 1427994883, "question_id": 29417363, "link": "https://stackoverflow.com/questions/29417363/requesting-multiple-urls-in-go", "title": "Requesting multiple URLs in Go", "body": "<p>I have the following Go program: <a href=\"https://play.golang.org/p/-TUtJ7DIhi\" rel=\"nofollow\">https://play.golang.org/p/-TUtJ7DIhi</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"strconv\"\n)\n\nfunc main() {\n    body, err := get(\"https://hacker-news.firebaseio.com/v0/topstories.json\")\n\n    if err != nil {\n        panic(err)\n    }\n\n    var ids [500]int\n    if err = json.Unmarshal(body, &amp;ids); err != nil {\n        panic(err)\n    }\n\n    var contents []byte\n    for _, value := range ids[0:10] {\n        body, err := get(\"https://hacker-news.firebaseio.com/v0/item/\" + strconv.Itoa(value) + \".json\")\n\n        if err != nil {\n            fmt.Println(err)\n        } else {\n            contents = append(contents, body...)\n        }\n    }\n\n    fmt.Println(contents)\n}\n\nfunc get(url string) ([]byte, error) {\n    res, err := http.Get(url)\n    if err != nil {\n        return nil, err\n    }\n\n    body, err := ioutil.ReadAll(res.Body)\n    res.Body.Close()\n\n    return body, err\n}\n</code></pre>\n\n<p>When run it throws <code>EOF json</code> errors on the iterative get requests, but when I hit the URLs individually they do not appear to be malformed.</p>\n\n<p>What am I missing?</p>\n"}, {"tags": ["node.js", "go", "redis", "background-process"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1427990578, "post_id": 29416837, "comment_id": 47006900, "body": "<code>BRPOP</code> is supposed to block. What does the error you&#39;re ignoring say?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1427991014, "post_id": 29416837, "comment_id": 47007192, "body": "Calling BRPOP in a loop is the way to do it.  Can you show the output from the program and explain how it differs from what you expect?"}, {"owner": {"reputation": 1117, "user_id": 763557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b270ca8a89f85baa6e84e016e18df635?s=128&d=identicon&r=PG&f=1", "display_name": "wgp", "link": "https://stackoverflow.com/users/763557/wgp"}, "edited": false, "score": 0, "creation_date": 1427996725, "post_id": 29416837, "comment_id": 47010303, "body": "There isn&#39;t an error that I&#39;m ignoring, at least not that I know of. What&#39;s being output is <code>Looking for a new Q item...</code> then <code>No error, &quot;</code>. And this repeats infinitely even when there are no items in the list. What I&#39;m expecting is that if there are no items to process the program will say &quot;Looking for a new Q item...&quot; just <i>once</i> and not run the loop again until Redis has something to return. That&#39;s what I thought a blocking command was supposed to do. If this is running as expected, is this the proper way to keep this process running in the background? Feels like a hack with a better way."}, {"owner": {"reputation": 1117, "user_id": 763557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b270ca8a89f85baa6e84e016e18df635?s=128&d=identicon&r=PG&f=1", "display_name": "wgp", "link": "https://stackoverflow.com/users/763557/wgp"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1427997728, "post_id": 29416837, "comment_id": 47010846, "body": "Actually, @JimB was right! Rookie mistake. My error handling code and success handling code are mixed up. So I was getting and ignoring an error which was that I gave the wrong number of arguments for the brpop command."}], "answers": [{"tags": [], "owner": {"reputation": 1117, "user_id": 763557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b270ca8a89f85baa6e84e016e18df635?s=128&d=identicon&r=PG&f=1", "display_name": "wgp", "link": "https://stackoverflow.com/users/763557/wgp"}, "is_accepted": true, "score": 2, "last_activity_date": 1427998670, "creation_date": 1427998670, "answer_id": 29419764, "question_id": 29416837, "link": "https://stackoverflow.com/questions/29416837/how-to-make-a-go-app-wait-for-data-to-become-available-in-a-redis-list/29419764#29419764", "title": "How to make a Go app wait for data to become available in a Redis list?", "body": "<p>@JimB deserves the credit. I switched up the error and success handlers. I was giving too few arguments to the BRPOP command. This code within the loop fixed it:</p>\n\n<pre><code>// We now import \"log\" now as well\n// Inside the for loop...\nif err != nil {\n  log.Fatal(err) // This alerted me to the wrong # of arguments issue\n} else {\n  fmt.Println(\"No error to be had \" + workItem) // Will not print until there is an item in the list\n}\n</code></pre>\n\n<p>Thanks everyone.</p>\n"}], "owner": {"reputation": 1117, "user_id": 763557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b270ca8a89f85baa6e84e016e18df635?s=128&d=identicon&r=PG&f=1", "display_name": "wgp", "link": "https://stackoverflow.com/users/763557/wgp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 1, "accepted_answer_id": 29419764, "answer_count": 1, "score": 0, "last_activity_date": 1427998670, "creation_date": 1427988788, "last_edit_date": 1427998593, "question_id": 29416837, "link": "https://stackoverflow.com/questions/29416837/how-to-make-a-go-app-wait-for-data-to-become-available-in-a-redis-list", "title": "How to make a Go app wait for data to become available in a Redis list?", "body": "<p>I have a Go app that is using the <a href=\"https://github.com/fzzy/radix\" rel=\"nofollow\">Radix Redis client for Go</a>. Its job is to run as a background process and wait for a Redis list to have items added to it for processing.</p>\n\n<p><strong>Background (feel free to skip)</strong>: I have a Node.js web app that has a need to request data from an external API that's been known to take at least an entire second or more to respond. The data isn't required immediately so I'm having the Node app add an item to a Redis list and move on to the important stuff. Meanwhile, I have a Go app that is supposed to run behind the scenes and do some work each time it finds an item has been added to the list.</p>\n\n<p>Right now it's just a <code>main</code> function that connects to Redis and checks to see if a list has items in it using the Redis <code>BRPOP</code> command (because I want Redis to block while its waiting for jobs). Running the program results in a connection being made and then...</p>\n\n<ul>\n<li>If there's an item in a list, the Go app processes it however it needs to</li>\n<li>If there's no items in the list then the Go app just quits</li>\n</ul>\n\n<p>I need the Go app to just sit there and wait for new items and I really don't want to resort to polling especially since the BRPOP and BLPUSH commands are made specifically so apps don't need to poll.</p>\n\n<p>My current solution is to just create an infinite loop that runs the BRPOP command over and over again forever. This feels like the wrong way to do it.</p>\n\n<p>Here's the entire program so far (I'm completely new to Go but not to programming so don't laugh too hard):</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"github.com/fzzy/radix/redis\"\n)\n\nfunc main() {\n  client, err := redis.Dial(\"tcp\", \"localhost:6379\")\n\n  if err != nil {\n    fmt.Println(\"An error message just for debug purposes\")\n  } else {\n    // Here I check to make sure the server is responding\n    ping := client.Cmd(\"PING\")\n    fmt.Println(ping) // Just to be sure I'm doing things right\n\n    for {\n      fmt.Println(\"Looking for a new Q item...\")\n      workItem, err := client.Cmd(\"BRPOP\", \"q:test\").Str()\n\n      if err != nil {\n        fmt.Println(\"No error, \" + workItem)\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>So what is the proper way to make a Go app wait for data to become available in a Redis list?</p>\n\n<p><strong>Update:</strong> Based on some of the comments I'll explain a little further what I'm expecting and what's happening.</p>\n\n<p>My understanding of a blocking Redis command is that it will just pause the program calling it until it has something to return. So in my case, when running the program with no items in the queue the program prints:</p>\n\n<pre><code>Looking for a new Q item...\nNo error, \n</code></pre>\n\n<p>It prints the above infinitely which makes sense since I have a never-ending for loop <strong>but</strong> because I'm using the blocking command, I was expecting it to behave more like a push. I expected the loop to just pause and wait until there's an item in the queue before moving on to the next iteration. My concern with it continuing to loop even with no queue items is that eventually the process will start to consume resources unnecessarily and slow down Redis because of the constant barrage of <code>BRPOP</code> commands (despite it being a blocking command).</p>\n\n<p>So I suppose now the new questions would be\n- Is there a better way to keep the Go program running while waiting for new items in the Redis list (or my makeshift queue)?\n- Will running this program in its current form consume more resources than it should and/or degrade Redis performance?</p>\n\n<h2>Solved</h2>\n\n<p>Thanks to @JimB's question about the \"error you're ignoring...\" I took a second look at the code to make sure I wasn't missing something obvious. I was: Turns out that in my loop I had switched up the error and success handling code. So each time it errored out I would print a success message to the console just so I could see what was happening inside the program. After switching the code and correctly handling the error I found that I was calling <code>BRPOP</code> with too few arguments. I fixed the code and now the loop will just hang there until there's something in the list to handle.</p>\n\n<p>Corrected lines below:</p>\n\n<pre><code>// We now import \"log\" now as well\n// Inside the for loop...\nif err != nil {\n  log.Fatal(err) // This alerted me to the wrong # of arguments issue\n} else {\n  fmt.Println(\"No error to be had \" + workItem) // Will not print until there is an item in the list\n}\n</code></pre>\n\n<p>I guess I was doing it right all along. If there are any comments or suggestions about performance or better ways to do this, however, I'm still all hears and would love to hear them.</p>\n"}, {"tags": ["go", "system-calls", "uname"], "comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 1, "creation_date": 1427986322, "post_id": 29415909, "comment_id": 47004102, "body": "It doesn&#39;t look like you&#39;re doing something wrong. Can you make sure your Go version is 1.4.2 by running <code>go version</code>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1427986428, "post_id": 29415909, "comment_id": 47004171, "body": "check <code>go env</code> too, making sure GOARCH and GOOS are correct."}, {"owner": {"reputation": 68230, "user_id": 1426056, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3ac815b6fca201737db888a28efd7248?s=128&d=identicon&r=PG", "display_name": "waitingkuo", "link": "https://stackoverflow.com/users/1426056/waitingkuo"}, "edited": false, "score": 0, "creation_date": 1427986512, "post_id": 29415909, "comment_id": 47004223, "body": "I got <code>go version go1.4.2 darwin&#47;amd64</code> by <code>go version</code>"}, {"owner": {"reputation": 68230, "user_id": 1426056, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3ac815b6fca201737db888a28efd7248?s=128&d=identicon&r=PG", "display_name": "waitingkuo", "link": "https://stackoverflow.com/users/1426056/waitingkuo"}, "edited": false, "score": 0, "creation_date": 1427986558, "post_id": 29415909, "comment_id": 47004257, "body": "buy my <code>goroot</code> is <code>GOROOT=&quot;&#47;usr&#47;local&#47;Cellar&#47;go&#47;1.4&#47;libexec&quot;</code>"}, {"owner": {"reputation": 68230, "user_id": 1426056, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3ac815b6fca201737db888a28efd7248?s=128&d=identicon&r=PG", "display_name": "waitingkuo", "link": "https://stackoverflow.com/users/1426056/waitingkuo"}, "edited": false, "score": 0, "creation_date": 1427986620, "post_id": 29415909, "comment_id": 47004300, "body": "I just used brew to upgrade to 1.4.2 ."}, {"owner": {"reputation": 68230, "user_id": 1426056, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3ac815b6fca201737db888a28efd7248?s=128&d=identicon&r=PG", "display_name": "waitingkuo", "link": "https://stackoverflow.com/users/1426056/waitingkuo"}, "edited": false, "score": 1, "creation_date": 1427986791, "post_id": 29415909, "comment_id": 47004417, "body": "my <code>goroot</code> is now GOROOT=&quot;/usr/local/Cellar/go/1.4.2/libexec&quot; after opening a new terminal tab. But I still got the same errors"}], "answers": [{"tags": [], "owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "is_accepted": false, "score": 8, "last_activity_date": 1427990075, "creation_date": 1427990075, "answer_id": 29417273, "question_id": 29415909, "link": "https://stackoverflow.com/questions/29415909/cannot-get-uname-by-golang/29417273#29417273", "title": "Cannot get Uname by golang", "body": "<p><strong>TL;DR</strong> <code>Uname</code> and <code>Utsname</code> are not available for OSX.</p>\n\n<p>The reason is because those functions are not defined for the operating system. </p>\n\n<p>Reading the documentation for <code>syscall</code> this jumped at me: </p>\n\n<blockquote>\n  <p>The details vary depending on the underlying system, and by default, godoc will display the syscall documentation for the current system. If you want godoc to display syscall documentation for another system, set $GOOS and $GOARCH to the desired system.</p>\n</blockquote>\n\n<p>Running <code>godoc syscall</code> on my Mac yielded the <code>sycall</code> documentation which does not include the <code>Utsname</code> type nor the <code>Uname</code> function call. </p>\n\n<p>However, running <code>GOOS=linux GOARCH=amd64 godoc syscall</code> actually shows the <code>Utsname</code> and <code>Uname</code>. </p>\n\n<p>Also, note that the package itself is locked down in favor of OS specific packages </p>\n\n<p><a href=\"https://golang.org/pkg/syscall/\">https://golang.org/pkg/syscall/</a> => <a href=\"https://godoc.org/golang.org/x/sys\">https://godoc.org/golang.org/x/sys</a></p>\n"}], "owner": {"reputation": 68230, "user_id": 1426056, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3ac815b6fca201737db888a28efd7248?s=128&d=identicon&r=PG", "display_name": "waitingkuo", "link": "https://stackoverflow.com/users/1426056/waitingkuo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2543, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1427990075, "creation_date": 1427986087, "question_id": 29415909, "link": "https://stackoverflow.com/questions/29415909/cannot-get-uname-by-golang", "title": "Cannot get Uname by golang", "body": "<p>I'm using golang 1.4.2 on Mac</p>\n\n<p>I want to use <a href=\"https://golang.org/pkg/syscall/#Uname\" rel=\"nofollow\">Uname</a> to get some information, followings are my codes:</p>\n\n<pre><code>package main\n\nimport (\n  \"syscall\"\n)\n\nfunc main() {\n  utsname := syscall.Utsname{}\n  syscall.Uname(&amp;utsname)\n}\n</code></pre>\n\n<p>But I got these errors:</p>\n\n<pre><code># command-line-arguments\n./main.go:8: undefined: syscall.Utsname\n./main.go:9: undefined: syscall.Uname\n</code></pre>\n\n<p>Any went wrong?</p>\n"}, {"tags": ["regex", "go"], "answers": [{"comments": [{"owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "edited": false, "score": 0, "creation_date": 1427987853, "post_id": 29415910, "comment_id": 47005124, "body": "I had to wait for the &#39;you can accept this in x minutes message&#39;, otherwise I would have straight away."}], "tags": [], "owner": {"reputation": 21514, "user_id": 211627, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "JDB still remembers Monica", "link": "https://stackoverflow.com/users/211627/jdb-still-remembers-monica"}, "is_accepted": true, "score": 4, "last_activity_date": 1427993344, "last_edit_date": 1427993344, "creation_date": 1427986096, "answer_id": 29415910, "question_id": 29415857, "link": "https://stackoverflow.com/questions/29415857/why-does-my-regular-expression-always-fail-in-go/29415910#29415910", "title": "Why does my regular expression ALWAYS fail in Go?", "body": "<p>Go regular expressions should not be surrounded with <code>/</code> characters. Remove those and see if that works.</p>\n\n<p>The <code>/</code> characters are used in some languages (such as javascript and ruby) when creating <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\" rel=\"nofollow\">regular expression literals</a> because the <code>\\</code> character is used frequently in regex and requires double escaping when in a regular string. It's just a convenience in some languages, but typically is not part of the actual regex syntax (though every language handles regex a bit differently).</p>\n\n<p>The Go language does not support regex literals, but it does have the concept of <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow\">string literals</a>, which makes it much easier to write complex regular expressions.</p>\n\n<p>So, for example, to find the string <code>\\.hidden-file-009</code>, you could write the expression as:</p>\n\n<pre><code>\"\\\\\\\\\\\\.[a-zA-Z0-9\\\\-_]*\"\n</code></pre>\n\n<p>or, more simply:</p>\n\n<pre><code> `\\\\\\.[a-zA-Z0-9\\-_]*`\n</code></pre>\n"}], "owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 0, "accepted_answer_id": 29415910, "answer_count": 1, "score": 1, "last_activity_date": 1427993344, "creation_date": 1427985940, "question_id": 29415857, "link": "https://stackoverflow.com/questions/29415857/why-does-my-regular-expression-always-fail-in-go", "title": "Why does my regular expression ALWAYS fail in Go?", "body": "<p>I know there are plenty of questions on here asking why their regex fails, but I can't see any specifically for Go/Golang.</p>\n\n<p>I have an ID type which is a string with some methods tacked on: <code>type ID string</code>, and this function which is supposed to return a bool if the ID is valid.</p>\n\n<p>My criteria for validity are:</p>\n\n<ul>\n<li>20 characters long.</li>\n<li>Any upper case letter A-Z.</li>\n<li>Any digit 0-9.</li>\n</ul>\n\n<p>So my regular expression, which I've tested on a few different online tools is <code>/[A-Z0-9]{20}/</code></p>\n\n<p>But every time I run my validate function it returns false, regardless of input. Specifically, the <code>regexp.MatchString()</code> function is returning false and nil.</p>\n\n<p>Below is my validation function, match is ALWAYS false, even when I change the regex to <code>/.{20}/</code> which is supposed to match 20 of anything.</p>\n\n<pre><code>func (this ID) validate() bool {\n\n    regexString := \"/[A-Z0-9]{\" + strconv.Itoa(MAX_ID_LENGTH) + \"}/\"\n    fmt.Println(regexString)\n\n    thisStr := this.ToString()\n    fmt.Println(thisStr)\n    charCount := utf8.RuneCountInString(thisStr)\n    fmt.Println(charCount)\n    thisStr = strings.ToUpper(thisStr)\n    fmt.Println(thisStr)\n    match, err := regexp.MatchString(regexString, thisStr)\n    fmt.Println(match, err)\n\n    //Check string length is correct and matches regex.\n    if charCount != MAX_ID_LENGTH || !match {\n        return false\n    } else {\n        return true\n    }\n}\n</code></pre>\n\n<p>Is it to do with the way I'm using the function? I'm stumped.</p>\n\n<p><strong>Note:</strong> the .ToUpper() function is there because when my IDs are generated they are only produced with upper case letters and 0-9, but I want \"abc\" to be treated as \"ABC\" if typed manually at a later date.</p>\n"}, {"tags": ["process", "go", "status"], "answers": [{"comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1427970929, "post_id": 29410430, "comment_id": 46994754, "body": "I&#39;d use <code>log.Println</code> rather than <code>panic</code> when launching a web server. <code>panic</code> will print a lot of stack trace, which isn&#39;t needed here."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1427971607, "post_id": 29410430, "comment_id": 46995108, "body": "@Ainar-G I agree, I would use that too, this was just for simplification of the example. But I added it to print if an instance is already running."}, {"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "edited": false, "score": 0, "creation_date": 1427973808, "post_id": 29410430, "comment_id": 46996359, "body": "very good explanation @icza ! I haven&#39;t thought about using a listener to accomplish the goal. Seen that I have already one, should be easy to implement the listener-solution. Thanks!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "edited": false, "score": 0, "creation_date": 1427974274, "post_id": 29410430, "comment_id": 46996612, "body": "@damoiser Please note that if your app already uses a webserver which you wish to use for stats too, you have to take care not to accidentally publish the stats to remote users. Please see my edited answer where I mention this."}, {"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "edited": false, "score": 0, "creation_date": 1427975147, "post_id": 29410430, "comment_id": 46997154, "body": "good point @icza , you have right. I must take care at this fact too. Thank you again"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1427976501, "last_edit_date": 1427976501, "creation_date": 1427969776, "answer_id": 29410430, "question_id": 29410102, "link": "https://stackoverflow.com/questions/29410102/get-custom-status-of-a-running-application/29410430#29410430", "title": "Get custom status of a running application", "body": "<p>The file system is not the only way to provide input for an application, there are many other ways, e.g. sending data to its standard input, the application may listen on a port for incoming connections or using any other peripherals (like microphone, sensors etc.).</p>\n\n<p>Since Go has a built-in webserver, it may be convenient to take advantage of it: the Go app can start the webserver (if it doesn't yet use it), and listen on a port for incoming connections, and when requests come, simply send back the status as simple text or in HTML format.</p>\n\n<p>Here is an example of it:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nvar (\n    waiting = 120\n    processing = 3414\n    done = 300\n)\n\nfunc ServeStats(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"%-22s : %d\\n\", \"jobs waiting in queue\", waiting)\n    fmt.Fprintf(w, \"%-22s : %d\\n\", \"processing jobs\", processing)\n    fmt.Fprintf(w, \"%-22s : %d\\n\", \"jobs done\", done)\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", ServeStats)\n    err := http.ListenAndServe(\"localhost:8081\", nil)\n    if err != nil {\n        fmt.Println(\"An instance of the application is already running!\",\n            \"Provide the 'status' parameter to see stats.\")\n    }\n}\n</code></pre>\n\n<p>The process that wants to get the status of your running app only has to make an <code>HTTP GET</code> request (e.g. wget in linux) to get the status. The above application serves the following status text as the response:</p>\n\n<pre><code>jobs waiting in queue  : 120\nprocessing jobs        : 3414\njobs done              : 300\n</code></pre>\n\n<p><strong>Important note:</strong></p>\n\n<p>I started the webserver on address <code>\"localhost:8081\"</code> which means the stats are only available from localhost (the same computer). If your app already uses the webserver, you may use that, but note that if it is reachable from the \"outside\" so will be your stats. If this is unwanted, you must check if the request (client) is originating from localhost, and if not you can deny serving the request.</p>\n\n<h2>Without an External Process</h2>\n\n<p>The \"external process\" that queries the status doesn't even have to be <em>external</em>, you can implement it in the application itself.</p>\n\n<p>Using your example: the application on startup can check if the <code>status</code> command line argument is present, and if so, it will not continue the normal startup process but perform the <code>HTTP GET</code> to get the status of the other running instance of the app, print it to the console and exit right after.</p>\n\n<p>Here's how you can do it. The modified <code>main()</code> function:</p>\n\n<pre><code>func main() {\n    if len(os.Args) &gt; 1 &amp;&amp; os.Args[1] == \"status\" {\n        getStatus()\n        return\n    }\n\n    http.HandleFunc(\"/\", ServeStats)\n    err := http.ListenAndServe(\"localhost:8081\", nil)\n    if err != nil {\n        fmt.Println(\"An instance of the application is already running!\",\n            \"Provide the 'status' parameter to see stats.\")\n    }\n}\n</code></pre>\n\n<p>And the implementation of <code>getStatus()</code>:</p>\n\n<pre><code>func getStatus() {\n    resp, err := http.Get(\"http://localhost:8081/\")\n    if err != nil {\n        fmt.Println(\"No running instance found!\")\n        return\n    }\n\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        fmt.Println(\"Running instance found but failed to get status!\")\n        return\n    }\n\n    fmt.Println(\"Status of the running instance:\")\n    fmt.Println(string(body))\n}\n</code></pre>\n\n<p>If you provide no arguments (or not the <code>\"status\"</code> one), the application tries to start normally.</p>\n\n<p>If you provide the argument <code>\"status\"</code>, it tries to get the status from a running instance. If succeeds, prints the received status. If not, prints that there is no running instance found. Either way, run terminates after that.</p>\n"}], "owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 29410430, "answer_count": 1, "score": 2, "last_activity_date": 1427976501, "creation_date": 1427968781, "question_id": 29410102, "link": "https://stackoverflow.com/questions/29410102/get-custom-status-of-a-running-application", "title": "Get custom status of a running application", "body": "<p>I would like to get the application status of a running application. For example: </p>\n\n<pre><code># start my app\n./my_app\n\n# require status\n./my_app status\n\n# it prints information about the application\n\njobs waiting in queue : 120\nprocessing jobs       : 3414\njobs done             : 300\n\nnumber of bad request received : 120\n\n[...]\n</code></pre>\n\n<p>I see for the moment only one option to accomplish this result: using an external process.</p>\n\n<p>The external process \"speak\" with the main application through a file (it <code>touch</code> a new file, so the main application \"knows\" that it must prepare the status report), then when the status report is ready, it send back to the external process (through a file), finally this one print the status to the cli.</p>\n\n<p>But personally I find this solution not so elegant.</p>\n\n<p>Do you have any others ideas to accomplish this? The application is written in Golang, are there maybe any tricks in Go to do this?</p>\n"}, {"tags": ["datetime", "go"], "answers": [{"comments": [{"owner": {"reputation": 6121, "user_id": 1513388, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/a235aa59e48586dcab866c685d042874?s=128&d=identicon&r=PG", "display_name": "user1513388", "link": "https://stackoverflow.com/users/1513388/user1513388"}, "edited": false, "score": 0, "creation_date": 1427969101, "post_id": 29410060, "comment_id": 46993668, "body": "Hmm, nice thank you. I can&#39;t believe I missed that. Is there a <code>time.strptime(string[, format])</code>  e.g. <code>time.strptime(&#39;11&#47;24&#47;2013&#39;, &quot;%m&#47;%d&#47;%Y&quot;)</code> equivalent ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6121, "user_id": 1513388, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/a235aa59e48586dcab866c685d042874?s=128&d=identicon&r=PG", "display_name": "user1513388", "link": "https://stackoverflow.com/users/1513388/user1513388"}, "edited": false, "score": 0, "creation_date": 1427969157, "post_id": 29410060, "comment_id": 46993706, "body": "@user1513388 Yes, there is. Check out the <a href=\"http://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\"><code>time.Parse()</code></a> function."}, {"owner": {"reputation": 6121, "user_id": 1513388, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/a235aa59e48586dcab866c685d042874?s=128&d=identicon&r=PG", "display_name": "user1513388", "link": "https://stackoverflow.com/users/1513388/user1513388"}, "edited": false, "score": 0, "creation_date": 1427972162, "post_id": 29410060, "comment_id": 46995406, "body": "Thanks I&#39;ve been just trying that.   I&#39;ve been hitting this issue though when trying to parse dates like this &quot;24/11/2013&quot; or this &quot;11/24/2013&quot;  <a href=\"http://stackoverflow.com/questions/14106541/go-parsing-date-time-strings-which-are-not-standard-formats\" title=\"go parsing date time strings which are not standard formats\">stackoverflow.com/questions/14106541/&hellip;</a> though which is rather confusing."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6121, "user_id": 1513388, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/a235aa59e48586dcab866c685d042874?s=128&d=identicon&r=PG", "display_name": "user1513388", "link": "https://stackoverflow.com/users/1513388/user1513388"}, "edited": false, "score": 0, "creation_date": 1427972364, "post_id": 29410060, "comment_id": 46995508, "body": "@user1513388 I don&#39;t think it&#39;s confusing. First you have to specify the format/layout in which the parseable input is presented. This is done by specifying a predefined date in using the format you want to parse: <code>time.Parse(&quot;01&#47;02&#47;2006&quot;, &quot;10&#47;15&#47;1983&quot;)</code> - first is the reference date, 2nd is the input <code>string</code> containing the date you want to parse."}, {"owner": {"reputation": 6121, "user_id": 1513388, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/a235aa59e48586dcab866c685d042874?s=128&d=identicon&r=PG", "display_name": "user1513388", "link": "https://stackoverflow.com/users/1513388/user1513388"}, "edited": false, "score": 0, "creation_date": 1427972697, "post_id": 29410060, "comment_id": 46995696, "body": "Yeah get that bit but how can I parse a european formatted date. This fails:   fmt.Print(time.Parse(&quot;23/02/06&quot;, &quot;15/06/13&quot;)) with 0001-01-01 00:00:00 +0000 UTC parsing time &quot;15/06/13&quot; as &quot;23/02/06&quot;: cannot parse &quot;/06/13&quot; as &quot;3&quot;"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6121, "user_id": 1513388, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/a235aa59e48586dcab866c685d042874?s=128&d=identicon&r=PG", "display_name": "user1513388", "link": "https://stackoverflow.com/users/1513388/user1513388"}, "edited": false, "score": 1, "creation_date": 1427972907, "post_id": 29410060, "comment_id": 46995830, "body": "@user1513388 Looks you don&#39;t fully grasped it. The layout <b>must</b> contain the reference date formatted which is <code>2006-01-02</code>. And you specified <code>2006-02-26</code> - that is not a valid layout."}, {"owner": {"reputation": 6121, "user_id": 1513388, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/a235aa59e48586dcab866c685d042874?s=128&d=identicon&r=PG", "display_name": "user1513388", "link": "https://stackoverflow.com/users/1513388/user1513388"}, "edited": false, "score": 0, "creation_date": 1427973463, "post_id": 29410060, "comment_id": 46996158, "body": "Arr OK. Thanks this works now fmt.Print(time.Parse(&quot;02/01/06&quot;, &quot;23/10/13&quot;)) &gt;&gt; 2013-10-23 00:00:00 +0000 UTC &lt;nil&gt;. Only other question is what does the &lt;nil&gt; mean ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6121, "user_id": 1513388, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/a235aa59e48586dcab866c685d042874?s=128&d=identicon&r=PG", "display_name": "user1513388", "link": "https://stackoverflow.com/users/1513388/user1513388"}, "edited": false, "score": 1, "creation_date": 1427973878, "post_id": 29410060, "comment_id": 46996403, "body": "@user1513388 Please check the documentation of <a href=\"http://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\"><code>time.Parse()</code></a>. It returns 2 values, the 2nd one is an <code>error</code> which will be <code>nil</code> if parsing succeeds."}, {"owner": {"reputation": 6121, "user_id": 1513388, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/a235aa59e48586dcab866c685d042874?s=128&d=identicon&r=PG", "display_name": "user1513388", "link": "https://stackoverflow.com/users/1513388/user1513388"}, "edited": false, "score": 0, "creation_date": 1427974641, "post_id": 29410060, "comment_id": 46996849, "body": "Thanks very much - its starting to make sense to me now."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1471954944, "last_edit_date": 1471954944, "creation_date": 1427968611, "answer_id": 29410060, "question_id": 29409908, "link": "https://stackoverflow.com/questions/29409908/calculating-deltas-between-two-dates-in-years-days-hours-mins-etc/29410060#29410060", "title": "Calculating deltas between two dates in years, days, hours, mins etc", "body": "<p>I don't know how you've spent your fair bit of time looking and not finding anything, but the <a href=\"http://golang.org/pkg/time/\" rel=\"nofollow\"><code>time</code></a> package of the standard library has everything you want.</p>\n\n<p>Here is your example coded in Go:</p>\n\n<pre><code>d0 := time.Date(2013, 8, 18, 0, 0, 0, 0, time.UTC)\nd1 := time.Date(2018, 9, 26, 0, 0, 0, 0, time.UTC)\n\ndelta := d0.Sub(d1)\n\nfmt.Println(delta.Hours() / 24)\n</code></pre>\n\n<p>Output (as expected):</p>\n\n<pre><code>-1865\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/LxufPaEjG9\" rel=\"nofollow\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 6121, "user_id": 1513388, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/a235aa59e48586dcab866c685d042874?s=128&d=identicon&r=PG", "display_name": "user1513388", "link": "https://stackoverflow.com/users/1513388/user1513388"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 29410060, "answer_count": 1, "score": -2, "last_activity_date": 1471954944, "creation_date": 1427968179, "question_id": 29409908, "link": "https://stackoverflow.com/questions/29409908/calculating-deltas-between-two-dates-in-years-days-hours-mins-etc", "title": "Calculating deltas between two dates in years, days, hours, mins etc", "body": "<p>I'm working on a Golang example that requires some date calculations. I was rather hoping that Go would provide some nice date libraries similar to the excellent Python <code>datetime</code> module, but that doesn't appear to be the case. </p>\n\n<p>How can I represent this python example in Go ? </p>\n\n<pre><code>from datetime import date\n\nd0 = date(2013, 8, 18)\nd1 = date(2018, 9, 26)\ndelta = d0 - d1\nprint delta.days\n&gt;&gt;-1865\n</code></pre>\n\n<p>I've spent a fair bit of time looking around on how to do this I can't seem to find a definitive answer that is clear and concise and without caveats such as not properly calculating leap years etc. </p>\n\n<p>This seems to be a fairly big limitation to what is becoming an excellent little language for building cross platform prototypes and eventually production applications.</p>\n"}, {"tags": ["javascript", "ajax", "go", "cors"], "answers": [{"comments": [{"owner": {"reputation": 459, "user_id": 1540033, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/275b35f80c93e82aa2c15456fd73b215?s=128&d=identicon&r=PG", "display_name": "mehdix_", "link": "https://stackoverflow.com/users/1540033/mehdix"}, "edited": false, "score": 0, "creation_date": 1427972698, "post_id": 29408704, "comment_id": 46995697, "body": "I have played with it with different tricks, didn&#39;t really seem to solve the problem."}, {"owner": {"reputation": 459, "user_id": 1540033, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/275b35f80c93e82aa2c15456fd73b215?s=128&d=identicon&r=PG", "display_name": "mehdix_", "link": "https://stackoverflow.com/users/1540033/mehdix"}, "edited": false, "score": 0, "creation_date": 1427972779, "post_id": 29408704, "comment_id": 46995754, "body": "My challenging question is if the problem is from the point where my AJAX call gets sent over the wire or is it my callback handler that fails to handle response from google?"}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 0, "last_activity_date": 1427964476, "creation_date": 1427964476, "answer_id": 29408704, "question_id": 29408491, "link": "https://stackoverflow.com/questions/29408491/enable-cors-in-golang-callback-function/29408704#29408704", "title": "Enable CORS in Golang callback function", "body": "<p>Just add CORS headers to your callbackHandler:</p>\n\n<pre><code>// make this configurable via command line flags, env var, or something\nvar MyServerName = \"https://localhost:8080\" \n\nfunc callbackHandler(w http.ResponseWriter, r *http.Request) {\n    w.Header().Add(\"Access-Control-Allow-Origin\", MyServerName)\n\n    fmt.Fprint(w, \"I am sent back from the server!\"+time.Now().Format(\"Mon, 02 Jan 2006 15:04:05 MST\"))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 700, "user_id": 4229820, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PSShC.jpg?s=128&g=1", "display_name": "Henri Koski", "link": "https://stackoverflow.com/users/4229820/henri-koski"}, "is_accepted": false, "score": 1, "last_activity_date": 1459871139, "last_edit_date": 1459871139, "creation_date": 1456169103, "answer_id": 35562121, "question_id": 29408491, "link": "https://stackoverflow.com/questions/29408491/enable-cors-in-golang-callback-function/35562121#35562121", "title": "Enable CORS in Golang callback function", "body": "<p>Like Not_a_Golfer said your backend is not setting correct headers to response. To handle CORS problem in every cases I made this little <a href=\"https://github.com/heppu/simple-cors\" rel=\"nofollow\">handler</a> that wraps your router so you don't have to manually set headers in every callback.</p>\n\n<p>Use it like this:</p>\n\n<pre><code>import \"github.com/heppu/simple-cors\"\n\nfunc init() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", rootHandler)\n    r.HandleFunc(\"/callback\", callbackHandler)\n    http.Handle(\"/\", cors.CORS(r))\n}\nfunc callbackHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"I am sent back from the server!\"+time.Now().Format(\"Mon, 02 Jan 2006 15:04:05 MST\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 459, "user_id": 1540033, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/275b35f80c93e82aa2c15456fd73b215?s=128&d=identicon&r=PG", "display_name": "mehdix_", "link": "https://stackoverflow.com/users/1540033/mehdix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4024, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1459871139, "creation_date": 1427963687, "question_id": 29408491, "link": "https://stackoverflow.com/questions/29408491/enable-cors-in-golang-callback-function", "title": "Enable CORS in Golang callback function", "body": "<p>I have an AJAX call to Google's oAuth2 api looks like this:</p>\n\n<pre><code>$(document).on('click', '#signup', function() {\n  var OAUTHURL        =  'https://accounts.google.com/o/oauth2/auth?';\n  var SCOPE           =   'email profile';\n  var STATE           =   'profile';\n  var REDIRECT_URI    =   'https://localhost:8080/callback';\n  var RESPONSE_TYPE   =   'token';\n  var CLIENT_ID       =   '554886359117-8icq0dc9halr8rjd6bdtqcmagrdql9lr.apps.googleusercontent.com';\n  var _url            =    OAUTHURL + 'scope=' + SCOPE + '&amp;state=' + STATE + '&amp;redirect_uri=' + REDIRECT_URI + '&amp;response_type=' + RESPONSE_TYPE + '&amp;client_id=' + CLIENT_ID;\n  $.ajax({\n    type: \"POST\",\n    dataType: \"text\",\n    url: _url,\n    success: function(response)\n    {\n        console.log(response.url);\n    },\n    error: function(error)\n    {\n        console.log(\"ERROR: \", error);\n    }\n  });\n});\n</code></pre>\n\n<p>This is supposed to redirect back to the server running on <a href=\"http://localhost/callback\" rel=\"nofollow\">http://localhost/callback</a>.</p>\n\n<pre><code>Redirect URIs:  http://localhost:8080/callback\nJavascript Origins: http://localhost:8080\n</code></pre>\n\n<p>I also have the callback function defined as below:</p>\n\n<pre><code>func init() {\n    r := mux.NewRouter()\n\n    r.HandleFunc(\"/\", rootHandler)\n    r.HandleFunc(\"/callback\", callbackHandler)\n    http.Handle(\"/\", r)\n}\nfunc callbackHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"I am sent back from the server!\"+time.Now().Format(\"Mon, 02 Jan 2006 15:04:05 MST\"))\n}\n</code></pre>\n\n<p>everything looks good in debugging mode, except I get this error back from google's api:</p>\n\n<blockquote>\n  <p>XMLHttpRequest cannot load\n  <a href=\"https://accounts.google.com/o/oauth2/auth?scope=email%20profile&amp;state=profi\" rel=\"nofollow\">https://accounts.google.com/o/oauth2/auth?scope=email%20profile&amp;state=profi</a>\u2026d=554886359117-8icq0dc9halr8rjd6bdtqcmagrdql9lr.apps.googleusercontent.com.\n  No 'Access-Control-Allow-Origin' header is present on the requested\n  resource. Origin '<a href=\"http://localhost:8080\" rel=\"nofollow\">http://localhost:8080</a>' is therefore not allowed\n  access.</p>\n</blockquote>\n\n<p>I have tweaked a little around but I can't seem to find my way through.\nAny thought on this?</p>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1427956752, "post_id": 29406316, "comment_id": 46987476, "body": "The <code>for range</code> loop is not the only way, you could simply convert the <code>string</code> to a <code>[]rune</code>, and then you could apply the same slicing operations on that as you currently do in the <code>string</code> itself - except that it would be correct in any input <code>string</code> assuming it is normalized. Note that converting to <code>[]rune</code> would be slower for the <code>LeftStr()</code> implementation than the <code>for range</code>."}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "edited": false, "score": 3, "creation_date": 1427959126, "post_id": 29406316, "comment_id": 46988607, "body": "You might also want to consider how to handle <a href=\"http://en.wikipedia.org/wiki/Combining_character\" rel=\"nofollow noreferrer\">combining characters</a> - are they part of the num count, or should they be counted together with the character they modify."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1427964219, "post_id": 29406316, "comment_id": 46990975, "body": "It is not just combining characters as ANisus correctly stated: Emoji are coming to unicode and the may carry modifiers which you propably don&#39;t want to cut away. <a href=\"http://www.unicode.org/reports/tr51/tr51-2.html#Proposals\" rel=\"nofollow noreferrer\">unicode.org/reports/tr51/tr51-2.html#Proposals</a>"}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1427971654, "post_id": 29406316, "comment_id": 46995136, "body": "@Volker: Neat. I didn&#39;t know that. No more eurocentric emojis!"}], "answers": [{"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 2, "last_activity_date": 1427990792, "creation_date": 1427990792, "answer_id": 29417487, "question_id": 29406316, "link": "https://stackoverflow.com/questions/29406316/gos-leftstr-rightstr-substr/29417487#29417487", "title": "Go&#39;s LeftStr, RightStr, SubStr", "body": "<p>As mentioned in already in comments,\n<a href=\"http://en.wikipedia.org/wiki/Combining_character\" rel=\"nofollow\">combining characters</a>, modifying runes, and other multi-rune\n<a href=\"https://blog.golang.org/normalization#TOC_5.\" rel=\"nofollow\">\"characters\"</a>\ncan cause difficulties.</p>\n\n<p>Anyone interested in Unicode handling in Go should probably read the Go Blog articles\n<a href=\"https://blog.golang.org/strings\" rel=\"nofollow\">\"Strings, bytes, runes and characters in Go\"</a>\nand <a href=\"https://blog.golang.org/normalization\" rel=\"nofollow\">\"Text normalization in Go\"</a>.\nIn particular, the later talks about the <a href=\"https://godoc.org/golang.org/x/text/unicode/norm/\" rel=\"nofollow\"><code>golang.org/x/text/unicode/norm</code></a> package which can help in handling some of this.</p>\n\n<p>You can consider several levels increasingly of more accurate (or increasingly more Unicode aware) spiting the first (or last) \"n characters\" from a string.</p>\n\n<ol>\n<li><p>Just use n bytes.\nThis may split in the middle of a rune but is O(1), is very simple, and in many cases you know the input consists of only single byte runes.\nE.g.\u00a0<code>str[:n]</code>.</p></li>\n<li><p>Split after n runes.\nThis may split in the middle of a character. This can be done easily, but at the expense of copying and converting with just <code>string([]rune(str)[:n])</code>.\nYou can avoid the conversion and copying by using the <a href=\"https://golang.org/pkg/unicode/utf8/\" rel=\"nofollow\"><code>unicode/utf8</code></a> package's <code>DecodeRuneInString</code> (and <code>DecodeLastRuneInString</code>) functions to get the length of each of the first n runes in turn and then return <code>str[:sum]</code> (O(n), no allocation).</p></li>\n<li><p>Split after the n'th \"boundary\".\nOne way to do this is to use\n<a href=\"https://godoc.org/golang.org/x/text/unicode/norm#Form.FirstBoundaryInString\" rel=\"nofollow\"><code>norm.NFC.FirstBoundaryInString(str)</code></a> repeatedly\nor <a href=\"https://godoc.org/golang.org/x/text/unicode/norm#Iter\" rel=\"nofollow\"><code>norm.Iter</code></a> to find the byte position to split at and then return <code>str[:pos]</code>.</p></li>\n</ol>\n\n<p>Consider the displayed string \"cafe\u0301s\" which could be represented in Go code as: \"cafe\u0301s\", \"caf\\u00E9s\", or \"caf\\xc3\\xa9s\" which all result in the identical six bytes. Alternative it could represented as \"cafe\\u0301s\" or \"cafe\\xcc\\x81s\" which both result in the identical seven bytes.</p>\n\n<p>The first \"method\" above may split those into \"caf\\xc3\"+\"\\xa9s\" and cafe\\xcc\"+\"\\x81s\".</p>\n\n<p>The second may split them into \"caf\\u00E9\"+\"s\" (\"caf\u00e9\"+\"s\") and \"cafe\"+\"\\u0301s\" (\"cafe\"+\"\u0301s\").</p>\n\n<p>The third should split them into \"caf\\u00E9\"+\"s\" and \"cafe\\u0301\"+\"s\" (both shown as \"caf\u00e9\"+\"s\").</p>\n"}], "owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 823, "favorite_count": 0, "accepted_answer_id": 29417487, "answer_count": 1, "score": 0, "last_activity_date": 1506268467, "creation_date": 1427955854, "last_edit_date": 1506268467, "question_id": 29406316, "link": "https://stackoverflow.com/questions/29406316/gos-leftstr-rightstr-substr", "title": "Go&#39;s LeftStr, RightStr, SubStr", "body": "<p>I believe there are no <code>LeftStr(str,n)</code> (take at most n first characters), <code>RightStr(str,n)</code> (take at most n last characters) and <code>SubStr(str,pos,n)</code> (take first n characters after pos) function in Go, so I tried to make one</p>\n\n<pre><code>// take at most n first characters\nfunc Left(str string, num int) string {\n    if num &lt;= 0 {\n        return ``\n    }\n    if num &gt; len(str) {\n        num = len(str)\n    }\n    return str[:num]\n}\n\n// take at most last n characters\nfunc Right(str string, num int) string {\n    if num &lt;= 0 {\n        return ``\n    }\n    max := len(str)\n    if num &gt; max {\n        num = max\n    }\n    num = max - num\n    return str[num:]\n}\n</code></pre>\n\n<p>But I believe those functions will give incorrect output when the string contains unicode characters. What's the fastest solution for those function, is using <code>for range</code> loop is the only way?</p>\n"}, {"tags": ["json", "dictionary", "interface", "go"], "answers": [{"comments": [{"owner": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "edited": false, "score": 1, "creation_date": 1427944425, "post_id": 29404297, "comment_id": 46983799, "body": "You could try delaying the unmarshal of the status with the RawMessage type. Then, Unmarshal it based on the status_type value."}], "tags": [], "owner": {"reputation": 740, "user_id": 4488456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4146daa51bdb93084db63bbf9b5d5c43?s=128&d=identicon&r=PG", "display_name": "jordan2175", "link": "https://stackoverflow.com/users/4488456/jordan2175"}, "is_accepted": true, "score": 7, "last_activity_date": 1483093482, "last_edit_date": 1483093482, "creation_date": 1427943395, "answer_id": 29404297, "question_id": 29403962, "link": "https://stackoverflow.com/questions/29403962/using-interfaces-with-golang-maps-and-structs-and-json/29404297#29404297", "title": "Using Interfaces with Golang Maps and Structs and JSON", "body": "<p>I figured it out, I think..</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype StatusType struct {\n    Id     string            `json:\"message_id,omitempty\"`\n    Status map[string]interface{} `json:\"status,omitempty\"`\n}\n\nfunc main() {\n    var s StatusType\n    s.Id = \"12345\"\n    m := make(map[string]interface{})\n    s.Status = m\n\n    // Now this works\n    // s.Status[\"x-value\"] = \"foo1234\"\n    // s.Status[\"y-value\"] = \"bar4321\"\n\n    // And this works\n    sites := []string{\"a\", \"b\", \"c\", \"d\"}\n    s.Status[\"site-value\"] = sites\n\n    var data []byte\n    data, _ = json.MarshalIndent(s, \"\", \"    \")\n\n    fmt.Println(string(data))\n}\n</code></pre>\n"}], "owner": {"reputation": 740, "user_id": 4488456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4146daa51bdb93084db63bbf9b5d5c43?s=128&d=identicon&r=PG", "display_name": "jordan2175", "link": "https://stackoverflow.com/users/4488456/jordan2175"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19287, "favorite_count": 2, "accepted_answer_id": 29404297, "answer_count": 1, "score": 4, "last_activity_date": 1483093482, "creation_date": 1427941094, "question_id": 29403962, "link": "https://stackoverflow.com/questions/29403962/using-interfaces-with-golang-maps-and-structs-and-json", "title": "Using Interfaces with Golang Maps and Structs and JSON", "body": "<p>I have some JSON code that can look like:</p>\n\n<pre><code>{\n    \"message_id\": \"12345\",\n    \"status_type\": \"ERROR\",\n    \"status\": {\n        \"x-value\": \"foo1234\",\n        \"y-value\": \"bar4321\"\n    }\n}\n</code></pre>\n\n<p>or can look like this. As you can see the \"status\" element changes from a standard object of strings to an object of array of strings, based on the status_type.  </p>\n\n<pre><code>{\n    \"message_id\": \"12345\",\n    \"status_type\": \"VALID\",\n    \"status\": {\n        \"site-value\": [\n            \"site1\",\n            \"site2\"\n        ]\n    }\n}\n</code></pre>\n\n<p>I am thinking that I need to have my struct for \"Status\" take a map like \"map[string]interface{}\", but I am not sure exactly how to do that.</p>\n\n<p>You can see the code here on the playground as well.<br>\n<a href=\"http://play.golang.org/p/wKowJu_lng\" rel=\"nofollow\">http://play.golang.org/p/wKowJu_lng</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype StatusType struct {\n    Id     string            `json:\"message_id,omitempty\"`\n    Status map[string]string `json:\"status,omitempty\"`\n}\n\nfunc main() {\n    var s StatusType\n    s.Id = \"12345\"\n    m := make(map[string]string)\n    s.Status = m\n    s.Status[\"x-value\"] = \"foo1234\"\n    s.Status[\"y-value\"] = \"bar4321\"\n\n    var data []byte\n    data, _ = json.MarshalIndent(s, \"\", \"    \")\n\n    fmt.Println(string(data))\n}\n</code></pre>\n"}]