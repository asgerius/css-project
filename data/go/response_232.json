[{"tags": ["regex", "go", "dfa", "ragel"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "edited": false, "score": 0, "creation_date": 1560991281, "post_id": 56676997, "comment_id": 99921912, "body": "Is the <i>intersection</i> a tall task for software ?"}, {"owner": {"reputation": 73, "user_id": 9317892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddce758a1df035473f072054fb6c0ea1?s=128&d=identicon&r=PG&f=1", "display_name": "aygestan", "link": "https://stackoverflow.com/users/9317892/aygestan"}, "edited": false, "score": 0, "creation_date": 1561047051, "post_id": 56676997, "comment_id": 99945445, "body": "@sln not sure what you mean. As far as I can tell, some languages support character class intersection natively, however, apparently Golang is not one of them and that is not quite what I need. I have discovered that it should be theoretically possible to compute the intersection of two simple regular expressions efficiently (by intersection I mean a regular expression that describes the intersection of the sets of strings that match the two regular expressions), but I was unable to find a library suitable to my needs."}], "answers": [{"tags": [], "owner": {"reputation": 66, "user_id": 9464659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cc9c2936d907e7988773df07ba7fac6?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian D. Thurston", "link": "https://stackoverflow.com/users/9464659/adrian-d-thurston"}, "is_accepted": false, "score": 1, "last_activity_date": 1567437980, "creation_date": 1567437980, "answer_id": 57759488, "question_id": 56676997, "link": "https://stackoverflow.com/questions/56676997/intersection-of-two-regular-expressions-in-golang-using-ragel/57759488#57759488", "title": "Intersection of two regular expressions in Golang using Ragel", "body": "<p>Ragel has an intersection operator (&amp;). You can produce the intersection of any two regular expressions, so long as they are expressed in the ragel syntax. There is no freely available automatic ragel-to-regex translation. This is the kind of thing I've been producing for clients privately. Anyhow, see the manual for more information on intersection.</p>\n"}], "owner": {"reputation": 73, "user_id": 9317892, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddce758a1df035473f072054fb6c0ea1?s=128&d=identicon&r=PG&f=1", "display_name": "aygestan", "link": "https://stackoverflow.com/users/9317892/aygestan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567437980, "creation_date": 1560985657, "question_id": 56676997, "link": "https://stackoverflow.com/questions/56676997/intersection-of-two-regular-expressions-in-golang-using-ragel", "title": "Intersection of two regular expressions in Golang using Ragel", "body": "<p>The template of the function is as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func GetIntersection(firstRegex string, secondRegex string) string {\n    ...\n}\n</code></pre>\n\n<p>I'm trying to use Ragel to get the intersection of two regular expressions. Not sure if Ragel is the right tool to use, though. My last resort is implementing conversions from regex to DFA and DFA to regex, as well as intersection of two DFA's myself, but I would rather avoid that. Would highly appreciate any reliable libraries to solve the problem.</p>\n"}, {"tags": ["go", "memory-leaks", "unmarshalling"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1560985517, "post_id": 56676434, "comment_id": 99920815, "body": "That profile shows where some allocations are made, but doesn\u2019t provide any information about a leak"}, {"owner": {"reputation": 98775, "user_id": 421195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9a9793fdeb3b94e185c8c99c0238372f?s=128&d=identicon&r=PG", "display_name": "paulsm4", "link": "https://stackoverflow.com/users/421195/paulsm4"}, "edited": false, "score": 3, "creation_date": 1560986570, "post_id": 56676434, "comment_id": 99921023, "body": "1) Verify you actually have a problem, 2) Write an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}, {"owner": {"reputation": 19, "user_id": 11672864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c3ab764b3d37dddf3eefdc1dc8649cf?s=128&d=identicon&r=PG&f=1", "display_name": "Abdul-Bari Khan", "link": "https://stackoverflow.com/users/11672864/abdul-bari-khan"}, "edited": false, "score": 0, "creation_date": 1561024969, "post_id": 56676434, "comment_id": 99932728, "body": "Over time, these keep increasing."}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 11672864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c3ab764b3d37dddf3eefdc1dc8649cf?s=128&d=identicon&r=PG&f=1", "display_name": "Abdul-Bari Khan", "link": "https://stackoverflow.com/users/11672864/abdul-bari-khan"}, "edited": false, "score": 0, "creation_date": 1560982393, "post_id": 56676474, "comment_id": 99920143, "body": "This is part of a library code that is extensively reused by other programs and leak is not an issue in but one use of this lib. I have tried do things differently but it would be good to know what you think would cause prevention of garbage collection? Have even tried a drop in replacement of encoding/json but still see the issue."}, {"owner": {"reputation": 98775, "user_id": 421195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9a9793fdeb3b94e185c8c99c0238372f?s=128&d=identicon&r=PG", "display_name": "paulsm4", "link": "https://stackoverflow.com/users/421195/paulsm4"}, "reply_to_user": {"reputation": 19, "user_id": 11672864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c3ab764b3d37dddf3eefdc1dc8649cf?s=128&d=identicon&r=PG&f=1", "display_name": "Abdul-Bari Khan", "link": "https://stackoverflow.com/users/11672864/abdul-bari-khan"}, "edited": false, "score": 5, "creation_date": 1560986416, "post_id": 56676474, "comment_id": 99920998, "body": "Dude - you showed us some suspicious code ... I suggested why it might be suspicious ... and your only response appears to be &quot;it&#39;s gotta be the GoLang library!&quot;  Frankly, &quot;json.Unmarshal&quot; is the <i>LAST</i> thing I&#39;d consider.  First: 1) Verify that you indeed HAVE a leak (maybe you&#39;re misinterpreting the stats), 2) Look at your usage (as I tried to suggest), 3) Write a standalone <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> to try to reproduce the problem <i>INDEPENDENTLY</i>.  If you really have a problem, then 1) <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> is your best bet, 2) worrying about json.Unmarshal is your last fallback."}, {"owner": {"reputation": 19, "user_id": 11672864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c3ab764b3d37dddf3eefdc1dc8649cf?s=128&d=identicon&r=PG&f=1", "display_name": "Abdul-Bari Khan", "link": "https://stackoverflow.com/users/11672864/abdul-bari-khan"}, "edited": false, "score": 0, "creation_date": 1561024564, "post_id": 56676474, "comment_id": 99932498, "body": "I don&#39;t think I said that the leak is in library. Replacing std library did not fix the issue either."}, {"owner": {"reputation": 98775, "user_id": 421195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9a9793fdeb3b94e185c8c99c0238372f?s=128&d=identicon&r=PG", "display_name": "paulsm4", "link": "https://stackoverflow.com/users/421195/paulsm4"}, "reply_to_user": {"reputation": 19, "user_id": 11672864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c3ab764b3d37dddf3eefdc1dc8649cf?s=128&d=identicon&r=PG&f=1", "display_name": "Abdul-Bari Khan", "link": "https://stackoverflow.com/users/11672864/abdul-bari-khan"}, "edited": false, "score": 1, "creation_date": 1561132612, "post_id": 56676474, "comment_id": 99976964, "body": "Sounds like it&#39;s time for you to write an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">MCVE</a> :)"}], "tags": [], "owner": {"reputation": 98775, "user_id": 421195, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9a9793fdeb3b94e185c8c99c0238372f?s=128&d=identicon&r=PG", "display_name": "paulsm4", "link": "https://stackoverflow.com/users/421195/paulsm4"}, "is_accepted": false, "score": 0, "last_activity_date": 1560981817, "creation_date": 1560981817, "answer_id": 56676474, "question_id": 56676434, "link": "https://stackoverflow.com/questions/56676434/my-golang-program-profiling-using-pprof-shows-memory-increasing-at-json-decod/56676474#56676474", "title": "My golang program profiling using pprof shows memory increasing at json (* decodeState) objectInterface in std/json package", "body": "<p>Q: Why don't you do something like this:</p>\n\n<p><a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/</a></p>\n\n<pre><code>func (a *Animal) UnmarshalJSON(b []byte) error {\n    var s string\n    if err := json.Unmarshal(b, &amp;s); err != nil {\n        return err\n    }\n    switch strings.ToLower(s) {\n    default:\n        *a = Unknown\n    case \"gopher\":\n        *a = Gopher\n    case \"zebra\":\n        *a = Zebra\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>In other words, is your implementation preventing objects (like \"err\", for example) from being garbage collected?</p>\n"}], "owner": {"reputation": 19, "user_id": 11672864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c3ab764b3d37dddf3eefdc1dc8649cf?s=128&d=identicon&r=PG&f=1", "display_name": "Abdul-Bari Khan", "link": "https://stackoverflow.com/users/11672864/abdul-bari-khan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1871, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1563208877, "creation_date": 1560981518, "last_edit_date": 1563208877, "question_id": 56676434, "link": "https://stackoverflow.com/questions/56676434/my-golang-program-profiling-using-pprof-shows-memory-increasing-at-json-decod", "title": "My golang program profiling using pprof shows memory increasing at json (* decodeState) objectInterface in std/json package", "body": "<p>I have a golang program that uses unmarshall from std \"encoding/json\" package keeps increasing in size (memory leak). A diagram of memory profile using pprof shows memory increasing at json (* decodeState) objectInterface. I want to understand how and why it could be happening to fix the issue.</p>\n\n<p>I have tried several things at upper level like release of returned value to avoid the leak, but with no success.</p>\n\n<pre><code>func (j JSONEncoding) From(b []byte, msg interface{}) (interface{}, error) {\n    err := json.Unmarshal(b, &amp;msg)\n    return msg, err\n}\n</code></pre>\n\n<p>pprof top5 shows this call, and the details below;</p>\n\n<pre><code>4096.89kB 24.43% 24.43%  4096.89kB 24.43%  encoding/json.(*decodeState).objectInterface\n\n(pprof) list objectInterface\nTotal: 20.65MB\nROUTINE ======================== encoding/json.(*decodeState).objectInterface in /usr/local/go/src/encoding/json/decode.go\n       6MB     7.50MB (flat, cum) 36.32% of Total\n         .          .   1061:   return v\n         .          .   1062:}\n         .          .   1063:\n         .          .   1064:// objectInterface is like object but returns map[string]interface{}.\n         .          .   1065:func (d *decodeState) objectInterface() map[string]interface{} {\n       3MB        3MB   1066:   m := make(map[string]interface{})\n         .          .   1067:   for {\n         .          .   1068:       // Read opening \" of string key or closing }.\n.\n. deleted code\n.\n         .          .   1095:\n         .          .   1096:       // Read value.\n       3MB     4.50MB   1097:       m[key] = d.valueInterface()\n</code></pre>\n\n<p>using topN, and using visualization I can see this box increasing with time/processing.</p>\n\n<p>This unmarshall is called in a loop but nothing is saved that could be a reason for the leak. I am not sure how and what of something to be done so that this leak is avoided.</p>\n\n<p><strong>Update</strong>: \nThe memory leak was more of a memory accrual, in the code at some other place. While trying to write a minimum code that shows the problem, I was not able to reproduce, and had to dig all the code to find out that an internal library was using a map to cache and the cache cleaner was not working properly.</p>\n\n<p>My problem was that pprof is giving info on who is allocating, but not where it is being kept. I think my question should have been, how can we find out which objects have references of what size. I know that one allocated reference could be in multiple places but such information would easily help in finding this kind of issue.</p>\n"}, {"tags": ["database", "postgresql", "go", "orm", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 2615, "user_id": 2480468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VNCmN.jpg?s=128&g=1", "display_name": "Tim Brown", "link": "https://stackoverflow.com/users/2480468/tim-brown"}, "is_accepted": true, "score": 2, "last_activity_date": 1560982864, "creation_date": 1560982864, "answer_id": 56676630, "question_id": 56675994, "link": "https://stackoverflow.com/questions/56675994/using-orm-models-instead-of-proper-database-modeling/56676630#56676630", "title": "Using ORM models instead of proper database modeling", "body": "<p>The only downsides I'm aware of from doing the same thing at my company are:</p>\n\n<ol>\n<li>Interoperability - you need to use golang to get everything up and running, so if you have projects that would like to use another language on a new database it gets a bit weird.</li>\n<li>Complex SQL stuff - occasionally you'll want to use a complex feature that might be awkward to write tags for (ex: compound indexes require tags on all the fields to use the same index name, but that's weird to mentally parse and you don't get to decide the order)</li>\n<li>Migration - if you use the built in <code>AutoMigrate</code> you can get tables, columns, and indices created, but you can't add in default data or write a data transition, nor will it drop columns, nor does it keep a history of changes.  If all the developers use the same dev database this isn't too much of an issue, but if you start having separate dbs you'll probably start keeping migration sql files around too, which you'll have to manage separately from Gorm.</li>\n</ol>\n\n<p>I don't regret using it initially as it was much easier to declare the model and the sql in one place to start, but as we grew and started to use more advanced sql features and more databases, we had to switch to doing actually schema definitions and migrations.</p>\n"}], "owner": {"reputation": 537, "user_id": 5012775, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Lhg2b.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5012775/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 56676630, "answer_count": 1, "score": 1, "last_activity_date": 1563995860, "creation_date": 1560979129, "last_edit_date": 1563995860, "question_id": 56675994, "link": "https://stackoverflow.com/questions/56675994/using-orm-models-instead-of-proper-database-modeling", "title": "Using ORM models instead of proper database modeling", "body": "<p>I've recently inherited a project where the database was modeled interestingly (i.e. lack of some index and foreign key definitions). The project uses GORM and from what I can tell, those Models have tags which define everything correctly.</p>\n\n<p>I can't think of a reason why using the ORM for database \"modeling\" wouldn't work. The closest I can come is performance, but at the scale this would need to run, the point seems moot. Are there any downsides to this running things this way?</p>\n"}, {"tags": ["go", "go-gorm", "revel"], "answers": [{"tags": [], "owner": {"reputation": 2615, "user_id": 2480468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VNCmN.jpg?s=128&g=1", "display_name": "Tim Brown", "link": "https://stackoverflow.com/users/2480468/tim-brown"}, "is_accepted": false, "score": 1, "last_activity_date": 1560983026, "creation_date": 1560983026, "answer_id": 56676651, "question_id": 56675690, "link": "https://stackoverflow.com/questions/56675690/go-migration-doesnt-create-a-foreign-key/56676651#56676651", "title": "Go migration doesn&#39;t create a foreign key", "body": "<p>You need a <code>RoleID</code> column, and if you name it that you wouldn't need to declare the <code>foreignkey</code> either.</p>\n\n<pre><code>type User struct {\n    gorm.Model\n    Name   string\n    RoleID int `gorm:\"column:RoleIdForRole\"`\n    Role   Role\n}\n</code></pre>\n\n<p>See <a href=\"http://gorm.io/docs/belongs_to.html\" rel=\"nofollow noreferrer\">this page</a> for more info</p>\n"}, {"tags": [], "owner": {"reputation": 1605, "user_id": 577647, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/df2b2eb575dec34507a6600f292b26f4?s=128&d=identicon&r=PG", "display_name": "tolga", "link": "https://stackoverflow.com/users/577647/tolga"}, "is_accepted": true, "score": 1, "last_activity_date": 1561063286, "last_edit_date": 1561063286, "creation_date": 1561062567, "answer_id": 56693471, "question_id": 56675690, "link": "https://stackoverflow.com/questions/56675690/go-migration-doesnt-create-a-foreign-key/56693471#56693471", "title": "Go migration doesn&#39;t create a foreign key", "body": "<p>I found a solution.</p>\n\n<p>First of all, although Tim Brown's answer is a valid answer compatible with documentation, it doesn't work. As mentioned in many forum posts and github issues, GORM foreign key is not autogenerated as told in the documentation.</p>\n\n<p>But this helps:</p>\n\n<pre><code>db.Model(&amp;models.User{}).AddForeignKey(\"role_id\", \"roles(id)\", \"RESTRICT\", \"RESTRICT\")\n</code></pre>\n\n<p>Shortly you need to set foreign keys just after migrating the tables.</p>\n"}], "owner": {"reputation": 1605, "user_id": 577647, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/df2b2eb575dec34507a6600f292b26f4?s=128&d=identicon&r=PG", "display_name": "tolga", "link": "https://stackoverflow.com/users/577647/tolga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 507, "favorite_count": 0, "accepted_answer_id": 56693471, "answer_count": 2, "score": 1, "last_activity_date": 1561063286, "creation_date": 1560977607, "question_id": 56675690, "link": "https://stackoverflow.com/questions/56675690/go-migration-doesnt-create-a-foreign-key", "title": "Go migration doesn&#39;t create a foreign key", "body": "<p>My first day with Go. I try to develop a migration mechanism with GORM within Revel. </p>\n\n<p>These are my model structs:</p>\n\n<pre><code>type Role struct {\n    gorm.Model\n    Name string\n}\n\ntype User struct {\n    gorm.Model\n    Name string\n    Role Role  `gorm:\"foreignkey:RoleIdForRole;association_foreignkey:Id\"`\n}\n</code></pre>\n\n<p>I simply automigrate both structs as follows, which work fine. I see tables called users and roles but users table doesn't have a field <strong>role_id</strong> or <strong>roleID</strong></p>\n\n<pre><code>db.AutoMigrate(&amp;models.Role{})\ndb.AutoMigrate(&amp;models.User{})\n</code></pre>\n\n<p>What am I missing?</p>\n"}, {"tags": ["go", "react-router"], "comments": [{"owner": {"reputation": 529, "user_id": 8915234, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210933076376525/picture?type=large", "display_name": "Cyro Dubeux", "link": "https://stackoverflow.com/users/8915234/cyro-dubeux"}, "edited": false, "score": 1, "creation_date": 1560972810, "post_id": 56674626, "comment_id": 99916688, "body": "Check this article: <a href=\"https://medium.com/@kimrgrey/integration-of-create-react-app-into-golang-server-47074b8dcd7d\" rel=\"nofollow noreferrer\">medium.com/@kimrgrey/&hellip;</a>"}, {"owner": {"reputation": 35, "user_id": 11672184, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7i_3JKxAecI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdwUbV2XXaNhKUh6665UBq5wi10Dg/mo/photo.jpg?sz=128", "display_name": "Fernando Jimenez", "link": "https://stackoverflow.com/users/11672184/fernando-jimenez"}, "reply_to_user": {"reputation": 529, "user_id": 8915234, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210933076376525/picture?type=large", "display_name": "Cyro Dubeux", "link": "https://stackoverflow.com/users/8915234/cyro-dubeux"}, "edited": false, "score": 0, "creation_date": 1560985059, "post_id": 56674626, "comment_id": 99920724, "body": "I ckecked it, thank you Cyro"}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 11672184, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7i_3JKxAecI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdwUbV2XXaNhKUh6665UBq5wi10Dg/mo/photo.jpg?sz=128", "display_name": "Fernando Jimenez", "link": "https://stackoverflow.com/users/11672184/fernando-jimenez"}, "edited": false, "score": 1, "creation_date": 1560984755, "post_id": 56676726, "comment_id": 99920652, "body": "I just realized that what i asked has not too much sense, your options really help me, thank you"}], "tags": [], "owner": {"reputation": 2615, "user_id": 2480468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VNCmN.jpg?s=128&g=1", "display_name": "Tim Brown", "link": "https://stackoverflow.com/users/2480468/tim-brown"}, "is_accepted": true, "score": 2, "last_activity_date": 1560983627, "creation_date": 1560983627, "answer_id": 56676726, "question_id": 56674626, "link": "https://stackoverflow.com/questions/56674626/how-to-serve-properly-a-react-router-with-go/56676726#56676726", "title": "How to serve (properly) a react-router with go?", "body": "<p>My guess is that you have some static content and you'd like everything else to forward to the <code>index.html</code>.  I had a similar problem, and my solution was to just prefix all the react-router urls with a constant so I could detect that on the backend and forward it.  My code looks something like this:</p>\n\n<pre><code>router := mux.NewRouter()\nrouter.PathPrefix(\"/public/\").Handler(http.StripPrefix(\"/public/\", http.FileServer(http.Dir(\"public\"))))\nrouter.HandleFunc(\"/\", handleIndex).Methods(\"GET\")\nrouter.HandleFunc(\"/h/{param:.*}\", handleIndex).Methods(\"GET\")\n</code></pre>\n\n<p>And in my react-router I just changed all the routes from <code>{uri}</code> to <code>/h/{uri}</code></p>\n\n<p>If you really want to forward everything to the react code without any backend checking for 404s or anything, you could do:</p>\n\n<pre><code>router := mux.NewRouter()\nrouter.NotFoundHandler = ... // Write a function to serve the index file here\nfs := http.FileServer(http.Dir(dir))\nrouter.PathPrefix(\"/\").Handler(fs)\n\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 11672184, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7i_3JKxAecI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdwUbV2XXaNhKUh6665UBq5wi10Dg/mo/photo.jpg?sz=128", "display_name": "Fernando Jimenez", "link": "https://stackoverflow.com/users/11672184/fernando-jimenez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 1, "accepted_answer_id": 56676726, "answer_count": 1, "score": 1, "last_activity_date": 1560983627, "creation_date": 1560972510, "question_id": 56674626, "link": "https://stackoverflow.com/questions/56674626/how-to-serve-properly-a-react-router-with-go", "title": "How to serve (properly) a react-router with go?", "body": "<p>Im trying to serve a react-router with go, i already did it, but i'm having troubles, i think the way i did is not the correct one, or it's not complete. Im using Mux. The trouble im having is that when i push the <code>&lt;Link&gt;</code>'s in my app it changes de view correctly, but when i try to change it directly from the browser or i try to reload the page i get a 404 error</p>\n\n<p>I've tried diferent ways, im actually doing this way:</p>\n\n<pre><code>func main() {\n\n    var dir = \"./static\"\n\n    router := mux.NewRouter()\n\n    fs := http.FileServer(http.Dir(dir))\n    router.PathPrefix(\"/\").Handler(fs)\n\n\n    fmt.Println(\"Server running in port :8000\")\n\n    log.Fatal(http.ListenAndServe(\":8000\", router))\n\n}\n</code></pre>\n\n<p>I want the server to serve the same directory in all request like \"/\", \"/example\", \"/example2\", etc.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1560972303, "post_id": 56674417, "comment_id": 99916508, "body": "There is a smart way, and you are always wise to seek a smart way :)"}], "tags": [], "owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "is_accepted": false, "score": -3, "last_activity_date": 1560971575, "creation_date": 1560971575, "answer_id": 56674417, "question_id": 56673851, "link": "https://stackoverflow.com/questions/56673851/is-it-possible-to-exclude-a-field-that-is-already-json-when-running-json-encode/56674417#56674417", "title": "Is it possible to exclude a field that is already JSON when running JSON Encode?", "body": "<p>Since there isnt any smart way of doing it ( and maybe also overkill to try to seek a smart way ) i just changed it to :</p>\n\n<pre><code>fmt.Fprintf(w, \"{\\\"Id\\\":\\\"%s\\\",\\\"Status\\\":\\\"%s\\\",\\\"Message\\\":%s}\", reply.Id, reply.Status, reply.Message)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 0, "creation_date": 1560971991, "post_id": 56674478, "comment_id": 99916367, "body": "that looks abit prettier than with fprint !"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 1, "creation_date": 1560972255, "post_id": 56674478, "comment_id": 99916492, "body": "Yes. It&#39;s almost never necessary to resort to manual JSON handling. :)"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 5, "last_activity_date": 1560972081, "last_edit_date": 1560972081, "creation_date": 1560971867, "answer_id": 56674478, "question_id": 56673851, "link": "https://stackoverflow.com/questions/56673851/is-it-possible-to-exclude-a-field-that-is-already-json-when-running-json-encode/56674478#56674478", "title": "Is it possible to exclude a field that is already JSON when running JSON Encode?", "body": "<p>If <code>Message</code> is a complete, valid, JSON object, you can accomplish what you want by converting it to type <code>json.RawMessage</code>:</p>\n\n<pre><code>type ReplyWithJSON struct {\n    Id      int\n    Status  string\n    Message json.RawMessage\n}\n\nu := ReplyWithJSON{Id: id, Status: \"progress\", Message: json.RawMessage(RetMessage)}\njson.NewEncoder(w).Encode(u)\n</code></pre>\n\n<p>This should generate the following output:</p>\n\n<blockquote>\n  <p>{\"Id\":123,\"Status\":\"progress\",\"Message\":{\"debug\":\"on\",\"window\":{\"width\":500,\"height\":500}}}</p>\n</blockquote>\n\n<p>See it in action <a href=\"https://play.golang.org/p/U-YOudzHhMC\" rel=\"nofollow noreferrer\">on the playground</a>.</p>\n"}], "owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 56674478, "answer_count": 2, "score": 1, "last_activity_date": 1560972081, "creation_date": 1560969116, "last_edit_date": 1560971707, "question_id": 56673851, "link": "https://stackoverflow.com/questions/56673851/is-it-possible-to-exclude-a-field-that-is-already-json-when-running-json-encode", "title": "Is it possible to exclude a field that is already JSON when running JSON Encode?", "body": "<p>I am constructing a reply on a restAPI and using json.NewEncoder.Encode() to generate the JSON reply ( note : w is responsewriter).</p>\n\n<pre><code>u := Reply{Id: id, Status: \"progress\", Message: \"\"}\njson.NewEncoder(w).Encode(u)\n</code></pre>\n\n<p>This works fine.</p>\n\n<p>But I then have the other situation where Message will be populated with a string that is already in JSON format:</p>\n\n<pre><code>RetMessage := \"{\"debug\": \"on\", \"window\": { \"width\": 500, \"height\": 500}}\"\nu := Reply{Id: id, Status: \"progress\", Message: RetMessage}\njson.NewEncoder(w).Encode(u)\n</code></pre>\n\n<p>Then the reply will be the JSON with escaped quotations etc, which makes sense of course as it parses it as strings to JSON, but it of course breaks the concept as I would like the RetMessage to be passed on as it is, where the others I would like to be encoded to JSON.</p>\n\n<p>Is there any way I can get around this in a smart way? The content in RetMessage is coming from a file so I can't change that the RetMessage sometimes do come as JSON encoded already.</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1560966159, "post_id": 56673166, "comment_id": 99913702, "body": "The linked answer says to <i>not</i> use a <code>*interface{}</code>. The only time a pointer to an interface is required is if you want to pass in an empty interface to <code>Unmarshal</code> itself. also, why do you also have <code>*io.ReadCloser</code> as an argument? There is almost never a reason to pass around pointers to interfaces (the above exception is one of the few if you want to assign to an interface via reflection)"}, {"owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1560966410, "post_id": 56673166, "comment_id": 99913816, "body": "@j I also tried it without pointers, but the same problem persisted. The same interface conversion problem, even though json.unmarshal now gets the correct type as input. NotPointerCode: <a href=\"https://play.golang.org/p/edn5opF50SQ\" rel=\"nofollow noreferrer\">play.golang.org/p/edn5opF50SQ</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1560966513, "post_id": 56673166, "comment_id": 99913874, "body": "Tried what? if you remove all the interface pointer nonsense, it works as expected: <a href=\"https://play.golang.org/p/GfJFvhVad3w\" rel=\"nofollow noreferrer\">play.golang.org/p/GfJFvhVad3w</a>. How does that differ from what you&#39;re trying to achieve?"}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1561008065, "post_id": 56676821, "comment_id": 99924957, "body": "The empty interface most certainly is a type: <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Interface_types</a>."}], "tags": [], "owner": {"reputation": 2615, "user_id": 2480468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VNCmN.jpg?s=128&g=1", "display_name": "Tim Brown", "link": "https://stackoverflow.com/users/2480468/tim-brown"}, "is_accepted": true, "score": 1, "last_activity_date": 1560984257, "creation_date": 1560984257, "answer_id": 56676821, "question_id": 56673166, "link": "https://stackoverflow.com/questions/56673166/json-unmarshal-interface-pointer-with-later-type-assertion/56676821#56676821", "title": "json.Unmarshal interface pointer with later type assertion", "body": "<p>An empty interface isn't an actual type, it's basically something that matches anything.  As stated in the comments, a pointer to an empty interface doesn't really make sense as a pointer already matches an empty interface since everything matches an empty interface.  To make your code work, you should remove the interface wrapper around your struct, since that's just messing up the json type checking, and the whole point of an empty interface is that you can pass <em>anything</em> to it.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n)\n\ntype myStruct struct {\n    A string `json:\"a\"`\n    B string `json:\"b\"`\n}\n\nfunc main() {\n    jsonBlob := []byte(`{\"a\":\"test\",\"b\":\"test2\"}`)\n\n    var foo = &amp;myStruct{} // This need to be a pointer so its attributes can be assigned\n    closer := ioutil.NopCloser(bytes.NewReader(jsonBlob))\n\n    err := unmarshalCloser(closer, foo)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(fmt.Sprintf(\"%v\", foo))\n\n    // That\u00b4s what i want:\n    fmt.Println(foo.A)\n}\n\n// You don't need to declare either of these arguments as pointers since they're both interfaces\nfunc unmarshalCloser(closer io.ReadCloser, v interface{}) error {\n    defer closer.Close()\n    // v NEEDS to be a pointer or the json stuff will barf\n\n    // Simplified with the decoder\n    return json.NewDecoder(closer).Decode(v)\n}\n</code></pre>\n"}], "owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "accepted_answer_id": 56676821, "answer_count": 1, "score": -2, "last_activity_date": 1560984257, "creation_date": 1560965860, "last_edit_date": 1560966351, "question_id": 56673166, "link": "https://stackoverflow.com/questions/56673166/json-unmarshal-interface-pointer-with-later-type-assertion", "title": "json.Unmarshal interface pointer with later type assertion", "body": "<p>Because I often unmarshal <code>http.Response.Body</code>, I thought I could write a function which handles all the hassle of reading, closing and unmarshaling into various different structs. That's why I introduced a function <code>func unmarhalInterface(closer *io.ReadCloser, v *interface{}) error</code> and can then assert the return value with <code>t:=i.(T)</code>.</p>\n\n<p>According to <a href=\"https://stackoverflow.com/a/44779409/9429150\">this answer</a> I already wrapped it into a value of type <code>*interface{}</code>, but because the overlying type is <code>interface{}</code>and not <code>myStruct</code>, the <code>json</code> package implementation chooses <code>map[string]interface{}</code>. After that a type assertion fails (of course). Is there anything i am missing or requires this implementation a type assertion \"by hand\", that means look for all fields in the map and assign those that I want into my struct.</p>\n\n<p>Code below has minimal example with notation in comments. If my explanation is not sufficient, please ask away.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n)\n\ntype myStruct struct {\n    A string `json:\"a\"`\n    B string `json:\"b\"`\n}\n\nfunc main() {\n    jsonBlob := []byte(`{\"a\":\"test\",\"b\":\"test2\"}`)\n\n    var foo = interface{}(myStruct{})\n    closer := ioutil.NopCloser(bytes.NewReader(jsonBlob))\n\n    err := unmarshalCloser(&amp;closer, &amp;foo)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(fmt.Sprintf(\"%v\", foo))\n\n    // That\u00b4s what i want:\n    foo2 := foo.(myStruct)\n    fmt.Println(foo2.A)\n}\n\nfunc unmarshalCloser(closer *io.ReadCloser, v *interface{}) error {\n    defer func() { _ = (*closer).Close() }()\n\n    data, err := ioutil.ReadAll(*closer)\n    if err != nil {\n        return err\n    }\n\n    err = json.Unmarshal(data, v)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/kQto_ljqlPw\" rel=\"nofollow noreferrer\">Golang Playground</a></p>\n"}, {"tags": ["go", "code-design"], "answers": [{"comments": [{"owner": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "edited": false, "score": 0, "creation_date": 1560967430, "post_id": 56673387, "comment_id": 99914303, "body": "I understand my approach is not correct, but it is clean, I am looking for correct+clean approach. I am not sure why I receive down-vote as I am asking for correct way of something. How can I do it cleaner instead of db.Func1(), db.Func2(), etc while each one of them return different structs ... how can I achieve something like db.Obj1.Func1(), db.Obj2.Func2() ? (each one of  Func1 and Func2 return different structs of database)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "edited": false, "score": 0, "creation_date": 1560968413, "post_id": 56673387, "comment_id": 99914715, "body": "You can use a different DBAL object for each type of object you want to work with."}, {"owner": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "edited": false, "score": 0, "creation_date": 1560969936, "post_id": 56673387, "comment_id": 99915450, "body": "ok, so, then FooStore or BarStore should be passed as receiver to their functions? correct?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "edited": false, "score": 0, "creation_date": 1560974080, "post_id": 56673387, "comment_id": 99917231, "body": "FooStore and BarStore would be structs with methods for interacting with the database. You don&#39;t &quot;pass&quot; anything as the receiver explicitly when calling a method in Go."}, {"owner": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "edited": false, "score": 0, "creation_date": 1560977182, "post_id": 56673387, "comment_id": 99918449, "body": "I think I am missing something!. If no receiver, how can I have FooStore.Func1() ? Aren&#39;t you referring to something like this? <a href=\"https://golangtutorials.blogspot.com/2011/06/methods-on-structs.html\" rel=\"nofollow noreferrer\">golangtutorials.blogspot.com/2011/06/methods-on-structs.html</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "edited": false, "score": 1, "creation_date": 1560985372, "post_id": 56673387, "comment_id": 99920781, "body": "Methods have receivers, you don&#39;t &quot;pass&quot; them. You might find this article helpful: <a href=\"https://www.alexedwards.net/blog/organising-database-access\" rel=\"nofollow noreferrer\">alexedwards.net/blog/organising-database-access</a> the section &quot;Using an Interface&quot; is basically what I&#39;m suggesting here: a class or classes responsible for interacting with the database."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1560968521, "last_edit_date": 1560968521, "creation_date": 1560966888, "answer_id": 56673387, "question_id": 56673062, "link": "https://stackoverflow.com/questions/56673062/golang-database-layer-organizing-inside-a-package/56673387#56673387", "title": "Golang database layer organizing inside a package", "body": "<p>If you think about how this is used, this is an odd way to organize your code. Methods are <em>behaviors</em> of their receiver type. Is <code>MyObject</code>'s job to retrieve other <code>MyObject</code>s from the database? That doesn't sound right. That should be the job of something that connects to the database. That could be package functions, or it could be an object that wraps the database connection or database session; each could be a valid approach depending on your application, database, and testing needs (package functions are much harder to test with because they can't be mocked).</p>\n\n<p>For example, if your model types are Foo and Bar, your database package might have types FooStore and BarStore, with each having methods to get one by ID, get all, insert one, update one, and so on (whatever the needs are for each type).</p>\n\n<p>It's often important to keep the database code separated from the data model, so that packages that work with the model don't have to also import the DBAL, which helps with separation of concerns.</p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1560974031, "post_id": 56673543, "comment_id": 99917208, "body": "Typically the DBAL is considered part of the Model in the MVC pattern, but it still needs to be separated from the model objects themselves. Database code in request handlers is one of the problems that MVC seeks to solve. It says as much in the page you linked to."}], "tags": [], "owner": {"reputation": 393, "user_id": 5223002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tmBSX.jpg?s=128&g=1", "display_name": "Eduardo Hitek", "link": "https://stackoverflow.com/users/5223002/eduardo-hitek"}, "is_accepted": false, "score": 0, "last_activity_date": 1560967729, "creation_date": 1560967729, "answer_id": 56673543, "question_id": 56673062, "link": "https://stackoverflow.com/questions/56673062/golang-database-layer-organizing-inside-a-package/56673543#56673543", "title": "Golang database layer organizing inside a package", "body": "<p>Great question.\nUsually, regardless of which language used in the Project, I try to apply the MVC pattern, in which this database's method should be separated from the Models.</p>\n\n<p><a href=\"https://i.stack.imgur.com/9j107.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/9j107.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>I would create another file called <code>your_model_controller.go</code> and give all the persistence responsibilities to this file </p>\n\n<p><a href=\"https://www.tutorialspoint.com/mvc_framework/mvc_framework_introduction.htm\" rel=\"nofollow noreferrer\">Introduction about MVC</a></p>\n"}, {"comments": [{"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 0, "creation_date": 1560980016, "post_id": 56676135, "comment_id": 99919466, "body": "One thing I DON&#39;T generally try to do myself is use or write any kind of real, dynamic ORM. In my work, all these services have hand-written SQL, for instance, rather than doing reflection or code generation. Your mileage may vary."}], "tags": [], "owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "is_accepted": true, "score": 3, "last_activity_date": 1560979840, "creation_date": 1560979840, "answer_id": 56676135, "question_id": 56673062, "link": "https://stackoverflow.com/questions/56673062/golang-database-layer-organizing-inside-a-package/56676135#56676135", "title": "Golang database layer organizing inside a package", "body": "<p>I like Ben Johnson's method explained here <a href=\"https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1\" rel=\"nofollow noreferrer\">https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1</a></p>\n\n<p>The idea is to have your domain objects in your base package, then wrap the database/nosql/redis/whatever persistence layer as services in subpackages. When I do this, I end up with this sort of thing:</p>\n\n<ul>\n<li>myobject.go (defines MyObbject struct, and MyObjectService interface, has things like maybe 'Get, Update')</li>\n<li>mysql/\n\n<ul>\n<li>myobject_service.go (implements MyObjectService for mysql persistence)</li>\n</ul></li>\n<li>redis/\n\n<ul>\n<li>myobject_service.go (implementation for redis)</li>\n</ul></li>\n</ul>\n\n<p>this allows you to pass around MyObjectService in your business logic and you don't even care how the persistence actually happens. A mysql.MyObjectService concrete struct tends to hold things like a pointer to the database connection. A cache package may store things in memory. Etc.</p>\n\n<p>So in other words, don't base your struct slavishly to the database, locking yourself into a particular implementation. Separate the business code logic from the act of persisting, and use interfaces to allow a consistent pattern to accessing persisted data. </p>\n"}], "owner": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2509, "favorite_count": 0, "accepted_answer_id": 56676135, "answer_count": 3, "score": 2, "last_activity_date": 1560979840, "creation_date": 1560965358, "question_id": 56673062, "link": "https://stackoverflow.com/questions/56673062/golang-database-layer-organizing-inside-a-package", "title": "Golang database layer organizing inside a package", "body": "<p>I would like to hear some advice from Golang gurus.\nImagine I have a package for database layer with many table which I should define structs and functions for them. As an example, I have a table called \"MyObject\" and define a struct for it.</p>\n\n<pre><code>type MyObject struct {\n    RecID       int\n    Name        string\n}\n</code></pre>\n\n<p>Is it convenient for functions related to this table/struct I define receiver like this:</p>\n\n<pre><code>func (o MyObject) AllMyObjects() ([]MyObject, error) {\n    // retreive all MyObjects by query\n}\n\n\nfunc (o *MyObject) OneMyObjects() (MyObject, error) {\n    // retreive one MyObject by query\n}\n</code></pre>\n\n<p>In this way as my db package get bigger by structs and functions, it will look cleaner and easier to call methods like this (although I should define 1 extra line):</p>\n\n<pre><code>var myobject MyObject\nvar myobjects,err = myobject.AllMyObjects()\n</code></pre>\n\n<p>rather than calling functions directly on package level (db is name of my package)</p>\n\n<pre><code>var myobjects,err = db.AllMyObjects()\n</code></pre>\n\n<p>Is this Go way of organizing code or do you have other advice for this? </p>\n"}, {"tags": ["go", "video", "ffmpeg", "compression"], "comments": [{"owner": {"reputation": 387, "user_id": 7447711, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/06fc8aa94e57d803061286afdcd0f309?s=128&d=identicon&r=PG&f=1", "display_name": "Mikael", "link": "https://stackoverflow.com/users/7447711/mikael"}, "edited": false, "score": 0, "creation_date": 1560964850, "post_id": 56672058, "comment_id": 99913106, "body": "Use this to break the video into images: <a href=\"https://stackoverflow.com/questions/34786669/extract-all-video-frames-as-images-with-ffmpeg\" title=\"extract all video frames as images with ffmpeg\">stackoverflow.com/questions/34786669/&hellip;</a> and then use this to make the matrix: <a href=\"https://stackoverflow.com/questions/33186783/get-a-pixel-array-from-from-golang-image-image\" title=\"get a pixel array from from golang image image\">stackoverflow.com/questions/33186783/&hellip;</a>  Make a slice of matrices and it should be what you want."}, {"owner": {"reputation": 489, "user_id": 5696129, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/265daeba6fe641c23afd16c1aee32a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Nephilim", "link": "https://stackoverflow.com/users/5696129/nephilim"}, "reply_to_user": {"reputation": 387, "user_id": 7447711, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/06fc8aa94e57d803061286afdcd0f309?s=128&d=identicon&r=PG&f=1", "display_name": "Mikael", "link": "https://stackoverflow.com/users/7447711/mikael"}, "edited": false, "score": 0, "creation_date": 1560978146, "post_id": 56672058, "comment_id": 99918817, "body": "@Mikael so a theoretical X amounts of jpegs, created, X amount of readers then reading each jpeg, then piecing them together. This sounds very expensive, but I&#39;ll look into it, I&#39;m getting desperate here."}, {"owner": {"reputation": 1463, "user_id": 1633924, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/19de3e512d3f715eba0e801a2f1e72d7?s=128&d=identicon&r=PG", "display_name": "mcont", "link": "https://stackoverflow.com/users/1633924/mcont"}, "edited": false, "score": 0, "creation_date": 1560979209, "post_id": 56672058, "comment_id": 99919189, "body": "As mentioned below, an option would be to make ffmpeg output YUV or RGB, so that you can then pipe the output and read it in your application. Some resources that might help you: <a href=\"https://stackoverflow.com/a/42989472/1633924\">1</a>, <a href=\"http://zulko.github.io/blog/2013/09/27/read-and-write-video-frames-in-python-using-ffmpeg/\" rel=\"nofollow noreferrer\">2</a>, <a href=\"https://batchloaf.wordpress.com/2017/02/12/a-simple-way-to-read-and-write-audio-and-video-files-in-c-using-ffmpeg-part-2-video/\" rel=\"nofollow noreferrer\">3</a>."}], "answers": [{"comments": [{"owner": {"reputation": 489, "user_id": 5696129, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/265daeba6fe641c23afd16c1aee32a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Nephilim", "link": "https://stackoverflow.com/users/5696129/nephilim"}, "edited": false, "score": 0, "creation_date": 1560978077, "post_id": 56674229, "comment_id": 99918786, "body": "Mind explaining what yuv4mpegpipe does and why it would help me? All I&#39;m finding is docs meant for people who know what they&#39;re looking for. Reminder, literally all I&#39;m looking for is a way to get every pixel(luminosity value, since it&#39;s grayscale video), without dealing with metadata."}, {"owner": {"reputation": 27067, "user_id": 210785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a561cd4d29738e18d9e565a6265d86ac?s=128&d=identicon&r=PG", "display_name": "szatmary", "link": "https://stackoverflow.com/users/210785/szatmary"}, "reply_to_user": {"reputation": 489, "user_id": 5696129, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/265daeba6fe641c23afd16c1aee32a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Nephilim", "link": "https://stackoverflow.com/users/5696129/nephilim"}, "edited": false, "score": 0, "creation_date": 1560980558, "post_id": 56674229, "comment_id": 99919638, "body": "It is a method for encoding raw YUV data into a stream of frames. <a href=\"https://wiki.multimedia.cx/index.php/YUV4MPEG2\" rel=\"nofollow noreferrer\">wiki.multimedia.cx/index.php/YUV4MPEG2</a>"}], "tags": [], "owner": {"reputation": 27067, "user_id": 210785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a561cd4d29738e18d9e565a6265d86ac?s=128&d=identicon&r=PG", "display_name": "szatmary", "link": "https://stackoverflow.com/users/210785/szatmary"}, "is_accepted": false, "score": 1, "last_activity_date": 1560970757, "creation_date": 1560970757, "answer_id": 56674229, "question_id": 56672058, "link": "https://stackoverflow.com/questions/56672058/get-frames-from-a-video-into-a-matrix/56674229#56674229", "title": "Get frames from a video into a matrix", "body": "<p>I/P/B frames only exist in the raw bitstream. Once the video is decoded, all frames are I frames. You probably want to use ffmprg to decode to something like yuv4mpegpipe then parse the output in your golang program. </p>\n"}], "owner": {"reputation": 489, "user_id": 5696129, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/265daeba6fe641c23afd16c1aee32a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Nephilim", "link": "https://stackoverflow.com/users/5696129/nephilim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1560970757, "creation_date": 1560961069, "last_edit_date": 1560962324, "question_id": 56672058, "link": "https://stackoverflow.com/questions/56672058/get-frames-from-a-video-into-a-matrix", "title": "Get frames from a video into a matrix", "body": "<p>I'm currently trying to implement a compression algorithm(frame prediction) for an assignment. <strong>I am not looking for thumbnail files</strong>, or even just a shell command to generate something for me. My problem is specifically integrating it with a golang program.  </p>\n\n<p>I just started and I'm already stuck. I'm supposed to get each frame out of a video,divide it into I P and B frames and perform inter-coding(compress the frame itself), then perform intra-coding(between the frames).</p>\n\n<p>Right now I cannot even get started on the above problems, because I have no idea how to read the video as something I could use in code. Apparently, the only library I can think of is ffmpeg. FFMPEG can get separate frames, apparently even i p and b frames.</p>\n\n<p><code>ffmpeg -i &lt;inputfile&gt; -vf '[in]select=eq(pict_type\\,B)[out]' b.frames.mp4\n</code></p>\n\n<p>But this is just another video output, that I do not know how to open. \nWhat I was thinking of was outputting frames into bitmaps(?), then reading each bitmap separately, to reconstruct three 3D matrixes, of i frames, p frames and b frames. However this seems like quite a feat. Someone, somewhere has definitely tried to parse a video into a 3D matrix and has found a better solution than what I'm thinking of. </p>\n\n<p>To be concise, I have a video, I need a 3D matrix. The 3D matrix is a matrix of 2D matrixes, which represent a frame in the video. Each point in a 3D matrix is a pixel(or whatever the equivalent is in videos).</p>\n\n<p><a href=\"https://i.stack.imgur.com/h0nKr.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/h0nKr.png\" alt=\"3D matrix\"></a></p>\n"}, {"tags": ["go", "protocol-buffers", "protoc", "go-modules"], "answers": [{"comments": [{"owner": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "edited": false, "score": 0, "creation_date": 1561043164, "post_id": 56674392, "comment_id": 99943230, "body": "If I clone and push isn&#39;t that same as fork? Are you sure you cannot? <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a> seems to explicitly state my use case: &quot;replace also allows the use of a forked dependency, such as...&quot;"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "edited": false, "score": 0, "creation_date": 1561110851, "post_id": 56674392, "comment_id": 99965772, "body": "All depends on the Details. If you fork a project with single package that does not pin its import path and does not use reflection to get its import path then of course you can fork and use the fork without and Problem. A github fork creates a new Package and is a Bad idea."}, {"owner": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "edited": false, "score": 1, "creation_date": 1561490683, "post_id": 56674392, "comment_id": 100078989, "body": "I&#39;m a golang noob, but I think your comments are true in the &quot;old&quot; non-versioned go module way (when all code is within <code>GOPATH</code>), which is covered in <a href=\"https://stackoverflow.com/questions/14323872/using-forked-package-import-in-go\" title=\"using forked package import in go\">stackoverflow.com/questions/14323872/&hellip;</a> With new go module support (v1.11+) I&#39;m pretty sure this pain-point has been addressed."}, {"owner": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "edited": false, "score": 1, "creation_date": 1561495177, "post_id": 56674392, "comment_id": 100080756, "body": "You are right. <code>replace</code> is only meant for local development, and have no effect outside of your own module (aka external tools like one in Q) . Details @ <a href=\"https://github.com/golang/go/issues/30354\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/30354</a>"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": -6, "last_activity_date": 1564712130, "last_edit_date": 1564712130, "creation_date": 1560971469, "answer_id": 56674392, "question_id": 56671133, "link": "https://stackoverflow.com/questions/56671133/how-to-use-a-forked-module-with-versioned-go-modules-v1-11-go111module-on/56674392#56674392", "title": "How to use a forked module, with versioned Go Modules (v1.11+, GO111MODULE=on)", "body": "<blockquote>\n  <p>How to use a forked module [?]</p>\n</blockquote>\n\n<p>You cannot. A Github fork produces a unrelated package, most likely not even buildable.</p>\n\n<p>Don't fork, clone. Then push to a different remote (which can be a fork).</p>\n"}, {"comments": [{"owner": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "edited": false, "score": 0, "creation_date": 1564712141, "post_id": 57317056, "comment_id": 101129239, "body": "THANK YOU! I was so confused on why the readme seemed to state that the go dev team explicitly planned for this case. What a dumb error on my part."}], "tags": [], "owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "is_accepted": true, "score": 13, "last_activity_date": 1564693937, "creation_date": 1564693937, "answer_id": 57317056, "question_id": 56671133, "link": "https://stackoverflow.com/questions/56671133/how-to-use-a-forked-module-with-versioned-go-modules-v1-11-go111module-on/57317056#57317056", "title": "How to use a forked module, with versioned Go Modules (v1.11+, GO111MODULE=on)", "body": "<p>You have the following <code>replace</code>:</p>\n\n<p><code>replace go.larrymyers.com/protoc-gen-twirp_typescript =&gt; github.com/rynop/protoc-gen-twirp_typescript master</code></p>\n\n<p>which if I've followed, is effectively <code>replace originalname =&gt; forkname</code></p>\n\n<p>I think the issue is that you are importing using the name of the fork, rather than the original name:</p>\n\n<pre><code>import (\n    // protocol buffer compiler plugins\n    _ \"github.com/golang/protobuf/protoc-gen-go\"\n    _ \"github.com/mwitkow/go-proto-validators/protoc-gen-govalidators\"\n    _ \"github.com/twitchtv/twirp/protoc-gen-twirp\"\n    _ \"github.com/rynop/protoc-gen-twirp_typescript\"   &lt;&lt;&lt;&lt; PROBLEM, using fork name\n)\n</code></pre>\n\n<p>The error message you see seems to be the <code>go</code> command complaining about that.</p>\n\n<p>I suspect it would work if you used the original name in the import statement:</p>\n\n<pre><code>import (\n    ...\n    _ \"go.larrymyers.com/protoc-gen-twirp_typescript\"   &lt;&lt;&lt;&lt; original name\n)\n</code></pre>\n\n<p>You should also run <code>go list -m all</code> to see the final selected versions, including it shows the outcome of any <code>replace</code> and <code>exclude</code> directives.</p>\n"}], "owner": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5840, "favorite_count": 2, "accepted_answer_id": 57317056, "answer_count": 2, "score": 14, "last_activity_date": 1564712130, "creation_date": 1560957649, "last_edit_date": 1561490682, "question_id": 56671133, "link": "https://stackoverflow.com/questions/56671133/how-to-use-a-forked-module-with-versioned-go-modules-v1-11-go111module-on", "title": "How to use a forked module, with versioned Go Modules (v1.11+, GO111MODULE=on)", "body": "<p>I <a href=\"https://github.com/rynop/protoc-gen-twirp_typescript\" rel=\"noreferrer\">forked</a> a go module, and want to use the fork in my project that uses <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"noreferrer\">versioned modules</a> via <code>v1.12</code>.  My code is not inside my <code>GOPATH</code>. </p>\n\n<p>My project's <code>go.mod</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>module github.com/me/myproj\n\ngo 1.12\n\nrequire (   \n    go.larrymyers.com/protoc-gen-twirp_typescript v0.0.0-20190605194555-ffbfe407b60f\n)\n\nreplace go.larrymyers.com/protoc-gen-twirp_typescript =&gt; github.com/rynop/protoc-gen-twirp_typescript master\n\n</code></pre>\n\n<p>protoc-gen-twirp_typescript is a tool for <code>protoc</code>, so here is my <code>tools.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// +build tools\n\npackage tools\n\nimport (\n    // protocol buffer compiler plugins\n    _ \"github.com/golang/protobuf/protoc-gen-go\"\n    _ \"github.com/mwitkow/go-proto-validators/protoc-gen-govalidators\"\n    _ \"github.com/twitchtv/twirp/protoc-gen-twirp\"\n    _ \"github.com/rynop/protoc-gen-twirp_typescript\"\n)\n\n</code></pre>\n\n<p>When I run <code>go mod tidy</code> to download my dependencies, I get this error:</p>\n\n<pre><code>go: finding github.com/rynop/protoc-gen-twirp_typescript master\ngo: finding github.com/rynop/protoc-gen-twirp_typescript latest\ngo: github.com/rynop/protoc-gen-twirp_typescript@v0.0.0-20190618203538-a346b5d9c8fb: parsing go.mod: unexpected module path \"go.larrymyers.com/protoc-gen-twirp_typescript\"\n</code></pre>\n\n<p>Why am I getting this error? I thought the <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"noreferrer\">replace</a> directive in <code>go.mod</code> allows for the <a href=\"https://github.com/rynop/protoc-gen-twirp_typescript/blob/master/go.mod\" rel=\"noreferrer\">forked modules go.mod</a> to stay untouched.</p>\n"}, {"tags": ["git", "go", "gitlab", "govendor"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1560955523, "post_id": 56670381, "comment_id": 99908272, "body": "What do you mean by &quot;group instead of project&quot;? The repo is <code>gitlab.com&#47;company&#47;group</code>, so that&#39;s what needs to be checked out."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1560957075, "post_id": 56670381, "comment_id": 99909253, "body": "In gitlab, you can have a repo: gitlab.com/company/repo.git or you can group several projects into a group, and your repo will be: gitlab.com/company/mygroup/repo.git"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1560957187, "post_id": 56670381, "comment_id": 99909334, "body": "in this case, group is : company/group"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560957232, "post_id": 56670381, "comment_id": 99909364, "body": "I had the same problem on an old project of mine. My solution was to stop using govendor, which is by now pretty outdated anyway."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560957350, "post_id": 56670381, "comment_id": 99909439, "body": "@Flimzy I tested with dep, and I had the same issue"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560957383, "post_id": 56670381, "comment_id": 99909464, "body": "Strange. I use dep all the time with groups, and have no problem."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1560957438, "post_id": 56670381, "comment_id": 99909506, "body": "I will add output with dep"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1560957473, "post_id": 56670381, "comment_id": 99909535, "body": "Are you on a recent version of gitlab? The 11.7 release specifically supports packages in subgroups: <a href=\"https://about.gitlab.com/2019/01/22/gitlab-11-7-released/#support-for-private-go-packages-in-subgroups\" rel=\"nofollow noreferrer\">about.gitlab.com/2019/01/22/gitlab-11-7-released/&hellip;</a>. I assume they added go meta tags to redirect to the correct git path"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1560957520, "post_id": 56670381, "comment_id": 99909577, "body": "@JimB yep, I use gitlab.com"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1560957675, "post_id": 56670381, "comment_id": 99909678, "body": "I added dep output in question"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1560957713, "post_id": 56670381, "comment_id": 99909708, "body": "Does <code>go get</code> work on it&#39;s own? If that&#39;s the case then it does seem like a bug with those vendoring tools (FWIW I&#39;ve completely moved on to modules which is much easier to reason about). Dep also claims it&#39;s fixed with 11.7: <a href=\"https://github.com/golang/dep/issues/1371\" rel=\"nofollow noreferrer\">github.com/golang/dep/issues/1371</a>, but maybe that thread leads somewhere"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1560957769, "post_id": 56670381, "comment_id": 99909747, "body": "but modules are in beta no ?"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1560957911, "post_id": 56670381, "comment_id": 99909843, "body": "go get ./... is working great"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1560957912, "post_id": 56670381, "comment_id": 99909844, "body": "modules are widely used, and go only defaults to GOPATH if you&#39;re already working inside a GOPATH."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563473573, "post_id": 56670381, "comment_id": 100721970, "body": "I had to find a solution for this using dep. Answer <a href=\"https://stackoverflow.com/q/56817601/13860\">here</a>. Not sure if I should mark this a duplicate, since this question was originally about govendor."}], "owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "closed_date": 1577781070, "answer_count": 0, "score": 1, "last_activity_date": 1560957629, "creation_date": 1560955345, "last_edit_date": 1560957629, "question_id": 56670381, "link": "https://stackoverflow.com/questions/56670381/govendor-and-dep-trying-to-fetch-group-when-it-should-fetch-projects", "closed_reason": "Duplicate", "title": "Govendor and dep trying to fetch group, when it should fetch projects", "body": "<p>I have Go project in gitlab inside a group, so it is like:</p>\n\n<pre><code>https://gitlab.com/company/group/project1.git\nhttps://gitlab.com/company/group/project2.git\netc.\n</code></pre>\n\n<p>I have a vendor folder with vendor.json generated\nWhen I call </p>\n\n<pre><code>govendor fetch +a\n\n\n# cd .; git clone https://gitlab.com/company/group.git /home/user/go/.cache/govendor/gitlab.com/company/group\nCloning into '/home/user/go/.cache/govendor/gitlab.com/company/group'...\nremote: The project you were looking for could not be found.\nfatal: repository 'https://oauth2:xxxxxxxxx@gitlab.com/company/group.git/' not found\nError: failed to create repo \"https://gitlab.com/company/group.git\" in \"/home/user/go/.cache/govendor/gitlab.com/company/group\" exit status 128\n</code></pre>\n\n<p>When I try with dep, I get: </p>\n\n<pre><code>Trying master (9def400) as initial lock for imported dep gitlab.com/company/miscellaneous\n  Warning: Skipping project. Unable to import lock \"e08070af4ee384fbddd6e78b3c9c73653776e249\" for gitlab.com/company/group: unable to list versions for gitlab.com/company/group(): \n        (1) failed to list versions for https://gitlab.com/company/group.git: remote: The project you were looking for could not be found.\nfatal: repository 'https://oauth2:xxxxxxxx@gitlab.com/company/group.git/' not found\n: exit status 128\n</code></pre>\n\n<p>Why is Govendor / dep trying to fetch a group instead of a project?</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1560955309, "post_id": 56670287, "comment_id": 99908115, "body": "How could <code>x.MyField</code> tell you which field? If there&#39;s only one <code>string</code> field then you can infer it, but once you have multiple fields of the same type there&#39;s no information to identify it."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1560955328, "post_id": 56670287, "comment_id": 99908127, "body": "That&#39;s not how reflection works. Besides, if the field name changes, you&#39;d still have to update the code, so what difference would it make?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1560955717, "post_id": 56670287, "comment_id": 99908400, "body": "Are you trying to find the tagged field (i.e. the one tagged <code>hello</code>) - regardless of its name (<code>MyField</code>)? If so, then yes this is possible. But please clarify your question first."}, {"owner": {"reputation": 69, "user_id": 10962811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2ae0e55fa8bd75d65619573e53cb9d7?s=128&d=identicon&r=PG&f=1", "display_name": "invalid_address", "link": "https://stackoverflow.com/users/10962811/invalid-address"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1560959719, "post_id": 56670287, "comment_id": 99910867, "body": "@Adrian You&#39;re right, if the field name changes I still have to update the code but I can rely on tools that can do this to me. I can refactor/rename the field using these tools but if I &quot;harcoded&quot; the field name as string it will require much more effort to look at the entire codebase searching for this terms."}, {"owner": {"reputation": 69, "user_id": 10962811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2ae0e55fa8bd75d65619573e53cb9d7?s=128&d=identicon&r=PG&f=1", "display_name": "invalid_address", "link": "https://stackoverflow.com/users/10962811/invalid-address"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1560959867, "post_id": 56670287, "comment_id": 99910935, "body": "@colminator no, what I want is to get the field tag, on my example &quot;hello&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 10962811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2ae0e55fa8bd75d65619573e53cb9d7?s=128&d=identicon&r=PG&f=1", "display_name": "invalid_address", "link": "https://stackoverflow.com/users/10962811/invalid-address"}, "edited": false, "score": 0, "creation_date": 1560961827, "post_id": 56671980, "comment_id": 99911802, "body": "Nice one. But is it safe ? I mean, can this offset change after a garbage collection?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 69, "user_id": 10962811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2ae0e55fa8bd75d65619573e53cb9d7?s=128&d=identicon&r=PG&f=1", "display_name": "invalid_address", "link": "https://stackoverflow.com/users/10962811/invalid-address"}, "edited": false, "score": 0, "creation_date": 1560972068, "post_id": 56671980, "comment_id": 99916401, "body": "@invalid_address See updated answer on how to use the unsafe package to make the code safe against changes to the garbage collector."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1560971872, "last_edit_date": 1560971872, "creation_date": 1560960778, "answer_id": 56671980, "question_id": 56670287, "link": "https://stackoverflow.com/questions/56670287/how-to-get-fields-tag-without-using-the-field-name-as-string/56671980#56671980", "title": "How to get field&#39;s tag without using the field name as string?", "body": "<p>Use offsets to find the field:</p>\n\n<pre><code>// getTag returns the tag for a field given a pointer to\n// a struct and a pointer to the field in that struct.\nfunc getTag(pv interface{}, pf interface{}) reflect.StructTag {\n    v := reflect.ValueOf(pv)\n    offset := reflect.ValueOf(pf).Pointer() - v.Pointer()\n\n    t := v.Type().Elem()\n    for i := 0; i &lt; t.NumField(); i++ {\n        f := t.Field(i)\n        if f.Offset == offset {\n            return f.Tag\n        }\n    }\n    return \"\"\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/npXraSQ5U8m\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n\n<p>The code above assumes that the garbage collector does not move the struct between the to calls to <a href=\"https://godoc.org/reflect#Value.Pointer\" rel=\"nofollow noreferrer\">Pointer</a>. This assumption is true today, but may not true in the future.  Use the <a href=\"https://godoc.org/unsafe#Offsetof\" rel=\"nofollow noreferrer\">unsafe</a> package to make the code safe against future changes to the garbage collector:</p>\n\n<pre><code>// getTag returns the tag for a field with the given offset\n// in the struct pointed to by pv.\nfunc getTag(pv interface{}, offset uintptr) reflect.StructTag {\n    t := reflect.TypeOf(pv).Elem()\n    for i := 0; i &lt; t.NumField(); i++ {\n        f := t.Field(i)\n        if f.Offset == offset {\n            return f.Tag\n        }\n    }\n    return \"\"\n}\n</code></pre>\n\n<p>Call it like this:</p>\n\n<pre><code>x := MyStruct{}\nfmt.Println(getTag(&amp;x, unsafe.Offsetof(x.MyField)))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/x2MmJyBOsAZ\" rel=\"nofollow noreferrer\">Run it on the Playground</a>.</p>\n"}], "owner": {"reputation": 69, "user_id": 10962811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2ae0e55fa8bd75d65619573e53cb9d7?s=128&d=identicon&r=PG&f=1", "display_name": "invalid_address", "link": "https://stackoverflow.com/users/10962811/invalid-address"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 56671980, "answer_count": 1, "score": 1, "last_activity_date": 1560971872, "creation_date": 1560955101, "question_id": 56670287, "link": "https://stackoverflow.com/questions/56670287/how-to-get-fields-tag-without-using-the-field-name-as-string", "title": "How to get field&#39;s tag without using the field name as string?", "body": "<p>Is it possible to fetch a field tag using a function that receives only the struct and the field itself ? </p>\n\n<p>I know that I can do a thing like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>reflect.TypeOf(x).FieldByName(\"FieldNameAsString\").Tag\n</code></pre>\n\n<p>But I don't want to use the field's name as string in this case because it could be renamed in the future, so it is better to use the field itself instead.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type MyStruct struct {\n    MyField string `thetag:\"hello\"`\n}\n\nfunc main() {\n    x := MyStruct{}\n    getTag(x, x.MyField)\n}\n</code></pre>\n"}, {"tags": ["go", "visual-studio-code", "race-condition"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560950482, "post_id": 56668273, "comment_id": 99905070, "body": "This has been asked before, but not answered. <a href=\"https://stackoverflow.com/q/54210354/13860\">stackoverflow.com/q/54210354/13860</a>   If we can get an answer here, we can close the other as a duplicate."}, {"owner": {"reputation": 4604, "user_id": 516512, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9tqAX.jpg?s=128&g=1", "display_name": "Farshid", "link": "https://stackoverflow.com/users/516512/farshid"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560951006, "post_id": 56668273, "comment_id": 99905403, "body": "@Flimzy I do not know about launch.json which is being mentioned in your denoted question.  Although two questions appear to be similar,  my question is focused on VS code microsoft extension for Go, which is configured via settings.json nd not via launch.json. If they are the same, then this question may be considered duplicate (while my version is more detailed and elaborated)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560951112, "post_id": 56668273, "comment_id": 99905477, "body": "You may be right. I don&#39;t use VSCode, so don&#39;t know about the differences you&#39;re talking about. I mainly left the comment as a note to future readers (possibly myself) to close the old one as a dupe of this if/when you get an answer."}, {"owner": {"reputation": 4604, "user_id": 516512, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9tqAX.jpg?s=128&g=1", "display_name": "Farshid", "link": "https://stackoverflow.com/users/516512/farshid"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560951364, "post_id": 56668273, "comment_id": 99905623, "body": "@Flimzy thanks. I will also search to find whether there has been a relationship between these two files in VS Code historically."}], "answers": [{"tags": [], "owner": {"reputation": 136, "user_id": 9994192, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JpJua.jpg?s=128&g=1", "display_name": "Owen Yuwono", "link": "https://stackoverflow.com/users/9994192/owen-yuwono"}, "is_accepted": true, "score": 1, "last_activity_date": 1575508866, "creation_date": 1575508866, "answer_id": 59186862, "question_id": 56668273, "link": "https://stackoverflow.com/questions/56668273/how-to-enable-race-detector-for-golang-in-visual-studio-code/59186862#59186862", "title": "How to enable race detector for Golang in Visual Studio Code?", "body": "<p>adding this line in <code>settings.json</code></p>\n\n<p><code>\"go.testFlags\": [\"-race\"]</code></p>\n\n<p>works for me</p>\n"}], "owner": {"reputation": 4604, "user_id": 516512, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/9tqAX.jpg?s=128&g=1", "display_name": "Farshid", "link": "https://stackoverflow.com/users/516512/farshid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 638, "favorite_count": 0, "accepted_answer_id": 59186862, "answer_count": 1, "score": 2, "last_activity_date": 1575508866, "creation_date": 1560949240, "question_id": 56668273, "link": "https://stackoverflow.com/questions/56668273/how-to-enable-race-detector-for-golang-in-visual-studio-code", "title": "How to enable race detector for Golang in Visual Studio Code?", "body": "<p>I searched in many web pages to find what phrase exact should I place in <code>settings.json</code> in VS Code Golang extension (released by Microsoft) to add a build flag (in my case, race detector)?</p>\n\n<p>I added:</p>\n\n<pre><code>\"go.buildFlags\": [\"-race\"],\n</code></pre>\n\n<p>in extension's <code>settings.json</code> but still when debugging, in a function that definitely generates a race condition, the debugging console does not denote something like:</p>\n\n<pre><code>Found 1 data race(s)\n</code></pre>\n\n<p>which the go compiler usually indicates when executing the same file via </p>\n\n<pre><code>go run -race file.go\n</code></pre>\n"}, {"tags": ["docker", "go", "gitlab", "gitlab-ci-runner"], "answers": [{"tags": [], "owner": {"reputation": 1099, "user_id": 6162120, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EeZSp.png?s=128&g=1", "display_name": "piarston", "link": "https://stackoverflow.com/users/6162120/piarston"}, "is_accepted": false, "score": 1, "last_activity_date": 1561019549, "creation_date": 1561019549, "answer_id": 56682046, "question_id": 56668072, "link": "https://stackoverflow.com/questions/56668072/where-do-i-find-the-name-of-the-windows-version-of-this-golang-image/56682046#56682046", "title": "Where do I find the name of the windows version of this golang image?", "body": "<p>The image you are trying to pull does exist on dockerhub, but as stated in the <a href=\"https://hub.docker.com/_/golang\" rel=\"nofollow noreferrer\">golang documentation</a>, the <code>windowsservercore</code> is only available for gitlab-runner <a href=\"https://docs.gitlab.com/runner/executors/docker.html\" rel=\"nofollow noreferrer\">Docker executors</a> that are running on Windows containers. The gitlab-runner that you are using is most likely a Docker executor running on a Linux machine.</p>\n\n<p>You need to register a gitlab-runner in a Windows container with the Docker executor in order to be able to use the image <code>golang:1.12.6-windowsservercore</code>.</p>\n"}], "owner": {"reputation": 728, "user_id": 3755946, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b78dda1af6b7a699776ad1bc69bbe35?s=128&d=identicon&r=PG&f=1", "display_name": "user3755946", "link": "https://stackoverflow.com/users/3755946/user3755946"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1561020699, "creation_date": 1560948614, "last_edit_date": 1561020699, "question_id": 56668072, "link": "https://stackoverflow.com/questions/56668072/where-do-i-find-the-name-of-the-windows-version-of-this-golang-image", "title": "Where do I find the name of the windows version of this golang image?", "body": "<p>Here is an excerpt from my gitlab-ci.yml:</p>\n\n<pre><code>image: golang:1.9.2\n\nvariables:\n  BIN_NAME: example\n  ARTIFACTS_DIR: artifacts\n  GO_PROJECT: example\n  GOPATH: /go \n\nbefore_script:\n  - mkdir -p ${GOPATH}/src/${GO_PROJECT}\n  - mkdir -p ${CI_PROJECT_DIR}/${ARTIFACTS_DIR}\n  - go get -u github.com/golang/dep/cmd/dep\n  - cp -r ${CI_PROJECT_DIR}/* ${GOPATH}/src/${GO_PROJECT}/\n  - cd ${GOPATH}/src/${GO_PROJECT}\n</code></pre>\n\n<p>This is for Linux. I need a Windows image that is configured for golang.</p>\n\n<p>I tried the following:</p>\n\n<pre><code>image: golang:1.12.6-windowsservercore\n</code></pre>\n\n<p>The above is documented on docker hub.<br>\nBut I get this error:</p>\n\n<blockquote>\n  <p>ERROR: Preparation failed: Error: No such image:\n  golang:1.12.6-windowsservercore (executor_docker.go:182:0s) Will be\n  retried in 3s ...</p>\n</blockquote>\n\n<p>Please note that I am aware the <code>before_script</code> will not work with this image but it should at least find the image.</p>\n"}, {"tags": ["go", "linked-list"], "answers": [{"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1560948714, "post_id": 56667566, "comment_id": 99903928, "body": "I spent <i>waaaay</i> much more time on these arrows than I should have :/"}], "tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": false, "score": 1, "last_activity_date": 1560954242, "last_edit_date": 1560954242, "creation_date": 1560947036, "answer_id": 56667566, "question_id": 56667153, "link": "https://stackoverflow.com/questions/56667153/getting-infinite-loop-when-outputting-the-reversed-linked-list/56667566#56667566", "title": "Getting infinite loop when outputting the reversed linked list", "body": "<pre><code>*node = *n\n</code></pre>\n\n<p>This line does not do what you think it does. You probably hoped it'd change that outer <code>*Node</code> to point to the new head (old tail), yes? Well no, it simply replaces the node at that location. Which explains why the former first value is missing.</p>\n\n<p>So before this last step you have something like this</p>\n\n<pre><code>nil &lt;- 3 &lt;=&gt; 2 &lt;=&gt; 1 -&gt; nil\n       \u2191           \u2191\n       n           node, myListAddress\n</code></pre>\n\n<p>Then you replace <code>node</code> with value of <code>n</code> (which is <code>nil &lt;- 3 -&gt; 2</code>). This makes the structure look like this:</p>\n\n<pre><code>      prev\n \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n \u2502                \u2502 node, myListAddress    \n \u02c5                \u2502\u2571\nnil &lt;- 3 &lt;=&gt; 2 -&gt; 3 \u2500\u2500\u2510\n             ^        \u2502next\n             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>\n\n<p>By the way, this list is so small that this diagram may be misleading. Here's how it looks with more elements:  </p>\n\n<pre><code>      prev\n \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n \u2502                            \u2502 node, myListAddress    \n \u02c5                            \u2502\u2571\nnil &lt;- 5 &lt;=&gt; 4 &lt;=&gt; 3 &lt;=&gt; 2 -&gt; 5 \u2500\u2500\u2510\n             ^                    \u2502next\n             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>\n\n<p>You can either use a <code>**Node</code> there. Or simply return the new head from the function:</p>\n\n<pre><code>func ReverseList(node *Node) *Node {\n\n    for n := node; n != nil; n = n.previous {\n        if n.next == nil {\n            n.next = n.previous\n            n.previous = nil\n\n            return n\n        } else {\n            n.next, n.previous = n.previous, n.next\n        }\n    }\n\n    return node\n}\n</code></pre>\n\n<p>Then </p>\n\n<pre><code>myListAddress = ReverseList(myListAddress)\n</code></pre>\n"}], "owner": {"reputation": 3789, "user_id": 5084982, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/1Y3cg.jpg?s=128&g=1", "display_name": "Le garcon", "link": "https://stackoverflow.com/users/5084982/le-garcon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1560954242, "creation_date": 1560945489, "last_edit_date": 1560946256, "question_id": 56667153, "link": "https://stackoverflow.com/questions/56667153/getting-infinite-loop-when-outputting-the-reversed-linked-list", "title": "Getting infinite loop when outputting the reversed linked list", "body": "<p>I'm learning Go and have written the following code to reverse a linked list. However, the code doesn't work as expected.</p>\n\n<p>Here's a Node structure along with the function for printing and reversing the list.</p>\n\n<pre><code>type Node struct {\n    number   int\n    previous *Node\n    next     *Node\n}\n\nfunc PrintList(node *Node) {\n    for n := node; n != nil; n = n.next {\n        fmt.Println(n)\n    }\n}\n\nfunc ReverseList(node *Node) {\n    var nextNodeRef *Node\n\n    for n := node; n != nil; n = n.previous {\n        if n.next == nil {\n            n.next = n.previous\n            n.previous = nil\n\n            *node = *n\n\n            break\n        } else {\n            nextNodeRef = n.next\n\n            n.next = n.previous\n            n.previous = nextNodeRef\n\n            if n.next == nil {\n                node = n\n            }\n        }\n    }\n\n}\n</code></pre>\n\n<p>The problem is that when I reverse the list and call <code>PrintList</code> I get a seemingly infinite output of all the elements of the list except for the last one (which used to be the first element)</p>\n\n<p>Here's my <code>main</code> function:</p>\n\n<pre><code>func main() {\n    myList := Node{1, nil, nil}\n    myListAddress := &amp;myList\n\n    AddNumber(2, myListAddress)\n    AddNumber(3, myListAddress)\n\n    fmt.Println(\"My list:\")\n    PrintList(myListAddress)\n\n    ReverseList(myListAddress)\n    fmt.Println(\"My list reversed:\")\n    // here I always get list elements that contain 3, 2, 3, 2...\n    PrintList(myListAddress)\n}\n</code></pre>\n\n<p>And here's the <code>AddNumber</code> function that I use:</p>\n\n<pre><code>func AddNumber(number int, node *Node) *Node {\n    if node == nil {\n        log.Fatal(\"No Node provided\")\n    }\n\n    var newNode Node\n\n    for n := node; n != nil; n = n.next {\n        if n.next == nil {\n            newNode = Node{number, n, nil}\n            n.next = &amp;newNode\n\n            break\n        }\n    }\n\n    return &amp;newNode\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1560945301, "post_id": 56667022, "comment_id": 99901900, "body": "What have you tried? Include your code. What problem are you experiencing?"}], "answers": [{"tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": true, "score": 1, "last_activity_date": 1560947162, "last_edit_date": 1560947162, "creation_date": 1560946821, "answer_id": 56667498, "question_id": 56667022, "link": "https://stackoverflow.com/questions/56667022/how-to-convert-json-array-to-objects/56667498#56667498", "title": "How to convert JSON array to objects", "body": "<p>You have to do something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    data1 := make(map[string]map[string]interface{})\n    s1 := `{\"data\":{\"0\":{\"0\":\"1\",\"1\":\"Test1\",\"2\":\"Test2\",\"DT_RowId\":\"row_1\"}}}`\n    err := json.Unmarshal([]byte(s1), &amp;data1)\n    if err != nil {\n        // check error\n    }\n\n    data2 := make(map[string][]interface{})\n    data2[\"data\"] = []interface{}{data1[\"data\"][\"0\"]}\n    s2, err := json.Marshal(data2)\n    if err != nil {\n        // check error\n    }\n\n    fmt.Printf(\"%s\\n\", s2)\n    // result will be:\n    // {\"data\":[{\"0\":\"1\",\"1\":\"Test1\",\"2\":\"Test2\",\"DT_RowId\":\"row_1\"}]}\n}\n</code></pre>\n\n<p>You can check it in <a href=\"https://play.golang.org/p/AGAosU6pBSB\" rel=\"nofollow noreferrer\">playground</a>.\n<br>And don't forget to check data before using it, like:</p>\n\n<pre><code>// instead of:\ndata2[\"data\"] = []interface{}{data1[\"data\"][\"0\"]}\n\n// you must have something like:\nval1, ok := data1[\"data\"]\nif !ok { ... }\n// and\nval2, ok := val1[\"0\"]\nif !ok { ... }\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 11670140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FiYoPAUz7m4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reHgQ9oWVfl6YbQ-XwEGaCbNC8VXQ/mo/photo.jpg?sz=128", "display_name": "Kota Sarath Kumar Achari", "link": "https://stackoverflow.com/users/11670140/kota-sarath-kumar-achari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 56667498, "answer_count": 1, "score": -3, "last_activity_date": 1560947162, "creation_date": 1560945038, "last_edit_date": 1560945290, "question_id": 56667022, "link": "https://stackoverflow.com/questions/56667022/how-to-convert-json-array-to-objects", "title": "How to convert JSON array to objects", "body": "<p>I have following json </p>\n\n<pre><code>{\"data\":{\"0\":{\"0\":\"1\",\"1\":\"Test1\",\"2\":\"Test2\",\"DT_RowId\":\"row_1\"}}}\n</code></pre>\n\n<p>I want to remove the outer level index</p>\n\n<p>I want as below</p>\n\n<pre><code>{\"data\":[{\"0\":\"1\",\"1\":\"Test1\",\"2\":\"Test2\",\"DT_RowId\":\"row_1\"}]}\n</code></pre>\n\n<p>This should be done in Go.</p>\n"}, {"tags": ["string", "go", "constants"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1560938961, "last_edit_date": 1560938961, "creation_date": 1560938632, "answer_id": 56665088, "question_id": 56664963, "link": "https://stackoverflow.com/questions/56664963/golang-remove-characters-used-for-readability-in-const-string-at-compile-time/56665088#56665088", "title": "golang remove characters (used for readability) in const string at compile time (spaces, \\n and \\t)", "body": "<p><a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"nofollow noreferrer\">Constant expressions</a> cannot contain function calls (except a few built-in functions). So what you want cannot be done using a <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">raw string literal</a>.</p>\n\n<p>If your goal with using multiple lines is just for readability, simply use multiple literals and <a href=\"https://golang.org/ref/spec#String_concatenation\" rel=\"nofollow noreferrer\">concatenate</a> them:</p>\n\n<pre><code>const url = \"https://example.com/path?\" +\n    \"attr1=test\" +\n    \"&amp;attr2=test\"\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/UyB_znP7jUu\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/49028654/initialize-const-variable/49028713#49028713\">Initialize const variable</a></p>\n"}], "owner": {"reputation": 537, "user_id": 3562282, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bb2a1b86f4f810371ecf35b5320d2e65?s=128&d=identicon&r=PG&f=1", "display_name": "Pierrot", "link": "https://stackoverflow.com/users/3562282/pierrot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 56665088, "answer_count": 1, "score": -1, "last_activity_date": 1560938961, "creation_date": 1560938271, "last_edit_date": 1560938669, "question_id": 56664963, "link": "https://stackoverflow.com/questions/56664963/golang-remove-characters-used-for-readability-in-const-string-at-compile-time", "title": "golang remove characters (used for readability) in const string at compile time (spaces, \\n and \\t)", "body": "<p>Spaces are useful to indent urls, sql queries to make it more readable.\nIs there a way to remove characters from a const string at compile time in golang ?</p>\n\n<pre><code>ex: (runtime version)\nconst url = `https://example.com/path?\nattr1=test\n&amp;attr2=test\n`\n// this is the code to be replaced\nurlTrim := strings.Replace(\nstrings.Replace(url, \"\\n\", \"\", -1)\n)\n</code></pre>\n"}, {"tags": ["go", "gitlab", "gitlab-ci"], "answers": [{"tags": [], "owner": {"reputation": 8395, "user_id": 5152001, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/2TlSo.jpg?s=128&g=1", "display_name": "Glen Thomas", "link": "https://stackoverflow.com/users/5152001/glen-thomas"}, "is_accepted": true, "score": 1, "last_activity_date": 1560972914, "creation_date": 1560972914, "answer_id": 56674706, "question_id": 56664439, "link": "https://stackoverflow.com/questions/56664439/how-do-i-build-using-my-gitlab-pipeline-for-windows/56674706#56674706", "title": "How do I build using my GitLab pipeline for windows", "body": "<p>This is not a gitlab question, but a go question.</p>\n\n<p>Since Go version 1.5 cross-compiling has become very easy.</p>\n\n<pre><code>GOOS=windows GOARCH=386 go build -o hello.exe hello.go\n</code></pre>\n\n<p>You can now run hello.exe on a Windows machine</p>\n"}], "owner": {"reputation": 728, "user_id": 3755946, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5b78dda1af6b7a699776ad1bc69bbe35?s=128&d=identicon&r=PG&f=1", "display_name": "user3755946", "link": "https://stackoverflow.com/users/3755946/user3755946"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 56674706, "answer_count": 1, "score": 0, "last_activity_date": 1561029113, "creation_date": 1560936599, "last_edit_date": 1561029113, "question_id": 56664439, "link": "https://stackoverflow.com/questions/56664439/how-do-i-build-using-my-gitlab-pipeline-for-windows", "title": "How do I build using my GitLab pipeline for windows", "body": "<p>I have the following .gitlab-ci.yml...</p>\n\n<pre><code>stages:\n  - test\n  - build\n  - art\n\nimage: golang:1.9.2\n\nvariables:\n  BIN_NAME: example\n  ARTIFACTS_DIR: artifacts\n  GO_PROJECT: example\n  GOPATH: /go\n\n\nbefore_script:\n  - mkdir -p ${GOPATH}/src/${GO_PROJECT}\n  - mkdir -p ${CI_PROJECT_DIR}/${ARTIFACTS_DIR}\n  - go get -u github.com/golang/dep/cmd/dep\n  - cp -r ${CI_PROJECT_DIR}/* ${GOPATH}/src/${GO_PROJECT}/\n  - cd ${GOPATH}/src/${GO_PROJECT}\n\ntest:\n  stage: test\n\n\n  script:\n    # Run all tests\n    go test -run ''\n\n\nbuild:\n  stage: build\n\n  script:\n    # Compile and name the binary as `hello`\n    - go build -o hello\n    - pwd\n    - ls -l hello\n    # Execute the binary\n    - ./hello\n    # Move to gitlab build directory\n    - mv ./hello ${CI_PROJECT_DIR}\n  artifacts:\n    paths:\n    - ./hello\n</code></pre>\n\n<p>This works great for linux but i now need to do the same so that it builds a windows executable.</p>\n\n<p>I then plan to run a scheduled script to download the artifacts.</p>\n\n<p>The other option is I run a virtual linux server on the windows server and use that to run my go binarys.\nI know i need to change the image to windows but can't see to find an appropriate one online (one that is configured for golang).</p>\n\n<p>Or is it possible to have this docker image build a windows exe?</p>\n"}, {"tags": ["json", "http", "go", "server", "go-gin"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1560937248, "post_id": 56664328, "comment_id": 99897462, "body": "<code>c.JSON(http.StatusOK, map[string]string{&quot;msg&quot;:&quot;this worked&quot;})</code> is closer to the node.js example."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1560937318, "post_id": 56664328, "comment_id": 99897500, "body": "@mkopriva The asker has the JSON response ready as a <code>string</code> value."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560937581, "post_id": 56664328, "comment_id": 99897652, "body": "@icza I noticed that, however <code>{&quot;msg&quot;:&quot;this worked&quot;}</code> in node is not a string literal but an object. So I&#39;ve reasoned that if they can use an object in node, why not a map in go?"}, {"owner": {"reputation": 478, "user_id": 2715121, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/39ef9c575e6ec1f9ed940bea47fc65d8?s=128&d=identicon&r=PG&f=1", "display_name": "tritium_3", "link": "https://stackoverflow.com/users/2715121/tritium-3"}, "edited": false, "score": 0, "creation_date": 1560973165, "post_id": 56664328, "comment_id": 99916847, "body": "yeah not necessarily needs to be a string, the example node.js code is what i&#39;m aiming for. an object that is easily constructed without using a predefined struct."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 17, "last_activity_date": 1560937076, "last_edit_date": 1560937076, "creation_date": 1560936706, "answer_id": 56664470, "question_id": 56664328, "link": "https://stackoverflow.com/questions/56664328/simplest-way-to-return-literal-json-using-gin-gonic/56664470#56664470", "title": "Simplest way to return literal JSON using gin gonic", "body": "<p>One option is to use <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.Data\" rel=\"noreferrer\"><code>Context.Data()</code></a> where you provide the data to send (along with the content type):</p>\n\n<pre><code>func GetDefault(c *gin.Context)  {\n    jsonData := []byte(`{\"msg\":\"this worked\"}`)\n\n    c.Data(http.StatusOK, \"application/json\", jsonData)\n}\n</code></pre>\n\n<p>You may also use a constant for the content type:</p>\n\n<pre><code>func GetDefault(c *gin.Context)  {\n    jsonData := []byte(`{\"msg\":\"this worked\"}`)\n\n    c.Data(http.StatusOK, gin.MIMEJSON, jsonData)\n}\n</code></pre>\n\n<p>If your data is availabe as a <code>string</code> value and is big, you can avoid converting it to <code>[]byte</code> if you use <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.DataFromReader\" rel=\"noreferrer\"><code>Context.DataFromReader()</code></a>:</p>\n\n<pre><code>func GetDefault(c *gin.Context) {\n    jsonStr := `{\"msg\":\"this worked\"}`\n\n    c.DataFromReader(http.StatusOK,\n        int64(len(jsonStr)), gin.MIMEJSON, strings.NewReader(jsonStr), nil)\n}\n</code></pre>\n\n<p>This solution also works if you have your JSON as an <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"noreferrer\"><code>io.Reader</code></a>, e.g. an <a href=\"https://golang.org/pkg/os/#File\" rel=\"noreferrer\"><code>os.File</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 393, "user_id": 5223002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tmBSX.jpg?s=128&g=1", "display_name": "Eduardo Hitek", "link": "https://stackoverflow.com/users/5223002/eduardo-hitek"}, "is_accepted": true, "score": 10, "last_activity_date": 1560966807, "creation_date": 1560966807, "answer_id": 56673371, "question_id": 56664328, "link": "https://stackoverflow.com/questions/56664328/simplest-way-to-return-literal-json-using-gin-gonic/56673371#56673371", "title": "Simplest way to return literal JSON using gin gonic", "body": "<p>you can use the <code>gin.H</code> struct on you response:</p>\n\n<pre><code>c.JSON(http.StatusOK, gin.H{\"msg\":\"this worked\"})\n</code></pre>\n"}], "owner": {"reputation": 478, "user_id": 2715121, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/39ef9c575e6ec1f9ed940bea47fc65d8?s=128&d=identicon&r=PG&f=1", "display_name": "tritium_3", "link": "https://stackoverflow.com/users/2715121/tritium-3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6504, "favorite_count": 2, "accepted_answer_id": 56673371, "answer_count": 2, "score": 8, "last_activity_date": 1589710232, "creation_date": 1560936293, "last_edit_date": 1589710232, "question_id": 56664328, "link": "https://stackoverflow.com/questions/56664328/simplest-way-to-return-literal-json-using-gin-gonic", "title": "Simplest way to return literal JSON using gin gonic", "body": "<p>I am learning Go by building a simple API interface for a web server. I want to return a simple message in JSON, when a default route is hit.</p>\n\n<p>So far, reading online, this is the easiest way to return a literal JSON string, and encode it and send it to the user.</p>\n\n<pre><code>func GetDefault(c *gin.Context)  {\n    jsonData := []byte(`{\"msg\":\"this worked\"}`)\n\n    var v interface{}\n    json.Unmarshal(jsonData, &amp;v)\n    data := v.(map[string]interface{})  \n\n    c.JSON(http.StatusOK,data)\n}\n</code></pre>\n\n<p>Is this the most efficient / fastest way to do it?</p>\n\n<p>in node.js and express, I would do something like:</p>\n\n<pre><code>return res.status(200).json({\"msg\":\"this worked\"});\n</code></pre>\n\n<p>Whats the best way to do this in Go + Gin?</p>\n"}, {"tags": ["string", "dictionary", "pointers", "go", "sarama"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1560933132, "post_id": 56663288, "comment_id": 99895128, "body": "The error is pretty clear. You can&#39;t use a string as a pointer to string. What part is unclear?"}, {"owner": {"reputation": 5229, "user_id": 5611997, "user_type": "registered", "profile_image": "https://graph.facebook.com/1277718525587696/picture?type=large", "display_name": "Leonardo Cuquejo", "link": "https://stackoverflow.com/users/5611997/leonardo-cuquejo"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560934542, "post_id": 56663288, "comment_id": 99895918, "body": "I&#39;m new to golang :)  I didn&#39;t get yet how pointer string works.  I understand that a pointer is pointing directly to the value in memory of a variable.  But I don&#39;t understant what is a map of pointers strings.   Should I create a var test string  Then point to this var like *test?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1560934718, "post_id": 56663288, "comment_id": 99896029, "body": "Okay. I suggest starting with <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">A Tour of Go</a>. Specifically <a href=\"https://tour.golang.org/moretypes/1\" rel=\"nofollow noreferrer\">the section on pointers</a>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1560933555, "creation_date": 1560933555, "answer_id": 56663455, "question_id": 56663288, "link": "https://stackoverflow.com/questions/56663288/how-to-use-mapstringstring/56663455#56663455", "title": "How to use map[string]*string", "body": "<p>To initialize a map having <code>string</code> pointer value type with a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"noreferrer\">composite literal</a>, you have to use <code>string</code> pointer values. A <code>string</code> literal is not a pointer, it's just a <code>string</code> value.</p>\n\n<p>An easy way to get a pointer to a <code>string</code> value is to take the address of a variable of <code>string</code> type, e.g.:</p>\n\n<pre><code>s1 := \"delete\"\ns2 := \"36000000\"\n\ntConfigs := map[string]*string{\n    \"cleanup.policy\":      &amp;s1,\n    \"delete.retention.ms\": &amp;s2,\n}\n</code></pre>\n\n<p>To make it convenient when used many times, create a helper function:</p>\n\n<pre><code>func strptr(s string) *string { return &amp;s }\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>tConfigs := map[string]*string{\n    \"cleanup.policy\":      strptr(\"delete\"),\n    \"delete.retention.ms\": strptr(\"36000000\"),\n}\n</code></pre>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/bf4z8IivQ_K\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>See background and other options here: <a href=\"https://stackoverflow.com/questions/30716354/how-do-i-do-a-literal-int64-in-go/30716481#30716481\">How do I do a literal *int64 in Go?</a></p>\n"}], "owner": {"reputation": 5229, "user_id": 5611997, "user_type": "registered", "profile_image": "https://graph.facebook.com/1277718525587696/picture?type=large", "display_name": "Leonardo Cuquejo", "link": "https://stackoverflow.com/users/5611997/leonardo-cuquejo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 56663455, "answer_count": 1, "score": 1, "last_activity_date": 1560933661, "creation_date": 1560933043, "last_edit_date": 1560933661, "question_id": 56663288, "link": "https://stackoverflow.com/questions/56663288/how-to-use-mapstringstring", "title": "How to use map[string]*string", "body": "<p>I'm trying to use sarama (Admin mode) to create a topic.\nWithout the ConfigEntries works fine. But I need to define some configs.</p>\n\n<p>I set up the topic config (Here is happening the error):</p>\n\n<pre><code>    tConfigs := map[string]*string{\n        \"cleanup.policy\":      \"delete\",\n        \"delete.retention.ms\": \"36000000\",\n    }\n</code></pre>\n\n<p>But then I get an error:</p>\n\n<pre><code>./main.go:99:28: cannot use \"delete\" (type string) as type *string in map value\n./main.go:100:28: cannot use \"36000000\" (type string) as type *string in map value\n</code></pre>\n\n<p>I'm trying to use the admin mode like this:</p>\n\n<pre><code>err = admin.CreateTopic(t.Name, &amp;sarama.TopicDetail{\n    NumPartitions:     1,\n    ReplicationFactor: 3,\n    ConfigEntries:     tConfigs,\n}, false)\n</code></pre>\n\n<p>Here is the line from the sarama module that defines CreateTopic()\n<a href=\"https://github.com/Shopify/sarama/blob/master/admin.go#L18\" rel=\"nofollow noreferrer\">https://github.com/Shopify/sarama/blob/master/admin.go#L18</a></p>\n\n<p>Basically, I didn't understand how the map of pointers strings works :)</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560928158, "post_id": 56660728, "comment_id": 99892649, "body": "What is <code>xid.ID</code>? Can you post the type declaration and its methods? Also, <code>DeleteMany()</code> returns an error, do not omit it, what is the error? It could be you have no permission to remove documents..."}, {"owner": {"reputation": 9712, "user_id": 66907, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f45da391d77044534895e4dd3770ffd2?s=128&d=identicon&r=PG", "display_name": "Sascha", "link": "https://stackoverflow.com/users/66907/sascha"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560928163, "post_id": 56660728, "comment_id": 99892654, "body": "I omitted the error as it returns no error"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560928271, "post_id": 56660728, "comment_id": 99892705, "body": "Also you have to use <code>bson</code> tag, not <code>json</code>. Please either change <code>json</code> to <code>bson</code> in your <code>Contact</code> struct, or if you use JSON as well, add <code>bson</code> too."}, {"owner": {"reputation": 9712, "user_id": 66907, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f45da391d77044534895e4dd3770ffd2?s=128&d=identicon&r=PG", "display_name": "Sascha", "link": "https://stackoverflow.com/users/66907/sascha"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560928800, "post_id": 56660728, "comment_id": 99892966, "body": "@icza Updated with more code"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560928906, "post_id": 56660728, "comment_id": 99893023, "body": "It looks you use string <code>id</code> with <code>Find()</code>, is it the same with <code>DeleteMany()</code>? Also, have you tried with <code>bson</code> tags?"}, {"owner": {"reputation": 9712, "user_id": 66907, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f45da391d77044534895e4dd3770ffd2?s=128&d=identicon&r=PG", "display_name": "Sascha", "link": "https://stackoverflow.com/users/66907/sascha"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560929057, "post_id": 56660728, "comment_id": 99893108, "body": "@icza added the bson tags (bson:&quot;surname&quot;) in addition to the json one&#39;s. As inserting worked with xid I did change that for querying, it gets converted to string, so yes the same"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560929266, "post_id": 56660728, "comment_id": 99893228, "body": "There seems to be some inconsistency. <code>Contact.ID</code> is of type <code>xid.ID</code> (which is a byte array), but when you insert a <code>Contact</code>, you simply use a <code>string</code> literal. That would be a compile-time error."}, {"owner": {"reputation": 9712, "user_id": 66907, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f45da391d77044534895e4dd3770ffd2?s=128&d=identicon&r=PG", "display_name": "Sascha", "link": "https://stackoverflow.com/users/66907/sascha"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560929437, "post_id": 56660728, "comment_id": 99893348, "body": "@icza no compile error, as the insert does unmarshal from post payload. Anyhow you were on the right track. As soon as I switched the type to string everywhere and used Stringer for ID and changed the type it worked. Please post it as an answer for future reference so I can accept it"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1560930636, "creation_date": 1560930636, "answer_id": 56662624, "question_id": 56660728, "link": "https://stackoverflow.com/questions/56660728/golang-and-mongodb-deletemany-with-filter/56662624#56662624", "title": "Golang and MongoDB: DeleteMany with filter", "body": "<p><code>Contact.ID</code> is of type <a href=\"https://godoc.org/github.com/rs/xid#ID\" rel=\"nofollow noreferrer\"><code>xid.ID</code></a>, which is a byte array:</p>\n\n<pre><code>type ID [rawLen]byte\n</code></pre>\n\n<p>So the insert code you provided where you use a <code>string</code> literal to specify the value for the <code>ID</code> field would be a compile-time error:</p>\n\n<pre><code>_, _ = contactCollection.InsertOne(context.TODO(), Contact{\n    ID: \"abcdefg\",\n    SurName: \"Demo\",\n    PreName: \"on stackoverflow\",\n})\n</code></pre>\n\n<p>Later in your comments you clarified that the above insert code was just an example, and not how you actually do it. In your real code you unmarshal the contact (or its ID field) from a request.</p>\n\n<p><a href=\"https://godoc.org/github.com/rs/xid#ID\" rel=\"nofollow noreferrer\"><code>xid.ID</code></a> has its own unmarshaling logic, which might interpret the input data differently, and might result in an ID representing a different <code>string</code> value than your input. <a href=\"https://godoc.org/github.com/rs/xid#ID.UnmarshalJSON\" rel=\"nofollow noreferrer\"><code>ID.UnmarshalJSON()</code></a> defines how the <code>string</code> ID will be converted to <code>xid.ID</code>:</p>\n\n<pre><code>func (id *ID) UnmarshalJSON(b []byte) error {\n    s := string(b)\n    if s == \"null\" {\n        *id = nilID\n        return nil\n    }\n    return id.UnmarshalText(b[1 : len(b)-1])\n}\n</code></pre>\n\n<p>As you can see, the first byte is cut off, and <a href=\"https://godoc.org/github.com/rs/xid#ID.UnmarshalText\" rel=\"nofollow noreferrer\"><code>ID.UnmarshalText()</code></a> does even more \"magic\" on it (check the source if you're interested).</p>\n\n<p>All-in-all, to avoid such \"transformations\" happen in the background without your knowledge, use a simple <code>string</code> type for your ID, and do necessary conversions yourself wherever you need to store / transmit your ID.</p>\n"}, {"tags": [], "owner": {"reputation": 393, "user_id": 5223002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tmBSX.jpg?s=128&g=1", "display_name": "Eduardo Hitek", "link": "https://stackoverflow.com/users/5223002/eduardo-hitek"}, "is_accepted": false, "score": 0, "last_activity_date": 1560966149, "creation_date": 1560966149, "answer_id": 56673232, "question_id": 56660728, "link": "https://stackoverflow.com/questions/56660728/golang-and-mongodb-deletemany-with-filter/56673232#56673232", "title": "Golang and MongoDB: DeleteMany with filter", "body": "<p>For the ID Field, you should use the <code>primitive.ObjectID</code> provided by the bson package.</p>\n\n<pre><code>\"go.mongodb.org/mongo-driver/bson/primitive\"\n\nID          primitive.ObjectID `json:\"_id\" bson:\"_id\"`\n</code></pre>\n"}], "owner": {"reputation": 9712, "user_id": 66907, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f45da391d77044534895e4dd3770ffd2?s=128&d=identicon&r=PG", "display_name": "Sascha", "link": "https://stackoverflow.com/users/66907/sascha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1089, "favorite_count": 0, "accepted_answer_id": 56662624, "answer_count": 2, "score": 2, "last_activity_date": 1560966149, "creation_date": 1560923038, "last_edit_date": 1560929127, "question_id": 56660728, "link": "https://stackoverflow.com/questions/56660728/golang-and-mongodb-deletemany-with-filter", "title": "Golang and MongoDB: DeleteMany with filter", "body": "<p>I try to read and write and delete data from a Go application with the official mongodb driver for go (go.mongodb.org/mongo-driver).</p>\n\n<p>Here is my struct I want to use:</p>\n\n<pre><code>Contact struct {\n    ID               xid.ID `json:\"contact_id\" bson:\"contact_id\"`\n    SurName          string `json:\"surname\" bson:\"surname\"`\n    PreName          string `json:\"prename\" bson:\"prename\"`\n}\n// xid is https://github.com/rs/xid\n</code></pre>\n\n<p>I omit code to add to the collection as this is working find.</p>\n\n<p>I can get a list of contacts with a specific contact_id using the following code (abbreviated):</p>\n\n<pre><code>filter := bson.D{}\ncursor, err := contactCollection.Find(nil, filter)\nfor cur.Next(context.TODO()) {\n  ...\n}\n</code></pre>\n\n<p>This works and returns the documents. I thought about doing the same for delete or a matched get:</p>\n\n<pre><code>// delete - abbreviated\nfilter := bson.M{\"contact_id\": id}\nresult, _ := contactCollection.DeleteMany(nil, filter)\n// result.DeletedCount is always 0, err is nil\nif err != nil {\n    sendError(c, err) // helper function\n    return\n}\n\nc.JSON(200, gin.H{\n    \"ok\":      true,\n    \"message\": fmt.Sprintf(\"deleted %d patients\", result.DeletedCount),\n}) // will be called, it is part of a webservice done with gin\n\n// get complete\nfunc Get(c *gin.Context) {\n    defer c.Done()\n\n    id := c.Param(\"id\")\n    filter := bson.M{\"contact_id\": id}\n\n    cur, err := contactCollection.Find(nil, filter)\n    if err != nil {\n        sendError(c, err) // helper function\n        return\n    } // no error\n\n    contacts := make([]types.Contact, 0)\n    for cur.Next(context.TODO()) { // nothing returned\n        // create a value into which the single document can be decoded\n        var elem types.Contact\n        err := cur.Decode(&amp;elem)\n        if err != nil {\n            sendError(c, err) // helper function\n            return\n        }\n        contacts = append(contacts, elem)\n    }\n\n    c.JSON(200, contacts)\n}\n</code></pre>\n\n<p>Why does the same filter does not work on delete?</p>\n\n<p><em>Edit:</em> Insert code looks like this:</p>\n\n<pre><code>_, _ = contactCollection.InsertOne(context.TODO(), Contact{\n    ID: \"abcdefg\",\n    SurName: \"Demo\",\n    PreName: \"on stackoverflow\",\n})\n</code></pre>\n"}, {"tags": ["go", "closures"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1560922806, "post_id": 56660625, "comment_id": 99890377, "body": "<code>go run</code> doesn&#39;t fail. But <code>go vet</code> let&#39;s you know that you&#39;re not calling the function returned by intSeq: <a href=\"https://play.golang.org/p/yKuLRWxWXtQ\" rel=\"nofollow noreferrer\">play.golang.org/p/yKuLRWxWXtQ</a>."}, {"owner": {"reputation": 240, "user_id": 5813693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2159d06e92bb9da140ffd9184ac1316?s=128&d=identicon&r=PG&f=1", "display_name": "Tuyen Pham", "link": "https://stackoverflow.com/users/5813693/tuyen-pham"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1560923020, "post_id": 56660625, "comment_id": 99890467, "body": "@Peter. So we have to call the inner anon function?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1560927797, "post_id": 56660625, "comment_id": 99892456, "body": "@TuyenPham no, if it compiles it&#39;s a valid go program, regardless of whether or not it actually produces the result you intended. <a href=\"https://golang.org/cmd/vet/\" rel=\"nofollow noreferrer\">golang.org/cmd/vet</a> <i>&quot;Vet examines Go source code and <b>reports suspicious constructs</b>, such as Printf calls whose arguments do not align with the format string. Vet uses heuristics that <b>do not guarantee all reports are genuine problems</b>, but it can find errors not caught by the compilers.&quot;</i>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1560930920, "post_id": 56660625, "comment_id": 99894048, "body": "Please include complete code necessary to understand the question <i>in the question</i>."}], "answers": [{"comments": [{"owner": {"reputation": 240, "user_id": 5813693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2159d06e92bb9da140ffd9184ac1316?s=128&d=identicon&r=PG&f=1", "display_name": "Tuyen Pham", "link": "https://stackoverflow.com/users/5813693/tuyen-pham"}, "edited": false, "score": 0, "creation_date": 1560962934, "post_id": 56663166, "comment_id": 99912265, "body": "Should <code>fmt.Println(nextInt())</code> and <code>fmt.Println(intSeq())</code> produce the same result? I expected somehow <code>go</code> also call the returned anon function."}], "tags": [], "owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "is_accepted": false, "score": 1, "last_activity_date": 1561383929, "last_edit_date": 1561383929, "creation_date": 1560932611, "answer_id": 56663166, "question_id": 56660625, "link": "https://stackoverflow.com/questions/56660625/passing-closure-as-functions-argument/56663166#56663166", "title": "Passing closure as function&#39;s argument", "body": "<p>To reckon.\nWhen you run Golang playground or any Test in your code, <code>go vet</code> run first and if it return with error the actual go code doesn't run.</p>\n\n<p>If you <code>go build</code> , or <code>go run</code> (tested with 1.12.5) the code run perfectly, printing the function pointer address.</p>\n\n<p>If you copy your code to the tutorial site, here <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">https://tour.golang.org/welcome/1</a> for example. the code work as you expected. </p>\n"}], "owner": {"reputation": 240, "user_id": 5813693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2159d06e92bb9da140ffd9184ac1316?s=128&d=identicon&r=PG&f=1", "display_name": "Tuyen Pham", "link": "https://stackoverflow.com/users/5813693/tuyen-pham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1561383929, "creation_date": 1560922440, "question_id": 56660625, "link": "https://stackoverflow.com/questions/56660625/passing-closure-as-functions-argument", "title": "Passing closure as function&#39;s argument", "body": "<p>From this example: <a href=\"https://gobyexample.com/closures\" rel=\"nofollow noreferrer\">https://gobyexample.com/closures</a>\nIf we change:</p>\n\n<pre><code>    fmt.Println(nextInt())\n    fmt.Println(nextInt())\n    fmt.Println(nextInt())\n</code></pre>\n\n<p>to</p>\n\n<pre><code>    fmt.Println(intSeq())\n    fmt.Println(intSeq())\n    fmt.Println(intSeq())\n</code></pre>\n\n<p><code>go run</code> will fail with error: <code>./prog.go:32:5: Println arg intSeq() is a func value, not called</code></p>\n\n<p>But from this example: <a href=\"https://gobyexample.com/recursion\" rel=\"nofollow noreferrer\">https://gobyexample.com/recursion</a></p>\n\n<pre><code>    fmt.Println(fact(7))\n</code></pre>\n\n<p>We can call <code>fact(7)</code> function as <code>fmt.Println</code>'s argument. Why we have difference?</p>\n"}, {"tags": ["http", "go", "web"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1560963017, "post_id": 56658947, "comment_id": 99912298, "body": "Keep in mind that machines aren&#39;t meant to use the status text, only the nuemric code. The text is intended for humans. A program that attempts to do something with the text is violating the RFC."}, {"owner": {"reputation": 317, "user_id": 7172191, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/noKs5.jpg?s=128&g=1", "display_name": "Juan Chan", "link": "https://stackoverflow.com/users/7172191/juan-chan"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1560994428, "post_id": 56658947, "comment_id": 99922392, "body": "@MichaelHampton I don&#39;t think you understand what I really need and want..The status text is for humans, of course. But there are always some weird requirements, aren&#39;t there? Anyway, thanks for reminding."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560939748, "post_id": 56659716, "comment_id": 99898930, "body": "This doesn&#39;t really address the question. You&#39;ve talked about the accepted status code values, but not the descriptive text for them."}], "tags": [], "owner": {"reputation": 868, "user_id": 4113109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c8272ee0ba8d6fb56ed64c4c116f80d?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya Satyavada", "link": "https://stackoverflow.com/users/4113109/aditya-satyavada"}, "is_accepted": false, "score": 8, "last_activity_date": 1560920165, "last_edit_date": 1560920165, "creation_date": 1560915575, "answer_id": 56659716, "question_id": 56658947, "link": "https://stackoverflow.com/questions/56658947/is-there-any-way-that-i-could-customize-http-response-status-in-golang/56659716#56659716", "title": "Is there any way that I could customize HTTP response status in Golang?", "body": "<p>I don't think what you're trying is currently supported.</p>\n\n<p>As per <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"noreferrer\">the official documentation of <code>net/http.ResponseWriter.WriteHeader</code></a>:</p>\n\n<blockquote>\n  <p>The provided code must be a valid HTTP 1xx-5xx status code. Only one header may be written. Go does not currently support sending user-defined 1xx informational headers, with the exception of 100-continue response header that the Server sends automatically when the Request.Body is read.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 317, "user_id": 7172191, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/noKs5.jpg?s=128&g=1", "display_name": "Juan Chan", "link": "https://stackoverflow.com/users/7172191/juan-chan"}, "edited": false, "score": 0, "creation_date": 1560994918, "post_id": 56665330, "comment_id": 99922479, "body": "Thank you very much. Your answer inspired me a lot !"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 3, "last_activity_date": 1560939692, "last_edit_date": 1560939692, "creation_date": 1560939390, "answer_id": 56665330, "question_id": 56658947, "link": "https://stackoverflow.com/questions/56658947/is-there-any-way-that-i-could-customize-http-response-status-in-golang/56665330#56665330", "title": "Is there any way that I could customize HTTP response status in Golang?", "body": "<p>This functionality is handled in <a href=\"https://golang.org/src/net/http/server.go#L1482\" rel=\"nofollow noreferrer\">net/http/server.go</a>:</p>\n\n<pre><code>func writeStatusLine(bw *bufio.Writer, is11 bool, code int, scratch []byte) {\n    if is11 {\n        bw.WriteString(\"HTTP/1.1 \")\n    } else {\n        bw.WriteString(\"HTTP/1.0 \")\n    }\n    if text, ok := statusText[code]; ok {\n        bw.Write(strconv.AppendInt(scratch[:0], int64(code), 10))\n        bw.WriteByte(' ')\n        bw.WriteString(text)\n        bw.WriteString(\"\\r\\n\")\n    } else {\n        // don't worry about performance\n        fmt.Fprintf(bw, \"%03d status code %d\\r\\n\", code, code)\n    }\n}\n</code></pre>\n\n<p>From this you can see that the descriptive text comes from the standard library's internal list of status codes, the same exposed by the <a href=\"https://golang.org/pkg/net/http/#StatusText\" rel=\"nofollow noreferrer\">StatusText</a> function.</p>\n\n<p>If there is no known text, the place-holder \"status code\" is used, with no option to change this behavior.</p>\n\n<p>So with the standard library <code>http</code> package, there is no way to do what you desire.  Your options are to fork and/or re-implement this functionality in your own package, or (possibly a long-shot), submit a feature request upstream to change this functionality.</p>\n\n<p>If this functionality is really necessary for some reason, one last-ditch, desperate approach might be to write some sort of proxy, that intercepts the HTTP output, and transforms the 'status code' text for you. You might be able to do this by writing your own implementation/wrapper of <a href=\"https://golang.org/pkg/net/#Listener\" rel=\"nofollow noreferrer\"><code>net.Listener</code></a>, which you then pass to <code>http.Serve</code>. This won't be very efficient, and is highly discouraged, unless you have absolutely no other option.</p>\n"}], "owner": {"reputation": 317, "user_id": 7172191, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/noKs5.jpg?s=128&g=1", "display_name": "Juan Chan", "link": "https://stackoverflow.com/users/7172191/juan-chan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 791, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1560939692, "creation_date": 1560907957, "last_edit_date": 1560938112, "question_id": 56658947, "link": "https://stackoverflow.com/questions/56658947/is-there-any-way-that-i-could-customize-http-response-status-in-golang", "title": "Is there any way that I could customize HTTP response status in Golang?", "body": "<p>I need to customize the HTTP Status in a handler in my Web Server, but I found that golang doesn't seem to support completely custom HTTP Response..\nFor example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>w.WriteHeader(999)\n</code></pre>\n\n<p>here is the <code>curl</code> result:</p>\n\n<pre><code>$ curl -vk -i localhost:9898/hello\n\n*   Trying ::1...\n* TCP_NODELAY set\n* Connected to localhost (::1) port 9898 (#0)\n&gt; GET /hello HTTP/1.1\n&gt; Host: localhost:9898\n&gt; User-Agent: curl/7.54.0\n&gt; Accept: */*\n&gt; \n&lt; HTTP/1.1 999 status code 999\nHTTP/1.1 999 status code 999\n&lt; Date: Wed, 19 Jun 2019 02:01:09 GMT\nDate: Wed, 19 Jun 2019 02:01:09 GMT\n&lt; Content-Length: 0\nContent-Length: 0\n</code></pre>\n\n<p>the <code>status code</code> in the result seems couldn't be modified.. but, I want to define my own status, like <code>Bad Request: xxx</code>.</p>\n\n<p>Is there any good ideas? Thanks a lot!</p>\n"}, {"tags": ["pointers", "go"], "answers": [{"comments": [{"owner": {"reputation": 139, "user_id": 3640939, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/01e4d1425efcea4982f1cae08f71dc74?s=128&d=identicon&r=PG&f=1", "display_name": "Shailendra Soni", "link": "https://stackoverflow.com/users/3640939/shailendra-soni"}, "edited": false, "score": 0, "creation_date": 1560910373, "post_id": 56658560, "comment_id": 99887894, "body": "Thanks for detail answer. Understood point#1 but is there any way to refer latest value whenever defer function executed? I have updated my question, I have used pointer to pass into defer function. @eugenioy is this right way?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 139, "user_id": 3640939, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/01e4d1425efcea4982f1cae08f71dc74?s=128&d=identicon&r=PG&f=1", "display_name": "Shailendra Soni", "link": "https://stackoverflow.com/users/3640939/shailendra-soni"}, "edited": false, "score": 1, "creation_date": 1560921532, "post_id": 56658560, "comment_id": 99890029, "body": "@ShailendraSoni, &quot;is there any way to refer latest value whenever defer function executed?&quot; Yes, with a closure: <a href=\"https://play.golang.org/p/c39FKEePLa4\" rel=\"nofollow noreferrer\">play.golang.org/p/c39FKEePLa4</a>"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 2, "last_activity_date": 1560903482, "creation_date": 1560903482, "answer_id": 56658560, "question_id": 56658433, "link": "https://stackoverflow.com/questions/56658433/pointer-understanding/56658560#56658560", "title": "Pointer Understanding", "body": "<blockquote>\n  <ol>\n  <li>Why is it display with '&amp;' in the actual output, where it suppose to print address of the variable</li>\n  </ol>\n</blockquote>\n\n<p>Take a look at the format options here:</p>\n\n<p><a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/fmt/</a></p>\n\n<p><code>Println</code> is using the default <code>%v</code>, if you want to print the value of the pointer, you can use the <code>%p</code> format, like so:</p>\n\n<pre><code>fmt.Printf(\"Pointer-Closing %p\\n\", xp2)\n</code></pre>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>Why defer function is not reflecting latest value of the 'xp2' variable ?</li>\n  </ol>\n</blockquote>\n\n<p>Take a look here:</p>\n\n<p><a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow noreferrer\">https://blog.golang.org/defer-panic-and-recover</a></p>\n\n<pre><code>A deferred function's arguments are evaluated when the defer statement is evaluated.\n</code></pre>\n\n<p>So at the time the <code>defer</code> is evaluated there, the pointer is referencing the first object, so that output is as expected.</p>\n"}], "owner": {"reputation": 139, "user_id": 3640939, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/01e4d1425efcea4982f1cae08f71dc74?s=128&d=identicon&r=PG&f=1", "display_name": "Shailendra Soni", "link": "https://stackoverflow.com/users/3640939/shailendra-soni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "closed_date": 1560932042, "answer_count": 1, "score": 0, "last_activity_date": 1560926249, "creation_date": 1560902058, "last_edit_date": 1560915570, "question_id": 56658433, "link": "https://stackoverflow.com/questions/56658433/pointer-understanding", "closed_reason": "Duplicate", "title": "Pointer Understanding", "body": "<p>I have struct type and referring address of the variable, but it does not reflect latest value of the variable in the <code>defer</code> function.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type XY struct {\n    S string\n}\n\nfunc CloseP(x *XY) {\n    if x != nil {\n        fmt.Println(\"Pointer-Closing\", x.S)\n    }\n}\n\nfunc main() {\n\n    xp2 := &amp;XY{\"Pointer-X2 First\"}\n    fmt.Println(xp2)\n    defer CloseP( xp2  )\n    xp2 = &amp;XY{\"Pointer-X2 Second\"}\n    fmt.Println(xp2)\n\n}\n\nOutput\n\n&amp;{Pointer-X2 First}\n&amp;{Pointer-X2 Second}\nPointer-Closing Pointer-X2 First\n\n</code></pre>\n\n<p>Expected Output</p>\n\n<pre><code>0xc000086018\n0xc000086018\nPointer-Closing Pointer-X2 Second\n</code></pre>\n\n<p>My questions are:</p>\n\n<blockquote>\n  <ol>\n  <li>Why is it display with '&amp;' in the actual output, where it suppose to print address of the variable. </li>\n  <li>Why defer function is not reflecting latest value of the 'xp2' variable ?</li>\n  </ol>\n</blockquote>\n\n<p>So for the <strong>point 2</strong>- I have implemented below function. Can someone tell me is this best way to resolve this problem. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    xp2 := XY{\"Pointer-X2 First\"}\n    defer CloseP( &amp;xp2  )\n    xp2 = XY{\"Pointer-X2 Second\"}\n}\n</code></pre>\n\n<p><strong>Output is</strong></p>\n\n<pre><code>Pointer-Closing Pointer-X2 Second\n</code></pre>\n"}, {"tags": ["pointers", "go", "interface"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 5, "creation_date": 1560897925, "post_id": 56657851, "comment_id": 99885657, "body": "The <code>Subscription</code> function is defined to return <code>*Subscription</code>, but in your interface it returns <code>Receiver</code>. The types must be the same. It doesn&#39;t matter that <code>*Subscription</code> implements the <code>Receiver</code> interface. The types must match exactly."}, {"owner": {"reputation": 172, "user_id": 4849325, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4f9a939fa9a3fdf68157e41c2f722163?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Kopczynski", "link": "https://stackoverflow.com/users/4849325/jacob-kopczynski"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1560898143, "post_id": 56657851, "comment_id": 99885704, "body": "So it&#39;s impossible to do this, then?"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1560898280, "post_id": 56657851, "comment_id": 99885732, "body": "If you define <code>Subscription</code> in your interface to return <code>*pubiub.Subscription</code> it will work."}, {"owner": {"reputation": 172, "user_id": 4849325, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4f9a939fa9a3fdf68157e41c2f722163?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Kopczynski", "link": "https://stackoverflow.com/users/4849325/jacob-kopczynski"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1560898390, "post_id": 56657851, "comment_id": 99885747, "body": "That wouldn&#39;t accomplish the goal of making this be mockable for testing purposes. So it&#39;s impossible."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560898984, "post_id": 56657851, "comment_id": 99885884, "body": "You can accomplish this, but it requires using custom-defined types that wrap all returned types. So you&#39;d have to create a new type that wraps <code>*pubsub.Subscription</code>, and use that throughout your app, and a custom wrapper even for your non-test code. Yes, that&#39;s a big pain. It&#39;s often not worth it."}, {"owner": {"reputation": 172, "user_id": 4849325, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4f9a939fa9a3fdf68157e41c2f722163?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Kopczynski", "link": "https://stackoverflow.com/users/4849325/jacob-kopczynski"}, "edited": false, "score": 0, "creation_date": 1560902403, "post_id": 56657851, "comment_id": 99886506, "body": "No, I cannot do that. This is a library function; I have no ability to modify the return type of <code>Client.Subscription</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560927483, "post_id": 56657851, "comment_id": 99892287, "body": "I know it&#39;s a library function. That&#39;s why I said you need to wrap the function and the type. Specifically, you need to wrap the <code>Client</code> type here. See my answer below for better elaboration on what I mean."}], "answers": [{"tags": [], "owner": {"reputation": 172, "user_id": 4849325, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4f9a939fa9a3fdf68157e41c2f722163?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Kopczynski", "link": "https://stackoverflow.com/users/4849325/jacob-kopczynski"}, "is_accepted": true, "score": -1, "last_activity_date": 1561666165, "last_edit_date": 1561666165, "creation_date": 1560898602, "answer_id": 56658058, "question_id": 56657851, "link": "https://stackoverflow.com/questions/56657851/create-interface-wrapping-existing-types-with-pointer-receiver-methods/56658058#56658058", "title": "Create interface wrapping existing types with pointer-receiver methods", "body": "<p>It can't be done.</p>\n\n<p>When defining the type signature of a method on an interface, it must match exactly. <code>func (c *Client) Subscription(id string) *Subscription</code> returns a <code>*Subscription</code>, and a <code>*Subscription</code> is a valid <code>Receiver</code>, but it does not count as conforming to the interface method <code>Subscription(string) Receiver</code>. Go requires precise matching for function signatures, not the duck-typing style that it usually uses for interfaces.</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1560927424, "creation_date": 1560927424, "answer_id": 56661736, "question_id": 56657851, "link": "https://stackoverflow.com/questions/56657851/create-interface-wrapping-existing-types-with-pointer-receiver-methods/56661736#56661736", "title": "Create interface wrapping existing types with pointer-receiver methods", "body": "<p>First, for most uses, using the <a href=\"https://godoc.org/cloud.google.com/go/pubsub/pstest\" rel=\"nofollow noreferrer\"><code>ptest</code></a> package is probably a much easier approach for testing pubsub.  But of course, your specific question can apply to any library, and the below approach can be useful for many things, not just mocking <code>pubsub</code>.</p>\n\n<hr>\n\n<p>Your broader goal of using interfaces to mock a library like this, is doable. But it is complicated when the library you wish to mock out returns concrete types that you cannot mock (probably due to unreported fields). The approach to be taken is much more involved than is often worth it, as there may be easier ways to test your code.</p>\n\n<p>But if you're intent on doing this, the approach you must take is to not wrap the entire package in interfaces, not just the specific methods you wish to mock.</p>\n\n<p>You would need to wrap any types that you wish to mock which are returned by or accepted by your interface, too.  This usually means you also need to modify your production code (not just your test code), so this can sometimes be a deal-breaker for existing code bases.</p>\n\n<p>Where I have usually done this before is when mocking something like the standard library's sql driver, but the same approach can be applied here. In essence, you would need to create a wrapper package for your <code>pubsub</code> library, which you use even in your production code. Again, this can be quite intrusive on existing codebases, but for the sake of illustration. Using your defined interfaces:</p>\n\n<pre><code>package mypubsub\n\nimport \"cloud.google.com/go/pubsub\"\n\ntype Receiver interface {\n    Recieve(context.Context, func(context.Context, *pubsub.Message) error)\n}\n\ntype SubscriptionMaker interface {\n    Subscription(string) Receiver\n}\n</code></pre>\n\n<p>You can then wrap the default implementation, for use in production code:</p>\n\n<pre><code>// defaultClient wraps the default pubsub Client functionality.\ntype defaultClient struct {\n    *pubsub.Client\n}\n\nfunc (d defaultImplementation) Subscription(name string) Receiver {\n    return d.Client.Subscription()\n}\n</code></pre>\n\n<p>Naturally, you'd need to expand this package to wrap most or all of the <code>pubsub</code> package you're using. This can be a bit daunting.</p>\n\n<p>But once you've done that, then use your <code>mypubsub</code> package everywhere in your code, instead of directly depending on the <code>pubsub</code> package. And now you can easily swap out a mock implementation anywhere you need for testing.</p>\n"}], "owner": {"reputation": 172, "user_id": 4849325, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4f9a939fa9a3fdf68157e41c2f722163?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Kopczynski", "link": "https://stackoverflow.com/users/4849325/jacob-kopczynski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 56658058, "answer_count": 2, "score": -4, "last_activity_date": 1561666165, "creation_date": 1560897120, "question_id": 56657851, "link": "https://stackoverflow.com/questions/56657851/create-interface-wrapping-existing-types-with-pointer-receiver-methods", "title": "Create interface wrapping existing types with pointer-receiver methods", "body": "<p>I need to test an app which uses Google Cloud Pubsub, and so must wrap its types <code>pubsub.Client</code> and <code>pubsub.Subscriber</code> for testing purposes. However, despite several attempts I can't get an interface around them which compiles.</p>\n\n<p>The definitions of the methods I'm trying to wrap are:</p>\n\n<pre><code>func (s *Subscription) Receive(\n    ctx context.Context, f func(context.Context, *Message)) error\n\nfunc (c *Client) Subscription(id string) *Subscription\n</code></pre>\n\n<p>Here is the current code. The <code>Receiver</code> interface (wrapper around <code>Subscriber</code>) seems to work, but I suspect it may need to change in order to fix <code>SubscriptionMaker</code>, so I've include both.</p>\n\n<p>Note: I've tried several variations of where to reference and dereference pointers, so please don't tell me to change that unless you have an explanation of why your suggested configuration is the correct one or you've personally verified it compiles.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"context\"\n\n    \"cloud.google.com/go/pubsub\"\n)\n\ntype Receiver interface {\n    Receive(context.Context, func(ctx context.Context, msg *pubsub.Message)) (err error)\n}\n\n// Pubsub subscriptions implement Receiver\nvar _ Receiver = &amp;pubsub.Subscription{}\n\ntype SubscriptionMaker interface {\n    Subscription(name string) (s Receiver)\n}\n\n// Pubsub clients implement SubscriptionMaker\nvar _ SubscriptionMaker = pubsub.Client{}\n</code></pre>\n\n<p>Current error message:</p>\n\n<pre><code>common_types.go:21:5: cannot use \"cloud.google.com/go/pubsub\".Client literal (type \"cloud.google.com/go/pubsub\".Client) as type SubscriptionMaker in assignment:\n    \"cloud.google.com/go/pubsub\".Client does not implement SubscriptionMaker (wrong type for Subscription method)\n        have Subscription(string) *\"cloud.google.com/go/pubsub\".Subscription\n        want Subscription(string) Receiver\n</code></pre>\n"}, {"tags": ["go", "buffer"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1560898635, "post_id": 56657755, "comment_id": 99885808, "body": "Just use an index expression. <code>b[0]</code> It&#39;s hard to get simpler than that. Is there some non-obvious requirement I&#39;m missing?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1560950702, "post_id": 56657755, "comment_id": 99905200, "body": "<a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"nofollow noreferrer\"><code>byte</code> is just an alias for <code>uint8</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 5, "last_activity_date": 1560897400, "last_edit_date": 1560897400, "creation_date": 1560896887, "answer_id": 56657825, "question_id": 56657755, "link": "https://stackoverflow.com/questions/56657755/read-uint8-from-byte-without-creating-a-bytes-buffer/56657825#56657825", "title": "Read uint8 from []byte without creating a bytes.Buffer", "body": "<p>Us an <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"noreferrer\">index expression</a> to get an single <code>uint8</code> from a slice.</p>\n\n<pre><code>len := binary.BigEndian.Uint32(b[:4])\nid := b[4]  // &lt;-- index expression\n</code></pre>\n\n<p>Note that <code>byte</code> is an <a href=\"https://golang.org/ref/spec#Alias_declarations\" rel=\"noreferrer\">alias</a> for <code>uint8</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1119, "user_id": 9406420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4afd4d026590218c0aff8389c0ec7334?s=128&d=identicon&r=PG", "display_name": "Ritwik", "link": "https://stackoverflow.com/users/9406420/ritwik"}, "is_accepted": false, "score": 0, "last_activity_date": 1560897257, "creation_date": 1560897257, "answer_id": 56657868, "question_id": 56657755, "link": "https://stackoverflow.com/questions/56657755/read-uint8-from-byte-without-creating-a-bytes-buffer/56657868#56657868", "title": "Read uint8 from []byte without creating a bytes.Buffer", "body": "<p>Here's an elegant way that I found,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var len uint32\nvar id uint8\nbinary.Read(buf, binary.BigEndian, &amp;len)\nbinary.Read(buf, binary.BigEndian, &amp;id)\n\n// this method doesn't need you to create a buffer for each value read\n</code></pre>\n"}], "owner": {"reputation": 1119, "user_id": 9406420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4afd4d026590218c0aff8389c0ec7334?s=128&d=identicon&r=PG", "display_name": "Ritwik", "link": "https://stackoverflow.com/users/9406420/ritwik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1560898457, "creation_date": 1560896300, "last_edit_date": 1560898457, "question_id": 56657755, "link": "https://stackoverflow.com/questions/56657755/read-uint8-from-byte-without-creating-a-bytes-buffer", "title": "Read uint8 from []byte without creating a bytes.Buffer", "body": "<p>How to read a <code>unit8</code> from <code>[]byte</code> without creating a <code>bytes.Buffer</code>. The value has been written to the buffer like this,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>buf := new(bytes.Buffer)\nbinary.Write(buf, binary.BigEndian, uint32(1))\nbinary.Write(buf, binary.BigEndian, uint8(1))\nb := buf.Bytes()\n</code></pre>\n\n<p>While decoding, it can easily be done for <code>uint32</code>, like the following...</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>len := binary.BigEndian.Uint32(b[:4])\n</code></pre>\n\n<p>But for the <code>uint8</code>, the only way to retrieve the value that I could come up with, is to create a buffer and then read the first byte,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>buf := new(bytes.Buffer)\n_, err := buf.Write(b[4:5])\n// error handling ...\nid = buf.ReadByte()\n</code></pre>\n\n<p>It seems like there's no method in the <code>encoding/binary</code> pkg for <code>uint8</code> value retrieval. And I guess there's probably some good reason behind it.</p>\n\n<p>Question: Is there any other way to read <code>uint8</code> from that <code>[]byte</code> without creating a <code>Buffer</code>??</p>\n"}, {"tags": ["git", "go", "semantic-versioning", "go-modules"], "comments": [{"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 1, "creation_date": 1560893552, "post_id": 56656862, "comment_id": 99884548, "body": "The issue is tracked here <a href=\"https://github.com/golang/go/issues/29228\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/29228</a>."}], "answers": [{"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": false, "score": 1, "last_activity_date": 1566235617, "creation_date": 1566235617, "answer_id": 57561408, "question_id": 56656862, "link": "https://stackoverflow.com/questions/56656862/how-to-build-go-module-with-a-semantic-version/57561408#57561408", "title": "How to&#160;build Go Module with a semantic version?", "body": "<p>The <code>go</code> command does not query version control to determine whether your repository is a pristine checkout of a semantic version (that's <a href=\"https://golang.org/issue/29228\" rel=\"nofollow noreferrer\">https://golang.org/issue/29228</a>).</p>\n\n<p>If you build the binary with some <em>other</em> module as the main module, then the <code>go</code> command should know which version of <em>your</em> module is in use and embed that in the resulting binary:</p>\n\n<p><code>go.mod</code>:</p>\n\n<pre><code>module example.com/other\n\nrequire test.org/simple v0.1.0\n</code></pre>\n\n<hr>\n\n<pre><code>go build test.org/simple &amp;&amp; ./simple\n</code></pre>\n"}], "owner": {"reputation": 12790, "user_id": 1767106, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0065eca502a4a798607e38cefc1ca2ed?s=128&d=identicon&r=PG", "display_name": "clay", "link": "https://stackoverflow.com/users/1767106/clay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566235617, "creation_date": 1560891068, "question_id": 56656862, "link": "https://stackoverflow.com/questions/56656862/how-to-build-go-module-with-a-semantic-version", "title": "How to&#160;build Go Module with a semantic version?", "body": "<p>Here are the bash steps to setup a new minimal Go module project with a git repo, commit it, and tag it with annotated semantic version tag:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>mkdir gotest\ncd gotest\n\ngit init\n\ngo mod init test.org/simple\n\ncat &lt;&lt;EOT &gt;&gt; app.go\npackage main\n\nimport (\n    \"fmt\"\n    \"runtime/debug\"\n)\n\nfunc main() {\n    fmt.Println(\"hello world\")\n\n    if bi, ok := debug.ReadBuildInfo(); ok {\n        fmt.Printf(\"version=%v. sum=%v\\n\", bi.Main.Version, bi.Main.Sum)\n    } else {\n        fmt.Println(\"Failed to get build info\")\n    }\n}\nEOT\n\necho \"simple\" &gt;&gt; .gitignore\n\ngit add go.mod app.go .gitignore\ngit commit -am \"initial commit\"\ngit tag -am \"initial semantic version\" v0.1.0\n</code></pre>\n\n<p>Quickly verify that it's tagged correctly:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>git tag -n\ngit describe --dirty\n</code></pre>\n\n<p>Build and run:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go build\n./simple\n</code></pre>\n\n<p>That produces:</p>\n\n<pre><code>hello world\nversion=(devel). sum=\n</code></pre>\n\n<p>I was hoping to see the semantic version I tagged the repository with. Instead I got the dummy placeholder version. What is wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1560890698, "post_id": 56656720, "comment_id": 99883507, "body": "If you have only these types of unit strings, you could just write the parser yourself. Easier than fiddling with some lib."}, {"owner": {"reputation": 11, "user_id": 1821816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df9eb12d9423d974f99a5f5c5df71826?s=128&d=identicon&r=PG", "display_name": "BerBrit", "link": "https://stackoverflow.com/users/1821816/berbrit"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1560890901, "post_id": 56656720, "comment_id": 99883598, "body": "@RickyA no, I have the full number of length units."}], "answers": [{"tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": false, "score": 0, "last_activity_date": 1560926755, "last_edit_date": 1560926755, "creation_date": 1560897706, "answer_id": 56657936, "question_id": 56656720, "link": "https://stackoverflow.com/questions/56656720/how-to-convert-string-210-0n-to-float/56657936#56657936", "title": "How to convert string &quot;210.0n&quot; to float", "body": "<p>You can write this in a simple switch case yourself. There is no need for a library.</p>\n\n<pre><code>    var str = \"100k\"\n\n    mFloat, err := strconv.ParseFloat(str[:len(str)-1], 64)\n    if err != nil{\n        //handle error\n    }\n\n    switch string(str[len(str)-1]){\n    case \"k\":\n        mFloat = mFloat * 1000\n        fmt.Printf(\"%e\", )  \n    case \"m\":\n        mFloat = mFloat * 1000000\n        fmt.Printf(\"%e\", mFloat * 1000000)      \n    // etc ....\n    }   \n\n    return mFloat\n</code></pre>\n\n<p>Different suffixes: <a href=\"https://www.mathsisfun.com/metric-numbers.html\" rel=\"nofollow noreferrer\">https://www.mathsisfun.com/metric-numbers.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 1821816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df9eb12d9423d974f99a5f5c5df71826?s=128&d=identicon&r=PG", "display_name": "BerBrit", "link": "https://stackoverflow.com/users/1821816/berbrit"}, "is_accepted": false, "score": 0, "last_activity_date": 1560956309, "creation_date": 1560956309, "answer_id": 56670695, "question_id": 56656720, "link": "https://stackoverflow.com/questions/56656720/how-to-convert-string-210-0n-to-float/56670695#56670695", "title": "How to convert string &quot;210.0n&quot; to float", "body": "<p>If this answer will help somebody then I have found this package on Github <a href=\"https://github.com/dustin/go-humanize\" rel=\"nofollow noreferrer\">github.com/dustin/go-humanize</a> which contains the necessary code to translate such kind of strings like \"240n\" \"1p\" and etc to the float.\nIt contains even more possibilities for data converting. Hope it will help some newbies who work with floats in Go.</p>\n"}], "owner": {"reputation": 11, "user_id": 1821816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df9eb12d9423d974f99a5f5c5df71826?s=128&d=identicon&r=PG", "display_name": "BerBrit", "link": "https://stackoverflow.com/users/1821816/berbrit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1560956309, "creation_date": 1560890329, "last_edit_date": 1560890837, "question_id": 56656720, "link": "https://stackoverflow.com/questions/56656720/how-to-convert-string-210-0n-to-float", "title": "How to convert string &quot;210.0n&quot; to float", "body": "<p>I have the string value in the following format:\n\"210.0n\" and I need to compare it with the value \"2.1e-07\". Direct comparison, of course, will fail.</p>\n\n<p>Is there any way how to convert such strings like this \"210.0n\", \"0.7m\", \"10.0K\" (with units metrics) to the normal float values? Maybe dedicated Go module is available? I can't find it.</p>\n"}, {"tags": ["go", "jetbrains-ide", "goland"], "comments": [{"owner": {"reputation": 1939, "user_id": 3944680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07f1f015cca3de72971e45d5dc49e440?s=128&d=identicon&r=PG&f=1", "display_name": "Silvio Lucas", "link": "https://stackoverflow.com/users/3944680/silvio-lucas"}, "edited": false, "score": 0, "creation_date": 1560914704, "post_id": 56655556, "comment_id": 99888693, "body": "Joe, do you have a main func declared in your code? Or even a main package declared as well? Can you share some code for us to see what&#39;s going on?"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12155537, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-WvdzbOmxWB4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re8om94I4moQ8HZeFEYXkL3BdbcJA/photo.jpg?sz=128", "display_name": "Brandon", "link": "https://stackoverflow.com/users/12155537/brandon"}, "is_accepted": false, "score": 0, "last_activity_date": 1570048472, "creation_date": 1570048472, "answer_id": 58209005, "question_id": 56655556, "link": "https://stackoverflow.com/questions/56655556/how-to-proper-configure-go-build-and-what-are-the-differences-between-run-kind/58209005#58209005", "title": "How to proper configure &quot;Go Build&quot; and what are the differences between Run Kind", "body": "<p>I believe what you need to do is simply enable go module integration. Find the setting at <code>File | Settings | Go | Go Modules (vgo)</code>. In that panel also make sure <code>Vgo executable</code> is set to your Project SDK. If it's still not working, enabling the vendor experiment option at <code>File | Settings | Go | Build Tags &amp; Vendoring</code> may help. Be sure your project specific settings aren't overriding these values as well.</p>\n"}], "owner": {"reputation": 37, "user_id": 6632218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ac46c0813525674001dde2e955d20d?s=128&d=identicon&r=PG&f=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/6632218/joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 583, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1570048472, "creation_date": 1560884808, "last_edit_date": 1560944098, "question_id": 56655556, "link": "https://stackoverflow.com/questions/56655556/how-to-proper-configure-go-build-and-what-are-the-differences-between-run-kind", "title": "How to proper configure &quot;Go Build&quot; and what are the differences between Run Kind", "body": "<p>I am new to Go language and also to the IDE GoLand so I am sorry if this is very basic.</p>\n\n<p>I am currently trying to configure Run Kind for package for all my files, the problem is I cannot seem to get the configuration straight, I get this error:</p>\n\n<blockquote>\n  <p>\"can't load package: package Course: unknown import path \"Course\": cannot find module providing package Course\"</p>\n</blockquote>\n\n<p>My GOROOT is the standard in <code>C:</code> and GOPATH is in my directory of workplace with the folders: <code>scr</code>, <code>bin</code> and <code>pkg</code>. Inside <code>scr</code> is course folder with training files for Go.</p>\n\n<p>I have tried to google every option on how to properly configure the go Build configuration, I might be missing to install packages not sure to be honest, I have installed the gotools and everything from golang.org, and tried following the guide from GoLand in JetBrains but no luck in properly configuring package, or Dir options.</p>\n\n<p>I can create a go Build for each file using Run Kind: File, but I want to create one for all the files inside the folder not one each time I want to run one.</p>\n\n<p>Also I have no idea what <code>-i</code> in Go tool arguments means.</p>\n"}, {"tags": ["unit-testing", "go", "faker"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1560880842, "post_id": 56654573, "comment_id": 99879279, "body": "Go suppresses the stdout of passing tests, otherwise a passing run would be incredibly noisy. Use <code>-v</code> to see the full output. Or just look at <code>go help test</code> and <code>go help testflag</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11666102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4da2aa1158093fb6291ff0a60015f59c?s=128&d=identicon&r=PG&f=1", "display_name": "epoX", "link": "https://stackoverflow.com/users/11666102/epox"}, "edited": false, "score": 0, "creation_date": 1560882149, "post_id": 56654665, "comment_id": 99879842, "body": "my test passes and says OK however I dont know where to see the PrintLn to see if its generating a username"}], "tags": [], "owner": {"reputation": 159, "user_id": 3667168, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/4jvCp.jpg?s=128&g=1", "display_name": "CorlinP", "link": "https://stackoverflow.com/users/3667168/corlinp"}, "is_accepted": false, "score": 1, "last_activity_date": 1560880743, "creation_date": 1560880743, "answer_id": 56654665, "question_id": 56654573, "link": "https://stackoverflow.com/questions/56654573/how-to-implement-a-faker-into-my-go-test/56654665#56654665", "title": "How to implement a faker into my go test?", "body": "<p>A test will say 'ok' if it has passed. A failing test will show the output. A quick way of making that happen is to add <code>t.Fail()</code> at the end of your Go test.</p>\n"}], "owner": {"reputation": 1, "user_id": 11666102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4da2aa1158093fb6291ff0a60015f59c?s=128&d=identicon&r=PG&f=1", "display_name": "epoX", "link": "https://stackoverflow.com/users/11666102/epox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1560882719, "creation_date": 1560880382, "last_edit_date": 1560882719, "question_id": 56654573, "link": "https://stackoverflow.com/questions/56654573/how-to-implement-a-faker-into-my-go-test", "title": "How to implement a faker into my go test?", "body": "<p>I am trying to learn Go and write my first test. I would like to figure out how to implement a faker to test CRUD on terraform. </p>\n\n<p>I've figured out how to import faker and created the variables to use. </p>\n\n<p>I tried to fmt.Println to see if it generates, but where do I see the Println if it's a test. It does not print when I do go test. </p>\n\n<pre><code>func testCheckTritonUserDelete(s *terraform.State) error {\n    fmt.Println(\"INside testCheckTritonUserDelete\")\n    fmt.Println(fake.UserName())\n    return nil\n</code></pre>\n\n<p>// this is the function in which I want to Println</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 715, "user_id": 8716187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9d379e724336936aa82cb81f348ef72?s=128&d=identicon&r=PG&f=1", "display_name": "Wookies-Will-Code", "link": "https://stackoverflow.com/users/8716187/wookies-will-code"}, "edited": false, "score": 0, "creation_date": 1560883920, "post_id": 56653439, "comment_id": 99880642, "body": "What do you want the GoLang code to be?  A match to Authy?"}, {"owner": {"reputation": 49, "user_id": 11664727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0619dc94957db1834c6a36b4371426fd?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian Blaga", "link": "https://stackoverflow.com/users/11664727/lucian-blaga"}, "reply_to_user": {"reputation": 715, "user_id": 8716187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9d379e724336936aa82cb81f348ef72?s=128&d=identicon&r=PG&f=1", "display_name": "Wookies-Will-Code", "link": "https://stackoverflow.com/users/8716187/wookies-will-code"}, "edited": false, "score": 0, "creation_date": 1560885548, "post_id": 56653439, "comment_id": 99881338, "body": "@Wookies-Will-Code yes i want to match with Authy desktop"}], "owner": {"reputation": 49, "user_id": 11664727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0619dc94957db1834c6a36b4371426fd?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian Blaga", "link": "https://stackoverflow.com/users/11664727/lucian-blaga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 268, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560911570, "creation_date": 1560875282, "last_edit_date": 1560911570, "question_id": 56653439, "link": "https://stackoverflow.com/questions/56653439/generate-otp-code-same-like-authy-desktop", "title": "generate otp code same like authy desktop", "body": "<p>I try to generate totp code using this library same like authy.com desktop application. this is my current code :</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n\n    \"github.com/pquerna/otp/totp\"\n\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc promptForPasscode() string {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Enter Passcode: \")\n    text, _ := reader.ReadString('\\n')\n    return text\n}\n\nfunc main() {\n\n    keySecret := \"NK4KFDHUGRGMFKFEWRJ5EEOV6FT2IAKE\"\n\n    coded, _ := totp.GenerateCode(keySecret, time.Now().UTC())\n    fmt.Println(\"code :\", coded)\n\n    fmt.Println(\"Validating TOTP...\")\n    // Now Validate that the user's successfully added the passcode.\n    passcode := promptForPasscode()\n    valid := totp.Validate(passcode, keySecret)\n    if valid {\n        println(\"Valid passcode!\")\n        os.Exit(0)\n    } else {\n        println(\"Invalid passocde!\")\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>The code is working, my problem is, the code generated by golang application is not the same like authy desktop application, what is wrong ?</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1560875674, "post_id": 56653423, "comment_id": 99876953, "body": "That&#39;s documented and <i>intended</i> behaviour when using <i>structs</i>, you can use a map for properties that are affected by such a strange (IMO) design decision. <a href=\"https://gorm.io/docs/update.html#Update-Changed-Fields\" rel=\"nofollow noreferrer\">gorm.io/docs/update.html#Update-Changed-Fields</a> (note the comments)"}, {"owner": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1560875938, "post_id": 56653423, "comment_id": 99877082, "body": "@mkopriva ohhh, Thanks, just noticed it. It says <code>false are blank values of their types</code> on struct usage"}], "answers": [{"tags": [], "owner": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "is_accepted": true, "score": 12, "last_activity_date": 1604554270, "last_edit_date": 1604554270, "creation_date": 1560876511, "answer_id": 56653723, "question_id": 56653423, "link": "https://stackoverflow.com/questions/56653423/gorm-doesnt-update-boolean-field-to-false/56653723#56653723", "title": "GORM doesnt update boolean field to false", "body": "<p>As @mkopriva mentioned, by GORM <a href=\"https://gorm.io/docs/update.html#Updates-multiple-columns\" rel=\"nofollow noreferrer\">Documentation</a></p>\n<blockquote>\n<pre class=\"lang-golang prettyprint-override\"><code>// Update attributes with `struct`, will only update non-zero fields\ndb.Model(&amp;user).Updates(User{Name: &quot;hello&quot;, Age: 18, Active: false})\n// UPDATE users SET name='hello', age=18, updated_at = '2013-11-17 &gt; 21:34:10' WHERE id = 111;\n\n// Update attributes with `map`\ndb.Model(&amp;user).Updates(map[string]interface{}{&quot;name&quot;: &quot;hello&quot;, &quot;age&quot;: 18, &quot;actived&quot;: false})\n// UPDATE users SET name='hello', age=18, actived=false, updated_at='2013-11-17 21:34:10' WHERE id=111;\n</code></pre>\n<blockquote>\n<p><strong>NOTE</strong> When update with struct, GORM will only update non-zero fields, you might want to use <code>map</code> to update attributes or use <code>Select</code> to specify fields to update</p>\n</blockquote>\n</blockquote>\n<p><strong>Solved:</strong></p>\n<pre><code>if err := service.DB.Model(&amp;attendee).Updates(map[string]interface{}{\n    &quot;Email&quot;:          attendee.Email,\n    &quot;ShowDirectory&quot;: false\n}).Error; err != nil {\n    return Attendee{}, err\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "edited": false, "score": 0, "creation_date": 1565880381, "post_id": 57506458, "comment_id": 101491098, "body": "check documentation, it says <code>false are blank values of their types</code> and blank value is <code>false</code> always"}, {"owner": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "edited": false, "score": 0, "creation_date": 1565880401, "post_id": 57506458, "comment_id": 101491111, "body": "Ill try next time, when i face it :)"}], "tags": [], "owner": {"reputation": 39, "user_id": 8794011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/597e34df995b2e2526e9fdd271e5cdf0?s=128&d=identicon&r=PG&f=1", "display_name": "DragoRoff", "link": "https://stackoverflow.com/users/8794011/dragoroff"}, "is_accepted": false, "score": 1, "last_activity_date": 1565855486, "creation_date": 1565855486, "answer_id": 57506458, "question_id": 56653423, "link": "https://stackoverflow.com/questions/56653423/gorm-doesnt-update-boolean-field-to-false/57506458#57506458", "title": "GORM doesnt update boolean field to false", "body": "<p>You should write gorm type in your struct, something like this:\n<code>gorm:\"type:boolean; column:column_name\"</code>\nand for sure it will work!</p>\n"}, {"tags": [], "owner": {"reputation": 1293, "user_id": 6041157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hedjS.jpg?s=128&g=1", "display_name": "pramod", "link": "https://stackoverflow.com/users/6041157/pramod"}, "is_accepted": false, "score": 4, "last_activity_date": 1593764031, "creation_date": 1593764031, "answer_id": 62711228, "question_id": 56653423, "link": "https://stackoverflow.com/questions/56653423/gorm-doesnt-update-boolean-field-to-false/62711228#62711228", "title": "GORM doesnt update boolean field to false", "body": "<p>Another convenient way would be making that field as a pointer.</p>\n<p><strong>NOTE all fields having a zero value, like 0, '', false or other zero values, won\u2019t be saved into the database but will use its default value. If you want to avoid this, consider using a pointer type or scanner/valuer</strong><a href=\"https://gorm.io/docs/create.html\" rel=\"nofollow noreferrer\">Link</a></p>\n<p>In your case, the model would look like:</p>\n<pre><code>type Attendee struct {\nID             uint   `gorm:&quot;primary_key&quot; gorm:&quot;AUTO_INCREMENT&quot; json:&quot;id,omitempty&quot; mapstructure:&quot;id&quot; csv:&quot;ID&quot;`\nEmail          string `json:&quot;email,omitempty&quot; mapstructure:&quot;email&quot; csv:&quot;Email,required&quot;`\n\nShowDirectory  *bool   `json:&quot;show_directory,omitempty&quot; gorm:&quot;default:true&quot; mapstructure:&quot;show_directory&quot; csv:&quot;-&quot;`\n</code></pre>\n<p>}</p>\n"}, {"comments": [{"owner": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "edited": false, "score": 0, "creation_date": 1604445539, "post_id": 64660380, "comment_id": 114349449, "body": "Have you seen my answer? And whats difference between mine?"}, {"owner": {"reputation": 2703, "user_id": 9551146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vH0OA.jpg?s=128&g=1", "display_name": "Narendranath Reddy", "link": "https://stackoverflow.com/users/9551146/narendranath-reddy"}, "reply_to_user": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "edited": false, "score": 0, "creation_date": 1604462279, "post_id": 64660380, "comment_id": 114352638, "body": "You said without a clear explanation and a best example and comparison, I just added more explanation. You know I faced the same issue and landed to this question but your answer didn\u2019t help when I first saw your answer dint saw the actual difference at the first sight, trust me for few  users my answer will help and that contains good explanation so I decided to write one more answer. Thanks for the answer"}], "tags": [], "owner": {"reputation": 2703, "user_id": 9551146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vH0OA.jpg?s=128&g=1", "display_name": "Narendranath Reddy", "link": "https://stackoverflow.com/users/9551146/narendranath-reddy"}, "is_accepted": false, "score": 0, "last_activity_date": 1604396923, "creation_date": 1604396923, "answer_id": 64660380, "question_id": 56653423, "link": "https://stackoverflow.com/questions/56653423/gorm-doesnt-update-boolean-field-to-false/64660380#64660380", "title": "GORM doesnt update boolean field to false", "body": "<p><strong>Please do not use go struct for updating the non-zero fields such as boolean:false</strong></p>\n<p>The below code will not update <code>Active: false</code> in your database and gorm simply ignore</p>\n<pre><code>db.Model(&amp;user).Updates(User{Name: &quot;hello&quot;, Age: 18, Active: false})\n// UPDATE users SET name='hello', age=18, updated_at = '2013-11-17 21:34:10' WHERE id = 111;\n</code></pre>\n<p>The below code will update the <code>Active: false</code></p>\n<pre><code>db.Model(&amp;user).Updates(map[string]interface{}{&quot;name&quot;: &quot;hello&quot;, &quot;age&quot;: 18, &quot;actived&quot;: false})\n// UPDATE users SET name='hello', age=18, actived=false, updated_at='2013-11-17 21:34:10' WHERE id=111;\n</code></pre>\n<blockquote>\n<p>Use Map instead of go struct</p>\n</blockquote>\n"}], "owner": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6266, "favorite_count": 3, "accepted_answer_id": 56653723, "answer_count": 4, "score": 6, "last_activity_date": 1604554270, "creation_date": 1560875252, "last_edit_date": 1574721456, "question_id": 56653423, "link": "https://stackoverflow.com/questions/56653423/gorm-doesnt-update-boolean-field-to-false", "title": "GORM doesnt update boolean field to false", "body": "<p>On <code>updates</code> gorm doesnt update boolean type to <code>false</code>. By default it updates to <code>true</code>, but when i try to update to <code>false</code> not changes. I dont see any errors also. What can be the issue ?</p>\n\n<pre><code>type Attendee struct {\n    ID             uint   `gorm:\"primary_key\" gorm:\"AUTO_INCREMENT\" json:\"id,omitempty\" mapstructure:\"id\" csv:\"ID\"`\n    Email          string `json:\"email,omitempty\" mapstructure:\"email\" csv:\"Email,required\"`\n\n    ShowDirectory  bool   `json:\"show_directory,omitempty\" gorm:\"default:true\" mapstructure:\"show_directory\" csv:\"-\"`\n}\n\n\nvar attendee Attendee\n// JSON.unmarshal lines here for the &amp;attendee\nif err := service.DB.Model(&amp;attendee).Updates(Attendee{\n        Email:         attendee.Email,\n        ShowDirectory: false\n}).Error; err != nil {\n    return Attendee{}, err\n}\n</code></pre>\n\n<p><strong>Alternate Solution:</strong></p>\n\n<p>This works, but I am updating multiple attributies. So, I cant use this.</p>\n\n<pre><code>    att := Attendee{ID: 1}\n    service.DB.Model(&amp;att).Update(\"ShowDirectory\", false)\n</code></pre>\n"}, {"tags": ["csv", "for-loop", "go", "scope", "func"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1560874132, "post_id": 56653062, "comment_id": 99876229, "body": "Put the <code>break</code> at the end (after your <code>Print</code>s inside the loop) and you&#39;ll find that <code>record</code> is empty on the last iteration where you get <code>EOF</code>, therefore it&#39;s still empty after the loop."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 7886815, "user_type": "registered", "profile_image": "https://graph.facebook.com/306060839826231/picture?type=large", "display_name": "Partha Sarathy", "link": "https://stackoverflow.com/users/7886815/partha-sarathy"}, "edited": false, "score": 0, "creation_date": 1560876831, "post_id": 56653173, "comment_id": 99877540, "body": "Thank you so much for the detailed explanation"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1560874876, "last_edit_date": 1560874876, "creation_date": 1560874193, "answer_id": 56653173, "question_id": 56653062, "link": "https://stackoverflow.com/questions/56653062/accessing-variables-outside-of-for-loop-in-golang/56653173#56653173", "title": "Accessing variables outside of for loop in Golang", "body": "<p>Your loop breaks when <code>reader.Read()</code> returns <code>io.EOF</code>. This happens when your input is consumed.</p>\n\n<p>At the same time (when <code>io.EOF</code> is returned), the returned record will be <code>nil</code>. <a href=\"https://golang.org/pkg/encoding/csv/#Reader.Read\" rel=\"nofollow noreferrer\"><code>Reader.Read()</code></a>:</p>\n\n<blockquote>\n  <p>If there is no data left to be read, <strong>Read returns nil, io.EOF</strong>.</p>\n</blockquote>\n\n<p>So you assign <code>nil</code> to the <code>record</code> variable, the loop breaks, and you inspect the <code>record</code> variable.</p>\n\n<p>If your intent is to hold the last record, store it in a separate variable, and do not \"overwrite\" it with the last <code>nil</code> record:</p>\n\n<pre><code>var lastRecord []string\nfor {\n    record, err = reader.Read()\n    // Stop at EOF.\n    if err == io.EOF {\n        break\n    }\n    lastRecord = record\n    fmt.Printf(\"%v\", record) // works fine\n    fmt.Printf(\"%v\\n\", record[0]) // works fine too\n}\nfmt.Printf(\"%v\\n\", lastRecord) // this will be the last non-nil record\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 7886815, "user_type": "registered", "profile_image": "https://graph.facebook.com/306060839826231/picture?type=large", "display_name": "Partha Sarathy", "link": "https://stackoverflow.com/users/7886815/partha-sarathy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 819, "favorite_count": 0, "accepted_answer_id": 56653173, "answer_count": 1, "score": 0, "last_activity_date": 1560874876, "creation_date": 1560873789, "question_id": 56653062, "link": "https://stackoverflow.com/questions/56653062/accessing-variables-outside-of-for-loop-in-golang", "title": "Accessing variables outside of for loop in Golang", "body": "<p>I'm trying to read a CSV file to store the values in a variable. However, I couldn't access the variables outside of the for loop </p>\n\n<pre><code>func GetKeys(filename string) {\n    var record []string\n    var err error\n    file, err := os.Open(filename)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n    // Create a new reader.\n    reader := csv.NewReader(bufio.NewReader(file))\n    for {\n        record, err = reader.Read()\n        // Stop at EOF.\n        if err == io.EOF {\n            break\n        }\n        fmt.Printf(\"%v\", record) // works fine\n        fmt.Printf(\"%v\\n\", record[0]) // works fine too\n    }\n    fmt.Printf(\"%v\\n\", record) // returns empty slice\n}\n\nfunc main() {\n    GetKeys(\"credentials.csv\")\n}\n</code></pre>\n"}, {"tags": ["pointers", "go", "methods", "interface"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1560873867, "last_edit_date": 1560873867, "creation_date": 1560873548, "answer_id": 56652994, "question_id": 56652884, "link": "https://stackoverflow.com/questions/56652884/why-use-a-pointer-when-using-a-custom-http-handler-in-go/56652994#56652994", "title": "Why use a pointer when using a custom http.Handler in Go?", "body": "<p><a href=\"https://golang.org/pkg/net/http/#Handle\" rel=\"nofollow noreferrer\"><code>http.Handle()</code></a> expects a value (any value) that implements <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow noreferrer\"><code>http.Handler</code></a>, which means it must have a <code>ServeHTTP()</code> method.</p>\n\n<p>You used pointer receiver for the <code>templateHandler.ServeHTTP()</code> method, which means only a pointer value to <code>templateHandler</code> has this method, but not that of a non-pointer <code>templateHandler</code> type.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">Spec: Method sets:</a></p>\n\n<blockquote>\n  <p>A type may have a <em>method set</em> associated with it. The method set of an <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"nofollow noreferrer\">interface type</a> is its interface. The method set of any other type <code>T</code> consists of all <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow noreferrer\">methods</a> declared with receiver type <code>T</code>. The method set of the corresponding <a href=\"https://golang.org/ref/spec#Pointer_types\" rel=\"nofollow noreferrer\">pointer type</a> <code>*T</code> is the set of all methods declared with receiver <code>*T</code> or <code>T</code> (that is, it also contains the method set of <code>T</code>).</p>\n</blockquote>\n\n<p>A non-pointer type only has methods with non-pointer receivers. A pointer type has methods both with pointer and non-pointer receivers.</p>\n\n<p>Your <code>ServeHTTP()</code> method modifies the receiver, so it must be a pointer. But if some other handler does not need to, the <code>ServeHTTP()</code> method may be created using a non-pointer receiver, and in that case you can use a non-pointer value as the <code>http.Handler</code>, like in this example:</p>\n\n<pre><code>type myhandler struct{}\n\nfunc (m myhandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {}\n\nfunc main() {\n    // non-pointer struct value implements http.Handler:\n    http.Handle(\"/\", myhandler{})\n}\n</code></pre>\n"}], "owner": {"reputation": 355, "user_id": 6382532, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/700ac9a62f0621f69f58836a7b78bfea?s=128&d=identicon&r=PG&f=1", "display_name": "lsgng", "link": "https://stackoverflow.com/users/6382532/lsgng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "accepted_answer_id": 56652994, "answer_count": 1, "score": -1, "last_activity_date": 1560873867, "creation_date": 1560873110, "last_edit_date": 1560873724, "question_id": 56652884, "link": "https://stackoverflow.com/questions/56652884/why-use-a-pointer-when-using-a-custom-http-handler-in-go", "title": "Why use a pointer when using a custom http.Handler in Go?", "body": "<p>When calling <code>http.Handle()</code> in the code snippet below, I'm using my own <code>templateHandler</code> type which implements the <code>http.Handler</code> interface.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"html/template\"\n    \"log\"\n    \"net/http\"\n    \"path/filepath\"\n    \"sync\"\n)\n\ntype templateHandler struct {\n    once     sync.Once\n    filename string\n    templ    *template.Template\n}\n\nfunc (t *templateHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    t.once.Do(func() {\n        t.templ = template.Must(template.ParseFiles(filepath.Join(\"templates\", t.filename)))\n    })\n    t.templ.Execute(w, nil)\n}\n\nfunc main() {\n    http.Handle(\"/\", &amp;templateHandler{filename: \"chat.html\"})\n    if err := http.ListenAndServe(\":8080\", nil); err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n\n<p>Now for some reason I have to pass a pointer to <code>http.Handle()</code> using <code>&amp;templateHandler{filename: \"chat.html\"}</code>. Without the <code>&amp;</code> I get the following error:</p>\n\n<pre><code>cannot use (templateHandler literal) (value of type templateHandler) \nas http.Handler value in argument to http.Handle: \nmissing method ServeHTTP\n</code></pre>\n\n<p>Why exactly is this happening? What difference does using a pointer make in this case?</p>\n"}, {"tags": ["tensorflow", "go", "tensorflow-hub"], "comments": [{"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1560869297, "post_id": 56651461, "comment_id": 99873440, "body": "i don&#39;t think go is officially supoprted by tensorflow anymore, you might find something on tensorflow forums / mailing lists"}, {"owner": {"reputation": 51, "user_id": 7832506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4f75f8bd8bc4f6658548b74bf1ba53f?s=128&d=identicon&r=PG&f=1", "display_name": "T. Watzl", "link": "https://stackoverflow.com/users/7832506/t-watzl"}, "reply_to_user": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1560957990, "post_id": 56651461, "comment_id": 99909899, "body": "Ok thanks. After talking with some ML experts I was recommended using python for at least the parts of the application which are going to use tensorflow and I think that is probably the easiest solution."}], "answers": [{"comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1611512359, "post_id": 56753691, "comment_id": 116469855, "body": "did you find out how to use the models  using <code>tensorflow&#47;go</code> once they are imported using <code>gocv</code>?"}, {"owner": {"reputation": 51, "user_id": 7832506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4f75f8bd8bc4f6658548b74bf1ba53f?s=128&d=identicon&r=PG&f=1", "display_name": "T. Watzl", "link": "https://stackoverflow.com/users/7832506/t-watzl"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1611787967, "post_id": 56753691, "comment_id": 116566797, "body": "I don&#39;t know anymore. Also a lot of things have changed between when the question was phrased and now. Mainly when I was doing this back in 2019 it was kinda hard situation because TF 1 was deprecated while TF 2 was not yet released. I never really managed to get everything to run as intended.  Maybe have a look at Keras, I also found out since that it might be a better alternative to TF."}], "tags": [], "owner": {"reputation": 51, "user_id": 7832506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4f75f8bd8bc4f6658548b74bf1ba53f?s=128&d=identicon&r=PG&f=1", "display_name": "T. Watzl", "link": "https://stackoverflow.com/users/7832506/t-watzl"}, "is_accepted": false, "score": 0, "last_activity_date": 1561464377, "creation_date": 1561464377, "answer_id": 56753691, "question_id": 56651461, "link": "https://stackoverflow.com/questions/56651461/using-tensorflow-hub-with-go/56753691#56753691", "title": "Using tensorflow hub with go", "body": "<p>So after a lot of work in the past few days I finally found a way. </p>\n\n<p>At first I wanted to just use Python to do all the Tensorflow stuff and then provide the results via a rest service. However it turned out that the number of models provided by Tensorflow Hub is very small. This was a problem for me because I had to try out different models and compare them.</p>\n\n<p>Thus I switched to using models from <a href=\"https://github.com/tensorflow/models\" rel=\"nofollow noreferrer\">https://github.com/tensorflow/models</a>. There are several tutorials how to export the data to .pb files. Those files can then be loaded in Go using gocv. </p>\n\n<p>It requires a lot of work to convert the files, but in the end I think this is the best way to use Tensorflow models in go. </p>\n"}], "owner": {"reputation": 51, "user_id": 7832506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4f75f8bd8bc4f6658548b74bf1ba53f?s=128&d=identicon&r=PG&f=1", "display_name": "T. Watzl", "link": "https://stackoverflow.com/users/7832506/t-watzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 168, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561464377, "creation_date": 1560868220, "question_id": 56651461, "link": "https://stackoverflow.com/questions/56651461/using-tensorflow-hub-with-go", "title": "Using tensorflow hub with go", "body": "<p>I want to use pre trained models in my go application. Especially the Inception-ResNet-v2 model.\nThis model seems to be only available via tensorflow hub (<a href=\"https://www.tensorflow.org/hub/\" rel=\"nofollow noreferrer\">https://www.tensorflow.org/hub/</a>). </p>\n\n<p>However I could not find any documentation how to use tensorflow hub with the go language bindings for tensorflow.</p>\n\n<p>How can I download and use these models in go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560864291, "post_id": 56650039, "comment_id": 99870074, "body": "Which function, exactly, is never returning?"}, {"owner": {"reputation": 49, "user_id": 11664727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0619dc94957db1834c6a36b4371426fd?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian Blaga", "link": "https://stackoverflow.com/users/11664727/lucian-blaga"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560864787, "post_id": 56650039, "comment_id": 99870441, "body": "@Flimzy i am not sure, app running, but never die."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560864822, "post_id": 56650039, "comment_id": 99870473, "body": "Please do some minimal debugging, then, to determine which function is not returning."}], "owner": {"reputation": 49, "user_id": 11664727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0619dc94957db1834c6a36b4371426fd?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian Blaga", "link": "https://stackoverflow.com/users/11664727/lucian-blaga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560864274, "creation_date": 1560863682, "last_edit_date": 1560864274, "question_id": 56650039, "link": "https://stackoverflow.com/questions/56650039/send-ssl-email-using-sendgrid-without-finish", "title": "send ssl email using sendgrid without finish", "body": "<p>I try to send email using ssl smtp from send grid, my current code is:</p>\n\n<pre><code>import (\n    \"crypto/tls\"\n    \"fmt\"\n    \"net\"\n    \"net/smtp\"\n    \"time\"\n\n    \"github.com/toorop/go-dkim\"\n    \"golang.org/x/net/proxy\"\n)\n\n// SmtpSendOne - send email using smtp &amp; proxy\nfunc SmtpSendOne(server SmtpServer, data *MailData) error {\n    var remote net.Conn\n    var err error\n\n    // TLS config\n    tlsconfig := &amp;tls.Config{\n        InsecureSkipVerify: true,\n        ServerName:         \"example.com\",\n    }\n\n    remote, err = net.DialTimeout(\"tcp\", \"smtp.sendgrid.net:456\", 10*time.Second)\n    defer remote.Close()\n\n    if remote == nil {\n        return fmt.Errorf(\"Proxy not working\")\n\n    }\n\n    if err != nil {\n        return fmt.Errorf(\"Failed to connect to SMTP server: %s\", err)\n    }\n\n    client, err := smtp.NewClient(remote, server.Host)\n    if err != nil {\n        return err\n    }\n\n    defer client.Close()\n\n    client.StartTLS(tlsconfig)\n\n    auth := SmtpLoginAuth(\"apikey\", \"apikey\")\n    authErr := client.Auth(auth)\n    if authErr != nil {\n        return authErr\n    }\n    if err = client.Mail(data.From()); err != nil {\n        return fmt.Errorf(\"MAIL failed : %s\", err)\n    }\n    if err = client.Rcpt(data.To()); err != nil {\n        return fmt.Errorf(\"RCPT failed %s\", err)\n    }\n\n    bodyWriter, err := client.Data()\n    if err != nil {\n        return err\n    }\n\n    bodyWriter.Close()\n    client.Quit()\n    return nil\n}\n</code></pre>\n\n<p>The problem is, when I run the code, email not send, and connection never dies, not return any error.\nSame one can understand where I went wrong? What am I missing?\nwith no ssl smtp is working without any problem.</p>\n"}, {"tags": ["go", "rpc", "json-rpc", "leveldb", "tendermint"], "comments": [{"owner": {"reputation": 1815, "user_id": 820520, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d83b63db79b42978fe35e120550ca180?s=128&d=identicon&r=PG", "display_name": "melekes", "link": "https://stackoverflow.com/users/820520/melekes"}, "edited": false, "score": 0, "creation_date": 1560929040, "post_id": 56649491, "comment_id": 99893101, "body": "I don&#39;t think you can access the same db. But you can make a copy and use it. Or better use RPC <a href=\"https://tendermint.com/rpc/\" rel=\"nofollow noreferrer\">tendermint.com/rpc</a> to get data you desire."}, {"owner": {"reputation": 1, "user_id": 8138559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42789b6dec06d4d1c872a7fa44d87f38?s=128&d=identicon&r=PG&f=1", "display_name": "Abhijith Reddy", "link": "https://stackoverflow.com/users/8138559/abhijith-reddy"}, "reply_to_user": {"reputation": 1815, "user_id": 820520, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d83b63db79b42978fe35e120550ca180?s=128&d=identicon&r=PG", "display_name": "melekes", "link": "https://stackoverflow.com/users/820520/melekes"}, "edited": false, "score": 0, "creation_date": 1561011928, "post_id": 56649491, "comment_id": 99926248, "body": "Can a copy of the db get updated in parallel with the original db tendermint would access. Is it possible for the original db to be connected with both tendermint and the copy."}, {"owner": {"reputation": 1, "user_id": 8138559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42789b6dec06d4d1c872a7fa44d87f38?s=128&d=identicon&r=PG&f=1", "display_name": "Abhijith Reddy", "link": "https://stackoverflow.com/users/8138559/abhijith-reddy"}, "reply_to_user": {"reputation": 1815, "user_id": 820520, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/d83b63db79b42978fe35e120550ca180?s=128&d=identicon&r=PG", "display_name": "melekes", "link": "https://stackoverflow.com/users/820520/melekes"}, "edited": false, "score": 0, "creation_date": 1561012010, "post_id": 56649491, "comment_id": 99926280, "body": "I am trying to make us the tendermint.com/rpc &#39;Subscribe&#39; method but the docs don&#39;t provide any example and I&#39;m unable to understand how to run the method. I could run other rpc endpoints referring the examples."}], "owner": {"reputation": 1, "user_id": 8138559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42789b6dec06d4d1c872a7fa44d87f38?s=128&d=identicon&r=PG&f=1", "display_name": "Abhijith Reddy", "link": "https://stackoverflow.com/users/8138559/abhijith-reddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 111, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1561011827, "creation_date": 1560861884, "last_edit_date": 1561011827, "question_id": 56649491, "link": "https://stackoverflow.com/questions/56649491/tendermint-access-leveldb-via-node", "title": "Tendermint access leveldb via node", "body": "<p>I have a sample go application running with tendermint. I would like to access the data Tendermint's blockchain stores in leveldb while both the application and the node are running.</p>\n\n<p>I have tried to run a basic go script that iterates over the tx_index.db which stores the tx.hash and the corresponding result of every transaction. But when I try to run the script the program panics with an error message.</p>\n\n<p>Here's the go script to iterate over the tx_index.db</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/syndtr/goleveldb/leveldb\"\n)\n\nfunc main() {\n    db, err := leveldb.OpenFile(\"tx_index.db\", nil)\n    if err != nil {\n        panic(err)\n    }\n\n    iter := db.NewIterator(nil, nil)\n    for iter.Next() {\n        key := iter.Key()\n        h_key := fmt.Sprintf(\"%X\", key)\n        value := iter.Value()\n        h_value := fmt.Sprintf(\"%X\", value)\n        fmt.Printf(\"Key: %v \\nValue: %v \\n\", h_key, h_value)\n    }\n    iter.Release()\n    err = iter.Error()\n    defer db.Close()\n\n}\n\n</code></pre>\n\n<p>Upon running the above script while the application and the tendermint node are running. I get the following error message!</p>\n\n<pre><code>panic: resource temporarily unavailable\n\ngoroutine 1 [running]:\nmain.main()\n    $HOME/tendermint/data/read_db.go:11 +0x375\nexit status 2\n</code></pre>\n\n<p>I am interested in accessing the tx_index.db while the application and tendermint node are running to get the transaction hash of the transactions performed. </p>\n\n<p>PS: If it's feasible I'd like to know if there's a way to get tx.hash by accessing the tx_index.db by interacting with the tendermint node.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560863346, "post_id": 56649243, "comment_id": 99869518, "body": "Thanks, that&#39;s an improvement. Can you still explain what specific help you need? Are you stuck on how to parse the lines? Or on how to generate the JSON? Or something else?"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 6661535, "user_type": "registered", "profile_image": "https://graph.facebook.com/1078474822231611/picture?type=large", "display_name": "Dimitri Berveglieri", "link": "https://stackoverflow.com/users/6661535/dimitri-berveglieri"}, "edited": false, "score": 0, "creation_date": 1561104975, "post_id": 56649987, "comment_id": 99962930, "body": "thank you very much, it worked. How can I mark your answer and the correct one? thanks a lot."}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "reply_to_user": {"reputation": 13, "user_id": 6661535, "user_type": "registered", "profile_image": "https://graph.facebook.com/1078474822231611/picture?type=large", "display_name": "Dimitri Berveglieri", "link": "https://stackoverflow.com/users/6661535/dimitri-berveglieri"}, "edited": false, "score": 0, "creation_date": 1561105389, "post_id": 56649987, "comment_id": 99963117, "body": "There is a grey tick symbol under the votes. You can click it to become green <a href=\"https://meta.stackexchange.com/questions/147531/how-mark-my-question-as-answered-on-stack-overflow\" title=\"how mark my question as answered on stack overflow\">meta.stackexchange.com/questions/147531/&hellip;</a>."}], "tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": true, "score": 1, "last_activity_date": 1560863532, "creation_date": 1560863532, "answer_id": 56649987, "question_id": 56649243, "link": "https://stackoverflow.com/questions/56649243/convert-txt-file-to-json-in-golang/56649987#56649987", "title": "Convert TXT file to Json in Golang", "body": "<p>You can read the data from a file as you do in your question and perform some extra validation and trimming on the strings and replace the template data with real. I am using fixed data to demonstrate how to do it. </p>\n\n<p>Here is the example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strings\"\n)\n\ntype Element struct {\n    Name  string `json:\"name\"`\n    Value string `json:\"value\"`\n}\n\nfunc main() {\n    var data = `VAULT_ADDR = \"https://address.com\"\nSECRET_USERNAME = \"{{tata/user}}\"\nSECRET_PASSWORD = \"{{tata/pass}}\"\nSECRET_SLACK_TOKEN = \"{{tata/token}}\"\nSECRET_CONTENTFUL_SPACE_ID = \"{{tata/space}}\"\nSECRET_CONTENTFUL_ACCESS_TOKEN = \"{{tata/stuff}}\"\nSECRET_NEW_RELIC_TOKEN = \"{{tata/tata}}\"`\n\n    var dataSlice = make([]Element, 0)\n    lines := strings.Split(data, \"\\n\")\n    for _, line := range lines {\n        keyVal := strings.Split(line, \"=\")\n        dataSlice = append(dataSlice, Element{Name: keyVal[0], Value: keyVal[1]})\n        // dataSlice[keyVal[0]] = keyVal[1]\n        // in real code make sure the dataSlice has length==2\n    }\n    bts, err := json.Marshal(dataSlice)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%s\", bts)\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 6661535, "user_type": "registered", "profile_image": "https://graph.facebook.com/1078474822231611/picture?type=large", "display_name": "Dimitri Berveglieri", "link": "https://stackoverflow.com/users/6661535/dimitri-berveglieri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1110, "favorite_count": 0, "closed_date": 1560898156, "accepted_answer_id": 56649987, "answer_count": 1, "score": -4, "last_activity_date": 1560863532, "creation_date": 1560861105, "last_edit_date": 1560862865, "question_id": 56649243, "link": "https://stackoverflow.com/questions/56649243/convert-txt-file-to-json-in-golang", "closed_reason": "Needs more focus", "title": "Convert TXT file to Json in Golang", "body": "<p>I'm struggling trying to convert a text file to JSON.\nI can't use python for limitations in the implementation so it needs to be in Go.</p>\n\n<p>I have this file structure</p>\n\n<pre><code>VAULT_ADDR=https://address.com\nSECRET_USERNAME={{tata/user}}\nSECRET_PASSWORD={{tata/pass}}\nSECRET_SLACK_TOKEN={{tata/token}}\n\nSECRET_CONTENTFUL_SPACE_ID={{tata/space}}\nSECRET_CONTENTFUL_ACCESS_TOKEN={{tata/stuff}}\n\nSECRET_NEW_RELIC_TOKEN={{tata/tata}}\n</code></pre>\n\n<p>I'd need to covert it for a JSON structure, I tried a lot of things but don't know if I should use a structure, interface or how to do this.</p>\n\n<p>would like to convert for this:</p>\n\n<pre><code>[  \n{  \n    \"name\":\"VAULT_ADDR\",\n    \"value\":\"https://address.com\"\n},\n{  \n    \"name\":\"SECRET_USERNAME\",\n    \"value\":\"{{tata/user}}\"\n},\n{  \n    \"name\":\"SECRET_PASSWORD\",\n    \"value\":\"{{tata/pass}}\"\n},\n{  \n    \"name\":\"SECRET_SLACK_TOKEN\",\n    \"value\":\"{{tata/token}}\"\n},\n{  \n    \"name\":\"SECRET_CONTENTFUL_SPACE_ID\",\n    \"value\":\"{{tata/space}}\"\n},\n{  \n    \"name\":\"SECRET_CONTENTFUL_ACCESS_TOKEN\",\n    \"value\":\"{{tata/stuff}}\"\n},\n{  \n    \"name\":\"SECRET_NEW_RELIC_TOKEN\",\n    \"value\":\"{{tata/tata}}\"\n}\n]\n</code></pre>\n\n<p>this is my code so far...</p>\n\n<pre><code>package main\n\nimport (\n  \"flag\"\n  \"fmt\"\n  \"io/ioutil\"\n  \"log\"\n  \"os\"\n  \"strings\"\n)\n\n var (\n   file string\n)\n\n func main() {\n\n   flag.StringVar(&amp;file, \"f\", \"\", \"file path\")\n   flag.Parse()\n\n   data, err := os.Open(file)\n   if err != nil {\n      log.Fatal(err)\n   }\n   defer data.Close()\n\n   file, err := ioutil.ReadAll(data)\n\n   converter := string(file)\n\n   s := strings.Split(converter, \"=\")\n\n   for _, line := range s {\n      parser := \"name\" + line\n\n      fmt.Println(parser)\n   }\n\n }\n</code></pre>\n\n<p>My code output:</p>\n\n<pre><code>name= VAULT_ADDR value\nname= https://address.com\nSECRET_USERNAME value\nname= {{tata/user}}\nSECRET_PASSWORD value\nname= {{tata/pass}}\nSECRET_SLACK_TOKEN value\nname= {{tata/token}}\n\nSECRET_CONTENTFUL_SPACE_ID value\nname= {{tata/space}}\nSECRET_CONTENTFUL_ACCESS_TOKEN value\nname= {{tata/stuff}}\n\nSECRET_NEW_RELIC_TOKEN value\nname= {{tata/tata}} value\n</code></pre>\n\n<p>thank you</p>\n"}, {"tags": ["c++", "go"], "answers": [{"comments": [{"owner": {"reputation": 117, "user_id": 7622244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2230d765f39cb91e5c474b5572530d5?s=128&d=identicon&r=PG&f=1", "display_name": "Steven Fang", "link": "https://stackoverflow.com/users/7622244/steven-fang"}, "edited": false, "score": 0, "creation_date": 1560863179, "post_id": 56649310, "comment_id": 99869399, "body": "I got it. <code>num</code> variable in C++ code is  a <code>vector</code>, which is a C++ object, it differs from normal int array. C++ will copy parameters object if we don&#39;t explicitly use a reference or use a pointer."}], "tags": [], "owner": {"reputation": 2876, "user_id": 7958961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df9fc6004eafe9f7b473927ecfd65646?s=128&d=identicon&r=PG&f=1", "display_name": "Rados\u0142aw Cybulski", "link": "https://stackoverflow.com/users/7958961/rados%c5%82aw-cybulski"}, "is_accepted": true, "score": 4, "last_activity_date": 1560861874, "last_edit_date": 1560861874, "creation_date": 1560861281, "answer_id": 56649310, "question_id": 56649138, "link": "https://stackoverflow.com/questions/56649138/why-does-my-go-solution-give-a-different-result-from-c/56649310#56649310", "title": "Why does my Go solution give a different result from C++?", "body": "<p>Try this:</p>\n\n<pre><code>func helper(res *[][]int, nums []int, start int) {\n    copied := make([]int, len(nums))\n    copy(copied, nums)\n    nums = copied;\n    if start == len(nums)-1 {\n        *res = append(*res, nums)\n        return\n    }\n    for i := start; i &lt; len(nums); i++ {\n        if start == i || nums[start] != nums[i] {               \n            nums[i], nums[start] = nums[start], nums[i]\n            helper(res, nums, start+1)\n        }\n    }\n}\n</code></pre>\n\n<p>When porting from language to language you need to make sure you \"port\" implicit features as well. In C++ solution when calling <code>helper</code> function language would make a copy of <code>nums</code> array for every iteration. You didn't clone this behavior to go and got different result. I added coping <code>num</code> at beginning of <code>helper</code> function and it worked well.</p>\n"}], "owner": {"reputation": 117, "user_id": 7622244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2230d765f39cb91e5c474b5572530d5?s=128&d=identicon&r=PG&f=1", "display_name": "Steven Fang", "link": "https://stackoverflow.com/users/7622244/steven-fang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 1, "accepted_answer_id": 56649310, "answer_count": 1, "score": 2, "last_activity_date": 1560861874, "creation_date": 1560860767, "last_edit_date": 1560861672, "question_id": 56649138, "link": "https://stackoverflow.com/questions/56649138/why-does-my-go-solution-give-a-different-result-from-c", "title": "Why does my Go solution give a different result from C++?", "body": "<p>Two code with exactly same logic gives different solutions.</p>\n\n<p>Is there a bug within Go, or did I make some stupid mistake in my code?</p>\n\n<p>This is a leetcode question <a href=\"https://leetcode.com/problems/permutations-ii/\" rel=\"nofollow noreferrer\">LeetCode - Permutations II</a>.</p>\n\n<p>The C++ code below is an ACCEPTED solution written by someone.</p>\n\n<p><strong>C++ Code</strong></p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;vector&gt;\n#include &lt;iostream&gt;\n#include &lt;algorithm&gt;\n\nusing namespace std;\nclass Solution {\npublic:\n    vector&lt;vector&lt;int&gt;&gt; permuteUnique(vector&lt;int&gt; &amp;num) {\n        sort(num.begin(), num.end());\n        vector&lt;vector&lt;int&gt;&gt;res;\n        helper(num, 0, num.size(), res);\n        return res;\n    }\n\n    void helper(vector&lt;int&gt; num, int start, int j, vector&lt;vector&lt;int&gt; &gt; &amp;res) {\n        if (start == j-1) {\n            res.push_back(num);\n            return;\n        }\n        for (int i = start; i &lt; j; i++) {\n            if (start == i || num[start] != num[i]) {\n                swap(num[start], num[i]);\n                helper(num, start + 1, j, res);\n            }\n        }\n    }\n};\n\nint main() {\n    Solution s;\n    vector&lt;int&gt; nums({2,1,2});\n    vector&lt;vector&lt;int&gt;&gt; res = s.permuteUnique(nums);\n    for (int i = 0; i &lt; res.size(); i++) {\n        for (int j = 0; j &lt; res[i].size(); j++) {\n            cout &lt;&lt; \" \" &lt;&lt; res[i][j];\n        }\n        cout &lt;&lt; endl;\n    }\n}\n</code></pre>\n\n<p>I translated the C++ code above to the golang code below:</p>\n\n<p><strong>Golang Code</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nfunc permuteUnique(nums []int) [][]int {\n    qsort(nums, 0, len(nums)-1)\n    res := make([][]int, 0, len(nums))\n    helper(&amp;res, nums, 0)\n    return res\n}\n\nfunc helper(res *[][]int, nums []int, start int) {\n    if start == len(nums)-1 {\n        copied := make([]int, len(nums))\n        copy(copied, nums)\n        *res = append(*res, copied)\n        return\n    }\n    for i := start; i &lt; len(nums); i++ {\n        if start == i || nums[start] != nums[i] {               \n            nums[i], nums[start] = nums[start], nums[i]\n            helper(res, nums, start+1)\n        }\n    }\n}\n\nfunc main() {\n    nums := []int{2,1,2}\n    res := permuteUnique(nums)\n    for i := 0; i &lt; len(res); i++ {\n        for j := 0; j &lt; len(res[0]); j++ {\n            print(\" \", res[i][j]);\n        }\n        println()\n    }\n}\n\nfunc qsort(nums []int, low, high int) {\n    if low &gt;= high {\n        return\n    }\n    i, j, pivot := low, high, nums[low]\n    for i &lt; j {\n        for i &lt; j &amp;&amp; nums[j] &gt;= pivot {\n            j--\n        }\n        nums[i] = nums[j]\n        for i &lt; j &amp;&amp; nums[i] &lt;= pivot {\n            i++\n        }\n        nums[j] = nums[i]\n    }\n    nums[i] = pivot\n    qsort(nums, low, i-1)\n    qsort(nums, i+1, high)\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<p>Both of code above is able to run instantly. Below is my output:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>fondoger@localhost:Desktop$ g++ test.cpp -o app &amp;&amp; ./app\n 1 2 2\n 2 1 2\n 2 2 1\nfondoger@localhost:Desktop$ go run test.go\n 1 2 2\n 2 1 2\n 2 2 1\n 1 2 2\n</code></pre>\n\n<p>I tried debugging using Goland IDE and Clion IDE for several hours, but I can't find out the truth. </p>\n"}, {"tags": ["go", "proto"], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 0, "last_activity_date": 1560875027, "last_edit_date": 1560875027, "creation_date": 1560869225, "answer_id": 56651764, "question_id": 56646742, "link": "https://stackoverflow.com/questions/56646742/protoc-generate-import-path-on-go-source-file/56651764#56651764", "title": "protoc generate import path on go source file", "body": "<blockquote>\n  <p>Acutally I hope a.pb.go import b like this: import github.com/cs/p/b.\n  Could it be done ?</p>\n</blockquote>\n\n<p>Yes!</p>\n\n<p>You need to include an import path during the <code>protoc</code> compilation step. So assuming your git source lives under the path <code>$GOPATH/src</code>, you would add the include flag <code>\"-I.:$GOPATH/src\"</code> like so:</p>\n\n<pre><code>protoc --go_out=plugins=grpc:. \"-I.:$GOPATH/src\" a/a.proto\n</code></pre>\n\n<hr>\n\n<p>Once imported, to reference any message types, use the scope path <code>&lt;package name&gt;.&lt;message name&gt;</code>.</p>\n\n<p>For example, the (git hosted) definition:</p>\n\n<pre><code>// this file resides here: ${GOPATH}/src/github.com/bib/pb/person.proto\npackage tutorial;\n\nmessage Person {\n  string name = 1;\n}\n</code></pre>\n\n<p>would be imported and referenced like so:</p>\n\n<pre><code>import \"github.com/bib/pb/person.proto\"\n\nmessage AddressBook {\n  repeated tutorial.Person people = 1;\n}\n</code></pre>\n"}], "owner": {"reputation": 573, "user_id": 6328514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yae7F.jpg?s=128&g=1", "display_name": "Lewis Chan", "link": "https://stackoverflow.com/users/6328514/lewis-chan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 328, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1560875027, "creation_date": 1560852662, "question_id": 56646742, "link": "https://stackoverflow.com/questions/56646742/protoc-generate-import-path-on-go-source-file", "title": "protoc generate import path on go source file", "body": "<p>I have a pb file in <code>$GOPATH/src/github.com/cs/p/a/a.proto</code>, and another pb file in <code>$GOPATH/src/github.com/cs/p/b/b.proto</code>. And <code>a.proto</code> import <code>b.proto</code> like this:</p>\n\n<pre><code>import \"b/b.proto\"\n</code></pre>\n\n<p>Now I enter <code>$GOPATH/src/github.com/cs/p</code> and execute the following command:</p>\n\n<blockquote>\n  <p>protoc --go_out=plugins=grpc:. a/a.proto</p>\n</blockquote>\n\n<p>Then I find <code>a.pb.go</code> is generated in <code>$GOPATH/src/github.com/cs/p/a/</code>, within which there's such statement: <code>import \"b\"</code>.</p>\n\n<p>When I build the project, it says it cannot find package <code>b</code>. What should I do ? Acutally I hope <code>a.pb.go</code> import <code>b</code> like this: <code>import github.com/cs/p/b</code>. Could it be done ?</p>\n"}, {"tags": ["go", "methods", "interface"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1560857326, "post_id": 56646553, "comment_id": 99865797, "body": "&quot;hidden until a specific cast happens&quot; -- Just a note: Go doesn&#39;t do casting at all, so this cannot be the explanation :)"}, {"owner": {"reputation": 843, "user_id": 1816774, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/6bee690bd3d6a8f900f7a8667f3211ce?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/1816774/tim"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560862231, "post_id": 56646553, "comment_id": 99868836, "body": "Changed &quot;cast&quot; to &quot;assertion&quot;, I agree this is not casting. But how would you call <code>bs := []byte(&quot;Hello world&quot;)</code>? Isn&#39;t that casting of a string to a slice of bytes?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1560862278, "post_id": 56646553, "comment_id": 99868871, "body": "No, it&#39;s not a casting. It&#39;s a type conversion. Read about the difference <a href=\"https://techdifferences.com/difference-between-type-casting-and-type-conversion.html\" rel=\"nofollow noreferrer\">here</a> if it&#39;s unclear."}], "answers": [{"tags": [], "owner": {"reputation": 843, "user_id": 1816774, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/6bee690bd3d6a8f900f7a8667f3211ce?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/1816774/tim"}, "is_accepted": true, "score": 0, "last_activity_date": 1560852076, "creation_date": 1560852076, "answer_id": 56646554, "question_id": 56646553, "link": "https://stackoverflow.com/questions/56646553/hidden-methods-in-type-implementations/56646554#56646554", "title": "Hidden methods in type implementations?", "body": "<p>The methods appear to be hidden, because the function takes an interface type. The interface of <code>http.ResponseWriter</code> does not define the <code>Hijack()</code> method. This is defined in the <code>http.Hijacker</code> interface. A concrete type may implement multiple interfaces. But even if such concrete type is passed into a scope where its type definition is an interface, additional methods will not be accessible. So in the questioned example, type assertion is performed to make make the <code>Hijack()</code> method available.</p>\n\n<p>Some examples (<a href=\"https://play.golang.org/p/jMBenb642OB\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Ship interface {\n    Load(containers []string)\n    Condition() []string\n}\n\ntype Sea interface {\n    Draft() int\n}\n\n// seaShip implements the Sea and Ship interfaces\ntype seaShip struct {\n    containers []string\n}\n\n// Load is only part of the Ship interface\nfunc (ss *seaShip) Load(containers []string) {\n    ss.containers = append(ss.containers, containers...)\n}\n\n// Condition is only part of the Ship interface\nfunc (ss *seaShip) Condition() []string {\n    return ss.containers\n}\n\n// Draft is only part of the Sea interface\nfunc (ss *seaShip) Draft() int {\n    return len(ss.containers)\n}\n\n// Pirates is not defined in any interface and therefore can only be called on the concrete type\nfunc (ss *seaShip) Pirates() string {\n    return \"Help!\"\n}\n\n// NewShip returns an implementation of the Ship interface\nfunc NewShip() Ship {\n    return &amp;seaShip{}\n}\n\nfunc main() {\n    ship := NewShip()\n    ship.Load([]string{\"Beer\", \"Wine\", \"Peanuts\"})\n    fmt.Println(ship.Condition())\n    // Won't compile, method is not part of interface!\n    // fmt.Println(ship.Draft())\n\n    // Assert to make Draft() available\n    sea := ship.(Sea)\n    fmt.Println(sea.Draft())\n\n    // Won't compile, methods are not part of interface!\n    // fmt.Println(sea.Condition())\n    // fmt.Println(sea.Pirates())\n\n    // Assert to the concrete type makes all methods available\n    ss := sea.(*seaShip)\n    fmt.Println(ss.Condition())\n    fmt.Println(ss.Pirates())\n}\n</code></pre>\n"}], "owner": {"reputation": 843, "user_id": 1816774, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/6bee690bd3d6a8f900f7a8667f3211ce?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/1816774/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 28, "favorite_count": 0, "accepted_answer_id": 56646554, "answer_count": 1, "score": -2, "last_activity_date": 1560862047, "creation_date": 1560852076, "last_edit_date": 1560862047, "question_id": 56646553, "link": "https://stackoverflow.com/questions/56646553/hidden-methods-in-type-implementations", "title": "Hidden methods in type implementations?", "body": "<p>Going through some go sources in the <code>net/http</code> and related libraries, I came across <a href=\"https://github.com/golang/go/blob/4ce6a8e89668b87dce67e2f55802903d6eb9110a/src/net/http/httputil/reverseproxy.go#L521-L532\" rel=\"nofollow noreferrer\">something</a> that made me curious. I'm looking at version 1.12 here.</p>\n\n<pre><code>func (p *ReverseProxy) handleUpgradeResponse(rw http.ResponseWriter, req *http.Request, res *http.Response) {\n  ...\n  hj, ok := rw.(http.Hijacker)\n  ...\n  conn, brw, err := hj.Hijack()\n  ...\n}\n</code></pre>\n\n<p>I've been seeing stuff like this in more places and also outside the standard library. What is happening here? Are some methods of an interface implementation hidden until a specific assertion happens? Why can't I just call <code>Hijack()</code> on the  <code>rw</code> object?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": true, "score": 2, "last_activity_date": 1560853092, "creation_date": 1560853092, "answer_id": 56646889, "question_id": 56646518, "link": "https://stackoverflow.com/questions/56646518/main-not-exiting-after-reading-from-channel/56646889#56646889", "title": "main not exiting after reading from channel", "body": "<p>Your code has deadlocks. A good way to wait until the processing has been done is to use <code>sync.WaitGroup</code>. Add 1 every time you add a job to the worker and then in the goroutine call <code>wg.done()</code> to signal the job has finished. When the job count is 0 on the waitgroup your code will exit properly. Here is an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype PDF struct {\n    filename string\n    code     string\n    error    error\n}\n\nfunc (p *PDF) GetCode() string {\n    return p.code\n}\n\nvar wg sync.WaitGroup\n\nfunc main() {\n\n    jobs := make(chan PDF)\n    results := make(chan PDF)\n\n    for w := 0; w &lt; 8; w++ {\n        go worker(jobs, results)\n    }\n\n    // PDF files to read.\n    pdfs := []string{\"test.pdf\", \"test2.pdf\", \"test3.pdf\"}\n\n    defer func() { close(results) }()\n    for _, file := range pdfs {\n        wg.Add(1)\n        jobs &lt;- PDF{filename: file}\n    }\n\n    go func() {\n        for i := range results {\n            fmt.Printf(\"%s\", i.GetCode())\n        }\n    }()\n    wg.Wait()\n    close(jobs)\n}\n\nfunc worker(jobs &lt;-chan PDF, results chan&lt;- PDF) {\n    for file := range jobs {\n        fmt.Printf(\"Processing %s\\n\", file.filename)\n        code, err := outputPdfText(file.filename)\n        results &lt;- PDF{filename: file.filename, code: code, error: err}\n        wg.Done()\n    }\n}\n\nfunc outputPdfText(inputPath string) (string, error) {\n    // Code that reads PDF and returns value\n    return \"\", nil\n}\n</code></pre>\n"}], "owner": {"reputation": 465, "user_id": 296030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/012135a2d0ba6b81435e3223e37088d9?s=128&d=identicon&r=PG&f=1", "display_name": "fortysixandtwo", "link": "https://stackoverflow.com/users/296030/fortysixandtwo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 56646889, "answer_count": 1, "score": 1, "last_activity_date": 1560854573, "creation_date": 1560852003, "last_edit_date": 1560854573, "question_id": 56646518, "link": "https://stackoverflow.com/questions/56646518/main-not-exiting-after-reading-from-channel", "title": "main not exiting after reading from channel", "body": "<p>I'm learning Go, but struggle to understand why my app doesn't exit properly. With the code snippet below I get the correct result, but main never exits after the last file has been read. As far as I know this is because it's an open channel somewhere, but I can't figure out why and how that is possible.</p>\n\n<p>The gist of this app is to take an array of PDF-files and read out a certain string of it.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\ntype PDF struct {\n    filename string\n    code string\n    error  error\n}\n\nfunc (p *PDF) GetCode() string {\n    return p.code\n}\n\nfunc main() {\n    jobs := make(chan PDF)\n    results := make(chan PDF)\n\n    for w := 0; w &lt; 8; w++ {\n        go worker(jobs, results)\n    }\n\n    // PDF files to read.\n    pdfs := []string{\"test.pdf\", \"test2.pdf\", \"test3.pdf\"}\n\n    for _, file := range pdfs {\n        go func(file string) {\n            jobs &lt;- PDF{filename: file}\n        }(file)\n    }\n    defer close(jobs)\n\n    for i := range results {\n        fmt.Printf(\"%s \", i.GetCode())\n    }\n}\n\nfunc worker(jobs &lt;-chan PDF, results chan&lt;- PDF) {\n    for file := range jobs {\n        fmt.Printf(\"Processing %s\\n\", file.filename)\n        code, err := outputPdfText(file.filename)\n        results &lt;- PDF{filename: file.filename, code: code, error: err}\n    }\n}\n\nfunc outputPdfText(inputPath string) (string, error) {\n    // Code that reads PDF and returns value\n    [...]\n}\n</code></pre>\n"}, {"tags": ["go", "osquery"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 11452567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84f5f3a64d66a60c7349e55cc8324a08?s=128&d=identicon&r=PG&f=1", "display_name": "hippwn", "link": "https://stackoverflow.com/users/11452567/hippwn"}, "edited": false, "score": 0, "creation_date": 1560870819, "post_id": 56652017, "comment_id": 99874404, "body": "It feels like it is more or less what I tried, but the error I do return (see last row) does not appear in osquery&#39;s shell."}], "tags": [], "owner": {"reputation": 533, "user_id": 718270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50c1f1a980f7bfd564b1664bab587ba?s=128&d=identicon&r=PG", "display_name": "seph", "link": "https://stackoverflow.com/users/718270/seph"}, "is_accepted": false, "score": 0, "last_activity_date": 1560870079, "creation_date": 1560870079, "answer_id": 56652017, "question_id": 56646473, "link": "https://stackoverflow.com/questions/56646473/how-to-provide-table-spec-when-adding-a-virtual-table-from-an-extension/56652017#56652017", "title": "How to provide table spec when adding a virtual table from an extension", "body": "<p>Return an error instead of nil.</p>\n\n<p>Something like (psuedocode):</p>\n\n<pre><code>    cnstList, present := queryContext.Constraints[\"field1\"]\n    if !present {\n       return nil, errors.New(\"Missing required field1\")\n    }\n    ...\n</code></pre>\n\n<p>For a real example, take a look at some of the custom tables in launcher. For example <a href=\"https://github.com/kolide/launcher/blob/ca2b2a48fb7ee7a13892b3f9940d4e67ccd9d6de/pkg/osquery/table/slack_config.go#L88-L101\" rel=\"nofollow noreferrer\">https://github.com/kolide/launcher/blob/ca2b2a48fb7ee7a13892b3f9940d4e67ccd9d6de/pkg/osquery/table/slack_config.go#L88-L101</a></p>\n"}], "owner": {"reputation": 3, "user_id": 11452567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84f5f3a64d66a60c7349e55cc8324a08?s=128&d=identicon&r=PG&f=1", "display_name": "hippwn", "link": "https://stackoverflow.com/users/11452567/hippwn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560943905, "creation_date": 1560851832, "last_edit_date": 1560943905, "question_id": 56646473, "link": "https://stackoverflow.com/questions/56646473/how-to-provide-table-spec-when-adding-a-virtual-table-from-an-extension", "title": "How to provide table spec when adding a virtual table from an extension", "body": "<p>I'm building an <em>osquery</em> extension using osquery-go which is providing a virtual table into osqueryi. My table requires a <code>WHERE</code> clause on a specific field to generate a result. Where do I put the specifications of my table?</p>\n\n<p>As stated on osquery's <a href=\"https://osquery.readthedocs.io/en/stable/development/creating-tables/\" rel=\"nofollow noreferrer\">documentation</a>, specs are usually provided in the specs <a href=\"https://github.com/facebook/osquery/tree/master/specs\" rel=\"nofollow noreferrer\">source</a> folder. But for an extension, I cannot figure out how to do it.</p>\n\n<p>I used the example provided on <a href=\"https://github.com/kolide/osquery-go\" rel=\"nofollow noreferrer\">osquery-go</a> as a starting point, it works pretty well. I'm also able to filter the input with the constraints but I'd like to get a warning, not the absence of result:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func MyTableGenerate(ctx context.Context, queryContext table.QueryContext) ([]map[string]string, error) {\n    if cnstList, present := queryContext.Constraints[\"field1\"]; present {\n        // If 'field1' is present in queryContext.Contraints's keys\n        // translate: if 'field1' is in the WHERE clause\n\n        for _, cnst := range cnstList.Constraints {\n            if cnst.Operator == table.OperatorEquals {\n                out, err := SomeExternalFn(cnst.Expression)\n                return []map[string]string{\n                    {\n                        \"field1\": cnst.Expression,\n                        \"field2\": out,\n                        \"field3\": err,\n                    },\n                }, nil\n            }\n        }\n    }\n    return nil, errors.New(\"Query to table MyTable must have a WHERE clause on 'field1'\")\n}\n</code></pre>\n\n<p>In osqueryi:</p>\n\n<pre><code>osquery&gt; select * from MyTable;\nosquery&gt; select * from MyTable where field1=\"foo\";\n+--------+--------+--------+\n| field1 | field2 | field3 |\n+--------+--------+--------+\n| foo    | foobar | foobaz |\n+--------+--------+--------+\n</code></pre>\n\n<p>What I seek:</p>\n\n<pre><code>osquery&gt; select * from file;\nW0618 11:50:58.840874  7252 virtual_table.cpp:991] Table file was queried without a required column in the WHERE clause\nW0618 11:50:58.841397  7252 virtual_table.cpp:1002] Please see the table documentation: https://osquery.io/schema/#file\n</code></pre>\n"}, {"tags": ["go", "struct", "concurrency", "mutex", "race-condition"], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 5097317, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Z1QovhDIDBk/AAAAAAAAAAI/AAAAAAAACiw/lvIGfSgZyqA/photo.jpg?sz=128", "display_name": "Randix Lai Randy", "link": "https://stackoverflow.com/users/5097317/randix-lai-randy"}, "edited": false, "score": 0, "creation_date": 1560908029, "post_id": 56649388, "comment_id": 99887479, "body": "Thank you for pointing that out. It does fix the question. I understand that it is a read now. But Why does it matter to pass an argument by value or not? And where should I put my mutex, in the Test struct , Data Struct, or both?"}, {"owner": {"reputation": 73, "user_id": 5097317, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Z1QovhDIDBk/AAAAAAAAAAI/AAAAAAAACiw/lvIGfSgZyqA/photo.jpg?sz=128", "display_name": "Randix Lai Randy", "link": "https://stackoverflow.com/users/5097317/randix-lai-randy"}, "edited": false, "score": 0, "creation_date": 1560908475, "post_id": 56649388, "comment_id": 99887572, "body": "I&#39;ve updated my question. Would you please help with that?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1560861883, "last_edit_date": 1560861883, "creation_date": 1560861556, "answer_id": 56649388, "question_id": 56646440, "link": "https://stackoverflow.com/questions/56646440/race-condition-with-mutex-in-go-and-where-to-embed-the-lock-parent-struct-or-ch/56649388#56649388", "title": "Race condition with mutex in go and where to embed the lock, parent struct or child struct?", "body": "<blockquote>\n  <p>The race test keeps saying there is race condition.</p>\n</blockquote>\n\n<hr>\n\n<p>The statement</p>\n\n<pre><code>fmt.Printf(\"result is %v\", t.data.d[\"test\"])\n</code></pre>\n\n<p>passes the argument </p>\n\n<pre><code>t.data.d[\"test\"]\n</code></pre>\n\n<p>by value. It makes a copy by assignment, which is a read.</p>\n\n<p>You need to protect the read via the mutex.</p>\n\n<pre><code>t.data.Lock()\nfmt.Printf(\"result is %v\\n\", t.data.d[\"test\"])\nt.data.Unlock()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 73, "user_id": 5097317, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Z1QovhDIDBk/AAAAAAAAAAI/AAAAAAAACiw/lvIGfSgZyqA/photo.jpg?sz=128", "display_name": "Randix Lai Randy", "link": "https://stackoverflow.com/users/5097317/randix-lai-randy"}, "is_accepted": false, "score": 1, "last_activity_date": 1560916265, "creation_date": 1560916265, "answer_id": 56659796, "question_id": 56646440, "link": "https://stackoverflow.com/questions/56646440/race-condition-with-mutex-in-go-and-where-to-embed-the-lock-parent-struct-or-ch/56659796#56659796", "title": "Race condition with mutex in go and where to embed the lock, parent struct or child struct?", "body": "<p>As @peterSO mentioned, the error is caused by \"fmt.Printf(\"result is %v\\n\", t.data.d[\"test\"])\". \nAfter hours digging, I seem to have found the answers about my first two questions. I misunderstood the concept of mutex. A mutex is used to protect the resource and not to lock the memory it self , in my example, the struct itself.\nFor the first question:\nif one goroutine executes some code like </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>s.pingLock.Lock()\n\\\\ some logic 1\ns.pingLock.Unlock()\nstreamLock\n\\\\ some logic 2\nstreamUnlock\n</code></pre>\n\n<p>So when one goroutine executes this code and acquires the <code>s.streamLock.Lock()</code>, until it's unlocked, other go routines cannot execute <code>some logic 2</code>, but any goroutine can execute <code>some logic1</code> if it gets the <code>pingLock.Lock()</code>. If using one lock only , if one go routine gets the lock, no one else can get the lock then all other executions get blocked.</p>\n\n<p>For the second question:\nIf understanding the above explanation. Then the second question is answered too. Put mutex anywhere you want because it's just a lock to protect the resource, that is to say, the code itself. I'm sure there's a nice idiomatic way to do it, though.</p>\n\n<p>I'm not sure if it's right to take it this way. If anyone has a different opinion or better answer , please let me know.</p>\n"}], "owner": {"reputation": 73, "user_id": 5097317, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Z1QovhDIDBk/AAAAAAAAAAI/AAAAAAAACiw/lvIGfSgZyqA/photo.jpg?sz=128", "display_name": "Randix Lai Randy", "link": "https://stackoverflow.com/users/5097317/randix-lai-randy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1560916265, "creation_date": 1560851758, "last_edit_date": 1560908439, "question_id": 56646440, "link": "https://stackoverflow.com/questions/56646440/race-condition-with-mutex-in-go-and-where-to-embed-the-lock-parent-struct-or-ch", "title": "Race condition with mutex in go and where to embed the lock, parent struct or child struct?", "body": "<ol>\n<li>I see some people out some mutexes within a single struct. Is it necessary? Or can we simply put one single lock there?\nexample:</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Session struct {\n    // some other irrelevant code\n    pingLock sync.Mutex\n    // some other irrelevant code\n    streamLock sync.Mutex\n    // some other irrelevant code\n    shutdownLock sync.Mutex\n}\n</code></pre>\n\n<ol start=\"2\">\n<li>If a struct contains another struct, and the child struct contains a map or a slice, where should I put the mutex, the parent struct or the child struct?</li>\n<li>Why is the mutex.Lock() not working in my code? Every time I run race test it shows there are races.</li>\n</ol>\n\n<p>At first I was trying to solve the first two problems so I wrote some demo code to test it out. I tried to use the lock within the child struct ,then parent struct to lock the state, but none of them worked. The race test keeps saying there is race condition.\nI've tried both <code>t.Lock()</code> and <code>t.data.Lock()</code>. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Test struct {\n    name string\n    data Data\n    sync.RWMutex //Should I put it here?\n}\n\ntype Data struct {\n    d map[string]int\n    sync.RWMutex // Should I put it here?\n}\n\nfunc (t *Test) add(key string) {\n    t.data.Lock()\n    defer t.data.Unlock()\n    t.data.d[key] += 1\n}\n\nfunc (t *Test) read() {\n    for {\n        t.data.Lock()\n        _= t.data.d[\"test\"]\n        t.data.Unlock()\n    }\n}\n\nfunc main() {\n\n    t := &amp;Test{}\n    t.name = \"oops\"\n    t.data = Data{}\n    t.data.d = make(map[string]int)\n    t.data.d[\"test\"] = 1\n\n    for i := 0; i &lt;= 10; i++ {\n        go func(t *Test) {\n            t.add(\"test\")\n        }(t)\n        go func(t *Test) {\n            t.read()\n        }(t)\n    }\n    time.Sleep(time.Second * 3)\n    fmt.Printf(\"result is %v\", t.data.d[\"test\"])\n</code></pre>\n"}, {"tags": ["json", "mongodb", "go", "bson"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560850622, "post_id": 56646062, "comment_id": 99862057, "body": "What have you tried? Include your code. What specific problems are you facing?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1560851187, "post_id": 56646062, "comment_id": 99862398, "body": "So your question is specifically how to handle <code>math.NaN()</code> when marshaling JSON?"}, {"owner": {"reputation": 1211, "user_id": 10051099, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zEhaK71cFsM/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pY3uj2Rs4X15NaJSIsOYxNzX4COQ/mo/photo.jpg?sz=128", "display_name": "Yohei", "link": "https://stackoverflow.com/users/10051099/yohei"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560851205, "post_id": 56646062, "comment_id": 99862407, "body": "@Flimzy thanks, I added the code that I tried."}, {"owner": {"reputation": 1211, "user_id": 10051099, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zEhaK71cFsM/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pY3uj2Rs4X15NaJSIsOYxNzX4COQ/mo/photo.jpg?sz=128", "display_name": "Yohei", "link": "https://stackoverflow.com/users/10051099/yohei"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560851260, "post_id": 56646062, "comment_id": 99862437, "body": "Yes, and I want to handle effectively. Even if the bson is deeply nested"}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 1, "creation_date": 1560851417, "post_id": 56646062, "comment_id": 99862534, "body": "You can unmarshal bson to interface{} and the marshal it to json. You may need to implement a custom decoder for Nan <a href=\"https://github.com/golang/go/issues/25721\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/25721</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 1, "creation_date": 1560853031, "post_id": 56646062, "comment_id": 99863435, "body": "@georgeok: What do you mean by custom decoder? If you&#39;re decoding into <code>interface{}</code>, there&#39;s no opportunity to use a custom unmarshaler. Did you have something else in mind?"}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1560853240, "post_id": 56646062, "comment_id": 99863568, "body": "I think if you try to json.Marshal the math.NaN the code will panic with <code>panic: json: unsupported value: NaN</code>. For example <a href=\"https://play.golang.org/p/0NAzLlXCUTm\" rel=\"nofollow noreferrer\">play.golang.org/p/0NAzLlXCUTm</a>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1560853628, "last_edit_date": 1560853628, "creation_date": 1560853281, "answer_id": 56646945, "question_id": 56646062, "link": "https://stackoverflow.com/questions/56646062/how-to-convert-bson-to-json-effectively-with-mongo-go-driver/56646945#56646945", "title": "How to convert bson to json effectively with mongo-go-driver?", "body": "<p>If you know the structure if your BSON, you can create a custom type that implements the <code>json.Marshaler</code> and <code>json.Unmarshaler</code> interfaces, and handles NaN as you wish. Example:</p>\n\n<pre><code>type maybeNaN struct{\n    isNan  bool\n    number float64\n}\n\nfunc (n maybeNaN) MarshalJSON() ([]byte, error) {\n    if n.isNan {\n        return []byte(\"null\"), nil // Or whatever you want here\n    }\n    return json.Marshal(n.number)\n}\n\nfunc (n *maybeNan) UnmarshalJSON(p []byte) error {\n    if string(p) == \"NaN\" {\n        n.isNan = true\n        return nil\n    }\n    return json.Unmarshal(p, &amp;n.number)\n}\n\ntype myStruct struct {\n    someNumber maybeNaN `json:\"someNumber\" bson:\"someNumber\"`\n    /* ... */\n}\n</code></pre>\n\n<p>If you have an arbitrary structure of your BSON, your only option is to traverse the structure, using reflection, and convert any occurrences of NaN into a type (possibly a custom type as described above)</p>\n"}], "owner": {"reputation": 1211, "user_id": 10051099, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zEhaK71cFsM/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pY3uj2Rs4X15NaJSIsOYxNzX4COQ/mo/photo.jpg?sz=128", "display_name": "Yohei", "link": "https://stackoverflow.com/users/10051099/yohei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4210, "favorite_count": 1, "accepted_answer_id": 56646945, "answer_count": 1, "score": -1, "last_activity_date": 1560853628, "creation_date": 1560850558, "last_edit_date": 1560851145, "question_id": 56646062, "link": "https://stackoverflow.com/questions/56646062/how-to-convert-bson-to-json-effectively-with-mongo-go-driver", "title": "How to convert bson to json effectively with mongo-go-driver?", "body": "<p>I want to convert bson in <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">mongo-go-driver</a> to json effectively.</p>\n\n<p>I should take care to handle <code>NaN</code>, because <code>json.Marshal</code> fail if <code>NaN</code> exists in data.</p>\n\n<p>For instance, I want to convert below bson data to json.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>b, _ := bson.Marshal(bson.M{\"a\": []interface{}{math.NaN(), 0, 1}})\n// How to convert b to json?\n</code></pre>\n\n<p>The below fails.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// decode\nvar decodedBson bson.M\nbson.Unmarshal(b, &amp;decodedBson)\n_, err := json.Marshal(decodedBson)\nif err != nil {\n    panic(err) // it will be invoked\n    // panic: json: unsupported value: NaN\n}\n</code></pre>\n"}, {"tags": ["http", "go", "https", "server", "http-headers"], "answers": [{"comments": [{"owner": {"reputation": 683, "user_id": 3598726, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/kpm0C.png?s=128&g=1", "display_name": "user3598726", "link": "https://stackoverflow.com/users/3598726/user3598726"}, "edited": false, "score": 0, "creation_date": 1560850855, "post_id": 56646077, "comment_id": 99862193, "body": "Ok I saw that too, I figured the headers are added automatically, becouse I did not set them, but they did appear. My looping through the w.Header object is after calling ResponseWriter.Write(). My problem is not that some go library is adding headers, be it. My problem is how can I acces them inside the sayhello function"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 683, "user_id": 3598726, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/kpm0C.png?s=128&g=1", "display_name": "user3598726", "link": "https://stackoverflow.com/users/3598726/user3598726"}, "edited": false, "score": 0, "creation_date": 1560850943, "post_id": 56646077, "comment_id": 99862256, "body": "@user3598726 You can&#39;t access them. You may suppress them if you don&#39;t want them sent (see edited answer), or you may set them explicitly to some other value, if you set them, they won&#39;t be changed / overwritten."}, {"owner": {"reputation": 683, "user_id": 3598726, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/kpm0C.png?s=128&g=1", "display_name": "user3598726", "link": "https://stackoverflow.com/users/3598726/user3598726"}, "edited": false, "score": 0, "creation_date": 1560850986, "post_id": 56646077, "comment_id": 99862281, "body": "Thanks, How can I know which one to supress If I don&#39;t know which one will be set? I can&#39;t find documentation about which headers will be added implicitly by the library"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 683, "user_id": 3598726, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/kpm0C.png?s=128&g=1", "display_name": "user3598726", "link": "https://stackoverflow.com/users/3598726/user3598726"}, "edited": false, "score": 0, "creation_date": 1560851442, "post_id": 56646077, "comment_id": 99862550, "body": "@user3598726 <code>ResponseWriter.Write()</code> documents it may add <code>Content-Type</code> and <code>Content-Length</code>. And another automatic header is <code>Date</code>. As your test shows, there is no other at the moment."}, {"owner": {"reputation": 683, "user_id": 3598726, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/kpm0C.png?s=128&g=1", "display_name": "user3598726", "link": "https://stackoverflow.com/users/3598726/user3598726"}, "edited": false, "score": 0, "creation_date": 1560859499, "post_id": 56646077, "comment_id": 99867071, "body": "Thanks u helped a lot, I still can&#39;t wrap my head around not being able to acces those headers. Shall I use a lower level library?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 683, "user_id": 3598726, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/kpm0C.png?s=128&g=1", "display_name": "user3598726", "link": "https://stackoverflow.com/users/3598726/user3598726"}, "edited": false, "score": 0, "creation_date": 1560860538, "post_id": 56646077, "comment_id": 99867751, "body": "@user3598726 There is no API to access them, and they are not added to the headers map, they are just written to the output. If you truly must inspect them, you could <a href=\"https://golang.org/pkg/net/http/#example_Hijacker\" rel=\"nofollow noreferrer\">hijack the connection</a>, but then you must speak raw HTTP."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1560851076, "last_edit_date": 1560851076, "creation_date": 1560850621, "answer_id": 56646077, "question_id": 56646030, "link": "https://stackoverflow.com/questions/56646030/how-to-check-implicitly-set-http-headers-with-golang-server/56646077#56646077", "title": "How to check implicitly set http headers with golang server?", "body": "<p>Those headers are sent automatically when you call <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\"><code>ResponseWriter.Write()</code></a>. Quoting from its doc:</p>\n\n<pre><code>// Write writes the data to the connection as part of an HTTP reply.\n//\n// If WriteHeader has not yet been called, Write calls\n// WriteHeader(http.StatusOK) before writing the data. If the Header\n// does not contain a Content-Type line, Write adds a Content-Type set\n// to the result of passing the initial 512 bytes of written data to\n// DetectContentType. Additionally, if the total size of all written\n// data is under a few KB and there are no Flush calls, the\n// Content-Length header is added automatically.\n//\n// Depending on the HTTP protocol version and the client, calling\n// Write or WriteHeader may prevent future reads on the\n// Request.Body. For HTTP/1.x requests, handlers should read any\n// needed request body data before writing the response. Once the\n// headers have been flushed (due to either an explicit Flusher.Flush\n// call or writing enough data to trigger a flush), the request body\n// may be unavailable. For HTTP/2 requests, the Go HTTP server permits\n// handlers to continue to read the request body while concurrently\n// writing the response. However, such behavior may not be supported\n// by all HTTP/2 clients. Handlers should read before writing if\n// possible to maximize compatibility.\nWrite([]byte) (int, error)\n</code></pre>\n\n<p><code>ResponseWriter.Header()</code> contains only the headers set explicitly. The <code>Content-Type</code> and <code>Content-Length</code> were sent by <code>w.Write()</code>.</p>\n\n<p>Note: if you want to suppress such automatic headers, you have to set their values to <code>nil</code>, e.g.:</p>\n\n<pre><code>w.Header()[\"Date\"] = nil\n</code></pre>\n\n<p>Also note that if you set the values of such headers manually, those values will be sent without being changed.</p>\n"}], "owner": {"reputation": 683, "user_id": 3598726, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/kpm0C.png?s=128&g=1", "display_name": "user3598726", "link": "https://stackoverflow.com/users/3598726/user3598726"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1924, "favorite_count": 0, "accepted_answer_id": 56646077, "answer_count": 1, "score": 0, "last_activity_date": 1560851076, "creation_date": 1560850446, "question_id": 56646030, "link": "https://stackoverflow.com/questions/56646030/how-to-check-implicitly-set-http-headers-with-golang-server", "title": "How to check implicitly set http headers with golang server?", "body": "<p>I created a simple http2 server, \nIf I send a request to it with curl, it responds with some headers, although I did not set them explicity. How can I acces them inside the requesthandling function ( sayhello )? My code ( I've never used golang before)</p>\n\n<p>server.go</p>\n\n<pre><code>package main\n\nimport (\n  \"net/http\"\n  \"strings\"\n  \"fmt\"\n  \"github.com/gorilla/mux\"\n  \"golang.org/x/net/http2\"\n)\n\nfunc sayHello(w http.ResponseWriter, r *http.Request) {\n  message := r.URL.Path\n  message = strings.TrimPrefix(message, \"/\")\n  message = \"Hello \" + message\n\n  w.Header().Set(\"myFirst\", \"golangQuestion\")\n  w.Write([]byte(message))\n  for k, v := range w.Header() {\n    fmt.Println(\"[RESPONSE][Header]\", k,\":\", v)\n    }\n}\n\nfunc main() {\n    router := mux.NewRouter()\n    router.PathPrefix(\"/\").HandlerFunc(sayHello) // catch everything else rule\n    var srv = &amp;http.Server{\n        Addr: \"127.0.0.1:8081\",\n    }\n    http2.ConfigureServer(srv, nil)\n    srv.Handler = router\n    sslCert := \"./ssl.cert\"\n    sslKey := \"./ssl.key\"\n    if err := srv.ListenAndServeTLS(sslCert, sslKey); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Sending request: </p>\n\n<blockquote>\n  <p>curl --head --insecure <a href=\"https://127.0.0.1:8081\" rel=\"nofollow noreferrer\">https://127.0.0.1:8081</a></p>\n</blockquote>\n\n<pre><code>HTTP/1.1 200 OK\nMyfirst: golangQuestion\nDate: Tue, 18 Jun 2019 09:18:29 GMT\nContent-Length: 6\nContent-Type: text/plain; charset=utf-8\n</code></pre>\n\n<p>I can see that some headers are sent back, the one which I set explicitly is also recieved, but the output of </p>\n\n<blockquote>\n  <p>go run server.go</p>\n</blockquote>\n\n<pre><code>[RESPONSE][Header] Myfirst : [golangQuestion]\n</code></pre>\n\n<p>How can I acces the other headers, which were not explicitly set, but recieved by curl as well? I loopd through <em>w.Headers</em>, but it did not contain the implicitly set headers</p>\n\n<pre><code>  for k, v := range w.Header() {\n    fmt.Println(\"[RESPONSE][Header]\", k,\":\", v)\n    }\n</code></pre>\n\n<p>My expectation that the output of go run server.go shall be something like this:</p>\n\n<pre><code>[RESPONSE][Header] Myfirst : [golangQuestion]\n[RESPONSE][Header] Date: [2019.02.12 ]\n[RESPONSE][Header] Content-Length: [6]\n</code></pre>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 1, "creation_date": 1560851823, "post_id": 56645995, "comment_id": 99862760, "body": "Just use the httptest server <a href=\"https://golang.org/pkg/net/http/httptest/#example_Server\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/httptest/#example_Server</a> and don&#39;t try to mock this in Go. There you can manipulate all the data you want."}, {"owner": {"reputation": 705, "user_id": 3327209, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/Zf6KK.jpg?s=128&g=1", "display_name": "Abhishek Jha", "link": "https://stackoverflow.com/users/3327209/abhishek-jha"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1560912684, "post_id": 56645995, "comment_id": 99888310, "body": "this creates a new mock http server. It does not capture the request made to other servers. So it wont solve the purpose in this case"}], "answers": [{"tags": [], "owner": {"reputation": 705, "user_id": 3327209, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/Zf6KK.jpg?s=128&g=1", "display_name": "Abhishek Jha", "link": "https://stackoverflow.com/users/3327209/abhishek-jha"}, "is_accepted": true, "score": 0, "last_activity_date": 1560914778, "creation_date": 1560914778, "answer_id": 56659617, "question_id": 56645995, "link": "https://stackoverflow.com/questions/56645995/validate-request-body-using-github-com-jarcoal-httpmock/56659617#56659617", "title": "Validate request Body using github.com/jarcoal/httpmock", "body": "<p>Following @georgeok Suggestion,\nWe can create a mock <a href=\"https://golang.org/pkg/net/http/httptest/#NewServer\" rel=\"nofollow noreferrer\">http server</a> and capture the request body when request is made.\nFollowing is the code snippet to create a server and store the request body.</p>\n\n<pre><code>server := httptest.NewServer(http.HandlerFunc(func(rw http.ResponseWriter, req *http.Request) {\n        actualRequestBody, err = ioutil.ReadAll(req.Body)\n        check(err)\n        // Send mock response to be tested\n        _, err := rw.Write(bytes)\n        check(err)\n    }))\n\n    defer server.Close()\n</code></pre>\n\n<p>Now our request body is stored on <code>actualRequestBody</code> variable, and we can assert on this for correctness.</p>\n\n<p>The only thing necessary to make sure this works is to make the call at host <code>server.URL</code>. As it spins up a server on the address mentioned at <code>server.URL</code>. So if the call from your code is being made to different server this will not catch it.</p>\n"}], "owner": {"reputation": 705, "user_id": 3327209, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/Zf6KK.jpg?s=128&g=1", "display_name": "Abhishek Jha", "link": "https://stackoverflow.com/users/3327209/abhishek-jha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 56659617, "answer_count": 1, "score": 0, "last_activity_date": 1560914778, "creation_date": 1560850356, "question_id": 56645995, "link": "https://stackoverflow.com/questions/56645995/validate-request-body-using-github-com-jarcoal-httpmock", "title": "Validate request Body using github.com/jarcoal/httpmock", "body": "<p>The function I am trying to test accepts data structs, forms a <code>query_dsl</code> and then makes a <code>/_search</code> call to elastic search with the formed query.\nHence I want to assert on the <code>query_dsl</code> and <code>url</code> which gets formed.</p>\n\n<p>I am using <code>github.com/jarcoal/httpmock</code> to mock <code>net/http</code> requests in my unit tests. As per the doc it exposes <code>func GetCallCountInfo() map[string]int</code> to validate how many times a particular endpoint was hit.\nBut I am also interested in knowing what was the request body when this call was made.</p>\n\n<p><code>http.Client</code> is not exposed, hence can not override/mock that for testing.</p>\n\n<p>If it is not possible using this package then is there any other library which can mock the network request and also gives hold of request body?</p>\n"}, {"tags": ["dictionary", "go", "concurrency", "synchronization"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1560848422, "last_edit_date": 1560848422, "creation_date": 1560846807, "answer_id": 56644905, "question_id": 56644771, "link": "https://stackoverflow.com/questions/56644771/how-to-solve-fatal-error-concurrent-map-read-and-map-write/56644905#56644905", "title": "How to solve fatal error: concurrent map read and map write", "body": "<p>In <code>Round()</code> you lock the <code>getHeightMu</code> mutex, and you call <code>getHeightManager()</code>. In which you again try to lock the same mutex.</p>\n\n<p>Go's mutex is not <a href=\"https://en.wikipedia.org/wiki/Reentrancy_(computing)\" rel=\"nofollow noreferrer\"><em>reentrant</em></a>, which means it cannot be locked again by the same goroutine if it is already locked. For details see <a href=\"https://stackoverflow.com/questions/14670979/recursive-locking-in-go\">Recursive locking in Go</a>.</p>\n\n<p>Attempting to lock an already locked mutex is a blocking operation. It will block as long as the mutex gets unlocked and your goroutine is the lucky one that gets to lock it again (if other goroutines are also waiting on it). But the unlock would only come when <code>Round()</code> returns which requires <code>getHeightManager()</code> to complete, which will never happen. It is a deadlock.</p>\n\n<p>You only need to lock the mutex in one place, close to were you access it. So only use locking inside <code>getHeightManager()</code>, and remove the locking from <code>Round()</code> (it doesn't access the protected resource anyway).</p>\n\n<p>Also depending how frequently new height managers are created and added to the map, it may be profitable to use a <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"nofollow noreferrer\"><code>sync.RWMutex</code></a>. You could first lock it for reading only, and if the height manager already exists, you can return it. The good side of this is that multiple readers could access it simultaneously without blocking each other. Only if you find the height manager does not exist yet would you have to acquire a write lock.</p>\n"}], "owner": {"reputation": 31, "user_id": 11663014, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-a6bQE5L-Cvo/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcYzTtY7HMdIOSjzd53E3RO6hu8Jg/mo/photo.jpg?sz=128", "display_name": "frank", "link": "https://stackoverflow.com/users/11663014/frank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1882, "favorite_count": 0, "accepted_answer_id": 56644905, "answer_count": 1, "score": 1, "last_activity_date": 1560874924, "creation_date": 1560846266, "last_edit_date": 1560874924, "question_id": 56644771, "link": "https://stackoverflow.com/questions/56644771/how-to-solve-fatal-error-concurrent-map-read-and-map-write", "title": "How to solve fatal error: concurrent map read and map write", "body": "<p>I'm writing some program in Go, I get this crash:</p>\n\n<pre><code>fatal error: concurrent map read and map write\n\n\nconsensus/bft.(*ConsensusManager).getHeightManager(0xc42009a7e0, 0x37, 0x0)\n\nconsensus/bft/bft_manager.go:246 +0x9b fp=0xc42b033258 sp=0xc42b033208 pc=0xaf1d7b\nconsensus/bft.(*HeightManager).Round(...)\nconsensus/bft/bft_manager.go:239\nconsensus/bft.(*ConsensusManager).Round(0xc42009a7e0, 0x37)\n</code></pre>\n\n<p>This is my code</p>\n\n<pre><code>type ConsensusManager struct {\n    pm                      *ProtocolManager\n    chain                   *core.BlockChain\n    coinbase                common.Address\n    readyValidators         map[common.Address]struct{}\n    trackedProtocolFailures []string\n    heights                 map[uint64]*HeightManager\n    blockCandidates         map[common.Hash]btypes.Proposal\n\n    currentBlock *types.Block\n    found        chan *types.Block\n\n    mu          sync.Mutex\n    writeMapMu  sync.RWMutex\n    getHeightMu sync.RWMutex\n    processMu sync.Mutex\n}\nfunc (cm *ConsensusManager) Round() uint64 {\n    return cm.getHeightManager(cm.Height()).Round()\n}\n\nfunc (cm *ConsensusManager) getHeightManager(h uint64) *HeightManager {\n\n    if _, ok := cm.heights[h]; !ok {\n        cm.heights[h] = NewHeightManager(cm, h)\n    }\n\n    return cm.heights[h]\n}\n</code></pre>\n\n<p>I try to Use RWMutex to Luck, but the code can't  work </p>\n\n<pre><code>func (cm *ConsensusManager) Round() uint64 {\n        cm.getHeightMu.Lock()\n    defer cm.getHeightMu.Unlock()\n\n    return cm.getHeightManager(cm.Height()).Round()\n}\n\nfunc (cm *ConsensusManager) getHeightManager(h uint64) *HeightManager {\n        cm.getHeightMu.Lock()\n    defer cm.getHeightMu.Unlock()\n\n        if _, ok := cm.heights[h]; !ok {\n        cm.heights[h] = NewHeightManager(cm, h)\n    }\n\n    return cm.heights[h]\n}\n\n</code></pre>\n\n<p>What's wrong with my solutions?</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1560841863, "post_id": 56643019, "comment_id": 99857307, "body": "Use pointers instead of values, ie <code>[]*Carousel</code>. If you use values, then inside the loop the <code>carousel</code> variable is a <b>copy</b> of what&#39;s in the slice, and changing the copy won&#39;t change the original. Alternatively you can use index to update the content of the slice directly, ie <code>(*carousels)[i].LastRun = time.Now()</code>."}, {"owner": {"reputation": 676, "user_id": 197879, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a8af0fed40a458dc9eb29682e946c0da?s=128&d=identicon&r=PG", "display_name": "dr. squid", "link": "https://stackoverflow.com/users/197879/dr-squid"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1560842394, "post_id": 56643019, "comment_id": 99857597, "body": "Nice! I tried using *carousels[i].LastRun = time.Now() without parentheses, but with parentheses it works perfekt!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560849358, "post_id": 56643019, "comment_id": 99861258, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/q/6476343/13860\">stackoverflow.com/q/6476343/13860</a>"}], "answers": [{"tags": [], "owner": {"reputation": 868, "user_id": 4113109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c8272ee0ba8d6fb56ed64c4c116f80d?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya Satyavada", "link": "https://stackoverflow.com/users/4113109/aditya-satyavada"}, "is_accepted": false, "score": 0, "last_activity_date": 1560842876, "creation_date": 1560842876, "answer_id": 56643831, "question_id": 56643019, "link": "https://stackoverflow.com/questions/56643019/updating-a-value-from-a-struct-in-golang/56643831#56643831", "title": "Updating a value from a struct in Golang", "body": "<p>To update the carouselstruct, you can do this:</p>\n\n<pre><code>func Sequencer(carousels []*Carousel) {\n\nticker := time.NewTicker(1000 * time.Millisecond)\nfor range ticker.C {\n    for i, _ := range carousels {\n        carousel = carousels[i]\n        next := carousel.LastRun.Add(time.Millisecond * time.Duration(carousel.Duration))\n        if next.Sub(time.Now()) &lt;= 0 {\n            fmt.Println(\"Carousel: \", carousel.Name, \"Last run: \", time.Since(carousel.LastRun))\n            carousel.LastRun = time.Now()\n        }\n    }\n  }\n}\n</code></pre>\n\n<p>When using <code>range</code>, the value used(for the <code>carousel</code> var in your case) is a copy of the element in the slice. Hence, even by updating it, it will not update the element in the actual list.</p>\n\n<p>To do so, you need to access the index of the slice you need to update and then perform your changes.</p>\n"}], "owner": {"reputation": 676, "user_id": 197879, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a8af0fed40a458dc9eb29682e946c0da?s=128&d=identicon&r=PG", "display_name": "dr. squid", "link": "https://stackoverflow.com/users/197879/dr-squid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 431, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1564033490, "creation_date": 1560839786, "last_edit_date": 1564033490, "question_id": 56643019, "link": "https://stackoverflow.com/questions/56643019/updating-a-value-from-a-struct-in-golang", "title": "Updating a value from a struct in Golang", "body": "<p>I am struggling updating a field coming from Gorm. I am loading all carousels from the database, and have a ticker that checks the field \"LastRun\", and I want to set a new time.Now() value when it is run.</p>\n\n<p>For now, I only need the loaded struct to be updated, so I know this does not write the changes to the DB at this moment.</p>\n\n<p>How do I update the field carousel.LastRun in func Sequencer() in this example? It keeps having the old value from the DB whatever I do...</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n    \"sync\"\n    \"time\"\n)\n\nvar (\n    db *gorm.DB\n    wg = &amp;sync.WaitGroup{}\n)\n\ntype Carousel struct {\n    gorm.Model\n    Name        string\n    Description string\n    Duration    uint\n    LastRun     time.Time\n    Index       uint8\n    State       State\n}\n\ntype State struct {\n    Type string\n}\n\nfunc main() {\n    path := \"pkg/database/database.db\"\n    db, err := gorm.Open(\"sqlite3\", path)\n    if err != nil {\n        panic(\"failed to connect database\")\n    }\n    defer db.Close()\n\n    db.AutoMigrate(&amp;Carousel{})\n\n    var carousels []Carousel\n    db.Find(&amp;carousels)\n    wg.Add(1)\n    Sequencer(&amp;carousels)\n    wg.Wait()\n}\n\nfunc Sequencer(carousels *[]Carousel) {\n\n    ticker := time.NewTicker(1000 * time.Millisecond)\n    for range ticker.C {\n        for _, carousel := range *carousels {\n            next := carousel.LastRun.Add(time.Millisecond * time.Duration(carousel.Duration))\n            if next.Sub(time.Now()) &lt;= 0 {\n                fmt.Println(\"Carousel: \", carousel.Name, \"Last run: \", time.Since(carousel.LastRun))\n                carousel.LastRun = time.Now()\n                /* How do I update the carousel.LastRun ? */\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "type-conversion"], "comments": [{"owner": {"reputation": 13, "user_id": 11654029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c09f7978032274e0c7e6f345d27356e?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/11654029/daniel"}, "edited": false, "score": 1, "creation_date": 1560833612, "post_id": 56641843, "comment_id": 99854337, "body": "Look here: <a href=\"https://stackoverflow.com/questions/19223277/how-to-convert-uint8-to-string/21520223\">enter link description here</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1560835036, "post_id": 56641843, "comment_id": 99854701, "body": "<a href=\"https://tour.golang.org/basics/13\" rel=\"nofollow noreferrer\">tour.golang.org/basics/13</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1560838920, "post_id": 56641843, "comment_id": 99855969, "body": "Simply <code>string(uint8slice)</code>. See <a href=\"https://stackoverflow.com/questions/28848187/how-to-convert-int8-to-string/28848879?r=SearchResults#28848879\">How to convert &#91;&#93;int8 to string</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1560849392, "post_id": 56641843, "comment_id": 99861285, "body": "Note that&#39;s a slice, not an array."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1560849993, "creation_date": 1560849993, "answer_id": 56645881, "question_id": 56641843, "link": "https://stackoverflow.com/questions/56641843/how-to-convert-uint8-array-to-string/56645881#56645881", "title": "How to convert uint8 array to string", "body": "<p><a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"nofollow noreferrer\"><code>byte</code> is an alias for <code>uint8</code></a>, which means that a slice of <code>uint8</code>) (aka <code>[]uint8</code>) is also a slice of <code>byte</code> (aka <code>[]byte</code>).</p>\n\n<p>And byte slices and strings are directly convertible, due to the fact that strings are backed by byte slices:</p>\n\n<pre><code>myByteSlice := []byte{ ... }     // same as myByteSlice := []uint8{ ... }\nmyString := string(myByteSlice)  // myString is a string representation of the byte slice\nmyOtherSlice := []byte(myString) // Converted back to byte slice\n</code></pre>\n"}], "owner": {"reputation": 511, "user_id": 6477475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc03819aa3dd8d238ad98868b886add6?s=128&d=identicon&r=PG&f=1", "display_name": "Le D. Thang", "link": "https://stackoverflow.com/users/6477475/le-d-thang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2292, "favorite_count": 2, "accepted_answer_id": 56645881, "answer_count": 1, "score": -3, "last_activity_date": 1560849993, "creation_date": 1560832648, "last_edit_date": 1560846346, "question_id": 56641843, "link": "https://stackoverflow.com/questions/56641843/how-to-convert-uint8-array-to-string", "title": "How to convert uint8 array to string", "body": "<p>What's the best way to convert from []uint8 to string?</p>\n\n<p>I'm using <a href=\"http://github.com/confluentinc/confluent-kafka-go/kafka\" rel=\"nofollow noreferrer\">http://github.com/confluentinc/confluent-kafka-go/kafka</a></p>\n\n<p>To read events from kafka. But it does not return plain string event.\nIt returns event with type []uint8 \nHow can I convert this event from []uint8 to string?</p>\n"}, {"tags": ["api", "go", "controller", "openstack", "beego"], "owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1560831260, "creation_date": 1560831260, "question_id": 56641671, "link": "https://stackoverflow.com/questions/56641671/status-changes-by-calling-openstack-api-from-beego-reactjs", "title": "Status changes by calling openstack api from Beego, Reactjs", "body": "<p><strong>We're using:</strong></p>\n\n<p>Backend - Beego (golang)</p>\n\n<p>Frontend - Reactjs</p>\n\n<p>Server - Openstack</p>\n\n<p><strong>So:</strong></p>\n\n<p>When reactjs calls listSomethingAPI, I calls openstackAPI and Openstack gives me that List.</p>\n\n<p>it has some fields like this:</p>\n\n<p><code>id | name | status</code></p>\n\n<p><strong>Problem is:</strong></p>\n\n<p>When Frontend calls PUT api, I calls API. But Openstack status change takes almost 10 seconds</p>\n\n<p><strong>Question:</strong> </p>\n\n<p>How do i know status changes when frontend calls PUT api</p>\n\n<p><strong>Solution that i found:</strong></p>\n\n<p>frontend calls ListAPI every 5 seconds.</p>\n\n<p><strong>We cant use</strong>:</p>\n\n<p>Websocket, AJAX</p>\n\n<p>Is there any way to solve this problem?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1560831488, "post_id": 56641653, "comment_id": 99853919, "body": "Your <code>requestBody</code> struct should declare a <code>transaction_details</code>, which is of a type struct with <code>trans_no</code> property."}], "answers": [{"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 1, "last_activity_date": 1560831670, "creation_date": 1560831670, "answer_id": 56641721, "question_id": 56641653, "link": "https://stackoverflow.com/questions/56641653/failed-get-post-request-in-golang/56641721#56641721", "title": "failed get post request in golang", "body": "<p>Your <code>requestBody</code> struct would unmarshal correctly if your post data was:</p>\n\n<pre><code>{\n    \"trans_no\": \"12400099\",\n    \"gross_amount\": 50000\n}\n</code></pre>\n\n<p>but since that information is nested one deeper, you need to include that nesting in your model.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var requestBody struct {\n    TransactionDetails struct {\n        TransNo string `json:\"trans_no\"`\n    } `json:\"transaction_details\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 8879112, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3oDWjWF3gao/AAAAAAAAAAI/AAAAAAAAACo/Hk78wucupQo/photo.jpg?sz=128", "display_name": "achmad syarippudin", "link": "https://stackoverflow.com/users/8879112/achmad-syarippudin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 56641721, "answer_count": 1, "score": -1, "last_activity_date": 1597293121, "creation_date": 1560831081, "last_edit_date": 1597293121, "question_id": 56641653, "link": "https://stackoverflow.com/questions/56641653/failed-get-post-request-in-golang", "title": "failed get post request in golang", "body": "<p>I have a problem how to get post request on Go.</p>\n<p>I was trying <code>json.Unmarshal()</code> but its still not working</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package controllers\n\nimport (\n    &quot;encoding/json&quot;\n    &quot;net/http&quot;\n\n    &quot;github.com/gin-gonic/gin&quot;\n)\n\n//CreateOrder function\nfunc CreateOrder(c *gin.Context) {\n\n    var requestBody struct {\n        TransNo string `json:&quot;trans_no&quot;`\n    }\n\n    err := json.NewDecoder(c.Request.Body).Decode(&amp;requestBody)\n\n    if err != nil {\n        panic(err)\n    }\n\n    c.JSON(http.StatusOK, gin.H{&quot;data&quot;: requestBody.TransNo})\n\n}\n</code></pre>\n<p>I no have any errors, but the result not showing anything.</p>\n<p>this my post data:</p>\n<pre><code>{\n  &quot;transaction_details&quot;: {\n    &quot;trans_no&quot;: &quot;12400099&quot;,\n    &quot;gross_amount&quot;: 50000\n  }\n}\n</code></pre>\n<p>I want to get <code>trans_no</code> value</p>\n"}, {"tags": ["go", "cluster-analysis", "k-means"], "comments": [{"owner": {"reputation": 2753, "user_id": 10878733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pwhdv.jpg?s=128&g=1", "display_name": "Shubham Panchal", "link": "https://stackoverflow.com/users/10878733/shubham-panchal"}, "edited": false, "score": 3, "creation_date": 1560835772, "post_id": 56641533, "comment_id": 99854900, "body": "Try including the work which you have done until now. Elaborate your problem to get detailed explanations."}, {"owner": {"reputation": 8410, "user_id": 202553, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Clpiv.jpg?s=128&g=1", "display_name": "knb", "link": "https://stackoverflow.com/users/202553/knb"}, "edited": false, "score": 0, "creation_date": 1561462897, "post_id": 56641533, "comment_id": 100063978, "body": "I think you need to set a random seed to get reproducible results. See Q <a href=\"https://stackoverflow.com/questions/12321133/golang-random-number-generator-how-to-seed-properly\">Golang random number generator how to seed properly</a>  (from 2012)"}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "edited": false, "score": 0, "creation_date": 1561649187, "post_id": 56660831, "comment_id": 100143216, "body": "i was actually confused about what information do i need to save , only centers or anyother?"}, {"owner": {"reputation": 70452, "user_id": 1060350, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/XCkw7.jpg?s=128&g=1", "display_name": "Has QUIT--Anony-Mousse", "link": "https://stackoverflow.com/users/1060350/has-quit-anony-mousse"}, "reply_to_user": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "edited": false, "score": 0, "creation_date": 1561661348, "post_id": 56660831, "comment_id": 100148630, "body": "Just think through what the algorithm does... Easier than Googling for a library."}], "tags": [], "owner": {"reputation": 70452, "user_id": 1060350, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/XCkw7.jpg?s=128&g=1", "display_name": "Has QUIT--Anony-Mousse", "link": "https://stackoverflow.com/users/1060350/has-quit-anony-mousse"}, "is_accepted": false, "score": 0, "last_activity_date": 1560923627, "creation_date": 1560923627, "answer_id": 56660831, "question_id": 56641533, "link": "https://stackoverflow.com/questions/56641533/how-to-save-the-clustering-model-using-go/56660831#56660831", "title": "How to save the clustering model using go?", "body": "<p>Seriously? You need a \"package\" to save k vectors?</p>\n\n<p>Just <strong>save the vectors yourself</strong>, and rather avoid adding too many dependencies that can break.</p>\n"}], "owner": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1560923627, "creation_date": 1560829904, "last_edit_date": 1560849783, "question_id": 56641533, "link": "https://stackoverflow.com/questions/56641533/how-to-save-the-clustering-model-using-go", "title": "How to save the clustering model using go?", "body": "<p>I wrote a clustering algorithm for k means using go, and I want to save that model so that it can run next time using that saved information.</p>\n\n<p>I want to ask how to go about it. Some direction or some library or package would be very helpful. Thanks.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-platform"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1560821201, "last_edit_date": 1560821201, "creation_date": 1560820784, "answer_id": 56640617, "question_id": 56639506, "link": "https://stackoverflow.com/questions/56639506/google-app-engine-is-not-finding-files-in-go-runtime/56640617#56640617", "title": "Google App Engine is not finding files in go runtime", "body": "<p>The function <code>runtime.Caller()</code> returns the compile time source file path. The application is not run in the same directory as where it was compiled.</p>\n\n<p>The application runs with the current working directory set to the directory containing app.yaml. Use this function to get the templates directory:</p>\n\n<pre><code>func getTemplatesDir() string {\n    return \"templates\"\n}\n</code></pre>\n"}], "owner": {"reputation": 144, "user_id": 5817748, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4_WauPfNYlQ/AAAAAAAAAAI/AAAAAAAAAhY/25dhIN10RXk/photo.jpg?sz=128", "display_name": "Alexander Richey", "link": "https://stackoverflow.com/users/5817748/alexander-richey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 56640617, "answer_count": 1, "score": 0, "last_activity_date": 1560930139, "creation_date": 1560809535, "last_edit_date": 1560930139, "question_id": 56639506, "link": "https://stackoverflow.com/questions/56639506/google-app-engine-is-not-finding-files-in-go-runtime", "title": "Google App Engine is not finding files in go runtime", "body": "<p>After adding a go.mod file, I am not able to access HTML template files from golang on App Engine. Everything works locally.</p>\n\n<p>I have verified that the HTML files exist on App Engine using Stackdriver Debug, but the runtime is not seeing them. Here is the code I have.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var templates map[string]*htmltpl.Template\n\nfunc init() {\n    if templates == nil {\n        templates = make(map[string]*htmltpl.Template)\n    }\n\n    templatesDir := getTemplatesDir()\n\n    layouts, err := filepath.Glob(templatesDir + \"/layouts/*.html\")\n    if err != nil {\n        panic(err)\n    }\n\n    includes, err := filepath.Glob(templatesDir + \"/includes/*.html\")\n    if err != nil {\n        panic(err)\n    }\n\n    // Generate our templates map from our layouts/ and includes/ directories\n    for _, layout := range layouts {\n        files := append(includes, layout)\n        templates[filepath.Base(layout)] = htmltpl.Must(htmltpl.ParseFiles(files...))\n    }\n}\n\nfunc getTemplatesDir() string {\n    _, filename, _, ok := runtime.Caller(1)\n    if !ok {\n        panic(\"Could not get filename\")\n    }\n    dirpath := path.Join(path.Dir(filename), \"../../templates\")\n    return dirpath\n}\n\n</code></pre>\n\n<p>Here is my <code>app.yaml</code>:</p>\n\n<pre><code>runtime: go111\n\nmain: ./main\n\nhandlers:\n  - url: .*\n    script: auto\n    secure: always\n</code></pre>\n\n<p>And here is my directory structure:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 app.yaml\n\u251c\u2500\u2500 db/\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 go.sum\n\u251c\u2500\u2500 handlers/\n\u251c\u2500\u2500 main\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 main.go\n\u251c\u2500\u2500 middleware/\n\u251c\u2500\u2500 models/\n\u251c\u2500\u2500 static/\n\u251c\u2500\u2500 templates/\n\u2502   \u251c\u2500\u2500 includes\n\u2502   \u2502\u00a0\u00a0 \u251c\u2500\u2500 base.html\n\u2502   \u2502\u00a0\u00a0 \u251c\u2500\u2500 button.html\n\u2502   \u2502\u00a0\u00a0 \u251c\u2500\u2500 message.html\n\u2502   \u2502\u00a0\u00a0 \u2514\u2500\u2500 profile.html\n\u2502   \u2514\u2500\u2500 layouts\n\u2502       \u2514\u2500\u2500 thread.html\n\u2514\u2500\u2500 utils\n    \u2514\u2500\u2500 template\n     \u00a0\u00a0 \u2514\u2500\u2500 template.go\n</code></pre>\n\n<p>I don't understand why, on App Engine, the call to <code>filepath.Glob(templatesDir + \"/layouts/*.html\")</code> returns an empty slice, whereas it returns a slice containing the path to <code>thread.html</code> when running locally.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 4, "creation_date": 1560807283, "post_id": 56639123, "comment_id": 99849215, "body": "Have a look at some docs first to understand more about the language. For example: <a href=\"https://gobyexample.com/structs\" rel=\"nofollow noreferrer\">gobyexample.com/structs</a>, <a href=\"https://gobyexample.com/interfaces\" rel=\"nofollow noreferrer\">gobyexample.com/interfaces</a> and <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1560807399, "post_id": 56639123, "comment_id": 99849245, "body": "And of course the <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">Tour of Go</a>"}, {"owner": {"reputation": 13, "user_id": 11661209, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3LPEjiE9qqE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc7fUE6SJaofCTdbC8hBQM9QLGHzQ/mo/photo.jpg?sz=128", "display_name": "Shubham Agarawal", "link": "https://stackoverflow.com/users/11661209/shubham-agarawal"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1560807927, "post_id": 56639123, "comment_id": 99849375, "body": "I have tried these sites before but can&#39;t get much information from it. I got confused with its use. I understand its part with normal data types but not with structs. @georgeok"}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1560808373, "post_id": 56639123, "comment_id": 99849499, "body": "You would be better off getting a book and understand the fundamental of the language."}, {"owner": {"reputation": 13, "user_id": 11661209, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3LPEjiE9qqE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc7fUE6SJaofCTdbC8hBQM9QLGHzQ/mo/photo.jpg?sz=128", "display_name": "Shubham Agarawal", "link": "https://stackoverflow.com/users/11661209/shubham-agarawal"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1560808539, "post_id": 56639123, "comment_id": 99849537, "body": "Can you please help me with this problem as I have to submit my assignment by tomorrow and I have less time left @georgeok. After completing my assignment I will purchase a good book for it and clear my concepts. Thanks"}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1560809293, "post_id": 56639123, "comment_id": 99849741, "body": "I can give you a couple of hints and hope you&#39;ll get the job done. SlackNotificationProvider and Notifier are different types. ProviderType.Slack is invalid syntax since Slack filed has to be initialised on the struct instance. Type comparison is done with someInterface.(type)."}, {"owner": {"reputation": 13, "user_id": 11661209, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3LPEjiE9qqE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc7fUE6SJaofCTdbC8hBQM9QLGHzQ/mo/photo.jpg?sz=128", "display_name": "Shubham Agarawal", "link": "https://stackoverflow.com/users/11661209/shubham-agarawal"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1560809826, "post_id": 56639123, "comment_id": 99849888, "body": "Thanks, @georgeok. I will try to solve my problems with it."}, {"owner": {"reputation": 13, "user_id": 11661209, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3LPEjiE9qqE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc7fUE6SJaofCTdbC8hBQM9QLGHzQ/mo/photo.jpg?sz=128", "display_name": "Shubham Agarawal", "link": "https://stackoverflow.com/users/11661209/shubham-agarawal"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1560810214, "post_id": 56639123, "comment_id": 99849994, "body": "@georgeok <a href=\"https://stackoverflow.com/a/24809384/11661209\">stackoverflow.com/a/24809384/11661209</a> In this example, they have initialized it in the same way I had done. What is the difference then? Also, this is my Notifier interface <code>golang type Notifier interface { \tSendNotification() error } </code>"}, {"owner": {"reputation": 13, "user_id": 11661209, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3LPEjiE9qqE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc7fUE6SJaofCTdbC8hBQM9QLGHzQ/mo/photo.jpg?sz=128", "display_name": "Shubham Agarawal", "link": "https://stackoverflow.com/users/11661209/shubham-agarawal"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1560811150, "post_id": 56639123, "comment_id": 99850209, "body": "@georgeok, please help. I am very much confused."}], "answers": [{"tags": [], "owner": {"reputation": 2615, "user_id": 2480468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VNCmN.jpg?s=128&g=1", "display_name": "Tim Brown", "link": "https://stackoverflow.com/users/2480468/tim-brown"}, "is_accepted": true, "score": 0, "last_activity_date": 1560812550, "last_edit_date": 1560812550, "creation_date": 1560812111, "answer_id": 56639783, "question_id": 56639123, "link": "https://stackoverflow.com/questions/56639123/assistance-needed-with-struct-concept-in-golang/56639783#56639783", "title": "Assistance needed with struct concept in golang", "body": "<p>Golang is a strongly typed language, which means the arguments to your functions are defined and can't be different.  Strings are strings and only strings, structs are structs and only structs.  Interfaces are golang's way of saying \"This can be any struct that has method(s) with the following signatures\". So you can't pass a <code>string</code> as a <code>ProviderType</code> and none of your structs actually implement the interface method you've defined, so nothing would work as you've laid it out.  To reorganize what you've got into something that might work:</p>\n\n<pre><code>const (\n    discordType = \"discord\"\n    slackType = \"slack\"\n)\n\n// This means this will match any struct that defines a method of \n// SendNotification that takes no arguments and returns an error\ntype Notifier interface {\n    SendNotification() error\n}\n\ntype SlackNotificationProvider struct {\n    WebHookURL string\n}\n\n// Adding this method means that it now matches the Notifier interface\nfunc (s *SlackNotificationProvider) SendNotification() error {\n    // Do the work for slack here\n}\n\ntype DiscordNotificationProvider struct {\n   WebHookURL string\n}\n\n// Adding this method means that it now matches the Notifier interface\nfunc (s *DiscordNotificationProvider) SendNotification() error {\n    // Do the work for discord here\n}\n\nfunc NewNotifier(uri, typ string) Notifier {\n    switch typ {\n    case slackType:\n       return SlackNotificationProvider{\n            WebHookURL: uri,\n        }\n    case discordType:\n        return DiscordNotificationProvider{\n            WebHookURL: uri + \"/slack\",\n        }\n    }\n    return nil\n}\n// you'll need some way to figure out what type this is\n// could be a parser or something, or you could just pass it\nuri := config.Cfg.SlackWebHookURL\ntyp := getTypeOfWebhook(uri)\nslackNotifier := NewNotifier(uri, typ)\n</code></pre>\n\n<p>As far as documentation to help with this, the \"Go By Example\" stuff is good, and I see other people have already linked that.  That said, a struct with one method feels like it should be a function, which you can also define as a type to allow you to pass back a few things.  Example:</p>\n\n<pre><code>type Foo func(string) string\n\nfunc printer(f Foo, s string) {\n    fmt.Println(f(s))\n}\n\nfunc fnUpper(s string) string {\n    return strings.ToUpper(s)\n}\n\nfunc fnLower(s string) string {\n    return strings.ToLower(s)\n}\n\nfunc main() {\n   printer(fnUpper, \"foo\")\n   printer(fnLower, \"BAR\")\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 11661209, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3LPEjiE9qqE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc7fUE6SJaofCTdbC8hBQM9QLGHzQ/mo/photo.jpg?sz=128", "display_name": "Shubham Agarawal", "link": "https://stackoverflow.com/users/11661209/shubham-agarawal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 1, "accepted_answer_id": 56639783, "answer_count": 1, "score": -3, "last_activity_date": 1560812550, "creation_date": 1560806832, "last_edit_date": 1560810427, "question_id": 56639123, "link": "https://stackoverflow.com/questions/56639123/assistance-needed-with-struct-concept-in-golang", "title": "Assistance needed with struct concept in golang", "body": "<p>I want to use slacknotificationprovider in the NewNotifier function. How can I do it. Also I want send a string(config.Cfg.SlackWebHookURL) in newNotifier function. What should I do? Also please suggest me some material to get a deeper knowledge of struct and interface in golang.\nI also want to know why ProviderType.Slack is not defined as I have mentioned it in ProviderType struct as of SlackNotificationProvider type? Thanks.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type SlackNotificationProvider struct {\n    SlackWebHookURL string\n    PostPayload     PostPayload\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type ProviderType struct {\n    Slack   SlackNotificationProvider\n    Discord DiscordNotificationProvider\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Notifier interface {\n    SendNotification() error\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func NewNotifier(providerType ProviderType) Notifier {\n    if providerType == ProviderType.Slack {\n        return SlackNotificationProvider{\n            SlackWebHookURL: SlackWebHookURL,\n        }\n    } else if providerType == ProviderType.Discord {\n        return DiscordNotificationProvider{\n            DiscordWebHookURL: SlackWebHookURL + \"/slack\",\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>slackNotifier := NewNotifier(config.Cfg.SlackWebHookURL)\n</code></pre>\n\n<p>Errors:\n1. cannot use config.Cfg.SlackWebHookURL (type string) as type ProviderType in argument to NewNotifiergo\n2. ProviderType.Slack undefined (type ProviderType has no method Slack)go</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 0, "creation_date": 1560798148, "post_id": 56637365, "comment_id": 99845752, "body": "yes about the quoted arguments that is where the code also went abit heavy if i have to write it myself. But the string in config should represent a complete shell command so i also will use quoted parameters - is there any way i can convert that into args so it can be supported by the Exec.Command ?"}, {"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 0, "creation_date": 1560798910, "post_id": 56637365, "comment_id": 99846057, "body": "maybe something like this : <a href=\"https://github.com/mattn/go-shellwords\" rel=\"nofollow noreferrer\">github.com/mattn/go-shellwords</a> or this : <a href=\"https://godoc.org/bitbucket.org/creachadair/shell\" rel=\"nofollow noreferrer\">godoc.org/bitbucket.org/creachadair/shell</a>"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 2, "last_activity_date": 1560801473, "last_edit_date": 1560801473, "creation_date": 1560798005, "answer_id": 56637365, "question_id": 56637338, "link": "https://stackoverflow.com/questions/56637338/args-and-passing-args-from-position1-not-position-0/56637365#56637365", "title": "Args and passing args from position[1] (not position 0)", "body": "<p>If the values coming it from the config file are in a format executable by shell, you're going to run into a host of problems just splitting on spaces (e.g. quoted arguments containing spaces). If you want to take in a command line that would be executable in a shell, you're going to want to have a shell execute it:</p>\n\n<pre><code>exec.Command(\"cmd.exe\", \"/c\", execmd)\n</code></pre>\n\n<p>There is no way of \"converting a string into args\" because it varies from shell to shell.</p>\n"}, {"comments": [{"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1560802363, "post_id": 56637826, "comment_id": 99847489, "body": "okay - you got any suggestions ? can it be done by regex or should i abort that route ?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1560804186, "post_id": 56637826, "comment_id": 99848232, "body": "I don&#39;t think a regex without lookarounds (which <code>pkg&#47;regexp</code> doesn&#39;t support) can do it. You&#39;d have to parse the string, or let a shell do the parsing for you."}, {"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1560808102, "post_id": 56637826, "comment_id": 99849427, "body": "seems there is an issue with windows and cmd using Command - instead i got it working with building the cmdline."}], "tags": [], "owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "is_accepted": false, "score": -1, "last_activity_date": 1560808225, "last_edit_date": 1560808225, "creation_date": 1560800096, "answer_id": 56637826, "question_id": 56637338, "link": "https://stackoverflow.com/questions/56637338/args-and-passing-args-from-position1-not-position-0/56637826#56637826", "title": "Args and passing args from position[1] (not position 0)", "body": "<p>I found this thread regarding the issue : <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/pNwqLyfl2co\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!topic/golang-nuts/pNwqLyfl2co</a></p>\n\n<p><strong>Edit 1:</strong> ( didnt work )</p>\n\n<p>And saw this one using RegExp - and found out how i can index into the args also :</p>\n\n<pre><code>r := regexp.MustCompile(\"'.+'|\\\".+\\\"|\\\\S+\")\ns := appConfig.JobExec.ExecProcess\nm := r.FindAllString(s, -1)\nExec.Command (m[0],m[1:])\n</code></pre>\n\n<p>This seems to work also with quoted strings !</p>\n\n<p><strong>Edit 2:</strong> </p>\n\n<p>It didnt work and didnt work on windows, theres an issue with params being passed on when running with cmd. Using sysprocattr.cmdline will make it work :</p>\n\n<pre><code>cmdins := exec.Command(cmd)\ncmdins.SysProcAttr = &amp;syscall.SysProcAttr{}\nfor _, arg := range args {\n    cmdins.SysProcAttr.CmdLine = cmdins.SysProcAttr.CmdLine + arg + \" \"\n}\n</code></pre>\n\n<p>the issue described here :    </p>\n\n<p><a href=\"https://github.com/golang/go/issues/17149\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/17149</a></p>\n"}], "owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1573461918, "creation_date": 1560797899, "last_edit_date": 1573461918, "question_id": 56637338, "link": "https://stackoverflow.com/questions/56637338/args-and-passing-args-from-position1-not-position-0", "title": "Args and passing args from position[1] (not position 0)", "body": "<p>I am reading a command line string from a config file (config.json) :</p>\n\n<pre><code>\"execmd\" : \"c:\\\\windows\\\\system32\\\\cmd.exe /c runscript.cmd\"\n</code></pre>\n\n<p>I want to pass this to <code>exec.Command()</code> - but this function requires 2 parameters:</p>\n\n<pre><code>exec.Comm*emphasized text*and (cmd, args...)\n</code></pre>\n\n<p>Where cmd is the first segment (cmd.exe) and args would then be every space deliminated value thereafter.</p>\n\n<ol>\n<li><p>I am not exactly sure if I need to read the config string, and then manually split it up in an array for each space deliminator? Is there any way of converting a string into args easily?</p></li>\n<li><p>How would it be possible to do something like this, where I can refer args... from an index? (the below code doesn't work, can't refer args this way)</p>\n\n<pre><code>exec.Command (arg[0], args[1]...)\n</code></pre></li>\n</ol>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1560797822, "post_id": 56637302, "comment_id": 99845630, "body": "You could change the type of your <code>Value</code> field to <code>interface{}</code> and type switch on it. &quot;How to handle it&quot; kind of depends on <i>what</i> you&#39;re actually doing with it."}, {"owner": {"reputation": 91, "user_id": 8398928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5bcecc6c029a3ac81350153317adcec?s=128&d=identicon&r=PG&f=1", "display_name": "R.Slaby", "link": "https://stackoverflow.com/users/8398928/r-slaby"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1560797927, "post_id": 56637302, "comment_id": 99845663, "body": "I collect this data and analyze it and place it in the database"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1560799730, "post_id": 56637302, "comment_id": 99846400, "body": "&quot;collect, analyze and store&quot; isn&#39;t a useful description."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1560801428, "post_id": 56637302, "comment_id": 99847069, "body": "See <a href=\"https://golang.org/pkg/encoding/json/#example_RawMessage_unmarshal\" rel=\"nofollow noreferrer\">the example for json.RawMessage</a> for how to parse Value depending on Key."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1560802718, "post_id": 56637302, "comment_id": 99847649, "body": "<a href=\"https://play.golang.com/p/yt49VCr2TBY\" rel=\"nofollow noreferrer\">play.golang.com/p/yt49VCr2TBY</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1560804751, "post_id": 56637302, "comment_id": 99848440, "body": "Does the type of the value depend on the key?  For example, is the value for Example_Key4 always a bool?  If so, see <a href=\"https://stackoverflow.com/questions/28033277/golang-decoding-generic-json-objects-to-one-of-many-formats\">Decoding Generic JSON Objects to One of Many Formats</a>."}], "answers": [{"tags": [], "owner": {"reputation": 91, "user_id": 8398928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5bcecc6c029a3ac81350153317adcec?s=128&d=identicon&r=PG&f=1", "display_name": "R.Slaby", "link": "https://stackoverflow.com/users/8398928/r-slaby"}, "is_accepted": true, "score": 0, "last_activity_date": 1560806624, "creation_date": 1560806624, "answer_id": 56639092, "question_id": 56637302, "link": "https://stackoverflow.com/questions/56637302/unmarshaling-irregular-json-file/56639092#56639092", "title": "Unmarshaling irregular JSON file", "body": "<p>The problem was solved using the structure:</p>\n\n<pre><code>type DataField struct {\nValue interface{} `json:\"value,omitempty\"`\nKey   string      `json:\"key,omitempty\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 8398928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5bcecc6c029a3ac81350153317adcec?s=128&d=identicon&r=PG&f=1", "display_name": "R.Slaby", "link": "https://stackoverflow.com/users/8398928/r-slaby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 56639092, "answer_count": 1, "score": -1, "last_activity_date": 1560806624, "creation_date": 1560797738, "last_edit_date": 1560805789, "question_id": 56637302, "link": "https://stackoverflow.com/questions/56637302/unmarshaling-irregular-json-file", "title": "Unmarshaling irregular JSON file", "body": "<p>I have a problem with unmarshaling JSON response from one of the APIs. API returns an array of simple objects. It has a structure: </p>\n\n<pre><code>  \"dataFields\": [\n    {\n      \"key\": \"Example_key1\",\n      \"value\": \"Example_value3\"\n    },\n    {\n      \"key\": \"Example_key2\",\n      \"value\": \"Example_value3\"\n    },\n    {\n      \"key\": \"Example_key3\",\n      \"value\": \"Example_value3\"\n    }\n  ]\n</code></pre>\n\n<p>Generally, there are always 2 strings (possibly a null instead of a string, but this is not a problem).</p>\n\n<p>Unfortunately, recently the provider has introduced a new field that looks like this:</p>\n\n<pre><code>{\n  \"key\": \"Example_key4\",\n  \"value\": false\n}\n</code></pre>\n\n<p>Now I can not unpack it to a simple unmarshal to the structure I used before:</p>\n\n<pre><code>type DataField struct {\nValue string `json:\"value,omitempty\"`\nKey   string `json:\"key,omitempty\"`\n}\n</code></pre>\n\n<p>Can you suggest to me how you can unpack something like that?</p>\n\n<p>Thank you in advance </p>\n"}, {"tags": ["xml", "go", "struct", "xmlhttprequest"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1560797218, "post_id": 56637105, "comment_id": 99845377, "body": "Just review your XML against your definitions, or fill out a struct fully in Go and export it to XML, then compare that to your input. I see a few things right off the bat; your root element is <code>root</code>, not <code>DataTestPlan</code>, so that needs an <code>XMLName</code> added, and multiple places in the XML where an <code>element</code> element appears are not mapped in your structs at all (the struct definitions just ignore it and try to map its children as if it weren&#39;t there)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1560801658, "post_id": 56637105, "comment_id": 99847166, "body": "It doesn&#39;t matter if it&#39;s &quot;not a struct&quot;, it needs to be handled in your mapping. You can&#39;t pretend it doesn&#39;t exist. E.g. <code>Parameters</code> shouldn&#39;t be a slice, because there&#39;s only one <code>parameters</code> element. The <code>parameters</code> <i>contains</i> a slice of <code>element</code> elements."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 11274321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37c40e4b5a75537fe59ae6694541fbe?s=128&d=identicon&r=PG&f=1", "display_name": "soamya", "link": "https://stackoverflow.com/users/11274321/soamya"}, "edited": false, "score": 1, "creation_date": 1560804395, "post_id": 56638200, "comment_id": 99848314, "body": "Thanks! I wasn&#39;t aware of &quot;&gt;&quot;. It was such a minor thing :)"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 0, "last_activity_date": 1560801858, "creation_date": 1560801858, "answer_id": 56638200, "question_id": 56637105, "link": "https://stackoverflow.com/questions/56637105/nested-xml-json-struct-tags-whats-the-correct-way-to-define-structs/56638200#56638200", "title": "Nested XML/JSON struct tags, what&#39;s the correct way to define structs?", "body": "<p>You can use <code>&gt;</code> in the tags.</p>\n\n<p><a href=\"https://golang.org/pkg/encoding/xml/#Unmarshal\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/xml/#Unmarshal</a></p>\n\n<blockquote>\n  <p>If the XML element contains a sub-element whose name matches the\n  prefix of a tag formatted as \"a\" or \"a>b>c\", unmarshal will descend\n  into the XML structure looking for elements with the given names, and\n  will map the innermost elements to that struct field. A tag starting\n  with \">\" is equivalent to one starting with the field name followed by\n  \">\".</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/pkg/encoding/xml/#Marshal\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/xml/#Marshal</a></p>\n\n<blockquote>\n  <p>If a field uses a tag \"a>b>c\", then the element c will be nested\n  inside parent elements a and b. Fields that appear next to each other\n  that name the same parent will be enclosed in one XML element.</p>\n</blockquote>\n\n<p>For example:</p>\n\n<pre><code>type DataTestplan struct {\n    Data []Testplan `json:\"data\" xml:\"data&gt;element\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/RX3IDI3zubo\" rel=\"nofollow noreferrer\">https://play.golang.com/p/RX3IDI3zubo</a></p>\n"}, {"tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": false, "score": 0, "last_activity_date": 1560803095, "creation_date": 1560803095, "answer_id": 56638447, "question_id": 56637105, "link": "https://stackoverflow.com/questions/56637105/nested-xml-json-struct-tags-whats-the-correct-way-to-define-structs/56638447#56638447", "title": "Nested XML/JSON struct tags, what&#39;s the correct way to define structs?", "body": "<p>There is no need to create a different struct for each tag. You can embed them all in one. For the xml parsing you are missing a few tags. You can avoid some code replication by using the <code>&gt;</code> in the xml tag. This will effectively \"merge\" two elements when you iterate them. Here is an example on a more concise implementation:</p>\n\n<pre><code>type Root struct {\n    XMLName xml.Name `xml:\"root\"`\n    Data    []struct {\n        Group      string `json:\"group\" xml:\"group\"`\n        Name       string `json:\"name\" xml:\"name\"`\n        Parameters []struct {\n            Comment     string `json:\"comment\" xml:\"comment,omitempty\"`\n            Description string `json:\"description\" xml:\"description,omitempty\"`\n        } `json:\"parameters\" xml:\"parameters&gt;element\"`\n        Released  bool `json:\"released\" xml:\"released\"`\n        Teststeps []struct {\n            Bin int32 `json:\"bin\" xml:\"bin\"`\n        } `xml:\"teststeps&gt;element,omitempty\"`\n        Version int32 `json:\"version\" xml:\"version\"`\n    } `json:\"data\" xml:\"data&gt;element\"`\n}\n</code></pre>\n\n<p>By running:</p>\n\n<pre><code>var dataNewTestplans DataTestplan\nerr := xml.NewDecoder(r.Body).Decode(&amp;dataNewTestplans)\nxmlData, _ := xml.Marshal(dataNewTestplans)\nfmt.Printf(string(xmlData))\n</code></pre>\n\n<p>you get:</p>\n\n<pre><code>&lt;root&gt;&lt;data&gt;&lt;element&gt;&lt;group&gt;TEST&lt;/group&gt;&lt;name&gt;TEST&lt;/name&gt;&lt;parameters&gt;&lt;element&gt;&lt;comment&gt;test&lt;/comment&gt;&lt;description&gt;test&lt;/description&gt;&lt;/element&gt;&lt;element&gt;&lt;comment&gt;test1&lt;/comment&gt;&lt;/element&gt;&lt;/parameters&gt;&lt;released&gt;true&lt;/released&gt;&lt;teststeps&gt;&lt;element&gt;&lt;bin&gt;32&lt;/bin&gt;&lt;/element&gt;&lt;/teststeps&gt;&lt;version&gt;1&lt;/version&gt;&lt;/element&gt;&lt;/data&gt;&lt;/root&gt;\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 11274321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37c40e4b5a75537fe59ae6694541fbe?s=128&d=identicon&r=PG&f=1", "display_name": "soamya", "link": "https://stackoverflow.com/users/11274321/soamya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 0, "accepted_answer_id": 56638200, "answer_count": 2, "score": 0, "last_activity_date": 1560803095, "creation_date": 1560796923, "last_edit_date": 1560801290, "question_id": 56637105, "link": "https://stackoverflow.com/questions/56637105/nested-xml-json-struct-tags-whats-the-correct-way-to-define-structs", "title": "Nested XML/JSON struct tags, what&#39;s the correct way to define structs?", "body": "<p>Few of the XML tags are not getting decoded while reading the request body</p>\n\n<p>I have defined my nested struct with both json and xml tags, as I want to use the same schema for request and response in both json and xml.</p>\n\n<pre><code>var dataNewTestplans DataTestplan\nerr := xml.NewDecoder(r.Body).Decode(&amp;dataNewTestplans)\nxmlData, _ := xml.Marshal(dataNewTestplans)\nfmt.Printf(string(xmlData))\n</code></pre>\n\n<p>DataTestplan struct:</p>\n\n<pre><code>type DataTestplan struct {\n    Data []Testplan `json:\"data\" xml:\"data\"`\n}\n</code></pre>\n\n<p>Testplan struct:</p>\n\n<pre><code>type Testplan struct {\n    Group      string      `json:\"group\" xml:\"group\"`\n    Name       string      `json:\"name\" xml:\"name\"`\n    Parameters []Parameter `json:\"parameters,omitempty\" xml:\"parameters,omitempty\"`\n    Released   bool        `json:\"released\" xml:\"released\"`\n    Teststeps  []Teststep  `json:\"teststeps,omitempty\" xml:\"teststeps,omitempty\"`\n    Version    int32       `json:\"version\" xml:\"version\"`\n}\n</code></pre>\n\n<p>Parameter struct:     </p>\n\n<pre><code>type Parameter struct {\n    XMLName     xml.Name `xml:\"parameters\"`\n    Comment     string   `json:\"comment\" xml:\"comment\"`\n    Description string   `json:\"description,omitempty\" xml:\"description,omitempty\"`\n}\n</code></pre>\n\n<p>Teststep struct: </p>\n\n<pre><code>type Teststep struct {\n    XMLName xml.Name `xml:\"teststeps\"`\n    AslID   string   `json:\"aslId,omitempty\" xml:\"aslID\"`\n    Bin     int32    `json:\"bin,omitempty\" xml:\"bin\"`\n}\n</code></pre>\n\n<p>XML sent : </p>\n\n<pre><code>&lt;root&gt;\n  &lt;data&gt;\n    &lt;element&gt;\n     &lt;group&gt;TEST&lt;/group&gt;\n     &lt;name&gt;TEST&lt;/name&gt;\n     &lt;parameters&gt;\n        &lt;element&gt;\n           &lt;comment&gt;test&lt;/comment&gt;\n           &lt;description&gt;test&lt;/description&gt;\n        &lt;/element&gt;\n        &lt;element&gt;\n           &lt;comment&gt;test1&lt;/comment&gt;\n        &lt;/element&gt;\n     &lt;/parameters&gt;\n     &lt;released&gt;true&lt;/released&gt;\n     &lt;teststeps&gt;\n        &lt;element&gt;\n           &lt;bin&gt;32&lt;/bin&gt;\n        &lt;/element&gt;\n      &lt;/teststeps&gt;\n     &lt;version&gt;1&lt;/version&gt;\n    &lt;/element&gt;\n  &lt;/data&gt;\n&lt;/root&gt;\n</code></pre>\n\n<p>XML decoded: </p>\n\n<pre><code>&lt;DataTestplan&gt;\n  &lt;data&gt;\n    &lt;group&gt;&lt;/group&gt;\n    &lt;name&gt;&lt;/name&gt;\n    &lt;released&gt;false&lt;/released&gt;\n    &lt;version&gt;0&lt;/version&gt;\n    &lt;/data&gt;\n&lt;/DataTestplan&gt;\n</code></pre>\n\n<p>I understand missing tags are most probably because of miss tagging of xml in the struct definition but I am not sure why the decoded information is missing value for tags ? What's the trick with XML and JSON encoding ? </p>\n"}, {"tags": ["go", "protoc", "go-modules"], "answers": [{"comments": [{"owner": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "edited": false, "score": 0, "creation_date": 1560819929, "post_id": 56638916, "comment_id": 99851882, "body": "Thanks for the quick response. Having to write a script per dependency, that manually specifies a git tag is anti-dependency management. Having 10 &quot;tools&quot; is not so far fetched.  There has got to be a better way....  Your <code>git -C</code> command is working on the gopath, which when using go modules, is also going against the grain (should be outside of $GOPATH).  Lastly, I do import - thats what the <code>tools.go</code> is for, see <a href=\"https://github.com/golang/go/wiki/Modules#how-can-i-track-tool-dependencies-for-a-module\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}], "tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": false, "score": 0, "last_activity_date": 1560805525, "creation_date": 1560805525, "answer_id": 56638916, "question_id": 56636580, "link": "https://stackoverflow.com/questions/56636580/replace-retool-with-tools-go-for-multi-developer-and-ci-environments-using-go-mo/56638916#56638916", "title": "replace retool with tools.go for multi developer and CI environments using go modules", "body": "<p>Go modules work with the imports of your .go files. If they find an import, they will automatically download the latest version that satisfies your requirements. You have to read <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules</a> and understand how modules work since Go 1.11 and later.</p>\n\n<blockquote>\n  <p>At this point, why is protoc-gen-go tool version (or git hash) NOT listed in go.mod?</p>\n</blockquote>\n\n<p>This is because protoc-gen-go is just an external tool as far Go modules are concerned. You don't import <code>golang/protobuf/tree/master/protoc-gen-go</code> but the code it generates.</p>\n\n<blockquote>\n  <p>When Joe clones the app repo, how does he get and compile the same version of protoc-gen-go that Ryan used?</p>\n</blockquote>\n\n<p>Use:</p>\n\n<pre><code>GIT_TAG=\"v1.2.0\" # change as needed\ngo get -d -u github.com/golang/protobuf/protoc-gen-go\ngit -C \"$(go env GOPATH)\"/src/github.com/golang/protobuf checkout $GIT_TAG\ngo install github.com/golang/protobuf/protoc-gen-go\n</code></pre>\n\n<p>to install a specific version on each machine of the users. Probably write a build script that automates the process.</p>\n\n<blockquote>\n  <p>How does protoc know to use the protoc-gen-go executable generator in my ./bin dir?</p>\n</blockquote>\n\n<p>From the github docs:\nThe compiler plugin, protoc-gen-go, will be installed in $GOPATH/bin unless $GOBIN is set. It must be in your $PATH for the protocol compiler, protoc, to find it.</p>\n"}, {"comments": [{"owner": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "edited": false, "score": 0, "creation_date": 1560872441, "post_id": 56640587, "comment_id": 99875329, "body": "this is EXACTLY what I was looking for, and very close to what I came up with last night.  I was using <code>--plugin=protoc-gen-twirp=.&#47;build&#47;gobin&#47;protoc-gen-twirp</code> to point to the built tool for each plugin, like you PATH trick MUCH better.  THANK YOU."}, {"owner": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "edited": false, "score": 0, "creation_date": 1560873460, "post_id": 56640587, "comment_id": 99875878, "body": "Bit unrelated: I notice you <code>.gitignore</code> <code>vendor</code> - why? IMO if your vendoring you want it in source so all devs are in lock-step, &amp; your CI don&#39;t have to hit the network."}, {"owner": {"reputation": 171, "user_id": 8210145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/asRGR.jpg?s=128&g=1", "display_name": "rm -rf", "link": "https://stackoverflow.com/users/8210145/rm-rf"}, "reply_to_user": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "edited": false, "score": 1, "creation_date": 1560876598, "post_id": 56640587, "comment_id": 99877419, "body": "On the first point, I&#39;m willing to trust same inputs will produce same outputs, with the versions locked down by go.mod and go.sum. On the second, yes, speeding up CI might make this worthwhile, but still don&#39;t like the idea of committing vendor to the repo. I&#39;d opt for a separate &quot;tools&quot; docker image build for CI. Good point though."}, {"owner": {"reputation": 633, "user_id": 4747401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XZ1BL.jpg?s=128&g=1", "display_name": "tie", "link": "https://stackoverflow.com/users/4747401/tie"}, "edited": false, "score": 0, "creation_date": 1561499003, "post_id": 56640587, "comment_id": 100081997, "body": "That\u2019s a bit too complex setup for protoc\u2026  <a href=\"https://github.com/jhump/goprotoc\" rel=\"nofollow noreferrer\">goprotoc</a> works flawlessly (so far) and is compatible with C++ protoc.  I also don\u2019t like the idea of having an extra <code>tools.json</code> file since everything is already tracked by Go modules, so I\u2019ve written a <a href=\"https://github.com/tie/tools.go\" rel=\"nofollow noreferrer\">program</a> that just runs <code>go install</code> for each underscore import in <code>tools.go</code> file. This is far from perfect since it installs binaries to <code>$GOBIN</code> (or wherever Go decides), but it can be easily fixed \u2014 I\u2019m just hesitating to store binaries in the project folder (<code>retools</code>)."}], "tags": [], "owner": {"reputation": 171, "user_id": 8210145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/asRGR.jpg?s=128&g=1", "display_name": "rm -rf", "link": "https://stackoverflow.com/users/8210145/rm-rf"}, "is_accepted": true, "score": 3, "last_activity_date": 1560820453, "creation_date": 1560820453, "answer_id": 56640587, "question_id": 56636580, "link": "https://stackoverflow.com/questions/56636580/replace-retool-with-tools-go-for-multi-developer-and-ci-environments-using-go-mo/56640587#56640587", "title": "replace retool with tools.go for multi developer and CI environments using go modules", "body": "<p>I was able to accomplish vendored tools build for protoc (and plugins like <a href=\"https://github.com/twitchtv/twirp\" rel=\"nofollow noreferrer\">Twirp</a>) following the <a href=\"https://github.com/golang/go/wiki/Modules#how-can-i-track-tool-dependencies-for-a-module\" rel=\"nofollow noreferrer\">Go Modules tools guidelines</a>, plus a little Makefile-Fu for the <a href=\"https://github.com/protocolbuffers/protobuf/releases/\" rel=\"nofollow noreferrer\">protoc</a> binary.</p>\n\n<p>A complete working example can be found in the Aspiration Labs <a href=\"https://github.com/aspiration-labs/pyggpot\" rel=\"nofollow noreferrer\">pyggpot repo</a>. Following are the essential details. Worth noting: getting the import path right for some of the tools was very fiddly, but ultimately, successful.</p>\n\n<p>For <code>protoc</code> itself, I vendor the binary release in the Makefile and set it up into a <code>tools/bin</code> dir:</p>\n\n<pre><code>TOOLS_DIR := ./tools\nTOOLS_BIN := $(TOOLS_DIR)/bin\n\n# protoc\nPROTOC_VERSION := 3.7.1\nPROTOC_PLATFORM := osx-x86_64\nPROTOC_RELEASES_PATH := https://github.com/protocolbuffers/protobuf/releases/download\nPROTOC_ZIP := protoc-$(PROTOC_VERSION)-$(PROTOC_PLATFORM).zip\nPROTOC_DOWNLOAD := $(PROTOC_RELEASES_PATH)/v$(PROTOC_VERSION)/$(PROTOC_ZIP)\nPROTOC := $(TOOLS_BIN)/protoc\n\n# protoc\n$(PROTOC): $(TOOLS_DIR)/$(PROTOC_ZIP)\n    unzip -o -d \"$(TOOLS_DIR)\" $&lt; &amp;&amp; touch $@  # avoid Prerequisite is newer than target `tools/bin/protoc'.\n\n$(TOOLS_DIR)/$(PROTOC_ZIP):\n    curl --location $(PROTOC_DOWNLOAD) --output $@\n</code></pre>\n\n<p>The <code>PROTOC_PLATFORM</code> string can be automated with something like <a href=\"https://stackoverflow.com/questions/714100/os-detecting-makefile\">OS detecting makefile</a>. The version of that we use is at <a href=\"https://github.com/aspiration-labs/pyggpot/blob/master/build/makefiles/osvars.mk\" rel=\"nofollow noreferrer\">https://github.com/aspiration-labs/pyggpot/blob/master/build/makefiles/osvars.mk</a>.</p>\n\n<p>On to building the go tools. Create a <code>tools.go</code> something like</p>\n\n<pre><code>// +build tools\n\npackage tools\n\nimport (\n    // protocol buffer compiler plugins\n    _ \"github.com/golang/protobuf/protoc-gen-go\"\n    _ \"github.com/twitchtv/twirp/protoc-gen-twirp\"\n    _ \"github.com/twitchtv/twirp/protoc-gen-twirp_python\"\n    _ \"github.com/thechriswalker/protoc-gen-twirp_js\"\n)\n</code></pre>\n\n<p>Note: the <code>// +build tools</code> tag will keep <code>go build</code> from over-building tools imports in your final build.</p>\n\n<p>Finally, some make code to build your go tools:</p>\n\n<pre><code># go installed tools.go\nGO_TOOLS := github.com/golang/protobuf/protoc-gen-go \\\n            github.com/twitchtv/twirp/protoc-gen-twirp \\\n            github.com/twitchtv/twirp/protoc-gen-twirp_python \\\n            github.com/thechriswalker/protoc-gen-twirp_js \\\n\n# tools\nGO_TOOLS_BIN := $(addprefix $(TOOLS_BIN), $(notdir $(GO_TOOLS)))\nGO_TOOLS_VENDOR := $(addprefix vendor/, $(GO_TOOLS))\n\nsetup_tools: $(GO_TOOLS_BIN)\n\n$(GO_TOOLS_BIN): $(GO_TOOLS_VENDOR)\n    GOBIN=\"$(PWD)/$(TOOLS_BIN)\" go install -mod=vendor $(GO_TOOLS)\n</code></pre>\n\n<p>And finally, a <code>make setup</code> target to run <code>go mod vendor</code> and process the targets above.</p>\n\n<pre><code>setup: setup_vendor $(TOOLS_DIR) $(PROTOC) setup_tools\n\n# vendor\nsetup_vendor:\n    go mod vendor\n\n$(TOOLS_DIR):\n    mkdir -v -p $@\n</code></pre>\n"}], "owner": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 1, "accepted_answer_id": 56640587, "answer_count": 2, "score": 3, "last_activity_date": 1560820453, "creation_date": 1560794364, "last_edit_date": 1560794723, "question_id": 56636580, "link": "https://stackoverflow.com/questions/56636580/replace-retool-with-tools-go-for-multi-developer-and-ci-environments-using-go-mo", "title": "replace retool with tools.go for multi developer and CI environments using go modules", "body": "<p>I'd like to replace <a href=\"https://github.com/twitchtv/retool/issues/51\" rel=\"nofollow noreferrer\">retool</a> with go modules <a href=\"https://github.com/go-modules-by-example/index/blob/master/010_tools/README.md\" rel=\"nofollow noreferrer\">tools.go</a> \"tools as dependencies\".  However I'm struggling to understand how this works when my developers and CI env all use different operating systems.</p>\n\n<p>I want to make sure each environment uses the exact same version of tools.</p>\n\n<p>For a concrete example, my app requires the protoc compiler to generate go code via github.com/golang/protobuf/protoc-gen-go.  I have 3 OS, all needing to execute protoc with the protoc-gen-go plugin/generator:</p>\n\n<ol>\n<li>Ryan: uses MacOS</li>\n<li>Joe: Linux (Ubuntu)</li>\n<li>CI: Linux (CentOS)</li>\n</ol>\n\n<p>I currently use retool to make sure ALL environments are locked in on the same version of tools (protoc-gen-go in this ex):</p>\n\n<pre><code>retool do build/bin/protoc -Ibuild/protoc/include -I. rpc/platform/platform.proto --go_out=.\n</code></pre>\n\n<p><strong>My new go modules / \"tools as dependencies\" setup</strong></p>\n\n<p>tools.go:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// +build tools\n\npackage tools\n\nimport (\n    _ \"github.com/golang/protobuf/protoc-gen-go\"\n)\n</code></pre>\n\n<p>Set the path that <code>go install</code> will use:</p>\n\n<pre><code>export GOBIN=$PWD/bin\n</code></pre>\n\n<p>Install:</p>\n\n<pre><code>go install github.com/golang/protobuf/protoc-gen-go\n</code></pre>\n\n<p>If Ryan runs the <code>go install ..</code> a <code>bin/protoc-gen-go</code> MacOS executable is created.</p>\n\n<p><strong>Questions</strong>:</p>\n\n<ol>\n<li>At this point, why is<code>protoc-gen-go</code> tool version (or git hash) NOT listed in go.mod?  </li>\n<li>When Joe clones the app repo, how does he get and compile the same version of protoc-gen-go that Ryan used?</li>\n<li>How does <code>protoc</code> know to use the <code>protoc-gen-go</code> executable generator in my <code>./bin</code> dir?</li>\n</ol>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 1295679, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95d491362d73b571fdb52d229c52ea89?s=128&d=identicon&r=PG", "display_name": "user1295679", "link": "https://stackoverflow.com/users/1295679/user1295679"}, "edited": false, "score": 0, "creation_date": 1560830025, "post_id": 56639890, "comment_id": 99853647, "body": "I want the first SQL to have a datetime condition, and the second SQL without a datetime condition."}, {"owner": {"reputation": 2615, "user_id": 2480468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VNCmN.jpg?s=128&g=1", "display_name": "Tim Brown", "link": "https://stackoverflow.com/users/2480468/tim-brown"}, "reply_to_user": {"reputation": 31, "user_id": 1295679, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95d491362d73b571fdb52d229c52ea89?s=128&d=identicon&r=PG", "display_name": "user1295679", "link": "https://stackoverflow.com/users/1295679/user1295679"}, "edited": false, "score": 0, "creation_date": 1560981953, "post_id": 56639890, "comment_id": 99920031, "body": "Yeah, that&#39;s what the above code is doing.  Most gorm methods return a query object, so in order to have two different where clauses you&#39;ll need two different objects, as in the code above.  For the query without a datetime condition, I just use the original transaction object, as it comes without any conditions by default.  For the query with a datetime, we create a new object."}], "tags": [], "owner": {"reputation": 2615, "user_id": 2480468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VNCmN.jpg?s=128&g=1", "display_name": "Tim Brown", "link": "https://stackoverflow.com/users/2480468/tim-brown"}, "is_accepted": false, "score": 0, "last_activity_date": 1560813064, "creation_date": 1560813064, "answer_id": 56639890, "question_id": 56636297, "link": "https://stackoverflow.com/questions/56636297/gorm-multiple-transactions-to-remove-old-search-conditions/56639890#56639890", "title": "Gorm multiple transactions to remove old search conditions", "body": "<p>I'd suggest having two separate query objects:</p>\n\n<pre><code>    bg := Db.Begin()\n    UDebt := make([]UserDebt, 0)\n    page, _ := strconv.Atoi(c.DefaultPostForm(\"page\", \"1\"))\n    limit, _ := strconv.Atoi(c.DefaultPostForm(\"limit\", \"20\"))\n    // Use the bg object so this is all done in the transaction\n    db := bg.Model(&amp;UDebt).Preload(\"User\")\n    start := c.PostForm(\"start\")\n    if start != \"\" {\n        // Don't change the original bg object\n        db = db.Where(\"datetime &gt;= ?\", start)\n    }\n\n    debts := make([]UserDebt,0)\n    // Use the newly created db object to store the query options for that\n    db.Debug().Set(\"gorm:query_option\", \"FOR UPDATE\").Limit(limit).Offset(page).Find(&amp;debts)\n    bg.Debug().Model(&amp;UserBet{}).Where(\"id in (?)\",arrayID).Update(\"is_read\",1)\n    bg.Commit()\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 1295679, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95d491362d73b571fdb52d229c52ea89?s=128&d=identicon&r=PG", "display_name": "user1295679", "link": "https://stackoverflow.com/users/1295679/user1295679"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 327, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1564042658, "creation_date": 1560792921, "last_edit_date": 1564042658, "question_id": 56636297, "link": "https://stackoverflow.com/questions/56636297/gorm-multiple-transactions-to-remove-old-search-conditions", "title": "Gorm multiple transactions to remove old search conditions", "body": "<pre><code>    bg := Db.Begin()\n    UDebt := make([]UserDebt, 0)\n    page, _ := strconv.Atoi(c.DefaultPostForm(\"page\", \"1\"))\n    limit, _ := strconv.Atoi(c.DefaultPostForm(\"limit\", \"20\"))\n    db := Db.Model(&amp;UDebt).Preload(\"User\")\n    start := c.PostForm(\"start\")\n    if start != \"\" {\n        db = db.Where(\"datetime &gt;= ?\", start)\n        bg = bg.Where(\"datetime &gt;= ?\", start)\n    }\n\n    debts := make([]UserDebt,0)\n    bg.Debug().Set(\"gorm:query_option\", \"FOR UPDATE\").Limit(limit).Offset(page).Find(&amp;debts)\n    // show sql: SELECT * FROM `user_debt`  WHERE (datetime &gt;= '2019-06-16 00:00:00') LIMIT 20 OFFSET 1 FOR UPDATE\n    // I hope this is a new connection without any conditions.\n    bg.Debug().Model(&amp;UserBet{}).Where(\"id in (?)\",arrayID).Update(\"is_read\",1)\n    // show sql: UPDATE `user_bet` SET `is_read` = '1'  WHERE (datetime &gt;= '2019-06-16 00:00:00') AND (id in ('17','18','19','20','21','22'))  \n    bg.Commit()\n\n</code></pre>\n\n<p>I want the second SQL to remove the datetime condition.\nThe second SQL takes the first SQL search condition. How do I remove this condition and use it in a transaction?</p>\n"}, {"tags": ["docker", "go", "arm", "cross-compiling"], "comments": [{"owner": {"reputation": 2106, "user_id": 7191047, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EWSwl.png?s=128&g=1", "display_name": "Danila Kiver", "link": "https://stackoverflow.com/users/7191047/danila-kiver"}, "edited": false, "score": 0, "creation_date": 1560792411, "post_id": 56634558, "comment_id": 99843494, "body": "Your description is a bit confused, however, let&#39;s try check everything step-by-step... First, did you check what is the <i>actual</i> compiled binary architecture using <code>readelf -h &#47;path&#47;to&#47;binary</code>? I.e. build the binary, then check it via <code>readelf -h .&#47;release&#47;edge_to_bc</code> on your build host."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 2106, "user_id": 7191047, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EWSwl.png?s=128&g=1", "display_name": "Danila Kiver", "link": "https://stackoverflow.com/users/7191047/danila-kiver"}, "edited": false, "score": 0, "creation_date": 1560795038, "post_id": 56634558, "comment_id": 99844526, "body": "no, I didn&#39;t do it. It is a good trick. let me try it and I tell you the results"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 2106, "user_id": 7191047, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EWSwl.png?s=128&g=1", "display_name": "Danila Kiver", "link": "https://stackoverflow.com/users/7191047/danila-kiver"}, "edited": false, "score": 0, "creation_date": 1560842480, "post_id": 56634558, "comment_id": 99857651, "body": "I added your command, and also uname -a in target ARM board. I don&#39;t know how to interpret this"}, {"owner": {"reputation": 2106, "user_id": 7191047, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EWSwl.png?s=128&g=1", "display_name": "Danila Kiver", "link": "https://stackoverflow.com/users/7191047/danila-kiver"}, "edited": false, "score": 0, "creation_date": 1560850010, "post_id": 56634558, "comment_id": 99861657, "body": "The second step: did you try to run this binary on the target machine without Docker? I.e. install all its dependencies directly on ARM board, copy the binary and run it. This probably may take some time, but should ensure that the executable is binary-compatible with target environment (if not - you will receive errors like &quot;file not found&quot;, etc)."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 2106, "user_id": 7191047, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EWSwl.png?s=128&g=1", "display_name": "Danila Kiver", "link": "https://stackoverflow.com/users/7191047/danila-kiver"}, "edited": false, "score": 0, "creation_date": 1560850620, "post_id": 56634558, "comment_id": 99862054, "body": "Thing is when I build binary and then build it with docker manually, it works, so I guess we can tell this is not a docker issue. I will update the readelf of the binary compiled manually"}], "answers": [{"comments": [{"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1560868603, "post_id": 56650559, "comment_id": 99872975, "body": "Wow ! Quite an answer. Never heard about BuildKit and buildx, I will upvote, just for that. I will try second option, I&#39;m not sure I want to use experimental stuff in production"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1560869062, "post_id": 56650559, "comment_id": 99873278, "body": "Just to know, why are you ending your dockerfile with <code>FROM release</code> ???"}, {"owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "reply_to_user": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1560873940, "post_id": 56650559, "comment_id": 99876131, "body": "@JuliatzindelToro depending on how you structure your Dockerfile, you may want the default stage to be one from earlier in the Dockerfile."}], "tags": [], "owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "is_accepted": true, "score": 1, "last_activity_date": 1560865582, "last_edit_date": 1560865582, "creation_date": 1560865223, "answer_id": 56650559, "question_id": 56634558, "link": "https://stackoverflow.com/questions/56634558/go-cross-compilation-from-ubuntu-amd64-to-arm7l-exec-user-process-caused-exec/56650559#56650559", "title": "Go Cross Compilation from Ubuntu amd64 to arm7l : exec user process caused &quot;exec format error&quot;", "body": "<p>When you run the build on the amd64 system of the arm7 image with this command:</p>\n\n<pre><code>docker build -t registry.gitlab.com/company/edge_to_bc:armhf .\n</code></pre>\n\n<p>It will use base images and run commands in that image for amd64. So even if your single <code>edge_to_bc</code> binary may be cross compiled, the rest of the image is not. Next, the binary compile command itself looks like it is linking to libraries, which quite likely are not in your final image. You can run <code>ldd edge_to_bc</code> to see these links, and if they are missing, you'll get the file not found error.</p>\n\n<hr>\n\n<p>In my own cross compile test, I'm using BuildKit, Buildx, and some experimental features on 19.03.0-rc2, so there will be parts of this that are not backwards compatible, but hopefully you find helpful. I'm using a multi-stage build to avoid the compile outside of docker and then a second build. I'm also specifying the platform for the build host and using the target arch and OS variables to configure go to cross compile. In this scenario, I went with a completely statically linked binary so there were no libraries to include, and with only copy commands in my final release image, I avoid issues running the build on a different platform.</p>\n\n<pre><code># syntax=docker/dockerfile:experimental\n# ^ above line must be at the beginning of the Dockerfile for BuildKit\n\n# --platform pulls an image for the build host rather than target OS/Arch\nFROM --platform=$BUILDPLATFORM golang:1.12-alpine as dev\nRUN apk add --no-cache git ca-certificates\nRUN adduser -D appuser\nWORKDIR /src\nCOPY . /src/\nCMD CGO_ENABLED=0 go build -o app . &amp;&amp; ./app\n\n# my dev stage is separate from build to allow mounting source and rebuilding\n# on developer machines    \nFROM --platform=$BUILDPLATFORM dev as build\nARG TARGETPLATFORM\nARG TARGETOS\nARG TARGETARCH\n# --mount is an experimental BuildKit feature\nRUN --mount=type=cache,id=gomod,target=/go/pkg/mod/cache \\\n    --mount=type=cache,id=goroot,target=/root/.cache/go-build \\\n    CGO_ENABLED=0 GOOS=${TARGETOS} GOARCH=${TARGETARCH} \\\n    go build -ldflags '-w -extldflags -static' -o app .\nUSER appuser\nCMD [ \"./app\" ]\n\n# this stage will have the target OS/Arch and cannot have any RUN commands\nFROM scratch as release\nCOPY --from=build /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/\nCOPY --from=build /etc/passwd /etc/group /etc/\nCOPY --from=build /src/app /app\nUSER appuser\nCMD [ \"/app\" ]\n\nFROM scratch as artifact\nCOPY --from=build /src/app /app\n\nFROM release\n</code></pre>\n\n<p>To build this, I can run one-off build commands with BuildKit:</p>\n\n<pre><code>DOCKER_BUILDKIT=1 docker build --platform=linux/amd64 -f Dockerfile -t golang-app:amd64 .\nDOCKER_BUILDKIT=1 docker build --platform=linux/arm64 -f Dockerfile -t golang-app:arm64 .\n</code></pre>\n\n<p>But even better is the Buildx version that creates a multi-arch image that will run on multiple platforms. This does require that you push to a registry server:</p>\n\n<pre><code>docker buildx build -f Dockerfile --platform linux/amd64,linux/arm64 \\\n  -t ${docker_hub_id}/golang-app:multi-arch --output type=registry .\n</code></pre>\n\n<p>For your scenario, you would swap out the references from arm64 to your own architectures. The <code>--platform</code> option was listed as experimental in many commands I ran, so you may need to configure the following in the /etc/docker/daemon.json file to enable:</p>\n\n<pre><code>{ \"experimental\": true }\n</code></pre>\n\n<p>I believe this required a full restart of the docker daemon (<code>systemctl restart docker</code>), not just a reload, to take effect.</p>\n\n<p>To extract the artifact from the build (the compiled binary for the specific architecture), I use:</p>\n\n<pre><code>docker build -f Dockerfile --target artifact -o type=local,dest=. .\n</code></pre>\n\n<p>That will output the contents of the artifact stage (a single binary) to the local directory.</p>\n\n<hr>\n\n<p>The above is option 3 in Docker's list of ways to build multi-arch images.</p>\n\n<p>Option 1 is to configure qemu with binfmt_misc to build and run images for different platforms. I have not yet been able to get this to work on Linux with Buildx, but Docker has done this for Mac and you may be able to find more details on what they did in the LinuxKit project. Using qemu for your situation may be ideal if you need to run commands and install other tools as part of your build, not just cross compile a single statically linked binary.</p>\n\n<p>Option 2 is to run the build on the target platform, which as you've seen works well. With <a href=\"https://github.com/docker/buildx\" rel=\"nofollow noreferrer\">Buildx</a>, you can add multiple build nodes, up to one per platform, allowing you to run the build from a single location (CI server).</p>\n"}], "owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 539, "favorite_count": 1, "accepted_answer_id": 56650559, "answer_count": 1, "score": 1, "last_activity_date": 1560865582, "creation_date": 1560785678, "last_edit_date": 1560850996, "question_id": 56634558, "link": "https://stackoverflow.com/questions/56634558/go-cross-compilation-from-ubuntu-amd64-to-arm7l-exec-user-process-caused-exec", "title": "Go Cross Compilation from Ubuntu amd64 to arm7l : exec user process caused &quot;exec format error&quot;", "body": "<p>I am having an headache with cross compilation from amd64 to arm7l</p>\n\n<p>I could finally do it with Gitlab CI, so now, I compile my binary in a docker image, here is the dockerfile:</p>\n\n<pre><code>FROM golang\n\nWORKDIR /go/src/gitlab.com/company/edge_to_bc\n\nCOPY . .\nRUN dpkg --add-architecture armhf &amp;&amp; apt update &amp;&amp; apt-get install -y gcc-arm-linux-gnueabihf libltdl-dev:armhf\n</code></pre>\n\n<p>I build it as \nThen I will build the the new container \"cross-compil\" ready with the name <code>ubuntu:cross-compil</code></p>\n\n<p>Now, I can compile my binary with: </p>\n\n<pre><code>docker run -it -v ${EDGE_TO_BC_PATH}/release:/go/src/gitlab.com/company/edge_to_bc/release ubuntu:cross-compil  bash -c 'CC=arm-linux-gnueabihf-gcc CXX=arm-linux-gnueabihf-g++ CGO_ENABLED=1 GOOS=linux GOARCH=arm GOARM=7 go build -v -o ./release/edge_to_bc '\n</code></pre>\n\n<p>I can see my executable generated in <code>./release/edge_to_bc</code></p>\n\n<p>Then I build my docker image:</p>\n\n<pre><code>docker build -t registry.gitlab.com/company/edge_to_bc:armhf .\n</code></pre>\n\n<p>And I push it.</p>\n\n<p>In the Dockerfile, I just copy the executable from host: </p>\n\n<pre><code>FROM alpine:3.7\n\nRUN apk --no-cache add ca-certificates libtool\n\nWORKDIR /sunclient/\n\nCOPY ./release/edge_to_bc ./\nEXPOSE 5555\n\nCMD [ \"./edge_to_bc\" ]\n</code></pre>\n\n<p>But when I run it in my arm board with: </p>\n\n<pre><code>docker run --rm registry.gitlab.com/company/edge_to_bc:armhf\n</code></pre>\n\n<p>I get: </p>\n\n<pre><code>standard_init_linux.go:207: exec user process caused \"no such file or directory\"\n</code></pre>\n\n<p>When debugging, if I want to get list of files with  </p>\n\n<pre><code>docker run --rm registry.gitlab.com/company/edge_to_bc:armhf\n</code></pre>\n\n<p>I get: </p>\n\n<pre><code>standard_init_linux.go:207: exec user process caused \"exec format error\"\n</code></pre>\n\n<p>Which indicate binary still not have correct format...</p>\n\n<p>What did I miss ? I spent a lot of time on this topic, and don't have much more ideas.</p>\n\n<p>When I check the architecture of binary, this is what I get:</p>\n\n<pre><code> edge_to_bc git:(master) \u2717 readelf -h ./release/edge_to_bc\nELF Header:\n  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 \n  Class:                             ELF32\n  Data:                              2's complement, little endian\n  Version:                           1 (current)\n  OS/ABI:                            UNIX - System V\n  ABI Version:                       0\n  Type:                              EXEC (Executable file)\n  Machine:                           ARM\n  Version:                           0x1\n  Entry point address:               0x19209\n  Start of program headers:          52 (bytes into file)\n  Start of section headers:          23993360 (bytes into file)\n  Flags:                             0x5000400, Version5 EABI, hard-float ABI\n  Size of this header:               52 (bytes)\n  Size of program headers:           32 (bytes)\n  Number of program headers:         10\n  Size of section headers:           40 (bytes)\n  Number of section headers:         49\n  Section header string table index: 48\n</code></pre>\n\n<p>On the target OS, this is what I get:</p>\n\n<pre><code>[root@gw-sol1 ~]# uname -a\nLinux gw-sol-1 4.4.113-UNRELEASED #1 SMP PREEMPT Thu Mar 7 16:46:40 CET 2019 armv7l armv7l armv7l GNU/Linux\n</code></pre>\n\n<p>EDIT: </p>\n\n<p>When I build the app directly on ARM device, it will work:</p>\n\n<pre><code>go build -o ./release/edge_to_bc -v -ldflags '-w -s -extldflags \"-static\"' ./...\n</code></pre>\n\n<p>the ELF: </p>\n\n<pre><code>ELF Header:\n  Magic:   7f 45 4c 46 01 01 01 03 00 00 00 00 00 00 00 00 \n  Class:                             ELF32\n  Data:                              2's complement, little endian\n  Version:                           1 (current)\n  OS/ABI:                            UNIX - GNU\n  ABI Version:                       0\n  Type:                              EXEC (Executable file)\n  Machine:                           ARM\n  Version:                           0x1\n  Entry point address:               0x125f1\n  Start of program headers:          52 (bytes into file)\n  Start of section headers:          16594072 (bytes into file)\n  Flags:                             0x5000400, Version5 EABI, hard-float ABI\n  Size of this header:               52 (bytes)\n  Size of program headers:           32 (bytes)\n  Number of program headers:         7\n  Size of section headers:           40 (bytes)\n  Number of section headers:         38\n  Section header string table index: 37\n</code></pre>\n\n<p>It seems quite similar to the other one, at least in architecture.</p>\n\n<p>Then build the docker image: </p>\n\n<pre><code>docker build . -t image/peer-test:armhf\n</code></pre>\n"}, {"tags": ["json", "xml", "rest", "go", "http-post"], "comments": [{"owner": {"reputation": 561, "user_id": 522915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c96d965519bcb39f42401ff75d807ae?s=128&d=identicon&r=PG", "display_name": "cyang", "link": "https://stackoverflow.com/users/522915/cyang"}, "edited": false, "score": 2, "creation_date": 1560785673, "post_id": 56634501, "comment_id": 99840674, "body": "Have you added &quot;Content-Type : application/json&quot; into your Postman request header?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1560786902, "post_id": 56634501, "comment_id": 99841290, "body": "It&#39;s generally the client&#39;s responsibility to set the Content-Type header correctly when sending the request. You shouldn&#39;t need to detect it at all."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 11274321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37c40e4b5a75537fe59ae6694541fbe?s=128&d=identicon&r=PG&f=1", "display_name": "soamya", "link": "https://stackoverflow.com/users/11274321/soamya"}, "edited": false, "score": 0, "creation_date": 1560789983, "post_id": 56634713, "comment_id": 99842495, "body": "Thanks for the clarification, but I am creating an API which can handle both types, as there are two different web application which would use this API and one has XML payload and other has JSON. That&#39;s why I want to handle it on the client side request handler, in case of XML payload I would like to convert it to JSON and call my core APIs which accept JSON format. IS there any other package or library which you can suggest ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 43, "user_id": 11274321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37c40e4b5a75537fe59ae6694541fbe?s=128&d=identicon&r=PG&f=1", "display_name": "soamya", "link": "https://stackoverflow.com/users/11274321/soamya"}, "edited": false, "score": 0, "creation_date": 1560790276, "post_id": 56634713, "comment_id": 99842607, "body": "@soamya as already mentioned in the answer and in the comments you do not need a library, all you need is to check the Content-Type header of the request to find out the type of the content of the body. If that header is not provided by the client that sends the request then you need to fix that side, not the back-end."}, {"owner": {"reputation": 43, "user_id": 11274321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37c40e4b5a75537fe59ae6694541fbe?s=128&d=identicon&r=PG&f=1", "display_name": "soamya", "link": "https://stackoverflow.com/users/11274321/soamya"}, "edited": false, "score": 0, "creation_date": 1560790613, "post_id": 56634713, "comment_id": 99842729, "body": "Got It ! Thanks !"}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 5, "last_activity_date": 1560786162, "creation_date": 1560786162, "answer_id": 56634713, "question_id": 56634501, "link": "https://stackoverflow.com/questions/56634501/content-type-of-post-request-payload/56634713#56634713", "title": "Content Type of POST request payload", "body": "<blockquote>\n  <p>I am using http.DetectContentType to return the content type o the request but it is returning text/plain is every scenario.</p>\n</blockquote>\n\n<p>According to the <a href=\"https://golang.org/pkg/net/http/#DetectContentType\" rel=\"noreferrer\">documentation</a> <code>DetectContentType</code> <em>\"... implements the algorithm described at <a href=\"https://mimesniff.spec.whatwg.org/\" rel=\"noreferrer\">https://mimesniff.spec.whatwg.org/</a> to determine the Content-Type of the given data\"</em>. The algorithm there is primarily for handling content types which the browser can handle by itself. </p>\n\n<p>And if you look  <a href=\"https://github.com/golang/go/blob/master/src/net/http/sniff.go\" rel=\"noreferrer\">at the actual code</a> you'll see that it does not care about <code>application/json</code> or similar at all and that it returns <code>text/plain</code> for anything which looks non-binary (and was not matched before as with <code>text/html</code>).</p>\n\n<p>In other words: this is the wrong tool for the job. The proper way would be for the client to specify what kind of content is sent using the <code>Content-Type</code> header and not to let the server guess the kind of content.</p>\n"}], "owner": {"reputation": 43, "user_id": 11274321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37c40e4b5a75537fe59ae6694541fbe?s=128&d=identicon&r=PG&f=1", "display_name": "soamya", "link": "https://stackoverflow.com/users/11274321/soamya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2218, "favorite_count": 0, "accepted_answer_id": 56634713, "answer_count": 1, "score": 0, "last_activity_date": 1560786162, "creation_date": 1560785499, "question_id": 56634501, "link": "https://stackoverflow.com/questions/56634501/content-type-of-post-request-payload", "title": "Content Type of POST request payload", "body": "<p>I am sending a JSON body in my POST Request, but http.DetectContentType is identifying it as a text/plain type.</p>\n\n<p>I want to have flexibility to process request payload based on their content type - if XML {}  if JSON {} else {NO Processing} </p>\n\n<p>To achieve this conditional processing, I am using http.DetectContentType to return the content type o the request but it is returning text/plain is every scenario.</p>\n\n<pre><code>func Test(w http.ResponseWriter, r *http.Request) *ErrorObject {\n\n        reqBuffer := make([]byte, 512)\n        _, err := r.Body.Read(reqBuffer)\n        if err != nil {\n\n    return ErrorObject{}.New(1, err, nil)\n}\n\ncontentType := GetContentType(reqBuffer)\nfmt.Printf(contentType)\n\n    if contentType == \"application/xml\" || contentType == \"text/xml\" {\n    w.Header().Set(\"Content-Type\", \"application/xml; charset=UTF-8\") ...}\n    if contentType == \"application/json\" || contentType == \"text/json\" {\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\") ... } \n    else return Invalid Request Type error\n} \n\n   func GetContentType(buffer []byte) string {\n\n       fmt.Println(string(buffer))\n       contentType := http.DetectContentType(buffer)\n       fmt.Printf(contentType)\n       return contentType\n\n    }\n</code></pre>\n\n<p>Expect to return the function - Content Type as application/json but getting text/plain </p>\n\n<p>Using POSTMAN to send request to server with Body as raw and JSON</p>\n\n<pre><code>    {\n      \"data\": [\n         {\n           \"group\": \"TEST\",\n           \"name\": \"TEST\",\n           \"released\": true,\n           \"version\": 1,\n           \"teststeps\": [\n              {\n                   \"bin\": 32,\n                   \"comment\": \"PAA\",\n                   \"dataType\": \"J\",\n                   \"format\": \"R6.2\",\n                   \"id\": \"PAA3\",\n                   \"osg\": 8,\n                   \"usg\": 0\n              }\n            ],\n           \"parameters\": [\n              {\n                  \"comment\": \"test\",\n                  \"description\": \"test\",\n                  \"format\": \"R7.0\",\n                  \"id\": 1,\n                  \"teststepId\": \"PAA\",\n                  \"value\": 30,\n                  \"type\": \"teststep\"\n            }\n          ]\n        }\n     ]\n  }\n</code></pre>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": true, "score": 3, "last_activity_date": 1560806115, "creation_date": 1560806115, "answer_id": 56639005, "question_id": 56633817, "link": "https://stackoverflow.com/questions/56633817/warning-unused-variable-cgo-a/56639005#56639005", "title": "warning: unused variable \u2018_cgo_a\u2019", "body": "<p>Do not use <code>-Wall</code> in cgo CFLAGS. This is a general issue in Go. Read more in the github thread: <a href=\"https://github.com/golang/go/issues/6883#issuecomment-383800123\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/6883#issuecomment-383800123</a></p>\n"}], "owner": {"reputation": 1474, "user_id": 3659011, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/8aLi8.jpg?s=128&g=1", "display_name": "Adam Zahran", "link": "https://stackoverflow.com/users/3659011/adam-zahran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "accepted_answer_id": 56639005, "answer_count": 1, "score": 3, "last_activity_date": 1560806115, "creation_date": 1560783123, "question_id": 56633817, "link": "https://stackoverflow.com/questions/56633817/warning-unused-variable-cgo-a", "title": "warning: unused variable \u2018_cgo_a\u2019", "body": "<p>What is the '_cgo_a' variable?</p>\n\n<p>I'm trying to link a c++ static lib.</p>\n\n<p>greeter.cpp</p>\n\n<pre><code>#include \"greeter.h\"\n#include &lt;iostream&gt;\n\nvoid\ngreet()\n{\n    std::cout &lt;&lt; \"Greetings\\n\";\n}\n</code></pre>\n\n<p>greeter.h</p>\n\n<pre><code>#ifndef GREETER_H_\n#define GREETER_H_\n\n#ifdef __cplusplus\nextern \"C\" {\n#endif\n\nvoid\ngreet();\n\n#ifdef __cplusplus\n}\n#endif\n\n#endif\n</code></pre>\n\n<p>I compiled the above into a static library like so:</p>\n\n<pre><code>$ g++ -c greeter.cpp\n$ ar vfx greeter.o -o libgreeter.a\n</code></pre>\n\n<p>and here's my main.go</p>\n\n<pre><code>package main\n\n// #cgo CFLAGS: -g -Wall\n// #cgo LDFLAGS: -L. -lgreeter\n// #include \"greeter.h\"\nimport \"C\"\n\nfunc main() {\n    C.greet()\n}\n</code></pre>\n\n<p>Then when I do <code>go build</code> that's what I get:</p>\n\n<pre><code># error\ncgo-gcc-prolog: In function \u2018_cgo_261f55e693f4_Cfunc_greet\u2019:\ncgo-gcc-prolog:46:49: warning: unused variable \u2018_cgo_a\u2019 [-Wunused-variable]\n</code></pre>\n\n<p>My go version: <code>go version go1.12.5 linux/amd64</code></p>\n\n<p>EDIT:\nIf I remove the <code>-Wall</code> from the CFLAGS it compiles fine. Still what is the <code>_cgo_a</code> variable and why is it give me an error?</p>\n"}, {"tags": ["python", "go", "binary"], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 10739773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d42d7ce80c37c542bed0d32e8b5e19b?s=128&d=identicon&r=PG&f=1", "display_name": "kms", "link": "https://stackoverflow.com/users/10739773/kms"}, "edited": false, "score": 0, "creation_date": 1560779117, "post_id": 56632416, "comment_id": 99837099, "body": "Thanks for the solution, It works fine but the second part of my question was that how do I retrieve output from Go binary i.e <code>pp.Pid()</code>  and use it as variable in my python script"}], "tags": [], "owner": {"reputation": 1186, "user_id": 1882397, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/kX5cT.png?s=128&g=1", "display_name": "kszl", "link": "https://stackoverflow.com/users/1882397/kszl"}, "is_accepted": true, "score": 0, "last_activity_date": 1560884755, "last_edit_date": 1560884755, "creation_date": 1560778333, "answer_id": 56632416, "question_id": 56632334, "link": "https://stackoverflow.com/questions/56632334/unable-to-pass-python-variable-to-go-binary/56632416#56632416", "title": "Unable to pass python variable to go binary", "body": "<pre><code>args_pid = 1401\ncmd = './process_pid {}'.format(args_pid)\nso = os.popen(cmd).read()\nprint so\n</code></pre>\n\n<p>You passed string args_pid to the Go binary instead of the actual value.</p>\n\n<hr>\n\n<p>When it comes to passing the answer, I'd go with something like this: your Go program could print the PID to stdout using <code>fmt.Printf(\"%d\", pp.Pid())</code>.</p>\n\n<p>Then what your Python code does to retrieve the answer is ok. You just need to cast it to int: <code>so = int(os.popen(cmd).read())</code> </p>\n"}], "owner": {"reputation": 93, "user_id": 10739773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d42d7ce80c37c542bed0d32e8b5e19b?s=128&d=identicon&r=PG&f=1", "display_name": "kms", "link": "https://stackoverflow.com/users/10739773/kms"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 56632416, "answer_count": 1, "score": -2, "last_activity_date": 1560884755, "creation_date": 1560778076, "question_id": 56632334, "link": "https://stackoverflow.com/questions/56632334/unable-to-pass-python-variable-to-go-binary", "title": "Unable to pass python variable to go binary", "body": "<p>In my python script I am trying to pass a variable to a Go binary to perform an operation and retrieve output from Go binary as variable and use it in my python script</p>\n\n<p>This is my Go Program which I am using to create my binary and I am creating binary </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"strconv\"\n\n    ps \"github.com/mitchellh/go-ps\"\n)\n\nvar args_pid string\nvar xyz int\n\nfunc main() {\nargs_pid = os.Args[1]\n\n    first, err := strconv.ParseInt(args_pid, 10, 0)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(2)\n    }\n    xyz = int(first)\n    pp, _ := ps.FindProcess(xyz)\n    log.Printf(\"The pid of passed process is %v\\n\", pp.Pid())\n}\n</code></pre>\n\n<p>This is my python script where I am using this binary</p>\n\n<pre><code>import os\nargs_pid = 1401\ncmd = './process_pid args_pid'\nso = os.popen(cmd).read()\nprint so\n</code></pre>\n\n<p>I get the following error: \n<code>strconv.ParseInt: parsing \"args_pid\": invalid syntax</code></p>\n\n<p>Can someone help me resolve this issue?</p>\n"}, {"tags": ["http", "go", "server", "x509certificate", "ca"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6171812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/153a67bd50aec28702289c1f4831c092?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne Wallace", "link": "https://stackoverflow.com/users/6171812/wayne-wallace"}, "edited": false, "score": 0, "creation_date": 1560781797, "post_id": 56632763, "comment_id": 99838542, "body": "I have attempted to not add the CAFile.pem as the RootCA also in my tls.config. But still, have the extra download required on my intermediate certification. I understand that you are saying the tls.X509KeyPair builds the chain automatically. The issue is that it is building it without the CAFile Here is the certs.ReadFile. // ReadFile returns a files contents as []byte from the filesystem, static or local func (f *Files) ReadFile(filename string) ([]byte, error) {  \tfile, err := f.dir.Open(f.determinePath(filename)) \tif err != nil { \t\treturn nil, err \t} return ioutil.ReadAll(file) }"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 11, "user_id": 6171812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/153a67bd50aec28702289c1f4831c092?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne Wallace", "link": "https://stackoverflow.com/users/6171812/wayne-wallace"}, "edited": false, "score": 0, "creation_date": 1560782052, "post_id": 56632763, "comment_id": 99838667, "body": "<a href=\"https://stackoverflow.com/posts/56632176/edit\">Edit the question</a> if you want to add additional information. Don&#39;t put non-trivial code into comments, please. However, in this case it isn&#39;t important how ReadFile is implemented. Important is that it returns the complete chain and not just the leaf certificate. So simply concatenate /certs/website.com.pem and /certs/CAFile.pem and you should be done."}, {"owner": {"reputation": 11, "user_id": 6171812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/153a67bd50aec28702289c1f4831c092?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne Wallace", "link": "https://stackoverflow.com/users/6171812/wayne-wallace"}, "edited": false, "score": 0, "creation_date": 1560782313, "post_id": 56632763, "comment_id": 99838851, "body": "Thanks for the feedback. My appologies, first time submitting question so a newb on this. So I agree that it is important that it returns the complete chain, but I am not sure how to add the CAFile.pem to the chain. It has no private key to pair it with... so that is where my confusion lies."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 11, "user_id": 6171812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/153a67bd50aec28702289c1f4831c092?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne Wallace", "link": "https://stackoverflow.com/users/6171812/wayne-wallace"}, "edited": false, "score": 0, "creation_date": 1560782463, "post_id": 56632763, "comment_id": 99838925, "body": "You don&#39;t need any key except the one for the leaf certificate. Just create one file with both certificates in it (or concatenate them in Go if that&#39;s easier for you; e.g. <code>tls.X509KeyPair(append(httpPem, caFilePem...), httpKey)</code>)."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 0, "last_activity_date": 1560779559, "creation_date": 1560779559, "answer_id": 56632763, "question_id": 56632176, "link": "https://stackoverflow.com/questions/56632176/how-do-i-add-a-cafile-to-our-certificates/56632763#56632763", "title": "How do I add a CAFile to our certificates", "body": "<p>From the <a href=\"https://golang.org/pkg/crypto/tls/#Config\" rel=\"nofollow noreferrer\">tls.Config documentation</a>: </p>\n\n<blockquote>\n  <p>Certificates contains one or more certificate <strong>chains</strong> to present to the other side of the connection.</p>\n  \n  <p>[...]</p>\n  \n  <p>RootCAs defines the set of root certificate authorities that <strong>clients</strong> use when verifying server certificates.</p>\n</blockquote>\n\n<p>The <code>RootCAs</code> field does nothing for servers. You only need to set the complete certificate chain in the <code>Certificates</code> field (excluding the root CA; that wouldn't technically break anything but waste bandwidth).</p>\n\n<p>You haven't shown what <code>certs.ReadFile</code> does, but you only need to ensure that it returns the PEM encoded leaf certificate and the intermediate(s) (i.e. the one that's an \"extra download\"), concatenated in that order. tls.X509KeyPair builds the chain automatically.</p>\n"}], "owner": {"reputation": 11, "user_id": 6171812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/153a67bd50aec28702289c1f4831c092?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne Wallace", "link": "https://stackoverflow.com/users/6171812/wayne-wallace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 425, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1560779559, "creation_date": 1560777453, "question_id": 56632176, "link": "https://stackoverflow.com/questions/56632176/how-do-i-add-a-cafile-to-our-certificates", "title": "How do I add a CAFile to our certificates", "body": "<p>We are using a web server in a docker container. At the moment our public private key is working fine. The problem we have is that our CAFile is not being included as an offered certificate when we test our site with <a href=\"https://www.ssllabs.com/\" rel=\"nofollow noreferrer\">https://www.ssllabs.com/</a>. After reviewing solutions, I attempted to add the certification to a caCertPool and added it to the configutation. Even after doing that, SSL Labs still says it does not see it and we still get a B Score. Here is a code snippet of what I am attempting without luck so far. </p>\n\n<pre><code>certs, err := newStaticCerts(&amp;static.Config{UseStaticFiles: cfg.IsProduction, FallbackToDisk: true, AbsPkgPath: getMessagePath()})\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if err != nil {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0log.WithFields(log.F(\"error\", err)).Fatal(\"Issue initializing static certs\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0httpKey, err := certs.ReadFile(\"/certs/website.com.key\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if err != nil {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0log.WithFields(log.F(\"error\", err)).Fatal(\"Issue loading tls key\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0httpPem, err := certs.ReadFile(\"/certs/website.com.pem\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if err != nil {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0log.WithFields(log.F(\"error\", err)).Fatal(\"Issue loading tls pem\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0caFilePem, err := certs.ReadFile(\"/certs/CAFile.pem\")\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if log.CheckErr(err, \"Issue loading CAFile pem\") {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0// Load client cert\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0cert, err := tls.X509KeyPair(httpPem, httpKey)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if err != nil {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0log.Fatal(err)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0caCertPool := x509.NewCertPool()\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0caCertPool.AppendCertsFromPEM(caFilePem)\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tlsConfig := &amp;tls.Config{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0MinVersion:               tls.VersionTLS12,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0CurvePreferences:         []tls.CurveID{tls.CurveP521, tls.CurveP384, tls.CurveP256},\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0PreferServerCipherSuites: true,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0CipherSuites: []uint16{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tls.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tls.TLS_RSA_WITH_AES_256_GCM_SHA384,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tls.TLS_RSA_WITH_AES_256_CBC_SHA,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0},\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Certificates: []tls.Certificate{cert},\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0RootCAs:      caCertPool,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0tlsConfig.BuildNameToCertificate()\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0//server := &amp;http.Server{Addr: \":\" + strconv.Itoa(cfg.AppPort), Handler: p.Serve(), TLSConfig: tlsConfig}\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0srv := &amp;http.Server{\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Addr:         \":\" + strconv.Itoa(cfg.AppPort),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Handler:      p.Serve(),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TLSConfig:    tlsConfig,\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TLSNextProto: make(map[string]func(*http.Server, *tls.Conn, http.Handler), 0),\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0err = kmshttp.RunServer(srv)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if log.CheckErr(err, \"shutting down server\") {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0}\n</code></pre>\n\n<p>The problem is when we check our Certification Paths, our RSA CA \nis an \"Extra download\" and not included on our site.</p>\n"}, {"tags": ["go", "encoding", "utf-8", "export-to-csv"], "comments": [{"owner": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 1, "creation_date": 1560774014, "post_id": 56629964, "comment_id": 99834149, "body": "How exactly are you confirming the final CSV? With a text editor/hex editor, or <i>Excel</i>\u2026?"}, {"owner": {"reputation": 29, "user_id": 11383611, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-acCnAkUqJ-Q/AAAAAAAAAAI/AAAAAAAAAik/0dMvTIwYoUk/photo.jpg?sz=128", "display_name": "Jaanus", "link": "https://stackoverflow.com/users/11383611/jaanus"}, "reply_to_user": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 0, "creation_date": 1560775955, "post_id": 56629964, "comment_id": 99835216, "body": "Excel is that stupid thing what does not get that it should be in UTF-8. I remember that in php and node i somehow managed to give &quot;headers&quot; with file and then it was smart enough to open that CSV with right encoding.  Other things get that those characters belong to UTF-8 and show them correctly (Notepad++, VS code, also default notepad show it correctly)"}, {"owner": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 2, "creation_date": 1560776285, "post_id": 56629964, "comment_id": 99835404, "body": "So, your problem is Excel related, not Go related, yes?"}, {"owner": {"reputation": 29, "user_id": 11383611, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-acCnAkUqJ-Q/AAAAAAAAAAI/AAAAAAAAAik/0dMvTIwYoUk/photo.jpg?sz=128", "display_name": "Jaanus", "link": "https://stackoverflow.com/users/11383611/jaanus"}, "reply_to_user": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 0, "creation_date": 1560843076, "post_id": 56629964, "comment_id": 99857979, "body": "I think that its Go, smarter editors just read the file before opening and detect utf8 in them, but excel is stupid and wants somekind of &quot;flag&quot; to open it as utf8.."}, {"owner": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 0, "creation_date": 1560844045, "post_id": 56629964, "comment_id": 99858504, "body": "Yes, Excel notoriously sucks when it comes to encodings. Believe it or not, there is no 100% foolproof method to produce a CSV file that <i>all versions of Excel</i> will read identically. At best you can produce a CSV file that <i>a particular version of Excel</i> (say, anything after 2012 on Windows) will read as expected. Either that, or you produce a standards compliant CSV file and let Excel users figure it out for themselves, or you provide an XLSX file as alternative."}], "owner": {"reputation": 29, "user_id": 11383611, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-acCnAkUqJ-Q/AAAAAAAAAAI/AAAAAAAAAik/0dMvTIwYoUk/photo.jpg?sz=128", "display_name": "Jaanus", "link": "https://stackoverflow.com/users/11383611/jaanus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560773805, "creation_date": 1560769319, "last_edit_date": 1560773805, "question_id": 56629964, "link": "https://stackoverflow.com/questions/56629964/encoded-csv-with-sqltocsv-package-not-working-with-non-ascii-characters", "title": "Encoded CSV with sqlToCsv package not working with non-ASCII characters", "body": "<p>I am using package \"github.com/jeffyi/sqltocsv\" to export MSSql rows to CSV files.</p>\n\n<p>My problem is that special characters end up wrong way:</p>\n\n<p>\u00fc as \u0106\u00bc\n\u00e4 as \u0106\u00a4\netc.. </p>\n\n<p>I have read the sqltocsv package multiple times and I just don't get that when and where is it going wrong.</p>\n\n<p>i have logged output to console, before exporting data comes out from DB as UTF-8 but on adding to CSV it gets messed up.</p>\n\n<p>I have tryed to use package \"encoding/csv\" to convert my data to csv file. \n(without any success)</p>\n\n<p>Here's how I use sqlToCsv package:</p>\n\n<pre><code>rows, _ := db.Query(sqlQuery)\n\n            csvConverter := sqltocsv.New(rows)\n            csvConverter.Delimiter = ';'\n            csvConverter.TimeFormat = time.RFC822\n\n            csvConverter.WriteFile(directory + \"/\" + fileName)\n</code></pre>\n\n<p>so in the end result should all characters be as they are:</p>\n\n<p>\u00fc as \u00fc (not \u0106\u00bc )\n\u00e4 as \u00e4 (not \u0106\u00a4 )</p>\n"}, {"tags": ["json", "http", "security", "go", "gzip"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1560766669, "post_id": 56629115, "comment_id": 99830331, "body": "The first thing to do would be not to unzip into memory. This is usually good advice, regardless of zip bombs. What are you doing with the uncompressed content? Can you treat it like a stream?  If not, unzip to disk, instead of memory."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1560766678, "post_id": 56629115, "comment_id": 99830336, "body": "Worst case scenario, abort if the content is too large."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560766751, "post_id": 56629115, "comment_id": 99830372, "body": "@Flimzy Even then, it is thinkable that the extracted size exceeds the disk space."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1560766847, "post_id": 56629115, "comment_id": 99830424, "body": "@MarkusWMahlberg: That&#39;s true with or without a zip bomb. I would assume that&#39;s already being checked for, and/or disk-full errors are being handled properly."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1560766899, "post_id": 56629115, "comment_id": 99830456, "body": "In general, do not use <code>ReadAll</code>. Use <code>Read</code> insteadand determine a threshold of the size of data read thus far vs gzip filesize. If this compression ratio exceeds what can reasonably be expected, abort."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 3, "creation_date": 1560767041, "post_id": 56629115, "comment_id": 99830542, "body": "@frankegoesdown A REST API can use temporary files as good as literally every other piece of software."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1560804411, "last_edit_date": 1560804411, "creation_date": 1560768082, "answer_id": 56629623, "question_id": 56629115, "link": "https://stackoverflow.com/questions/56629115/how-to-protect-service-from-gzip-bomb/56629623#56629623", "title": "How to protect service from gzip bomb?", "body": "<p>What can be deceiving is that the compressed size may be significantly smaller that the allowed size (the size you can or you wish to handle). In your example the input is about 1 MB, while the uncompressed size is about 1 GB.</p>\n\n<p>While reading the <em>uncompressed</em> data you should stop after reaching a reasonable limit. To easily do that, you may use <a href=\"https://golang.org/pkg/io/#LimitReader\" rel=\"nofollow noreferrer\"><code>io.LimitReader()</code></a> where you can specify the max amount of bytes you wish to read. Yes, you have to wrap the <em>unzipped</em> stream, not the original, compressed stream.</p>\n\n<p>This is an example how it would look like:</p>\n\n<pre><code>limited := io.LimitReader(fz, 2*1024*1024)\n\ns, err := ioutil.ReadAll(limited)\n</code></pre>\n\n<p>The above example limits the readable data to 2 MB. What happens when the unzipped data is more than that? The <code>io.Reader</code> returned by <code>io.LimitReader()</code> (which is by the way an <a href=\"https://golang.org/pkg/io/#LimitedReader\" rel=\"nofollow noreferrer\"><code>io.LimitedReader</code></a>) will report <code>io.EOF</code>. This protects your server from the attack, but might not be the best way to handle it.</p>\n\n<p>Since you mentioned this is for a rest API, a better suited solution would be the similar <a href=\"https://golang.org/pkg/net/http/#MaxBytesReader\" rel=\"nofollow noreferrer\"><code>http.MaxBytesReader()</code></a>. This wraps the passed reader to read up until a given limit, and if that is reached, it returns an error, and also sends an error back to the HTTP client, and also closes the underlying read-closer. If the default behavior of <code>http.MaxBytesReader()</code> is not suitable for you, check its sources, copy it and modify it, it's relatively simple. Tune it to your needs.</p>\n\n<p>Also note that you should not read everything (the uncompressed data) into memory. You may pass the \"limited reader\" to <a href=\"https://golang.org/pkg/encoding/json/#NewDecoder\" rel=\"nofollow noreferrer\"><code>json.NewDecoder()</code></a> which will read from the given reader while decoding the input JSON. Of course if the passed limited reader reports an error, the decoding will fail.</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 3, "last_activity_date": 1560769025, "last_edit_date": 1560769025, "creation_date": 1560768930, "answer_id": 56629857, "question_id": 56629115, "link": "https://stackoverflow.com/questions/56629115/how-to-protect-service-from-gzip-bomb/56629857#56629857", "title": "How to protect service from gzip bomb?", "body": "<p>Don't read everything into memory. Operate on a stream if possible. This is 100% possible in your example:</p>\n\n<pre><code>func ReadGzFile(filename string) (io.ReadCloser, error) {\n    fi, err := os.Open(filename)\n    if err != nil {\n        return nil, err\n    }\n\n    return gzip.NewReader(fi)\n}\n\nfunc main() {\n    b, err := ReadGzFile(\"test.gzip\")\n    if err != nil {\n        log.Println(err)\n    }\n    defer b.Close()\n    var dat map[string]interface{}\n    if err := json.NewDecoder(b).Decode(&amp;dat); err != nil {\n        panic(err)\n    }\n    fmt.Println(dat)\n}\n</code></pre>\n\n<p>This <code>Decode</code> approach has the side effect (which may or may not be desirable) of ignoring any garbage in the stream after the first valid JSON object.  In your case, this seems like a benefit. In some cases, it may not be.</p>\n"}], "owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1371, "favorite_count": 0, "accepted_answer_id": 56629623, "answer_count": 2, "score": 1, "last_activity_date": 1560804411, "creation_date": 1560766191, "last_edit_date": 1560769945, "question_id": 56629115, "link": "https://stackoverflow.com/questions/56629115/how-to-protect-service-from-gzip-bomb", "title": "How to protect service from gzip bomb?", "body": "<p>I have <code>test.gzip</code> file with json</p>\n\n<pre><code>{\"events\": [\n{\"uuid\":\"56c1718c-8eb3-11e9-8157-e4b97a2c93d3\",\n\"timestamp\":\"2019-06-14 14:47:31 +0000\",\n\"number\":732,\n\"user\": {\"full_name\":\"0\"*1024*1024*1024}}]}\n</code></pre>\n\n<p>full_name filed contains 1GB of <code>0</code>, zipped filesize ~1Mb</p>\n\n<p>how can I protect my service during unpacking so that my memory is not over?</p>\n\n<pre><code>func ReadGzFile(filename string) ([]byte, error) {\n    fi, err := os.Open(filename)\n    if err != nil {\n        return nil, err\n    }\n    defer fi.Close()\n\n    fz, err := gzip.NewReader(fi)\n    if err != nil {\n        return nil, err\n    }\n    defer fz.Close()\n\n    s, err := ioutil.ReadAll(fz)\n    if err != nil {\n        return nil, err\n    }\n    return s, nil\n}\n\nfunc main() {\n    b, err := ReadGzFile(\"test.gzip\")\n    if err != nil {\n        log.Println(err)\n    }\n    var dat map[string]interface{}\n    if err := json.Unmarshal(b, &amp;dat); err != nil {\n        panic(err)\n    }\n    fmt.Println(dat)\n}\n</code></pre>\n\n<p>In this case output can kill my service by OOMKiller</p>\n"}, {"tags": ["go", "kubernetes", "kubelet"], "comments": [{"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1560781113, "post_id": 56628111, "comment_id": 99838134, "body": "Can you explain the exact problem you are facing?"}, {"owner": {"reputation": 41, "user_id": 8543155, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rpePV.jpg?s=128&g=1", "display_name": "Bo Wang", "link": "https://stackoverflow.com/users/8543155/bo-wang"}, "reply_to_user": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1560839140, "post_id": 56628111, "comment_id": 99856056, "body": "thanks Giulio, I would like a way to dump goroutine stack trace of kubelet to help resolve all deadlock kind problems not only for an exact one."}], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 8543155, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rpePV.jpg?s=128&g=1", "display_name": "Bo Wang", "link": "https://stackoverflow.com/users/8543155/bo-wang"}, "is_accepted": true, "score": 2, "last_activity_date": 1560861522, "last_edit_date": 1560861522, "creation_date": 1560859847, "answer_id": 56648851, "question_id": 56628111, "link": "https://stackoverflow.com/questions/56628111/how-to-dump-goroutines-stack-race-of-the-running-kubelet/56648851#56648851", "title": "How to dump goroutines stack race of the running kubelet", "body": "<ol>\n<li><p>pprof, it will keep kubelet running</p>\n\n<ul>\n<li>install go on node-x </li>\n<li>run \u201ckubectl proxy\u201d in one terminal</li>\n<li>curl <a href=\"http://localhost:8001/api/v1/proxy/nodes/node-x/debug/pprof/goroutine?debug=2\" rel=\"nofollow noreferrer\">http://localhost:8001/api/v1/proxy/nodes/node-x/debug/pprof/goroutine?debug=2</a></li>\n</ul></li>\n<li><p>send signal to kubelet which caused kubelet to exit with a stack dump</p>\n\n<p>kill -SIGABRT </p></li>\n</ol>\n"}], "owner": {"reputation": 41, "user_id": 8543155, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rpePV.jpg?s=128&g=1", "display_name": "Bo Wang", "link": "https://stackoverflow.com/users/8543155/bo-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 518, "favorite_count": 1, "accepted_answer_id": 56648851, "answer_count": 1, "score": 0, "last_activity_date": 1560861522, "creation_date": 1560762365, "last_edit_date": 1560846843, "question_id": 56628111, "link": "https://stackoverflow.com/questions/56628111/how-to-dump-goroutines-stack-race-of-the-running-kubelet", "title": "How to dump goroutines stack race of the running kubelet", "body": "<p>kubernetes is complicated, kubelet run into deadlocks after long running in some scenarios.</p>\n\n<p><strong>Is there a way to dump goroutine stack trace of the running kubelet</strong>?</p>\n\n<p>The expected output like following which is very helpful to debug deadlock kind issues of kubelet.</p>\n\n<pre><code>goroutine 386 [chan send, 1140 minutes]:\nk8s.io/kubernetes/pkg/kubelet/pleg.(*GenericPLEG).relist(0xc42069ea20)\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/pleg/generic.go:261 +0x74e\nk8s.io/kubernetes/pkg/kubelet/pleg.(*GenericPLEG).(k8s.io/kubernetes/pkg/kubelet/pleg.relist)-fm()\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/pleg/generic.go:130 +0x2a\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.JitterUntil.func1(0xc4212ee520)\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:133 +0x54\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.JitterUntil(0xc4212ee520, 0x3b9aca00, 0x0, 0x1, 0xc420056540)\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:134 +0xbd\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.Until(0xc4212ee520, 0x3b9aca00, 0xc420056540)\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:88 +0x4d\ncreated by k8s.io/kubernetes/pkg/kubelet/pleg.(*GenericPLEG).Start\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/pleg/generic.go:130 +0x88\n...\ngoroutine 309 [sleep]:\ntime.Sleep(0x12a05f200)\n    /usr/local/go/src/runtime/time.go:102 +0x166\nk8s.io/kubernetes/pkg/kubelet.(*Kubelet).syncLoop(0xc4205e3b00, 0xc420ff2780, 0x3e56a60, 0xc4205e3b00)\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/kubelet.go:1777 +0x1e7\nk8s.io/kubernetes/pkg/kubelet.(*Kubelet).Run(0xc4205e3b00, 0xc420ff2780)\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/pkg/kubelet/kubelet.go:1396 +0x27f\nk8s.io/kubernetes/cmd/kubelet/app.startKubelet.func1()\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/cmd/kubelet/app/server.go:998 +0x67\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.JitterUntil.func1(0xc42105dfb0)\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:133 +0x54\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.JitterUntil(0xc42105dfb0, 0x0, 0x0, 0x1, 0xc420056540)\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:134 +0xbd\nk8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait.Until(0xc42105dfb0, 0x0, 0xc420056540)\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/vendor/k8s.io/apimachinery/pkg/util/wait/wait.go:88 +0x4d\ncreated by k8s.io/kubernetes/cmd/kubelet/app.startKubelet\n    /workspace/anago-v1.11.5-beta.0.24+753b2dbc622f5c/src/k8s.io/kubernetes/_output/dockerized/go/src/k8s.io/kubernetes/cmd/kubelet/app/server.go:996 +0xea\n...\n</code></pre>\n\n<p>I appreciate that anyone could share the experience about how to dump goroutines stack race of kubelet that something like what docker provided[1]</p>\n\n<pre><code>$ pkill -SIGUSR1 dockerd\n</code></pre>\n\n<p>[1]. <a href=\"https://success.docker.com/article/how-to-dump-goroutines-stacktraces\" rel=\"nofollow noreferrer\">https://success.docker.com/article/how-to-dump-goroutines-stacktraces</a></p>\n"}, {"tags": ["go", "tcp", "proxy"], "comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1560817177, "post_id": 56626858, "comment_id": 99851447, "body": "CLOSE_WAIT means you aren&#39;t closing sockets when you should, i.e. when you get EOS on a read. TIME_WAIT is normal but you can reduce them by <i>not</i> closing <i>until</i> you get the EOS from the peer."}], "answers": [{"comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1560817283, "post_id": 56640123, "comment_id": 99851469, "body": "With this option the kernel will reset the connections instead of closing them,and throw away all data still in flight. This is violently inappropriate for most purposes and certainly for a proxy. And this does not solve CLOSE_WAIT in any way."}, {"owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1560826279, "post_id": 56640123, "comment_id": 99852994, "body": "Agree on CLOSE_WAIT, but SO_LINGER is the only opt if u wanna clean up TIME_WAIT, might set it to &gt; 0 tho"}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1560901781, "post_id": 56640123, "comment_id": 99886408, "body": "It&#39;s not the only option. If you are the end that always <i>receives</i> the first FIN, you never enter TIME_WAIT at all. See the state diagram. So, wait for the EOS from the peer before you close. Simple."}], "tags": [], "owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "is_accepted": false, "score": -1, "last_activity_date": 1560815371, "creation_date": 1560815371, "answer_id": 56640123, "question_id": 56626858, "link": "https://stackoverflow.com/questions/56626858/unstable-proxy-server-as-a-result-of-rising-close-wait-and-time-wait-sockets/56640123#56640123", "title": "Unstable proxy server as a result of rising CLOSE_WAIT and TIME_WAIT sockets", "body": "<p>you can try:</p>\n\n<pre><code>conn, ok = conn.(*net.TCPConn)\nif ok {\n     conn.SetLinger(0)\n}\n</code></pre>\n\n<p>with this option the kernel will close TIME_WAIT and CLOSE_WAIT (terminating states) sockets quicker.</p>\n\n<p>notes:</p>\n\n<ul>\n<li>TIME_WAIT: your server initiated tcp termination, TIME_WAIT is the last state of that tcp conn on your server</li>\n<li>CLOSE_WAIT: client initiated tcp termination, your server is waiting for FIN ACK from client</li>\n</ul>\n"}], "owner": {"reputation": 975, "user_id": 2148352, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HcT8H.jpg?s=128&g=1", "display_name": "James May", "link": "https://stackoverflow.com/users/2148352/james-may"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 284, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560815371, "creation_date": 1560757550, "question_id": 56626858, "link": "https://stackoverflow.com/questions/56626858/unstable-proxy-server-as-a-result-of-rising-close-wait-and-time-wait-sockets", "title": "Unstable proxy server as a result of rising CLOSE_WAIT and TIME_WAIT sockets", "body": "<p>I have socks5 proxy server written on golang. The daemon is listening 10000 ports from 15000 to 25000 and so this is a proxy list. Recently we started to test it with some clients and we end up with about 500 rps on 5000 of these ports. This is not as much I think, but I immediately point bunch of problems.</p>\n\n<p>The server is Ubuntu 18, 8 cores, 32G RAM, 1Gb network. I observe almost 800% CPU all the time and constantly rising number of CLOSE_WAIT and TIME_WAIT socket states. I investigate the code carefully about a week, but not point any problem, all connections are closing everywhere.</p>\n\n<p>pprof is saying that this is all about system calls, more precisely socket read. ReadAtLeast here is reading first 3 bytes of socks5 request to determine the request type.</p>\n\n<p><a href=\"https://i.stack.imgur.com/CXy7D.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CXy7D.png\" alt=\"enter image description here\"></a></p>\n\n<pre><code>func (s *Server) Serve(conn net.Conn) error {\n    defer conn.Close() // seems doesn't work too\n\n    _ = conn.SetDeadline(time.Now().Add(time.Second * 30)) // doesn't work\n\n    request, err := NewRequest(conn)\n    if err != nil {\n        return err\n    }\n\n    // Process the client request\n    return s.handleRequest(request, conn)\n}\n\nfunc NewRequest(bufConn io.Reader) (*Request, error) {\n    header := []byte{0, 0, 0}\n    if _, err := io.ReadAtLeast(bufConn, header, 3); err != nil {\n        return nil, fmt.Errorf(\"Failed to get command version: %v\", err)\n    }\n\n    // ...\n}\n</code></pre>\n\n<p>net.ipv4.tcp_fin_timeout=25 so 2MSL is 50 seconds, but seems the sockets just don't have enough time to close because new ones coming in to fast. This is about TIME_WAIT. What wrong with CLOSE_WAIT I have no idea. I definitely close the connection, but seems not getting FIN_ACK from the client.</p>\n\n<p>As a temporary solution I put the restart command to the crontab each 15 minutes, so all CLOSE_WAIT connections are dropped and TIME_WAIT decreased a little, but this is a downtime etc.</p>\n\n<p><a href=\"https://i.stack.imgur.com/ZJhBh.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ZJhBh.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["javascript", "node.js", "go", "math"], "comments": [{"owner": {"reputation": 47165, "user_id": 5053002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab6a9edfd2614014563162586c1b0697?s=128&d=identicon&r=PG", "display_name": "Jaromanda X", "link": "https://stackoverflow.com/users/5053002/jaromanda-x"}, "edited": false, "score": 1, "creation_date": 1560757284, "post_id": 56626783, "comment_id": 99825793, "body": "bitwise operations in javascript result in signed 32 bit result - as per <b><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators#Signed_32-bit_integers\" rel=\"nofollow noreferrer\">documentation</a></b>"}, {"owner": {"reputation": 871354, "user_id": 157247, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/4HovX.jpg?s=128&g=1", "display_name": "T.J. Crowder", "link": "https://stackoverflow.com/users/157247/t-j-crowder"}, "edited": false, "score": 1, "creation_date": 1560757362, "post_id": 56626783, "comment_id": 99825830, "body": "When you use <i>any</i> of the bitwise operators in JavaScript, the number you operate on is first converted to a 32-bit <b>signed</b> integer, then the operation is performed, then it&#39;s converted back to a double (an IEEE-754 binary double-precison number). I can&#39;t speak for GoLang, but my guess is you&#39;re dealing with unsigned there instead."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1560757456, "post_id": 56626783, "comment_id": 99825871, "body": "The Go version uses the <code>int</code> type which is <code>int64</code> or <code>int32</code> depending on the architecture. Since you get a result and not a compile-time overflow, it&#39;s <code>int64</code>."}, {"owner": {"reputation": 47165, "user_id": 5053002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab6a9edfd2614014563162586c1b0697?s=128&d=identicon&r=PG", "display_name": "Jaromanda X", "link": "https://stackoverflow.com/users/5053002/jaromanda-x"}, "edited": false, "score": 0, "creation_date": 1560757482, "post_id": 56626783, "comment_id": 99825879, "body": "just add <code>0x100000000</code> if the result is negative in javascript"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 47165, "user_id": 5053002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab6a9edfd2614014563162586c1b0697?s=128&d=identicon&r=PG", "display_name": "Jaromanda X", "link": "https://stackoverflow.com/users/5053002/jaromanda-x"}, "edited": false, "score": 0, "creation_date": 1560757545, "post_id": 56626783, "comment_id": 99825904, "body": "As @JaromandaX wrote, use <code>console.log(0x100000000+(number1 ^ number2))</code>."}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560757578, "post_id": 56626853, "comment_id": 99825925, "body": "Go doesn&#39;t use unsigned integers in the above code, but <code>int64</code>."}, {"owner": {"reputation": 38349, "user_id": 10221765, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e762fef8d87381d5cbd58d851d1b816?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Bashford", "link": "https://stackoverflow.com/users/10221765/jack-bashford"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560757603, "post_id": 56626853, "comment_id": 99825935, "body": "Thanks @icza, I&#39;ll add that to my answer"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560757724, "post_id": 56626853, "comment_id": 99825993, "body": "Also include the &quot;fix&quot; how to get the same output as in Go and it&#39;ll be perfect."}, {"owner": {"reputation": 38349, "user_id": 10221765, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e762fef8d87381d5cbd58d851d1b816?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Bashford", "link": "https://stackoverflow.com/users/10221765/jack-bashford"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1560758245, "post_id": 56626853, "comment_id": 99826208, "body": "There is no real &quot;fix&quot; unless you recreate bitwise XOR with IEEE-754."}], "tags": [], "owner": {"reputation": 38349, "user_id": 10221765, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e762fef8d87381d5cbd58d851d1b816?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Bashford", "link": "https://stackoverflow.com/users/10221765/jack-bashford"}, "is_accepted": true, "score": 4, "last_activity_date": 1560758458, "last_edit_date": 1560758458, "creation_date": 1560757536, "answer_id": 56626853, "question_id": 56626783, "link": "https://stackoverflow.com/questions/56626783/whats-the-difference-between-go-and-javascript-about-0xffffffff-97/56626853#56626853", "title": "What&#39;s the difference between Go and Javascript about 0xFFFFFFFF ^ 97", "body": "<p>In JavaScript, a bitwise operation (<code>^</code> is bitwise XOR) converts the numbers signed 32-bit integer, then back to a double. So after the XOR operation is performed, the number is converted back to its default type - IEEE-754 double-precision binary number - and then the result is given. </p>\n\n<pre><code>number -&gt; 32-bit signed integer -&gt; bitwise operation -&gt; IEEE-754 double-precision binary number\n</code></pre>\n\n<p>GoLang uses unsigned integers (<a href=\"https://golang.org/ref/spec#Arithmetic_operators\" rel=\"nofollow noreferrer\">GoLang spec</a>), or, as pointed out by <a href=\"https://stackoverflow.com/users/1705598/icza\">icza</a>, <code>int64</code> numbers.</p>\n"}], "owner": {"reputation": 31, "user_id": 9187890, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tXVv7.jpg?s=128&g=1", "display_name": "DeeLMind", "link": "https://stackoverflow.com/users/9187890/deelmind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 56626853, "answer_count": 1, "score": 1, "last_activity_date": 1560763442, "creation_date": 1560757197, "last_edit_date": 1560763442, "question_id": 56626783, "link": "https://stackoverflow.com/questions/56626783/whats-the-difference-between-go-and-javascript-about-0xffffffff-97", "title": "What&#39;s the difference between Go and Javascript about 0xFFFFFFFF ^ 97", "body": "<p>I want to change Go code to Javascript code, but there is one mistake about result that is different between Go and Javascript.\nI want to change javascript's result to same as Go's result (0xFFFFFFFF ^ 97)</p>\n\n<p>I try to debug it, and I recognize that 0xFFFFFFFF ^ 97 , in Go is 4294967198 but in javascript it is -98.</p>\n\n<p>In Go:</p>\n\n<pre><code>number1 := 0xFFFFFFFF\nnumber2 := 97\nfmt.Print(number1 ^ number2) // 4294967198 \n</code></pre>\n\n<p>In Javascript:</p>\n\n<pre><code>var number1 = 0xFFFFFFFF\nvar number2 = 97\nconsole.log(number1 ^ number2) // -98\n</code></pre>\n\n<p>0xFFFFFFFF ^ 97 is different result in Go and Javascript</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1560752204, "post_id": 56625287, "comment_id": 99823693, "body": "<a href=\"https://play.golang.com/p/GOqySHhNMbJ\" rel=\"nofollow noreferrer\">play.golang.com/p/GOqySHhNMbJ</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1560752218, "post_id": 56625287, "comment_id": 99823697, "body": "Basically: You cannot do this. You will either have to unmarshal in steps or write your on Unmarshaler."}, {"owner": {"reputation": 2887, "user_id": 3068541, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/787075573/picture?type=large", "display_name": "JackyJohnson", "link": "https://stackoverflow.com/users/3068541/jackyjohnson"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1560753100, "post_id": 56625287, "comment_id": 99824012, "body": "@mkopriva thanks for the example using <code>d.Token()</code>!"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1560753375, "post_id": 56625287, "comment_id": 99824122, "body": "@believesInSanta no problem, although I realize that for this example case it&#39;s a bit overkill since all you need are <a href=\"https://play.golang.com/p/fU3PPqtbtEJ\" rel=\"nofollow noreferrer\">tags</a> to get the same result. It would make more sense if your go structs would look more like this: <a href=\"https://play.golang.com/p/Ds5VEcVSXHE\" rel=\"nofollow noreferrer\">play.golang.com/p/Ds5VEcVSXHE</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2887, "user_id": 3068541, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/787075573/picture?type=large", "display_name": "JackyJohnson", "link": "https://stackoverflow.com/users/3068541/jackyjohnson"}, "edited": false, "score": 0, "creation_date": 1560751440, "post_id": 56625449, "comment_id": 99823431, "body": "You would have to unmarshal multiple times though.  For illustration, suppose <code>Apple</code> has &quot;Color&quot; element, and &quot;Peach&quot; has a &quot;Size&quot; element.  Editing post now."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 2887, "user_id": 3068541, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/787075573/picture?type=large", "display_name": "JackyJohnson", "link": "https://stackoverflow.com/users/3068541/jackyjohnson"}, "edited": false, "score": 0, "creation_date": 1560751788, "post_id": 56625449, "comment_id": 99823521, "body": "Check the alternative solution I&#39;m proposing. You would just need to implement the logic in the <code>Fruit</code> type&#39;s unmarshal function, and to call <code>xml.Unmarshal</code> on the fruits type once."}, {"owner": {"reputation": 2887, "user_id": 3068541, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/787075573/picture?type=large", "display_name": "JackyJohnson", "link": "https://stackoverflow.com/users/3068541/jackyjohnson"}, "edited": false, "score": 0, "creation_date": 1560752014, "post_id": 56625449, "comment_id": 99823620, "body": "I see how you&#39;re handling the parsing within the interface method, but here you&#39;re just appending Apple&#39;s and Peach&#39;es, how would you unmarshal the respective data into each Apple and Peach?"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 2887, "user_id": 3068541, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/787075573/picture?type=large", "display_name": "JackyJohnson", "link": "https://stackoverflow.com/users/3068541/jackyjohnson"}, "edited": false, "score": 0, "creation_date": 1560752684, "post_id": 56625449, "comment_id": 99823875, "body": "Done. Let me know if that answers your question :)"}, {"owner": {"reputation": 2887, "user_id": 3068541, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/787075573/picture?type=large", "display_name": "JackyJohnson", "link": "https://stackoverflow.com/users/3068541/jackyjohnson"}, "edited": false, "score": 0, "creation_date": 1560753055, "post_id": 56625449, "comment_id": 99823996, "body": "Yes, I think so.  Thanks :)"}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 2, "last_activity_date": 1560752615, "last_edit_date": 1560752615, "creation_date": 1560751121, "answer_id": 56625449, "question_id": 56625287, "link": "https://stackoverflow.com/questions/56625287/unmarshaling-xml-use-different-target-type-based-on-an-attribute-value/56625449#56625449", "title": "Unmarshaling XML: use different target type based on an attribute value", "body": "<p>You can simply iterate on the nodes of your <code>Element</code> type and create the <code>Apple</code> and <code>Peach</code> structures as you go, by switching on their <code>Name</code> attribute:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    for _, element := range e.Nodes {\n        switch element.Name {\n        case \"apple\":\n            apples = append(apples, Apple{})\n        case \"peach\":\n            peaches = append(peaches, Peach{})\n        }\n    }\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/TY8MxRNstiQ\" rel=\"nofollow noreferrer\">Here is a playground link</a>.</p>\n\n<p>Another, more complex solution (but also more elegant and practical) would be to implement your own <code>UnmarshalXML</code> method on your <code>Element</code> type, which would directly populate it with the proper types:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Apple struct {\n    Color string\n}\ntype Peach struct {\n    Size string\n}\n\ntype Fruits struct {\n    Apples  []Apple\n    Peaches []Peach\n}\n\ntype Element struct {\n    XMLName xml.Name `xml:\"element\"`\n    Nodes   []struct {\n        Name  string `xml:\"name,attr\"`\n        Apple struct {\n            Color string `xml:\"color\"`\n        } `xml:\"apple\"`\n        Peach struct {\n            Size string `xml:\"size\"`\n        } `xml:\"peach\"`\n    } `xml:\"node\"`\n}\n\nfunc (f *Fruits) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    var element Element\n    d.DecodeElement(&amp;element, &amp;start)\n\n    for _, el := range element.Nodes {\n        switch el.Name {\n        case \"apple\":\n            f.Apples = append(f.Apples, Apple{\n                Color: el.Apple.Color,\n            })\n        case \"peach\":\n            f.Peaches = append(f.Peaches, Peach{\n                Size: el.Peach.Size,\n            })\n        }\n    }\n\n    return nil\n}\n\nfunc main() {\n    f := Fruits{}\n\n    err := xml.Unmarshal([]byte(x), &amp;f)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(\"Apples:\", f.Apples)\n    fmt.Println(\"Peaches\", f.Peaches)\n}\n</code></pre>\n\n<p><a href=\"https://goplay.space/#F5TWPwCoJmS\" rel=\"nofollow noreferrer\">Here is a playground link for this second solution</a></p>\n\n<p>Result:</p>\n\n<blockquote>\n<pre><code>Apples: [{red}]\nPeaches [{medium}]\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 2887, "user_id": 3068541, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/787075573/picture?type=large", "display_name": "JackyJohnson", "link": "https://stackoverflow.com/users/3068541/jackyjohnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 56625449, "answer_count": 1, "score": 1, "last_activity_date": 1560765098, "creation_date": 1560750099, "last_edit_date": 1560765098, "question_id": 56625287, "link": "https://stackoverflow.com/questions/56625287/unmarshaling-xml-use-different-target-type-based-on-an-attribute-value", "title": "Unmarshaling XML: use different target type based on an attribute value", "body": "<p>I want to use a different type to unmarshal the XML content of a child node based on its parent's name attribute.</p>\n\n<p>In the following example I have 2 children nodes with attributes \"apple\" and \"peach\".  I would like to use type <code>Apple</code> when the attribute is <code>\"apple\"</code> and <code>Peach</code> when it's <code>\"peach\"</code>.  Basically <code>Apple</code> and <code>Peach</code> have very different structures, so that's the scenario.  How would I accomplish that or what would be the suggested approach?</p>\n\n<p>Here is the <a href=\"https://play.golang.org/p/4uhhSkN6UQc\" rel=\"nofollow noreferrer\">playground</a> with a basic setup to the problem. </p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;element&gt;\n    &lt;node name=\"apple\"&gt;\n        &lt;apple&gt;\n            &lt;color&gt;red&lt;color&gt;\n        &lt;/apple&gt;\n    &lt;/node&gt;\n    &lt;node name=\"peach\"&gt; \n        &lt;peach&gt;\n            &lt;size&gt;medium&lt;/size&gt;\n        &lt;/peach&gt;\n    &lt;/node&gt;\n&lt;/element&gt;\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var x = `...` // xml\ntype Element struct {\n    Nodes []struct{\n        Name string `xml:\"name,attr\"`\n    } `xml:\"node\"`\n    Apple Apple\n    Peach Peach\n}\ntype Apple struct { // use this struct if name is \"apple\"\n    Color string \n} \ntype Peach struct { // use this struct if name is \"peach\"\n    Size string\n}\nfunc main() {\n    e := Element{}\n    err := xml.Unmarshal([]byte(x), &amp;e)\n    if err != nil {\n        panic(err)\n    }   \n    fmt.Println(e.Apple.Color)\n    fmt.Println(e.Peach.Size\n}\n</code></pre>\n"}, {"tags": ["go", "amazon-s3", "singleton"], "answers": [{"comments": [{"owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1560808462, "post_id": 56623201, "comment_id": 99849518, "body": "Ohh yes, you are SPOT ON, thanks! Do you know how can retry logic be written, for example, if sessions are expired, recreate it?"}], "tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": false, "score": 2, "last_activity_date": 1560726027, "creation_date": 1560726027, "answer_id": 56623201, "question_id": 56623036, "link": "https://stackoverflow.com/questions/56623036/how-to-keep-single-aws-s3-session-in-app/56623201#56623201", "title": "How to keep single AWS S3 session in app?", "body": "<p><code>bigS3 := s3.New(sess)</code> assigns the value to a new variable local to the function, not the one you want. Change it to:</p>\n\n<pre><code>bigS3 = s3.New(sess)\n</code></pre>\n\n<p>and the value won\u2019t be nil any more.</p>\n"}], "owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1560756398, "creation_date": 1560723838, "last_edit_date": 1560756398, "question_id": 56623036, "link": "https://stackoverflow.com/questions/56623036/how-to-keep-single-aws-s3-session-in-app", "title": "How to keep single AWS S3 session in app?", "body": "<p>In a Go 1.12 app, while dealing with AWS S3, for an insertion or deletion action each time creating new session object will be bad idea, can someone help sharing how can we create only single session throughout the app? Tried below sample code to generate bigS3 object at app bootup:</p>\n\n<pre><code>var bigS3 *s3.S3\n\nfunc main() {\n    sess, awsSessionErr := session.NewSession(&amp;aws.Config{\n        Region:      aws.String(awsRegion),\n        Credentials: credentials.NewStaticCredentials(awsAccessKeyID, awsSecretAccessKey, awsSessionToken),\n    })\n    isError(awsSessionErr, \"Error creating aws session: \")\n    bigS3 := s3.New(sess)\n    _, awsListBucketErr := bigS3.ListBuckets(nil) //Used to just built the session\n    isError(awsListBucketErr, \"Unable to list AWS bucket(s): \")\n}\n</code></pre>\n\n<p>Then tried using it like below in other function, but it fails as bigS3 in below method is nil.</p>\n\n<pre><code>func listObjectsInsideBucket(bucketName string) {\n    resp, awsListObjectsErr := bigS3.ListObjects(&amp;s3.ListObjectsInput{Bucket: aws.String(bucketName)})\n    isError(awsListObjectsErr, \"Unable to list items in bucket.\")\n}\n</code></pre>\n"}, {"tags": ["mysql", "sql", "go"], "comments": [{"owner": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 2, "creation_date": 1560713752, "post_id": 56622021, "comment_id": 99816941, "body": "It\u2019s saying you\u2019re giving it one argument and the query doesn\u2019t need any. Remove the <code>id</code> from the code since it\u2019s not used"}, {"owner": {"reputation": 55, "user_id": 10944501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2q0M5.jpg?s=128&g=1", "display_name": "TijnvdEijnde", "link": "https://stackoverflow.com/users/10944501/tijnvdeijnde"}, "reply_to_user": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 0, "creation_date": 1560714176, "post_id": 56622021, "comment_id": 99817060, "body": "I tried that and it will remove the result, so i won&#39;t show my anything."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560714517, "post_id": 56622021, "comment_id": 99817154, "body": "&quot;the error is telling me that there should be no returns&quot; -- No, that&#39;s not what the error says. The error says it expected 0 arguments, and you passed one. Don&#39;t pass any arguments."}], "answers": [{"comments": [{"owner": {"reputation": 3851, "user_id": 6266540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0455a60b54cc79b3f8935832f4ca76c?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian", "link": "https://stackoverflow.com/users/6266540/fabian"}, "reply_to_user": {"reputation": 55, "user_id": 10944501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2q0M5.jpg?s=128&g=1", "display_name": "TijnvdEijnde", "link": "https://stackoverflow.com/users/10944501/tijnvdeijnde"}, "edited": false, "score": 1, "creation_date": 1560714186, "post_id": 56622053, "comment_id": 99817062, "body": "@JasonHayes123 are you sure there is a row with naam=&quot;your-given-id&quot;? You can change it to <code>medewerkernummer=?</code>."}, {"owner": {"reputation": 7091, "user_id": 1836618, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/552e7df10bda07699d7771ad835c691c?s=128&d=identicon&r=PG", "display_name": "Peter Featherstone", "link": "https://stackoverflow.com/users/1836618/peter-featherstone"}, "edited": false, "score": 0, "creation_date": 1560714475, "post_id": 56622053, "comment_id": 99817145, "body": "Id is I&#39;m assuming the id column, not the name so it&#39;s highly unlikely someone will have a name of <code>1</code> which is what the above code now checks for"}, {"owner": {"reputation": 55, "user_id": 10944501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2q0M5.jpg?s=128&g=1", "display_name": "TijnvdEijnde", "link": "https://stackoverflow.com/users/10944501/tijnvdeijnde"}, "edited": false, "score": 0, "creation_date": 1560714953, "post_id": 56622053, "comment_id": 99817259, "body": "@fabian Where did you get medewerkernummer from?"}, {"owner": {"reputation": 3851, "user_id": 6266540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0455a60b54cc79b3f8935832f4ca76c?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian", "link": "https://stackoverflow.com/users/6266540/fabian"}, "reply_to_user": {"reputation": 55, "user_id": 10944501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2q0M5.jpg?s=128&g=1", "display_name": "TijnvdEijnde", "link": "https://stackoverflow.com/users/10944501/tijnvdeijnde"}, "edited": false, "score": 1, "creation_date": 1560715540, "post_id": 56622053, "comment_id": 99817403, "body": "@JasonHayes123 didn&#39;t know the name of the id column. So looked what is unique in your code. DB name in connect string (vitaintellectdb) sounded unique enough and a google search gave me besides this thread <a href=\"https://pastebin.com/9AMsYnUk\" rel=\"nofollow noreferrer\">a pastebin</a>. Since you probably use one of the structures there, and structs often match column names it was an educated guess that&#39;s your id column."}, {"owner": {"reputation": 55, "user_id": 10944501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2q0M5.jpg?s=128&g=1", "display_name": "TijnvdEijnde", "link": "https://stackoverflow.com/users/10944501/tijnvdeijnde"}, "edited": false, "score": 0, "creation_date": 1560715870, "post_id": 56622053, "comment_id": 99817486, "body": "@fabian Thanks a lot, this will help me out a lot!"}], "tags": [], "owner": {"reputation": 3851, "user_id": 6266540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0455a60b54cc79b3f8935832f4ca76c?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian", "link": "https://stackoverflow.com/users/6266540/fabian"}, "is_accepted": true, "score": 3, "last_activity_date": 1560714508, "last_edit_date": 1560714508, "creation_date": 1560713832, "answer_id": 56622053, "question_id": 56622021, "link": "https://stackoverflow.com/questions/56622021/panic-sql-expected-0-arguments-got-1/56622053#56622053", "title": "panic: sql: expected 0 arguments, got 1", "body": "<pre><code>sqlStatement := `SELECT naam FROM medewerker WHERE naam=\"jansen\"`\nrow := db.QueryRow(sqlStatement, id)\n</code></pre>\n\n<p>The given sql statement has no parameter. The following sql statement including the placeholder might work better.</p>\n\n<pre><code>sqlStatement := `SELECT naam FROM medewerker WHERE medewerkernummer =?`\nrow := db.QueryRow(sqlStatement, id)\n</code></pre>\n\n<p>Depending how your <code>id</code>-column is named you might have to change <code>naam=?</code> to <code>idColumn=?</code>. In the examples <a href=\"https://golang.org/src/database/sql/example_test.go\" rel=\"nofollow noreferrer\">here</a> you might find inspiration.</p>\n"}, {"comments": [{"owner": {"reputation": 55, "user_id": 10944501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2q0M5.jpg?s=128&g=1", "display_name": "TijnvdEijnde", "link": "https://stackoverflow.com/users/10944501/tijnvdeijnde"}, "edited": false, "score": 0, "creation_date": 1560714315, "post_id": 56622079, "comment_id": 99817099, "body": "I get the following error Unknown column &#39;jansen&#39; in &#39;where clause&#39;"}, {"owner": {"reputation": 7091, "user_id": 1836618, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/552e7df10bda07699d7771ad835c691c?s=128&d=identicon&r=PG", "display_name": "Peter Featherstone", "link": "https://stackoverflow.com/users/1836618/peter-featherstone"}, "reply_to_user": {"reputation": 55, "user_id": 10944501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2q0M5.jpg?s=128&g=1", "display_name": "TijnvdEijnde", "link": "https://stackoverflow.com/users/10944501/tijnvdeijnde"}, "edited": false, "score": 2, "creation_date": 1560714376, "post_id": 56622079, "comment_id": 99817118, "body": "That sounds like a different issue, namely your SQL syntax is incorrect."}], "tags": [], "owner": {"reputation": 7091, "user_id": 1836618, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/552e7df10bda07699d7771ad835c691c?s=128&d=identicon&r=PG", "display_name": "Peter Featherstone", "link": "https://stackoverflow.com/users/1836618/peter-featherstone"}, "is_accepted": false, "score": 3, "last_activity_date": 1560714031, "creation_date": 1560714031, "answer_id": 56622079, "question_id": 56622021, "link": "https://stackoverflow.com/questions/56622021/panic-sql-expected-0-arguments-got-1/56622079#56622079", "title": "panic: sql: expected 0 arguments, got 1", "body": "<p>The error is telling you that you are passing an argument to <code>QueryRow</code> that it is not expecting. </p>\n\n<p>Your SQL statement doesn't have any placeholders so isn't expecting any but you are giving it one of <code>id</code>. Just change:</p>\n\n<p><code>row := db.QueryRow(sqlStatement, id)</code></p>\n\n<p>to:</p>\n\n<p><code>row := db.QueryRow(sqlStatement)</code></p>\n"}, {"tags": [], "owner": {"reputation": 15, "user_id": 6745062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9c68c48ae4cb3f0b71d5898411e7d57?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan Alex Martin", "link": "https://stackoverflow.com/users/6745062/ryan-alex-martin"}, "is_accepted": false, "score": -1, "last_activity_date": 1614728305, "creation_date": 1614728305, "answer_id": 66448675, "question_id": 56622021, "link": "https://stackoverflow.com/questions/56622021/panic-sql-expected-0-arguments-got-1/66448675#66448675", "title": "panic: sql: expected 0 arguments, got 1", "body": "<p>You can use <code>fmt.Sprintf</code> to do this really cleanly in one line.</p>\n<pre><code>...\n    row := db.QueryRow(fmt.Sprintf(&quot;SELECT naam FROM medewerker WHERE naam='%s', id)\n...\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 10944501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2q0M5.jpg?s=128&g=1", "display_name": "TijnvdEijnde", "link": "https://stackoverflow.com/users/10944501/tijnvdeijnde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5867, "favorite_count": 1, "accepted_answer_id": 56622053, "answer_count": 3, "score": 2, "last_activity_date": 1614728305, "creation_date": 1560713623, "last_edit_date": 1560714471, "question_id": 56622021, "link": "https://stackoverflow.com/questions/56622021/panic-sql-expected-0-arguments-got-1", "title": "panic: sql: expected 0 arguments, got 1", "body": "<p>I am trying to execute queries with Go, but I cannot manage to request any query, because it keeps giving me the same error over and over. </p>\n\n<p>I have changed the query multiple times, but that doesn't seem to help.\nAlso i have changed QueryRow in Query, unfortunately that doesn't help either.</p>\n\n<pre><code>func test123() {\n\n    db, err := sql.Open(\"mysql\", \"root:password@tcp(127.0.0.1:3306)/vitaintellectdb\")\n    if err != nil {\n        panic(err.Error())\n    }\n\n    id := 1\n    var col string\n    sqlStatement := `SELECT naam FROM medewerker WHERE naam=\"jansen\"`\n    row := db.QueryRow(sqlStatement, id)\n    err2 := row.Scan(&amp;col)\n    if err2 != nil {\n        if err2 == sql.ErrNoRows {\n            fmt.Println(\"Zero rows found\")\n        } else {\n            panic(err2)\n        }\n    }\n\n}\n</code></pre>\n\n<p>QueryRow is designed to give you 1 row in return. Unfortunately the error is telling me that there should be no returns, I expect 1 row in return.</p>\n"}, {"tags": ["go", "telegram-bot"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 1, "creation_date": 1560710383, "post_id": 56621617, "comment_id": 99816142, "body": "What did you try? Can you show some code? We won&#39;t code your bot for you."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 5545996, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a042b9ce2445d97f831dc672c87d358?s=128&d=identicon&r=PG", "display_name": "Wojciech Zag&#243;rski", "link": "https://stackoverflow.com/users/5545996/wojciech-zag%c3%b3rski"}, "is_accepted": false, "score": 0, "last_activity_date": 1560729525, "creation_date": 1560729525, "answer_id": 56623459, "question_id": 56621617, "link": "https://stackoverflow.com/questions/56621617/how-to-trigger-telegram-bot-to-send-a-message/56623459#56623459", "title": "How to trigger telegram bot to send a message", "body": "<p>The <code>telegram-bot-api</code> sends messages to Telegram Bot API using HTTP POST requests.</p>\n\n<p>See more here: <a href=\"https://github.com/go-telegram-bot-api/telegram-bot-api/blob/master/bot.go#L71\" rel=\"nofollow noreferrer\">https://github.com/go-telegram-bot-api/telegram-bot-api/blob/master/bot.go#L71</a></p>\n\n<p>You can simply initialize another <code>BotAPI</code> instance inside the server logic and use it to send messages asynchronously.\nIt won't affect active long polling or webhooks.</p>\n"}], "owner": {"reputation": 53, "user_id": 11554838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9d88085d8f40613a9af01b0477e6912?s=128&d=identicon&r=PG&f=1", "display_name": "Sergey Shopin", "link": "https://stackoverflow.com/users/11554838/sergey-shopin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3147, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1560729525, "creation_date": 1560710243, "last_edit_date": 1560716713, "question_id": 56621617, "link": "https://stackoverflow.com/questions/56621617/how-to-trigger-telegram-bot-to-send-a-message", "title": "How to trigger telegram bot to send a message", "body": "<p>I can not figure out how to induce (trigger) a local server with a telegram bot to send a message to a channel.</p>\n\n<p>For example, to send a notification to a user from the website, where he has registered and connected his telegram. We will assume that the user has already started dialog with bot and is ready to receive messages from it.</p>\n\n<p>I have a separate server that can send requests to the server with the bot, but I cannot understand how to receive and handle requests on this telegram-bot server.</p>\n\n<p>I'm using the go telegram-bot-api library and at this moment the server uses a long-polling approach instead of webhooks. So it receives some telegram API events through an update channel.</p>\n\n<p>My code is just a copy of example in telegram-bot-api golang lib git repo:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    bot, err := tgbotapi.NewBotAPI(\"MyAwesomeBotToken\")\n    if err != nil {\n        log.Panic(err)\n    }\n\n    bot.Debug = true\n\n    log.Printf(\"Authorized on account %s\", bot.Self.UserName)\n\n    u := tgbotapi.NewUpdate(0)\n    u.Timeout = 60\n\n    updates, err := bot.GetUpdatesChan(u)\n\n    for update := range updates {\n        if update.Message == nil { // ignore any non-Message Updates\n            continue\n        }\n\n        log.Printf(\"[%s] %s\", update.Message.From.UserName, update.Message.Text)\n\n        msg := tgbotapi.NewMessage(update.Message.Chat.ID, update.Message.Text)\n        msg.ReplyToMessageID = update.Message.MessageID\n\n        bot.Send(msg)\n    }\n}\n</code></pre>\n\n<p>I expect my bot to be induced (triggered) from a third-party service, get some data from it, generate a message and send it to the user through the chat.</p>\n\n<p>At this time my implementation is: bot gets messages from user by the update channel, handles it and sends a reply message.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1560702758, "post_id": 56620114, "comment_id": 99814332, "body": "<code>ioutil.ReadAll</code> will do what you request, but that precludes any possibility of interactivity on the TCP connection."}, {"owner": {"reputation": 33, "user_id": 8174897, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NA9YG.jpg?s=128&g=1", "display_name": "richu_rsa", "link": "https://stackoverflow.com/users/8174897/richu-rsa"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560866854, "post_id": 56620114, "comment_id": 99871792, "body": "@Flimzy thanks , it works like a charm."}], "answers": [{"tags": [], "owner": {"reputation": 33, "user_id": 8174897, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NA9YG.jpg?s=128&g=1", "display_name": "richu_rsa", "link": "https://stackoverflow.com/users/8174897/richu-rsa"}, "is_accepted": true, "score": 0, "last_activity_date": 1560838893, "creation_date": 1560838893, "answer_id": 56642819, "question_id": 56620114, "link": "https://stackoverflow.com/questions/56620114/how-to-loop-until-ipconn-read-has-read-all-data-sent-to-it-in-go/56642819#56642819", "title": "How to loop until *ipconn.Read() has read all data sent to it in go", "body": "<p>ioutil.ReadAll will read all the data from the tcp stream. Be careful as it doesnt return until the connection has been closed.</p>\n"}], "owner": {"reputation": 33, "user_id": 8174897, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NA9YG.jpg?s=128&g=1", "display_name": "richu_rsa", "link": "https://stackoverflow.com/users/8174897/richu-rsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 56642819, "answer_count": 1, "score": -3, "last_activity_date": 1560838893, "creation_date": 1560698130, "question_id": 56620114, "link": "https://stackoverflow.com/questions/56620114/how-to-loop-until-ipconn-read-has-read-all-data-sent-to-it-in-go", "title": "How to loop until *ipconn.Read() has read all data sent to it in go", "body": "<p>I was sending some data using *ipconn.Write method in go , but it seems *ipconn.Read() can only read 20 bytes at a time</p>\n\n<p>here is server sending data</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>ln, err := net.Listen(\"tcp\", \"localhost:8888\")\nconn, err := ln.Accept()\ntmp := make([]byte,10000)\ntmp = []byte(\"abcdefghijklmnopqrstuvwxyz\")\nconn.Write(tmp)\n</code></pre>\n\n<p>here is the client receiving data</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>conn, err := net.Dial(\"tcp\", \"localhost:8888\")\ndata := make([]byte, 100000)\nconn.Read(data)\nfmt.Println(string(data)) // prints only first 20 chars\n</code></pre>\n\n<p>If i again call conn.Read(data) I get another 20 characters </p>\n\n<p>Is there any way to read all the data or loop until the connection is closed ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1560726958, "post_id": 56619323, "comment_id": 99819340, "body": "You can\u2019t do that in Go. See <a href=\"https://stackoverflow.com/questions/24836696/how-to-get-the-variable-name-as-in-the-source-code-using-reflect?rq=1\" title=\"how to get the variable name as in the source code using reflect\">stackoverflow.com/questions/24836696/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 432, "user_id": 6639975, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dvwQi.jpg?s=128&g=1", "display_name": "GypsyCosmonaut", "link": "https://stackoverflow.com/users/6639975/gypsycosmonaut"}, "edited": false, "score": 0, "creation_date": 1560694198, "post_id": 56619549, "comment_id": 99812339, "body": "Thanks but naahh.. I don&#39;t want to declare two arrays of different types, I could have done that, but that means repeating yourself. Any better solution ?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 432, "user_id": 6639975, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dvwQi.jpg?s=128&g=1", "display_name": "GypsyCosmonaut", "link": "https://stackoverflow.com/users/6639975/gypsycosmonaut"}, "edited": false, "score": 2, "creation_date": 1560698314, "post_id": 56619549, "comment_id": 99813292, "body": "@GypsyCosmonaut: you could use a <code>map[string]int</code> instead."}, {"owner": {"reputation": 432, "user_id": 6639975, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dvwQi.jpg?s=128&g=1", "display_name": "GypsyCosmonaut", "link": "https://stackoverflow.com/users/6639975/gypsycosmonaut"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1560738469, "post_id": 56619549, "comment_id": 99820746, "body": "@SergioTulentsev You also mean like Ali, i.e, using like <code>map[string]int{&quot;os.O_RDWR&quot; :  os.RDWR, &quot;os.O_SYNC&quot; : os.O_SYNC}</code> . This is a repeating pattern. And as I&#39;ve come to understand from others and is usually said in coding, repeating is bad habit. I am just trying not to repeat."}, {"owner": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "edited": false, "score": 0, "creation_date": 1560755876, "post_id": 56619549, "comment_id": 99825148, "body": "it is not possible, because in string array you insert the value of cell statically, you could define struct which has two attributes."}, {"owner": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "edited": false, "score": 0, "creation_date": 1560756244, "post_id": 56619549, "comment_id": 99825323, "body": "custom struct solution added."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 432, "user_id": 6639975, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dvwQi.jpg?s=128&g=1", "display_name": "GypsyCosmonaut", "link": "https://stackoverflow.com/users/6639975/gypsycosmonaut"}, "edited": false, "score": 1, "creation_date": 1560762427, "post_id": 56619549, "comment_id": 99828204, "body": "@GypsyCosmonaut: you&#39;re misinterpreting what DRY means. It does not mean &quot;there must be no duplication in your code, none whatsoever, for any reason&quot;. It means &quot;if you need to change behaviour of your code, there should be just one place that knows/controls that piece of logic&quot;. In my proposed example with a map, the knowledge (correspondence between name of a setting and its value) is reasonably contained/grouped. Yes, you&#39;d have to type the names twice, but that&#39;s a price I&#39;d be willing to pay to avoid messing with runtime/reflection."}], "tags": [], "owner": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "is_accepted": true, "score": 3, "last_activity_date": 1560756198, "last_edit_date": 1560756198, "creation_date": 1560693821, "answer_id": 56619549, "question_id": 56619323, "link": "https://stackoverflow.com/questions/56619323/get-value-of-int-for-a-string-variable/56619549#56619549", "title": "Get value of INT for a &quot;STRING&quot; variable", "body": "<p>you could use map.</p>\n\n<pre><code>func main() {\n    var m map[string]int\n    m = make(map[string]int)\n    b := []int{os.O_APPEND,os.O_CREATE,os.O_EXCL,os.O_RDONLY,os.O_RDWR,os.O_SYNC,os.O_TRUNC,os.O_WRONLY}\n    a := []string{\"os.O_APPEND\",\"os.O_CREATE\",\"os.O_EXCL\",\"os.O_RDONLY\",\"os.O_RDWR\",\"os.O_SYNC\",\"os.O_TRUNC\",\"os.O_WRONLY\"}\n    for index, value := range a {\n        m[value] = b[index]\n    }\n    var i =0\n    for index,mapValue := range m{\n        fmt.Println(i,\" - \",index,\"-\",mapValue )\n        i++\n    }\n}\n</code></pre>\n\n<p>out put will be:</p>\n\n<pre><code>0  -  os.O_RDWR - 2\n1  -  os.O_SYNC - 1052672\n2  -  os.O_TRUNC - 512\n3  -  os.O_WRONLY - 1\n4  -  os.O_APPEND - 1024\n5  -  os.O_CREATE - 64\n6  -  os.O_EXCL - 128\n7  -  os.O_RDONLY - 0\n</code></pre>\n\n<p>or you could define custom struct</p>\n\n<pre><code>type CustomClass struct {\n    StringValue string\n    IntValue int\n}\nfunc main() {\n\n    CustomArray:=[]CustomClass{\n        {\"os.O_APPEND\",os.O_APPEND},\n        {\"os.O_CREATE\",os.O_CREATE},\n        {\"os.O_EXCL\",os.O_EXCL},\n        {\"os.O_RDONLY\",os.O_RDONLY},\n        {\"os.O_RDWR\",os.O_RDWR},\n        {\"os.O_SYNC\",os.O_SYNC},\n        {\"os.O_TRUNC\",os.O_TRUNC},\n        {\"os.O_WRONLY\",os.O_WRONLY},\n    }\n    for k, v := range CustomArray {\n        fmt.Println(k,\" - \", v.StringValue,\" - \", v.IntValue)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 432, "user_id": 6639975, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dvwQi.jpg?s=128&g=1", "display_name": "GypsyCosmonaut", "link": "https://stackoverflow.com/users/6639975/gypsycosmonaut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 56619549, "answer_count": 1, "score": 2, "last_activity_date": 1560756198, "creation_date": 1560692038, "last_edit_date": 1560736906, "question_id": 56619323, "link": "https://stackoverflow.com/questions/56619323/get-value-of-int-for-a-string-variable", "title": "Get value of INT for a &quot;STRING&quot; variable", "body": "<p>I need output like</p>\n\n<pre><code>0 - os.O_APPEND     - 1024\n1 - os.O_CREATE     - 64\n2 - os.O_EXCL       - 128\n3 - os.O_RDONLY     - 0\n4 - os.O_RDWR       - 2\n5 - os.O_SYNC       - 1052672\n6 - os.O_TRUNC      - 512\n7 - os.O_WRONLY     - 1\n</code></pre>\n\n<p>I am able to to do half of it with </p>\n\n<pre><code>func main() {\n        a := []int{os.O_APPEND,os.O_CREATE,os.O_EXCL,os.O_RDONLY,os.O_RDWR,os.O_SYNC,os.O_TRUNC,os.O_WRONLY}\n        for index, value := range a {\n                fmt.Printf(\"%d -  - %d\\n\", index, value)\n        }\n}\n</code></pre>\n\n<p>which gave me output</p>\n\n<pre><code>0 -  - 1024\n1 -  - 64\n2 -  - 128\n3 -  - 0\n4 -  - 2\n5 -  - 1052672\n6 -  - 512\n7 -  - 1\n</code></pre>\n\n<p>and the other half of it with</p>\n\n<pre><code>func main() {\n        a := []string{\"os.O_APPEND\",\"os.O_CREATE\",\"os.O_EXCL\",\"os.O_RDONLY\",\"os.O_RDWR\",\"os.O_SYNC\",\"os.O_TRUNC\",\"os.O_WRONLY\"}\n        for index, value := range a {\n                fmt.Printf(\"%d - %-15s -\\n\", index, value)\n        }\n}\n</code></pre>\n\n<p>which gave me the output</p>\n\n<pre><code>0 - os.O_APPEND     -\n1 - os.O_CREATE     -\n2 - os.O_EXCL       -\n3 - os.O_RDONLY     -\n4 - os.O_RDWR       -\n5 - os.O_SYNC       -\n6 - os.O_TRUNC      -\n7 - os.O_WRONLY     -\n</code></pre>\n\n<p>How can I get the desired output ?</p>\n\n<p><strong>Update</strong></p>\n\n<p>As I'm thinking about it, I'm getting an idea for solving it with an array of empty interface and then type asserting on each element of the array of empty interface, once with string to get the string, and once with int to get the value of int, but I don't know how to do that.</p>\n"}, {"tags": ["go", "homebrew", "windows-subsystem-for-linux"], "answers": [{"comments": [{"owner": {"reputation": 88, "user_id": 9500065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da24278de5cd66e03926ca14657021f7?s=128&d=identicon&r=PG&f=1", "display_name": "Helay", "link": "https://stackoverflow.com/users/9500065/helay"}, "edited": false, "score": 0, "creation_date": 1560678710, "post_id": 56617734, "comment_id": 99809106, "body": "how can I fix this? I just run &quot;brew install fluxctl&quot;"}, {"owner": {"reputation": 12305, "user_id": 8192635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcaf44c9ff9eeeb51fc78c816891d75a?s=128&d=identicon&r=PG&f=1", "display_name": "LinPy", "link": "https://stackoverflow.com/users/8192635/linpy"}, "reply_to_user": {"reputation": 88, "user_id": 9500065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da24278de5cd66e03926ca14657021f7?s=128&d=identicon&r=PG&f=1", "display_name": "Helay", "link": "https://stackoverflow.com/users/9500065/helay"}, "edited": false, "score": 0, "creation_date": 1560679415, "post_id": 56617734, "comment_id": 99809232, "body": "you can try to  install it using the binary : <a href=\"https://github.com/weaveworks/flux/releases/download/1.13.0/fluxctl_darwin_amd64\" rel=\"nofollow noreferrer\">github.com/weaveworks/flux/releases/download/1.13.0/&hellip;</a>"}, {"owner": {"reputation": 88, "user_id": 9500065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da24278de5cd66e03926ca14657021f7?s=128&d=identicon&r=PG&f=1", "display_name": "Helay", "link": "https://stackoverflow.com/users/9500065/helay"}, "edited": false, "score": 0, "creation_date": 1560680819, "post_id": 56617734, "comment_id": 99809487, "body": "Thanks for your clues that drove me to the solution!"}], "tags": [], "owner": {"reputation": 12305, "user_id": 8192635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcaf44c9ff9eeeb51fc78c816891d75a?s=128&d=identicon&r=PG&f=1", "display_name": "LinPy", "link": "https://stackoverflow.com/users/8192635/linpy"}, "is_accepted": false, "score": 0, "last_activity_date": 1560679786, "last_edit_date": 1560679786, "creation_date": 1560678659, "answer_id": 56617734, "question_id": 56617693, "link": "https://stackoverflow.com/questions/56617693/install-fluxctl-using-brew/56617734#56617734", "title": "Install fluxctl using brew", "body": "<p>the problem is from the package itself:</p>\n\n<p>the version in URL <a href=\"https://proxy.golang.org/github.com/2opremio/distribution/@v/v0.0.0-20190419185413-6c9727e5e5de.zip\" rel=\"nofollow noreferrer\">download</a> is not valid</p>\n\n<p>it returns:</p>\n\n<pre><code>not found: invalid version\n</code></pre>\n\n<p>you can try to it directly using the <a href=\"https://github.com/weaveworks/flux/releases/download/1.13.0/fluxctl_darwin_amd64\" rel=\"nofollow noreferrer\">Binary</a></p>\n"}, {"tags": [], "owner": {"reputation": 88, "user_id": 9500065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da24278de5cd66e03926ca14657021f7?s=128&d=identicon&r=PG&f=1", "display_name": "Helay", "link": "https://stackoverflow.com/users/9500065/helay"}, "is_accepted": true, "score": 0, "last_activity_date": 1560680776, "creation_date": 1560680776, "answer_id": 56617954, "question_id": 56617693, "link": "https://stackoverflow.com/questions/56617693/install-fluxctl-using-brew/56617954#56617954", "title": "Install fluxctl using brew", "body": "<p>I solved the problem by installing go using brew \"brew install go\"</p>\n\n<p>It gave me an error </p>\n\n<pre><code>Error: go HEAD-6a9b22c is already installed\nTo install 1.12.6, first run `brew unlink go\n</code></pre>\n\n<p>then I run <code>brew unlink go</code> then <code>brew install go</code> again.</p>\n\n<p>I made sure I have the right version by running </p>\n\n<pre><code>$ whereis go\ngo: /usr/local/go /home/linuxbrew/.linuxbrew/bin/go\n\n$ go version\ngo version go1.12.6 linux/amd64\n</code></pre>\n\n<p>Then \"brew install fluxctl\" successfully installed!</p>\n"}], "owner": {"reputation": 88, "user_id": 9500065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da24278de5cd66e03926ca14657021f7?s=128&d=identicon&r=PG&f=1", "display_name": "Helay", "link": "https://stackoverflow.com/users/9500065/helay"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "closed_date": 1560682428, "accepted_answer_id": 56617954, "answer_count": 2, "score": -5, "last_activity_date": 1560680776, "creation_date": 1560678109, "last_edit_date": 1560679917, "question_id": 56617693, "link": "https://stackoverflow.com/questions/56617693/install-fluxctl-using-brew", "closed_reason": "Not suitable for this site", "title": "Install fluxctl using brew", "body": "<p>I'm trying to install fluxctl using brew but got the following error:</p>\n\n<pre><code>go: downloading golang.org/x/sync v0.0.0-20190227155943-e225da77a7e6\ngo: extracting golang.org/x/sync v0.0.0-20190227155943-e225da77a7e6\n    build github.com/weaveworks/flux/cmd/fluxctl: cannot load github.com/docker/distribution: reading https://proxy.golang.org/github.com/2opremio/distribution/@v/v0.0.0-20190419185413-6c9727e5e5de.zip: 400 Bad Request\n</code></pre>\n\n<p>Also, I tried to:\n1) uninstall go and then install the updated version \"1.12.6\" but still got the same error.\n2) brew update &amp; brew doctor </p>\n\n<p>P.S.using WSL (windows 10)</p>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1560681647, "post_id": 56616196, "comment_id": 99809644, "body": "Despite the answer, we are not here to do your work for you. You must show your attempt."}, {"owner": {"reputation": 1199, "user_id": 11152032, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ge37s.png?s=128&g=1", "display_name": "Anshu", "link": "https://stackoverflow.com/users/11152032/anshu"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560684324, "post_id": 56616196, "comment_id": 99810211, "body": "Ok  @flimzy...I am try to convert such camel string to snak....it&#39;s work . But thanks for you point."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1560689381, "post_id": 56616196, "comment_id": 99811283, "body": "I know what you&#39;re trying to do. You said that in your question. My point is, questions are expected to show a best effort, including code."}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1602396613, "post_id": 56616196, "comment_id": 113703435, "body": "Great question +1. The preferred Go term is MixedCaps or mixedCaps not CamelCase. See <a href=\"https://golang.org/doc/effective_go.html#mixed-caps\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#mixed-caps</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1320, "user_id": 3538313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cbc08db98f4175e0da37edeea4116f0?s=128&d=identicon&r=PG", "display_name": "JHS", "link": "https://stackoverflow.com/users/3538313/jhs"}, "edited": false, "score": 2, "creation_date": 1576520671, "post_id": 56616250, "comment_id": 104918462, "body": "Do you happen to know the reason the first capital letter is treated differently from the others?"}], "tags": [], "owner": {"reputation": 2239, "user_id": 11265540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xt43S.jpg?s=128&g=1", "display_name": "Tenusha Guruge", "link": "https://stackoverflow.com/users/11265540/tenusha-guruge"}, "is_accepted": true, "score": 11, "last_activity_date": 1560681995, "last_edit_date": 1560681995, "creation_date": 1560661763, "answer_id": 56616250, "question_id": 56616196, "link": "https://stackoverflow.com/questions/56616196/how-to-convert-camel-case-string-to-snake-case/56616250#56616250", "title": "How to convert Camel case string to snake case", "body": "<p>Try this,</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"strings\"\n    \"regexp\"\n)\n\nvar matchFirstCap = regexp.MustCompile(\"(.)([A-Z][a-z]+)\")\nvar matchAllCap   = regexp.MustCompile(\"([a-z0-9])([A-Z])\")\n\nfunc ToSnakeCase(str string) string {\n    snake := matchFirstCap.ReplaceAllString(str, \"${1}_${2}\")\n    snake  = matchAllCap.ReplaceAllString(snake, \"${1}_${2}\")\n    return strings.ToLower(snake)\n}\n</code></pre>\n\n<p>Run:</p>\n\n<pre><code>func main() {   \n    fmt.Println(ToSnakeCase(\"IGotInternAtGeeksForGeeks\"))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>i_got_intern_at_geeks_for_geeks\n</code></pre>\n\n<blockquote>\n  <p>NOTE :  this will not work for many non-English languages</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 126, "user_id": 4299518, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1lQQf.jpg?s=128&g=1", "display_name": "Wei Huang", "link": "https://stackoverflow.com/users/4299518/wei-huang"}, "is_accepted": false, "score": 0, "last_activity_date": 1560783015, "creation_date": 1560783015, "answer_id": 56633776, "question_id": 56616196, "link": "https://stackoverflow.com/questions/56616196/how-to-convert-camel-case-string-to-snake-case/56633776#56633776", "title": "How to convert Camel case string to snake case", "body": "<p>Faster and simpler version:</p>\n\n<pre><code>import \"bytes\"\n\nfunc SnakeCase(camel string) string {\n    var buf bytes.Buffer\n    for _, c := range camel {\n        if 'A' &lt;= c &amp;&amp; c &lt;= 'Z' {\n            // just convert [A-Z] to _[a-z]\n            if buf.Len() &gt; 0 {\n                buf.WriteRune('_')\n            }\n            bytes.WriteRune(c - 'A' + 'a')\n        } else {\n            bytes.WriteRune(c)\n        }\n    }\n    return buf.String()\n}\n</code></pre>\n\n<p>Known bugs: \n 1. no-ascii\n 2. reversed upper abbreviate word, eg. baseURL will be ugly <code>base_u_r_l</code>, but not <code>base_url</code>, consider use white list to filter.</p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 6737199, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qSC7QapHLQ8/AAAAAAAAAAI/AAAAAAAABD0/pW-oPWoK-c0/photo.jpg?sz=128", "display_name": "Roshan Ranabhat", "link": "https://stackoverflow.com/users/6737199/roshan-ranabhat"}, "is_accepted": false, "score": 0, "last_activity_date": 1586239218, "creation_date": 1586239218, "answer_id": 61073668, "question_id": 56616196, "link": "https://stackoverflow.com/questions/56616196/how-to-convert-camel-case-string-to-snake-case/61073668#61073668", "title": "How to convert Camel case string to snake case", "body": "<p>I know this is old post but, I've create a package named <a href=\"https://github.com/gobeam/Stringy\" rel=\"nofollow noreferrer\">gobeam/Stringy</a> You can easily convert camel case string to snake case and kebab case and vice versa. Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    stringy \"github.com/gobeam/Stringy\"\n)\n\nfunc main() {\n    str := stringy.New(\"HelloGuysHowAreYou?\")\n    snakeStr := str.SnakeCase(\"?\", \"\")\n    fmt.Println(snakeStr.ToLower()) // hello_guys_how_are_you\n    fmt.Println(snakeStr.ToUpper()) // HELLO_GUYS_HOW_ARE_YOU\n}\n\n</code></pre>\n"}], "owner": {"reputation": 1199, "user_id": 11152032, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ge37s.png?s=128&g=1", "display_name": "Anshu", "link": "https://stackoverflow.com/users/11152032/anshu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2768, "favorite_count": 2, "accepted_answer_id": 56616250, "answer_count": 3, "score": 0, "last_activity_date": 1586239218, "creation_date": 1560661000, "question_id": 56616196, "link": "https://stackoverflow.com/questions/56616196/how-to-convert-camel-case-string-to-snake-case", "title": "How to convert Camel case string to snake case", "body": "<p><strong>I have  a string</strong></p>\n\n<pre><code>str := \"IGotInternAtGeeksForGeeks\"\n</code></pre>\n\n<p><strong>I try to convert it in to</strong></p>\n\n<p><code>str = \"i_got_intern_at_geeks_for_geeks\"</code> </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": false, "score": 2, "last_activity_date": 1560662941, "creation_date": 1560662941, "answer_id": 56616342, "question_id": 56615919, "link": "https://stackoverflow.com/questions/56615919/how-to-convert-int16-to-hex-encoded-string-in-golang/56616342#56616342", "title": "How to convert int16 to hex-encoded string in Golang", "body": "<p>Since <a href=\"https://godoc.org/fmt#Println\" rel=\"nofollow noreferrer\"><code>fmt.Println</code></a> doesn't accept format flags, it prints each variable depending on its type.</p>\n\n<p><a href=\"https://godoc.org/github.com/howeyc/crc16#Checksum\" rel=\"nofollow noreferrer\"><code>crc16.Checksum</code></a> returns an int16, so <code>fmt.Println</code> will display the integer value of your hexadecimal string, which is <code>55772</code>.</p>\n\n<p>If you want <code>fmt.Println</code> to print <code>D9DC</code> instead of the integer value, you have multiple choices.</p>\n\n<ul>\n<li>Convert your integer into a string that contains the hexadecimal value (which means if you change your integer, you will need to convert it into a string again before using it</li>\n<li>Create your own type with a <code>String()</code> method, which is an integer but is represented by its hexadecimal value when printed.</li>\n</ul>\n\n<p>For the second option, your type could be something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Hex int16\n\nfunc (h Hex) String() string {\n    return strconv.FormatInt(int64(h), 16)\n}\n</code></pre>\n\n<p><code>fmt.Println</code> will automatically use this method because it means the <code>Hex</code> type implements the <a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"nofollow noreferrer\"><code>Stringer</code></a> interface. For more info on this, here are some resources:</p>\n\n<ul>\n<li><a href=\"https://tour.golang.org/methods/17\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/17</a></li>\n<li><a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"nofollow noreferrer\">https://golang.org/pkg/fmt/#Stringer</a></li>\n</ul>\n"}], "owner": {"reputation": 9, "user_id": 11186524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf6421240cedca4c857d48a3f6ae94f1?s=128&d=identicon&r=PG&f=1", "display_name": "IamADDICT", "link": "https://stackoverflow.com/users/11186524/iamaddict"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1562604088, "creation_date": 1560657147, "last_edit_date": 1560674209, "question_id": 56615919, "link": "https://stackoverflow.com/questions/56615919/how-to-convert-int16-to-hex-encoded-string-in-golang", "title": "How to convert int16 to hex-encoded string in Golang", "body": "<p>I need to convert the data format of an int16 to a string representing its hexadecimal value.</p>\n\n<p>I have tried some hex converters but they change the data instead of changing the formatting. I need it to be a string representation of its hexadecimal value.</p>\n\n<pre><code>data := (data from buffer)\n\nfmt.Printf(\"BUFFER DATA : %X\\n\", data) // output print on screen D9DC (hex)\nfmt.Println((\"BUFFER DATA : \", string(data)) // output print on screen 55772 (dec)\nfmt.Println((\"BUFFER DATA : \", data) // output print on screen [?]\n</code></pre>\n\n<p>How can I convert the data format so it prints <code>D9DC</code> with <code>fmt.Println</code>?</p>\n\n<p>Full code here <a href=\"https://play.golang.org/p/WVpMb9lh1Rx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WVpMb9lh1Rx</a></p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 1, "creation_date": 1560664559, "post_id": 56615308, "comment_id": 99806902, "body": "good rule of thumb is to get your code working outside of any container first ... only after you have it up and running then put a working app inside docker ... this simplifies and reduces the range of unknowns and separates code related errors from potential errors only due to docker config unknowns"}], "answers": [{"comments": [{"owner": {"reputation": 156, "user_id": 11421293, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3330c1612c79f9ecefff15ef3566346?s=128&d=identicon&r=PG&f=1", "display_name": "Nothingbetter", "link": "https://stackoverflow.com/users/11421293/nothingbetter"}, "edited": false, "score": 0, "creation_date": 1560704264, "post_id": 56615825, "comment_id": 99814665, "body": "Cool. Why use go build rather than go install if you just put it in $GOPATH/bin anyway?"}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 5, "last_activity_date": 1560655499, "creation_date": 1560655499, "answer_id": 56615825, "question_id": 56615308, "link": "https://stackoverflow.com/questions/56615308/go-binary-not-found-when-using-dockerfile/56615825#56615825", "title": "Go binary not found when using Dockerfile", "body": "<p>There are two problems here:</p>\n\n<ul>\n<li>The package <code>github.com/Kelindar/tcp</code> does not contain a <code>main</code> function, thus it can't produce a binary to be executed.</li>\n<li>There is no <code>main</code> package, and every go program needs a <code>main</code> package with a <code>main</code> function</li>\n</ul>\n\n<p>Whether you run <code>go build</code> or <code>go install</code> in this repository, you will see that nothing will happen, since your package is actually a library.</p>\n\n<p>Now if you add a <code>cmd/tcp_server</code> folder with a <code>tcp_server.go</code> file like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net\"\n\n    \"github.com/kelindar/tcp\"\n)\n\nfunc main() {\n    closingChan := make(chan bool)\n    onAccept := func(c net.Conn) {\n        // Do something here.\n    }\n\n    l, err := net.Listen(\"tcp\", fmt.Sprintf(\":%d\", 4242))\n    if err != nil {\n        log.Fatalf(\"Unable to net.Listen: %v\", err)\n    }\n\n    server := &amp;tcp.Server{\n        Closing:  closingChan,\n        OnAccept: onAccept,\n    }\n\n    log.Println(\"Server ready...\")\n    if err := server.Serve(l); err != nil {\n        log.Fatalf(\"Server crashed: %v\", err)\n    }\n\n    log.Println(\"Server stopped\")\n}\n</code></pre>\n\n<p>And that you update your Dockerfile to use the command that uses your tcp package:</p>\n\n<pre><code>FROM golang\n\nRUN go get github.com/Kelindar/tcp\nRUN go build -o $GOPATH/bin/tcp_server $GOPATH/src/github.com/Kelindar/tcp/cmd/tcp_server/tcp_server.go\n\nENTRYPOINT tcp_server\n\nEXPOSE 8080\n</code></pre>\n\n<p>Your server will be working properly within docker:</p>\n\n<blockquote>\n  <p><code>2019/06/16 05:23:29 Server ready...</code></p>\n</blockquote>\n"}], "owner": {"reputation": 156, "user_id": 11421293, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3330c1612c79f9ecefff15ef3566346?s=128&d=identicon&r=PG&f=1", "display_name": "Nothingbetter", "link": "https://stackoverflow.com/users/11421293/nothingbetter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3374, "favorite_count": 2, "accepted_answer_id": 56615825, "answer_count": 1, "score": 1, "last_activity_date": 1560655499, "creation_date": 1560647116, "question_id": 56615308, "link": "https://stackoverflow.com/questions/56615308/go-binary-not-found-when-using-dockerfile", "title": "Go binary not found when using Dockerfile", "body": "<p>I am following <a href=\"https://blog.golang.org/docker\" rel=\"nofollow noreferrer\">Go's Docker instructions</a>. Their example works for me. I am now trying to modify it to run a tcp server:</p>\n\n<pre><code>go get github.com/Kelindar/tcp\n</code></pre>\n\n<p>Add a Dockerfile:</p>\n\n<pre><code>FROM golang\n\nADD . /go/src/github.com/Kelindar/tcp\nRUN go install github.com/Kelindar/tcp\n\nENTRYPOINT /go/bin/tcp\n\nEXPOSE 8080\n</code></pre>\n\n<p>I then build it:</p>\n\n<pre><code>docker build --no-cache -t tcp .\n</code></pre>\n\n<p>build output:</p>\n\n<pre><code>Sending build context to Docker daemon    322kB\nStep 1/5 : FROM golang\n ---&gt; 9fe4cdc1f173\nStep 2/5 : ADD . /go/src/github.com/Kelindar/tcp\n ---&gt; 10abce658324\nStep 3/5 : RUN go install github.com/Kelindar/tcp\n ---&gt; Running in 59dc47b30474\nRemoving intermediate container 59dc47b30474\n ---&gt; 8fab53d2882c\nStep 4/5 : ENTRYPOINT /go/bin/tcp\n ---&gt; Running in 18d4b5befccb\nRemoving intermediate container 18d4b5befccb\n ---&gt; 073fdb78a481\nStep 5/5 : EXPOSE 8080\n ---&gt; Running in 8ee2b7bc0cba\nRemoving intermediate container 8ee2b7bc0cba\n ---&gt; 8bf9f82d4fef\nSuccessfully built 8bf9f82d4fef\nSuccessfully tagged tcp:latest\n</code></pre>\n\n<p>Now, I run it:</p>\n\n<pre><code>docker run --name test --rm tcp\n</code></pre>\n\n<p>I get an error:</p>\n\n<pre><code>/bin/sh: 1: /go/bin/tcp: not found\n</code></pre>\n\n<p>Not really sure where to go on this.</p>\n"}, {"tags": ["debugging", "go", "process", "worker"], "comments": [{"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 4, "creation_date": 1560640954, "post_id": 56614847, "comment_id": 99804126, "body": "First thing I see is that main will exit immediately and not all your tasks will run. sync.WaitGroup to wait for the goroutines to finish"}, {"owner": {"reputation": 1, "user_id": 11653419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/418bbaf33baedb190bc0688ca36765a8?s=128&d=identicon&r=PG&f=1", "display_name": "Tim G", "link": "https://stackoverflow.com/users/11653419/tim-g"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1560641342, "post_id": 56614847, "comment_id": 99804178, "body": "Thanks for the response. That&#39;s what I had replied with and it seems they had expected a different answer. I&#39;m a little lost at this point."}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 1, "creation_date": 1560641920, "post_id": 56614847, "comment_id": 99804257, "body": "They may have expected to say that queue &lt;- tasks[i] will block until there is an empty goroutine to receive the data.  The other thing is the channel in the worker func could have been declared as a receiver channel but that&#39;s minor."}, {"owner": {"reputation": 1, "user_id": 11653419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/418bbaf33baedb190bc0688ca36765a8?s=128&d=identicon&r=PG&f=1", "display_name": "Tim G", "link": "https://stackoverflow.com/users/11653419/tim-g"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1560642358, "post_id": 56614847, "comment_id": 99804314, "body": "Those were my thoughts as well, but so much of the problem and answer is dependent on the data itself, how it&#39;s used and so on, and so I didn&#39;t try to break down every possible thing that it could be without getting more information. However, they seemed to have concluded that the abstract example given was sufficient to find a definitive bug. This lead me to question my overall knowledge of this area of the Go language. I&#39;m troubled that this cost me a potential job based on my response. After all, I did mention blocking/non blocking, the need to wait and check on worker process success."}], "owner": {"reputation": 1, "user_id": 11653419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/418bbaf33baedb190bc0688ca36765a8?s=128&d=identicon&r=PG&f=1", "display_name": "Tim G", "link": "https://stackoverflow.com/users/11653419/tim-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560640246, "creation_date": 1560640246, "question_id": 56614847, "link": "https://stackoverflow.com/questions/56614847/go-worker-tasks-with-queue-using-structure-to-channel", "title": "Go worker tasks with queue using structure to channel", "body": "<p>I was asked about finding a bug in some Go code and I am stumped as to what this obvious bug should be. I was asked the following:</p>\n\n<p>What is wrong with this code? It\u2019s incomplete, but the snippet should be enough to spot the bug. How would you fix it? What other improvements can you propose?</p>\n\n<p>Tried different coding solutions to example and find the bug, but don't see an obvious bug in the code because I can get this code to work fine (depending on how I code for it). I told them that the code isn't waiting on the worker processes or checking that they're completing before closing the channel. I stated that the code is too abstract to say for sure and it depends on the goal of the code, but that it can be made to work fine (not that I'd code it that way, of course).</p>\n\n<pre><code>const nworkers = 5\n\ntype Task struct {\n        ...\n}\n\nfunc worker(queue chan *Task) {\n        for task := range queue {\n            task.execute()\n        }\n}\n\nfunc main() {\n    tasks := getTasks()\n\n    queue := make(chan *Task, nworkers)\n\n    for i := 0; i &lt; nworkers; i++ {\n            go worker(queue)\n    }\n\n    for i := 0; i &lt; len(tasks); i++ {\n            queue &lt;- tasks[i]\n    }\n\n    close(queue)\n}\n\n/*\n Again, I had created some code to populate the missing code areas and \nadded wait to the workers and checks to ensure they completed, passing \nthe structure to the function call, added code to populate the struct \ndata and passed the data with queue &lt;- &amp;tasks[i] to reference (in how I \nwas doing it with one example) and so on. I literally can't see anything \nobvious as per the bug in the code example if I fill in some blanks to \nmake it work).\n*/\n</code></pre>\n\n<p>No specific expected output, just trying to locate this bug so I can learn from this question as I delve further into the Go language. Can anyone spot what should be an obvious bug and explain where/what the bug is?</p>\n"}, {"tags": ["go", "concurrency", "stream", "channel"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560634957, "post_id": 56614006, "comment_id": 99803149, "body": "What happens if one of your consumers gets far ahead of the other? If you don&#39;t want them to be synchronous, you need some sort of buffering. It might be possible/sufficient to use bufio. Or you might need something much more complex, depending on your needs, and the potential sizes of these streams."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1560635125, "post_id": 56614006, "comment_id": 99803186, "body": "The simplest solution (although not the most performant) would probably be to write your stream to a disk. Then you can have an unlimited number of readers reading off the disk.  A more complex solution would be to use a disk-backed buffer."}, {"owner": {"reputation": 6566, "user_id": 3785777, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/pGH0T.jpg?s=128&g=1", "display_name": "luqo33", "link": "https://stackoverflow.com/users/3785777/luqo33"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1560695262, "post_id": 56614006, "comment_id": 99812593, "body": "@Flimzy you&#39;re right it&#39;s really tricky to cater for situations where one consumer gets ahead of the other at random. I went for copying the stream and working with them independently from one another."}], "answers": [{"comments": [{"owner": {"reputation": 6566, "user_id": 3785777, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/pGH0T.jpg?s=128&g=1", "display_name": "luqo33", "link": "https://stackoverflow.com/users/3785777/luqo33"}, "edited": false, "score": 0, "creation_date": 1560695097, "post_id": 56615206, "comment_id": 99812551, "body": "I tried to avoid copying the source stream initially, but later found that it&#39;s really tricky if copying is not involved. I like this approach better now. Thanks ;)"}], "tags": [], "owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "is_accepted": true, "score": 1, "last_activity_date": 1560648018, "last_edit_date": 1560648018, "creation_date": 1560645332, "answer_id": 56615206, "question_id": 56614006, "link": "https://stackoverflow.com/questions/56614006/concurrently-send-bytes-coming-from-stream-to-two-destinations/56615206#56615206", "title": "Concurrently send bytes coming from stream to two destinations", "body": "<p>in your scenario, it's better to have 2 independent byte streams for 2 network calls. If they rely on one source stream, when <code>sendToClient</code> stalls <code>uploadeToServer</code> will hang. channel wouldn't solve the problem above but introducing locking overhead.</p>\n\n<p>you can try <code>io.MultiWriter</code> to make 2 independent byte streams</p>\n\n<pre><code>var buf1, buf2 bytes.Buffer\nmw := io.MultiWriter(&amp;buf1, &amp;buf2)\n\nif _, err := io.Copy(mw, r.Body); err != nil {\n    ...\n}\ngo sendToClient(buf1)\ngo uploadeToServer(buf2)\n...\n</code></pre>\n"}], "owner": {"reputation": 6566, "user_id": 3785777, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/pGH0T.jpg?s=128&g=1", "display_name": "luqo33", "link": "https://stackoverflow.com/users/3785777/luqo33"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "accepted_answer_id": 56615206, "answer_count": 1, "score": 2, "last_activity_date": 1560648018, "creation_date": 1560631187, "last_edit_date": 1560634889, "question_id": 56614006, "link": "https://stackoverflow.com/questions/56614006/concurrently-send-bytes-coming-from-stream-to-two-destinations", "title": "Concurrently send bytes coming from stream to two destinations", "body": "<p>What's the best way to broadcast values from a stream to two network destination simultaneously? Here is simplified code:</p>\n\n<pre><code>func main() {\n    resp, _ := http.Get(\"http://origin.com/image.jpeg\")\n\n    var buf bytes.Buffer\n    // tee, when read, writes to &amp;buf\n    respBodyTee := io.TeeReader(resp.Body, &amp;buf)\n\n    sendToClient(respBodyTee)\n    uploadeToServer(&amp;buf)\n}\n</code></pre>\n\n<p>A stream cannot be read twice, so <code>TeeReader</code> is used to populate <code>&amp;buf</code> with whatever is read from <code>respo.Body</code>.</p>\n\n<p>However, the functions (<code>sendToClient</code> and <code>uploadToServer</code>) will run synchronously while I'd like to them to make their work concurrently.</p>\n\n<p>Solution that I have on mind is to pass a channel to <code>sendToClient</code> that will populate channel with bytes already sent to client. Later have <code>uploadToServer</code> read from the same channel. Something along these lines:</p>\n\n<pre><code>func main() {\n    resp, _ := http.Get(\"http://origin.com/image.jpeg\")\n\n    ch := make(chan byte)\n    go sendToClient(respBodyTee, ch) // pass 'ch' for writing and run in a goroutine\n    uploadeToServer(ch) // will read from 'ch' (synchronous)\n}\n</code></pre>\n\n<p>I'm new to Go and am not sure if the above is the right direction.</p>\n"}, {"tags": ["go", "websocket", "concurrency", "mutex"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1560638076, "post_id": 56613495, "comment_id": 99803690, "body": "We&#39;ll need a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, I&#39;m afraid. This code looks fine, but how do we know you&#39;re not using the very same <code>*websocket.Conn</code> in another <code>CONN</code>? (or maybe there are other problems)"}, {"owner": {"reputation": 1386, "user_id": 5293560, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh6.googleusercontent.com/-k9P2KYH96og/AAAAAAAAAAI/AAAAAAAAA_A/K3dmT7Nqow0/photo.jpg?sz=128", "display_name": "vityavv", "link": "https://stackoverflow.com/users/5293560/vityavv"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1560641013, "post_id": 56613495, "comment_id": 99804138, "body": "@SergioTulentsev I have added some code into the question. unfortunately, I cannot single out the error very well, so I can&#39;t provide a very good minimal example :("}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1560722008, "post_id": 56613495, "comment_id": 99818743, "body": "Some calls to WriteMessage are not protected by the mutex.   Use Send for all writes."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1560726826, "post_id": 56613495, "comment_id": 99819330, "body": "There is a data race on variable connections. Run the application with the race detector."}], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 6420072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2636ed2bdfe323ff03a362bd002b80e?s=128&d=identicon&r=PG&f=1", "display_name": "Kax", "link": "https://stackoverflow.com/users/6420072/kax"}, "is_accepted": false, "score": 0, "last_activity_date": 1561185145, "creation_date": 1561185145, "answer_id": 56713180, "question_id": 56613495, "link": "https://stackoverflow.com/questions/56613495/concurrent-write-to-websocket-connection/56713180#56713180", "title": "Concurrent write to websocket connection", "body": "<p>Your <code>func wsHandler(w http.ResponseWriter, r *http.Request)</code> is not properly synchronized over the global variable map <code>connections</code></p>\n\n<p>Each call to <code>wsHandler</code> is made in a separate goroutine:</p>\n\n<p>From <a href=\"https://golang.org/pkg/net/http/#Server.ListenAndServe\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Server.ListenAndServe</a></p>\n\n<blockquote>\n  <p>ListenAndServe listens on the TCP network address srv.Addr and then calls Serve to handle requests on incoming connections.</p>\n</blockquote>\n\n<p>And from <a href=\"https://golang.org/pkg/net/http/#Server.Serve\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Server.Serve</a></p>\n\n<blockquote>\n  <p>Serve accepts incoming connections on the Listener l, creating a new service goroutine for each.</p>\n</blockquote>\n"}], "owner": {"reputation": 1386, "user_id": 5293560, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh6.googleusercontent.com/-k9P2KYH96og/AAAAAAAAAAI/AAAAAAAAA_A/K3dmT7Nqow0/photo.jpg?sz=128", "display_name": "vityavv", "link": "https://stackoverflow.com/users/5293560/vityavv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1869, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561185145, "creation_date": 1560626387, "last_edit_date": 1560640985, "question_id": 56613495, "link": "https://stackoverflow.com/questions/56613495/concurrent-write-to-websocket-connection", "title": "Concurrent write to websocket connection", "body": "<p>I am using <code>github.com/gorilla/websocket</code> for websockets. I have this code</p>\n\n<pre><code>type CONN struct {\n    Conn *websocket.Conn\n    Username string\n    hand []string\n    mu *sync.Mutex\n}\nfunc (c *CONN) Send(messageType int, message []byte) error {\n    c.mu.Lock()\n    defer c.mu.Unlock()\n    return c.Conn.WriteMessage(messageType, message)\n}\n//later...\nconnection.Send(messageType, []byte(\"play\"))\nconnection.Send(messageType, []byte(\"[\\\"a\\\", \\\"b\\\", \\\"c\\\"]\"))\n</code></pre>\n\n<p>These last two lines are giving me the error. Please let me know if you need any more code to figure it out. Here's the error:</p>\n\n<pre><code>2019/06/15 15:19:03 http: panic serving [::1]:56788: concurrent write to websocket connection\ngoroutine 10 [running]:\nnet/http.(*conn).serve.func1(0xc000164140)\n    /usr/lib64/go/1.11/src/net/http/server.go:1746 +0xd0\npanic(0x6654e0, 0x7125a0)\n    /usr/lib64/go/1.11/src/runtime/panic.go:513 +0x1b9\ngithub.com/gorilla/websocket.(*messageWriter).flushFrame(0xc000043a18, 0xc000016501, 0xc00001656c, 0x0, 0x4, 0x713e00, 0xc0001141e0)\n    /home/victor/programs/goprograms/src/github.com/gorilla/websocket/conn.go:597 +0x631\ngithub.com/gorilla/websocket.(*Conn).WriteMessage(0xc0001a4160, 0x1, 0xc000016568, 0x4, 0x8, 0x4, 0xc000016568)\n    /home/victor/programs/goprograms/src/github.com/gorilla/websocket/conn.go:753 +0x24b\nmain.(*CONN).Send(0xc00015c280, 0x1, 0xc000016568, 0x4, 0x8, 0x0, 0x0)\n    /home/victor/programs/goprograms/src/v/asdf/network/main.go:32 +0x9e\nmain.wsHandler(0x716960, 0xc00011e380, 0xc000116400)\n    /home/victor/programs/goprograms/src/v/asdf/network/main.go:68 +0x501\nnet/http.HandlerFunc.ServeHTTP(0x6e1ab0, 0x716960, 0xc00011e380, 0xc000116400)\n    /usr/lib64/go/1.11/src/net/http/server.go:1964 +0x44\nnet/http.(*ServeMux).ServeHTTP(0x8dadc0, 0x716960, 0xc00011e380, 0xc000116400)\n    /usr/lib64/go/1.11/src/net/http/server.go:2361 +0x127\nnet/http.serverHandler.ServeHTTP(0xc00008d040, 0x716960, 0xc00011e380, 0xc000116400)\n    /usr/lib64/go/1.11/src/net/http/server.go:2741 +0xab\nnet/http.(*conn).serve(0xc000164140, 0x716b60, 0xc00005a800)\n    /usr/lib64/go/1.11/src/net/http/server.go:1847 +0x646\ncreated by net/http.(*Server).Serve\n    /usr/lib64/go/1.11/src/net/http/server.go:2851 +0x2f5\n</code></pre>\n\n<p><a href=\"https://gist.github.com/vityavv/a97ac9fe9192cb7107e6c7979f90cafc\" rel=\"nofollow noreferrer\">Here is the full code I am using</a> - line 75 is where the connection is set. I don't see how there could be multiple connections under one item in the map.</p>\n"}, {"tags": ["go", "google-cloud-platform", "rsa", "iot", "google-cloud-iot"], "comments": [{"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1560617907, "post_id": 56611893, "comment_id": 99799581, "body": "The public key is not a valid format. The header suggests a base64-encoded SubjectPublicKeyInfo structure but the contents are actually an RSAPublicKey structure. An RSAPublicKey structure should start out &quot;BEGIN RSA PUBLIC KEY&quot;."}, {"owner": {"reputation": 3670, "user_id": 3210471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0011315a5220abee16de015d7c96e4ed?s=128&d=identicon&r=PG", "display_name": "MURATSPLAT", "link": "https://stackoverflow.com/users/3210471/muratsplat"}, "reply_to_user": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1560671317, "post_id": 56611893, "comment_id": 99807877, "body": "@JamesKPolk thank you for comment. But using the header recommended by you  instead of &quot;PUBLIC KEY&quot; doesn&#39;t work. I am getting same error by GCP IoT Core API.  I think that my go code can&#39;t generate RSA Keys like as openssl command. For example  the outputs of this command <code>openssl genrsa -out rsa_private.pem 2048 &amp;&amp; openssl rsa -in rsa_private.pem -pubout -out rsa_public.pem</code>  are verified by GCP IoT Core API."}, {"owner": {"reputation": 3670, "user_id": 3210471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0011315a5220abee16de015d7c96e4ed?s=128&d=identicon&r=PG", "display_name": "MURATSPLAT", "link": "https://stackoverflow.com/users/3210471/muratsplat"}, "reply_to_user": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1562243984, "post_id": 56611893, "comment_id": 100323276, "body": "I could not figure out any way to generate valid pem file via above code. So I  have written an wrapper on <code>ssh</code> command."}], "answers": [{"comments": [{"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "reply_to_user": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1560646497, "post_id": 56612684, "comment_id": 99804856, "body": "@JohnHanley: Thanks. Do you happen to have a link to right docs, or is it something you discovered by trial and error?"}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 1, "creation_date": 1560647707, "post_id": 56612684, "comment_id": 99805010, "body": "It is more of a convention with the cloud vendors as PKCS #1 is easier to decode. However, I just looked up the IoT certificate create command: <code>openssl req -x509 -newkey rsa:2048 -keyout rsa_private.pem -nodes -out rsa_cert.pem -subj &quot;&#47;CN=unused&quot;</code> and that command generates PKCS #8. <a href=\"https://cloud.google.com/iot/docs/how-tos/credentials/keys\" rel=\"nofollow noreferrer\">cloud.google.com/iot/docs/how-tos/credentials/keys</a>"}, {"owner": {"reputation": 3670, "user_id": 3210471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0011315a5220abee16de015d7c96e4ed?s=128&d=identicon&r=PG", "display_name": "MURATSPLAT", "link": "https://stackoverflow.com/users/3210471/muratsplat"}, "edited": false, "score": 0, "creation_date": 1560671482, "post_id": 56612684, "comment_id": 99807910, "body": "@JamesKPolk  using <code>RSA PUBLIC KEY</code> as TYPE doesn&#39;t work."}], "tags": [], "owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "is_accepted": false, "score": 0, "last_activity_date": 1560620048, "creation_date": 1560620048, "answer_id": 56612684, "question_id": 56611893, "link": "https://stackoverflow.com/questions/56611893/gcp-iot-core-rejects-this-rsa-pem-public-key-with-an-error/56612684#56612684", "title": "GCP IoT core rejects this RSA_PEM public key with an error", "body": "<p>The encoding header and the encoding method don't match. If you want to use</p>\n\n<pre><code>asn1Bytes := x509.MarshalPKCS1PublicKey(&amp;key.PublicKey)\n</code></pre>\n\n<p>then the <code>pem.Block</code> Type should be <code>Type:  \"RSA PUBLIC KEY\",</code>.</p>\n\n<p>If you want the other common public key format, a SubjectPublicKeyInfo ASN.1 structure, then keep the <code>pem.Block</code> as you have it and instead use</p>\n\n<pre><code>asn1Bytes, err := x509.MarshalPKIXPublicKey(&amp;key.PublicKey)\n</code></pre>\n\n<p>I don't know what GCP is expecting but it's almost certainly one or the other.</p>\n"}, {"tags": [], "owner": {"reputation": 1713, "user_id": 4052858, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/710d5f65b404307fea9b5a1564c60549?s=128&d=identicon&r=PG&f=1", "display_name": "N.F.", "link": "https://stackoverflow.com/users/4052858/n-f"}, "is_accepted": false, "score": 0, "last_activity_date": 1567405070, "creation_date": 1567405070, "answer_id": 57752201, "question_id": 56611893, "link": "https://stackoverflow.com/questions/56611893/gcp-iot-core-rejects-this-rsa-pem-public-key-with-an-error/57752201#57752201", "title": "GCP IoT core rejects this RSA_PEM public key with an error", "body": "<p>I faced the same issue.\nI could solve this with the following code.</p>\n\n<pre><code>package cloudIotCore\n\nimport (\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/x509\"\n    \"encoding/pem\"\n    \"os\"\n)\n\nfunc create() {\n\n    //\n    // Create key\n    //\n    reader := rand.Reader\n    bitSize := 2048\n\n    key, err := rsa.GenerateKey(reader, bitSize)\n    if err != nil {\n        panic(err)\n    }\n\n    publicKeyAsc1Bytes, err := x509.MarshalPKIXPublicKey(&amp;(key.PublicKey))\n    if err != nil {\n        panic(err)\n    }\n\n    publicPemKey := &amp;pem.Block{\n        Type:  \"PUBLIC KEY\",\n        Bytes: publicKeyAsc1Bytes,\n    }\n\n    privatePemKey := &amp;pem.Block{\n        Type:  \"RSA PRIVATE KEY\",\n        Bytes: x509.MarshalPKCS1PrivateKey(key),\n    }\n\n    //\n    // Create Device with publicPemKey\n    //\n\n    :\n\n    //\n    // Save pem files\n    //\n\n    publicPemFile, err := os.Create(PATH_TO_PUBLICKEY)\n    if err != nil {\n        panic(err)\n    }\n    defer publicPemFile.Close()\n\n    err = pem.Encode(publicPemFile, publicPemKey)\n    if err != nil {\n        panic(err)\n    }\n\n    privatePemFile, err := os.Create(PATH_TO_PRIVATEKEY)\n    if err != nil {\n        panic(err)\n    }\n    defer privatePemFile.Close()\n\n    err = pem.Encode(privatePemFile, privatePemKey)\n    if err != nil {\n        panic(err)\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 3670, "user_id": 3210471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0011315a5220abee16de015d7c96e4ed?s=128&d=identicon&r=PG", "display_name": "MURATSPLAT", "link": "https://stackoverflow.com/users/3210471/muratsplat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 997, "favorite_count": 2, "answer_count": 2, "score": 0, "last_activity_date": 1567405070, "creation_date": 1560613885, "last_edit_date": 1560670456, "question_id": 56611893, "link": "https://stackoverflow.com/questions/56611893/gcp-iot-core-rejects-this-rsa-pem-public-key-with-an-error", "title": "GCP IoT core rejects this RSA_PEM public key with an error", "body": "<p>I try to develop an automation to register new IoT device with public RSA pem certificate but I have a problem which is I don't know the reason.</p>\n\n<p>The problem is RSA_PEM public pem is generated my automation is rejected by GCP IoT Server with an error. That error is \"The key data for the device credential in position 1 is invalid. Make sure the format is correct: Invalid RS256 public key\"</p>\n\n<p>When I debug the my code, the pem public certificate looks fine. But I am not sure that.</p>\n\n<p>I am sharing go code that generate private and public certificates in paired.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package cert\n\nimport (\n    \"bytes\"\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/x509\"\n    \"encoding/pem\"\n\n    \"io\"\n)\n\ntype CertificateRSA struct {\n    Private io.Reader\n    Public  io.Reader\n}\n\nfunc Create() (*CertificateRSA, error) {\n\n    bitSize := 2048\n    key, err := rsa.GenerateKey(rand.Reader, bitSize)\n    if err != nil {\n        return nil, err\n    }\n\n    var privateKey = &amp;pem.Block{\n        Type:  \"RSA PRIVATE KEY\",\n        Bytes: x509.MarshalPKCS1PrivateKey(key),\n    }\n\n    var priBuff bytes.Buffer\n    err = pem.Encode(&amp;priBuff, privateKey)\n    if err != nil {\n        return nil, err\n    }\n\n    // asn1Bytes := x509.MarshalPKCS1PublicKey(&amp;key.PublicKey)\n    asn1Bytes := x509.MarshalPKCS1PublicKey(&amp;key.PublicKey)\n\n    var publicKey = &amp;pem.Block{\n        Type:  \"PUBLIC KEY\",\n        Bytes: asn1Bytes,\n    }\n\n    var pubBuff bytes.Buffer\n\n    err = pem.Encode(&amp;pubBuff, publicKey)\n    return &amp;CertificateRSA{\n        Private: &amp;priBuff,\n        Public:  &amp;pubBuff,\n    }, err\n}\n\n</code></pre>\n\n<p>Can you see any problem in my code ?</p>\n\n<p>And this code can generates certificates like as these:</p>\n\n<pre><code>-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEA0FGWENPInhIfCLDTqCFKFsyrvmzKsEjJtHEL0Tqh0LtHDWG5\nSh7MT7/x/xNAFc00zmgGG+PPaJDP/7gkGJitRAXcJOlKwlowgmVTf+QGwH81pq3o\nZNRd0mEXbF0EuPBRNt/9TzkZPAlPDGruMCiMq9LWsoIflx+u/3UmXgsyMQTs5vSM\nz4T5VCELHGCtfZfBrDAP19KzwjFEUTEzX+Llotp0mO6+cRCslVvSK3xd8KIk2cOm\nAXEmCavZnwuVsqCVmNZFoQZvFszisMf5cXZRDstKCGsqDgqIGM5dMMrBS92CqZ4u\nj6h9zbMG7J9oXsVmVFiQ++hS0TLJdWwMD+uhWQIDAQABAoIBAAbKIfH6dRdxz8Eg\nwkVAkIGduhtCwHhuZuSSqqfvGUcMU4yEGt3nkxEmWGTP487SGV6A1XIjQqdN0Pms\nrsB+eWc2Ka6qS915wwr88nPAotezTbRZBrICmew5beICRh0g+ASp2D+0xLXIN+NX\nuNuo9qzC+mxnAVCTn8iDsPRvuPsP9vJSy5zIzPWURdPBQ3Ny1pbj+odqwDdUw8q7\nFfUmGHC7a5oKex3vxDhDL8OPc3KjynFJdm1YqUagLzppDHMZtI2rNAYfWrkrJVB7\nzlX3m0hUDDrvHbQBiqGUj2qI2MqgrFlcK0HSryJdCz4tVdYY3qBi/tZrwOAvnSkv\nzNFT6AECgYEA9veJpGwUYdRhWyo05xsatDJ+KvBpizi66Iu2Lu+fRQUuwYaC0DSV\nBMr1ktbJzbgbu4XDNrJ8GKrqka06vGjaYVhw1C56LU83hHsckTx+K3fpb9wkFamE\ngCZG3uAqflLsEPZ6xPHLe1U+SDZfghLrH90JYi7tTULReAVy5zVs8iECgYEA1/Aq\n6ls9kPtJWLEU299WdNGYy5Fx1N8oUj5sjYTfPf/27OeBXWg+CKBIhXk534z9pwqq\nLUs7NbmqhuocuxFtE7oxdwqXqUR7qYUdpVuRZ8EmVvBuUGxI1MG6MMKxHxSSpTs5\n3tTDAd2WlwPX3jbqAj2WOiL2T97cXNjYyKxiuDkCgYBbI0RnKf9njtGSrAOz2XvE\nTfHjdK7uUrQfBxfnQER9WwlDH5l8rjrj9uYjFyKHyU5qqFU/BSTokYJY2h2X0/Xr\nAJE6rCAoQliRikEjk7hX4DuELTAf0lv0UqvKqdzkm0NEi0EJFtXpoK6IRZB/Vu3v\n50kEM58c6PCWIyShEEUxIQKBgQCg63qf0UTNMWaUcMqxm/sq7TNnqMjisTa0K47r\n27Qd2Q1juJZATLnF5eSFizSkssYoYJs3S9QhEm7RQdANXEwkImJQaxVgcAeT6f6Q\nxu9SGa9/pIcg6cFQw9oEEmK6XbN27O8Qbw+v6Tka6yNIlzXGW60DQCC8nsErc/IB\nge3DiQKBgA3183wzRLj7oZD/KJHW+BY0Y6ljZ8EQQ5anc3RFsQrJ48MdPtRNvC49\nOe0T2lRznVdiPcGY8DKlBMYXQ4jiXZxpWmM8jNkJYPBhx9rq8zBDESo8DKSFd1Jo\nlNADlBGDEPYgxG29hnSOrBf5TI1Fkj15RVZOJ79uaefp98ACIgkl\n-----END RSA PRIVATE KEY-----\n</code></pre>\n\n<pre><code>-----BEGIN PUBLIC KEY-----\nMIIBCgKCAQEA0FGWENPInhIfCLDTqCFKFsyrvmzKsEjJtHEL0Tqh0LtHDWG5Sh7M\nT7/x/xNAFc00zmgGG+PPaJDP/7gkGJitRAXcJOlKwlowgmVTf+QGwH81pq3oZNRd\n0mEXbF0EuPBRNt/9TzkZPAlPDGruMCiMq9LWsoIflx+u/3UmXgsyMQTs5vSMz4T5\nVCELHGCtfZfBrDAP19KzwjFEUTEzX+Llotp0mO6+cRCslVvSK3xd8KIk2cOmAXEm\nCavZnwuVsqCVmNZFoQZvFszisMf5cXZRDstKCGsqDgqIGM5dMMrBS92CqZ4uj6h9\nzbMG7J9oXsVmVFiQ++hS0TLJdWwMD+uhWQIDAQAB\n-----END PUBLIC KEY-----\n</code></pre>\n"}, {"tags": ["elasticsearch", "go"], "comments": [{"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1560621136, "post_id": 56611518, "comment_id": 99800254, "body": "I&#39;m not sure if there are other errors but I think you intended <code>monitoringAnswersPipeline = append(monitoringAnswersPipeline, esSubQuery)</code> to go inside the for loop, otherwise it just adds the final esSubQuery rather than all of them."}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1560621340, "post_id": 56611518, "comment_id": 99800302, "body": "Also, if you are using the <code>olivere&#47;elastic</code> library which I think you are you can turn on a feature to print the request before it is sent by doing calling <code>SetTraceLog</code> when you create the client.  <a href=\"https://godoc.org/github.com/olivere/elastic#SetTraceLog\" rel=\"nofollow noreferrer\">godoc.org/github.com/olivere/elastic#SetTraceLog</a>  This will print out the actual request you are making so you can compare it with the one you are sending in Postman"}, {"owner": {"reputation": 59, "user_id": 11543716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SRB-pw6Qah0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdz6DsOACBMSFULvuqJEJdXAZr6Kg/mo/photo.jpg?sz=128", "display_name": "nickMason", "link": "https://stackoverflow.com/users/11543716/nickmason"}, "reply_to_user": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1560693959, "post_id": 56611518, "comment_id": 99812282, "body": "@IainDuncan I have added the ES logs to my question, can you take a look please?"}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1560706429, "post_id": 56611518, "comment_id": 99815192, "body": "thanks! That had enough information in it to provide an answer, hope this helps."}], "answers": [{"tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": true, "score": 1, "last_activity_date": 1560706308, "last_edit_date": 1560706308, "creation_date": 1560704737, "answer_id": 56620950, "question_id": 56611518, "link": "https://stackoverflow.com/questions/56611518/es-query-from-a-golang-server-to-es-returning-error-while-the-postman-request-di/56620950#56620950", "title": "ES query from a golang server to ES returning error while the postman request directly to ES returns the expected results", "body": "<p>Thanks for uploading the logs, you are right that the <code>[\"_id\"]</code> is the request being sent. The problem is in the request line as <code>Source([]string{\"_id\"})</code> does not set the source field to <code>[\"_id\"]</code> as you intended but instead:</p>\n\n<blockquote>\n  <p>Source allows the user to set the request body manually without using\n  any of the structs and interfaces in Elastic.</p>\n</blockquote>\n\n<p><a href=\"https://godoc.org/github.com/olivere/elastic#SearchService.Source\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/olivere/elastic#SearchService.Source</a></p>\n\n<p>You want to use <code>FetchSourceContext</code> instead:</p>\n\n<pre><code>res, err = r.esConn.Search(indexName).From(requestBody.MaxResponseTimestampCount).FetchSourceContext(elastic.NewFetchSourceContect(true). Include(\"_id\")).Query(query).Size(requestBody.ResponsePageLength).Do(ctx)\n</code></pre>\n\n<p><a href=\"https://godoc.org/github.com/olivere/elastic#SearchService.FetchSourceContext\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/olivere/elastic#SearchService.FetchSourceContext</a></p>\n"}], "owner": {"reputation": 59, "user_id": 11543716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SRB-pw6Qah0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdz6DsOACBMSFULvuqJEJdXAZr6Kg/mo/photo.jpg?sz=128", "display_name": "nickMason", "link": "https://stackoverflow.com/users/11543716/nickmason"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 56620950, "answer_count": 1, "score": 1, "last_activity_date": 1562913807, "creation_date": 1560610902, "last_edit_date": 1562913807, "question_id": 56611518, "link": "https://stackoverflow.com/questions/56611518/es-query-from-a-golang-server-to-es-returning-error-while-the-postman-request-di", "title": "ES query from a golang server to ES returning error while the postman request directly to ES returns the expected results", "body": "<p>This is the request body that I for this endpoint using Postman <code>localhost:9201/response_v2_862875ee3a88a6d09c95bdbda029ce2b/_search</code></p>\n\n<pre><code>{\n\"_source\": [\"_id\"],\n\"from\": 1,\n\"size\": 10,\n: {\n                                \"should\": {\n                                    \"match\": {\n\n            }\n        }, {\n            \"range\": {\n                \"_updated_at\": {\n                    \"from\": \"36163\",\n                    \"include_lower\": true,\n                    \"include_upper\": true,\n                    \"to\": null\n                }\n            }\n        }]\n    }\n}\n}\n\n</code></pre>\n\n<p>To this url localhost:9201/rensedbda029ce2b/_search</p>\n\n<p>And I get the results <a href=\"https://gist.gith\" rel=\"nofollow noreferrer\">https://gist.gith</a></p>\n\n<p>But when I make the same request from my server to ES I get an error saying \"elastic: Error 400 (Bad Request): Expected [START_OBJECT] but found [START_ARRAY] [type=parsing_exception]\"</p>\n\n<p>These are some snippets of my code. I get the query from another util function and use that while making the call to ES.</p>\n\n<p>This is the call to ES <code>res, err = r.esConn.Search(indexName).e(requestBody.ResponsePageLength).Do(ctx)</code></p>\n\n<p>and the query builder function is this, it takes arguments which are extracted from the body of the request to my server and builds a query based on that.</p>\n\n<pre><code>func CreateMonitoringPipeline(maxResponseTime string, responseQueries []ResponseQuery, baselineFormId string) *elastic.BoolQuery {\nfinalQuery := elastic.NewBoolQuery()\n\n    dateRangeMatchQuery := elastic.NewRangeQuery(\"_updated_at\").\n        Gte(maxResponseTime)\n\n    finalQuery.Filter(dateRangeMatchQuery)\n}\n\nreturn finalQuery\n}\n</code></pre>\n\n<p>I can't figure out why is this happening? my ES is running using the ES binary and my server runs in a docker container.</p>\n\n<p>Completely new to ES and golang so please help. </p>\n\n<p>UPDATE: </p>\n\n<p>This is what I got when I logged my request using <code>SetTraceLog</code></p>\n\n<pre><code>| ELASTICPOST /resp8ecf8427e/_search HTTP/1.1\n| Host: 172.17.0.1:9201\n| User-Agent: elastic/5.0.81 (linux-amd64)\n| Transfer-Encoding: chunked\n| Accept: application/json\n| Content-Type: application/json\n| Accept-Encoding: gzip\n| \n| 7\n| [\"_id\"]\n| 0\n</code></pre>\n\n<p>I can't understand what do the 7 and <code>[\"_id\"]</code> mean. Is this my request body that ES received?</p>\n"}, {"tags": ["go", "floating-point", "int", "division"], "comments": [{"owner": {"reputation": 620, "user_id": 1078027, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/32ca0886c7e7f19b1edfcf90cb13c700?s=128&d=identicon&r=PG", "display_name": "boreq", "link": "https://stackoverflow.com/users/1078027/boreq"}, "edited": false, "score": 3, "creation_date": 1560611727, "post_id": 56611436, "comment_id": 99798087, "body": "This code does not compile. Please provide a complete working example. There are missing variable declarations in the code and syntax errors. A link to a Go Playground would go a long way."}], "answers": [{"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1560622176, "post_id": 56611681, "comment_id": 99800498, "body": "You&#39;re also neglecting the error in your solution :-)"}, {"owner": {"reputation": 1968, "user_id": 9263083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d74d9629591720e7e7bc8ddd3f35c92?s=128&d=identicon&r=PG&f=1", "display_name": "sanoJ", "link": "https://stackoverflow.com/users/9263083/sanoj"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1560622446, "post_id": 56611681, "comment_id": 99800561, "body": "Oh I have missed it, updated the example. Thanks @colminator"}], "tags": [], "owner": {"reputation": 1968, "user_id": 9263083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d74d9629591720e7e7bc8ddd3f35c92?s=128&d=identicon&r=PG&f=1", "display_name": "sanoJ", "link": "https://stackoverflow.com/users/9263083/sanoj"}, "is_accepted": true, "score": 0, "last_activity_date": 1560622530, "last_edit_date": 1560622530, "creation_date": 1560612142, "answer_id": 56611681, "question_id": 56611436, "link": "https://stackoverflow.com/questions/56611436/division-of-two-values-results-in-0/56611681#56611681", "title": "Division of two values results in 0", "body": "<p>The problem is your trying to convert floating string an int in </p>\n\n<pre><code>endAmount, _ := strconv.Atoi(amountAsString)\n</code></pre>\n\n<p>This will give an error, but you're just neglecting it. Use <code>strconv.ParseFloat(amountAsString, 64)</code> to solve your problem.</p>\n\n<p>Check the playground <a href=\"https://play.golang.org/p/s5QM-hqGGvi\" rel=\"nofollow noreferrer\">example</a> to see the error and the working code</p>\n"}], "owner": {"reputation": 1, "user_id": 11646871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75e7a94d4eb360a4da81836f3ed331be?s=128&d=identicon&r=PG&f=1", "display_name": "Vogel", "link": "https://stackoverflow.com/users/11646871/vogel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 56611681, "answer_count": 1, "score": -4, "last_activity_date": 1560622530, "creation_date": 1560610294, "question_id": 56611436, "link": "https://stackoverflow.com/questions/56611436/division-of-two-values-results-in-0", "title": "Division of two values results in 0", "body": "<p>I'm trying to make a division of two variables, but when I want to print the result, the program prints out 0</p>\n\n<p>the leadTime and endAmount are being correctly printed by te program, but the monthlyAmount is being printed as 0. Also if I remove the float64() around endAmount and leadTime it is being printed as 0</p>\n\n<pre><code>var leadTime int\nif currentAge &lt; 45 {\n    leadTime  = 120\n} else if currentAge &gt; 45 &amp;&amp; currentAge &lt; 55 {\n    leadTime = 90\n} else if currentAge &gt; 55 {\n    leadTime = 60\n}\nendAmount, _ := strconv.Atoi(amountAsString)\n\nmonthlyAmount:= (float64(endAmount) / float64(leadTime)\nfmt.Println(\"leadTime :\", leadTime )\nfmt.Println(\"Total amount:\", endAmount)\nfmt.Println(\"monthlyAmount:\", monthlyAmount)\n</code></pre>\n\n<p>with the standardinput I'm testing with, the leadTime = 120 and the endAmount = 93735.00 so the monthlyAmount should be: 781.13</p>\n"}, {"tags": ["amazon-web-services", "go", "lambda", "aws-lambda"], "answers": [{"tags": [], "owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "is_accepted": true, "score": 2, "last_activity_date": 1560614816, "creation_date": 1560614816, "answer_id": 56612015, "question_id": 56611363, "link": "https://stackoverflow.com/questions/56611363/cannot-invoke-aws-lambda-programmatically/56612015#56612015", "title": "Cannot invoke AWS lambda programmatically", "body": "<p>Try using the <code>New</code> function in the <code>lambda</code> package.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>sess := session.Must(session.NewSessionWithOptions(session.Options{\n    SharedConfigState: session.SharedConfigEnable,\n}))\n\nclient := lambda.New(sess, &amp;aws.Config{Region: aws.String(\"us-west-2\")})\n</code></pre>\n"}], "owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 56612015, "answer_count": 1, "score": 1, "last_activity_date": 1560634160, "creation_date": 1560609646, "last_edit_date": 1560634160, "question_id": 56611363, "link": "https://stackoverflow.com/questions/56611363/cannot-invoke-aws-lambda-programmatically", "title": "Cannot invoke AWS lambda programmatically", "body": "<p>I am importing the lambda service as follows:</p>\n\n<pre><code>import (\n    lambdaservice \"github.com/aws/aws-sdk-go/service/lambda\"\n)\n\n\n</code></pre>\n\n<p>and use it as follows:</p>\n\n<pre><code>func InvokeCreateSessionLambda(payload invoketypes.Input) {\n    l := &amp;lambdaservice.Lambda{}\n    data, _ := json.Marshal(payload)\n\n    input := &amp;lambdaservice.InvokeInput{\n        Payload:        data,\n        InvocationType: aws.String(\"RequestResponse\"),\n        FunctionName:   aws.String(\"MyValidFunctionARN\"),\n        ClientContext:  aws.String(\"{\\\"service\\\":\\\"somedata\\\"}\"),\n    }\n    err := input.Validate()\n    fmt.Println(err) // prints  &lt;nil&gt;\n    r, e := l.Invoke(input) &lt;panic&gt;\n    fmt.Print(e)\n    fmt.Print(r)\n}\n</code></pre>\n\n<p>but <code>l.Invoke(input)</code> panics with the (relevant) stack trace:</p>\n\n<pre><code>runtime error: invalid memory address or nil pointer dereference\n&lt;skipped some lines&gt;\npanic(0xac91e0, 0x1214ef0)\n    /usr/local/go/src/runtime/panic.go:522 +0x1b5\ntest-lambda-go/vendor/github.com/aws/aws-sdk-go/aws/client.(*Client).NewRequest(...)\n    /home/ayush/projects/gojects/src/test-lambda-go/vendor/github.com/aws/aws-sdk-go/aws/client/client.go:84\ntest-lambda-go/vendor/github.com/aws/aws-sdk-go/service/lambda.(*Lambda).newRequest(0xc000107498, 0xc0001f0680, 0xb22ac0, 0xc0001f0640, 0xb12080, 0xc0001f06c0, 0xc0000e2480)\n    /home/ayush/projects/gojects/src/test-lambda-go/vendor/github.com/aws/aws-sdk-go/service/lambda/service.go:87 +0x3e\ntest-lambda-go/vendor/github.com/aws/aws-sdk-go/service/lambda.(*Lambda).InvokeRequest(0xc000107498, 0xc0001f0640, 0x6, 0xc0001fa000)\n    /home/ayush/projects/gojects/src/test-lambda-go/vendor/github.com/aws/aws-sdk-go/service/lambda/api.go:1895 +0x102\ntest-lambda-go/vendor/github.com/aws/aws-sdk-go/service/lambda.(*Lambda).Invoke(0xc000107498, 0xc0001f0640, 0xc0001074c0, 0x1, 0x1)\n    /home/ayush/projects/gojects/src/test-lambda-go/vendor/github.com/aws/aws-sdk-go/service/lambda/api.go:2017 +0x35\n</code></pre>\n\n<p>Any  idea what's causing the error and how to fix this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 112, "user_id": 3315185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28f4c2029b1bed286fa007d00a70a750?s=128&d=identicon&r=PG", "display_name": "Liyang Chen", "link": "https://stackoverflow.com/users/3315185/liyang-chen"}, "edited": false, "score": 0, "creation_date": 1560583322, "post_id": 56608186, "comment_id": 99791853, "body": "In your example, <code>inpdata.txt</code> is not included in the output binary. Suppose your program read <code>inpdata.txt</code> by <code>ioutil.ReadAll(&quot;.&#47;inpdata.txt&quot;)</code>, when your binary is run, your program will actually look for <code>&lt;current working directory&gt;&#47;inputdata.txt&quot;</code>. <code>&lt;current working directory&gt;</code> is usually where you run your program. So you need to ensure your <code>inputdata.txt</code> is beside your binary."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1560583519, "last_edit_date": 1560583519, "creation_date": 1560583215, "answer_id": 56608266, "question_id": 56608186, "link": "https://stackoverflow.com/questions/56608186/does-go-build-include-non-go-files-in-binary/56608266#56608266", "title": "Does go build include non go files in binary?", "body": "<blockquote>\n  <p>Does go build includes non go files in binary?</p>\n</blockquote>\n\n<p>By default, no: you need to embed them.</p>\n\n<p>There are several approaches:</p>\n\n<ul>\n<li><a href=\"https://github.com/skx/implant\" rel=\"nofollow noreferrer\"><code>skx/implant</code></a> generates a go file from your non-go resource</li>\n<li><a href=\"https://github.com/aprice/embed\" rel=\"nofollow noreferrer\"><code>aprice/embed</code></a> uses <code>go generate</code></li>\n<li><a href=\"https://github.com/gobuffalo/packr\" rel=\"nofollow noreferrer\"><code>gobuffalo/packr</code></a> uses code declaration</li>\n<li><a href=\"https://github.com/unnoted/fileb0x\" rel=\"nofollow noreferrer\"><code>unnoted/fileb0x</code></a> defines a Virtual Memory File System.</li>\n</ul>\n"}], "owner": {"reputation": 35, "user_id": 10412704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/202205369ba04757a47bbf6a53e7f0a6?s=128&d=identicon&r=PG&f=1", "display_name": "ehrktia", "link": "https://stackoverflow.com/users/10412704/ehrktia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 859, "favorite_count": 3, "closed_date": 1560590014, "answer_count": 1, "score": 0, "last_activity_date": 1560590031, "creation_date": 1560582584, "last_edit_date": 1560589910, "question_id": 56608186, "link": "https://stackoverflow.com/questions/56608186/does-go-build-include-non-go-files-in-binary", "closed_reason": "Duplicate", "title": "Does go build include non go files in binary?", "body": "<p>Does <code>go build</code> include other supporting files used in code and ships it along with exe?\nFor ex:</p>\n\n<pre><code>--&gt; input.go - contains go code to read input from text file\n--&gt; inpdata.txt\n</code></pre>\n\n<p>when we do <code>go build</code>, does the <code>inpdata.txt</code> files get shipped as well?<br>\nif these supporting files are excluded, how do they get their input values which are being fed from external files?</p>\n\n<p>I am trying to build a binary (<code>exe</code> file precisely for win-OS) using Golang.<br>\nAfter reading some of the documentation can understand clearly that the <code>go build</code> command which produces the exe file for win-OS ignores <code>_test.go</code> files and all <code>tesdata</code> folders.<br>\nAlso referred to <a href=\"https://golang.org/pkg/go/build/#hdr-Binary_Only_Packages\" rel=\"nofollow noreferrer\"><code>go build</code> binary package</a> in the documentation, mentioned this is applicable only to non source files only.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 112, "user_id": 3315185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28f4c2029b1bed286fa007d00a70a750?s=128&d=identicon&r=PG", "display_name": "Liyang Chen", "link": "https://stackoverflow.com/users/3315185/liyang-chen"}, "edited": false, "score": 0, "creation_date": 1560585385, "post_id": 56608104, "comment_id": 99792261, "body": "&quot;HERE is my problem which doesn\u2019t works&quot; what error did you get?"}, {"owner": {"reputation": 112, "user_id": 3315185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28f4c2029b1bed286fa007d00a70a750?s=128&d=identicon&r=PG", "display_name": "Liyang Chen", "link": "https://stackoverflow.com/users/3315185/liyang-chen"}, "edited": false, "score": 0, "creation_date": 1560586299, "post_id": 56608104, "comment_id": 99792419, "body": "I believe you have truncated your code, because there is variable <code>c</code> not defined, using <code>\u201c</code> instead of <code>&quot;</code> as double quote, appending <code>strings.Builder</code> to <code>out</code> instead of <code>strings.Builder.String()</code>. Does your code compile successfully?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1560595894, "post_id": 56608104, "comment_id": 99794309, "body": "What are you trying to achieve by copying the builder (<code>b2 := b1</code> and <code>b3 := b2</code>)? Regardless, you should read the docs: <a href=\"https://golang.org/pkg/strings/#Builder\" rel=\"nofollow noreferrer\">golang.org/pkg/strings/#Builder</a> says <i>&quot;Do not copy a non-zero Builder&quot;</i>. But even if it was allowed why don&#39;t you just concatenate the strings? E.g. <code>out = append(out, &quot;l_sh_dit cert_data &quot; + cfg.B)</code>? Why make your code more complex? <a href=\"https://play.golang.com/p/WKMXxCXGuTt\" rel=\"nofollow noreferrer\">play.golang.com/p/WKMXxCXGuTt</a>"}, {"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1560609592, "post_id": 56608104, "comment_id": 99797560, "body": "I didn&#39;t even understand what you are trying to achieve"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1560620645, "post_id": 56608104, "comment_id": 99800165, "body": "@mkopriva - thanks this helps, can you please add it as answer and i&#39;ll close the question, in addition, in case I&#39;ve 5 properties which I need to handle this way do you suggest to do with the same pattern (if else for each field) or you recommended other way ?"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1560624711, "creation_date": 1560624711, "answer_id": 56613278, "question_id": 56608104, "link": "https://stackoverflow.com/questions/56608104/update-array-of-string-with-value-from-config/56613278#56613278", "title": "Update array of string with value from config", "body": "<p>One of the reasons your program is failing is because you are copying a non-zero <a href=\"https://golang.org/pkg/strings/#Builder\" rel=\"nofollow noreferrer\"><code>strings.Builder</code></a> instance which is disallowed.</p>\n\n<blockquote>\n  <p>A Builder is used to efficiently build a string using Write methods.\n  It minimizes memory copying. The zero value is ready to use. <strong>Do not\n  copy a non-zero Builder.</strong></p>\n</blockquote>\n\n<p>Also, and I may be wrong here, but I believe the builder is intended to provide better performance for when dealing with complex enough rules where the use of numerous individual steps to build up the string is justified. Yours is not one of those cases, however, because all you need is a single concatenation to get what you want.</p>\n\n<pre><code>type Cfg struct { A, B string }\n\nfunc getShCfg(c Cfg) string {\n    var out []string\n\n    la := \"l_sh_dit conf_data 7MB\"\n    lb := \"l_sh_dit cert_data 3MB\"\n\n    if len(c.A) &gt; 0 {\n        out = append(out, \"l_sh_dit conf_data \" + c.A)\n    } else {\n        out = append(out, la)\n    }\n    if len(c.B) &gt; 0 {\n        out = append(out, \"l_sh_dit cert_data \"+c.B)\n\n    } else {\n        out = append(out, lb)\n    }\n\n    return strings.Join(out, \";\\n\\r\") + \";\"\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/WKMXxCXGuTt\" rel=\"nofollow noreferrer\">https://play.golang.com/p/WKMXxCXGuTt</a></p>\n\n<hr>\n\n<p>Additionally if the number of the config properties grows and you want to avoid writing too many if-elses then you can always extract that logic into a func.</p>\n\n<pre><code>func getCfgProp(key, val, def string) string {\n    if len(val) &gt; 0 {\n        return key + \" \" + val\n    }\n    return key + \" \" + def\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/daXqV4-Umza\" rel=\"nofollow noreferrer\">https://play.golang.com/p/daXqV4-Umza</a></p>\n"}], "owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 826, "favorite_count": 2, "accepted_answer_id": 56613278, "answer_count": 1, "score": 2, "last_activity_date": 1560624711, "creation_date": 1560581749, "last_edit_date": 1560590723, "question_id": 56608104, "link": "https://stackoverflow.com/questions/56608104/update-array-of-string-with-value-from-config", "title": "Update array of string with value from config", "body": "<p>I\u2019ve the following function which needs to provide a strings with data in two options</p>\n\n<ol>\n<li>Value from config is provided ( can change only the values of <code>7MB</code> or <code>3MB</code> ) all the prefix is the same</li>\n<li>If config not provided fallback to defaults which is <code>7MB</code>  and <code>3MB</code></li>\n</ol>\n\n<p>example</p>\n\n<p>if I dont get any value from the config API the function should return <strong>default</strong> values, which is hard-coded in the function. like this:</p>\n\n<pre><code>\u201cl_sh_dit conf_data 7MB\n l_sh_dit cert_data 3MB\u201d\n\n</code></pre>\n\n<p>if im getting value from the <code>config</code> app let say 1MB (conf) and 100MB (cert) respectively the output of the function should look l</p>\n\n<pre><code>\u201cl_sh_dit conf_data 1MB\n l_sh_dit cert_data 100MB\u201d\n\n</code></pre>\n\n<p>The problem is that I\u2019ve already the <code>defaults</code> value <code>hard-coded</code>, how can I update in each <code>element</code> in the array only the last value (the number 10M or all other value) , in efficient way ? </p>\n\n<p>I've tried with string builder API without success as this is a bit tricky, what could be missing here? </p>\n\n<pre><code>func getShCfg() string{\n\nvar out []string\n\nvar b1 strings.Builder\n\n\nla:= \"l_sh_dit conf_data 7MB\"\nlb := \"l_sh_dit cert_data 3MB\"\n\ncfg, ok := c.(config.Configuration)\n\nif !ok {\n    log.Errorf(\u201cerror:\u201d, c)\n    return \"\"\n}\n\n// here I got the data from config, else fallback to defaults \nif len(cfg.A) &gt; 0 {\n\n   // HERE is my problem which doesn\u2019t works\n   b1.WriteString(\"l_sh_dit\")\n   b2 := b1\n   b2.WriteString(\"conf_data\") \n   b3 := b2\n   b3.WriteString(cfg.A) \n\n   out = append(out, b3)\n} else {\n    out = append(out, la)\n}\n\n\n// here I got the data from config, else fallback to defaults \nif len(cfg.B) &gt; 0 {\n   // HERE is my problem which doesn\u2019t works\n   b1.WriteString(\"l_sh_dit\")\n   b2 := b1\n   b2.WriteString(\"cert_data\") \n   b3 := b2\n   b3.WriteString(cfg.B) \n   out = append(out, b3)\n\n} else {\n    out = append(out, lb)\n}\n\nreturn strings.Join(out, \";\\n\\r\") + \";\"\n\n}\n</code></pre>\n"}, {"tags": ["go", "terraform"], "comments": [{"owner": {"reputation": 12661, "user_id": 5343387, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/15a14cec3014822297a08ed6dfae2563?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Schuchard", "link": "https://stackoverflow.com/users/5343387/matt-schuchard"}, "edited": false, "score": 0, "creation_date": 1560596763, "post_id": 56608097, "comment_id": 99794510, "body": "According to the documentation, the answer appears to be: no. This means you may be stuck with defining it as a primitive instead of an aggregate."}, {"owner": {"reputation": 1592, "user_id": 413234, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5TcuP.jpg?s=128&g=1", "display_name": "stmcallister", "link": "https://stackoverflow.com/users/413234/stmcallister"}, "reply_to_user": {"reputation": 12661, "user_id": 5343387, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/15a14cec3014822297a08ed6dfae2563?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Schuchard", "link": "https://stackoverflow.com/users/5343387/matt-schuchard"}, "edited": false, "score": 0, "creation_date": 1560609142, "post_id": 56608097, "comment_id": 99797442, "body": "Ah, thank you for the comment! How would defining as a primitive help? I appears if I define them as primitives I would still run into the same issue."}], "answers": [{"comments": [{"owner": {"reputation": 1592, "user_id": 413234, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5TcuP.jpg?s=128&g=1", "display_name": "stmcallister", "link": "https://stackoverflow.com/users/413234/stmcallister"}, "edited": false, "score": 0, "creation_date": 1562197725, "post_id": 56636250, "comment_id": 100306764, "body": "updated my question based on your answer. will you take a look? thanks for your help!"}], "tags": [], "owner": {"reputation": 28957, "user_id": 281848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w7nJW.jpg?s=128&g=1", "display_name": "Martin Atkins", "link": "https://stackoverflow.com/users/281848/martin-atkins"}, "is_accepted": false, "score": 1, "last_activity_date": 1560792691, "creation_date": 1560792691, "answer_id": 56636250, "question_id": 56608097, "link": "https://stackoverflow.com/questions/56608097/terraform-schema-elem-support-multiple-types/56636250#56636250", "title": "Terraform Schema Elem Support Multiple Types?", "body": "<p>In the current (at the time of writing) Terraform SDK, this is not possible: every value must have a specific defined type because the SDK relies on it to correctly decode the data stored in Terraform state snapshots.</p>\n\n<p>A common workaround for that limitation in providers today is to have a field of a string type that accepts a JSON serialization of the value. In order to allow migration away from this workaround in future, these attributes are conventionally named with a <code>_json</code> suffix, like <code>condition_json</code> in your case. Terraform 0.12 improved the robustness of the <code>jsonencode</code> function to make it easier to provide values for such attributes without needing to hand-write JSON strings in the configuration.</p>\n\n<p>Terraform 0.12 introduced support for dynamically-typed attributes at the core layer and in the provider protocol, and so a future version of the Terraform SDK will include a capability to define an attribute as being runtime-typed. That is, the value type will be included in the message sent over the wire rather than being assumed from the schema. At that point, you can potentially use that mode for your attribute here. If you'd previously used the <code>_json</code> attribute workaround at that point, it would be possible to support both the JSON mode and the dynamic-type mode at the same time for a while to gracefully transition.</p>\n"}], "owner": {"reputation": 1592, "user_id": 413234, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5TcuP.jpg?s=128&g=1", "display_name": "stmcallister", "link": "https://stackoverflow.com/users/413234/stmcallister"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1562197645, "creation_date": 1560581707, "last_edit_date": 1562197645, "question_id": 56608097, "link": "https://stackoverflow.com/questions/56608097/terraform-schema-elem-support-multiple-types", "title": "Terraform Schema Elem Support Multiple Types?", "body": "<p>Can the Terraform Schema support multiple Schema types for an <code>Elem</code>? The problem I'm trying to solve is that the data from my external API is an array that has multiple types--some elements are strings and some are lists. For instance a value would look something like:</p>\n\n<pre><code>condition = [\n    \"and\",\n    [\n        \"contains\",\n        [\"foo\",\"bar\",\"baz\"],\n        \"website\"\n    ]\n</code></pre>\n\n<p>And then, I create my schema for that property to look something like this</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\"condition\": {\n    Type:     schema.TypeList,\n    Required: true,\n    Elem: &amp;schema.Schema{\n        Type: schema.TypeList,\n    },\n},\n</code></pre>\n\n<p>But, when I run my test I get a message that says:</p>\n\n<pre><code>condition.0: should be a list\n</code></pre>\n\n<p>Which, this makes sense because my schema definition declares that every <code>Elem</code> should be a list. Is there a way to define multiple types for the <code>Elem</code>?</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I've changed my <code>condition</code> field from the above to be </p>\n\n<pre><code>\"condition_json\": {\n  Type:     schema.TypeString,\n  Required: true,\n},\n</code></pre>\n\n<p>My <code>.tf</code> file is now using <code>jsonencode()</code> like so:</p>\n\n<pre><code>\nvariable \"condition_list\" {\n    default = [\n        [\"and\"],\n        [\"contains\",[\"path\",\"payload\",\"source\"],\"website\"],\n        [\"contains\",[\"path\",\"headers\",\"from\",\"0\",\"address\"],\"homer\"]\n    ]\n}\nresource \"event_rule\" \"first\" {\n    condition_json = \"${jsonencode(var.condition_list)}\"\n}\n</code></pre>\n\n<p>When I build my struct for my event rule object, the <code>Condition</code> field is getting the value of <code>condition_json</code> like so:</p>\n\n<pre><code>Condition: d.Get(\"condition_json\").([]interface{}),\n</code></pre>\n\n<p>Because my Condition field in the library interfacing with the API looks like:</p>\n\n<pre><code>Condition         []interface{} `json:\"condition,omitempty\"`\n</code></pre>\n\n<p>My problem is that I'm getting an error that </p>\n\n<pre><code>interface {} is string, not []interface {}\n</code></pre>\n\n<p>This message makes sense because I have the schema set to <code>TypeString</code> but, in my struct interfacing with the API I have <code>Condition</code> typed as <code>[]interface{}</code>. My question is, is there a way to cast d.Get(\"condition_json\") to <code>[]interface{}</code> rather than assert?</p>\n\n<p>I'm obviously missing something, and I'm not sure what. :)</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1560581841, "creation_date": 1560581841, "answer_id": 56608112, "question_id": 56607912, "link": "https://stackoverflow.com/questions/56607912/read-a-command-line-flag-from-a-compiled-binary/56608112#56608112", "title": "Read a Command Line Flag from a compiled binary", "body": "<p><a href=\"https://golang.org/pkg/flag/#Parse\" rel=\"nofollow noreferrer\"><code>flag.Parse()</code></a> is a runtime operation.</p>\n\n<p>Reading back an embedded value means said value was embedded at compile time.<br>\nSee <a href=\"https://github.com/AgentZombie/go-embed-version\" rel=\"nofollow noreferrer\"><code>AgentZombie go-embed-version</code></a> as an example:</p>\n\n<pre><code>go build -o /tmp/versserv -ldflags \"-X github.com/AgentZombie/go-embed-version/cmd.Version=foo\" server/server.go\n</code></pre>\n\n<p>Then you can call your binary, which can return the embedded value.<br>\nSame idea in <a href=\"https://github.com/GoogleContainerTools/container-diff/commit/367eb429e9ff7011aeab18bc24803ace643505a3\" rel=\"nofollow noreferrer\"><code>GoogleContainerTools/container-diff</code> commit 367eb42</a> from <a href=\"https://github.com/GoogleContainerTools/container-diff/pull/304\" rel=\"nofollow noreferrer\">PR 304</a>.<br>\nThis is automated (again as an example) in <a href=\"https://github.com/ahmetb/govvv\" rel=\"nofollow noreferrer\"><code>ahmetb/govvv</code></a></p>\n"}], "owner": {"reputation": 459, "user_id": 11568656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa9f2bdc50c1c5869645b74352ac64b2?s=128&d=identicon&r=PG&f=1", "display_name": "O.Man", "link": "https://stackoverflow.com/users/11568656/o-man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1560590743, "creation_date": 1560579826, "last_edit_date": 1560590743, "question_id": 56607912, "link": "https://stackoverflow.com/questions/56607912/read-a-command-line-flag-from-a-compiled-binary", "title": "Read a Command Line Flag from a compiled binary", "body": "<p>I created a simple program where I set 2 flags and build it. How to read these flags and set this 2 values from compiled binary?</p>\n\n<p>I tried to read the file many ways but I did not find the flag value.</p>\n\n<p>flag.go</p>\n\n<pre><code>var (\n    name *string\n    version *int\n)\n\nfunc init(){\n    name = flag.String(\"name\",\"test\", \"a string\")\n    version = flag.Int(\"version\", 1.0, \"an int\")\n}\n\nfunc main(){\n    flag.Parse()\n    fmt.Println(\"name : \", *name)\n    fmt.Println(\"version : \", *version)\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>func main(){\n    path := \"/Users/____/Desktop/flag\"\n\n    dat,_ := ioutil.ReadFile(path)\n\n    strings.Contains(string(dat),\"name\")\n\n    fmt.Println(\"%s opened\\n\", dat)\n}\n</code></pre>\n\n<p>I want to find flag value from compiled binary a store it to main program variable. Something like that</p>\n\n<p>var flagMain = test\nvar versionMain = 1.0</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 1562, "user_id": 4303758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/nbL0i.jpg?s=128&g=1", "display_name": "Manjeet Thakur", "link": "https://stackoverflow.com/users/4303758/manjeet-thakur"}, "edited": false, "score": 0, "creation_date": 1560594198, "post_id": 56607802, "comment_id": 99793965, "body": "i think <code>var webRegisterData request.WebRegisterData</code> should be <code>var webRegisterData WebRegisterData</code>"}], "answers": [{"tags": [], "owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "is_accepted": true, "score": 0, "last_activity_date": 1560745219, "last_edit_date": 1560745219, "creation_date": 1560596361, "answer_id": 56609716, "question_id": 56607802, "link": "https://stackoverflow.com/questions/56607802/in-gin-framework-invalid-character-p-looking-for-beginning-of-value/56609716#56609716", "title": "In Gin framework, invalid character &#39;P&#39; looking for beginning of value", "body": "<p>Your request is of invalid JSON format. </p>\n\n<p>Your request should look like:</p>\n\n<pre><code>{\n    \"username\": \"asdasd\",\n    \"password\": \"asdasdasd\",\n    \"email\": \"123@123.com\"\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10403471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae39ff64e0befb5a2b511614cee14922?s=128&d=identicon&r=PG&f=1", "display_name": "Al Liu", "link": "https://stackoverflow.com/users/10403471/al-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 0, "accepted_answer_id": 56609716, "answer_count": 1, "score": 0, "last_activity_date": 1560745219, "creation_date": 1560578671, "last_edit_date": 1560592836, "question_id": 56607802, "link": "https://stackoverflow.com/questions/56607802/in-gin-framework-invalid-character-p-looking-for-beginning-of-value", "title": "In Gin framework, invalid character &#39;P&#39; looking for beginning of value", "body": "<p>When I use Gin, c.shouldBindJson is not working correctly. I test my REST API in postman and get the error response</p>\n\n<blockquote>\n  <p>Request</p>\n</blockquote>\n\n<pre><code>{\n    Username: \"asdasd\",\n    Password: \"asdasdasd\",\n    Email: \"123@123.com\"\n}\n</code></pre>\n\n<blockquote>\n  <p>Response:\n  Postman gives me the response</p>\n</blockquote>\n\n<pre><code>{\n    \"code\": 400,\n    \"error\": \"invalid character 'U' looking for beginning of value\",\n}\n</code></pre>\n\n<h3>Struct</h3>\n\n<p>Here is the data struct</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type WebRegisterData struct {\n    Username    string              `json:\"username\"`\n    Password    string              `json:\"password\"`\n    Email       string              `json:\"email\"`\n}\n</code></pre>\n\n<h3>Function</h3>\n\n<p>Here is the relevant function</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (h *Handler) WebRegister(c *gin.Context)  {\n    if h.db == nil {\n        c.JSON(http.StatusInternalServerError, gin.H{\n            \"code\": 500,\n            \"error\": nil,\n        })\n        c.Abort()\n        return\n    }\n\n\n    var webRegisterData request.WebRegisterData\n\n    err :=  c.ShouldBindJSON(&amp;webRegisterData)\n    if err != nil {\n        c.JSON(http.StatusBadRequest, gin.H{\n            \"code\": 400,\n            \"error\": err.Error(),\n        })\n        c.Abort()\n        return\n    }\n\n    ...\n}\n</code></pre>\n"}, {"tags": ["go", "lambda"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11159326, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--Nm4zbs5jOs/AAAAAAAAAAI/AAAAAAAAAQQ/-iIaCaznuEA/photo.jpg?sz=128", "display_name": "vignesh S", "link": "https://stackoverflow.com/users/11159326/vignesh-s"}, "edited": false, "score": 0, "creation_date": 1574856021, "post_id": 56622460, "comment_id": 104377488, "body": "There are some alternate ways to do it. We are using SAM Template. it does automatically for us."}], "tags": [], "owner": {"reputation": 108, "user_id": 3226398, "user_type": "registered", "profile_image": "https://graph.facebook.com/825608468/picture?type=large", "display_name": "Nihanth Dara", "link": "https://stackoverflow.com/users/3226398/nihanth-dara"}, "is_accepted": false, "score": 1, "last_activity_date": 1560717517, "creation_date": 1560717517, "answer_id": 56622460, "question_id": 56607738, "link": "https://stackoverflow.com/questions/56607738/cannot-read-json-file-after-uploading-go-package-into-aws-lambda/56622460#56622460", "title": "Cannot read json file after uploading &quot;go&quot; package into AWS Lambda", "body": "<p>I have used your sample code and put in the zip file and also the mappings file that I used to test on AWS lambda. Link to code - <a href=\"https://github.com/nihanthd/stackoverflow/tree/master/lambda\" rel=\"nofollow noreferrer\">https://github.com/nihanthd/stackoverflow/tree/master/lambda</a></p>\n\n<p>Handler name in AWS lambda is <strong><em>trial</em></strong></p>\n\n<p>Test Data to trigger the function using AWS lambda event</p>\n\n<pre><code>{\n    \"name\": \"Vignesh\"\n}\n</code></pre>\n\n<p>Commands used to build the executable and create the zip file</p>\n\n<pre><code>$ GOARCH=amd64 GOOS=linux go build trial.go\n$ zip trial.zip trial mappings.json\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11159326, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--Nm4zbs5jOs/AAAAAAAAAAI/AAAAAAAAAQQ/-iIaCaznuEA/photo.jpg?sz=128", "display_name": "vignesh S", "link": "https://stackoverflow.com/users/11159326/vignesh-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 515, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560717517, "creation_date": 1560577953, "question_id": 56607738, "link": "https://stackoverflow.com/questions/56607738/cannot-read-json-file-after-uploading-go-package-into-aws-lambda", "title": "Cannot read json file after uploading &quot;go&quot; package into AWS Lambda", "body": "<p>I have go lang code to read some json file. It's running fine in local but I created Lambda package and uploaded the package in Lambda. It cannot read the file</p>\n\n<pre><code>\nimport (\n    \"context\"\n    \"fmt\"\n    \"io/ioutil\"\n\n    \"github.com/aws/aws-lambda-go/lambda\"\n)\n\ntype MyEvent struct {\n    Name string `json:\"name\"`\n}\n\nfunc HandleRequest(ctx context.Context, name MyEvent) (string, error) {\n    jsonBytes, err := ioutil.ReadFile(\"mappings.json\")\n    fmt.Println(string(jsonBytes))\n    fmt.Println(err)\n    return fmt.Sprintf(\"Hello %s!\", name.Name), nil\n}\n\nfunc main() {\n    lambda.Start(HandleRequest)\n}\n</code></pre>\n\n<p>How to read the file from AWS Lambda? Any idea on this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1560577697, "post_id": 56607578, "comment_id": 99790970, "body": "The problem is that you are adding a slice and not a string into your table. Why are you not using fmt.Sprintf() instead of the tickerObject at table.Add()?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1560579011, "post_id": 56607578, "comment_id": 99791138, "body": "<a href=\"https://golang.org/pkg/text/tabwriter/\" rel=\"nofollow noreferrer\">golang.org/pkg/text/tabwriter</a>"}, {"owner": {"reputation": 9, "user_id": 4276257, "user_type": "registered", "profile_image": "https://graph.facebook.com/803555122/picture?type=large", "display_name": "Shawn Andrews", "link": "https://stackoverflow.com/users/4276257/shawn-andrews"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1560611627, "post_id": 56607578, "comment_id": 99798052, "body": "@apxp Seems to break even harder when I change it to that -  &quot;panic: strings: negative Repeat count&quot;"}, {"owner": {"reputation": 9, "user_id": 4276257, "user_type": "registered", "profile_image": "https://graph.facebook.com/803555122/picture?type=large", "display_name": "Shawn Andrews", "link": "https://stackoverflow.com/users/4276257/shawn-andrews"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1560613408, "post_id": 56607578, "comment_id": 99798536, "body": "@Peter thank you!  That did the trick....I added in tabwriter and it looks <b>so much better</b>."}], "owner": {"reputation": 9, "user_id": 4276257, "user_type": "registered", "profile_image": "https://graph.facebook.com/803555122/picture?type=large", "display_name": "Shawn Andrews", "link": "https://stackoverflow.com/users/4276257/shawn-andrews"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560614166, "creation_date": 1560575919, "last_edit_date": 1560576273, "question_id": 56607578, "link": "https://stackoverflow.com/questions/56607578/cannot-figure-out-how-to-format-values-for-for-loop-print-outs", "title": "Cannot figure out how to format values for for loop print outs", "body": "<p>I am trying to change the output of a subcommand for a CLI plugin but struggling to get it to work correctly.  Currently it shows an ugly printed list; I want to format it into a nice table that's easier to read.  Without the table, it works fine...just looks ugly.  Adding in the table breaks it by saying \"....used as a value\".</p>\n\n<p>I have tried declaring the line as a string array with no luck.  I'm missing something and not sure what.  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    for {\n            select {\n            case &lt;-ticker.C:\n                stats, _ := ccclient.AppStats(app.Metadata.GUID)\n                table := ui.Table([]string{\"Sample Time\", \"Instance ID\", \"CPU %\", \"Memory (MB)\", \"Disk (MB)\", \"Cell IP:port\"})\n                for key, value := range stats {\n                    tickerObject := []string{time.Now().Format(time.RFC3339), key}\n                    //ui.Say(fmt.Sprintf(\"%s, %s, %s, %s, %s, %s\", time.Now().Format(time.RFC3339), key, fmt.Sprintf(\"%f\", value.Stats.Usage.CPU), fmt.Sprintf(\"%f\", (value.Stats.Usage.Mem/1024/1024)), fmt.Sprintf(\"%f\", (value.Stats.Usage.Disk/1024/1024)), value.Stats.Host+\":\"+strconv.Itoa(value.Stats.Port)))}\n                    table.Add(tickerObject)\n                    table.Print()\n                }\n            case &lt;-quit:\n                ticker.Stop()\n            }\n        }\n</code></pre>\n\n<p>I expect a formatted output that looks cleaner, instead I get -</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>cannot use tickerObject (type []string) as type string in argument to table.Add\n</code></pre>\n\n<hr>\n\n<p>Current output (using the commented out ui.Say line), does not line up:</p>\n\n<blockquote>\n  <p>Collecting stats on app fabric-tasks in space Functions Dev Testing\n  Ctrl-C to stop collection of stats</p>\n  \n  <p>Sample Time,instance #,cpu %,memory (MB),disk (MB),cell ip:port\n  2019-06-14T23:33:42-05:00, 0, 0.004659, 38.492188, 205.914062,\n  169.61.179.187:61440 2019-06-14T23:33:47-05:00, 0, 0.004659, 38.492188, 205.914062, 169.61.179.187:61440 2019-06-14T23:33:52-05:00, 0, 0.004659, 38.492188, 205.914062, 169.61.179.187:61440\n  2019-06-14T23:33:57-05:00, 0, 0.006533, 38.492188, 205.914062,\n  169.61.179.187:61440</p>\n</blockquote>\n\n<p>I don't <em>think</em> the table is the issue, I think I'm just missing something ridiculously simple with how the data is being stored.  I think the table can only pull display a string (or at least all the examples of I have found in our internal documentation only call strings).</p>\n"}, {"tags": ["go", "google-cloud-platform"], "answers": [{"comments": [{"owner": {"reputation": 886, "user_id": 939963, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/05d2c4c6364775f365fecf75e61b3228?s=128&d=identicon&r=PG", "display_name": "thisguy123", "link": "https://stackoverflow.com/users/939963/thisguy123"}, "edited": false, "score": 0, "creation_date": 1561529138, "post_id": 56614359, "comment_id": 100088412, "body": "Any chance you could expand on why it must be called this way? I&#39;m reading about context and having a little trouble...  It seems to me I have already passed in context in this line.. <code>computeService, err := compute.NewService(ctx)</code>  Why do I need to again pass it to the <code>stopTaggedMachines</code> function and then to the <code>Context()</code> function?"}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "reply_to_user": {"reputation": 886, "user_id": 939963, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/05d2c4c6364775f365fecf75e61b3228?s=128&d=identicon&r=PG", "display_name": "thisguy123", "link": "https://stackoverflow.com/users/939963/thisguy123"}, "edited": false, "score": 1, "creation_date": 1561531587, "post_id": 56614359, "comment_id": 100089466, "body": "To answer your question, please create another question. The answer is too detailed to put into a comment. This will also make a good question for Google Cloud Go developers."}, {"owner": {"reputation": 886, "user_id": 939963, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/05d2c4c6364775f365fecf75e61b3228?s=128&d=identicon&r=PG", "display_name": "thisguy123", "link": "https://stackoverflow.com/users/939963/thisguy123"}, "edited": false, "score": 0, "creation_date": 1561532229, "post_id": 56614359, "comment_id": 100089768, "body": "Follow up question here -&gt; <a href=\"https://stackoverflow.com/questions/56766872/what-is-the-proper-style-and-usage-of-golang-context\" title=\"what is the proper style and usage of golang context\">stackoverflow.com/questions/56766872/&hellip;</a>  Thanks!"}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "reply_to_user": {"reputation": 886, "user_id": 939963, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/05d2c4c6364775f365fecf75e61b3228?s=128&d=identicon&r=PG", "display_name": "thisguy123", "link": "https://stackoverflow.com/users/939963/thisguy123"}, "edited": false, "score": 0, "creation_date": 1561534919, "post_id": 56614359, "comment_id": 100091148, "body": "@thisguy123 - I posted an answer. I do not understand why your question was downvoted. Maybe question snobbery and that is a shame."}], "tags": [], "owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "is_accepted": true, "score": 1, "last_activity_date": 1560634711, "creation_date": 1560634711, "answer_id": 56614359, "question_id": 56605887, "link": "https://stackoverflow.com/questions/56605887/unable-to-stop-a-gcp-instance-with-golang/56614359#56614359", "title": "Unable to stop a GCP instance with golang", "body": "<p>Change this line of code:</p>\n\n<pre><code>result := svc.Instances.Stop(project, zone, v.Name)\n</code></pre>\n\n<p>To:</p>\n\n<pre><code>result, err := svc.Instances.Stop(project, zone, v.Name).Context(ctx).Do()\n</code></pre>\n"}], "owner": {"reputation": 886, "user_id": 939963, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/05d2c4c6364775f365fecf75e61b3228?s=128&d=identicon&r=PG", "display_name": "thisguy123", "link": "https://stackoverflow.com/users/939963/thisguy123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 1, "accepted_answer_id": 56614359, "answer_count": 1, "score": 1, "last_activity_date": 1561529281, "creation_date": 1560552205, "last_edit_date": 1561529281, "question_id": 56605887, "link": "https://stackoverflow.com/questions/56605887/unable-to-stop-a-gcp-instance-with-golang", "title": "Unable to stop a GCP instance with golang", "body": "<p>I'm trying to learn golang, and decided to build a simple app to stop instances in my gcloud project. Relevant snippets below.</p>\n\n<pre><code>func stopTaggedMachines(svc *compute.Service, project, zone, tag string) ([]string, error) {\n    //result := computeService.Instances.List(\"my-project\", \"us-west1-b\")\n    var instances []string\n    f := func(page *compute.InstanceList) error {\n        for _, v := range page.Items {\n            if v.Labels[\"gcp-idler-managed\"] == \"true\" {\n                result := svc.Instances.Stop(project, zone, v.Name)\n                fmt.Printf(\"[INFO] gcp-machine-idler: Instance in state %v, Stopping %v... Result - %v\\n\", v.Status, v.Name, result)\n                instances.append(result)\n            }\n        }\n        return nil\n    }\n\n    call := svc.Instances.List(\"my-project\", \"us-west1-b\")\n    if err := call.Pages(oauth2.NoContext, f); err != nil {\n        return instances, nil\n    }\n    return instances, nil\n}\n\nfunc main() {\n    // Use oauth2.NoContext if there isn't a good context to pass in.\n    ctx := context.Background()\n\n    computeService, err := compute.NewService(ctx)\n    if err != nil {\n        log.Fatal(err)\n    }\n    stopTaggedMachines(computeService, \"my-project\", \"us-west1-b\", \"gcp-idler-managed\")\n    return\n}\n</code></pre>\n\n<p>When I run with <code>go run main.go</code> I get output that the machine was found in state running (so I know I've reached the stop line). However, the machine is never stopped. I'm a bit confused as to what could be going wrong here, or (more importantly) how to find resources that could help me.</p>\n\n<p>Is there some logical flaw in my code? How would a more experienced go developer find more information on this method and it's usage? Docs seem pretty sparse from what I can find.</p>\n\n<hr>\n\n<p><em>Answered</em>: Updated code Snippets...</p>\n\n<p>Call <code>stopTaggedMachines</code> like this</p>\n\n<pre><code>stopTaggedMachines(ctx, computeService, \"my-project\", \"us-west1-b\", \"gcp-idler-managed\")\n</code></pre>\n\n<p>Call <code>Stop</code> like this</p>\n\n<pre><code>result, err := svc.Instances.Stop(project, zone, v.Name).Context(ctx).Do()\n</code></pre>\n"}, {"tags": ["firebase", "go", "firebase-admin"], "answers": [{"tags": [], "owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "is_accepted": true, "score": 4, "last_activity_date": 1560647932, "creation_date": 1560647932, "answer_id": 56615374, "question_id": 56605884, "link": "https://stackoverflow.com/questions/56605884/initialize-firebase-admin-sdk-with-only-environment-variables-in-golang/56615374#56615374", "title": "Initialize Firebase Admin SDK with only environment variables in Golang", "body": "<p>try:</p>\n\n<pre><code>export JSON_CREDS=\"{\\\"type\\\":\\\"service_account\\\",\\\"project_id\\\":\\\"project-id\\\",\\\"private_key_id\\\":\\\"some_number\\\",\\\"private_key\\\":\\\"\\\",\\\"client_email\\\":\\\"&lt;api-name&gt;api@project-id.iam.gserviceaccount.com\\\",\\\"client_id\\\":\\\"...\\\",\\\"auth_uri\\\":\\\"https:\\/\\/accounts.google.com\\/o\\/oauth2\\/auth\\\",\\\"token_uri\\\":\\\"https:\\/\\/accounts.google.com\\/o\\/oauth2\\/token\\\",\\\"auth_provider_x509_cert_url\\\":\\\"https:\\/\\/www.googleapis.com\\/oauth2\\/v1\\/certs\\\",\\\"client_x509_cert_url\\\":\\\"https:\\/\\/www.googleapis.com\\/...&lt;api-name&gt;api%40project-id.iam.gserviceaccount.com\\\"}\"\n\n...\n\nimport \"google.golang.org/api/option\"\n\n...\n\napp, err := firebase.NewApp(context.Background(), nil, option.WithCredentialsJSON([]byte(os.Getenv(\"JSON_CREDS\"))))\n</code></pre>\n"}], "owner": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 546, "favorite_count": 1, "accepted_answer_id": 56615374, "answer_count": 1, "score": 1, "last_activity_date": 1560647932, "creation_date": 1560552173, "question_id": 56605884, "link": "https://stackoverflow.com/questions/56605884/initialize-firebase-admin-sdk-with-only-environment-variables-in-golang", "title": "Initialize Firebase Admin SDK with only environment variables in Golang", "body": "<p>I'm trying to <a href=\"https://firebase.google.com/docs/admin/setup/\" rel=\"nofollow noreferrer\">initialize the Firebase Admin SDK</a>, in go, using only environment variables (no access to a filesystem).</p>\n\n<p>I have the <code>service-account-file.json</code> file, and can get it working locally via:</p>\n\n<pre><code>export GOOGLE_APPLICATION_CREDENTIALS=\"/path/to/service-account-file.json\"\n\n...\n\nmyfile.go:\napp, err := firebase.NewApp(context.Background(), nil)\n</code></pre>\n\n<p>However, I'd like to put the contents of <code>service-account-file.json</code> into an env var, and init the firebase Admin SDK with its value.</p>\n\n<p>There is an <a href=\"https://github.com/googleapis/google-api-go-client/issues/185\" rel=\"nofollow noreferrer\">open issue</a> that claims you can do it via <a href=\"https://godoc.org/golang.org/x/oauth2/google#CredentialsFromJSON\" rel=\"nofollow noreferrer\">CredentialsFromJSON</a>, however I can't quite figure it out.</p>\n\n<p>Does anyone have this working? If so can you please provide an example?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 2, "creation_date": 1560552739, "post_id": 56605810, "comment_id": 99788005, "body": "<a href=\"https://golang.org/ref/spec#Integer_literals\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Integer_literals</a> is an exhaustive list of integer literal expressions that are allowed. You might be able to come up with a convention using bit-shifts, bitwise-or, and/or the <code>iota</code> keyword to express these sorts of values."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1560565318, "post_id": 56605810, "comment_id": 99789571, "body": "Go is adding binary literals using the <code>0b</code> notation in <a href=\"https://tip.golang.org/ref/spec#Integer_literals\" rel=\"nofollow noreferrer\">Go 1.13</a>."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 8, "last_activity_date": 1560566204, "last_edit_date": 1560566204, "creation_date": 1560565349, "answer_id": 56606882, "question_id": 56605810, "link": "https://stackoverflow.com/questions/56605810/how-to-define-bit-literals-in-go/56606882#56606882", "title": "How to define bit literals in Go?", "body": "<blockquote>\n  <p>The Go Programming Language Specification<br>\n   Version of May 14, 2019</p>\n  \n  <p>Integer literals</p>\n  \n  <p>An integer literal is a sequence of digits representing an integer\n  constant. An optional prefix sets a non-decimal base: 0b or 0B for\n  binary, 0, 0o, or 0O for octal, and 0x or 0X for hexadecimal. A single\n  0 is considered a decimal zero. In hexadecimal literals, letters a\n  through f and A through F represent values 10 through 15.</p>\n  \n  <p>For readability, an underscore character _ may appear after a base\n  prefix or between successive digits; such underscores do not change\n  the literal's value.</p>\n\n<pre><code>int_lit        = decimal_lit | binary_lit | octal_lit | hex_lit .\ndecimal_lit    = \"0\" | ( \"1\" \u2026 \"9\" ) [ [ \"_\" ] decimal_digits ] .\nbinary_lit     = \"0\" ( \"b\" | \"B\" ) [ \"_\" ] binary_digits .\noctal_lit      = \"0\" [ \"o\" | \"O\" ] [ \"_\" ] octal_digits .\nhex_lit        = \"0\" ( \"x\" | \"X\" ) [ \"_\" ] hex_digits .\n\ndecimal_digits = decimal_digit { [ \"_\" ] decimal_digit } .\nbinary_digits  = binary_digit { [ \"_\" ] binary_digit } .\noctal_digits   = octal_digit { [ \"_\" ] octal_digit } .\nhex_digits     = hex_digit { [ \"_\" ] hex_digit } .\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>For Go 1.13 and later, use binary or hexadecimal:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    b := byte(0b00010011)\n    fmt.Printf(\"%08b %02x\\n\", b, b)\n    x := byte(0x13)\n    fmt.Printf(\"%08b %02x\\n\", x, x)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>00010011 13\n00010011 13\n</code></pre>\n\n<hr>\n\n<p>For Go 1.12 and earlier, use hexadecimal:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    x := byte(0x13)\n    fmt.Printf(\"%08b %02x\\n\", x, x)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>00010011 13\n</code></pre>\n"}], "owner": {"reputation": 772, "user_id": 8708710, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/440c96fe2dc212e8d498d0166799e951?s=128&d=identicon&r=PG", "display_name": "Lakindu Akash", "link": "https://stackoverflow.com/users/8708710/lakindu-akash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4543, "favorite_count": 2, "accepted_answer_id": 56606882, "answer_count": 1, "score": 0, "last_activity_date": 1561309687, "creation_date": 1560551386, "last_edit_date": 1560800795, "question_id": 56605810, "link": "https://stackoverflow.com/questions/56605810/how-to-define-bit-literals-in-go", "title": "How to define bit literals in Go?", "body": "<p>Is there any way to define bit literals like <code>var i=0b0001111</code> in Golang (<strong>1.12v</strong>)  as in C and some other languages?</p>\n"}, {"tags": ["docker", "go", "dockerfile"], "answers": [{"comments": [{"owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 0, "creation_date": 1560816474, "post_id": 56625171, "comment_id": 99851315, "body": "How were you able to verify they built concurrently?"}, {"owner": {"reputation": 108, "user_id": 3226398, "user_type": "registered", "profile_image": "https://graph.facebook.com/825608468/picture?type=large", "display_name": "Nihanth Dara", "link": "https://stackoverflow.com/users/3226398/nihanth-dara"}, "reply_to_user": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 0, "creation_date": 1560894772, "post_id": 56625171, "comment_id": 99884919, "body": "By checking the timestamps at which the images were created in the docker-machine. You can ssh into the docker machine and then do <code>docker image ls -a | grep dev</code>, as well as the <a href=\"https://github.com/nihanthd/stackoverflow/blob/master/docker/build.go#L43\" rel=\"nofollow noreferrer\">log line</a> in the code I shared should print out the timestamp at which the container was created."}], "tags": [], "owner": {"reputation": 108, "user_id": 3226398, "user_type": "registered", "profile_image": "https://graph.facebook.com/825608468/picture?type=large", "display_name": "Nihanth Dara", "link": "https://stackoverflow.com/users/3226398/nihanth-dara"}, "is_accepted": true, "score": 1, "last_activity_date": 1560749228, "creation_date": 1560749228, "answer_id": 56625171, "question_id": 56605679, "link": "https://stackoverflow.com/questions/56605679/build-docker-images-in-parallel-using-docker-go-client/56625171#56625171", "title": "Build docker images in parallel using docker Go client", "body": "<p>If I understand your question correctly, you have a docker-machine on which you want to build the images concurrently using your GO program.</p>\n\n<p>I tried to do the same thing with Dockerfiles which have the same image being built, and per my understanding, all of them were build concurrently.</p>\n\n<p>Here is the go package that I used to replicate the scenario - <a href=\"https://github.com/nihanthd/stackoverflow/tree/master/docker\" rel=\"nofollow noreferrer\">https://github.com/nihanthd/stackoverflow/tree/master/docker</a></p>\n\n<p>Now in your case if you were using 3 different docker files, then certainly they would have different build times, that means the output would be seem to be deterministic</p>\n"}], "owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 56625171, "answer_count": 1, "score": 1, "last_activity_date": 1560749228, "creation_date": 1560550095, "last_edit_date": 1560596386, "question_id": 56605679, "link": "https://stackoverflow.com/questions/56605679/build-docker-images-in-parallel-using-docker-go-client", "title": "Build docker images in parallel using docker Go client", "body": "<p>I'm using Docker's Go client to build my projects. This <a href=\"https://stackoverflow.com/questions/38804313/build-docker-image-from-go-code\">post</a> highlights how to do that with the Go client. I'm calling <code>ImageBuild</code> on three of my Dockerfiles (<code>1.Dockerfile</code>, <code>2.Dockerfile</code>, and <code>3.Dockerfile</code>) as a test. Here is my code:</p>\n\n<pre><code>func GetContext(filePath string) io.Reader {\n    // Use homedir.Expand to resolve paths like '~/repos/myrepo'\n    filePath, _ = homedir.Expand(filePath)\n    ctx, err := archive.TarWithOptions(filePath, &amp;archive.TarOptions{})\n    if err != nil {\n        panic(err)\n    }\n\n    return ctx\n}\n\nfunc testImageBuild() {\n    ctx := context.Background()\n    cli, err := client.NewEnvClient()\n    if err != nil {\n        log.Fatal(err, \" :unable to init client\")\n    }\n\n    var wg sync.WaitGroup\n    for i := 0; i &lt; 3; i++ {\n        wg.Add(1)\n        go func(i int) {\n            defer wg.Done()\n            dockerFile := fmt.Sprintf(\"%d.Dockerfile\", i)\n            imageBuildResponse, err := cli.ImageBuild(\n                ctx,\n                GetContext(\".\"),\n                types.ImageBuildOptions{\n                    Dockerfile: dockerFile,\n                    Tags:       []string{fmt.Sprintf(\"devbuild_%d\", i)},\n                })\n            if err != nil {\n                log.Fatal(err, \" :unable to build docker image\"+string(1))\n            }\n            defer imageBuildResponse.Body.Close()\n            _, err = io.Copy(os.Stdout, imageBuildResponse.Body)\n            if err != nil {\n                log.Fatal(err, \" :unable to read image build response \"+string(1))\n            }\n        }(i)\n    }\n    wg.Wait()\n}\n\nfunc main() {\n    testImageBuild()\n}\n</code></pre>\n\n<p><code>GetContext</code> is used to tar the directory path as a context for Docker. <code>testImageBuild</code> spins off three different goroutines to build the three different images.</p>\n\n<p>My question is: When I run this, the output to stdout is always the same and seems deterministic, which makes me think that the images aren't actually been built in parallel. I'm not familiar with how docker build its images, and it seems entirely possible that this approach is simply sending requests to docker server in parallel rather than actually building in parallel. Is this true? If so, how can I build my projects in parallel?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1560553222, "post_id": 56605288, "comment_id": 99788108, "body": "It would be helpful to know whether the problem is with your DB connection/connectivity or with the <code>gorm</code> package. Is the machine this code runs on able to connect to the database with these credentials via another client like <code>psql</code>? What about a Go program that uses <code>database&#47;sql</code> instead of <code>gorm</code>?"}, {"owner": {"reputation": 179, "user_id": 4718921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58c07e4f74942d3e358b307d23a057e3?s=128&d=identicon&r=PG&f=1", "display_name": "Muhamed Keta", "link": "https://stackoverflow.com/users/4718921/muhamed-keta"}, "edited": false, "score": 2, "creation_date": 1560592774, "post_id": 56605288, "comment_id": 99793704, "body": "<b>Advice:</b> Switch up the code to print/log.fatal the err from the gorm.Open(). It should give the error. It is there for a reason. You can see what the error is and search up from there."}], "answers": [{"tags": [], "owner": {"reputation": 481, "user_id": 9886915, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-l-tB0NPctcM/AAAAAAAAAAI/AAAAAAAAABc/trmX55bBtM0/photo.jpg?sz=128", "display_name": "clearloop", "link": "https://stackoverflow.com/users/9886915/clearloop"}, "is_accepted": false, "score": 0, "last_activity_date": 1568500822, "creation_date": 1568500822, "answer_id": 57939798, "question_id": 56605288, "link": "https://stackoverflow.com/questions/56605288/gorm-cant-connect-to-local-postgres-db/57939798#57939798", "title": "Gorm can&#39;t connect to local postgres db", "body": "<p>If you're sure about psql server is running, try to modify <code>pg_hba.conf</code>, locates at <code>/etc/postgresql/${version}/main/pg_hba.conf</code> usually:</p>\n\n<pre><code># TYPE  DATABASE        USER            ADDRESS                 METHOD  \nlocal   all             all                                     trust\n</code></pre>\n"}], "migrated_from": {"other_site": {"markdown_extensions": ["Prettify"], "launch_date": 1250553600, "open_beta_date": 1247529600, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon@2.png", "twitter_account": "super_user", "favicon_url": "https://cdn.sstatic.net/Sites/superuser/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon.png", "audience": "computer enthusiasts and power users", "site_url": "https://superuser.com", "api_site_parameter": "superuser", "logo_url": "https://cdn.sstatic.net/Sites/superuser/Img/logo.png", "name": "Super User", "site_type": "main_site"}, "on_date": 1560547426, "question_id": 1448909}, "owner": {"reputation": 1, "user_id": 11649807, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LxPwiCyiQmY/AAAAAAAAAAI/AAAAAAAAAAg/-tq-v-lpsRA/photo.jpg?sz=128", "display_name": "battulga tsogtgerel", "link": "https://stackoverflow.com/users/11649807/battulga-tsogtgerel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 594, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568500822, "creation_date": 1560543186, "question_id": 56605288, "link": "https://stackoverflow.com/questions/56605288/gorm-cant-connect-to-local-postgres-db", "title": "Gorm can&#39;t connect to local postgres db", "body": "<p>I'm new to GoLang and I`ve an issue with connecting my Go webserver with Postgres Database. \nCan someone tell me what I'm doing wrong here? \nAll these credentials are correct btw. User exists, Password is correct, DB exists and belongs to the user.</p>\n\n<pre><code>package app\n\nimport (\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\nfunc connectDB(){\n    db, err := gorm.Open(\"postgres\", \"host=localhost port=5432 user=power_user dbname=local_db password=power_user\")\n    if err != nil {\n        log.Fatal(\"DB Connection failed\")\n    }   \n}\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "mocking", "deferred"], "comments": [{"owner": {"reputation": 387, "user_id": 7447711, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/06fc8aa94e57d803061286afdcd0f309?s=128&d=identicon&r=PG&f=1", "display_name": "Mikael", "link": "https://stackoverflow.com/users/7447711/mikael"}, "edited": false, "score": 4, "creation_date": 1560540853, "post_id": 56604150, "comment_id": 99784576, "body": "In what circumstances would <code>defer stmt.Close()</code> not be called?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1560540925, "post_id": 56604150, "comment_id": 99784607, "body": "The only time a defer isn&#39;t going to be called is if the program exits, and you can&#39;t test anything in that case."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1560541378, "post_id": 56604150, "comment_id": 99784783, "body": "You&#39;re using a mock database, it should be able to detect if the statement was closed, right?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1560547186, "post_id": 56604150, "comment_id": 99786662, "body": "Why would you test this? Such a test is only testing the go runtime, and if you don&#39;t trust that, I&#39;d say there are bigger problems to deal with."}], "answers": [{"tags": [], "owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "is_accepted": false, "score": 1, "last_activity_date": 1560555295, "creation_date": 1560555295, "answer_id": 56606179, "question_id": 56604150, "link": "https://stackoverflow.com/questions/56604150/how-test-if-defer-is-called-or-not/56606179#56606179", "title": "How test if defer is called or not", "body": "<p>It looks like you are making use of data-dog's <a href=\"https://godoc.org/github.com/DATA-DOG/go-sqlmock\" rel=\"nofollow noreferrer\">sqlmock</a> package, so you ought to be able to use <a href=\"https://godoc.org/github.com/DATA-DOG/go-sqlmock#Sqlmock\" rel=\"nofollow noreferrer\"><code>ExpectClose()</code></a> to register the expectation that the database will be closed, and <code>ExpectationsWereMet()</code> to collect this information.</p>\n\n<p>If you're using some other package, feel free to link it; there's probably something similar available, and worst-case you can write your own wrapper around their wrapper. Making sure that a particular method of a particular dependency was called is a fairly common desire when developers write tests using mocks, so most of the better mock packages will go out of their way to provide some sort of API to check that.</p>\n\n<p>As noted in the comments on this question, tests of this nature are often of somewhat questionable value and can seem like they exist more to increase a dubious metric like % code coverage than to increase code reliability or maintainability.</p>\n"}], "owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1560555295, "creation_date": 1560540627, "question_id": 56604150, "link": "https://stackoverflow.com/questions/56604150/how-test-if-defer-is-called-or-not", "title": "How test if defer is called or not", "body": "<p>I have following code</p>\n\n<pre><code>func (s *MyRepo) InsertOrder(ctx context.Context, orderID string) error {\n    query := `INSERT INTO orders (orderID) VALUES (?)`\n\n    stmt, err := s.db.RawDatabase().PrepareContext(ctx, query)\n    if err != nil {\n        return err\n    }\n    defer stmt.Close()\n\n    _, err = stmt.ExecContext(ctx, orderID)\n    if err != nil {\n        //log err\n    }\n    return err\n}\n</code></pre>\n\n<p>And the corresponding test case is</p>\n\n<pre><code>func TestMyRepo_InsertOrder_Success(t *testing.T) {\n    orderID := \"orderID\"\n    mockDB, repo := getDBStore()\n    query := `[INSERT INTO orders (orderID) VALUES (?)]`\n    mockDB.ExpectPrepare(query).\n        ExpectExec().\n        WithArgs(orderID).\n        WillReturnResult(sqlmock.NewResult(1, 1)).\n        WillReturnError(nil)\n\n    err := repo.InsertOrder(context.Background(), orderID)\n    assert.Nil(t, err)\n}\n</code></pre>\n\n<p>But this doesn't test if <code>defer stmt.Close()</code> has been called or not (which gets called once the function ends). How can I test this? </p>\n"}]