[{"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": true, "score": 1, "last_activity_date": 1541634221, "last_edit_date": 1541634221, "creation_date": 1541633910, "answer_id": 53199543, "question_id": 53199322, "link": "https://stackoverflow.com/questions/53199322/how-to-make-a-post-request-to-urlscanio-using-go/53199543#53199543", "title": "How to make a post request to urlscanio using Go?", "body": "<p><code>url.Value</code> is a <code>map[string][]string</code> containing values used in query parameters or <code>POST</code> form. You would need it if you were trying to do something like:</p>\n\n<pre><code>curl -X GET https://urlscan.io/api/v1/scan?url=&lt;urltoscan&gt;\n</code></pre>\n\n<p>or </p>\n\n<pre><code>curl -X POST -F 'url=&lt;urltoscan&gt;' https://urlscan.io/api/v1/scan\n</code></pre>\n\n<p>See documentation <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/url/#Values</a>.</p>\n\n<p>To send a regular POST request with JSON data, you can encode the JSON as bytes and send with <code>http.Post</code>:</p>\n\n<pre><code>var payload = []byte(`{\"url\":\"&lt;your-url&gt;\",\"public\":\"on\"}`)\nreq, err := http.NewRequest(\"POST\", url, \nbytes.NewBuffer(payload))\nreq.Header.Set(\"API-Key\", authtoken)\nreq.Header.Set(\"Content-Type\", \"application/json\")\n\nclient := &amp;http.Client{}\nresp, err := client.Do(req)\nif err != nil {\n        panic(err)\n}\ndefer resp.Body.Close()\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 9825979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2463398de4c8409be4a16fba6f84700?s=128&d=identicon&r=PG&f=1", "display_name": "ReverendRonja", "link": "https://stackoverflow.com/users/9825979/reverendronja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 53199543, "answer_count": 1, "score": 1, "last_activity_date": 1541634221, "creation_date": 1541632400, "question_id": 53199322, "link": "https://stackoverflow.com/questions/53199322/how-to-make-a-post-request-to-urlscanio-using-go", "title": "How to make a post request to urlscanio using Go?", "body": "<p>What I'm doing is trying to submit a URL to scan to urlscan.io. I can do a search but have issues with submissions, particularly correctly sending the right headers/encoded data. </p>\n\n<p>from their site on how to submit a url: </p>\n\n<p>curl -X POST \"<a href=\"https://urlscan.io/api/v1/scan/\" rel=\"nofollow noreferrer\">https://urlscan.io/api/v1/scan/</a>\" \\\n      -H \"Content-Type: application/json\" \\\n      -H \"API-Key: $apikey\" \\\n      -d \"{\\\"url\\\": \\\"$url\\\", \\\"public\\\": \\\"on\\\"}\"</p>\n\n<p>This works to satisfy the Api key header requirement but </p>\n\n<pre><code>req.Header.Add(\"API-Key\", authtoken)\n</code></pre>\n\n<p>This is my attempt that fails</p>\n\n<pre><code>data := make(url.Values)\ndata.Add(\"url\", myurltoscan)\n</code></pre>\n\n<p>The URL property I have struggled with tremendously.</p>\n\n<p>This is my error:\n\"message\": \"Missing URL properties\",\n  \"description\": \"The URL supplied was not OK, please specify it including the protocol, host and path (e.g. <a href=\"http://example.com/bar\" rel=\"nofollow noreferrer\">http://example.com/bar</a>)\",\n  \"status\": 400</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3", "amazon-sqs", "amazon-sns"], "comments": [{"owner": {"reputation": 10420, "user_id": 299462, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/1239668b80debd03fef129775ff3f065?s=128&d=identicon&r=PG", "display_name": "Kannaiyan", "link": "https://stackoverflow.com/users/299462/kannaiyan"}, "edited": false, "score": 2, "creation_date": 1541630960, "post_id": 53199003, "comment_id": 93286706, "body": "S3 can publish events to SNS when an object gets created with just configuration and no coding. Where is your problem?"}, {"owner": {"reputation": 3334, "user_id": 1772245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b75ac639ad884c9dd27942d985ace8ee?s=128&d=identicon&r=PG", "display_name": "mostafazh", "link": "https://stackoverflow.com/users/1772245/mostafazh"}, "edited": false, "score": 0, "creation_date": 1590444872, "post_id": 53199003, "comment_id": 109677170, "body": "if my answer has worked for you, please mark it as the &quot;correct answer&quot;  i.stack.imgur.com/QpogP.png"}], "answers": [{"comments": [{"owner": {"reputation": 780, "user_id": 5261088, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8256e8a248d8bcde285d3b97f77e36b0?s=128&d=identicon&r=PG&f=1", "display_name": "MickeyThreeSheds", "link": "https://stackoverflow.com/users/5261088/mickeythreesheds"}, "edited": false, "score": 0, "creation_date": 1541643420, "post_id": 53199190, "comment_id": 93289853, "body": "Ok! Thanks! But I have one more question! SubscribeURL? I&#39;ve never seen that before, I am SURE I used ARNs for subscribing before, no?"}, {"owner": {"reputation": 3334, "user_id": 1772245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b75ac639ad884c9dd27942d985ace8ee?s=128&d=identicon&r=PG", "display_name": "mostafazh", "link": "https://stackoverflow.com/users/1772245/mostafazh"}, "reply_to_user": {"reputation": 780, "user_id": 5261088, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8256e8a248d8bcde285d3b97f77e36b0?s=128&d=identicon&r=PG&f=1", "display_name": "MickeyThreeSheds", "link": "https://stackoverflow.com/users/5261088/mickeythreesheds"}, "edited": false, "score": 0, "creation_date": 1541662411, "post_id": 53199190, "comment_id": 93294502, "body": "The SubscribeURL is sent to you in the body during the &quot;confirmation&quot; step. All what you need to do is make a GET request to that URL and you will start receiving messages from SNS as soon as they sent from S3."}], "tags": [], "owner": {"reputation": 3334, "user_id": 1772245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b75ac639ad884c9dd27942d985ace8ee?s=128&d=identicon&r=PG", "display_name": "mostafazh", "link": "https://stackoverflow.com/users/1772245/mostafazh"}, "is_accepted": false, "score": 3, "last_activity_date": 1541632000, "last_edit_date": 1541632000, "creation_date": 1541631537, "answer_id": 53199190, "question_id": 53199003, "link": "https://stackoverflow.com/questions/53199003/subscribe-to-an-sns-topic-and-or-sqs-queue-in-golang/53199190#53199190", "title": "Subscribe to an SNS topic and / or SQS queue in golang?", "body": "<p>To use SNS you will need a simple HTTP/HTTPS endpoint to receive SNS notifications. Which is divided into two parts (Confirm the subscription and Processing messages from HTTP/HTTPS endpoint)</p>\n\n<p><strong>1. Confirm the subscription</strong>\nDo something as simple as this:</p>\n\n<pre><code>func confirmSubscription(subcribeURL string) {\n    response, err := http.Get(subcribeURL)\n    if err != nil {\n        fmt.Printf(\"Unbale to confirm subscriptions\")\n    } else {\n        fmt.Printf(\"Subscription Confirmed sucessfully. %d\", response.StatusCode)\n    }\n}\n</code></pre>\n\n<p><strong>2. Processing messages from HTTP/HTTPS endpoint</strong></p>\n\n<p>Parse the request's body, the <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/dev/notification-content-structure.html\" rel=\"nofollow noreferrer\">documentations</a> mentions how the body should be structured. </p>\n\n<p><strong>Sources:</strong></p>\n\n<p><a href=\"https://docs.aws.amazon.com/sns/latest/dg/sns-http-https-endpoint-as-subscriber.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sns/latest/dg/sns-http-https-endpoint-as-subscriber.html</a></p>\n\n<p><a href=\"https://github.com/viveksyngh/aws-sns-subscriber/blob/master/subscriber/subscriber.go\" rel=\"nofollow noreferrer\">https://github.com/viveksyngh/aws-sns-subscriber/blob/master/subscriber/subscriber.go</a> </p>\n"}], "owner": {"reputation": 780, "user_id": 5261088, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8256e8a248d8bcde285d3b97f77e36b0?s=128&d=identicon&r=PG&f=1", "display_name": "MickeyThreeSheds", "link": "https://stackoverflow.com/users/5261088/mickeythreesheds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1957, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1541632000, "creation_date": 1541630468, "question_id": 53199003, "link": "https://stackoverflow.com/questions/53199003/subscribe-to-an-sns-topic-and-or-sqs-queue-in-golang", "title": "Subscribe to an SNS topic and / or SQS queue in golang?", "body": "<p>I know how to do this in java, but I just can't figure it out in Go at all.</p>\n\n<p>All I want to do, is have a way to detect that an item got created in an S3 bucket, then have that trigger an SNS topic, which then notifies me of the file location in S3.</p>\n\n<p>Has anybody got a working example of how I can do the go side of this for subscribing to the SNS topic or the SNS queue if I need one? Because all I seem to be able to find is Java and Node. I can find publish examples for go, but they are of little use to my use case.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1541629681, "post_id": 53198800, "comment_id": 93286227, "body": "The code you posted does not result in the error you get. For proof, see: <a href=\"https://play.golang.org/p/oYB3JnfYHZ4\" rel=\"nofollow noreferrer\">Go Playground</a>. Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 8, "creation_date": 1541629824, "post_id": 53198800, "comment_id": 93286281, "body": "Most likely you have a <code>result</code> variable outside of the <code>for</code> loop, and since you use  short variable declaration, that shadows the outer <code>result</code>, and most likely the outer <code>result</code> is the one that is never used, like in this example: <a href=\"https://play.golang.org/p/_SejIKP8Nzc\" rel=\"nofollow noreferrer\">Go Playground</a>."}, {"owner": {"reputation": 3357, "user_id": 64968, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5c4fe5cc84e9620e3dfdd4cdffc59a56?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/64968/chris"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541635112, "post_id": 53198800, "comment_id": 93287892, "body": "Thanks @icza, that was it exactly. I didn&#39;t clock how variable declaration was working in go and it was the variable declared outside the scope that was causing the problem. Thanks!"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 4, "creation_date": 1541636192, "post_id": 53198800, "comment_id": 93288116, "body": "<code>go vet</code> will catch this sort of problem."}, {"owner": {"reputation": 3357, "user_id": 64968, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5c4fe5cc84e9620e3dfdd4cdffc59a56?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/64968/chris"}, "edited": false, "score": 0, "creation_date": 1541644100, "post_id": 53198800, "comment_id": 93289980, "body": "That&#39;s an awesome tip, thanks Michael"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1541661410, "post_id": 53198800, "comment_id": 93294136, "body": "Don&#39;t use a JSON document as a format string. That&#39;s going to bite you sooner or later. Use <code>fmt.Fprint</code> (no f), or simply <code>w.Write(result)</code> instead."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1541662926, "creation_date": 1541662926, "answer_id": 53203262, "question_id": 53198800, "link": "https://stackoverflow.com/questions/53198800/why-does-the-compiler-complain-about-an-unused-variable-in-this-instance-when-i/53203262#53203262", "title": "Why does the compiler complain about an unused variable in this instance (when it is used by fmt.Fprintf)?", "body": "<p>The code in question does not result in the error posted, for proof, check it on the <a href=\"https://play.golang.org/p/oYB3JnfYHZ4\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>This error usually is (and the op confirmed it is too in this case) caused by having a local variable with same name outside of the block, and when using the <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">short variable declaration</a>, that shadows that variable.</p>\n\n<p>This error can be reproduced with the following code:</p>\n\n<pre><code>var result []byte\n\ncustomers := []int{}\nw := os.Stdout\n\nfor _, element := range customers {\n    result, _ := json.Marshal(element)\n    fmt.Fprintf(w, string(result))\n}\n</code></pre>\n\n<p>Attempting to compile and run it, we get the error (try it on the <a href=\"https://play.golang.org/p/_SejIKP8Nzc\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>prog.go:10:6: result declared and not used\n</code></pre>\n\n<p>Solution is to use a simple <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow noreferrer\">assignment</a> instead of the short variable declaration if intention is to use the existing variable (in which case no new variable will be created), or use a different name for the variable if intention is not to use the outer, existing variable (but then the outer variable is to be removed or be used of course).</p>\n"}], "owner": {"reputation": 3357, "user_id": 64968, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5c4fe5cc84e9620e3dfdd4cdffc59a56?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/64968/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 53203262, "answer_count": 1, "score": 0, "last_activity_date": 1541666121, "creation_date": 1541629471, "last_edit_date": 1541666121, "question_id": 53198800, "link": "https://stackoverflow.com/questions/53198800/why-does-the-compiler-complain-about-an-unused-variable-in-this-instance-when-i", "title": "Why does the compiler complain about an unused variable in this instance (when it is used by fmt.Fprintf)?", "body": "<p>I have a simple piece of code where I want to convert elements of a slice into json and then print them out to my http.responseWriter.</p>\n\n<pre><code>for _, element := range customers {\n    result, _ := json.Marshal(element)\n    fmt.Fprintf(w, string(result))\n}\n</code></pre>\n\n<p>However when I compile this I get the error \"result declared and not used\". If I add a simple line:</p>\n\n<pre><code>_ = result\n</code></pre>\n\n<p>Then everything compiles and works fine. Why does the compiler complain about this usage, and what is the correct way to do this in go? </p>\n\n<p>Any insight is appreciated, my searches so far seem to indicate the call to Fprintf should count as a usage.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541629089, "post_id": 53198618, "comment_id": 93286005, "body": "Related / possible duplicate of <a href=\"https://stackoverflow.com/questions/33267106/golang-time-ticker-how-to-begin-on-even-timestamps\">Golang time.Ticker, how to begin on even timestamps</a>."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 3, "last_activity_date": 1541664267, "creation_date": 1541664267, "answer_id": 53203559, "question_id": 53198618, "link": "https://stackoverflow.com/questions/53198618/i-have-to-send-out-thousands-of-reminders-any-way-to-avoid-a-ticker-every-minut/53203559#53203559", "title": "I have to send out thousands of reminders, any way to avoid a ticker every minute?", "body": "<p>First things first, to compare time values, use the <a href=\"https://golang.org/pkg/time/#Time.Equal\" rel=\"nofollow noreferrer\">Time.Equal</a>, <a href=\"https://golang.org/pkg/time/#Time.Before\" rel=\"nofollow noreferrer\">Time.Before</a>, and <a href=\"https://golang.org/pkg/time/#Time.After\" rel=\"nofollow noreferrer\">time.After</a> methods. Comparing the individual components is not reliable at all:</p>\n\n<pre><code>newYork, _ := time.LoadLocation(\"America/New_York\")\n\nt1 := time.Date(2018, 11, 8, 4, 0, 0, 0, time.UTC)\nt2 := t1.In(newYork)\n\nfmt.Printf(\"%v == %v?\\n\", t1, t2) // 2018-11-08 04:00:00 +0000 UTC == 2018-11-07 23:00:00 -0500 EST?\n\nfmt.Println(t1.Day() == t2.Day()) // false\nfmt.Println(t2.Equal(t1))         // true\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/06RcvuI_1Ha\" rel=\"nofollow noreferrer\">https://play.golang.org/p/06RcvuI_1Ha</a></p>\n\n<hr>\n\n<p>For the scheduling problem I would use a <a href=\"https://golang.org/pkg/time/#Timer\" rel=\"nofollow noreferrer\">time.Timer</a>. </p>\n\n<ol>\n<li>Figure out which notification is up next</li>\n<li>Set or reset the timer accordingly</li>\n<li><ol>\n<li>After the timer fires, goto 1</li>\n<li>If a notification is added, goto 1</li>\n<li>If a notification is deleted, goto 1</li>\n</ol></li>\n</ol>\n\n<p>Here is a sketch:</p>\n\n<pre><code>package main\n\nimport \"time\"\n\nfunc main() {\n    t := time.NewTimer(0)\n\n    go func() {\n        for range t.C {\n            nextTwo := db.GetNextNotifications(2)\n\n            // Sanity check\n            if time.Until(nextTwo[0].Start) &gt; 1*time.Second {\n                // The timer went off early. Perhaps the notification has been\n                // deleted?\n                t.Reset(time.Until(nextTwo[0].Start))\n                continue\n            }\n\n            go send(nextTwo[0])\n            t.Reset(time.Until(nextTwo[1].Start))\n        }\n    }()\n\n    resetTimer(t) // call as required whenever a notification is added or removed\n}\n\nfunc resetTimer(t *time.Timer) {\n    next := db.GetNextNotification()\n    t.Reset(time.Until(next.Start))\n}\n</code></pre>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "accepted_answer_id": 53203559, "answer_count": 1, "score": 1, "last_activity_date": 1541664267, "creation_date": 1541628530, "question_id": 53198618, "link": "https://stackoverflow.com/questions/53198618/i-have-to-send-out-thousands-of-reminders-any-way-to-avoid-a-ticker-every-minut", "title": "I have to send out thousands of reminders, any way to avoid a ticker every minute?", "body": "<p>I have a struct like:</p>\n\n<pre><code>type Notifications struct {\n  Id int\n  Start *time.Time\n}\n\nnotifications := db.GetNotifications()\n</code></pre>\n\n<p>So now I need to send out these notifications whenever the time matches the current time.</p>\n\n<pre><code>1  2018-11-07 09:05:00\n2  2018-11-07 09:05:00\n3  2018-11-07 09:15:00\n..\n</code></pre>\n\n<p>The simplest way for me to do this is with a ticker:</p>\n\n<pre><code>ticker := time.NewTicker(30 * time.Second)\ndefer ticker.Stop()\n\nfor {\n    &lt;-ticker.C\n    alerts := []Notification\n    for _, n := range notifications {\n      if n.Start == // same year, month, day, hour and minute {\n        alerts = append(alerts, n) \n      }\n    }\n\n    sendNotifications(alerts)\n    // TODO mutate the notifications to avoid duplicatation sending\n}\n</code></pre>\n\n<p>Is there a more efficient way to do be doing this?</p>\n\n<p>What is the best way to match on the time, do I have to compare time.Now()'s attributes like year, month, day, hour and minute individually in my if statement?  i.e. A notification is triggered if the year,month,day,hour and minute have been reached (seconds and beyond are ignored)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1541627504, "post_id": 53198199, "comment_id": 93285381, "body": "<code>var cmd *exec.Cmd</code> (<a href=\"https://golang.org/ref/spec#Variables\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Variables</a> and <a href=\"https://golang.org/ref/spec#Variable_declarations\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Variable_declarations</a>)"}, {"owner": {"reputation": 1283, "user_id": 3246078, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/6a7de53a68c0e67d9b9cbcea5d6e5581?s=128&d=identicon&r=PG&f=1", "display_name": "HH- Apologize to Carole Baskin", "link": "https://stackoverflow.com/users/3246078/hh-apologize-to-carole-baskin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1541627605, "post_id": 53198199, "comment_id": 93285418, "body": "@mkopriva - thanks, put it in an answer so I can accept it"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1541627880, "creation_date": 1541627880, "answer_id": 53198468, "question_id": 53198199, "link": "https://stackoverflow.com/questions/53198199/initializing-empty-object-in-go/53198468#53198468", "title": "Initializing empty object in Go", "body": "<p>You can declare a typed variable before you have a value for it.</p>\n\n<pre><code> var cmd *exec.Cmd\n // or\n cmd := (*exec.Cmd)(nil)\n</code></pre>\n\n<p>Read more here <a href=\"https://golang.org/ref/spec#Variables\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Variables</a> and here <a href=\"https://golang.org/ref/spec#Variable_declarations\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Variable_declarations</a>.</p>\n"}], "owner": {"reputation": 1283, "user_id": 3246078, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/6a7de53a68c0e67d9b9cbcea5d6e5581?s=128&d=identicon&r=PG&f=1", "display_name": "HH- Apologize to Carole Baskin", "link": "https://stackoverflow.com/users/3246078/hh-apologize-to-carole-baskin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 879, "favorite_count": 0, "accepted_answer_id": 53198468, "answer_count": 1, "score": -1, "last_activity_date": 1541627880, "creation_date": 1541626602, "question_id": 53198199, "link": "https://stackoverflow.com/questions/53198199/initializing-empty-object-in-go", "title": "Initializing empty object in Go", "body": "<p>I will use exec.Command with different arguments depending on a variable.  I do <code>cmd := exec.Command(...</code> in the if/else brackets , so <code>cmd</code> is unusable outside of that scope.  Is it possible to initialize <code>cmd</code> above if/else so that it can be used afterward?</p>\n"}, {"tags": ["html", "go"], "answers": [{"comments": [{"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "reply_to_user": {"reputation": 9, "user_id": 10619044, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WZPpUnpO1qA/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbD34dOZp1OT7RqMxAmN2RQThZGnyQ/mo/photo.jpg?sz=128", "display_name": "yoyo ik ben het", "link": "https://stackoverflow.com/users/10619044/yoyo-ik-ben-het"}, "edited": false, "score": 0, "creation_date": 1541626346, "post_id": 53198077, "comment_id": 93284894, "body": "no problem.  If this answers your question, you should Accept the answer"}], "tags": [], "owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "is_accepted": false, "score": 0, "last_activity_date": 1541626313, "last_edit_date": 1541626313, "creation_date": 1541626019, "answer_id": 53198077, "question_id": 53198037, "link": "https://stackoverflow.com/questions/53198037/why-doesnt-my-status-of-the-order-show-up-when-i-type-in-my-email/53198077#53198077", "title": "Why doesn&#39;t my status of the order show up when I type in my email?", "body": "<p>Looking at its definition,</p>\n\n<pre><code>func LoadBestellingenFromMap() (map[string][]Klant, error) {\n</code></pre>\n\n<p><code>LoadBestellingenFromMap</code> returns a <code>map</code> to a <em><code>slice</code></em> of <code>Klant</code>s, not just one.</p>\n\n<p>You might try something like:</p>\n\n<pre><code>for _, values := range PizzaBestellingen {\n  for _, value := range Values {\n    if value.Email == request.FormValue(\"statuscheck\") {\n        data = value.Status\n    }\n  }\n}\n</code></pre>\n\n<p>It's possible you'll also have to reconsider the logic of your algorithm ( you could get more than one such <code>Email</code>), but that is already be the case, since you were already iterating across <code>PizzaBestellingen</code> anyway.  Keep it in mind if it's possible more than one such email would match.  </p>\n"}], "owner": {"reputation": 9, "user_id": 10619044, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WZPpUnpO1qA/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbD34dOZp1OT7RqMxAmN2RQThZGnyQ/mo/photo.jpg?sz=128", "display_name": "yoyo ik ben het", "link": "https://stackoverflow.com/users/10619044/yoyo-ik-ben-het"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 23, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1541626716, "creation_date": 1541625840, "last_edit_date": 1541626716, "question_id": 53198037, "link": "https://stackoverflow.com/questions/53198037/why-doesnt-my-status-of-the-order-show-up-when-i-type-in-my-email", "title": "Why doesn&#39;t my status of the order show up when I type in my email?", "body": "<p>I am making an pizza website and I am working on the status of the order.\nThe order is working, but if i type my email in the input place, it doesn't show my status.</p>\n\n<p>The HTML:</p>\n\n<pre><code>&lt;form method=\"POST\"&gt;\n        &lt;p&gt;Emailadres &lt;input type=\"email\" name=\"statuscheck\"&gt;&lt;/p&gt;\n        &lt;input type=\"submit\" value=\"Verzend\"&gt;\n\n     &lt;/form&gt;\n     {{ . }}\n</code></pre>\n\n<p>The Handler:</p>\n\n<pre><code>func statusHandler(writer http.ResponseWriter, request *http.Request) {\nlog.Println(\"Viewing status\")\n\n// maak een html template object aan\nstatuschecktemplate, _ := template.ParseFiles(\"./templates/status.htm\")\n\nPizzaBestellingen, _ := LoadBestellingenFromMap()\n\nvar data string\n\nfor _, value := range PizzaBestellingen {\n    for _, value := range value {\n        if value.Email == request.FormValue(\"statuscheck\") {\n            data = value.Status\n        }\n    }\n}\nfmt.Println(data)\n// genereer de html met de lijst van pizzas\n// deze worden automatisch teruggestuurd naar de browser\nstatuschecktemplate.Execute(writer, data)\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1541624021, "post_id": 53197586, "comment_id": 93283829, "body": "I&#39;d execute and parse the output of <code>uname -a</code> or alike."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1541624251, "post_id": 53197586, "comment_id": 93283950, "body": "@WarBro: then it looks like you&#39;re looking for a recommendation for a package that parses the unique OS data for you, which is off topic for StackOverflow"}], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1541633733, "post_id": 53197771, "comment_id": 93287557, "body": "The Go Playground runs in a NaCl sandbox:  <a href=\"https://blog.golang.org/playground\" rel=\"nofollow noreferrer\">The Go Blog: Inside the Go Playground</a>."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 10, "last_activity_date": 1541625292, "last_edit_date": 1541625292, "creation_date": 1541624575, "answer_id": 53197771, "question_id": 53197586, "link": "https://stackoverflow.com/questions/53197586/how-can-i-detect-os-version-in-go/53197771#53197771", "title": "How can I detect OS version in Go", "body": "<p>So there's this obscure <code>Uname</code> method in the <code>syscall</code> package that basically does it, at least on Linux. The struct it fills is a bit clunky and undocumented, but you can get the gist of it:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"syscall\"\n)\n\n// A utility to convert the values to proper strings.\nfunc int8ToStr(arr []int8) string {\n    b := make([]byte, 0, len(arr))\n    for _, v := range arr {\n        if v == 0x00 {\n            break\n        } \n        b = append(b, byte(v))\n    }\n    return string(b)\n}\n\nfunc main() {\n\n    var uname syscall.Utsname\n    if err := syscall.Uname(&amp;uname); err == nil {\n        // extract members:\n        // type Utsname struct {\n        //  Sysname    [65]int8\n        //  Nodename   [65]int8\n        //  Release    [65]int8\n        //  Version    [65]int8\n        //  Machine    [65]int8\n        //  Domainname [65]int8\n        // }\n\n        fmt.Println(int8ToStr(uname.Sysname[:]), \n                    int8ToStr(uname.Release[:]), \n                    int8ToStr(uname.Version[:]))\n\n    }\n}\n</code></pre>\n\n<p>BTW This doesn't work on the playground, probably because of the sandbox limitations, but works on Linux. Haven't tested other systems.</p>\n"}], "owner": {"reputation": 187, "user_id": 5623153, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/3JAz2.png?s=128&g=1", "display_name": "WarBro", "link": "https://stackoverflow.com/users/5623153/warbro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2205, "favorite_count": 2, "accepted_answer_id": 53197771, "answer_count": 1, "score": 3, "last_activity_date": 1541625292, "creation_date": 1541623737, "last_edit_date": 1541624455, "question_id": 53197586, "link": "https://stackoverflow.com/questions/53197586/how-can-i-detect-os-version-in-go", "title": "How can I detect OS version in Go", "body": "<p>Relatively new to Go. Seems trivial, but I can't figure out how to detect the OS version. I know I can use <code>runtime.GOOS</code> and <code>runtime.GOARCH</code> to get the platform and architecture, but say I know I'm on linux but I want to find if I'm on RH6 vice RH7, etc. is what I'm trying to figure out.</p>\n"}, {"tags": ["json", "pointers", "go", "struct"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1541619021, "post_id": 53196055, "comment_id": 93281471, "body": "This may not be related, but in your <code>load</code> method, you are passing a pointer to a pointer to <code>json.Unmarshal</code>."}], "answers": [{"comments": [{"owner": {"reputation": 173, "user_id": 2999538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ff0b4e45fd5bd41515d018efd31f6c?s=128&d=identicon&r=PG&f=1", "display_name": "odzhu", "link": "https://stackoverflow.com/users/2999538/odzhu"}, "edited": false, "score": 0, "creation_date": 1541878232, "post_id": 53197033, "comment_id": 93370722, "body": "@mkoptiva thanks! You made my day!  Could you please suggest where to ready about  the following expression &quot;(*tmp)(m)&quot; , I don&#39;t understand why not working by passing &quot;m&quot; object directly to Unmarshal()  ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 173, "user_id": 2999538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ff0b4e45fd5bd41515d018efd31f6c?s=128&d=identicon&r=PG&f=1", "display_name": "odzhu", "link": "https://stackoverflow.com/users/2999538/odzhu"}, "edited": false, "score": 0, "creation_date": 1541883872, "post_id": 53197033, "comment_id": 93372232, "body": "@nixlike If you pass <code>m</code> directly to <code>json.Unmarshal</code> it will again call <code>m.UnmarshalJSON</code> method and so on until you get stack overflow. <code>type tmp Mcloud</code> creates a new type called <code>tmp</code> that has the same structure as <code>Mcloud</code> but none of its methods, so <code>tmp</code> does not have <code>UnmarshalJSON</code> for example, and therefore it is safe to pass it to <code>json.Unmarshal</code>. And because the two types have the same structure you can convert between them. <code>(*tmp)(m)</code> is an expression that converts <code>m</code>&#39;s type (<code>*Mcloud</code>) to <code>*tmp</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 173, "user_id": 2999538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ff0b4e45fd5bd41515d018efd31f6c?s=128&d=identicon&r=PG&f=1", "display_name": "odzhu", "link": "https://stackoverflow.com/users/2999538/odzhu"}, "edited": false, "score": 0, "creation_date": 1541883979, "post_id": 53197033, "comment_id": 93372262, "body": "Same kind of expression as <code>[]byte(&quot;hello world&quot;)</code>, converting a <code>string</code> literal to <code>[]byte</code>."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1541621204, "creation_date": 1541621204, "answer_id": 53197033, "question_id": 53196055, "link": "https://stackoverflow.com/questions/53196055/persisting-nested-structs-in-golang/53197033#53197033", "title": "Persisting nested structs in golang", "body": "<p>First you need to tell <code>encoding/json</code> to skip the parent field, you can do that with the <code>json:\"-\"</code> tag.</p>\n\n<p>Then during unmarshaling, after you've loaded all of a parent's children you loop over the children and set their parent, you can do this as part of the unamrshaling process by implementing the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>json.Unmarshaler</code></a> interface.</p>\n\n<pre><code>type Mcloud struct {\n    Projects map[string]*Project `json:\"Projects\"`\n    Workdir  string\n}\n\ntype Project struct {\n    Name     string\n    Networks map[string]Network\n    Parent   *Mcloud `json:\"-\"` // ignore on un/marshal\n    TFC      TFConf\n}\n\nfunc (m *Mcloud) UnmarshalJSON(data []byte) error {\n    type tmp Mcloud\n    if err := json.Unmarshal(data, (*tmp)(m)); err != nil {\n        return err\n    }\n\n    // set Parent of all projects\n    for _, p := range m.Projects {\n        p.Parent = m\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 2999538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ff0b4e45fd5bd41515d018efd31f6c?s=128&d=identicon&r=PG&f=1", "display_name": "odzhu", "link": "https://stackoverflow.com/users/2999538/odzhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 770, "favorite_count": 0, "accepted_answer_id": 53197033, "answer_count": 1, "score": 0, "last_activity_date": 1541621204, "creation_date": 1541617175, "question_id": 53196055, "link": "https://stackoverflow.com/questions/53196055/persisting-nested-structs-in-golang", "title": "Persisting nested structs in golang", "body": "<p>I want to add persistence and initialize from json.\nI'm trying to save/load nested structs and getting \"fatal error: stack overflow\". </p>\n\n<p>As I understand, the reason is that both parent and child structs have pointers to each other and json library is going into loops. I need pointer to Parent since need access it from the child.</p>\n\n<p>I understand this is common issue, what is the best way to address it?</p>\n\n<pre><code>type Mcloud struct {\n    Projects map[string]*Project `json:\"Projects\"`\n    Workdir  string\n}\n\ntype Project struct {\n    Name     string\n    Networks map[string]Network\n    Parent   *Mcloud\n    TFC      TFConf\n}\n\nfunc newMcloud() *Mcloud {\n    mc := &amp;Mcloud{\n        Projects: make(map[string]*Project),\n        Workdir:  defaultWorkDir,\n    }\n    mc.load(statefile)\n\n    return mc\n}\n\n\nfunc (mc *Mcloud) addProject(n string) {\n    mc.Projects[n] = &amp;Project{\n        Name:     n,\n        Networks: make(map[string]Network),\n        Parent:   mc,\n    }\n    mc.Projects[n].addTFConf()\n}\n\n//save saves state to statefile\nfunc (mc *Mcloud) save(f string) (err error) {\n    if jsonState, err := json.Marshal(mc); err != nil {\n        fmt.Println(\"Was not able to marshal\")\n        log.Fatal(err)\n    } else {\n        if err := ioutil.WriteFile(f, jsonState, 0666); err != nil {\n            fmt.Println(\"Was not able to write state to\", f, \"!\")\n            log.Fatal(err)\n        }\n        fmt.Println(\"Save function saves: \\n\", mc, \"to file \", f)\n    }\n\n    return err\n}\n\nfunc (mc *Mcloud) load(f string) (err error) {\n    var bytestate []byte\n\n    if bytestate, err = ioutil.ReadFile(f); err == nil {\n        err = json.Unmarshal(bytestate, &amp;mc)\n    }\n\n    return err\n}\n</code></pre>\n\n<p>Getting</p>\n\n<blockquote>\n  <p>runtime: goroutine stack exceeds 1000000000-byte limit fatal error:\n  stack overflow</p>\n  \n  <p>runtime stack: runtime.throw(0x149cdfe, 0xe)\n          /usr/local/Cellar/go/1.11.1/libexec/src/runtime/panic.go:608 +0x72 runtime.newstack()\n          /usr/local/Cellar/go/1.11.1/libexec/src/runtime/stack.go:1008 +0x729 runtime.morestack()\n          /usr/local/Cellar/go/1.11.1/libexec/src/runtime/asm_amd64.s:429 +0x8f</p>\n  \n  <p>goroutine 1 [running]: runtime.heapBitsSetType(0xc042a7df20, 0x60,\n  0x60, 0x1486e60)\n          /usr/local/Cellar/go/1.11.1/libexec/src/runtime/mbitmap.go:911 +0xa30 fp=0xc02243c388 sp=0xc02243c380 pc=0x1016cd0 runtime.mallocgc(0x60, 0x1486e60, 0x1, 0x0)\n          /usr/local/Cellar/go/1.11.1/libexec/src/runtime/malloc.go:933 +0x540 fp=0xc02243c428 sp=0xc02243c388 pc=0x100d4f0 runtime.newobject(0x1486e60, 0x0)\n          /usr/local/Cellar/go/1.11.1/libexec/src/runtime/malloc.go:1032 +0x38 fp=0xc02243c458 sp=0xc02243c428 pc=0x100db28 reflect.mapiterinit(0x14206a0, 0xc00009d830, 0x0)</p>\n</blockquote>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1541616990, "creation_date": 1541616990, "answer_id": 53196012, "question_id": 53195666, "link": "https://stackoverflow.com/questions/53195666/go-slice-no-panic-one-past-the-end/53196012#53196012", "title": "Go slice - no panic one past the end", "body": "<p>This is expected behavior; <code>slice[cap(slice):]</code> refers to a zero-length slice at the end of <code>slice</code>. <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">Per the spec</a>:</p>\n\n<blockquote>\n  <p>For arrays or strings, the indices are in range if 0 &lt;= low &lt;= high &lt;= len(a), otherwise they are out of range. For slices, the upper index bound is the slice capacity cap(a) rather than the length.</p>\n</blockquote>\n\n<p>Note that it is <code>&lt;= len(a)</code>, not <code>&lt; len(a)</code>; an index equal to the length/capacity is allowed per the specification.</p>\n"}], "owner": {"reputation": 1, "user_id": 10619697, "user_type": "registered", "profile_image": "https://graph.facebook.com/2117876158243721/picture?type=large", "display_name": "Bill Nickless", "link": "https://stackoverflow.com/users/10619697/bill-nickless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 582, "favorite_count": 0, "closed_date": 1541617572, "accepted_answer_id": 53196012, "answer_count": 1, "score": -2, "last_activity_date": 1541616990, "creation_date": 1541615607, "question_id": 53195666, "link": "https://stackoverflow.com/questions/53195666/go-slice-no-panic-one-past-the-end", "closed_reason": "Duplicate", "title": "Go slice - no panic one past the end", "body": "<p>Why does this code work?  Specifically, the lines that reference the slice range a[5:] and return a zero length slice?  Both the length and the capacity are reported as five, yet referencing a sixth non-existent element does not cause a panic:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    a := []int{1, 2, 3, 4, 5}\n    fmt.Println(a, \"Len(a)=\", len(a), \"Cap(a)=\", cap(a))\n\n    fmt.Println(a[4]) // Works as expected\n    // fmt.Println(a[5]) // XXX-runtime error:index out of range\n    fmt.Println(a[5:]) // Works--returns a zero-length slice--but why?\n\n    a = append(a[:4], a[5:]...)\n    fmt.Println(a, \"Len(a)=\", len(a), \"Cap(a)=\", cap(a))\n\n}\n</code></pre>\n\n<p>Go Playground: <a href=\"https://play.golang.org/p/7evt4Y0ADD3\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7evt4Y0ADD3</a></p>\n\n<p>In <a href=\"https://stackoverflow.com/questions/38960719/go-slice-difference-between-n-and-n\">Go Slice - difference between [:n] and [n:]</a> the explanation is that the underlying array is actually longer than the slice, so accessing the range a[5:] is simply accessing the longer array.  But when you run this code you'll see that the length and capacity of the slice is actually reported as 5.  And if you uncomment the reference to a[5] you'll see that does cause a panic as expected.</p>\n\n<p>Can I count on this behavior or am I running into a specification/compiler bug that could be fixed in a future release?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1541609493, "post_id": 53194031, "comment_id": 93276951, "body": "Use a <code>for</code> loop. <a href=\"https://tour.golang.org/moretypes/16\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/16</a>"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1541610854, "post_id": 53194031, "comment_id": 93277680, "body": "See this answer <a href=\"https://stackoverflow.com/a/15323988/1153938\">stackoverflow.com/a/15323988/1153938</a> for how to find a value in an array.  Then loop it"}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1541611725, "post_id": 53194031, "comment_id": 93278130, "body": "Ask question more specifically. Do you want to delete the elements (those are in b_array) from a_array Or want to output like set operation A-B?"}], "answers": [{"comments": [{"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1541682538, "post_id": 53196432, "comment_id": 93304723, "body": "Dif can&#39;t be done based longest or smallest sized set. That means, lets say <code>A[] = {1, 2}</code> and <code>B[] = {1, 2, 3, 4}</code> and if he wants <code>A dif B</code> ( <code>A\\B</code> or ` A - B` in terms of set), then your program just give output <code>{3, 4}</code> where the correct answer is <code>{}</code>. Hope make sense."}, {"owner": {"reputation": 84923, "user_id": 1920232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iUA8y.jpg?s=128&g=1", "display_name": "peterm", "link": "https://stackoverflow.com/users/1920232/peterm"}, "reply_to_user": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1541704269, "post_id": 53196432, "comment_id": 93316725, "body": "First of all the suggested implementation is not based on shortest or smallest, it&#39;s just an implementation detail for a slightly different problem - get values from both slices that are not present in both of them or in other words eliminate all that present in both and give me the rest unique values, again, from both slices. From OP&#39;s question it&#39;s not clear what exactly is required - the result of subtracting two slices pretending they are sets or my interpretation. But I&#39;ll add another version that strictly compares <code>a</code> against <code>b</code>."}], "tags": [], "owner": {"reputation": 84923, "user_id": 1920232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iUA8y.jpg?s=128&g=1", "display_name": "peterm", "link": "https://stackoverflow.com/users/1920232/peterm"}, "is_accepted": false, "score": 1, "last_activity_date": 1541708764, "last_edit_date": 1541708764, "creation_date": 1541618833, "answer_id": 53196432, "question_id": 53194031, "link": "https://stackoverflow.com/questions/53194031/how-to-delete-duplicate-elements-between-slices-on-golang/53196432#53196432", "title": "how to delete Duplicate elements between slices on golang", "body": "<p>If you need to strictly compare one slice against the other you may do something along the lines of</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func diff(a []string, b []string) []string {\n    // Turn b into a map\n    var m map[string]bool\n    m = make(map[string]bool, len(b))\n    for _, s := range b {\n        m[s] = false\n    }\n    // Append values from the longest slice that don't exist in the map\n    var diff []string\n    for _, s := range a {\n        if _, ok := m[s]; !ok {\n            diff = append(diff, s)\n            continue\n        }\n        m[s] = true\n    }\n    // Sort the resulting slice\n    sort.Strings(diff)\n    return diff\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/zgbCunAHyM5\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<hr>\n\n<p>Alternatively if you want to get all values from both slices that are not present in both of them you can do</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func diff(a []string, b []string) []string {\n    var shortest, longest *[]string\n    if len(a) &lt; len(b) {\n        shortest = &amp;a\n        longest = &amp;b\n    } else {\n        shortest = &amp;b\n        longest = &amp;a\n    }\n    // Turn the shortest slice into a map\n    var m map[string]bool\n    m = make(map[string]bool, len(*shortest))\n    for _, s := range *shortest {\n        m[s] = false\n    }\n    // Append values from the longest slice that don't exist in the map\n    var diff []string\n    for _, s := range *longest {\n        if _, ok := m[s]; !ok {\n            diff = append(diff, s)\n            continue\n        }\n        m[s] = true\n    }\n    // Append values from map that were not in the longest slice\n    for s, ok := range m {\n        if ok {\n            continue\n        }\n        diff = append(diff, s)\n    }\n    // Sort the resulting slice\n    sort.Strings(diff)\n    return diff\n}\n</code></pre>\n\n<p>Then</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>fmt.Println(diff(a_array, b_array))\n</code></pre>\n\n<p>will give you</p>\n\n<pre>\n[1 2]\n</pre>\n\n<p><a href=\"https://play.golang.org/p/nm3VgZXbtK7\" rel=\"nofollow noreferrer\">Go playground</a></p>\n"}], "owner": {"reputation": 11, "user_id": 9674565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EZ8Vz.jpg?s=128&g=1", "display_name": "marumo", "link": "https://stackoverflow.com/users/9674565/marumo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1752, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1602065583, "creation_date": 1541609087, "question_id": 53194031, "link": "https://stackoverflow.com/questions/53194031/how-to-delete-duplicate-elements-between-slices-on-golang", "title": "how to delete Duplicate elements between slices on golang", "body": "<p>As a title,\nhow to delete duplicate elements between slices on golang </p>\n\n<p>ex.</p>\n\n<pre><code>a_array := {\"1\",\"2\",\"3\",\"4,\"}\nb_array := {\"3\",\"4\"}\n</code></pre>\n\n<p>hope of result</p>\n\n<p><code>\"1\",\"2\"</code></p>\n\n<p>With the assumption, a_array elements definitely has b_array elements.\nPlease tell me how to do it.\nThank you!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 1, "creation_date": 1541606730, "post_id": 53193020, "comment_id": 93275387, "body": "Have you tried building without the &quot;wtf/&quot; prefix for the import path? e.g. <code>go build -ldflags &quot;-X main.version=1.0.0.1234&quot; wtf</code>"}, {"owner": {"reputation": 2844, "user_id": 23569, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/371e4b037974623acab3a397d0e0bf2a?s=128&d=identicon&r=PG", "display_name": "Marc Bernier", "link": "https://stackoverflow.com/users/23569/marc-bernier"}, "reply_to_user": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 0, "creation_date": 1541608492, "post_id": 53193020, "comment_id": 93276383, "body": "@ssemilla, one of the first things I tried."}], "answers": [{"comments": [{"owner": {"reputation": 2844, "user_id": 23569, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/371e4b037974623acab3a397d0e0bf2a?s=128&d=identicon&r=PG", "display_name": "Marc Bernier", "link": "https://stackoverflow.com/users/23569/marc-bernier"}, "edited": false, "score": 0, "creation_date": 1541608764, "post_id": 53193363, "comment_id": 93276544, "body": "Navigating to that location seems to work! I&#39;m actually trying to do this from VS Code using the Go plug-in, so I guess I need to figure out how to get that information into the go.buildFlags config setting."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1541607970, "last_edit_date": 1541607970, "creation_date": 1541606959, "answer_id": 53193363, "question_id": 53193020, "link": "https://stackoverflow.com/questions/53193020/debugging-issues-with-x-ldflag/53193363#53193363", "title": "Debugging issues with -X ldflag", "body": "<p>The mistake is that you have to specify the package by import path, not relative folder to the <code>src</code> folder. So simply refer to your <code>version</code> variable like <code>main.version</code>. For details, see <a href=\"https://stackoverflow.com/questions/47509272/how-to-set-package-variable-using-ldflags-x-in-golang-build/47510909#47510909\">How to set package variable using -ldflags -X in Golang build</a>.</p>\n\n<p>So navigate to <code>%GOPATH%/src/wtf</code>, and build it with the following command:</p>\n\n<pre><code>go build -ldflags \"-X main.version=1.0.0.1234\" wtf.go\n</code></pre>\n\n<p>(Or if you don't have source files with other packages in the <code>src/wtf</code> folder, you can leave out the source file name.)</p>\n\n<p>This will place the <code>wtf.exe</code> in the current folder. Running it will print:</p>\n\n<pre><code>Version 1.0.0.1234\n</code></pre>\n\n<p>Note that <code>go install</code> is not needed. That will build your app and place the executable binary in <code>%GOPATH%/bin</code>, but that won't have the <code>version</code> set!</p>\n\n<p>If you want to use <code>go install</code>, you again have to provide the flags. Run the following command in the <code>%GOPATH%/src/wtf</code> folder:</p>\n\n<pre><code>go install -ldflags \"-X main.version=1.0.0.1234\"\n</code></pre>\n\n<p>Also note that <code>go install</code> does not require you to run <code>go build</code> prior, and you do not need to run <code>go install</code> after <code>go build</code>. For details, see <a href=\"https://stackoverflow.com/questions/30612611/what-does-go-build-build/30612612#30612612\">What does go build build?</a></p>\n"}], "owner": {"reputation": 2844, "user_id": 23569, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/371e4b037974623acab3a397d0e0bf2a?s=128&d=identicon&r=PG", "display_name": "Marc Bernier", "link": "https://stackoverflow.com/users/23569/marc-bernier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 647, "favorite_count": 0, "accepted_answer_id": 53193363, "answer_count": 1, "score": 0, "last_activity_date": 1541607970, "creation_date": 1541605956, "question_id": 53193020, "link": "https://stackoverflow.com/questions/53193020/debugging-issues-with-x-ldflag", "title": "Debugging issues with -X ldflag", "body": "<p>I have a go program like this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nvar version string\n\nfunc main() {\n    fmt.Printf(\"Version %s\\n\", version)\n}\n</code></pre>\n\n<p>I would like to change the value of <strong>version</strong> at compile time, as demonstrated <a href=\"https://stackoverflow.com/questions/11354518/golang-application-auto-build-versioning?rq=1\">here</a>, so I'm building it in this way (wtf.go is in src/wtf):</p>\n\n<pre><code>go build -ldflags \"-X wtf/main.version=1.0.0.1234\" wtf\ngo install wtf\n</code></pre>\n\n<p>But when I run, <strong>version</strong> is an empty string.</p>\n\n<p>I have tried various casings of <strong>version</strong>, different variations of the package name and path. It seems that <strong>go build</strong> does not validate the package/variable name very much, as clearly bogus ones do not generate an error.</p>\n\n<p>Is there a way I can find out what variable go is trying to modify so that I can troubleshoot this?</p>\n\n<p>I'm using Go v 1.10.3 for Windows/amd64.</p>\n"}, {"tags": ["css", "go", "assets", "buffalo"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1541609117, "post_id": 53192959, "comment_id": 93276733, "body": "Buffalo uses a package called <a href=\"https://github.com/gobuffalo/packr\" rel=\"nofollow noreferrer\">packr</a>, which embeds the contents of those static files right in the binary. However, it should still be generating the files in <code>public&#47;assets&#47;</code>."}], "answers": [{"comments": [{"owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "edited": false, "score": 0, "creation_date": 1541609004, "post_id": 53193677, "comment_id": 93276670, "body": "I guess part of my  question is: Wether or not public/assets is a <i>build artifact</i> or <i>application code</i>.  IF the former, which is what your implying i think, then the question is: How does one build these artifacts ?  I don&#39;t see &#39;buffalo dev&#39; making them locally, but i could be missing something.... Also it appears &#39;buffalo build&#39; doesn&#39;t always make them either.."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "edited": false, "score": 0, "creation_date": 1541609428, "post_id": 53193677, "comment_id": 93276913, "body": "I&#39;m not an expert in buffalo, but if those files are included in their .gitignore, that&#39;s a clear indication from them that they don&#39;t consider it application code."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1541607983, "creation_date": 1541607983, "answer_id": 53193677, "question_id": 53192959, "link": "https://stackoverflow.com/questions/53192959/where-are-public-assets-generated-in-the-go-buffalo-workflow/53193677#53193677", "title": "Where are /public/assets generated in the go buffalo workflow?", "body": "<p>There's source control, which contains the source you've created for your application, there's the build server, which turns the source into deployable artifact(s), and there's artifacts, which contain everything necessary to run the app (i.e. resources, compiled binary, no source code).</p>\n\n<p>Source control is generally a poor solution for storing artifacts; this is why e.g. GitHub has the Releases feature. Find a proper solution for your artifacts, outside of source control - what you choose will depend on your build and operating environments and your deployment system. For example, S3 is a popular choice for storing internal build artifacts because it's very easy to use and reasonably cheap.</p>\n"}, {"tags": [], "owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "is_accepted": false, "score": 2, "last_activity_date": 1541649704, "last_edit_date": 1541649704, "creation_date": 1541649297, "answer_id": 53201322, "question_id": 53192959, "link": "https://stackoverflow.com/questions/53192959/where-are-public-assets-generated-in-the-go-buffalo-workflow/53201322#53201322", "title": "Where are /public/assets generated in the go buffalo workflow?", "body": "<p>So to answer the original question of where public/assets are generated - the answer is \"at creation time\" or \"at build time, if you dont have them, and if you bootstrap the empty directory\".  Hopefully after the PR mentioned below is merged, the answer to this question will be \"at creation time, or at build time if they don't already exist in your repo (i.e. because they are gitignored)\".</p>\n\n<p>The two points (why local build doesnt generate them + why docker build doesnt generate them) have completely unrelated and different answers, so I'll treat them each in separate bullets. </p>\n\n<ul>\n<li><p>We've found that actually, depending on the state of your repository, if you lose/delete the webpack files, the buffalo environment doesn't regenerate them for you, and thats not a bug in anyway, because its a valid use case to run buffalo without generating any assets (although this is not a use case which seems very useful to me, it might be worth proposing a change to make buffalo more opinionated in this regard).</p></li>\n<li><p>Regarding the docker build itself, it seems that if you add a <code>mkdir</code> statement to ensure that public/assets exists <em>before</em> running buffalo build (i.e. in your Dockerfile), then you can compensate for the fact that you are git-ignoring that directory, and it will correctly be populated in the static build.</p></li>\n</ul>\n\n<p>Since the latter use case is the more important one, I've created a pull request to address this issue (i.e. to make it so that you don't need to manually add a mkdir public/assets step) under the guidance of the buffalo community, which can be found here: \n<a href=\"https://github.com/gobuffalo/buffalo/pull/1447\" rel=\"nofollow noreferrer\">https://github.com/gobuffalo/buffalo/pull/1447</a>.</p>\n\n<p>In short : Until this PR merges, if you need your assets to build your deployables (which you probably do), either remove the public/assets line from gitignore and commit them to version control so that your code can directly be built with no external dependencies, OR just make sure you build your code in the same place that you run buffalo dev.  If there is a third answer.  The former is the more cloud friendly solution from my perspective, but I'm new to buffalo so I may be misunderstanding the idioms in some ways.</p>\n\n<p><em>Disclaimer: I'm answering this question because I think it might be useful to folks, but I'm not a buffalo expert.</em>  There are much deeper technical perspectives on how assets work on the buffalo docs/website (<a href=\"https://gobuffalo.io/en/docs/assets\" rel=\"nofollow noreferrer\">https://gobuffalo.io/en/docs/assets</a>)</p>\n"}], "owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1541649704, "creation_date": 1541605782, "question_id": 53192959, "link": "https://stackoverflow.com/questions/53192959/where-are-public-assets-generated-in-the-go-buffalo-workflow", "title": "Where are /public/assets generated in the go buffalo workflow?", "body": "<p>In go buffalo, there is a generated .gitignore file which ignores public/assets. However, at the same time, the generated css and js are critical for getting a 'real' buffalo app.  So, there's a disconnect which I don't fully understand, which is that <strong>something seemingly critical for deploying an app is bound to be missing, by default, from any version control system which builds the app itself.</strong></p>\n\n<p>What I've noticed</p>\n\n<ul>\n<li><p>buffalo build does not generate content in public/assets.</p></li>\n<li><p>buffalo dev also does not generate this content.</p></li>\n<li><p>running buffalo dev after deleting <code>public/assets/*</code> results in a site that doesn't have any CSS, implying that it breaks functionality.</p></li>\n</ul>\n\n<p>So, thus. from what I can tell /public/assets are both essential, and non-dynamically created.  </p>\n\n<p>So, my question is thus, how can i regenerate public/assets in my buffalo workflow at build time (i.e. how can i retain the .gitignore defaults) <em>or</em> where do people generally  package their assets if not in version control?</p>\n"}, {"tags": ["html", "go"], "comments": [{"owner": {"reputation": 393, "user_id": 2664120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e396f6a7678066cf12a38350f80a3e?s=128&d=identicon&r=PG", "display_name": "Nordiii", "link": "https://stackoverflow.com/users/2664120/nordiii"}, "edited": false, "score": 1, "creation_date": 1541604219, "post_id": 53192351, "comment_id": 93273832, "body": "Wild guess but probably because in the template it&#39;s  <code>.totaalprijs</code> insteadof <code>.Totaalprijs</code>"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 0, "creation_date": 1541604335, "post_id": 53192351, "comment_id": 93273920, "body": "This is a continuation of <a href=\"https://stackoverflow.com/questions/53190146/why-isnt-my-order-data-saved-in-my-json-file\" title=\"why isnt my order data saved in my json file\">stackoverflow.com/questions/53190146/&hellip;</a>. What are the contents of <code>.&#47;data&#47;pizzas.json</code>? Why are you ignoring the possible error of <code>strconv.Atoi</code>?"}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 5, "creation_date": 1541604597, "post_id": 53192351, "comment_id": 93274105, "body": "stop ignoring errors, you assign most errors to _, and then when you do assign them to err you still don&#39;t check them."}], "owner": {"reputation": 9, "user_id": 10619044, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WZPpUnpO1qA/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbD34dOZp1OT7RqMxAmN2RQThZGnyQ/mo/photo.jpg?sz=128", "display_name": "yoyo ik ben het", "link": "https://stackoverflow.com/users/10619044/yoyo-ik-ben-het"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1541625937, "creation_date": 1541603806, "last_edit_date": 1541625937, "question_id": 53192351, "link": "https://stackoverflow.com/questions/53192351/why-is-the-total-price-of-my-not-displayed-on-the-web-page", "title": "Why is the total price of my not displayed on the web page?", "body": "<p>All of this code is working except for the total price (totaalprijs). I just can't seem to make it display on my webpage. I think the problem is somewhere around the if-statement: \"if aantalpizzas != 0\" but I don't know where the problem is located. The total price is saved in the json file, but it isn't showed on the webpage.</p>\n\n<p>The handler:</p>\n\n<pre><code>func bestellingHandler(writer http.ResponseWriter, request *http.Request) {\nlog.Println(\"Viewing bestellingen\")\nbestellingTemplate, _ := template.ParseFiles(\"./templates/Bestellingen.htm\")\n\n// laad de pizza's uit de data file\n\nfmt.Println(request.Method)\nfmt.Println(request.Form)\nfmt.Println(request.PostFormValue(\"name\"))\n\nfilepizza := \"./data/pizzas.json\"\nReadpizza, err := ioutil.ReadFile(filepizza)\n\nvar Pizzaslice []Pizza\n\nerr = json.Unmarshal(Readpizza, &amp;Pizzaslice)\nif err != nil {\n    panic(err)\n}\n\nPizzamap := make(map[string]PizzaOrder)\nvar totaalprijs float64\nfor i := 0; i &lt; (len(Pizzaslice)); i++ {\n\n    index := strconv.Itoa(i)\n    aantalpizzas, _ := strconv.Atoi(request.FormValue(\"aantal_\" + Pizzaslice[i].Name))\n    prijspizzas, _ := strconv.ParseFloat(request.FormValue(\"price\"+Pizzaslice[i].Name), 64)\n    if aantalpizzas != 0 {\n\n        Pizzamap[index] = PizzaOrder{\n            Naam:   request.FormValue(\"name\" + Pizzaslice[i].Name),\n            Price:  prijspizzas,\n            Aantal: aantalpizzas,\n        }\n\n        totaalprijs += float64(aantalpizzas) * prijspizzas\n    }\n}\n\nfilebestelling := \"./data/deck.json\"\nReadbestelling, err := ioutil.ReadFile(filebestelling)\n\nvar klantmap map[string]Klant\n\nerr = json.Unmarshal(Readbestelling, &amp;klantmap)\nif err != nil {\n    panic(err)\n}\nindex := strconv.Itoa(len(klantmap))\nklantmap[index] = Klant{\n    Naam:           request.FormValue(\"naam\"),\n    Tussenvoegsel:  request.FormValue(\"tussenv\"),\n    Achternaam:     request.FormValue(\"lname\"),\n    Adres:          request.FormValue(\"adress\"),\n    Telefoonnummer: request.FormValue(\"phone\"),\n    Postcode:       request.FormValue(\"zipcode\"),\n    Email:          request.FormValue(\"email\"),\n    Status:         \"Je bestelling wordt bereid\",\n    Totaalprijs:    totaalprijs,\n    Order:          Pizzamap,\n}\n\nResultaat, err := json.MarshalIndent(klantmap, \"\", \"\\t\")\nif err != nil {\n    panic(err)\n}\n\nioutil.WriteFile(filebestelling, Resultaat, 0644)\nfmt.Sprintln(klantmap[index])\nbestellingTemplate.Execute(writer, klantmap[index])\n</code></pre>\n\n<p>}</p>\n\n<p>The HTML:</p>\n\n<pre><code>&lt;fieldset&gt;\n               &lt;legend&gt;Je bestelling:&lt;/legend&gt;\n                &lt;ul&gt;\n\n                    &lt;li&gt;\n                        &lt;p&gt;Naam: {{ .Naam }}&lt;br&gt;\n                        Tussenvoegsel: {{ .Tussenvoegsel }}&lt;br&gt;\n                        Achternaam: {{ .Achternaam }}&lt;br&gt;\n                        E-mail: {{ .Email }}&lt;br&gt;\n                        Telefoonnummer: {{ .Telefoonnummer }}&lt;br&gt;\n                        Status: {{ .Status }}&lt;br&gt;\n                        &lt;/p&gt;\n                        &lt;fieldset&gt;\n                            &lt;ul&gt;\n                        {{ range $key, $value := .Order }}\n                        &lt;li&gt;\n                         Pizzanaam: {{ $value.Naam }}  &lt;br&gt;\n                         Prijs: &amp;euro;{{ $value.Price | printf \"%.2f\" }}  &lt;br&gt;\n                         Aantal: {{ $value.Aantal }} &lt;br&gt;\n                        &lt;/li&gt;\n                        {{ end }} \n                        &lt;/ul&gt;\n                        &lt;/fieldset&gt;\n                        &lt;/p&gt;\n                    &lt;/li&gt;\n                    &lt;li&gt;Totaal: &amp;euro;{{ .totaalprijs | printf \"%.2f\" }}&lt;/li&gt;\n\n\n                &lt;/ul&gt;\n            &lt;/fieldset&gt;\n</code></pre>\n\n<p>The json file:</p>\n\n<pre><code>{\n\"0\": {\n    \"Naam\": \"Lucas\",\n    \"Tussenvoegsel\": \"de\",\n    \"Achternaam\": \"Groot\",\n    \"Adres\": \"Margrietlaan 37\",\n    \"Postcode\": \"6713PL\",\n    \"Telefoonnummer\": \"0617033981\",\n    \"Email\": \"keeperluuk@gmail.com\",\n    \"Status\": \"Je bestelling wordt bereid\",\n    \"Totaalprijs\": 0,\n    \"Order\": {\n        \"0\": {\n            \"Naam\": \"salami\",\n            \"Price\": 0,\n            \"Aantal\": 2\n        }\n    }\n}\n</code></pre>\n\n<p>The pizzas.json file:</p>\n\n<pre><code>{\n        \"name\":\"margherita\",\n        \"price\": 8.50,\n        \"desc\":\"tomaten saus, mozzarella en oregano\",\n        \"image\":\"./templates/margherita.png\"\n    },\n    {\n        \"name\":\"pepperoni\",\n        \"price\": 9.25,\n        \"desc\":\"tomatensaus, mozzarella en pepperoni\",\n        \"image\":\"./templates/pepperoni.png\"\n    }\n</code></pre>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1541602522, "post_id": 53191933, "comment_id": 93272625, "body": "<a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">github.com/go-yaml/yaml</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": false, "score": 0, "last_activity_date": 1541605253, "creation_date": 1541605253, "answer_id": 53192797, "question_id": 53191933, "link": "https://stackoverflow.com/questions/53191933/how-to-update-the-value-of-a-key-in-a-yaml-file-using-golang/53192797#53192797", "title": "How to update the value of a key in a .yaml file using golang?", "body": "<p>To update the value of a key in a yaml file</p>\n\n<ol>\n<li>You need to deserialize(means store []byte array to go object) yaml file content</li>\n<li>Then Update what you expect</li>\n<li>Finally serialize (means store go object to []byte array) and rewrite into file</li>\n</ol>\n\n<p>Ref: <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">https://github.com/go-yaml/yaml</a>. That's it!.</p>\n"}], "owner": {"reputation": 23, "user_id": 8187036, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d774ec5d1bad40c40f28f11ac952aaf9?s=128&d=identicon&r=PG&f=1", "display_name": "shoaib", "link": "https://stackoverflow.com/users/8187036/shoaib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 952, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1541605762, "creation_date": 1541602421, "last_edit_date": 1541605762, "question_id": 53191933, "link": "https://stackoverflow.com/questions/53191933/how-to-update-the-value-of-a-key-in-a-yaml-file-using-golang", "title": "How to update the value of a key in a .yaml file using golang?", "body": "<p>How to update the value of a key in a yaml file using go language?</p>\n"}, {"tags": ["debugging", "go", "delve"], "comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 1, "creation_date": 1541602751, "post_id": 53191672, "comment_id": 93272782, "body": "dlv is a debugger, its not an interpreter. If you have a variable in your code, which contains the data. You can type <code>print(variableName)</code> and you will get that."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 1, "creation_date": 1541607798, "post_id": 53191672, "comment_id": 93276001, "body": "delve in go 1.11 supports functions as an experimental feature.  pdb is easier to implement as python isn&#39;t a fully compiled language"}], "answers": [{"tags": [], "owner": {"reputation": 3406, "user_id": 798575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68c48a99ec334bd0a1ebe3cd10b39915?s=128&d=identicon&r=PG", "display_name": "alanjds", "link": "https://stackoverflow.com/users/798575/alanjds"}, "is_accepted": true, "score": 1, "last_activity_date": 1543520227, "creation_date": 1543520227, "answer_id": 53546341, "question_id": 53191672, "link": "https://stackoverflow.com/questions/53191672/debugging-with-delve-execute-function/53546341#53546341", "title": "Debugging with Delve: execute function", "body": "<p>Not possible yet. <em>Right now</em> (2018-NOV) work is <a href=\"https://github.com/derekparker/delve/issues/119#ref-commit-2925c03\" rel=\"nofollow noreferrer\">in progress</a> on Delve, but unfinished.</p>\n\n<p>Go runtime <a href=\"https://github.com/golang/go/issues/21678\" rel=\"nofollow noreferrer\">was changed</a> recently to allow this kind of call. Delve have a <a href=\"https://github.com/derekparker/delve/issues/119\" rel=\"nofollow noreferrer\">Github issue</a> tracking the progress of such feature, but is still experimental and incomplete.</p>\n"}], "owner": {"reputation": 7294, "user_id": 4183498, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/USkeW.jpg?s=128&g=1", "display_name": "Du\u0161an Ma\u010far", "link": "https://stackoverflow.com/users/4183498/du%c5%a1an-ma%c4%8far"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3144, "favorite_count": 0, "accepted_answer_id": 53546341, "answer_count": 1, "score": 4, "last_activity_date": 1565435597, "creation_date": 1541601620, "last_edit_date": 1565435538, "question_id": 53191672, "link": "https://stackoverflow.com/questions/53191672/debugging-with-delve-execute-function", "title": "Debugging with Delve: execute function", "body": "<p>I setup a breakpoint in my Go code with <code>runtime.Breakpoint()</code>, save the file (my editor, Atom with <a href=\"https://atom.io/packages/go-plus\" rel=\"nofollow noreferrer\">go-plus installed</a>, runs <code>go install .</code> on save). Then I run Delve in terminal with <code>dlv debug</code>, and type <code>continue</code> after it starts.</p>\n\n<p>When the breakpoint kicks in, I want to test a couple of things (basically to print reader's data <a href=\"https://stackoverflow.com/a/9649061/55504\">via a <code>bytes.Buffer</code></a>). But, I get the following error </p>\n\n<pre><code>buf := new(bytes.Buffer): \"1:5: expected 'EOF', found ':='\"\n</code></pre>\n\n<p>and in general cannot do much more than print values.</p>\n\n<p>Is it really not possible to do this sort of thing? I am used to Python's <code>pdb</code> where setting variables or calling functions is not a problem and I would expect Delve is capable of the same. </p>\n\n<p>So, what am I doing wrong?</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1541596517, "post_id": 53190146, "comment_id": 93269191, "body": "If you need help: Post the relevant details, which means a minimal example showing the problem."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10618430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a2a73ee7702971e50a18ea2c0fcc007?s=128&d=identicon&r=PG&f=1", "display_name": "L.Groot", "link": "https://stackoverflow.com/users/10618430/l-groot"}, "edited": false, "score": 0, "creation_date": 1541598927, "post_id": 53190816, "comment_id": 93270504, "body": "I already changed it, but when I make a new order it isn&#39;t saved in the json file. It just says: &quot;Order&quot;: {}"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 1, "user_id": 10618430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a2a73ee7702971e50a18ea2c0fcc007?s=128&d=identicon&r=PG&f=1", "display_name": "L.Groot", "link": "https://stackoverflow.com/users/10618430/l-groot"}, "edited": false, "score": 0, "creation_date": 1541599246, "post_id": 53190816, "comment_id": 93270660, "body": "Are you getting the same error? Post an update if you are getting a different error."}, {"owner": {"reputation": 1, "user_id": 10618430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a2a73ee7702971e50a18ea2c0fcc007?s=128&d=identicon&r=PG&f=1", "display_name": "L.Groot", "link": "https://stackoverflow.com/users/10618430/l-groot"}, "edited": false, "score": 0, "creation_date": 1541600489, "post_id": 53190816, "comment_id": 93271378, "body": "I don&#39;t get the error anymore but it still doesn&#39;t show my data in the json file"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 1, "user_id": 10618430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a2a73ee7702971e50a18ea2c0fcc007?s=128&d=identicon&r=PG&f=1", "display_name": "L.Groot", "link": "https://stackoverflow.com/users/10618430/l-groot"}, "edited": false, "score": 0, "creation_date": 1541600913, "post_id": 53190816, "comment_id": 93271626, "body": "I think that this is getting far from the original question. It would be better if you just  post a concise part of the code that you are having trouble from."}, {"owner": {"reputation": 1, "user_id": 10618430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a2a73ee7702971e50a18ea2c0fcc007?s=128&d=identicon&r=PG&f=1", "display_name": "L.Groot", "link": "https://stackoverflow.com/users/10618430/l-groot"}, "edited": false, "score": 0, "creation_date": 1541601834, "post_id": 53190816, "comment_id": 93272165, "body": "But i don&#39;t know where the trouble is located. If i knew i would give you the exact location"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 1, "user_id": 10618430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a2a73ee7702971e50a18ea2c0fcc007?s=128&d=identicon&r=PG&f=1", "display_name": "L.Groot", "link": "https://stackoverflow.com/users/10618430/l-groot"}, "edited": false, "score": 0, "creation_date": 1541602039, "post_id": 53190816, "comment_id": 93272290, "body": "Have you tried using <code>Pizzamap</code> instead of <code>Pizzabesteld</code> as I suggested?"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 1, "user_id": 10618430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a2a73ee7702971e50a18ea2c0fcc007?s=128&d=identicon&r=PG&f=1", "display_name": "L.Groot", "link": "https://stackoverflow.com/users/10618430/l-groot"}, "edited": false, "score": 0, "creation_date": 1541602584, "post_id": 53190816, "comment_id": 93272668, "body": "If you are satisfied with this answer, accept this answer so that this question will not be classified as &quot;Unanswered&quot;. <a href=\"https://stackoverflow.com/help/someone-answers\">stackoverflow.com/help/someone-answers</a>"}, {"owner": {"reputation": 1, "user_id": 10618430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a2a73ee7702971e50a18ea2c0fcc007?s=128&d=identicon&r=PG&f=1", "display_name": "L.Groot", "link": "https://stackoverflow.com/users/10618430/l-groot"}, "edited": false, "score": 0, "creation_date": 1541602598, "post_id": 53190816, "comment_id": 93272677, "body": "but can you also help me with showing the total price of the order?"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 1, "user_id": 10618430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a2a73ee7702971e50a18ea2c0fcc007?s=128&d=identicon&r=PG&f=1", "display_name": "L.Groot", "link": "https://stackoverflow.com/users/10618430/l-groot"}, "edited": false, "score": 0, "creation_date": 1541602766, "post_id": 53190816, "comment_id": 93272798, "body": "I think that is for another question. Stackoverflow is not meant for us to debug every part of your code. <a href=\"https://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a>"}, {"owner": {"reputation": 1, "user_id": 10618430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a2a73ee7702971e50a18ea2c0fcc007?s=128&d=identicon&r=PG&f=1", "display_name": "L.Groot", "link": "https://stackoverflow.com/users/10618430/l-groot"}, "edited": false, "score": 0, "creation_date": 1541602929, "post_id": 53190816, "comment_id": 93272944, "body": "i know but that&#39;s what i&#39;m working for like 5 days now"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "reply_to_user": {"reputation": 1, "user_id": 10618430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a2a73ee7702971e50a18ea2c0fcc007?s=128&d=identicon&r=PG&f=1", "display_name": "L.Groot", "link": "https://stackoverflow.com/users/10618430/l-groot"}, "edited": false, "score": 0, "creation_date": 1541603369, "post_id": 53190816, "comment_id": 93273265, "body": "I&#39;m sorry but you need to make an effort for us to easily understand this. I suggest you read on this <a href=\"https://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a>. Moreover, you can create a minimal example using <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">play.golang.org</a> so that we can help you easier. Also, when posting code, I suggest to make the variable names a little bit easier to understand for English speakers. I believe that this has already answered not just your original question but even the edits that you made. Happy coding!"}], "tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": false, "score": 1, "last_activity_date": 1541601326, "last_edit_date": 1541601326, "creation_date": 1541598662, "answer_id": 53190816, "question_id": 53190146, "link": "https://stackoverflow.com/questions/53190146/why-isnt-my-order-data-saved-in-my-json-file/53190816#53190816", "title": "Why isn&#39;t my order data saved in my json file", "body": "<blockquote>\n  <p>cannot unmarshal string into Go struct field PizzaOrder.Price of type float64</p>\n</blockquote>\n\n<p>This makes it clear that a string is trying to be decoded into a float</p>\n\n<p>Looking at your type definition:</p>\n\n<pre><code>type PizzaOrder struct {\n    Naam   string\n    Price  float64 // &lt;-- expects float\n    Aantal int     // &lt;-- expects int\n}\n</code></pre>\n\n<p>Your input will really not be unmarshal'ed because <code>Price</code> and <code>Aantal</code> are <code>string</code> instead of <code>float64</code> and <code>int</code> respectively</p>\n\n<pre><code>\"Order\": {\n    \"0\": {\n        \"Naam\": \"\",\n        \"Price\": \"\", // &lt;-- string\n        \"Aantal\": \"\" // &lt;-- string\n    }\n}\n</code></pre>\n\n<p>Should be</p>\n\n<pre><code>\"Order\": {\n    \"0\": {\n        \"Naam\": \"\",\n        \"Price\": 0,\n        \"Aantal\": 0\n    }\n}\n</code></pre>\n\n<p><strong>Edit 1:</strong></p>\n\n<p>Shouldn't</p>\n\n<pre><code>Pizzabesteld[index] = PizzaOrder{\n</code></pre>\n\n<p>Be</p>\n\n<pre><code>Pizzamap[index] = PizzaOrder{\n</code></pre>\n\n<p>? You are trying to output <code>Pizzamap</code> but it is actually an empty map.</p>\n"}], "owner": {"reputation": 1, "user_id": 10618430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a2a73ee7702971e50a18ea2c0fcc007?s=128&d=identicon&r=PG&f=1", "display_name": "L.Groot", "link": "https://stackoverflow.com/users/10618430/l-groot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1541601326, "creation_date": 1541596242, "last_edit_date": 1541599816, "question_id": 53190146, "link": "https://stackoverflow.com/questions/53190146/why-isnt-my-order-data-saved-in-my-json-file", "title": "Why isn&#39;t my order data saved in my json file", "body": "<p>If I send data to my json file, it sends all the data of the customer, but not the data of my order. I think my code doesn't convert the types right, but I can't find the location. I think it's located somewhere in the pizzamap, but i can't find a error.</p>\n\n<p>The Handler: </p>\n\n<pre><code>func bestellingHandler(writer http.ResponseWriter, request *http.Request) {\nlog.Println(\"Viewing bestellingen\")\nbestellingTemplate, _ := template.ParseFiles(\"./templates/Bestellingen.htm\")\n\n// laad de pizza's uit de data file\n\nfmt.Println(request.Method)\nfmt.Println(request.Form)\nfmt.Println(request.PostFormValue(\"name\"))\n\nfilepizza := \"./data/pizzas.json\"\nReadpizza, err := ioutil.ReadFile(filepizza)\n\nvar Pizzaslice []Pizza\n\nerr = json.Unmarshal(Readpizza, &amp;Pizzaslice)\nif err != nil {\n    panic(err)\n}\n\nPizzamap := make(map[string]PizzaOrder)\nvar totaalprijs float64\nfor i := 0; i &lt; (len(Pizzaslice)); i++ {\n\n    index := strconv.Itoa(i)\n    aantalpizzas, _ := strconv.Atoi(request.FormValue(\"aantal_\" + Pizzaslice[i].Name))\n    prijspizzas, _ := strconv.ParseFloat(request.FormValue(\"price\"+Pizzaslice[i].Name), 64)\n    if aantalpizzas != 0 {\n\n        Pizzabesteld[index] = PizzaOrder{\n            Naam:   request.FormValue(\"name\" + Pizzaslice[i].Name),\n            Price:  prijspizzas,\n            Aantal: aantalpizzas,\n        }\n\n        fmt.Println(Pizzabesteld)\n        totaalprijs += float64(aantalpizzas) * prijspizzas\n    }\n}\n\nfilebestelling := \"./data/deck.json\"\nReadbestelling, err := ioutil.ReadFile(filebestelling)\n\nvar klantmap map[string]Klant\n\nerr = json.Unmarshal(Readbestelling, &amp;klantmap)\nif err != nil {\n    panic(err)\n}\nindex := strconv.Itoa(len(klantmap))\nklantmap[index] = Klant{\n    Naam:           request.FormValue(\"naam\"),\n    Tussenvoegsel:  request.FormValue(\"tussenv\"),\n    Achternaam:     request.FormValue(\"lname\"),\n    Adres:          request.FormValue(\"adress\"),\n    Telefoonnummer: request.FormValue(\"phone\"),\n    Postcode:       request.FormValue(\"zipcode\"),\n    Email:          request.FormValue(\"email\"),\n    Status:         \"Je bestelling wordt bereid\",\n    Totaalprijs:    totaalprijs,\n    Order:          Pizzamap,\n}\n\nResultaat, err := json.MarshalIndent(klantmap, \"\", \"\\t\")\nif err != nil {\n    panic(err)\n}\n\nioutil.WriteFile(filebestelling, Resultaat, 0644)\nfmt.Sprintln(klantmap[index])\nbestellingTemplate.Execute(writer, klantmap[index])\n</code></pre>\n\n<p>}</p>\n\n<p>The HTML:</p>\n\n<pre><code>&lt;fieldset&gt;\n               &lt;legend&gt;Je bestelling:&lt;/legend&gt;\n                &lt;ul&gt;\n\n                    &lt;li&gt;\n                        &lt;p&gt;Naam: {{ .Naam }}&lt;br&gt;\n                        Tussenvoegsel: {{ .Tussenvoegsel }}&lt;br&gt;\n                        Achternaam: {{ .Achternaam }}&lt;br&gt;\n                        E-mail: {{ .Email }}&lt;br&gt;\n                        Telefoonnummer: {{ .Telefoonnummer }}&lt;br&gt;\n                        Status: {{ .Status }}&lt;br&gt;\n                        &lt;fieldset&gt;\n                            &lt;ul&gt;\n                        {{range $key, $value := .Order}}\n                        &lt;li&gt;\n                         Pizzanaam: {{ $value.Naam }}  &lt;br&gt;\n                         Prijs: &amp;euro;{{ $value.Price | printf \"%.2f\" }}  &lt;br&gt;\n                         Aantal: {{ $value.Aantal }} &lt;br&gt;\n                        &lt;/li&gt;\n                        {{end}} \n                        &lt;/ul&gt;\n                        &lt;/fieldset&gt;\n                        &lt;/p&gt;\n                    &lt;/li&gt;\n                    &lt;li&gt;Totaal: &amp;euro;{{ .totaalprijs | printf \"%.2f\" }}&lt;/li&gt;\n\n\n                &lt;/ul&gt;\n            &lt;/fieldset&gt;\n</code></pre>\n\n<p>The Structures:</p>\n\n<pre><code>type PizzaOrder struct {\nNaam   string\nPrice  float64\nAantal int\n</code></pre>\n\n<p>}</p>\n\n<p>this is what it shows in my json file</p>\n\n<p>The json:</p>\n\n<pre><code>\"0\": {\n    \"Naam\": \"Lucas\",\n    \"Tussenvoegsel\": \"de\",\n    \"Achternaam\": \"Groot\",\n    \"Adres\": \"Margrietlaan 37\",\n    \"Postcode\": \"6713PL\",\n    \"Telefoonnummer\": \"03958321\",\n    \"Email\": \"k@gmail.com\",\n    \"Status\": \"Je bestelling wordt bereid\",\n    \"Totaalprijs\": 0,\n    \"Order\": {\n        \"0\": {\n            \"Naam\": \"salami\",\n            \"Price\": 0,\n            \"Aantal\": 2\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["ssl", "go", "memory-leaks", "tls1.2"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1541595680, "post_id": 53189316, "comment_id": 93268755, "body": "Keep-Alive is enabled by default. Call <a href=\"https://golang.org/pkg/net/http/#Server.SetKeepAlivesEnabled\" rel=\"nofollow noreferrer\"><code>s.SetKeepAlivesEnabled(false)</code></a> to disable it (but verify that this actually works for HTTP 2.0). In any case, the IdleTimeout should indeed close idle connections automatically. How many active connections are there when the memory consumption is high? Is the server directly exposed to the Internet or is there a proxy involved?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1541599903, "post_id": 53189316, "comment_id": 93271042, "body": "&#171;memory keeps growing and growing&#187; \u2014 from the chart, I would say memory gets allocated and then freed, oscillating around certain mean value \u2014 exactly as I&#39;d expect from a GC&#39;ed runtime. Or does those drops on the chart mean restarts of your applications?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1541602290, "post_id": 53189316, "comment_id": 93272479, "body": "@kostix if you look at the time intervals, no way that&#39;s GC, these are daily more or less. probably deployments?"}, {"owner": {"reputation": 15031, "user_id": 1256496, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/hlmB0.jpg?s=128&g=1", "display_name": "zemirco", "link": "https://stackoverflow.com/users/1256496/zemirco"}, "edited": false, "score": 0, "creation_date": 1541603230, "post_id": 53189316, "comment_id": 93273169, "body": "There is no proxy in front of it. The server is directly exposed to the internet. Those drops aren&#39;t restarts. Restarts happened between October 21 and October 28 where the memory didn&#39;t have time to grow as much. I think the drops are due to the <code>oom killer</code>. I would also say the time spans are too long for being caused by the GC."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1541605456, "post_id": 53189316, "comment_id": 93274642, "body": "Yep, you&#39;re both correct on this: I did not pay attention to the scale of the X axis."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1541605730, "post_id": 53189316, "comment_id": 93274818, "body": "I&#39;d <a href=\"https://github.com/golang/go/issues?utf8=%E2%9C%93&amp;q=is%3Aissue+in%3Atitle+tls+leak\" rel=\"nofollow noreferrer\">hit the issue tracker</a> by now. Please post the issue number here if you&#39;ll do that. I, for one, would be interested to follow."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1541622269, "post_id": 53189316, "comment_id": 93283007, "body": "Yes, please do. I&#39;ve been trying to track this down for months. Learned a lot about <code>go tool pprof</code> but am no closer to a solution than I was when my program first ran into its container&#39;s memory limit..."}, {"owner": {"reputation": 15031, "user_id": 1256496, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/hlmB0.jpg?s=128&g=1", "display_name": "zemirco", "link": "https://stackoverflow.com/users/1256496/zemirco"}, "edited": false, "score": 1, "creation_date": 1541665103, "post_id": 53189316, "comment_id": 93295646, "body": "I created an issue <a href=\"https://github.com/golang/go/issues/28654\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/28654</a>. If you&#39;ve got the same issue and can provide additional information please do so."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1541682834, "post_id": 53189316, "comment_id": 93304888, "body": "@zemirco, thank you! +1 for such a definitive bug report."}], "answers": [{"tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": false, "score": 1, "last_activity_date": 1549039501, "creation_date": 1549039501, "answer_id": 54483711, "question_id": 53189316, "link": "https://stackoverflow.com/questions/53189316/golang-web-server-leaking-memory-at-crypto-tls-block-reserve/54483711#54483711", "title": "Golang web server leaking memory at crypto/tls.(*block).reserve", "body": "<p>Adding an answer so this doesn't keep showing up in the list of upvoted and unanswered questions.</p>\n\n<p>It appears that the memory leak was related to the gorilla context bug <a href=\"https://github.com/gorilla/sessions/commit/12bd4761fc66ac946e16fcc2a32b1e0b066f6177\" rel=\"nofollow noreferrer\">https://github.com/gorilla/sessions/commit/12bd4761fc66ac946e16fcc2a32b1e0b066f6177</a> and had nothing to do with tls in the stdlib.</p>\n"}], "owner": {"reputation": 15031, "user_id": 1256496, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/hlmB0.jpg?s=128&g=1", "display_name": "zemirco", "link": "https://stackoverflow.com/users/1256496/zemirco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 569, "favorite_count": 2, "answer_count": 1, "score": 10, "last_activity_date": 1549039501, "creation_date": 1541593055, "last_edit_date": 1545320520, "question_id": 53189316, "link": "https://stackoverflow.com/questions/53189316/golang-web-server-leaking-memory-at-crypto-tls-block-reserve", "title": "Golang web server leaking memory at crypto/tls.(*block).reserve", "body": "<p>I've got a web server written in Go.</p>\n\n<pre><code>tlsConfig := &amp;tls.Config{\n    PreferServerCipherSuites: true,\n    MinVersion:               tls.VersionTLS12,\n    CurvePreferences: []tls.CurveID{\n        tls.CurveP256,\n        tls.X25519,\n    },\n    CipherSuites: []uint16{\n        tls.TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,\n        tls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,\n        tls.TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,\n        tls.TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,\n        tls.TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,\n        tls.TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,\n    },\n}\n\ns := &amp;http.Server{\n    ReadTimeout:  5 * time.Second,\n    WriteTimeout: 10 * time.Second,\n    IdleTimeout:  120 * time.Second,\n    Handler:      r, // where r is my router\n    TLSConfig:    tlsConfig,\n}\n\n// redirect http to https\nredirect := &amp;http.Server{\n    ReadTimeout:  5 * time.Second,\n    WriteTimeout: 10 * time.Second,\n    IdleTimeout:  120 * time.Second,\n    Handler: http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Connection\", \"close\")\n        url := \"https://\" + r.Host + r.URL.String()\n        http.Redirect(w, r, url, http.StatusMovedPermanently)\n    }),\n}\ngo func() {\n    log.Fatal(redirect.ListenAndServe())\n}()\n\nlog.Fatal(s.ListenAndServeTLS(certFile, keyFile))\n</code></pre>\n\n<p>Here is a screenshot from my Digital Ocean dashboard.</p>\n\n<p><a href=\"https://i.stack.imgur.com/ZbZpX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ZbZpX.png\" alt=\"enter image description here\"></a></p>\n\n<p>As you can see memory keeps growing and growing. So I started looking at <a href=\"https://github.com/google/pprof\" rel=\"nofollow noreferrer\">https://github.com/google/pprof</a>. Here is the output of <code>top5</code>.</p>\n\n<pre><code>Type: inuse_space\nTime: Nov 7, 2018 at 10:31am (CET)\nEntering interactive mode (type \"help\" for commands, \"o\" for options)\n(pprof) top5\nShowing nodes accounting for 289.50MB, 79.70% of 363.24MB total\nDropped 90 nodes (cum &lt;= 1.82MB)\nShowing top 5 nodes out of 88\n      flat  flat%   sum%        cum   cum%\n  238.98MB 65.79% 65.79%   238.98MB 65.79%  crypto/tls.(*block).reserve\n   20.02MB  5.51% 71.30%    20.02MB  5.51%  crypto/tls.Server\n   11.50MB  3.17% 74.47%    11.50MB  3.17%  crypto/aes.newCipher\n   10.50MB  2.89% 77.36%    10.50MB  2.89%  crypto/aes.(*aesCipherGCM).NewGCM\n</code></pre>\n\n<p>The SVG shows the same huge amount of memory allocated by crypto/tls.(*block).reserve.</p>\n\n<p><a href=\"https://i.stack.imgur.com/FxbfZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/FxbfZ.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here is the exact code.</p>\n\n<p><a href=\"https://i.stack.imgur.com/59VOT.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/59VOT.png\" alt=\"enter image description here\"></a></p>\n\n<p>I spent the last days reading every article, document, blog post, source code, help file I could find. However nothing helps. The code is running on a Ubuntu 17.10 x64 machine using Go 1.11 inside a Docker container.</p>\n\n<p>It looks like the server doesn't close the connections to the client. I thought setting all the <code>xyzTimeout</code> would help but it didn't.</p>\n\n<p>Any ideas?</p>\n\n<p>Edit 12/20/2018:</p>\n\n<p>fixed now <a href=\"https://github.com/golang/go/issues/28654#issuecomment-448477056\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/28654#issuecomment-448477056</a></p>\n"}, {"tags": ["go", "out-of-memory", "runtime"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 10617937, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-e9M0gQ6ifEE/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbAxTt_wC0lWSiYn_JBEW3RB9XDEFQ/mo/photo.jpg?sz=128", "display_name": "nhujter", "link": "https://stackoverflow.com/users/10617937/nhujter"}, "edited": false, "score": 0, "creation_date": 1541661680, "post_id": 53189404, "comment_id": 93294232, "body": "Thanks a lot about the explanation of the stack trace.  It really helps to find out the bug in my code.  My problem has been solved"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 23, "user_id": 10617937, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-e9M0gQ6ifEE/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbAxTt_wC0lWSiYn_JBEW3RB9XDEFQ/mo/photo.jpg?sz=128", "display_name": "nhujter", "link": "https://stackoverflow.com/users/10617937/nhujter"}, "edited": false, "score": 0, "creation_date": 1541662269, "post_id": 53189404, "comment_id": 93294451, "body": "@nhujter Glad to hear that. If this solves your problem, you should consider accepting and upvoting the answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1541602415, "last_edit_date": 1541602415, "creation_date": 1541593358, "answer_id": 53189404, "question_id": 53188646, "link": "https://stackoverflow.com/questions/53188646/runtime-out-of-memory-with-still-memory/53189404#53189404", "title": "runtime: out of memory with still memory", "body": "<p>Analyzing the stack trace, it looks you are attempting to allocate a far-too-large slice here: <code>db_template.XCludeList.getAllCombinationComplex()</code></p>\n\n<pre><code>indexdb/db_template.XCludeList.getAllCombinationComplex(0xea4382c480, 0x8, 0x9, 0xe4ec1dc460, 0x4, 0x4, 0x0, 0x0, 0x0)\n    /home/scmbuild/workspaces_cluster/index/src/indexdb/db_template/db.go:145 +0x371 fp=0xea27f3ca88 sp=0xea27f3c900\n</code></pre>\n\n<p>This calls into <code>runtime.makeslice()</code>:</p>\n\n<pre><code>runtime.makeslice(0xa38840, 0x3ecc38680, 0x3ecc38680, 0x0, 0x0, 0x0)\n    /usr/local/go1.6.2/src/runtime/slice.go:32 +0x165 fp=0xea27f3c900 sp=0xea27f3c8b0\n</code></pre>\n\n<p>The source code for <code>runtime.makeslice()</code> for Go 1.6 is here: <a href=\"https://github.com/golang/go/blob/release-branch.go1.6/src/runtime/slice.go\" rel=\"nofollow noreferrer\">slice.go:</a></p>\n\n<pre><code>func makeslice(t *slicetype, len64, cap64 int64) slice {\n    ...\n}\n</code></pre>\n\n<p>And it is called with params:</p>\n\n<pre><code>runtime.makeslice(0xa38840, 0x3ecc38680, 0x3ecc38680, 0x0, 0x0, 0x0)\n</code></pre>\n\n<p>The second value is the length, which is</p>\n\n<pre><code>0x3ecc38680 = 16857138816\n</code></pre>\n\n<p>You attempt to create a slice with more than 16*10<sup>9</sup> elements. If the element type of the slice would require the minimum of 1 byte (excluding the zero-sized types), this would be roughly 16 GB! And this is just a lower estimation. Obviously this operation cannot succeed with 8 GB of RAM available.</p>\n\n<p>Also, please update your Go, 1.6.2 is almost 3 years old, not supported anymore (doesn't even receive security patches).</p>\n"}], "owner": {"reputation": 23, "user_id": 10617937, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-e9M0gQ6ifEE/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbAxTt_wC0lWSiYn_JBEW3RB9XDEFQ/mo/photo.jpg?sz=128", "display_name": "nhujter", "link": "https://stackoverflow.com/users/10617937/nhujter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4821, "favorite_count": 1, "accepted_answer_id": 53189404, "answer_count": 1, "score": 2, "last_activity_date": 1541605068, "creation_date": 1541590302, "last_edit_date": 1541605068, "question_id": 53188646, "link": "https://stackoverflow.com/questions/53188646/runtime-out-of-memory-with-still-memory", "title": "runtime: out of memory with still memory", "body": "<p>an extremely weird problem happened recently. my program was running on a docker which has 8GB memory and 4GB was used when the panic happened. there were more than 4GB memory available, why could this happen? below is the panic stack output.</p>\n\n<pre><code># ulimit -m\nunlimited\n\n# go version\n1.6.2\n</code></pre>\n\n<p>i tried to run the code line <code>getAllCombinationComplex</code> repeatedly, and the memory-used grew to about 5GB but the panic did not happen again. </p>\n\n<pre><code>fatal error: runtime: out of memory\n\nruntime stack:\nruntime.throw(0xd28a90, 0x16)\n        /usr/local/go1.6.2/src/runtime/panic.go:547 +0x90\nruntime.sysMap(0xf409e80000, 0x3ecc390000, 0x434a00, 0x1080918)\n        /usr/local/go1.6.2/src/runtime/mem_linux.go:206 +0x9b\nruntime.(*mheap).sysAlloc(0x1066280, 0x3ecc390000, 0xdfc4d6d680)\n        /usr/local/go1.6.2/src/runtime/malloc.go:429 +0x191\nruntime.(*mheap).grow(0x1066280, 0x1f661c8, 0x0)\n        /usr/local/go1.6.2/src/runtime/mheap.go:651 +0x63\nruntime.(*mheap).allocSpanLocked(0x1066280, 0x1f661c4, 0x10677f0)\n        /usr/local/go1.6.2/src/runtime/mheap.go:553 +0x4f6\nruntime.(*mheap).alloc_m(0x1066280, 0x1f661c4, 0xffffff0100000000, 0x7ff85dbfddd0)\n        /usr/local/go1.6.2/src/runtime/mheap.go:437 +0x119\nruntime.(*mheap).alloc.func1()\n        /usr/local/go1.6.2/src/runtime/mheap.go:502 +0x41\nruntime.systemstack(0x7ff85dbfdde8)\n        /usr/local/go1.6.2/src/runtime/asm_amd64.s:307 +0xab\nruntime.(*mheap).alloc(0x1066280, 0x1f661c4, 0x10100000000, 0x41587c)\n        /usr/local/go1.6.2/src/runtime/mheap.go:503 +0x63\nruntime.largeAlloc(0x3ecc386800, 0x7ff800000000, 0x6)\n        /usr/local/go1.6.2/src/runtime/malloc.go:766 +0xb3\nruntime.mallocgc.func3()\n        /usr/local/go1.6.2/src/runtime/malloc.go:664 +0x33\nruntime.systemstack(0xc820028000)\n        /usr/local/go1.6.2/src/runtime/asm_amd64.s:291 +0x79\nruntime.mstart()\n        /usr/local/go1.6.2/src/runtime/proc.go:1051\n\ngoroutine 63798322149 [running]:\nruntime.systemstack_switch()\n        /usr/local/go1.6.2/src/runtime/asm_amd64.s:245 fp=0xea27f3c798 sp=0xea27f3c790\nruntime.mallocgc(0x3ecc386800, 0xa572e0, 0x0, 0xec6c1e8000)\n        /usr/local/go1.6.2/src/runtime/malloc.go:665 +0x9eb fp=0xea27f3c870 sp=0xea27f3c798\nruntime.newarray(0xa572e0, 0x3ecc38680, 0x2)\n        /usr/local/go1.6.2/src/runtime/malloc.go:798 +0xc9 fp=0xea27f3c8b0 sp=0xea27f3c870\nruntime.makeslice(0xa38840, 0x3ecc38680, 0x3ecc38680, 0x0, 0x0, 0x0)\n        /usr/local/go1.6.2/src/runtime/slice.go:32 +0x165 fp=0xea27f3c900 sp=0xea27f3c8b0\nindexdb/db_template.XCludeList.getAllCombinationComplex(0xea4382c480, 0x8, 0x9, 0xe4ec1dc460, 0x4, 0x4, 0x0, 0x0, 0x0)\n        /home/scmbuild/workspaces_cluster/index/src/indexdb/db_template/db.go:145 +0x371 fp=0xea27f3ca88\n sp=0xea27f3c900\nindexdb/db_template.XCludeList.getAllCombinationComplex(0xea4382c480, 0x8, 0x9, 0xe4ec1dc438, 0x5, 0x5, 0x0, 0x0, 0x0)\n        /home/scmbuild/workspaces_cluster/index/src/indexdb/db_template/db.go:141 +0x2ee fp=0xea27f3cc10\n sp=0xea27f3ca88\nindexdb/db_template.XCludeList.getAllCombinationComplex(0xea4382c480, 0x8, 0x9, 0xe4ec1dc410, 0x6, 0x6, 0x0, 0x0, 0x0)\n        /home/scmbuild/workspaces_cluster/index/src/indexdb/db_template/db.go:141 +0x2ee fp=0xea27f3cd98\n sp=0xea27f3cc10\nindexdb/db_template.XCludeList.getAllCombinationComplex(0xea4382c480, 0x8, 0x9, 0xe4ec1dc3e8, 0x7, 0x7, 0x0, 0x0, 0x0)\n        /home/scmbuild/workspaces_cluster/index/src/indexdb/db_template/db.go:141 +0x2ee fp=0xea27f3cf20\n sp=0xea27f3cd98\nindexdb/db_template.XCludeList.getAllCombinationComplex(0xea4382c480, 0x8, 0x9, 0xe4ec1dc3c0, 0x8, 0x8, 0x0, 0x0, 0x0)\n        /home/scmbuild/workspaces_cluster/index/src/indexdb/db_template/db.go:141 +0x2ee fp=0xea27f3d0a8\n sp=0xea27f3cf20\nindexdb/db_template.XCludeList.GetAllCombinationString(0xea4382c480, 0x8, 0x9, 0x0, 0x0, 0x0)\n        /home/scmbuild/workspaces_cluster/index/src/indexdb/db_template/db.go:114 +0x530 fp=0xea27f3d398\n sp=0xea27f3d0a8\nindexdb/mem.MemDB.QueryCountersFullMatchByTags(0xead2bf0003, 0x38, 0xead2bf0043, 0x10, 0xea4382c480, 0x8, 0x9, 0x0, 0x0, 0x0, ...)\n        /home/scmbuild/workspaces_cluster/index/src/indexdb/mem/mem.go:391 +0x1f5 fp=0xea27f3d670 sp=0xe\na27f3d398\nindexdb/mem.(*MemDB).QueryCountersFullMatchByTags(0x107e7b8, 0xead2bf0003, 0x38, 0xead2bf0043, 0x10, 0xea4382c480, 0x8, 0x9, 0x0, 0x0, ...)\n        &lt;autogenerated&gt;:10 +0x112 fp=0xea27f3d6d8 sp=0xea27f3d670\nrouter.QCountersFullMatchByTags(0xd2745f5ef0)\n        /home/scmbuild/workspaces_cluster/index/src/router/http.go:505 +0x54a fp=0xea27f3d8d8 sp=0xea27f\n3d6d8\ngithub.com/gin-gonic/gin.(*Context).Next(0xd2745f5ef0)\n        /home/scmbuild/workspaces_cluster/index/deps/src/github.com/gin-gonic/gin/context.go:110 +0x7a f\np=0xea27f3d908 sp=0xea27f3d8d8\ngithub.com/gin-gonic/gin.RecoveryWithWriter.func1(0xd2745f5ef0)\n        /home/scmbuild/workspaces_cluster/index/deps/src/github.com/gin-gonic/gin/recovery.go:45 +0x51 f\np=0xea27f3d930 sp=0xea27f3d908\ngithub.com/gin-gonic/gin.(*Context).Next(0xd2745f5ef0)\n        /home/scmbuild/workspaces_cluster/index/deps/src/github.com/gin-gonic/gin/context.go:110 +0x7a f\np=0xea27f3d960 sp=0xea27f3d930\ngithub.com/gin-gonic/gin.(*Engine).handleHTTPRequest(0xd4d0bd2360, 0xd2745f5ef0)\n        /home/scmbuild/workspaces_cluster/index/deps/src/github.com/gin-gonic/gin/gin.go:337 +0x2fd fp=0\nxea27f3dae8 sp=0xea27f3d960\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP(0xd4d0bd2360, 0x7ff7611f00b0, 0xdb6777f1e0, 0xd6e25a0700)\n        /home/scmbuild/workspaces_cluster/index/deps/src/github.com/gin-gonic/gin/gin.go:301 +0x197 fp=0\nxea27f3db60 sp=0xea27f3dae8\nnet/http.serverHandler.ServeHTTP(0xd129858080, 0x7ff7611f00b0, 0xdb6777f1e0, 0xd6e25a0700)\n        /usr/local/go1.6.2/src/net/http/server.go:2081 +0x19e fp=0xea27f3dbc0 sp=0xea27f3db60\nnet/http.(*conn).serve(0xce774f1400)\n        /usr/local/go1.6.2/src/net/http/server.go:1472 +0xf2e fp=0xea27f3df88 sp=0xea27f3dbc0\nruntime.goexit()\n        /usr/local/go1.6.2/src/runtime/asm_amd64.s:1998 +0x1 fp=0xea27f3df90 sp=0xea27f3df88\ncreated by net/http.(*Server).Serve\n        /usr/local/go1.6.2/src/net/http/server.go:2137 +0x44e\n</code></pre>\n"}, {"tags": ["go", "runtime", "cpu"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1541592110, "post_id": 53188616, "comment_id": 93267073, "body": "Was the program compiled with CGO_ENABLED=0?  If not then the problem is (probably) in the C go parts of the program.  pprof can&#39;t profile inside sections of C libraries"}, {"owner": {"reputation": 11, "user_id": 10617824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d30afffe98624ef5b1020a67a23d697a?s=128&d=identicon&r=PG&f=1", "display_name": "kingjang", "link": "https://stackoverflow.com/users/10617824/kingjang"}, "reply_to_user": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1541592592, "post_id": 53188616, "comment_id": 93267298, "body": "thankyou!,but my program isn&#39;t compiled with CGO_ENABLED=0  -_-..and  what tool can profile inside sections of C libraries?"}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1541746263, "post_id": 53188616, "comment_id": 93328980, "body": "Apparently &quot;ExternalCode means time spent in native dynamic libraries.&quot; <a href=\"https://github.com/golang/go/wiki/Performance\" rel=\"nofollow noreferrer\">performance</a>"}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1541748881, "post_id": 53188616, "comment_id": 93329860, "body": "Perhaps the ExternalCode is the underlying unix read syscall. Maybe the code is spinning in a hot loop? Could <i>last</i> ever be MAX_PACKET_LEN?"}, {"owner": {"reputation": 11, "user_id": 10617824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d30afffe98624ef5b1020a67a23d697a?s=128&d=identicon&r=PG&f=1", "display_name": "kingjang", "link": "https://stackoverflow.com/users/10617824/kingjang"}, "edited": false, "score": 0, "creation_date": 1542010402, "post_id": 53188616, "comment_id": 93400654, "body": "thanks.I tried to change the centos version and golang version in docker , it is running normally at least until now."}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 0, "last_activity_date": 1541592754, "creation_date": 1541592754, "answer_id": 53189246, "question_id": 53188616, "link": "https://stackoverflow.com/questions/53188616/runtime-externalcode-cpu-usage-is-too-high-up-to-80/53189246#53189246", "title": "runtime._ExternalCode Cpu usage is too high, Up to 80%", "body": "<p>As you have confirmed that your program was <em>not</em> built with CGO_ENABLED=0</p>\n\n<p>The problem is (probably) in the C go parts of the program. pprof can't profile inside sections of C libraries</p>\n\n<p>I believe there are some other things that count as \"_External\" like time.Now on some systems</p>\n"}], "owner": {"reputation": 11, "user_id": 10617824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d30afffe98624ef5b1020a67a23d697a?s=128&d=identicon&r=PG&f=1", "display_name": "kingjang", "link": "https://stackoverflow.com/users/10617824/kingjang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 535, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1557203689, "creation_date": 1541590192, "last_edit_date": 1557203689, "question_id": 53188616, "link": "https://stackoverflow.com/questions/53188616/runtime-externalcode-cpu-usage-is-too-high-up-to-80", "title": "runtime._ExternalCode Cpu usage is too high, Up to 80%", "body": "<p>I wrote a tcp handler in golang, about 300 connections per second. There was no problem with the program just released to production. But after running for about 10 days, I see that the cpu usage is up to 100%. I used the golang tool \"go tool pprof\" to get the information of cpu usage :</p>\n\n<pre><code>File: gateway-w\nType: cpu\nTime: Nov 7, 2018 at 5:38pm (CST)\nDuration: 30.14s, Total samples = 30.13s (  100%)\nEntering interactive mode (type \"help\" for commands, \"o\" for options)\n(pprof) top\nShowing nodes accounting for 27.42s, 91.01% of 30.13s total\nDropped 95 nodes (cum &lt;= 0.15s)\nShowing top 10 nodes out of 28\n      flat  flat%   sum%        cum   cum%\n    24.69s 81.94% 81.94%     24.69s 81.94%  runtime._ExternalCode /usr/local/go/src/runtime/proc.go\n     0.57s  1.89% 83.84%      0.57s  1.89%  runtime.lock /usr/local/go/src/runtime/lock_futex.go\n     0.56s  1.86% 85.70%      0.56s  1.86%  runtime.unlock /usr/local/go/src/runtime/lock_futex.go\n     0.26s  0.86% 86.56%      5.37s 17.82%  gateway-w/connect/connect-tcp.tcpStartSession /go/src/gateway-w/connect/connect-tcp/tcp_framework.go\n     0.25s  0.83% 87.39%      1.67s  5.54%  net.(*conn).Read /usr/local/go/src/net/net.go\n     0.24s   0.8% 88.18%      1.41s  4.68%  net.(*netFD).Read /usr/local/go/src/net/fd_unix.go\n     0.23s  0.76% 88.95%      0.23s  0.76%  runtime.nanotime /usr/local/go/src/runtime/sys_linux_amd64.s\n     0.22s  0.73% 89.68%      0.22s  0.73%  internal/poll.(*fdMutex).incref /usr/local/go/src/internal/poll/fd_mutex.go\n     0.21s   0.7% 90.38%      0.21s   0.7%  internal/poll.(*fdMutex).rwunlock /usr/local/go/src/internal/poll/fd_mutex.go\n     0.19s  0.63% 91.01%      0.19s  0.63%  internal/poll.(*fdMutex).rwlock /usr/local/go/src/internal/poll/fd_mutex.go\n</code></pre>\n\n<p>my tcpHandle code is like this:</p>\n\n<pre><code>func tcpStartSession(conn net.Conn) {\n\n    defer closeTcp(conn)\n\n    var (last, n int\n        err     error\n        buff    []byte\n    )\n\n    last, n, err, buff =\n        0, 0, nil,\n        make([]byte, MAX_PACKET_LEN)\n\n    for {\n        // set read timeout\n        conn.SetReadDeadline(time.Now().Add(time.Duration(tcpTimeOutSec) * time.Second))\n        n, err = conn.Read(buff[last:])\n\n        if err != nil {\n            log.Info(\"tcp read error maybe timeout , \", err)\n            break\n        }\n        if n == 0 {\n            log.Debug(\"empty packet, continue\")\n            continue\n        }\n        log.Debug(\"read bytes \", n)\n\n        log.Info(\"get a raw package\uff1a\", hex.EncodeToString(buff[:last+n]))\n        last += n\n        ...\n\n        for {\n            if last == 0 {\n                break\n            }\n\n            ret, err := protoHandle.IsWhole(buff[:last])\n            if err != nil {\n                log.Warn(\"proto handle check iswhole error\", err)\n            }\n\n            log.Debug(\"rest buffer len = %d\\n\", ret)\n            if ret &lt; 0 {\n                //wait for more tcp fragment.\n                break\n            }\n            packetLen := last - ret\n            packetBuf := make([]byte, packetLen)\n            copy(packetBuf, buff[:packetLen])\n\n            last = ret\n\n            if last &gt; 0 {\n                copy(buff, buff[packetLen:packetLen+last])\n            }\n\n            ...\n\n        }\n    }\n}\n</code></pre>\n\n<p>I can't understand what runtime._ExternalCode means. This is the function inside golang. </p>\n\n<p>my golang version is <code>:go version go1.9.2 linux/amd64</code></p>\n\n<p>my program is running on docker </p>\n\n<pre><code>my docker version is : 1.12.6\n</code></pre>\n\n<p>I hope someone can help me. Thank you very much\uff01</p>\n\n<hr>\n\n<p>I tried to upgrade the golang version to 1.10.3. After running for more than half a year, there was no problem. Recently, the same problem occurred, but I have not changed the program code. I suspect that there is a problem with this code:</p>\n\n<pre><code>conn.SetReadDeadline(time.Now().Add(time.Duration(tcpTimeOutSec) * time.Second))\n</code></pre>\n\n<p>Need your help, thank you.</p>\n"}, {"tags": ["go", "oauth", "oauth-2.0", "cloud-foundry"], "comments": [{"owner": {"reputation": 16436, "user_id": 10411602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b534549770aedbc4d7eb03a39d740f6?s=128&d=identicon&r=PG&f=1", "display_name": "Blaze", "link": "https://stackoverflow.com/users/10411602/blaze"}, "edited": false, "score": 0, "creation_date": 1541589381, "post_id": 53188106, "comment_id": 93265842, "body": "From review: I&#39;m not very knowledgeable on this topic, but I guess the &quot; &quot; everywhere in your code (do they display for you?) might have to do with it. For me it appears as a block-type character containing (L SEP). Looks like this is unicode <code>U+2028</code> or HTML entity code <code>&amp;#8232;</code>."}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 0, "creation_date": 1541589524, "post_id": 53188106, "comment_id": 93265898, "body": "Can you post a link to the oauth API of the host? I&#39;ve already sent an edit request, once approved, your formatting will be right."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1541593985, "post_id": 53189288, "comment_id": 93268002, "body": "Thanks, does it mandatory to provide the <code>grant type</code> and <code>response type</code> , I currently only have the <code>url</code> <code>client_id</code> <code>secret</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1541594306, "post_id": 53189288, "comment_id": 93268142, "body": "in addition im getting now response 401 , any idea what it could be? is guess this is improvement, isnt it?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1541594398, "post_id": 53189288, "comment_id": 93268187, "body": "also in the <code>url</code> I should put only <code>https:&#47;&#47;tenenat.host.com&#47;oauth&#47;token</code> this ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1541594498, "post_id": 53189288, "comment_id": 93268230, "body": "for <code>grantType</code> Type I didnt provide anything, does it related to the <code>401</code> ? and <code>repsonseType=&quot;token&quot;</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1541595672, "post_id": 53189288, "comment_id": 93268751, "body": "I&#39;ve put \t\t <code>GrantType:    &quot;client_credentials&quot;,</code> \t\t<code>ResponseType: &quot;token&quot;,</code> and still having <code>401</code> what it could be? maybe the url format ? im using <code>https:&#47;&#47;tenenat.host.com&#47;oauth&#47;token</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1541600710, "post_id": 53189288, "comment_id": 93271516, "body": "Thanks, from where sholud i take the bearer value ?"}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 0, "last_activity_date": 1541599521, "last_edit_date": 1541599521, "creation_date": 1541592913, "answer_id": 53189288, "question_id": 53188106, "link": "https://stackoverflow.com/questions/53188106/get-token-from-oauth-request-client/53189288#53189288", "title": "get token from OAuth request client", "body": "<p>If avoidable, you should not be placing sensitive data, such as client secret, in the URL string.  It is less secure than using the message body: for example it may be captured in logs and site traffic analytics that end up being shared with third parties.</p>\n\n<p>Instead, do a POST with a JSON body:</p>\n\n<pre><code>type TokenRequest struct {\n    GrantType    string `json:\"grant_type\"`\n    ResponseType string `json:\"response_type\"`\n    ClientID     string `json:\"client_id\"`\n    ClientSecret string `json:\"client_secret\"`\n}\ntokenReq := &amp;TokenRequest{\n    GrantType:    grantType,\n    ResponseType: responseType,\n    ClientID:     clientID,\n    ClientSecret: clientSecret,\n}\nbody, err := json.Marshal(tokenReq)\nif err != nil {\n    log.Errorf(\"Failed to marshal request body: %s\", err)\n}\nreq, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(body))\nif err != nil {\n    log.Errorf(\"Failed to create request: %s\", err)\n}\nreq.Header.Set(\"Content-Type\", \"application/json\")\nreq.Header.Set(\"Accept\", \"application/json\")\nres, err := httpClient.Do(req)\n</code></pre>\n\n<h2>Update</h2>\n\n<p>OP is now getting a statuscode 401 response.  401 is unauthorized.  You probably need to authenticate to the API.  For example, if you have a bearer token, add a header for it prior to making your request:</p>\n\n<pre><code>req.Header.Set(\"Authorization\", fmt.Sprintf(\"Bearer %s\", bearer))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 396, "user_id": 3077673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cgN7F.jpg?s=128&g=1", "display_name": "warrens", "link": "https://stackoverflow.com/users/3077673/warrens"}, "is_accepted": false, "score": 0, "last_activity_date": 1613999128, "creation_date": 1613999128, "answer_id": 66316279, "question_id": 53188106, "link": "https://stackoverflow.com/questions/53188106/get-token-from-oauth-request-client/66316279#66316279", "title": "get token from OAuth request client", "body": "<p>Not sure about the url that you are using, but in my case it is an AWS Cognito one, and I could not get a bearer token if the request was json formatted -- it had to be &quot;url encoded&quot;.  It may be that your endpoint should be treated the same way?</p>\n<p>Anyhow here is the code that worked for me getting the <strong>client_credentials</strong> bearer token from AWS Cognito.</p>\n<pre><code>// &quot;url encode&quot; the request data\nbodyData := url.Values{}\nbodyData.Set(&quot;client_id&quot;, clientID)\nbodyData.Set(&quot;grant_type&quot;, &quot;client_credentials&quot;)\nbodyData.Set(&quot;scope&quot;, clientScope)\nbody := bodyData.Encode()\nbodyBuffer := bytes.NewBuffer([]byte(body))\n\n// create the post request\nhttpRequest, _ := http.NewRequest(&quot;POST&quot;, tokenEndpointURL, bodyBuffer)\nhttpRequest.Header.Add(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;)\nhttpRequest.SetBasicAuth(url.QueryEscape(clientID), url.QueryEscape(clientSecret))\n\n// post the request\nhttpClient := &amp;http.Client{}\nhttpResponse, err := httpClient.Do(httpRequest)\nif err != nil {\n    fmt.Printf(&quot;error with http client do: %v&quot;, err)\n    return &quot;&quot;, err\n}\ndefer httpResponse.Body.Close()\n\n// read the response\nresponseBuffer, err := ioutil.ReadAll(httpResponse.Body)\nif err != nil {\n    fmt.Printf(&quot;error reading http response body: %v&quot;, err)\n    return &quot;&quot;, err\n}\nresponseJSON := string(responseBuffer)\nfmt.Printf(&quot;responseJSON: %v&quot;, responseJSON)\n\n// unmarshal the response\ntype ClientCredentialsTokenResponseStruct struct {\n    AccessToken string `json:&quot;access_token&quot;`\n    TokenType   string `json:&quot;token_type&quot;`\n    ExpiresIn   int    `json:&quot;expires_in&quot;`\n}\n\nvar tokenResponse ClientCredentialsTokenResponseStruct\n_ = json.Unmarshal([]byte(responseJSON), &amp;tokenResponse)\n</code></pre>\n<p>The bearer token is in <code>tokenResponse.AccessToken</code>.</p>\n<p>Good luck!</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1613999128, "creation_date": 1541588183, "last_edit_date": 1541595433, "question_id": 53188106, "link": "https://stackoverflow.com/questions/53188106/get-token-from-oauth-request-client", "title": "get token from OAuth request client", "body": "<p>I\u2019ve the following code which I want to get the token from the request , I pass the <strong>API/ClientSecret/ClientID</strong></p>\n\n<pre><code>r := fmt.Sprintf(\"https://tenenat.host.com/oauth/token?grant_type=client_credentials&amp;response_type=token&amp;client_id=%s&amp;client_secret=%s\", CI, CS)\nreq, err := http.NewRequest(http.MethodPost, r, nil)\nreq.Header.Set(\"accept\", \"application/json\")\nres, err := httpClient.Do(req)\nif err != nil {\n    fmt.Println(os.Stdout)\n    var t OAuthAccessResponse\n    if err := json.NewDecoder(res.Body).Decode(&amp;t); err != nil {\n        fmt.Println(os.Stdout, \"could not parse JSON response: %v\", err)\n    }\n    defer res.Body.Close()\n}\n</code></pre>\n\n<p>When running it I got error :</p>\n\n<p>http 400 bad request .</p>\n\n<p>Any idea if I miss something in the request ?    </p>\n\n<p>Im not able to format the code right :) </p>\n"}, {"tags": ["go", "godoc"], "answers": [{"comments": [{"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1541589840, "post_id": 53188473, "comment_id": 93266030, "body": "what should I need to add to the command  godoc -html -src c:/Users/go/src/myProject ?"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1541589894, "post_id": 53188473, "comment_id": 93266048, "body": "can I run it with godoc -http=:6060 ? P.S how I can export method ?"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1541590191, "post_id": 53188473, "comment_id": 93266192, "body": "i run this command godoc -http=:6060 -goroot=$GOHOME  and then i run <a href=\"http://localhost:6060?m=all\" rel=\"nofollow noreferrer\">localhost:6060?m=all</a> then I succeed to get the struct but not the function"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1541591843, "post_id": 53188473, "comment_id": 93266941, "body": "The main package can&#39;t be documented by the default godoc. See <a href=\"https://stackoverflow.com/questions/21778556/what-steps-are-needed-to-document-package-main-in-godoc\" title=\"what steps are needed to document package main in godoc\">stackoverflow.com/questions/21778556/&hellip;</a>"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 2, "last_activity_date": 1541589636, "creation_date": 1541589636, "answer_id": 53188473, "question_id": 53187692, "link": "https://stackoverflow.com/questions/53187692/how-to-create-document-with-godoc/53188473#53188473", "title": "How to create document with godoc?", "body": "<p>Unexported identifiers are not documented by default. Set at least <code>?m=all</code> to see them:</p>\n\n<blockquote>\n  <p>The presentation mode of web pages served by godoc can be controlled with the \"m\" URL parameter; it accepts a comma-separated list of flag names as value:</p>\n\n<pre><code>all     show documentation for all declarations, not just the exported ones\nmethods show all embedded methods, not just those of unexported anonymous fields\nsrc     show the original source code rather then the extracted documentation\n</code></pre>\n  \n  <p>For instance, <a href=\"https://golang.org/pkg/math/big/?m=all\" rel=\"nofollow noreferrer\">https://golang.org/pkg/math/big/?m=all</a> shows the documentation for all (not just the exported) declarations of package big.\n  <a href=\"https://godoc.org/golang.org/x/tools/cmd/godoc\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/tools/cmd/godoc</a></p>\n</blockquote>\n"}], "owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1117, "favorite_count": 0, "accepted_answer_id": 53188473, "answer_count": 1, "score": -1, "last_activity_date": 1572178937, "creation_date": 1541586787, "last_edit_date": 1572178937, "question_id": 53187692, "link": "https://stackoverflow.com/questions/53187692/how-to-create-document-with-godoc", "title": "How to create document with godoc?", "body": "<p>I create simple go with comment in the application to the function and the package\nI tried godoc -html and my application and the result</p>\n\n<pre><code>&lt;!--\n    Copyright 2009 The Go Authors. All rights reserved.\n    Use of this source code is governed by a BSD-style\n    license that can be found in the LICENSE file.\n--&gt;\n\n&lt;!--\n        Note: Static (i.e., not template-generated) href and id\n        attributes start with \"pkg-\" to make it impossible for\n        them to conflict with generated attributes (some of which\n        correspond to Go identifiers).\n--&gt;\n\n        &lt;script type='text/javascript'&gt;\n        document.ANALYSIS_DATA = ;\n        document.CALLGRAPH = ;\n        &lt;/script&gt;\n\n\n\n                &lt;p&gt;\nPackage main provides logic ...\n&lt;/p&gt;\n</code></pre>\n\n<p>why I didn't see my other document ? and why the <code>&lt;p&gt;</code> for the package has spaces </p>\n\n<pre><code>// Package main provides logic.\npackage main\nimport (\n\n}\n\nsome types.....\n\nfunc main() {\n}\n\n// doLogic .....\n// .....\n// ....\nfunc (sm *myI) doLogic (s *myStruct) bool {\n\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 2625549, "user_type": "registered", "profile_image": "https://graph.facebook.com/1834930432/picture?type=large", "display_name": "Santo", "link": "https://stackoverflow.com/users/2625549/santo"}, "edited": false, "score": 0, "creation_date": 1541614563, "post_id": 53193576, "comment_id": 93279449, "body": "Yeah, did that already a coupe times. Sadly it didnt change the situation at all :("}], "tags": [], "owner": {"reputation": 68, "user_id": 5601747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8337713be0ab6170dfc5b4684db5a1ac?s=128&d=identicon&r=PG&f=1", "display_name": "jsasuga", "link": "https://stackoverflow.com/users/5601747/jsasuga"}, "is_accepted": false, "score": 0, "last_activity_date": 1541607655, "creation_date": 1541607655, "answer_id": 53193576, "question_id": 53186726, "link": "https://stackoverflow.com/questions/53186726/vendor-directory-on-google-app-engine-go111-runtime-causes-error/53193576#53193576", "title": "Vendor Directory on Google App Engine go111 runtime causes error?", "body": "<p>Are you using dep? If so, have you tried deleting the /vendor folder and Gopkg.lock file and re-running <code>dep ensure</code>?</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 2625549, "user_type": "registered", "profile_image": "https://graph.facebook.com/1834930432/picture?type=large", "display_name": "Santo", "link": "https://stackoverflow.com/users/2625549/santo"}, "is_accepted": false, "score": 0, "last_activity_date": 1541712734, "creation_date": 1541712734, "answer_id": 53216458, "question_id": 53186726, "link": "https://stackoverflow.com/questions/53186726/vendor-directory-on-google-app-engine-go111-runtime-causes-error/53216458#53216458", "title": "Vendor Directory on Google App Engine go111 runtime causes error?", "body": "<p>I was able to figure out on my own. The issue was not with GAE, but instead with dep. Somehow, dep managed to lock in a very old version of that dependency with a symlink beeing in place which of course couldnt be resolved locally. Editing Gopck.toml and point it to a proper revision solved that issue. </p>\n\n<p>Sorry for thinking its a google issue. I dont know to close that question :)</p>\n"}], "owner": {"reputation": 1, "user_id": 2625549, "user_type": "registered", "profile_image": "https://graph.facebook.com/1834930432/picture?type=large", "display_name": "Santo", "link": "https://stackoverflow.com/users/2625549/santo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 238, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1541712734, "creation_date": 1541583236, "last_edit_date": 1541583856, "question_id": 53186726, "link": "https://stackoverflow.com/questions/53186726/vendor-directory-on-google-app-engine-go111-runtime-causes-error", "title": "Vendor Directory on Google App Engine go111 runtime causes error?", "body": "<p>I'm trying to get a little setup going and I'm encountering a strange issue. Code here: <a href=\"https://github.com/SantoDE/appenginedemo\" rel=\"nofollow noreferrer\">https://github.com/SantoDE/appenginedemo</a></p>\n\n<p>I can deploy that, as long as I dont have my dependencies vendored locally. Once I let dep populate the vendor directory, I have a strange issue:</p>\n\n<blockquote>\n  <p>copied /Users/manuelzapf/go/src/github.com/SantoDE/appenginedemo/vendor/github.com/json-iterator/go/jsoniter.go to /var/folders/q3/x4rq343n57x5v8pccndssw3r0000gn/T/tmp8Crxax/tmpPZJdtd/vendor/github.com/json-iterator/go/jsoniter.go\n  2018/11/07 09:51:09 Staging second-gen Standard app: unable to copy root directory to /app: unable to copy dir \"/Users/manuelzapf/go/src/github.com/SantoDE/appenginedemo/vendor\" to \"vendor\": unable to copy dir \"/Users/manuelzapf/go/src/github.com/SantoDE/appenginedemo/vendor/github.com\" to \"vendor/github.com\": unable to copy dir \"/Users/manuelzapf/go/src/github.com/SantoDE/appenginedemo/vendor/github.com/json-iterator\" to \"vendor/github.com/json-iterator\": unable to copy dir \"/Users/manuelzapf/go/src/github.com/SantoDE/appenginedemo/vendor/github.com/json-iterator/go\" to \"vendor/github.com/json-iterator/go\": unable to copy dir \"/Users/manuelzapf/go/src/github.com/SantoDE/appenginedemo/vendor/github.com/json-iterator/go/skip_tests\" to \"vendor/github.com/json-iterator/go/skip_tests\": unable to copy dir \"/Users/manuelzapf/go/src/github.com/SantoDE/appenginedemo/vendor/github.com/json-iterator/go/skip_tests/array\" to \"vendor/github.com/json-iterator/go/skip_tests/array\": unable to stat /Users/manuelzapf/go/src/github.com/SantoDE/appenginedemo/vendor/github.com/json-iterator/go/skip_tests/array/skip_test.go: stat /Users/manuelzapf/go/src/github.com/SantoDE/appenginedemo/vendor/github.com/json-iterator/go/skip_tests/array/skip_test.go: no such file or directory</p>\n</blockquote>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["json", "string", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1541581786, "post_id": 53186254, "comment_id": 93262099, "body": "Of course you <i>can</i> write your own UnmarshalJSON method to do this. But why bother? Plain and straight unmarshaling into a string and splitting afterwords is so much simpler, easier to test and less error prone."}], "answers": [{"comments": [{"owner": {"reputation": 445, "user_id": 92323, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1047661124/picture?type=large", "display_name": "MarcoW", "link": "https://stackoverflow.com/users/92323/marcow"}, "edited": false, "score": 0, "creation_date": 1541583984, "post_id": 53186380, "comment_id": 93263203, "body": "Works like a sunshine. Thanks! Would you agree with Volker&#39;s comment that doing it post-unmarshalling is actually a better solution?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 445, "user_id": 92323, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1047661124/picture?type=large", "display_name": "MarcoW", "link": "https://stackoverflow.com/users/92323/marcow"}, "edited": false, "score": 1, "creation_date": 1541584275, "post_id": 53186380, "comment_id": 93263364, "body": "@MarcoW Depends on your use case. If you only need the slice once, you may leave the field as a <code>string</code> in the struct, and add a method to the struct that splits it (or just split the field&#39;s value where needed). If you need it multiple times, the splitted parts may be stored (e.g. in an additional field), but at that point this solution is simpler."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1541581823, "creation_date": 1541581823, "answer_id": 53186380, "question_id": 53186254, "link": "https://stackoverflow.com/questions/53186254/custom-unmarshal-with-string-split-in-golang/53186380#53186380", "title": "Custom Unmarshal with string split in Golang", "body": "<p>Easiest would be to define your own string slice type and implement <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"noreferrer\"><code>json.Unmarshaler</code></a> on that:</p>\n\n<pre><code>type strslice []string\n\nfunc (ss *strslice) UnmarshalJSON(data []byte) error {\n    var s string\n    if err := json.Unmarshal(data, &amp;s); err != nil {\n        return err\n    }\n    *ss = strings.Split(s, \"-\")\n    return nil\n}\n</code></pre>\n\n<p>And use this in your struct:</p>\n\n<pre><code>type Student struct {\n    StudentNumber int      `json:\"student_number\"`\n    Name          string   `json:\"name\"`\n    Subjects      strslice `json:\"subjects\"`\n}\n</code></pre>\n\n<p>And then it'll work:</p>\n\n<pre><code>func main() {\n    var s Student\n    err := json.Unmarshal([]byte(src), &amp;s)\n    fmt.Println(s, err)\n}\n\nconst src = `{\"student_number\":1234567, \"name\":\"John Doe\", \"subjects\":\"Chemistry-Maths-History-Geography\"}`\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/FObyfS87AaL\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{1234567 John Doe [Chemistry Maths History Geography]} &lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 445, "user_id": 92323, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1047661124/picture?type=large", "display_name": "MarcoW", "link": "https://stackoverflow.com/users/92323/marcow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3112, "favorite_count": 0, "accepted_answer_id": 53186380, "answer_count": 1, "score": 1, "last_activity_date": 1541582034, "creation_date": 1541581309, "last_edit_date": 1541582034, "question_id": 53186254, "link": "https://stackoverflow.com/questions/53186254/custom-unmarshal-with-string-split-in-golang", "title": "Custom Unmarshal with string split in Golang", "body": "<p>I have the following JSON</p>\n\n<p><code>{\"student_number\":1234567, \"name\":\"John Doe\", \"subjects\":\"Chemistry-Maths-History-Geography\"}</code></p>\n\n<p>I would like to unmarshal it in a struct, where one item (the subjects) are split on '-' into a <code>[]string</code>.</p>\n\n<pre><code>type Student struct {\n  StudentNumber int       `json:\"student_number\"`\n  Name          string    `json:\"name\"`\n  Subjects []string \n}\n</code></pre>\n\n<p>I have attempted several different ways of achieving this with custom Unmarshalling using <code>strings.Split()</code>, but have not succeeded so far.</p>\n\n<p>Is there any way to achieve this in the unmarshalling process? Or will I need to simply unmarshal as is and make the conversion afterward?</p>\n"}, {"tags": ["c", "pointers", "go", "type-conversion", "cgo"], "comments": [{"owner": {"reputation": 32077, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1541577248, "post_id": 53185257, "comment_id": 93260220, "body": "function parameter <code>uint8_t *data</code> is incompatible with local variable <code>uint8_t *data[BUF_SIZE];</code> so it should probably be <code>uint8_t data[BUF_SIZE];</code>"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 9502084, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Vincent Em", "link": "https://stackoverflow.com/users/9502084/vincent-em"}, "is_accepted": true, "score": 1, "last_activity_date": 1541578076, "last_edit_date": 1541578076, "creation_date": 1541577236, "answer_id": 53185394, "question_id": 53185257, "link": "https://stackoverflow.com/questions/53185257/direct-c-pointer-conversion/53185394#53185394", "title": "Direct C pointer conversion", "body": "<p>Sorry guys, I found my own mistake:</p>\n\n<pre><code>// convert unsafePtr to a pointer of the type *[1 &lt;&lt; 30]C.uint8_t\narrayPtr := (*[1 &lt;&lt; 30]C.uint8_t)(unsafePtr)\n</code></pre>\n\n<p>==> to</p>\n\n<pre><code>// convert unsafePtr to a pointer of the type *[1 &lt;&lt; 30]uint8\narrayPtr := (*[1 &lt;&lt; 30]uint8)(unsafePtr)\n</code></pre>\n\n<p>Problem solved!</p>\n\n<p>Thanks ;)</p>\n"}], "owner": {"reputation": 11, "user_id": 9502084, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Vincent Em", "link": "https://stackoverflow.com/users/9502084/vincent-em"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 1, "accepted_answer_id": 53185394, "answer_count": 1, "score": -1, "last_activity_date": 1541578076, "creation_date": 1541576541, "last_edit_date": 1541577022, "question_id": 53185257, "link": "https://stackoverflow.com/questions/53185257/direct-c-pointer-conversion", "title": "Direct C pointer conversion", "body": "<p>I have this C code:</p>\n\n<pre><code>uint8_t *data[BUF_SIZE];\ndata = ...;\n\n// extern void goReadData(uint8_t *data, int bufferSize);\ngoReadData(data, BUF_SIZE)\n</code></pre>\n\n<p>And in the GO Code I'm trying to use the <code>data</code> pointer as a GO array or slice, I want to retrieve an []uint8 from the *C.uint8_t. I know the size of the <code>data</code></p>\n\n<pre><code>//export goReadData\nfunc goReadData(data *C.uint8_t, bufferSize C.int) {\n\n    fmt.Printf(\"Data type %v\\n\", reflect.TypeOf(data))\n    // print 1: Data type *main._Ctype_uchar\n\n\n    // Solution 1: GoBytes\n    // works but really slow (memory copy I think)\n    goBytes := C.GoBytes(unsafe.Pointer(data), bufferSize)\n    fmt.Printf(\"goBytes type %v\\n\", reflect.TypeOf(goBytes))\n    // print 2: goBytes type []uint8\n\n\n    // Solution 2: direct pointer\n    // Really fast, but wrong type at the end\n    // unsafe.Pointer to the C array\n    unsafePtr := unsafe.Pointer(data)\n\n    // convert unsafePtr to a pointer of the type *[1 &lt;&lt; 30]C.uint8_t\n    arrayPtr := (*[1 &lt;&lt; 30]C.uint8_t)(unsafePtr)\n\n    // slice the array into a Go slice, with the same backing array\n    // as data, making sure to specify the capacity as well as\n    // the length.\n    length := int(bufferSize)\n    slice := arrayPtr[0:length:length]\n\n    fmt.Printf(\"Direct slice type %v\\n\", reflect.TypeOf(slice))\n    //Print 3: Direct type []main._Ctype_uchar\n}\n</code></pre>\n\n<p>How could I do to recover an <code>[]uint8</code> instead of []main._Ctype_uchar with the second solution? Or do you have another solution to do that without a bytes copy?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "edited": false, "score": 0, "creation_date": 1541576597, "post_id": 53185064, "comment_id": 93259961, "body": "Is component B a go routine? could you use comment in your code to match post description?"}, {"owner": {"reputation": 857, "user_id": 1208081, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/ca2d4ef0024cd926cc7a6218f7a4aed8?s=128&d=identicon&r=PG", "display_name": "user1208081", "link": "https://stackoverflow.com/users/1208081/user1208081"}, "reply_to_user": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "edited": false, "score": 0, "creation_date": 1541576782, "post_id": 53185064, "comment_id": 93260034, "body": "A is grafana ,B is prometheus ,they all are kubernetes pod"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1541576853, "post_id": 53185064, "comment_id": 93260060, "body": "Presumably some other code that you haven&#39;t shown sets <code>m.Needflush</code> to either <code>&quot;del&quot;</code> or <code>&quot;add&quot;</code>? If so, you are missing synchronization. Consider using a channel instead. This would also eliminate the time.Sleep call, which you seem to take issue with."}], "owner": {"reputation": 857, "user_id": 1208081, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/ca2d4ef0024cd926cc7a6218f7a4aed8?s=128&d=identicon&r=PG", "display_name": "user1208081", "link": "https://stackoverflow.com/users/1208081/user1208081"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1541577167, "creation_date": 1541575475, "last_edit_date": 1541577167, "question_id": 53185064, "link": "https://stackoverflow.com/questions/53185064/how-to-prevent-client-make-mistake-due-to-event-signal-delay", "title": "how to prevent client make mistake due to event signal delay?", "body": "<p>i want to let component A know component B ,when B die ,A remove all B info,and when B born ,A regist B info. A watch the notice which write the info of B's die or born ,but due to long time need to confirm die info, the die info on notice will delay if B die and immediately reborn ,the reborn info come before the die info,B record the info using a variable(that maybe unsuitable),i do not know how to deal with this situation,anyone can help?\nhere is the code</p>\n\n<p>this is the code watch the etcd event</p>\n\n<pre><code>    for wresp := range rch {\n    for _, ev := range wresp.Events {\n        switch ev.Type {\n            case clientv3.EventTypePut:\n                fmt.Printf(\"[%s] %q : %q\\n\", ev.Type, ev.Kv.Key, ev.Kv.Value)\n                info := GetServiceInfo(ev)\n                m.AddNode(string(ev.Kv.Key),info)\n                m.Needflush = \"add\"\n            case clientv3.EventTypeDelete:\n                fmt.Printf(\"[%s] %q : %q\\n\", ev.Type, ev.Kv.Key, ev.Kv.Value)\n                delete(m.Nodes, string(ev.Kv.Key))\n                m.Needflush = \"del\"\n        }\n    }\n}\n</code></pre>\n\n<p>this is the code which i depend on the watched event do some operates  </p>\n\n<pre><code>for {\n    if m.Needflush == \"del\" {\n        purge_ds(grafana_addr, \"test_datasource\")\n        m.Needflush = \"no\"\n    } else if m.Needflush == \"add\" {\n        prometheus_addr = read_prometheusip(m.Client, \"monitor/prometheus_ip\")\n        add_ds(grafana_addr, \"test_datasource\", prometheus_addr)\n        m.Needflush = \"no\"\n    }\n    time.Sleep(time.Second * 5)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1541573157, "post_id": 53184549, "comment_id": 93258769, "body": "The bytes are not discarded. You can rewind to the beginning of the file and read it back. Creating and then immediately unlinking a file is a common pattern for dealing with temporary files."}, {"owner": {"reputation": 1187, "user_id": 10390273, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZnPo-zLAkpE/AAAAAAAAAAI/AAAAAAAAAQ0/eDv2tBJWBWM/photo.jpg?sz=128", "display_name": "ASHWIN RAJEEV", "link": "https://stackoverflow.com/users/10390273/ashwin-rajeev"}, "edited": false, "score": 0, "creation_date": 1541577298, "post_id": 53184549, "comment_id": 93260240, "body": "It is because you open a port using os.Openfile() and writing to that particular port no more error check is performed during the write operation. Because of that you won&#39;t get file not found error during the write operation."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1541577367, "post_id": 53184549, "comment_id": 93260266, "body": "On most Unix filesystems, deleting a file just removes the inode entry, leaving the underlying file in tact, until it is closed. This is a feature, which can be used to great advantage in some cases, but the TL;DR; is: The situation you&#39;re describing is intentional."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1541577381, "post_id": 53184549, "comment_id": 93260271, "body": "Perhaps you should explain why you care if the file gets deleted, so we can suggest appropriate countermeasures. As long as you don&#39;t Close() the file, all *os.File methods should JustWork(tm). Only once you start referring to the file by name will you get problems, but every time you do that you have to handle (expect, even!) errors anyway."}], "answers": [{"tags": [], "owner": {"reputation": 149158, "user_id": 524368, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oZ8Up.png?s=128&g=1", "display_name": "datenwolf", "link": "https://stackoverflow.com/users/524368/datenwolf"}, "is_accepted": true, "score": 0, "last_activity_date": 1541586508, "last_edit_date": 1541586508, "creation_date": 1541584094, "answer_id": 53186963, "question_id": 53184549, "link": "https://stackoverflow.com/questions/53184549/how-to-detect-deleted-file/53186963#53186963", "title": "How to detect deleted file?", "body": "<blockquote>\n  <p>While this is running, I issue rm mytest.log from the command line and observe that the program does not produce an error on the next call to <code>WriteString()</code></p>\n</blockquote>\n\n<p>Yes, that's exactly the behavior that's specified. Also the file hasn't been removed. The only thing that <code>rm</code> does remove is that particular path entry in the filesystem. A single file can have multiple paths, also called <em>hardlinks</em>.</p>\n\n<p>The actual file is deleted only, when the last reference to it, either by filesystem entry (link) or by file descriptor (file open in a program) has been closed.</p>\n\n<p>This particular behavior of the Unix file model was used for a long time to implement \"unnamed\" shared memory, by creating and opening a file in <code>/dev/shm</code> and then removing the filesystem entry \u2013 because this particular way of doing things introduces a race condition, for security sensitive applications new syscalls were introduced, that allow creating anonymous memory maps, and very recently Linux even got a function to create a file in a filesystem, without creating a path entry (<a href=\"https://linux.die.net/man/2/open\" rel=\"nofollow noreferrer\"><code>open</code></a> with <code>O_TMPFILE</code> flag).</p>\n\n<p>On more recent versions of Linux you can even re-/create filesystem entries for files which last entry already was removed using the <a href=\"https://linux.die.net/man/2/linkat\" rel=\"nofollow noreferrer\"><code>linkat</code></a> syscall.</p>\n\n<h3>Update</h3>\n\n<p>The question is, do you really want to error out if the last filesystem entry vanishes? It's not a bad condition after all, you can safely write and read, without problems, just be aware, that once you close the last file descriptor to the file, it will be lost.</p>\n\n<p>It is perfectly possible to detect if the last filesystem entry has been removed and abort file operations if so \u2013 however be aware, that such code might introduce it's very own share of problems, for example if the program expects to create a new filesystem entry, once everything has been written to the file properly, using linkat.</p>\n\n<p>Anyway, what you can do, is <code>fstat</code>-ing the file (<code>file.Stat</code> in Go) and look at the number of hardlinks the file has. If that number drops to zero, all filesystem entries are gone. Actually getting that number is a little bit tricky in Go, it's described here <a href=\"https://stackoverflow.com/questions/26854961/counting-hard-links-to-a-file-in-go\">Counting hard links to a file in Go</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"syscall\"\n    \"time\"\n)\n\nfunc main() {\n    fmt.Println(\"Test Operation\")\n    f, err := os.OpenFile(\"test.txt\", os.O_CREATE|os.O_APPEND|os.O_WRONLY, 0644)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    for {\n\n        n, err := f.WriteString(\"blah\\n\")\n        if err != nil {\n            log.Fatal(err)\n        }\n        log.Printf(\"wrote %d bytes\\n\", n)\n        time.Sleep(2 * time.Second)\n        stat, err := f.Stat()\n        if err != nil{\n            log.Fatal(err)\n        }\n        if sys := stat.Sys(); sys != nil {\n            if stat, ok := sys.(*syscall.Stat_t); ok {\n                nlink := uint64(stat.Nlink)\n                if 0 == nlink {\n                    log.Printf(\"All filesystem entries to original file removed, exiting\")\n                    break\n                }\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2422, "user_id": 202311, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7408fce5260e98922355385680be0179?s=128&d=identicon&r=PG", "display_name": "IanB", "link": "https://stackoverflow.com/users/202311/ianb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 53186963, "answer_count": 1, "score": 0, "last_activity_date": 1541586508, "creation_date": 1541572191, "question_id": 53184549, "link": "https://stackoverflow.com/questions/53184549/how-to-detect-deleted-file", "title": "How to detect deleted file?", "body": "<p>Writing to a non-existent file does not produce an error in Go.</p>\n\n<p>For example, here's a sample program writing to a file in a loop:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n\n    f, err := os.OpenFile(\"mytest.log\", os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    for {\n\n        n, err := f.WriteString(\"blah\\n\")\n        if err != nil {\n            log.Fatal(err)\n        }\n        log.Printf(\"wrote %d bytes\\n\", n)\n        time.Sleep(2 * time.Second)\n    }\n}\n</code></pre>\n\n<p>While this is running, I issue <code>rm mytest.log</code> from the command line and observe that the program does not produce an error on the next call to <code>WriteString()</code>. (I tested on Linux, it may be different for other OS's)</p>\n\n<p>Is there a way to detect if the file was deleted (other than doing a stat on the file before every write)? And presumably the bytes written are simply discarded by the operating system?</p>\n"}, {"tags": ["oracle", "go"], "comments": [{"owner": {"reputation": 14991, "user_id": 1690193, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/2hac9.jpg?s=128&g=1", "display_name": "Nick.McDermaid", "link": "https://stackoverflow.com/users/1690193/nick-mcdermaid"}, "edited": false, "score": 1, "creation_date": 1541580913, "post_id": 53184521, "comment_id": 93261676, "body": "You cannot connect to Oracle from <i>anything</i> without an Oracle client installed."}, {"owner": {"reputation": 15822, "user_id": 1156452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/okUnm.jpg?s=128&g=1", "display_name": "thatjeffsmith", "link": "https://stackoverflow.com/users/1156452/thatjeffsmith"}, "edited": false, "score": 0, "creation_date": 1541586097, "post_id": 53184521, "comment_id": 93264317, "body": "Do you want a stateful, always on connection? Or could you rely on https calls to a mid tier?"}, {"owner": {"reputation": 79, "user_id": 10553582, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Uctj0JdsaHs/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCK5GAK3SzGM10cGUKJJWUxohHsoA/mo/photo.jpg?sz=128", "display_name": "Samayra Goyal", "link": "https://stackoverflow.com/users/10553582/samayra-goyal"}, "edited": false, "score": 0, "creation_date": 1541588707, "post_id": 53184521, "comment_id": 93265538, "body": "I dont need a always on connection, the connection should be established only when there is a request, I dont expect the incoming traffic to be more than 1 req per min."}], "owner": {"reputation": 79, "user_id": 10553582, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Uctj0JdsaHs/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCK5GAK3SzGM10cGUKJJWUxohHsoA/mo/photo.jpg?sz=128", "display_name": "Samayra Goyal", "link": "https://stackoverflow.com/users/10553582/samayra-goyal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1541580113, "creation_date": 1541572008, "last_edit_date": 1541580113, "question_id": 53184521, "link": "https://stackoverflow.com/questions/53184521/connecting-a-database-on-oracle-server-from-go-without-any-client-on-the-go-side", "title": "Connecting a database on Oracle server from Go without any client on the go side", "body": "<p>I checked out the go connectors available: go-oci8 and goracle, they need oracle client installed on the go side, is there any way to connect to oracle without the need of these clients?My go version is 1.7, I came across go-goracle/goracle but it requires minimum go 1.9\n I am getting this error:</p>\n\n<pre><code>    go get gopkg.in/goracle.v2\n    # gopkg.in/goracle.v2\n    .go/src/gopkg.in/goracle.v2/orahlp.go:271: undefined: driver.Pinger\n</code></pre>\n\n<p>Please can anyone suggest anything which works with go version 1.7 without the client installed.\n Regards,\n Sheetal</p>\n"}, {"tags": ["json", "parsing", "go"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 1, "creation_date": 1541572182, "post_id": 53184467, "comment_id": 93258557, "body": "Maps are unordered in go, that&#39;s why."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1541573415, "post_id": 53184467, "comment_id": 93258847, "body": "Well, you cannot do this (at least not in a simple way): Your JSON is an object and its fields are <i>unordered</i>. So are maps in Go. What you can do (See linked answer) is sort the timestamps. This will give you the time in sorted order which may differ from your input order (which is <i>unordered</i>). If your input really would have an order it would be ab JSON <i>array</i> and not an object."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541575956, "post_id": 53184467, "comment_id": 93259715, "body": "@Volker That actually qualifies to be the answer."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 3, "last_activity_date": 1541580519, "last_edit_date": 1541580519, "creation_date": 1541576515, "answer_id": 53185252, "question_id": 53184467, "link": "https://stackoverflow.com/questions/53184467/json-parsing-in-go-trick/53185252#53185252", "title": "JSON Parsing in Go - Trick", "body": "<p>You should not assume that the key order in a JSON object means anything:</p>\n\n<p>From <a href=\"https://tools.ietf.org/html/rfc7159#section-1\" rel=\"nofollow noreferrer\">the introduction of RFC 7159</a> (emphasis mine):</p>\n\n<blockquote>\n  <p>An <strong>object is an unordered collection</strong> of zero or more name/value pairs, where a name is a string and a value is a string, number, boolean, null, object, or array.</p>\n  \n  <p>An <strong>array is an ordered sequence</strong> of zero or more values.</p>\n</blockquote>\n\n<p>In addition to that, you shouldn't assume that the producer of the JSON document has been in control of the key/value order; maps are unordered in most languages, so it mostly comes down to the used encoding library. If the producer did care about the order, they would use an array.</p>\n\n<p>That being said, if you really are interested in the order of the JSON keys, you have to decode the object piece by piece, using <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Token\" rel=\"nofollow noreferrer\">json.Decoder.Token</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n    j := `{\n        \"2016-08-17T00:00:00.000Z\": 4,\n        \"2016-11-02T00:00:00.000Z\": 1,\n        \"2017-08-30T00:00:00.000Z\": 1\n    }`\n\n    dec := json.NewDecoder(strings.NewReader(j))\n    for dec.More() {\n        t, err := dec.Token()\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        switch t := t.(type) {\n        case json.Delim:\n            // no-op\n        case string:\n            fmt.Printf(\"%s =&gt; \", t)\n        case float64:\n            fmt.Printf(\"%.0f\\n\", t)\n        case json.Number:\n            fmt.Printf(\" %s\\n\", t)\n        default:\n            log.Fatalf(\"Unexpected type: %T\", t)\n        }\n    }\n}\n</code></pre>\n\n<p>Try it on the Playground: <a href=\"https://play.golang.org/p/qfXcOfOvKws\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qfXcOfOvKws</a></p>\n"}], "owner": {"reputation": 81, "user_id": 4398653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yj8yP.png?s=128&g=1", "display_name": "veerg404", "link": "https://stackoverflow.com/users/4398653/veerg404"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "closed_date": 1541577900, "accepted_answer_id": 53185252, "answer_count": 1, "score": -2, "last_activity_date": 1541580519, "creation_date": 1541571709, "question_id": 53184467, "link": "https://stackoverflow.com/questions/53184467/json-parsing-in-go-trick", "closed_reason": "Duplicate", "title": "JSON Parsing in Go - Trick", "body": "<p>How to parse this json using Go?</p>\n\n<pre><code> timelinedata := '{\n   \"2016-08-17T00:00:00.000Z\": 4,\n   \"2016-11-02T00:00:00.000Z\": 1,\n   \"2017-08-30T00:00:00.000Z\": 1\n   } '\n</code></pre>\n\n<p>I want the dates and the values in separate variables by looping over the json.\nCurrently I am doing it in this way</p>\n\n<pre><code>var timeline map[string]int\n</code></pre>\n\n<p><code>json.Unmarshal([]byte(timelinedata),</code></p>\n\n<pre><code>for k, v := range timeline {\n            new_key := k\n            new_val := v\n            println(\"val---&gt;&gt;\", new_key, new_val)\n        }\n</code></pre>\n\n<p>The problem is that the output is not in proper order as like the json input is. Every time I run the loop the output order varies. I want to map the json in exact order as like the input. I think I am not maping it in a proper way---</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541565857, "post_id": 53183356, "comment_id": 93257166, "body": "No. The nearest is reflect.Type.PkgPath"}, {"owner": {"reputation": 799, "user_id": 237729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wXyCu.png?s=128&g=1", "display_name": "wdscxsj", "link": "https://stackoverflow.com/users/237729/wdscxsj"}, "edited": false, "score": 0, "creation_date": 1619100070, "post_id": 53183356, "comment_id": 118806939, "body": "<code>go list -m</code> good enough?"}], "answers": [{"tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": true, "score": 4, "last_activity_date": 1576697896, "last_edit_date": 1576697896, "creation_date": 1541566709, "answer_id": 53183780, "question_id": 53183356, "link": "https://stackoverflow.com/questions/53183356/api-to-get-the-module-name/53183780#53183780", "title": "API to get the module name", "body": "<p>As of this writing, I am not aware of any exposed APIs for that. However, looking at <code>go mod</code> sources, there is a function that can be quite useful in <a href=\"https://golang.org/src/cmd/go/internal/modfile/read.go?s=20594:20628#L827\" rel=\"nofollow noreferrer\">Go mod source file</a></p>\n\n<pre><code>// ModulePath returns the module path from the gomod file text.\n// If it cannot find a module path, it returns an empty string.\n// It is tolerant of unrelated problems in the go.mod file.\nfunc ModulePath(mod []byte) string {\n    //...\n}\n\nfunc main() {\n\n    src := `\nmodule github.com/you/hello\n\nrequire rsc.io/quote v1.5.2\n`\n\n    mod := ModulePath([]byte(src))\n    fmt.Println(mod)\n\n}\n</code></pre>\n\n<p>Which outputs <code>github.com/you/hello</code></p>\n"}, {"tags": [], "owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "is_accepted": false, "score": 3, "last_activity_date": 1552683855, "creation_date": 1552683855, "answer_id": 55190642, "question_id": 53183356, "link": "https://stackoverflow.com/questions/53183356/api-to-get-the-module-name/55190642#55190642", "title": "API to get the module name", "body": "<p>If your starting point is a <code>go.mod</code> file and you are asking how to parse it, I would suggest starting with  <code>go mod edit -json</code>, which outputs a particular <code>go.mod</code> file in JSON format. Here is the documentation:</p>\n\n<p><a href=\"https://golang.org/cmd/go/#hdr-Edit_go_mod_from_tools_or_scripts\" rel=\"nofollow noreferrer\">https://golang.org/cmd/go/#hdr-Edit_go_mod_from_tools_or_scripts</a></p>\n\n<p>Alternatively, you could use <a href=\"https://godoc.org/github.com/rogpeppe/go-internal/modfile\" rel=\"nofollow noreferrer\">rogpeppe/go-internal/modfile</a>, which is a go package that can parse a <code>go.mod</code> file, and which is used by <a href=\"https://github.com/rogpeppe/gohack\" rel=\"nofollow noreferrer\">rogpeppe/gohack</a> and some other tools from the broader community.</p>\n\n<p>Issue <a href=\"https://github.com/golang/go/issues/28101\" rel=\"nofollow noreferrer\">#28101</a> I think tracks adding a new API to the Go standard library to parse <code>go.mod</code> files.</p>\n\n<p>Here is a snippet of the documentation for <code>go mod edit -json</code>:</p>\n\n<blockquote>\n  <p>The -json flag prints the final go.mod file in JSON format instead of\n  writing it back to go.mod. The JSON output corresponds to these Go\n  types:</p>\n</blockquote>\n\n<pre><code>type Module struct {\n    Path string\n    Version string\n}\n\ntype GoMod struct {\n    Module  Module\n    Go      string\n    Require []Require\n    Exclude []Module\n    Replace []Replace\n}\n\ntype Require struct {\n    Path string\n    Version string\n    Indirect bool\n}\n</code></pre>\n\n<p>Here is an example snippet of JSON output from <code>go mod edit -json</code> that shows the actual module path (aka module name), which was your original question:</p>\n\n<pre><code>{\n        \"Module\": {\n                \"Path\": \"rsc.io/quote\"\n        },\n</code></pre>\n\n<p>In this case, the module name is <code>rsc.io/quote</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1071, "user_id": 241993, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/zfpeC.jpg?s=128&g=1", "display_name": "Mohamed Bana", "link": "https://stackoverflow.com/users/241993/mohamed-bana"}, "is_accepted": false, "score": 0, "last_activity_date": 1597316420, "creation_date": 1597316420, "answer_id": 63393712, "question_id": 53183356, "link": "https://stackoverflow.com/questions/53183356/api-to-get-the-module-name/63393712#63393712", "title": "API to get the module name", "body": "<p>Try this?</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;io/ioutil&quot;\n    &quot;os&quot;\n\n    modfile &quot;golang.org/x/mod/modfile&quot;\n)\n\nconst (\n    RED   = &quot;\\033[91m&quot;\n    RESET = &quot;\\033[0m&quot;\n)\n\nfunc main() {\n    modName := GetModuleName()\n    fmt.Fprintf(os.Stdout, &quot;modName=%+v\\n&quot;, modName)\n}\n\nfunc exitf(beforeExitFunc func(), code int, format string, args ...interface{}) {\n    beforeExitFunc()\n    fmt.Fprintf(os.Stderr, RED+format+RESET, args...)\n    os.Exit(code)\n}\n\nfunc GetModuleName() string {\n    goModBytes, err := ioutil.ReadFile(&quot;go.mod&quot;)\n    if err != nil {\n        exitf(func() {}, 1, &quot;%+v\\n&quot;, err)\n    }\n\n    modName := modfile.ModulePath(goModBytes)\n    fmt.Fprintf(os.Stdout, &quot;modName=%+v\\n&quot;, modName)\n\n    return modName\n}\n</code></pre>\n"}], "owner": {"reputation": 51890, "user_id": 303477, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/a33dc35cc7a3747fd3b9a666a31a2533?s=128&d=identicon&r=PG&f=1", "display_name": "bsr", "link": "https://stackoverflow.com/users/303477/bsr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1353, "favorite_count": 0, "accepted_answer_id": 53183780, "answer_count": 3, "score": 5, "last_activity_date": 1597316420, "creation_date": 1541562901, "last_edit_date": 1541572411, "question_id": 53183356, "link": "https://stackoverflow.com/questions/53183356/api-to-get-the-module-name", "title": "API to get the module name", "body": "<p>Is there an API to get the module name of a project which uses go 1.11 module system?</p>\n\n<p>so I need to get <code>abc.com/a/m</code> from the module definition <code>module abc.com/a/m</code> in <code>go.mod</code> file.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1541571361, "post_id": 53183044, "comment_id": 93258330, "body": "Which, as I would like to point out, makes sense: a <a href=\"https://en.wikipedia.org/wiki/Transmission_Control_Protocol#Connection_establishment\" rel=\"nofollow noreferrer\">three-way tcp handshake</a> is <i>expensive</i> time wise ."}, {"owner": {"reputation": 29, "user_id": 8215167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7362882e29bbe159f46fd612a8fc261?s=128&d=identicon&r=PG", "display_name": "user8215167", "link": "https://stackoverflow.com/users/8215167/user8215167"}, "edited": false, "score": 0, "creation_date": 1543563829, "post_id": 53183044, "comment_id": 93972003, "body": "Sorry, i wanna to make established for every http request, not  reuse TCP connections. Any way to reach that?"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 0, "creation_date": 1543564587, "post_id": 53183044, "comment_id": 93972309, "body": "As stated in my edit, set <code>DisableKeepAlives</code> to <code>true</code>."}], "tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": false, "score": 1, "last_activity_date": 1543564527, "last_edit_date": 1543564527, "creation_date": 1541559707, "answer_id": 53183044, "question_id": 53182674, "link": "https://stackoverflow.com/questions/53182674/per-http-request-over-per-tcp-connection/53183044#53183044", "title": "per http request over per tcp connection", "body": "<p>If you are using the <code>DefaultTransport</code> for your HTTP requests then the TCP connections are reused.</p>\n\n<blockquote>\n  <p>DefaultTransport is the default implementation of Transport and is used by DefaultClient. It establishes network connections as needed and caches them for reuse by subsequent calls.</p>\n</blockquote>\n\n<p>You can use <code>MaxConnsPerHost</code> to limit the total number of connections:</p>\n\n<pre><code>// MaxConnsPerHost optionally limits the total number of\n// connections per host, including connections in the dialing,\n// active, and idle states. On limit violation, dials will block.\n//\n// Zero means no limit.\n//\n// For HTTP/2, this currently only controls the number of new\n// connections being created at a time, instead of the total\n// number. In practice, hosts using HTTP/2 only have about one\n// idle connection, though.\nMaxConnsPerHost int\n</code></pre>\n\n<p><strong>Edit</strong></p>\n\n<p>I highly suggest you read the <a href=\"https://golang.org/pkg/net/http/#Transport\" rel=\"nofollow noreferrer\">docs</a> as Go has one of the most well documented standard library. Anyway, you can configure <code>http.Transport</code> to disable keep-alive to force usage of one TCP connection per request.</p>\n\n<pre><code>// DisableKeepAlives, if true, disables HTTP keep-alives and\n// will only use the connection to the server for a single\n// HTTP request.\n//\n// This is unrelated to the similarly named TCP keep-alives.\nDisableKeepAlives bool\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 8215167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7362882e29bbe159f46fd612a8fc261?s=128&d=identicon&r=PG", "display_name": "user8215167", "link": "https://stackoverflow.com/users/8215167/user8215167"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1543564527, "creation_date": 1541555883, "last_edit_date": 1541572465, "question_id": 53182674, "link": "https://stackoverflow.com/questions/53182674/per-http-request-over-per-tcp-connection", "title": "per http request over per tcp connection", "body": "<p>My question is simple: How many http requests make how many tcp connections to server in Go.</p>\n\n<p>I'm coding a tool can send many http requests, but I find all this requests over one or two tcp connetions, seem like golang http Transport have a connections pool.</p>\n"}, {"tags": ["go", "aws-api-gateway", "serverless"], "comments": [{"owner": {"reputation": 95, "user_id": 3889099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d2ebc329403c635332b726c30859002?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/3889099/kevin"}, "edited": false, "score": 1, "creation_date": 1541554562, "post_id": 53182395, "comment_id": 93255160, "body": "Is your origin <code>http</code> or <code>https:&#47;&#47;localhost:8080</code>? The origin needs to match exactly.  I found this <a href=\"https://www.moesif.com/blog/technical/cors/Authoritative-Guide-to-CORS-Cross-Origin-Resource-Sharing-for-REST-APIs/\" rel=\"nofollow noreferrer\">guide</a> to be very effective at explaining how CORS works.  A couple notes: 1. If you have <code>&quot;Access-Control-Allow-Credentials&quot;: &quot;true&quot;</code>, you can&#39;t supply a wildcard <code>*</code> to <code>Access-Control-Allow-Origin</code>, for security reasons.  2. I don&#39;t think the issue is with OPTIONS, since your GET isn&#39;t preflighted (because I don&#39;t see you using any custom headers)"}, {"owner": {"reputation": 3596, "user_id": 2443687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1da01ca60576663e27ab608fc4dbbbb2?s=128&d=identicon&r=PG", "display_name": "Carlos Martinez", "link": "https://stackoverflow.com/users/2443687/carlos-martinez"}, "reply_to_user": {"reputation": 95, "user_id": 3889099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d2ebc329403c635332b726c30859002?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/3889099/kevin"}, "edited": false, "score": 0, "creation_date": 1541555988, "post_id": 53182395, "comment_id": 93255423, "body": "Hey @Kevin, the origin is <code>http</code> as you can see in the error, same value i&#39;m setting in <code>Access-Control-Allow-Origin</code> on the response. It seems like the header is not present when I check the response headers in my browser, but it is present when I inspect the response headers from Postman"}, {"owner": {"reputation": 3596, "user_id": 2443687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1da01ca60576663e27ab608fc4dbbbb2?s=128&d=identicon&r=PG", "display_name": "Carlos Martinez", "link": "https://stackoverflow.com/users/2443687/carlos-martinez"}, "reply_to_user": {"reputation": 95, "user_id": 3889099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d2ebc329403c635332b726c30859002?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/3889099/kevin"}, "edited": false, "score": 0, "creation_date": 1541556561, "post_id": 53182395, "comment_id": 93255523, "body": "Another comment, I&#39;m not seeing any logs from my lambda function when sending the AJAX request, it seems like the request is being handled before it triggers the function"}], "answers": [{"tags": [], "owner": {"reputation": 607, "user_id": 6252528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd8c3fb0c76fc0a7b1f004bc1ab8288f?s=128&d=identicon&r=PG&f=1", "display_name": "Cleriston", "link": "https://stackoverflow.com/users/6252528/cleriston"}, "is_accepted": false, "score": 5, "last_activity_date": 1541556731, "creation_date": 1541556731, "answer_id": 53182744, "question_id": 53182395, "link": "https://stackoverflow.com/questions/53182395/api-gateway-blocked-by-cors-policy-no-access-control-allow-origin-header/53182744#53182744", "title": "API Gateway, blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header", "body": "<p>My configuration is:</p>\n\n<pre><code>(event, context, callback) =&gt; {\n   callback(null, {\n      statusCode: (code || 200),\n      body: JSON.stringify(resp),\n      headers: { 'Access-Control-Allow-Origin': '*'},\n   });\n}\n</code></pre>\n\n<p>and it works fine for me. I use to have the same issue as you before, but as long as you define your function with CORS: true and your response contains the header, you should be fine.</p>\n\n<p>Note: Im didnt understand the sintax \"map[string]string\" and credentials should not be necessary at this case.</p>\n"}, {"tags": [], "owner": {"reputation": 3596, "user_id": 2443687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1da01ca60576663e27ab608fc4dbbbb2?s=128&d=identicon&r=PG", "display_name": "Carlos Martinez", "link": "https://stackoverflow.com/users/2443687/carlos-martinez"}, "is_accepted": true, "score": 3, "last_activity_date": 1541557933, "creation_date": 1541557933, "answer_id": 53182857, "question_id": 53182395, "link": "https://stackoverflow.com/questions/53182395/api-gateway-blocked-by-cors-policy-no-access-control-allow-origin-header/53182857#53182857", "title": "API Gateway, blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header", "body": "<p>It turns out I was ignoring the status code from the response :(</p>\n\n<p>I realized I was actually getting two errors:</p>\n\n<ul>\n<li>A 406 status code for a missing Content-Type header</li>\n<li>The CORS error</li>\n</ul>\n\n<p>The first error was caused because I wasn't passing the Content-Type header to the request (I had a check in my code I completely forget that expects that header).</p>\n\n<p><strong>The second error was caused because I didn't add the <code>Access-Control-Allow-Origin</code> header to the error response of my function.</strong></p>\n"}, {"comments": [{"owner": {"reputation": 1036, "user_id": 9855588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef25aee783cab58b07adb188667fb051?s=128&d=identicon&r=PG&f=1", "display_name": "dataviews", "link": "https://stackoverflow.com/users/9855588/dataviews"}, "edited": false, "score": 0, "creation_date": 1610577261, "post_id": 56816408, "comment_id": 116181522, "body": "thank you! Adding the Access-Control-Allow-Origin helped with my error"}], "tags": [], "owner": {"reputation": 2859, "user_id": 6225565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iqBej.jpg?s=128&g=1", "display_name": "Shalauddin Ahamad Shuza", "link": "https://stackoverflow.com/users/6225565/shalauddin-ahamad-shuza"}, "is_accepted": false, "score": 1, "last_activity_date": 1561799961, "creation_date": 1561799961, "answer_id": 56816408, "question_id": 53182395, "link": "https://stackoverflow.com/questions/53182395/api-gateway-blocked-by-cors-policy-no-access-control-allow-origin-header/56816408#56816408", "title": "API Gateway, blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header", "body": "<p>Enable <strong>Lamba proxy integration</strong></p>\n\n<pre><code>return events.APIGatewayProxyResponse{\n    StatusCode: http.StatusOK,\n    Headers: map[string]string{\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Content-Type\": \"application/json\",\n    },\n    Body: string(jsonEvents),\n}, nil\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/BM5dq.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/BM5dq.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 3596, "user_id": 2443687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1da01ca60576663e27ab608fc4dbbbb2?s=128&d=identicon&r=PG", "display_name": "Carlos Martinez", "link": "https://stackoverflow.com/users/2443687/carlos-martinez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10864, "favorite_count": 0, "accepted_answer_id": 53182857, "answer_count": 3, "score": 6, "last_activity_date": 1561799961, "creation_date": 1541553067, "question_id": 53182395, "link": "https://stackoverflow.com/questions/53182395/api-gateway-blocked-by-cors-policy-no-access-control-allow-origin-header", "title": "API Gateway, blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header", "body": "<p>I know this question might be duplicated, but none of the existing question point to anything I'm not doing...</p>\n\n<p>I've deployed an API using the serverless framework, but I'm having trouble with CORS.</p>\n\n<p>I'm doing a get request using axios:</p>\n\n<pre><code>axios.get('https://test.execute-api.us-west-1.amazonaws.com/dev/test?from=2012-01-09T21:40:00Z')\n     .then(response =&gt; {\n       this.data = response.data;\n     })\n     .catch(error =&gt; console.log(error))\n</code></pre>\n\n<p>And I'm getting the following error:</p>\n\n<pre><code>Access to XMLHttpRequest at 'https://test.execute-api.us-west-1.amazonaws.com/dev/test?from=2012-01-09T21:40:00Z' from origin 'http://localhost:8080' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.\n</code></pre>\n\n<p>What I've already done:</p>\n\n<ul>\n<li>Made sure there's an OPTIONS method in API Gateway with a method response that looks like this:</li>\n</ul>\n\n<p><a href=\"https://i.stack.imgur.com/mkjYB.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/mkjYB.png\" alt=\"enter image description here\"></a></p>\n\n<ul>\n<li>Made sure I deployed those changes.</li>\n</ul>\n\n<p>Also, the response of my Lambda function is returning the following headers:</p>\n\n<pre><code>return events.APIGatewayProxyResponse{\n    StatusCode: http.StatusOK,\n    Headers: map[string]string{\n        \"Access-Control-Allow-Origin\":      \"http://localhost:8080\",\n        \"Access-Control-Allow-Credentials\": \"true\",\n    },\n    Body: string(jsonEvents),\n}, nil\n</code></pre>\n\n<p>I also tried setting <code>Access-Control-Allow-Origin</code> to <code>'*'</code></p>\n\n<p>My serverless.yml file has <code>cors: true</code> on each of the function events:</p>\n\n<pre><code>functions:\n  deploymentFrequency:\n    handler: bin/update/deployment-frequency\n    events:\n      - http:\n          path: deployment-frequency\n          method: post\n          cors: true\n  fetchDeploymentFrequency:\n    handler: bin/fetch/deployment-frequency\n    events:\n      - http:\n          path: deployment-frequency\n          method: get\n          cors: true\n</code></pre>\n\n<p>What am I missing? Nothing seems to work. The request works fine from Postman and it looks to be including the headers, so this seems to be an issue with the OPTIONS method.</p>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 3, "creation_date": 1541551848, "post_id": 53182202, "comment_id": 93254567, "body": "This is just coincidence and will not give you the smallest number when your input data changes. Hint: try changing 9 to 16."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1541551852, "post_id": 53182202, "comment_id": 93254568, "body": "The program prints numbers that are less than the number&#39;s index in the slice, not the smallest number in the slice."}], "answers": [{"tags": [], "owner": {"reputation": 3754, "user_id": 6027873, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1aa721a23e4aa11f8d8c4d92f0eee8cc?s=128&d=identicon&r=PG&f=1", "display_name": "hoque", "link": "https://stackoverflow.com/users/6027873/hoque"}, "is_accepted": false, "score": 1, "last_activity_date": 1541570976, "creation_date": 1541570976, "answer_id": 53184352, "question_id": 53182202, "link": "https://stackoverflow.com/questions/53182202/find-smallest-number-in-a-list/53184352#53184352", "title": "Find smallest number in a list", "body": "<p>In</p>\n\n<pre><code>for i, num := range x {\n        if num &lt; i {\n            fmt.Println(num)\n        }\n    }\n</code></pre>\n\n<p>Here, <code>i</code> represents index and <code>num</code> represents the value. So, your <code>if</code> condition represents value is less than index then prints the value. For, 9 value is 9 and index is 14. so It prints 9, Which is not what you want to do. </p>\n"}, {"tags": [], "owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "is_accepted": false, "score": 3, "last_activity_date": 1541571761, "creation_date": 1541571761, "answer_id": 53184473, "question_id": 53182202, "link": "https://stackoverflow.com/questions/53182202/find-smallest-number-in-a-list/53184473#53184473", "title": "Find smallest number in a list", "body": "<p>To find the smallest number in the list you will need to iterate over the list and store the smallest number you have currently found. Compare this \"smallest-so-far\" number against each other number in the list and if you find a smaller one, replace your smallest number with it. At the end of the iteration you will know the smallest number in the list.</p>\n\n<pre><code>smallest := x[0]            // set the smallest number to the first element of the list\nfor _, num := range x[1:] { // iterate over the rest of the list\n    if num &lt; smallest {     // if num is smaller than the current smallest number\n        smallest = num      // set smallest to num\n    }\n}\nfmt.Println(smallest)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 3, "last_activity_date": 1541576548, "creation_date": 1541576548, "answer_id": 53185259, "question_id": 53182202, "link": "https://stackoverflow.com/questions/53182202/find-smallest-number-in-a-list/53185259#53185259", "title": "Find smallest number in a list", "body": "<p>To expand a bit on @hoque's answer: The fact that the sample program you give is purely coincidental. If the correct value 9 would be the first in the slice, there would be no output at all.</p>\n\n<p>There are various ways to achieve the goal of identifying the smallest int (there are more ways):</p>\n\n<pre><code>func smallestOfCopyWithSort(in []int) int {\n\n  // Make a copy, so we do not have to modify the original slice.\n  // Note: Do NOT use this approach, it is here only for completeness.\n  copy := append([]int(nil), in...)\n  sort.Ints(copy)\n  return (copy[0])\n}\n\nfunc smallestWithSort(in []int) int {\n  // Sort the slice.\n  // Note that it will be modified and you\n  // need to make sure that it will always\n  // be sorted, even when you add new values.\n  sort.Ints(in)\n  return (in[0])\n}\n\nfunc smallestWithMattsApproach(in []int) int {\n  smallest := in[0]            // set the smallest number to the first element of the list\n\n  for _, num := range in[1:] { // iterate over the rest of the list\n    if num &lt; smallest { // if num is smaller than the current smallest number\n      smallest = num // set smallest to num\n    }\n  }\n\n  return smallest\n}\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/a/53184473/1296707\">@Matt's approach</a> is probably the best one, as it is quite fast without the need of modifying the original slice. And it really depends on what you want to achieve. Here are some benchmarks</p>\n\n<pre><code>$ go test -test.benchmem -bench=. -test.cpu 1,2,4 -test.benchtime=10s\ngoos: darwin\ngoarch: amd64\npkg: &lt;redacted&gt;\nBenchmarkSortWithCopy          5000000       345 ns/op       160 B/op          2 allocs/op\nBenchmarkSortWithCopy-2        5000000       354 ns/op       160 B/op          2 allocs/op\nBenchmarkSortWithCopy-4        5000000       352 ns/op       160 B/op          2 allocs/op\nBenchmarkMattsApproach       100000000      15.1 ns/op         0 B/op          0 allocs/op\nBenchmarkMattsApproach-2     100000000      15.1 ns/op         0 B/op          0 allocs/op\nBenchmarkMattsApproach-4     100000000      15.2 ns/op         0 B/op          0 allocs/op\nBenchmarkSort               2000000000      0.00 ns/op         0 B/op          0 allocs/op\nBenchmarkSort-2             2000000000      0.00 ns/op         0 B/op          0 allocs/op\nBenchmarkSort-4             2000000000      0.00 ns/op         0 B/op          0 allocs/op\n</code></pre>\n\n<p>Non-surprisingly, <code>smallestOfCopyWithSort</code> is orders of magnitude slower than the other approaches if called multiple times.</p>\n\n<p>Matts approach is blazing fast and does not copy or modify anything.</p>\n\n<p>However, if you need to access the smallest number of the slice multiple times, sorting the slice (ascending) and simply accessing the first member is more efficient. The reason for this is that the slice will be modified to be in sorted order. There is a caveat to this approach, however: you either need to be very <a href=\"https://github.com/golang/go/wiki/SliceTricks#insert\" rel=\"nofollow noreferrer\">careful when you add values to the slice</a> or resort it every time you modify it, which might nullify the performance advantage, depending on your ratio of reads and writes to/from the slice. Personally, I find the <code>smallestWithSort</code> the solution I use most often, since the slices I am working with usually do not change.</p>\n\n<h2>Conclusion</h2>\n\n<p>If you only need to <em>access</em> the smallest number once or the order of the slice values matters, use Matt's approach. If the order does not matter <em>and</em> you need to access the smallest number more than once, you probably should go with <code>smallestWithSort</code>, keeping the constraints in mind.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10906583, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-0EZFYZWNxGM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYmE6IFcrU-sehBDhCe_7DS7VLk1Q/mo/photo.jpg?sz=128", "display_name": "Shayan Karami", "link": "https://stackoverflow.com/users/10906583/shayan-karami"}, "is_accepted": false, "score": -2, "last_activity_date": 1600155284, "creation_date": 1600155284, "answer_id": 63897152, "question_id": 53182202, "link": "https://stackoverflow.com/questions/53182202/find-smallest-number-in-a-list/63897152#63897152", "title": "Find smallest number in a list", "body": "<p>return smallest number of a list in python</p>\n<pre><code>def find_smallest_number(input_list):\n    d=[]\n    for num in input_list:\n        for i in numbers:\n            if num&lt;i:\n                if d==[]:\n                    d.append(num)\n                else:\n                    for j in d:\n                        if j&gt;num:\n                            d.remove(j)\n                            d.append(num)\n    return d\n</code></pre>\n"}], "owner": {"reputation": 311, "user_id": 8921111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0e6d3bd8500714c83c194cde243a1af?s=128&d=identicon&r=PG&f=1", "display_name": "fnklstn", "link": "https://stackoverflow.com/users/8921111/fnklstn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 966, "favorite_count": 0, "answer_count": 4, "score": -1, "last_activity_date": 1600155284, "creation_date": 1541551511, "last_edit_date": 1541552200, "question_id": 53182202, "link": "https://stackoverflow.com/questions/53182202/find-smallest-number-in-a-list", "title": "Find smallest number in a list", "body": "<p>I wrote a program in Go that finds the smallest number in a list and it works. \nHowever, I don't really understand the logic. Could you please explait how comes that it works? </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    x := []int{\n        48, 96, 86, 68,\n        57, 82, 63, 70,\n        37, 34, 83, 27,\n        19, 97, 9, 17,\n    }\n\n    for i, num := range x {\n        if num &lt; i {\n            fmt.Println(num)\n        }\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Awuw2Th1g2V\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Awuw2Th1g2V</a></p>\n\n<p>Output:</p>\n\n<pre><code>9\n</code></pre>\n\n<p>The solution in my textbook is different and I understand the logic there. </p>\n"}, {"tags": ["c++", "go", "multilingual", "flatbuffers"], "answers": [{"comments": [{"owner": {"reputation": 312, "user_id": 4522147, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hmhDOrapTas/AAAAAAAAAAI/AAAAAAAAABM/vDs2120-l9k/photo.jpg?sz=128", "display_name": "Jean-Benoit Harvey", "link": "https://stackoverflow.com/users/4522147/jean-benoit-harvey"}, "edited": false, "score": 0, "creation_date": 1541604483, "post_id": 53181712, "comment_id": 93274025, "body": "You&#39;re totally right on the fact that the local variable goes out of scope.  I added your suggestion to my original code since its certain this is necessary."}, {"owner": {"reputation": 312, "user_id": 4522147, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hmhDOrapTas/AAAAAAAAAAI/AAAAAAAAABM/vDs2120-l9k/photo.jpg?sz=128", "display_name": "Jean-Benoit Harvey", "link": "https://stackoverflow.com/users/4522147/jean-benoit-harvey"}, "edited": false, "score": 0, "creation_date": 1541605713, "post_id": 53181712, "comment_id": 93274807, "body": "Although your answer did not fix my problem, it prevent a future one. For this I thank you.       It also brought to my attention the buffer and its management.     I finally solved the problem by increasing the initial buffer size when creating the builder.    It appears that when the builder resizes the buffer, it looses or does not use the 2 bytes following the end of the original size. I don&#39;t know if this is due to a bug or a misuse from my part, but I do not remember reading anything about this in the documentation."}], "tags": [], "owner": {"reputation": 4578, "user_id": 17419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JU9iE.jpg?s=128&g=1", "display_name": "Aardappel", "link": "https://stackoverflow.com/users/17419/aardappel"}, "is_accepted": true, "score": 2, "last_activity_date": 1541547571, "creation_date": 1541547571, "answer_id": 53181712, "question_id": 53181435, "link": "https://stackoverflow.com/questions/53181435/multi-language-integration-problem-with-flatbuffers/53181712#53181712", "title": "Multi-language integration problem with FlatBuffers", "body": "<p>Not sure if this the entire problem, but a quick glance at <code>convertStreamMessage</code> shows a major problem: the <code>FlatBufferBuilder</code> is a local variable which goes out of scope just as you are returning a raw pointer to its internal data which is being destructed.</p>\n\n<p>You either want to make sure the <code>FlatBufferBuilder</code> outlives the sending of the data, or use <code>FlatBufferBuilder::Release()</code> as the return value instead.</p>\n\n<p>Also note that in debugging these problems, you could have used the C++ verifier (or any code that reads the data) to check the data just before sending it, which would have caught this problem earlier.</p>\n"}, {"comments": [{"owner": {"reputation": 4578, "user_id": 17419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JU9iE.jpg?s=128&g=1", "display_name": "Aardappel", "link": "https://stackoverflow.com/users/17419/aardappel"}, "edited": false, "score": 0, "creation_date": 1541622913, "post_id": 53193159, "comment_id": 93283289, "body": "Resizing most definitely does not lose data, it sounds like you have further problems hiding in your code if this happening."}, {"owner": {"reputation": 312, "user_id": 4522147, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hmhDOrapTas/AAAAAAAAAAI/AAAAAAAAABM/vDs2120-l9k/photo.jpg?sz=128", "display_name": "Jean-Benoit Harvey", "link": "https://stackoverflow.com/users/4522147/jean-benoit-harvey"}, "reply_to_user": {"reputation": 4578, "user_id": 17419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JU9iE.jpg?s=128&g=1", "display_name": "Aardappel", "link": "https://stackoverflow.com/users/17419/aardappel"}, "edited": false, "score": 0, "creation_date": 1541693774, "post_id": 53193159, "comment_id": 93311505, "body": "Thanks for the insight, I will investigate further."}], "tags": [], "owner": {"reputation": 312, "user_id": 4522147, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hmhDOrapTas/AAAAAAAAAAI/AAAAAAAAABM/vDs2120-l9k/photo.jpg?sz=128", "display_name": "Jean-Benoit Harvey", "link": "https://stackoverflow.com/users/4522147/jean-benoit-harvey"}, "is_accepted": false, "score": 1, "last_activity_date": 1541606362, "creation_date": 1541606362, "answer_id": 53193159, "question_id": 53181435, "link": "https://stackoverflow.com/questions/53181435/multi-language-integration-problem-with-flatbuffers/53193159#53193159", "title": "Multi-language integration problem with FlatBuffers", "body": "<blockquote>\n  <p>In the end what solved my problem was simply to increase the initial buffer size of the builder in the <strong>client</strong>.   </p>\n  \n  <p>It would appear that immediately when the builder resizes, the 2 bytes positioned next to the end of the initial buffer (before the dynamic resize) were either not used or lost their data.  </p>\n</blockquote>\n\n<p>The test data I was using in the <strong>client</strong> didn't brought this problem forward, it's payload was a bit smaller than the real data we used, so when the test were running, no resize happened.  </p>\n\n<p>Although this is the actual solution to my problem, I would not have found it this fast without <a href=\"https://stackoverflow.com/a/53181712/4522147\">@Aardappel's answer</a> , which also prevented an eventual later problem. </p>\n"}], "owner": {"reputation": 312, "user_id": 4522147, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hmhDOrapTas/AAAAAAAAAAI/AAAAAAAAABM/vDs2120-l9k/photo.jpg?sz=128", "display_name": "Jean-Benoit Harvey", "link": "https://stackoverflow.com/users/4522147/jean-benoit-harvey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 459, "favorite_count": 0, "accepted_answer_id": 53181712, "answer_count": 2, "score": 2, "last_activity_date": 1541606362, "creation_date": 1541545584, "question_id": 53181435, "link": "https://stackoverflow.com/questions/53181435/multi-language-integration-problem-with-flatbuffers", "title": "Multi-language integration problem with FlatBuffers", "body": "<h1>Question</h1>\n\n<p>I have a recurring crash (<code>panic: runtime error: slice bounds out of range</code>) from the <code>flatbuffers</code> generated server files when attempting to access a part of a buffer (created with <code>flatbuffers</code>) which contains a message streamed from one client to a server.<br>\nThis problem only appears in integration of both client and server. When tested on their own, both client and server succeed in using <code>flatbuffers</code> and no crash occurs in the server <code>// see the boundary tests below</code><br>\nKnowing that:<br>\n - the sent and received <code>byte[]</code> is the same, (which excludes a problem in the communication method)<br>\n - the sent data is correctly formed before it is put in the <code>flatbuffers</code>' <code>buffer</code> and sent.<br>\nWhat could be causing this? </p>\n\n<h1>Problem context and details</h1>\n\n<p>I have a <code>c++</code> <strong>client</strong> and a <code>go</code> <strong>server</strong> that communicate using <code>FlatBuffers</code>.<br>\nThe <strong>client</strong> and <strong>server</strong> both have automated boundary-tests which confirm that they each \"correctly\" use <code>flatbuffers</code> the way they should. (i.e. the <strong>client</strong> creates the buffer before sending it and the <strong>server</strong> receives before access it)<br>\nThese tests work.\nWe are using <code>FlatBuffers-v1.10.0</code></p>\n\n<p>My problem is that when they are used together, the following error always occurs in the <strong>server</strong> when accessing to the buffer:  </p>\n\n<pre><code>panic: runtime error: slice bounds out of range  \n\ngoroutine 19 [running]:\ngithub.com/google/flatbuffers/go.(*Table).GetVOffsetT(...)\n     /home/.../go/github.com/google/flatbuffers/go/table.go:134\ngithub.com/google/flatbuffers/go.(*Table).OffsetT(0x4000045c68, 0x4000000004, 0x4000160008)\n     /home/.../go/github.com/google/flatbuffers/go/table.go:16 +0xf0\ngithub.com/PhantomIntelligence/Server/lib/Protocol/Stream.(*StreamedData).Id(0x4000045c68, 0x4000045c68)\n     /home/.../go/github.com/PhantomIntelligence/Server/lib/Protocol/Stream/SteamedData.go:30 +0x2c\ngithub.com/PhantomIntelligence/Server/dataAccess/conversion/flatBuffers.ConvertStreamMessage(0x4000015a000, 0xa7c, 0xe00, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\n     /home/.../go/github.com/PhantomIntelligence/Server/dataAccess/conversion/flatBuffers/deserialization.go:55 +0x1fc\n... // the rest is irrelevant for this question's purpose \n</code></pre>\n\n<h2>Data causing the crash</h2>\n\n<p>The crash always happen on the first buffer received by the server when it tries to access it to use it. More specifically, it always happen when attempting to access the either the (0th, 12th or 15th) <code>ContainerData</code> of the 7th <code>Container</code>.  </p>\n\n<blockquote>\n  <p>Know that for this use case, we send a <em>StreamedData</em> with 16 <em>Containers</em>, each holding 16 <em>ContainerData</em>  </p>\n</blockquote>\n\n<hr>\n\n<h1>Code details</h1>\n\n<blockquote>\n  <p>Note that only the structure is remains from my original implementation. I am not allowed to divulgate the nature of the data we manipulate. Thus the object names might seem weird, but the structure is the relevant part.   </p>\n</blockquote>\n\n<h2>Schema compilation</h2>\n\n<p>The <code>c++</code> <strong>client</strong> runs this during its compilation:  </p>\n\n<pre><code>flatc -o lib/ --no-js-exports --no-prefix --scoped-enums --cpp schemas/*.fbs\n</code></pre>\n\n<p>The <code>go</code> <strong>server</strong> runs this during its compilation:  </p>\n\n<pre><code>flatc -o lib/ --no-js-exports --no-prefix --scoped-enums --go schemas/*.fbs\n</code></pre>\n\n<h2>Schemas</h2>\n\n<p>Both the <strong>client</strong> and <strong>server</strong> use the following schema:  </p>\n\n<blockquote>\n  <p>Please note that this extract is not the complete schema, only the part relevant for this question.  </p>\n</blockquote>\n\n<pre><code>// file: stream_streamed_data.fbs\nnamespace Protocol.Stream;\ntable ContainerData {\n  id:uint16 = 0;\n  a:uint16 = 0;\n  b:uint16 = 0;\n  c:int16 = 0;\n  d:int16 = 0;\n  e:uint8 = 0;\n}\ntable Container {\n  id:uint16 = 65535;\n  data:[ContainerData];\n}\ntable StreamedData {\n  id:uint16 = 0;\n  containers:[Container];\n}\n---- \n// file: stream_payload.fbs\ninclude \"stream_streamed_data.fbs\";\n/* some more includes ... */\n\nnamespace Protocol.Stream;\nunion PayloadContent { StreamedData, ..., Request, Result } \n\ntable Payload {\n  sensor_id:string;\n  content:PayloadContent;\n}\n\n---- \n// file: header.fbs\n\nnamespace Protocol;\ntable Header {\n  source_id:string;\n  destination_id:string;\n  timestamp:string;\n}\n\n---- \n// file: protocol_message.fbs\ninclude \"headers.fbs\";\ninclude \"stream_payload.fbs\";\n/* some more includes ... */\n\nnamespace Protocol;\nunion Content { Stream.Payload, ..., Other.Payload } \n\ntable Message {\n  header:Header;\n  content:Content;\n}\n\nroot_type Message;  \n</code></pre>\n\n<p>The <strong>client</strong> has to stream <code>Protocol.Message</code>s that contain <code>Protocol.Stream.Payload</code>, which themselves contain a <code>Protocol.Stream.StreamedMessage</code>.  </p>\n\n<h2><strong>Client</strong> implementation</h2>\n\n<pre><code>#ifndef CLIENT_FLATBUFFERSCONVERTER_HPP\n#define CLIENT_FLATBUFFERSCONVERTER_HPP\n\n#include &lt;flatbuffers/flatbuffers.h&gt;\n#include &lt;lib/protocol/protocol_message_generated.h&gt;\n#include &lt;chrono&gt;\n#include &lt;iostream&gt;\n\nnamespace ServerCommunication {\n\n    enum class ProtocolStructure : uint8_t {\n        NONE = 0,\n        /* some more types ... */\n\n        SENSOR_MESSAGE = 12,\n\n        /* some more types ... */\n\n        UNRECOGNIZED_TYPE = // A NUMBER,\n        MIN = NONE,\n        MAX = UNRECOGNIZED_TYPE\n    };\n\n    typedef uint8_t* FlatBuffersBytes;\n\n    struct BytesToSend {\n        FlatBuffersBytes data;\n        size_t dataLength;\n    };\n\n    namespace BufferSize {\n        size_t const STREAMED_MESSAGE = 2560;\n    }\n\n    template&lt;class T&gt;\n    class FlatBuffersConverter {\n\n    public:\n\n        explicit FlatBuffersConverter() = delete;\n\n        ~FlatBuffersConverter() noexcept = delete;\n\n        FlatBuffersConverter(FlatBuffersConverter const&amp; other) = delete;\n\n        FlatBuffersConverter(FlatBuffersConverter&amp;&amp; other) noexcept = delete;\n\n        FlatBuffersConverter&amp; operator=(FlatBuffersConverter const&amp; other)&amp; = delete;\n\n        FlatBuffersConverter&amp; operator=(FlatBuffersConverter&amp;&amp; other)&amp; noexcept = delete;\n\n        static BytesToSend const convertSensorMessage(typename T::Message&amp;&amp; message) noexcept;\n\n    private:\n\n        static std::string const generateSerializationTimestamp() noexcept;\n\n\n    };\n\n    template&lt;class T&gt;\n    BytesToSend const FlatBuffersConverter&lt;T&gt;::convertStreamMessage(typename T::StreamMessage&amp;&amp; message) noexcept {\n        flatbuffers::FlatBufferBuilder builder(BufferSize::STREAM_MESSAGE);\n\n        auto streamIdFromMessage = message.getStreamId();\n        auto streamId = builder.CreateString(streamIdFromMessage.c_str(), streamIdFromMessage.size());\n        auto source = streamId;\n        auto destination = builder.CreateString(\"Server\");\n        auto timestamp = builder.CreateString(generateSerializationTimestamp());\n        auto header = Protocol::CreateHeader(\n                builder,\n                source,\n                destination,\n                timestamp);\n\n        auto containersFromStreamMessage = message.getContainers();\n        std::vector&lt;flatbuffers::Offset&lt;Protocol::Stream::Container&gt;&gt; containerVector;\n        auto containerIterator = containersFromStreamMessage-&gt;begin();\n        auto containerEnd = containersFromStreamMessage-&gt;end();\n\n        for (; containerIterator != containerEnd; ++containerIterator) {\n\n            auto dataFromContainer = containerIterator-&gt;getData();\n            std::vector&lt;flatbuffers::Offset&lt;GatewayProtocol::Stream::ContainerData&gt;&gt; containerDataVector;\n            auto containerDataIterator = dataFromContainer-&gt;begin();\n            auto containerDataEnd = dataFromContainer-&gt;end();\n\n            for (; containerDataIterator != containerDataEnd; ++containerDataIterator) {\n                auto track = Protocol::Stream::CreateContainerData(\n                        builder,\n                        containerDataIterator-&gt;id,\n                        containerDataIterator-&gt;a,\n                        containerDataIterator-&gt;b,\n                        containerDataIterator-&gt;c,\n                        containerDataIterator-&gt;d,\n                        containerDataIterator-&gt;e);\n                containerDataVector.push_back(containerData);\n            }\n\n            auto containerDataFBVector = builder.CreateVector(containerDataVector);\n\n            auto container = Protocol::Stream::CreateContainer(\n                    builder,\n                    containerIterator-&gt;id,\n                    containerDataFBVector);\n            containerVector.push_back(container);\n        }\n\n        auto containers = builder.CreateVector(containerVector);\n        auto streamMessageContent = Protocol::Stream::CreateStreamedData(\n                builder,\n                message.messageId,\n                containers);\n\n        auto streamPayload = Protocol::Stream::CreatePayload(\n                builder,\n                streamId,\n                Protocol::Stream::PayloadContent::StreamedData,\n                streamMessageContent.Union());\n\n        auto convertedMessage = Protocol::CreateMessage(\n                builder,\n                header,\n                Protocol::Content::Stream_Payload,\n                sensorPayload.Union());\n\n        builder.Finish(convertedMessage);\n\n        auto size = builder.GetSize();\n        auto data = builder.GetBufferPointer();\n        BytesToSend bytesToSend{data, size};\n        return bytesToSend;\n    }\n\n    template&lt;class T&gt;\n    std::string const FlatBuffersConverter&lt;T&gt;::generateSerializationTimestamp() noexcept {\n        std::size_t const ARBITRARY_BIG_ENOUGH_SIZE = 128;\n        auto timestamp = std::chrono::high_resolution_clock::now();\n        auto time_tTimestamp = std::chrono::system_clock::to_time_t(timestamp);\n        auto utcTime = gmtime(&amp;time_tTimestamp);\n        char charArrayTime[ARBITRARY_BIG_ENOUGH_SIZE];\n        auto numberOfCharacterWritten = strftime(charArrayTime, sizeof(charArrayTime), \"%D %T\", utcTime);\n        std::string formattedTime(std::begin(charArrayTime), std::begin(charArrayTime) + numberOfCharacterWritten);\n        return formattedTime;\n    }\n\n}\n\n#endif //CLIENT_FLATBUFFERSCONVERTER_HPP\n</code></pre>\n\n<h2><strong>Client</strong> Boundary test</h2>\n\n<pre><code>#ifndef CLIENT_SERVERCOMMUNICATORTEST_CPP\n#define CLIENT_SERVERCOMMUNICATORTEST_CPP\n\n#include &lt;gtest/gtest.h&gt;\n\n/* some other include */\n#include \"spirit-sensor-gateway/server-communication/WebSocketServerCommunicationStrategy.hpp\"\n#include \"test/utilities/stub/WebSocketServerStub.h\" // &lt;--- Receives and accesses the buffer\n\nusing ServerCommunication::WebSocketServerCommunicationStrategy;\nusing Stub::WebSocketServerStub;\nusing TestFunctions::DataTestUtil;\n\nclass WebSocketServerCommunicatorTest : public ::testing::Test {\nprotected:\n};\n\nTEST_F(WebSocketServerCommunicatorTest, given_aNumberOfRandomStreamDataMessage_when_send_then_theDataIsPutInFlatBuffersAndReceivedByTheServer) {\n\n    auto numberOfMessageToSend = 10;\n\n    WebSocketServerStub webSocketServerStub;\n\n    WebSocketServerCommunicationStrategy&lt;Sensor::Test::ServerLike::Structures&gt; webSocketServerCommunicationStrategy;\n    webSocketServerStub.run();\n    webSocketServerCommunicationStrategy.openConnection(webSocketServerStub.getAddress());\n\n    ServerStructuresLists::StreamDataMessages sentStreamDataMessages;\n\n    for (auto i = 0; i &lt; numberOfMessageToSend; i++) {\n        auto streamDataMessage = DataTestUtil::createRandomStreamDataMessage();\n        auto streamDataMessageCopy = DataModel::StreamDataMessage(streamDataMessage);\n\n        sentStreamDataMessages.push_back(std::move(streamDataMessageCopy));\n        webSocketServerCommunicationStrategy.sendMessage(std::move(streamDataMessage));\n    }\n\n    auto numberOfReceivedMessages = webSocketServerStub.getNumberOfMessageReceived();\n    while(numberOfMessageToSend != numberOfReceivedMessages) {\n        std::this_thread::sleep_for(std::chrono::milliseconds(50));\n        std::this_thread::yield();\n        numberOfReceivedMessages = webSocketServerStub.getNumberOfMessageReceived();\n    }\n\n    webSocketServerCommunicationStrategy.closeConnection();\n    auto receivedStreamDataMessages = webSocketServerStub.getStreamDataMessages();\n\n    auto sameMessageSentAndReceived = sentStreamDataMessages.size() == receivedStreamDataMessages.size();\n\n    for (auto streamDataMessageIndex = 0;\n         sameMessageSentAndReceived &amp;&amp; streamDataMessageIndex &lt; sentStreamDataMessages.size(); ++streamDataMessageIndex) {\n        sameMessageSentAndReceived = sameMessageSentAndReceived &amp;&amp;\n                                     sentStreamDataMessages.front() == receivedStreamDataMessages.front();\n        sentStreamDataMessages.pop_front();\n        receivedStreamDataMessages.pop_front();\n    }\n    if (!sameMessageSentAndReceived) {\n        while (!sentStreamDataMessages.empty() &amp;&amp; !receivedStreamDataMessages.empty()) {\n            std::cout &lt;&lt; \"Sent:     \" &lt;&lt; sentStreamDataMessages.front().toString() &lt;&lt; std::endl;\n            std::cout &lt;&lt; \"Received: \" &lt;&lt; receivedStreamDataMessages.front().toString() &lt;&lt; std::endl;\n            sentStreamDataMessages.pop_front();\n            receivedStreamDataMessages.pop_front();\n        }\n    }\n\n    ASSERT_TRUE(sameMessageSentAndReceived);\n}\n\n#endif //CLIENT_SERVERCOMMUNICATORTEST_CPP\n</code></pre>\n\n<h2><strong>Client</strong>'s ServerStub FlatBuffer Conversion function</h2>\n\n<pre><code>#include \"ServerStubFlatBuffersConverter.h\"\n\nusing Stub::ServerFlatBuffersConverter;\nusing ServerCommunication::ProtocolStructure;\n\nServerFlatBuffersConverter::StreamDataMessage\nServerFlatBuffersConverter::convertToStreamDataMessage(const ServerCommunication::FlatBuffersBytes flatBuffersBytes) {\n    // the identification step has been done at this point, we know the []byte holds a StreamedData\n    auto message = Protocol::GetMessage(flatBuffersBytes);\n    auto streamDataMessagePayload = message-&gt;content_as_Stream_Payload();\n    auto streamedData = streamDataMessagePayload-&gt;content_as_StreamedData();\n    auto messageId = streamedData-&gt;id();\n    auto streamId = flatbuffers::GetString(streamDataMessagePayload-&gt;stream_id());\n\n    auto ContainersBuffer = streamedData-&gt;containers();\n\n    std::vector&lt;DataModel::MessageContainer&gt; containers;\n    for (flatbuffers::uoffset_t containerIndex = 0;\n         containerIndex &lt; ContainersBuffer-&gt;Length();\n         ++containerIndex) {\n        auto containerFromBuffer = ContainersBuffer-&gt;Get(containerIndex);\n\n        auto containerId = containerFromBuffer-&gt;id();\n        auto containerDatasBuffer = containerFromBuffer-&gt;data();\n        std::vector&lt;DataModel::ContainerData&gt; containerDatas;\n        for (auto dataIterator = containerDatasBuffer-&gt;begin();\n             dataIterator != containerDatasBuffer-&gt;end();\n             ++dataIterator) {\n            auto data = DataModel::ContainerData{\n                    dataIterator-&gt;id(),\n                    dataIterator-&gt;a(),\n                    dataIterator-&gt;b(),\n                    dataIterator-&gt;c(),\n                    dataIterator-&gt;d(),\n                    dataIterator-&gt;e()\n            };\n            containerDatas.push_back(data);\n        }\n        auto container = DataModel::MessageContainer(containerId, containerDatas);\n        containers.push_back(container);\n    }\n\n    StreamDataMessage message(streamId, messageId, containers);\n    return message;\n}\n</code></pre>\n\n<h2><strong>Server</strong> Implementation</h2>\n\n<pre><code>package flatBuffers\n\nimport (\n    \"github.com/PhantomIntelligence/Server/domain/protocol\"\n    \"github.com/PhantomIntelligence/Server/lib/Protocol\"\n    \"github.com/PhantomIntelligence/Server/lib/Protocol/Stream\"\n    \"github.com/google/flatbuffers/go\"\n)\n\ntype GatewayMessageType = byte\n\nconst (\n    NONE                     = 0\n     /* some more types ... */\n    SENSOR_MESSAGE           = 12\n    /* some more types ... */\n    UNRECOGNIZED_TYPE        = // A NUMBER\n)\n\nfunc ConvertStreamMessage(messageBytes []byte) protocol.StreamMessage {\n    // the identification step has been done at this point, we know the []byte holds a StreamedData\n    var protocolMessageFlatBuffersTable = new(flatbuffers.Table)\n    var protocolMessageContentFlatBuffersTable = new(flatbuffers.Table)\n\n    var clientMessageOffset = Protocol.GetRootAsMessage(messageBytes, 0)\n\n    var header = new(Protocol.Header)\n    clientMessageOffset.Header(header)\n    clientMessageOffset.Content(protocolMessageFlatBuffersTable)\n\n    var messageTimestampString = string(header.Timestamp())\n\n    var streamedPayload = new(Stream.Payload)\n    streamedPayload.Init(protocolMessageFlatBuffersTable.Bytes, protocolMessageFlatBuffersTable.Pos)\n    streamedPayload.Content(protocolMessageContentFlatBuffersTable)\n\n    var streamIdFromClient = string(streamedPayload.StreamId())\n\n    var streamedDataFromClient = new(Stream.StreamedData)\n    streamedDataFromClient.Init(protocolMessageContentFlatBuffersTable.Bytes, protocolMessageContentFlatBuffersTable.Pos)\n\n    var numberOfContainers = streamedDataFromClient.ContainersLength()\n    var containers []protocol.Container\n    for containerIndex := 0; containerIndex &lt; numberOfContainers; containerIndex++ {\n        var containerFromStream = new(Stream.Container)\n        streamedDataFromClient.Containers(containerFromStream, containerIndex)\n\n        var numberOfContainerDatas = containerFromStream.ContainerDatasLength()\n        var datas []protocol.ContainerData\n        for containerDataIndex := 0; containerDataIndex &lt; numberOfContainerDatas; containerDataIndex++ {\n            var dataFromContainer = new(Stream.ContainerData)\n            containerFromStream.Data(dataFromContainer, dataIndex)\n            datas = append(datas, protocol.ContainerData{\n                Id:         protocol.IdType(dataFromContainer.Id()), // &lt;--- This line crashes ! always @ containerIndex = 6, containerDataIndex = 0, 12 or 15\n                A:        protocol.AType(dataFromContainer.A()),\n                B:       protocol.BType(dataFromContainer.B()),\n                C:           protocol.CType(dataFromContainer.C()),\n                D:    protocol.DType(dataFromContainer.D()),\n                E: protocol.EType(dataFromContainer.E()),\n            })\n        }\n\n        containers = append(containers, protocol.Container{\n            ContainerId:               protocol.ContainerIdType(containerFromStream.Id()),\n            ContainerDatas:                datas,\n        })\n    }\n\n    var streamedMessage = protocol.StreamedMessage{\n        StreamId:  protocol.SensorIdType(streamIdFromClient),\n        MessageId: protocol.MessageIdType(streamedDataFromClient.Id()),\n        Containers:    containers,\n    }\n\n    return  streamedMessage\n}\n</code></pre>\n\n<h2>Server Boundary test</h2>\n\n<p>This test pass, we also have a similar test that sends <em>n</em> random data instead of 1 and it passes too</p>\n\n<pre><code>package receptionFromGateway_test\n\nimport (\n    \"/* some more imports */\n    \"github.com/PhantomIntelligence/Server/test/utilities/clientStub\"\n    \"os\"\n    \"runtime\"\n    \"testing\"\n    \"time\"\n)\n\nfunc TestFlatBuffersReceptionAndAccessFromClient(test *testing.T) {\n    defer os.RemoveAll(\"./logs\")\n\n    test.Run(\"given_aStreamedDataMessageSentFromClientStub\"+\n        \"_when_receivedAndAccessedByServer\"+\n        \"_then_streamedDataMessageIntegrityIsConserved\", func(subTest *testing.T) {\n        sentStreamedDataMessage := utilities.GenerateRandomStreamedDataMessage(16, 16) // 16 container, 16 data each\n\n        deserializer := serialization.NewFlatBufferDeserializationFilter()\n        pipe := dataFlow.NewPipe(deserializer)\n        procedure := dataFlowMock.NewProcedurePassToPipeThenSave(pipe)\n        pipeline := dataFlow.NewPipeline(procedure)\n\n        client := clientStub.NewWebSocketCommunicator() // &lt;-- this calls  `convertStreamMessageToFlatBuffers` written below\n        server := serving.NewServer()\n        server.Router.Mediator.Pipeline = pipeline\n\n        go server.Serve(\":3591\")\n        runtime.Gosched()\n        time.Sleep(50 * time.Millisecond)\n        client.Start()\n        client.Send(sentStreamedDataMessage)\n        runtime.Gosched()\n        time.Sleep(50 * time.Millisecond)\n        client.Stop()\n\n        pipeline.GetProducingPipe().TerminateProcess()\n\n        var receivedStreamedDataMessage = pipeline.GetProducingPipe().Filter.(*dataFlowMock.FilterSaveObjectReceived).ObjectReceived\n        utilities.AssertEqual(subTest, receivedStreamedDataMessage, sentStreamedDataMessage)\n    })\n}\n</code></pre>\n\n<h2>Server ClientStub's serialization function</h2>\n\n<pre><code>package client\n\nStub\n\nimport (\n    \"github.com/PhantomIntelligence/Server/dataAccess/conversion/flatBuffers\"\n    \"github.com/PhantomIntelligence/Server/domain/protocol\"\n    \"github.com/PhantomIntelligence/Server/lib/Protocol\"\n    \"github.com/PhantomIntelligence/Server/lib/Protocol/Stream\"\n    \"github.com/google/flatbuffers/go\"\n)\n\nconst (\n    streamedDataMessageInitialSize = 2560\n)\n\nfunc convertStreamMessageToFlatBuffers(message protocol.StreamMessage) []byte {\n    builder := flatbuffers.NewBuilder(streamedDataMessageInitialSize)\n\n    var streamIdOffset = builder.CreateString(string(message.StreamId))\n\n    var headerOffset = createFlatBufferHeaders(builder, streamIdOffset)\n\n    var numberOfContainers int\n    var containerOffsets = make(map[int]flatbuffers.UOffsetT)\n    for containerIndex, container := range message.Containers {\n\n        var numberOfData int\n        var containerDataOffsets = make(map[int]flatbuffers.UOffsetT)\n        for containerIndex, container := range container.ContainerDatas {\n            Stream.ContainerDataStart(builder)\n            Stream.ContainerDataAddId(builder, uint16(container.ContainerDataId))\n            Stream.ContainerDataAddA(builder, uint16(container.A))\n            Stream.ContainerDataAddB(builder, uint16(container.B))\n            Stream.ContainerDataAddC(builder, int16(container.C))\n            Stream.ContainerDataAddD(builder, int16(container.D))\n            Stream.ContainerDataAddE(builder, byte(container.E))\n\n            containerDataOffset := Stream.ContainerDataEnd(builder)\n            containerDataOffsets[containerIndex] = containerDataOffset\n\n            numberOfData = containerIndex + 1\n        }\n\n        Stream.ContainerStartDataVector(builder, numberOfData)\n        // FlatBuffer UOffsetT vector requires to be filled by pre-pending backward the offsets\n        for dataOffsetIndex := numberOfData - 1; dataOffsetIndex &gt;= 0; dataOffsetIndex-- {\n            builder.PrependUOffsetT(containerDataOffsets[dataOffsetIndex])\n        }\n        var dataOffsetVector = builder.EndVector(numberOfData)\n\n        Stream.ContainerStart(builder)\n        Stream.ContainerAddId(builder, uint16(container.ContainerId))\n        Stream.ContainerAddData(builder, dataOffsetVector)\n\n        containerOffset := Stream.ContainerEnd(builder)\n        containerOffsets[containerIndex] = containerOffset\n\n        numberOfContainers = containerIndex + 1\n    }\n\n    Stream.StreamedDataStartContainersVector(builder, numberOfContainers)\n    // FlatBuffer UOffsetT vector requires to be filled by pre-pending backward the offsets\n    for containerOffsetIndex := numberOfContainers - 1; containerOffsetIndex &gt;= 0; containerOffsetIndex-- {\n        builder.PrependUOffsetT(containerOffsets[containerOffsetIndex])\n    }\n    var containerOffsetVector = builder.EndVector(numberOfContainers)\n\n    Stream.StreamedDataStart(builder)\n    Stream.StreamedDataAddId(builder, uint16(message.MessageId))\n    Stream.StreamedDataAddContainers(builder, containerOffsetVector)\n    var streamedDataMessageOffset = Stream.StreamedDataEnd(builder)\n\n    Stream.PayloadStart(builder)\n    Stream.PayloadAddSensorId(builder, streamIdOffset)\n    Stream.PayloadAddContentType(builder, Stream.PayloadContentStreamedData)\n    Stream.PayloadAddContent(builder, streamedDataMessageOffset)\n    var streamPayloadOffset = Stream.PayloadEnd(builder)\n\n    Protocol.MessageStart(builder)\n    Protocol.MessageAddHeader(builder, headerOffset)\n    Protocol.MessageAddContentType(builder, Protocol.ContentStream_Payload)\n    Protocol.MessageAddContent(builder, streamPayloadOffset)\n    clientStreamMessageOffset := Protocol.MessageEnd(builder)\n\n    builder.Finish(clientStreamMessageOffset)\n\n    flatBuffersBytes := builder.Bytes[builder.Head():]\n    return flatBuffersBytes\n}\n\nfunc createFlatBufferHeaders(builder *flatbuffers.Builder, sensorIdOffset flatbuffers.UOffsetT) flatbuffers.UOffsetT {\n    destinationIdOffset := builder.CreateString(\"Server\")\n    offset := flatBuffers.CreateHeaderOffset(builder, destinationIdOffset, sensorIdOffset)\n    return offset\n}\n</code></pre>\n"}, {"tags": ["python", "datetime", "go"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 7314139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab94c2b5aeed2fc2b077a38a4e07aaad?s=128&d=identicon&r=PG&f=1", "display_name": "M.Traynor", "link": "https://stackoverflow.com/users/7314139/m-traynor"}, "edited": false, "score": 0, "creation_date": 1541546317, "post_id": 53181455, "comment_id": 93253253, "body": "The 9! That&#39;s the kind if solution I was looking for. Thank you so much, that works perfectly and doesn&#39;t feel too dirty :D"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1541545749, "creation_date": 1541545749, "answer_id": 53181455, "question_id": 53181367, "link": "https://stackoverflow.com/questions/53181367/parsing-python-to-golang-datetime/53181455#53181455", "title": "Parsing Python to Golang - DateTime", "body": "<p>Zeros in the fractional seconds must match the number of characters exactly, and as your error states, the portion after <code>750Z</code> doesn't match the corresponding portion of the format string.</p>\n\n<p>You can add the correct number of zeros, like <code>\"2006-01-02T15:04:05.000000Z\"</code>, or use <code>9</code> as a more flexible format.</p>\n\n<pre><code>dtLayout := \"2006-01-02T15:04:05.9Z\"\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/dyC0OXUnhhu\" rel=\"noreferrer\">https://play.golang.org/p/dyC0OXUnhhu</a></p>\n"}], "owner": {"reputation": 43, "user_id": 7314139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab94c2b5aeed2fc2b077a38a4e07aaad?s=128&d=identicon&r=PG&f=1", "display_name": "M.Traynor", "link": "https://stackoverflow.com/users/7314139/m-traynor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 875, "favorite_count": 0, "accepted_answer_id": 53181455, "answer_count": 1, "score": 3, "last_activity_date": 1541600223, "creation_date": 1541545108, "last_edit_date": 1541600223, "question_id": 53181367, "link": "https://stackoverflow.com/questions/53181367/parsing-python-to-golang-datetime", "title": "Parsing Python to Golang - DateTime", "body": "<p>I've been attempting to get a specific string output from pyhtons datetime\n(2006-01-02T15:04:05.000Z), so that I can easily parse it in golang using time.Parse. </p>\n\n<p>I tried (in python)</p>\n\n<pre><code>datetime.utcnow().strftime('%Y-%m-%dT%H:%M:%S.%fZ')\n</code></pre>\n\n<p>Which will give me something like this: \"2018-11-06T22:48:50.002750Z\"</p>\n\n<p>And when I try to parse it like this in Golang:</p>\n\n<pre><code>dtLayout := \"2006-01-02T15:04:05.000Z\"\ndateStr := \"2018-11-06T22:48:50.002750Z\"\n\nparsedDate, err := time.Parse(dtLayout, dateStr)\nif err != nil {\n    if err != nil {\n        log.Printf(\"error: %v\", err)\n    }\n</code></pre>\n\n<p>I get this error:</p>\n\n<blockquote>\n  <p>2018/11/06 16:49:11 error: parsing time \"2018-11-06T22:48:50.002750Z\" as \"2006-01-02T15:04:05.000Z\": cannot parse \"750Z\" as \"Z\"</p>\n</blockquote>\n\n<p>There's probably an easy way to do this using just milliseconds, but I'm stubborn and feel like I'm close. </p>\n"}, {"tags": ["sql", "go"], "answers": [{"comments": [{"owner": {"reputation": 555, "user_id": 8337498, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8b22e7b8121ee9ea74b80f0783247a02?s=128&d=identicon&r=PG&f=1", "display_name": "taraf", "link": "https://stackoverflow.com/users/8337498/taraf"}, "edited": false, "score": 0, "creation_date": 1545062961, "post_id": 53180467, "comment_id": 94486316, "body": "Makes sense. Thank you!"}], "tags": [], "owner": {"reputation": 84923, "user_id": 1920232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iUA8y.jpg?s=128&g=1", "display_name": "peterm", "link": "https://stackoverflow.com/users/1920232/peterm"}, "is_accepted": true, "score": 3, "last_activity_date": 1541540423, "creation_date": 1541540423, "answer_id": 53180467, "question_id": 53180213, "link": "https://stackoverflow.com/questions/53180213/is-it-a-good-practice-to-use-sql-functions-with-go-context-as-parameter/53180467#53180467", "title": "Is it a good practice to use SQL functions with Go context as parameter?", "body": "<p><code>Context</code> aware methods allow for cancellable query execution.</p>\n\n<p>The way the cancellation is handled is driver specific, but even if the driver is not directly supports taking the context any query that was started with a context should be closed when the context is closed.</p>\n\n<p>This should help with potential connection leaks and query specific timeouts.</p>\n"}], "owner": {"reputation": 555, "user_id": 8337498, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8b22e7b8121ee9ea74b80f0783247a02?s=128&d=identicon&r=PG&f=1", "display_name": "taraf", "link": "https://stackoverflow.com/users/8337498/taraf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 53180467, "answer_count": 1, "score": 2, "last_activity_date": 1546257408, "creation_date": 1541539351, "last_edit_date": 1546257408, "question_id": 53180213, "link": "https://stackoverflow.com/questions/53180213/is-it-a-good-practice-to-use-sql-functions-with-go-context-as-parameter", "title": "Is it a good practice to use SQL functions with Go context as parameter?", "body": "<p>I have RESTFUL web service in Golang and I'm using it's SQL driver for database. my question is should I use SQL functions with context as parameter or without it? For instance, there are both <code>QueryContext</code> and <code>Query</code> methods.</p>\n\n<p>Actually I do know what is the context in Go, I just don't know why I should send it to the database methods.</p>\n"}, {"tags": ["go", "networking", "network-programming"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1541541964, "post_id": 53179876, "comment_id": 93251637, "body": "See also <a href=\"https://stackoverflow.com/questions/5314038/simulating-host-unreachable-how-to-achieve-implement-it\" title=\"simulating host unreachable how to achieve implement it\">stackoverflow.com/questions/5314038/&hellip;</a>"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1541544633, "post_id": 53179876, "comment_id": 93252680, "body": "Pull the cable."}, {"owner": {"reputation": 5392, "user_id": 361836, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/f426a26f03d7d4d61d354a3b2fc5337d?s=128&d=identicon&r=PG", "display_name": "lucidquiet", "link": "https://stackoverflow.com/users/361836/lucidquiet"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1541559458, "post_id": 53179876, "comment_id": 93256055, "body": "@MichaelHampton missed the part on &#39;local network&#39;, or I probably wasn&#39;t clear: on a single machine."}], "answers": [{"comments": [{"owner": {"reputation": 5392, "user_id": 361836, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/f426a26f03d7d4d61d354a3b2fc5337d?s=128&d=identicon&r=PG", "display_name": "lucidquiet", "link": "https://stackoverflow.com/users/361836/lucidquiet"}, "edited": false, "score": 0, "creation_date": 1543529160, "post_id": 53180093, "comment_id": 93963176, "body": "It&#39;s not that I have options after the traffic is gone, but I&#39;m seeing behavior that can only be explained if a connection is completely cut off, without some form of NACK or closed connection, or some such.  Like a service restarting, but the packets were possibly in udp (I don&#39;t know)."}], "tags": [], "owner": {"reputation": 59, "user_id": 8177345, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-QiMdWiR_5Xo/AAAAAAAAAAI/AAAAAAAAAvc/SX8HEhgfddA/photo.jpg?sz=128", "display_name": "Jorge Lopez", "link": "https://stackoverflow.com/users/8177345/jorge-lopez"}, "is_accepted": false, "score": 2, "last_activity_date": 1541538820, "creation_date": 1541538820, "answer_id": 53180093, "question_id": 53179876, "link": "https://stackoverflow.com/questions/53179876/how-to-emulate-a-complete-network-loss-between-a-client-and-server/53180093#53180093", "title": "How to emulate a complete network loss between a client and server?", "body": "<p>At the risk of being silly... Have you considered removing the cable / shutting down the network interface, manually? If this is just for testing what happens if you lose connectivity that is an option. </p>\n\n<p>Another option is to use the firewall of your operating system to drop the specific traffic, for example to add a rule with iptables in a Linux-based OS. </p>\n\n<pre><code>//Block incoming port 80 (web)\n$ sudo iptables -I INPUT -p tcp -m tcp --dport 80 -j DROP\n//Block outgoing port 80 (web)\n$ sudo iptables -I OUTPUT -p tcp -m tcp --dport 80 -j DROP\n\n//Remove block incoming port 80 (web)\n$ sudo iptables -I INPUT -p tcp -m tcp --dport 80 -j ACCEPT\n//Remove block outgoing port 80 (web)\n$ sudo iptables -I OUTPUT -p tcp -m tcp --dport 80 -j ACCEPT\n</code></pre>\n\n<p>Of course, you can execute this commands within your program, if you need to. </p>\n"}], "owner": {"reputation": 5392, "user_id": 361836, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/f426a26f03d7d4d61d354a3b2fc5337d?s=128&d=identicon&r=PG", "display_name": "lucidquiet", "link": "https://stackoverflow.com/users/361836/lucidquiet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1541538820, "creation_date": 1541537785, "question_id": 53179876, "link": "https://stackoverflow.com/questions/53179876/how-to-emulate-a-complete-network-loss-between-a-client-and-server", "title": "How to emulate a complete network loss between a client and server?", "body": "<p>I'm trying to understand if a client (in a client-server architecture) when using a 'blocking' call will somehow completely lose the other side of the connection without being given any signs of the loss.  I think this can happen normally as most networks sometimes have issues.  The thing is I want to duplicate the idea: the client connects in a blocking mode, the server accept the connection, then disappears, and then possibly later re-appears, but not in a way where the server closes a connection, or 'nacks' or anything.</p>\n\n<p>Is there a way to induce this behavior in a local network?</p>\n\n<p>And as it turns out this particular app is written in Go but I don't know how much that will matter.</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "edited": false, "score": 0, "creation_date": 1541745774, "post_id": 53179959, "comment_id": 93328830, "body": "thanks @ThunderCat when I put that code in the for now connection just triggers <code>webSocket.onclose()</code> on the client side without throwing any errors on backend. I put debugger and doesn&#39;t seem to enter that portion of code. The event onClose returned in JS looks   {code: 1006, composed: false, currentTarget: WebSocket <code>{url: &quot;ws:&#47;&#47;localhost:3001&#47;chat&quot;, readyState: 3, eventPhase: 2, isTrusted: true,  srcElement: WebSocket {url: &quot;ws:&#47;&#47;localhost:3001&#47;chat&quot;, readyState: 3, bufferedAmount: 0, onopen: null, onerror: null, target: WebSocket {url: &quot;ws:&#47;&#47;localhost:3001&#47;chat&quot;, readyState: 3,...}</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "edited": false, "score": 0, "creation_date": 1541773576, "post_id": 53179959, "comment_id": 93341785, "body": "The calls to c.conn.ReadJSON and json.Unmarshal in the original code return errors, but you didn&#39;t see any errors logged.  You should confirm that LogErr actually works as expected. You also note that the program does not seem to enter the code on the server.  Perhaps the client is connecting to a different endpoint or a different server entirely."}, {"owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "edited": false, "score": 0, "creation_date": 1541853324, "post_id": 53179959, "comment_id": 93363917, "body": "why does this only work when I send JSON as a string like this:                 <code>webSocket.send(JSON.stringify(comment))</code> if I try <code>webSocket.send(comment)</code> it doesn&#39;t work"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "edited": false, "score": 1, "creation_date": 1541856648, "post_id": 53179959, "comment_id": 93364744, "body": "<code>webSocket.send(JSON.stringify(comment))</code> encodes the comment in the format expected by the server.  <code>webSocket.send(comment)</code> fails because the argument is not <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/send#Parameters\" rel=\"nofollow noreferrer\">one of the allowed types</a>."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1541538227, "creation_date": 1541538227, "answer_id": 53179959, "question_id": 53179657, "link": "https://stackoverflow.com/questions/53179657/gorilla-websocket-how-to-unmarshal-binary-data-into-json/53179959#53179959", "title": "Gorilla websocket how to unmarshal binary data into JSON?", "body": "<p>The application reads two messages on each iteration through the loop and attempts to unmarshal both to <code>comment</code>.  Read one message only.</p>\n\n<p>The application calls <code>ReadJSON</code> and <code>Unmarshal</code> incorrectly and the error returned from these functions explains why: the application is attempting to unmarshal to a non-pointer.</p>\n\n<p>The application also sends the raw bytes of the message to a channel. That looks like it might be a leftover from whatever you are copying, so I'll ignore that in the remainder of the answer. </p>\n\n<p>Here's the fixed loop:</p>\n\n<pre><code>for {\n    var comment Comment\n    err = c.conn.ReadJSON(&amp;comment)\n    if err != nil {\n        if websocket.IsUnexpectedCloseError(err, websocket.CloseGoingAway, websocket.CloseAbnormalClosure) {\n            LogErr(\"IsUnexpectedCloseError()\", err)\n        }\n        break\n    }\n    // Do something with comment\n}\n</code></pre>\n"}], "owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1906, "favorite_count": 0, "accepted_answer_id": 53179959, "answer_count": 1, "score": 2, "last_activity_date": 1541538227, "creation_date": 1541536678, "question_id": 53179657, "link": "https://stackoverflow.com/questions/53179657/gorilla-websocket-how-to-unmarshal-binary-data-into-json", "title": "Gorilla websocket how to unmarshal binary data into JSON?", "body": "<p>I'm following the <a href=\"https://github.com/gorilla/websocket/tree/master/examples/chat\" rel=\"nofollow noreferrer\">chat example</a> provided by gorilla.</p>\n\n<p>I still can get to unmarshal the json data sent. Should I do this in the <code>readPump()</code>:</p>\n\n<pre><code>func (c *ChatClient) readPump() {\n    defer func() {\n        c.hub.unregisterChan &lt;- c\n        c.conn.Close()\n    }()\n    c.conn.SetReadLimit(maxMessageSize)\n    c.conn.SetReadDeadline(time.Now().Add(pongWait))\n    c.conn.SetPongHandler(func(string) error { c.conn.SetReadDeadline(time.Now().Add(pongWait)); return nil })\n    for {\n        _, message, err := c.conn.ReadMessage()\n        // =================MY CODE START=============\n        var comment Comment\n        err = c.conn.ReadJSON(comment)\n        if err != nil {\n            LogErr(\"readjson()\", err)\n            break\n        }\n        err = json.Unmarshal(message, comment)\n        if err != nil {\n            LogErr(\"readjson()\", err)\n            break\n        }\n        // =================MY CODE END=============\n\n        if err != nil {\n            if websocket.IsUnexpectedCloseError(err, websocket.CloseGoingAway, websocket.CloseAbnormalClosure) {\n                LogErr(\"IsUnexpectedCloseError()\", err)\n            }\n            break\n        }\n        message = bytes.TrimSpace(bytes.Replace(message, newline, space, -1))\n        c.hub.broadcastChan &lt;- message\n    }\n}\n</code></pre>\n\n<p>or in the <code>writePump()</code></p>\n\n<pre><code>func (c *ChatClient) writePump() {\n    ticker := time.NewTicker(pingPeriod)\n    defer func() {\n        ticker.Stop()\n        c.conn.Close()\n    }()\n    for {\n        select {\n        case message, ok := &lt;-c.send:\n            c.conn.SetWriteDeadline(time.Now().Add(writeWait))\n\n            // CLOSE\n            if !ok {\n                c.conn.WriteMessage(websocket.CloseMessage, []byte{})\n                return\n            }\n\n            w, err := c.conn.NextWriter(websocket.BinaryMessage)\n            if err != nil {\n                LogErr(\"c.conn.NextWriter\", err)\n                return\n            }\n            w.Write(message)\n\n            // Add queued chat messages to the current websocket message.\n            n := len(c.send)\n            for i := 0; i &lt; n; i++ {\n                w.Write(newline)\n                w.Write(&lt;-c.send)\n            }\n\n            if err := w.Close(); err != nil {\n                LogErr(\"w.Close()\", err)\n                return\n            }\n        case &lt;-ticker.C:\n            c.conn.SetWriteDeadline(time.Now().Add(writeWait))\n            if err := c.conn.WriteMessage(websocket.PingMessage, nil); err != nil {\n                LogErr(\"c.conn.WriteMessage()\", err)\n                return\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The LogErr() methods don't print any message. Totally lost here.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1541531495, "post_id": 53178460, "comment_id": 93246951, "body": "Based on this it should, but the example code is incomplete. Relevant code should be included <i>in the body of the question</i>, not at an external link."}], "answers": [{"comments": [{"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1541533093, "post_id": 53178546, "comment_id": 93247690, "body": "that&#39;s for clarifying that, makes sense to me now."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1541531784, "creation_date": 1541531784, "answer_id": 53178546, "question_id": 53178460, "link": "https://stackoverflow.com/questions/53178460/why-doesnt-the-goroutines-process-the-same-file-twice/53178546#53178546", "title": "Why doesn&#39;t the goroutines process the same file twice?", "body": "<p><code>walkFiles</code>, which was not reproduced in your question but which is key to understanding it, has the following signature:</p>\n\n<pre><code>func walkFiles(done &lt;-chan struct{}, root string) (&lt;-chan string, &lt;-chan error)\n</code></pre>\n\n<p>So in your quoted code, <code>paths</code> isn't a \"collection\" (i.e. a slice), it's a <em>channel</em>. When each of the workers reads from the channel, it pulls the next path out of the channel. The next worker to receieve from the channel won't get the same path, it will get the next one after that.</p>\n\n<p>All three of the arguments to <code>digester</code> are channels:</p>\n\n<pre><code>func digester(done &lt;-chan struct{}, paths &lt;-chan string, c chan&lt;- result) \n</code></pre>\n\n<ul>\n<li><code>done</code> is used to indicate to the workers that they should stop, even if there is still work queued.</li>\n<li><code>paths</code> is the work queue the workers receive paths from.</li>\n<li><code>c</code> is the channel that the workers send results on.</li>\n</ul>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 53178546, "answer_count": 1, "score": -2, "last_activity_date": 1541531784, "creation_date": 1541531413, "question_id": 53178460, "link": "https://stackoverflow.com/questions/53178460/why-doesnt-the-goroutines-process-the-same-file-twice", "title": "Why doesn&#39;t the goroutines process the same file twice?", "body": "<p>I'm looking at the goroutines blog post about patterns with goroutines and channels etc.</p>\n\n<p>In the <a href=\"https://blog.golang.org/pipelines/bounded.go\" rel=\"nofollow noreferrer\">bounded.go</a> example I see this:</p>\n\n<pre><code>    paths, errc := walkFiles(done, root)\n\n    // Start a fixed number of goroutines to read and digest files.\n    c := make(chan result) // HLc\n    var wg sync.WaitGroup\n    const numDigesters = 20\n    wg.Add(numDigesters)\n    for i := 0; i &lt; numDigesters; i++ {\n        go func() {\n            digester(done, paths, c) // HLc\n            wg.Done()\n        }()\n    }\n</code></pre>\n\n<p>Now since each digester is processing the same <code>paths</code> collection, why doesn't it repeat the same file twice?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1541531816, "post_id": 53178203, "comment_id": 93247115, "body": "Use <code>X.name = ANY ($1)</code> with <a href=\"https://godoc.org/github.com/lib/pq#StringArray\" rel=\"nofollow noreferrer\"><code>lib&#47;pq</code> array types</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1541533597, "post_id": 53178203, "comment_id": 93247922, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/38036752/go-and-in-clause-in-postgres\">Go and IN clause in Postgres</a>"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 4, "last_activity_date": 1541532242, "creation_date": 1541532242, "answer_id": 53178657, "question_id": 53178203, "link": "https://stackoverflow.com/questions/53178203/go-postgres-select-in-using-array/53178657#53178657", "title": "Go postgres `SELECT * IN` using array", "body": "<p>Copying and pasting fragments from some working Go PostgreSQL code:</p>\n\n<pre><code>import (\n    \"database/sql\"\n    \"github.com/lib/pq\"\n)\n\n    query := `\n            . . .\n            WHERE code = ANY($1)\n           . . .\n\n        `\n\n    codes := []string{\"JFK\", \"LGA\", \"EWR\"}\n    rows, err := db.Query(query, pq.Array(codes))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1302, "user_id": 957913, "user_type": "registered", "accept_rate": 72, "profile_image": "https://graph.facebook.com/723865010/picture?type=large", "display_name": "nate", "link": "https://stackoverflow.com/users/957913/nate"}, "is_accepted": false, "score": 0, "last_activity_date": 1541689738, "creation_date": 1541689738, "answer_id": 53210549, "question_id": 53178203, "link": "https://stackoverflow.com/questions/53178203/go-postgres-select-in-using-array/53210549#53210549", "title": "Go postgres `SELECT * IN` using array", "body": "<p>I solved this using <a href=\"http://jmoiron.github.io/sqlx/#inQueries\" rel=\"nofollow noreferrer\">http://jmoiron.github.io/sqlx/#inQueries</a></p>\n\n<pre><code>var phone string = \"123\"\nvar names []string = []string{\"bob\", \"joe\"}\nsqlStatement := `Select * FROM X where X.name in (?) and X.phone=?`\nsqlStatement, args, err := sqlx.In(sqlStatement, names, phone)\nsqlStatement = db.Rebind(sqlStatement)\n        rows, sqlerr := db.Queryx(sqlStatement, args...)\n</code></pre>\n\n<p>this now returns correctly.</p>\n\n<p>another way to solve this was to use <code>fmt.Sprintf()</code> and converting the <code>?</code> to <code>%s</code></p>\n"}], "owner": {"reputation": 1302, "user_id": 957913, "user_type": "registered", "accept_rate": 72, "profile_image": "https://graph.facebook.com/723865010/picture?type=large", "display_name": "nate", "link": "https://stackoverflow.com/users/957913/nate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1041, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1541689738, "creation_date": 1541530401, "question_id": 53178203, "link": "https://stackoverflow.com/questions/53178203/go-postgres-select-in-using-array", "title": "Go postgres `SELECT * IN` using array", "body": "<p>I have a simple select statement:</p>\n\n<p><code>Select * FROM X where X.name in (\"bob\", \"joe\") and X.phone='123'</code></p>\n\n<p>That works fine in postgres,</p>\n\n<p>In my Go code I have the following code:</p>\n\n<pre><code>var phone string = \"123\"\nvar names []string = []string{\"bob\", \"joe\"}\nsqlStatement := `Select * FROM X where X.name in ($1) and X.phone=$2`\nrows, sqlerr := db.Query(sqlStatement, names, phone)\n</code></pre>\n\n<p>but for some reason I error out from that sql.</p>\n\n<blockquote>\n  <p>unsupported Scan, storing driver.Value type  into type *string</p>\n</blockquote>\n\n<p>how can i use my names array in side the sqlstatement?</p>\n\n<p>note: if i do a fmt.printf and paste the sql statement into postgres, i do get data back + if i take out the $1, and manually input the strings</p>\n"}, {"tags": ["go", "jointable", "go-gorm"], "comments": [{"owner": {"reputation": 1325, "user_id": 10431118, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cEMkN.jpg?s=128&g=1", "display_name": "pvy4917", "link": "https://stackoverflow.com/users/10431118/pvy4917"}, "edited": false, "score": 0, "creation_date": 1541525188, "post_id": 53176927, "comment_id": 93243866, "body": "<a href=\"https://stackoverflow.com/questions/7867621/gorm-grails-add-extra-column-to-a-jointable-expression\" title=\"gorm grails add extra column to a jointable expression\">stackoverflow.com/questions/7867621/&hellip;</a>"}, {"owner": {"reputation": 56, "user_id": 10592957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YR2CQ.jpg?s=128&g=1", "display_name": "OgliWanFabi", "link": "https://stackoverflow.com/users/10592957/ogliwanfabi"}, "reply_to_user": {"reputation": 1325, "user_id": 10431118, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cEMkN.jpg?s=128&g=1", "display_name": "pvy4917", "link": "https://stackoverflow.com/users/10431118/pvy4917"}, "edited": false, "score": 0, "creation_date": 1541525630, "post_id": 53176927, "comment_id": 93244090, "body": "Sorry if it wasn&#39;t clear but it&#39;s not the same ORM than the one used in Grail"}, {"owner": {"reputation": 1325, "user_id": 10431118, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cEMkN.jpg?s=128&g=1", "display_name": "pvy4917", "link": "https://stackoverflow.com/users/10431118/pvy4917"}, "edited": false, "score": 0, "creation_date": 1541525685, "post_id": 53176927, "comment_id": 93244118, "body": "Sorry for that. I don&#39;t think you can add extra column in <code>Gorm</code>."}, {"owner": {"reputation": 1325, "user_id": 10431118, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cEMkN.jpg?s=128&g=1", "display_name": "pvy4917", "link": "https://stackoverflow.com/users/10431118/pvy4917"}, "edited": false, "score": 0, "creation_date": 1541525849, "post_id": 53176927, "comment_id": 93244212, "body": "<a href=\"https://www.reddit.com/r/golang/comments/788jmi/in_gorm_is_it_possible_to_define_an_extra_column/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/788jmi/&hellip;</a>"}, {"owner": {"reputation": 56, "user_id": 10592957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YR2CQ.jpg?s=128&g=1", "display_name": "OgliWanFabi", "link": "https://stackoverflow.com/users/10592957/ogliwanfabi"}, "reply_to_user": {"reputation": 1325, "user_id": 10431118, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cEMkN.jpg?s=128&g=1", "display_name": "pvy4917", "link": "https://stackoverflow.com/users/10431118/pvy4917"}, "edited": false, "score": 0, "creation_date": 1541526233, "post_id": 53176927, "comment_id": 93244387, "body": "I already saw that but I have a hard time to create the join table struct. I am currently trying to follow the example here: <a href=\"https://stackoverflow.com/questions/46105380/define-associative-model-in-golang-gorm\" title=\"define associative model in golang gorm\">stackoverflow.com/questions/46105380/&hellip;</a>. If I find a workaround, I&#39;ll post the answer here"}], "owner": {"reputation": 56, "user_id": 10592957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YR2CQ.jpg?s=128&g=1", "display_name": "OgliWanFabi", "link": "https://stackoverflow.com/users/10592957/ogliwanfabi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1543308330, "creation_date": 1541524991, "last_edit_date": 1543308330, "question_id": 53176927, "link": "https://stackoverflow.com/questions/53176927/extra-column-in-self-referencing-model", "title": "Extra Column in self-referencing model", "body": "<p>I just started to use Gorm and I am encountering troubles to define a model.<br>\nI have succeeded in creating a join table by following the doc example for self-referencing model:</p>\n\n<p>\n\n<pre><code>type User struct {\n  gorm.Model\n  Friends []*User `gorm:\"many2many:friendships;association_jointable_foreignkey:friend_id\"`\n}\n</code></pre>\n\n<p>The problem is I want an extra column in my join table to know whether a friend is accepted or not. I have looked for an answer through the internet but the only answer that I found is this : \n<a href=\"https://github.com/jinzhu/gorm/issues/719#issuecomment-168485989\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm/issues/719#issuecomment-168485989</a>\nbut I don't understand how I can adapt it in my case.<br>\nIf anyone out there has any examples and/or solutions, I will be grateful.\nThanks again !</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 7206, "user_id": 5741643, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/27485d5a049481e18d6aeb3f18480447?s=128&d=identicon&r=PG&f=1", "display_name": "Poul Bak", "link": "https://stackoverflow.com/users/5741643/poul-bak"}, "edited": false, "score": 1, "creation_date": 1541525111, "post_id": 53176798, "comment_id": 93243827, "body": "What have you tried? Show you code and what doesn&#39;t Work. Then you will get a better answer."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1541525256, "post_id": 53176798, "comment_id": 93243904, "body": "<a href=\"https://golang.org/pkg/regexp/#Regexp.Split\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp/#Regexp.Split</a>"}, {"owner": {"reputation": 13757, "user_id": 1270003, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/d5ed9123b92a6e4dffa75f9f6dd9e382?s=128&d=identicon&r=PG&f=1", "display_name": "texasbruce", "link": "https://stackoverflow.com/users/1270003/texasbruce"}, "edited": false, "score": 0, "creation_date": 1541525284, "post_id": 53176798, "comment_id": 93243915, "body": "Pure regex solution will be tricky, including look forwards and back. The best way to do this is probably splitting by dot first, then combining the ones within quotes and add dot in between"}, {"owner": {"reputation": 4446, "user_id": 7500028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbf0e88580cccb9004735bcb92be952e?s=128&d=identicon&r=PG&f=1", "display_name": "Julio", "link": "https://stackoverflow.com/users/7500028/julio"}, "edited": false, "score": 0, "creation_date": 1541525355, "post_id": 53176798, "comment_id": 93243956, "body": "Are all of those all possible inputs? Are other forms possible?, such: <code>&quot;&#39;a.b&#39;.c.d&quot;</code> or even more nesting patterns such: <code>&quot;&#39;a.&quot;x.y&quot;&#39;.c.d&quot;</code>"}, {"owner": {"reputation": 7206, "user_id": 5741643, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/27485d5a049481e18d6aeb3f18480447?s=128&d=identicon&r=PG&f=1", "display_name": "Poul Bak", "link": "https://stackoverflow.com/users/5741643/poul-bak"}, "edited": false, "score": 0, "creation_date": 1541526400, "post_id": 53176798, "comment_id": 93244483, "body": "I don&#39;t think the second value would compile in any language - quotes within quotes."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1541529507, "post_id": 53176798, "comment_id": 93245999, "body": "Is this a CSV file?"}], "answers": [{"comments": [{"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1541623972, "post_id": 53177953, "comment_id": 93283806, "body": "Could you show how you&#39;d do it with <a href=\"https://godoc.org/github.com/glenn-brown/golang-pkg-pcre/src/pkg/pcre\" rel=\"nofollow noreferrer\">pcre</a>?"}], "tags": [], "owner": {"reputation": 2295, "user_id": 792779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99528e625676b23a593f5a3daa005793?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/792779/john"}, "is_accepted": false, "score": 1, "last_activity_date": 1541529304, "creation_date": 1541529304, "answer_id": 53177953, "question_id": 53176798, "link": "https://stackoverflow.com/questions/53176798/split-input-string-in-go-by-regex/53177953#53177953", "title": "Split input string in go by regex", "body": "<p>Since go doesn't support negative lookaheads, I don't think finding a regular expression that matches the <code>.</code> you want to split on will be easy/possible. Instead, you can match the sourrounding text and only capture appropriately:</p>\n\n<p>So the regular expression itself is a bit ugly, but here's the breakdown (ignoring escaped characters for go):</p>\n\n<p><code>(\\'[^.'\"]+(?:\\.[^.'\"]+)+\\')|(\\\"[^.'\"]+(?:\\.[^.'\"]+)+\\\")|(?:([^.'\"]+)\\.?)|(?:\\.([^.'\\\"]+))</code></p>\n\n<p>There are four scenarios that this regular expression matches, and captures certain subsets of these matches:</p>\n\n<ul>\n<li><code>(\\'[^.'\"]+(?:\\.[^.'\"]+)+\\')</code> - Match and capture single-quoted text\n\n<ul>\n<li><code>\\'</code> - Match <code>'</code> literally</li>\n<li><code>[^.'\"]+</code> - Match sequence of non-quotes and non-periods</li>\n<li><code>(?:\\.[^.'\"]+)+</code> - Match a period followed by a sequence of non-quotes and non-periods, repeated as many times as needed. Not captured.</li>\n<li><code>\\'</code> - Match <code>'</code> literally</li>\n</ul></li>\n<li><code>(\\\"[^.'\"]+(?:\\.[^.'\"]+)+\\\")</code> - Match and capture double-quoted text\n\n<ul>\n<li>Same as above but with double quotes</li>\n</ul></li>\n<li><code>(?:([^.'\"]+)\\.?)</code> - Match text proceeded by an optional <code>.</code>, not capturing the <code>.</code>\n\n<ul>\n<li><code>([^.'\"]+)</code> - Match and capture sequence of non-quotes and non-periods</li>\n<li><code>\\.?</code> - Optionally match a period (optional to capture the last bit of delimited text) </li>\n</ul></li>\n<li><code>(?:\\.([^.'\"]+))</code> - Match text preceded by a <code>.</code>, not capturing the <code>.</code>\n\n<ul>\n<li>Same as above but with the period coming before the capture group, and also non-optional</li>\n</ul></li>\n</ul>\n\n<p>Example code that dumps the captures:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    re := regexp.MustCompile(\"('[^.'\\\"]+(?:\\\\.[^.'\\\"]+)+')|(\\\"[^.'\\\"]+(?:\\\\.[^.'\\\"]+)+\\\")|(?:([^.'\\\"]+)\\\\.?)|(?:\\\\.([^.'\\\"]+))\")\n    txt := \"a.b.c.'d.e'\"\n\n    result:= re.FindAllStringSubmatch(txt, -1)\n\n    for k, v := range result {\n        fmt.Printf(\"%d. %s\\n\", k, v)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 1, "last_activity_date": 1541530290, "creation_date": 1541530290, "answer_id": 53178174, "question_id": 53176798, "link": "https://stackoverflow.com/questions/53176798/split-input-string-in-go-by-regex/53178174#53178174", "title": "Split input string in go by regex", "body": "<p>Matching balanced delimiters is a complex problem for regular expressions, as evidenced by <a href=\"https://stackoverflow.com/a/53177953/14660\">John's answer</a>. Unless you're using something like the <a href=\"https://godoc.org/github.com/glenn-brown/golang-pkg-pcre/src/pkg/pcre\" rel=\"nofollow noreferrer\">Go pcre package</a>.</p>\n\n<p>Instead the <a href=\"https://golang.org/pkg/encoding/csv/\" rel=\"nofollow noreferrer\">Go CSV parser</a> can be adapted. Configure it to use <code>.</code> as the separator, lazy quotes (the CSV quote is <code>'</code>), and variable length records.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n    lines := `a.b.c.d\na.\\\"b.c\\\".d\na.'b.c'.d\n`\n\n    csv := csv.NewReader(strings.NewReader(lines))\n    csv.Comma = '.'\n    csv.LazyQuotes = true\n    csv.FieldsPerRecord = -1\n    for {\n        record, err := csv.Read()\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        fmt.Printf(\"%#v\\n\", record)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4446, "user_id": 7500028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbf0e88580cccb9004735bcb92be952e?s=128&d=identicon&r=PG&f=1", "display_name": "Julio", "link": "https://stackoverflow.com/users/7500028/julio"}, "is_accepted": true, "score": 1, "last_activity_date": 1541533038, "creation_date": 1541533038, "answer_id": 53178833, "question_id": 53176798, "link": "https://stackoverflow.com/questions/53176798/split-input-string-in-go-by-regex/53178833#53178833", "title": "Split input string in go by regex", "body": "<p>Here is another option with a somewhat less hacky regex. It uses the <a href=\"http://www.rexegg.com/regex-best-trick.html\" rel=\"nofollow noreferrer\">trash bin trick</a>. So the real data is on the (first and second) capturing groups.</p>\n\n<p>It works even with nested quotes like this: <code>\"a.'b.c'.d.e.\"f.g.h\"\"</code> as long as there is not a recursion of 2 or more levels (as in here: <code>\"a.'b.\"c.d\"'\"</code>, quotes inside quotes inside quotes).</p>\n\n<p>The regex is this: <code>^\"|['\"](\\w+(?:\\.\\w+)*)['\"]|(\\w+)</code></p>\n\n<p>And the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"regexp\"\n    \"fmt\"\n)\n\nfunc main() {\n    var re = regexp.MustCompile(`^\"|['\"](\\w+(?:\\.\\w+)*)['\"]|(\\w+)`)\n    var str = `\"a.'b.c'.d.e.\"f.g.h\"\"`\n\n    result := re.FindAllStringSubmatch(str, -1)\n    for _, m := range result {\n        if (m[1] != \"\" || m[2] != \"\") {\n            fmt.Print(m[1] + m[2] + \"\\n\")\n        }\n    }\n}\n</code></pre>\n\n<p><strong>Input:</strong></p>\n\n<p><code>\"a.'b.c'.d.e.\"f.g.h\"\"</code></p>\n\n<p><strong>Output:</strong></p>\n\n<pre><code>a\nb.c\nd\ne\nf.g.h\n</code></pre>\n"}], "owner": {"reputation": 162, "user_id": 6147375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d684954974de36ebcd6766c50daa5534?s=128&d=identicon&r=PG&f=1", "display_name": "creedqq", "link": "https://stackoverflow.com/users/6147375/creedqq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1329, "favorite_count": 1, "accepted_answer_id": 53178833, "answer_count": 3, "score": 0, "last_activity_date": 1541533038, "creation_date": 1541524456, "question_id": 53176798, "link": "https://stackoverflow.com/questions/53176798/split-input-string-in-go-by-regex", "title": "Split input string in go by regex", "body": "<p>How can I split input strings below by regex in Go? Examples of strings:</p>\n\n<p>I know how to split by dot, but how can I avoid splitting in quotes?</p>\n\n<pre><code>\"a.b.c.d\" -&gt; [\"a\", \"b\", \"c\", \"d\"]\n\"a.\"b.c\".d\" -&gt; [\"a\", \"b.c\", \"d\"]\n\"a.'b.c'.d\" -&gt; [\"a\", \"b.c\", \"d\"]\n</code></pre>\n"}, {"tags": ["database", "go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1541574963, "post_id": 53175792, "comment_id": 93259357, "body": "nice outcome <a href=\"https://play.golang.org/p/eI4kFrPWLb1\" rel=\"nofollow noreferrer\">play.golang.org/p/eI4kFrPWLb1</a>"}], "answers": [{"comments": [{"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1541696159, "post_id": 53186857, "comment_id": 93312814, "body": "Seems like I need two separate methods for Row and Rows, since these are different types. Otherwise, this is a good way of abstracting away row scanning. Thanks."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1541698247, "post_id": 53186857, "comment_id": 93313976, "body": "@MadWombat I&#39;m not sure what you mean by two separate methods. And by &quot;Row and Rows&quot; you mean *sql.Row and *sql.Rows?"}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1541700345, "post_id": 53186857, "comment_id": 93314939, "body": "Yes, so in the interface I guess I need to implement ScanRow(row sql.Row) and ScanRows(rows sql.Rows) to accommodate results from both Query and QueryRow"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1541702522, "post_id": 53186857, "comment_id": 93315968, "body": "No you don&#39;t need to, if you define the interface that&#39;s at the top of my answer (<code>type Row interface {</code>), which is implemented by both <code>*sql.Row</code> and <code>*sql.Rows</code> out of the box, you can use that as the argument to ScanRow, i.e. <code>ScanRow(r Row) error</code>. Try it out, you&#39;ll see that when you pass *sql.Row and *sql.Rows to ScanRow your program will compiler just fine. Remember that in Go interfaces are satisfied implicitly which means that you can define interfaces for types that already exist without modifying them."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1541702828, "post_id": 53186857, "comment_id": 93316095, "body": "Ah! I see. Thank you."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1541583682, "creation_date": 1541583682, "answer_id": 53186857, "question_id": 53175792, "link": "https://stackoverflow.com/questions/53175792/how-to-make-scanning-db-rows-in-go-dry/53186857#53186857", "title": "How to make scanning DB rows in Go DRY?", "body": "<p>To eliminate the repetition of the required steps to scan the <code>*sql.Rows</code> structure you could introduce two interfaces. One that describes the already implemented behaviour of <code>*sql.Rows</code> and <code>*sql.Row</code>. </p>\n\n<pre><code>// This interface is already implemented by *sql.Rows and *sql.Row.\ntype Row interface {\n    Scan(...interface{}) error\n}\n</code></pre>\n\n<p>And another one that abstracts away the actual scanning step of the row(s).</p>\n\n<pre><code>// have your entity types implement this one\ntype RowScanner interface {\n    ScanRow(Row) error\n}\n</code></pre>\n\n<p>An example implementation of the RowScanner interface could look like this:</p>\n\n<pre><code>type User struct {\n    Id       uint\n    Username string\n    // ...\n}\n\n// Implements RowScanner\nfunc (u *User) ScanRow(r Row) error {\n    return r.Scan(\n        &amp;u.Id,\n        &amp;u.Username,\n        // ...\n    )\n}\n\ntype UserList struct {\n    Items []*User\n}\n\n// Implements RowScanner\nfunc (list *UserList) ScanRow(r Row) error {\n    u := new(User)\n    if err := u.ScanRow(r); err != nil {\n        return err\n    }\n    list.Items = append(list.Items, u)\n    return nil\n}\n</code></pre>\n\n<p>With these interfaces you can now dry your rows-scanning code for all of your types that implement the RowScanner interface by using these two functions.</p>\n\n<pre><code>func queryRows(query string, rs RowScanner, params ...interface{}) error {\n    rows, err := db.Query(query, params...)\n    if err != nil {\n        return err\n    }\n    defer rows.Close()\n\n    for rows.Next() {\n        if err := rs.ScanRow(rows); err != nil {\n            return err\n        }\n    }\n    return rows.Err()\n}\n\nfunc queryRow(query string, rs RowScanner, params ...interface{}) error {\n    return rs.ScanRow(db.QueryRow(query, params...))\n}\n\n// example\nulist := new(UserList)\nif err := queryRows(queryString, ulist, arg1, arg2); err != nil {\n    panic(err)\n}\n\n// or\nu := new(User)\nif err := queryRow(queryString, u, arg1, arg2); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<hr>\n\n<p>If you have composite types that you want to scan but you want to avoid having to repeat the enumeration of its elements' fields, then you could introduce a method that returns a type's fields and reuse that method where you need it. For example:</p>\n\n<pre><code>func (u *User) ScannableFields() []interface{} {\n    return []interface{}{\n        &amp;u.Id,\n        &amp;u.Username,\n        // ...\n    }\n}\n\nfunc (u *User) ScanRow(r Row) error {\n    return r.Scan(u.ScannableFields()...)\n}\n\n// your other entity type\ntype Site struct {\n    Id   uint\n    Name string\n    // ...\n}\n\nfunc (s *Site) ScannableFields() []interface{} {\n    return []interface{}{\n        &amp;p.Id,\n        &amp;p.Name,\n        // ...\n    }\n}\n\n// Implements RowScanner\nfunc (s *Site) ScanRow(r Row) error {\n    return r.Scan(s.ScannableFields()...)\n}\n\n// your composite\ntype UserWithSite struct {\n    User *User\n    Site *Site\n}\n\n// Implements RowScanner\nfunc (u *UserWithSite) ScanRow(r Row) error {\n    u.User = new(User)\n    u.Site = new(Site)\n    fields := append(u.User.ScannableFields(), u.Site.ScannableFields()...)\n    return r.Scan(fields...)\n}\n\n// retrieve from db\nu := new(UserWithSite)\nif err := queryRow(queryString, u, arg1, arg2); err != nil {\n    panic(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 840, "favorite_count": 0, "accepted_answer_id": 53186857, "answer_count": 1, "score": -5, "last_activity_date": 1541583682, "creation_date": 1541520996, "last_edit_date": 1541523012, "question_id": 53175792, "link": "https://stackoverflow.com/questions/53175792/how-to-make-scanning-db-rows-in-go-dry", "title": "How to make scanning DB rows in Go DRY?", "body": "<p>I have a table in the database containing user account information. I have a struct called User defined. </p>\n\n<pre><code>type User struct {\n  Id        uint\n  Username  string\n  Password  string\n  FirstName string\n  LastName  string\n  Address1  string\n  Address2  string\n  .... a bunch more fields ...\n}\n</code></pre>\n\n<p>For fetching individual user accounts, I have a method defined</p>\n\n<pre><code>func (user *User) GetById(db *sql.DB, id uint) error {\n  query := `SELECT \n            ...a whole bunch of SQL ...\n            WHERE id = $1\n            ... more SQL ...\n            LIMIT 1`\n  row := db.QueryRow(query, id)\n  err := row.Scan(\n    &amp;user.Id,\n    &amp;user.UserName,\n    &amp;user.Password,\n    &amp;user.FirstName,\n    &amp;user.LastName,\n    ... some 20 more lines of fields read into the struct ...\n  )\n  if err != nil {\n    return err\n  }\n  return nil\n}\n</code></pre>\n\n<p>And there are several places in the system where I need to fetch user information as part of a larger query. That is, I am fetching some other type of object, but also a user account related to it.</p>\n\n<p>That means, I have to repeat the whole <code>rows.Scan(&amp;user.Username, &amp;user...)</code> thing over and over again and it takes a whole page and it is error prone and if I ever change the user table structure I would have to change the code in a whole bunch of places. How can I make this more DRY?</p>\n\n<p>Edit: I am not sure why this was marked as a duplicate, but since this edit is required, I will try to explain one more time. I am not asking how to scan a row into a struct. I already know how to do that, as the code above clearly shows. I am asking how to structure the struct scanning code in such a way that I do not have to repeat the same page of scanning code every time I am scanning the same type of struct.</p>\n\n<p>Edit: also, yes, I am aware of sqlstruct and sqlx and similar libraries. I am deliberately avoiding these, because they depend on reflect package with well documented performance issues. And I intend to potentially scan millions of rows using these techniques (not millions of users, but this question extends to other record types).</p>\n\n<p>Edit: so, yes, I know I should write a function. I am not sure what this function should take as arguments and what results it should return. Lets say that the other query I want to accommodate looks like this</p>\n\n<pre><code>SELECT\n    s.id,\n    s.name,\n    ... more site fields ...\n    u.id,\n    u.username,\n    ... more user fields ...\nFROM site AS s\nJOIN user AS u ON (u.id = s.user_id)\nJOIN some_other_table AS st1 ON (site.id = st1.site_id)\n... more SQL ...\n</code></pre>\n\n<p>And I have a site struct method that embeds a user struct. I don't want to repeat the user scanning code here. I want to call a function that will scan the user portion of the raw into a user struct the same way it does in the user method above.</p>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1541520737, "post_id": 53175555, "comment_id": 93241363, "body": "By using a pointer type, e.g. <code>*int8</code>. See <a href=\"https://stackoverflow.com/questions/46365252/how-to-recognize-void-value-and-unspecified-field-when-unmarshaling-in-go/46365300#46365300\">How to recognize void value and unspecified field when unmarshaling in Go?</a>"}, {"owner": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541521452, "post_id": 53175555, "comment_id": 93241753, "body": "that worked like charm!  Thanks @icza"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1541521503, "post_id": 53175555, "comment_id": 93241783, "body": "I&#39;ll mark it as duplicate then."}], "owner": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "closed_date": 1541521518, "answer_count": 0, "score": 1, "last_activity_date": 1541520237, "creation_date": 1541520118, "last_edit_date": 1541520237, "question_id": 53175555, "link": "https://stackoverflow.com/questions/53175555/how-to-know-if-yaml-integer-value-is-empty", "closed_reason": "Duplicate", "title": "How to know if yaml integer value is empty", "body": "<p>I'm making a \"syntax\" validator for .yaml files, I'm trying to know how to validate if integer value from a .yaml file is empty with Go. with strings I don't have any problem, with integer the value default assigned is <code>0</code> but it can't help me to determine if is empty.</p>\n\n<p>example yaml:</p>\n\n<pre><code>name: \"Foo\"\nage:\n</code></pre>\n\n<p>Go Struct:</p>\n\n<pre><code>type Person struct {\n     Name string `yaml:\"name\"`\n     Age  int8   `yaml:\"age\"`\n}\n</code></pre>\n\n<p>if age is empty it going to be assigned a <code>0</code> by default, if the name is empty you will know due you will have <code>\"\"</code></p>\n\n<p>How could I know if age is empty? I'm using <code>gopkg.in/yaml.v2</code> to unmarshal the .yaml.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 4, "creation_date": 1541519484, "post_id": 53175308, "comment_id": 93240614, "body": "Go doesn&#39;t have the classical inheritance like that of Java. It has composition and the way in which you design class hierarchies are different. The way your code looks, you have a <code>Dog</code> which <b>HAS</b> an <code>Animal</code>. This is not the same as a <code>Dog</code> <b>IS</b> an <code>Animal</code>."}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 3, "creation_date": 1541519871, "post_id": 53175308, "comment_id": 93240847, "body": "I&#39;d suggest you look at interfaces in Go. One possible way of doing this is to create an <code>Animal</code> interface that can <code>MakeNoise()</code>."}], "answers": [{"tags": [], "owner": {"reputation": 149903, "user_id": 14637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1904e7096278a10f1dfb3fdc0ceb53cc?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/14637/thomas"}, "is_accepted": false, "score": 1, "last_activity_date": 1541520406, "creation_date": 1541520406, "answer_id": 53175633, "question_id": 53175308, "link": "https://stackoverflow.com/questions/53175308/use-chain-methods-on-inherted-struct/53175633#53175633", "title": "use chain methods on inherted struct", "body": "<p><code>dog.Hello()</code> returns an <code>*Animal</code>, not a <code>*Dog</code>, so you can't just call <code>.Bark()</code> on the returned value.</p>\n\n<p>Note that the call <code>dog.Hello()</code> doesn't <em>really</em> call <code>Hello()</code> on the <code>Dog</code> struct, but rather on the <code>*Animal</code> contained within. It's just syntactic sugar, equivalent to <code>dog.animal.Hello()</code> (if the <code>*Animal</code> field were named, instead of anonymous). It is not inheritance!</p>\n\n<p>However, you already have a <code>*Dog</code> so you can just call <code>.Bark()</code> on that directly:</p>\n\n<pre><code>dog.Hello()\ndog.Bark()\n</code></pre>\n\n<p>Suggestions in the comments about interfaces might also apply, but with this toy example, it's hard to tell what you're trying to achieve in the first place.</p>\n"}], "owner": {"reputation": 31, "user_id": 6877466, "user_type": "registered", "profile_image": "https://graph.facebook.com/1799951810251994/picture?type=large", "display_name": "Anh Thi", "link": "https://stackoverflow.com/users/6877466/anh-thi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1541520406, "creation_date": 1541519297, "last_edit_date": 1541520028, "question_id": 53175308, "link": "https://stackoverflow.com/questions/53175308/use-chain-methods-on-inherted-struct", "title": "use chain methods on inherted struct", "body": "<p>I'm new to Go. I'm solving a problem which is similarity to this, I have a struct Dog inherited from Animal struct. I want to chain method so that i could get a result like \"I am an animal. woof!\" but when i run the program, it generate an error</p>\n\n<blockquote>\n  <p>dog.Animal.Hello().Bark undefined (type *Animal has no field or method Bark)</p>\n</blockquote>\n\n<pre><code>type Animal struct {\n    name string\n    age int\n}\n\nfunc (animal *Animal) Hello() *Animal {\n    fmt.Println(\"I am an animal\")\n    return animal\n}\n\ntype Dog struct {\n    *Animal\n}\n\nfunc (dog *Dog) Bark() *Dog {\n    fmt.Println(\"woof!\")\n    return dog\n}\n\nfunc main() {\n    dog := &amp;Dog{&amp;Animal{name: \"Peter\", age: 25}}\n    dog.Hello().Bark()\n}\n</code></pre>\n\n<p>How can i get over this. Thank you for any recommendation</p>\n"}, {"tags": ["go", "charts", "bar-chart", "go-chart"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1541513094, "post_id": 53173216, "comment_id": 93236739, "body": "I&#39;m voting to close this question as off-topic because it is about a particular configuration issues in a particular third party library."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1541513112, "post_id": 53173216, "comment_id": 93236753, "body": "You should ask the author of go-chart."}], "answers": [{"tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": true, "score": 1, "last_activity_date": 1541518561, "last_edit_date": 1541518561, "creation_date": 1541517430, "answer_id": 53174775, "question_id": 53173216, "link": "https://stackoverflow.com/questions/53173216/text-rotation-in-go-go-chart-library/53174775#53174775", "title": "Text rotation in go- go chart library", "body": "<p>When creating a <code>chart.BarChart</code>, just add <code>TextRotationDegrees</code> to the style of your <code>XAxis</code></p>\n\n<pre><code>XAxis: chart.Style{\n    Show:                true,\n    TextRotationDegrees: 45.0,\n},\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 4398653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yj8yP.png?s=128&g=1", "display_name": "veerg404", "link": "https://stackoverflow.com/users/4398653/veerg404"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "accepted_answer_id": 53174775, "answer_count": 1, "score": 0, "last_activity_date": 1583743900, "creation_date": 1541512009, "last_edit_date": 1583743900, "question_id": 53173216, "link": "https://stackoverflow.com/questions/53173216/text-rotation-in-go-go-chart-library", "title": "Text rotation in go- go chart library", "body": "<p>I am using go chart library <a href=\"https://github.com/wcharczuk/go-chart\" rel=\"nofollow noreferrer\">https://github.com/wcharczuk/go-chart</a> to make a bar chart. The problem I am facing is that the label values are of long length and I want to rotate the text with 45 degree to show the complete text<a href=\"https://i.stack.imgur.com/M73E6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/M73E6.png\" alt=\"enter image description here\"></a></p>\n\n<p>The date format I like to show is like this <code>2018-05-12</code>.</p>\n\n<pre><code>var values []chart.Value\n        for k, v := range timeline {\n\n            // leng += 1\n            new_data := k[0:10]\n            println(new_data)\n            val := float64(v)\n            values = append(values, chart.Value{Label: new_data, Value: val, Style: chart.Style{FontColor: drawing.Color{R: 255, G: 0, B: 0, A: 255}, FontSize: 4.0}})\n        } \n\npie := chart.BarChart{\n        Title:      \"Timeline Chart\",\n        Height:     350,\n        TitleStyle: chart.StyleShow(),\n        Background: chart.Style{\n            Padding: chart.Box{\n                Top: 40,\n            },\n        },\n        BarWidth: 60,\n        XAxis:    chart.StyleShow(),\n        YAxis: chart.YAxis{\n            Style: chart.StyleShow(),\n            // TickStyle: chart.Style{\n            //  TextRotationDegrees: 45.0,\n            // },\n            NameStyle: chart.Style{Show: true, TextRotationDegrees: 45.0},\n        },\n        Bars: values,\n</code></pre>\n\n<p>}</p>\n\n<p>The <strong>chart.Style</strong> property is also not working as I want to make font size small and change color of the label text </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1541509103, "post_id": 53172364, "comment_id": 93234367, "body": "This: <code>licenceAsBytes, _ := APIstub.GetState(args[0]);</code> creates the variable <code>licenceAsBytes</code>. So this <code>licenceAsBytes, _ := json.Marshal(result)</code> is an error, because there are no new variables on the left side. Use simple assignment: <code>licenceAsBytes, _ = json.Marshal(result)</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1541509279, "post_id": 53172364, "comment_id": 93234471, "body": "Don&#39;t ignore errors!"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1541510652, "post_id": 53172364, "comment_id": 93235299, "body": "<code>result.Status := args[1]</code> is also invalid since this doesn&#39;t create a new variable."}], "answers": [{"tags": [], "owner": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "is_accepted": false, "score": 2, "last_activity_date": 1541523578, "last_edit_date": 1541523578, "creation_date": 1541509270, "answer_id": 53172437, "question_id": 53172364, "link": "https://stackoverflow.com/questions/53172364/error-in-marshal-and-unmarshall-in-golang/53172437#53172437", "title": "Error in marshal and Unmarshall in golang", "body": "<p>As <a href=\"https://stackoverflow.com/questions/53172364/error-in-marshal-and-unmarshall-in-golang#comment93234367_53172364\">@icza pointed out</a>, you cannot use shorthand notation twice within a single block, like this:</p>\n\n<pre><code>licenceAsBytes, _ := APIstub.GetState(args[0]);\n...\nlicenceAsBytes, _ := json.Marshal(result)\n</code></pre>\n\n<p>The second should read:</p>\n\n<pre><code>licenceAsBytes, _ = json.Marshal(result)\n</code></pre>\n\n<p>Similarly, the following is invalid:</p>\n\n<pre><code>result.Status := args[1]\n</code></pre>\n\n<p>as it does not define a new variable (it assigns a value to a struct field).</p>\n\n<p>While not an error, for anything, that might go into production, you probably do not want to ignore errors silently (as your current code snippet does, 3x).</p>\n"}, {"tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": false, "score": 0, "last_activity_date": 1541510843, "creation_date": 1541510843, "answer_id": 53172891, "question_id": 53172364, "link": "https://stackoverflow.com/questions/53172364/error-in-marshal-and-unmarshall-in-golang/53172891#53172891", "title": "Error in marshal and Unmarshall in golang", "body": "<p><code>a, b := 5, 6</code> <code>a</code> and <code>b</code> is declared and initialized. If again we use them in a statement like <code>a, _ := some_func()</code>, then error will occur and it will say no new var in left side of the statement. If at least one of them is not declared previously then it will execute without such error.</p>\n\n<p>So, in your case, change this</p>\n\n<pre><code>result.Status := args[1]\nlicenceAsBytes, _ := json.Marshal(result)\n</code></pre>\n\n<p>to</p>\n\n<pre><code>result.Status = args[1]\nlicenceAsBytes, _ = json.Marshal(result)\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 10178118, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G32HpZd3nJg/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rNL4nFRPbyvEBHs1TmzAlbO_OQfA/mo/photo.jpg?sz=128", "display_name": "Sanjeev Kumar", "link": "https://stackoverflow.com/users/10178118/sanjeev-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 0, "answer_count": 2, "score": -5, "last_activity_date": 1541562932, "creation_date": 1541509016, "last_edit_date": 1541562932, "question_id": 53172364, "link": "https://stackoverflow.com/questions/53172364/error-in-marshal-and-unmarshall-in-golang", "title": "Error in marshal and Unmarshall in golang", "body": "<p>I am new to golang while creating a blockchain smart contract function below</p>\n\n<pre><code>func (s *SmartContract)  changeStatus(APIstub shim.ChaincodeStubInterface,args[]string) sc.Response{\n    if len(args) != 2 {\n        return shim.Error(\"Incorrect number of arguments. Expecting 2\")\n    }\n    licenceAsBytes, _ := APIstub.GetState(args[0]);\n    var result Licence\n    json.Unmarshal([]byte(licenceAsBytes), result)\n    result.Status := args[1]\n    licenceAsBytes, _ := json.Marshal(result)\n    APIstub.PutState(args[0], licenceAsBytes);\n\n    return shim.Success(nil)\n\n} \n</code></pre>\n\n<p>When I'm calling this function, I am getting the following error:</p>\n\n<blockquote>\n  <p>Error: could not assemble transaction, err proposal response was not successful, error code 500, msg error starting container: error starting container: Failed to generate platform-specific docker build: Error returned from build: 2 \"# github.com/fabcar/go\n  chaincode/input/src/github.com/fabcar/go/fabcar.go:110:8: non-name result.Status on left side of :=\n  chaincode/input/src/github.com/fabcar/go/fabcar.go:111:20: no new variables on left side of :=\n  \"</p>\n</blockquote>\n"}, {"tags": ["unit-testing", "http", "go", "testing"], "comments": [{"owner": {"reputation": 75, "user_id": 9934193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac90f0ac4addef4a04e5e251d525c786?s=128&d=identicon&r=PG&f=1", "display_name": "ndx", "link": "https://stackoverflow.com/users/9934193/ndx"}, "edited": false, "score": 0, "creation_date": 1541505339, "post_id": 53171123, "comment_id": 93232422, "body": "I&#39;ve already looked at that post and tried to make it work without success."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1541505651, "post_id": 53171123, "comment_id": 93232550, "body": "Then you should post what you&#39;ve tried, and what problems you&#39;ve encountered."}, {"owner": {"reputation": 75, "user_id": 9934193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac90f0ac4addef4a04e5e251d525c786?s=128&d=identicon&r=PG&f=1", "display_name": "ndx", "link": "https://stackoverflow.com/users/9934193/ndx"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541511509, "post_id": 53171123, "comment_id": 93235849, "body": "Original post updated. Well, if I create a custom type and implement the interface as you suggest, how would I go about passing it into the test server?"}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 9934193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac90f0ac4addef4a04e5e251d525c786?s=128&d=identicon&r=PG&f=1", "display_name": "ndx", "link": "https://stackoverflow.com/users/9934193/ndx"}, "edited": false, "score": 0, "creation_date": 1541513565, "post_id": 53173459, "comment_id": 93237033, "body": "Thank you. 100% coverage makes me happy."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 75, "user_id": 9934193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac90f0ac4addef4a04e5e251d525c786?s=128&d=identicon&r=PG&f=1", "display_name": "ndx", "link": "https://stackoverflow.com/users/9934193/ndx"}, "edited": false, "score": 0, "creation_date": 1541513692, "post_id": 53173459, "comment_id": 93237113, "body": "@ndx If this answers your question, consider accepting and upvoting the answer."}, {"owner": {"reputation": 546, "user_id": 1128094, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/0u2o6.png?s=128&g=1", "display_name": "sabbir", "link": "https://stackoverflow.com/users/1128094/sabbir"}, "edited": false, "score": 0, "creation_date": 1561151131, "post_id": 53173459, "comment_id": 99984070, "body": "&quot;How to do that? There are many ways&quot; can you list some of the ways?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 546, "user_id": 1128094, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/0u2o6.png?s=128&g=1", "display_name": "sabbir", "link": "https://stackoverflow.com/users/1128094/sabbir"}, "edited": false, "score": 0, "creation_date": 1561183297, "post_id": 53173459, "comment_id": 99988552, "body": "@sabbir One way is listed explicitly in the answer with concrete example: <i>&quot;a simple one is to &quot;lie&quot; about the content length&quot;</i>."}, {"owner": {"reputation": 85, "user_id": 836325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6ba5d3e9515bcfe094b4eb454d68e14?s=128&d=identicon&r=PG", "display_name": "Jim C", "link": "https://stackoverflow.com/users/836325/jim-c"}, "edited": false, "score": 0, "creation_date": 1580953348, "post_id": 53173459, "comment_id": 106270785, "body": "My use case is a little different perhaps.  I&#39;m testing a REST client, and I&#39;m trying to cause <code>httpClient.Get()</code> to return an error.  When I try and use the suggested fake out of the <code>Content-Length</code> header, I don&#39;t get a error return from httpClient.Get(), but I do get a response marshaling error.  So at least I can test that.  Any ideas on how to trigger a error response from httpClient.Get() when using the httptest package?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 85, "user_id": 836325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6ba5d3e9515bcfe094b4eb454d68e14?s=128&d=identicon&r=PG", "display_name": "Jim C", "link": "https://stackoverflow.com/users/836325/jim-c"}, "edited": false, "score": 1, "creation_date": 1580978391, "post_id": 53173459, "comment_id": 106277584, "body": "@JimC If you want <code>http.Client.Get()</code> to fail, just pass in an invalid URL."}, {"owner": {"reputation": 85, "user_id": 836325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6ba5d3e9515bcfe094b4eb454d68e14?s=128&d=identicon&r=PG", "display_name": "Jim C", "link": "https://stackoverflow.com/users/836325/jim-c"}, "edited": false, "score": 0, "creation_date": 1581014786, "post_id": 53173459, "comment_id": 106298002, "body": "Thanks @icza, that was easy. I just added an extra digit to <code>server.URL</code> that I got from <code>server := httptest.NewServer(mux)</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1541513636, "last_edit_date": 1541513636, "creation_date": 1541512932, "answer_id": 53173459, "question_id": 53171123, "link": "https://stackoverflow.com/questions/53171123/how-to-force-error-on-reading-response-body/53173459#53173459", "title": "How to force error on reading response body", "body": "<p>Check the documentation of <a href=\"https://golang.org/pkg/net/http/#Response\" rel=\"noreferrer\"><code>Response.Body</code></a> to see when reading from it might return an error:</p>\n\n<pre><code>// Body represents the response body.\n//\n// The response body is streamed on demand as the Body field\n// is read. If the network connection fails or the server\n// terminates the response, Body.Read calls return an error.\n//\n// The http Client and Transport guarantee that Body is always\n// non-nil, even on responses without a body or responses with\n// a zero-length body. It is the caller's responsibility to\n// close Body. The default HTTP client's Transport may not\n// reuse HTTP/1.x \"keep-alive\" TCP connections if the Body is\n// not read to completion and closed.\n//\n// The Body is automatically dechunked if the server replied\n// with a \"chunked\" Transfer-Encoding.\nBody io.ReadCloser\n</code></pre>\n\n<p>The easiest way is to generate an invalid HTTP response from the test handler.</p>\n\n<p>How to do that? There are many ways, a simple one is to \"lie\" about the content length:</p>\n\n<pre><code>handler := func(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Length\", \"1\")\n}\n</code></pre>\n\n<p>This handler tells it has 1 byte body, but actually it sends none. So at the other end (the client) when attempting to read 1 byte from it, obviously that won't succeed, and will result in the following error:</p>\n\n<pre><code>Unable to read from body unexpected EOF\n</code></pre>\n\n<p>See related question if you would need to simulate error reading from a request body (not from a response body): <a href=\"https://stackoverflow.com/questions/45126312/how-do-i-test-an-error-on-reading-from-a-request-body/45126402#45126402\">How do I test an error on reading from a request body?</a></p>\n"}, {"comments": [{"owner": {"reputation": 2725, "user_id": 303114, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/kBVST.jpg?s=128&g=1", "display_name": "danfromisrael", "link": "https://stackoverflow.com/users/303114/danfromisrael"}, "edited": false, "score": 0, "creation_date": 1610964795, "post_id": 63800290, "comment_id": 116289588, "body": "plus one for the complete executable example!"}], "tags": [], "owner": {"reputation": 4497, "user_id": 2417812, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b93b8e30afdedfaae41d81f412b9085e?s=128&d=identicon&r=PG", "display_name": "Peter Souter", "link": "https://stackoverflow.com/users/2417812/peter-souter"}, "is_accepted": false, "score": 1, "last_activity_date": 1599592759, "creation_date": 1599592759, "answer_id": 63800290, "question_id": 53171123, "link": "https://stackoverflow.com/questions/53171123/how-to-force-error-on-reading-response-body/63800290#63800290", "title": "How to force error on reading response body", "body": "<p>To expand upon icza's awesome answer, you can also do this with an <code>httptest.Server</code> object:</p>\n<pre><code>bodyErrorServer := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n  w.Header().Set(&quot;Content-Length&quot;, &quot;1&quot;)\n}))\n\ndefer bodyErrorServer.Close()\n</code></pre>\n<p>You can then pass <code>bodyErrorServer.URL</code> in your tests like normal, and you'll always get an EOF error:</p>\n<pre><code>package main\n\nimport (\n    &quot;bytes&quot;\n    &quot;fmt&quot;\n    &quot;io/ioutil&quot;\n    &quot;net/http&quot;\n    &quot;net/http/httptest&quot;\n    &quot;testing&quot;\n    &quot;time&quot;\n)\n\nfunc getBodyFromURL(service string, clientTimeout int) (string, error) {\n\n    var netClient = &amp;http.Client{\n        Timeout: time.Duration(clientTimeout) * time.Millisecond,\n    }\n\n    rsp, err := netClient.Get(service)\n    if err != nil {\n        return &quot;&quot;, err\n    }\n\n    defer rsp.Body.Close()\n\n    if rsp.StatusCode != 200 {\n        return &quot;&quot;, fmt.Errorf(&quot;HTTP request error. Response code: %d&quot;, rsp.StatusCode)\n    }\n\n    buf, err := ioutil.ReadAll(rsp.Body)\n    if err != nil {\n        return &quot;&quot;, err\n    }\n\n    return string(bytes.TrimSpace(buf)), nil\n}\n\nfunc TestBodyError(t *testing.T) {\n\n    bodyErrorServer := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(&quot;Content-Length&quot;, &quot;1&quot;)\n    }))\n\n    _, err := getBodyFromURL(bodyErrorServer.URL, 1000)\n\n    if err.Error() != &quot;unexpected EOF&quot; {\n        t.Error(&quot;GOT AN ERROR&quot;)\n    } else if err == nil {\n            t.Error(&quot;GOT NO ERROR, THATS WRONG!&quot;)\n    } else {\n        t.Log(&quot;Got an unexpected EOF as expected, horray!&quot;)\n    }\n}\n\n</code></pre>\n<p>Playground example here: <a href=\"https://play.golang.org/p/JzPmatibgZn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JzPmatibgZn</a></p>\n"}], "owner": {"reputation": 75, "user_id": 9934193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac90f0ac4addef4a04e5e251d525c786?s=128&d=identicon&r=PG&f=1", "display_name": "ndx", "link": "https://stackoverflow.com/users/9934193/ndx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2218, "favorite_count": 3, "accepted_answer_id": 53173459, "answer_count": 2, "score": 4, "last_activity_date": 1599592759, "creation_date": 1541504201, "last_edit_date": 1541582154, "question_id": 53171123, "link": "https://stackoverflow.com/questions/53171123/how-to-force-error-on-reading-response-body", "title": "How to force error on reading response body", "body": "<p>I've written http client wrapper in go and I need to test it thoroughly.\nI'm reading the response body with ioutil.ReadAll within the wrapper. I'm having a bit of trouble figuring out how I can force a read from the response body to fail with the help of httptest.</p>\n\n<pre><code>package req\n\nfunc GetContent(url string) ([]byte, error) {\n    response, err := httpClient.Get(url)\n    // some header validation goes here\n    body, err := ioutil.ReadAll(response.Body)\n    defer response.Body.Close()\n\n    if err != nil {\n        errStr := fmt.Sprintf(\"Unable to read from body %s\", err)\n        return nil, errors.New(errStr)\n    }\n\n    return body, nil\n}\n</code></pre>\n\n<p>I'm assuming I can set up a fake server as such:</p>\n\n<pre><code>package req_test\n\nfunc Test_GetContent_RequestBodyReadError(t *testing.T) {\n\n    handler := func(w http.ResponseWriter, r *http.Request) {\n        w.WriteHeader(http.StatusOK)\n    }\n\n    ts := httptest.NewServer(http.HandlerFunc(handler))\n    defer ts.Close()\n\n    _, err := GetContent(ts.URL)\n\n    if err != nil {\n        t.Log(\"Body read failed as expected.\")\n    } else {\n        t.Fatalf(\"Method did not fail as expected\")\n    }\n\n}\n</code></pre>\n\n<p>I'm assuming I need to modify the ResposeWriter. Now, is there any way for me to modify the responseWriter and thereby force the ioutil.ReadAll in the wrapper to fail?</p>\n\n<p>I realize that you seem to think it's a duplicate of <a href=\"https://stackoverflow.com/questions/45126312/how-do-i-test-an-error-on-reading-from-a-request-body\">this post</a> and while you may believe so or it might be, just marking it as a duplicate doesn't really help me. The code provided in the answers in the \"duplicate\" post makes very little sense to me in this context.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1541517622, "post_id": 53170210, "comment_id": 93239466, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/47138003/multiple-value-strconv-parseint-in-single-value-context\">multiple-value strconv.ParseInt() in single-value context</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1541517663, "post_id": 53170210, "comment_id": 93239487, "body": "There are dozens of questions on SO about &quot;multiple values in single-value context&quot; errors, all of which have basically the same answers. Please take a quick search of SO and see if you can find your answer."}, {"owner": {"reputation": 157, "user_id": 10612612, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-w4m3q9aA7yM/AAAAAAAAAAI/AAAAAAAAAkk/d49sHP6CQEc/photo.jpg?sz=128", "display_name": "Aryamaan Goswamy", "link": "https://stackoverflow.com/users/10612612/aryamaan-goswamy"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1541524848, "post_id": 53170210, "comment_id": 93243680, "body": "@Adrian I am only a beginner at Golang and I can&#39;t understand any of the code in the first place."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1541525202, "post_id": 53170210, "comment_id": 93243873, "body": "Consider taking the <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">Tour of Go</a> which does an excellent job of explaining the basic concepts and syntax of the language."}], "answers": [{"tags": [], "owner": {"reputation": 3913, "user_id": 3710800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6b06275b7ae4d1d759875b312db2102f?s=128&d=identicon&r=PG&f=1", "display_name": "Guillaume Barr&#233;", "link": "https://stackoverflow.com/users/3710800/guillaume-barr%c3%a9"}, "is_accepted": false, "score": 2, "last_activity_date": 1541501541, "last_edit_date": 1541501541, "creation_date": 1541500860, "answer_id": 53170240, "question_id": 53170210, "link": "https://stackoverflow.com/questions/53170210/how-to-fix-multiple-value-for-single-value-context-error-in-golang/53170240#53170240", "title": "How to fix multiple value for single value context error in Golang?", "body": "<p><code>fmt.Scan()</code> returns two values and your code expects just one when you call it.</p>\n\n<p>The Scan signature <code>func Scan(a ...interface{}) (n int, err error)</code> returns first the number of scanned items and eventually an error. A nil value in the error position indicates that there was no error.</p>\n\n<p>Change your code like this:</p>\n\n<pre><code>addendOne, err := fmt.Scan()\nif err != nil {\n    //Check your error here\n}\n\nfmt.Println(\"Enter another number: \")\naddendTwo, err := fmt.Scan()\nif err != nil {\n    //Check your error here\n}\n</code></pre>\n\n<p>If you really want to ignore the errors you can used the blank identifier <code>_</code>:</p>\n\n<pre><code>addendOne, _ := fmt.Scan()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 719, "user_id": 3172875, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TvLqj.png?s=128&g=1", "display_name": "AnatPort", "link": "https://stackoverflow.com/users/3172875/anatport"}, "is_accepted": false, "score": 5, "last_activity_date": 1600010189, "last_edit_date": 1600010189, "creation_date": 1541501089, "answer_id": 53170303, "question_id": 53170210, "link": "https://stackoverflow.com/questions/53170210/how-to-fix-multiple-value-for-single-value-context-error-in-golang/53170303#53170303", "title": "How to fix multiple value for single value context error in Golang?", "body": "<p><code>fmt.Scan</code> returns two values, and you're only catching one into <code>addedOne</code>.\nyou should catch the error as well like this:</p>\n<pre><code>addendTwo, err := fmt.Scan() \nif err != nil {\n  // handle error here\n}\n</code></pre>\n<p>if you want to ignore the error value (not recommended!), do it like this:</p>\n<pre><code>addendTwo, _ := fmt.Scan() \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 121, "user_id": 6696072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c572069bca9107a071b8a62266365fa9?s=128&d=identicon&r=PG&f=1", "display_name": "Karol Kozikowski", "link": "https://stackoverflow.com/users/6696072/karol-kozikowski"}, "is_accepted": false, "score": 0, "last_activity_date": 1541501473, "creation_date": 1541501473, "answer_id": 53170401, "question_id": 53170210, "link": "https://stackoverflow.com/questions/53170210/how-to-fix-multiple-value-for-single-value-context-error-in-golang/53170401#53170401", "title": "How to fix multiple value for single value context error in Golang?", "body": "<p>Because Scan returns int and error so you should use the := syntax that is shorthand for declaring and initializing.</p>\n\n<pre><code>addendOne, err := fmt.Scan()\naddendTwo, err := fmt.Scan()\n</code></pre>\n\n<p>From golang fmt documentation:</p>\n\n<blockquote>\n  <p>func <a href=\"https://golang.org/pkg/fmt/#Scan\" rel=\"nofollow noreferrer\">Scan</a>(a ...interface{}) (n int, err error)</p>\n</blockquote>\n"}], "owner": {"reputation": 157, "user_id": 10612612, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-w4m3q9aA7yM/AAAAAAAAAAI/AAAAAAAAAkk/d49sHP6CQEc/photo.jpg?sz=128", "display_name": "Aryamaan Goswamy", "link": "https://stackoverflow.com/users/10612612/aryamaan-goswamy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3460, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1600010189, "creation_date": 1541500731, "last_edit_date": 1541502009, "question_id": 53170210, "link": "https://stackoverflow.com/questions/53170210/how-to-fix-multiple-value-for-single-value-context-error-in-golang", "title": "How to fix multiple value for single value context error in Golang?", "body": "<pre><code>package main\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Enter a number: \")\n    var addendOne int = fmt.Scan()\n    fmt.Println(\"Enter another number: \")\n    var addendTwo int = fmt.Scan()\n    sum := addendOne + addendTwo\n    fmt.Println(addendOne, \" + \", addendTwo, \" = \", sum)\n}\n</code></pre>\n\n<p>This raises an error:</p>\n\n<blockquote>\n  <p>multiple values in single-value context.</p>\n</blockquote>\n\n<p>Why does it happen and how do we fix it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8597, "user_id": 1039481, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/a10ec3de7bec751e1633eba0ef28d4cb?s=128&d=identicon&r=PG", "display_name": "Akhil Thayyil", "link": "https://stackoverflow.com/users/1039481/akhil-thayyil"}, "edited": false, "score": 0, "creation_date": 1541499037, "post_id": 53169598, "comment_id": 93229179, "body": "where is the <code>wg</code> declared ?"}, {"owner": {"reputation": 323, "user_id": 9325709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/900514478124ece83447875b14afe55b?s=128&d=identicon&r=PG&f=1", "display_name": "maxwellhertz", "link": "https://stackoverflow.com/users/9325709/maxwellhertz"}, "reply_to_user": {"reputation": 8597, "user_id": 1039481, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/a10ec3de7bec751e1633eba0ef28d4cb?s=128&d=identicon&r=PG", "display_name": "Akhil Thayyil", "link": "https://stackoverflow.com/users/1039481/akhil-thayyil"}, "edited": false, "score": 0, "creation_date": 1541499648, "post_id": 53169598, "comment_id": 93229506, "body": "Oh sorry I forgot it. The type of <code>wg</code> is <code>sync.WaitGroup</code>. @AkhilThayyil"}, {"owner": {"reputation": 497, "user_id": 3246419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99017ab0cf42916f3ececbf0f9c7ee46?s=128&d=identicon&r=PG&f=1", "display_name": "tmcnicol", "link": "https://stackoverflow.com/users/3246419/tmcnicol"}, "edited": false, "score": 0, "creation_date": 1541503177, "post_id": 53169598, "comment_id": 93231355, "body": "If you are doing this for learning then that is great but as an alternative you may want to consider an atomic counter for this purpose, example can be found here <a href=\"https://gobyexample.com/atomic-counters\" rel=\"nofollow noreferrer\">gobyexample.com/atomic-counters</a>"}, {"owner": {"reputation": 323, "user_id": 9325709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/900514478124ece83447875b14afe55b?s=128&d=identicon&r=PG&f=1", "display_name": "maxwellhertz", "link": "https://stackoverflow.com/users/9325709/maxwellhertz"}, "edited": false, "score": 0, "creation_date": 1541506879, "post_id": 53169598, "comment_id": 93233160, "body": "Thanks. I&#39;ll give it a try.@tmcnicol"}], "answers": [{"tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": true, "score": 10, "last_activity_date": 1541505435, "last_edit_date": 1541505435, "creation_date": 1541500552, "answer_id": 53170157, "question_id": 53169598, "link": "https://stackoverflow.com/questions/53169598/all-goroutines-are-asleep/53170157#53170157", "title": "All goroutines are asleep", "body": "<p>Channels <code>make(chan int)</code> has implicit size zero ( ref: <a href=\"https://golang.org/ref/spec#Making_slices_maps_and_channels\" rel=\"noreferrer\">https://golang.org/ref/spec#Making_slices_maps_and_channels</a>)</p>\n\n<p>A channel of size zero is unbuffered. A channel of specified size make(chan int, n) is buffered. See <a href=\"http://golang.org/ref/spec#Send_statements\" rel=\"noreferrer\">http://golang.org/ref/spec#Send_statements</a> for a discussion on buffered vs. unbuffered channels. The example at <a href=\"http://play.golang.org/p/VZAiN1V8-P\" rel=\"noreferrer\">http://play.golang.org/p/VZAiN1V8-P</a> illustrates the difference.</p>\n\n<p>Here, channel <code>&lt;-ch</code> or <code>ch &lt;-</code> will be blocked until someone processes it (<strong>concurrently</strong>). If you try the flow of this program in pen and paper, you will figure it out why it is blocked. Below figure shows possible data flow through channel <code>ch</code>:</p>\n\n<p><a href=\"https://i.stack.imgur.com/6LRcY.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/6LRcY.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>So if you make your <code>ch := make(chan int64)</code> to  <code>ch := make(chan int64,1)</code>, it will work.</p>\n\n<pre><code>var counter int64 // shared resource\nvar wg sync.WaitGroup\n\nfunc main() {\n    ch := make(chan int64, 1)\n\n    wg.Add(2)\n\n    go incCounter(ch)\n    go incCounter(ch)\n\n    ch &lt;- counter\n\n    wg.Wait()\n    fmt.Println(\"Final Counter:\", counter) // expected value is 4\n}\n\nfunc incCounter(ch chan int64) {\n    defer wg.Done()\n\n    for count := 0; count &lt; 2; count++ {\n        value := &lt;-ch\n        value++\n        counter = value\n        ch &lt;- counter\n    }\n}\n</code></pre>\n\n<p>If we analyse how program works when you are using <code>ch := make(chan int64)</code>, we can see that one go routine is blocked in this program(another one is exited). With the help of <code>time.Sleep(n)</code> and receiving the last data from the channel in the blocked go routine, we can overcome the deadlock. See the code below:</p>\n\n<pre><code>var counter int64 // shared resource\nvar wg sync.WaitGroup\n\nfunc main() {\n    ch := make(chan int64)\n\n    wg.Add(2)\n\n    go incCounter(ch)\n    go incCounter(ch)\n\n    ch &lt;- counter\n\n    // to ensure one go routine 'incCounter' is completed and one go routine is blocked for unbuffered channel\n    time.Sleep(3*time.Second)\n\n    &lt;-ch // to unblock the last go routine\n\n    wg.Wait()\n    fmt.Println(\"Final Counter:\", counter) // expected value is 4\n}\n\nfunc incCounter(ch chan int64) {\n    defer wg.Done()\n\n    for count := 0; count &lt; 2; count++ {\n        value := &lt;-ch\n        value++\n        counter = value\n        ch &lt;- counter\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 323, "user_id": 9325709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/900514478124ece83447875b14afe55b?s=128&d=identicon&r=PG&f=1", "display_name": "maxwellhertz", "link": "https://stackoverflow.com/users/9325709/maxwellhertz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 53170157, "answer_count": 1, "score": 1, "last_activity_date": 1541505435, "creation_date": 1541498494, "last_edit_date": 1541503863, "question_id": 53169598, "link": "https://stackoverflow.com/questions/53169598/all-goroutines-are-asleep", "title": "All goroutines are asleep", "body": "<p>I write some code which aims to synchronize using channel.</p>\n\n<pre><code>    var counter int64  // shared resource\n\n    var wg sync.WaitGroup\n\n    func main() {\n        ch := make(chan int64)\n\n        wg.Add(2)\n\n        go incCounter(ch)\n        go incCounter(ch)\n\n        ch &lt;- counter\n\n        wg.Wait()\n        fmt.Println(\"Final Counter:\", counter) // expected value is 4\n    }\n\n    func incCounter(ch chan int64) {\n        defer wg.Done()\n\n        for count := 0; count &lt; 2; count++ {\n            value := &lt;-ch\n            value++\n            counter = value\n            ch &lt;- counter\n        }\n    }\n</code></pre>\n\n<p>When I ran this program, an error happened: <code>all goroutines are asleep - deadlock!</code>. However I can't fix the problem and I don't know what is wrong. Could anyone help?</p>\n"}, {"tags": ["go", "operating-system", "signals"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541497855, "post_id": 53169391, "comment_id": 93228456, "body": "It works for me (Linux, Go 1.11)."}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1541497875, "post_id": 53169391, "comment_id": 93228470, "body": "your go function probably finishes before you can press ctrl + c, you probably want an infinite loop to catch the signal"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1541497938, "post_id": 53169391, "comment_id": 93228512, "body": "Please include the output of <code>go version</code> and <code>go env</code>. Also, what does <code>runtime.GOMAXPROCS(0)</code> return to you?"}, {"owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "edited": false, "score": 0, "creation_date": 1541498168, "post_id": 53169391, "comment_id": 93228634, "body": "it works for me too. How did you run the go program?"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1541503397, "post_id": 53169391, "comment_id": 93231469, "body": "The program works for me on Linux and MacOs with go 1.10.3"}, {"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 1, "creation_date": 1541511840, "post_id": 53169391, "comment_id": 93236045, "body": "Are you running this on Windows? What shell are you using? I&#39;ve experienced this same issue before in Cygwin but it works perfectly when using PowerShell."}], "answers": [{"tags": [], "owner": {"reputation": 18530, "user_id": 3344003, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/988af95d5692ee66b1fc2fe725ba738e?s=128&d=identicon&r=PG&f=1", "display_name": "user3344003", "link": "https://stackoverflow.com/users/3344003/user3344003"}, "is_accepted": false, "score": 1, "last_activity_date": 1541515973, "creation_date": 1541515973, "answer_id": 53174345, "question_id": 53169391, "link": "https://stackoverflow.com/questions/53169391/ctrl-c-not-being-caught/53174345#53174345", "title": "CTRL + C not being caught", "body": "<p>You need to ensure that your terminal or terminal emulator settings are set up to do what you are trying to do. Terminal drivers do a lot of filtering. For example on Enunchs,  keys get translated into  sent to the application and then get echoed back to the terminal as as .</p>\n\n<p>Your terminal driver could be just ignoring . It could be in a passthu mode where it just sends  as a character to your application.</p>\n\n<p>How you would make such settings depends upon your operating system.</p>\n"}], "owner": {"reputation": 67, "user_id": 7435381, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/d11cbc2c19a32fb2ae5451b451e22578?s=128&d=identicon&r=PG&f=1", "display_name": "marwagaser", "link": "https://stackoverflow.com/users/7435381/marwagaser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1541515973, "creation_date": 1541497726, "question_id": 53169391, "link": "https://stackoverflow.com/questions/53169391/ctrl-c-not-being-caught", "title": "CTRL + C not being caught", "body": "<p>I am trying to write a program which prints \"wait\" whenever cntrl + c is being pressed and continue printing the numbers from 1 to 10. Otherwise, numbers from 1 to 10 should be printed with delay of 10 seconds between each number.However control+ c is not being recognized whenever i click and \"wait\" is not being printed only numbers from 1 to 10 are. </p>\n\n<pre><code>    func main() {\n        c := make(chan os.Signal, 1)\n        signal.Notify(c, os.Interrupt)\n        go func() {\n            for sig := range c {\n                fmt.Print(sig)\n                fmt.Print(\"WAIT\")\n            }\n        }()\n        for i := 1; i &lt;= 10; i++ {\n            fmt.Println(i)\n            time.Sleep(time.Second)\n        }\n\n}\n</code></pre>\n"}, {"tags": ["angularjs", "go"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 4, "last_activity_date": 1541497372, "last_edit_date": 1541497372, "creation_date": 1541496522, "answer_id": 53169057, "question_id": 53168995, "link": "https://stackoverflow.com/questions/53168995/why-my-go-service-say-that-my-item-is-not-defined-from-my-server/53169057#53169057", "title": "Why my go service say that my &quot;item&quot; is not defined from my server?", "body": "<p>Go template parser found Angular expressions and wanted to interpret them. It found no function named <code>item</code>.</p>\n\n<p>You need to apply one of the solutions </p>\n\n<ol>\n<li>use strings in templates <code>{{`{{Your.Angular.Data}}`}}</code></li>\n<li>escape the expressions using <code>{{\"{{\"}}</code>, <code>{{\"}}\"}}</code></li>\n<li>use different <a href=\"https://golang.org/pkg/text/template/#Template.Delims\" rel=\"nofollow noreferrer\">delimiters</a> </li>\n</ol>\n\n<p><code>tpl = template.Must(template.ParseGlob(\"Views/*\").Delims(\"&lt;(\",\")&gt;\"))</code></p>\n\n<p>In the your case you don't use any template features so you can drop them.</p>\n\n<p>Source <a href=\"https://stackoverflow.com/q/17641887/450989\">How do I escape \u201c{{\u201d and \u201c}}\u201d delimiters in Go templates?</a></p>\n"}], "owner": {"reputation": 31, "user_id": 9541715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2c2afccd056c1a88f319a1aaa2337e0?s=128&d=identicon&r=PG&f=1", "display_name": "Luis Zanella", "link": "https://stackoverflow.com/users/9541715/luis-zanella"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 53169057, "answer_count": 1, "score": 1, "last_activity_date": 1541511299, "creation_date": 1541496326, "last_edit_date": 1592644375, "question_id": 53168995, "link": "https://stackoverflow.com/questions/53168995/why-my-go-service-say-that-my-item-is-not-defined-from-my-server", "title": "Why my go service say that my &quot;item&quot; is not defined from my server?", "body": "<p>I running my service of go and then there is this error that i don\u00b4t know how to solve it (panic: template: index.html:20: function &quot;item&quot; not defined) it suppose to be for my html but how i can solve it:</p>\n<h2>Code HTML (Angular)</h2>\n<pre><code>&lt;table id=&quot;mytable&quot; class=&quot;table table-bordred table-striped&quot;&gt;\n  &lt;tr&gt;\n   &lt;th&gt;ID&lt;/th&gt;\n   &lt;th&gt;Name&lt;/th&gt;\n   &lt;th&gt;Last Name&lt;/th&gt;\n   &lt;th&gt;Second Last Name&lt;/th&gt;\n  &lt;/tr&gt;\n  &lt;tbody&gt;\n   &lt;tr ng-repeat=&quot;item in ListOfUsers&quot;&gt;\n    &lt;td ng-if=&quot;ListOfUsers.length!==0&quot;&gt;{{item._id}}&lt;/td&gt;\n    &lt;td ng-if=&quot;ListOfUsers.length!==0&quot;&gt;{{item._name}}&lt;/td&gt;\n    &lt;td ng-if=&quot;ListOfUsers.length!==0&quot;&gt;{{item._lastName}}&lt;/td&gt;\n    &lt;td&gt;&lt;a class=&quot;btn btn-primary btn-xs&quot; href=&quot;#!EditUser/{{item.Id}}&quot;&gt;\n    &lt;span class=&quot;glyphicon glyphicon-pencil&quot;&gt;&lt;/span&gt;&lt;/a&gt;\n    &lt;/td&gt;\n    &lt;td&gt;&lt;a class=&quot;btn btn-danger btn-xs&quot;ref=&quot;#!DeleteUser/{{item.Id}}&quot;&gt;\n    &lt;span class=&quot;glyphicon glyphicon-trash&quot;&gt;&lt;/span&gt;&lt;/a&gt;\n    &lt;/td&gt;\n   &lt;/tr&gt;\n  &lt;/tbody&gt;\n &lt;/table&gt;\n</code></pre>\n<hr />\n<h1>Go Service</h1>\n<pre><code>func main(){\n    fs := http.FileServer(http.Dir(&quot;Resources&quot;))\n    go print10000numbers(&quot;world&quot;)\n    print10000numbers(&quot;hello&quot;)\n    router := mux.NewRouter()\n    router.HandleFunc(&quot;/People&quot;,GetPeopleHandler).Methods(&quot;GET&quot;)\n    router.HandleFunc(&quot;/InsertPeople&quot;,InsertPersonHandler).Methods(&quot;POST&quot;)\n    router.HandleFunc(&quot;/UpdatePeople/{id}&quot;,UpdatePersonHandler).Methods(&quot;POST&quot;)\n    router.HandleFunc(&quot;/DeletePeople/{id}&quot;,DeletePersonHandler).Methods(&quot;DELETE&quot;)\n    router.Handle(&quot;/Resources/Angular/angular.js&quot;,http.StripPrefix(&quot;/Resources&quot;, fs))\n    router.Handle(&quot;/Resources/JS/AppController.js&quot;,http.StripPrefix(&quot;/Resources&quot;, fs))\n    tpl = template.Must(template.ParseGlob(&quot;Views/*&quot;))\n    fmt.Println(&quot;Listening&quot;)\n    router.HandleFunc(&quot;/&quot;,chargeHtml).Methods(&quot;GET&quot;)\n    http.ListenAndServe(&quot;:8081&quot;,router)\n}\nfunc chargeHtml(w http.ResponseWriter,r *http.Request){\n    tpl.ExecuteTemplate(w,&quot;index.html&quot;,nil) \n}\n</code></pre>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1541489946, "post_id": 53167528, "comment_id": 93224930, "body": "A sync.WaitGroup does no magic: You <b>must</b> call wg.Add before starting a goroutine and wg.Done inside the goroutine once done."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1541490078, "post_id": 53167528, "comment_id": 93224982, "body": "But if you properly use a sync.WaitGroup your code would still be wrong: You <b>must</b> <b>not</b> write to the same map concurrently. This simply is <b>not</b> <b>allowed</b>. You should guard the individual writes with a sync.Mutex instead if just making sure all goroutines are done with a syc.WaitGroup."}], "answers": [{"tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": true, "score": 3, "last_activity_date": 1541494593, "last_edit_date": 1541494593, "creation_date": 1541490511, "answer_id": 53167719, "question_id": 53167528, "link": "https://stackoverflow.com/questions/53167528/go-functions-writing-to-the-same-map/53167719#53167719", "title": "Go functions writing to the same map", "body": "<p>As pointed out in the comments, you need to synchronize access to the map and your usage of <code>sync.WaitGroup</code> is incorrect.</p>\n\n<p>Try this instead:</p>\n\n<pre><code>func main() {\n    squares := make(map[int]int)\n    var lock sync.Mutex\n    var wg sync.WaitGroup\n    for i := 1; i &lt;= 10; i++ {\n        wg.Add(1) // Increment the wait group count\n        go func(n int, s map[int]int) {\n            lock.Lock() // Lock the map\n            s[n] = n * n\n            lock.Unlock()\n            wg.Done() // Decrement the wait group count\n        }(i, squares)\n    }\n    wg.Wait()\n    fmt.Println(\"Squares::: \", squares)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 552, "user_id": 606880, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/f0039481cbb27fea7ef2a47764e5335f?s=128&d=identicon&r=PG", "display_name": "viggy", "link": "https://stackoverflow.com/users/606880/viggy"}, "is_accepted": false, "score": -3, "last_activity_date": 1541502821, "creation_date": 1541502821, "answer_id": 53170742, "question_id": 53167528, "link": "https://stackoverflow.com/questions/53167528/go-functions-writing-to-the-same-map/53170742#53170742", "title": "Go functions writing to the same map", "body": "<p><a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\">sync.Map</a> is what you are actually looking for, modified the code to suit your usecase here, </p>\n\n<p><a href=\"https://play.golang.org/p/DPLHiMsH5R8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DPLHiMsH5R8</a></p>\n\n<p>P.S. Had to add some sleep so that the program does not finish before all the go routines are called.</p>\n"}], "owner": {"reputation": 1534, "user_id": 6619424, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/52542029d07d6ca5d28ab46c837cb2bd?s=128&d=identicon&r=PG&f=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/6619424/arun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 53167719, "answer_count": 2, "score": -3, "last_activity_date": 1541502821, "creation_date": 1541489581, "question_id": 53167528, "link": "https://stackoverflow.com/questions/53167528/go-functions-writing-to-the-same-map", "title": "Go functions writing to the same map", "body": "<p>I am trying to familiarize with go routines. I have written the following simple program to store the squares of numbers from 1-10 in a map.  </p>\n\n<pre><code>func main() {\n    squares := make(map[int]int)\n    var wg sync.WaitGroup\n    for i := 1; i &lt;= 10; i++ {\n        go func(n int, s map[int]int) {\n            s[n] = n * n\n        }(i, squares)\n    }\n    wg.Wait()\n    fmt.Println(\"Squares::: \", squares)\n}\n</code></pre>\n\n<p>At the end, it prints an empty map. But in go, maps are passed by references. Why is it printing an empty map?</p>\n"}, {"tags": ["go", "memory", "binary", "byte"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541489308, "post_id": 53167273, "comment_id": 93224703, "body": "This is a integer literal in hex. E.g. 0x10 == 16. Writing 0x1 is just a fancy way to write 1."}], "answers": [{"tags": [], "owner": {"reputation": 448, "user_id": 3946355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51adb3fdec323f447fd70f20e76866d6?s=128&d=identicon&r=PG&f=1", "display_name": "Chang Qian", "link": "https://stackoverflow.com/users/3946355/chang-qian"}, "is_accepted": true, "score": 4, "last_activity_date": 1541489371, "creation_date": 1541489371, "answer_id": 53167489, "question_id": 53167273, "link": "https://stackoverflow.com/questions/53167273/what-does-0x1-in-golang-mean/53167489#53167489", "title": "What does 0x1 in Golang mean?", "body": "<p><code>0x1</code> is just the hexadecimal notation of number <code>1</code>. You <code>&amp;</code> some integer with <code>0x1</code> to get its least significant (rightmost) bit. You write <code>0x1</code> instead of <code>1</code> when using a bit mask because it's easier to convert from base 16 than from base 10 to base 2.</p>\n\n<p>For the second question, what <code>func PrefixLen</code> does is finding the number of consecutive zeroes on the beginning of <code>count</code>. The outer loop does one byte each time, and the inner loop deals with separate bits: when j=0 it shifts 7 to the right thus getting the first bit from left, when j=1 it shifts 6 getting the second bit, and so on. When a bit of <code>1</code> is encountered it returns the count of bits already checked.</p>\n"}], "owner": {"reputation": 3738, "user_id": 5509839, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/dgxf7.jpg?s=128&g=1", "display_name": "aroooo", "link": "https://stackoverflow.com/users/5509839/aroooo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 372, "favorite_count": 1, "accepted_answer_id": 53167489, "answer_count": 1, "score": -1, "last_activity_date": 1541489371, "creation_date": 1541488368, "question_id": 53167273, "link": "https://stackoverflow.com/questions/53167273/what-does-0x1-in-golang-mean", "title": "What does 0x1 in Golang mean?", "body": "<p>I'm trying to understand this piece of code for returning how many zeroes a byte array is prefixed with but I'm not sure what 0x1 is. Google search isn't helpful, but I'm assuming <code>0x1</code> is returning the first bit? What are these called?</p>\n\n<p>Also, I know this is a separate question but I don't think it warrants a new thread: I don't quite understand why we're nesting a loop here, bit shifting, and subtracting j from 7. Is this how the byte is transformed into binary? </p>\n\n<pre><code>IdLength := 32\nfunc PrefixLen(count [IdLength]byte) int {\n    for i := 0; i &lt; IdLength; i++ {\n        for j := 0; j &lt; 8; j++ {\n            if (count[i]&gt;&gt;uint8(7-j))&amp;0x1 != 0 {\n                return i*8 + j\n            }\n        }\n    }\n    return IdLength*8 - 1\n}\n</code></pre>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 8, "creation_date": 1541487267, "post_id": 53166988, "comment_id": 93223931, "body": "Probably not with package net/http. The simplest solutions is to fix upstream. Or implement your own HTTP (forking net/http). Good luck with that!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 5, "creation_date": 1541492048, "post_id": 53166988, "comment_id": 93225848, "body": "The proper way to handle such a request is with a 400 response code, which seems to be what&#39;s happening. Anything else is no longer called HTTP, since the response to an invalid request is so specifically defined within the HTTP spec.  So if you want to do something differently, you should not use the <code>net&#47;http</code> package."}, {"owner": {"reputation": 1177, "user_id": 3064551, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/3CW8n.jpg?s=128&g=1", "display_name": "rajenpandit", "link": "https://stackoverflow.com/users/3064551/rajenpandit"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541661248, "post_id": 53166988, "comment_id": 93294089, "body": "Thanks @Volker for you suggestions. I have forked net/http and did changes in net/textproto/reader.go to ignore such line where colon (:) separator is not present and continue with rest lines instead of throwing error."}], "owner": {"reputation": 1177, "user_id": 3064551, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/3CW8n.jpg?s=128&g=1", "display_name": "rajenpandit", "link": "https://stackoverflow.com/users/3064551/rajenpandit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 293, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1541487080, "creation_date": 1541487080, "question_id": 53166988, "link": "https://stackoverflow.com/questions/53166988/how-to-ignore-a-http-header-line-with-missing-colon-separator-in-golang", "title": "How to ignore a http header line with missing colon separator in golang", "body": "<p>I am facing a problem in golang http server where client is sending a http request with invalid parameters in header. The request parameters are as follows:</p>\n\n<pre><code>GET /a-53-qf21489190x38856_2/yy HTTP/1.1\nHost: xxx.xxx.xxx.xxx:80\nUser-Agent: mot-w845\nConnection: Keep-Alive\nProfile: http://10.213.2.68\nX-MDN9035445271\naccept: application/vnd.wap.mms-message\naccept-language: en\naccept-charset: US-ASCII, ISO-8859-1, UTF-8\n\nHTTP/1.1 400 Bad Request\nContent-Type: text/plain; charset=utf-8\nConnection: close\n</code></pre>\n\n<p>Here X-MDN9035445271 doesn't contain colon (:) separator, because of this server is returning bad request. Is there any way to ignore such kind of header and process the request normally. </p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1541486785, "post_id": 53166848, "comment_id": 93223776, "body": "race condition maybe? your r registry variable has no locking?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1541486845, "post_id": 53166848, "comment_id": 93223796, "body": "The <code>main</code> function calls <code>r.Print()</code> before <code>service2</code> returns. There&#39;s a data race on the map (run the program with  <code>go -race main.go</code> to view the races)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541487029, "post_id": 53166848, "comment_id": 93223855, "body": "Your program may print anything, e.g. even  <code>service 1 -&gt; hubbu bubba trallala</code> as it is malformed as it is racy."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1541488749, "post_id": 53166848, "comment_id": 93224481, "body": "&quot;the defer in service2() is never called&quot;. Yes it is. Approximately 300 milliseconds after service2 starts running. &quot;I understand that timeout means &#39;stop executing&#39;&quot;. No, it does not, at least not regarding the context package. Cancelling a context doesn&#39;t do anything fancy; it simply closes a channel."}, {"owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1541490725, "post_id": 53166848, "comment_id": 93225279, "body": "you are right! I misunderstood it. So how to solve the problem correctly? Should I introduce a channel and wait for a signal or add mutexes somehow?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1541492341, "post_id": 53166848, "comment_id": 93225978, "body": "Please put your code in the question. Playgrounds links are great, but should not be required to understand your question--especially considering external links tend to go stale eventually."}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1541506180, "post_id": 53169195, "comment_id": 93232825, "body": "I added timeouts to simulate the situation when <code>service2()</code> executes longer time than <code>service1()</code> to learn how to deal with such situations. So the answer for part 2 is not the answer to my question. But thanks for the explanation! Helped me a lot."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "reply_to_user": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1541506406, "post_id": 53169195, "comment_id": 93232950, "body": "Did you mean that the timeout for <code>service2()</code> is less than timeout for <code>service1()</code>?"}, {"owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1541506552, "post_id": 53169195, "comment_id": 93233011, "body": "Not quite... I wanted to simulate a situation when <code>service1()</code> is running and defer is executed. However, the <code>service2()</code> is still running and then it timeouts. I&#39;m thinking about buffered channels as a solution for the data condition you explained."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "reply_to_user": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1541507434, "post_id": 53169195, "comment_id": 93233464, "body": "In that case did you call <code>service2()</code> from <code>service1()</code>? I/m just wanted to know."}, {"owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1541516691, "post_id": 53169195, "comment_id": 93238879, "body": "correct! It looks like that -&gt; <code>main()</code> -&gt; <code>go service1()</code> -&gt;<code>go service2()</code>"}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "reply_to_user": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1541518998, "post_id": 53169195, "comment_id": 93240292, "body": "So, if you simulate a solution when <code>service1()</code> is running and defer is executed then how <code>service2()</code> is still in running. Cause it&#39;s parent is <code>service1()</code> as you said. So you can&#39;t go with this solution. Right?"}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "reply_to_user": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1541523621, "post_id": 53169195, "comment_id": 93243046, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/183198/discussion-between-shudipta-sharma-and-kabanek\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": true, "score": 0, "last_activity_date": 1541497508, "last_edit_date": 1541497508, "creation_date": 1541497073, "answer_id": 53169195, "question_id": 53166848, "link": "https://stackoverflow.com/questions/53166848/why-when-i-timeout-a-function-a-defer-is-not-called/53169195#53169195", "title": "Why when I timeout a function a defer is not called?", "body": "<h2>Answer of 1st part</h2>\n\n<p>Say you have a function <code>f1()</code> which uses <code>defer</code> to call <code>f2()</code>, i.e. <code>defer f2()</code> . The fact is that the <code>f2</code> will be called if and only if <code>f1</code> completes even if a run-time panic occurs. More specifically, look at <a href=\"https://www.golang-book.com/books/intro/7#section6\" rel=\"nofollow noreferrer\">go-defer</a>.</p>\n\n<p>Now our concern is about using defer in goroutine. We also have to remember that a go-routine exits if it's parent function completes of exits.</p>\n\n<p>So if we use <code>defer</code> in a go-routine function, then if the parent fuction completes or exits, then go-routine function must exit. Since it exits (not completes) the <code>defer</code> statement will not execute. It will be clear we draw the state of your program.\n<a href=\"https://i.stack.imgur.com/1xIrg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1xIrg.png\" alt=\"enter image description here\"></a>\nAs you see, </p>\n\n<ul>\n<li>at 1st millisecond, <code>service1()</code> completes before others. So, <code>service2()</code> exits without executing <code>defer</code> statement and 'service 2' won't be set to <code>false</code>. Since <code>service1()</code> completes, it's <code>defer</code> will execute and 'service 1' will be set to <code>false</code>.</li>\n<li>at 2nd millisecond, the <code>main()</code> completes and program finishes.</li>\n</ul>\n\n<p>So we see how this program executes.</p>\n\n<h2>Answer of 2nd part</h2>\n\n<p>One possible solution i tried is increase time in <code>service1()</code> or decrease time in <code>service2()</code>.</p>\n"}], "owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 408, "favorite_count": 1, "accepted_answer_id": 53169195, "answer_count": 1, "score": -2, "last_activity_date": 1541497792, "creation_date": 1541486345, "last_edit_date": 1541497792, "question_id": 53166848, "link": "https://stackoverflow.com/questions/53166848/why-when-i-timeout-a-function-a-defer-is-not-called", "title": "Why when I timeout a function a defer is not called?", "body": "<p>When I add a defer in a function I expect that it will be always called when the function ends.\nI noticed that it does not happen when the function is times out. </p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc service1(ctx context.Context, r *Registry) {\n    ctx, cancel := context.WithTimeout(ctx, 100*time.Millisecond)\n    defer func() {\n        r.Unset(\"service 1\")\n    }()\n    r.Set(\"service 1\")\n    go service2(ctx, r)\n\n    select {\n    case &lt;-ctx.Done():\n        cancel()\n        break\n    }\n }\n\n func service2(ctx context.Context, r *Registry) {\n    defer func() {\n        r.Unset(\"service 2\")\n    }()\n\n    r.Set(\"service 2\")\n\n    time.Sleep(time.Millisecond * 300)\n }\n\n         type Registry struct {\n    entries map[string]bool\n }\n\n func (r *Registry)Set(key string) {\n    r.entries[key] = true\n }\n\n func (r *Registry)Unset(key string)  {\n    r.entries[key] = false\n }\n\n func (r *Registry)Print() {\n    for key, val := range r.entries  {\n        fmt.Printf(\"%s -&gt; %v\\n\", key, val)\n    }\n }\n\n func NewRegistry() *Registry {\n    r := Registry{}\n    r.entries = make(map[string]bool)\n\n    return &amp;r\n }\n\nfunc main() {\n    r := NewRegistry()\n\n    ctx, cancel := context.WithTimeout(context.Background(), time.Millisecond*200)\n\n    go service1(ctx, r)\n    // go service3(ctx, r)\n\n    select {\n    case &lt;-ctx.Done():\n        fmt.Printf(\"context err: %s\\n\", ctx.Err())\n        cancel()\n    }\n\n    r.Print()\n }\n</code></pre>\n\n<p>In the example above, the defer in <code>service2()</code> is never called and that's why the output is:</p>\n\n<pre><code>service 1 -&gt; false\nservice 2 -&gt; true\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>service 1 -&gt; false\nservice 2 -&gt; false\n</code></pre>\n\n<p>I understand that timeout means \"stop executing\" but it's reasonable to me execute deferred code. I could not find any explanation of this behavior.</p>\n\n<p>And the second part of the question - how to modify the service or <code>Registry</code> to be resistant to such situations?</p>\n"}, {"tags": ["go", "distributed", "p2p", "xor", "kademlia"], "answers": [{"comments": [{"owner": {"reputation": 3738, "user_id": 5509839, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/dgxf7.jpg?s=128&g=1", "display_name": "aroooo", "link": "https://stackoverflow.com/users/5509839/aroooo"}, "edited": false, "score": 0, "creation_date": 1541529814, "post_id": 53170794, "comment_id": 93246132, "body": "Interesting\u2013 UvarInt() was actually returning a value when the two identifiers were different. Was this probably just using the first 64 bits truncated then?"}, {"owner": {"reputation": 448, "user_id": 3946355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51adb3fdec323f447fd70f20e76866d6?s=128&d=identicon&r=PG&f=1", "display_name": "Chang Qian", "link": "https://stackoverflow.com/users/3946355/chang-qian"}, "reply_to_user": {"reputation": 3738, "user_id": 5509839, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/dgxf7.jpg?s=128&g=1", "display_name": "aroooo", "link": "https://stackoverflow.com/users/5509839/aroooo"}, "edited": false, "score": 1, "creation_date": 1541557727, "post_id": 53170794, "comment_id": 93255713, "body": "@arooo I did some more research and found that <code>Uvarint()</code> (and its signed sibling) use a unique encoding described in <a href=\"https://developers.google.com/protocol-buffers/docs/encoding\" rel=\"nofollow noreferrer\">developers.google.com/protocol-buffers/docs/encoding</a> (also in the source of <code>encoding&#47;binary</code> package), which puts the least significant bits first and 7 bits of data (instead of 8) per byte. So it will give unexpected results trying to interpret arbitrary data in byte slices. Answer updated."}, {"owner": {"reputation": 448, "user_id": 3946355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51adb3fdec323f447fd70f20e76866d6?s=128&d=identicon&r=PG&f=1", "display_name": "Chang Qian", "link": "https://stackoverflow.com/users/3946355/chang-qian"}, "reply_to_user": {"reputation": 3738, "user_id": 5509839, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/dgxf7.jpg?s=128&g=1", "display_name": "aroooo", "link": "https://stackoverflow.com/users/5509839/aroooo"}, "edited": false, "score": 1, "creation_date": 1541558000, "post_id": 53170794, "comment_id": 93255774, "body": "@arooo Also, it&#39;s recommended that you add check for length of <code>node</code> and <code>otherNode</code> and a corresponding return value of type <code>error</code> to avoid <code>index out of range</code> panics."}], "tags": [], "owner": {"reputation": 448, "user_id": 3946355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51adb3fdec323f447fd70f20e76866d6?s=128&d=identicon&r=PG&f=1", "display_name": "Chang Qian", "link": "https://stackoverflow.com/users/3946355/chang-qian"}, "is_accepted": true, "score": 2, "last_activity_date": 1561428541, "last_edit_date": 1561428541, "creation_date": 1541502979, "answer_id": 53170794, "question_id": 53166625, "link": "https://stackoverflow.com/questions/53166625/better-understanding-kademlias-xor-integer-metric/53170794#53170794", "title": "Better understanding Kademlia&#39;s XOR Integer Metric", "body": "<p>It's not correct because</p>\n\n<ul>\n<li><code>binary.Uvarint()</code> can only decode numbers within 64 bits, and your rawBytes is 256 bits</li>\n<li>The \"varint\" encoding (as commented in <a href=\"https://golang.org/src/encoding/binary/varint.go\" rel=\"nofollow noreferrer\">https://golang.org/src/encoding/binary/varint.go</a>) is basically not compatible with raw bytes.</li>\n</ul>\n\n<p>You have to use the <code>math/big</code> package for usage like that. Here is my revised version of your snippet:</p>\n\n<pre><code>func xorDistance(node string, otherNode string) *big.Int {\n    var rawBytes [32]byte\n    for i := 0; i &lt; 32; i++ {\n        rawBytes[i] = node[i] ^ otherNode[i]\n    }\n    return big.NewInt(0).SetBytes(rawBytes[:])\n}\n</code></pre>\n"}], "owner": {"reputation": 3738, "user_id": 5509839, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/dgxf7.jpg?s=128&g=1", "display_name": "aroooo", "link": "https://stackoverflow.com/users/5509839/aroooo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 53170794, "answer_count": 1, "score": 4, "last_activity_date": 1561428541, "creation_date": 1541484911, "last_edit_date": 1541488380, "question_id": 53166625, "link": "https://stackoverflow.com/questions/53166625/better-understanding-kademlias-xor-integer-metric", "title": "Better understanding Kademlia&#39;s XOR Integer Metric", "body": "<p>I'm trying to better-grasp Kademlia's XOR distance metric so I've written a small dummy program to try and understand better. I'm also not using a 160-bit number as my key here, but rather a sha256 hash of some user identifier.</p>\n\n<p>Here's my xor distance function. Is this more or less correct? I'm XORing each byte\u2013 appending that to a buffer <code>rawBytes</code> and converting that  byte buffer into an integer.</p>\n\n<pre><code>func XorDistance(node string, otherNode string) uint64 {\n    var rawBytes [32]byte\n    for i := 0; i &lt; 32; i++ {\n        rawBytes[i] = node[i] ^ otherNode[i]\n    }\n    distance, _ := binary.Uvarint(rawBytes[:])\n    return distance\n}\n</code></pre>\n"}, {"tags": ["go", "cors", "preflight", "revel"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 7836325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/349e6f23f746a4b3d5132668f35431f0?s=128&d=identicon&r=PG&f=1", "display_name": "user7836325", "link": "https://stackoverflow.com/users/7836325/user7836325"}, "is_accepted": false, "score": 1, "last_activity_date": 1550664357, "creation_date": 1550664357, "answer_id": 54786011, "question_id": 53164637, "link": "https://stackoverflow.com/questions/53164637/handle-preflight-request-with-golang-revel/54786011#54786011", "title": "Handle preflight request with Golang, Revel", "body": "<p>Add a filters before revel.PanicFilter</p>\n\n<pre><code>revel.Filters = []revel.Filter{\n        ValidateOrigin,\n        revel.PanicFilter,             // Recover from panics and display an error page instead.\n        revel.RouterFilter,            // Use the routing table to select the right Action\n        revel.FilterConfiguringFilter, // A hook for adding or removing per-Action filters.\n        revel.ParamsFilter,            // Parse parameters into Controller.Params.\n        IpLimitFilter,\n        revel.SessionFilter,           // Restore and write the session cookie.\n        revel.FlashFilter,             // Restore and write the flash cookie.\n        revel.ValidationFilter,        // Restore kept validation errors and save new ones from cookie.\n        revel.I18nFilter,              // Resolve the requested language\n        HeaderFilter,\n        revel.InterceptorFilter,       // Run interceptors around the action.\n        revel.CompressFilter,          // Compress the result.\n        revel.BeforeAfterFilter,       // Call the before and after filter functions\n        revel.ActionInvoker,           // Invoke the action.\n    }\n\nvar ValidateOrigin = func(c *revel.Controller, fc []revel.Filter) {\n    if c.Request.Method == \"OPTIONS\" {\n        c.Response.Out.Header().Add(\"Access-Control-Allow-Origin\", \"*\")\n        c.Response.Out.Header().Add(\"Access-Control-Allow-Headers\", \"Content-Type,AccessToken,X-CSRF-Token, Authorization\") //\u81ea\u5b9a\u4e49 Header\n        c.Response.Out.Header().Add(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS\")\n        c.Response.Out.Header().Add(\"Access-Control-Expose-Headers\", \"Content-Length, Access-Control-Allow-Origin, Access-Control-Allow-Headers, Content-Type\")\n        c.Response.Out.Header().Add(\"Access-Control-Allow-Credentials\", \"true\")\n        c.Response.SetStatus(http.StatusNoContent)\n        // \u622a\u53d6\u590d\u6742\u8bf7\u6c42\u4e0bpost\u53d8\u6210options\u8bf7\u6c42\u540e\u53f0\u5904\u7406\u65b9\u6cd5(\u9488\u5bf9\u8de8\u57df\u8bf7\u6c42\u68c0\u6d4b)\n    } else {\n        c.Response.Out.Header().Add(\"Access-Control-Allow-Headers\", \"Origin, Content-Type, Accept\")\n        c.Response.Out.Header().Add(\"Access-Control-Allow-Origin\", \"*\")\n        c.Response.Out.Header().Add(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, PUT, DELETE\")\n        c.Response.Out.Header().Add(\"Content-Type\", \"application/json; charset=UTF-8\")\n        c.Response.Out.Header().Add(\"X-Frame-Options\", \"SAMORIGIN\")\n        c.Response.Out.Header().Add(\"Vary\", \"Origin, Access-Control-Request-Method, Access-Control-Request-Headers\")\n\n        fc[0](c, fc[1:]) // Execute the next filter stage.\n    }\n}\n...\n</code></pre>\n\n<p>Because ajax turns a simple request (single post) request into a secondary request, that is, an options request is first sent to determine whether the domain is allowed, and then the real request post is sent to obtain the result.</p>\n"}], "owner": {"reputation": 139, "user_id": 9223835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe290666d33d667fae91b0bf22d76bf8?s=128&d=identicon&r=PG&f=1", "display_name": "Ryo", "link": "https://stackoverflow.com/users/9223835/ryo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 939, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1550664357, "creation_date": 1541468201, "last_edit_date": 1541580456, "question_id": 53164637, "link": "https://stackoverflow.com/questions/53164637/handle-preflight-request-with-golang-revel", "title": "Handle preflight request with Golang, Revel", "body": "<p>I made API application with Golang + Revel framework</p>\n\n<p>Now I tried to send http request from front end application, made by vue.js. </p>\n\n<p>But because of cors, PUT method cannot be handled.(POST method worked fine now)</p>\n\n<p>In revel, I thought we can set header in <code>app/init.go</code> file, like this</p>\n\n<pre><code>var HeaderFilter = func(c *revel.Controller, fc []revel.Filter) {\nc.Response.Out.Header().Add(\"X-Frame-Options\", \"SAMEORIGIN\")\nc.Response.Out.Header().Add(\"X-XSS-Protection\", \"1; mode=block\")\nc.Response.Out.Header().Add(\"X-Content-Type-Options\", \"nosniff\")\nc.Response.Out.Header().Add(\"Referrer-Policy\", \"strict-origin-when-cross-origin\")\n\n// Add them by myself\nc.Response.Out.Header().Add(\"Access-Control-Allow-Headers\", \"Origin, Content-Type, Accept\")\nc.Response.Out.Header().Add(\"Access-Control-Allow-Origin\", \"*\")\nc.Response.Out.Header().Add(\"Access-Control-Allow-Method\", \"POST, GET, OPTIONS, PUT, DELETE\")\nc.Response.Out.Header().Add(\"Content-Type\", \"application/json; charset=UTF-8\")\n\nfc[0](c, fc[1:]) // Execute the next filter stage.\n</code></pre>\n\n<p>But still I got 404 error from API and request method is shown as <code>OPTIONS</code>.  </p>\n\n<p>How can I set request header to enable to handle every requests ?</p>\n"}, {"tags": ["json", "go", "post", "go-echo"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 8023930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7daf6dd58d93c9a2d31b8d67f9d651f8?s=128&d=identicon&r=PG&f=1", "display_name": "GaidarOS", "link": "https://stackoverflow.com/users/8023930/gaidaros"}, "edited": false, "score": 0, "creation_date": 1541487874, "post_id": 53165644, "comment_id": 93224141, "body": "I can&#39;t believe it was that simple. I feel dumb right now. I&#39;ll be sure to keep your points in mind. Thanks!"}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 1, "last_activity_date": 1541478960, "last_edit_date": 1541478960, "creation_date": 1541477646, "answer_id": 53165644, "question_id": 53163520, "link": "https://stackoverflow.com/questions/53163520/testing-post-request-with-echo-expected-vs-actual-output/53165644#53165644", "title": "Testing POST request with Echo (expected vs actual output)", "body": "<p>You are calling <code>json.Marshal</code> on the <code>[]Houses</code>, which marshals it to a JSON string, then you are calling <code>echo.Context.JSON</code> with the JSON string, which internally calls <code>json.Marshal</code>. Double marshalling causes the escaping. See example. (error checking omitted for brevity)</p>\n\n<p><a href=\"https://play.golang.org/p/nYvHS4huy0M\" rel=\"nofollow noreferrer\">https://play.golang.org/p/nYvHS4huy0M</a></p>\n\n<pre><code>h := &amp;Houses{\"Jhon Doe\", \"High St.\"}\nd, _ := json.Marshal(h)\n\n// double marshal bad\nd, _ = json.Marshal(string(d))\n\nfmt.Println(string(d))\n// prints \"{\\\"name\\\":\\\"Jhon Doe\\\",\\\"address\\\":\\\"High St.\\\"}\"\n</code></pre>\n\n<p>Your solution is to just pass the slice to your <code>c.JSON</code> call. As a side note, you should be able to pass the struct to <code>c.Bind</code> instead of using a map with type assertions.</p>\n"}], "owner": {"reputation": 63, "user_id": 8023930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7daf6dd58d93c9a2d31b8d67f9d651f8?s=128&d=identicon&r=PG&f=1", "display_name": "GaidarOS", "link": "https://stackoverflow.com/users/8023930/gaidaros"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2982, "favorite_count": 1, "accepted_answer_id": 53165644, "answer_count": 1, "score": 4, "last_activity_date": 1553996229, "creation_date": 1541458820, "last_edit_date": 1553996229, "question_id": 53163520, "link": "https://stackoverflow.com/questions/53163520/testing-post-request-with-echo-expected-vs-actual-output", "title": "Testing POST request with Echo (expected vs actual output)", "body": "<p>I'm kinda new in Go, so, sorry if this is a silly question.</p>\n\n<p>I have been recently trying some API with Echo. I'm trying to test a route(POST) handler of Go echo that gets a json and puts it in an array. Bellow is the code for the handler <strong>main.go</strong> and for the test <strong>test_main.go</strong></p>\n\n<p><code>main.go</code></p>\n\n\n\n<pre><code>type Houses struct {\nName    string `json:\"name,ommitempty\"`\nAddress string `json:\"address,omitempty\"`\n}\n\nvar houses []Houses\n\nfunc newHouse(c echo.Context) error {\n    m := echo.Map{}\n    if err := c.Bind(&amp;m); err != nil {\n        return err\n    }\n    dv := Houses{\n        Name:    m[\"name\"].(string),\n        Address: m[\"address\"].(string),\n    }\n    houses = append(houses, dv)\n    js, _ := json.Marshal(houses)\n    fmt.Println(fmt.Sprintf(\"%s\", js))\n\n    return c.JSON(http.StatusOK, string(js))\n}\n</code></pre>\n\n<p><code>test_main.go</code></p>\n\n<pre><code>import (\n    \"net/http\"\n    \"net/http/httptest\"\n    \"strings\"\n    \"testing\"\n\n    \"github.com/labstack/echo\"\n    \"github.com/stretchr/testify/assert\"\n)\n\nvar userJSON = `{\"name\":\"Jhon Doe\",\"address\":\"High St.\"}`\n\nfunc TestModel(t *testing.T) {\n    url := \"/new_house\"\n    e := echo.New()\n    req, err := http.NewRequest(http.MethodPost, url, strings.NewReader(userJSON))\n    req.Header.Set(\"Content-Type\", \"application/json\")\n    if err != nil {\n        t.Errorf(\"The request could not be created because of: %v\", err)\n    }\n    rec := httptest.NewRecorder()\n    c := e.NewContext(req, rec)\n    // c.SetPath(\"/new_house\")\n    // c.JSON(http.StatusOK, Devices{\"Jhon Doe\", \"Middle Way\"})\n\n    res := rec.Result()\n    defer res.Body.Close()\n\n    if assert.NoError(t, newHouse(c)) {\n        assert.Equal(t, http.StatusOK, rec.Code)\n        assert.Equal(t, \"[\"+userJSON+\"]\", rec.Body.String())\n    }\n}\n</code></pre>\n\n<p>The test fails with the error shown bellow even though the handler works properly if called by curl. </p>\n\n<pre><code>[{\"name\":\"Jhon Doe\",\"address\":\"High St.\"}]\n--- FAIL: TestModel (0.00s)\n    /home/gaidaros/Code/echo-badger/models/model_test.go:34: \n            Error Trace:    model_test.go:34\n            Error:          Not equal: \n                            expected: \"[{\\\"name\\\":\\\"Jhon Doe\\\",\\\"address\\\":\\\"High St.\\\"}]\"\n                            actual  : \"\\\"[{\\\\\\\"name\\\\\\\":\\\\\\\"Jhon Doe\\\\\\\",\\\\\\\"address\\\\\\\":\\\\\\\"High St.\\\\\\\"}]\\\"\"\n\n                            Diff:\n                            --- Expected\n                            +++ Actual\n                            @@ -1 +1 @@\n                            -[{\"name\":\"Jhon Doe\",\"address\":\"High St.\"}]\n                            +\"[{\\\"name\\\":\\\"Jhon Doe\\\",\\\"address\\\":\\\"High St.\\\"}]\"\n            Test:           TestModel\nFAIL\nexit status 1\n</code></pre>\n\n<p>After several days of struggling over it I couldn't figure out how to make the actual output to match the expected, so I'm posting here in hopes of getting past this obstacle. Any help is appreciated!</p>\n"}, {"tags": ["for-loop", "go", "coding-style"], "comments": [{"owner": {"reputation": 8470, "user_id": 538866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb67b45ca1dc2584f8e4d703d009177b?s=128&d=identicon&r=PG", "display_name": "Jonas G. Drange", "link": "https://stackoverflow.com/users/538866/jonas-g-drange"}, "edited": false, "score": 1, "creation_date": 1541450392, "post_id": 53161811, "comment_id": 93214125, "body": "Did you try it? The for-loop is versatile. You would need an extra <code>;</code>, though."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541450398, "post_id": 53161811, "comment_id": 93214127, "body": "The second version is not Go. Most people would write a variant of the first code."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1541450645, "post_id": 53161811, "comment_id": 93214256, "body": "You mean something like this?: <a href=\"https://play.golang.org/p/Uly1buDNXCF\" rel=\"nofollow noreferrer\">play.golang.org/p/Uly1buDNXCF</a> -- Sure it&#39;s possible if you write a valid for statement, whether that&#39;s useful or not is debatable."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1541450760, "post_id": 53161811, "comment_id": 93214301, "body": "Yes, it&#39;s possible. You have to repeat the Read call: <a href=\"https://play.golang.org/p/Uc51FFTBM_9\" rel=\"nofollow noreferrer\">play.golang.org/p/Uc51FFTBM_9</a>. I don&#39;t see how this is in any way better than your first version though. Multiple short lines are preferable over a single long line and, more importantly, the error handling is incomplete (any error other than EOF is ignored)."}], "answers": [{"tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": false, "score": 0, "last_activity_date": 1541484521, "creation_date": 1541484521, "answer_id": 53166571, "question_id": 53161811, "link": "https://stackoverflow.com/questions/53161811/golang-one-line-for-loop/53166571#53166571", "title": "Golang one line for loop", "body": "<p>It is conventional way to write simpler statements rather than lengthy, complex one, isn't it?</p>\n\n<p>So, I consider the 1st version is more conventional way than the 2nd version. Moreover, the <code>for</code> loop in your 2nd version isn't in the right way. If you want to use that, then fix it like following or whatever you wish:</p>\n\n<pre><code>for line, err := reader.Read(); err != io.EOF; line, err = reader.Read() {\n    //do data parsing from your line here\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 10315779, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-E_BvAT5hZbQ/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaMgosCR4s5Xl9VTinGirTinV7kReg/mo/photo.jpg?sz=128", "display_name": "Maximillian Schulte", "link": "https://stackoverflow.com/users/10315779/maximillian-schulte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1607, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1541484521, "creation_date": 1541450066, "question_id": 53161811, "link": "https://stackoverflow.com/questions/53161811/golang-one-line-for-loop", "title": "Golang one line for loop", "body": "<p>I was trying to read in CSV file in Golang line by line with a for loop that required an if statement with a break to see if the error reading the file was EOF.  I find this syntax rather unnecessary when I could in java for example read the line inside a while loop conditional and simultaneously check for the EOF error.  I thought that declaring a variable inside of a for loop was possible and I know for sure that you can do this with if statements in Golang. Doing:</p>\n\n<pre><code>if v := 2; v &gt; 1{\n    fmt.Println(\"2 is better than 1\")\n}\n</code></pre>\n\n<p>The first snippet of code I have here is what I know to work in my program.</p>\n\n<pre><code>reader := csv.NewReader(some_file)\n\nfor {\n    line, err := reader.Read()\n    if err == io.EOF {\n        break\n    }\n    //do data parsing from your line here\n}\n</code></pre>\n\n<p>I do not know whether or not this second snippet is conceptually possible or just syntactically incorrect.</p>\n\n<pre><code>reader := csv.NewReader(some_file)\n\nfor line, err := reader.Read(); err != io.EOF {\n    //do data parsing from your line here\n}\n</code></pre>\n\n<p>Would like some clarification/benefits/conventions of doing it one way over another, Thanks :)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "edited": false, "score": 0, "creation_date": 1541449596, "post_id": 53161647, "comment_id": 93213749, "body": "Just a heads up: type is keyword in go. so you cant name your variable that way."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1541449921, "post_id": 53161647, "comment_id": 93213905, "body": "I&#39;m not sure what your example is asking, something like these questions? <a href=\"https://stackoverflow.com/questions/26566124/golang-variable-with-type-from-string\" title=\"golang variable with type from string\">stackoverflow.com/questions/26566124/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/10210188/instance-new-type-golang\" title=\"instance new type golang\">stackoverflow.com/questions/10210188/instance-new-type-golan&zwnj;&#8203;g</a>, <a href=\"https://stackoverflow.com/questions/23030884/is-there-a-way-to-create-an-instance-of-a-struct-from-a-string\" title=\"is there a way to create an instance of a struct from a string\">stackoverflow.com/questions/23030884/&hellip;</a>, etc."}, {"owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "edited": false, "score": 0, "creation_date": 1541450220, "post_id": 53161647, "comment_id": 93214042, "body": "Please who has downvoted my question let explain here what is reason for that."}, {"owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1541450315, "post_id": 53161647, "comment_id": 93214092, "body": "@JimB - for exampel you have to arrays and sou want to go over for loop but one of them. Over my upper way you can only write two loops which is really not nice. It would be nice to pass array name if that is possible and then do loop."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1541518031, "post_id": 53161815, "comment_id": 93239711, "body": "Except using a map, which doesn&#39;t require any conditionals."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1541524589, "post_id": 53161815, "comment_id": 93243548, "body": "@Adrian The map just <i>hides</i> the conditionals."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1541524967, "post_id": 53161815, "comment_id": 93243756, "body": "Not exactly. While there are certainly branches involved in the implementation of maps, it is not the same implementation at all. It is a completely different implementation based on a hash table."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1541450094, "creation_date": 1541450094, "answer_id": 53161815, "question_id": 53161647, "link": "https://stackoverflow.com/questions/53161647/how-to-dynamically-call-variable/53161815#53161815", "title": "How to dynamically call variable?", "body": "<blockquote>\n  <p>Is something like this possible in go?</p>\n</blockquote>\n\n<p>No.</p>\n\n<p>All ways to do something like this boils down to the solution you showed.</p>\n"}, {"comments": [{"owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "edited": false, "score": 0, "creation_date": 1541452775, "post_id": 53162301, "comment_id": 93215115, "body": "absolutely if is possible, but if not?"}, {"owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "edited": false, "score": 0, "creation_date": 1541452861, "post_id": 53162301, "comment_id": 93215150, "body": "no matter what I agree with you that this would be only proper way"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 4, "last_activity_date": 1541452387, "creation_date": 1541452387, "answer_id": 53162301, "question_id": 53161647, "link": "https://stackoverflow.com/questions/53161647/how-to-dynamically-call-variable/53162301#53162301", "title": "How to dynamically call variable?", "body": "<p>use a map</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n        x:=make(map[string]int)\n        x[\"SomethingA\"]=123\n        x[\"SomethingB\"]=456\n    fmt.Println(x[\"SomethingA\"])\n    fmt.Println(x[\"SomethingB\"])\n}\n</code></pre>\n"}], "owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 1, "answer_count": 2, "score": -4, "last_activity_date": 1541452387, "creation_date": 1541449322, "question_id": 53161647, "link": "https://stackoverflow.com/questions/53161647/how-to-dynamically-call-variable", "title": "How to dynamically call variable?", "body": "<p>I have two variables:</p>\n\n<pre><code>somethingA := 123\nsomethingB := 456\n</code></pre>\n\n<p>This two variables are filled though the system and lets presume that you have third variable:</p>\n\n<pre><code>type := \"A\"\n</code></pre>\n\n<p>With third variable you want to call somethingA but not like following:</p>\n\n<pre><code>if type == \"A\" {\n    return somethingA\n}else{\n    return somethingB\n}\n</code></pre>\n\n<p>but something like:</p>\n\n<pre><code>return something{type}\n</code></pre>\n\n<p>Is something like this possible in go?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["go", "tab-completion"], "comments": [{"owner": {"reputation": 32690, "user_id": 3266847, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/U0oyt.png?s=128&g=1", "display_name": "Benjamin W.", "link": "https://stackoverflow.com/users/3266847/benjamin-w"}, "edited": false, "score": 3, "creation_date": 1541448903, "post_id": 53161408, "comment_id": 93213462, "body": "This sounds pretty broad. You might look into using readline functionality, for example through <a href=\"https://github.com/chzyer/readline\" rel=\"nofollow noreferrer\">this implementation</a>."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1541449461, "post_id": 53161408, "comment_id": 93213689, "body": "have a look at this: <a href=\"https://github.com/abiosoft/ishell\" rel=\"nofollow noreferrer\">github.com/abiosoft/ishell</a>"}], "owner": {"reputation": 37, "user_id": 10372559, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-B31-tOfZ5po/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaOLkuN6BACRXbwyER5-ooTpOb2LNw/mo/photo.jpg?sz=128", "display_name": "Mike", "link": "https://stackoverflow.com/users/10372559/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 556, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1541448250, "creation_date": 1541448250, "question_id": 53161408, "link": "https://stackoverflow.com/questions/53161408/how-might-i-implement-tab-completion-in-golang", "title": "How might I implement tab completion in GoLang?", "body": "<p>I have an interactive program written in Go.</p>\n\n<p>How might I go about implementing tab completion within the program?</p>\n\n<p>Would command history be possible (pressing up/down arrow key)?</p>\n\n<p>Example:</p>\n\n<p><code>$ ./go-program</code></p>\n\n<p><code>(Go-Program)&gt; set option &lt;tab tab&gt;</code></p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1541445628, "post_id": 53160629, "comment_id": 93211983, "body": "In the where clause say you had this type: <code>Where(&quot;locattttiiiooon_id = ?&quot;</code> Now with the above code that error will never be emitted and basically always insert new rows. - It should crash the request in my opinion, not sure how to do that either in the &#39;go way&#39;"}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1541457262, "post_id": 53160629, "comment_id": 93216951, "body": "No I mean if a developer mistyped something, if we don&#39;t throw the error how will we know?  Allot of data will be corrupted by the time you find out there is an error that you didn&#39;t handle.  execution shouldn&#39;t&#39; continue."}, {"owner": {"reputation": 989, "user_id": 5016244, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bdZPE.jpg?s=128&g=1", "display_name": "Theophile Dano", "link": "https://stackoverflow.com/users/5016244/theophile-dano"}, "reply_to_user": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1541457392, "post_id": 53160629, "comment_id": 93217001, "body": "Execution <b>should</b> continue, but not this particular task, I admit it. But that&#39;s why you <b>must</b> write unit tests, make code reviews etc. Don&#39;t overload your code for programming mistakes that shouldn&#39;t happen anyways"}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1541457937, "post_id": 53160629, "comment_id": 93217189, "body": "Hmm I see, yeah it would simplify the usage that&#39;s for sure.  I just find in other languages it would just crash so always checking for err != nil has gotten me a bit muddled."}], "tags": [], "owner": {"reputation": 989, "user_id": 5016244, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bdZPE.jpg?s=128&g=1", "display_name": "Theophile Dano", "link": "https://stackoverflow.com/users/5016244/theophile-dano"}, "is_accepted": false, "score": 2, "last_activity_date": 1541444812, "creation_date": 1541444812, "answer_id": 53160629, "question_id": 53160219, "link": "https://stackoverflow.com/questions/53160219/is-my-find-function-following-best-practises/53160629#53160629", "title": "Is my Find function following best practises", "body": "<p>Regarding \"best practices\", it's better to post under <a href=\"https://codereview.stackexchange.com/\">the dedicated SO website</a>. </p>\n\n<pre><code>var ErrUserNotFound = errors.New(\"User not found\")\n\nfunc (dbs *DbService) GetUserLocationId(locationId int) (user User, err error)\n    record := dbs.deps.db.Where(\"location_id = ?\", locationId).Find(&amp;user)\n    if record.RecordNotFound() {\n        err = ErrUserNotFound\n    }\n    return\n}\n</code></pre>\n\n<p>Okay this is closer to the GO \"best practices\" standards IMHO. It's considered good practices to create package error values for commonly returned errors. It helps the caller handle each case properly (should there be), but it's not really the case here.</p>\n\n<p>For the other snippet, you really won't want to do this like that. First of all you omitted the pointer receiver for both methods <code>GetUserLocationById</code> and <code>InsertNewUser</code>. Then, you usually don't want to shadow the parent's scope <code>err</code> variable, but it's <em>ok</em> here...</p>\n\n<pre><code>user, err := dbs.GetUserLocationById(123)\nif err != nil {\n   err = dbs.InsertNewUser(user)\n   // handle err here\n}\n</code></pre>\n\n<p>Anyways, I think that doing this with errors is too bad for there are no really other possibilities than \"ErrUserNotFound\" here. I would advise going for a <code>ok</code> boolean instead.</p>\n\n<pre><code>func (dbs *DbService) GetUserLocationId(locationId int) (user User, ok bool)\n    record := dbs.deps.db.Where(\"location_id = ?\", locationId).Find(&amp;user)\n    ok = !record.RecordNotFound()\n    return\n}\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>var user User\nif user, ok := dbs.GetUserLocationId(123); !ok {\n    if err := dbs.InsertNewUser(user); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": -6, "last_activity_date": 1541848478, "creation_date": 1541443057, "last_edit_date": 1541848478, "question_id": 53160219, "link": "https://stackoverflow.com/questions/53160219/is-my-find-function-following-best-practises", "title": "Is my Find function following best practises", "body": "<p>I want to make sure my query to find models by ID is correct as I will be using this same pattern for all my structs/models.</p>\n\n<pre><code>func (dbs *DbService) GetUserLocationId(locationId int) (User, error) {\n    var model User\n    if dbs.deps.db.Where(\"location_id = ?\", locationId).Find(&amp;model).RecordNotFound() {\n        return model, errors.New(\"User not found\")\n    }\n    return model, nil\n}\n</code></pre>\n\n<p>So a common usecase in a web application is to lookup a model, if it does not exist that I will insert a new record.</p>\n\n<p>using the above I will do:</p>\n\n<pre><code>user, err := GetUserLocationById(123)\nif err != nil {\n  err := InsertNewUser(user)\n}\n</code></pre>\n\n<p>Now what thing I am struggling with is this.  If the errors is not nil, then I should insert a new user.  But what if the error is because my query inside the function GetUserLocationById has the wrong column name?\nI dont' want to start inserting rows when they really do exist.</p>\n\n<p>Looking for some advice to make sure I am doing this correctly. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1541445969, "post_id": 53159944, "comment_id": 93212128, "body": "Have you taken a look at the source of <code>json.Unmarshal</code>?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1541456511, "post_id": 53159944, "comment_id": 93216651, "body": "rows.Scan takes an argument for each column. Can I assume from the code in your question that you are querying for a single column?  If so, I&#39;ll whip up an answer.  If there are multiple columns, describe what you plan to pass to <code>dest</code> and how columns are mapped to whatever is in there."}, {"owner": {"reputation": 1023, "user_id": 759432, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d93ba89bd33c4f930040be57b6de8f17?s=128&d=identicon&r=PG", "display_name": "smad", "link": "https://stackoverflow.com/users/759432/smad"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1541488936, "post_id": 53159944, "comment_id": 93224563, "body": "@Adrian : Yes without being able to find the answer to my question actually. I am not a Go expert, so I may not understand some important part."}, {"owner": {"reputation": 1023, "user_id": 759432, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d93ba89bd33c4f930040be57b6de8f17?s=128&d=identicon&r=PG", "display_name": "smad", "link": "https://stackoverflow.com/users/759432/smad"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1541501218, "post_id": 53159944, "comment_id": 93230383, "body": "@ThunderCat you&#39;re right, let&#39;s say it was for the exercise"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1541491309, "creation_date": 1541491309, "answer_id": 53167899, "question_id": 53159944, "link": "https://stackoverflow.com/questions/53159944/filling-a-slice-of-interface-type-given-as-argument-e-g-implement-a-scanall-f/53167899#53167899", "title": "Filling a slice of interface type given as argument (e.g., implement a ScanAll for database/sql)", "body": "<p>Here's a solution using the <a href=\"https://godoc.org/reflect\" rel=\"nofollow noreferrer\">reflect package</a>. Call the function with a pointer to a slice.</p>\n\n<pre><code>func GetAll(query string, dest interface{}) error {\n\n    // Return error if dest is not a pointer to a slice.\n    slice := reflect.ValueOf(dest)\n    if slice.Kind() != reflect.Ptr {\n        return errors.New(\"dest must be pointer\")\n    }\n    slice = slice.Elem()\n    if slice.Kind() != reflect.Slice {\n        return errors.New(\"dest must be pointer to struct\")\n    }\n\n    rows, err := db.Query(query)\n    if err != nil {\n        return err\n    }\n    defer rows.Close()\n\n    for rows.Next() {\n        // Create a new slice element. The variable elementp holds a \n        // pointer to the new element.\n        elementp := reflect.New(slice.Type().Elem())\n\n        err := rows.Scan(elementp.Interface())\n        if err != nil {\n            return err\n        }\n\n        // Append the element to the slice.\n        slice.Set(reflect.Append(slice, elementp.Elem()))\n    }\n    return nil\n}\n</code></pre>\n\n<p>The above code works with standard database/sql package when the query result has a single column and dest is a pointer to a slice of a type appropriate for that column.  Here's an example:</p>\n\n<pre><code>var names []string\nif err := GetAll(db, \"select name from people\", &amp;names); err != nil {\n    // handle error\n}\n</code></pre>\n\n<p>This code should also work with a database package that supports scanning multiple columns to a struct. </p>\n"}], "owner": {"reputation": 1023, "user_id": 759432, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d93ba89bd33c4f930040be57b6de8f17?s=128&d=identicon&r=PG", "display_name": "smad", "link": "https://stackoverflow.com/users/759432/smad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 53167899, "answer_count": 1, "score": 0, "last_activity_date": 1541491309, "creation_date": 1541441704, "question_id": 53159944, "link": "https://stackoverflow.com/questions/53159944/filling-a-slice-of-interface-type-given-as-argument-e-g-implement-a-scanall-f", "title": "Filling a slice of interface type given as argument (e.g., implement a ScanAll for database/sql)", "body": "<p>How could we implement a function which would return all rows resulting from a SQL query and convert them to <code>dest</code> which is an interface array (may not work as <code>Scan</code>) ?</p>\n\n<p>I assume the destination array would have to be given as an argument to the function. But then, I still do not know how I am supposed to complete the implementation:</p>\n\n<pre><code>func GetAll(query string, dest interface{}) error {\n\n  rows, err := s.db.Query(query)\n  if err != nil {\n    return err\n  }\n  defer rows.Close()\n\n  for rows.Next() {\n    var destRow ??? /* do not have a type. using reflect.TypeOf(dest).Elem()? */\n    err := rows.Scan(&amp;destRow)\n    if err != nil {\n      return err\n    }\n    dest = append(dest, destRow) /* would even compile? */\n  }\n  return nil\n}\n</code></pre>\n\n<p>It does not look like much different from what <code>json.Unmarshal</code> have to do actually...</p>\n"}, {"tags": ["python", "api", "go", "graphql"], "answers": [{"comments": [{"owner": {"reputation": 697, "user_id": 10596363, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kCzsM9B7TVo/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbA3rrBiuH8iM-UpkyXPeiW01IIsJA/mo/photo.jpg?sz=128", "display_name": "GGG", "link": "https://stackoverflow.com/users/10596363/ggg"}, "edited": false, "score": 0, "creation_date": 1541576574, "post_id": 53173290, "comment_id": 93259951, "body": "Can you elaborate on your approach?  Should we create only one GraphQl server for all our back-end (Golang, Python), and talk to front-end via this server?"}, {"owner": {"reputation": 400, "user_id": 9518998, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aWyyW.jpg?s=128&g=1", "display_name": "David Mraz", "link": "https://stackoverflow.com/users/9518998/david-mraz"}, "reply_to_user": {"reputation": 697, "user_id": 10596363, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kCzsM9B7TVo/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbA3rrBiuH8iM-UpkyXPeiW01IIsJA/mo/photo.jpg?sz=128", "display_name": "GGG", "link": "https://stackoverflow.com/users/10596363/ggg"}, "edited": false, "score": 0, "creation_date": 1541598928, "post_id": 53173290, "comment_id": 93270506, "body": "yeah sure, you can take a look for example at the image in this article <a href=\"https://labs.getninjas.com.br/sharing-data-in-a-microservices-architecture-using-graphql-97db59357602\" rel=\"nofollow noreferrer\">labs.getninjas.com.br/&hellip;</a>. Usually they recommend having microservices also with GraphQL and perform schema stiching in GraphQL gateway.I do not think that it is ideal as with schema stitching there are problem to do optimal GraphQL schema design. I usually prefer to do microservices to GraphQL communciation with protocol buffers GRPc or in your case, i think that at first phase REST is enough. Then you will have GraphQL server only as API gateway."}, {"owner": {"reputation": 400, "user_id": 9518998, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aWyyW.jpg?s=128&g=1", "display_name": "David Mraz", "link": "https://stackoverflow.com/users/9518998/david-mraz"}, "reply_to_user": {"reputation": 697, "user_id": 10596363, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kCzsM9B7TVo/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbA3rrBiuH8iM-UpkyXPeiW01IIsJA/mo/photo.jpg?sz=128", "display_name": "GGG", "link": "https://stackoverflow.com/users/10596363/ggg"}, "edited": false, "score": 0, "creation_date": 1541599152, "post_id": 53173290, "comment_id": 93270605, "body": "as for the frontend communication, yes you will communicate just directly to graphql gateway and additional communication to microservices is then performed from gateway"}], "tags": [], "owner": {"reputation": 400, "user_id": 9518998, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aWyyW.jpg?s=128&g=1", "display_name": "David Mraz", "link": "https://stackoverflow.com/users/9518998/david-mraz"}, "is_accepted": true, "score": 2, "last_activity_date": 1541512280, "creation_date": 1541512280, "answer_id": 53173290, "question_id": 53159897, "link": "https://stackoverflow.com/questions/53159897/how-to-create-graphql-server-for-microservices/53173290#53173290", "title": "How to create Graphql server for microservices?", "body": "<p>I do not know much details about your services, but great pattern I successfully used on different projects is as you mentioned <code>GraphQL gateway</code>. </p>\n\n<p>You will create one service, I prefer to create it in Node.js where all requests from frontend will coming through. Then from <code>GraphQL gateway</code> you will request your microservices. This will be basically your only entry point into the backend system. Requests will be authenticated and you are able to unify access to your data and perform also some performance optimizations like implementing data loader's caching and batching to mitigate N+1 problem. In addition you will reduce complexity of having multiple APIs and leverage all the GraphQL benefits. \nOn my last project we had 7 different frontends and each was using the same <code>GraphQL gateway</code> and I was really happy with our approach. There are definitely some downsides as you need to keep in sync all your frontends and <code>GraphQL gateway</code>, therefore you need to be more aware of your breaking changes, but it is solvable with for example <code>deprecated</code> directive and by performing blue/green deployment with Kubernetes cluster. </p>\n\n<p>The other option is to create the so-called backend for frontend in GraphQL. Right now I do not have enough information which solution would be best for you. You need to decide based on your frontend needs and business domain, but usually I prefer GraphQL gateway as GraphQL has great flexibility and the need to taylor your API to frontend is covered by GraphQL capabilities. Hope it helps David</p>\n"}], "owner": {"reputation": 697, "user_id": 10596363, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kCzsM9B7TVo/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbA3rrBiuH8iM-UpkyXPeiW01IIsJA/mo/photo.jpg?sz=128", "display_name": "GGG", "link": "https://stackoverflow.com/users/10596363/ggg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 668, "favorite_count": 0, "accepted_answer_id": 53173290, "answer_count": 1, "score": 2, "last_activity_date": 1541512280, "creation_date": 1541441463, "question_id": 53159897, "link": "https://stackoverflow.com/questions/53159897/how-to-create-graphql-server-for-microservices", "title": "How to create Graphql server for microservices?", "body": "<p>We have several microservices on Golang and Python, On Golang we are writing finance operations and on Python online store logic, we want to create one API for our front-end and we don't know how to do it.\nI have read about API gateway and would it be right if Golang will create its own GraphQL server, Python will create another one and they both will communicate with the third graphql server which will generate API for out front-end.</p>\n"}, {"tags": ["oracle", "go", "oracle9i"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 5044542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae6b07d6ec34f945f4e402e0f82802c9?s=128&d=identicon&r=PG&f=1", "display_name": "sideways", "link": "https://stackoverflow.com/users/5044542/sideways"}, "edited": false, "score": 0, "creation_date": 1541446072, "post_id": 53160610, "comment_id": 93212166, "body": "The version is 9.2.0.7 . I&#39;ve since tried using the 64 bit version of 11.2 and I keep getting a <code>Error connecting to the database: driver: bad connection</code> so I&#39;m assuming that I&#39;ll need to go lower than 11.2 and try out 10.2 and pray it works."}, {"owner": {"reputation": 38299, "user_id": 3027266, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3249486ec6096e443cb8e93489fe0a09?s=128&d=identicon&r=PG&f=1", "display_name": "Wernfried Domscheit", "link": "https://stackoverflow.com/users/3027266/wernfried-domscheit"}, "reply_to_user": {"reputation": 23, "user_id": 5044542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae6b07d6ec34f945f4e402e0f82802c9?s=128&d=identicon&r=PG&f=1", "display_name": "sideways", "link": "https://stackoverflow.com/users/5044542/sideways"}, "edited": false, "score": 0, "creation_date": 1541452256, "post_id": 53160610, "comment_id": 93214910, "body": "What about a database upgrade?"}, {"owner": {"reputation": 23, "user_id": 5044542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae6b07d6ec34f945f4e402e0f82802c9?s=128&d=identicon&r=PG&f=1", "display_name": "sideways", "link": "https://stackoverflow.com/users/5044542/sideways"}, "edited": false, "score": 0, "creation_date": 1541496468, "post_id": 53160610, "comment_id": 93227757, "body": "This is in the works, but is the long-term solution. I was hoping for a quick way to engage with it, but I&#39;ll have to turn to an older language like PHP or Python. After your comment and my final digging in the evening, I believe that no Go package supports Oracle 10.2 Client version.  Thank you for the help and reading through my struggles."}], "tags": [], "owner": {"reputation": 38299, "user_id": 3027266, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3249486ec6096e443cb8e93489fe0a09?s=128&d=identicon&r=PG&f=1", "display_name": "Wernfried Domscheit", "link": "https://stackoverflow.com/users/3027266/wernfried-domscheit"}, "is_accepted": true, "score": 1, "last_activity_date": 1541444748, "creation_date": 1541444748, "answer_id": 53160610, "question_id": 53158732, "link": "https://stackoverflow.com/questions/53158732/go-lang-connect-to-oracle-9i-using-go-oci8/53160610#53160610", "title": "Go lang connect to Oracle 9i (using go-oci8)", "body": "<p>The architecture of the Oracle Client have to match so architecture of your application. I.e. if your Go Lang is 64-bit then the Oracle Client have to be also 64-bit. It does not matter whether the database is 32 or 64-bit. </p>\n\n<p>I think the main problem is, you cannot connect with an Oracle 11.2 Client to a (20 years old!) Oracle 9i database. </p>\n\n<p>Check <a href=\"https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=138710094513777&amp;id=207303.1&amp;_afrWindowMode=0&amp;_adf.ctrl-state=yoihn9em0_4\" rel=\"nofollow noreferrer\">Client / Server Interoperability Support Matrix for Different Oracle Versions (Doc ID 207303.1)</a> for details.</p>\n\n<p>It says:</p>\n\n<blockquote>\n  <p>For connections between 10.2 (or higher) and 9.2 the 9.2 end MUST be\n  at 9.2.0.4 or higher. Connections between 10.2 (or higher) and\n  9.2.0.1, 9.2.0.2 or 9.2.0.3 have never been supported.</p>\n</blockquote>\n\n<p>You did not tell us which version of \"Oracle 9i\" your ar using.</p>\n"}], "owner": {"reputation": 23, "user_id": 5044542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae6b07d6ec34f945f4e402e0f82802c9?s=128&d=identicon&r=PG&f=1", "display_name": "sideways", "link": "https://stackoverflow.com/users/5044542/sideways"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 541, "favorite_count": 0, "accepted_answer_id": 53160610, "answer_count": 1, "score": 0, "last_activity_date": 1541503628, "creation_date": 1541436617, "last_edit_date": 1541503628, "question_id": 53158732, "link": "https://stackoverflow.com/questions/53158732/go-lang-connect-to-oracle-9i-using-go-oci8", "title": "Go lang connect to Oracle 9i (using go-oci8)", "body": "<p>I have a 32 bit Oracle DB (version 9i - 9.2.0.7.0), a 64 bit Mac and am trying to connect to it using <a href=\"https://github.com/mattn/go-oci8\" rel=\"nofollow noreferrer\">go-oci8</a> with Go Lang (version go1.11.1 darwin/amd64).</p>\n\n<p>I used SQL-Developer <a href=\"https://www.oracle.com/technetwork/developer-tools/sql-developer/downloads/sqldev-downloads-403-2292439.html\" rel=\"nofollow noreferrer\">4.0.2</a> to successfully connect to the DB and then enabled InstantClient connection through it using <a href=\"https://www.thatjeffsmith.com/archive/2014/01/oracle-sql-developer-4-and-the-oracle-client/\" rel=\"nofollow noreferrer\">this</a> tutorial. So I've got things running from the Oracle Client's side.</p>\n\n<p>I'm using InstantClient Version 11.2.0.4.0 (32-bit) for MacOS (basic and SDK), I've used mainly <a href=\"https://gocodecloud.com/blog/2016/08/09/accessing-an-oracle-db-in-go/\" rel=\"nofollow noreferrer\">this</a> tutorial almost successfully. After everything, the error I'm getting is: </p>\n\n<p><code>github.com/mattn/go-oci8 ld: warning: ignoring file /Users/myusername/Downloads/instantclient_11_2/libclntsh.dylib, file was built for i386 which is not the architecture being linked (x86_64): /Users/myusername/Downloads/instantclient_11_2/libclntsh.dylib Undefined symbols for architecture x86_64:\n</code></p>\n\n<p>And then a long stack of symbols. Basically the Go oci8 library is trying to use C (which is 64 bit) and tries to build 64 bit files, which will then be used by Go. If I try with the 64 bit version of InstantClient, I have no problems, but I get a \"driver: bad connection\" error which is because 64bit won't work to connect some reason.</p>\n\n<p>I have no idea what to do to resole this issue - can I somehow force the build of 32 bit files while using <code>go get -u -v github.com/mattn/go-oci8</code>? Or somehow make the 64 bit InstantClient version connect to the old 32 bit Oracle DB?</p>\n\n<p>Any kind of help on how to get this running would be much appreciated.</p>\n\n<p>Edit: I've tried 10.2 Oracle Client, but I can't connect it with go-oci8 (I'm assuming it doesn't support it). The error I get is <code>../github.com/mattn/go-oci8/oci8.go:113:25: could not determine kind of name for C.OCI_SYSASM</code></p>\n\n<p><strong>Final edit for people who have the same problem</strong> (coming on to a very old Oracle Database) - you can't interface with the readily provided solutions using Go. The libraries listed to work with Oracle operate with Client versions 11.2 and up.</p>\n"}, {"tags": ["go", "command-line", "command-line-interface", "go-cobra"], "comments": [{"owner": {"reputation": 1011, "user_id": 722955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20f47acfd4f247064e5ec44fc15dd9dc?s=128&d=identicon&r=PG", "display_name": "Devin", "link": "https://stackoverflow.com/users/722955/devin"}, "edited": false, "score": 1, "creation_date": 1541439207, "post_id": 53158302, "comment_id": 93209200, "body": "One way is to write the error using the <code>os</code> package via <code>os.Stderr.WriteString(err)</code> instead of doing <code>fmt.Println(err)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 4783, "user_id": 2939061, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NoM9S.gif?s=128&g=1", "display_name": "quasoft", "link": "https://stackoverflow.com/users/2939061/quasoft"}, "is_accepted": true, "score": 0, "last_activity_date": 1541444431, "creation_date": 1541444431, "answer_id": 53160533, "question_id": 53158302, "link": "https://stackoverflow.com/questions/53158302/go-run-cli-command-with-wrong-args/53160533#53160533", "title": "GO: Run cli command with wrong args", "body": "<p>Your sample already prints the error both to <code>stdout</code> and <code>stderr</code>.</p>\n\n<p>By default the <code>cobra</code> package prints any errors it encounters to <code>stderr</code>, unless you specifically change that.</p>\n\n<p>So running \n<code>./main provide apps something 2&gt; ./stderr.txt</code> creates a text file with the following content (this is what cobra writes to <code>stderr</code> without your intervention):</p>\n\n<pre><code>Error: app name doesnt exist\n</code></pre>\n\n<p>And running <code>./main provide apps something &gt; ./stdout.txt</code> - creates a text file with the following content (you printed that yourself with <code>fmt.Println(err)</code>, the second line from the bottom in your code):</p>\n\n<pre><code>app name doesnt exist\n</code></pre>\n\n<p>Which means <strong>default behaviour prints errors both to <code>stdout</code> and <code>stderr</code></strong>.</p>\n\n<p>As Devin has advised you, changing the last line to <code>os.Stderr.WriteString(err)</code> or\n<code>fmt.Fprintln(os.Stderr, err)</code> (the one I would use) will make your project to  <strong>print everything to <code>stderr</code> only</strong>, which means printing errors twice:</p>\n\n<pre><code>Error: app name doesnt exist\napp name doesnt exist\n</code></pre>\n\n<p>It might be useful to know that cobra allows you some control of error printing behaviour. For example, you can tell a cobra command which stream to print to:</p>\n\n<pre><code>command.SetOutput(os.Stdout)     // Defaults to os.Stderr\n</code></pre>\n\n<p>you could also prevent printing of errors:</p>\n\n<pre><code>command.SilenceErrors = true\n</code></pre>\n\n<p>or prevent printing of usage text:</p>\n\n<pre><code>command.SilenceUsage = true\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 727, "favorite_count": 0, "accepted_answer_id": 53160533, "answer_count": 1, "score": 2, "last_activity_date": 1541444431, "creation_date": 1541434933, "last_edit_date": 1541435350, "question_id": 53158302, "link": "https://stackoverflow.com/questions/53158302/go-run-cli-command-with-wrong-args", "title": "GO: Run cli command with wrong args", "body": "<p>I use cobra to create CLI command tool.\neverything is looking OK except the error handling</p>\n\n<p>what I want that if command was sent by mistake (wrong args or wrong input) return <strong>std.err</strong> instead of <strong>std.out</strong></p>\n\n<p>to simplify the secnario I've created this which demonstrate my use-case</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"os\"\n\n    \"github.com/spf13/cobra\"\n)\n\nvar (\n    RootCmd = &amp;cobra.Command{\n        Use: \"myApp\",\n        Run: func(cmd *cobra.Command, args []string) {\n            fmt.Printf(\"ROOT verbose = %d, args = %v\\n\", args)\n        },\n    }\n\n    provideCmd = &amp;cobra.Command{\n        Use: \"provide\",\n        Run: nil,\n    }\n\n    appCmd = &amp;cobra.Command{\n        Use: \"apps\",\n        RunE: func(cmd *cobra.Command, args []string) error {\n            name := args[0]\n            if name != \"myapp\" {\n                err := errors.New(\"app name doesnt exist\")\n                return err\n            }\n            return nil\n        },\n        SilenceUsage:               true,\n    }\n\n\n)\n\nfunc init() {\n    // Add the application command to app command\n    provideCmd.AddCommand(appCmd)\n    //  add provide command to root command\n    RootCmd.AddCommand(provideCmd)\n}\n\nfunc main() {\n    if err := RootCmd.Execute(); err != nil {\n        fmt.Println(err)\n        os.Exit(-1)\n    }\n}\n</code></pre>\n\n<p>Now if I compile the binary and run <code>exec.Command</code> against the binary everything is working as expected. but if I want to test the error scenario like <code>mycli provide apps apps1</code>\nI want to see that returned in <code>std.err</code> and not at <code>std.out</code></p>\n\n<p>When I execute <code>mycli provide apps myapp</code> everything should be OK</p>\n\n<p>but if I run <code>mycli provide apps myapp2</code> I want to get std.err and not std.out , which is not the case here ...what am I missing here ? </p>\n\n<p><a href=\"https://play.golang.org/p/B00z4eZ7Sj-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/B00z4eZ7Sj-</a></p>\n"}, {"tags": ["go", "prometheus"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1541432243, "post_id": 53156150, "comment_id": 93205504, "body": "This isn&#39;t possible in Prometheus. All measurements of a single metric must have the same label set."}, {"owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1541433210, "post_id": 53156150, "comment_id": 93206044, "body": "Hm it&#39;s a pity. They would be the same everywhere, but I don&#39;t know their name and values before runtime."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1541450278, "post_id": 53156150, "comment_id": 93214073, "body": "In that case you can implement the <a href=\"https://godoc.org/github.com/prometheus/client_golang/prometheus#Collector\" rel=\"nofollow noreferrer\">Collector interface</a> yourself (take a look at the example to get started). Note that if the labels do change unexpectedly this will result in scrape errors."}], "owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3840, "favorite_count": 1, "answer_count": 0, "score": 5, "last_activity_date": 1541427359, "creation_date": 1541427359, "question_id": 53156150, "link": "https://stackoverflow.com/questions/53156150/dynamic-prometheus-labels-in-gauge", "title": "Dynamic prometheus labels in Gauge", "body": "<p>I wonder if/how it's possible to add dynamic labels. I don't know the key or the quantity of the labels which I would like to add to my gauge values.</p>\n\n<p><strong>What I tried</strong></p>\n\n<pre><code>labelsContainers = []string{\"node\", \"container\", \"pod\", \"qos\", \"namespace\", \"nodepool\"}\n\n// Requested resources\nrequestedContainerCPUCoresGauge = prometheus.NewGaugeVec(\n    prometheus.GaugeOpts{\n        Namespace: namespace,\n        Subsystem: \"pod_container_resource_requests\",\n        Name:      \"cpu_cores\",\n        Help:      \"Requested CPU cores in Kubernetes configuration\",\n    },\n    labelsContainers)\n\nfor _, containerMetric := range containerMetrics {\n    containerLabels := prometheus.Labels{\n        \"node\":      containerMetric.Node,\n        \"container\": containerMetric.Container,\n        \"qos\":       containerMetric.Qos,\n        \"pod\":       containerMetric.Pod,\n        \"namespace\": containerMetric.Namespace,\n    }\n\n    for key, value := range containerMetric.NodeLabels {\n        containerLabels[key] = value\n    }\n\n    requestedContainerCPUCoresGauge.With(containerLabels).Set(containerMetric.RequestedCPUCores)\n    requestedContainerRAMBytesGauge.With(containerLabels).Set(containerMetric.RequestedMemoryBytes)\n}\n</code></pre>\n\n<p><strong>The problem</strong></p>\n\n<p>This throws a panic. I assume this is because the prom client expects exactly those labels defined in <code>labelsContainers</code> and doesn't allow further labels. How can I create a gauge which allows additional (unknown) labels?</p>\n"}, {"tags": ["node.js", "go", "vue.js", "webpack"], "comments": [{"owner": {"reputation": 17307, "user_id": 1814486, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/G0mb9.png?s=128&g=1", "display_name": "nicholaswmin", "link": "https://stackoverflow.com/users/1814486/nicholaswmin"}, "edited": false, "score": 2, "creation_date": 1541426791, "post_id": 53155638, "comment_id": 93202254, "body": "I&#39;m not sure how Vue does it, but in other JS frameworks, <code>build</code> commands are only executed <i>only</i> before you deploy to production. When developing locally you don&#39;t really need minification etc..."}], "answers": [{"tags": [], "owner": {"reputation": 56, "user_id": 7205697, "user_type": "registered", "profile_image": "https://graph.facebook.com/1316848535027102/picture?type=large", "display_name": "Polski Max", "link": "https://stackoverflow.com/users/7205697/polski-max"}, "is_accepted": false, "score": 0, "last_activity_date": 1541425804, "creation_date": 1541425804, "answer_id": 53155721, "question_id": 53155638, "link": "https://stackoverflow.com/questions/53155638/applying-changes-for-vue-application-executed-by-go/53155721#53155721", "title": "Applying changes for vue application executed by GO", "body": "<p>You can use vue with any backend. Seems like FileServer or your browser caches your static files. You could use <code>Cache-Control: no-cache</code> header to avoid caching.</p>\n"}, {"tags": [], "owner": {"reputation": 449, "user_id": 1914351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d268c84819e83e2f62b5f9db34cebfb?s=128&d=identicon&r=PG", "display_name": "Jeff Collier", "link": "https://stackoverflow.com/users/1914351/jeff-collier"}, "is_accepted": false, "score": 0, "last_activity_date": 1550333691, "creation_date": 1550333691, "answer_id": 54725058, "question_id": 53155638, "link": "https://stackoverflow.com/questions/53155638/applying-changes-for-vue-application-executed-by-go/54725058#54725058", "title": "Applying changes for vue application executed by GO", "body": "<p>The .vue source files must be processed in order to be served as HTML by a web server. You cannot modify .vue files and expect to see the changes in a web browser running against a production web server. As such, after modifications you must run <code>npm run build</code> which will process the .vue files and generate valid HTML files into <code>/dist</code>.</p>\n\n<p>Now reviewing your code, I see that you could further simplify it by doing this:</p>\n\n<pre><code>func main() {\n    http.Handle(\"/static\", http.FileServer(http.Dir(\"web-vue/dist/\")))\n    http.Handle(\"/\", http.FileServer(http.Dir(\"web-vue/dist/\")))\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n"}], "owner": {"reputation": 90, "user_id": 9817281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/629721572567e2fe2f734f7b90b5d477?s=128&d=identicon&r=PG&f=1", "display_name": "Sergey Gornostaev", "link": "https://stackoverflow.com/users/9817281/sergey-gornostaev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 151, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1550333691, "creation_date": 1541425522, "last_edit_date": 1541426593, "question_id": 53155638, "link": "https://stackoverflow.com/questions/53155638/applying-changes-for-vue-application-executed-by-go", "title": "Applying changes for vue application executed by GO", "body": "<p>I used Go to create a very simple web app wich only one web page. In this project I used Vue CLI to install webpack. If I run vue application by npm, all is fine and work perfect, but I want get ability work with vue when i run go web app. For this I builded vue-project by npm 'npm run build' and get dist directory, after that in go application I wrote something like this:</p>\n\n<pre><code>func main() {\n    http.Handle(\"/static/\", http.FileServer(http.Dir(\"web-vue/dist\")))\n\n    http.HandleFunc(\"/\", HomePage)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc HomePage(w http.ResponseWriter, r *http.Request){\n    t, err := template.ParseFiles(\"web-vue/dist/index.html\")\n    if err != nil {\n        log.Print(\"template parsing error: \", err)\n    }\n    err = t.Execute(w,\"SerGorn\")\n    if err != nil {\n        log.Print(\"template executing error: \", err)\n    }\n}\n</code></pre>\n\n<p>It's work fine with one exception, when I change .vue file, for applying this changes, needs rebuild app by npm again. How I could solve this problem? Any Idea?  Or may be it's wrong way and better if work with vue will be in only node.js?</p>\n"}, {"tags": ["go", "graphql", "twirp"], "comments": [{"owner": {"reputation": 3751, "user_id": 6792646, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/90c3356d59254bbb5b4464ee3524294e?s=128&d=identicon&r=PG", "display_name": "Daksh Miglani", "link": "https://stackoverflow.com/users/6792646/daksh-miglani"}, "edited": false, "score": 0, "creation_date": 1541424453, "post_id": 53154709, "comment_id": 93200937, "body": "graphql is json over http. rpc is a different paradigm. But you can always build an api wrapper over an rpc framework."}, {"owner": {"reputation": 697, "user_id": 10596363, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kCzsM9B7TVo/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbA3rrBiuH8iM-UpkyXPeiW01IIsJA/mo/photo.jpg?sz=128", "display_name": "GGG", "link": "https://stackoverflow.com/users/10596363/ggg"}, "reply_to_user": {"reputation": 3751, "user_id": 6792646, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/90c3356d59254bbb5b4464ee3524294e?s=128&d=identicon&r=PG", "display_name": "Daksh Miglani", "link": "https://stackoverflow.com/users/6792646/daksh-miglani"}, "edited": false, "score": 0, "creation_date": 1541425214, "post_id": 53154709, "comment_id": 93201348, "body": "@DakshMiglani should I create a second graphql API to work with twirp API? Is it hard to do ?"}, {"owner": {"reputation": 3751, "user_id": 6792646, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/90c3356d59254bbb5b4464ee3524294e?s=128&d=identicon&r=PG", "display_name": "Daksh Miglani", "link": "https://stackoverflow.com/users/6792646/daksh-miglani"}, "edited": false, "score": 0, "creation_date": 1541428390, "post_id": 53154709, "comment_id": 93203188, "body": "yeah. Make a graphql api and use twirp in the resolvers to fetch the data and all."}, {"owner": {"reputation": 3751, "user_id": 6792646, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/90c3356d59254bbb5b4464ee3524294e?s=128&d=identicon&r=PG", "display_name": "Daksh Miglani", "link": "https://stackoverflow.com/users/6792646/daksh-miglani"}, "edited": false, "score": 0, "creation_date": 1541428413, "post_id": 53154709, "comment_id": 93203200, "body": "read this article: <a href=\"https://graphql.org/blog/rest-api-graphql-wrapper/\" rel=\"nofollow noreferrer\">graphql.org/blog/rest-api-graphql-wrapper</a>"}, {"owner": {"reputation": 697, "user_id": 10596363, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kCzsM9B7TVo/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbA3rrBiuH8iM-UpkyXPeiW01IIsJA/mo/photo.jpg?sz=128", "display_name": "GGG", "link": "https://stackoverflow.com/users/10596363/ggg"}, "reply_to_user": {"reputation": 3751, "user_id": 6792646, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/90c3356d59254bbb5b4464ee3524294e?s=128&d=identicon&r=PG", "display_name": "Daksh Miglani", "link": "https://stackoverflow.com/users/6792646/daksh-miglani"}, "edited": false, "score": 0, "creation_date": 1541441501, "post_id": 53154709, "comment_id": 93210219, "body": "@DakshMiglani Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 3751, "user_id": 6792646, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/90c3356d59254bbb5b4464ee3524294e?s=128&d=identicon&r=PG", "display_name": "Daksh Miglani", "link": "https://stackoverflow.com/users/6792646/daksh-miglani"}, "is_accepted": true, "score": 1, "last_activity_date": 1541442093, "creation_date": 1541442093, "answer_id": 53160033, "question_id": 53154709, "link": "https://stackoverflow.com/questions/53154709/is-it-possible-to-use-graphql-with-twirp-rpc-framework-by-twitch/53160033#53160033", "title": "Is it possible to use GraphQL with Twirp RPC framework by Twitch", "body": "<h1>It is definitely possible.</h1>\n\n<p>You Just have to make a wrapper over the Twirp based RPC API.</p>\n\n<p>This is a similar case to wrapping a GraphQL API over a Rest API.</p>\n\n<p>You should also <a href=\"https://graphql.org/blog/rest-api-graphql-wrapper/\" rel=\"nofollow noreferrer\">read this article</a>, where the wrapping of a graphql api over a rest one is shown.</p>\n"}], "owner": {"reputation": 697, "user_id": 10596363, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kCzsM9B7TVo/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbA3rrBiuH8iM-UpkyXPeiW01IIsJA/mo/photo.jpg?sz=128", "display_name": "GGG", "link": "https://stackoverflow.com/users/10596363/ggg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 53160033, "answer_count": 1, "score": 1, "last_activity_date": 1541442093, "creation_date": 1541421895, "question_id": 53154709, "link": "https://stackoverflow.com/questions/53154709/is-it-possible-to-use-graphql-with-twirp-rpc-framework-by-twitch", "title": "Is it possible to use GraphQL with Twirp RPC framework by Twitch", "body": "<p>I have a Golang program working with Twirp and I want to create GraphQl server, but as far as I know, twirp build on top of the Rest API </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1541422476, "post_id": 53154437, "comment_id": 93199898, "body": "Do <b>not</b> set GOROOT! And make sure you actually have $GOPATH/src and your bashrc is actually read."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 1, "creation_date": 1541423312, "post_id": 53154437, "comment_id": 93200313, "body": "@samrat_shakya Can you put the result of <code>$ go env</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 1, "last_activity_date": 1541425619, "creation_date": 1541425619, "answer_id": 53155668, "question_id": 53154437, "link": "https://stackoverflow.com/questions/53154437/gopath-is-looking-into-different-path/53155668#53155668", "title": "GOPATH is looking into different path", "body": "<p>Probably should have</p>\n\n<pre><code>export GOPATH=/home/user/go\n\nexport PATH=$GOPATH/bin:$PATH\n</code></pre>\n\n<ul>\n<li>don't use GOROOT at all (do <code>unset GOROOT</code> just to be safe )</li>\n<li>pkg is below GOPATH</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": false, "score": 1, "last_activity_date": 1541479298, "last_edit_date": 1541479298, "creation_date": 1541478676, "answer_id": 53165767, "question_id": 53154437, "link": "https://stackoverflow.com/questions/53154437/gopath-is-looking-into-different-path/53165767#53165767", "title": "GOPATH is looking into different path", "body": "<p>Run <code>$ go env</code> and check if the output contains the followings or not:</p>\n\n<ol>\n<li><code>GOPATH=\"/home/user/go\"</code></li>\n<li><code>GOROOT=\"/usr/local/go\"</code></li>\n</ol>\n\n<p>If not, then use like bellow in your <code>~/.bashrc</code> file</p>\n\n<pre><code>export GOPATH=$HOME/go\n# No need to set GOROOT since it is set /usr/local/go by default\nexport PATH=$GOPATH/bin:/usr/local/go/bin:$PATH\n</code></pre>\n\n<p>Now run <code>$ source ~/.bashrc</code> in bash. That's it.</p>\n"}], "owner": {"reputation": 115, "user_id": 8866182, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-gPLtFQmlXpc/AAAAAAAAAAI/AAAAAAAADxs/ZV5037NKyMg/photo.jpg?sz=128", "display_name": "samrat shakya", "link": "https://stackoverflow.com/users/8866182/samrat-shakya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1541479298, "creation_date": 1541420875, "question_id": 53154437, "link": "https://stackoverflow.com/questions/53154437/gopath-is-looking-into-different-path", "title": "GOPATH is looking into different path", "body": "<p>I have set GOPATH and GOROOT in ~/.bashrc as:</p>\n\n<p><code>export GOROOT=/usr/lib/go-1.10</code></p>\n\n<p><code>export GOPATH=/home/user/go/pkg</code></p>\n\n<p><code>export PATH=$PATH:$GOROOT/bin:$GOPATH/bin</code></p>\n\n<p>and whenever I try to build with go build main.go I am getting.</p>\n\n<blockquote>\n  <p>main.go:4:2: cannot find package \"google.golang.org/grpc/examples/grpcdemo/pb\" in any of:\n  /usr/lib/go-1.10/src/google.golang.org/grpc/examples/grpcdemo/pb (from $GOROOT)\n      /home/user/go/src/google.golang.org/grpc/examples/grpcdemo/pb (from $GOPATH)</p>\n</blockquote>\n\n<p>The question is why is looking inside <code>home/user/go/src</code> as I have set the GOPATH to <code>/home/user/go/pkg</code>. So, I have expected package  inside<code>/home/user/go/pkg/src/google.golang.org/grpc/examples/grpcdemo/pb</code>.\nShouldn't it be looking inside <code>/home/user/go/pkg</code>? </p>\n"}, {"tags": ["dictionary", "go", "prometheus"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1541421705, "last_edit_date": 1541421705, "creation_date": 1541421059, "answer_id": 53154488, "question_id": 53154432, "link": "https://stackoverflow.com/questions/53154432/dynamically-add-key-value-map-to-struct/53154488#53154488", "title": "Dynamically add key value map to struct", "body": "<p>You may use a simple <code>for range</code> loop on <code>labelsMap</code>, and add each pair, e.g.:</p>\n\n<pre><code>containerLabels := prometheus.Labels{}\nfor k, v := range labelsMap {\n    containerLabels[k] = v\n}\n</code></pre>\n\n<p>Or since <a href=\"https://godoc.org/github.com/prometheus/client_golang/prometheus#Labels\" rel=\"nofollow noreferrer\"><code>prometheus.Labels</code></a> is just a simple map:</p>\n\n<pre><code>type Labels map[string]string\n</code></pre>\n\n<p>And if you don't want to modify the <code>labelsMap</code> afterwards, a simple type <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a> also works:</p>\n\n<pre><code>containerLabels := prometheus.Labels(labelsMap)\n</code></pre>\n"}], "owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 559, "favorite_count": 0, "accepted_answer_id": 53154488, "answer_count": 1, "score": 1, "last_activity_date": 1541421705, "creation_date": 1541420856, "last_edit_date": 1541421659, "question_id": 53154432, "link": "https://stackoverflow.com/questions/53154432/dynamically-add-key-value-map-to-struct", "title": "Dynamically add key value map to struct", "body": "<p>I am trying to figure out how I can add the key value pairs of a <code>map[string]string</code> into my prometheus.Labels struct.</p>\n\n<p>If you've got experience with prometheus: I am trying to dynamically add labels and it's values.</p>\n\n<pre><code>labelsMap := make(map[string]string)\nlabelsMap[\"nodepool\"] = \"default\"\nlabelsMap[\"zone\"] = \"europe-west\"\n\n// here I'd like to add my key / value pairs from my map\ncontainerLabels := prometheus.Labels{\n    \"node\":      \"nodename\",\n    \"container\": \"foo\",\n    \"qos\":       \"bar\",\n}\nrequestedContainerCPUCoresGauge.With(containerLabels).Set(containerMetric.RequestedCPUCores)\n</code></pre>\n\n<p><strong>My question:</strong></p>\n\n<p>How can I dynamically add the key/value pairs from my given map <code>labelsMap</code> in my containerLabels?</p>\n"}, {"tags": ["go", "unicode", "encoding"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1541420498, "post_id": 53154264, "comment_id": 93198931, "body": "There is nothing to do here. You may freely use UTF-8 encoded urdu text in source. No &quot;encoding&quot; needed here. If you have a specific problem: Show code and what the code does and explain why you think this is wrong."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 4398653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yj8yP.png?s=128&g=1", "display_name": "veerg404", "link": "https://stackoverflow.com/users/4398653/veerg404"}, "edited": false, "score": 0, "creation_date": 1541423426, "post_id": 53154445, "comment_id": 93200386, "body": "thankyou for your response. I am having a little issue with printing the string in my console. Actually I want to write the desired output in a pdf but its not working. Its printing messy string. I tried to changed the format as per as the documentation (using %q and %s ) but still getting the messy output. Any solution for that?"}, {"owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 1, "creation_date": 1541425374, "post_id": 53154445, "comment_id": 93201451, "body": "If you are having problems with PDF output. that might be a limitation of the PDF package you are using (would have been useful to mention which one ;) ). For example <i>gofpdf</i> currently doesn&#39;t support UTF-8: &quot;Like FPDF version 1.7, from which gofpdf is derived, this package does not yet support UTF-8 fonts. In particular, languages that require more than one code page such as Chinese, Japanese, and Arabic are not currently supported. [...] However, support is provided to automatically translate UTF-8 runes to code page encodings for languages that have fewer than 256 glyphs.&quot;"}, {"owner": {"reputation": 81, "user_id": 4398653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yj8yP.png?s=128&g=1", "display_name": "veerg404", "link": "https://stackoverflow.com/users/4398653/veerg404"}, "reply_to_user": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 0, "creation_date": 1541425483, "post_id": 53154445, "comment_id": 93201505, "body": "@rob74 yes I am using gofpdf and thankyou for your response. It solved my problem :)"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1541422274, "last_edit_date": 1541422274, "creation_date": 1541420915, "answer_id": 53154445, "question_id": 53154264, "link": "https://stackoverflow.com/questions/53154264/encoding-of-urdu-text-in-go/53154445#53154445", "title": "encoding of Urdu text in Go", "body": "<p>Go uses UTF-8 encoding for the <code>string</code> type. Use <code>string</code> to convert a slice of UTF-8 encoded bytes (<code>[]byte</code>) to a UTF-8 encoded <code>string</code>. A <code>string</code> is a sequence of <code>byte</code>s; it is an immutable copy of the <code>byte</code> slice.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    username := `\u0627\u0628\u0648 \u0646\u0627\u0635\u0631 \u0627\u0644\u062d\u0631\u0633\u0627\u0646\u06cc`\n\n    userbytes := []byte(username)\n    fmt.Printf(\"%[1]T: %[1]v\\n\", userbytes)\n    userstring := string(userbytes)\n    fmt.Printf(\"%[1]T: %[1]v\\n\", userstring)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Ugwj-CxmQw0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Ugwj-CxmQw0</a></p>\n\n<p>Output:</p>\n\n<pre><code>[]uint8: [216 167 216 168 217 136 32 217 134 216 167 216 181 216 177 32 216 167 217 132 216 173 216 177 216 179 216 167 217 134 219 140]\nstring: \u0627\u0628\u0648 \u0646\u0627\u0635\u0631 \u0627\u0644\u062d\u0631\u0633\u0627\u0646\u06cc\n</code></pre>\n\n<p>Type <code>byte</code> is an alias of type <code>uint8</code>.</p>\n\n<hr>\n\n<p>The Go Blog: <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">Strings, bytes, runes and characters in Go</a></p>\n\n<p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n\n<p>Wikipedia: <a href=\"https://en.wikipedia.org/wiki/UTF-8\" rel=\"nofollow noreferrer\">UTF-8</a></p>\n\n<p>Unicode: <a href=\"http://unicode.org/faq/utf_bom.html\" rel=\"nofollow noreferrer\">UTF-8, UTF-16, UTF-32 &amp; BOM</a></p>\n\n<p><a href=\"http://unicode.org/\" rel=\"nofollow noreferrer\">The Unicode Consortium</a></p>\n"}], "owner": {"reputation": 81, "user_id": 4398653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yj8yP.png?s=128&g=1", "display_name": "veerg404", "link": "https://stackoverflow.com/users/4398653/veerg404"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 366, "favorite_count": 1, "closed_date": 1541449920, "accepted_answer_id": 53154445, "answer_count": 1, "score": -1, "last_activity_date": 1541422501, "creation_date": 1541420187, "last_edit_date": 1541422501, "question_id": 53154264, "link": "https://stackoverflow.com/questions/53154264/encoding-of-urdu-text-in-go", "closed_reason": "Not suitable for this site", "title": "encoding of Urdu text in Go", "body": "<p>I have Urdu text and I want to encode it in Go.</p>\n\n<p>A user name is like this</p>\n\n<pre><code>username := `\u0627\u0628\u0648 \u0646\u0627\u0635\u0631 \u0627\u0644\u062d\u0631\u0633\u0627\u0646\u06cc`\n</code></pre>\n\n<p>I read about the encoding package of Go but I'm not able to get my desired result. I want to read all the bytes and a string equivalent encoded value of this variable.</p>\n"}, {"tags": ["pointers", "go", "struct", "reflection"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541420247, "post_id": 53154133, "comment_id": 93198822, "body": "Your question makes no sense. You <b>asked</b> for a pointer, you got one. If you want the value call <code>Interface()</code> on the reflect.Value."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541420328, "post_id": 53154133, "comment_id": 93198855, "body": "To clarify: The Pointer method returns you a &quot;pointer to what you have&quot;. If you have a *TableMeta you get a **TableMeta. If you want the value back: Interface() and type assert."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541420427, "post_id": 53154133, "comment_id": 93198899, "body": "In your last example, <code>info</code> is of type <code>*BookInfo</code>, so why are you attempting to get <code>*TableMeta</code> out of its <code>reflect.Value</code> wrapper? Obtain <code>*BookInfo</code> from it, then you can refer to its <code>Meta</code> field which will be of type <code>*TableMeta</code>. Same goes for the <code>getTabInfo()</code> function."}, {"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541421015, "post_id": 53154133, "comment_id": 93199191, "body": "@icza the address of first field of struct and the address of struct is same.I tried it\uff0cit works"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541421297, "post_id": 53154133, "comment_id": 93199319, "body": "@wangjun Posted an answer to explain it."}, {"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541421499, "post_id": 53154133, "comment_id": 93199428, "body": "@Volker I am learning English while learning programming. I am not good at it. Thanks for your comment\uff0cI think i understand it. But if Pointer() return the address of value, I think the document of reflect is not exactly."}], "answers": [{"comments": [{"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1541424125, "post_id": 53154580, "comment_id": 93200757, "body": "Yes, you are right. I made a figure, found the first field value is the address of TableMeta in heap. Thanks a lot"}, {"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1541425477, "post_id": 53154580, "comment_id": 93201500, "body": "I want writ my own ORM package. I don\u2019t want use reflect every query.so I make a cache to store model fields information when model first query. But when using field alone without model, I cannot get the database name nor table name, except store them to every field. So I want to use field offset to get the model meta data, the first field of each model must be a \u2018*TableMeta\u2019,so I only need store offset of field, when I want get the meta data, sub the offset of field from the address of field, then I get the model address, at the same time, get the meta data"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1541425665, "post_id": 53154580, "comment_id": 93201599, "body": "@wangjun There are other ways that don&#39;t involve relying on this. E.g. you can use <a href=\"https://golang.org/pkg/reflect/#Value.FieldByName\" rel=\"nofollow noreferrer\"><code>Value.FieldByName()</code></a> to get a field by its string name."}, {"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1541426659, "post_id": 53154580, "comment_id": 93202187, "body": "If I only pass a field to some function, I can\u2019t get the field name, because it is only a Field type, though it must be in a model. I defined some methods and interfaces to implement it in first version which not use reflect. But in that version the model definition is a little complex. So I want change it. But reflect is too slow, so I want to use it as less as needed. So I introduced unsafe. Forgive my poor English, I tried my best to explain clearly"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1541421754, "last_edit_date": 1541421754, "creation_date": 1541421421, "answer_id": 53154580, "question_id": 53154133, "link": "https://stackoverflow.com/questions/53154133/reflect-pointer-returned-value-is-not-the-value-address/53154580#53154580", "title": "reflect.Pointer() returned value is not the value address", "body": "<p>The value you have is a pointer to a <code>BookInfo</code> struct, it is of type <code>*BookInfo</code>. And the type of <code>BookInfo.Meta</code> field is also a pointer, it is of type <code>*TableMeta</code>, thus a <code>*BookInfo</code> can then be looked at as <code>**TableMeta</code>, hence the \"double\" pointer.</p>\n\n<p>It's true that the struct pointer points to its first field, but don't build on it. It's fragile. If you add a field before it, it'll break badly (which will only happen at runtime, no compile time messages due to package <code>unsafe</code>).</p>\n\n<p>So if the value is of type <code>*BookInfo</code>, simply obtain that out of the <code>reflect.Value</code> wrapper, then you can refer to its field like <code>value.Meta</code>, which will be of type <code>*TableMeta</code>. Avoid using package <code>unsafe</code>, especially if it's not needed.</p>\n"}], "owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 329, "favorite_count": 0, "accepted_answer_id": 53154580, "answer_count": 1, "score": 0, "last_activity_date": 1541421827, "creation_date": 1541419699, "last_edit_date": 1541421827, "question_id": 53154133, "link": "https://stackoverflow.com/questions/53154133/reflect-pointer-returned-value-is-not-the-value-address", "title": "reflect.Pointer() returned value is not the value address", "body": "<pre><code>type BookInfo struct {\n    Meta         *TableMeta\n    ...\n}\n\nfunc (si *schemaInfo) getTabInfo(obj interface{}) (*tabInfo, error) {\n    typ := reflect.TypeOf(obj)\n    val := reflect.ValueOf(obj)\n    if typ.Kind() != reflect.Ptr {\n        return nil, errors.New(\"nborm.schemaInfo.getDBInfo() error: required a pointer\")\n    }\n    meta := *(**TableMeta)(unsafe.Pointer(val.Pointer()))\n    ...\n }\n</code></pre>\n\n<p><code>getTabInfo()</code> works well, but I want to know why <code>val.Pointer()</code> return a value of <code>**TableMeta</code>? Why not a <code>*TableMeta</code>?The document of <code>reflect</code> says, </p>\n\n<blockquote>\n  <p>Pointer returns v's value as a uintptr. It returns uintptr instead of\n  unsafe.Pointer so that code using reflect cannot obtain\n  unsafe.Pointers without importing the unsafe package explicitly. It\n  panics if v's Kind is not Chan, Func, Map, Ptr, Slice, or\n  UnsafePointer.</p>\n</blockquote>\n\n<p>In my mind:</p>\n\n<pre><code>info := &amp;BookInfo{}\nval := reflect.ValueOf(info)\nptr := val.Pointer()\nmeta := (*TableMeta)(unsafe.Pointer(val.Pointer()))\n</code></pre>\n\n<p>should work, but infact when I called <code>val.Pointer()</code>, the returned value is the pointer of <code>*TableMeta</code>(<code>**TableMeta</code>).</p>\n"}, {"tags": ["go", "diffie-hellman"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1541424086, "post_id": 53153749, "comment_id": 93200732, "body": "You may as well just exec.Command it in a goroutine. This process may take several minutes, perhaps even an hour on a slow system. And it&#39;s not possible to predict how long it runs."}], "owner": {"reputation": 29, "user_id": 10423885, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mzZn8oDKmbE/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUpT_ip2v46RxAE3iI8jT7pOVy-jw/mo/photo.jpg?sz=128", "display_name": "Adam", "link": "https://stackoverflow.com/users/10423885/adam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 553, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1541418277, "creation_date": 1541418277, "question_id": 53153749, "link": "https://stackoverflow.com/questions/53153749/how-to-generate-diffie-hellman-parameters-in-golang", "title": "How to generate Diffie-Hellman parameters in golang", "body": "<p>Is there a Golang equivalent to the following openssl command?</p>\n\n<p><code>openssl dhparam -out dh.pem 2048</code></p>\n\n<p>I would like to be able to generate Diffie-Hellman parameters with golang and not need to invoke openssl.</p>\n"}, {"tags": ["go", "recursion"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541414936, "post_id": 53152852, "comment_id": 93196101, "body": "<i>&quot;I faced with a problem...&quot;</i> And what is that problem?"}, {"owner": {"reputation": 162, "user_id": 6147375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d684954974de36ebcd6766c50daa5534?s=128&d=identicon&r=PG&f=1", "display_name": "creedqq", "link": "https://stackoverflow.com/users/6147375/creedqq"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541415017, "post_id": 53152852, "comment_id": 93196137, "body": "Sorry, already added."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541415087, "post_id": 53152852, "comment_id": 93196177, "body": "<i>&quot; error occurs&quot;</i> What kind of error? Please be more specific."}, {"owner": {"reputation": 162, "user_id": 6147375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d684954974de36ebcd6766c50daa5534?s=128&d=identicon&r=PG&f=1", "display_name": "creedqq", "link": "https://stackoverflow.com/users/6147375/creedqq"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541416292, "post_id": 53152852, "comment_id": 93196829, "body": "Added in description"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541416364, "post_id": 53152852, "comment_id": 93196851, "body": "The problem is that you check if the <i>kind</i> is a map, and then you attempt to type assert a concrete map type. But that fails if it is a different map type. Your code only attempts to handle a single map type."}, {"owner": {"reputation": 162, "user_id": 6147375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d684954974de36ebcd6766c50daa5534?s=128&d=identicon&r=PG&f=1", "display_name": "creedqq", "link": "https://stackoverflow.com/users/6147375/creedqq"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541416928, "post_id": 53152852, "comment_id": 93197124, "body": "Yes, but how can I fix this?  I thought that map[string]interface{] is something like map[string]anything"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541417018, "post_id": 53152852, "comment_id": 93197176, "body": "No, it&#39;s not. You can only type-assert concrete types or interfaces. So it would help to know what actual types you might have in the map. If you know, you can enumerate them. It would be easier to use a type switch."}, {"owner": {"reputation": 162, "user_id": 6147375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d684954974de36ebcd6766c50daa5534?s=128&d=identicon&r=PG&f=1", "display_name": "creedqq", "link": "https://stackoverflow.com/users/6147375/creedqq"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541417021, "post_id": 53152852, "comment_id": 93197178, "body": "In case when I change the stored structure from map[string]int to map[string]interface{} - all works fine."}, {"owner": {"reputation": 162, "user_id": 6147375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d684954974de36ebcd6766c50daa5534?s=128&d=identicon&r=PG&f=1", "display_name": "creedqq", "link": "https://stackoverflow.com/users/6147375/creedqq"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541417133, "post_id": 53152852, "comment_id": 93197232, "body": "So there are any change to create unified method for all types?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1541417259, "post_id": 53152852, "comment_id": 93197298, "body": "Again, if all maps inside the map are of concrete type <code>map[string]interface{}</code>, you may use a simple type conversion or switch. If inner maps map be other custom map types having that map as the underlying type, you may use <a href=\"https://golang.org/pkg/reflect/#Value.Convert\" rel=\"nofollow noreferrer\"><code>reflect.Value.Conver()</code></a> to handle them in unity."}, {"owner": {"reputation": 162, "user_id": 6147375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d684954974de36ebcd6766c50daa5534?s=128&d=identicon&r=PG&f=1", "display_name": "creedqq", "link": "https://stackoverflow.com/users/6147375/creedqq"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541417393, "post_id": 53152852, "comment_id": 93197368, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/183119/discussion-between-creedqq-and-icza\">continue this discussion in chat</a>."}, {"owner": {"reputation": 162, "user_id": 6147375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d684954974de36ebcd6766c50daa5534?s=128&d=identicon&r=PG&f=1", "display_name": "creedqq", "link": "https://stackoverflow.com/users/6147375/creedqq"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541418667, "post_id": 53152852, "comment_id": 93197993, "body": "May you give me an example? I didn&#39;t find any regarding Value.Convert()  Thanks."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1541431599, "post_id": 53152852, "comment_id": 93205165, "body": "If slices and maps are always the concrete types <code>[]interface{}</code> and <code>map[string]interface{}</code>, then use type assertions to walk through structure. See answer <a href=\"https://stackoverflow.com/questions/29366038/looping-iterate-over-the-second-level-nested-json-in-go-lang\">here</a> for an example.  If not, then use reflection for all operations. See answer <a href=\"https://stackoverflow.com/questions/47664320/golang-recursively-reflect-both-type-of-field-and-value\">here</a> for starting point (there&#39;s probably a better example of using reflect, but I cannot find it quickly)."}], "answers": [{"comments": [{"owner": {"reputation": 162, "user_id": 6147375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d684954974de36ebcd6766c50daa5534?s=128&d=identicon&r=PG&f=1", "display_name": "creedqq", "link": "https://stackoverflow.com/users/6147375/creedqq"}, "edited": false, "score": 0, "creation_date": 1541435221, "post_id": 53154701, "comment_id": 93207246, "body": "The issue in a case, outer map contain another map with a different type. \tnested := map[string]int{ \t\t&quot;rsc&quot;: 5, \t\t&quot;gri&quot;: 52, \t} \tcommits := map[string]interface{}{ \t\t&quot;rsc&quot;: 3711, \t\t&quot;adg&quot;: nested, \t}"}], "tags": [], "owner": {"reputation": 3754, "user_id": 6027873, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1aa721a23e4aa11f8d8c4d92f0eee8cc?s=128&d=identicon&r=PG&f=1", "display_name": "hoque", "link": "https://stackoverflow.com/users/6027873/hoque"}, "is_accepted": false, "score": 1, "last_activity_date": 1541421867, "creation_date": 1541421867, "answer_id": 53154701, "question_id": 53152852, "link": "https://stackoverflow.com/questions/53152852/how-to-iterate-recursively-through-mapstringinterface/53154701#53154701", "title": "How to iterate recursively through map[string]interface{}", "body": "<p>Following is working for me</p>\n\n<pre><code>func main() {\n    x := MapType{\n        \"a\": MapType{\n            \"x\": MapType{\n                \"p\": ArrayType{\"l\", \"o\", \"l\"},\n            },\n        } ,\n    }\n    d := &amp;Document{}\n    fmt.Println(d.throughMap(x))\n\n}\n\ntype Document struct {}\n\ntype MapType map[string]interface{}\ntype ArrayType []interface{}\nfunc (doc *Document) throughMap(docMap MapType) MapType {\n    for k, v := range docMap {\n        fmt.Println(k, v)\n        vt := reflect.TypeOf(v)\n        switch vt.Kind() {\n        case reflect.Map:\n            if mv, ok := v.(MapType); ok {\n                docMap[k] = doc.throughMap(mv)\n            } else {\n                panic(\"error.\")\n            }\n        case reflect.Array, reflect.Slice:\n            if mv, ok := v.(ArrayType); ok {\n                docMap[k] = doc.throughArray(mv)\n            } else {\n                panic(\"error.\")\n            }\n        default:\n            docMap[k] = doc.processType(v)\n        }\n    }\n    return docMap\n}\n\nfunc (doc *Document) throughArray(arrayType ArrayType) ArrayType  {\n    return arrayType\n}\n\nfunc (doc *Document) processType(x interface{}) interface{} {\n    return x\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1541439023, "creation_date": 1541439023, "answer_id": 53159340, "question_id": 53152852, "link": "https://stackoverflow.com/questions/53152852/how-to-iterate-recursively-through-mapstringinterface/53159340#53159340", "title": "How to iterate recursively through map[string]interface{}", "body": "<p>Use the following code to recurse through maps, arrays and slices of any type:</p>\n\n<pre><code>func walk(v reflect.Value) {\n    fmt.Printf(\"Visiting %v\\n\", v)\n    // Indirect through pointers and interfaces\n    for v.Kind() == reflect.Ptr || v.Kind() == reflect.Interface {\n        v = v.Elem()\n    }\n    switch v.Kind() {\n    case reflect.Array, reflect.Slice:\n        for i := 0; i &lt; v.Len(); i++ {\n            walk(v.Index(i))\n        }\n    case reflect.Map:\n        for _, k := range v.MapKeys() {\n            walk(v.MapIndex(k))\n        }\n    default:\n        // handle other types\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 162, "user_id": 6147375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d684954974de36ebcd6766c50daa5534?s=128&d=identicon&r=PG&f=1", "display_name": "creedqq", "link": "https://stackoverflow.com/users/6147375/creedqq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2510, "favorite_count": 0, "accepted_answer_id": 53159340, "answer_count": 2, "score": 1, "last_activity_date": 1541439023, "creation_date": 1541414802, "last_edit_date": 1541416261, "question_id": 53152852, "link": "https://stackoverflow.com/questions/53152852/how-to-iterate-recursively-through-mapstringinterface", "title": "How to iterate recursively through map[string]interface{}", "body": "<p>I faced with a problem how to iterate through the map[string]interface{} recursively with additional conditions.</p>\n\n<p>1) if a value is a map - recursively call the method</p>\n\n<p>2) if a value is an array - call method for array</p>\n\n<p>3) if a value isn't a map - process it.</p>\n\n<p>Now when method try to execute <code>doc.throughMap(mv)</code> - error occurs \nSo how can I convert some value to needed type after <code>reflect</code> confirm that value is a map or an array?</p>\n\n<pre><code>type MapType map[string]interface{}\ntype ArrayType []interface{}\nfunc (doc *Document) throughMap(docMap MapType) MapType {\n    for k, v := range docMap {\n        vt := reflect.TypeOf(v)\n        switch vt.Kind() {\n        case reflect.Map:\n            if mv, ok := v.(map[string]interface{}); ok {\n                docMap[k] = doc.throughMap(mv)\n            } else {\n                panic(\"error.\")\n            }\n        case reflect.Array, reflect.Slice:\n            if mv, ok := v.([]interface{}); ok {\n                docMap[k] = doc.throughArray(mv)\n            } else {\n                panic(\"error.\")\n            }\n        default:\n            docMap[k] = doc.processType(v)\n        }\n    }\n    return docMap\n}\n</code></pre>\n\n<p>Stacktrace:</p>\n\n<pre><code>panic: error. [recovered]\n    panic: error.\n\ngoroutine 1 [running]:\nencoding/json.(*encodeState).marshal.func1(0xc000074cd0)\n    /usr/local/go/src/encoding/json/encode.go:301 +0x9a\npanic(0x4bd700, 0x4f9b70)\n    /usr/local/go/src/runtime/panic.go:513 +0x1b9\nproject-name/package/name.(*Document).throughMap(0xc00000c028, 0xc000060180, 0xc00007e000)\n    /home/path/to/project/document.go:231 +0x3f4\nproject-name/package/name.(*Document).convertDocument(0xc00000c028)\n    /home/path/to/project/document.go:217 +0x33\nproject-name/pachage/name.(*Document).MarshalJSON(0xc00000c028, 0x4db740, 0xc00000c028, 0x7f3f0f7540c0, 0xc00000c028, 0xc00001c101)\n    /home/path/to/project/document.go:167 +0xd8\nencoding/json.marshalerEncoder(0xc00007c000, 0x4db740, 0xc00000c028, 0x16, 0xc000070100)\n    /usr/local/go/src/encoding/json/encode.go:453 +0xb7\nencoding/json.(*encodeState).reflectValue(0xc00007c000, 0x4db740, 0xc00000c028, 0x16, 0x4c0100)\n    /usr/local/go/src/encoding/json/encode.go:333 +0x82\nencoding/json.(*encodeState).marshal(0xc00007c000, 0x4db740, 0xc00000c028, 0x4f0100, 0x0, 0x0)\n    /usr/local/go/src/encoding/json/encode.go:305 +0xf4\nencoding/json.Marshal(0x4db740, 0xc00000c028, 0xc000034698, 0x3, 0x3, 0x4d, 0x0)\n    /usr/local/go/src/encoding/json/encode.go:160 +0x52\nmain.main()\n    /home/path/to/project/main.go:21 +0x34d\n</code></pre>\n"}, {"tags": ["json", "parsing", "go", "struct"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541413801, "post_id": 53152343, "comment_id": 93195444, "body": "Your input is not JSON so you cannot parse it like JSON. You could parse it as JSON5."}, {"owner": {"reputation": 7, "user_id": 10584827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c87ff701d7365ac4c5e3992861703cab?s=128&d=identicon&r=PG&f=1", "display_name": "igitcanz", "link": "https://stackoverflow.com/users/10584827/igitcanz"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541413906, "post_id": 53152343, "comment_id": 93195521, "body": "I edited my data. It&#39;s in JSON format."}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 3, "creation_date": 1541414332, "post_id": 53152343, "comment_id": 93195759, "body": "It is not JSON. the <a href=\"http://www.json.org/\" rel=\"nofollow noreferrer\">JSON specification</a> does not allow a trailing comma."}, {"owner": {"reputation": 408, "user_id": 2234099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/678915aaa580bada8ed32e01000274c2?s=128&d=identicon&r=PG", "display_name": "gngchrs", "link": "https://stackoverflow.com/users/2234099/gngchrs"}, "edited": false, "score": 0, "creation_date": 1541415345, "post_id": 53152343, "comment_id": 93196323, "body": "Could you post how data is defined, and the <code>createdFile.Write</code>  function? I started <a href=\"https://goplay.space/#Wg2UVy2Fh3H\" rel=\"nofollow noreferrer\">a snippet here</a> . That way, it can be easy to diagnose why you are getting the error."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1541421953, "post_id": 53152343, "comment_id": 93199637, "body": "@igitcanz In <code>createdFile.Write([]byte)</code>, why are you passing <code>u.Schools</code> of type <code>[]struct {         Location string         Year    int     }</code> instead of a <code>[]byte</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": false, "score": 0, "last_activity_date": 1541422858, "creation_date": 1541422858, "answer_id": 53154970, "question_id": 53152343, "link": "https://stackoverflow.com/questions/53152343/how-to-parse-string-to-go-struct-and-write-to-file/53154970#53154970", "title": "how to parse string to go struct and write to file", "body": "<p>I found the following two problems:</p>\n\n<ol>\n<li>You've passed <code>u.Schools</code> of <code>type []struct { Location string Year int }</code> instead of a <code>[]byte</code></li>\n<li>Also your json data is still not valid.</li>\n</ol>\n\n<p>So here is my solution. Since you didn't provide the <code>createdFile.Write()</code> details, I used here <code>ioutil</code> package.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n)\n\nvar data = `{\n    \"name\": \"alex\",\n    \"schools\": [\n        {\"location\": \"xxx\" , \"year\": 2012},\n        {\"location\": \"xxx\" , \"year\": 2012}\n    ]\n}`\n\ntype User struct {\n    Name    string `json:\"name\"`\n    Schools []struct {\n        Location string\n        Year     int\n    }\n}\n\nfunc main() {\n    var (\n        u User\n        err error\n        schoolsBytes []byte\n    )\n\n    if err = json.Unmarshal([]byte(data), &amp;u); err != nil {\n        log.Fatalln(err)\n    }\n    fmt.Println(u.Schools)\n\n    schoolsBytes, err = json.Marshal(u.Schools)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    err = ioutil.WriteFile(\"/tmp/dat1\", schoolsBytes, 0777)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    dat, err := ioutil.ReadFile(\"/tmp/dat1\")\n    if err != nil {\n        log.Fatalln(err)\n    }\n    fmt.Print(string(dat))\n}\n</code></pre>\n"}], "owner": {"reputation": 7, "user_id": 10584827, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c87ff701d7365ac4c5e3992861703cab?s=128&d=identicon&r=PG&f=1", "display_name": "igitcanz", "link": "https://stackoverflow.com/users/10584827/igitcanz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 277, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1541422858, "creation_date": 1541413048, "last_edit_date": 1541413893, "question_id": 53152343, "link": "https://stackoverflow.com/questions/53152343/how-to-parse-string-to-go-struct-and-write-to-file", "title": "how to parse string to go struct and write to file", "body": "<p>I want to parse the schools array in the string and and want to write in a file by using golang.\nlets assume i have a string which is called as data;</p>\n\n<pre><code>{\n    \"name\": \"alex\",\n    \"schools\": [\n        {\"location\": \"xxx\" , \"year\": 2012},\n        {\"location\": \"xxx\" , \"year\": 2012},\n    ]\n}\n</code></pre>\n\n<p>I want to parse it and write schools to a file.</p>\n\n<p>In order to achive it. I first write a struct as;</p>\n\n<pre><code>type User struct{\n    name string `json:\"name\"`\n    Schools []struct {\n        Location string\n        Year    int\n    }\n} \n</code></pre>\n\n<p>then create a variable and try to parse the string as,</p>\n\n<pre><code>var u User\nerr := json.Unmarshal([]byte(data), &amp;u)\n\n\n_, err = createdFile.Write(u.Schools)\n</code></pre>\n\n<p>But this give me error as </p>\n\n<pre><code>cannot use m (type User) as type []byte in argument to createdFile.Write\n</code></pre>\n\n<p>How can I do it? Where is my mistake?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1541410295, "post_id": 53151580, "comment_id": 93193487, "body": "<code>greeting(&quot;Arun&quot;)</code> is a function and those do not get called by magic. Add <code>()</code>."}, {"owner": {"reputation": 2754, "user_id": 849632, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/NDhZK.jpg?s=128&g=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/849632/arun"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541411356, "post_id": 53151580, "comment_id": 93194069, "body": "I understand now.. It returns a <code>function</code> and it needs to be called with <code>()</code> .. I understand now.. Thank you so much"}], "answers": [{"tags": [], "owner": {"reputation": 3754, "user_id": 6027873, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1aa721a23e4aa11f8d8c4d92f0eee8cc?s=128&d=identicon&r=PG&f=1", "display_name": "hoque", "link": "https://stackoverflow.com/users/6027873/hoque"}, "is_accepted": true, "score": 2, "last_activity_date": 1541410643, "creation_date": 1541410643, "answer_id": 53151712, "question_id": 53151580, "link": "https://stackoverflow.com/questions/53151580/closures-in-golang-string-not-displayed/53151712#53151712", "title": "Closures in Golang - String not displayed", "body": "<p>Edit the main function with </p>\n\n<pre><code>func main() {\n    fmt.Println(greeting(\"Arun\")())\n}\n</code></pre>\n"}], "owner": {"reputation": 2754, "user_id": 849632, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/NDhZK.jpg?s=128&g=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/849632/arun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 53151712, "answer_count": 1, "score": -1, "last_activity_date": 1541410643, "creation_date": 1541410153, "question_id": 53151580, "link": "https://stackoverflow.com/questions/53151580/closures-in-golang-string-not-displayed", "title": "Closures in Golang - String not displayed", "body": "<p>I have been following lot of Tutorials on <code>Closures</code> in <code>golang</code>, but still couldn't really achieve the below one</p>\n\n<p>I have a function named 'greeting' that takes the <code>name</code> as the input and  has a <code>closure</code> within it, which would give the full-greeting message</p>\n\n<pre><code>func greeting(name string) func() string {\n    fullGreeting := \"\"\n    return func() string {\n        var message = \"Welcome to Closures \" + name\n        fullGreeting = message\n        return fullGreeting\n    }\n}\n\nfunc main() {\n    fmt.Println(greeting(\"Arun\"))\n}\n</code></pre>\n\n<p>Am expecting it to print <code>Welcome to Closures Arun</code>while it is printing just the method-value <code>0x48b660</code></p>\n"}, {"tags": ["regex", "go", "unicode"], "answers": [{"comments": [{"owner": {"reputation": 3509, "user_id": 4243840, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aaeabd769bae1bf82fd4b8882fed6653?s=128&d=identicon&r=PG", "display_name": "JGNI", "link": "https://stackoverflow.com/users/4243840/jgni"}, "edited": false, "score": 0, "creation_date": 1541408139, "post_id": 53150538, "comment_id": 93192463, "body": "Your regex doesn&#39;t match #de\u0301range, because the acute accent is a mark \\p{M} not a letter. Change your regex to <code>\\B#[\\p{L}\\p{N}_][\\p{L}\\p{N}\\p{M}_]*</code>"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 3509, "user_id": 4243840, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aaeabd769bae1bf82fd4b8882fed6653?s=128&d=identicon&r=PG", "display_name": "JGNI", "link": "https://stackoverflow.com/users/4243840/jgni"}, "edited": false, "score": 2, "creation_date": 1541411164, "post_id": 53150538, "comment_id": 93193961, "body": "@JGNI Probably, that level of conciseness is not necessary and <code>\\B#[\\p{L}\\p{N}\\p{M}_]+</code> will be enough. If there is a need to only match diacritics after letters, the pattern would look like <code>\\B#(?:\\p{L}\\p{M}*|[\\p{N}_])+</code>. If there was a requirement to only have a letter after <code>#</code>, it would look like <code>\\B#\\p{L}\\p{M}*(?:\\p{L}\\p{M}*|[\\p{N}_])*</code>. And so on and so forth."}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 3, "last_activity_date": 1541411047, "last_edit_date": 1541411047, "creation_date": 1541405578, "answer_id": 53150538, "question_id": 53150358, "link": "https://stackoverflow.com/questions/53150358/how-to-match-multiple-languages/53150538#53150538", "title": "How to match multiple languages", "body": "<p>I suggest using</p>\n\n<pre><code>\\B#[\\p{L}\\p{N}\\p{M}_]+\n</code></pre>\n\n<p>where <code>[\\p{L}\\p{N}\\p{M}_]</code> is roughly the Unicode-aware <code>\\w</code> pattern. The <code>\\p{L}</code> matches any Uniciode letter, <code>\\p{M}</code> matches any combining mark and <code>\\p{N}</code> matches any Unicode digit.</p>\n\n<p>See <a href=\"https://play.golang.org/p/pb0G8ILPsT1\" rel=\"nofollow noreferrer\">Go demo</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    text := \"#hello #\u0630\u0648\u0642 #citroe\u0308n\"\n    r := regexp.MustCompile(`\\B#[\\p{L}\\p{N}\\p{M}_]+`)\n    res := r.FindAllString(text, -1)\n    for _, element := range res {\n        fmt.Println(element)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>#hello\n#\u0630\u0648\u0642\n</code></pre>\n\n<p>With <code>text := \"#\u0630\u0648\u0642\"</code>, <a href=\"https://play.golang.org/p/Fl_Zop4CfZv\" rel=\"nofollow noreferrer\">the output is</a> <code>#\u0630\u0648\u0642</code>.</p>\n\n<p>See the <a href=\"https://regex101.com/r/wWYBSb/2\" rel=\"nofollow noreferrer\"><strong>regex demo</strong></a>.</p>\n"}], "owner": {"reputation": 879, "user_id": 2260362, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5152ad032e9e8b4f461aca8516954ff2?s=128&d=identicon&r=PG", "display_name": "Jamil Seaidoun", "link": "https://stackoverflow.com/users/2260362/jamil-seaidoun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 1, "accepted_answer_id": 53150538, "answer_count": 1, "score": 2, "last_activity_date": 1541411047, "creation_date": 1541404654, "last_edit_date": 1541410665, "question_id": 53150358, "link": "https://stackoverflow.com/questions/53150358/how-to-match-multiple-languages", "title": "How to match multiple languages", "body": "<p>I am writing a regex in golang to capture hashtags that might appear in different languages. For example obvious one is english, but there might be latin or arabic users who will try and create hashtags using those character set. \nI am aware of the unicode character class name but how can you use multiple at once without generating a regex for each one?</p>\n\n<p>example code: </p>\n\n<pre><code>r, err := regexp.Compile(`\\B(\\#[[:ascii:]]+\\b)[^?!;]*`)\n</code></pre>\n\n<p>This will match <code>\"#hello #\u0630\u0648\u0642\"</code> and output <code>[]string{#hello, #\u0630\u0648\u0642}</code> but not match for just <code>\"#\u0630\u0648\u0642\"</code></p>\n"}, {"tags": ["go", "datetime-parsing"], "answers": [{"tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": true, "score": 1, "last_activity_date": 1541402654, "creation_date": 1541402654, "answer_id": 53149966, "question_id": 53149541, "link": "https://stackoverflow.com/questions/53149541/parsing-dynamic-time-format-in-go/53149966#53149966", "title": "Parsing Dynamic Time Format in Go", "body": "<p>Use this layout instead: <code>2006-01-02T15:04:05.999</code></p>\n"}], "owner": {"reputation": 321, "user_id": 3703043, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cd2902cf6d55bd2c822d8507c5d3940c?s=128&d=identicon&r=PG&f=1", "display_name": "kue", "link": "https://stackoverflow.com/users/3703043/kue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 53149966, "answer_count": 1, "score": 0, "last_activity_date": 1541402654, "creation_date": 1541400327, "question_id": 53149541, "link": "https://stackoverflow.com/questions/53149541/parsing-dynamic-time-format-in-go", "title": "Parsing Dynamic Time Format in Go", "body": "<p>I'm working with an external API that will sometimes shorten the returned timestamp if the last values are zero. </p>\n\n<pre><code>layout := \"2006-01-02T15:04:05.000\"\nopened, err := time.Parse(layout, externallyFormattedTimestamp)\nif err != nil {\n    fmt.Println(\"something went wrong parsing the timestamp\")\n    fmt.Println(err.Error())\n}\n</code></pre>\n\n<p>If the returned externallyFormattedTimestamp is <code>2018-11-05T06:19:59.827</code>, this will parse without issue. </p>\n\n<p>But if the time returned ends with zeros, it'll be shortened like <code>2018-11-05T06:19:59.8</code> instead of <code>2018-11-05T06:19:59.800</code>, and break. Do I need to manually append zeros to the string before parsing, or is there something I missed built into Go that will handle this for me?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 1842, "user_id": 5672261, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/9fMHZ.jpg?s=128&g=1", "display_name": "Nitin", "link": "https://stackoverflow.com/users/5672261/nitin"}, "edited": false, "score": 0, "creation_date": 1541397768, "post_id": 53149079, "comment_id": 93188678, "body": "Where should close <code>sum</code> channel?  at the end of <code>doSum</code> function?"}], "tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": true, "score": 2, "last_activity_date": 1541398482, "last_edit_date": 1541398482, "creation_date": 1541397503, "answer_id": 53149079, "question_id": 53148676, "link": "https://stackoverflow.com/questions/53148676/deadlock-with-multiple-goroutines-with-multiple-channels/53149079#53149079", "title": "Deadlock with Multiple goroutines with multiple channels", "body": "<p>We can iterate through values sent over a channel. To break such iteration channel needs to be closed explicitly. Otherwise range would block forever in the same way as for nil channel. In your code you did't close the <code>sum</code>(for print function <code>sumValues</code> channel) channel. That's why following function will be blocked for forever.</p>\n\n<pre><code>func print(sumValues &lt;-chan string ){\n    for val := range sumValues {\n        fmt.Println(val)\n    }\n}\n</code></pre>\n\n<p>So you have to close the <code>sum</code> channel in the <code>doSum</code> function after all the go routine in the <code>doSum</code> function are complete (otherwise <code>sum</code> channel might be closed before go routines are complete). You can use <code>sync.WaitGroup</code> to do that. See the updated <code>doSum</code> function below:</p>\n\n<pre><code>func doSum(sum chan&lt;- string, oddChan &lt;-chan int, evenChan &lt;-chan int) {\n    var waitGroup sync.WaitGroup\n\n    waitGroup.Add(2) // Must wait for 2 calls to 'done' before moving on\n\n    go func(sum chan&lt;- string) {\n        s1 := 0\n        for val := range oddChan {\n            s1 += val\n        }\n        sum &lt;- fmt.Sprint(\"sum of odd number = \", s1)\n        waitGroup.Done()\n    }(sum)\n\n    go func(sum chan&lt;- string) {\n        s1 := 0\n        for val := range evenChan {\n            s1 += val\n        }\n        sum &lt;- fmt.Sprint(\"sum of even number = \", s1)\n        waitGroup.Done()\n    }(sum)\n\n    // Waiting for all goroutines to exit\n    waitGroup.Wait()\n\n    // all goroutines are complete now close the sum channel\n    close(sum)\n}\n</code></pre>\n"}], "owner": {"reputation": 1842, "user_id": 5672261, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/9fMHZ.jpg?s=128&g=1", "display_name": "Nitin", "link": "https://stackoverflow.com/users/5672261/nitin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 53149079, "answer_count": 1, "score": 0, "last_activity_date": 1541398482, "creation_date": 1541394691, "last_edit_date": 1592644375, "question_id": 53148676, "link": "https://stackoverflow.com/questions/53148676/deadlock-with-multiple-goroutines-with-multiple-channels", "title": "Deadlock with Multiple goroutines with multiple channels", "body": "<p>I am working on a sample program to print sum of odd and sum of even number between 1 to 100 using goroutine with multiple channels.</p>\n<p>you can find my code</p>\n<p><a href=\"https://play.golang.org/p/5OSqFEKjIgf\" rel=\"nofollow noreferrer\">here</a></p>\n<p>output</p>\n<pre><code>sum of even number = 2550\nsum of odd number = 2500\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan receive]:\nmain.print(0x434100, 0x11db7c)\n    /tmp/sandbox052575152/main.go:18 +0xc0\nmain.main()\n    /tmp/sandbox052575152/main.go:14 +0x120\n</code></pre>\n<p>The code works but with deadlock.\nI am not sure what is wrong in my code</p>\n"}, {"tags": ["rest", "go"], "comments": [{"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 2, "creation_date": 1541386192, "post_id": 53147536, "comment_id": 93186368, "body": "I&#39;m assuming that is not the complete <code>curl</code> command since you have a payload? Can you post what the definition of <code>Client</code> is? what is <code>c.w</code>?"}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1541390103, "post_id": 53147536, "comment_id": 93186982, "body": "<a href=\"https://www.getpostman.com/\" rel=\"nofollow noreferrer\">getpostman.com</a> have a nice <code>code</code> feature.  You can export a request to several code snippets. Go is one of the options."}, {"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 1, "creation_date": 1541407876, "post_id": 53147536, "comment_id": 93192322, "body": "From what I see your <code>Publish</code> method only writes (to something, whatever <code>c.w</code> is), but doesn&#39;t send anything. On a side note your code can be improved, but that would be something for <a href=\"https://codereview.stackexchange.com\">codereview.stackexchange.com</a>"}, {"owner": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "reply_to_user": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1541407976, "post_id": 53147536, "comment_id": 93192378, "body": "@Havelock As the code doesn&#39;t work at the moment (<i>&quot;everything I try fails</i>&quot;), it&#39;s off-topic on <a href=\"https://codereview.stackexchange.com\">Code Review</a>."}, {"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "reply_to_user": {"reputation": 94713, "user_id": 1139697, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5f136ddb684f39aaee1c028ee1950f6f?s=128&d=identicon&r=PG", "display_name": "Zeta", "link": "https://stackoverflow.com/users/1139697/zeta"}, "edited": false, "score": 0, "creation_date": 1541409210, "post_id": 53147536, "comment_id": 93192994, "body": "@Zeta, sure... but is the above code snippet &quot;everything&quot; ? As I said I see nothing which would attempt sending anything over the network."}, {"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1541410226, "post_id": 53147536, "comment_id": 93193445, "body": "It would also be helpful to include the part with the definition of <code>Client</code>."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1541412136, "post_id": 53147536, "comment_id": 93194493, "body": "@Godfather It would be better if you add necessary information for your problem(i mean <code>Client</code> definition server implementation and so so stuffs)"}], "owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1541384802, "creation_date": 1541384802, "question_id": 53147536, "link": "https://stackoverflow.com/questions/53147536/converting-curl-command-to-golang-conn-publish-code", "title": "converting curl command to golang conn.publish code", "body": "<p>I am trying to talk to server via Golang\nand I am unable to get it to work:</p>\n\n<p>However, the following CURL Command works:</p>\n\n<p>\"curl <a href=\"http://localhost:8888/auth\" rel=\"nofollow noreferrer\">http://localhost:8888/auth</a>\"</p>\n\n<p>I know the form is:  </p>\n\n<pre><code>&lt;subject&gt; &lt;payload length&gt; \"\\r\\n\" &lt;payload&gt;\n</code></pre>\n\n<p>but everything I try fails.</p>\n\n<p>The publish code is as follows:</p>\n\n<pre><code>// Publish takes a subject as an immutable string and payload inbytes,\n// then sends the message to the server.\n\nfunc (c *Client) Publish(subject string, payload []byte) error {\n    c.Lock()\n    pub := fmt.Sprintf(\"%s %d\\r\\n\", subject, len(payload))\n    _, err := c.w.WriteString(pub)\n\n    if err == nil {\n        _, err = c.w.Write(payload)\n    }\n    if err == nil {\n        _, err = c.w.WriteString(\"\\r\\n\")\n    }\n    if err == nil {\n        err = c.w.Flush()\n    }\n    c.Unlock()\n    if err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>I would appreciate any help that can be offered.</p>\n"}, {"tags": ["go", "recursion", "concurrency", "fibonacci", "goroutine"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1541384683, "post_id": 53147240, "comment_id": 93186132, "body": "You have a combinatorial explodion: <a href=\"http://www.cs.toronto.edu/~gfb/csc104/2016W/Lectures/CSC104.2016W.Week-7.Lecture.Fibonacci.I.pdf\" rel=\"nofollow noreferrer\">cs.toronto.edu/~gfb/csc104/2016W/Lectures/&hellip;</a>"}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1541420409, "post_id": 53147240, "comment_id": 93198889, "body": "&quot;supposed to be very efficient&quot; and then &quot;recursive fibonacci implementation&quot;, these two doesn&#39;t go together, period. An efficient fibonacci implementation uses a loop, and isn&#39;t recursive. The recursive variant is only good for one thing and that is teaching about the pitfalls of recursion."}, {"owner": {"reputation": 11, "user_id": 6366127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebab8f264f2c351c29e54d0073342684?s=128&d=identicon&r=PG&f=1", "display_name": "Swade", "link": "https://stackoverflow.com/users/6366127/swade"}, "edited": false, "score": 0, "creation_date": 1541438153, "post_id": 53147240, "comment_id": 93208748, "body": "&quot;supposed to be very inefficient&quot; and I am using this to teach the pitfalls. I&#39;m hoping to implement a worker pool and limit the amount of workers to the number of available CPUs. I would just like to get this working to show the differences."}], "answers": [{"tags": [], "owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "is_accepted": false, "score": 2, "last_activity_date": 1541390116, "creation_date": 1541390116, "answer_id": 53148108, "question_id": 53147240, "link": "https://stackoverflow.com/questions/53147240/nth-fibonacci-number-in-go-using-recursion-and-concurrency/53148108#53148108", "title": "Nth Fibonacci number in Go using recursion and concurrency", "body": "<p>I suggest you do the math behind how many goroutines you're actually launching.</p>\n\n<p>Your first call spawns two goroutines.  Each of those spawn two further goroutines.  The total number of goroutines spawned will be <code>2^1 + 2^2 + 2^3 + ... + 2^n</code>.  While a lot of these will exit before you reach the number below, it's still a <strong>lot</strong> of goroutines.</p>\n\n<p><a href=\"https://i.stack.imgur.com/P2eJr.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/P2eJr.gif\" alt=\"Sum\"></a></p>\n"}, {"tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": false, "score": 1, "last_activity_date": 1541420223, "creation_date": 1541420223, "answer_id": 53154276, "question_id": 53147240, "link": "https://stackoverflow.com/questions/53147240/nth-fibonacci-number-in-go-using-recursion-and-concurrency/53154276#53154276", "title": "Nth Fibonacci number in Go using recursion and concurrency", "body": "<p>You program create exponential number of go routines. That comes with context switching latency. Try to run it for limited number of go routines. See following code where i run it for limited number of go routines:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype Fibonacci struct {\n    num    float64\n    answer float64\n}\n\ntype goRoutineManager struct {\n    goRoutineCnt chan bool\n}\n\nfunc (g *goRoutineManager) Run(f func()) {\n    select {\n    case g.goRoutineCnt &lt;- true:\n        go func() {\n            f()\n            &lt;-g.goRoutineCnt\n        }()\n    default:\n        f()\n    }\n}\n\nfunc NewGoRoutineManager(goRoutineLimit int) *goRoutineManager {\n    return &amp;goRoutineManager{\n        goRoutineCnt: make(chan bool, goRoutineLimit),\n    }\n}\n\nfunc newFibonacci(n float64, gm *goRoutineManager) *Fibonacci {\n\n    f := new(Fibonacci)\n    f.num = n\n    c1 := make(chan float64, 1)\n    c2 := make(chan float64, 1)\n\n    if f.num &lt;= 1 {\n        f.answer = n\n    } else {\n\n        gm.Run(func() {\n            fib1 := newFibonacci(n-1, gm)\n            c2 &lt;- fib1.answer\n        })\n\n        gm.Run(func() {\n            fib2 := newFibonacci(n-2, gm)\n            c1 &lt;- fib2.answer\n        })\n\n        f.answer = &lt;-c2 + &lt;-c1\n    }\n    close(c1)\n    close(c2)\n\n    return f\n}\n\nfunc main() {\n\n    numbers := []float64{30, 35, 36, 37, 38, 39, 40} //{30, 35, 36, 37, 38, 39, 40}\n    for _, value := range numbers {\n        start := time.Now()\n        fmt.Println(\"getting the \", value, \" fibonacci number\")\n\n        gm := NewGoRoutineManager(3)\n\n        f := newFibonacci(value, gm)\n        fmt.Println(f.answer)\n\n        end := time.Now()\n        totalTime := end.Sub(start)\n        fmt.Println(\"Fibonacci number: \", value, \" took \", totalTime, \"\\n\")\n    }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12330646, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mDz0hebyReF7fEzZUAq-Op5MJNPZRnDW8VSUozW=k-s128", "display_name": "joehu", "link": "https://stackoverflow.com/users/12330646/joehu"}, "is_accepted": false, "score": 0, "last_activity_date": 1573027908, "creation_date": 1573027908, "answer_id": 58725630, "question_id": 53147240, "link": "https://stackoverflow.com/questions/53147240/nth-fibonacci-number-in-go-using-recursion-and-concurrency/58725630#58725630", "title": "Nth Fibonacci number in Go using recursion and concurrency", "body": "<p>cause you are creating too many channels.Try to use the trivial algorithm when the problem is relatively small.\nthe following program works when n==45,I guess it will also crash when n is around 65.Trivial fib is acctually quite a hard problem to run in parallel properlly.</p>\n\n<pre><code>func fib(n int) int {\n    if n &lt; 2 {\n        return 1\n    }\n    return fib(n-1) + fib(n-2)\n}\n\nfunc fibP(n int) int {\n    //base case\n    if n &lt; 25 {\n        return fib(n)\n    }\n    fib2chan := make(chan int)\n    go func() {\n        fib2chan &lt;- fibP(n - 2)\n    }()\n    return fibP(n-1) + &lt;-fib2chan\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 6366127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebab8f264f2c351c29e54d0073342684?s=128&d=identicon&r=PG&f=1", "display_name": "Swade", "link": "https://stackoverflow.com/users/6366127/swade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1174, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1573027908, "creation_date": 1541381819, "question_id": 53147240, "link": "https://stackoverflow.com/questions/53147240/nth-fibonacci-number-in-go-using-recursion-and-concurrency", "title": "Nth Fibonacci number in Go using recursion and concurrency", "body": "<p><a href=\"https://i.stack.imgur.com/eDfgN.png\" rel=\"nofollow noreferrer\">The Java Code I'm attempting to translate.</a> I've been trying to implement this java method of getting the nth Fibonacci number in <strong>Go</strong> but I can't seem to get my code past the number Fibonacci number 35 before it crashes. This method <strong>is</strong> supposed to be very inefficient but not so inefficient that it doesn't complete.</p>\n\n\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype Fibonacci struct {\n    num    float64\n    answer float64\n}\n\nfunc newFibonacci(n float64) *Fibonacci {\n\n    f := new(Fibonacci)\n    f.num = n\n    c1 := make(chan float64)\n    c2 := make(chan float64)\n\n    if f.num &lt;= 1 {\n        f.answer = n\n    } else {\n        go func() {\n            fib1 := newFibonacci(n - 1)\n            c2 &lt;- fib1.answer\n        }()\n        go func() {\n            fib2 := newFibonacci(n - 2)\n            c1 &lt;- fib2.answer   \n        }()\n\n        f.answer = &lt;-c2 + &lt;-c1\n    }\n    close(c1)\n    close(c2)\n\n    return f\n}\n\nfunc main() {\n\n    numbers := []float64{30, 35, 36, 37, 38, 39, 40}\n    for _, value := range numbers{\n        start := time.Now()\n        fmt.Println(\"getting the \", value, \" fibonacci number\")\n        f := newFibonacci(value)\n        fmt.Println(f.answer)\n        end := time.Now()\n        totalTime := end.Sub(start)\n        fmt.Println(\"Fibonacci number: \", value, \" took \", totalTime, \"\\n\")\n    }\n\n}\n</code></pre>\n\n\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "edited": false, "score": 0, "creation_date": 1541379664, "post_id": 53145887, "comment_id": 93185230, "body": "<code>Bad: {{.var.x}}</code> might have to read <code>{{.var}}</code>"}, {"owner": {"reputation": 33, "user_id": 897869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9b8d225edd3add894a5b0dd47fc762d?s=128&d=identicon&r=PG", "display_name": "Parnic", "link": "https://stackoverflow.com/users/897869/parnic"}, "reply_to_user": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "edited": false, "score": 0, "creation_date": 1541382930, "post_id": 53145887, "comment_id": 93185839, "body": "@NorbertvanNobelen indeed, that would fix the error. I included that intentionally to show what happens when there&#39;s a template error. :)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1541423726, "post_id": 53145887, "comment_id": 93200544, "body": "Possible duplicate: <a href=\"https://stackoverflow.com/questions/30821745/idiomatic-way-to-handle-template-errors-in-golang/30822458#30822458\">Idiomatic way to handle template errors in golang</a>."}, {"owner": {"reputation": 33, "user_id": 897869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9b8d225edd3add894a5b0dd47fc762d?s=128&d=identicon&r=PG", "display_name": "Parnic", "link": "https://stackoverflow.com/users/897869/parnic"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541433243, "post_id": 53145887, "comment_id": 93206061, "body": "@icza unfortunately gin-gonic keeps that template execute call internal. I&#39;m looking for a way to do it with gin specifically. Maybe the answer is that it&#39;s not possible."}, {"owner": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1541699073, "post_id": 53145887, "comment_id": 93314328, "body": "AH, now I understand your question. Graceful error handling in go itself is pretty clear. The idiomatic way as linked by @icza is the way to go."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 897869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9b8d225edd3add894a5b0dd47fc762d?s=128&d=identicon&r=PG", "display_name": "Parnic", "link": "https://stackoverflow.com/users/897869/parnic"}, "edited": false, "score": 0, "creation_date": 1541433302, "post_id": 53153859, "comment_id": 93206099, "body": "Unfortunately gin-gonic keeps that template execute call internal. I&#39;m looking for a way to do it with gin specifically. Maybe the answer is that it&#39;s not possible with gin without Executing the template twice."}, {"owner": {"reputation": 85, "user_id": 5218121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b308136b453109457c54443dbc9fab7d?s=128&d=identicon&r=PG&f=1", "display_name": "big pigeon", "link": "https://stackoverflow.com/users/5218121/big-pigeon"}, "reply_to_user": {"reputation": 33, "user_id": 897869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9b8d225edd3add894a5b0dd47fc762d?s=128&d=identicon&r=PG", "display_name": "Parnic", "link": "https://stackoverflow.com/users/897869/parnic"}, "edited": false, "score": 0, "creation_date": 1541470468, "post_id": 53153859, "comment_id": 93220076, "body": "@Parnic use context.Data method, it will write bytes data to response.Writer"}, {"owner": {"reputation": 33, "user_id": 897869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9b8d225edd3add894a5b0dd47fc762d?s=128&d=identicon&r=PG", "display_name": "Parnic", "link": "https://stackoverflow.com/users/897869/parnic"}, "edited": false, "score": 0, "creation_date": 1541700423, "post_id": 53153859, "comment_id": 93314987, "body": "The context.Data tip helped me out, thanks. I ended up executing the html template myself and writing the result to Data if there were no errors, otherwise displaying my error page via HTML()."}], "tags": [], "owner": {"reputation": 85, "user_id": 5218121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b308136b453109457c54443dbc9fab7d?s=128&d=identicon&r=PG&f=1", "display_name": "big pigeon", "link": "https://stackoverflow.com/users/5218121/big-pigeon"}, "is_accepted": true, "score": 2, "last_activity_date": 1541418651, "creation_date": 1541418651, "answer_id": 53153859, "question_id": 53145887, "link": "https://stackoverflow.com/questions/53145887/gracefully-handle-template-rendering-errors-in-gin-gonic/53153859#53153859", "title": "Gracefully handle template rendering errors in gin-gonic", "body": "<p>you must be sure the Template render correctly,Because c.HTML will write directly to response, at this time some byte has been sent to client.</p>\n\n<p>you can use \"html/template\", and use buff to cache response data, instead of writing directly to response writer</p>\n"}], "owner": {"reputation": 33, "user_id": 897869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9b8d225edd3add894a5b0dd47fc762d?s=128&d=identicon&r=PG", "display_name": "Parnic", "link": "https://stackoverflow.com/users/897869/parnic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 947, "favorite_count": 0, "accepted_answer_id": 53153859, "answer_count": 1, "score": 3, "last_activity_date": 1541769852, "creation_date": 1541368502, "last_edit_date": 1541769852, "question_id": 53145887, "link": "https://stackoverflow.com/questions/53145887/gracefully-handle-template-rendering-errors-in-gin-gonic", "title": "Gracefully handle template rendering errors in gin-gonic", "body": "<p>I'm learning Go and using gin-gonic for a web application. I'm trying to recover gracefully from template errors and haven't been able to figure out how to buffer output or redirect properly to achieve this.</p>\n\n<p>With this code:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n    g := gin.New()\n    g.LoadHTMLGlob(\"templates/*\")\n    g.Use(func(c *gin.Context) {\n        defer func() {\n            if err := recover(); err != nil {\n                c.HTML(http.StatusInternalServerError, \"error.tmpl\", nil)\n            }\n        }()\n\n        c.Next()\n    })\n    g.GET(\"/\", func(c *gin.Context) {\n        c.HTML(http.StatusOK, \"index.tmpl\", gin.H{\"var\": 4})\n    })\n    g.Run(\":80\")\n}\n</code></pre>\n\n<p>where templates/index.tmpl is</p>\n\n<pre><code>Before\n&lt;br&gt;\nBad: {{.var.x}}\n&lt;br&gt;\nAfter\n</code></pre>\n\n<p>and templates/error.tmpl is</p>\n\n<pre><code>Oops! We encountered an error.\n</code></pre>\n\n<p>when I load my page, I see</p>\n\n<pre><code>Before\nBad: Oops! We encountered an error.\n</code></pre>\n\n<p>and the response code ends up being 200. I'd prefer to cleanly catch the error so that the only thing displayed to the user is</p>\n\n<pre><code>Oops! We encountered an error.\n</code></pre>\n\n<p>the response code comes out as 500, and the error gets logged on the server for later investigation.</p>\n\n<p>What's the best way within gin to catch template errors without showing partial output to the user? I've seen several examples of accomplishing this with buffering using the built-in net/http stuff, but haven't been able to find anything for a good way to handle it in gin.</p>\n\n<h2>Edited with solution</h2>\n\n<p>Building off of @big pigeon's comments on the accepted answer, I ended up executing the template myself into a buffer and using <code>c.Data()</code> to display it if there were no errors. This still seems less than ideal since it bypasses features like <code>multitemplate</code>'s ability to dynamically reload a parsed template at runtime in dev builds, but it works. The updated proof-of-concept code looks like:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"html/template\"\n    \"net/http\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n    g := gin.New()\n    g.LoadHTMLGlob(\"templates/*\")\n    g.Use(func(c *gin.Context) {\n        defer func() {\n            if err := recover(); err != nil {\n                c.HTML(http.StatusInternalServerError, \"error.tmpl\", nil)\n            }\n        }()\n\n        c.Next()\n    })\n    g.GET(\"/\", func(c *gin.Context) {\n        if tmpl, err := template.ParseFiles(\"templates/index.tmpl\"); err != nil {\n            panic(err)\n        } else {\n            buf := &amp;bytes.Buffer{}\n            if err = tmpl.Execute(buf, gin.H{\"var\": 4}); err != nil {\n                panic(err)\n            } else {\n                c.Data(http.StatusOK, \"text/html; charset=utf-8\", buf.Bytes())\n            }\n        }\n    })\n    g.Run(\":80\")\n}\n</code></pre>\n\n<p>Using buffer pooling, pre-parsing templates, and other such niceties are left as an exercise to any future readers.</p>\n\n<p>If anyone knows of a better way to handle this without bypassing gin's parsing/rendering features, I'm very open to it.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1541367007, "post_id": 53145619, "comment_id": 93182608, "body": "See <a href=\"https://tour.golang.org/flowcontrol/1\" rel=\"nofollow noreferrer\">Go Tour</a>, <a href=\"https://golang.org/doc/effective_go.html#for\" rel=\"nofollow noreferrer\">Effective Go</a> and the  <a href=\"https://golang.org/ref/spec#For_clause\" rel=\"nofollow noreferrer\">specification</a> for a description of how for statements work."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1541367363, "post_id": 53145619, "comment_id": 93182712, "body": "I think you are not asking about <code>for</code>, but about the usage of multiple assignment in the init and post statements. See the linked Q&amp;A for a discussion about this."}], "owner": {"user_type": "does_not_exist", "display_name": "user7194542"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "closed_date": 1541369262, "answer_count": 0, "score": 0, "last_activity_date": 1541366697, "creation_date": 1541366697, "question_id": 53145619, "link": "https://stackoverflow.com/questions/53145619/specyfic-usage-of-for-loop-in-go-language", "closed_reason": "Duplicate", "title": "Specyfic usage of &quot;for&quot; loop in Go Language", "body": "<p>I found this example of using the \"for\" loop in Go language. Unfortunately I have no idea why and how it works. Could anyone explain to me how exactly the use of \"for\" works in this example?</p>\n\n<pre><code>for no, i := 10, 1; i &lt;= 10 &amp;&amp; no &lt;= 19;i,no = i + 1, no + 1 {\n    fmt.Printf(\"%d * %d = %d\\n\", no, i, no*i)\n}\n</code></pre>\n"}, {"tags": ["go", "child-process"], "answers": [{"tags": [], "owner": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "is_accepted": true, "score": 0, "last_activity_date": 1541379904, "creation_date": 1541379904, "answer_id": 53147054, "question_id": 53144856, "link": "https://stackoverflow.com/questions/53144856/how-to-run-binary-from-os-execute-from-code/53147054#53147054", "title": "How to run binary from os.execute from code", "body": "<p>Applications accessing the shell, do often not execute the shell initialization/configuration. For example the cron an clearly also go do not execute the shell initialization.</p>\n\n<p>To make your program work add the absolute path to the executable, or alternative the relative path from the location where your application is started from:</p>\n\n<pre><code>exec.Command(\u201c./integration/testdata/fzr\u201d, \u201c\u2014help\u201d)\n</code></pre>\n\n<p>(Assuming that the path displayed is your actual path).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 53147054, "answer_count": 1, "score": 1, "last_activity_date": 1541407670, "creation_date": 1541361458, "last_edit_date": 1541364273, "question_id": 53144856, "link": "https://stackoverflow.com/questions/53144856/how-to-run-binary-from-os-execute-from-code", "title": "How to run binary from os.execute from code", "body": "<p>I'm trying to build binary with code and run the command against the bin (the bin is CLI)\nVia code, </p>\n\n<p><code>mytest.go</code> file</p>\n\n<pre><code>cmd := exec.Command(\"go\", \"build\",  \"-o\", \"./integration/testdata/fzr\u201d,)\ncmd.Dir = \u201c./testdata\"\nerr := cmd.Run()\n</code></pre>\n\n<p>now after  the code run, I was able to see the <code>bin</code> under <code>testdata</code> folder \nAnd now I\u2019m want to run a command like <code>fzr \u2014help</code></p>\n\n<p>Like following</p>\n\n<pre><code>cmdOut := exec.Command(\u201cfzr\u201d, \u201c\u2014help\u201d)\ncmdOut.Dir = \"./testdata/\"\nerr := cmdOut.Run()\n</code></pre>\n\n<p><strong>I got error</strong> </p>\n\n<pre><code>lookPathErr: {\n    Name: \u201cfzr\u201d,\n    Err: {\n        s: \"executable file not found in $PATH\",\n    },\n}\n</code></pre>\n\n<p>Now If I take the fzr bin and put it in go/src/bin I was able to run <code>fzr \u2014help</code> from the terminal</p>\n\n<p>The project structure is like following</p>\n\n<pre><code>myGithubProject/\n  |---- integration\n   |---- -testdata\n    |---- -fzr\n   |---- -mytest.go\n</code></pre>\n\n<p><code>mytest</code> is in the same level with the <code>testadata</code> and the <code>fzr</code> bin is under test data</p>\n\n<p>What could be the problem ?</p>\n\n<p>I try also to provide the full path to the bin with <code>os.Getwd()</code> which doesnt help ...</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": true, "score": 4, "last_activity_date": 1541358700, "creation_date": 1541358700, "answer_id": 53144411, "question_id": 53144276, "link": "https://stackoverflow.com/questions/53144276/omit-multiple-fields-with-mgo/53144411#53144411", "title": "Omit multiple fields with mgo", "body": "<p>This looks like a typo. To ignore a field, the tag value must be a hyphen, not an underscore.</p>\n\n<pre><code>Profit     float64    `json:\"profit\" bson:\"-\"`\nEuroProfit float64    `json:\"euro_profit\" bson:\"-\"`\n</code></pre>\n"}], "owner": {"reputation": 8863, "user_id": 162622, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/f250b5a19c6c65b27f03a8c75b45616b?s=128&d=identicon&r=PG", "display_name": "Kiva", "link": "https://stackoverflow.com/users/162622/kiva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 53144411, "answer_count": 1, "score": 0, "last_activity_date": 1541412891, "creation_date": 1541357798, "last_edit_date": 1541412891, "question_id": 53144276, "link": "https://stackoverflow.com/questions/53144276/omit-multiple-fields-with-mgo", "title": "Omit multiple fields with mgo", "body": "<p>I have the following structure and I would like to not insert fields Profit and EuroProfit.</p>\n\n<pre><code>type Order struct {\nPrice      float64    `json:\"price\"`\nEuroPrice  float64    `json:\"euro_price\"`\nProfit     float64    `json:\"profit\" bson:\"_\"`\nEuroProfit float64    `json:\"euro_profit\" bson:\"_\"`\nCurrency   *Currency  `json:\"currency\"`\nDate       customTime `json:\"date\"` }\n</code></pre>\n\n<p>I read in the mgo/bson doc I have to add bson:\"_\" to avoid to insert them.</p>\n\n<p>But when I insert a structure I get the following error:</p>\n\n<pre><code>Duplicated key '_' in struct model.Order\n</code></pre>\n\n<p>And indeed, if I let only one ' _ ', it is inserted in the mongodb, so the bson:\" _ \" seems doesn't work.</p>\n\n<p>How can I avoid to insert them ?</p>\n\n<p>I use the following import:</p>\n\n<p>\"github.com/globalsign/mgo/bson\"</p>\n"}, {"tags": ["unit-testing", "go", "testing"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1541354743, "post_id": 53143458, "comment_id": 93179125, "body": "If you have a virtual file system (especially <code>&#47;etc&#47;passwd</code>), then it should work just fine. The internals for <code>user.Lookup</code> uses <code>&#47;etc&#47;passwd</code>. <a href=\"https://golang.org/src/os/user/lookup_unix.go#L181\" rel=\"nofollow noreferrer\">golang.org/src/os/user/lookup_unix.go#L181</a>"}, {"owner": {"reputation": 2022, "user_id": 693154, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/3f1377595f2f1a43cc82ca682cca9ffb?s=128&d=identicon&r=PG", "display_name": "borfast", "link": "https://stackoverflow.com/users/693154/borfast"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1541357963, "post_id": 53143458, "comment_id": 93179978, "body": "Well, Go&#39;s internals don&#39;t know about my virtual file system, so <code>os.Open()</code> will just try to access <code>&#47;etc&#47;passwd</code> on my machine instead of the one in the in-memory file system. Unless there&#39;s a way for me to tell Go&#39;s <code>os</code> package to use the virtual file system, I don&#39;t see how it will use it. Is there a way to do that?"}, {"owner": {"reputation": 665, "user_id": 4411182, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-y6ywJeM9H7I/AAAAAAAAAAI/AAAAAAAAAHY/NY5Ggehfnxc/photo.jpg?sz=128", "display_name": "George Edward Shaw IV", "link": "https://stackoverflow.com/users/4411182/george-edward-shaw-iv"}, "edited": false, "score": 0, "creation_date": 1541366883, "post_id": 53143458, "comment_id": 93182588, "body": "The easiest thing to do might be to abstract the type <code>LinuxBackend</code> more to take a parameter for some sort of path (maybe the root of everything? I&#39;d have to know more about your project to say for sure) so that way you can make spin up a variable of type <code>LinuxBackend</code> in your tests that either points to a) the virtual file system (if its mounted somewhere) or b) a clone temporary directory that you clean up at the end of the tests. Check out <code>testing.M</code> and <code>TestMain</code> to make some of this process easier."}, {"owner": {"reputation": 2022, "user_id": 693154, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/3f1377595f2f1a43cc82ca682cca9ffb?s=128&d=identicon&r=PG", "display_name": "borfast", "link": "https://stackoverflow.com/users/693154/borfast"}, "edited": false, "score": 0, "creation_date": 1541370593, "post_id": 53143458, "comment_id": 93183550, "body": "LinuxBackend is just a struct that contains an Afero file system (I just added it in the question). That way I can instantiate an in-memory file system for tests or a regular file system for the other code. So in other words, I believe I already have the abstraction you mention but I still don&#39;t see how I could make Go&#39;s code use it."}], "owner": {"reputation": 2022, "user_id": 693154, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/3f1377595f2f1a43cc82ca682cca9ffb?s=128&d=identicon&r=PG", "display_name": "borfast", "link": "https://stackoverflow.com/users/693154/borfast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 200, "favorite_count": 2, "answer_count": 0, "score": 2, "last_activity_date": 1541372201, "creation_date": 1541352448, "last_edit_date": 1541372201, "question_id": 53143458, "link": "https://stackoverflow.com/questions/53143458/how-can-i-test-golang-code-that-calls-users-lookup-with-a-virtual-file-system-li", "title": "How can I test Golang code that calls users.Lookup with a virtual file system like Afero&#39;s in-memory FS?", "body": "<p>I'm trying to write tests for this function in Go:\n</p>\n\n<pre><code>type LinuxBackend struct {\n    fs afero.Fs\n}\n\n\nfunc (b *LinuxBackend) GetSSHUser(name string) users.SSHUser {\n    // Get the user from the system\n    usr, err := user.Lookup(name)\n    if err != nil {\n        panic(err)\n    }\n\n    return users.SSHUser{ User: usr }\n}\n</code></pre>\n\n<p>I'd like to have a fake <code>/etc/passwd</code> so that my tests can create the necessary users in that file instead of relying on the real system file.</p>\n\n<p>For other parts of my code, I abstracted the underlying file system using <a href=\"https://github.com/spf13/afero\" rel=\"nofollow noreferrer\">Afero</a> to create an in-memory file system, creating the necessary files (including <code>/etc/passwd</code>) so the tests can run. That's what the <code>fs</code> field in <code>LinuxBackend</code> is for.</p>\n\n<p>For example, here's another function from the same package:\n</p>\n\n<pre><code>func (b *LinuxBackend) GetMinMaxUid() (int, int) {\n    content, err := afero.ReadFile(b.fs, LoginDefsPath)\n    // more code here...\n    return min, max\n}\n</code></pre>\n\n<p>I can then test this without touching the real file system:\n</p>\n\n<pre><code>func createLoginDefs(afs afero.Fs) {\n    afs.MkdirAll(\"/etc\", os.FileMode(os.ModeDir))\n    f, _ := afs.OpenFile(LoginDefsPath, os.O_APPEND|os.O_WRONLY|os.O_CREATE, 0600)\n    defer f.Close()\n    f.WriteString(\"UID_MIN           \" + strconv.Itoa(uidMin) + \"\\n\")\n    f.WriteString(\"UID_MAX           \" + strconv.Itoa(uidMax) + \"\\n\")\n}\n\nfunc TestLinuxBackend_GetMinMaxUid(t *testing.T) {\n    afs := afero.NewMemMapFs() // &lt;-- This is the trick.\n    createLoginDefs(afs)\n\n    backend := LinuxBackend{afs}\n\n    min, max := backend.GetMinMaxUid()\n\n    // rest of the test...\n}\n</code></pre>\n\n<p>I can't do that for <a href=\"https://github.com/golang/go/blob/master/src/os/user/lookup.go#L32\" rel=\"nofollow noreferrer\"><code>user.Lookup()</code></a>, though, which means it will try to fetch the non-existent test users from the real file system.</p>\n\n<p><code>user.Lookup</code> calls <code>user.lookupUser</code>, which has two concrete implementations, a <a href=\"https://github.com/golang/go/blob/master/src/os/user/lookup_unix.go#L181\" rel=\"nofollow noreferrer\">pure Go</a> one, and a <a href=\"https://github.com/golang/go/blob/master/src/os/user/cgo_lookup_unix.go#L52\" rel=\"nofollow noreferrer\">cgo one</a>. The latter is completely impossible to coerce to use a virtual file system, I believe, since it uses libc's <code>pw*</code> utility functions to fetch users. The former starts by <code>Open</code>ing a file handle and then passes it to a <code>findUsername</code> function that takes an <code>io.Reader</code> as an argument, but this function is not exported from the module, so I can't use it directly to pass a Reader from the Afero file system to it.</p>\n\n<p>Is there a way I can somehow make Go use the in-memory file system for <code>user.Lookup</code> and <code>user.lookupUser</code>, or write the code or test in some other way so that <code>user.Lookup</code> doesn't use the real file system?</p>\n\n<p>I could always copy <code>user.lookupUser</code> but I'd rather avoid that.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1541352175, "post_id": 53143365, "comment_id": 93178290, "body": "After removing the unused libraries, I get <code>.&#47;test.go:24:21: newStrcut is not a type</code>. What are you intending with <code>myS = newStrcut(&amp;newStrcut{})</code>?"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1541352561, "post_id": 53143365, "comment_id": 93178416, "body": "I need it to do injection for the structure , it is needed for the testing"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1541352985, "post_id": 53143365, "comment_id": 93178581, "body": "It doesn&#39;t compile, I don&#39;t know what you intend to do, so I can&#39;t reproduce your problem. If you provide a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a> which compiles and runs we can help. Did you mean <code>myS = newStrcut(&amp;myStruct{})</code>?"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1541354304, "post_id": 53143365, "comment_id": 93178999, "body": "yes myS = newStrcut(&amp;myStruct{})"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1541354329, "post_id": 53143365, "comment_id": 93179010, "body": "The idea is to create interface and then to use it from the tests and call to the same method that create the myValue and then send the relevant structure and I want that the value will be the same"}], "answers": [{"comments": [{"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1541352484, "post_id": 53143413, "comment_id": 93178386, "body": "why does the object ate diffrerent ? why i don&#39;t get the same value ? How I can fix it ?"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1541352535, "post_id": 53143413, "comment_id": 93178404, "body": "I want that the value will be the same in the same objects"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1541352611, "post_id": 53143413, "comment_id": 93178432, "body": "why the &quot;s&quot; in doMyLogic and in doFunc are different ?"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1541352780, "post_id": 53143413, "comment_id": 93178503, "body": "I want that the myValue will be the same for the same objects in the same structure"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1541352930, "post_id": 53143413, "comment_id": 93178565, "body": "The idea is to create interface and then to use it from the tests and call to the same method that create the myValue and then send the relevant structure"}, {"owner": {"reputation": 15544, "user_id": 864393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59ae69e09086fed821a36d36814022c2?s=128&d=identicon&r=PG", "display_name": "Jeremy Roman", "link": "https://stackoverflow.com/users/864393/jeremy-roman"}, "reply_to_user": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 1, "creation_date": 1541356398, "post_id": 53143413, "comment_id": 93179562, "body": "Schwern&#39;s answer below covers a reasonable version of what you may be trying to achieve here."}], "tags": [], "owner": {"reputation": 15544, "user_id": 864393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59ae69e09086fed821a36d36814022c2?s=128&d=identicon&r=PG", "display_name": "Jeremy Roman", "link": "https://stackoverflow.com/users/864393/jeremy-roman"}, "is_accepted": false, "score": 3, "last_activity_date": 1541352121, "creation_date": 1541352121, "answer_id": 53143413, "question_id": 53143365, "link": "https://stackoverflow.com/questions/53143365/why-do-i-get-an-empty-variable-with-a-reference-to-interface/53143413#53143413", "title": "Why do I get an empty variable with a reference to interface?", "body": "<p>You're accessing the <code>MyValue</code> field on two different objects. Your code constructs an object, <code>myS</code>, which contains a pointer to a second object, <code>myS.si</code>.</p>\n\n<p>The first contains <code>\"test\"</code> in the <code>MyValue</code> field. The other, since it was never set, gets the default value for strings, <code>\"\"</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 1, "last_activity_date": 1541354297, "creation_date": 1541354297, "answer_id": 53143764, "question_id": 53143365, "link": "https://stackoverflow.com/questions/53143365/why-do-i-get-an-empty-variable-with-a-reference-to-interface/53143764#53143764", "title": "Why do I get an empty variable with a reference to interface?", "body": "<p><a href=\"https://stackoverflow.com/a/53143413/14660\">Jeremy covered why it's not working</a>. I think I can answer what the OP wants to do. I think there's a misunderstanding about how interfaces work. I think the OP is trying to give <code>myStruct</code> the <code>myInterface</code> interface, but interfaces are implicit.</p>\n\n<pre><code>type myInterface interface {\n    doFunc() bool\n}\n</code></pre>\n\n<p>This makes an interface <code>myInterface</code>. Things do not need to be declared to be of an interface. Anything which satisfies the interface is that interface. Anything which defines <code>doFunc() bool</code> is a <code>myInterface</code>. There's no need to declare it.</p>\n\n<blockquote>\n  <p><em>I want that the myValue will be the same for the same objects in the same structure</em> \u2013 user1365697 15 mins ago</p>\n  \n  <p><em>The idea is to create interface and then to use it from the tests and call to the same method that create the myValue and then send the relevant structure</em> \u2013 user1365697 13 mins ago\n   <a href=\"https://stackoverflow.com/users/1365697/user1365697\">OP in comment</a></p>\n</blockquote>\n\n<pre><code>type myStruct struct {\n    myValue string\n    si            myInterface \n}\n</code></pre>\n\n<p>This defines a struct which has a string, and it also has something which implements <code>myInterface</code>. Again, that's anything which defines <code>doFunc() bool</code>.</p>\n\n<p>It's important to realize that <code>myStruct.si</code> is a totally different thing with (potentially, because it's not defined) its own <code>myValue</code>.</p>\n\n<p>Instead of giving <code>myStruct</code> its own extra struct, I think what the OP intended is to give <code>myStruct</code> the <code>myInterface</code> interface. Since interfaces are implicit <code>myStruct</code> already satisfies <code>myInterface</code>. It should look like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype myInterface interface {\n    doFunc() bool\n}\n\ntype myStruct struct {\n    myValue string\n}\n\nfunc (s myStruct) doMyLogic() bool {\n    fmt.Println(s.myValue)\n    s.doFunc()\n    return false\n}\n\nfunc (s myStruct) doFunc() bool {\n    fmt.Println(s.myValue)\n    return false\n}\n\nfunc main() {\n    myS := myStruct{ myValue: \"test\" }\n    if myS.doMyLogic() {\n        return\n    }\n}\n</code></pre>\n\n<p>Because <code>myStruct</code> has <code>doFunc() bool</code> defined it satisfies the <code>myInterface</code> interface. There's no need to add an extra field for it.</p>\n\n<p>You can pass <code>myStruct</code> to anything requiring <code>myInterface</code>. That's the idea behind interfaces. Rather than making explicit declarations, anything which satisfies the interface will work. Like Duck Typing, but strict.</p>\n\n<pre><code>func usesMyInterface(s myInterface) bool {\n    return s.doFunc()\n}\n\nfunc main() {\n    myS := myStruct{ myValue: \"test\" }\n    usesMyInterface(myS)\n}\n</code></pre>\n"}], "owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 53143764, "answer_count": 2, "score": -1, "last_activity_date": 1541354297, "creation_date": 1541351905, "last_edit_date": 1541353395, "question_id": 53143365, "link": "https://stackoverflow.com/questions/53143365/why-do-i-get-an-empty-variable-with-a-reference-to-interface", "title": "Why do I get an empty variable with a reference to interface?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\ntype myInterface interface {\n    doFunc() bool\n}\n\ntype myStruct struct {\n    myValue string\n    si            myInterface \n}\n\nfunc newStrcut(si myInterface ) *myStruct {\n    return &amp;myStruct {si: si}\n}\n\nvar myS *myStruct \n\nfunc main() {\n\n    myS = newStrcut(&amp;newStrcut{})\n    myS.myValue = \"test\"\n    if myS.doMyLogic() {\n        return\n    }\n\n}\n\nfunc (s *myStruct) doMyLogic() bool {\n    fmt.Printf(s.myValue )\n    s.si.doFunc()\n    return false\n}\n\nfunc (s *myStruct) doFunc() bool {\n    fmt.Printf(s.myValue)\n    return false\n}\n</code></pre>\n\n<p>Why do I get different values for <code>s.MyValue</code> in <code>doFunc</code> and <code>doMyLogic</code>? In doMyLogic it was <code>test</code> and in doFunc it is <code>\"\"</code>.</p>\n"}, {"tags": ["go", "time", "duration", "protobuf-3"], "comments": [{"owner": {"reputation": 2284, "user_id": 2125099, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9bf0fb68f7d521aa94e45c76cb18a4b3?s=128&d=identicon&r=PG", "display_name": "fl0cke", "link": "https://stackoverflow.com/users/2125099/fl0cke"}, "edited": false, "score": 1, "creation_date": 1541348613, "post_id": 53141213, "comment_id": 93177202, "body": "try <a href=\"https://github.com/gogo/protobuf\" rel=\"nofollow noreferrer\">github.com/gogo/protobuf</a> instead of google&#39;s protobuf library. There is an <a href=\"https://github.com/gogo/protobuf/blob/master/extensions.md\" rel=\"nofollow noreferrer\">extension</a> that converts duration.Duration to time.Duration."}, {"owner": {"reputation": 372, "user_id": 1379258, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Q8ySF.jpg?s=128&g=1", "display_name": "martwetzels", "link": "https://stackoverflow.com/users/1379258/martwetzels"}, "edited": false, "score": 0, "creation_date": 1542276063, "post_id": 53141213, "comment_id": 93513792, "body": "What is unclear about the documentation? <a href=\"https://developers.google.com/protocol-buffers/docs/reference/csharp/class/google/protobuf/well-known-types/duration\" rel=\"nofollow noreferrer\">developers.google.com/protocol-buffers/docs/reference/csharp&zwnj;&#8203;/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "is_accepted": false, "score": 0, "last_activity_date": 1545222348, "creation_date": 1545222348, "answer_id": 53851236, "question_id": 53141213, "link": "https://stackoverflow.com/questions/53141213/how-to-store-time-duration-in-protobuf3/53851236#53851236", "title": "how to store time.duration in protobuf3", "body": "<p>Try this :  </p>\n\n<pre><code>go get github.com/gogo/protobuf/protoc-gen-gogofaster\n\nprotoc --gogofaster_out=./ duration.proto\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 10603597, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GirAHeRaQSw/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCy-uJ6EfTtFMAlPG-swcMcU7y5aA/mo/photo.jpg?sz=128", "display_name": "halle", "link": "https://stackoverflow.com/users/10603597/halle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1179, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1545222348, "creation_date": 1541337281, "last_edit_date": 1541380698, "question_id": 53141213, "link": "https://stackoverflow.com/questions/53141213/how-to-store-time-duration-in-protobuf3", "title": "how to store time.duration in protobuf3", "body": "<p>in proto file...</p>\n\n<pre><code>syntax = \"proto3\";\n\nimport \"google/protobuf/duration.proto\";\n\nmessage aaaResponse{\n  google.protobuf.Duration  min   = 2;\n }\n</code></pre>\n\n<p>...\nwill auto generate *duration.Duration </p>\n\n<p>how to change the proto file to get time.Duration</p>\n"}, {"tags": ["docker", "go", "docker-compose", "gocql"], "comments": [{"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1541337997, "post_id": 53141202, "comment_id": 93174287, "body": "what does <code>SELECT cql_version FROM system.local;</code> says if you run in cqlsh ?"}, {"owner": {"reputation": 1841, "user_id": 1495550, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/56b9da65c0fbf232e45e80a79e9304fa?s=128&d=identicon&r=PG", "display_name": "billdoor", "link": "https://stackoverflow.com/users/1495550/billdoor"}, "reply_to_user": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1541341081, "post_id": 53141202, "comment_id": 93175140, "body": "it says   cql_version -------------        3.4.4 - also some new info in my second edit"}], "answers": [{"tags": [], "owner": {"reputation": 1187, "user_id": 10390273, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZnPo-zLAkpE/AAAAAAAAAAI/AAAAAAAAAQ0/eDv2tBJWBWM/photo.jpg?sz=128", "display_name": "ASHWIN RAJEEV", "link": "https://stackoverflow.com/users/10390273/ashwin-rajeev"}, "is_accepted": false, "score": 0, "last_activity_date": 1541402334, "creation_date": 1541402334, "answer_id": 53149889, "question_id": 53141202, "link": "https://stackoverflow.com/questions/53141202/gocql-docker-not-found/53149889#53149889", "title": "gocql + docker &quot;not found&quot;", "body": "<p>Open your terminal and first verify the port is already is use or not using the following command </p>\n\n<pre><code>sudo lsof -i :9042\n</code></pre>\n\n<p>if It is already used the you will get a list containing the process ID. You can kill the operation by using the following command</p>\n\n<pre><code>sudo kill &lt;process ID&gt;\n</code></pre>\n\n<p>After this check all the actively running docker containers by using the following command</p>\n\n<pre><code>docker ps -a\n</code></pre>\n\n<p>Now we can remove all the docker containers using the following command</p>\n\n<pre><code>docker rm -f $(docker ps -aq)\n</code></pre>\n\n<p>After all these operation use the docker compose up command that you used in your project.</p>\n\n<pre><code>docker-compose up -d\n</code></pre>\n\n<p>Hope it will work!</p>\n"}], "owner": {"reputation": 1841, "user_id": 1495550, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/56b9da65c0fbf232e45e80a79e9304fa?s=128&d=identicon&r=PG", "display_name": "billdoor", "link": "https://stackoverflow.com/users/1495550/billdoor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 211, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1541402334, "creation_date": 1541337188, "last_edit_date": 1541343212, "question_id": 53141202, "link": "https://stackoverflow.com/questions/53141202/gocql-docker-not-found", "title": "gocql + docker &quot;not found&quot;", "body": "<p>I have a docker compose file set up like this:</p>\n\n<pre><code>version: \"3\"\nservices:\n  web:\n    image: myApp\n    container_name: web\n    environment:\n      CASSANDRA_HOSTS: \"db\"\n    ports:\n      - \"8080:8080\"\n    restart: unless-stopped\n    depends_on:\n      - cassandra\n    links:\n      - cassandra:db\n  cassandra:\n    image: cassandra\n    restart: unless-stopped\n    ports:\n      - \"9042:9042\"\n    expose:\n      - \"9042\"\n      - \"7000\"\n      - \"7001\"\n      - \"9160\"\n    volumes:\n      - \"/private/cassandra_docker/:/var/lib/cassandra\"\n</code></pre>\n\n<p>and when start the services up with <code>docker-compose up -d</code> 'web' logs:</p>\n\n<pre><code>2018/11/04 13:01:33 gocql: unable to create session: control: unable to connect to initial hosts: dial tcp 172.19.0.2:9042: connect: connection refused\n2018/11/04 13:01:39 gocql: unable to dial control conn 172.19.0.2: dial tcp 172.19.0.2:9042: connect: connection refused\n2018/11/04 13:01:39 could not open session with cassandra\n2018/11/04 13:01:39 gocql: unable to create session: control: unable to connect to initial hosts: dial tcp 172.19.0.2:9042: connect: connection refused\n2018/11/04 13:01:53 gocql: Session.handleNodeUp: 172.19.0.2:9042\n2018/11/04 13:01:53 not found\n2018/11/04 13:02:19 gocql: Session.handleNodeUp: 172.19.0.2:9042\n2018/11/04 13:02:19 not found\n</code></pre>\n\n<p>when i then use <code>docker inspect docker_cassandra_1</code> i see it having this ip address - so resolution works fine:</p>\n\n<pre><code> \"Networks\": {\n                \"docker_default\": {\n                    \"IPAMConfig\": null,\n                    \"Links\": null,\n                    \"Aliases\": [\n                        \"101ae9d068ce\",\n                        \"cassandra\"\n                    ],\n                    \"NetworkID\": \"9b416bdf21c152a7d751c264b9f42799534800f08b17ada6d90ee92d62c390bc\",\n                    \"EndpointID\": \"bc2fe3cc3fb9967e0e056d24a98b97afbc856d54f7695f8e7cfb2583a397285a\",\n                    \"Gateway\": \"172.19.0.1\",\n                    \"IPAddress\": \"172.19.0.2\",\n                    \"IPPrefixLen\": 16,\n                    \"IPv6Gateway\": \"\",\n                    \"GlobalIPv6Address\": \"\",\n                    \"GlobalIPv6PrefixLen\": 0,\n                    \"MacAddress\": \"02:42:ac:13:00:02\"\n                }\n            }\n</code></pre>\n\n<p>and in the logs of cassandra i see that the node knows what it's ip address is, and it is listening on the correct port too:</p>\n\n<blockquote>\n  <p>10:06:37,709 StorageService.java:2289 - Node /172.19.0.2 state jump to\n  NORMAL cassandra_1 \n  INFO  [main] 2018-11-04 10:06:37,737 Gossiper.java:1692 - Waiting for gossip to settle... cassandra_1\n  INFO  [main] 2018-11-04 10:06:45,745 Gossiper.java:1723 - No gossip\n  backlog; proceeding cassandra_1\n  INFO  [main] 2018-11-04\n  10:06:46,379 NativeTransportService.java:70 - Netty using native Epoll\n  event loop cassandra_1  | INFO  [main] 2018-11-04 10:06:46,496\n  ...\n  Starting listening for CQL clients on /0.0.0.0:9042 (unencrypted)...</p>\n</blockquote>\n\n<p>when <code>docker inspect web</code> i see that it has no IP Address and is stuck restarting (and cannot be stopped except by force removing the image:</p>\n\n<pre><code>\"Networks\": {\n                \"docker_default\": {\n                    \"IPAMConfig\": null,\n                    \"Links\": [\n                        \"docker_cassandra_1_9415bd9be111:cassandra_1_9415bd9be111\",\n                        \"docker_cassandra_1_9415bd9be111:db\",\n                        \"docker_cassandra_1_9415bd9be111:docker_cassandra_1_9415bd9be111\"\n                    ],\n                    \"Aliases\": [\n                        \"82f1f884ee5f\",\n                        \"web\"\n                    ],\n                    \"NetworkID\": \"9b416bdf21c152a7d751c264b9f42799534800f08b17ada6d90ee92d62c390bc\",\n                    \"EndpointID\": \"\",\n                    \"Gateway\": \"\",\n                    \"IPAddress\": \"\",\n                    \"IPPrefixLen\": 0,\n                    \"IPv6Gateway\": \"\",\n                    \"GlobalIPv6Address\": \"\",\n                    \"GlobalIPv6PrefixLen\": 0,\n                    \"MacAddress\": \"\",\n                    \"DriverOpts\": null\n                }\n            }\n</code></pre>\n\n<p>docker ps:</p>\n\n<pre><code>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                         PORTS                                                       NAMES\n82f1f884ee5f        myApp               \"/bin/bash -c '/runA\u2026\"   6 minutes ago       Restarting (1) 5 minutes ago                                                               web\nb3713664e748        cassandra           \"docker-entrypoint.s\u2026\"   6 minutes ago       Up 6 minutes                   7000-7001/tcp, 7199/tcp, 9160/tcp, 0.0.0.0:9042-&gt;9042/tcp   docker_cassandra_1\n</code></pre>\n\n<p>I also checked the system.local table in cassandra - all addresses are the correct one (the one docker dns resolves to)</p>\n\n<p>what is the problem here?</p>\n\n<p>EDIT.:</p>\n\n<p>failed to mention: <code>docker exec -it docker_cassandra_1 cqlsh</code> lets me connect to the database - so it is obviously up</p>\n\n<p>EDIT2:</p>\n\n<p>i did some further testing and installed nmap on the myApp container (and changed it to run /bin/bash on startup instead of my entrypoint script)</p>\n\n<p>this is run on the \"web\" container</p>\n\n<pre><code>Starting Nmap 7.60 ( https://nmap.org ) at 2018-11-04 14:13 UTC\nNmap scan report for db (172.19.0.2)\nHost is up (0.000061s latency).\nrDNS record for 172.19.0.2: docker_cassandra_1.docker_default\n\nPORT     STATE SERVICE\n9042/tcp open  unknown\nMAC Address: 02:42:AC:13:00:02 (Unknown)\n\nNmap done: 1 IP address (1 host up) scanned in 0.47 seconds\nroot@028dcea32e53:/run.sh \n2018/11/04 14:14:01 gocql: Session.handleNodeUp: 172.19.0.2:9042\n2018/11/04 14:14:01 not found\n</code></pre>\n\n<p><code>docker exec -it docker_cassandra_1 /bin/bash</code></p>\n\n<p>lets me connect via the external IP</p>\n\n<pre><code>csqlsh 172.19.0.2\nConnected to Test Cluster at 172.19.0.2:9042.\n[cqlsh 5.0.1 | Cassandra 3.11.3 | CQL spec 3.4.4 | Native protocol v4]\n</code></pre>\n\n<p>This is the code I connect with:</p>\n\n<pre><code>cluster := gocql.NewCluster(\"db\")\n    cluster.Keyspace = \"myApp\"\n    cluster.ProtoVersion = 4\n    cluster.Consistency = gocql.One\n    var err error\n    DataSource.Client, err = cluster.CreateSession()\n</code></pre>\n\n<p>edit:</p>\n\n<p>it also does not work when i start my app on the hosts and try to connect to 127.0.0.1, while port 9042 is exposed via -p 9042:9042</p>\n"}, {"tags": ["dictionary", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1541340741, "last_edit_date": 1541340741, "creation_date": 1541340435, "answer_id": 53141682, "question_id": 53139622, "link": "https://stackoverflow.com/questions/53139622/the-relation-between-add-key-value-and-mapassign-method-in-go1-10-3/53141682#53141682", "title": "the relation between add key/value and mapassign method in go1.10.3", "body": "<ol>\n<li><p>In the operation <code>m[k] = v</code>, the caller copies the value <code>v</code> to the address returned by <code>mapassign</code>.</p></li>\n<li><p>The comments in the function <a href=\"https://github.com/golang/go/blob/6fe8ee78e9b4870ebc1de2b5cfd6170a78a56c00/src/cmd/compile/internal/gc/reflect.go#L1070-L1096\" rel=\"nofollow noreferrer\">needkeyupdate</a> explain why some types need key updates: floating point &amp; complex -0 and 0 are equal, but different values; string might have smaller backing store.</p></li>\n</ol>\n"}], "owner": {"reputation": 1887, "user_id": 6514989, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7cc849ff19574490024b6e12ef33c82b?s=128&d=identicon&r=PG&f=1", "display_name": "nail fei", "link": "https://stackoverflow.com/users/6514989/nail-fei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 1, "accepted_answer_id": 53141682, "answer_count": 1, "score": 2, "last_activity_date": 1541340741, "creation_date": 1541325834, "question_id": 53139622, "link": "https://stackoverflow.com/questions/53139622/the-relation-between-add-key-value-and-mapassign-method-in-go1-10-3", "title": "the relation between add key/value and mapassign method in go1.10.3", "body": "<p>I am reading the source code of map in <a href=\"https://github.com/golang/go/blob/master/src/runtime/map.go\" rel=\"nofollow noreferrer\">go1.10.3</a>.It seemed there exist corresponding method about operation such as:</p>\n\n<pre><code> makemap(t *maptype, hint int, h *hmap) *hmap ==&gt; m = make(map[xx]yy)\n mapaccess1(t *maptype, h *hmap, key unsafe.Pointer)==&gt; m['key']\n</code></pre>\n\n<p>but I cant find the correspond method for the operation which add key/value as below:</p>\n\n<pre><code> m['xx']='yy'\n</code></pre>\n\n<p>there exist a method called mapassign which has some similarity with this \noperation.</p>\n\n<pre><code> mapassign(t *maptype, h *hmap, key unsafe.Pointer) unsafe.Pointer\n</code></pre>\n\n<p>this will add a new key to the map, but as we can see, <strong>the input arguments has no value</strong>. And another question is when it has already this key, it maybe update this key.</p>\n\n<pre><code>        if !alg.equal(key, k) {\n            continue\n        }\n        // already have a mapping for key. Update it.\n        if t.needkeyupdate {//why??\n            typedmemmove(t.key, k, key)\n        }\n</code></pre>\n\n<p>since the two key is equal, why should update it?</p>\n\n<p><strong>summary:</strong> <br>\n1. the relation between add key/value operation and method <em>mapassign</em>?<br>\n2. why it maybe need to update the key since the insert key and the key which has already exist is equal in mapassign method?</p>\n"}, {"tags": ["go", "asn.1"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 10601404, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IS8yU.jpg?s=128&g=1", "display_name": "Kirabou", "link": "https://stackoverflow.com/users/10601404/kirabou"}, "edited": false, "score": 0, "creation_date": 1541449021, "post_id": 53142326, "comment_id": 93213508, "body": "I did not think that for Big Int the Unmarshal destination has to be a pointer to a pointer! Thanks for pointing that to me"}], "tags": [], "owner": {"reputation": 22751, "user_id": 2399879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UxMS5.jpg?s=128&g=1", "display_name": "Crowman", "link": "https://stackoverflow.com/users/2399879/crowman"}, "is_accepted": true, "score": 4, "last_activity_date": 1541345370, "last_edit_date": 1541345370, "creation_date": 1541345044, "answer_id": 53142326, "question_id": 53139020, "link": "https://stackoverflow.com/questions/53139020/why-is-unmarshalling-of-a-der-asn-1-large-integer-limited-to-sequence-in-golang/53142326#53142326", "title": "Why is unmarshalling of a DER ASN.1 large integer limited to SEQUENCE in Golang?", "body": "<p>The documentation states that:</p>\n\n<blockquote>\n  <p>An ASN.1 INTEGER can be written to an int, int32, int64, or *big.Int\n  (from the math/big package).</p>\n</blockquote>\n\n<p>Note that the fourth option is a <code>*big.Int</code>, not a <code>big.Int</code>. You can't see it because of the auto type deduction, but the former is actually the same type as <code>r</code> in your first example, and more clearly the type of <code>X</code> in your second example, too.</p>\n\n<p>If you change your variable to a pointer, then it should work. For example, modifying your first example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/asn1\"\n    \"fmt\"\n    \"math/big\"\n)\n\n\nfunc main() {\n        r, _ := new(big.Int).SetString(\"481B6A0913BD8024CA5D22F014F3\", 16);\n        encoding, _  := asn1.Marshal(r) \n        fmt.Printf(\"% X\\n\", encoding)\n\n        var t *big.Int  // &lt;---- changed type\n        _, err := asn1.Unmarshal(encoding, &amp;t)\n        if err != nil {\n            fmt.Println(\"Erreur unmarshalling -\", err)\n        }   \n\n        fmt.Println(t.String())\n} \n</code></pre>\n\n<p>yields:</p>\n\n<pre><code>paul@horus:asn1int$ ./asn1int\n02 0E 48 1B 6A 09 13 BD 80 24 CA 5D 22 F0 14 F3\n1462505468235399478280266926003443\npaul@horus:asn1int$\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 10601404, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IS8yU.jpg?s=128&g=1", "display_name": "Kirabou", "link": "https://stackoverflow.com/users/10601404/kirabou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 656, "favorite_count": 0, "accepted_answer_id": 53142326, "answer_count": 1, "score": 4, "last_activity_date": 1541345370, "creation_date": 1541320216, "last_edit_date": 1541322716, "question_id": 53139020, "link": "https://stackoverflow.com/questions/53139020/why-is-unmarshalling-of-a-der-asn-1-large-integer-limited-to-sequence-in-golang", "title": "Why is unmarshalling of a DER ASN.1 large integer limited to SEQUENCE in Golang?", "body": "<p>I would like to be able to unmarshal a large integer from a DER file using the encoding/asn1 package, but it looks like it only works for a SEQUENCE of integers.</p>\n\n<p>For example, this does not work, which is strange because the marshaling of the Big Int works well (<a href=\"https://play.golang.org/p/Wkj0jAA6bpq\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Wkj0jAA6bpq</a>) :</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/asn1\"\n    \"fmt\"\n    \"math/big\"\n)\n\n\nfunc main() {\n        r, _ := new(big.Int).SetString(\"481B6A0913BD8024CA5D22F014F3\", 16);\n        encoding, _  := asn1.Marshal(r) \n        fmt.Printf(\"% X\\n\", encoding)               // Displayed as an integer: 02 0E 48 1B 6A 09 13 BD 80 24 CA 5D 22 F0 14 F3\n        var t big.Int\n        _, err := asn1.Unmarshal(encoding, &amp;t)\n        if err != nil {\n            fmt.Println(\"Erreur unmarshalling -\", err)  // asn1: structure error: tags don't match\n        }   \n        fmt.Println(t.String())\n} \n</code></pre>\n\n<p>It looks like I can unmarshall a large integer only if it's part of a SEQUENCE like in this example : <a href=\"https://play.golang.org/p/J93afvbk41L\" rel=\"nofollow noreferrer\">https://play.golang.org/p/J93afvbk41L</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/asn1\"\n    \"fmt\"\n    \"math/big\"\n)\n\ntype TestBigInt struct {                    // From encoding/asn1/asn1_test.go\n    X *big.Int\n}\n\nfunc main() {\n        r, _ := new(big.Int).SetString(\"481B6A0913BD8024CA5D22F014F3\", 16);\n        encoding, _  := asn1.Marshal(TestBigInt{r}) \n        fmt.Printf(\"% X\\n\", encoding)               // Displayed as a sequence of an integer: 30 10 02 0E 48 1B 6A 09 13 BD 80 24 CA 5D 22 F0 14 F3\n        var t TestBigInt\n        _, err := asn1.Unmarshal(encoding, &amp;t)\n        if err != nil {\n            fmt.Println(\"Erreur unmarshalling -\", err)  \n        }   \n        fmt.Println(t.X.String())\n} \n</code></pre>\n\n<p>However, it works well for 32 bits of 64 bits integer like in this example : <a href=\"https://play.golang.org/p/vcIgWrI-sk-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vcIgWrI-sk-</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/asn1\"\n    \"fmt\"\n)\n\nfunc main() {\n        r := 12234\n        encoding, _ := asn1.Marshal(r)\n        fmt.Printf(\"% X\\n\", encoding)\n        var t int\n        _, err := asn1.Unmarshal(encoding, &amp;t)\n        if err != nil {\n            fmt.Println(\"Erreur unmarshalling -\", err)\n        }   \n        fmt.Println(t)\n}\n</code></pre>\n\n<p>Is this a known limitation of the encoding/asn1 package ? Any known solution to unmarshal a large integer outside a SEQUENCE ?</p>\n"}, {"tags": ["go", "request", "digital-ocean", "duration", "fasthttp"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1541323221, "post_id": 53138190, "comment_id": 93170699, "body": "You are omitting the relevant code. Add the implementation for <code>handler</code>."}], "owner": {"reputation": 131, "user_id": 10472133, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-O0rxjXkeBeQ/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DU0-cr_qPS3oVBFYnZS2W0WUzttCQ/mo/photo.jpg?sz=128", "display_name": "rithik r", "link": "https://stackoverflow.com/users/10472133/rithik-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 137, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1541312078, "creation_date": 1541311356, "last_edit_date": 1541312078, "question_id": 53138190, "link": "https://stackoverflow.com/questions/53138190/high-average-request-duration-on-digitalocean-load-balancer-using-golang-fasthtt", "title": "High Average Request Duration on Digitalocean Load balancer using golang fasthttp", "body": "<p>I have a go program which takes requests processes them within 100ms and sends a response. I am using digitalocean Load Balancer and i noticed 'Average Request Duration' is pretty high around 33Kms.Below is the graph</p>\n\n<p><a href=\"https://i.stack.imgur.com/Uj9bN.png\" rel=\"nofollow noreferrer\">https://i.stack.imgur.com/Uj9bN.png</a></p>\n\n<p>Here is the code i am using...</p>\n\n<pre><code>count :=\"one\"\nn := func(ctx *fasthttp.RequestCtx) {    \nswitch count {\n case \"one\":\n  handle(ctx)     //...dosomething for 100 ms function   \n default:\n  ctx.Error(\"not found\", fasthttp.StatusNotFound)\n }\n}\nfasthttp.ListenAndServe(\":8082\", n)\n</code></pre>\n\n<p>What am i doing wrong and why isn't my program closing requests.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 777, "user_id": 1971586, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1f6027e3a9bb7094bd38fc08be15af55?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/1971586/brian"}, "edited": false, "score": 0, "creation_date": 1541308449, "post_id": 53137944, "comment_id": 93168543, "body": "For the first case, I am able to strip out all non-printable ascii by filtering out all runes with a value less than 32, however the C-style escape sequences are just the basic runes they represent (e.g. ... &quot;55 56 57 92 97 49 50&quot; in the above example)  and throw the json decoder for a loop."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1541318092, "post_id": 53137944, "comment_id": 93169859, "body": "String literals in Source must be properly escaped. Just fix that. It is unrelated to JSON."}, {"owner": {"reputation": 777, "user_id": 1971586, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1f6027e3a9bb7094bd38fc08be15af55?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/1971586/brian"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1541321739, "post_id": 53137944, "comment_id": 93170457, "body": "@Volker Since I am receiving these files from another group, I am unable to fix the data.  It&#39;s unlikely they are going to modify their system to accommodate me either."}, {"owner": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 3, "creation_date": 1541329127, "post_id": 53137944, "comment_id": 93172077, "body": "@Brian You misunderstand. The error you are seeing has to do with Go syntax. It\u2019s not JSON-related, and wouldn\u2019t ever happen when you read the JSON from somewhere other than your own code."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "reply_to_user": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 0, "creation_date": 1541331275, "post_id": 53137944, "comment_id": 93172628, "body": "@Biffen is right, you aren&#39;t really processing JSON in Go, as the input isn&#39;t compatible.  Your question is really about &quot;how can I do something with this messy data?&quot;"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1541399724, "post_id": 53137944, "comment_id": 93189268, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags\">RegEx match open tags except XHTML self-contained tags</a>"}], "answers": [{"comments": [{"owner": {"reputation": 777, "user_id": 1971586, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1f6027e3a9bb7094bd38fc08be15af55?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/1971586/brian"}, "edited": false, "score": 0, "creation_date": 1541322041, "post_id": 53138992, "comment_id": 93170512, "body": "Thanks for the tip!  I&#39;ll try it out.  For the second case, I neglected to mention that if I use <code>fmt.Println</code> to print out <code>testJsonString := &quot;{\\&quot;test_one\\&quot; : \\&quot;123456789\\\\a123456\\&quot;}&quot;</code> it appears to escape properly - but it fails to unmarshal"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "reply_to_user": {"reputation": 777, "user_id": 1971586, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1f6027e3a9bb7094bd38fc08be15af55?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/1971586/brian"}, "edited": false, "score": 0, "creation_date": 1541328764, "post_id": 53138992, "comment_id": 93171998, "body": "updated to specifically deal with other &quot;C-type&quot; escape sequences BUT it&#39;s not clear from the question if this is an acceptable way to do it.  You need to think about how double escaped sequences should be dealt with.  Maybe you need a parser"}, {"owner": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 0, "creation_date": 1541328971, "post_id": 53138992, "comment_id": 93172049, "body": "\u2018<i>According to the JSON spec <a href=\"https://jsonapi.org/format/\" rel=\"nofollow noreferrer\">jsonapi.org/format</a> non printable characters should be URI escaped</i>\u2019 No. According to <a href=\"https://tools.ietf.org/html/rfc8259#section-7\" rel=\"nofollow noreferrer\"><i>the actual JSON specification</i></a> (JSON:API \u2260 JSON), non-printable characters <i>may</i> be <i><code>\\u</code>-escaped</i>."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "reply_to_user": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 0, "creation_date": 1541330146, "post_id": 53138992, "comment_id": 93172338, "body": "@Biffen yes, I&#39;d forgot about that!  Seems the easiest thing in this case is to try uri escaping the dirty data"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 0, "last_activity_date": 1541331893, "last_edit_date": 1541331893, "creation_date": 1541319961, "answer_id": 53138992, "question_id": 53137944, "link": "https://stackoverflow.com/questions/53137944/unmarshalling-json-with-non-printable-ascii-characters/53138992#53138992", "title": "Unmarshalling JSON with non-printable ASCII characters", "body": "<p>According to the JSON spec <a href=\"https://jsonapi.org/format/\" rel=\"nofollow noreferrer\">https://jsonapi.org/format/</a> non printable characters should be URI escaped (or converted to valid unicode escapes)</p>\n\n<p>So here's a converter that makes non printable characters into their uri escaped forms.  These can then be fed into the Unmarshal</p>\n\n<p>If this isn't exactly the behaviour you need then modify the converter to remove the characters (with <code>continue</code>) or replace with a question mark rune or whatever</p>\n\n<p>BTW, the second problem with <code>\\\\a</code> does not \"print out as expected\" for me.  Please give a better example that actually shows the problem you are experiencing</p>\n\n<pre><code>    package main\n\n    import (\n        \"bytes\"\n        \"encoding/json\"\n        \"fmt\"\n        \"unicode\"\n        \"net/url\"\n    )\n\nfunc safety(d string) []byte {\n    var buffer bytes.Buffer\n    for _, c := range d {\n        s := string(c)\n        if c == 92 { // 92 is a backslash\n          continue\n        }\n        if unicode.IsPrint(c) {        \n            buffer.WriteString(s)\n        } else {\n            buffer.WriteString(url.QueryEscape(s))\n        }\n        fmt.Println(buffer.String())\n    }\n    return buffer.Bytes()\n}\n\nfunc main() {\n    testJsonString := \"{\\\"test_one\\\" : \\\"123\\x10456\\x0B789\\v123\\a456\\\"}\"\n    var dat map[string]interface{}\n    err := json.Unmarshal(safety(testJsonString), &amp;dat)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%v\", dat)\n}\n</code></pre>\n"}], "owner": {"reputation": 777, "user_id": 1971586, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1f6027e3a9bb7094bd38fc08be15af55?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/1971586/brian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1028, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1541331893, "creation_date": 1541308046, "last_edit_date": 1541322709, "question_id": 53137944, "link": "https://stackoverflow.com/questions/53137944/unmarshalling-json-with-non-printable-ascii-characters", "title": "Unmarshalling JSON with non-printable ASCII characters", "body": "<p>Using Go, how can I unmarshal a JSON string that contains unprintable ASCII characters?</p>\n\n<p>For Example</p>\n\n<pre><code>testJsonString := \"{\\\"test_one\\\" : \\\"123\\x10456\\x0B789\\v123\\a456\\\"}\"\nvar dat map[string]interface{}\nerr := json.Unmarshal([]byte(testJsonString), &amp;dat)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Yields:</p>\n\n<pre><code>panic: invalid character '\\x10' in string literal\n\ngoroutine 1 [running]:\nmain.main()\n    /tmp/sandbox903140350/main.go:14 +0x180\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/mFGWzndDK8V\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mFGWzndDK8V</a></p>\n\n<p>Unfortunately I do not have control over the source data, so I need a way to ignore or strip out the unprintable characters.</p>\n\n<p>Similarly, another data issue I'm encountering is stripping out a few C escape sequences as well - like \\0 and \\a.  If I replace string listed above with this string below, the program fails as well.  Essentially it also fails on any C escape sequence <a href=\"https://en.wikipedia.org/wiki/Escape_sequences_in_C\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Escape_sequences_in_C</a></p>\n\n<pre><code>testJsonString := \"{\\\"test_one\\\" : \\\"123456789\\\\a123456\\\"}\"\n</code></pre>\n\n<p>will error out with</p>\n\n<pre><code>panic: invalid character 'a' in string escape code\n\ngoroutine 1 [running]:\nmain.main()\n    /tmp/sandbox322770276/main.go:12 +0x100\n</code></pre>\n\n<p>This also seems to not be able to be unmarshaled, but is not able to be escaped through rune number checking or checking the unicode (since Go appears to treat it as a backslash followed by the character 'a', which are both legal)</p>\n\n<p>Is there a good way to handle these edge cases?</p>\n"}, {"tags": ["go", "rabbitmq", "amqp"], "comments": [{"owner": {"reputation": 1487, "user_id": 3668541, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/ba66d28285a3e98b836178617d096b75?s=128&d=identicon&r=PG&f=1", "display_name": "haz", "link": "https://stackoverflow.com/users/3668541/haz"}, "edited": false, "score": 0, "creation_date": 1541306159, "post_id": 53137758, "comment_id": 93168293, "body": "I fixed my &quot;repeated printing&quot; issue by re-initializing the <code>graceful</code> and <code>err</code> channels when an error is received. This makes sense, since one of the channels is closed upon disconnection. I&#39;m still confused about how <code>NotifyClose</code> works, though."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1541318135, "post_id": 53137758, "comment_id": 93169862, "body": "please provide a full reproducible example."}, {"owner": {"reputation": 1487, "user_id": 3668541, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/ba66d28285a3e98b836178617d096b75?s=128&d=identicon&r=PG&f=1", "display_name": "haz", "link": "https://stackoverflow.com/users/3668541/haz"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1541328893, "post_id": 53137758, "comment_id": 93172030, "body": "@mh-cbon I added the rest of my queue implementation, and how to instantiate it."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1541345364, "post_id": 53137758, "comment_id": 93176237, "body": "Reading at your code it appears to me your code is not in sync with the flaw of events. The reconnect sequence is triggered at some point which i think is difficult too determine precisely. Overall your implementation seems rather complex to me. You have a for loop with a dial method, yous should take advantage of this pattern to implement simpler logic, i think i it would work better out of the box."}], "owner": {"reputation": 1487, "user_id": 3668541, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/ba66d28285a3e98b836178617d096b75?s=128&d=identicon&r=PG&f=1", "display_name": "haz", "link": "https://stackoverflow.com/users/3668541/haz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1559, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1541328871, "creation_date": 1541305913, "last_edit_date": 1592644375, "question_id": 53137758, "link": "https://stackoverflow.com/questions/53137758/reconnecting-to-rabbitmq-after-disconnection", "title": "Reconnecting to RabbitMQ after disconnection", "body": "<p>I am using the recommending <a href=\"https://godoc.org/github.com/streadway/amqp#Channel.NotifyClose\" rel=\"nofollow noreferrer\">streadyway/amqp</a> library to interact with RabbitMQ inside Go.</p>\n<p>I want my service to gracefully fail when it cannot connect to RabbitMQ. This means noticing that it couldn't connect, waiting <code>n</code> seconds, and trying to reconnect (loop forever).</p>\n<p>I'm pretty sure I need use the <a href=\"https://godoc.org/github.com/streadway/amqp#Channel.NotifyClose\" rel=\"nofollow noreferrer\">Channel.NotifyClose</a> method, but I can't work it out:</p>\n<blockquote>\n<pre><code>func (ch *Channel) NotifyClose(c chan *Error) chan *Error\n</code></pre>\n<p>NotifyClose registers a listener for when the server sends a channel or connection exception in the form of a Connection.Close or Channel.Close method. Connection exceptions will be broadcast to all open channels and all channels will be closed, where channel exceptions will only be broadcast to listeners to this channel.</p>\n<p>The chan provided will be closed when the Channel is closed and on a graceful close, no error will be sent.</p>\n</blockquote>\n<p>This is what I attempted:</p>\n<pre><code>graceful := make(chan *amqp.Error)\nerrs := channel.NotifyClose(graceful)\nfor {\n    case &lt;-graceful:\n        fmt.Println(&quot;Graceful close!&quot;)\n        reconnect()\n    case &lt;-errs:\n        fmt.Println(&quot;Not graceful close&quot;)\n        reconnect()\n}\n</code></pre>\n<p>Sometimes, this works! Othertimes, after reconnecting, it will repeatedly print out:</p>\n<pre><code>2018/11/04 15:29:26 Other close\n2018/11/04 15:29:26 Connected!\n2018/11/04 15:29:26 Graceful close!\n2018/11/04 15:29:26 Connected!\n2018/11/04 15:29:26 Other close\n2018/11/04 15:29:26 Connected!\n2018/11/04 15:29:26 Graceful close!\n...\n</code></pre>\n<p>Very rapidly.</p>\n<p>I want to be able to run the service in one terminal, and rabbit in the other. I should be able to stop &amp; restart rabbit whenever I like, with the service reconnecting consistently.</p>\n<p>I'm a bit confused about the <code>NotifyClose</code> method - is the <code>c</code> chan just closed when the connection is closed? Why does it return another channel?</p>\n<p>Cheers.</p>\n<hr />\n<p>My entire code. This doesn't have a <code>push</code> or <code>pop</code> function, because this is a minimal example to demonstrate re-connecting when a connection fails. Push and pop implementations would depend upon how reconnection is implemented.</p>\n<p>Any code review comments also welcome.</p>\n<pre><code>package main\n\nimport (\n    &quot;github.com/streadway/amqp&quot;\n    &quot;io&quot;\n    &quot;log&quot;\n    &quot;sync&quot;\n    &quot;time&quot;\n)\n\n// RabbitMQ ...\ntype RabbitMQ struct {\n    Logger      *log.Logger\n    IsConnected bool\n    addr        string\n    name        string\n    connection  *amqp.Connection\n    channel     *amqp.Channel\n    queue       *amqp.Queue\n    wg          *sync.WaitGroup\n    done        chan bool\n}\n\nconst retryDelay = 5 * time.Second\n\n// NewQueue creates a new queue instance.\nfunc NewQueue(logOut io.Writer, name string, addr string) *RabbitMQ {\n    rabbit := RabbitMQ{\n        IsConnected: false,\n        addr:        addr,\n        name:        name,\n        wg:          new(sync.WaitGroup),\n        done:        make(chan bool),\n        Logger:      log.New(logOut, &quot;&quot;, log.LstdFlags),\n    }\n    rabbit.wg.Add(1)\n    rabbit.Connect()\n    go rabbit.reconnect()\n    return &amp;rabbit\n}\n\n// reconnect waits to be notified about a connection\n// error, and then attempts to reconnect to RabbitMQ.\nfunc (rabbit *RabbitMQ) reconnect() {\n    defer rabbit.wg.Done()\n    graceful := make(chan *amqp.Error)\n    errs := rabbit.channel.NotifyClose(graceful)\n    for {\n        select {\n        case &lt;-rabbit.done:\n            return\n        case &lt;-graceful:\n            graceful = make(chan *amqp.Error)\n            rabbit.Logger.Println(&quot;Graceful close!&quot;)\n            rabbit.IsConnected = false\n            rabbit.Connect()\n            rabbit.IsConnected = true\n            errs = rabbit.channel.NotifyClose(graceful)\n        case &lt;-errs:\n            graceful = make(chan *amqp.Error)\n            rabbit.Logger.Println(&quot;Normal close&quot;)\n            rabbit.IsConnected = false\n            rabbit.Connect()\n            errs = rabbit.channel.NotifyClose(graceful)\n        }\n    }\n}\n\n// Connect will block until a new connection to\n// RabbitMQ is formed.\nfunc (rabbit *RabbitMQ) Connect() {\n    for {\n        conn, err := amqp.Dial(rabbit.addr)\n        if err != nil {\n            rabbit.Logger.Println(&quot;Failed to establish connection&quot;)\n            time.Sleep(retryDelay)\n            continue\n        }\n        ch, err := conn.Channel()\n        if err != nil {\n            rabbit.Logger.Println(&quot;Failed to create a channel&quot;)\n            time.Sleep(retryDelay)\n            continue\n        }\n        queue, err := ch.QueueDeclare(\n            name,\n            false, // Durable\n            false, // Delete when unused\n            false, // Exclusive\n            false, // No-wait\n            nil,   // Arguments\n        )\n        if err != nil {\n            rabbit.Logger.Println(&quot;Failed to publish a queue&quot;)\n            time.Sleep(retryDelay)\n            continue\n        }\n        rabbit.Logger.Println(&quot;Connected!&quot;)\n        rabbit.IsConnected = true\n        rabbit.connection = conn\n        rabbit.channel = ch\n        rabbit.queue = &amp;queue\n        return\n    }\n}\n\n// Close the connection to RabbitMQ and stop\n// checking for reconnections.\nfunc (rabbit *RabbitMQ) Close() error {\n    close(rabbit.done)\n    rabbit.wg.Wait()\n    return rabbit.connection.Close()\n}\n</code></pre>\n<p>And how this is used:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;os&quot;\n)\n\nconst (\n    name = &quot;job_queue&quot;\n    addr = &quot;amqp://guest:guest@localhost:5672/&quot;\n)\n\nfunc main() {\n    fmt.Println(&quot;Starting...&quot;)\n    NewQueue(os.Stdout, name, addr)\n    for {}\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "goinstall"], "answers": [{"tags": [], "owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "is_accepted": false, "score": 2, "last_activity_date": 1541348320, "last_edit_date": 1541348320, "creation_date": 1541329169, "answer_id": 53140084, "question_id": 53137590, "link": "https://stackoverflow.com/questions/53137590/including-pkg-in-dockerignore-file/53140084#53140084", "title": "Including pkg in .dockerignore file", "body": "<p>Personally, I think copying <code>pkg</code> folder from host to image is not a good idea because :</p>\n\n<ul>\n<li>it tightly couples the place from where you are building the image (your host) and the image itself. You could potentially have differences in resulting images depending on where you build the image, and that's probably what you don't want</li>\n<li>moreover, if you have automated builds (from CI for example), you're probably rebuilding the whole application from a <strong>clean environment</strong> each time, so there is no initial <code>pkg</code> folder to copy.</li>\n</ul>\n\n<p>If you're familiar with Java world, I've already encountered that problem for images built with Maven. To speed up the build, some people are copying their local Maven repository (<code>~/.m2</code>) in the image to avoid redownloading artifacts. I don't particularly agree with that, since there is always a risk that their <code>.m2</code> folder contains corrupted artifacts : therefore, the image built on their machine will be different than if it was built on a clean environment. It depends on whether you want to have consistent builds or quick builds (I prefer the former).</p>\n\n<p>In conclusion, I think that building images from a clean environment, without depending on the host where the image is built, is a good practice. That's why I personally would not copy any files (except application source code!) inside the image.</p>\n"}], "owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1541367236, "creation_date": 1541303245, "question_id": 53137590, "link": "https://stackoverflow.com/questions/53137590/including-pkg-in-dockerignore-file", "title": "Including pkg in .dockerignore file", "body": "<p>Right now my .dockerignore file has this contents:</p>\n\n<pre><code>.vscode\n.idea\n.git\nbin\npkg\n</code></pre>\n\n<p>and my Dockerfile looks like:</p>\n\n<pre><code>FROM golang:latest\nRUN mkdir -p /app\nWORKDIR /app\nCOPY . .\nENV GOPATH /app\nRUN go install huru\nEXPOSE 3000\nENTRYPOINT /app/bin/huru\n</code></pre>\n\n<p>My question is - should I be copying the pkg folder from host to image or not? Right now I am not, as my dockerignore file makes clear.</p>\n\n<p>I get the feeling that I should just COPY the pkg folder from host to image, because that might have pre-built files in it that <code>go install</code> can use instead of re-downloading the source from github etc?</p>\n"}, {"tags": ["http", "go", "websocket"], "comments": [{"owner": {"reputation": 145, "user_id": 8278045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12209c01a07e31c5c1b2ce9ea9d318c0?s=128&d=identicon&r=PG&f=1", "display_name": "Greg Gilley", "link": "https://stackoverflow.com/users/8278045/greg-gilley"}, "edited": false, "score": 0, "creation_date": 1579837957, "post_id": 53136746, "comment_id": 105908605, "body": "Did you ever find a way to make ReverseProxy work?"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "reply_to_user": {"reputation": 145, "user_id": 8278045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12209c01a07e31c5c1b2ce9ea9d318c0?s=128&d=identicon&r=PG&f=1", "display_name": "Greg Gilley", "link": "https://stackoverflow.com/users/8278045/greg-gilley"}, "edited": false, "score": 0, "creation_date": 1580059320, "post_id": 53136746, "comment_id": 105964982, "body": "@GregGilley Yes, I wrote a custom, low-level (e.g. <code>io.Copy</code>) WebSocket reverse proxy that worked well. I can&#39;t share it because my employer owns the code and it&#39;s not open source. However I have since been able to replace that with the standard <code>httputil.ReverseProxy</code> and that is also working well."}, {"owner": {"reputation": 145, "user_id": 8278045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12209c01a07e31c5c1b2ce9ea9d318c0?s=128&d=identicon&r=PG&f=1", "display_name": "Greg Gilley", "link": "https://stackoverflow.com/users/8278045/greg-gilley"}, "edited": false, "score": 0, "creation_date": 1580148587, "post_id": 53136746, "comment_id": 105994879, "body": "My problem was my RoundTrip handler. I was printing out the buffer for debugging and it caused the &quot;non-writable buffer&quot; problem. Thanks for replying!"}], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 395, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1580059205, "creation_date": 1541291360, "last_edit_date": 1580059205, "question_id": 53136746, "link": "https://stackoverflow.com/questions/53136746/unusable-response-body-in-websocket-reverse-proxy", "title": "Unusable Response Body in WebSocket Reverse Proxy", "body": "<p>Update: Go 1.12 added <code>httputil.ReverseProxy</code> support for WebSocket traffic. The answer to this question is now to upgrade your version of Go.</p>\n\n<hr>\n\n<p>Go's <a href=\"https://golang.org/pkg/net/http/httputil/#ReverseProxy\" rel=\"nofollow noreferrer\">httputil.ReverseProxy</a> doesn't work for <a href=\"https://tools.ietf.org/html/rfc6455\" rel=\"nofollow noreferrer\">WebSocket</a> traffic. The issues with it are detailed <a href=\"https://github.com/golang/go/issues/26937#issuecomment-419321249\" rel=\"nofollow noreferrer\">here</a>.  It looks like the fix/feature may be released in Go 1.12 (see \"added this to the Go1.12 milestone\" <a href=\"https://github.com/golang/go/issues/26937\" rel=\"nofollow noreferrer\">here</a>).</p>\n\n<p>As the fix/feature is not out yet, I am trying to write my own reverse proxy to solve the problem until it is released.  On my server, I wrote a simple <a href=\"https://github.com/gorilla/websocket\" rel=\"nofollow noreferrer\">gorilla/websocket</a> handler that upgrades the connection and then waits for a message from the client.</p>\n\n<p>On my reverse proxy server, I wrote a reverse proxy handler based on the Go 1.12 change submission <a href=\"https://go-review.googlesource.com/c/go/+/146437/\" rel=\"nofollow noreferrer\">here</a>, especially the additions in <a href=\"https://go-review.googlesource.com/c/go/+/146437/2/src/net/http/httputil/reverseproxy.go\" rel=\"nofollow noreferrer\">reverseproxy.go</a>.  Here is the core of my reverse proxy handler, in relevant part:</p>\n\n<pre><code>outreq := r.WithContext(ctx)\nif r.ContentLength == 0 {\n    outreq.Body = nil\n}\np.director(outreq)\noutreq.Header = copyHeaders(browserHeaders)\nsetForwardHeader(r.RemoteAddr, outreq)\nlog.Infof(\"outreq URL is %+v\", outreq.URL)\n\ntransport := http.DefaultTransport\nres, err := transport.RoundTrip(outreq)\nif err != nil {\n    log.Errorf(\"RoundTrip(outreq) failed: %s\", err)\n}\nlog.Infof(\"Server response was %+v\", res)\n\nif res.StatusCode != http.StatusSwitchingProtocols {\n    log.Errorf(\"Did not receive HTTP status 101 switchingn protocols: %d\\n\", res.StatusCode)\n    return\n}\nif !hasUpgradeHeaders(res.Header) {\n    log.Error(\"request does not contain upgrade headers\")\n    return\n}\nbackConn, ok := res.Body.(io.ReadWriteCloser)\nif !ok {\n    log.Errorf(\"internal error: 101 switching protocols response with non-writable body: %v (%T)\", res.Body, res.Body)\n    return\n}\n</code></pre>\n\n<p>When I try to connect a websocket from my browser, I get as far as that last if statement.  The type assertion of the response body to type <code>io.ReadWriteCloser</code> failed.  When I log the response I see this:</p>\n\n<pre><code>Server response was &amp;{Status:101 Switching Protocols StatusCode:101 Proto:HTTP/1.1 \nProtoMajor:1 ProtoMinor:1 Header:map[Upgrade:[websocket] Connection:[Upgrade]\nSec-Websocket-Accept:[B1fWETPTtNo0bAHFWkFn2lAm9iw=]] Body:{} ContentLength:0 \nTransferEncoding:[] Close:false Uncompressed:false \nTrailer:map[] Request:0xc000112100 TLS:&lt;nil&gt;}\n</code></pre>\n\n<p>The error log output is this:</p>\n\n<p><code>ERRO[0012] internal error: 101 switching protocols response with non-writable body: {} (http.noBody)</code></p>\n\n<p>Why am I getting <code>http.noBody</code> in the response body rather than something implementing the <code>io.ReadWriteCloser</code> interface?  How can I resolve the issue so that I can proceed to <a href=\"https://golang.org/pkg/net/http/#Hijacker\" rel=\"nofollow noreferrer\">hijack</a> the connection and facilitate communication between the browser and the server?</p>\n\n<h2>Update</h2>\n\n<p>I think I found the answer to the \"why\" question.  The latest release of Go does not include this line in persistConn's readLoop function in transport.go in the net/http package:</p>\n\n<pre><code>if resp.isProtocolSwitch() {\n    resp.Body = newReadWriteCloserBody(pc.br, pc.conn)\n}\n</code></pre>\n\n<p><a href=\"https://go-review.googlesource.com/c/go/+/131279/4/src/net/http/transport.go#1862\" rel=\"nofollow noreferrer\">Source</a></p>\n\n<p>Compare to current <a href=\"https://golang.org/src/net/http/transport.go\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Any ideas for how to resolve?</p>\n"}, {"tags": ["go", "command", "command-line-interface"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1541318205, "post_id": 53135210, "comment_id": 93169878, "body": "<a href=\"https://golang.org/pkg/os/exec/#Cmd.Run\" rel=\"nofollow noreferrer\">golang.org/pkg/os/exec/#Cmd.Run</a>"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1541332016, "post_id": 53135210, "comment_id": 93172809, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/39478181/how-to-get-output-from-stdout-into-a-string-in-golang\">How to get output from stdout into a string in golang</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1541278216, "post_id": 53135300, "comment_id": 93163963, "body": "HI, why the wait is after the <code>for scanner </code> ?  the for shouldnt be after the wait ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1541278578, "post_id": 53135300, "comment_id": 93164049, "body": "and can I somehow get all the value to 1 string ?"}, {"owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "edited": false, "score": 0, "creation_date": 1541285969, "post_id": 53135300, "comment_id": 93165619, "body": "You can append to a string"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1541324372, "post_id": 53135300, "comment_id": 93170975, "body": "This code should never terminate. scanner.Scan returns true until the reader is closed, but the reader isn&#39;t closed until Wait is called."}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": false, "score": 2, "last_activity_date": 1541277496, "creation_date": 1541277496, "answer_id": 53135300, "question_id": 53135210, "link": "https://stackoverflow.com/questions/53135210/running-os-execute-to-get-the-output/53135300#53135300", "title": "Running os.execute to get the output", "body": "<p>You won't directly have an output, since the commands takes some time before it writes in stdout/stderr, so you need to basically wait for something to come out.</p>\n\n<p>The way you can do it is by using <code>bufio.NewScanner</code>, like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os/exec\"\n    \"strings\"\n)\n\nfunc main() {\n    args := \"get apps\"\n    cmd := exec.Command(\"ftr\", strings.Split(args, \" \")...)\n    cmd.Dir = \"./testdata/\"\n\n    stdout, _ := cmd.StdoutPipe()\n    cmd.Start()\n\n    scanner := bufio.NewScanner(stdout)\n    scanner.Split(bufio.ScanWords)\n\n    for scanner.Scan() {\n        m := scanner.Text()\n        fmt.Println(m)\n    }\n\n    cmd.Wait()\n}\n</code></pre>\n\n<p>If your command writes on stderr instead of stdout, you might need to use <code>cmd.StderrPipe</code> instead of <code>cmd.Stdoutpipe</code> in order to get the output.</p>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 1, "last_activity_date": 1541331793, "last_edit_date": 1541331793, "creation_date": 1541324685, "answer_id": 53139479, "question_id": 53135210, "link": "https://stackoverflow.com/questions/53135210/running-os-execute-to-get-the-output/53139479#53139479", "title": "Running os.execute to get the output", "body": "<p>Calling both Start and Output is redundant.</p>\n\n<blockquote>\n  <p>Output runs the command and returns its standard output.</p>\n</blockquote>\n\n<p>Start is used to run the command asynchronously. Simply remove that call:</p>\n\n<pre><code>    cmd := exec.Command(\"ftr\", \"get\", \"apps\")\n    cmd.Dir = \"./testdata/\"\n    b, err := cmd.Output()\n    fmt.Println(string(b), err)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1541331793, "creation_date": 1541276852, "last_edit_date": 1541277495, "question_id": 53135210, "link": "https://stackoverflow.com/questions/53135210/running-os-execute-to-get-the-output", "title": "Running os.execute to get the output", "body": "<p>Im using the following code which run command against binary and need to provide output </p>\n\n<p>if I run the command <code>ftr get apps</code> in the in my mac I got </p>\n\n<p><code>[app1 apps2]</code></p>\n\n<p>Now I copy the binary to the test data folder\nand run the code below and I want to get the apps, currenlty there is no error but Im not getting also the data, what could be missing here?</p>\n\n<pre><code>    Cmd := exec.Command(\"ftr\", \"get\", \"apps\")\n    Cmd.Dir = \"./testdata/\"\n    err := Cmd.Start()\n    fmt.Println(err)\n    bytes, e := Cmd.Output()\n    fmt.Println(bytes, e)\n</code></pre>\n"}, {"tags": ["postgresql", "go", "go-gorm", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 399, "user_id": 8555793, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4243175498f555ba9f34a34bbe561c00?s=128&d=identicon&r=PG&f=1", "display_name": "JesterWest", "link": "https://stackoverflow.com/users/8555793/jesterwest"}, "is_accepted": true, "score": 1, "last_activity_date": 1541339168, "creation_date": 1541339168, "answer_id": 53141480, "question_id": 53132474, "link": "https://stackoverflow.com/questions/53132474/create-new-struct-and-append-it-to-array-in-a-one-to-many-relationship/53141480#53141480", "title": "Create new struct and append it to array in a one to many relationship", "body": "<p>Solved the problem. It turns out there was some problem with the database table. Although I got auto migrate enable, there was a problem with some ids that were null.</p>\n\n<p>Here is the working route:</p>\n\n<pre><code>func CreateMeasurement(c *gin.Context) {\n    id := c.Params.ByName(\"id\")\n    var station Station\n    if err := db.Where(\"id = ?\", id).First(&amp;station).Error; err != nil {\n        c.AbortWithStatus(404)\n        fmt.Println(err)\n    } else {\n        var measurement Measurement\n        c.BindJSON(&amp;measurement)\n\n        db.Model(&amp;station).Association(\"Measurements\").Append(&amp;measurement)\n        c.JSON(200, station)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 399, "user_id": 8555793, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4243175498f555ba9f34a34bbe561c00?s=128&d=identicon&r=PG&f=1", "display_name": "JesterWest", "link": "https://stackoverflow.com/users/8555793/jesterwest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 53141480, "answer_count": 1, "score": 2, "last_activity_date": 1541339168, "creation_date": 1541256911, "last_edit_date": 1541273239, "question_id": 53132474, "link": "https://stackoverflow.com/questions/53132474/create-new-struct-and-append-it-to-array-in-a-one-to-many-relationship", "title": "Create new struct and append it to array in a one to many relationship", "body": "<p>I'm trying to append a new item to an array in a one-to-many relationship. The problem is that one of the IDs is always undefined and the model I want to append to does not get updated.</p>\n\n<p>I have the following models:</p>\n\n<pre><code>type Station struct {\n    gorm.Model\n    Name         string\n    Measurements []Measurement\n    PlantID      uint64\n    Plant        Plant\n}\n\ntype Measurement struct {\n    ID             uint64 `gorm:\"primary_key\"`\n    StationID      uint64\n    TempSensor     float32\n    LightSensor    float32\n    HumiditySensor float32\n    CreatedAt      time.Time\n}\n\ntype Plant struct {\n    gorm.Model\n    Name string\n}\n</code></pre>\n\n<p>This is the route to which I'm sending the post request:</p>\n\n<pre><code>/stations/:id/measurements\n</code></pre>\n\n<p>This is the current route handler that I have:</p>\n\n<pre><code>func CreateMeasurement(c *gin.Context) {\n    id := c.Params.ByName(\"id\")\n    var station Station\n    if err := db.Where(\"id = ?\", id).First(&amp;station).Error; err != nil {\n        c.AbortWithStatus(404)\n        fmt.Println(err)\n    } else {\n        var measurement Measurement\n        c.BindJSON(&amp;measurement)\n\n        // Convert params string to uint\n        convertedID, err := strconv.ParseUint(id, 10, 64)\n        if err != nil {\n            fmt.Println(err)\n        }\n        measurement.StationID = convertedID\n\n        db.Model(&amp;station).Association(\"Measurements\").Append(&amp;measurement)\n        db.Save(&amp;station)\n        c.JSON(200, station)\n    }\n}\n</code></pre>\n\n<hr>\n\n<p><strong>Question</strong>: How can I create a new <code>Measurement</code> item and append it to the <code>[]Measurement</code> array in a specific <code>Station</code> which is specified by the route parameters?</p>\n"}, {"tags": ["javascript", "html", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1541254261, "post_id": 53131917, "comment_id": 93157712, "body": "Add a new endpoint to your Go server, one that will serve only the row that you want to refresh, implement a new handler that will handle the requests to that endpoint and have the handler write the row in json format. With that in place add a jascript on-click event listener to the the HTML table and have it send an XMLHttpRequest to the new Go endpoint, when the response comes back have the js listener use the returned json to update the clicked row."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1541254879, "post_id": 53131917, "comment_id": 93157875, "body": "See similar examples: <a href=\"https://stackoverflow.com/questions/41136000/creating-load-more-button-in-golang-with-templates/41138344#41138344\">Creating load more button in Golang with templates</a>; <a href=\"https://stackoverflow.com/questions/41197376/interactive-web-pages-in-go/41198615#41198615\">Interactive web pages in Go</a>; <a href=\"https://stackoverflow.com/questions/37118281/dynamically-refresh-a-part-of-the-template-when-a-variable-is-updated-golang/37119014#37119014\">Dynamically refresh a part of the template when a variable is updated golang</a>."}, {"owner": {"reputation": 1, "user_id": 10342776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ad4f6db090f0a1c2f7264907df4afc4?s=128&d=identicon&r=PG&f=1", "display_name": "Madpeky", "link": "https://stackoverflow.com/users/10342776/madpeky"}, "edited": false, "score": 0, "creation_date": 1541279594, "post_id": 53131917, "comment_id": 93164295, "body": "Ok thanks to you both."}, {"owner": {"reputation": 1, "user_id": 10342776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ad4f6db090f0a1c2f7264907df4afc4?s=128&d=identicon&r=PG&f=1", "display_name": "Madpeky", "link": "https://stackoverflow.com/users/10342776/madpeky"}, "edited": false, "score": 0, "creation_date": 1541279644, "post_id": 53131917, "comment_id": 93164316, "body": "Got it to work in one way, I sent data from Javascript to Goland and Im able to print it (all cell of a specific row). But in main.Go when i try to iterate through the data with a &#39;range&#39; it says &#39;impossible cause of rune type&#39;. Is it the default format ? Do i have to convert the rune data to string ?"}], "owner": {"reputation": 1, "user_id": 10342776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ad4f6db090f0a1c2f7264907df4afc4?s=128&d=identicon&r=PG&f=1", "display_name": "Madpeky", "link": "https://stackoverflow.com/users/10342776/madpeky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1541344327, "creation_date": 1541252628, "last_edit_date": 1541344327, "question_id": 53131917, "link": "https://stackoverflow.com/questions/53131917/how-to-rgefresh-a-specific-row-of-a-html-table-when-click-on-a-cell", "title": "How to rgefresh a specific row of a HTML table when click on a cell", "body": "<p>First sorry for my bad english, I'll try to do my best.</p>\n\n<p>Im trying to create a webapp that shows the name of servers, their IPs, ping, ports, etc...</p>\n\n<p>Here is a part of my code:</p>\n\n<p><strong>MAIN.GO :</strong></p>\n\n<pre><code>type Widget struct {\nIpport  string\nNumber  string\nState   string\nColport string\nBlink   string\n}\n\ntype resulthtml struct {\nName       string\nAffordi    string\nAfflieu    string\nAffip      string\nAffresping string\nAffresport string\nAffport    string\nAffactif   string\nColping    string\nLisports   []Widget\nBlink      string\n}\n\nvar prout []resulthtml\n\n// 80% of the missing code is here like ping function, etc, etc\n\nfunc main() {\n\n//.........some code here.............\n\n    http.Handle(\"/favicon.ico\", http.NotFoundHandler())\n    http.HandleFunc(\"/\", affichagePing)\n    http.ListenAndServe(\":2692\", nil)\n}\n\n\nfunc affichagePing(w http.ResponseWriter, r *http.Request) {\n\n    tmpl := template.Must(template.ParseFiles(\"test.html\"))\n    tmpl.Execute(w, prout)\n}\n</code></pre>\n\n<p>And <strong>TEST.HTML :</strong></p>\n\n<pre><code>        &lt;div id=\"cadre_affich1\"&gt;\n        &lt;table id=\"Affichageglobal\"&gt;\n        &lt;thead&gt;\n                &lt;tr&gt;    \n                    &lt;th class=\"AffichageLigneT\" style=\"width: 3%;\"&gt;&lt;/th&gt;\n                    &lt;th class=\"AffichageLigneT\" style=\"width: 15%;\"&gt;Name&lt;/th&gt;\n                    &lt;th class=\"AffichageLigneT\" style=\"width: 8%;\"&gt;Type&lt;/th&gt;\n                    &lt;th class=\"AffichageLigneT\" style=\"width: 6%;\"&gt;Place&lt;/th&gt;\n                    &lt;th class=\"AffichageLigneT\" style=\"width: 14%;\"&gt;IP&lt;/th&gt;\n                    &lt;th class=\"AffichageLigneT\" style=\"width: 10%;\"&gt;Ping&lt;/th&gt;\n                    &lt;th class=\"AffichageLigneT\" style=\"width: 41%;\"&gt;Ports&lt;/th&gt;\n                    &lt;th class=\"AffichageLigneT\" style=\"width: 3%;\"&gt;&lt;/th&gt;\n                &lt;/tr&gt;\n            &lt;/thead&gt;\n            &lt;tbody&gt;\n                {{range .}}\n                &lt;tr&gt;\n                    &lt;td class=\"AffichageLigneRefr\"&gt;&lt;/td&gt;\n                    &lt;td class=\"AffichageLigneNom\"&gt;&lt;span class=\"AffichageStatut\" style=\"background-color:{{.Colping}}\"&gt;&lt;/span&gt;&lt;span&gt;{{.Name}}&lt;/span&gt;&lt;/td&gt;\n                    &lt;td class=\"AffichageLigneType\"&gt;{{.Affordi}}&lt;/td&gt;\n                    &lt;td class=\"AffichageLigneLieu\"&gt;{{.Afflieu}}&lt;/td&gt;\n                    &lt;td class=\"AffichageLigneIP\"&gt;{{.Affip}}&lt;/td&gt;                        \n                    &lt;td class=\"AffichageLigneResPing\"&gt;&lt;span class={{.Blink}} style=\"color:{{.Colping}}\"&gt;{{.Affresping}}&lt;/span&gt;&lt;/td&gt;                     \n                    &lt;td class=\"AffichageLignePorts\"&gt;{{range $v := .Lisports}}&lt;span class={{$v.Blink}}&gt;{{$v.Number}}&lt;/span&gt;{{end}}&lt;/td&gt;\n                    &lt;td class=\"AffichageLigneEdit\"&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n                {{end}}\n            &lt;/tbody&gt;\n        &lt;/table&gt;\n    &lt;/div&gt;\n</code></pre>\n\n<p>I have no problem displaying what I want. Now I want to refresh a <strong>specific row without reloading the whole page</strong> (its ping, name, etc...) when I click on the first cell of it. I know I have to do it through Javascript that will send informations to a Go Handler but well, I spent hours and tried so many things...</p>\n\n<p>I can't get it to work.</p>\n\n<p>Thank you very much.</p>\n"}]