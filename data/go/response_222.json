[{"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 117, "user_id": 10096250, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHa1mu8bbSY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pg9uZTR5XzQA3e2QUPjP-guqL_yA/mo/photo.jpg?sz=128", "display_name": "jmacnc", "link": "https://stackoverflow.com/users/10096250/jmacnc"}, "edited": false, "score": 0, "creation_date": 1554944103, "post_id": 55622798, "comment_id": 97939266, "body": "Found the answer in this question <a href=\"https://stackoverflow.com/questions/54963232/mongo-go-driver-find-a-document-by-id\" title=\"mongo go driver find a document by id\">stackoverflow.com/questions/54963232/&hellip;</a>"}, {"owner": {"reputation": 117, "user_id": 10096250, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHa1mu8bbSY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pg9uZTR5XzQA3e2QUPjP-guqL_yA/mo/photo.jpg?sz=128", "display_name": "jmacnc", "link": "https://stackoverflow.com/users/10096250/jmacnc"}, "edited": false, "score": 0, "creation_date": 1554944142, "post_id": 55622798, "comment_id": 97939280, "body": "<code>oid, _ := primitive.ObjectIDFromHex(&quot;5c9ed92ef16b6f3380b2ddce&quot;)</code>"}], "owner": {"reputation": 117, "user_id": 10096250, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHa1mu8bbSY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pg9uZTR5XzQA3e2QUPjP-guqL_yA/mo/photo.jpg?sz=128", "display_name": "jmacnc", "link": "https://stackoverflow.com/users/10096250/jmacnc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "closed_date": 1554990234, "answer_count": 0, "score": 0, "last_activity_date": 1554940178, "creation_date": 1554940178, "question_id": 55622798, "link": "https://stackoverflow.com/questions/55622798/find-document-by-object-id-converting-string-to-objectid", "closed_reason": "Duplicate", "title": "Find document by Object ID - Converting string to objectID", "body": "<p>I am trying to find documents but \"_id\". This is for a GET call. A variable in the url will produce a string. The string in the URL will be the documentID.</p>\n\n<p>This is what I have so far</p>\n\n<pre><code>oid := \"5c9ed92ef16b6f3380b2ddce\"\n    filter := bson.M{\"_id\": oid}\n    err := db.Collection(\"products\").FindOne(context.Background(), filter).Decode(&amp;result)\n</code></pre>\n\n<p>Am I formatting the filter wrong? Should I be converting the string to an objectID type?</p>\n"}, {"tags": ["go", "logging", "kubernetes", "google-kubernetes-engine", "google-cloud-stackdriver"], "answers": [{"tags": [], "owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "is_accepted": false, "score": 0, "last_activity_date": 1555298447, "creation_date": 1555298447, "answer_id": 55682194, "question_id": 55622289, "link": "https://stackoverflow.com/questions/55622289/stackdriver-logs-not-showing-up-in-gke/55682194#55682194", "title": "Stackdriver logs not showing up in GKE", "body": "<p>See here:</p>\n\n<p><a href=\"https://cloud.google.com/kubernetes-engine/docs/tutorials/authenticating-to-cloud-platform\" rel=\"nofollow noreferrer\">https://cloud.google.com/kubernetes-engine/docs/tutorials/authenticating-to-cloud-platform</a></p>\n\n<p>Your containerized client is unable to authenticate against the Cloud Platform Logging service.</p>\n\n<p>You don't explain how you're authenticating when running the client locally but this mechanism needs to be reproduced on Kubernetes.</p>\n\n<p>If you check the container's logs, these should confirm the failure to authenticate against the Logging service.</p>\n\n<p>HTH!</p>\n"}, {"tags": [], "owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "is_accepted": true, "score": 0, "last_activity_date": 1555524441, "creation_date": 1555524441, "answer_id": 55733601, "question_id": 55622289, "link": "https://stackoverflow.com/questions/55622289/stackdriver-logs-not-showing-up-in-gke/55733601#55733601", "title": "Stackdriver logs not showing up in GKE", "body": "<p>So the solution was simplier than I was expecting.  I don't fully understand it yet but appears to be how stackdriver works.</p>\n\n<p>When I run locally then my logs show up under  Google Project --> Project ID --> Log Name</p>\n\n<p>When I run in GKE then it shows up in VM Instance --> Instance ID (or all Instance) --> Log Name</p>\n\n<p>I would actually expect it to show up under google project all the time.  Either it doesn't or I misconfigured Stackdriver.</p>\n"}], "owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 740, "favorite_count": 0, "accepted_answer_id": 55733601, "answer_count": 2, "score": 1, "last_activity_date": 1555524441, "creation_date": 1554936285, "question_id": 55622289, "link": "https://stackoverflow.com/questions/55622289/stackdriver-logs-not-showing-up-in-gke", "title": "Stackdriver logs not showing up in GKE", "body": "<p>I am unable to see log messages that are sent from my GKE clusters using Golang.   They work fine when running locally but not from the container running in GKE.  Clearly something is misconfigured in GKE but I don't see any errors but not really sure where to look.  Any insight or places to check would be very useful.</p>\n\n<p>Below is my code and my cluster scopes (if it helps).</p>\n\n<p>Thanks.</p>\n\n<p>Scopes:</p>\n\n<pre><code>oauthScopes:\n- https://www.googleapis.com/auth/cloud-platform\n- https://www.googleapis.com/auth/compute\n- https://www.googleapis.com/auth/datastore\n- https://www.googleapis.com/auth/devstorage.full_control\n- https://www.googleapis.com/auth/devstorage.read_only\n- https://www.googleapis.com/auth/logging.write\n- https://www.googleapis.com/auth/monitoring\n- https://www.googleapis.com/auth/monitoring.write\n- https://www.googleapis.com/auth/pubsub\n- https://www.googleapis.com/auth/service.management.readonly\n- https://www.googleapis.com/auth/servicecontrol\n- https://www.googleapis.com/auth/source.full_control\n- https://www.googleapis.com/auth/sqlservice.admin\n- https://www.googleapis.com/auth/trace.append\n</code></pre>\n\n<p>Code: </p>\n\n<pre><code>func LogMessage(logLevel ReddiyoLoggingSeverity, message, domain, transactionID string) {\n\n    ctx := context.Background()\n    // Creates a client.\n    client, err := logging.NewClient(ctx, loggingData.ProjectID)\n    if err != nil {\n        log.Fatalf(\"Failed to create client: %v\", err)\n    }\n\n    // Selects the log to write to.\n    logger := client.Logger(loggingData.LogName)\n\n    labels := make(map[string]string)\n    labels[\"transactionID\"] = transactionID\n    labels[\"domain\"] = domain\n\n    var logSeverity logging.Severity\n    switch logLevel {\n    case debug:\n        logSeverity = logging.Debug\n    case info:\n        logSeverity = logging.Info\n    case warning:\n        logSeverity = logging.Warning\n    case reddiyoError:\n        logSeverity = logging.Error\n    case critical:\n        logSeverity = logging.Critical\n    case emergency:\n        logSeverity = logging.Emergency\n    default:\n        logSeverity = logging.Warning\n    }\n    logger.Log(logging.Entry{\n        Payload:  message,\n        Severity: logSeverity,\n        Labels:   labels})\n    // Closes the client and flushes the buffer to the Stackdriver Logging\n    // service.\n    if err := client.Close(); err != nil {\n        log.Fatalf(\"Failed to close client: %v\", err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "unicode", "utf-8"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1554920792, "post_id": 55619023, "comment_id": 97931363, "body": "Can you show an example of what you&#39;re trying to do? Since go uses utf8 for strings, it will interpret the bytes correctly by default: <a href=\"https://play.golang.org/p/u3JkywATmPR\" rel=\"nofollow noreferrer\">play.golang.org/p/u3JkywATmPR</a>"}, {"owner": {"reputation": 23, "user_id": 7870122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9037119a25595ad45ec8d8ef9d027a?s=128&d=identicon&r=PG&f=1", "display_name": "matzewagner", "link": "https://stackoverflow.com/users/7870122/matzewagner"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554929718, "post_id": 55619023, "comment_id": 97935313, "body": "I may not have been clear enough with the above description. The output string that I&#39;m getting is not interpreted automatically, because it behaves like a Raw string literal. See here: <a href=\"https://play.golang.org/p/TI-41dEWZaM\" rel=\"nofollow noreferrer\">play.golang.org/p/TI-41dEWZaM</a>"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 0, "last_activity_date": 1554932554, "last_edit_date": 1554932554, "creation_date": 1554931833, "answer_id": 55621581, "question_id": 55619023, "link": "https://stackoverflow.com/questions/55619023/converting-command-line-output-with-utf-8-byte-string-to-unicode-codepoint-in-go/55621581#55621581", "title": "Converting command line output with UTF-8 byte-string to Unicode codepoint in Go", "body": "<p>You can use the <a href=\"https://golang.org/pkg/strconv/\" rel=\"nofollow noreferrer\"><code>strconv</code></a> package to parse the string literal containing the escape sequences.</p>\n\n<p>The quick and dirty way is to simply add the missing quotes and interpret it as a quoted string using <a href=\"https://golang.org/pkg/strconv/#Unquote\" rel=\"nofollow noreferrer\"><code>strconv.Unquote</code></a></p>\n\n<pre><code>s := `\\xe2\\x96\\xb2`\ns, err := strconv.Unquote(`\"` + s + `\"`)\n</code></pre>\n\n<p>You can also directly parse the string one character at a time (which is what <code>Unquote</code> does internally), using <a href=\"https://golang.org/pkg/strconv/#UnquoteChar\" rel=\"nofollow noreferrer\"><code>strconv.UnquoteChar</code></a></p>\n\n<pre><code>s := `\\xe2\\x96\\xb2`\nbuf := make([]byte, 0, 3*len(s)/2)\nfor len(s) &gt; 0 {\n    c, _, ss, err := strconv.UnquoteChar(s, 0)\n    if err != nil {\n        log.Fatal(err)\n    }\n    s = ss\n    buf = append(buf, byte(c))\n}\ns = string(buf)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6SDij9d-aRr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6SDij9d-aRr</a></p>\n"}], "owner": {"reputation": 23, "user_id": 7870122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9037119a25595ad45ec8d8ef9d027a?s=128&d=identicon&r=PG&f=1", "display_name": "matzewagner", "link": "https://stackoverflow.com/users/7870122/matzewagner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 1, "accepted_answer_id": 55621581, "answer_count": 1, "score": 1, "last_activity_date": 1554935568, "creation_date": 1554920506, "last_edit_date": 1554930071, "question_id": 55619023, "link": "https://stackoverflow.com/questions/55619023/converting-command-line-output-with-utf-8-byte-string-to-unicode-codepoint-in-go", "title": "Converting command line output with UTF-8 byte-string to Unicode codepoint in Go", "body": "<p>I am running an executable from Go via os.Exec, which gives me the following output: <code>(\\\\xe2\\\\x96\\\\xb2)</code>. The output contains a UTF-8 byte string, which I want to convert to the corresponding Unicode codepoint (U+25B2). What I am expecting to see, or trying to convert to is: \"(\u25b2)\".\nI have looked at this entry in the Go Blog (<a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">https://blog.golang.org/strings</a>), but it starts out with an Interpreted string literal, whereas the command output seems to be a Raw string literal. I have tried <code>strconv.Quote</code> and <code>strconv.Unquote</code>, which does not achieve what I'm looking for.</p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "edited": false, "score": 0, "creation_date": 1554911567, "post_id": 55616346, "comment_id": 97926745, "body": "Can you add the docker file code and how you are downloading dependencies etc details!"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11341313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb91539e750693b086f2e776065367c0?s=128&d=identicon&r=PG&f=1", "display_name": "Test Sensor", "link": "https://stackoverflow.com/users/11341313/test-sensor"}, "is_accepted": false, "score": 0, "last_activity_date": 1554913919, "creation_date": 1554913919, "answer_id": 55617369, "question_id": 55616346, "link": "https://stackoverflow.com/questions/55616346/relocation-target-runtime-entersyscallblock-not-defined-for-abi0/55617369#55617369", "title": "relocation target runtime.entersyscallblock not defined for ABI0", "body": "<p>I removed  vendor/github.com/google/netstack and i cloned it back from github and it worked ...</p>\n"}], "owner": {"reputation": 1, "user_id": 11341313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb91539e750693b086f2e776065367c0?s=128&d=identicon&r=PG&f=1", "display_name": "Test Sensor", "link": "https://stackoverflow.com/users/11341313/test-sensor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 425, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554913919, "creation_date": 1554910244, "last_edit_date": 1554913456, "question_id": 55616346, "link": "https://stackoverflow.com/questions/55616346/relocation-target-runtime-entersyscallblock-not-defined-for-abi0", "title": "relocation target runtime.entersyscallblock not defined for ABI0", "body": "<p>I'm trying to compile a project under GoLang and I got an error with the building.\nin fact, the error is:</p>\n\n<blockquote>\n  <p>vendor/github.com/google/netstack/tcpip/link/rawfile.blockingPoll:relocation target runtime.entersyscallblock not defined for ABI0 (but is defined for ABIInternal).</p>\n</blockquote>\n\n<p>I was under <strong>goLang 12</strong> and on the internet it says that it has some <strong>assembly's issue</strong>.\nso I downloaded <strong>goLang 10.8</strong> and re-tried the process but unfortunately, the error persists.</p>\n\n<p>Does anyone have an idea, on how to solve this? Thanks in advance.</p>\n"}, {"tags": ["go", "uber-api"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1554908982, "post_id": 55615279, "comment_id": 97925244, "body": "You are not using msg for anything and effectively sign the empty string. The message also doesn&#39;t seem to be the request body (it&#39;s not JSON)."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1554917768, "post_id": 55615279, "comment_id": 97929929, "body": "You forgot to actually encode the message. Maybe add <code>h.Write(msg)</code> somewhere"}, {"owner": {"reputation": 1, "user_id": 11340401, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7vPwqzd2ciM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd8LsXvg6hEeGyEDlX1ydBNC4LVJg/mo/photo.jpg?sz=128", "display_name": "Mouncef Guinou", "link": "https://stackoverflow.com/users/11340401/mouncef-guinou"}, "reply_to_user": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1554995308, "post_id": 55615279, "comment_id": 97962751, "body": "@MadWombat, actually I&#39;ve forgot to add it when I&#39;ve copied/paste, so I don&#39;t think that would be the issue..."}], "owner": {"reputation": 1, "user_id": 11340401, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7vPwqzd2ciM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd8LsXvg6hEeGyEDlX1ydBNC4LVJg/mo/photo.jpg?sz=128", "display_name": "Mouncef Guinou", "link": "https://stackoverflow.com/users/11340401/mouncef-guinou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554996108, "creation_date": 1554907081, "last_edit_date": 1554996108, "question_id": 55615279, "link": "https://stackoverflow.com/questions/55615279/whats-the-good-way-to-encrypt-message-which-will-be-equal-than-the-uber-signatu", "title": "What&#39;s the good way to encrypt message which will be equal than the Uber Signature from the webhooks", "body": "<p>Regarding the Uber documentation, I'm trying to verify in order to trust the POST in our API.</p>\n\n<p><a href=\"https://developer.uber.com/docs/riders/guides/webhooks#security\" rel=\"nofollow noreferrer\">https://developer.uber.com/docs/riders/guides/webhooks#security</a></p>\n\n<p>To do so, I'd need to encrypt with a client_secret in sha256.</p>\n\n<p>Im doing that in Go language.</p>\n\n<p>My issue is, I can't have the same encrypted message than the Uber-Signature.</p>\n\n<p>Here's the code used:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"   \n    \"crypto/hmac\"\n    \"crypto/sha256\"\n    \"encoding/hex\"\n)\n\nfunc main() {\n    secret := \"mySecretCode\"\n\n    msg := `{\"event_id\":\"af4189d4-6a4c-48b5-ab83-8a59d6b03284\",\"resource_href\":\"https://sandbox-api.uber.com/v1/requests/f09bdc07-509b-4d91-859c-8883ac7fc04a\",\"meta\":{\"status\":\"processing\",\"rider_id\":\"8LSgK24vbx3bcLWThqQyMI_1T_ErGeb1SIHAO3wHX4ycPNvKGf_WsNf14PgVW8el7cBA_lemjMxKkcngZk945K_fCMXQARIfNZ8QOv7VWoQnwpSmUSKUgnYE1WEk-aHyrA==\",\"user_id\":\"eb0e5df4-3d65-40a0-aff7-40bf06e15727\",\"resource_id\":\"f09bdc07-509b-4d91-859c-8883ac7fc04a\"},\"event_type\":\"requests.status_changed\",\"event_time\":1554990665}`\n\n    fmt.Printf(\"Secret: %s Data: %s\\n\", secret, msg)\n\n    h := hmac.New(sha256.New, []byte(secret))\n    h.Write([]byte(msg))\n    encodedMsg := hex.EncodeToString(h.Sum(nil))\n    fmt.Println(encodedMsg)\n}\n</code></pre>\n\n<p>I'm expecting this:\n<code>3795f9ad1c5fe0ae4cd0d10d7a60ccb9f4409c3ae23eb0d0e448fb509f994faf</code></p>\n\n<p>But I got this:\n<code>350b4ed376e3e4a490dfa7ed4701da7be46e9454d5893bc63f5040bffde19fa8</code></p>\n\n<p>Here's the code: <a href=\"https://play.golang.org/p/PHPFIDxXA8T\" rel=\"nofollow noreferrer\">https://play.golang.org/p/PHPFIDxXA8T</a></p>\n\n<p>Any idea why?</p>\n"}, {"tags": ["go", "stream", "peer", "libp2p"], "answers": [{"comments": [{"owner": {"reputation": 110, "user_id": 10086742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9a08eba23183def103897ea65339180?s=128&d=identicon&r=PG&f=1", "display_name": "mahdi", "link": "https://stackoverflow.com/users/10086742/mahdi"}, "edited": false, "score": 1, "creation_date": 1565184792, "post_id": 57290981, "comment_id": 101273036, "body": "PS: I&#39;v added an example to libp2p examples repository and the <a href=\"https://github.com/libp2p/go-libp2p-examples/pull/74\" rel=\"nofollow noreferrer\">pull request</a> is waiting to be merged."}, {"owner": {"reputation": 473, "user_id": 2499463, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vYvcq.jpg?s=128&g=1", "display_name": "MYLOGOS", "link": "https://stackoverflow.com/users/2499463/mylogos"}, "edited": false, "score": 0, "creation_date": 1590483012, "post_id": 57290981, "comment_id": 109688592, "body": "<a href=\"https://github.com/libp2p/go-libp2p-examples/tree/master/pubsub\" rel=\"nofollow noreferrer\">github.com/libp2p/go-libp2p-examples/tree/master/pubsub</a>"}], "tags": [], "owner": {"reputation": 110, "user_id": 10086742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9a08eba23183def103897ea65339180?s=128&d=identicon&r=PG&f=1", "display_name": "mahdi", "link": "https://stackoverflow.com/users/10086742/mahdi"}, "is_accepted": true, "score": 1, "last_activity_date": 1564576838, "creation_date": 1564576838, "answer_id": 57290981, "question_id": 55614393, "link": "https://stackoverflow.com/questions/55614393/how-to-send-data-to-multiple-hosts-using-golang-libp2p-streams/57290981#57290981", "title": "How to send data to multiple hosts using golang libp2p streams?", "body": "<p>The best way to send multicast or broadcast messages in libp2p is to use <a href=\"https://github.com/libp2p/go-libp2p-pubsub\" rel=\"nofollow noreferrer\">PubSub</a>, So every node subscribed to a topic will be notified about sent messages despite not being directly connected to sender node.</p>\n\n<p>You can find an example implementation using Pubsub <a href=\"https://github.com/libp2p/go-libp2p-examples/tree/master/ipfs-camp-2019/08-End\" rel=\"nofollow noreferrer\">here</a>. It uses gossibSub implementation from libp2p.</p>\n"}], "owner": {"reputation": 35, "user_id": 11202238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49afff65f28b187b51c6b02e905adfea?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/11202238/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 566, "favorite_count": 0, "accepted_answer_id": 57290981, "answer_count": 1, "score": 0, "last_activity_date": 1564576838, "creation_date": 1554904526, "question_id": 55614393, "link": "https://stackoverflow.com/questions/55614393/how-to-send-data-to-multiple-hosts-using-golang-libp2p-streams", "title": "How to send data to multiple hosts using golang libp2p streams?", "body": "<p>my question refers to the libp2p library in golang: <a href=\"https://github.com/libp2p/go-libp2p\" rel=\"nofollow noreferrer\">https://github.com/libp2p/go-libp2p</a> </p>\n\n<p>This video explains the background: <a href=\"https://www.youtube.com/watch?v=hP0hSZ7E7_Y\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=hP0hSZ7E7_Y</a></p>\n\n<p>The peers in the network communicate via buffered streams <code>rw</code>. For each new connecting peer there is a new stream created that connects him to an existing peer using addresses. This means there are multiple streams but not all peers are directly connected with each other. Using those streams, the peers can read and write data from it via  </p>\n\n<p><code>rw := bufio.NewReadWriter(bufio.NewReader(stream),bufio.NewWriter(stream))</code></p>\n\n<p>by writing messages `rw.WriteString(\"message\")<code>,</code>rw.Flush()``</p>\n\n<p>and reading this messages via <code>message := rw.ReadString(rw)</code>.</p>\n\n<p>As the peers are not all connected, they only receive messages from directly connected peers and not even all of them if there are multiple connections. </p>\n\n<p>Exactly this problem is mentioned in the video, around time 09:45. The author of the video says that this could be easily modified to send messages not only to directly connected peers but also to multiple hosts. But how can this be done? </p>\n\n<p>My goal is to send message from one peer and that all other peers in the network, also the not directly connected ones, can receive (and answer) it.</p>\n"}, {"tags": ["go", "grpc", "http2", "kubernetes-ingress", "grpc-go"], "comments": [{"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1554918078, "post_id": 55612412, "comment_id": 97930096, "body": "Your service defines port 8081, but your ingress wants port 50051. Why?"}, {"owner": {"reputation": 305, "user_id": 5092293, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh6.googleusercontent.com/-FPhDIMUZk0k/AAAAAAAAAAI/AAAAAAAAAvM/fOTkthoUx0k/photo.jpg?sz=128", "display_name": "Tushar Sheth", "link": "https://stackoverflow.com/users/5092293/tushar-sheth"}, "reply_to_user": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1554984384, "post_id": 55612412, "comment_id": 97955241, "body": "@MadWombat updated the service. It was different service pointing to diff port."}, {"owner": {"reputation": 2863, "user_id": 11101419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8c5QW.png?s=128&g=1", "display_name": "A_Suh", "link": "https://stackoverflow.com/users/11101419/a-suh"}, "edited": false, "score": 0, "creation_date": 1554988732, "post_id": 55612412, "comment_id": 97958070, "body": "@TusharSheth Can you also share you deployment manifest?"}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1554990838, "post_id": 55612412, "comment_id": 97959582, "body": "<a href=\"https://github.com/kubernetes/ingress-nginx/issues/2497\" rel=\"nofollow noreferrer\">github.com/kubernetes/ingress-nginx/issues/2497</a>"}, {"owner": {"reputation": 2863, "user_id": 11101419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8c5QW.png?s=128&g=1", "display_name": "A_Suh", "link": "https://stackoverflow.com/users/11101419/a-suh"}, "edited": false, "score": 0, "creation_date": 1556025721, "post_id": 55612412, "comment_id": 98291248, "body": "What are you using as an ingress controller?   gke?  nginx? at least something?"}, {"owner": {"reputation": 305, "user_id": 5092293, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh6.googleusercontent.com/-FPhDIMUZk0k/AAAAAAAAAAI/AAAAAAAAAvM/fOTkthoUx0k/photo.jpg?sz=128", "display_name": "Tushar Sheth", "link": "https://stackoverflow.com/users/5092293/tushar-sheth"}, "reply_to_user": {"reputation": 2863, "user_id": 11101419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8c5QW.png?s=128&g=1", "display_name": "A_Suh", "link": "https://stackoverflow.com/users/11101419/a-suh"}, "edited": false, "score": 0, "creation_date": 1556087709, "post_id": 55612412, "comment_id": 98312797, "body": "@A_Suh I am using it for gke."}, {"owner": {"reputation": 2863, "user_id": 11101419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8c5QW.png?s=128&g=1", "display_name": "A_Suh", "link": "https://stackoverflow.com/users/11101419/a-suh"}, "edited": false, "score": 0, "creation_date": 1556270199, "post_id": 55612412, "comment_id": 98389034, "body": "@TusharSheth then why you are using <code>kubernetes.io&#47;ingress.class: &quot;nginx&quot;</code> annotation?"}], "answers": [{"tags": [], "owner": {"reputation": 2863, "user_id": 11101419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8c5QW.png?s=128&g=1", "display_name": "A_Suh", "link": "https://stackoverflow.com/users/11101419/a-suh"}, "is_accepted": false, "score": 1, "last_activity_date": 1557750726, "creation_date": 1557750726, "answer_id": 56112431, "question_id": 55612412, "link": "https://stackoverflow.com/questions/55612412/deploy-rest-grpc-server-deploy-to-k8s-with-ingress/56112431#56112431", "title": "Deploy Rest + gRPC server deploy to k8s with ingress", "body": "<p>A backend of the ingress object is a combination of service and port names </p>\n\n<p>In your case you have <code>serviceName: grpc</code> as a backend while your service's actual name is <code>name: grpc-scratch</code></p>\n\n<pre><code>apiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: grpc-ingress\n  annotations:\n    nginx.org/grpc-services: \"grpc\"\n    kubernetes.io/ingress.class: \"nginx\"\n    kubernetes.io/tls-acme: true\nspec:\n  tls:\n    - hosts:\n        - xyz.com\n      secretName: grpc-secret\n  rules:\n    - host: xyz.com\n      http:\n        paths:\n          - path: /grpc\n            backend:\n              serviceName: grpc-scratch\n              servicePort: grpc\n</code></pre>\n"}], "owner": {"reputation": 305, "user_id": 5092293, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh6.googleusercontent.com/-FPhDIMUZk0k/AAAAAAAAAAI/AAAAAAAAAvM/fOTkthoUx0k/photo.jpg?sz=128", "display_name": "Tushar Sheth", "link": "https://stackoverflow.com/users/5092293/tushar-sheth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2374, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1594173760, "creation_date": 1554898802, "last_edit_date": 1555270971, "question_id": 55612412, "link": "https://stackoverflow.com/questions/55612412/deploy-rest-grpc-server-deploy-to-k8s-with-ingress", "title": "Deploy Rest + gRPC server deploy to k8s with ingress", "body": "<p>I have used a sample gRPC HelloWorld application <a href=\"https://github.com/grpc/grpc-go/tree/master/examples/helloworld\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc-go/tree/master/examples/helloworld</a>. This example is running smoothly in local system.</p>\n\n<p>I want to deploy it to kubernetes with use of Ingress. </p>\n\n<p>Below are my config files.</p>\n\n<p><strong>service.yaml</strong> - as NodePort</p>\n\n<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: grpc-scratch\n  labels:\n    run: grpc-scratch\n  annotations:\n    service.alpha.kubernetes.io/app-protocols: '{\"grpc\":\"HTTP2\"}'\nspec:\n  type: NodePort\n  ports:\n  - name: grpc\n    port: 50051\n    protocol: TCP\n    targetPort: 50051\n  selector:\n    run: example-grpc\n</code></pre>\n\n<p><strong>ingress.yaml</strong></p>\n\n<pre><code>apiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: grpc-ingress\n  annotations:\n    nginx.org/grpc-services: \"grpc\"\n    kubernetes.io/ingress.class: \"nginx\"\n    kubernetes.io/tls-acme: true\nspec:\n  tls:\n    - hosts:\n        - xyz.com\n      secretName: grpc-secret\n  rules:\n    - host: xyz.com\n      http:\n        paths:\n          - path: /grpc\n            backend:\n              serviceName: grpc\n              servicePort: 50051\n</code></pre>\n\n<p>I am unable to make gRPC request to the server with url <code>xyz.com/grpc</code>. Getting the error</p>\n\n<pre><code>{\n  \"error\": \"14 UNAVAILABLE: Name resolution failure\"\n}\n</code></pre>\n\n<p>If I make request to <code>xyz.com</code> the error is </p>\n\n<pre><code>{\n  \"error\": \"14 UNAVAILABLE: Trying to connect an http1.x server\"\n}\n</code></pre>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["go", "kubernetes", "client-go"], "answers": [{"comments": [{"owner": {"reputation": 249, "user_id": 642318, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/7af83b1e5da93133828b49c01b91c5ee?s=128&d=identicon&r=PG", "display_name": "user642318", "link": "https://stackoverflow.com/users/642318/user642318"}, "edited": false, "score": 0, "creation_date": 1555072952, "post_id": 55613097, "comment_id": 97992219, "body": "How do I perform List first from the informer store and then react to events from the work queues?"}, {"owner": {"reputation": 134, "user_id": 4866324, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0aeeb110b6e2209eedfe12e89d0c25f6?s=128&d=identicon&r=PG&f=1", "display_name": "Matteo", "link": "https://stackoverflow.com/users/4866324/matteo"}, "reply_to_user": {"reputation": 249, "user_id": 642318, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/7af83b1e5da93133828b49c01b91c5ee?s=128&d=identicon&r=PG", "display_name": "user642318", "link": "https://stackoverflow.com/users/642318/user642318"}, "edited": false, "score": 0, "creation_date": 1555073803, "post_id": 55613097, "comment_id": 97992736, "body": "First way I can think of: in the main controller goroutine take the following steps in the order they appear:  1. create the Informer  2. register the handlers  3. wait for Informer cache to sync  4. do the List  5. start the workers."}], "tags": [], "owner": {"reputation": 134, "user_id": 4866324, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0aeeb110b6e2209eedfe12e89d0c25f6?s=128&d=identicon&r=PG&f=1", "display_name": "Matteo", "link": "https://stackoverflow.com/users/4866324/matteo"}, "is_accepted": false, "score": 0, "last_activity_date": 1554901465, "last_edit_date": 1554901465, "creation_date": 1554900830, "answer_id": 55613097, "question_id": 55612291, "link": "https://stackoverflow.com/questions/55612291/custom-controller-react-to-addfunc-event-handler-before-cache-hassynced-is-this/55613097#55613097", "title": "Custom Controller react to addfunc event handler before cache hassynced? Is this behaviour correct?", "body": "<p>What you're seeing is the standard behavior. While you wait for syncing to take place notifications are received and the appropriate notification handlers are executed.</p>\n\n<p>Your code is different wrt most code that uses the informer API because processing happens directly in the notification handlers. That smells like edge-based behavior, while Kubernetes encourages level-based behavior.</p>\n\n<p>The typical pattern when writing a Kubernetes controller (this is what you should do) is having the notification handlers do nothing but enqueuing a reference (typically a namespaced name) to the notified object in a workqueue, and have a pool of workers (goroutines if you're using go) extract such references, use them to retrieve the whole object from the Informer's cache and then do the actual processing. So what is typically done is syncing the Informers' caches before starting the workers, so that workers won't start processing before the cache has synced. To be explicit, <code>updateIPs()</code> should not be executed in the notification handlers code, but in the workers' body.</p>\n\n<p>At <a href=\"https://github.com/kubernetes/client-go/blob/master/examples/workqueue/main.go\" rel=\"nofollow noreferrer\">this page</a> there's a self-contained example of the usual pattern. More precisely, see <a href=\"https://github.com/kubernetes/client-go/blob/master/examples/workqueue/main.go#L174-L195\" rel=\"nofollow noreferrer\">this code</a> for an example of typical notification handlers and <a href=\"https://github.com/kubernetes/client-go/blob/master/examples/workqueue/main.go#L123-L133\" rel=\"nofollow noreferrer\">this code</a> for an example of how syncing is done wrt starting the workers.</p>\n"}], "owner": {"reputation": 249, "user_id": 642318, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/7af83b1e5da93133828b49c01b91c5ee?s=128&d=identicon&r=PG", "display_name": "user642318", "link": "https://stackoverflow.com/users/642318/user642318"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 260, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554901465, "creation_date": 1554898407, "question_id": 55612291, "link": "https://stackoverflow.com/questions/55612291/custom-controller-react-to-addfunc-event-handler-before-cache-hassynced-is-this", "title": "Custom Controller react to addfunc event handler before cache hassynced? Is this behaviour correct?", "body": "<p>Below is my snippet</p>\n\n<pre><code>factory := informers.NewFilteredSharedInformerFactory(clientset, 0, \"\", func(o *metaV1.ListOptions) {\n    o.LabelSelector = \"node-role.kubernetes.io/master=\"\n})\n\nnodeInformer := factory.Core().V1().Nodes().Informer()\n\ni.lister = factory.Core().V1().Nodes().Lister()\n\nnodeInformer.AddEventHandler(\n    cache.ResourceEventHandlerFuncs{\n        AddFunc: func(obj interface{}) {\n            i.updateIPs()\n        },\n        UpdateFunc: func(oldobj, newObj interface{}) {\n            i.updateIPs()\n        },\n        DeleteFunc: func(obj interface{}) {\n            i.updateIPs()\n        },\n    })\n\nfactory.Start(ctx.Done())\n\nif !cache.WaitForCacheSync(ctx.Done(), nodeInformer.HasSynced) {\n    runtime.HandleError(fmt.Errorf(\"Timed out waiting for caches to sync\"))\n    return\n}\n</code></pre>\n\n<p>Full code is at: <a href=\"https://github.com/tweakmy/fotofona/blob/master/nodeinformer.go\" rel=\"nofollow noreferrer\">https://github.com/tweakmy/fotofona/blob/master/nodeinformer.go</a></p>\n\n<p>This is the result when I run my unit test:</p>\n\n<pre><code>   $ go test -v -run TestInformer\n   === RUN   TestInformer\n   Update ip host [10.0.0.1]\n   cache is synced\n   --- PASS: TestInformer (3.10s)\n</code></pre>\n\n<p>Is this the expected behaviour?\nHow do I get it to list after the cache has synced and react to event handler after cache has synced.</p>\n"}, {"tags": ["mongodb", "go"], "owner": {"reputation": 11, "user_id": 2910640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21a73277d211b350fb1950e95f43fb76?s=128&d=identicon&r=PG&f=1", "display_name": "feistelwang", "link": "https://stackoverflow.com/users/2910640/feistelwang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 362, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1554897939, "creation_date": 1554897939, "question_id": 55612159, "link": "https://stackoverflow.com/questions/55612159/connect-mongodb-by-mongo-go-driver-consume-huge-memory", "title": "connect mongodb by mongo-go-driver consume huge memory", "body": "<p>I'm using mongo-go-driver, parallel connect several ports to check whether the port is listened by mongodb </p>\n\n<p>go version 1.12.3\nmongo-go-driver v1.0</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type BaseServerStatus struct {\n   Host           string    `bson:\"host\"`\n   Version        string    `bson:\"version\"`\n   Process        string    `bson:\"process\"`\n   Pid            int64     `bson:\"pid\"`\n   Uptime         int64     `bson:\"uptime\"`\n   UptimeMillis   int64     `bson:\"uptimeMillis\"`\n   UptimeEstimate int64     `bson:\"uptimeEstimate\"`\n   LocalTime      time.Time `bson:\"localTime\"`\n}\n\n\nfunc GetBaseServerStatus(ip, port string) (srvStatus *BaseServerStatus, err error) {\n   opts := options.Client()\n   opts.SetDirect(true)\n   opts.SetServerSelectionTimeout(1 * time.Second)\n   opts.SetConnectTimeout(2 * time.Second)\n   opts.SetSocketTimeout(2 * time.Second)\n   opts.SetMaxConnIdleTime(1 * time.Second)\n   opts.SetMaxPoolSize(1)\n   url := fmt.Sprintf(\"mongodb://%s:%s/admin\", ip, port)\n   opts.ApplyURI(url)\n   ctx, _ := context.WithTimeout(context.Background(), 2*time.Second)\n   conn, err := mongo.Connect(ctx, opts)\n   if err != nil {\n      fmt.Printf(\"new %s:%s mongo connection error: %v\\n\", ip, port, err)\n      return\n   }\n   defer conn.Disconnect(ctx)\n   err = conn.Ping(ctx, nil)\n   if err != nil {\n      fmt.Printf(\"ping %s:%s ping error: %v\\n\", ip, port, err)\n      return\n   }\n   sr := conn.Database(\"admin\").RunCommand(ctx, bson.D{{\"serverStatus\", 1}})\n   if sr.Err() != nil {\n      fmt.Printf(\"get  %s:%s server status error: %v\\n\", ip, port, sr.Err())\n      return\n   }\n   srvStatus = new(BaseServerStatus)\n   err = sr.Decode(srvStatus)\n   return\n}\n\n\nfunc main()  {\n   var wg sync.WaitGroup\n   //ips := []string{\"xxx.xxx.xxx.xxx:22\"}\n   ips := []string{\"xxx.xxx.xxx.xxx:22\", \"xxx.xxx.xxx.xxx:80\", \"xxx.xxx.xxx.xxx:7005\", \"xxx.xxx.xxx.xxx:7017\", \"xxx.xxx.xxx.xxx:7006\", \"xxx.xxx.xxx.xxx:7016\", \"xxx.xxx.xxx.xxx:7018\", \"xxx.xxx.xxx.xxx:7014\", \"xxx.xxx.xxx.xxx:199\", \"xxx.xxx.xxx.xxx:8182\", \"xxx.xxx.xxx.xxx:7015\", \"xxx.xxx.xxx.xxx:7022\", \"xxx.xxx.xxx.xxx:7013\", \"xxx.xxx.xxx.xxx:7020\", \"xxx.xxx.xxx.xxx:9009\", \"xxx.xxx.xxx.xxx:7004\", \"xxx.xxx.xxx.xxx:7008\", \"xxx.xxx.xxx.xxx:7002\", \"xxx.xxx.xxx.xxx:7021\", \"xxx.xxx.xxx.xxx:7007\", \"xxx.xxx.xxx.xxx:7024\", \"xxx.xxx.xxx.xxx:7010\", \"xxx.xxx.xxx.xxx:7011\", \"xxx.xxx.xxx.xxx:7003\", \"xxx.xxx.xxx.xxx:7012\", \"xxx.xxx.xxx.xxx:7009\", \"xxx.xxx.xxx.xxx:7019\", \"xxx.xxx.xxx.xxx:8001\", \"xxx.xxx.xxx.xxx:7023\", \"xxx.xxx.xxx.xxx:111\", \"xxx.xxx.xxx.xxx:7001\", \"xxx.xxx.xxx.xxx:8002\", \"xxx.xxx.xxx.xxx:19313\", \"xxx.xxx.xxx.xxx:15772\", \"xxx.xxx.xxx.xxx:19777\", \"xxx.xxx.xxx.xxx:15778\", \"xxx.xxx.xxx.xxx:15776\"}\n\n   for _, ip := range ips {\n      wg.Add(1)\n      //time.Sleep(3 * time.Second)\n      go func(addr string) {\n         fmt.Printf(\"start to probe port %s\\n\", addr)\n         GetBaseServerStatus(strings.Split(addr, \":\")[0], strings.Split(addr, \":\")[1])\n         wg.Done()\n      }(ip)\n   }\n   wg.Wait()\n   fmt.Println(\"scan end\")\n   time.Sleep(20 * time.Second)\n\n}\n</code></pre>\n\n<p>however, run this code ,it consume 26GB memory\nI use pprof to diagnose, see below</p>\n\n<p>Showing top 10 nodes out of 15\n      flat  flat%   sum%        cum   cum%\n   26.29GB 96.86% 96.86%    26.29GB 96.86%  go.mongodb.org/mongo-driver/x/network/connection.(*connection).ReadWireMessage</p>\n"}, {"tags": ["go", "towers-of-hanoi"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1554894920, "post_id": 55610974, "comment_id": 97916536, "body": "Write a benchmark and do the performance optimization. A starting point might be the (a bit outdated) article <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">blog.golang.org/profiling-go-programs</a>. The main point is: write a func BenchmarkHanoi(b *testing.B) and run this benchmark, generating cpuprofile and memoryprofile (see go help testflag) and then anylze them via go tool pprof."}, {"owner": {"reputation": 1710, "user_id": 3898725, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/074CQ.jpg?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/3898725/michael"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1554897834, "post_id": 55610974, "comment_id": 97918256, "body": "OK, I think I know where the time is taken. If I remove <code>moves.WriteString()</code> calls, it&#39;s much faster. But what is a more efficient way to build the string than using <code>string.Builder</code>? In Rust I&#39;m using <code>String.push_str()</code> and in JS I simply add by <code>moves += &quot;...&quot;</code>."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1554901058, "post_id": 55610974, "comment_id": 97920218, "body": "Define a Steps struct with fields to and from. Pass in a slice of steps, append to it. Render the slice afterwards."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554917134, "post_id": 55610974, "comment_id": 97929617, "body": "FYI: unrelated to your performance question, the closure function does not reset <code>moves</code> before beginning work. Therefore subsequent calls to this function will append to previous results still store in <code>moves</code>."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554917522, "post_id": 55610974, "comment_id": 97929813, "body": "actually the above comment will may affect benchmarking - if one does not reset the moves string between benchmark invocations, then the string result will grow with each iteration (i.e. <code>hanoi(20, &quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</code> should always return the same result)"}, {"owner": {"reputation": 1710, "user_id": 3898725, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/074CQ.jpg?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/3898725/michael"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554966722, "post_id": 55610974, "comment_id": 97945226, "body": "@colminator, Yes, In my test, it always gets reinstanciated (reseted). I also tryied it with a struct and a func implemenation (or say: a class). This was a little bit slower than the closure. It&#39;s really strange that Go is that much slower. I tested the fibonacci sequence too. And there Go is far slower too. Really strange."}], "owner": {"reputation": 1710, "user_id": 3898725, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/074CQ.jpg?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/3898725/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 131, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1554912434, "creation_date": 1554894156, "last_edit_date": 1554912434, "question_id": 55610974, "link": "https://stackoverflow.com/questions/55610974/efficient-way-to-implement-towers-of-hanoi-with-steps-returned-as-string", "title": "Efficient way to implement Towers of Hanoi with steps returned as string", "body": "<p>I'm comparing several algorithms in JS, Rust and Go. I implemented Towsers of Hanoi this way in Go:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Hanoi() (hanoi func(n int, from, via, to string) string) {\n    var moves strings.Builder\n    var hanoiRe func(n int, from, via, to string)\n    hanoiRe = func(n int, from, via, to string) {\n        if n &gt; 0 {\n            hanoiRe(n-1, from, to, via)\n            moves.WriteString(from)\n            moves.WriteString(\"-&gt;\")\n            moves.WriteString(to)\n            moves.WriteString(\"\\n\")\n            hanoiRe(n-1, via, from, to)\n        }\n    }\n    hanoi = func(n int, from, via, to string) string {\n        hanoiRe(n, from, via, to)\n        return moves.String()\n    }\n    return\n}\n</code></pre>\n\n<p>But this implementation is much slower than JS or Rust. So I think, this could be done faster. But how?</p>\n\n<p>I already tried <code>type hanoi struct{moves strings.Builder}</code> with <code>func (h *hanoi) ...</code>, which is a bit slower. The way using a string and <code>moves += ...</code>is much slower.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>My comparisons:</p>\n\n<p><strong>JS:</strong></p>\n\n<pre><code>class HanoiJS {\n    constructor() {\n        this.moves = \"\";\n    }\n    hanoi(n, from, via, to) {\n        if (n &gt; 0) {\n            this.hanoi(n - 1, from, to, via);\n            this.moves += from + \"-&gt;\" + to + \"\\n\";\n            this.hanoi(n - 1, via, from, to);\n        }\n        return this.moves;\n    }\n}\n</code></pre>\n\n<p><strong>Rust:</strong></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Hanoi {\n    moves: String\n}\n\nimpl Hanoi {\n\n    pub fn new() -&gt; Hanoi {\n        Hanoi {\n            moves: String::new()\n        }\n    }\n\n    pub fn hanoi(&amp;mut self, n: i32, from: &amp;str, via: &amp;str, to: &amp;str) -&gt; &amp;str {\n        if n &gt; 0 {\n            self.hanoi(n - 1, from, to, via);\n            self.moves.push_str(from);\n            self.moves.push_str(\"-&gt;\");\n            self.moves.push_str(to);\n            self.moves.push_str(\"\\n\");\n            self.hanoi(n - 1, via, from, to);\n        }\n        return &amp;self.moves;\n    }\n}\n</code></pre>\n\n<p><strong>Compared with n=20 and 5 times:</strong>\n<a href=\"https://i.stack.imgur.com/GsYkf.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/GsYkf.png\" alt=\"chart\"></a></p>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1554886922, "post_id": 55608499, "comment_id": 97911772, "body": "Have you tried <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">reflection</a>?"}, {"owner": {"reputation": 632, "user_id": 4308511, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56c3c96e5374a48aa733565f9e61711d?s=128&d=identicon&r=PG&f=1", "display_name": "Jakub", "link": "https://stackoverflow.com/users/4308511/jakub"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1554887221, "post_id": 55608499, "comment_id": 97911957, "body": "@mkopriva Not yet. I&#39;m new to the language and I have not used it so far."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554902622, "post_id": 55608643, "comment_id": 97921257, "body": "This method still requires access to the unexported type. Note that the type OP needs to compare against is <code>expr</code>, not <code>Expr</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554902732, "post_id": 55608643, "comment_id": 97921319, "body": "It could be done a little more ham-fistedly using <code>reflect.TypeOf(v).Name() == &quot;expr&quot;</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1554902951, "post_id": 55608643, "comment_id": 97921481, "body": "@Adrian My solution doesn&#39;t refer to the unexported type, it uses the return value of the exported <code>squirrel.Expr()</code> function, which is valid. We could use reflection to &quot;extract&quot; the return type of <code>Expr()</code> if calling it is unfeasible, but it is not in this case. Using <code>Type.Name()</code> has more downsides than the easiness it provides."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1554903724, "last_edit_date": 1554903724, "creation_date": 1554886972, "answer_id": 55608643, "question_id": 55608499, "link": "https://stackoverflow.com/questions/55608499/type-assertion-of-a-non-exported-type/55608643#55608643", "title": "Type assertion of a non-exported type", "body": "<p>You may use reflection to compare the type of values to the type of <code>squirrel.expr</code>. Type here means the <a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"nofollow noreferrer\"><code>reflect.Type</code></a> descriptors, acquired by <a href=\"https://golang.org/pkg/reflect/#TypeOf\" rel=\"nofollow noreferrer\"><code>reflect.TypeOf()</code></a>.</p>\n\n<p>For example:</p>\n\n<pre><code>m := map[string]interface{}{\n    \"col1\": 123,\n    \"col2\": \"a_string\",\n    \"col3\": squirrel.Expr(\"now()\"),\n}\nfmt.Println(m)\n\nexprType := reflect.TypeOf(squirrel.Expr(\"\"))\n\nfiltered := make(map[string]interface{})\nfor k, v := range m {\n    if reflect.TypeOf(v) == exprType {\n        continue\n    }\n    filtered[k] = v\n}\nfmt.Println(filtered)\n</code></pre>\n\n<p>This will output:</p>\n\n<pre><code>map[col1:123 col2:a_string col3:{now() []}]\nmap[col1:123 col2:a_string]\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p>We obtained the <code>reflect.Type</code> descriptor of the values we want to filter out by passing the return value of a <code>squirrel.Expr()</code> call (which is of type <code>squirrel.expr</code>). This is fine in this case, but if it is unfeasible to call this function just to get the type (e.g. the call has side effects which must be avoided), we can avoid that. We can use reflection to obtain the <code>reflect.Type</code> descriptor of the <code>squirrel.Expr</code> function itself, and get the type descriptor of its return type. This is how it could be done:</p>\n\n<pre><code>exprType := reflect.TypeOf(squirrel.Expr).Out(0)\n</code></pre>\n"}], "owner": {"reputation": 632, "user_id": 4308511, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56c3c96e5374a48aa733565f9e61711d?s=128&d=identicon&r=PG&f=1", "display_name": "Jakub", "link": "https://stackoverflow.com/users/4308511/jakub"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 55608643, "answer_count": 1, "score": 1, "last_activity_date": 1554903724, "creation_date": 1554886499, "last_edit_date": 1554889793, "question_id": 55608499, "link": "https://stackoverflow.com/questions/55608499/type-assertion-of-a-non-exported-type", "title": "Type assertion of a non-exported type", "body": "<p>I am using a 3rd party package, which allows you to create structures of a certain non-exported type through an exported function.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package squirrel\n\ntype expr struct {\n    sql string\n    args []interface{}\n}\n\nfunc Expr(sql string, args ...interface{}) expr {\n    return expr{sql: sql, args: args}\n}\n</code></pre>\n\n<p>Because of the way some other function of this library accepts data, I ended up with such a map:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>m := map[string]interface{} {\n    \"col1\": 123,\n    \"col2\": \"a_string\",\n    \"col3\": Expr(\"now()\"),\n}\n</code></pre>\n\n<p>but because of a different function in this library I need to filter out all <code>squirrel.expr</code> from this map.</p>\n\n<p>Obviously, I wasn't able to assert the type directly, by doing so:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>filtered := make(map[string]interface{})\nfor k, v := range m {\n    switch v.(type) {\n    case squirrel.expr:\n        continue\n    default:\n        filtered[k] = v\n    }\n}\n</code></pre>\n\n<p>Is there another way to achieve the same result?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1554886614, "post_id": 55608470, "comment_id": 97911583, "body": "Try <code>curl -X GET http:&#47;&#47;localhost:8000&#47;v1&#47;user?first_name=tigran</code>"}, {"owner": {"reputation": 65, "user_id": 11310037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f38f3f28a0696538ae94b78e29c63399?s=128&d=identicon&r=PG&f=1", "display_name": "rsimovic", "link": "https://stackoverflow.com/users/11310037/rsimovic"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1554887042, "post_id": 55608470, "comment_id": 97911850, "body": "I got []. Take a look at my handlefunc."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1554887190, "post_id": 55608470, "comment_id": 97911934, "body": "You should check errors, most importantly the one from <code>Scan</code>. You should also first set headers before calling <code>WriteHeader</code>."}, {"owner": {"reputation": 65, "user_id": 11310037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f38f3f28a0696538ae94b78e29c63399?s=128&d=identicon&r=PG&f=1", "display_name": "rsimovic", "link": "https://stackoverflow.com/users/11310037/rsimovic"}, "edited": false, "score": 0, "creation_date": 1554887510, "post_id": 55608470, "comment_id": 97912111, "body": "No, I got the same for user richard."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1554918679, "post_id": 55608470, "comment_id": 97930382, "body": "It looks like what you get is an empty user struct with all fields left at defaults. It means that your database query fails somewhere. Either it fails to fetch the records or it fails to scan the results into the struct. You need to check all the returned errors instead of ignoring them."}], "answers": [{"tags": [], "owner": {"reputation": 161, "user_id": 11339140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_oZaOqfxYFI/AAAAAAAAAAI/AAAAAAAAADw/o9Jcv0YYArU/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0444\u043e\u0440 \u0421\u0435\u0440\u044f\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/11339140/%d0%9d%d0%b8%d0%ba%d0%b8%d1%84%d0%be%d1%80-%d0%a1%d0%b5%d1%80%d1%8f%d0%ba%d0%be%d0%b2"}, "is_accepted": false, "score": 1, "last_activity_date": 1554888170, "creation_date": 1554888170, "answer_id": 55609058, "question_id": 55608470, "link": "https://stackoverflow.com/questions/55608470/why-does-curl-give-me-wrong-json-for-my-user/55609058#55609058", "title": "Why does curl give me wrong json for my user?", "body": "<p>Probably you should use url as <code>http://localhost:8000/v1/user?first_name=tigran</code> and get that parameter as <code>req.URL.Query()[\"first_name\"][0]</code> but do not forget about user input checking</p>\n"}], "owner": {"reputation": 65, "user_id": 11310037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f38f3f28a0696538ae94b78e29c63399?s=128&d=identicon&r=PG&f=1", "display_name": "rsimovic", "link": "https://stackoverflow.com/users/11310037/rsimovic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1554888170, "creation_date": 1554886417, "last_edit_date": 1554887018, "question_id": 55608470, "link": "https://stackoverflow.com/questions/55608470/why-does-curl-give-me-wrong-json-for-my-user", "title": "Why does curl give me wrong json for my user?", "body": "<p>Something is wrong with my function</p>\n\n<pre><code>func (driver *DBClient) GetUsersByFirstName(w http.ResponseWriter, r *http.Request) {\n    var users []models.User\n    name := r.FormValue(\"first_name\")\n    // Handle response details\n    var query = \"select * from \\\"user\\\" where data-&gt;&gt;'first_name'=?\"\n    driver.db.Raw(query, name).Scan(&amp;users)\n    w.WriteHeader(http.StatusOK)\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    //responseMap := map[string]interface{}{\"url\": \"\"}\n    respJSON, _ := json.Marshal(users)\n    w.Write(respJSON)\n}\n</code></pre>\n\n<p>When I use POST</p>\n\n<pre><code>curl -X POST \\\nhttp://localhost:8000/v1/user \\\n-H 'cache-control: no-cache' \\\n-H 'content-type: application/json' \\\n-d '{\n\"username\": \"tsarcayan\",\n\"email_address\": \"rsarnayan@gmail.com\",\n\"first_name\": \"tigran\",\n\"last_name\": \"tanayan\"\n}'\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>{\"id\":4}\n</code></pre>\n\n<p>But when I try to get first_name for user tigran</p>\n\n<pre><code>curl -X GET http://localhost:8000/v1/user/\"tigran\"\n</code></pre>\n\n<p>I got</p>\n\n<pre><code>{\"user\":{\"ID\":0,\"CreatedAt\":\"0001-01-01T00:00:00Z\",\"UpdatedAt\":\"0001-01-01T00:00:00Z\",\"DeletedAt\":null,\"Orders\":null},\"data\":null}`\n</code></pre>\n\n<p>How to fix this?</p>\n\n<p>My handlefunc</p>\n\n<pre><code>r.HandleFunc(\"/v1/user\", dbclient.GetUsersByFirstName).Methods(\"GET\")\n</code></pre>\n"}, {"tags": ["go", "methods", "closures"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1554863653, "post_id": 55603812, "comment_id": 97903186, "body": "What is the misuse you are trying to protect against with closures?  The second approach is more idiomatic and therefore should be more obvious how to use correctly."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 6, "creation_date": 1554864403, "post_id": 55603812, "comment_id": 97903332, "body": "Why don&#39;t you have a shader package to encapsulate the Shader type and its methods?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1554866812, "post_id": 55603812, "comment_id": 97903809, "body": "and if the shader package is only of use to your parent package - and not to any external code - use go <a href=\"https://golang.org/doc/go1.4#internalpackages\" rel=\"nofollow noreferrer\">internal packages</a>"}, {"owner": {"reputation": 5, "user_id": 11337687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a16cc774d5b1494b0dfe50c52943931?s=128&d=identicon&r=PG&f=1", "display_name": "JkImGaming", "link": "https://stackoverflow.com/users/11337687/jkimgaming"}, "edited": false, "score": 0, "creation_date": 1554933147, "post_id": 55603812, "comment_id": 97936605, "body": "This is more about if the code is idiomatic and less about its use case. Although, that is important info. Personally, I thought it was an interesting use of closures. This was more of an example and less about an actual use case which like Ceris Limon said it would be obvious the correct use if methods were used."}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 11337687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a16cc774d5b1494b0dfe50c52943931?s=128&d=identicon&r=PG&f=1", "display_name": "JkImGaming", "link": "https://stackoverflow.com/users/11337687/jkimgaming"}, "edited": false, "score": 0, "creation_date": 1554933621, "post_id": 55605889, "comment_id": 97936778, "body": "I know that pointers cause a cache failure because they must be looked up. If having the receiver be a pointer has noticeable overhead would that affect the decision to use closures? Or is that a decision that can only be determined after profiling? Also, exactly what problems do each solve?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 5, "user_id": 11337687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a16cc774d5b1494b0dfe50c52943931?s=128&d=identicon&r=PG&f=1", "display_name": "JkImGaming", "link": "https://stackoverflow.com/users/11337687/jkimgaming"}, "edited": false, "score": 0, "creation_date": 1554962340, "post_id": 55605889, "comment_id": 97943359, "body": "I don&#39;t understand your question. What does &quot;pointers cause a cache failure because they must be looked up&quot; mean? In any case, if your concern is performance, the answer is always that it can only be determined after profiling."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1554877155, "creation_date": 1554877155, "answer_id": 55605889, "question_id": 55603812, "link": "https://stackoverflow.com/questions/55603812/is-it-better-to-use-methods-over-closures/55605889#55605889", "title": "Is it better to use methods over closures?", "body": "<p>Closures and methods solve entirely different problems, so it's rare that you should ever ask which one to use in a particular situation.</p>\n\n<p>Having said that, closures <em>can be</em> a way to provide data protection, and are often (ab)used for this in languages which don't otherwise offer private variables (i.e. JavaScript).</p>\n\n<p>There's no reason to ever use them <em>for this purpose</em> in Go.</p>\n"}], "owner": {"reputation": 5, "user_id": 11337687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a16cc774d5b1494b0dfe50c52943931?s=128&d=identicon&r=PG&f=1", "display_name": "JkImGaming", "link": "https://stackoverflow.com/users/11337687/jkimgaming"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 55605889, "answer_count": 1, "score": -3, "last_activity_date": 1554934709, "creation_date": 1554862800, "last_edit_date": 1554934709, "question_id": 55603812, "link": "https://stackoverflow.com/questions/55603812/is-it-better-to-use-methods-over-closures", "title": "Is it better to use methods over closures?", "body": "<p>I have a simple type of data that only consists of an uint32, but many operations can be performed on this data. All files that use this data reside in the same package and therefore can access the unexported uint32 inside the struct which is not preferable. I recently learned about the power of closures and was wondering if it is better to use a struct that contains functions that perform the tasks or to have the uint32 stored in the struct and then just use methods with a receiver of the struct.</p>\n\n<p>This is a basic representation of an OpenGL shader. Both the method and closure options, look the same to the caller but perform differently under the hood.</p>\n\n<p>Closure:</p>\n\n<pre><code>type Shader struct {\n    getID  func() uint32\n    delete func()\n}\n\nfunc CreateShader(shader string) Shader {\n    var id uint32\n    //Do work...\n    return Shader{\n        getID: func() uint32 {\n            return id\n        },\n        delete: func() {\n            gl.DeleteShader(id)\n        },\n    }\n}\n</code></pre>\n\n<p>Methods:</p>\n\n<pre><code>type Shader struct {\n    id uint32\n}\n\nfunc CreateShader(shader string) Shader{\n    var id uint32\n    //Do work...\n    return Shader{id: id}\n}\n\nfunc (s Shader) getID() uint32 {\n    return s.id\n}\n\nfunc (s Shader) delete() {\n    gl.DeleteShader(s.id)\n}\n</code></pre>\n\n<p>Both options appear like this in use:</p>\n\n<pre><code>func main() {\n    shader := CreateShader(\"shader.code\")\n    id := shader.getID()\n    fmt.Println(id)\n    shader.delete()\n}\n</code></pre>\n\n<p>The miss use I thought to avoid was that the caller could affect the id type without Shader knowing. Something similar to:</p>\n\n<pre><code>shader.id = 4102 // or some other change\n</code></pre>\n\n<p>With the use of closures this behavior is impossible and requires the caller to go use the proper calls.</p>\n\n<p>As mentioned in the comments, it is possible to use a shader package and unexport the shader type. I didn't use this because I thought it was improper to make an entire package just to hold one file. But perhaps it is proper if it solidifies correct use of the type.</p>\n\n<p>Is there any reason that the closure version is \"wrong\" compared to the methods? Are there any golang standards that would classify either choice better suited for my use case? I expect the caller to not touch the id of the shader and think that the use of closures makes it clearer the proper use of the shader type.</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 3, "creation_date": 1554865275, "post_id": 55603147, "comment_id": 97903493, "body": "The JSON document dictates the order of the fields. So I assume you are asking about JSON marshaling (not <i>parsing</i>) and want the Root fields marshaled first before Inner?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1554877204, "post_id": 55603147, "comment_id": 97906612, "body": "Structs are not parsed. They&#39;re already in normalized form. So I&#39;m not sure what you&#39;re asking."}, {"owner": {"reputation": 125, "user_id": 5626368, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/44c3e777c124eb6d8d585b72e6c52368?s=128&d=identicon&r=PG&f=1", "display_name": "Hemanth Savasere", "link": "https://stackoverflow.com/users/5626368/hemanth-savasere"}, "edited": false, "score": 0, "creation_date": 1554961621, "post_id": 55603147, "comment_id": 97943091, "body": "Reflection of &quot;Root&quot; struct fields should happen first and then the other fields. Since &quot;Root&quot; is the parent struct and child in &quot;Inner&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 5626368, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/44c3e777c124eb6d8d585b72e6c52368?s=128&d=identicon&r=PG&f=1", "display_name": "Hemanth Savasere", "link": "https://stackoverflow.com/users/5626368/hemanth-savasere"}, "edited": false, "score": 0, "creation_date": 1554961863, "post_id": 55604081, "comment_id": 97943179, "body": "Is there any other way by which I can make the embedded struct to get parsed at last rather than getting parsed first."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 125, "user_id": 5626368, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/44c3e777c124eb6d8d585b72e6c52368?s=128&d=identicon&r=PG&f=1", "display_name": "Hemanth Savasere", "link": "https://stackoverflow.com/users/5626368/hemanth-savasere"}, "edited": false, "score": 0, "creation_date": 1555023134, "post_id": 55604081, "comment_id": 97974661, "body": "You&#39;d have to write your own marshaller to prefer local fields first before recursing into embedded structs. But why would you need this? It&#39;s perfectly fine listing the fields in your code in the order you want them to be  marshaled."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 3, "last_activity_date": 1554865857, "last_edit_date": 1554865857, "creation_date": 1554864947, "answer_id": 55604081, "question_id": 55603147, "link": "https://stackoverflow.com/questions/55603147/how-do-i-make-sure-that-the-fileds-of-the-root-struct-get-parsed-first-and-then/55604081#55604081", "title": "How do I make sure that the fileds of the root struct get parsed first and then the fields of embedded struct gets parsed", "body": "<p>If you are asking about JSON marshaling (which is not parsing) and want fields marshaled in a certain order, a marshaler will typically marshal fields in their index order &amp; recurse any embedded structs along the way. Struct field indices - as seen by the <code>reflect</code> package that <code>json.Marhsal</code> uses - are defined by their order of appearance in your code.</p>\n\n<p>So put the fields you want first - and any embedded structs later:</p>\n\n<pre><code>type Root struct {\n    Foo string `json:\"foo\"`\n    Bar string `json:\"bar\"`\n    Inner // &lt;- move this last\n}\n</code></pre>\n\n<p>Playground <a href=\"https://play.golang.org/p/IhgPfvBOIaz\" rel=\"nofollow noreferrer\">Example</a></p>\n\n<pre><code>b, _ := json.Marshal(Root{})\n\n{\"foo\":\"\",\"bar\":\"\",\"fooInner\":\"\"}\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 5626368, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/44c3e777c124eb6d8d585b72e6c52368?s=128&d=identicon&r=PG&f=1", "display_name": "Hemanth Savasere", "link": "https://stackoverflow.com/users/5626368/hemanth-savasere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 1, "accepted_answer_id": 55604081, "answer_count": 1, "score": 0, "last_activity_date": 1554874833, "creation_date": 1554856762, "last_edit_date": 1554874833, "question_id": 55603147, "link": "https://stackoverflow.com/questions/55603147/how-do-i-make-sure-that-the-fileds-of-the-root-struct-get-parsed-first-and-then", "title": "How do I make sure that the fileds of the root struct get parsed first and then the fields of embedded struct gets parsed", "body": "<p>I have the struct as follows:-</p>\n\n<pre><code>type Inner struct {\n    FooInner string `json:\"fooInner\"`\n    BarInner string `json:\"barInner,omitempty\"`\n}\n\ntype Root struct {\n    Inner\n    Foo string `json:\"foo\"`\n    Bar string `json:\"bar\"`\n}\n</code></pre>\n\n<p>I want the fields of \"Root\" struct to be parsed first and then the fields of the \"Inner\" struct. But here the fields of Inner struct is getting parsed first.</p>\n"}, {"tags": ["go", "gzip"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 4, "creation_date": 1554856364, "post_id": 55602895, "comment_id": 97901784, "body": "<code>eNorTk0uSi0BAAjRAoc=</code> - this is no &quot;gzip string&quot;. This is  zlib encoded (zlib is not gzip, also it basically just is a different header in front of the deflate encoded content) and then additionally base64 encode, so you need to first decode it from base64 and then use a zlib decompression and not a gzip decompression."}, {"owner": {"reputation": 2439, "user_id": 82230, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/PSGNe.jpg?s=128&g=1", "display_name": "slim", "link": "https://stackoverflow.com/users/82230/slim"}, "edited": false, "score": 0, "creation_date": 1605803975, "post_id": 55602895, "comment_id": 114770290, "body": "Is there someway we can re-title this question so it doesn&#39;t appear in google searches?"}], "answers": [{"comments": [{"owner": {"reputation": 3067, "user_id": 53991, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/2191b5cfee9c0fb7de571ac6cac45512?s=128&d=identicon&r=PG", "display_name": "perrohunter", "link": "https://stackoverflow.com/users/53991/perrohunter"}, "edited": false, "score": 0, "creation_date": 1554926769, "post_id": 55603287, "comment_id": 97934028, "body": "Thanks for your answer, how did you knew to use zlib? the input is actually being compressed by Celery (a python tool) where I indicate I want gzip compression, but actually your solution worked, so I want to understand how you detected it&#39;s a zlib compressed string"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 3067, "user_id": 53991, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/2191b5cfee9c0fb7de571ac6cac45512?s=128&d=identicon&r=PG", "display_name": "perrohunter", "link": "https://stackoverflow.com/users/53991/perrohunter"}, "edited": false, "score": 0, "creation_date": 1554958106, "post_id": 55603287, "comment_id": 97941971, "body": "@perrohunter: The base 64 was obvious. So I did <code>echo &#39;eNorTk0uSi0BAAjRAoc=&#39; | base64 -d &gt; f; file f</code> which showed <code>f: zlib compressed data</code>."}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 8, "last_activity_date": 1554875005, "last_edit_date": 1592644375, "creation_date": 1554858021, "answer_id": 55603287, "question_id": 55602895, "link": "https://stackoverflow.com/questions/55602895/decompress-gzip-string-with-golang/55603287#55603287", "title": "Decompress gzip string with golang", "body": "<blockquote>\n<p>... I have a string which contains a gzip compressed string</p>\n<pre><code>nbody := &quot;eNorTk0uSi0BAAjRAoc=&quot;\n</code></pre>\n</blockquote>\n<p>This is not a  &quot;gzip compressed string&quot;. This looks like some base64 encoded data which need to be decoded first. After decoding it is not gzip either but zlib - which is basically the same as gzip (content compressed with deflate algorithm) but with a different file header. Therefore trying to decode it with gzip will not work.</p>\n<p>The following will therefore take your original string, decode it from base64 and decompress it using zlib (not gzip):</p>\n<pre><code>package main\n  \nimport (\n        &quot;bytes&quot;\n        &quot;compress/zlib&quot;\n        &quot;encoding/base64&quot;\n        &quot;fmt&quot;\n        &quot;io/ioutil&quot;\n)\n\nfunc main() {\n        b64z := &quot;eNorTk0uSi0BAAjRAoc=&quot;\n        z, _ := base64.StdEncoding.DecodeString(b64z)\n        r, _ := zlib.NewReader(bytes.NewReader(z))\n        result, _ := ioutil.ReadAll(r)\n        fmt.Println(string(result))  // results in &quot;secret&quot;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3067, "user_id": 53991, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/2191b5cfee9c0fb7de571ac6cac45512?s=128&d=identicon&r=PG", "display_name": "perrohunter", "link": "https://stackoverflow.com/users/53991/perrohunter"}, "edited": false, "score": 0, "creation_date": 1554927162, "post_id": 55606902, "comment_id": 97934214, "body": "Thanks for the suggestion, I&#39;ll look into that but my input comes from a json blob that is pulled from redis, I can turn it into a stream afterwards, for now I got a solution from Steffen Ullrich which works"}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1554881030, "creation_date": 1554881030, "answer_id": 55606902, "question_id": 55602895, "link": "https://stackoverflow.com/questions/55602895/decompress-gzip-string-with-golang/55606902#55606902", "title": "Decompress gzip string with golang", "body": "<p>If you have large inputs, you might want to use streams and a custom chain of decoders instead.</p>\n\n<p>It has the advantage that (except for this example) neither the encoded input nor the decoded output has to reside in RAM.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"compress/zlib\"\n    \"encoding/base64\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"strings\"\n)\n\nconst nbody = \"eNorTk0uSi0BAAjRAoc=\"\n\nfunc main() {\n\n    _, err := io.Copy(os.Stdout, decoder(strings.NewReader(nbody)))\n    if err != nil {\n        log.Fatalf(\"Error copying decoded value to stdout: %s\",err)\n    }\n}\n\n// This could use any io.Reader as input, for example\n// a request body in http requests\nfunc decoder(r io.Reader) io.Reader {\n\n    // We simply set up a custom chain of Decoders\n    d, err := zlib.NewReader(\n        base64.NewDecoder(base64.StdEncoding, r))\n\n    // This should only occur if one of the Decoders can not reset\n    // its internal buffer. Hence, it validates a panic.\n    if err != nil {\n        panic(fmt.Sprintf(\"Error setting up decoder chain: %s\", err))\n    }\n\n    // We return an io.Reader which can be used as any other\n    return d\n\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/JhArP7p3OV5\" rel=\"nofollow noreferrer\"><strong>Run on playground</strong></a></kbd></p>\n"}], "owner": {"reputation": 3067, "user_id": 53991, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/2191b5cfee9c0fb7de571ac6cac45512?s=128&d=identicon&r=PG", "display_name": "perrohunter", "link": "https://stackoverflow.com/users/53991/perrohunter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7241, "favorite_count": 0, "accepted_answer_id": 55603287, "answer_count": 2, "score": -4, "last_activity_date": 1554881030, "creation_date": 1554854541, "question_id": 55602895, "link": "https://stackoverflow.com/questions/55602895/decompress-gzip-string-with-golang", "title": "Decompress gzip string with golang", "body": "<p>I have a string which contains a gzip compressed string, therefore there's no file headers, standard <code>compress/gzip</code> library throws error <code>gzip: invalid header</code></p>\n\n<p>How can I decompress a gzip compressed string in go?</p>\n\n<p>This is what I'm trying</p>\n\n<pre><code>nbody := \"eNorTk0uSi0BAAjRAoc=\"\nrdata := strings.NewReader(nbody)\nr,err := gzip.NewReader(rdata)\nlog.Println(r)\nif err != nil {\n    log.Fatal(err)\n}\ns, _ := ioutil.ReadAll(r)\nfmt.Println(string(s))\n</code></pre>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1554847090, "post_id": 55601883, "comment_id": 97899626, "body": "You probably want to use <code>data ...interface{}</code> instead of <code>data interface{}</code>"}, {"owner": {"reputation": 393, "user_id": 6794339, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/1832841430283368/picture?type=large", "display_name": "Hernan Huma&#241;a", "link": "https://stackoverflow.com/users/6794339/hernan-huma%c3%b1a"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1554848106, "post_id": 55601883, "comment_id": 97899931, "body": "\ud83e\udd14 can u explain me ?"}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1554848782, "post_id": 55601883, "comment_id": 97900132, "body": "change the function signature <code>func BenchmarkBulkInsert(data ...interface{})</code>"}], "answers": [{"comments": [{"owner": {"reputation": 393, "user_id": 6794339, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/1832841430283368/picture?type=large", "display_name": "Hernan Huma&#241;a", "link": "https://stackoverflow.com/users/6794339/hernan-huma%c3%b1a"}, "edited": false, "score": 0, "creation_date": 1554849469, "post_id": 55602226, "comment_id": 97900313, "body": "hey can u say me if the method that i`m using for insert a array is is written correctly?"}, {"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "reply_to_user": {"reputation": 393, "user_id": 6794339, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/1832841430283368/picture?type=large", "display_name": "Hernan Huma&#241;a", "link": "https://stackoverflow.com/users/6794339/hernan-huma%c3%b1a"}, "edited": false, "score": 0, "creation_date": 1554849558, "post_id": 55602226, "comment_id": 97900332, "body": "Yeah that&#39;s okay."}], "tags": [], "owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "is_accepted": true, "score": 3, "last_activity_date": 1554849083, "creation_date": 1554849083, "answer_id": 55602226, "question_id": 55601883, "link": "https://stackoverflow.com/questions/55601883/how-to-insert-an-interface-type-to-mongodb-with-bulk-insert/55602226#55602226", "title": "How to insert an interface{} type to mongodb with bulk.Insert()", "body": "<p>You should use <a href=\"https://gobyexample.com/variadic-functions\" rel=\"nofollow noreferrer\">variadic func</a>\nSo you have to change the input parameter from this :  </p>\n\n<pre><code>func BenchmarkBulkInsert(data interface{}) \n</code></pre>\n\n<p>to this :  </p>\n\n<pre><code>func BenchmarkBulkInsert(data ...interface{}) \n</code></pre>\n"}], "owner": {"reputation": 393, "user_id": 6794339, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/1832841430283368/picture?type=large", "display_name": "Hernan Huma&#241;a", "link": "https://stackoverflow.com/users/6794339/hernan-huma%c3%b1a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 55602226, "answer_count": 1, "score": 1, "last_activity_date": 1554880176, "creation_date": 1554846899, "last_edit_date": 1554880176, "question_id": 55601883, "link": "https://stackoverflow.com/questions/55601883/how-to-insert-an-interface-type-to-mongodb-with-bulk-insert", "title": "How to insert an interface{} type to mongodb with bulk.Insert()", "body": "<p>I can't insert a big array into my collection; I have a problem with the <code>interface{}</code> type.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>collections = getSession().DB(\"go\").C(\"comments\")\n\nfunc BenchmarkBulkInsert(data interface{}) {\n    bulk := collections.Bulk()\n\n    bulk.Insert(data...)\n    _, bulkErr := bulk.Run()\n    if bulkErr != nil {\n        panic(bulkErr)\n    }\n\n    fmt.Printf(\"\\n - %d comments inserted!\", reflect.ValueOf(data).Len())\n}\n</code></pre>\n\n<p>I can't build the app.  The error message is this: </p>\n\n<blockquote>\n  <p>cannot use data (type interface {}) as type []interface {} in argument to bulk.Insert: need type assertion</p>\n</blockquote>\n\n<p>I'm using the \"gopkg.in/mgo.v2\" package to connect to the Mongo database, and <code>data</code> is an array when I print it to the console.</p>\n"}, {"tags": ["http", "go", "filesystems"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1554846969, "post_id": 55601663, "comment_id": 97899587, "body": "Try <code>.&#47;details&#47;</code> instead of <code>&#47;details&#47;</code>"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554847330, "post_id": 55601663, "comment_id": 97899711, "body": "As a test, try an absolute path to your assets directory. The above is a relative path - and if your go server is not in the same directory, it will not find it."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1554847384, "post_id": 55601663, "comment_id": 97899733, "body": "@Abdullah the <code>&#47;details&#47;</code> handler path is correct"}, {"owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554847914, "post_id": 55601663, "comment_id": 97899884, "body": "@colminator Absolute path didn&#39;t help."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1554848585, "post_id": 55601663, "comment_id": 97900075, "body": "is there a user permission issue? i.e. what user is running the go-server and what file owership is on the assets directory?  Simplify your testing by pointing to /tmp/assets - and making all files/directories &#39;r-x&#39;"}, {"owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554849283, "post_id": 55601663, "comment_id": 97900270, "body": "@colminator shouldn&#39;t be a permission issue, I&#39;m just running it locally."}, {"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 2, "creation_date": 1554850444, "post_id": 55601663, "comment_id": 97900541, "body": "There is no problem with the code you posted. I ran it and it works just Okay. Make sure you have no typo in your url"}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 1, "last_activity_date": 1554851343, "creation_date": 1554851343, "answer_id": 55602520, "question_id": 55601663, "link": "https://stackoverflow.com/questions/55601663/static-directory-not-getting-served/55602520#55602520", "title": "Static directory not getting served", "body": "<p>Per the above comments double check your paths, permission, user contexts etc.</p>\n\n<p>If you are still stuck, start with this basic setup:</p>\n\n<pre><code>package main\n\nimport (\n        \"log\"\n        \"net/http\"\n)\n\nfunc main() {\n        fs := http.FileServer(http.Dir(\"/tmp/assets\"))\n        http.Handle(\"/details/\", http.StripPrefix(\"/details/\", fs))\n        log.Fatal(\n                http.ListenAndServe(\":8080\", nil),\n        )   \n}\n</code></pre>\n\n<p>And test with curl etc.</p>\n\n<pre><code>$ find /tmp/assets\n\n/tmp/assets\n/tmp/assets/test.json\n\n$ go run ./main.go\n\n$ curl localhost:8080/details/\n\n&lt;pre&gt;\n&lt;a href=\"test.json\"&gt;test.json&lt;/a&gt;\n&lt;/pre&gt;\n</code></pre>\n"}], "owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 55602520, "answer_count": 1, "score": 1, "last_activity_date": 1554877439, "creation_date": 1554845680, "last_edit_date": 1554877439, "question_id": 55601663, "link": "https://stackoverflow.com/questions/55601663/static-directory-not-getting-served", "title": "Static directory not getting served", "body": "<p>I'm trying to serve a folder in the root of my application called <code>assets</code>. I want all files and subfolders within there to be accessible through the url <code>/details/</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>fs := http.FileServer(http.Dir(\"assets\"))\nhttp.Handle(\"/details/\", http.StripPrefix(\"/details/\", fs))\n</code></pre>\n\n<p>I still get 404s for everything. Am I using <code>StripPrefix</code> incorrectly?</p>\n\n<p>To be clear, suppose <code>assets</code> contained <code>test.json</code>. I want that to be accessible from the URL <code>/details/test.json</code>.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1554840024, "post_id": 55600326, "comment_id": 97896900, "body": "Please post what you&#39;ve tried (Go code). Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1554840223, "post_id": 55600326, "comment_id": 97896981, "body": "Updated the question @icza"}, {"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554851878, "post_id": 55600326, "comment_id": 97900801, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/34827022/find-the-document-from-sub-array\">find the document from sub array?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 438, "user_id": 8258081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c67142456c223973b7a83db658744cd8?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas Tuemand M&#248;ller", "link": "https://stackoverflow.com/users/8258081/jonas-tuemand-m%c3%b8ller"}, "is_accepted": false, "score": 1, "last_activity_date": 1554843476, "creation_date": 1554843476, "answer_id": 55601234, "question_id": 55600326, "link": "https://stackoverflow.com/questions/55600326/how-can-i-find-a-document-based-on-value-in-a-nested-array-with-integer-keys/55601234#55601234", "title": "How can I find a document based on value in a nested array with integer keys?", "body": "<p>If you own the database I would suggest restructuring your data to look like this:</p>\n\n<pre><code>{ \n    \"_id\" : ObjectId(\"5ca0e44acb216df65405dc5f\"), \n    \"items\" : [\n        {\n            \"id\" : ObjectId(\"5c9fbb25e86deef65491c321\"), \n            \"active\" : true\n        }, \n        {\n            \"id\" : ObjectId(\"5c9fbb57cb216df65405dc5c\"), \n            \"active\" : false\n        }, \n        {\n            \"id\" : ObjectId(\"5c9fbb65cb216df65405dc5d\"), \n            \"active\" : false\n        }\n    ]\n}\n</code></pre>\n\n<p>Then you can use the MongoDB's own documentation: <a href=\"https://docs.mongodb.com/manual/tutorial/query-array-of-documents/\" rel=\"nofollow noreferrer\">Query an Array of Embedded Documents methods</a>.</p>\n"}], "owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554843476, "creation_date": 1554839467, "last_edit_date": 1554842350, "question_id": 55600326, "link": "https://stackoverflow.com/questions/55600326/how-can-i-find-a-document-based-on-value-in-a-nested-array-with-integer-keys", "title": "How can I find a document based on value in a nested array with integer keys?", "body": "<p>My find query looks like the following:</p>\n\n<p><code>bson.M{\"_id\": oId, \"items\": bson.M{\"$elemMatch\": bson.M{\"id\": theId, \"active\": true}}}</code> (where <code>theId</code> is the object id from a method)</p>\n\n<p>What I'm trying to do is to select a document with the matching <code>id</code> and where <code>active</code> is set to <code>true</code></p>\n\n<pre><code>{ \n    \"_id\" : ObjectId(\"5ca0e44acb216df65405dc5f\"), \n    \"items\" : {\n        \"0\" : {\n            \"id\" : ObjectId(\"5c9fbb25e86deef65491c321\"), \n            \"active\" : true\n        }, \n        \"1\" : {\n            \"id\" : ObjectId(\"5c9fbb57cb216df65405dc5c\"), \n            \"active\" : false\n        }, \n        \"2\" : {\n            \"id\" : ObjectId(\"5c9fbb65cb216df65405dc5d\"), \n            \"active\" : false\n        }\n    }, \n}\n</code></pre>\n\n<p>But no matter how I do it, it never finds any documents. How can this be done?</p>\n\n<p>Edit: Added my Go code.</p>\n\n<pre><code>func CountRows(find interface{}) int {\n    session := database.GetMongoSession()\n    defer session.Close()\n\n    c := session.DB(config.Settings.Database.Name).C(\"list\")\n\n    count, err := c.Find(find).Count()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return count\n}\n\nfunc IsActive(oId bson.ObjectId, theId bson.ObjectId) bool {\n    if CountRows(bson.M{\"_id\": oId, \"items\": bson.M{\"$elemMatch\": bson.M{\"id\": theId , \"active\": true}}}) &gt; 0 {\n        return true\n    }\n\n    return false\n}\n</code></pre>\n\n<p>It always returns false because it can't find any documents.</p>\n"}, {"tags": ["go", "arangodb", "aql"], "comments": [{"owner": {"reputation": 1635, "user_id": 3571016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yTG7n.png?s=128&g=1", "display_name": "camba1", "link": "https://stackoverflow.com/users/3571016/camba1"}, "edited": false, "score": 0, "creation_date": 1554840370, "post_id": 55599768, "comment_id": 97897052, "body": "So if you remove the update (last two rows of your AQL) and just return e._key, does that return only your record? Also since <code>e.@key0</code> is actually the <code>_from</code> field of the edge, this means it will try to update any type of edge that starts at  <code>@val0</code>. Are all the edges in the traversal of type &#39;has_skill&#39; (you are traversing 5 steps in your query). If any of the edges start at node <code>@val0</code> and are not of type has_skill, you would get the error above when the system tries to do the update"}, {"owner": {"reputation": 19, "user_id": 11336397, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OLBzFFev1ig/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3revhxnoqL-WkwrBF1IHS7dPeSDRbg/mo/photo.jpg?sz=128", "display_name": "Matthew Loughney", "link": "https://stackoverflow.com/users/11336397/matthew-loughney"}, "reply_to_user": {"reputation": 1635, "user_id": 3571016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yTG7n.png?s=128&g=1", "display_name": "camba1", "link": "https://stackoverflow.com/users/3571016/camba1"}, "edited": false, "score": 0, "creation_date": 1554841355, "post_id": 55599768, "comment_id": 97897464, "body": "Yep, that was the issue, thanks."}], "answers": [{"comments": [{"owner": {"reputation": 1886, "user_id": 364157, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LZ6oI.jpg?s=128&g=1", "display_name": "David Thomas", "link": "https://stackoverflow.com/users/364157/david-thomas"}, "edited": false, "score": 1, "creation_date": 1554883672, "post_id": 55600699, "comment_id": 97909956, "body": "Typically if someone answers your question in a comment, it&#39;s recommended you ask them to post their comment as an answer so you can accept it and give them credit for the fix."}, {"owner": {"reputation": 19, "user_id": 11336397, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OLBzFFev1ig/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3revhxnoqL-WkwrBF1IHS7dPeSDRbg/mo/photo.jpg?sz=128", "display_name": "Matthew Loughney", "link": "https://stackoverflow.com/users/11336397/matthew-loughney"}, "reply_to_user": {"reputation": 1886, "user_id": 364157, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LZ6oI.jpg?s=128&g=1", "display_name": "David Thomas", "link": "https://stackoverflow.com/users/364157/david-thomas"}, "edited": false, "score": 0, "creation_date": 1554908902, "post_id": 55600699, "comment_id": 97925204, "body": "I realize that. In this case, I actually thought of the fix myself, implemented it, then thought &quot;oh wait, I posted that on stackoverflow. I don&#39;t want to delete is in case someone else has a similar problem. I&#39;ll go answer it myself so no one wastes their time answering it since I already found a fix.&quot; Then I put up the answer then noticed their comment."}], "tags": [], "owner": {"reputation": 19, "user_id": 11336397, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OLBzFFev1ig/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3revhxnoqL-WkwrBF1IHS7dPeSDRbg/mo/photo.jpg?sz=128", "display_name": "Matthew Loughney", "link": "https://stackoverflow.com/users/11336397/matthew-loughney"}, "is_accepted": true, "score": 0, "last_activity_date": 1554841156, "creation_date": 1554841156, "answer_id": 55600699, "question_id": 55599768, "link": "https://stackoverflow.com/questions/55599768/aql-update-succeeds-in-collection-loop-but-throws-not-found-error-in-graph-trave/55600699#55600699", "title": "AQL update succeeds in collection loop but throws not found error in graph traversal", "body": "<p>It turned out that my filter was returning some edges not in the <code>has_skill</code> collection (4 total to be exact), so when it tried to update in <code>has_skill</code>, it succeeded for the one I wanted but failed for the other 3, and since the UPDATE operation is atomic that made it fail for all of them. I did not notice this because I was only looking at the first edge returned when looking at the keys, and this wasn't an issue in my <code>FOR e IN collectionName</code> query because obviously those are all in the correct collection, so that only returned the 1 edge I was looking for.</p>\n"}], "owner": {"reputation": 19, "user_id": 11336397, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OLBzFFev1ig/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3revhxnoqL-WkwrBF1IHS7dPeSDRbg/mo/photo.jpg?sz=128", "display_name": "Matthew Loughney", "link": "https://stackoverflow.com/users/11336397/matthew-loughney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "accepted_answer_id": 55600699, "answer_count": 1, "score": 0, "last_activity_date": 1554841156, "creation_date": 1554837293, "question_id": 55599768, "link": "https://stackoverflow.com/questions/55599768/aql-update-succeeds-in-collection-loop-but-throws-not-found-error-in-graph-trave", "title": "AQL update succeeds in collection loop but throws not found error in graph traversal", "body": "<p>I am trying to figure out how to update edge documents using a graph traversal query in arangodb. I am able to do this using the standard\n<code>FOR e IN collectionName UPDATE e with {newProps} IN collectionName</code>. However I cannot figure out what is wrong with my attempt to accomplish the same thing using the\n<code>FOR v, e, p IN 1..5 OUTBOUND @startId GRAPH @graphName</code> syntax.</p>\n\n<p>I am using the arangodb:latest docker image on macOS Mojave 10.14.3, and I am using arango's go library (github.com/arangodb/go-driver) to query by building a query string and sending it using the Database.Query() function. I have tried just returning the key for the edge I'm trying to update (i.e. just returning <code>e._key</code> instead of attempting to update in the query below), and have verified using arangosh that that is indeed the correct key of the edge I'm trying to update. Additionally as stated above, I have been able to update an edge using the relational AQL syntax.</p>\n\n<p>Here is my query:</p>\n\n<pre><code>FOR v, e, p IN 1..5 OUTBOUND @startId GRAPH @graphName\n    FILTER e.@key0 == @val0\n    UPDATE e._key WITH {@propName0: @propValue0} IN has_skill\n    RETURN {new: NEW, old: OLD}\n</code></pre>\n\n<p>and here are my bind variables:</p>\n\n<pre><code>[graphName:Matthew_Loughney, key0:_from, propName0:testProp, propValue0:testVal, startId:applicant/232, val0:applicant/232]\n</code></pre>\n\n<p>I would expect that when I view the <code>has_skill</code> collection using arangosh, I would see that my edge now has a property <code>testProp</code> with value <code>testVal</code>; however, I instead just get the error <code>AQL: document not found (while executing)</code> and my edge remains unchanged.</p>\n"}, {"tags": ["go", "code-generation"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 7, "creation_date": 1554834201, "post_id": 55598931, "comment_id": 97894346, "body": "<code>go:generate</code> must be a single line. If your command is too long for your taste you would need to move it to e.g. a shell script, and execute that script via <code>go:generate</code>."}], "answers": [{"tags": [], "owner": {"reputation": 161, "user_id": 11339140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_oZaOqfxYFI/AAAAAAAAAAI/AAAAAAAAADw/o9Jcv0YYArU/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0444\u043e\u0440 \u0421\u0435\u0440\u044f\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/11339140/%d0%9d%d0%b8%d0%ba%d0%b8%d1%84%d0%be%d1%80-%d0%a1%d0%b5%d1%80%d1%8f%d0%ba%d0%be%d0%b2"}, "is_accepted": true, "score": 5, "last_activity_date": 1589566251, "last_edit_date": 1589566251, "creation_date": 1554887408, "answer_id": 55608796, "question_id": 55598931, "link": "https://stackoverflow.com/questions/55598931/go-generate-multiline-command/55608796#55608796", "title": "&quot;go generate&quot; multiline command", "body": "<p>There is no way to split go generate command into several lines, but there are some tips.</p>\n\n<p>If you need to run multiple short commands you can write them one by one like the following.</p>\n\n<pre><code>//go:generate echo command A\n//go:generate echo command B\n//go:generate ls\n</code></pre>\n\n<p>You also should know that there is not a bash script but a raw command. So the following works not as one may expect.</p>\n\n<pre><code>//go:generate echo something | tr a-z A-Z &gt; into_file\n// result in \"something | tr a-z A-Z &gt; into_file\"\n</code></pre>\n\n<p>For long or complex commands you should use separate script (or maybe go program) that is called from go:generate comment.</p>\n\n<pre><code>//go:generate sh generate.sh\n//go:generate go run generator.go arg-A arg-B\n</code></pre>\n\n<p>In generator.go you should use build tag to prevent it from normal compilation with other files.</p>\n\n<pre><code>// +build ignore\n\npackage main\n// ...\n</code></pre>\n\n<p>The best place to learn go is go sources: <a href=\"https://github.com/golang/go/blob/master/src/runtime/runtime.go#L13\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/runtime/runtime.go#L13</a></p>\n"}], "owner": {"reputation": 605, "user_id": 1833375, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh4.googleusercontent.com/-fDVU1oE52OQ/AAAAAAAAAAI/AAAAAAAAAB0/vttX9bxzSiM/photo.jpg?sz=128", "display_name": "John White", "link": "https://stackoverflow.com/users/1833375/john-white"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2162, "favorite_count": 1, "accepted_answer_id": 55608796, "answer_count": 1, "score": 3, "last_activity_date": 1589566251, "creation_date": 1554833897, "question_id": 55598931, "link": "https://stackoverflow.com/questions/55598931/go-generate-multiline-command", "title": "&quot;go generate&quot; multiline command", "body": "<p>I'm trying to use <code>//go:generate</code> to run an external tool before compiling my code, and as I need to pass a certain number of parameters, the line becomes rather long.</p>\n\n<p>It seems that there is no way to write a multiline <code>go:generate</code> command, is it correct? Are there alternative approaches?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["arrays", "go", "memory", "slice"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1554831112, "post_id": 55598220, "comment_id": 97892924, "body": "In oder to shift values in a slice (or array), you need to move each value, there&#39;s no &quot;more optimized&quot; way to do this. It sounds like you want a different data structure, are you trying to make a ring-buffer?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1554831190, "post_id": 55598220, "comment_id": 97892963, "body": "The temporary buffer can be eliminated: <a href=\"https://play.golang.org/p/72T8AquHG-B\" rel=\"nofollow noreferrer\">play.golang.org/p/72T8AquHG-B</a>.   If the cost of shifting is high, then you may want to use a <a href=\"https://en.wikipedia.org/wiki/Circular_buffer\" rel=\"nofollow noreferrer\">ring buffer</a> as JimB suggests."}, {"owner": {"reputation": 347, "user_id": 9370956, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Mikael Brenner", "link": "https://stackoverflow.com/users/9370956/mikael-brenner"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1554831348, "post_id": 55598220, "comment_id": 97893056, "body": "@JimB Wouldn&#39;t a double ended queue do the same? Like he gets the data from one end and add to the other"}, {"owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "edited": false, "score": 0, "creation_date": 1554831447, "post_id": 55598220, "comment_id": 97893105, "body": "yeah no need for temporary buffer (thanks) , my problem is like I will always have n data in order , and whenever new data comes, I need to throw the first one and keep the new one in last"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 347, "user_id": 9370956, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Mikael Brenner", "link": "https://stackoverflow.com/users/9370956/mikael-brenner"}, "edited": false, "score": 2, "creation_date": 1554831770, "post_id": 55598220, "comment_id": 97893227, "body": "@MikaelBrenner: sure, I only mentioned one other possibility for brevity, since a ring-buffer is often the most efficient implementation, and the question was really about slices."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1554831889, "post_id": 55598220, "comment_id": 97893281, "body": "@mkmayank: if you are always removing from the head and appending to the tail with a fixed amount of storage, then you want a circular buffer of some sort. There is a <a href=\"https://golang.org/pkg/container/ring\" rel=\"nofollow noreferrer\"><code>container&#47;ring</code></a> package in the stdlib, or you can simply abstract the concept over a fixed slice (or find another package that does for you)"}, {"owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "edited": false, "score": 1, "creation_date": 1554831936, "post_id": 55598220, "comment_id": 97893308, "body": "using ring buffer, I just need to keep track of pointer(read,write) , in my case it will always be the same  <a href=\"https://play.golang.org/p/_4Of9XTUsQA\" rel=\"nofollow noreferrer\">play.golang.org/p/_4Of9XTUsQA</a> is it almost optimized or is there still room ?"}, {"owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554832570, "post_id": 55598220, "comment_id": 97893592, "body": "@JimB thanks for suggesting <code>ring</code> package , though it will consume function stack, type assertion, internal computation, Which will be better, above commented custom pointer solution or ring package in terms of performance, as this operation will happen at every millisecond multiple times ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1554832752, "post_id": 55598220, "comment_id": 97893676, "body": "Obviously doing less work is faster. If you can pre-allocate what you need, and only manipulate the slice index, then there&#39;s not much else to optimize. When in doubt, benchmark and measure."}, {"owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "edited": false, "score": 0, "creation_date": 1554832913, "post_id": 55598220, "comment_id": 97893766, "body": "thanks, I will post do benchmark and post here too, if someone requires in future"}], "answers": [{"tags": [], "owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "is_accepted": true, "score": 1, "last_activity_date": 1554837819, "last_edit_date": 1554837819, "creation_date": 1554835112, "answer_id": 55599255, "question_id": 55598220, "link": "https://stackoverflow.com/questions/55598220/efficiently-keeping-a-collection-of-the-last-n-pushed-items/55599255#55599255", "title": "efficiently keeping a collection of the last N pushed items", "body": "<p>Slice ring buffer, custom implementation :</p>\n\n<pre><code>data := make([]int, cap, cap)\npointer := 0\n\ndata[pointer] = newData\npointer = (pointer+1) % cap\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/container/ring\" rel=\"nofollow noreferrer\">custom/ring</a> package implemetation :</p>\n\n<pre><code>data := ring.New(cap)\ndata.Value = newData\ndata = data.Next()\n</code></pre>\n\n<p>After suggestion in comment thread, I did <a href=\"https://play.golang.org/p/KrVJodjDGy7\" rel=\"nofollow noreferrer\">benchmark</a> between <a href=\"https://play.golang.org/p/_4Of9XTUsQA\" rel=\"nofollow noreferrer\">slice custom shifting</a> and <a href=\"https://golang.org/pkg/container/ring\" rel=\"nofollow noreferrer\">custom/ring</a></p>\n\n<pre><code>BenchmarkCustom1000-4         100000         17322 ns/op\nBenchmarkRing1000-4           100000         22824 ns/op\nBenchmarkCustom-4           100000000           17.4 ns/op\nBenchmarkRing-4             100000000           22.8 ns/op\n</code></pre>\n\n<p>custom slice shifting using variable (pointer or flag) is faster and also memory optimised.</p>\n"}], "owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 55599255, "answer_count": 1, "score": 0, "last_activity_date": 1554837819, "creation_date": 1554830939, "last_edit_date": 1554834915, "question_id": 55598220, "link": "https://stackoverflow.com/questions/55598220/efficiently-keeping-a-collection-of-the-last-n-pushed-items", "title": "efficiently keeping a collection of the last N pushed items", "body": "<p>Given:</p>\n\n<ol>\n<li>slice with pre-known capacity</li>\n<li>capacity and number of slices are large , and around 15MB of memory will be used, so I don't want to waste memory and want to keep minimum memory.</li>\n<li>slice will be updated by removing first element and adding new element to end of slice.</li>\n</ol>\n\n<p><code>b = append(b[1:], n)</code> will increase capacity</p>\n\n<p>to shift and assign myself, I wrote</p>\n\n<pre><code>func shiftAndPut(a []int, n int) (b []int) {\n    b = make([]int, cap(a), cap(a))\n    for i,v := range(a[1:]) {\n        b[i] = v\n    }\n    b[len(b)-1] = n\n    return\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/7xIBh0UPp2w\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7xIBh0UPp2w</a></p>\n\n<p>It keeps the capacity same, but requires various computations </p>\n\n<ol>\n<li>iterating slice one time,</li>\n<li>calling of function,</li>\n<li>new variable for small time,</li>\n<li>sub slicing in range function, which adds more computations,</li>\n<li>etc</li>\n</ol>\n\n<p>Is there any more optimised way to do this?</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554825624, "post_id": 55596841, "comment_id": 97890303, "body": "You haven&#39;t changed the logger destination so it&#39;s not logging to file, it&#39;s logging to stderr (unless you&#39;re piping stderr to file)."}, {"owner": {"reputation": 1, "user_id": 11260388, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lQepLnJVylw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdg-te1LLV6wZ3qVwkMBdjYSXyMqA/mo/photo.jpg?sz=128", "display_name": "Deniz Tohumcu", "link": "https://stackoverflow.com/users/11260388/deniz-tohumcu"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554825996, "post_id": 55596841, "comment_id": 97890499, "body": "@Adrian <code>log.SetOutput(f)</code> sets destionation to created file but I have no logs whatsoever. I was inspired by this : <a href=\"https://stackoverflow.com/questions/19965795/go-golang-write-log-to-file\" title=\"go golang write log to file\">stackoverflow.com/questions/19965795/&hellip;</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554827069, "post_id": 55596841, "comment_id": 97891040, "body": "Ah I just saw that, but it happens after almost all of your logging calls."}, {"owner": {"reputation": 1, "user_id": 11260388, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lQepLnJVylw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdg-te1LLV6wZ3qVwkMBdjYSXyMqA/mo/photo.jpg?sz=128", "display_name": "Deniz Tohumcu", "link": "https://stackoverflow.com/users/11260388/deniz-tohumcu"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554827849, "post_id": 55596841, "comment_id": 97891412, "body": "@Adrian Yeah, every single time, I tried without the <code>defer f.close</code> now it works but why would the defer function would block my destination?"}], "owner": {"reputation": 1, "user_id": 11260388, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lQepLnJVylw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdg-te1LLV6wZ3qVwkMBdjYSXyMqA/mo/photo.jpg?sz=128", "display_name": "Deniz Tohumcu", "link": "https://stackoverflow.com/users/11260388/deniz-tohumcu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554825466, "creation_date": 1554825466, "question_id": 55596841, "link": "https://stackoverflow.com/questions/55596841/how-to-fix-a-log-function-that-is-not-excuted-in-a-function", "title": "How to fix a log function that is not excuted in a function?", "body": "<p>I am making a logging function for logging data arrives from CANBUS.</p>\n\n<p>I have used prints to see if I can enter every condition and I can recieve I am in message but I can't append and log in to my file that I have created. All not declared variables are globals.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\npackage main\n\nimport (\n    Filter \"go/src/Filter/FiltreLib\"\n    \"flag\"\n    \"fmt\"\n    \"github.com/go-daq/canbus\"\n    \"log\"\n    \"os\"\n    \"strconv\"\n    \"sync\"\n    \"time\"\n)\n\n\nfunc main(){\nsck, err := canbus.New()\n        if err != nil {\n            log.Fatal(err)\n        }\n        defer sck.Close()\n\n        addr := \"can 0\"\n        err = sck.Bind(addr)\n        if err != nil {\n            log.Fatalf(\"error binding to [%s]: %v\\n\", addr, err)\n        }\n        state = \"s\" //Silent as default\n\n        go func() {\n            for {\n                fmt.Scanln(&amp;newstate)\n                switch true {\n                case state == \"s\" &amp;&amp; \"v\" == newstate: // if silence -&gt; verbose\n                    state = \"v\"\n                    fmt.Println(state)\n                    break\n                case state == \"v\" &amp;&amp; \"s\" == newstate: // if Verbose -&gt; Silence\n                    state = \"s\"\n                    fmt.Println(state)\n                    break\n                }\n            }\n        }()\n        for {\n            CANtoDATA(sck, 4)\n        }\n}\nfunc CANtoDATA(sck *canbus.Socket, IDDS int)() { //Takes Frames from can and logs them in xlsx\n\n    id,msg,err = sck.Recv() //gets new frame\n    FileCreatorWriter(IDDS,msg)\n    framestoString(IDDS)\n\n}\n\nfunc FileCreatorWriter(DS int, data []byte)(err error){\n    if datecheck != time.Now().Format(\"01-02-2006\") {\n        token = false\n    }\n    if token == false {\n        datecheck = time.Now().Format(\"01-02-2006\")\n        date = time.Now().Format(\" 01-02-2006 - 15:04:05\")\n        f, err = os.OpenFile(\"IDDS: \"+strconv.Itoa(DS)+\" - \"+date+\".txt\", os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)\n        if err != nil {\n            log.Fatalf(\"error opening file: %v\", err)\n        }\n        defer f.Close()\n\n        if err != nil {\n            fmt.Printf(err.Error())\n        }\n        token = true\n    }\n    _,frameID = CityFilter.FrameIden(id)\n    IDds := CityFilter.ReadIDDS(Converter(data))\n\n    if  DS == IDds &amp;&amp; 1 == frameID {\n        fmt.Printf(\"I am in!!!!!!\")\n        log.SetOutput(f)\n        log.Println(datamap)\n    }\n    return\n}\n\n\n</code></pre>\n\n<p>I want to see the data map logged in the created file and append with every iteration.</p>\n"}, {"tags": ["go", "networking", "tcp", "websocket", "server"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1554825224, "post_id": 55596417, "comment_id": 97890088, "body": "Mutexes are for synchronizing access to some shared data, so they don&#39;t apply here. Separating them looks pretty much just like you wrote out: one routine reads from <code>conn</code> and prints to stdout, one reads from stdin and writes to <code>conn</code>; and you already have code for doing those things. Have you tried actually implementing it that way? What issue(s) did you encounter?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554828972, "post_id": 55596417, "comment_id": 97891982, "body": "A note on terminology: You don&#39;t write goroutines. You write functions which are executed in goroutines. Think of goroutines like threads."}], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 0, "last_activity_date": 1554826674, "creation_date": 1554826674, "answer_id": 55597178, "question_id": 55596417, "link": "https://stackoverflow.com/questions/55596417/how-to-write-functions-that-are-executed-in-goroutines-to-send-and-receive-messa/55597178#55597178", "title": "How to write functions that are executed in goroutines to send and receive messages?", "body": "<p>You can create a function like this one, that returns a channel. It also starts a new go routine that will write to the returned channel.</p>\n\n<p>This allows consumers to call this method, and expect values back on the returned channel.</p>\n\n<p>I've also updated the method signature to use a <code>*bufio.Scanner</code> as it's a more efficient method of splitting on newlines.</p>\n\n<pre><code>func ReadFully(scanner *bufio.Scanner) &lt;-chan string {\n    out := make(chan  string)\n\n    go func() {\n        // once all the values have been read, close the channel\n        // this tells the consumers that there will not be anymore\n        // values and they don't need to keep listening to this channel.\n        defer close(out)\n\n        for scanner.Scan() {\n            out &lt;- scanner.Text()\n        }\n\n        if err := scanner.Err(); err!= nil {\n            log.Fatal(err)\n        }\n    }()\n\n    return out\n}\n</code></pre>\n\n<p>Now we can use this <code>ReadFully</code> method in <code>SocketClient</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func SocketClient() {\n    conn, err := net.Dial(\"tcp\", \":9000\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer conn.Close()\n\n    serverScan := bufio.NewScanner(conn)\n    inputScan := bufio.NewScanner(os.Stdin)\n\n\n    serverCh := ReadFully(serverScan)\n    inputCh := ReadFully(inputScan)\n\n\n    // create a wait group, this stops the SocketClient \n    // method from exiting until the workers are done.\n    var wg sync.WaitGroup\n    wg.Add(2)\n\n    go func() {\n        defer wg.Done()\n        for v := range inputCh {\n            _, _ = conn.Write([]byte(v))\n        }\n    }()\n\n    go func() {\n        defer wg.Done()\n        for v := range serverCh {\n            fmt.Printf(\"Received: %s\\n\", v)\n        }\n    }()\n\n    wg.Wait()\n}\n\n</code></pre>\n\n<p>Note, this example entirely omits cancellations etc. In general you should never start a go routine without a way to stop it. </p>\n\n<p>Check out this great article on pipelines.\n<a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">https://blog.golang.org/pipelines</a></p>\n"}, {"comments": [{"owner": {"reputation": 5, "user_id": 9812935, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Q1jTRzBTVBg/AAAAAAAAAAI/AAAAAAAADcM/vDpqMdyR7aI/photo.jpg?sz=128", "display_name": "abhishek singla", "link": "https://stackoverflow.com/users/9812935/abhishek-singla"}, "edited": false, "score": 0, "creation_date": 1555508868, "post_id": 55597484, "comment_id": 98137038, "body": "your code works perfectly fine but can you tell me that the function that you wrote in goroutine, when exactly does it get the chance to get executed? Once the execution reaches the for loop after the goroutine, it will just get continuously running, as there is no Sleep, chan, Waitgroup involved in the function. Every other tutorial I see involves the use of them to achieve what you have done here."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 5, "user_id": 9812935, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Q1jTRzBTVBg/AAAAAAAAAAI/AAAAAAAADcM/vDpqMdyR7aI/photo.jpg?sz=128", "display_name": "abhishek singla", "link": "https://stackoverflow.com/users/9812935/abhishek-singla"}, "edited": false, "score": 0, "creation_date": 1555512754, "post_id": 55597484, "comment_id": 98139649, "body": "The goroutine is started in the SocketClient function.  It loops reading lines until read returns an error.  Read blocks until it has read a line or there is an error on the connection."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1554829876, "last_edit_date": 1554829876, "creation_date": 1554827958, "answer_id": 55597484, "question_id": 55596417, "link": "https://stackoverflow.com/questions/55596417/how-to-write-functions-that-are-executed-in-goroutines-to-send-and-receive-messa/55597484#55597484", "title": "How to write functions that are executed in goroutines to send and receive messages?", "body": "<p>Run one of the loops directly in <code>SocketClient</code>. Run the other loop in a new goroutine started by <code>SocketClient</code>.</p>\n\n<pre><code>func SocketClient() error {\n    conn, err := net.Dial(\"tcp\", \":9000\")\n    if err != nil {\n        return err\n    }\n    defer conn.Close()\n    server_reader := bufio.NewReader(conn)\n    input_reader := bufio.NewReader(os.Stdin)\n\n    go func() {\n        defer conn.Close()\n\n        // This loop will break and the goroutine will exit when the\n        // SocketClient function executes conn.Close().\n\n        for {\n            buff, err := server_reader.ReadBytes('\\n')\n            if err != nil {\n                // optional: log.Fatal(err) to cause program to exit without waiting for new input from stdin.\n                return\n            }\n            fmt.Printf(\"Received: %s\", buff)\n        }\n    }()\n\n    for {\n        // for sending messages\n        buff, err := input_reader.ReadBytes('\\n')\n        if err != nil {\n            return err\n        }\n        if _, err := conn.Write(buff); err != nil {\n            return err\n        }\n    }\n}\n</code></pre>\n\n<p>Use the bufio.Reader <code>ReadBytes</code> method instead of the <code>ReadString</code> to avoid unnecessary conversions between <code>[]byte</code> and <code>string</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 3906, "user_id": 624395, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/202bfd99f4900ed88a72e4c1721dbe95?s=128&d=identicon&r=PG", "display_name": "Marco", "link": "https://stackoverflow.com/users/624395/marco"}, "is_accepted": false, "score": 0, "last_activity_date": 1555013512, "creation_date": 1555013512, "answer_id": 55640434, "question_id": 55596417, "link": "https://stackoverflow.com/questions/55596417/how-to-write-functions-that-are-executed-in-goroutines-to-send-and-receive-messa/55640434#55640434", "title": "How to write functions that are executed in goroutines to send and receive messages?", "body": "<p>I wrote a blog post on Go concurrency. <a href=\"https://marcofranssen.nl/concurrency-in-go/\" rel=\"nofollow noreferrer\">https://marcofranssen.nl/concurrency-in-go/</a></p>\n\n<p>also used some of the concepts in this blog post.</p>\n\n<p><a href=\"https://marcofranssen.nl/go-webserver-with-gracefull-shutdown/\" rel=\"nofollow noreferrer\">https://marcofranssen.nl/go-webserver-with-gracefull-shutdown/</a> </p>\n\n<p>which also allows me to intercept commandline input like signals to safely shutdown the server.</p>\n\n<p>You might use a similar approach to take your commanding input and user it.</p>\n\n<p>The main idea is to use channels for communicating between your go routines.</p>\n"}], "owner": {"reputation": 5, "user_id": 9812935, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Q1jTRzBTVBg/AAAAAAAAAAI/AAAAAAAADcM/vDpqMdyR7aI/photo.jpg?sz=128", "display_name": "abhishek singla", "link": "https://stackoverflow.com/users/9812935/abhishek-singla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 55597484, "answer_count": 3, "score": 0, "last_activity_date": 1555013512, "creation_date": 1554823979, "last_edit_date": 1554967342, "question_id": 55596417, "link": "https://stackoverflow.com/questions/55596417/how-to-write-functions-that-are-executed-in-goroutines-to-send-and-receive-messa", "title": "How to write functions that are executed in goroutines to send and receive messages?", "body": "<p>I have to write a client side code that is receiving messages in the form of strings from server as well as taking input from the console to end message to the server. Both these operations should run concurrently with each other. I have written a code which perform these operations but sequentially not concurrently.</p>\n\n<p>Here's what my current code looks like:</p>\n\n<pre><code>func SocketClient() {\n    conn, err := net.Dial(\"tcp\", \":9000\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer conn.Close()\n    server_reader := bufio.NewReader(conn)\n    input_reader := bufio.NewReader(os.Stdin)\n    for {\n        // for sending messages\n        buff, err := input_reader.ReadString('\\n')\n        if err != nil {\n            log.Fatalln(err)\n        }\n        conn.Write([]byte(buff))\n\n        // for receiving messages but this won't run until the above has taken input from console\n        buff2, err := server_reader.ReadString('\\n')\n        if err != nil {\n            log.Fatalln(err)\n        }\n        fmt.Println(\"Received: %s\", buff2)\n    }\n}\n</code></pre>\n\n<p>buff receives incoming messages from server and then buff2 takes outgoing message input from console but in order to receive the incoming messages again, buff2 needs some input. I know this can be done using channels, mutex locks etc. but because of my lack of understanding of fundamentals I am having problem using them.</p>\n\n<p>I guess the actual code should look something like this:</p>\n\n<pre><code>func SocketClient() {\n    conn, err := net.Dial(\"tcp\", \":9000\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer conn.Close()\n    go func() {\n        // for sending messages\n    } ()\n    go func() {\n        // for receiving messages\n    } ()\n}\n</code></pre>\n\n<p>How to make the input and output as two separate goroutines?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554829494, "post_id": 55596317, "comment_id": 97892194, "body": "Are you sure it&#39;s actually an IPv6 address, or is it an IPv4-mapped IPv6 address? Are you using a load-balancer/reverse-proxy, or are the IPv6 clients coming through an http proxy?"}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554848181, "post_id": 55596317, "comment_id": 97899956, "body": "@JimB not sure if clients are coming from a proxy but they are mostly from vietnam. I asked them to do a <i>whatismyip</i> search and it comes up with a ipv4 and ipv6 address. I also tried <code>net.ParseIP(&quot;2001:44b8:2169:c800:xxxx:c80a:b134:cc40&quot;).To4()</code> which returns nil."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554904294, "post_id": 55596317, "comment_id": 97922372, "body": "OK, some remote clients have an IPv6 address. If you don&#39;t have a load balancer or reverse proxy in your service, then it&#39;s coming through another proxy somewhere. What exactly is the problem?"}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554907973, "post_id": 55596317, "comment_id": 97924603, "body": "@JimB I only want to get the IPv4 address. Because I have another TCP server that is I want to compare IP addressees to and I can&#39;t because the website gets an v6 while the server gets a v4 address. So I want to get only IPv4 on the website too."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554908825, "post_id": 55596317, "comment_id": 97925150, "body": "The IPv4 address of <i>what</i>? You either the want reported client address, which may be IPv6, because it is on the internet and you can&#39;t ignore that IPv6 exists; or you want the address of the tcp connection. If you only want the address of the remote <i>connection</i>, that&#39;s <code>Request.RemoteAddr</code>, but it&#39;s of course often not the original client IP address. (The docs for <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.ClientIP\" rel=\"nofollow noreferrer\"><code>ClientIP</code></a> should explain <i>why</i> you&#39;re getting the IP your are)"}], "owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3700, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1554847606, "creation_date": 1554823657, "last_edit_date": 1554847606, "question_id": 55596317, "link": "https://stackoverflow.com/questions/55596317/golang-gin-get-client-ip-in-ipv4-only", "title": "Golang gin get client IP in ipv4 only", "body": "<p>I'm trying to get the IP address of the client when using <code>gin-gonic</code> but sometimes it gives me the IPv6 address which I don't want.</p>\n\n<p>My current code looks like this:</p>\n\n<pre><code>web.POST(\"/path\", func(c *gin.Context) {\n    ipAddr := c.ClientIP() // sometimes ipv4, sometimes ipv6\n</code></pre>\n\n<p>How do I get only the IPv4 address?</p>\n\n<p>For reference I'm only listening on IPv4 address:</p>\n\n<pre><code>server := &amp;http.Server{\n    Handler: router,\n}\nl, err := net.Listen(\"tcp4\", cfg.Listen)\nif err != nil {\n    panic(err)\n}\nerr = server.Serve(l)\n</code></pre>\n\n<hr>\n\n<p>Here are examples of the IPv6 addresses I'm receiving: </p>\n\n<pre><code>2402:800:6371:2f72:xxxx:bf67:3689:95df\n2001:44b8:2169:c800:xxxx:c80a:b134:cc40\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "testify"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1554823669, "post_id": 55596268, "comment_id": 97889190, "body": "Edit the question to give the import path of the <code>assert</code> package and the code for <code>indexOutOfRange</code>."}, {"owner": {"reputation": 9920, "user_id": 7599833, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74ae2f4b27f5f727270818eba261aa0b?s=128&d=identicon&r=PG", "display_name": "Helder Sepulveda", "link": "https://stackoverflow.com/users/7599833/helder-sepulveda"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1554824122, "post_id": 55596268, "comment_id": 97889466, "body": "@CeriseLim&#243;n Added the import of <code>assert</code> it is part of the <code>github.com&#47;stretchr&#47;testify&#47;assert</code>"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1554824365, "post_id": 55596268, "comment_id": 97889615, "body": "Does the function really panic? Do you call <code>panic()</code> inside that function? You should not test an internal panic, because if the language changes, your tests will fail without changing anything in your code."}], "answers": [{"comments": [{"owner": {"reputation": 9920, "user_id": 7599833, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74ae2f4b27f5f727270818eba261aa0b?s=128&d=identicon&r=PG", "display_name": "Helder Sepulveda", "link": "https://stackoverflow.com/users/7599833/helder-sepulveda"}, "edited": false, "score": 0, "creation_date": 1554824638, "post_id": 55596520, "comment_id": 97889750, "body": "I see! I was just diving into how that PanicsWithValue works:  <a href=\"https://github.com/stretchr/testify/search?q=PanicsWithValue\" rel=\"nofollow noreferrer\">github.com/stretchr/testify/search?q=PanicsWithValue</a>"}, {"owner": {"reputation": 9920, "user_id": 7599833, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74ae2f4b27f5f727270818eba261aa0b?s=128&d=identicon&r=PG", "display_name": "Helder Sepulveda", "link": "https://stackoverflow.com/users/7599833/helder-sepulveda"}, "edited": false, "score": 0, "creation_date": 1554824753, "post_id": 55596520, "comment_id": 97889816, "body": "that indexOutOfRangeValue looks hackish, strange go lang does not have those values readily available"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1554825029, "last_edit_date": 1554825029, "creation_date": 1554824341, "answer_id": 55596520, "question_id": 55596268, "link": "https://stackoverflow.com/questions/55596268/golang-unit-testing-using-panicswithvalue/55596520#55596520", "title": "Golang unit testing using PanicsWithValue", "body": "<p>The index out of range error has type <code>runtime.errorString</code>.  The application compares the value to a value of type <code>string</code>. This comparison evaluates to false.</p>\n\n<p>To fix, capture the index out of range error and compare to that.</p>\n\n<pre><code>var indexOutOfRangeValue = func() (v interface{}) {\n    defer func() {\n        v = recover()\n    }()\n    x := []int{}\n    return x[1]\n}()\n\nfunc TestIndexOutOfRange(t *testing.T) {\n    assert.PanicsWithValue(t, indexOutOfRangeValue, func() { indexOutOfRange(9) })\n}\n</code></pre>\n\n<p>This code assumes that index out of range panic values compare as equal. There's no guarantee that this assumption will be true in future versions of Go, but it seems unlikely that the runtime break this assumption.</p>\n"}], "owner": {"reputation": 9920, "user_id": 7599833, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74ae2f4b27f5f727270818eba261aa0b?s=128&d=identicon&r=PG", "display_name": "Helder Sepulveda", "link": "https://stackoverflow.com/users/7599833/helder-sepulveda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 731, "favorite_count": 0, "accepted_answer_id": 55596520, "answer_count": 1, "score": -1, "last_activity_date": 1554825029, "creation_date": 1554823464, "last_edit_date": 1554824074, "question_id": 55596268, "link": "https://stackoverflow.com/questions/55596268/golang-unit-testing-using-panicswithvalue", "title": "Golang unit testing using PanicsWithValue", "body": "<p>We are trying to test a function that raises an <code>index out of range</code> error.  </p>\n\n<p>The code of the unit test is simple, something like:</p>\n\n<pre><code>import (\n    \"testing\"\n\n    \"github.com/stretchr/testify/assert\"\n)\n\nfunc TestIndexOutOfRange(t *testing.T) {\n    assert.PanicsWithValue(t, \"index out of range\", func() { indexOutOfRange(9) })\n}\n</code></pre>\n\n<p>But unfortunately the test Fails with a strange error</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>=== RUN   TestIndexOutOfRange\n--- FAIL: TestIndexOutOfRange (0.00s)\n  &lt;autogenerated&gt;:1:\n    Error Trace: badindex_test.go:55\n    Error: func (assert.PanicTestFunc)(0x1c440d0) should panic with value: \"index out of range\"\n    Panic value: \"index out of range\"\n    Test: TestIndexOutOfRange\n</code></pre>\n\n<p>You can see that the panic value and the error show the same, but test still fails.<br>\nAny ideas what is going on?</p>\n"}, {"tags": ["windows", "go", "protocol-buffers"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554817437, "post_id": 55594238, "comment_id": 97885246, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/q/36083542/13860\">stackoverflow.com/q/36083542/13860</a>"}], "answers": [{"tags": [], "owner": {"reputation": 462, "user_id": 6602159, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phhUH.jpg?s=128&g=1", "display_name": "M. Rostami", "link": "https://stackoverflow.com/users/6602159/m-rostami"}, "is_accepted": false, "score": 1, "last_activity_date": 1586032222, "creation_date": 1586032222, "answer_id": 61034374, "question_id": 55594238, "link": "https://stackoverflow.com/questions/55594238/how-to-fix-go-out-protoc-gen-go-the-system-cannot-find-the-file-specified/61034374#61034374", "title": "How to fix \u2018--go_out: protoc-gen-go: The system cannot find the file specified.\u2019 error", "body": "<h2>Description</h2>\n\n<p>Unfortunately, it is said that none of the core developers develop on Windows, hence I solve the problem and add this answer for Windows developers.  </p>\n\n<p>However, the <a href=\"https://stackoverflow.com/q/36083542/13860\">possible duplicate link</a> that @Flimzy mentioned doesn't work and I have done all the 6 steps below then surprisingly the problem has solved by step 7. Moreover, by mistake, I was running the command on a VSCode terminal.</p>\n\n<hr>\n\n<h2>Procedure</h2>\n\n<ol>\n<li><p>Download <code>protoc-win32.zip</code> from \"<a href=\"https://developers.google.com/protocol-buffers/docs/downloads\" rel=\"nofollow noreferrer\">https://developers.google.com/protocol-buffers/docs/downloads</a>\".  </p></li>\n<li><p>Unzip the file then add the location of the <code>protoc.exe</code> to your PATH environment variable. In addition, it's not that much necessary, you can copy the <code>protoc.exe</code> to the <code>GOPATH</code>.</p></li>\n<li><p>Change/Navigate the CMD/Powershell path to the file then run <code>protoc.exe --version</code> from the command prompt to verify the procedure.</p></li>\n<li><p>Verify that your <code>GOPATH</code> environment variable is set.  </p></li>\n<li><p>Run <code>go get -u github.com/golang/protobuf/protoc-gen-go</code> from the CMD/Powershell. This should install the binary to <code>%GOPATH%/bin</code>.  </p></li>\n<li><p>Add the exact <code>%GOPATH%/bin</code> to your PATH environment variable.</p></li>\n<li><p>Open a new CMD/Powershell, navigate to your <code>.proto</code> file then run <code>protoc --go_out=. *.proto</code> </p></li>\n</ol>\n\n<hr>\n\n<p><strong><em>References:</em></strong>  </p>\n\n<ol>\n<li><a href=\"https://groups.google.com/forum/#!topic/golang-nuts/Qs8d56uavVs\" rel=\"nofollow noreferrer\">How to install protoc-gen-go (Go protocol buffer compiler plugin) in windows?</a>  </li>\n<li><a href=\"https://github.com/golang/protobuf/issues/811\" rel=\"nofollow noreferrer\">protoc-gen-go: protoc fails to compile in Windows</a></li>\n</ol>\n"}], "owner": {"reputation": 59, "user_id": 10639347, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "mohammad ghari", "link": "https://stackoverflow.com/users/10639347/mohammad-ghari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 882, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1586032222, "creation_date": 1554817103, "last_edit_date": 1554817156, "question_id": 55594238, "link": "https://stackoverflow.com/questions/55594238/how-to-fix-go-out-protoc-gen-go-the-system-cannot-find-the-file-specified", "title": "How to fix \u2018--go_out: protoc-gen-go: The system cannot find the file specified.\u2019 error", "body": "<p>I Create a person.proto and I wanna compile this file to *.go .\nI installed Package </p>\n\n<blockquote>\n  <p>go get -u github.com/golang/protobuf/protoc-gen-go </p>\n</blockquote>\n\n<p>After executing the following command</p>\n\n<blockquote>\n  <p>.\\protoc.exe --go_out=. person.proto</p>\n</blockquote>\n\n<p>I get the error below</p>\n\n<blockquote>\n  <p>--go_out: protoc-gen-go: The system cannot find the file specified.</p>\n</blockquote>\n\n<p>I want to use the buffer protocol, version 2</p>\n\n<p>How can I fix this error?</p>\n\n<p>My proto file:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package communication;\n\nmessage Person {\n  required string name = 1;\n  required int32 id = 2;\n  optional string email = 3;\n\n  enum PhoneType {\n    MOBILE = 0;\n    HOME = 1;\n    WORK = 2;\n  }\n\n  message PhoneNumber {\n    required string number = 1;\n    optional PhoneType type = 2 [default = HOME];\n  }\n\n  repeated PhoneNumber phone = 4;\n}\n</code></pre>\n"}, {"tags": ["go", "benchmarking"], "comments": [{"owner": {"reputation": 384463, "user_id": 1126841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa05233b2357f8d11c22ef4cfc7bb85c?s=128&d=identicon&r=PG", "display_name": "chepner", "link": "https://stackoverflow.com/users/1126841/chepner"}, "edited": false, "score": 2, "creation_date": 1554815561, "post_id": 55593617, "comment_id": 97883948, "body": "I&#39;d suggest looking at the code the compiler generates (however one does that in <code>go</code>; I&#39;m mostly ignorant about this language). Could be related to branch prediction, or an accidental cache optimization due to the code&#39;s layout."}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1554816514, "post_id": 55593617, "comment_id": 97884615, "body": "which go version are you using?"}, {"owner": {"reputation": 457, "user_id": 1820343, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a97800506d556373ec1775d99bafdd4f?s=128&d=identicon&r=PG", "display_name": "pyriand3r", "link": "https://stackoverflow.com/users/1820343/pyriand3r"}, "edited": false, "score": 0, "creation_date": 1554817479, "post_id": 55593617, "comment_id": 97885279, "body": "Go version is: 1.12.1 linux/amd64"}, {"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 1, "creation_date": 1554852811, "post_id": 55593617, "comment_id": 97900992, "body": "Please post your benchmark"}, {"owner": {"reputation": 457, "user_id": 1820343, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a97800506d556373ec1775d99bafdd4f?s=128&d=identicon&r=PG", "display_name": "pyriand3r", "link": "https://stackoverflow.com/users/1820343/pyriand3r"}, "edited": false, "score": 0, "creation_date": 1554881253, "post_id": 55593617, "comment_id": 97908642, "body": "<a href=\"https://github.com/exercism/go/tree/master/exercises/nth-prime\" rel=\"nofollow noreferrer\">Here</a> is  the whole exercise with test-cases and test-file including the benchmark. To try on your pc just download the files, add the <code>nth_prime.go</code> file with my content above and you can test yourself..."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1587140208, "post_id": 55593617, "comment_id": 108400991, "body": "Don&#39;t do <code>i*i</code> inside the loop!  Get an upper bound with sqrt.  Or on ISAs where the same instruction gives div and mod results at the same time, something like <code>i &lt; n&#47;i</code> is possible if it compiles efficiently.  <a href=\"https://codereview.stackexchange.com/a/204965\">Checking if a number is prime in NASM Win64 Assembly</a>"}, {"owner": {"reputation": 196, "user_id": 9121201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2698ee8824af5a9a99d798e9217db503?s=128&d=identicon&r=PG", "display_name": "Amit Davidson", "link": "https://stackoverflow.com/users/9121201/amit-davidson"}, "edited": false, "score": 0, "creation_date": 1587153344, "post_id": 55593617, "comment_id": 108407593, "body": "Also, in your benchmark the difference between the results is huge! (that at first, might not explain why a small addition to the assembly cause this difference). The reason is you ran it for a small amount of iterations. I would suggest running it for longer so you could get better results next time."}], "answers": [{"comments": [{"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1587140654, "post_id": 61269344, "comment_id": 108401220, "body": "You didn&#39;t point out what the check against <code>-1</code> is for.  <code>LONG_MIN &#47; -1</code> would raise a #DE divide overflow exception with x86&#39;s idiv instruction, and apparently Go needs to avoid that (instead of taking C&#39;s approach of saying that signed integer overflow is undefined behaviour.) Knowing that <code>n</code> can&#39;t be odd lets it skip this check.  The check is <code>if(i==-1){ quotient = -n; remainder = 0; }</code>.  Probably from that clunky <code>i*i &lt; n</code> loop condition; Go can&#39;t prove that the loop condition will stop <code>i</code> from wrapping around to be negative? For large enough <code>n</code>, <code>i*i</code> might overflow before being false"}], "tags": [], "owner": {"reputation": 196, "user_id": 9121201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2698ee8824af5a9a99d798e9217db503?s=128&d=identicon&r=PG", "display_name": "Amit Davidson", "link": "https://stackoverflow.com/users/9121201/amit-davidson"}, "is_accepted": false, "score": 3, "last_activity_date": 1587119125, "creation_date": 1587119125, "answer_id": 61269344, "question_id": 55593617, "link": "https://stackoverflow.com/questions/55593617/never-triggered-if-statements-make-code-execution-in-benchmark-faster-why/61269344#61269344", "title": "Never triggered if statements make code execution in benchmark faster? Why?", "body": "<p>What happens is the compiler is guaranteed with some assertions about the input when those if's are added.\nIf those assertions are lifted, the compiler has to add it himself. The way it does it is by validating it on each iteration. We can take a look at the assembly code to prove it. (by passing <code>-gcflags=-S</code> to the <code>go test</code> command)</p>\n\n<p>With the if's:</p>\n\n<pre><code>0x004b 00075 (func.go:16)  JMP     81\n0x004d 00077 (func.go:16)  LEAQ    2(BX), AX\n0x0051 00081 (func.go:16)  MOVQ    AX, DX\n0x0054 00084 (func.go:16)  IMULQ   AX, AX\n0x0058 00088 (func.go:16)  CMPQ    AX, CX\n0x005b 00091 (func.go:16)  JGT     133\n0x005d 00093 (func.go:17)  TESTQ   DX, DX\n0x0060 00096 (func.go:17)  JEQ     257\n0x0066 00102 (func.go:17)  MOVQ    CX, AX\n0x0069 00105 (func.go:17)  MOVQ    DX, BX\n0x006c 00108 (func.go:17)  CQO\n0x006e 00110 (func.go:17)  IDIVQ   BX\n0x0071 00113 (func.go:17)  TESTQ   DX, DX\n0x0074 00116 (func.go:17)  JNE     77\n</code></pre>\n\n<p>Without the if's:</p>\n\n<pre><code>0x0016 00022 (func.go:16)  JMP     28\n0x0018 00024 (func.go:16)  LEAQ    2(BX), AX\n0x001c 00028 (func.go:16)  MOVQ    AX, DX\n0x001f 00031 (func.go:16)  IMULQ   AX, AX\n0x0023 00035 (func.go:16)  CMPQ    AX, CX\n0x0026 00038 (func.go:16)  JGT     88\n0x0028 00040 (func.go:17)  TESTQ   DX, DX\n0x002b 00043 (func.go:17)  JEQ     102\n0x002d 00045 (func.go:17)  MOVQ    CX, AX\n0x0030 00048 (func.go:17)  MOVQ    DX, BX\n0x0033 00051 (func.go:17)  CMPQ    BX, $-1\n0x0037 00055 (func.go:17)  JEQ     64\n0x0039 00057 (func.go:17)  CQO\n0x003b 00059 (func.go:17)  IDIVQ   BX\n0x003e 00062 (func.go:17)  JMP     69\n0x0040 00064 func.go:17)  NEGQ    AX\n0x0043 00067 (func.go:17)  XORL    DX, DX\n0x0045 00069 (func.go:17)  TESTQ   DX, DX\n0x0048 00072 (func.go:17)  JNE     24\n</code></pre>\n\n<p>Line 51 in the assembly code <code>0x0033 00051 (func.go:17)  CMPQ    BX, $-1</code> is the culprit. </p>\n\n<p>Line 16, <code>for i := 3; i*i &lt;= n; i+=2</code>, in the original Go code, is translated the same for both cases. But line 17 <code>if n%i == 0</code> that <strong>runs every iteration</strong> compiles to more instructions and as a result more work for the CPU in total. </p>\n\n<p>Something similar in the <code>encoding/base64</code> package by ensuring the loop won't receive a <code>nil</code> value. You can take a look here:\n<a href=\"https://go-review.googlesource.com/c/go/+/151158/3/src/encoding/base64/base64.go\" rel=\"nofollow noreferrer\">https://go-review.googlesource.com/c/go/+/151158/3/src/encoding/base64/base64.go</a>\nThis check was added intentionally. In your case, you optimized it accidentally :)</p>\n"}], "owner": {"reputation": 457, "user_id": 1820343, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a97800506d556373ec1775d99bafdd4f?s=128&d=identicon&r=PG", "display_name": "pyriand3r", "link": "https://stackoverflow.com/users/1820343/pyriand3r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 5, "answer_count": 1, "score": 4, "last_activity_date": 1587119125, "creation_date": 1554815062, "last_edit_date": 1554820697, "question_id": 55593617, "link": "https://stackoverflow.com/questions/55593617/never-triggered-if-statements-make-code-execution-in-benchmark-faster-why", "title": "Never triggered if statements make code execution in benchmark faster? Why?", "body": "<p>I have recently started the Go track on <a href=\"https://www.exercism.io\" rel=\"nofollow noreferrer\">exercism.io</a> and had fun optimizing the \"nth-prime\" calculation. Actually I came across a funny fact I can't explain. Imagine the following code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Package prime provides ...\npackage prime\n\n// Nth function checks for the prime number on position n\nfunc Nth(n int) (int, bool) {\n        if n &lt;= 0 {\n            return 0, false\n        }\n\n        if (n == 1) {\n            return 2, true\n        }\n\n        currentNumber := 1\n        primeCounter := 1\n\n        for n &gt; primeCounter {\n            currentNumber+=2\n            if isPrime(currentNumber) {\n                primeCounter++\n            }\n        }\n        return currentNumber, primeCounter==n\n}\n\n// isPrime function checks if a number \n// is a prime number\nfunc isPrime(n int) bool {\n    //useless because never triggered but makes it faster??\n    if n &lt; 2 {\n        println(\"n &lt; 2\")\n        return false\n    }\n\n    //useless because never triggered but makes it faster??\n    if n%2 == 0 {\n        println(\"n%2\")\n        return n==2\n    }\n\n    for i := 3; i*i &lt;= n; i+=2 {\n        if n%i == 0 {\n            return false\n        }\n    }\n    return true\n}\n</code></pre>\n\n<p>In the private function <code>isPrime</code> I have two initial if-statements that are never triggered, because I only give in uneven numbers greater than 2. The benchmark returns following:</p>\n\n<pre><code>Running tool: /usr/bin/go test -benchmem -run=^$ -bench ^(BenchmarkNth)$\n\nBenchmarkNth-8           100      18114825 ns/op           0 B/op          0 \n</code></pre>\n\n<p>If I remove the never triggered if-statements the benchmark goes slower: </p>\n\n<pre><code>Running tool: /usr/bin/go test -benchmem -run=^$ -bench ^(BenchmarkNth)$\n\nBenchmarkNth-8            50      21880749 ns/op           0 B/op          0\n</code></pre>\n\n<p>I have run the benchmark multiple times changing the code back and forth always getting more or less the same numbers and I can't think of a reason why these two if-statements should make the execution faster. Yes it is micro-optimization, but I want to know: Why?</p>\n\n<p>Here is the whole exercise from exercism with test-cases: <a href=\"https://github.com/exercism/go/tree/master/exercises/nth-prime\" rel=\"nofollow noreferrer\">nth-prime</a></p>\n\n<p>Go version i am using is 1.12.1 linux/amd64 on a manjaro i3 linux</p>\n"}, {"tags": ["go", "testing", "caching"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1554815040, "post_id": 55590941, "comment_id": 97883636, "body": "I think you&#39;re confused because the source code you linked to isn&#39;t the test command, it&#39;s tests for the <code>go</code> command."}, {"owner": {"reputation": 841, "user_id": 4506781, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/73fa1afa3fc0fefc5c36f2df4ce8200a?s=128&d=identicon&r=PG", "display_name": "syscll", "link": "https://stackoverflow.com/users/4506781/syscll"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554823802, "post_id": 55590941, "comment_id": 97889271, "body": "@JimB Sorry, I completely linked to the wrong file - updated the link."}, {"owner": {"reputation": 841, "user_id": 4506781, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/73fa1afa3fc0fefc5c36f2df4ce8200a?s=128&d=identicon&r=PG", "display_name": "syscll", "link": "https://stackoverflow.com/users/4506781/syscll"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1554824014, "post_id": 55590941, "comment_id": 97889398, "body": "@icza Thanks - that does answer my question."}], "owner": {"reputation": 841, "user_id": 4506781, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/73fa1afa3fc0fefc5c36f2df4ce8200a?s=128&d=identicon&r=PG", "display_name": "syscll", "link": "https://stackoverflow.com/users/4506781/syscll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "closed_date": 1554824044, "answer_count": 0, "score": 2, "last_activity_date": 1554823025, "creation_date": 1554806533, "last_edit_date": 1554823025, "question_id": 55590941, "link": "https://stackoverflow.com/questions/55590941/where-is-the-default-cache-location-of-go-test-files", "closed_reason": "Duplicate", "title": "Where is the default cache location of Go test files?", "body": "<p>From the Go testing <a href=\"https://golang.org/cmd/go/#hdr-Testing_flags\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>When 'go test' runs in package list mode, 'go test' caches successful package test results to avoid unnecessary repeated running of tests.</p>\n</blockquote>\n\n<p>This all works fine for me. However, I cannot find an official list of cache directories per platform in the documentation. I can take a guess that it might be stored in <code>$HOME/.cache/go-build</code> on Linux?</p>\n\n<p>So far I have read the <a href=\"https://github.com/golang/go/blob/master/src/cmd/go/internal/test/test.go\" rel=\"nofollow noreferrer\">source code</a>, searched the documentation (as linked above), and read the output of <code>go help test</code> and <code>go help cache</code> but still can't see a definitive answer.</p>\n"}, {"tags": ["go", "iterator", "closures"], "answers": [{"comments": [{"owner": {"reputation": 2945, "user_id": 5345715, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f05631812e06e1599ce28b59ed000c?s=128&d=identicon&r=PG&f=1", "display_name": "User12547645", "link": "https://stackoverflow.com/users/5345715/user12547645"}, "edited": false, "score": 0, "creation_date": 1554811602, "post_id": 55590835, "comment_id": 97881456, "body": "Thank you very much. I did not know that. Could you please point out why a named return value is the same as a named argument? Do you have a link where I could read about that?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2945, "user_id": 5345715, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f05631812e06e1599ce28b59ed000c?s=128&d=identicon&r=PG&f=1", "display_name": "User12547645", "link": "https://stackoverflow.com/users/5345715/user12547645"}, "edited": false, "score": 0, "creation_date": 1554812384, "post_id": 55590835, "comment_id": 97881915, "body": "@User12547645 <a href=\"https://golang.org/doc/effective_go.html#named-results\" rel=\"nofollow noreferrer\">Effective Go: Named result parameters</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 2945, "user_id": 5345715, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f05631812e06e1599ce28b59ed000c?s=128&d=identicon&r=PG&f=1", "display_name": "User12547645", "link": "https://stackoverflow.com/users/5345715/user12547645"}, "edited": false, "score": 2, "creation_date": 1554812766, "post_id": 55590835, "comment_id": 97882126, "body": "@User12547645: &quot;The result parameters act as ordinary local variables and the function may assign values to them as necessary.&quot; As always, read the The Go Programming Language Specification: <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">golang.org/ref/spec</a>."}, {"owner": {"reputation": 2945, "user_id": 5345715, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f05631812e06e1599ce28b59ed000c?s=128&d=identicon&r=PG&f=1", "display_name": "User12547645", "link": "https://stackoverflow.com/users/5345715/user12547645"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1554812847, "post_id": 55590835, "comment_id": 97882178, "body": "Thank you @icza. So if I use a named return parameter, this parameter is initialized as a zero value (0 for ints). This is why it is like a new parameter. Thank you."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 5, "last_activity_date": 1554806198, "creation_date": 1554806198, "answer_id": 55590835, "question_id": 55590783, "link": "https://stackoverflow.com/questions/55590783/variable-not-used-when-using-a-named-return-type/55590835#55590835", "title": "Variable not used, when using a named return type", "body": "<p>In the second case, the return value <code>(i int)</code> shadows the outer declaration <code>i := 1</code>.  So it's this first <code>i</code> that is unused. This means the second example isn't a closure at all.</p>\n\n<p>From a scoping standpoint, your second example is the same as:</p>\n\n<pre><code>func f() func() int {\n    i := 1\n    return func(i int) int {\n        i++\n        return\n    }\n}\n</code></pre>\n\n<p>In this case, it should be clear that the inner <code>i</code> is distinct, and shadows the outer one.</p>\n"}], "owner": {"reputation": 2945, "user_id": 5345715, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f05631812e06e1599ce28b59ed000c?s=128&d=identicon&r=PG&f=1", "display_name": "User12547645", "link": "https://stackoverflow.com/users/5345715/user12547645"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 55590835, "answer_count": 1, "score": -4, "last_activity_date": 1554806198, "creation_date": 1554806066, "last_edit_date": 1554806142, "question_id": 55590783, "link": "https://stackoverflow.com/questions/55590783/variable-not-used-when-using-a-named-return-type", "title": "Variable not used, when using a named return type", "body": "<p>Why can I do the following to define an iterator in Go:</p>\n\n<pre><code>func f() func() int {\n    i := 1\n    return func() int {\n        i++\n        return i\n    }\n}\n</code></pre>\n\n<p>but this will result in a variable not used error (<code>i</code> is not used)?</p>\n\n<pre><code>func f() func() int {\n    i := 1\n    return func() (i int) {\n        i++\n        return\n    }\n}\n</code></pre>\n\n<p>main function: </p>\n\n<pre><code>func main() {\n    iter := f()\n    fmt.Println(iter())\n    fmt.Println(iter())\n    fmt.Println(iter())\n    fmt.Println(iter())\n}\n</code></pre>\n\n<p>To me both versions do exactly the same: They use <code>f</code> as an iterator. <code>f</code> makes use of closures (more specifically <code>i</code>). The first version explicitly returns an incremented <code>i</code> and the second implicitly, by referring to it via a named return type. </p>\n\n<p>To me both versions are the same, so why do I get an error? </p>\n"}, {"tags": ["date", "go", "time"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1554812918, "last_edit_date": 1554812918, "creation_date": 1554805348, "answer_id": 55590545, "question_id": 55590476, "link": "https://stackoverflow.com/questions/55590476/parse-capital-letter-month-in-golang/55590545#55590545", "title": "parse capital letter month in golang", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">Package time</a></p>\n\n<pre><code>import \"time\" \n</code></pre>\n  \n  <p>The recognized month formats are \"Jan\" and \"January\".</p>\n</blockquote>\n\n<hr>\n\n<p>The parse layout abbreviated month format is \"Jan\". Use \"02-Jan-2006\" for the parse layout.</p>\n\n<p>For example, </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    date, err := time.Parse(\"02-Jan-2006\", \"25-APR-2019\")\n    fmt.Println(date, err)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/5MRpUrUVJt4\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5MRpUrUVJt4</a></p>\n\n<p>Output:</p>\n\n<pre><code>2019-04-25 00:00:00 +0000 UTC &lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 376, "favorite_count": 1, "accepted_answer_id": 55590545, "answer_count": 1, "score": 1, "last_activity_date": 1554812918, "creation_date": 1554805155, "question_id": 55590476, "link": "https://stackoverflow.com/questions/55590476/parse-capital-letter-month-in-golang", "title": "parse capital letter month in golang", "body": "<p>I want to parse string like <code>\"25-APR-2019\"</code> to <code>time.time</code></p>\n\n<p>I know parsing date using</p>\n\n<pre><code>date, err := time.Parse(layout, stringVariableForDate)\n</code></pre>\n\n<p>But I didn't find layout option in <a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#pkg-constants</a></p>\n\n<p>I can not use JAN, as using this, I am getting error :</p>\n\n<pre><code>panic: parsing time \"25-APR-2019\" as \"02-JAN-2006\": cannot parse \"APR-2019\" as \"-JAN-\"\n</code></pre>\n\n<p>How can I parse date string with month name in capital letter in go-lang?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 579, "user_id": 11206879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bS2D6.png?s=128&g=1", "display_name": "Pan Ke", "link": "https://stackoverflow.com/users/11206879/pan-ke"}, "edited": false, "score": 0, "creation_date": 1554795313, "post_id": 55587207, "comment_id": 97871888, "body": "try <code>_, err = stmt.Exec()</code> pls"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1554795953, "post_id": 55587207, "comment_id": 97872253, "body": "What part of the error message is confusing you?"}], "answers": [{"comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1554795290, "post_id": 55587260, "comment_id": 97871880, "body": "Change the <code>:=</code> to <code>=</code> in the same line."}], "tags": [], "owner": {"reputation": 579, "user_id": 11206879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bS2D6.png?s=128&g=1", "display_name": "Pan Ke", "link": "https://stackoverflow.com/users/11206879/pan-ke"}, "is_accepted": true, "score": 2, "last_activity_date": 1554795334, "last_edit_date": 1554795334, "creation_date": 1554794836, "answer_id": 55587260, "question_id": 55587207, "link": "https://stackoverflow.com/questions/55587207/models-go-res-declared-and-not-used/55587260#55587260", "title": "models.go: res declared and not used", "body": "<p>the error message is clear, res, defined in model, see below, declared and not used</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>res, err := stmt.Exec()\nif err != nil {\n  log.Println(err)\n  return nil, err\n}\nreturn db, nil\n</code></pre>\n\n<p>if you don't care about <code>res</code>, can use <code>_</code> to ignore it</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>_, err = stmt.Exec()\nif err != nil {\n  log.Println(err)\n  return nil, err\n}\nreturn db, nil\n</code></pre>\n"}], "owner": {"reputation": 5432, "user_id": 4723732, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/77fa71fdc548472c228be40043c1bc1f?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Rublev", "link": "https://stackoverflow.com/users/4723732/richard-rublev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 55587260, "answer_count": 1, "score": -5, "last_activity_date": 1554795913, "creation_date": 1554794636, "last_edit_date": 1554795913, "question_id": 55587207, "link": "https://stackoverflow.com/questions/55587207/models-go-res-declared-and-not-used", "title": "models.go: res declared and not used", "body": "<p>I can not reproduce this example although I have changed db name and password.Tree structure</p>\n\n<pre><code>.\n\u251c\u2500\u2500 main.go\n\u251c\u2500\u2500 main_test.go\n\u251c\u2500\u2500 models\n\u2502   \u2514\u2500\u2500 models.go\n\u2514\u2500\u2500 utils\n    \u2514\u2500\u2500 encodeutils.go\n</code></pre>\n\n<p>Models</p>\n\n<pre><code>func InitDB() (*sql.DB, error) {\n    var err error\n    db, err := sql.Open(\"postgres\", \"postgres://miki:pass58@localhost/mydb?sslmode=disable\")\n    if err != nil {\n        return nil, err\n    } else {\n        // Create model for our URL service\n        stmt, err := db.Prepare(\"CREATE TABLE WEB_URL(ID SERIAL PRIMARY KEY, URL TEXT NOT NULL);\")\n        if err != nil {\n            log.Println(err)\n            return nil, err\n        }\n        res, err := stmt.Exec()\n        if err != nil {\n            log.Println(err)\n            return nil, err\n        }\n        return db, nil\n    }\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>import (\n    \"database/sql\"\n    \"encoding/json\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n\n    \"github.com/PacktPublishing/Building-RESTful-Web-Services-with-Go/Chapter07/urlshortener/models\"\n    base62 \"github.com/PacktPublishing/Building-RESTful-Web-Services-with-Go/Chapter07/urlshortener/utils\"\n    \"github.com/gorilla/mux\"\n    _ \"github.com/lib/pq\"\n)\n\n// DB stores the database session imformation. Needs to be initialized once\ntype DBClient struct {\n    db *sql.DB\n}\n\n// Model the record struct\ntype Record struct {\n    ID  int    `json:\"id\"`\n    URL string `json:\"url\"`\n}\n\n// GetOriginalURL fetches the original URL for the given encoded(short) string\nfunc (driver *DBClient) GetOriginalURL(w http.ResponseWriter, r *http.Request) {\n    var url string\n    vars := mux.Vars(r)\n    // Get ID from base62 string\n    id := base62.ToBase10(vars[\"encoded_string\"])\n    err := driver.db.QueryRow(\"SELECT url FROM web_url WHERE id = $1\", id).Scan(&amp;url)\n    // Handle response details\n    if err != nil {\n        w.Write([]byte(err.Error()))\n    } else {\n        w.WriteHeader(http.StatusOK)\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        responseMap := map[string]interface{}{\"url\": url}\n        response, _ := json.Marshal(responseMap)\n        w.Write(response)\n    }\n}\n\n// GenerateShortURL adds URL to DB and gives back shortened string\nfunc (driver *DBClient) GenerateShortURL(w http.ResponseWriter, r *http.Request) {\n    var id int\n    var record Record\n    postBody, _ := ioutil.ReadAll(r.Body)\n    json.Unmarshal(postBody, &amp;record)\n    err := driver.db.QueryRow(\"INSERT INTO web_url(url) VALUES($1) RETURNING id\", record.URL).Scan(&amp;id)\n    responseMap := map[string]interface{}{\"encoded_string\": base62.ToBase62(id)}\n    if err != nil {\n        w.Write([]byte(err.Error()))\n    } else {\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        response, _ := json.Marshal(responseMap)\n        w.Write(response)\n    }\n}\n\nfunc main() {\n    db, err := models.InitDB()\n    if err != nil {\n        panic(err)\n    }\n    dbclient := &amp;DBClient{db: db}\n    if err != nil {\n        panic(err)\n    }\n    defer db.Close()\n    // Create a new router\n    r := mux.NewRouter()\n    // Attach an elegant path with handler\n    r.HandleFunc(\"/v1/short/{encoded_string:[a-zA-Z0-9]*}\", dbclient.GetOriginalURL).Methods(\"GET\")\n    r.HandleFunc(\"/v1/short\", dbclient.GenerateShortURL).Methods(\"POST\")\n    srv := &amp;http.Server{\n        Handler: r,\n        Addr:    \"127.0.0.1:8000\",\n        // Good practice: enforce timeouts for servers you create!\n        WriteTimeout: 15 * time.Second,\n        ReadTimeout:  15 * time.Second,\n    }\n    log.Fatal(srv.ListenAndServe())\n}\n</code></pre>\n\n<p>When I run</p>\n\n<pre><code>go run /home/miki/go/src/github.com/PacktPublishing/Building-RESTful-Web-Services-with-Go/Chapter07/urlshortener/main.go\n</code></pre>\n\n<p>I got</p>\n\n<pre><code>go/src/github.com/PacktPublishing/Building-RESTful-Web-Services-with-Go/Chapter07/urlshortener/models/models.go:22:3: res declared and not used\n</code></pre>\n\n<p>Why? Models are initialized in main.</p>\n\n<p>Just to show postqresql\nmydb=# \\c mydb \\dt</p>\n\n<pre><code>You are now connected to database \"mydb\" as user \"postgres\".\n        List of relations\n Schema |  Name   | Type  | Owner \n--------+---------+-------+-------\n public | web_url | table | miki\n</code></pre>\n\n<p>If I try </p>\n\n<pre><code>_, err = stmt.Exec()\nif err != nil {\n    log.Println(err)\n    return nil, err\n}\nreturn db, nil\n</code></pre>\n\n<p>Then</p>\n\n<pre><code>2019/04/09 09:35:58 pq: relation \"web_url\" already exists\npanic: pq: relation \"web_url\" already exists\n</code></pre>\n"}, {"tags": ["go", "active-directory", "ldap"], "comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1554794043, "post_id": 55586906, "comment_id": 97871228, "body": "Only if the user&#39;s IP address is in the LDAP server."}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 1, "creation_date": 1554794546, "post_id": 55586906, "comment_id": 97871475, "body": "Ok, so how looks like LDAP query in my case?"}], "answers": [{"tags": [], "owner": {"reputation": 28745, "user_id": 1202807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e09276b9edb245e928e7163b27b15691?s=128&d=identicon&r=PG", "display_name": "Gabriel Luci", "link": "https://stackoverflow.com/users/1202807/gabriel-luci"}, "is_accepted": false, "score": 1, "last_activity_date": 1554812318, "creation_date": 1554812318, "answer_id": 55592702, "question_id": 55586906, "link": "https://stackoverflow.com/questions/55586906/user-information-by-ip-address-from-active-directory-by-ldap-query/55592702#55592702", "title": "User information by IP address from Active Directory by LDAP query?", "body": "<p>Active Directory does not store the IP or computer name that each person uses. Trying to match a user with a computer is difficult because a person can usually log in from any computer.</p>\n\n<p>If you really want that information, there are a couple ways:</p>\n\n<ol>\n<li>If you have admin rights to each computer in your environment, you could access <code>\\\\IPAddress\\c$\\Users</code> and check which profile was most-recently used.</li>\n<li>Make people authenticate to your website using Windows Authentication. As long as your website is in the Trusted Sites (in Internet Options) people will be automatically logged in. I have no experience doing this with Go, but here is an implementation I found on Google: <a href=\"https://gowalker.org/github.com/mfcollins3/windowsauthtoken\" rel=\"nofollow noreferrer\">https://gowalker.org/github.com/mfcollins3/windowsauthtoken</a> The idea is that your website will run behind IIS. IIS performs the authentication and just forwards the user information to your application.</li>\n</ol>\n"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 882, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1554812318, "creation_date": 1554793518, "question_id": 55586906, "link": "https://stackoverflow.com/questions/55586906/user-information-by-ip-address-from-active-directory-by-ldap-query", "title": "User information by IP address from Active Directory by LDAP query?", "body": "<p>In <code>Go</code> application client make HTTP request. I know the IP address of the client who make the request.</p>\n\n<p>Is it possibly to know user information (username, email, e.t.c) by IP address from Active Directory by LDAP query? What kind of filter I need to use?</p>\n\n<pre><code>l, err := ldap.Dial(\"tcp\", fmt.Sprintf(\"%s:%d\", \"ldap.example.com\", 389))\nif err != nil {\n    log.Fatal(err)\n}\ndefer l.Close()\n\nsearchRequest := ldap.NewSearchRequest(\n    \"dc=example,dc=com\", // The base dn to search\n    ldap.ScopeWholeSubtree, ldap.NeverDerefAliases, 0, 0, false,\n    \"(&amp;(objectClass=organizationalPerson))\", // The filter to apply\n    []string{\"dn\", \"cn\"},                    // A list attributes to retrieve\n    nil,\n)\n\nsr, err := l.Search(searchRequest)\nif err != nil {\n    log.Fatal(err)\n}\n\nfor _, entry := range sr.Entries {\n    fmt.Printf(\"%s: %v\\n\", entry.DN, entry.GetAttributeValue(\"cn\"))\n}\n</code></pre>\n"}, {"tags": ["api", "go", "controller", "beego"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1554797388, "post_id": 55586490, "comment_id": 97872979, "body": "Change the order of the two last lines. And please do not ignore errors."}, {"owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1554797488, "post_id": 55586490, "comment_id": 97873026, "body": "@mkopriva which line?"}, {"owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1554797577, "post_id": 55586490, "comment_id": 97873071, "body": "@mkopriva please check out my updated code"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1554797753, "post_id": 55586490, "comment_id": 97873145, "body": "You should change the order of the two last lines, that is, call <code>json.Unmarshal</code> before you attempt to read the <code>raw</code> variable. Do not expect a map value to contain anything if you haven&#39;t put anything into it yet."}, {"owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1554797831, "post_id": 55586490, "comment_id": 97873185, "body": "@mkopriva I&#39;m so sorry, I just didn&#39;t copy correct. I just updated it."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1554798624, "post_id": 55586490, "comment_id": 97873631, "body": "Go does not support type casting/coercion, there&#39;s no builtin language feature that allows you to turn a <code>string</code> into <code>time.Time</code>. The expression <code>v.(T)</code> is a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>. So you should type assert the timestamp values as <code>string</code> not as <code>time.Time</code> and then parse those strings using the <code>time</code> package."}, {"owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1554798721, "post_id": 55586490, "comment_id": 97873672, "body": "Now I see. Thank you, sir. Can you give me a hint as Answer?, Let me accept your answer as a comment."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1554799230, "post_id": 55586490, "comment_id": 97873979, "body": "Something like this: <a href=\"https://play.golang.com/p/hu2OmmdIpyV\" rel=\"nofollow noreferrer\">play.golang.com/p/hu2OmmdIpyV</a>"}], "owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554798774, "creation_date": 1554791728, "last_edit_date": 1554798774, "question_id": 55586490, "link": "https://stackoverflow.com/questions/55586490/how-to-take-time-time-as-api-body-raw", "title": "How to take time.Time as API body raw", "body": "<blockquote>\n  <p>Problem is 2019/04/09 12:14:08.780 [C] [panic.go:522]  Handler crashed with error interface conversion: interface {} is string, not time.Time</p>\n</blockquote>\n\n<pre><code>// SingleTenantUsage\n// @Param   startTime   time    true \"startTime\"\n// @Param   endTime     time    true \"endTime\"\n// @router /singleTenantUsage [post]\nfunc (h *HypervisorController) SingleTenantUsage() {\n   var bodyBytes []byte\n   raw := make(map[string]interface{})\n   if h.Ctx.Request.Body != nil {\n     bodyBytes, _ = ioutil.ReadAll(h.Ctx.Request.Body)\n   }\n\n   json.Unmarshal(bodyBytes, &amp;raw)\n\n   usageSingle, err := compute.UsageSingleTenant(raw[\"tenantID\"].(time.Time),raw[\"startTime\"].(time.Time), raw[\"endTime\"].(time.Time))   &lt;---- error here\n\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/OjLJM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/OjLJM.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go", "pem", "jwk"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1554791072, "post_id": 55586188, "comment_id": 97869813, "body": "From the docs it looks like <a href=\"https://godoc.org/github.com/lestrrat-go/jwx/jwk#Key\" rel=\"nofollow noreferrer\">the Materialize method</a> returns the corresponding type from the standard library. You should be able to find examples for how to marshal <i>those</i> into PEM using the <a href=\"https://golang.org/pkg/crypto/x509/\" rel=\"nofollow noreferrer\">x509</a> and <a href=\"https://golang.org/pkg/encoding/pem/\" rel=\"nofollow noreferrer\">pem</a> packages."}, {"owner": {"reputation": 191, "user_id": 1615742, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c3afa77edd9dd0cf69b9bf91ad9b7687?s=128&d=identicon&r=PG", "display_name": "Russo", "link": "https://stackoverflow.com/users/1615742/russo"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1554852269, "post_id": 55586188, "comment_id": 97900878, "body": "Thanks @Peter ! Thanks to your comment I found a question I didn&#39;t see before here : <a href=\"https://stackoverflow.com/questions/41077953/go-language-and-verify-jwt\" title=\"go language and verify jwt\">stackoverflow.com/questions/41077953/go-language-and-verify-&zwnj;&#8203;jwt</a> I had to refactor my code because I was trying to achieve this with another lib."}], "answers": [{"tags": [], "owner": {"reputation": 906, "user_id": 497300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68c8cc3daf6dde73ad11a7e27cf3bc20?s=128&d=identicon&r=PG", "display_name": "trung", "link": "https://stackoverflow.com/users/497300/trung"}, "is_accepted": false, "score": 1, "last_activity_date": 1560524408, "creation_date": 1560524408, "answer_id": 56600743, "question_id": 55586188, "link": "https://stackoverflow.com/questions/55586188/how-to-generate-pem-from-jwk-in-go/56600743#56600743", "title": "How to generate pem from jwk in go", "body": "<p>Authorization server usually provides an endpoint to obtain JSON Web Keyset (JWKS). So I think <code>validationCrt</code> would indeed be a JSON Web Keyset. Nevertheless, you can <code>json.Unmarshal()</code> to JWK/JWKS (<a href=\"https://github.com/square/go-jose\" rel=\"nofollow noreferrer\">square/go-jose</a>) and obtain the reference of the public key via <code>.Key</code>. </p>\n\n<p>Getting to PEM format is as simple as </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>...\npubData, err := x509.MarshalPKIXPublicKey(pubKey)\nif err != nil {\n    return err\n}\nif err := pem.Encode(os.Stdout, &amp;pem.Block{\n    Type:  \"PUBLIC KEY\",\n    Bytes: pubData,\n}); err != nil {\n    return err\n}\n...\n</code></pre>\n"}], "owner": {"reputation": 191, "user_id": 1615742, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c3afa77edd9dd0cf69b9bf91ad9b7687?s=128&d=identicon&r=PG", "display_name": "Russo", "link": "https://stackoverflow.com/users/1615742/russo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1895, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560524408, "creation_date": 1554790474, "question_id": 55586188, "link": "https://stackoverflow.com/questions/55586188/how-to-generate-pem-from-jwk-in-go", "title": "How to generate pem from jwk in go", "body": "<p>I'm trying to generate a pem string using this library :</p>\n\n<p>\"github.com/lestrrat-go/jwx/jwk\"</p>\n\n<p>But so far I coudn't, I'm guessing it's because I'm new to go and there's something I'm not understanding.\nI have read the doc found here : <a href=\"https://godoc.org/github.com/lestrrat-go/jwx/jwk#pkg-examples\" rel=\"nofollow noreferrer\">doc</a></p>\n\n<p>My code fetchs a JWK from a server, once I have it, I try to generate a pem string here :</p>\n\n<pre><code>// validationCrt contains my []byte from the server\nset, err := jwk.Parse(validationCrt)\nif err != nil {\n    println(err)\n}\n\n// I suspect this piece of code is actually a mess\n// but I just can't understand what I'm doing wrong\nkey, err := jwk.GetPublicKey(set)\nif err != nil {\n    log.Printf(\"failed to create public key: %s\", err)\n}\n</code></pre>\n\n<p>I am really lost I tried multiple ways (with and without this lib) and it seems I can't find any example out there (they usually explain how to generate a key, or go from pem to jwt, but my go app it's a client.)</p>\n\n<p>Any help would be appreciated</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1554789074, "post_id": 55585889, "comment_id": 97869092, "body": "Resource requests like this are off-topic on StackOverflow."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1554789181, "post_id": 55585889, "comment_id": 97869133, "body": "Having said that, I&#39;m not sure if this is even theoretically possible. Many (perhaps most) Unicode &quot;characters&quot; are composite, and would require complex, multi-stroke keyboard input to generate from the keyboard. And the exact method of input depends on many things (not just the OS). In Linux, for example, it also depends on whether you&#39;re at the console, or in X, and if you&#39;re in X, it depends on which Window manager/DE you&#39;re using, and how it&#39;s configured."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554790776, "post_id": 55585889, "comment_id": 97869702, "body": "@Flimzy, I think asking for the Linux and Mac equivalents for the SendInput API doesn&#39;t qualify as a resource request."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1554795813, "post_id": 55585889, "comment_id": 97872175, "body": "@Peter: It seems like the epitome of a resource request for me. What else would be the answer, if not some resource?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554796550, "post_id": 55585889, "comment_id": 97872580, "body": "@Flimzy, one or more code snippets showing how to use analogous Linux/Mac APIs in Go, ideally pointing out differences and caveats. And yes, as usual an answer should also include links to the documentation for those APIs, but it does not need to be exclusively that."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554816580, "post_id": 55585889, "comment_id": 97884657, "body": "This is an impossibly complex question; entering non-ASCII characters on a us-en keyboard layout requires multiple keystrokes and/or chords on every OS. In other keyboard layouts, some non-ASCII characters may be more readily accessible, but it will vary by keyboard layout <i>and</i> by operating system. The scope of this problem is huge - effectively the space of the desired character map, multiplied by the number of keyboard layouts to support, multiplied by the number of OSes to support."}], "owner": {"reputation": 51, "user_id": 5481288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bef1970ab90b4e067f45945ff3d77940?s=128&d=identicon&r=PG&f=1", "display_name": "qwelp", "link": "https://stackoverflow.com/users/5481288/qwelp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 573, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1559948568, "creation_date": 1554788893, "question_id": 55585889, "link": "https://stackoverflow.com/questions/55585889/how-to-send-keystrokes-from-unicode-string-in-golang", "title": "How to send keystrokes from unicode string in golang", "body": "<p>I need to output unicode string as keyboard input on Windows, Linux and MacOs platforms. String could have none-ASCII printable chars from different languages (latin, cyrillic etc.). Platform specific system API calls should be used in each platform. \nFor Windows I've found SendInput function. Unicode char could be passed to this function to create keyboard event.\nAre there any analogs for Linux and MacOS?</p>\n\n<p>I've found  <a href=\"https://github.com/micmonay/keybd_event\" rel=\"nofollow noreferrer\">keybd_event</a> package for golang for simulating keystrokes. It works well with ASCII chars by using virtual codes. But It haven't support none-ASCII chars.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 5432, "user_id": 4723732, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/77fa71fdc548472c228be40043c1bc1f?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Rublev", "link": "https://stackoverflow.com/users/4723732/richard-rublev"}, "edited": false, "score": 0, "creation_date": 1554783083, "post_id": 55584447, "comment_id": 97867411, "body": "Why do you have context.Backgound?"}, {"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1554789255, "post_id": 55584447, "comment_id": 97869155, "body": "Function has a context as a first parameter. Using <code>context.Background()</code> (a non-nil, empty Context) is a common practice when you don&#39;t need a context, but have to pass it."}, {"owner": {"reputation": 393, "user_id": 6794339, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/1832841430283368/picture?type=large", "display_name": "Hernan Huma&#241;a", "link": "https://stackoverflow.com/users/6794339/hernan-huma%c3%b1a"}, "edited": false, "score": 0, "creation_date": 1554849560, "post_id": 55584447, "comment_id": 97900333, "body": "how can convert my v interface{} in bson? my struct is how this example `\tCommentId int64 json:&quot;commentId&quot; but when i wanna insert the v the problem persist \ud83d\ude13"}], "tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 2, "last_activity_date": 1554778496, "creation_date": 1554778496, "answer_id": 55584447, "question_id": 55583184, "link": "https://stackoverflow.com/questions/55583184/how-to-insert-multi-array-in-mongodb-with-golang/55584447#55584447", "title": "How to insert multi array in mongodb with golang", "body": "<p>First, I would suggest to use <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo\" rel=\"nofollow noreferrer\">go.mongodb.org/mongo-driver</a> library to interact with MongoDB. This is the MongoDB official driver for the Go language. </p>\n\n<p>To insert an array, you can utilise <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo#Collection.InsertMany\" rel=\"nofollow noreferrer\">Collection.InsertMany()</a>. For example: </p>\n\n<pre><code>result, err := coll.InsertMany(\n            context.Background(),\n            []interface{}{\n                bson.D{\n                    {\"item\", \"shirt\"},\n                    {\"quantity\", int32(25)},\n                    {\"tags\", bson.A{\"blank\", \"red\"}},\n                    {\"size\", bson.D{\n                        {\"h\", 14},\n                        {\"w\", 21},\n                        {\"uom\", \"cm\"},\n                    }},\n                },\n                bson.D{\n                    {\"item\", \"hat\"},\n                    {\"quantity\", int32(42)},\n                    {\"tags\", bson.A{\"gray\"}},\n                    {\"size\", bson.D{\n                        {\"h\", 27.9},\n                        {\"w\", 35.5},\n                        {\"uom\", \"cm\"},\n                    }},\n                },\n}) \n</code></pre>\n\n<p>See also <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo#Collection.BulkWrite\" rel=\"nofollow noreferrer\">Collection.BulkWrite()</a> to perform <a href=\"https://docs.mongodb.com/manual/core/bulk-write-operations/#bulk-write-operations\" rel=\"nofollow noreferrer\">Bulk Write Operations</a></p>\n"}], "owner": {"reputation": 393, "user_id": 6794339, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/1832841430283368/picture?type=large", "display_name": "Hernan Huma&#241;a", "link": "https://stackoverflow.com/users/6794339/hernan-huma%c3%b1a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2015, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1554924966, "creation_date": 1554766500, "last_edit_date": 1554924966, "question_id": 55583184, "link": "https://stackoverflow.com/questions/55583184/how-to-insert-multi-array-in-mongodb-with-golang", "title": "How to insert multi array in mongodb with golang", "body": "<p>I have this callback</p>\n\n<pre><code>p.OnSuccess(func(v interface{}) {\n\n    bulk := collections.Bulk()\n\n    bulk.Insert(v)\n    _, bulkErr := bulk.Run()\n    if bulkErr != nil {\n        panic(bulkErr)\n    }\n\n    fmt.Printf(\"\\n - %d comments inserted!\", reflect.ValueOf(v).Len())\n    Response(w, 200, 1, \"comment inserted!\", v)\n})\n</code></pre>\n\n<p>Where <code>v</code> is  a <code>interface</code> array and when i run the program for insert the data in mongo, golang response me with this message:</p>\n\n<blockquote>\n  <p>BSON field 'insert.documents.0' is the wrong type 'array', expected type 'obje\n  ct'</p>\n</blockquote>\n\n<p>this is the struct:</p>\n\n<pre><code>type Comment struct {\n\n    CommentId   int64 `bson:\"commentId\" json:\"commentId\"`\n    From        UserComment `bson:\"from\" json:\"from\"`\n    Text        string      `bson:\"text\" json:\"text\"`\n    CreatedTime time.Time   `bson:\"createdTime\" json:\"createdTime\"`\n    InfId       string      `bson:\"infId\" json:\"infId\"`\n    PostDate    string      `bson:\"postDate\" json:\"postDate\"`\n    PostId      string      `bson:\"postId\" json:\"postId\"`\n    Rate        string      `bson:\"rate\" json:\"rate\"`\n    CreatedAt   time.Time   `bson:\"createdAt\" json:\"createdAt\"`\n    UpdatedAt   time.Time   `bson:\"updatedAt\" json:\"updatedAt\"`\n}\n\ntype UserComment struct {\n\n    InstagramId int64  `bson:\"instagramId\" json:\"instagramId\"`\n    Username    string `bson:\"username\" json:\"username\"`\n    FullName    string `bson:\"fullName\" json:\"fullName\"`\n    Picture     string `bson:\"picture\" json:\"picture\"`\n}\n</code></pre>\n\n<p>i don't know if is the format of the struct but i  tried with this code and it did not work either!</p>\n\n<pre><code>var (\n    Allcomments []Comment\n    p           = promise.NewPromise()\n)\n\nfc := UserComment{\n    InstagramId: 1121313, //c.User.ID,\n    Username:    \"c.User.Username\",\n    FullName:    \"c.User.FullName\",\n    Picture:     \"c.User.ProfilePicURL\",\n}\n\ncmmnts := Comment{\n    CommentId:   44232323, //c.ID,\n    From:        fc,\n    Text:        \"c.Text\",\n    CreatedTime: now,\n    InfId:       \"infId\",\n    PostDate:    \"postDate\",\n    PostId:      \"PostId\",\n    Rate:        \"a\",\n    CreatedAt:   now,\n    UpdatedAt:   now,\n}\n\n\n\nAllcomments = append(Allcomments, cmmnts)\np.Resolve(Allcomments)\n</code></pre>\n"}, {"tags": ["go", "foundationdb"], "comments": [{"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1554776587, "post_id": 55582340, "comment_id": 97866210, "body": "Try to test something simple like getting data from db first. After that you will know if issue is in connection or in transaction."}, {"owner": {"reputation": 1, "user_id": 4521594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25f5d1631609e4434e511242ed183ae6?s=128&d=identicon&r=PG", "display_name": "Bancron", "link": "https://stackoverflow.com/users/4521594/bancron"}, "reply_to_user": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1554830507, "post_id": 55582340, "comment_id": 97892674, "body": "I am able to put data in the DB and query it back out via calling <code>fdb.Database.Transact</code> code: <code>Transact</code> for writing and <code>ReadTransact</code> for reading. The code is extremely similar."}, {"owner": {"reputation": 1, "user_id": 4521594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25f5d1631609e4434e511242ed183ae6?s=128&d=identicon&r=PG", "display_name": "Bancron", "link": "https://stackoverflow.com/users/4521594/bancron"}, "reply_to_user": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1554831331, "post_id": 55582340, "comment_id": 97893046, "body": "It is just being called over HTTP instead of inside a test. Same <code>fdb.MustOpenDefault()</code> and so on."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 4521594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25f5d1631609e4434e511242ed183ae6?s=128&d=identicon&r=PG", "display_name": "Bancron", "link": "https://stackoverflow.com/users/4521594/bancron"}, "is_accepted": true, "score": 0, "last_activity_date": 1554845735, "creation_date": 1554845735, "answer_id": 55601682, "question_id": 55582340, "link": "https://stackoverflow.com/questions/55582340/running-a-go-test-with-a-transaction/55601682#55601682", "title": "Running a Go test with a Transaction", "body": "<p>I have this working now by running some fdbserver and fdbcli commands first.</p>\n\n<pre><code>func TestMain(m *testing.M) {\n    port := 4692\n    testFileContents := []byte(fmt.Sprintf(\"test:test%d@127.0.0.1:%d\", port, port))\n    err := ioutil.WriteFile(\"fdb_test.cluster\", testFileContents, 0755)\n    db := fdb.MustOpen(\"fdb_test.cluster\", []byte(\"DB\"))\n    mErr := m.Run()\n    // ... tests run now\n\n    err = fdbServerCmd.Process.Kill()\n    if err != nil {\n        log.Fatalf(\"error killing fdbserver process %s\", err)\n    }\n    os.Exit(mErr)\n}\n\nfunc createDB() *exec.Cmd {\n    port := 4692\n    testFileContents := []byte(fmt.Sprintf(\"test:test%d@127.0.0.1:%d\", port, port))\n    err := ioutil.WriteFile(\"fdb_test.cluster\", testFileContents, 0755)\n    if err != nil {\n        log.Fatalf(\"unable to write fdb_test.cluster file %s\", err)\n    }\n    fdbServerLoc := \"/usr/local/libexec/fdbserver\"\n    fdbServerCmd := exec.Command(fdbServerLoc,\n        \"-p\", fmt.Sprintf(\"127.0.0.1:%d\", port),\n        \"--datadir\", fmt.Sprintf(\"/tmp/fdb%d\", port),\n        \"-C\", \"fdb_test.cluster\",\n    )\n    fdbServerCmd.Start()\n    configureLoc := \"/usr/local/bin/fdbcli\"\n    configureCmd := exec.Command(configureLoc,\n        \"-C\", \"fdb_test.cluster\", \"--exec\", \"configure new single memory\")\n    // This may error if the DB already exists (from previous test runs), so ignore the error.\n    configureCmd.Run()\n    return fdbServerCmd\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 4521594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25f5d1631609e4434e511242ed183ae6?s=128&d=identicon&r=PG", "display_name": "Bancron", "link": "https://stackoverflow.com/users/4521594/bancron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 0, "accepted_answer_id": 55601682, "answer_count": 1, "score": 0, "last_activity_date": 1564698482, "creation_date": 1554760625, "last_edit_date": 1564698482, "question_id": 55582340, "link": "https://stackoverflow.com/questions/55582340/running-a-go-test-with-a-transaction", "title": "Running a Go test with a Transaction", "body": "<p>I have Go code using FoundationDB and I want to test it.</p>\n\n<p>I have literally copied the Go <a href=\"https://github.com/apple/foundationdb/blob/master/bindings/go/src/fdb/fdb_test.go#L87\" rel=\"nofollow noreferrer\">test from Apple's Github</a>. When I uncomment the line that actually runs <code>Set</code> within the transaction, the test hangs and then times out. (With the line still commented out it works as expected.)</p>\n\n<pre><code>func TestExampleTransactor(t *testing.T) {\n    fdb.MustAPIVersion(400)  // Note: test behaves the same with MustAPIVersion(600)\n    db := fdb.MustOpenDefault()\n\n    setOne := func(t fdb.Transactor, key fdb.Key, value []byte) error {\n        fmt.Printf(\"setOne called with:  %T\\n\", t)\n        _, e := t.Transact(func(tr fdb.Transaction) (interface{}, error) {\n            // We don't actually call tr.Set here to avoid mutating a real database.\n            tr.Set(key, value) // **NOTE** this is the line I uncommented\n            return nil, nil\n        })\n        return e\n    }\n\n    setMany := func(t fdb.Transactor, value []byte, keys ...fdb.Key) error {\n        fmt.Printf(\"setMany called with: %T\\n\", t)\n        _, e := t.Transact(func(tr fdb.Transaction) (interface{}, error) {\n            for _, key := range keys {\n                setOne(tr, key, value)\n            }\n            return nil, nil\n        })\n        return e\n    }\n\n    var e error\n\n    fmt.Println(\"Calling setOne with a database:\")\n    e = setOne(db, []byte(\"foo\"), []byte(\"bar\"))\n    if e != nil {\n        fmt.Println(e)\n        return\n    }\n    fmt.Println(\"\\nCalling setMany with a database:\")\n    e = setMany(db, []byte(\"bar\"), fdb.Key(\"foo1\"), fdb.Key(\"foo2\"), fdb.Key(\"foo3\"))\n    if e != nil {\n        fmt.Println(e)\n        return\n    }\n}\n</code></pre>\n\n<p>I am running MacOS 10.13.6. I have FoundationDB installed and I'm able to connect to it using <code>fdbcli</code>, as well as read from and write to it.</p>\n\n<p>Here are the <code>foundation</code> processes:</p>\n\n<pre><code>ps aux | grep foundation\nroot             12942   1.0  0.3  4488980  46608   ??  S    12:35PM   2:00.06 /usr/local/libexec/fdbserver --cluster_file /usr/local/etc/foundationdb/fdb.cluster --datadir /usr/local/foundationdb/data/4689 --listen_address\nroot             12517   0.3  0.1  4382548  12204   ??  S    12:32PM   0:29.63 /usr/local/foundationdb/backup_agent/backup_agent --cluster_file /usr/local/etc/foundationdb/fdb.cluster\nbancron          25399   0.0  0.0  4258468    200 s005  R+    2:55PM   0:00.00 grep foundation\nroot             12515   0.0  0.0  4297540    584   ??  Ss   12:32PM   0:00.01 /usr/local/libexec/fdbmonitor --conffile /usr/local/etc/foundationdb/foundationdb.conf --lockfile /var/run/FoundationDB.pid\n</code></pre>\n\n<p>In case it is relevant, this is the contents of the default cluster file found at <code>/usr/local/etc/foundationdb/fdb.cluster</code>:</p>\n\n<pre><code>JCKqKWc6:ku0VRske@127.0.0.1:4689\n</code></pre>\n\n<p>And this is the contents of <code>/usr/local/etc/foundationdb/foundationdb.conf</code>:</p>\n\n<pre><code>[general]\nrestart_delay = 60\ncluster_file = /usr/local/etc/foundationdb/fdb.cluster\n\n## Default parameters for individual fdbserver processes\n[fdbserver]\ncommand = /usr/local/libexec/fdbserver\npublic_address = auto:$ID\nlisten_address = public\ndatadir = /usr/local/foundationdb/data/$ID\nlogdir = /usr/local/foundationdb/logs\n\n## An individual fdbserver process with id 4689\n## Parameters set here override defaults from the [fdbserver] section\n[fdbserver.4689]\n\n[backup_agent]\ncommand = /usr/local/foundationdb/backup_agent/backup_agent\nlogdir = /usr/local/foundationdb/logs\n\n[backup_agent.1]\n</code></pre>\n"}, {"tags": ["docker", "go", "active-directory", "kerberos"], "comments": [{"owner": {"reputation": 18792, "user_id": 385548, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e8f290affc1d939cf9a4ad2c9e79592a?s=128&d=identicon&r=PG", "display_name": "Vojtech Vitek", "link": "https://stackoverflow.com/users/385548/vojtech-vitek"}, "edited": false, "score": 0, "creation_date": 1613769632, "post_id": 55582064, "comment_id": 117188409, "body": "Hi Nurzhan, did you figure it out? Care to share the answer / example, please?"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1003, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1554759127, "creation_date": 1554759127, "question_id": 55582064, "link": "https://stackoverflow.com/questions/55582064/how-to-set-up-a-connection-with-kerberos-in-golang-app", "title": "How to set up a connection with Kerberos in Golang app?", "body": "<p>I have task to create <code>SSO</code> (single sign-on) in <code>Golang</code> application with the help of <code>Kerberos</code> and <code>Active Directory</code>. In other words, if an employee of the company makes a request for a specific URL, the service must return information about him.</p>\n\n<p>I decided to use <a href=\"https://github.com/jcmturner/gokrb5\" rel=\"nofollow noreferrer\">gokrb5</a> library.</p>\n\n<p>What I have done so far:</p>\n\n<p>1) <code>SPN</code> name for the service was created in Active Directory.</p>\n\n<p>2) <code>krb5.keytab</code> file for the service was created.</p>\n\n<p>3) Active Directory and Kerberos server located on remote Windows server.</p>\n\n<p>4) Golang application would be in Linux Docker container.</p>\n\n<p>5) I install <code>Kerberos</code> client to Docker container.</p>\n\n<p>6) I put <code>krb5.keytab</code> file to <code>etc</code> folder of Docker container.</p>\n\n<p>7) Kerberos Realm: EXAMPLE.LOCAL.</p>\n\n<p>8)  hostname for the KDC Server: CS001, CS002, CS003</p>\n\n<p>What the configuration file <code>krb5.conf</code> for Kerberos client should look like? How in Golang application I can correctly send token to Kerberos?</p>\n"}, {"tags": ["go", "amazon-dynamodb", "latency", "aws-sdk-go", "aws-aurora"], "comments": [{"owner": {"reputation": 162605, "user_id": 174777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6PnNW.jpg?s=128&g=1", "display_name": "John Rotenstein", "link": "https://stackoverflow.com/users/174777/john-rotenstein"}, "edited": false, "score": 0, "creation_date": 1554757299, "post_id": 55581207, "comment_id": 97861716, "body": "What were your numbers?"}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1554827557, "post_id": 55581207, "comment_id": 97891264, "body": "Are you using VPC for connecting to AuroraDB, and calls to Dynamo are over VPC or internet ?"}], "answers": [{"comments": [{"owner": {"reputation": 379, "user_id": 3935715, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/7462de9b868da1b88001d7e25489e839?s=128&d=identicon&r=PG&f=1", "display_name": "Korba", "link": "https://stackoverflow.com/users/3935715/korba"}, "edited": false, "score": 0, "creation_date": 1554765609, "post_id": 55581753, "comment_id": 97864163, "body": "Corrected to use GetItem instead of Query. Cloudwatch indeed shows DynamoDB latency to be 2.08 ms though."}], "tags": [], "owner": {"reputation": 16176, "user_id": 2933177, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/LRuRW.jpg?s=128&g=1", "display_name": "Charles", "link": "https://stackoverflow.com/users/2933177/charles"}, "is_accepted": false, "score": 6, "last_activity_date": 1554761556, "last_edit_date": 1554761556, "creation_date": 1554757615, "answer_id": 55581753, "question_id": 55581207, "link": "https://stackoverflow.com/questions/55581207/aurora-vs-dynamodb-latency-not-as-expected/55581753#55581753", "title": "Aurora vs DynamoDB latency not as expected", "body": "<p>You don't show the timing results... but I'd say you're comparing apples to oranges. If you know the primary key of a DynamoDB item, you should be using <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/#DynamoDB.GetItem\" rel=\"noreferrer\">GetItem()</a> not Query().</p>\n\n<p>Using GetItem(), you should have \"single-digit millisecond\" response times; <strong><em>excluding the network / HTTP latency</em></strong></p>\n\n<p>That last bit is important, but should hopefully be similar for the requests to Aurora.</p>\n"}, {"tags": [], "owner": {"reputation": 48529, "user_id": 63074, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e77511a13f8c53b87610e52b4b38aa43?s=128&d=identicon&r=PG", "display_name": "Mike Dinescu", "link": "https://stackoverflow.com/users/63074/mike-dinescu"}, "is_accepted": false, "score": 1, "last_activity_date": 1554827138, "creation_date": 1554827138, "answer_id": 55597296, "question_id": 55581207, "link": "https://stackoverflow.com/questions/55581207/aurora-vs-dynamodb-latency-not-as-expected/55597296#55597296", "title": "Aurora vs DynamoDB latency not as expected", "body": "<p>I think you're missing a few very important points.</p>\n\n<ol>\n<li>DynamoDB is a \"database as a service\" whereas Aurora is a more traditional database</li>\n<li>Whenever you do performance benchmarking or any kind, you can't just run a single test: you need to perform lots and then compute a statistic, such as mean, or better yet a top percentile (say the 99th percentile)</li>\n<li>DynamoDB shines when you need \"predictable performance at any scale\" </li>\n</ol>\n\n<hr>\n\n<p>The first point is important because it means that in order to get data from DynamoDB you're making web requests which have some degree of overhead compared to a more traditional database. This overhead may well be on the order of 1-2 milliseconds per request. But this is presumably fine in the context of most applications as long as the application is well architected and doesn't make a ton of unnecessary requests.</p>\n\n<p>The second point is important because if you don't look at it correctly you could be measuring outliers: meaning you might see some results that are not representative of typical performance and could spend a lot of time chasing red herrings. Instead of measuring the performance of one query, measure the performance of many of the same type of queries and compute some stats, like: the mean and standard deviation; or the <a href=\"https://www.netcraftsmen.com/95th-percentile-calculation/\" rel=\"nofollow noreferrer\">Nth percentile</a> (50th, 90th, 99th are typical)</p>\n\n<p>The last point is really the one that pretty much motivates using DynamoDB versus a classic database engine. You're looking at the happiest of happy cases: a (presumably) small table with a few items where you're retrieving a single one using it's primary key. DynamoDB is really all about what happens as your <em>data grows</em> over time. You want to have the same performance when retrieving that item now, when your table has 1000 items in it as when your table has 100,000,000 items in it. And things do get more interesting with more complex queries.</p>\n\n<p>With DynamoDB you're trading a little performance overhead in the simplest of cases for stability.</p>\n\n<p>But DynamoDB is not a panacea! There are situations where a relational database will always beat DynamoDB. </p>\n"}], "owner": {"reputation": 379, "user_id": 3935715, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/7462de9b868da1b88001d7e25489e839?s=128&d=identicon&r=PG&f=1", "display_name": "Korba", "link": "https://stackoverflow.com/users/3935715/korba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2411, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1554827138, "creation_date": 1554754940, "last_edit_date": 1554761403, "question_id": 55581207, "link": "https://stackoverflow.com/questions/55581207/aurora-vs-dynamodb-latency-not-as-expected", "title": "Aurora vs DynamoDB latency not as expected", "body": "<p>I wanted to get some numbers to prove my reading that DynamoDB Key-Value storage has better read performance compare to relational DB (MySQL, PostgreSQL, Aurora). So I decided to compare READ Latencies of DynamoDB &amp; AWS-Aurora (which is a/c to AWS website - \"up to five times faster than standard MySQL databases and three times faster than standard PostgreSQL databases\")</p>\n\n<p><strong>Step1</strong>: Created a Table in Aurora with the following Schema and added 1.02 million records to that table.</p>\n\n<pre><code>Table gift_log (\n  gift_uuid               BINARY(16) NOT NULL,\n  user_uuid               BINARY(16) NOT NULL,\n  parent_uuid             BINARY(16),\n  operation_time          TIMESTAMP,\n  operation               VARCHAR(20) NOT NULL,\n  gift_type               VARCHAR(20) NOT NULL,\n  parent_type             VARCHAR(20),\n  relation_type           VARCHAR(20),\n  PRIMARY KEY (gift_uuid)\n);\n</code></pre>\n\n<p>Used Golang Client that uses MySQL driver for database/sql package to query table.</p>\n\n<p><strong>Step2</strong>; Created DynamoDB table with following Attributes. Added 1 million Items to the table.\n        DID NOT  use any sort key. All queries used Partition key.</p>\n\n<pre><code>\nTable: GiftLog {\n    gift_uuid               Binary (Partition Key)\n    user_uuid               Binary\n    operation_time          Number,\n    operation               String,\n    gift_type               String,\n    parent_type             String\n}\n</code></pre>\n\n<p>Used Golang Client that uses AWS Go-SDK to query DynamoDB table.</p>\n\n<p>AURORA</p>\n\n<pre><code>startTime := time.Now().UnixNano()\n\nrows, err := db.Query(\"SELECT * FROM gift_log WHERE gift_uuid=?\", giftIDsToRead[i])\n\nendTimt := time.Now().UnixNano()\n</code></pre>\n\n<p>DynamoDB</p>\n\n<pre><code>queryInput := &amp;dynamodb.QueryInput{\n        TableName: aws.String(tableName),\n        KeyConditions: map[string]*dynamodb.Condition{\n                        \"GiftUUID\": {\n                            ComparisonOperator: aws.String(\"EQ\"),\n                            AttributeValueList: []*dynamodb.AttributeValue{\n                                {\n                                    B: giftIDsToRead[i],\n                                },\n                            },\n                        },\n        },\n}\n\nstartTime := time.Now().UnixNano()\n\nresp, err := svc.Query(queryInput)\n\nendTime := time.Now().UnixNano()\n</code></pre>\n\n<p>Aurora Latency: 543.89 DynamoDB Latency: 2934.96 usec</p>\n\n<p>These numbers don't seem right. Am I not comparing apples to apples?</p>\n"}, {"tags": ["go", "dependencies", "dep"], "comments": [{"owner": {"reputation": 2485, "user_id": 3639630, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rPscq.jpg?s=128&g=1", "display_name": "Wesgur", "link": "https://stackoverflow.com/users/3639630/wesgur"}, "edited": false, "score": 3, "creation_date": 1554750880, "post_id": 55579202, "comment_id": 97859029, "body": "try dep with verbose option <code>dep ensure -v</code>"}, {"owner": {"reputation": 217, "user_id": 5410509, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/40f4503dae48b0d35114f22883ef4063?s=128&d=identicon&r=PG&f=1", "display_name": "Jasson Harsojo", "link": "https://stackoverflow.com/users/5410509/jasson-harsojo"}, "reply_to_user": {"reputation": 2485, "user_id": 3639630, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rPscq.jpg?s=128&g=1", "display_name": "Wesgur", "link": "https://stackoverflow.com/users/3639630/wesgur"}, "edited": false, "score": 0, "creation_date": 1554784565, "post_id": 55579202, "comment_id": 97867730, "body": "yes i&#39;ve done that, it just showing the process but nothing happen. just stuck"}, {"owner": {"reputation": 111, "user_id": 1542778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3fc3444375d06a3f970671917ffdb42?s=128&d=identicon&r=PG", "display_name": "jesusnoseq", "link": "https://stackoverflow.com/users/1542778/jesusnoseq"}, "edited": false, "score": 0, "creation_date": 1554849375, "post_id": 55579202, "comment_id": 97900295, "body": "Try to execute <code>sudo dep ensure</code>"}], "answers": [{"tags": [], "owner": {"reputation": 217, "user_id": 5410509, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/40f4503dae48b0d35114f22883ef4063?s=128&d=identicon&r=PG&f=1", "display_name": "Jasson Harsojo", "link": "https://stackoverflow.com/users/5410509/jasson-harsojo"}, "is_accepted": true, "score": 0, "last_activity_date": 1554992769, "creation_date": 1554992769, "answer_id": 55634882, "question_id": 55579202, "link": "https://stackoverflow.com/questions/55579202/dep-ensure-doing-nothing-just-loading/55634882#55634882", "title": "Dep Ensure Doing Nothing Just Loading", "body": "<p>Finally i got it work by reinstalling dep</p>\n\n<p>Remove <code>Gopkg.toml</code>, <code>Gopkg.lock</code>, &amp; <code>vendor</code> and re-do dep init again</p>\n\n<p>Remove file from <code>$GOPATH/pkg/dep</code> &amp; <code>$GOPATH/pkg/bin/dep</code></p>\n\n<p>Just erase everything about dep.</p>\n\n<p>I Don't know what happen but it works for me</p>\n\n<p>Just make sure you do the dep inside $GOPATH folder</p>\n"}], "owner": {"reputation": 217, "user_id": 5410509, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/40f4503dae48b0d35114f22883ef4063?s=128&d=identicon&r=PG&f=1", "display_name": "Jasson Harsojo", "link": "https://stackoverflow.com/users/5410509/jasson-harsojo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 709, "favorite_count": 0, "accepted_answer_id": 55634882, "answer_count": 1, "score": 0, "last_activity_date": 1554992769, "creation_date": 1554746386, "question_id": 55579202, "link": "https://stackoverflow.com/questions/55579202/dep-ensure-doing-nothing-just-loading", "title": "Dep Ensure Doing Nothing Just Loading", "body": "<p>I have a problem with dep</p>\n\n<p>When i add some dependency for example <code>github.com/jmoiron/sqlx</code> this dependency, I have to wait very long, then it just doing nothing, only showing message \"Fetching Sources\"</p>\n\n<p>I've been waiting for 5 mins and it's not doing anything</p>\n\n<p><em>PS: this one still brand new project</em></p>\n\n<p>go version go1.11.2 darwin/amd64</p>\n\n<p>dep version 0.50</p>\n\n<p>OS MacOS High Sierra</p>\n\n<p>Any suggestion?</p>\n"}, {"tags": ["go", "go-gorm"], "owner": {"reputation": 2869, "user_id": 975987, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/VsuyE.jpg?s=128&g=1", "display_name": "William Wino", "link": "https://stackoverflow.com/users/975987/william-wino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 202, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1554789513, "creation_date": 1554744098, "last_edit_date": 1554789513, "question_id": 55578629, "link": "https://stackoverflow.com/questions/55578629/self-referencing-struct-records-with-preloaded-parents-are-switched-between-par", "title": "Self-referencing struct, records with preloaded parents are switched between parents and children", "body": "<p>I have a struct which is self referencing, and when I try to fetch the data by using <code>Preload</code> the record is somehow switched between the parent and the child.</p>\n\n<p>In this example I created these records:</p>\n\n<ol>\n<li>A Person called Manager 1 </li>\n<li>A Person called Employee 1 which has\nManager 1 as his parent </li>\n<li>A Person called Manager 2</li>\n<li>A Person called\nEmployee 2 which has Manager 2 as his parent</li>\n</ol>\n\n<p>Here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\ntype Person struct {\n    ID      int `gorm:\"primary_key\"`\n    Name    string\n    Parent  int\n    Parent_ *Person `gorm:\"foreignkey:parent\"`\n}\n\nfunc (Person) TableName() string {\n    return \"go_person\"\n}\n\nconst (\n    DB_ADAPTER  = \"postgres\"\n    DB_HOST     = \"localhost\"\n    DB_USER     = \"postgres\"\n    DB_PASSWORD = \"test\"\n    DB_NAME     = \"test\"\n    DB_SSLMODE  = \"disable\"\n)\n\nfunc main() {\n    db, err := gorm.Open(DB_ADAPTER, \"host=\"+DB_HOST+\" user=\"+DB_USER+\" dbname=\"+DB_NAME+\" sslmode=disable\"+\" password=\"+DB_PASSWORD+\"\")\n    if err != nil {\n        panic(\"failed to open storage\")\n    }\n    defer db.Close()\n    db.AutoMigrate(&amp;Person{})\n\n    db.Delete(Person{})\n\n    newManager := Person{\n        Name    : \"Manager 1\",\n    }\n    db.Create(&amp;newManager)\n\n    managerID := newManager.ID\n\n    newEmployee := Person{\n        Name    : \"Employee 1\",\n        Parent  : managerID,\n    }\n    db.Create(&amp;newEmployee)\n\n    newManager = Person{\n        Name    : \"Manager 2\",\n    }\n    db.Create(&amp;newManager)\n\n    managerID = newManager.ID\n\n    newEmployee = Person{\n        Name    : \"Employee 2\",\n        Parent  : managerID,\n    }\n    db.Create(&amp;newEmployee)\n\n    persons := []Person{}\n\n    db.Preload(\"Parent_\").Find(&amp;persons)\n\n    for _, person := range persons {\n        fmt.Println(\"Name    :\",person.Name)\n        if person.Parent_ != nil {\n            fmt.Println(\"Manager :\",person.Parent_.Name)\n        }\n        fmt.Println(\"---------------------------------\")\n    }\n}\n</code></pre>\n\n<p>In this example I expect to have this as the output:</p>\n\n<pre><code>Name    : Manager 1\n---------------------------------\nName    : Employee 1\nManager : Manager 1\n---------------------------------\nName    : Manager 2\n---------------------------------\nName    : Employee 2\nManager : Manager 2\n---------------------------------\n</code></pre>\n\n<p>But instead I got this:</p>\n\n<pre><code>Name    : Manager 1\nManager : Employee 1\n---------------------------------\nName    : Employee 1\n---------------------------------\nName    : Manager 2\nManager : Employee 2\n---------------------------------\nName    : Employee 2\n---------------------------------\n</code></pre>\n\n<p>Why?</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 474, "user_id": 2709131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2814a78ae5b7945b770965603bd31df6?s=128&d=identicon&r=PG&f=1", "display_name": "pwaterz", "link": "https://stackoverflow.com/users/2709131/pwaterz"}, "edited": false, "score": 1, "creation_date": 1554771171, "post_id": 55578280, "comment_id": 97865301, "body": "Is your GOROOT path set? Also are there any other go files in the same project where there might an error?"}, {"owner": {"reputation": 2945, "user_id": 5345715, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f05631812e06e1599ce28b59ed000c?s=128&d=identicon&r=PG&f=1", "display_name": "User12547645", "link": "https://stackoverflow.com/users/5345715/user12547645"}, "reply_to_user": {"reputation": 474, "user_id": 2709131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2814a78ae5b7945b770965603bd31df6?s=128&d=identicon&r=PG&f=1", "display_name": "pwaterz", "link": "https://stackoverflow.com/users/2709131/pwaterz"}, "edited": false, "score": 0, "creation_date": 1554792545, "post_id": 55578280, "comment_id": 97870476, "body": "Yes, I inserted <code>go.goroot</code> in my application. Apparently, I have two conflicting go installations on my computer. After recompiling the tools, vscode was able to detect errors. Thanks! Please submit your suggestion as an answer so I can close this issue."}, {"owner": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "edited": false, "score": 0, "creation_date": 1590771605, "post_id": 55578280, "comment_id": 109817221, "body": "I keep seeing &quot;go: install/update tools&quot; in documentation. Has this option been removed recently? I&#39;m assuming it was an old menu setting Go &gt; Install/update tools?"}], "answers": [{"tags": [], "owner": {"reputation": 2945, "user_id": 5345715, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f05631812e06e1599ce28b59ed000c?s=128&d=identicon&r=PG&f=1", "display_name": "User12547645", "link": "https://stackoverflow.com/users/5345715/user12547645"}, "is_accepted": false, "score": 4, "last_activity_date": 1554804604, "creation_date": 1554804604, "answer_id": 55590302, "question_id": 55578280, "link": "https://stackoverflow.com/questions/55578280/vscode-does-not-detect-errors-golang/55590302#55590302", "title": "vscode does not detect errors golang", "body": "<p>As @pwaterz pointed out, the solution to my problem was to add <code>\"go.goroot: /some/other/path\"</code>. </p>\n\n<p>The reason that vscode was not able to detect errors was, that there are different go versions on my computer. Adding the goroot and running <code>go: install/update Tools</code> solved the problem.</p>\n"}], "owner": {"reputation": 2945, "user_id": 5345715, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f05631812e06e1599ce28b59ed000c?s=128&d=identicon&r=PG&f=1", "display_name": "User12547645", "link": "https://stackoverflow.com/users/5345715/user12547645"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2106, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1554804604, "creation_date": 1554742686, "question_id": 55578280, "link": "https://stackoverflow.com/questions/55578280/vscode-does-not-detect-errors-golang", "title": "vscode does not detect errors golang", "body": "<p>My vscode does not detect errors in golang. </p>\n\n<p>Example: </p>\n\n<pre><code>package somepackage\n\nimport \"fmt\"\n\nfunc f(name string) string {\n    name = 1\n    return name\n}\n</code></pre>\n\n<p>This should throw a type error, but it does not. I never get any errors.</p>\n\n<p>My <code>settings.json</code> contains</p>\n\n<pre><code>\"go.gopath\": \"some/path\", \n\"go.vetOnSave\": \"package\",\n\"go.lintOnSave\": \"package\",\n\"go.testOnSave\": true,\n\"go.buildOnSave\": \"package\",\n\"go.coverOnSave\": true \n</code></pre>\n\n<p>I was able to run <code>go: install/update Tools</code>. All tools are installed successfully.</p>\n\n<p>I am also able to run debug a .go file in vscode. </p>\n"}, {"tags": ["go", "go-http"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1554736652, "post_id": 55576657, "comment_id": 97852115, "body": "Can you print the url path for those requests where you get the <code>?</code> in the query param?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1554736680, "post_id": 55576657, "comment_id": 97852131, "body": "The client includes an additional question mark in the URL then."}], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 4525571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2156573556e1e7448710d907b2873cad?s=128&d=identicon&r=PG&f=1", "display_name": "Thor", "link": "https://stackoverflow.com/users/4525571/thor"}, "is_accepted": true, "score": 0, "last_activity_date": 1554740950, "creation_date": 1554740950, "answer_id": 55577832, "question_id": 55576657, "link": "https://stackoverflow.com/questions/55576657/inconsistent-key-maps-from-r-url-query/55577832#55577832", "title": "Inconsistent key maps from r.URL.Query()", "body": "<p>Figured out the culprit- there was a middleware that was preprocessing the query and forwarding requests through a proxy for some reason.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (h *Handler) proxy(w http.ResponseWriter, r *http.Request, uri *url.URL) {\n    params := r.URL.Query()\n    proxy := httputil.ReverseProxy{Director: func(proxyRequest *http.Request) {\n        proxyRequest.URL.Scheme = uri.Scheme\n        proxyRequest.URL.Host = uri.Host\n        proxyRequest.URL.Path = uri.Path\n        proxyRequest.Body = r.Body\n        proxyRequest.URL.RawQuery = paramsToString(params)\n    }}\n    proxy.ServeHTTP(w, r)\n}\n\nfunc paramsToString(m url.Values) string {\n    keys := make([]string, 0, len(m))\n    for k := range m {\n        keys = append(keys, k+\"=\"+m[k][0])\n    }\n    return \"?\" + strings.Join(keys, \"&amp;\")\n}\n</code></pre>\n\n<p><code>proxyRequest.URL.RawQuery</code> expects the raw query, not a query with <code>?</code>; the <code>paramsToString</code> func should actually be this</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func paramsToString(m url.Values) string {\n    keys := make([]string, 0, len(m))\n    for k := range m {\n        keys = append(keys, k+\"=\"+m[k][0])\n    }\n    return strings.Join(keys, \"&amp;\")\n}\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 4525571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2156573556e1e7448710d907b2873cad?s=128&d=identicon&r=PG&f=1", "display_name": "Thor", "link": "https://stackoverflow.com/users/4525571/thor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 55577832, "answer_count": 1, "score": -3, "last_activity_date": 1554740950, "creation_date": 1554736562, "last_edit_date": 1554737360, "question_id": 55576657, "link": "https://stackoverflow.com/questions/55576657/inconsistent-key-maps-from-r-url-query", "title": "Inconsistent key maps from r.URL.Query()", "body": "<p>When parsing URLs using <code>r.URL.Query()</code>, I am getting inconsistent results and was wondering if anyone else has had the same issue and/or a viable workaround. Keys sometimes return <code>?keyName</code> instead of <code>keyName</code> so often i'll do <code>keys.Get</code> on both values.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func(w http.ResponseWriter, r *http.Request) {\n        keys := r.URL.Query()\n        lat := keys.Get(\"lat\")\n        if lat == \"\" {\n                // r.URL.Query sometimes comes back with ?lat instead of lat for some reason...\n            lat = keys.Get(\"?lat\")\n            if lat == \"\" {\n                            // error here\n            }\n        }\n\n        lng := keys.Get(\"lng\")\n        if lng == \"\" {\n            lng = keys.Get(\"?lng\")\n            if lng == \"\" {\n                            // error here\n            }\n        }\n}\n</code></pre>\n\n<p>Test URL: <code>http://localhost:3000/?lng=-75.7572111845&amp;type=property</code></p>\n\n<h3>Current Outputs</h3>\n\n<pre><code>2019/04/08 10:59:27 map[lat:[39.5040840724] lng:[-75.7572111845]]\n2019/04/08 10:59:28 map[?lat:[39.5040840724] lng:[-75.7572111845]]\n2019/04/08 10:59:29 map[lat:[39.5040840724] lng:[-75.7572111845]]\n2019/04/08 10:59:30 map[lat:[39.5040840724] lng:[-75.7572111845]]\n2019/04/08 10:59:31 map[lat:[39.5040840724] ?lng:[-75.7572111845]]\n</code></pre>\n\n<h3>Expected</h3>\n\n<pre><code>2019/04/08 10:59:27 map[lat:[39.5040840724] lng:[-75.7572111845]]\n2019/04/08 10:59:28 map[lat:[39.5040840724] lng:[-75.7572111845]]\n2019/04/08 10:59:29 map[lat:[39.5040840724] lng:[-75.7572111845]]\n2019/04/08 10:59:30 map[lat:[39.5040840724] lng:[-75.7572111845]]\n2019/04/08 10:59:31 map[lat:[39.5040840724] lng:[-75.7572111845]]\n</code></pre>\n"}, {"tags": ["ajax", "go", "cors", "jwt", "setcookie"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554736118, "post_id": 55576464, "comment_id": 97851820, "body": "Your CORS allowed origin isn&#39;t the same as the URL in your JavaScript - are your API and UI being served from the same port?"}, {"owner": {"reputation": 187, "user_id": 10484525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5777df4baf6f1c458b98e853c327236d?s=128&d=identicon&r=PG&f=1", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/10484525/abhinav"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554737057, "post_id": 55576464, "comment_id": 97852332, "body": "No, they are served on different ports. Frontend: localhost:5000, backend: localhost:8080"}], "answers": [{"tags": [], "owner": {"reputation": 351, "user_id": 1774646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e594c1d84998cb4cdfe7008014788201?s=128&d=identicon&r=PG", "display_name": "abvarun226", "link": "https://stackoverflow.com/users/1774646/abvarun226"}, "is_accepted": false, "score": 0, "last_activity_date": 1554746150, "creation_date": 1554746150, "answer_id": 55579146, "question_id": 55576464, "link": "https://stackoverflow.com/questions/55576464/when-i-do-post-request-on-golang-api-using-postman-i-successfully-receive-the-jw/55579146#55579146", "title": "When I do POST request on golang api using POSTMAN I successfully receive the jwt token as a cookie but when I do it from browser I get no cookie", "body": "<p>In your server response, set <code>HttpOnly</code> to false and in chrome, go to console and type <code>document.cookie</code>. You should see the cookie set by the server.</p>\n\n<p>The other option is, leave <code>HttpOnly</code> set to true. In chrome, open developer tools, click on <code>Application</code> tab, you should see <code>Cookies</code> under <code>Storage</code>. Click on <code>Cookies</code> and you should see the cookie set by the server.</p>\n"}, {"tags": [], "owner": {"reputation": 187, "user_id": 10484525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5777df4baf6f1c458b98e853c327236d?s=128&d=identicon&r=PG&f=1", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/10484525/abhinav"}, "is_accepted": true, "score": 1, "last_activity_date": 1555166073, "creation_date": 1555166073, "answer_id": 55666628, "question_id": 55576464, "link": "https://stackoverflow.com/questions/55576464/when-i-do-post-request-on-golang-api-using-postman-i-successfully-receive-the-jw/55666628#55666628", "title": "When I do POST request on golang api using POSTMAN I successfully receive the jwt token as a cookie but when I do it from browser I get no cookie", "body": "<p>I had to add <code>w.Header().Add(\"Access-Control-Allow-Credentials\", \"true\")</code> for all the requests and not just OPTIONS preflight request and also it turned out that chrome was not showing the cookie in storage but it was present and working as expected, later I checked in firefox and the cookie was visible in storage.</p>\n"}], "owner": {"reputation": 187, "user_id": 10484525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5777df4baf6f1c458b98e853c327236d?s=128&d=identicon&r=PG&f=1", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/10484525/abhinav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1155, "favorite_count": 0, "accepted_answer_id": 55666628, "answer_count": 2, "score": 3, "last_activity_date": 1555166073, "creation_date": 1554735970, "last_edit_date": 1554736988, "question_id": 55576464, "link": "https://stackoverflow.com/questions/55576464/when-i-do-post-request-on-golang-api-using-postman-i-successfully-receive-the-jw", "title": "When I do POST request on golang api using POSTMAN I successfully receive the jwt token as a cookie but when I do it from browser I get no cookie", "body": "<p>I have made an API in golang. Backend and frontend are running on separate servers. When I test the API with POSTMAN everything works fine and I receive the cookie containing the jwt token but when I do the request from the frontend then no cookie is received.</p>\n\n<p>Here is the middleware for handling CORS:</p>\n\n<pre><code>func corsHandler(h http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        // origin := r.Header.Get(\"Origin\")\n        w.Header().Set(\"Access-Control-Allow-Origin\", \"http://localhost:5000\")\n        if r.Method == \"OPTIONS\" {\n            w.Header().Set(\"Access-Control-Allow-Credentials\", \"true\")\n            w.Header().Set(\"Access-Control-Allow-Methods\", \"GET, POST, PUT, DELETE\")\n\n            w.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type, X-CSRF-Token, Authorization, access-control-allow-origin\")\n            return\n        }\n        h.ServeHTTP(w, r)\n    })\n}\n\n</code></pre>\n\n<p>Following is the cookie generator:</p>\n\n<pre><code>    jwtCookie := &amp;http.Cookie{\n        Name:   \"jwtToken\",\n        Secure: false,\n        HttpOnly: true,\n        Value:    tokenString,\n        Expires:  expiryTime,\n    }\n\n    http.SetCookie(w, jwtCookie)\n    w.Header().Add(\"Access-Control-Allow-Credentials\", \"true\")\n    w.WriteHeader(http.StatusOK)\n</code></pre>\n\n<p>Following is the ajax request:</p>\n\n<pre><code>       $.ajax({\n            type: 'POST',\n            url: 'http://localhost:8080/api/signin',\n            data: JSON.stringify({\n                \"username\": $('#username').val(),\n                \"password\": $('#password').val()\n            }),\n            xhrFields: { withCredentials: true },\n            contentType: \"application/json\",\n            dataType: \"json\",\n            success: function(data) {\n                console.log(data);\n            },\n            error: function(message) {\n                console.log(message.responseJSON);\n            }\n        });\n</code></pre>\n\n<p>In firefox the response header looks like this:\n<a href=\"https://i.stack.imgur.com/5zOsF.png\" rel=\"nofollow noreferrer\">As you can see in image 1, the cookie is received in header but it is not visible in storage</a></p>\n\n<p>In chrome the response header looks like:\n<a href=\"https://i.stack.imgur.com/xPX8e.png\" rel=\"nofollow noreferrer\">there is no cookie visible in chrome</a></p>\n\n<p>I am stuck on this for quite a long time. Any help would be valuable :)</p>\n"}, {"tags": ["go", "google-api", "go-http"], "answers": [{"comments": [{"owner": {"reputation": 351, "user_id": 1774646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e594c1d84998cb4cdfe7008014788201?s=128&d=identicon&r=PG", "display_name": "abvarun226", "link": "https://stackoverflow.com/users/1774646/abvarun226"}, "reply_to_user": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "edited": false, "score": 0, "creation_date": 1554742211, "post_id": 55577253, "comment_id": 97855010, "body": "No problem. Happy to help."}], "tags": [], "owner": {"reputation": 351, "user_id": 1774646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e594c1d84998cb4cdfe7008014788201?s=128&d=identicon&r=PG", "display_name": "abvarun226", "link": "https://stackoverflow.com/users/1774646/abvarun226"}, "is_accepted": true, "score": 2, "last_activity_date": 1554738629, "creation_date": 1554738629, "answer_id": 55577253, "question_id": 55576032, "link": "https://stackoverflow.com/questions/55576032/sending-file-to-google-drive-api-from-golang-code-yields-error-unsupported-cont/55577253#55577253", "title": "Sending file to Google drive API from golang code yields error: Unsupported content with type: image/jpeg", "body": "<p>The problem is in the JSON metadata that you send. Here is a sample code (use proper error checking) that will work,</p>\n\n<pre><code>import (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"mime/multipart\"\n    \"net/http\"\n    \"net/textproto\"\n)\n\nfunc main() {\n    accessToken := \"YOUR-TOKEN\"\n\n    client := http.Client{}\n    mediaData, _ := ioutil.ReadFile(\"test.png\")\n\n    body := &amp;bytes.Buffer{}\n    writer := multipart.NewWriter(body)\n\n    // JSON Metadata (part-1)\n    jsonMetadata := textproto.MIMEHeader{}\n    metadata := `{\"name\": \"test.png\"}`\n    jsonMetadata.Set(\"Content-Type\", \"application/json\")\n    part, _ := writer.CreatePart(jsonMetadata)\n    part.Write([]byte(metadata))\n\n    // Image bytes (part-2)\n    imageData := textproto.MIMEHeader{}\n    partAttach, _ := writer.CreatePart(imageData)\n    io.Copy(partAttach, bytes.NewReader(mediaData))\n    writer.Close()\n\n    // Request Content Type with boundary\n    contentType := fmt.Sprintf(\"multipart/related; boundary=%s\", writer.Boundary())\n\n    // HTTP Request with auth and content type headers\n    req, _ := http.NewRequest(http.MethodPost, \"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart\", bytes.NewReader(body.Bytes()))\n    req.Header.Add(\"Authorization\", \"Bearer \"+accessToken)\n    req.Header.Add(\"Content-Type\", contentType)\n\n    // Send request\n    resp, err := client.Do(req)\n    if err != nil {\n        log.Fatalf(\"failed to send request: %v\", err)\n    }\n    defer resp.Body.Close()\n    content, _ := ioutil.ReadAll(resp.Body)\n\n    log.Printf(\"http status: %d\", resp.StatusCode)\n    log.Printf(\"response: %s\", string(content))\n}\n</code></pre>\n\n<p>Reference: <a href=\"https://developers.google.com/drive/api/v3/manage-uploads?authuser=1#send_a_multipart_upload_request\" rel=\"nofollow noreferrer\">https://developers.google.com/drive/api/v3/manage-uploads?authuser=1#send_a_multipart_upload_request</a></p>\n"}], "owner": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "accepted_answer_id": 55577253, "answer_count": 1, "score": 1, "last_activity_date": 1554738629, "creation_date": 1554734663, "question_id": 55576032, "link": "https://stackoverflow.com/questions/55576032/sending-file-to-google-drive-api-from-golang-code-yields-error-unsupported-cont", "title": "Sending file to Google drive API from golang code yields error: Unsupported content with type: image/jpeg", "body": "<p>based on the Google Drive API <a href=\"https://developers.google.com/drive/api/v3/reference/files/create\" rel=\"nofollow noreferrer\">docs</a> the proper way of uploading a file is:</p>\n\n<p><code>curl -v -H 'Authorization: Bearer mytoken'  -F 'metadata={\"name\": \"test3.jpeg\"};type=application/json' -F file=@jpeg_image.jpeg 'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart'</code></p>\n\n<p>Now, I need to perform the same request from golang code, but I am having a hard time translating this to golang, here is the code I am using after several attempts:</p>\n\n<pre><code>// fileBytes are of type []byte\nbuffer := &amp;bytes.Buffer{}\n    multipartWriter := multipart.NewWriter(buffer)\n    multipartWriter.WriteField(\"metadata\", \"{\\\"name\\\": \\\"test3.jpef\\\"};type=application/json\")\n    partHeader := textproto.MIMEHeader{}\n    partHeader.Add(\"Content-Type\", \"image/jpeg\")\n    filePartWriter, _ := multipartWriter.CreatePart(partHeader)\n    io.Copy(filePartWriter, bytes.NewReader(fileBytes))\n    multipartWriter.Close()\n\n    googleDriveRequest, _ := http.NewRequest(http.MethodPost, \"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart\", buffer)\n    googleDriveRequest.Header.Add(\"Authorization\", \"Bearer \"+accessToken)\n    googleDriveRequest.Header.Add(\"Content-Type\", multipartWriter.FormDataContentType())\n\n    googleDriveAPIResponse, googleDriveAPIError := lib.HttpClient.Do(googleDriveRequest)\n</code></pre>\n\n<p>Using curl the request succeeds :</p>\n\n<pre><code>{\n \"kind\": \"drive#file\",\n \"id\": \"1DwsbQGP3-QtS5p0iQqRtAjcCCsAfxzGD\",\n \"name\": \"test3.jpeg\",\n \"mimeType\": \"image/jpeg\"\n}\n\n</code></pre>\n\n<p>With Golang, I get a 400:</p>\n\n<pre><code>{\\n \\\"error\\\": {\\n  \\\"errors\\\": [\\n   {\\n    \\\"domain\\\": \\\"global\\\",\\n    \\\"reason\\\": \\\"badContent\\\",\\n    \\\"message\\\": \\\"Unsupported content with type: image/jpeg \\\"\\n   }\\n  ],\\n  \\\"code\\\": 400,\\n  \\\"message\\\": \\\"Unsupported content with type: image/jpeg\\\"\\n }\\n}\\n\n</code></pre>\n\n<p>I also tried with different values for <code>partHeader.Add(\"Content-Type\", \"image/jpeg\")</code>, I tried with <code>application/x-www-form-urlencoded</code> as well, I also commented out this line, and let golang do the detection, but still getting the same error. </p>\n\n<p>Any suggestions or ideas? </p>\n\n<p>Regards,</p>\n"}, {"tags": ["xml", "go", "marshalling"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1554728065, "post_id": 55573927, "comment_id": 97846574, "body": "How do you do it currently? Isn&#39;t <code>xml.Encoder()</code> suitable for you?"}, {"owner": {"reputation": 89, "user_id": 9016532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beed93ac48cd8f94c28dd3a9630c5454?s=128&d=identicon&r=PG&f=1", "display_name": "Fishdigger", "link": "https://stackoverflow.com/users/9016532/fishdigger"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1554728208, "post_id": 55573927, "comment_id": 97846685, "body": "Right now, I gather all of the data that should go in the document (4+ GB), marshal it with <code>xml.Marshal</code> and then use <code>ioutil.WriteFile</code>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1554729885, "last_edit_date": 1554729885, "creation_date": 1554729508, "answer_id": 55574411, "question_id": 55573927, "link": "https://stackoverflow.com/questions/55573927/how-to-marshal-a-large-amount-of-data-to-xml/55574411#55574411", "title": "How to marshal a large amount of data to XML", "body": "<p>Use <a href=\"https://golang.org/pkg/encoding/xml/#Encoder\" rel=\"noreferrer\"><code>xml.Encoder</code></a> to stream the XML output to an <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"noreferrer\"><code>io.Writer</code></a> that may be a network connection (<a href=\"https://golang.org/pkg/net/#Conn\" rel=\"noreferrer\"><code>net.Conn</code></a>) or a file (<a href=\"https://golang.org/pkg/os/#File\" rel=\"noreferrer\"><code>os.File</code></a>). The complete result will not be kept in memory.</p>\n\n<p>You may use <a href=\"https://golang.org/pkg/encoding/xml/#Encoder.Encode\" rel=\"noreferrer\"><code>Encoder.Encode()</code></a> to encode a Go value to XML. Generally you may pass any Go value that you would pass to <a href=\"https://golang.org/pkg/encoding/xml/#Marshal\" rel=\"noreferrer\"><code>xml.Marshal()</code></a>.</p>\n\n<p><code>Encoder.Encode()</code> only helps if the data you want to marshal is ready in-memory, which may or may not be feasible to you. E.g. if you want to marshal a large list which cannot (or should not) be read into memory, this will not be a salvation to you.</p>\n\n<p>If the input data also cannot be held in memory, then you may construct the XML output by tokens and elements. You may use <a href=\"https://golang.org/pkg/encoding/xml/#Encoder.EncodeToken\" rel=\"noreferrer\"><code>Encoder.EncodeToken()</code></a> for this which allows you to write \"parts\" of the result XML document.</p>\n\n<p>For example if you want to write a large list to the output, you may write a start element tag (e.g. <code>&lt;list&gt;</code>), then write the elements of the list one-by-one (each fetched from database or from file, or constructed by an algorithm on-the-fly), and once the list is marshaled, you may close the list element tag (<code>&lt;/list&gt;</code>).</p>\n\n<p>Here's a simple example how you can do that:</p>\n\n<pre><code>type Student struct {\n    ID   int\n    Name string\n}\n\nfunc main() {\n    he := func(err error) {\n        if err != nil {\n            panic(err) // In your app, handle error properly\n        }\n    }\n\n    // For demo purposes we use an in-memory buffer,\n    // but this may be an os.File too.\n    buf := &amp;bytes.Buffer{}\n\n    enc := xml.NewEncoder(buf)\n    enc.Indent(\"\", \"  \")\n\n    he(enc.EncodeToken(xml.StartElement{Name: xml.Name{Local: \"list\"}}))\n    for i := 0; i &lt; 3; i++ {\n        // Here you can fetch / construct the records\n        he(enc.Encode(Student{ID: i, Name: string(i + 'A')}))\n    }\n    he(enc.EncodeToken(xml.EndElement{Name: xml.Name{Local: \"list\"}}))\n    he(enc.Flush())\n\n    fmt.Println(buf.String())\n}\n</code></pre>\n\n<p>Output of the above is (try it on the <a href=\"https://play.golang.org/p/rllhbQyo4I7\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&lt;list&gt;\n  &lt;Student&gt;\n    &lt;ID&gt;0&lt;/ID&gt;\n    &lt;Name&gt;A&lt;/Name&gt;\n  &lt;/Student&gt;\n  &lt;Student&gt;\n    &lt;ID&gt;1&lt;/ID&gt;\n    &lt;Name&gt;B&lt;/Name&gt;\n  &lt;/Student&gt;\n  &lt;Student&gt;\n    &lt;ID&gt;2&lt;/ID&gt;\n    &lt;Name&gt;C&lt;/Name&gt;\n  &lt;/Student&gt;\n&lt;/list&gt;\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 9016532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/beed93ac48cd8f94c28dd3a9630c5454?s=128&d=identicon&r=PG&f=1", "display_name": "Fishdigger", "link": "https://stackoverflow.com/users/9016532/fishdigger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "accepted_answer_id": 55574411, "answer_count": 1, "score": 1, "last_activity_date": 1554730599, "creation_date": 1554727875, "last_edit_date": 1554730599, "question_id": 55573927, "link": "https://stackoverflow.com/questions/55573927/how-to-marshal-a-large-amount-of-data-to-xml", "title": "How to marshal a large amount of data to XML", "body": "<p>I need to send a large amount of data via XML and my Docker container runs out of memory when performing the task. Is there a way using Go to incrementally marshal a large XML document and also incrementally write it to a file so as to minimize memory usage?</p>\n"}, {"tags": ["database", "go", "go-gorm"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3562771"}, "edited": false, "score": 0, "creation_date": 1554727952, "post_id": 55573831, "comment_id": 97846482, "body": "I was thinking on this problem since yesterday and I found the problem just now. I just forgot to define var comment as an array"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3562771"}, "edited": false, "score": 0, "creation_date": 1554728092, "post_id": 55573831, "comment_id": 97846601, "body": "if administrator wants to delete my question, they can. but I&#39;m pretty sure this question is useful for another programmer."}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1554729522, "post_id": 55573831, "comment_id": 97847544, "body": "There are quite a few issues with your code. The one related to your question is that you are not passing a slice to gorm and expecting a slice in return, this can&#39;t happen. You would need to change <code>var comments Comment</code> to <code>var comments []Comment</code>. Notice the slice <code>[]</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1554731778, "post_id": 55573831, "comment_id": 97849070, "body": "This will probably be closed. If you want to try to keep it open for the benefit of future users, you should provide an answer. Comments will generally be deleted over time."}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1554796536, "post_id": 55573831, "comment_id": 97872571, "body": "@Flimzy I didn&#39;t know that comments are generally deleted over time!! Thanks!"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user3562771"}, "is_accepted": false, "score": 0, "last_activity_date": 1554742538, "creation_date": 1554742538, "answer_id": 55578244, "question_id": 55573831, "link": "https://stackoverflow.com/questions/55573831/gorm-returns-just-one-instead-of-multiple-results/55578244#55578244", "title": "Gorm returns just one instead of multiple results", "body": "<p>I was thinking on this problem since yesterday and I found the problem just now. I just forgot to define var comment as an array.</p>\n\n<p>\"The one related to your question is that you are not passing a slice to gorm and expecting a slice in return. change var comments Comment to var comments []Comment. Notice the slice []\" <a href=\"https://stackoverflow.com/users/5198756/abdullah\">Abdullah</a> said</p>\n\n<pre><code>var comments Comment\n</code></pre>\n\n<p>to</p>\n\n<pre><code>var comments []Comment\n</code></pre>\n\n<p>thanks to <a href=\"https://stackoverflow.com/users/5198756/abdullah\">Abdullah</a></p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3562771"}, "edited": false, "score": 0, "creation_date": 1554799832, "post_id": 55587705, "comment_id": 97874387, "body": "Abdullah can you give me more example of gorm many 2 many? i read all the documentation but in documentation has not enough example to understand well. <a href=\"https://stackoverflow.com/questions/55586141/gorm-package-for-has-many-or-many-to-many-relationship-in-one-table\" title=\"gorm package for has many or many to many relationship in one table\">stackoverflow.com/questions/55586141/&hellip;</a> this is my another question... I try to never ask a question in stackoverflow because of negative rate but i have to... and this is my email if you want to send me an example of gorm email: sadeghsadegh21@gmail.com"}], "tags": [], "owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "is_accepted": true, "score": 2, "last_activity_date": 1554796492, "creation_date": 1554796492, "answer_id": 55587705, "question_id": 55573831, "link": "https://stackoverflow.com/questions/55573831/gorm-returns-just-one-instead-of-multiple-results/55587705#55587705", "title": "Gorm returns just one instead of multiple results", "body": "<p>There quite a few issues in the attached snippet, will tackle them one by one:</p>\n\n<h3>#1</h3>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Post struct {\n    gorm.Model\n    Title    string\n    Text     string\n    Comments []Comment\n}\n\ntype Comment struct {\n    gorm.Model\n    Text   string\n    PostID uint `gorm:\"foreignkey:ID;association_foreignkey:PostID\"`\n}\n</code></pre>\n\n<p>Here, the assignments of the foreign key <code>foreignkey:ID</code> as well as the association foreign key are both unnecessary <strong>and misplaced</strong>.</p>\n\n<p>For the <a href=\"http://gorm.io/docs/has_many.html#Foreign-Key\" rel=\"nofollow noreferrer\">Foreign Key</a>: By default, gorm uses the owner\u2019s type name plus the name of its primary key field. In your case: <code>PostID</code>.</p>\n\n<ul>\n<li><code>Post</code> is the <em>the owner\u2019s type name</em></li>\n<li><code>ID</code> is <em>its primary key</em>.</li>\n</ul>\n\n<p>You would only need to use the <code>forignkey</code> tag if you want to change the name of the feild in the <code>Comment</code> struct. For example, <code>PostNumber</code> instead of <code>PostID</code>. So you would need to add a tag with <code>foreignkey:PostNumber</code> and change the PostID in <code>Comment</code> to <code>PostNumber</code>.</p>\n\n<p>For the <a href=\"http://gorm.io/docs/has_many.html#Association-ForeignKey\" rel=\"nofollow noreferrer\">Association ForeignKey</a>, It's used if you want to tell gorm to use a different member other than the owner's primary key. For example, <code>AnotherID</code> in the below example.</p>\n\n<p>Another problem would be that you should specify these tags on the <code>has many</code> fields and not the foreign key itself. A complete example would look like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Post struct {\n    gorm.Model\n    AnotherID uint     &lt;-------------------------------------------------------\n    Title     string                                                           |\n    Text      string                                                           |\n    Comments  []Comment `gorm:\"foreignkey:PostNumber;association_foreignkey:AnotherID\"`\n}                                             |\n                                              |\ntype Comment struct {                         |\n    gorm.Model                                |\n    Text       string                         |\n    PostNumber uint    &lt;----------------------\n}\n</code></pre>\n\n<p><em>Note that these two have to have the same type.</em></p>\n\n<hr>\n\n<h3>#2</h3>\n\n<p>One can argue about the usage of <code>defer db.Close()</code>. From the <a href=\"https://golang.org/pkg/database/sql/#DB.Close\" rel=\"nofollow noreferrer\">docs</a>, </p>\n\n<blockquote>\n  <p>It is rare to Close a DB, as the DB handle is meant to be long-lived and shared between many goroutines.</p>\n</blockquote>\n\n<p>In this example, it's fine to <code>defer</code> the closing of the database. Though, it will happen automatically if you don't call it. The main reason why I am commenting about it is to tell you that in big applications, you don't need to do that with each connection. It's safe to just call <code>sql.Open()</code> on a global variable and use it without the need to <code>db.Close()</code>.</p>\n\n<p>In this case, you also don't want it to open as many connections as it pleases so you might want to fine tune the following parameters:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>db.DB().SetConnMaxLifetime(X) // sets the maximum amount of time a connection may be reused.\ndb.DB().SetMaxIdleConns(X) // sets the maximum number of connections in the idle connection pool.\ndb.DB().SetMaxOpenConns(X) // sets the maximum number of open connections to the database.\n</code></pre>\n\n<p><em>See <a href=\"https://github.com/go-sql-driver/mysql/issues/461\" rel=\"nofollow noreferrer\">this</a> discussion for more information.</em></p>\n\n<hr>\n\n<h3>#3</h3>\n\n<p>The below calls <strong>can</strong> fail:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>db.DropTableIfExists(&amp;Post{}, &amp;Comment{})\n\ndb.AutoMigrate(&amp;Post{}, &amp;Comment{})\n\ndb.Create(&amp;Post{Title: \"test1 title\", Text: \"text1\"})\n</code></pre>\n\n<p>So, <strong>ALWAYS</strong> check for errors, you can do that with checking the <code>Error</code> member of the <code>gorm.DB</code> struct:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>err = db.DropTableIfExists(&amp;Post{}, &amp;Comment{}).Error\nif err != nil {\n    // handle error\n}\n\nerr = db.AutoMigrate(&amp;Post{}, &amp;Comment{}).Error\n// Check error\n\nerr = db.Create(&amp;Post{Title: \"test1 title\", Text: \"text1\"}).Error\n// Check error\n</code></pre>\n\n<hr>\n\n<h3>#4</h3>\n\n<p>This is <em>the answer to your question</em>: </p>\n\n<p>You are passing not passing a slice of <code>Comment</code> to <code>db.Model(&amp;myPost).Related(&amp;comments)</code> and expecting a slice in return which will not work for obvious reasons, so you would need to change:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var comments Comment\n</code></pre>\n\n<p>to</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var comments []Comment\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3562771"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1816, "favorite_count": 0, "accepted_answer_id": 55587705, "answer_count": 2, "score": 0, "last_activity_date": 1554796492, "creation_date": 1554727531, "last_edit_date": 1554730687, "question_id": 55573831, "link": "https://stackoverflow.com/questions/55573831/gorm-returns-just-one-instead-of-multiple-results", "title": "Gorm returns just one instead of multiple results", "body": "<p>I wrote blow codes and it returns just 1 row instead of 4:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n)\n\ntype Post struct {\n    gorm.Model\n    Title    string\n    Text     string\n    Comments []Comment\n}\n\ntype Comment struct {\n    gorm.Model\n    Text   string\n    PostID uint `gorm:\"foreignkey:ID;association_foreignkey:PostID\"`\n}\n\nfunc main() {\n    db, err := gorm.Open(\"sqlite3\", \"test.db\")\n    if err != nil {\n        panic(\"failed to connect to database\")\n    }\n    defer db.Close()\n\n    db.DropTableIfExists(&amp;Post{}, &amp;Comment{})\n    db.AutoMigrate(&amp;Post{}, &amp;Comment{})\n\n    // fill db\n    db.Create(&amp;Post{Title: \"test1 title\", Text: \"text1\"})\n    db.Create(&amp;Post{Title: \"test2 title\", Text: \"text2\"})\n    db.Create(&amp;Post{Title: \"test3 title\", Text: \"text3\"})\n    db.Create(&amp;Comment{Text: \"test1 comment1\", PostID: 3})\n    db.Create(&amp;Comment{Text: \"test2 comment1\", PostID: 2})\n    db.Create(&amp;Comment{Text: \"test3 comment2\", PostID: 2})\n    db.Create(&amp;Comment{Text: \"test4 comment3\", PostID: 2})\n    db.Create(&amp;Comment{Text: \"test5 comment4\", PostID: 2})\n    db.Create(&amp;Comment{Text: \"test6 comment1\", PostID: 1})\n    //end fill db\n\n    var myPost Post\n    var comments Comment\n    db.First(&amp;myPost, 2)\n    db.Model(&amp;myPost).Related(&amp;comments)\n\n    fmt.Println(myPost)\n    fmt.Println(comments)\n}\n</code></pre>\n\n<p>and this is my output: </p>\n\n<pre><code>{{2 2019-04-08 17:04:20.3781288 +0430 +0430 2019-04-08 17:04:20.3781288 +0430 +0430 &lt;nil&gt;} test2 title text2 []}\n{{5 2019-04-08 17:04:20.4091133 +0430 +0430 2019-04-08 17:04:20.4091133 +0430 +0430 &lt;nil&gt;} test5 comment4 2}\n</code></pre>\n\n<p>you can see just one row: </p>\n\n<pre><code>test5 comment4 \n</code></pre>\n\n<p>and I expect this result:</p>\n\n<pre><code>test2 comment1\ntest3 comment2\ntest4 comment3\ntest5 comment4\n</code></pre>\n\n<p>What should I do to get 4 rows result?</p>\n\n<p>I already read all the documentation of gorm. and this example of doc is not working for me as I expect\n<a href=\"http://doc.gorm.io/associations.html#has-many\" rel=\"nofollow noreferrer\">http://doc.gorm.io/associations.html#has-many</a></p>\n\n<pre><code>Has Many\n// User has many emails, UserID is the foreign key\ntype User struct {\n    gorm.Model\n    Emails   []Email\n}\n\ntype Email struct {\n    gorm.Model\n    Email   string\n    UserID  uint\n}\n\ndb.Model(&amp;user).Related(&amp;emails)\n//// SELECT * FROM emails WHERE user_id = 111; // 111 is user's primary key\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "webhooks", "patch"], "answers": [{"comments": [{"owner": {"reputation": 22448, "user_id": 1870481, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/478e3c60bf48e069b2f79bddd202d600?s=128&d=identicon&r=PG", "display_name": "michas", "link": "https://stackoverflow.com/users/1870481/michas"}, "edited": false, "score": 1, "creation_date": 1554739988, "post_id": 55575415, "comment_id": 97853980, "body": "Oh, great. Thanks a lot! I was not aware of JSON Pointers, yet. Adding the class this way will probably only work if the annotation object is already present. - Seems like I have to handle both cases separately."}], "tags": [], "owner": {"reputation": 351, "user_id": 1774646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e594c1d84998cb4cdfe7008014788201?s=128&d=identicon&r=PG", "display_name": "abvarun226", "link": "https://stackoverflow.com/users/1774646/abvarun226"}, "is_accepted": true, "score": 13, "last_activity_date": 1554732600, "creation_date": 1554732600, "answer_id": 55575415, "question_id": 55573724, "link": "https://stackoverflow.com/questions/55573724/create-a-patch-to-add-a-kubernetes-annotation/55575415#55575415", "title": "Create a patch to add a kubernetes annotation", "body": "<p>Replace the forward slash (<code>/</code>) in <code>kubernetes.io/ingress.class</code> with <code>~1</code>.</p>\n\n<p>Your command should look like this,</p>\n\n<pre><code>$ kubectl patch ingress mying --type='json' -p='[{\"op\": \"add\", \"path\": \"/metadata/annotations/kubernetes.io~1ingress.class\", \"value\":\"nginx\"}]'\n</code></pre>\n\n<p>Reference:\nRFC 6901 <a href=\"https://tools.ietf.org/html/rfc6901#section-3\" rel=\"noreferrer\">https://tools.ietf.org/html/rfc6901#section-3</a></p>\n"}, {"comments": [{"owner": {"reputation": 190, "user_id": 5504758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a0db81d2fd6bea68871e05b975d041b?s=128&d=identicon&r=PG&f=1", "display_name": "nakamume", "link": "https://stackoverflow.com/users/5504758/nakamume"}, "edited": false, "score": 1, "creation_date": 1604542806, "post_id": 60402927, "comment_id": 114381065, "body": "<code>kubectl annotate</code> is nice utility. But please note that OP explicitly mentioned that they are aware of this and it&#39;s not working for their use case"}, {"owner": {"reputation": 3629, "user_id": 10589890, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3zRNJ.png?s=128&g=1", "display_name": "Efrat Levitan", "link": "https://stackoverflow.com/users/10589890/efrat-levitan"}, "reply_to_user": {"reputation": 190, "user_id": 5504758, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a0db81d2fd6bea68871e05b975d041b?s=128&d=identicon&r=PG&f=1", "display_name": "nakamume", "link": "https://stackoverflow.com/users/5504758/nakamume"}, "edited": false, "score": 0, "creation_date": 1604562434, "post_id": 60402927, "comment_id": 114385650, "body": "yeah but it was relevant for a few other people here"}], "tags": [], "owner": {"reputation": 3629, "user_id": 10589890, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3zRNJ.png?s=128&g=1", "display_name": "Efrat Levitan", "link": "https://stackoverflow.com/users/10589890/efrat-levitan"}, "is_accepted": false, "score": 12, "last_activity_date": 1582663798, "creation_date": 1582663798, "answer_id": 60402927, "question_id": 55573724, "link": "https://stackoverflow.com/questions/55573724/create-a-patch-to-add-a-kubernetes-annotation/60402927#60402927", "title": "Create a patch to add a kubernetes annotation", "body": "<p>much easier for me was to <code>annotate</code> rather than <code>patch</code>:</p>\n\n<pre><code>kubectl annotate ingress mying kubernetes.io/ingress.class=value\n</code></pre>\n\n<p>add <code>--dry-run -o yaml</code> flags if you want to test it before applying the change.</p>\n"}, {"tags": [], "owner": {"reputation": 13460, "user_id": 110333, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/59436ecd4fe6ad7c34f67654d839f05f?s=128&d=identicon&r=PG", "display_name": "grosser", "link": "https://stackoverflow.com/users/110333/grosser"}, "is_accepted": false, "score": 0, "last_activity_date": 1588255103, "last_edit_date": 1588255103, "creation_date": 1588209170, "answer_id": 61514294, "question_id": 55573724, "link": "https://stackoverflow.com/questions/55573724/create-a-patch-to-add-a-kubernetes-annotation/61514294#61514294", "title": "Create a patch to add a kubernetes annotation", "body": "<p>Using just:</p>\n\n<pre><code>[{\"op\": \"add\", \"path\": \"/metadata/annotations/kubernetes.io~1ingress.class\", \"value\":\"nginx\"}]\n</code></pre>\n\n<p>does not work when the created pod has no annotations, for example when coming from <code>kubectl run --generator=run-pod/v1 --attach test-deploy --image=busybox ls</code></p>\n\n<p>To detect this you need a separate parsing step into a metadata with pointer annotation so it can be detected as nil, or always send an empty annotation when it's empty:</p>\n\n<pre><code>type Metadata struct {\n    Annotations  *map[string]string\n}\n\ntype ObjectWithMeta struct {\n    Metadata Metadata\n}\n</code></pre>\n\n<p>then send:</p>\n\n<pre><code>[\n  {\"op\":\"add\",\"path\":\"/metadata/annotations\",\"value\":{}},\n  {\"op\":\"add\",\"path\":\"/metadata/annotations/foo\",\"value\": \"bar\"}\n]\n</code></pre>\n"}], "owner": {"reputation": 22448, "user_id": 1870481, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/478e3c60bf48e069b2f79bddd202d600?s=128&d=identicon&r=PG", "display_name": "michas", "link": "https://stackoverflow.com/users/1870481/michas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5283, "favorite_count": 0, "accepted_answer_id": 55575415, "answer_count": 3, "score": 6, "last_activity_date": 1588255103, "creation_date": 1554727168, "question_id": 55573724, "link": "https://stackoverflow.com/questions/55573724/create-a-patch-to-add-a-kubernetes-annotation", "title": "Create a patch to add a kubernetes annotation", "body": "<p>I would like to write an <a href=\"https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#mutatingadmissionwebhook\" rel=\"noreferrer\">mutating webhook</a> to add a default ingress class to all ingress object, that do not explicitly provide one.</p>\n\n<p>According to the <a href=\"https://github.com/kubernetes/kubernetes/blob/master/test/images/webhook/addlabel.go#L29\" rel=\"noreferrer\">examples</a> I found I need to provide a proper json patch for the webhook to return.</p>\n\n<p>I first tried my patches using kubectl:</p>\n\n<pre><code>$ kubectl patch ingress mying --type='json' -p='[{\"op\": \"add\", \"path\": \"/metadata/annotations/key\", \"value\":\"value\"}]'\nThe  \"\" is invalid\n</code></pre>\n\n<p>Looks like this is not working when there is not already an annotations element present.</p>\n\n<pre><code>$ kubectl patch ingress mying --type='json' -p='[{\"op\": \"add\", \"path\": \"/metadata/annotations\", \"value\":{\"key\":\"value\"}}]'\ningress.extensions/kafka-monitoring-topics-ui patched\n</code></pre>\n\n<p>Creating the complete annotations element works fine, however in my case I need a key of <code>kubernetes.io/ingress.class</code> which contains a slash.</p>\n\n<pre><code>kubectl patch ingress mying --type='json' -p='[{\"op\": \"add\", \"path\": \"/metadata/annotations\", \"value\":{\"kubernetes.io/ingress.class\":\"value\"}}]'\ningress.extensions/kafka-monitoring-topics-ui patched\n</code></pre>\n\n<p>This works fine when creating the annotation object. However, if there is already a some annotation present and I simply want to <em>add</em> one, it seems to be impossible to add one.</p>\n\n<p>Simply using <code>[{\"op\": \"add\", \"path\": \"/metadata/annotations\", \"value\":{\"kubernetes.io/ingress.class\":\"value\"}}]</code> removes all existing annotation, while something like <code>'[{\"op\": \"add\", \"path\": \"/metadata/annotations/kubernetes.io/ingress.class\", \"value\": \"value\"}]</code> does not work because of the contained slash.</p>\n\n<p><strong>Long story short: What is the correct way to simply add a ingress class using a proper patch?</strong></p>\n\n<p>PS: Yes, I am aware of <code>kubectl annotate</code>, but unfortunately that does not help with my webhook.</p>\n"}, {"tags": ["go", "leveldb"], "comments": [{"owner": {"reputation": 1263, "user_id": 7099984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb73d10a9ce4b91379b514722601f9ee?s=128&d=identicon&r=PG&f=1", "display_name": "myxaxa", "link": "https://stackoverflow.com/users/7099984/myxaxa"}, "edited": false, "score": 0, "creation_date": 1554725373, "post_id": 55572573, "comment_id": 97844862, "body": "pls explain what is not understood. package should be installed as written here - <a href=\"https://github.com/DataDog/leveldb\" rel=\"nofollow noreferrer\">github.com/DataDog/leveldb</a>"}, {"owner": {"reputation": 15, "user_id": 4394183, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001289082499/picture?type=large", "display_name": "Alaa Radwan", "link": "https://stackoverflow.com/users/4394183/alaa-radwan"}, "reply_to_user": {"reputation": 1263, "user_id": 7099984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb73d10a9ce4b91379b514722601f9ee?s=128&d=identicon&r=PG&f=1", "display_name": "myxaxa", "link": "https://stackoverflow.com/users/7099984/myxaxa"}, "edited": false, "score": 0, "creation_date": 1554726444, "post_id": 55572573, "comment_id": 97845559, "body": "I want a code example ... something that is simple to understand"}, {"owner": {"reputation": 15, "user_id": 4394183, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001289082499/picture?type=large", "display_name": "Alaa Radwan", "link": "https://stackoverflow.com/users/4394183/alaa-radwan"}, "reply_to_user": {"reputation": 1263, "user_id": 7099984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb73d10a9ce4b91379b514722601f9ee?s=128&d=identicon&r=PG&f=1", "display_name": "myxaxa", "link": "https://stackoverflow.com/users/7099984/myxaxa"}, "edited": false, "score": 0, "creation_date": 1554726730, "post_id": 55572573, "comment_id": 97845735, "body": "thank you for the link I think my problem is that I am using this package github.com/syndtr/goleveldb/leveldb instead of your link"}, {"owner": {"reputation": 1263, "user_id": 7099984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb73d10a9ce4b91379b514722601f9ee?s=128&d=identicon&r=PG&f=1", "display_name": "myxaxa", "link": "https://stackoverflow.com/users/7099984/myxaxa"}, "edited": false, "score": 0, "creation_date": 1554726893, "post_id": 55572573, "comment_id": 97845838, "body": "use another package:) here you can find an example - <a href=\"https://github.com/jmhodges/levigo/blob/master/leveldb_test.go#L109\" rel=\"nofollow noreferrer\">github.com/jmhodges/levigo/blob/master/leveldb_test.go#L109</a>"}, {"owner": {"reputation": 15, "user_id": 4394183, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001289082499/picture?type=large", "display_name": "Alaa Radwan", "link": "https://stackoverflow.com/users/4394183/alaa-radwan"}, "reply_to_user": {"reputation": 1263, "user_id": 7099984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb73d10a9ce4b91379b514722601f9ee?s=128&d=identicon&r=PG&f=1", "display_name": "myxaxa", "link": "https://stackoverflow.com/users/7099984/myxaxa"}, "edited": false, "score": 1, "creation_date": 1554727883, "post_id": 55572573, "comment_id": 97846444, "body": "this sounds helpful thank you :)"}], "answers": [{"tags": [], "owner": {"reputation": 161, "user_id": 11339140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_oZaOqfxYFI/AAAAAAAAAAI/AAAAAAAAADw/o9Jcv0YYArU/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0444\u043e\u0440 \u0421\u0435\u0440\u044f\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/11339140/%d0%9d%d0%b8%d0%ba%d0%b8%d1%84%d0%be%d1%80-%d0%a1%d0%b5%d1%80%d1%8f%d0%ba%d0%be%d0%b2"}, "is_accepted": true, "score": 0, "last_activity_date": 1554979717, "last_edit_date": 1554979717, "creation_date": 1554903470, "answer_id": 55614026, "question_id": 55572573, "link": "https://stackoverflow.com/questions/55572573/how-to-use-seektolast-to-get-last-key-value/55614026#55614026", "title": "How to use SeekToLast to get last key value", "body": "<p>Do you mean <a href=\"https://github.com/syndtr/goleveldb\" rel=\"nofollow noreferrer\">goleveldb</a>?</p>\n\n<p>If so then it will look like</p>\n\n<pre><code>iter := db.NewIterator(nil, nil)\nok := iter.Last()\nif ok {\n    key = iter.Key()\n    value = iter.Value()\n}\niter.Release() // Note: you should first get data and then release iterator\nerr = iter.Error()\n</code></pre>\n\n<p>Or to iterate from the end to the beginning.</p>\n\n<pre><code>iter := db.NewIterator(nil, nil)\nfor ok := iter.Last(); ok; ok = iter.Prev() {\n    // Use key/value.\n    // ...\n}\niter.Release()\nerr = iter.Error()\n</code></pre>\n\n<p>You may also retrieve last key-value with specific prefix, or in general from some range (more details: <a href=\"https://godoc.org/github.com/syndtr/goleveldb/leveldb#DB.NewIterator\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/syndtr/goleveldb/leveldb#DB.NewIterator</a>)</p>\n\n<pre><code>iter := db.NewIterator(util.BytesPrefix([]byte(\"prefix_\")), nil)\n// or\niter := db.NewIterator(util.Range{\n    Start: []byte(\"prefix_03\"),\n    Limit: []byte(\"prefix_04\"),\n}), nil)\n</code></pre>\n\n<p>Does it help?</p>\n"}], "owner": {"reputation": 15, "user_id": 4394183, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001289082499/picture?type=large", "display_name": "Alaa Radwan", "link": "https://stackoverflow.com/users/4394183/alaa-radwan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 628, "favorite_count": 0, "accepted_answer_id": 55614026, "answer_count": 1, "score": -1, "last_activity_date": 1554979717, "creation_date": 1554723455, "last_edit_date": 1554730739, "question_id": 55572573, "link": "https://stackoverflow.com/questions/55572573/how-to-use-seektolast-to-get-last-key-value", "title": "How to use SeekToLast to get last key value", "body": "<p>I want the best performance code to get the last key value in the database. I google this problem and find SeekToLast function but I don't know how to use it.</p>\n"}, {"tags": ["go", "visual-studio-code", "package"], "comments": [{"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1554728054, "post_id": 55572241, "comment_id": 97846566, "body": "Are you using single Workspace? Is it intended to be <code>$HOME&#47;go</code>? If answer is Yes for both, you can clean up <code>$GOPATH</code> env variable and <code>go.gopath</code> in vscode, Go will fall back to <code>$HOME&#47;go</code>. Otherwise check if &quot;go.gopath&quot; is actually the same as <code>$GOPATH</code>, this path looks strange - <code>home&#47;jan&#47;go</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2945, "user_id": 5345715, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f05631812e06e1599ce28b59ed000c?s=128&d=identicon&r=PG&f=1", "display_name": "User12547645", "link": "https://stackoverflow.com/users/5345715/user12547645"}, "edited": false, "score": 0, "creation_date": 1554734175, "post_id": 55574926, "comment_id": 97850618, "body": "Shame on me. That was super obvious"}], "tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": true, "score": 3, "last_activity_date": 1554731156, "creation_date": 1554731156, "answer_id": 55574926, "question_id": 55572241, "link": "https://stackoverflow.com/questions/55572241/unable-to-automatically-install-go-extensions-in-vscode/55574926#55574926", "title": "Unable to automatically install go extensions in vscode", "body": "<p>Your GOPATH is not set correctly in <code>settings.json</code>.</p>\n\n<pre><code>    \"go.gopath\": \"home/jan/go\"\n</code></pre>\n\n<p>This path is relative, and so it would be appended to whatever your working directory is, with the obvious result of not being able to find the path as it won't exist.</p>\n\n<p>You can either set it correctly, or delete it and the GOPATH environment variable will be used. (I run it this way.) </p>\n\n<pre><code>    \"go.gopath\": \"/home/jan/go\"\n</code></pre>\n"}], "owner": {"reputation": 2945, "user_id": 5345715, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/13f05631812e06e1599ce28b59ed000c?s=128&d=identicon&r=PG&f=1", "display_name": "User12547645", "link": "https://stackoverflow.com/users/5345715/user12547645"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2507, "favorite_count": 1, "accepted_answer_id": 55574926, "answer_count": 1, "score": 3, "last_activity_date": 1554731156, "creation_date": 1554722309, "question_id": 55572241, "link": "https://stackoverflow.com/questions/55572241/unable-to-automatically-install-go-extensions-in-vscode", "title": "Unable to automatically install go extensions in vscode", "body": "<p>I am getting started with Go and would like to use Visual Studio Code for editing. I successfully installed go on my Ubuntu Computer. </p>\n\n<p>My <code>GOPATH</code> (go env) is set to the same value as <code>go.gopath</code> in settings.json. If I run <code>Go: Current GOPATH</code> it outputs the correct path. </p>\n\n<p>However, I am not able to install the go extensions. If I click on <code>Install all</code> I get output similar to this: </p>\n\n<pre><code>Installing 1 tool at home/jan/go/bin\n  dlv\n\nInstalling github.com/go-delve/delve/cmd/dlv FAILED\n\n1 tools failed to install.\n\ndlv:\nError: Command failed: /snap/bin/go get -u -v github.com/go-delve/delve/cmd/dlv\n</code></pre>\n\n<p>I seem to be able to just install packages manually with <code>/snap/bin/go get -u -v github.com/go-delve/delve/cmd/dlv</code>. The command runs without errors, but VSCode seems to be unable to find dlv.</p>\n\n<p>My settings.json: </p>\n\n<pre><code>{\n    \"terminal.integrated.rendererType\": \"dom\",\n    \"go.useLanguageServer\": true,\n    \"go.formatTool\": \"gofmt\",\n    \"go.lintOnSave\": \"file\",\n    \"go.vetOnSave\": \"package\",\n    \"go.buildOnSave\": \"package\",\n    \"go.lintTool\": \"golint\",\n    \"go.gopath\": \"home/jan/go\"\n}\n</code></pre>\n\n<p>I have git installed on my computer. It works without a problem.</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 1587, "user_id": 8399980, "user_type": "registered", "profile_image": "https://graph.facebook.com/1494042510683240/picture?type=large", "display_name": "Andrey Berenda", "link": "https://stackoverflow.com/users/8399980/andrey-berenda"}, "edited": false, "score": 0, "creation_date": 1554718253, "post_id": 55570920, "comment_id": 97840770, "body": "Every goroutine run if main programme does not fail"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1554718261, "post_id": 55570920, "comment_id": 97840776, "body": "&quot;How do I know if there is any failure here?&quot; Not at all. The situations in which a goroutine cannot be started are so extreme that you cannot do anything anymore. Even if there would be an indicator that this <code>go</code> failed you would not be able to react to that infomation in any sensible way."}, {"owner": {"reputation": 29, "user_id": 8279851, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acbc2a2b7c6b7621df4cdeb4f6e9d385?s=128&d=identicon&r=PG&f=1", "display_name": "tang mz", "link": "https://stackoverflow.com/users/8279851/tang-mz"}, "edited": false, "score": 0, "creation_date": 1554773991, "post_id": 55570920, "comment_id": 97865797, "body": "I think so too, thank you for answering my doubts."}], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 8279851, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acbc2a2b7c6b7621df4cdeb4f6e9d385?s=128&d=identicon&r=PG&f=1", "display_name": "tang mz", "link": "https://stackoverflow.com/users/8279851/tang-mz"}, "edited": false, "score": 0, "creation_date": 1554776170, "post_id": 55571009, "comment_id": 97866138, "body": "wow~,thank you for you answer.  I read a lot of blogs and didn&#39;t find the answer, but now I understand."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1554718282, "creation_date": 1554718282, "answer_id": 55571009, "question_id": 55570920, "link": "https://stackoverflow.com/questions/55570920/can-initiating-a-goroutine-i-e-calling-go-fail/55571009#55571009", "title": "Can initiating a goroutine (i.e. calling &#39;go&#39;) fail?", "body": "<p>The <a href=\"https://golang.org/ref/spec#Go_statements\" rel=\"nofollow noreferrer\"><code>go</code></a> statement cannot fail (only in \"extreme\" circumstances like out of memory, but then a failing <code>go</code> statement would be the least of your problems).</p>\n\n<p>Of course without synchronization you don't have guarantee when that goroutine is scheduled to run. Your example use of <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a> therefore is incorrect, as if the goroutine is not scheduled until the <code>main</code> goroutine reaches <code>wg.Wait()</code>, it may never even start, as when the <code>main</code> goroutine ends, your program ends as well.</p>\n\n<p>Instead increment the WaitGroup's counter in the main goroutine (and it's best to call <code>WaitGroup.Done()</code> deferred, so it gets called even if the goroutine would panic):</p>\n\n<pre><code>var wg = &amp;sync.WaitGroup{}\nwg.Add(1)\ngo func() {\n    defer wg.Done()\n    fmt.Println(\"halo world\")\n}()\nwg.Wait()\n</code></pre>\n\n<p>That way you don't even need the sleep, <code>wg.Wait()</code> will block until the other goroutine calls <code>wg.Done()</code> (which will happen only when the other goroutine completed its work).</p>\n"}], "owner": {"reputation": 29, "user_id": 8279851, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acbc2a2b7c6b7621df4cdeb4f6e9d385?s=128&d=identicon&r=PG&f=1", "display_name": "tang mz", "link": "https://stackoverflow.com/users/8279851/tang-mz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554719597, "creation_date": 1554717965, "last_edit_date": 1554719597, "question_id": 55570920, "link": "https://stackoverflow.com/questions/55570920/can-initiating-a-goroutine-i-e-calling-go-fail", "title": "Can initiating a goroutine (i.e. calling &#39;go&#39;) fail?", "body": "<p>Is it possible to fail when executing <code>go f</code>?</p>\n\n<p>Since the keyword go has no return value, how to determine whether a goroutine is successfully started during high concurrency?</p>\n\n<p>For Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    var wg = &amp;sync.WaitGroup{}\n    go func() { // How do I know if there is any failure here?\n        wg.Add(1)\n        fmt.Println(\"halo world\")\n        wg.Done()\n    }()\n    time.Sleep(time.Nanosecond)\n    wg.Wait()\n}\n\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1554712361, "post_id": 55569036, "comment_id": 97837417, "body": "No, you should not define those structs. You should read the docs that explain what those structs already are."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1554712365, "post_id": 55569036, "comment_id": 97837419, "body": "&quot;As far as i understand i should define these structs&quot;. No. You seem to get the fundamentals wrong. Start with the Tour of Go (tour.golang.org). Then ask a human coworker who is more experienced with Go."}], "answers": [{"tags": [], "owner": {"reputation": 28834, "user_id": 68115, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/995c83001ff61cbb0041c081ebac9098?s=128&d=identicon&r=PG", "display_name": "grenade", "link": "https://stackoverflow.com/users/68115/grenade"}, "is_accepted": false, "score": 2, "last_activity_date": 1556022427, "creation_date": 1556022427, "answer_id": 55811217, "question_id": 55569036, "link": "https://stackoverflow.com/questions/55569036/how-to-list-running-instances-on-google-cloud-platform-with-go/55811217#55811217", "title": "How to list running instances on Google Cloud Platform with Go", "body": "<p>i had to write something like this today and googling for examples turned up surprisingly little. i've written up what i learned below, however, i'm quite new to golang so maybe smarter people can suggest improvements.</p>\n\n<p>my work in progress is at: <a href=\"https://github.com/grenade/rubberneck\" rel=\"nofollow noreferrer\">https://github.com/grenade/rubberneck</a></p>\n\n<hr>\n\n<p>if you want to run your go program from a development pc that is not on the google compute platform:</p>\n\n<ul>\n<li>set up the gcloud cli to run on your pc (instructions: <a href=\"https://cloud.google.com/sdk/gcloud\" rel=\"nofollow noreferrer\">https://cloud.google.com/sdk/gcloud</a>)</li>\n<li>create a service account for your go application to run under (instructions: <a href=\"https://cloud.google.com/docs/authentication/production#creating_a_service_account\" rel=\"nofollow noreferrer\">https://cloud.google.com/docs/authentication/production#creating_a_service_account</a>)</li>\n<li>grant permissions to the service account (use the same instructions link above)</li>\n<li>create a local key file containing your new service account credentials (use the same instructions link above)</li>\n<li>set the <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable to the path of your local key file</li>\n<li>write your go application. something like this:</li>\n</ul>\n\n<pre><code>package main\n\nimport (\n\n  \"golang.org/x/net/context\"\n  \"google.golang.org/api/compute/v1\"\n  \"golang.org/x/oauth2/google\"\n\n  \"fmt\"\n  \"strings\"\n)\n\nfunc main() {\n  projects := [...]string{\n    \"my-project-one\",\n    \"my-project-two\",\n  }\n  filters := [...]string{\n    \"status = RUNNING\",\n    \"name != my-uninteresting-instance-one\",\n    \"name != my-uninteresting-instance-two\",\n  }\n\n  ctx := context.Background()\n  client, err := google.DefaultClient(ctx,compute.ComputeScope)\n  if err != nil {\n    fmt.Println(err)\n  }\n  computeService, err := compute.New(client)\n  for _, project := range projects {\n    zoneListCall := computeService.Zones.List(project)\n    zoneList, err := zoneListCall.Do()\n    if err != nil {\n      fmt.Println(\"Error\", err)\n    } else {\n      for _, zone := range zoneList.Items {\n        instanceListCall := computeService.Instances.List(project, zone.Name)\n        instanceListCall.Filter(strings.Join(filters[:], \" \"))\n        instanceList, err := instanceListCall.Do()\n        if err != nil {\n          fmt.Println(\"Error\", err)\n        } else {\n          for _, instance := range instanceList.Items {\n            if workerType, isWorker := instance.Labels[\"worker-type\"]; isWorker {\n              m := strings.Split(instance.MachineType, \"/\")\n              fmt.Printf(\"cloud: gcp, zone: %v, name: %v, instance id: %v, machine type: %v, worker type: %v, launch time: %v\\n\",\n                zone.Name,\n                instance.Name,\n                instance.Id,\n                m[len(m)-1],\n                workerType,\n                instance.CreationTimestamp)\n            }\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 5406792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf7e9e9d22024793c841581889905801?s=128&d=identicon&r=PG&f=1", "display_name": "Ozan Temel", "link": "https://stackoverflow.com/users/5406792/ozan-temel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1392, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1556022427, "creation_date": 1554711718, "question_id": 55569036, "link": "https://stackoverflow.com/questions/55569036/how-to-list-running-instances-on-google-cloud-platform-with-go", "title": "How to list running instances on Google Cloud Platform with Go", "body": "<p>I'm trying to learn Go by managing Google Cloud Platform. I didn't understand how to use related functions about Compute. The goal is listing instances with some go code.</p>\n\n<p>This is <a href=\"https://godoc.org/google.golang.org/api/compute/v1#InstancesService.List\" rel=\"nofollow noreferrer\">https://godoc.org/google.golang.org/api/compute/v1#InstancesService.List</a> the related function.</p>\n\n<pre><code>func (r *InstancesService) List(project string, zone string) *InstancesListCall\n</code></pre>\n\n<p>There are two structs, InstancesService and InstancesListCall</p>\n\n<p>As far as i understand i should define these structs but it's not clear the things should be defined in the structs. I've searched for examples but many of them using rest calls instead of golang api. Have any idea how to list instances with go?</p>\n"}, {"tags": ["go", "split"], "comments": [{"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554719434, "post_id": 55568347, "comment_id": 97841425, "body": "You question is unclear , what do you mean by looping the next word ?"}, {"owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "reply_to_user": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554721058, "post_id": 55568347, "comment_id": 97842360, "body": "@MostafaSolati i don&#39;t know how to explain it in words, but basically the code should check each letters in the word one by one, if the letters/some words in the word already appeared,the word would be split. And please do refer to the output for examples"}, {"owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "reply_to_user": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554721971, "post_id": 55568347, "comment_id": 97842860, "body": "@MostafaSolati extra output examples, member,member\u22c5ship, member\u22c5ships, members\u22c5hip"}, {"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554722838, "post_id": 55568347, "comment_id": 97843362, "body": "Why the last one turned to members.hip instead of member.ship ?"}, {"owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "reply_to_user": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554723058, "post_id": 55568347, "comment_id": 97843502, "body": "@MostafaSolati because members is also a word that appears before membership, i forgot to include it after member"}, {"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554723187, "post_id": 55568347, "comment_id": 97843577, "body": "Okay , lets assume there is a members , that should turn to member.s"}, {"owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "reply_to_user": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554723526, "post_id": 55568347, "comment_id": 97843784, "body": "@MostafaSolati yes, thats correct"}, {"owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "reply_to_user": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554723681, "post_id": 55568347, "comment_id": 97843878, "body": "@MostafaSolati member, member.s, member.ship, members.hip"}, {"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554727541, "post_id": 55568347, "comment_id": 97846229, "body": "You are wrong if members splits to members.s then membership cannot split to members.hip because members splitted earlier so it&#39;s not a new word to split new words based on that"}, {"owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "reply_to_user": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554727839, "post_id": 55568347, "comment_id": 97846419, "body": "@MostafaSolati it is not based from the next words, it is based from the entire words in the file, as long as the word already appear, if the next word contains the word, it will be split"}, {"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554728008, "post_id": 55568347, "comment_id": 97846524, "body": "What you want leads to something like this m.e.m.b.e.r.s.h.i.p.s because eventually we have smaller words that contain one or two letters"}, {"owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "reply_to_user": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1554728191, "post_id": 55568347, "comment_id": 97846674, "body": "@MostafaSolati in the file there is no m, e,b,r,s,h,i,p by itself, so m.e.m.b.e.r.s.h.i.p is not possible"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1554728628, "post_id": 55568347, "comment_id": 97846970, "body": "<code>I have a file with a lot of words in it,</code>  says what you have is a generic file but the example you have given clearly follows a pattern . Can you confirm if there are any special order in which words appear in the file or should it work on any random file ?"}, {"owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "reply_to_user": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1554729392, "post_id": 55568347, "comment_id": 97847453, "body": "@SarathSadasivanPillai from a to z, another example i could give is begone, be.gone, beg.one"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1554729589, "post_id": 55568347, "comment_id": 97847595, "body": "@strawberrylatte can you update the question with these examples.  The details are in comments , it would be good to update the question in a manner that the question does not imply assumptions"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1554736473, "post_id": 55568347, "comment_id": 97852015, "body": "@strawberrylatte please check the answer"}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "edited": false, "score": 0, "creation_date": 1554744501, "post_id": 55575743, "comment_id": 97856014, "body": "may i know what this means? cur[:len(prev)] , is the current word length output is similar to previous word length?"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "reply_to_user": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "edited": false, "score": 0, "creation_date": 1554795808, "post_id": 55575743, "comment_id": 97872172, "body": "slice of current word upto the length of prev (here it could be any one of the previous words)"}], "tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": true, "score": 0, "last_activity_date": 1554734050, "last_edit_date": 1554734050, "creation_date": 1554733745, "answer_id": 55575743, "question_id": 55568347, "link": "https://stackoverflow.com/questions/55568347/how-to-segment-split-words-in-file/55575743#55575743", "title": "How to segment/split words in file", "body": "<p>For the given input following would help. </p>\n\n<pre><code>func splitSegmant(prev string, cur string) string {\n    if len(cur) &lt; len(prev) || cur[:len(prev)] != prev {\n        return \"\"\n    }\n    return fmt.Sprintf(\"%s.%s\", cur[:len(prev)], cur[len(prev):])\n}\n\nfunc Split(lines []string) []string {\n    splits := []string{lines[0]}\n    for i := 0; i &lt; len(lines); i++ {\n        for j := 0; j &lt; i; j++ {\n            split := splitSegmant(lines[j], lines[i])\n            if split != \"\" {\n                splits = append(splits, split)\n            }\n        }\n    }\n    return splits\n}\n</code></pre>\n\n<p>you may find working code here : <a href=\"https://play.golang.com/p/E-oDF5APo_t\" rel=\"nofollow noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 55575743, "answer_count": 1, "score": -2, "last_activity_date": 1554734050, "creation_date": 1554708991, "last_edit_date": 1554730508, "question_id": 55568347, "link": "https://stackoverflow.com/questions/55568347/how-to-segment-split-words-in-file", "title": "How to segment/split words in file", "body": "<p>I have a file with a lot of words in it, and i have to split the word that a part of it already existed or appear during the scanning of the file:</p>\n\n<p>Some of the words in the file are</p>\n\n<pre><code>member\nmembers\nmembership\nmemberships\n</code></pre>\n\n<p>I have tried this, but I wanted the first lines[i](which is a) to keep looping the next words</p>\n\n<pre><code>func Split(lines []string) string {\n    for i := 0; i &lt; len(lines)-1; i++ { // position of words\n        j := i + 1\n        fmt.Println(lines[i], lines[j])\n        if strings.ContainsAny(lines[j], lines[i]) {\n            s := strings.Split(dictionary[j], dictionary[i])\n            fmt.Println(dictionary[i], \".\", s)\n        }\n    }\n    ...\n}\n</code></pre>\n\n<p>but it only outputs</p>\n\n<pre><code>member\nmember.s\nmembers.hip\nmembership.s\n</code></pre>\n\n<p>The output that i want:</p>\n\n<pre><code>member\nmember.s\nmember.ship\nmembers.hip\nmember.ships\nmembers.hips\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32481, "user_id": 2270041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cn7rq.jpg?s=128&g=1", "display_name": "Matteo", "link": "https://stackoverflow.com/users/2270041/matteo"}, "edited": false, "score": 0, "creation_date": 1554703078, "post_id": 55567017, "comment_id": 97833112, "body": "How this solution can scale?"}, {"owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "reply_to_user": {"reputation": 32481, "user_id": 2270041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cn7rq.jpg?s=128&g=1", "display_name": "Matteo", "link": "https://stackoverflow.com/users/2270041/matteo"}, "edited": false, "score": 0, "creation_date": 1554703300, "post_id": 55567017, "comment_id": 97833179, "body": "What do you mean scale?"}], "answers": [{"comments": [{"owner": {"reputation": 1416, "user_id": 2424594, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oS1ii.jpg?s=128&g=1", "display_name": "manish", "link": "https://stackoverflow.com/users/2424594/manish"}, "edited": false, "score": 0, "creation_date": 1554703197, "post_id": 55567050, "comment_id": 97833147, "body": "this code isn&#39;t tested, but should work, ideally"}, {"owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "edited": false, "score": 0, "creation_date": 1554703395, "post_id": 55567050, "comment_id": 97833211, "body": "It&#39;s not work ~ http.ListenAndServe should bock and listen . But if I put into go routine this program will finish and exit"}, {"owner": {"reputation": 1416, "user_id": 2424594, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oS1ii.jpg?s=128&g=1", "display_name": "manish", "link": "https://stackoverflow.com/users/2424594/manish"}, "reply_to_user": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "edited": false, "score": 0, "creation_date": 1554704426, "post_id": 55567050, "comment_id": 97833585, "body": "@howie agreed, I edited my answer, added a <code>channel</code>"}], "tags": [], "owner": {"reputation": 1416, "user_id": 2424594, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oS1ii.jpg?s=128&g=1", "display_name": "manish", "link": "https://stackoverflow.com/users/2424594/manish"}, "is_accepted": false, "score": 0, "last_activity_date": 1554704393, "last_edit_date": 1554704393, "creation_date": 1554703154, "answer_id": 55567050, "question_id": 55567017, "link": "https://stackoverflow.com/questions/55567017/how-to-handle-different-port-by-golang-gorilla-mux/55567050#55567050", "title": "How to handle different port by Golang Gorilla mux?", "body": "<p>try <code>go routines</code> :)</p>\n\n<blockquote>\n  <p>Agreed, to <code>wait</code> and <code>listen</code> you can add a <code>channel</code> which will continue to listen infinietly </p>\n</blockquote>\n\n<pre><code>infinite_wait := make(chan string)\n\ngo func(){\n    http.ListenAndServe(\":80\", internal)\n}()\n\ngo func(){\n    http.ListenAndServe(\":8080\", external)\n}() \n\n&lt;-infinite_wait \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "edited": false, "score": 0, "creation_date": 1554703469, "post_id": 55567059, "comment_id": 97833236, "body": "How to prevent exit ? when put http.ListenAndServe into go routine ?"}, {"owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "reply_to_user": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "edited": false, "score": 0, "creation_date": 1554704180, "post_id": 55567059, "comment_id": 97833479, "body": "@howie i mistake. add <code>exit := make(chan bool)</code> for prevent exit."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1554730679, "post_id": 55567059, "comment_id": 97848333, "body": "You can eliminate the code related to the <code>exit</code> channel by calling <code>http.ListenAndServe(&quot;:8080&quot;, external)</code> directly at the end of the function.  Do not ignore the errors returned from <code>http.ListenAndServe</code>.  Do something like: <code>log.Fatal(http.ListenAndServe(&quot;:80&quot;, internal))</code>"}, {"owner": {"reputation": 148157, "user_id": 35364, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/f11512869fe2f8d87a2f2b687b76686c?s=128&d=identicon&r=PG", "display_name": "hasen", "link": "https://stackoverflow.com/users/35364/hasen"}, "edited": false, "score": 1, "creation_date": 1554734686, "post_id": 55567059, "comment_id": 97850915, "body": "No need to wrap the thing in a func. You can just <code>go http.ListenAndServer(&quot;:80&quot;, internal)</code>.  Also, to block exiting you don&#39;t need a fake channel. You can <code>select {}</code>"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 148157, "user_id": 35364, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/f11512869fe2f8d87a2f2b687b76686c?s=128&d=identicon&r=PG", "display_name": "hasen", "link": "https://stackoverflow.com/users/35364/hasen"}, "edited": false, "score": 0, "creation_date": 1554747295, "post_id": 55567059, "comment_id": 97857380, "body": "@hasen added a log.Fatal wrapper to catch common usage errors like &quot;port in use&quot;"}], "tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": true, "score": 4, "last_activity_date": 1554734854, "last_edit_date": 1554734854, "creation_date": 1554703176, "answer_id": 55567059, "question_id": 55567017, "link": "https://stackoverflow.com/questions/55567017/how-to-handle-different-port-by-golang-gorilla-mux/55567059#55567059", "title": "How to handle different port by Golang Gorilla mux?", "body": "<p>Use goroutine.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    package main\n\n    import (\n        \"net/http\"\n\n        \"github.com/gorilla/mux\"\n    )\n\n    func main() {\n\n        internal := mux.NewRouter()\n        external := mux.NewRouter()\n\n        internal.HandleFunc(\"/foo\", logging(foo))\n        internal.HandleFunc(\"/bar\", logging(bar))\n\n        external.HandleFunc(\"/monitor\", monitor())\n\n        go http.ListenAndServe(\":80\", internal)\n\n        go http.ListenAndServe(\":8080\", external)\n\n        select{} // block forever to prevent exiting\n    }\n</code></pre>\n"}], "owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1159, "favorite_count": 0, "closed_date": 1554703590, "accepted_answer_id": 55567059, "answer_count": 2, "score": 1, "last_activity_date": 1554734854, "creation_date": 1554702940, "question_id": 55567017, "link": "https://stackoverflow.com/questions/55567017/how-to-handle-different-port-by-golang-gorilla-mux", "closed_reason": "Duplicate", "title": "How to handle different port by Golang Gorilla mux?", "body": "<p>I try to separate internal use and external use API in different port.</p>\n\n<p>For example external in port 80 , and internal in port 5487. </p>\n\n<p>I use <strong>github.com/gorilla/mux</strong> for url routing.</p>\n\n<p>I try to create two different route</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n\n    internal := mux.NewRouter()\n    external := mux.NewRouter()\n\n    internal.HandleFunc(\"/foo\", logging(foo))\n    internal.HandleFunc(\"/bar\", logging(bar))\n\n    external.HandleFunc(\"/monitor\", monitor())\n\n    http.ListenAndServe(\":80\", internal)\n    http.ListenAndServe(\":8080\", external)\n}\n\n</code></pre>\n\n<p>But it's turn out that the second server is unreachable code.</p>\n\n<p>So how can I create two different port in go ?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["algorithm", "go", "goroutine"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1554699464, "post_id": 55566433, "comment_id": 97832044, "body": "It&#39;s terminal emulator specific, not really a Go programming question."}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 3, "creation_date": 1554705179, "post_id": 55566433, "comment_id": 97833885, "body": "you would need to clear &amp; rewrite if you want to append to a previously written line."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 2, "creation_date": 1554706354, "post_id": 55566433, "comment_id": 97834399, "body": "Regarding the random order, the rand.Seed(...) is intended to be called once, with a non constant value. Typically the current time is suitable as the time advances on most environments, but the playground always starts at the same moment in time (so it is always predictable). Move rand.Seed(..) to the top of main()."}], "answers": [{"tags": [], "owner": {"reputation": 1226, "user_id": 1716905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf004baf04689322a8766ebc1efd5e07?s=128&d=identicon&r=PG&f=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/1716905/luke"}, "is_accepted": false, "score": 1, "last_activity_date": 1554732071, "creation_date": 1554732071, "answer_id": 55575228, "question_id": 55566433, "link": "https://stackoverflow.com/questions/55566433/print-multiple-rows-in-parallel-golang/55575228#55575228", "title": "Print multiple rows in parallel Golang", "body": "<p>you may want to check out <a href=\"https://stackoverflow.com/a/36592553/1716905\">this stackoverflow answer</a> which uses <a href=\"https://github.com/buger/goterm\" rel=\"nofollow noreferrer\">goterm</a> to move the terminal cursor and allow you to overwrite part of it.</p>\n\n<p>The idea is that once you get to the terminal bit you want to be \"dynamic\" (much like a videogame screen clear+redraw), you always reposition the cursor and \"draw\" your \"horses\" position.</p>\n\n<p>Note that with this you will need to store their positions somewhere, to then \"draw\" their positions at each \"frame\".</p>\n\n<p>With this exercise you are getting close to how video games work, and for this you may want to set up a goroutine with a given refresh rate to clear your terminal and render what you want.</p>\n"}], "owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1554732071, "creation_date": 1554699021, "last_edit_date": 1554703387, "question_id": 55566433, "link": "https://stackoverflow.com/questions/55566433/print-multiple-rows-in-parallel-golang", "title": "Print multiple rows in parallel Golang", "body": "<p>I am attempting to write a horse race simulator with multiple rows. \nEach row will represent one horse location calculated by a goroutine.</p>\n\n<p>For some reason the code, when run on the Go Playground, does not output the numbers randomly as happens on my machine.</p>\n\n<pre><code>package main\n\nimport (\n    \"math/rand\"\n    \"os\"\n    \"strconv\"\n    \"time\"\n)\n\nvar counter = 0\n\nfunc main() {\n    i := 1\n    horses := 9\n    for i &lt;= horses {\n        go run(i)\n        i++\n    }\n    time.Sleep(5000 * time.Millisecond)\n    print(\"\\ncounter: \" + strconv.Itoa(counter))\n    print(\"\\nEnd of main()\")\n}\n\nfunc run(number int) {\n    var i = 1\n    var steps = 5\n    for i &lt;= steps {\n        print(\"[\" + strconv.Itoa(number) + \"]\")\n        rand.Seed(time.Now().UnixNano())\n        sleep := rand.Intn(10)\n        time.Sleep(time.Duration(sleep) * time.Millisecond)\n        i++\n        counter++\n    }\n    if i == steps {\n        println(strconv.Itoa(number) + \" wins\")\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/pycZ4EdH7SQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pycZ4EdH7SQ</a></p>\n\n<p>My output unordered is:</p>\n\n<pre><code>[1][5][8][2][3][4][7][9][6][7][9][9][4][3]...\n</code></pre>\n\n<p>But my question is how would I go about to print the numbers like:</p>\n\n<pre><code>[1][1]\n[2][2][2][2][2][2][2][2]\n[3][3][3]\n...\n[N][N][N][N][N]\n</code></pre>\n"}, {"tags": ["go", "graphql"], "answers": [{"comments": [{"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1554689690, "post_id": 55564856, "comment_id": 97830320, "body": "I actually already tried it too earlier, but its giving another error. I&#39;ll update my question."}], "tags": [], "owner": {"reputation": 56993, "user_id": 6024220, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6s3nUiQ9-fI/AAAAAAAAAAI/AAAAAAAAA0E/3zpg3zXHu4I/photo.jpg?sz=128", "display_name": "Daniel Rearden", "link": "https://stackoverflow.com/users/6024220/daniel-rearden"}, "is_accepted": true, "score": 9, "last_activity_date": 1554688982, "last_edit_date": 1554688982, "creation_date": 1554682984, "answer_id": 55564856, "question_id": 55564703, "link": "https://stackoverflow.com/questions/55564703/passing-variables-with-graphql-using-a-http-client/55564856#55564856", "title": "Passing variables with graphql using a http client", "body": "<p>You can't use variables when you set the Content Type to <code>application/graphql</code> because the entire request body is treated as a single GraphQL document. Variables cannot be included inside a GraphQL document -- they have to be submitted separately. Instead of using <code>application/graphql</code>, you should use <code>application/json</code> as the Content Type. Then, your request body should be a JSON string with two keys -- <code>query</code> and <code>variables</code>:</p>\n\n<pre><code>{\n  \"query\": \"mutation ($checkoutId: ID!, $lineItems: [CheckoutLineItemInput!]!) {...}\",\n  \"variables\": {\n    \"checkoutId\" \"\",\n    \"lineItems\": [\n      ...\n    ]\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1126, "favorite_count": 1, "accepted_answer_id": 55564856, "answer_count": 1, "score": 2, "last_activity_date": 1554723715, "creation_date": 1554681410, "last_edit_date": 1554723715, "question_id": 55564703, "link": "https://stackoverflow.com/questions/55564703/passing-variables-with-graphql-using-a-http-client", "title": "Passing variables with graphql using a http client", "body": "<p>I'm trying to interface with shopify storefront api in golang. But this is my first encounter with graphql and I'm a bit confused.</p>\n\n<p>I need to pass variables for the request and did some research where I came to the conclusion that I could pass variables like shown below. But shopify keeps returning this error:</p>\n\n<pre><code>{\"errors\":[{\"message\":\"Parse error on \\\"variables\\\" (IDENTIFIER) at [13, 3]\",\"locations\":[{\"line\":13,\"column\":3}]}]}\n</code></pre>\n\n<p>Here is my current code:</p>\n\n<pre><code>body := strings.NewReader(fmt.Sprintf(`\n    mutation ($checkoutId: ID!, $lineItems: [CheckoutLineItemInput!]!) {\n        checkoutLineItemsAdd(checkoutId: $checkoutId, lineItems: $lineItems) {\n          userErrors {\n            message\n            field\n          }\n          checkout {\n            id\n          }\n        }\n      }\n    variables: { \"lineItems\": [ { \"quantity\": 1, \"variantId\": \"%s\" } ], \"checkoutId\": \"%s\" }\n`, productID, checkoutID))\n\nreq, err := http.NewRequest(\"POST\", \"https://myshop.myshopify.com/api/graphql\", body)\nif err != nil {\n    // handle err\n    fmt.Println(err)\n}\nreq.Header.Set(\"Content-Type\", \"application/graphql\")\nreq.Header.Set(\"X-Shopify-Storefront-Access-Token\", \"mytoken\")\n\nresp, err := http.DefaultClient.Do(req)\nif err != nil {\n    // handle err\n    fmt.Println(err)\n}\ndefer resp.Body.Close()\n\ndata, err := ioutil.ReadAll(resp.Body)\nif err != nil {\n    // handle err\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>My question is, what is the correct way of passing variables when using <code>application/graphql</code>?</p>\n\n<hr>\n\n<p>After updating the code with the answer of @DanielRearden I'm now getting this error:</p>\n\n<pre><code>{\"errors\":[{\"message\":\"Variable checkoutId of type ID! was provided invalid value\",\"locations\":[{\"line\":1,\"column\":11}],\"extensions\":{\"value\":null,\"problems\":[{\"path\":[],\"explanation\":\"Expected value to not be null\"}]}},{\"message\":\"Variable lineItems of type [CheckoutLineItemInput!]! was provided invalid value\",\"locations\":[{\"line\":1,\"column\":29}],\"extensions\":{\"value\":null,\"problems\":[{\"path\":[],\"explanation\":\"Expected value to not be null\"}]}}]}\n</code></pre>\n\n<p>Updated code:</p>\n\n<pre><code>    body := strings.NewReader(fmt.Sprintf(`{\n        \"query\": \"mutation ($checkoutId: ID!, $lineItems: [CheckoutLineItemInput!]!) { checkoutLineItemsAdd(checkoutId: $checkoutId, lineItems: $lineItems) { userErrors { message field } checkout { id } }}\",\n        \"variables\": { \n            \"$lineItems\": [ \n                { \"quantity\": 1, \"variantId\": \"%s\" }\n            ], \n            \"$checkoutId\": \"%s\"\n        }\n    }`, productID, checkoutID))\n    ...\n    ...\n    req.Header.Set(\"Content-Type\", \"application/json\")\n</code></pre>\n\n<hr>\n\n<p>Removing the <code>$</code> token on the variables as shown below returns another error:</p>\n\n<pre><code>{\n        \"query\": \"mutation ($checkoutId: ID!, $lineItems: [CheckoutLineItemInput!]!) { checkoutLineItemsAdd(checkoutId: $checkoutId, lineItems: $lineItems) { userErrors { message field } checkout { id } }}\",\n        \"variables\": { \n            \"checkoutId\": \"%s\",\n            \"lineItems\": [ \n                { \"quantity\": 1, \"variantId\": \"%s\" }\n            ]\n        }\n    }\n</code></pre>\n\n<p>And the error is: (status 500)</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n  &lt;meta charset=\"utf-8\" /&gt;\n  &lt;meta name=\"referrer\" content=\"never\" /&gt;\n  &lt;title&gt;Something went wrong&lt;/title&gt;\n</code></pre>\n\n<p>But I guess this is not a graphql issue anymore but more of a shopify api problem. </p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 728, "user_id": 4156868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tsaT7.jpg?s=128&g=1", "display_name": "sumedhe", "link": "https://stackoverflow.com/users/4156868/sumedhe"}, "edited": false, "score": 4, "creation_date": 1556543157, "post_id": 55565491, "comment_id": 98463645, "body": "How can we update the whole <code>movie</code> field without mentioning each field in update document?"}, {"owner": {"reputation": 1732, "user_id": 646553, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/juIlb.jpg?s=128&g=1", "display_name": "shontauro", "link": "https://stackoverflow.com/users/646553/shontauro"}, "edited": false, "score": 1, "creation_date": 1565549027, "post_id": 55565491, "comment_id": 101379956, "body": "This is how I implemented my Update filter -- update := bson.D{primitive.E{Key: &quot;$set&quot;, \t\tValue: bson.D{ \t\t\tprimitive.E{Key: &quot;name&quot;, Value: supplier.Name}, \t\t\tprimitive.E{Key: &quot;documentType&quot;, Value: supplier.DocumentType}  \t\t}, \t}}"}, {"owner": {"reputation": 1551, "user_id": 1845283, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/12025c96a4e96984d9c95b2a8878d1bb?s=128&d=identicon&r=PG", "display_name": "Dewald Swanepoel", "link": "https://stackoverflow.com/users/1845283/dewald-swanepoel"}, "reply_to_user": {"reputation": 728, "user_id": 4156868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tsaT7.jpg?s=128&g=1", "display_name": "sumedhe", "link": "https://stackoverflow.com/users/4156868/sumedhe"}, "edited": false, "score": 0, "creation_date": 1604932795, "post_id": 55565491, "comment_id": 114490532, "body": "@sumedhe, if you want to replace the entire document, not just certain fields, you might want to consider using ReplaceOne() as opposed to UpdateOne()"}, {"owner": {"reputation": 659, "user_id": 1155514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mjZMX.jpg?s=128&g=1", "display_name": "Muhammad Tariq", "link": "https://stackoverflow.com/users/1155514/muhammad-tariq"}, "reply_to_user": {"reputation": 1732, "user_id": 646553, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/juIlb.jpg?s=128&g=1", "display_name": "shontauro", "link": "https://stackoverflow.com/users/646553/shontauro"}, "edited": false, "score": 0, "creation_date": 1611513262, "post_id": 55565491, "comment_id": 116470144, "body": "@shontauro, please write an answer and provide some details. That will be helpful for the readers. Its very hard to understand the code in the comment."}], "tags": [], "owner": {"reputation": 273, "user_id": 4256748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac027c2b12eb957c1eb0813bc6f4bd7d?s=128&d=identicon&r=PG&f=1", "display_name": "ZacSketches", "link": "https://stackoverflow.com/users/4256748/zacsketches"}, "is_accepted": true, "score": 4, "last_activity_date": 1554690488, "creation_date": 1554690488, "answer_id": 55565491, "question_id": 55564562, "link": "https://stackoverflow.com/questions/55564562/what-is-the-bson-syntax-for-set-in-updateone-for-the-official-mongo-go-driver/55565491#55565491", "title": "What is the bson syntax for $set in UpdateOne for the official mongo-go-driver", "body": "<p>After playing around with this for a little while longer I was able to solve the problem after <strong>A LOT OF TRIAL AND ERROR</strong> using the <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson\" rel=\"nofollow noreferrer\">mongodb bson package</a> by changing the <code>UpdateByName</code> function in my code above as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// UpdateByName changes the description for a movie identified by its name\nfunc (db *DB) UpdateByName(movie Movie) (*mongo.UpdateResult, error) {\n    filter := bson.D{{\"name\", movie.Name}}\n    update := bson.D{{\"$set\",\n        bson.D{\n            {\"description\", movie.Description},\n        },\n    }}\n\n    res, err := db.Client.Database(db.Database).Collection(db.Collection).UpdateOne(\n        db.Ctx,\n        filter,\n        update,\n    )\n    if err != nil {\n        return nil, err\n    }\n    return res, nil\n}\n</code></pre>\n\n<p>Note the use of <code>bson.D{{$\"set\", ...</code>. It is unfortunate the way MongoDB has implemented the <code>bson</code> package this syntax still does not pass the go-vet.  If anyone has a comment to fix the lint conflict below it would be appreciated.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>go.mongodb.org/mongo-driver/bson/primitive.E composite literal uses unkeyed fields\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 413, "user_id": 146593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65c13cb6900324876c7b0f07562cd3d9?s=128&d=identicon&r=PG", "display_name": "Denis", "link": "https://stackoverflow.com/users/146593/denis"}, "is_accepted": false, "score": 1, "last_activity_date": 1575301466, "creation_date": 1575301466, "answer_id": 59142314, "question_id": 55564562, "link": "https://stackoverflow.com/questions/55564562/what-is-the-bson-syntax-for-set-in-updateone-for-the-official-mongo-go-driver/59142314#59142314", "title": "What is the bson syntax for $set in UpdateOne for the official mongo-go-driver", "body": "<p>In many cases you can replace construction</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>filter := bson.D{{\"name\", movie.Name}}\n</code></pre>\n\n<p>with</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>filter := bson.M{\"name\": movie.Name}\n</code></pre>\n\n<p>if arguments order dowsn't matter</p>\n"}], "owner": {"reputation": 273, "user_id": 4256748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac027c2b12eb957c1eb0813bc6f4bd7d?s=128&d=identicon&r=PG&f=1", "display_name": "ZacSketches", "link": "https://stackoverflow.com/users/4256748/zacsketches"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5526, "favorite_count": 0, "accepted_answer_id": 55565491, "answer_count": 2, "score": 3, "last_activity_date": 1575323435, "creation_date": 1554679749, "last_edit_date": 1575323435, "question_id": 55564562, "link": "https://stackoverflow.com/questions/55564562/what-is-the-bson-syntax-for-set-in-updateone-for-the-official-mongo-go-driver", "title": "What is the bson syntax for $set in UpdateOne for the official mongo-go-driver", "body": "<p>I am trying to get some familiarity with the official <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo\" rel=\"nofollow noreferrer\">mongo-go-driver</a> and the right syntax for <code>UpdateOne</code>.  </p>\n\n<p>My simplest full example follows: </p>\n\n<p>(NOTE: in order to use this code you will need to substitute in your own user and server names as well as export the login password to the environment as MONGO_PW):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"os\"\n\n    \"go.mongodb.org/mongo-driver/bson\"\n    \"go.mongodb.org/mongo-driver/bson/primitive\"\n\n    \"go.mongodb.org/mongo-driver/mongo\"\n    \"go.mongodb.org/mongo-driver/mongo/options\"\n)\n\ntype DB struct {\n    User       string\n    Server     string\n    Database   string\n    Collection string\n    Client     *mongo.Client\n    Ctx        context.Context\n}\n\nvar db = DB{\n    User:       &lt;username&gt;,\n    Server:     &lt;server_IP&gt;,\n    Database:   \"test\",\n    Collection: \"movies\",\n    Ctx:        context.TODO(),\n}\n\ntype Movie struct {\n    ID          primitive.ObjectID `bson:\"_id\" json:\"id\"`\n    Name        string             `bson:\"name\" json:\"name\"`\n    Description string             `bson:\"description\" json:\"description\"`\n}\n\nfunc main() {\n    if err := db.Connect(); err != nil {\n        fmt.Println(\"error: unable to connect\")\n        os.Exit(1)\n    }\n    fmt.Println(\"connected\")\n\n    // The code assumes the original entry for dunkirk is the following\n    // {\"Name\":\"dunkirk\", \"Description\":\"a world war 2 movie\"}\n    updatedMovie := Movie{\n        Name:        \"dunkirk\",\n        Description: \"movie about the british evacuation in WWII\",\n    }\n\n    res, err := db.UpdateByName(updatedMovie)\n    if err != nil {\n        fmt.Println(\"error updating movie:\", err)\n        os.Exit(1)\n    }\n    if res.MatchedCount &lt; 1 {\n        fmt.Println(\"error: update did not match any documents\")\n        os.Exit(1)\n    }\n}\n\n// UpdateByName changes the description for a movie identified by its name\nfunc (db *DB) UpdateByName(movie Movie) (*mongo.UpdateResult, error) {\n    filter := bson.D{{\"name\", movie.Name}}\n\n    res, err := db.Client.Database(db.Database).Collection(db.Collection).UpdateOne(\n        db.Ctx,\n        filter,\n        movie,\n    )\n    if err != nil {\n        return nil, err\n    }\n    return res, nil\n}\n\n// Connect assumes that the database password is stored in the\n// environment variable MONGO_PW\nfunc (db *DB) Connect() error {\n    pw, ok := os.LookupEnv(\"MONGO_PW\")\n    if !ok {\n        fmt.Println(\"error: unable to find MONGO_PW in the environment\")\n        os.Exit(1)\n    }\n    mongoURI := fmt.Sprintf(\"mongodb+srv://%s:%s@%s\", db.User, pw, db.Server)\n\n    // Set client options and verify connection\n    clientOptions := options.Client().ApplyURI(mongoURI)\n    client, err := mongo.Connect(db.Ctx, clientOptions)\n    if err != nil {\n        return err\n    }\n    err = client.Ping(db.Ctx, nil)\n    if err != nil {\n        return err\n    }\n\n    db.Client = client\n    return nil\n}\n</code></pre>\n\n<p>The function signature for <code>UpdateOne</code> from the package docs is:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (coll *Collection) UpdateOne(ctx context.Context, filter interface{}, \n    update interface{}, opts ...*options.UpdateOptions) (*UpdateResult, error)\n</code></pre>\n\n<p>So I am clearly making some sort of mistake in creating the <code>update interface{}</code> argument to the function because I am presented with this error</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error updating movie: update document must contain key beginning with '$'\n</code></pre>\n\n<p>The most popular answer <a href=\"https://stackoverflow.com/questions/38883285/error-the-update-operation-document-must-contain-atomic-operators-when-running\">here</a> shows that I need to use a document sort of like this </p>\n\n<pre><code>{ $set: {\"Name\" : \"The Matrix\", \"Decription\" \"Neo and Trinity kick butt\" } }\n</code></pre>\n\n<p>but taken verbatim this will not compile in the mongo-go-driver.</p>\n\n<p>I think I need some form of a bson document to comply with the Go syntax.  What is the best and/or most efficient syntax to create this bson document for the <code>update</code>?</p>\n"}, {"tags": ["json", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 10113045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942799f8caa6bec9e17828593d5abdec?s=128&d=identicon&r=PG&f=1", "display_name": "J. Carl", "link": "https://stackoverflow.com/users/10113045/j-carl"}, "edited": false, "score": 0, "creation_date": 1554707394, "post_id": 55565205, "comment_id": 97834880, "body": "Hi, thanks for your answer. That&#39;s basically my third solution."}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 2, "last_activity_date": 1554687230, "creation_date": 1554687230, "answer_id": 55565205, "question_id": 55564216, "link": "https://stackoverflow.com/questions/55564216/unmarshal-json-with-arbitrary-key-value-pairs-to-struct/55565205#55565205", "title": "Unmarshal JSON with arbitrary key/value pairs to struct", "body": "<p>TMTOWTDI, and I think you found a reasonable solution.  Another option you could consider -- which I guess is similar to your option 2 -- is to unmarshal it onto a <code>map[string]interface{}</code>.</p>\n\n<p>Then range over the keys and values and do whatever you need to with the data, running type assertions on the values as necessary.  Depending on what you need to do, you may skip the struct entirely, or still populate it.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    jsonMsg := `{\"known1\": \"foo\", \"known2\": \"bar\", \"unknown1\": \"car\", \"unknown2\": 1}`\n    var msg map[string]interface{}\n    fmt.Println(json.Unmarshal([]byte(jsonMsg), &amp;msg))\n    fmt.Printf(\"%+v\", msg)\n}\n</code></pre>\n\n<p>prints</p>\n\n<pre><code>&lt;nil&gt;\nmap[known1:foo known2:bar unknown1:car unknown2:1]\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Bl99Cq5tFWW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Bl99Cq5tFWW</a></p>\n"}, {"tags": [], "owner": {"reputation": 161, "user_id": 11339140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_oZaOqfxYFI/AAAAAAAAAAI/AAAAAAAAADw/o9Jcv0YYArU/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0444\u043e\u0440 \u0421\u0435\u0440\u044f\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/11339140/%d0%9d%d0%b8%d0%ba%d0%b8%d1%84%d0%be%d1%80-%d0%a1%d0%b5%d1%80%d1%8f%d0%ba%d0%be%d0%b2"}, "is_accepted": false, "score": 0, "last_activity_date": 1554905188, "creation_date": 1554905188, "answer_id": 55614610, "question_id": 55564216, "link": "https://stackoverflow.com/questions/55564216/unmarshal-json-with-arbitrary-key-value-pairs-to-struct/55614610#55614610", "title": "Unmarshal JSON with arbitrary key/value pairs to struct", "body": "<p>Probably there is no existing solution just for your situation.\nAs an addition to your solutions you may try to use raw parsing libraries like:</p>\n\n<ul>\n<li><a href=\"https://github.com/buger/jsonparser\" rel=\"nofollow noreferrer\">https://github.com/buger/jsonparser</a></li>\n<li><a href=\"https://github.com/json-iterator/go\" rel=\"nofollow noreferrer\">https://github.com/json-iterator/go</a></li>\n<li><a href=\"https://github.com/nikandfor/json\" rel=\"nofollow noreferrer\">https://github.com/nikandfor/json</a></li>\n</ul>\n\n<p>Last one is mine and it has some unfinished features, but raw parsing is done.</p>\n\n<p>You may also use reflection with libraries above to set known fields in the struct.</p>\n"}], "owner": {"reputation": 59, "user_id": 10113045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942799f8caa6bec9e17828593d5abdec?s=128&d=identicon&r=PG&f=1", "display_name": "J. Carl", "link": "https://stackoverflow.com/users/10113045/j-carl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1274, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1554905188, "creation_date": 1554675977, "last_edit_date": 1554748323, "question_id": 55564216, "link": "https://stackoverflow.com/questions/55564216/unmarshal-json-with-arbitrary-key-value-pairs-to-struct", "title": "Unmarshal JSON with arbitrary key/value pairs to struct", "body": "<h1>Problem</h1>\n\n<p>Found many similar questions (title) but none solved my problem, so here is it.</p>\n\n<p>I have a JSON string that contains some known fields (should always be present) plus any number of unknown/arbitrary fields.</p>\n\n<h2>Example</h2>\n\n<pre><code>{\"known1\": \"foo\", \"known2\": \"bar\", \"unknown1\": \"car\", \"unknown2\": 1}\n</code></pre>\n\n<p>In this example <code>known1</code> and <code>known2</code> are known fields. <code>unknown1</code> and <code>unknown2</code> are arbitrary/unknown fields.</p>\n\n<p>The unknown fields can have any name (key) and any value. The value type can be either a string, bool, float64 or int.</p>\n\n<p>What I want is to find the simplest and most elegant (idiomatic) way to parse a message like this.</p>\n\n<h1>My solution</h1>\n\n<p>I've used the following struct:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Message struct {\n    Known1   string `json:\"known1\"`\n    Known2   string `json:\"known2\"`\n    Unknowns []map[string]interface{}\n}\n</code></pre>\n\n<h2>Expected result</h2>\n\n<p>With this struct and the above sample JSON message I want to achieve a <code>Message</code> like the following (output from <code>fmt.Printf(\"%+v\", msg)</code>):</p>\n\n<pre><code>{Known1:foo Known2:bar Unknowns:[map[unknown1:car] map[unknown2:1]]}\n</code></pre>\n\n<h2>Attempts</h2>\n\n<h3>1. Simple unmarshal</h3>\n\n<p><a href=\"https://play.golang.org/p/WO6XlpK_vJg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WO6XlpK_vJg</a></p>\n\n<p>This doesn't work, <code>Unknowns</code> is not filled with the remaining unknown key/value pairs as expected.</p>\n\n<h3>2. Double unmarshal</h3>\n\n<p><a href=\"https://play.golang.org/p/Mw6fOYr-Km8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Mw6fOYr-Km8</a></p>\n\n<p>This works but I needed two unmarshals, one to fill the known fields (using an alias type to avoid an infinite loop) and a second one to get all fields as a <code>map[string]interface{}</code> and process the unknowns.</p>\n\n<h3>3. Unmarshal and type conversion</h3>\n\n<p><a href=\"https://play.golang.org/p/a7itXObavrX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/a7itXObavrX</a></p>\n\n<p>This works and seems the best option among my solutions.</p>\n\n<h1>Any other option?</h1>\n\n<p>Option 2 and 3 work but I'm curious if anyone has a simpler/more elegant solution.</p>\n"}, {"tags": ["database", "go", "refactoring", "boltdb"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1554776016, "post_id": 55563933, "comment_id": 97866122, "body": "what is the question?"}, {"owner": {"reputation": 325, "user_id": 369565, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a223e23689e6e49df20c8da6e230b126?s=128&d=identicon&r=PG", "display_name": "Timtico", "link": "https://stackoverflow.com/users/369565/timtico"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1554803053, "post_id": 55563933, "comment_id": 97876362, "body": "I clarified my post, is it ok like this?"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1554803501, "post_id": 55563933, "comment_id": 97876658, "body": "still no clear question.  what you want, and what you tried, and what problem you met,  finally what is the question about the problem."}, {"owner": {"reputation": 325, "user_id": 369565, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a223e23689e6e49df20c8da6e230b126?s=128&d=identicon&r=PG", "display_name": "Timtico", "link": "https://stackoverflow.com/users/369565/timtico"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1554842120, "post_id": 55563933, "comment_id": 97897788, "body": "I would like to create a new function that replaces the code I&#39;ve written: opening a new (read only) database transaction with <code>db.View</code>, selectiong the right rootbucket and underlying bucket with <code>tx.Bucket</code> . If I would only wrap one level of bucket selection and subsequent looping, I could write something like this:"}], "answers": [{"tags": [], "owner": {"reputation": 161, "user_id": 11339140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_oZaOqfxYFI/AAAAAAAAAAI/AAAAAAAAADw/o9Jcv0YYArU/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0444\u043e\u0440 \u0421\u0435\u0440\u044f\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/11339140/%d0%9d%d0%b8%d0%ba%d0%b8%d1%84%d0%be%d1%80-%d0%a1%d0%b5%d1%80%d1%8f%d0%ba%d0%be%d0%b2"}, "is_accepted": false, "score": 0, "last_activity_date": 1554906754, "creation_date": 1554906754, "answer_id": 55615162, "question_id": 55563933, "link": "https://stackoverflow.com/questions/55563933/golang-and-boltdb-using-closures-to-wrap-a-bucket-foreach-function/55615162#55615162", "title": "golang and boltdb: using closures to wrap a bucket ForEach function", "body": "<p>I didn't actually catch what you want, but I'll try to answer.</p>\n\n<p>You may have an callback argument that you pass to ForEach</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    func ForEachBucket(db *bolt.DB, bucketname string, f func(b *bolt.Bucket) error {\n        // ...\n        return mapBucket.ForEach(f) // do not forget about returned error here\n    }\n</code></pre>\n\n<p>More general: <a href=\"https://play.golang.org/p/LQlZHOWZTfi\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LQlZHOWZTfi</a></p>\n"}], "owner": {"reputation": 325, "user_id": 369565, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a223e23689e6e49df20c8da6e230b126?s=128&d=identicon&r=PG", "display_name": "Timtico", "link": "https://stackoverflow.com/users/369565/timtico"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 215, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1554906754, "creation_date": 1554673440, "last_edit_date": 1554802967, "question_id": 55563933, "link": "https://stackoverflow.com/questions/55563933/golang-and-boltdb-using-closures-to-wrap-a-bucket-foreach-function", "title": "golang and boltdb: using closures to wrap a bucket ForEach function", "body": "<p>In my code I use alot of repeating code to iterate over nested buckets in a bolddb database. I would like to do some refactoring, wrapping these repeating codes into new functions.</p>\n\n<p>I know I need to use closures for this, but the extra db.View layer gives me headaches.</p>\n\n<p>More precisely, I would like to wrap the bucket.ForEach function into a new function. This function creates a view transaction of the database, selects the nested bucket and returns a new function that lets me iterate over the given bucket.</p>\n\n<p>The code signature of the newly created code would be something like this:</p>\n\n<pre><code>ForEachBucket(bucket_name string, *bolt.DB) func() {}\n</code></pre>\n\n<p>The code that I want to wrap:</p>\n\n<pre><code>func ForEachBucket(bucketname string, db *bolt.DB)  {\n\n    db.View(func(tx *bolt.Tx) error {\n        rootBkt := tx.Bucket([]byte(\"rootbucket\")) // always the same\n        interestingBkt := rootBkt.Bucket([]byte(bucketname))\n        if nestedBkt := interestingBkt.Bucket([]byte(\"underlying\")); nestedBkt != nil {\n            mapBkt.ForEach(func(k, v []byte) error {\n                // do something here\n                    }\n            })\n            return nil\n        })\n}\n</code></pre>\n\n<p>I want to create a new function (using closures) that wraps the above code and returns a foreach like function.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 11267305, "user_type": "registered", "profile_image": "https://graph.facebook.com/124290542001393/picture?type=large", "display_name": "Rombe", "link": "https://stackoverflow.com/users/11267305/rombe"}, "edited": false, "score": 0, "creation_date": 1554765392, "post_id": 55566742, "comment_id": 97864114, "body": "I change $&gt; curl --socks5 202.79.50.167:44926 google.com  &gt;$&gt; curl --socks4 202.79.50.167:44926 google.com, and it work...  I understand I need a dialer through the socks4"}], "tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": true, "score": 0, "last_activity_date": 1554701207, "creation_date": 1554701207, "answer_id": 55566742, "question_id": 55563812, "link": "https://stackoverflow.com/questions/55563812/why-simple-dialersocks-always-return-eof/55566742#55566742", "title": "Why Simple dialer(socks) always return EOF?", "body": "<p>It's because the sock5 proxy you are attempting to use is not working properly. </p>\n\n<pre><code>$&gt; curl --socks5 202.79.50.167:44926 google.com\ncurl: (7) Unable to receive initial SOCKS5 response.\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 11267305, "user_type": "registered", "profile_image": "https://graph.facebook.com/124290542001393/picture?type=large", "display_name": "Rombe", "link": "https://stackoverflow.com/users/11267305/rombe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "accepted_answer_id": 55566742, "answer_count": 1, "score": -1, "last_activity_date": 1554707412, "creation_date": 1554672433, "last_edit_date": 1554707412, "question_id": 55563812, "link": "https://stackoverflow.com/questions/55563812/why-simple-dialersocks-always-return-eof", "title": "Why Simple dialer(socks) always return EOF?", "body": "<p>get this error in any addr.</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc dialSocks(socks string) (Dial proxy.Dialer, err error) {\n    Dial, err = proxy.SOCKS5(\"tcp\", socks, nil, proxy.Direct)\n    return\n}\n\nfunc checkError(err error) {\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"Fatal error: %s\", err.Error())\n        os.Exit(1)\n    }\n}\n\nfunc main() {\n    dialSocksProxy, err := dialSocks(\"202.79.50.167:44926\")\n    checkError(err)\n\n    dialer, err := dialSocksProxy.Dial(\"tcp\", \"smtp.gmail.com:587\")\n    checkError(err)\n}\n</code></pre>\n\n<p><strong>output:</strong></p>\n\n<p>Fatal error: socks connect tcp 202.79.50.167:44926->smtp.gmail.com:587:EOF</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1554674314, "post_id": 55563746, "comment_id": 97827784, "body": "Why don&#39;t you swap the route to a function that always returns 404?"}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1554674498, "post_id": 55563746, "comment_id": 97827829, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/24252500/golang-http-mux-change-handler-function\">Golang http mux change handler function</a>"}, {"owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1554702930, "post_id": 55563746, "comment_id": 97833063, "body": "This should be part of a long-running process listening to docker labels for defining routes. It didn\u2018t seem elegant to have routes accumulating over time."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554730787, "post_id": 55563746, "comment_id": 97848413, "body": "If they have a shared prefix, point it at a handler and do your own routing."}], "owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 403, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554730744, "creation_date": 1554671708, "last_edit_date": 1554730744, "question_id": 55563746, "link": "https://stackoverflow.com/questions/55563746/how-to-remove-a-named-route-from-gorilla-mux-in-go", "title": "How to remove a named route from Gorilla mux in go?", "body": "<p>I'd like to dynamically add/remove routes. \nAccording to the mux <code>Router</code> api it seems I can add routes, but not remove? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1554730953, "post_id": 55563409, "comment_id": 97848526, "body": "Are you familiar with <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow noreferrer\">golang.org/pkg/math/big</a> ?"}, {"owner": {"reputation": 750, "user_id": 6509531, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3deff0730998b5c350c5b2006980016c?s=128&d=identicon&r=PG&f=1", "display_name": "Liam Mueller", "link": "https://stackoverflow.com/users/6509531/liam-mueller"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554732021, "post_id": 55563409, "comment_id": 97849233, "body": "@Adrian I took a look at it before, but somehow I manage to gloss over <code>Float</code>. Ugh. If you want to make that an answer, I&#39;ll accept it."}, {"owner": {"reputation": 1025, "user_id": 1683793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/384cc6ed9450635fc4189e1a5a840dd5?s=128&d=identicon&r=PG", "display_name": "user1683793", "link": "https://stackoverflow.com/users/1683793/user1683793"}, "edited": false, "score": 0, "creation_date": 1570235597, "post_id": 55563409, "comment_id": 102860954, "body": "The <code>math&#47;big</code> package is out there and works as advertised but it is nothing like a replacement for the gcc <code>__float128</code> &quot;native&quot; type.  To use <code>Float</code> is a pain and it is not anywhere as fast as native types.  Still, it supports major precision.  If you need the precision, it will give it to you.  If you need speed, forget it."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1554902491, "creation_date": 1554902491, "answer_id": 55613676, "question_id": 55563409, "link": "https://stackoverflow.com/questions/55563409/128-bit-float-in-go-equivalent-of-cs-decimal-type/55613676#55613676", "title": "128-bit Float in Go - Equivalent of C#&#39;s &quot;decimal&quot; Type", "body": "<p>The standard library's <code>math/big</code> includes a <a href=\"https://golang.org/pkg/math/big/#Float\" rel=\"nofollow noreferrer\"><code>Float</code> type</a>:</p>\n\n<blockquote>\n  <p>A nonzero finite Float represents a multi-precision floating point number</p>\n</blockquote>\n"}], "owner": {"reputation": 750, "user_id": 6509531, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3deff0730998b5c350c5b2006980016c?s=128&d=identicon&r=PG&f=1", "display_name": "Liam Mueller", "link": "https://stackoverflow.com/users/6509531/liam-mueller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 689, "favorite_count": 0, "accepted_answer_id": 55613676, "answer_count": 1, "score": 0, "last_activity_date": 1554902491, "creation_date": 1554669068, "last_edit_date": 1554732071, "question_id": 55563409, "link": "https://stackoverflow.com/questions/55563409/128-bit-float-in-go-equivalent-of-cs-decimal-type", "title": "128-bit Float in Go - Equivalent of C#&#39;s &quot;decimal&quot; Type", "body": "<p>Simple question: is there an equivalent of C#'s <a href=\"https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/decimal\" rel=\"nofollow noreferrer\">decimal</a> type in the Go standard library?</p>\n\n<p>I intend to use this type to interface with an OData API that returns decimals at some endpoints, and from what I read, <code>complex128</code> is not suitable for this behavior (the storage of it is different than that of floats)</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1554669307, "post_id": 55562848, "comment_id": 97826538, "body": "You are closing both files at the end of InitLog. You cannot write to closed files."}, {"owner": {"reputation": 217, "user_id": 5410509, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/40f4503dae48b0d35114f22883ef4063?s=128&d=identicon&r=PG&f=1", "display_name": "Jasson Harsojo", "link": "https://stackoverflow.com/users/5410509/jasson-harsojo"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1554696013, "post_id": 55562848, "comment_id": 97831351, "body": "Is it necessary to close file?"}], "answers": [{"comments": [{"owner": {"reputation": 217, "user_id": 5410509, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/40f4503dae48b0d35114f22883ef4063?s=128&d=identicon&r=PG&f=1", "display_name": "Jasson Harsojo", "link": "https://stackoverflow.com/users/5410509/jasson-harsojo"}, "edited": false, "score": 0, "creation_date": 1554695990, "post_id": 55563638, "comment_id": 97831344, "body": "ah.. i see. Do we have to close the file or is it okay to leave it open ?"}, {"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "reply_to_user": {"reputation": 217, "user_id": 5410509, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/40f4503dae48b0d35114f22883ef4063?s=128&d=identicon&r=PG&f=1", "display_name": "Jasson Harsojo", "link": "https://stackoverflow.com/users/5410509/jasson-harsojo"}, "edited": false, "score": 0, "creation_date": 1554705302, "post_id": 55563638, "comment_id": 97833940, "body": "It&#39;s not OK, you should close it. Try to open file in your main func, pass it to <code>InitLogger</code> and add <code>defer file.Close()</code> statement there. Also I suggest you to use existing implementation of loggers (e.g. <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">github.com/sirupsen/logrus</a>) instead of making it by yourself."}, {"owner": {"reputation": 217, "user_id": 5410509, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/40f4503dae48b0d35114f22883ef4063?s=128&d=identicon&r=PG&f=1", "display_name": "Jasson Harsojo", "link": "https://stackoverflow.com/users/5410509/jasson-harsojo"}, "edited": false, "score": 0, "creation_date": 1554732632, "post_id": 55563638, "comment_id": 97849642, "body": "what will happen if i dont close the  file in the  long term?"}], "tags": [], "owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "is_accepted": false, "score": 1, "last_activity_date": 1554670833, "creation_date": 1554670833, "answer_id": 55563638, "question_id": 55562848, "link": "https://stackoverflow.com/questions/55562848/go-logging-does-not-appear/55563638#55563638", "title": "Go Logging does not appear", "body": "<p>In <code>InitLog</code> you used </p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/doc/effective_go.html#defer\" rel=\"nofollow noreferrer\">defer</a> fileInfo.Close() </p>\n</blockquote>\n\n<p>It closed file after <code>InitLog</code> call. Then <code>logger.Info.Println(\"test info\")</code> tries to write to the closed file.</p>\n\n<p>If you (really) want to use global logger, you should not close file in <code>InitLog</code> function.</p>\n"}], "owner": {"reputation": 217, "user_id": 5410509, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/40f4503dae48b0d35114f22883ef4063?s=128&d=identicon&r=PG&f=1", "display_name": "Jasson Harsojo", "link": "https://stackoverflow.com/users/5410509/jasson-harsojo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 821, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1554670833, "creation_date": 1554665284, "last_edit_date": 1554666219, "question_id": 55562848, "link": "https://stackoverflow.com/questions/55562848/go-logging-does-not-appear", "title": "Go Logging does not appear", "body": "<p>I want to create a Dependency Injection for a logging system in golang,\nbut when I do <code>log.Info.Println</code> it doesn't print anything to the log file.\nHere's my code:</p>\n\n<p>app.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    log \"github.com/jass-trix/BVDI/backend/application/logging\"\n)\n\nfunc main() {\n    logger := log.InitLog()\n    logger.Info.Println(\"test info\")\n    logger.Error.Println(\"test error\")\n}\n\n</code></pre>\n\n<p>init.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package logging\n\nimport (\n    \"flag\"\n    \"io\"\n    \"log\"\n    \"os\"\n)\n\nconst logPath = \"log/path/\"\n\n//Logger is a struct that contain all type of logger\n//logger will be separated into two level\ntype Logger struct {\n    Info  *log.Logger\n    Error *log.Logger\n}\n\nvar infoLog *log.Logger\nvar errorLog *log.Logger\n\n//InitLog is a function to instantiate logging\nfunc InitLog() *Logger {\n\n    flag.Parse()\n\n    fileInfo, err := os.OpenFile(logPath+\"file.log\", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0660)\n    if err != nil {\n        log.Fatalf(\"error on opening file: %v\", err)\n    }\n    defer fileInfo.Close()\n\n    multiInfo := io.MultiWriter(fileInfo, os.Stdout)\n    infoLog := log.New(multiInfo, \"INFO: \", log.Ldate|log.Ltime|log.Lshortfile)\n\n    fileError, err := os.OpenFile(logPath+\"file.error.log\", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0660)\n    if err != nil {\n        log.Fatalf(\"error on opening file: %v\", err)\n    }\n    defer fileError.Close()\n\n    multiError := io.MultiWriter(fileError, os.Stdout)\n    errorLog := log.New(multiError, \"ERROR: \", log.Ldate|log.Ltime|log.Lshortfile)\n    return &amp;Logger{\n        Info:  infoLog,\n        Error: errorLog,\n    }\n}\n</code></pre>\n\n<p>When I call <code>logger.Info.Println()</code> in app.go it doesn't print anything,\nbut when I call <code>errorLog.Println()</code> in init.go it prints to the file.</p>\n\n<p>Does logging support Dependency Injection?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 59, "user_id": 1202542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/819ad7bd45ce8d3b5ada13285d1650e7?s=128&d=identicon&r=PG", "display_name": "Danny", "link": "https://stackoverflow.com/users/1202542/danny"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1554678713, "post_id": 55562632, "comment_id": 97828620, "body": "thanks that was it"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554705246, "post_id": 55562632, "comment_id": 97833916, "body": "Note that you should <i>not do this</i>!! It&#39;s common (in fact, probably the normal case), that your compiled code doesn&#39;t run on the same machine as your source files. So <code>runtime</code>&#39;s output may have nothing to do with the system that is executing the code. Proper practice is instead to pass the location to your static files as configuration, which can be configured per-installation."}], "answers": [{"tags": [], "owner": {"reputation": 59, "user_id": 1202542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/819ad7bd45ce8d3b5ada13285d1650e7?s=128&d=identicon&r=PG", "display_name": "Danny", "link": "https://stackoverflow.com/users/1202542/danny"}, "is_accepted": false, "score": -1, "last_activity_date": 1554679445, "creation_date": 1554679445, "answer_id": 55564542, "question_id": 55562632, "link": "https://stackoverflow.com/questions/55562632/how-to-determine-directory-of-packages-source-files/55564542#55564542", "title": "How to determine directory of package&#39;s source files", "body": "<p>From this question <a href=\"https://stackoverflow.com/a/32163888/1202542\">answer here</a></p>\n\n<pre><code>_, filename, _, ok := runtime.Caller(0)\n\nif !ok {\n    panic(\"no caller information\")\n}\n\nos.Open(path.Dir(filename) + '/static/sample.json\")\n</code></pre>\n\n<p>did the trick.</p>\n"}], "owner": {"reputation": 59, "user_id": 1202542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/819ad7bd45ce8d3b5ada13285d1650e7?s=128&d=identicon&r=PG", "display_name": "Danny", "link": "https://stackoverflow.com/users/1202542/danny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "closed_date": 1554705171, "answer_count": 1, "score": -1, "last_activity_date": 1554705140, "creation_date": 1554663973, "last_edit_date": 1554705140, "question_id": 55562632, "link": "https://stackoverflow.com/questions/55562632/how-to-determine-directory-of-packages-source-files", "closed_reason": "Duplicate", "title": "How to determine directory of package&#39;s source files", "body": "<p>I have a package in a repo that has static files in it. </p>\n\n<pre><code>myPackage\nstatic/sample.json\nmain.go\n</code></pre>\n\n<p><code>main.go</code> uses <code>os.Open('static/sample.json\")</code> and processes the file</p>\n\n<p>Then I have another repo that consumes mypackage by importing it. The problem is that it is looking for the json file in this new repo.  I tried to put the full path github.com/username/mypackage/static/sample.json but it still can't be found. Is there a way I can keep the files in the other package?</p>\n"}, {"tags": ["go", "high-load"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1554656531, "post_id": 55561495, "comment_id": 97822828, "body": "Why do you think this is bad performance? What do you expect different?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1554669629, "post_id": 55561495, "comment_id": 97826624, "body": "Furthermore, what is your reference value?"}], "answers": [{"tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 11, "last_activity_date": 1554657983, "creation_date": 1554657983, "answer_id": 55561801, "question_id": 55561495, "link": "https://stackoverflow.com/questions/55561495/awful-golang-http-server-performance/55561801#55561801", "title": "Awful Golang http server performance", "body": "<p>In HTTP/1.0 benchmarks where each request is its own TCP connection the benchmark is really testing the server's TCP session setup and teardown. Not the web server.</p>\n\n<p>I just reran your test (well sort of) using Go's net/http and the server process used 150% CPU. Out of 16 available CPUs. That's pathetic CPU usage. It gets much better if I use persistent HTTP/1.1 connections (try <code>-k</code> in <code>ab</code>). Then the server gets up to 600%.</p>\n\n<p>If you want to serve a lot of small temporary TCP connections focus on improving your kernel's TCP performance. You can find guides online. It's mostly about disabling any firewalls or connection tracking, increasing available file descriptors and tweaking things like TCP Fast Open and reducing the timeouts on closed sockets.</p>\n"}], "owner": {"reputation": 975, "user_id": 2148352, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HcT8H.jpg?s=128&g=1", "display_name": "James May", "link": "https://stackoverflow.com/users/2148352/james-may"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2643, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1554657983, "creation_date": 1554656179, "question_id": 55561495, "link": "https://stackoverflow.com/questions/55561495/awful-golang-http-server-performance", "title": "Awful Golang http server performance", "body": "<p>I'm trying to figure out how it might be I have 5600 rps even with simple \"Hello World\" response. I tried starndard net/http, echo and fasthttp. Here is an example of the latter:</p>\n\n<pre><code>func main() {\n    router := routing.New()\n\n    router.Get(\"/\", func(c *routing.Context) error {\n        fmt.Fprintf(c, \"Hello, world!\")\n        return nil\n    })\n\n    panic(fasthttp.ListenAndServe(\":7777\", router.HandleRequest))\n}\n</code></pre>\n\n<p>I use ab and wrk for testing. Here is wrk command:</p>\n\n<pre><code>$ wrk -t10 -c100 -d10s http://somesite.com\nRunning 10s test @ http://somesite.com\n  10 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    17.05ms    1.08ms  33.46ms   91.30%\n    Req/Sec   587.80     33.97   670.00     84.92%\n  58603 requests in 10.10s, 8.27MB read\nRequests/sec:   5802.71\nTransfer/sec:    838.67KB\n</code></pre>\n\n<p>I tried on two different servers. One of them is a simple Digital Ocean instance, but another is dedicated with 32G RAM, 8 cores and 1Gb network channel. The results are the same for both servers. I run fasthttp application on one of them and wrk on another, and wise versa.</p>\n"}, {"tags": ["html", "go", "sqlite"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554731521, "post_id": 55560541, "comment_id": 97848888, "body": "In <code>AddReminder</code>, <code>statement.Exec</code> returns an error but you&#39;re ignoring it. Check that error."}], "answers": [{"tags": [], "owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "is_accepted": false, "score": 0, "last_activity_date": 1554662128, "last_edit_date": 1554662128, "creation_date": 1554661506, "answer_id": 55562302, "question_id": 55560541, "link": "https://stackoverflow.com/questions/55560541/how-to-store-date-and-time-input-type-from-html-form-into-sqlite3-db/55562302#55562302", "title": "How to store Date and Time input type from html form into sqlite3 DB", "body": "<p>Use Integer type in sqlite table and your time property in reminder struct should change to time.Time</p>\n\n<pre><code>type reminder struct {\n    id int\n    title string\n    description string\n    date string\n    time time.Time\n}\n</code></pre>\n\n<p>In order to convert your form date and time strings into a time.Time format you should parse your strings like so :</p>\n\n<pre><code>layout := \"2006-01-02T15:04:05.000Z\"\nstr := fmt.Sprintf(\"%sT%sZ\", r.FormValue(\"date\") , r.FormValue(\"time\"))\nt, err := time.Parse(layout, str)\n</code></pre>\n"}], "owner": {"reputation": 166, "user_id": 10132227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b806233c3b8b57d4b8d06831b9c2667?s=128&d=identicon&r=PG&f=1", "display_name": "c-anirudh", "link": "https://stackoverflow.com/users/10132227/c-anirudh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 437, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554662128, "creation_date": 1554650411, "question_id": 55560541, "link": "https://stackoverflow.com/questions/55560541/how-to-store-date-and-time-input-type-from-html-form-into-sqlite3-db", "title": "How to store Date and Time input type from html form into sqlite3 DB", "body": "<p>I am setting up a <code>reminder</code> feature in a personal assistant application. The application accepts the details of the reminder as a html form which also include <code>date</code> and <code>time</code> input fields.</p>\n\n<p>I am using golang for creating my server and created a sqlite database using it. But the value of date and time from the form doesn't get saved in the DB while other fields like title, description, etc gets saved. What datatype should I use for my time and date fields in the sqlite DB?</p>\n\n<p>I have tried using <code>TEXT</code> as the datatype for date and time but it doesn't work.</p>\n\n<p>Input form:</p>\n\n<pre><code>   ...\n&lt;div class=\"form-group\"&gt;\n   &lt;label for=\"date\"&gt;Date&lt;/label&gt;\n   &lt;input type=\"date\" class=\"form-control\" id=\"date\" data-ng-model=\"formData.remDate\" required&gt;\n&lt;/div&gt;\n\n&lt;div class=\"form-group\"&gt;\n   &lt;label for=\"time\"&gt;Time&lt;/label&gt;\n   &lt;input type=\"time\" class=\"form-control\" id=\"time\" data-ng-model=\"formData.remTime\" required&gt;\n&lt;/div&gt;\n   ...\n</code></pre>\n\n<p>This is the <code>reminder object</code> that is generated from the form:</p>\n\n<pre><code>{title: \"learn golang\", description: \"How do I save date and time in database?\", date: Mon Apr 08 2019 00:00:00 GMT+0530 (India Standard Time), time: Thu Jan 01 1970 20:00:00 GMT+0530 (India Standard Time)}\n</code></pre>\n\n<p>Golang file for creating and storing in DB:</p>\n\n<pre><code>package controllers\n\nimport (\n    \"net/http\"\n    \"database/sql\"\n    \"fmt\"\n    \"strconv\"\n\n    _ \"github.com/mattn/go-sqlite3\"\n)\n\ntype reminder struct {\n    id int\n    title string\n    description string\n    date string\n    time string\n}\n\nfunc ReminderController(w http.ResponseWriter, r *http.Request) {\n\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    w.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n    r.ParseForm()\n\n    request := reminder{\n        title: r.FormValue(\"title\"),\n        description: r.FormValue(\"description\"),\n        date: r.FormValue(\"date\"),\n        time: r.FormValue(\"time\"),\n    }\n    fmt.Println(request)\n\n    AddReminder(request, w)\n\n}\n\nfunc prepareDB() {\n    database, err := sql.Open(\"sqlite3\", \"./jarvis.db\")\n    checkErr(err)\n\n    statement, err := database.Prepare(\"CREATE TABLE IF NOT EXISTS reminder (id INTEGER PRIMARY KEY, title TEXT, description TEXT, date TEXT, time TEXT\")\n    checkErr(err)\n\n    statement.Exec()\n}\n\nfunc AddReminder(reminderObject reminder,  res http.ResponseWriter) {\n    prepareDB()\n\n    database, err := sql.Open(\"sqlite3\", \"./jarvis.db\")\n    checkErr(err)\n\n    statement, err := database.Prepare(\"INSERT INTO reminder (title, description, date, time) VALUES (?,?,?,?) \")\n    checkErr(err)\n    fmt.Println(reminderObject.title)\n    statement.Exec(reminderObject.title, reminderObject.description, reminderObject.date, reminderObject.time)\n\n    ShowReminder()\n\n    res.Write([]byte(`{\"status\": \"success\", \"message\": \"Reminder has been set !\"}`))\n}\n\nfunc ShowReminder() {\n    prepareDB()\n\n    database, err := sql.Open(\"sqlite3\", \"./jarvis.db\")\n    checkErr(err)\n\n    rows, err := database.Query(\"SELECT id, title, description, date, time FROM reminder\")\n    checkErr(err)\n\n    var id int\n    var title string\n    var description string\n    var date string\n    var time string\n\n    for rows.Next() {\n        rows.Scan(&amp;id, &amp;title, &amp;description, &amp;date, &amp;time)\n        fmt.Println(strconv.Itoa(id) + \": \" + title + \" \" + description + \"\\nEnd Time : \" + date + \":\" + time)\n    }\n}\n\nfunc checkErr(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Output generated in go console :</p>\n\n<pre><code>3: learn golang How do I save date and time in database?\nEnd Time : :\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1554649796, "post_id": 55560424, "comment_id": 97820881, "body": "Go finds the library. It doesn&#39;t find the NewServer function. Are you sure there&#39;s such a function ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6909438"}, "reply_to_user": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1554649951, "post_id": 55560424, "comment_id": 97820923, "body": "@DenysS&#233;guret You were right. Submit your comment as an answer and I will accept it. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "is_accepted": true, "score": 0, "last_activity_date": 1554650194, "creation_date": 1554650194, "answer_id": 55560510, "question_id": 55560424, "link": "https://stackoverflow.com/questions/55560424/why-does-go-compiler-not-find-a-library-i-use/55560510#55560510", "title": "Why does Go compiler not find a library I use?", "body": "<p><code>undefined: tbot.NewServer</code> means Go finds the tbot library but doesn't find the <code>NewServer</code> function.</p>\n\n<p>There's no such function in <a href=\"https://godoc.org/github.com/yanzay/tbot\" rel=\"nofollow noreferrer\">this library</a>.</p>\n\n<hr>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6909438"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 55560510, "answer_count": 1, "score": -2, "last_activity_date": 1554650194, "creation_date": 1554649616, "question_id": 55560424, "link": "https://stackoverflow.com/questions/55560424/why-does-go-compiler-not-find-a-library-i-use", "title": "Why does Go compiler not find a library I use?", "body": "<p>I have a simple Go program in directory <code>x</code>:</p>\n\n<pre><code>package main\n\nimport (\n        \"log\"\n        \"os\"\n\n        \"github.com/yanzay/tbot\"\n)\n\nfunc main() {\n        bot, err := tbot.NewServer(os.Getenv(\"TELEGRAM_TOKEN\"))\n        if err != nil {\n                log.Fatal(err)\n        }\n        bot.Handle(\"/answer\", \"42\")\n        bot.ListenAndServe()\n}\n</code></pre>\n\n<p><code>x/pkg/windows_386/github.com/yanzay</code> contains the file <code>tbot.a</code> with the <code>tbot</code> library used in my program. <code>x/src/github.com/yanzay/tbot</code> contains the source code of that library.</p>\n\n<p>When I run <code>go build main.go</code>, I get this output:</p>\n\n<pre><code># command-line-arguments\n.\\main.go:12:21: undefined: tbot.NewServer\n</code></pre>\n\n<p>How can I make sure that Go compiler finds the <code>tbot</code> package in the <code>x/pkg</code> or <code>x/src</code>?</p>\n"}, {"tags": ["go", "benchmarking"], "answers": [{"tags": [], "owner": {"reputation": 89, "user_id": 428093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0f87c8b96b937b3e7f2c320e4379e98?s=128&d=identicon&r=PG", "display_name": "drdr.xp", "link": "https://stackoverflow.com/users/428093/drdr-xp"}, "is_accepted": false, "score": 3, "last_activity_date": 1554656957, "creation_date": 1554656957, "answer_id": 55561627, "question_id": 55560080, "link": "https://stackoverflow.com/questions/55560080/why-does-go-benchmark-show-different-result-with-the-same-code-in-different-plac/55561627#55561627", "title": "Why does go benchmark show different result with the same code in different places?", "body": "<p>After digging into go source code I found that during compiling go replaces math/bits:OnesCount64 with an instruction implementation:\n<code>go/src/cmd/compile/internal/gc/ssa.go:3428 :makeOnesCountAMD64</code>.</p>\n\n<p>When calling <code>math/bits.OnesCount64</code> it actually does use the codes in <code>math/bits</code>.</p>\n"}], "owner": {"reputation": 89, "user_id": 428093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0f87c8b96b937b3e7f2c320e4379e98?s=128&d=identicon&r=PG", "display_name": "drdr.xp", "link": "https://stackoverflow.com/users/428093/drdr-xp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1554656957, "creation_date": 1554647644, "last_edit_date": 1554650763, "question_id": 55560080, "link": "https://stackoverflow.com/questions/55560080/why-does-go-benchmark-show-different-result-with-the-same-code-in-different-plac", "title": "Why does go benchmark show different result with the same code in different places?", "body": "<p>I benchmarked golang system package \"math/bits\". It is fast.\nI benchmarked the same codes copied from \"math/bits\", it is about 3 times slower.</p>\n\n<p>I wonder what is the differences between user's code and the system code when compiling, linking or benchmarking?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// x_test.go\npackage x_test\n\nimport (\n    \"math/bits\"\n    \"testing\"\n)\n\n// copied from \"math/bits\"\nconst DeBruijn64 = 0x03f79d71b4ca8b09\n\nvar Input uint64 = DeBruijn64\nvar Output int\n\nconst m0 = 0x5555555555555555 // 01010101 ...\nconst m1 = 0x3333333333333333 // 00110011 ...\nconst m2 = 0x0f0f0f0f0f0f0f0f // 00001111 ...\nconst m3 = 0x00ff00ff00ff00ff // etc.\nconst m4 = 0x0000ffff0000ffff\n\nfunc OnesCount64(x uint64) int {\n    const m = 1&lt;&lt;64 - 1\n    x = x&gt;&gt;1&amp;(m0&amp;m) + x&amp;(m0&amp;m)\n    x = x&gt;&gt;2&amp;(m1&amp;m) + x&amp;(m1&amp;m)\n    x = (x&gt;&gt;4 + x) &amp; (m2 &amp; m)\n    x += x &gt;&gt; 8\n    x += x &gt;&gt; 16\n    x += x &gt;&gt; 32\n    return int(x) &amp; (1&lt;&lt;7 - 1)\n}\n\n// copied from \"math/bits\" END\n\n\nfunc BenchmarkMine(b *testing.B) {\n    var s int\n    for i := 0; i &lt; b.N; i++ {\n        s += OnesCount64(uint64(i))\n    }\n    Output = s\n}\n\nfunc BenchmarkGo(b *testing.B) {\n    var s int\n    for i := 0; i &lt; b.N; i++ {\n        s += bits.OnesCount64(uint64(i))\n    }\n    Output = s\n}\n</code></pre>\n\n<p>And running it shows the different result:</p>\n\n<pre><code>go test x_test.go  -bench=.\ngoos: darwin\ngoarch: amd64\nBenchmarkMine-4         500000000                3.32 ns/op\nBenchmarkGo-4           2000000000               0.96 ns/op\n</code></pre>\n\n<p>The two benchmarks should result in similar results. But not.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "edited": false, "score": 2, "creation_date": 1554646372, "post_id": 55559840, "comment_id": 97819902, "body": "I think you could use <a href=\"https://golang.org/pkg/regexp/#Regexp.FindAllStringSubmatchIndex\" rel=\"nofollow noreferrer\">FindAllStringSubmatchIndex</a> like <code>fmt.Println(re.FindAllStringSubmatch(s, -1))</code>"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 3, "creation_date": 1554646373, "post_id": 55559840, "comment_id": 97819903, "body": "Have you tried to look in the documentation? There just might be a method for this."}], "owner": {"reputation": 248, "user_id": 6073838, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/1530379783927023/picture?type=large", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0410\u043d\u0442\u043e\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/6073838/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%90%d0%bd%d1%82%d0%be%d0%bd%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "closed_date": 1554652786, "answer_count": 0, "score": 0, "last_activity_date": 1554646170, "creation_date": 1554646170, "question_id": 55559840, "link": "https://stackoverflow.com/questions/55559840/find-multiple-in-string", "closed_reason": "Duplicate", "title": "Find multiple in string", "body": "<p>How I can find multiple value in brackets?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    re := regexp.MustCompile(`\\{[A-Za-z0-9]*\\}`)\n    s := \"{tag1} SomeText {tag2}\"\n    fmt.Println(re.FindStringSubmatch(s))\n}\n</code></pre>\n\n<p>This code return only first tag <code>tag1</code>. </p>\n\n<p><a href=\"https://play.golang.org/p/T8lhGpzfOBj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/T8lhGpzfOBj</a></p>\n"}, {"tags": ["sql", "database", "postgresql", "go"], "answers": [{"comments": [{"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 0, "creation_date": 1554640005, "post_id": 55556599, "comment_id": 97818253, "body": "Thank you. I will try it and that I will write here)"}, {"owner": {"reputation": 474, "user_id": 4063201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/uU5YK.png?s=128&g=1", "display_name": "monirz", "link": "https://stackoverflow.com/users/4063201/monirz"}, "reply_to_user": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 0, "creation_date": 1554649994, "post_id": 55556599, "comment_id": 97820934, "body": "Don&#39;t forget to change the username and password though.  And may be  accept the answer if you get it working. It&#39;s a working example, I tried it on my machine."}, {"owner": {"reputation": 659, "user_id": 5944467, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c0106fda691ceb8ba3dafd6a980e8d60?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/5944467/rahul"}, "edited": false, "score": 0, "creation_date": 1614422304, "post_id": 55556599, "comment_id": 117384162, "body": "Doesn&#39;t this create the &#39;example&#39; table in the &#39;postgres&#39; database ?"}], "tags": [], "owner": {"reputation": 474, "user_id": 4063201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/uU5YK.png?s=128&g=1", "display_name": "monirz", "link": "https://stackoverflow.com/users/4063201/monirz"}, "is_accepted": true, "score": 4, "last_activity_date": 1554622503, "last_edit_date": 1554622503, "creation_date": 1554621981, "answer_id": 55556599, "question_id": 55555836, "link": "https://stackoverflow.com/questions/55555836/is-it-possible-to-create-postgresql-databases-with-dynamic-names-with-the-help-o/55556599#55556599", "title": "Is it possible to create PostgreSQL Databases with dynamic names with the help of Golang?", "body": "<p>Try this,</p>\n\n<pre><code> package main\n\nimport (\n  \"database/sql\"\n   \"log\"\n\n   _ \"github.com/lib/pq\"\n)\n\nfunc main() {\n    conninfo := \"user=postgres password=yourpassword \n    host=127.0.0.1 sslmode=disable\"\n    db, err := sql.Open(\"postgres\", conninfo)\n\nif err != nil {\n    log.Fatal(err)\n}\ndbName := \"testdb\"\n_, err = db.Exec(\"create database \" + dbName)\nif err != nil {\n    //handle the error\n    log.Fatal(err)\n}\n\n//Then execute your query for creating table\n   _, err = db.Exec(\"CREATE TABLE example ( id integer, \n   username varchar(255) )\")\n\n   if err != nil {\n       log.Fatal(err)\n   }\n\n}\n</code></pre>\n\n<p>Note: All query statements don't support parameters in postgress, like <code>(\"create database $1\", \"testdb\")</code> won't work.</p>\n"}], "owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1183, "favorite_count": 0, "accepted_answer_id": 55556599, "answer_count": 1, "score": 2, "last_activity_date": 1554623116, "creation_date": 1554614130, "last_edit_date": 1554623116, "question_id": 55555836, "link": "https://stackoverflow.com/questions/55555836/is-it-possible-to-create-postgresql-databases-with-dynamic-names-with-the-help-o", "title": "Is it possible to create PostgreSQL Databases with dynamic names with the help of Golang?", "body": "<p>I use Go on my backend. I try to write a function which takes database name and creates PostgreSQL Database with this name. After this function should create tables in this DB (I have already created an sql script for this task)</p>\n\n<p>So the main problem is that I don't understand how to write a function which will create a PostgreSQL Database. I had a thought to create one .sql file and somehow pass database name to this file (for example find string in .sql file, which looks like {{dbname}} and replace it with db name), but may be there is a better way?</p>\n\n<p>Here is my .sql file which should create tables in new PostgreSQL Database </p>\n\n<pre><code>create table \"reviews\"\n(\n  review_id  uuid  not null\n    constraint review_pk\n      primary key,\n  user_id  uuid  not null,\n  rating  float,\n  comment text,\n  date  date  not null\n);\n\ncreate unique index reviews_review_id_uindex\n  on \"reviews\" (review_id);\n\ncreate unique index reviews_user_id_uindex\n  on \"reviews\" (user_id);\n\ncreate table \"sections\"\n(\n  section_id  uuid  not null\n    constraint section_pk\n      primary key,\n  title  text  not null,\n  color  text,\n  created_at date not null,\n  updated_at  date  not null,\n  deleted boolean default false\n);\n\ncreate unique index sections_section_id_uindex\n  on \"sections\" (section_id);\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554623252, "post_id": 55554961, "comment_id": 97814189, "body": "Please include the full error message. It includes line numbers, to tell you exactly where the error occurred."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1554625088, "post_id": 55555029, "comment_id": 97814664, "body": "Fine <i>is</i> a method. <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow noreferrer\">Methods are functions with a receiver</a>, and <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"nofollow noreferrer\">interfaces define method sets</a>."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1554625298, "post_id": 55555029, "comment_id": 97814708, "body": "Ah, looks like the question was edited after you answered it. You may want to remove that bit about Fine being a function."}], "tags": [], "owner": {"reputation": 158, "user_id": 5041327, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lvEAD.png?s=128&g=1", "display_name": "dat tutbrus", "link": "https://stackoverflow.com/users/5041327/dat-tutbrus"}, "is_accepted": false, "score": 1, "last_activity_date": 1554668739, "last_edit_date": 1554668739, "creation_date": 1554602934, "answer_id": 55555029, "question_id": 55554961, "link": "https://stackoverflow.com/questions/55554961/what-causes-panic-runtime-error-invalid-memory-address-or-nil-pointer-derefer/55555029#55555029", "title": "What causes &quot;panic: runtime error: invalid memory address or nil pointer dereference&quot;?", "body": "<p>Looking at package <code>b</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// InitB inits B :)\nfunc InitB() {\n    app := App{}\n\n    app.fine.Fine(\"hi\")\n}\n</code></pre>\n\n<p>You could see that you initalized a new <code>App{}</code> with a new <code>Controller</code> but you didn't fill in the Interface inside the <code>Controller</code>. An interface is something that expects a certain method from a type.</p>\n\n<p>Here's a quick snippet that would solve it:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type NotFine struct{}\n\n// Fine is a method of NotFine (type struct)\nfunc (NotFine) Fine(str string) string {\n    fmt.Println(str)\n    return \"\"\n}\n\n// InitB, ideally, would take in the interface itself,\n// meaning, the function becomes InitB(c Controller).\n// You then initiate `app := App{fine: c}`.\n// This is implemented in https://play.golang.org/p/ZfEqdr8zNG-\nfunc InitB() {\n    notfine := NotFine{}\n    app := App{\n        fine: notfine,\n    }\n\n    app.fine.Fine(\"hi\")\n}\n</code></pre>\n\n<p>Playground link: <a href=\"https://play.golang.org/p/ZfEqdr8zNG-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ZfEqdr8zNG-</a></p>\n"}], "owner": {"reputation": 1, "user_id": 11323067, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-4-DEbUVr1yU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdqLmwtxSnMd-DpC1g3z8tkkB6a1A/mo/photo.jpg?sz=128", "display_name": "Soyo kaze", "link": "https://stackoverflow.com/users/11323067/soyo-kaze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2041, "favorite_count": 0, "closed_date": 1554707785, "answer_count": 1, "score": -3, "last_activity_date": 1554668739, "creation_date": 1554601962, "last_edit_date": 1554623198, "question_id": 55554961, "link": "https://stackoverflow.com/questions/55554961/what-causes-panic-runtime-error-invalid-memory-address-or-nil-pointer-derefer", "closed_reason": "Not suitable for this site", "title": "What causes &quot;panic: runtime error: invalid memory address or nil pointer dereference&quot;?", "body": "<p>I'm having a problem with my project.</p>\n\n<p>getting the error:  </p>\n\n<blockquote>\n  <p><strong>panic: runtime error: invalid memory address or nil pointer dereference\n  [signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x44c16f]</strong></p>\n</blockquote>\n\n<p>What am I doing wrong?</p>\n\n<p><strong>package A</strong></p>\n\n<pre><code>package a\n\nimport (\n    \"fmt\"\n\n    \"github.com/lathrel/test/b\"\n\n)\n\ntype (\n    // App ...\n    App b.App\n)\n\n// Fine is a fine :) but was fine :/\nfunc (app *App) Fine(str string) string {\n    fmt.Println(str)\n    return \"\"\n}\n</code></pre>\n\n<p><strong>package B</strong></p>\n\n<pre><code>package b\n\n// App is a test\ntype App struct {\n    fine Controller\n}\n\n// Controller is a test\ntype Controller interface {\n    Fine(str string) string\n}\n\n// InitB inits B :)\nfunc InitB() {\n    app := App{}\n\n    app.fine.Fine(\"hi\")\n}\n</code></pre>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/lathrel/test/b\"\n)\n\nfunc main() {\n    b.InitB()\n}\n</code></pre>\n"}, {"tags": ["file", "go", "cryptography", "signature"], "comments": [{"owner": {"reputation": 486, "user_id": 3103584, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lV31D.png?s=128&g=1", "display_name": "Ella Rose", "link": "https://stackoverflow.com/users/3103584/ella-rose"}, "edited": false, "score": 0, "creation_date": 1554599300, "post_id": 55554802, "comment_id": 97810684, "body": "Welcome to crypto.stackexchange - This appears to be a programming question, and programming questions are off-topic here even if they are using cryptography. The correct place for programming questions is on stackoverflow; I can migrate this there for you."}, {"owner": {"reputation": 1569, "user_id": 2819689, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/07cce556c9a96b1ec9622df191fc651c?s=128&d=identicon&r=PG&f=1", "display_name": "MikiBelavista", "link": "https://stackoverflow.com/users/2819689/mikibelavista"}, "edited": false, "score": 0, "creation_date": 1554622570, "post_id": 55554802, "comment_id": 97814056, "body": "Nice example <a href=\"https://austburn.me/blog/golang-server.html\" rel=\"nofollow noreferrer\">austburn.me/blog/golang-server.html</a>"}, {"owner": {"reputation": 126, "user_id": 2537478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed50870bf017c9ca2199481f2515c3e8?s=128&d=identicon&r=PG", "display_name": "Natanael", "link": "https://stackoverflow.com/users/2537478/natanael"}, "edited": false, "score": 0, "creation_date": 1554640903, "post_id": 55554802, "comment_id": 97818500, "body": "For a file large enough that calculating a single hash of the whole file is non-trivial, you can use Merkle tree hashes to split the file in chunks, and then sign the hash root."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1554670121, "post_id": 55554802, "comment_id": 97826753, "body": "From godoc: \u201eMessages should be small because: 1. The whole message needs to be held in memory to be processed. 2. Using large messages pressures implementations on small machines to process plaintext without verifying the signature. This is very dangerous, and this API discourages it, but a protocol that uses excessive message sizes might present some implementations with no other choice. 3. Performance may be improved by working with messages that fit into data caches. Thus large amounts of data should be chunked so that each message is small.\u201c."}, {"owner": {"reputation": 31, "user_id": 4733013, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sE9rOdYazqk/AAAAAAAAAAI/AAAAAAAAV2M/0ra0U3_2l7c/photo.jpg?sz=128", "display_name": "Holloway Kean Ho", "link": "https://stackoverflow.com/users/4733013/holloway-kean-ho"}, "reply_to_user": {"reputation": 126, "user_id": 2537478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed50870bf017c9ca2199481f2515c3e8?s=128&d=identicon&r=PG", "display_name": "Natanael", "link": "https://stackoverflow.com/users/2537478/natanael"}, "edited": false, "score": 0, "creation_date": 1554673532, "post_id": 55554802, "comment_id": 97827607, "body": "@Natanael, Thanks. Can you convert your comment into answer please? That is exactly something I&#39;m looking for. I found the examples I need:  <a href=\"https://github.com/cbergoon/merkletree/blob/master/merkle_tree.go\" rel=\"nofollow noreferrer\">github.com/cbergoon/merkletree/blob/master/merkle_tree.go</a> <a href=\"https://en.wikipedia.org/wiki/Merkle_tree\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Merkle_tree</a>. I will mark it as answer."}], "answers": [{"tags": [], "owner": {"reputation": 126, "user_id": 2537478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed50870bf017c9ca2199481f2515c3e8?s=128&d=identicon&r=PG", "display_name": "Natanael", "link": "https://stackoverflow.com/users/2537478/natanael"}, "is_accepted": true, "score": 1, "last_activity_date": 1554674733, "creation_date": 1554674733, "answer_id": 55564098, "question_id": 55554802, "link": "https://stackoverflow.com/questions/55554802/how-to-use-nacl-to-sign-a-large-file/55564098#55564098", "title": "How to use NaCl to sign a large file?", "body": "<p>For signing very large files (multiple gigabytes and up), the problem of using a standard signing function is often runtime and fragility. For very large files (or just slow disks) it could perhaps take hours or more just to serially read the full file from start to end. </p>\n\n<p>In such cases, you want a way to process the file in parallel. One of the common ways to do this which is suitable for cryptographic signatures is Merkle tree hashes. They allow you to split the large file into smaller chunks, hash them in parallel (producing \"leaf hashes\"), and then further hash those hashes in a tree structure to produce a root hash which represents the full file.</p>\n\n<p>Once you have calculated this Merkle tree root hash, you can sign this root hash. It then becomes possible to use the signed Merkle tree root hash to verify all of the file chunks in parallel, as well as verifying their order (based on the positions of the leaf hashes in the tree structure). </p>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 4733013, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sE9rOdYazqk/AAAAAAAAAAI/AAAAAAAAV2M/0ra0U3_2l7c/photo.jpg?sz=128", "display_name": "Holloway Kean Ho", "link": "https://stackoverflow.com/users/4733013/holloway-kean-ho"}, "edited": false, "score": 0, "creation_date": 1554675271, "post_id": 55564099, "comment_id": 97827992, "body": "thanks for the answer. Indeed the message must be in the RAM. Markus tree algorithm will produce a single root shasum which I then can sign with (smaller, less stress on cpu due to NaCL sign, and the best part, facilitate streaming across network too). I will go with that direction."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 31, "user_id": 4733013, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sE9rOdYazqk/AAAAAAAAAAI/AAAAAAAAV2M/0ra0U3_2l7c/photo.jpg?sz=128", "display_name": "Holloway Kean Ho", "link": "https://stackoverflow.com/users/4733013/holloway-kean-ho"}, "edited": false, "score": 0, "creation_date": 1554675409, "post_id": 55564099, "comment_id": 97828022, "body": "@HollowayKeanHo Why must it be in RAM? You can copy about any io.Reader into the hash."}, {"owner": {"reputation": 31, "user_id": 4733013, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sE9rOdYazqk/AAAAAAAAAAI/AAAAAAAAV2M/0ra0U3_2l7c/photo.jpg?sz=128", "display_name": "Holloway Kean Ho", "link": "https://stackoverflow.com/users/4733013/holloway-kean-ho"}, "edited": false, "score": 0, "creation_date": 1554675976, "post_id": 55564099, "comment_id": 97828137, "body": "the final input (the shasum signature) into NaCL must be in RAM for faster processing."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 31, "user_id": 4733013, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sE9rOdYazqk/AAAAAAAAAAI/AAAAAAAAV2M/0ra0U3_2l7c/photo.jpg?sz=128", "display_name": "Holloway Kean Ho", "link": "https://stackoverflow.com/users/4733013/holloway-kean-ho"}, "edited": false, "score": 0, "creation_date": 1554881105, "post_id": 55564099, "comment_id": 97908537, "body": "@HollowayKeanHo Read the code. The shasum is in RAM."}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 1, "last_activity_date": 1554675234, "last_edit_date": 1554675234, "creation_date": 1554674747, "answer_id": 55564099, "question_id": 55554802, "link": "https://stackoverflow.com/questions/55554802/how-to-use-nacl-to-sign-a-large-file/55564099#55564099", "title": "How to use NaCl to sign a large file?", "body": "<p>The problem with NaCl is that you need to put the whole message into RAM, <a href=\"https://godoc.org/golang.org/x/crypto/nacl/sign\" rel=\"nofollow noreferrer\">as per godoc</a>:</p>\n\n<blockquote>\n  <p>Messages should be small because: 1. The whole message needs to be held in memory to be processed. 2. Using large messages pressures implementations on small machines to process plaintext without verifying the signature. This is very dangerous, and this API discourages it, but a protocol that uses excessive message sizes might present some implementations with no other choice. 3. Performance may be improved by working with messages that fit into data caches. Thus large amounts of data should be chunked so that each message is small.</p>\n</blockquote>\n\n<p>However, there are various other methods. Most of them basically do what you described in the first way. You basically copy the file contents into an <code>io.Writer</code> which takes the contents and calculates the hash sum - this is most efficient.</p>\n\n<p>The code below is pretty hacked, but you should get the picture.\nI achieved an average throughput of 315MB/s with it.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/ecdsa\"\n    \"crypto/elliptic\"\n    \"crypto/rand\"\n    \"crypto/sha256\"\n    \"flag\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"math/big\"\n    \"os\"\n    \"time\"\n)\n\nvar filename = flag.String(\"file\", \"\", \"file to sign\")\n\nfunc main() {\n    flag.Parse()\n\n    if *filename == \"\" {\n        log.Fatal(\"file can not be empty\")\n    }\n\n    f, err := os.Open(*filename)\n    if err != nil {\n        log.Fatalf(\"Error opening '%s': %s\", *filename, err)\n    }\n    defer f.Close()\n\n    start := time.Now()\n    sum, n, err := hash(f)\n    duration := time.Now().Sub(start)\n    log.Printf(\"Hashed %s (%d bytes)in %s to %x\", *filename, n, duration, sum)\n\n    log.Printf(\"Average: %.2f MB/s\", (float64(n)/1000000)/duration.Seconds())\n\n    r, s, err := sign(sum)\n    if err != nil {\n        log.Fatalf(\"Error creatig signature: %s\", err)\n    }\n\n    log.Printf(\"Signature: (0x%x,0x%x)\\n\", r, s)\n\n}\n\nfunc sign(sum []byte) (*big.Int, *big.Int, error) {\n    priv, err := ecdsa.GenerateKey(elliptic.P256(), rand.Reader)\n    if err != nil {\n        log.Printf(\"Error creating private key: %s\", err)\n    }\n\n    return ecdsa.Sign(rand.Reader, priv, sum[:])\n\n}\n\nfunc hash(f *os.File) ([]byte, int64, error) {\n    var (\n        hash []byte\n        n    int64\n        err  error\n    )\n\n    h := sha256.New()\n\n    // This is where the magic happens.\n    // We use the efficient io.Copy to feed the contents\n    // of the file into the hash function.\n    if n, err = io.Copy(h, f); err != nil {\n        return nil, n, fmt.Errorf(\"Error creating hash: %s\", err)\n    }\n    hash = h.Sum(nil)\n    return hash, n, nil\n}\n</code></pre>\n"}], "migrated_from": {"other_site": {"aliases": ["http://cryptography.stackexchange.com"], "markdown_extensions": ["MathJax"], "launch_date": 1435671420, "open_beta_date": 1312315906, "closed_beta_date": 1310497200, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/crypto/Img/apple-touch-icon@2.png", "twitter_account": "StackCrypto", "favicon_url": "https://cdn.sstatic.net/Sites/crypto/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/crypto/Img/apple-touch-icon.png", "audience": "software developers, mathematicians and others interested in cryptography", "site_url": "https://crypto.stackexchange.com", "api_site_parameter": "crypto", "logo_url": "https://cdn.sstatic.net/Sites/crypto/Img/logo.png", "name": "Cryptography", "site_type": "main_site"}, "on_date": 1554599313, "question_id": 68590}, "owner": {"reputation": 31, "user_id": 4733013, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sE9rOdYazqk/AAAAAAAAAAI/AAAAAAAAV2M/0ra0U3_2l7c/photo.jpg?sz=128", "display_name": "Holloway Kean Ho", "link": "https://stackoverflow.com/users/4733013/holloway-kean-ho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 55564098, "answer_count": 2, "score": 2, "last_activity_date": 1554681282, "creation_date": 1554598948, "last_edit_date": 1554681282, "question_id": 55554802, "link": "https://stackoverflow.com/questions/55554802/how-to-use-nacl-to-sign-a-large-file", "title": "How to use NaCl to sign a large file?", "body": "<p>Given the sign capability from Go NaCl library (<a href=\"https://github.com/golang/crypto/tree/master/nacl/sign\" rel=\"nofollow noreferrer\">https://github.com/golang/crypto/tree/master/nacl/sign</a>), how to sign a file, especially, a very large file as big as more than 1GB? Most of the internet search results are all about signing a slice or small array of bytes.</p>\n\n<p>I can think of 2 ways:</p>\n\n<ol>\n<li>Loop through the file and stream in a block manner (e.g. 16k each time), then feed it into the sign function. The streamed output are concatenated into a signature certificate. For verification, it is done reversely.</li>\n<li>Use SHA(X) to generate the shasum of the file and then sign the shasum output.</li>\n</ol>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 1, "creation_date": 1554600118, "post_id": 55554772, "comment_id": 97810771, "body": "There may not be a GoLang example, but the connection URI format is handled <b>exactly the same</b> for <b>ALL</b> languages. Common <i>&quot;language tutorials&quot;</i> generally only give examples on the presumption that you are connecting to a local instance of MongoDB. The majority of answers I post here also only show a local connection string and without credentials, but that does not make them <i>invalid</i> for usage with a remote host and with credentials. You simply swap in the contents of the URI. And <b>that</b> in fact has <b>many</b> existing answers and examples."}, {"owner": {"reputation": 273, "user_id": 4256748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac027c2b12eb957c1eb0813bc6f4bd7d?s=128&d=identicon&r=PG&f=1", "display_name": "ZacSketches", "link": "https://stackoverflow.com/users/4256748/zacsketches"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1554601375, "post_id": 55554772, "comment_id": 97810903, "body": "@NeilLunn I appreciate that the answer you link to is similar, but in many ways it is different &amp; I think this question stands on its own as a contribution to both Atlas and the mongo-go-driver.  Specific differences: (1) the other question uses the mgo driver in the question and the mongo-go-driver is only discussed in one of the answers; (2) the other question about a more complex connection using SRV whereas this question is about a basic connection that serves beginners more clearly, (3) this question provides a fully worked answer.  I kindly ask that you remove your duplicate assignment."}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 1, "creation_date": 1554601645, "post_id": 55554772, "comment_id": 97810936, "body": "Not very different at all. In fact it&#39;s the official MongoDB Go driver ( second part of answer even thought the question uses mgo) and actually the recommended way to connect. And like I said it&#39;s just <b>one of many</b>. People have been using a connection URI for many years now."}], "answers": [{"comments": [{"owner": {"reputation": 12410, "user_id": 650424, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/17b6cb58e7de35e82f094681aa5321c5?s=128&d=identicon&r=PG", "display_name": "Cmag", "link": "https://stackoverflow.com/users/650424/cmag"}, "edited": false, "score": 0, "creation_date": 1570425762, "post_id": 55554773, "comment_id": 102895669, "body": "any way to auto-discover the host?   I have a feeling Mongo would prefer us to use the atlas connection string and the host that has, vs trying to create individual host connections.    i.e. what if you have a more than 1 mongo host?"}], "tags": [], "owner": {"reputation": 273, "user_id": 4256748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac027c2b12eb957c1eb0813bc6f4bd7d?s=128&d=identicon&r=PG&f=1", "display_name": "ZacSketches", "link": "https://stackoverflow.com/users/4256748/zacsketches"}, "is_accepted": true, "score": 3, "last_activity_date": 1554598832, "last_edit_date": 1592644375, "creation_date": 1554598832, "answer_id": 55554773, "question_id": 55554772, "link": "https://stackoverflow.com/questions/55554772/how-do-you-connect-to-mongodb-atlas-with-the-official-mongo-go-driver/55554773#55554773", "title": "How do you connect to MongoDB Atlas with the official mongo-go-driver", "body": "<p>I am hosting my test Atlas cluster on AWS so I wanted to have similar credential management to the AWS process. From the <a href=\"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html\" rel=\"nofollow noreferrer\">AWS credentials page</a>:</p>\n<blockquote>\n<p>The default provider chain looks for credentials in the following order:</p>\n<ol>\n<li><p>Environment variables.</p>\n</li>\n<li><p>Shared credentials file.</p>\n</li>\n<li><p>If your application is running on an Amazon EC2 instance, IAM role for Amazon EC2.</p>\n</li>\n</ol>\n</blockquote>\n<p>Therefore, I wanted to implement the environment veriable for my simple login to Atlas example.  Code below assumes that the following line has been issued at the command line</p>\n<p><code>export MONGO_PW='&lt;your Atlas admin user password&gt;'</code></p>\n<p>Then the following program will verify your connection</p>\n<pre><code>package main\n\nimport (\n    &quot;context&quot;\n    &quot;fmt&quot;\n    &quot;os&quot;\n\n    &quot;go.mongodb.org/mongo-driver/mongo&quot;\n    &quot;go.mongodb.org/mongo-driver/mongo/options&quot;\n)\n\nvar username = &quot;&lt;username&gt;&quot;\nvar host1 = &quot;&lt;atlas host&gt;&quot;  // of the form foo.mongodb.net\n\nfunc main() {\n\n    ctx := context.TODO()\n\n    pw, ok := os.LookupEnv(&quot;MONGO_PW&quot;)\n    if !ok {\n        fmt.Println(&quot;error: unable to find MONGO_PW in the environment&quot;)\n        os.Exit(1)\n    }\n    mongoURI := fmt.Sprintf(&quot;mongodb+srv://%s:%s@%s&quot;, username, pw, host1)\n    fmt.Println(&quot;connection string is:&quot;, mongoURI)\n\n    // Set client options and connect\n    clientOptions := options.Client().ApplyURI(mongoURI)\n    client, err := mongo.Connect(ctx, clientOptions)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n\n    err = client.Ping(ctx, nil)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n\n    fmt.Println(&quot;Connected to MongoDB!&quot;)\n}\n\n</code></pre>\n<p>From here the rest of the tutorial linked in my original question goes smoothly.</p>\n"}], "owner": {"reputation": 273, "user_id": 4256748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac027c2b12eb957c1eb0813bc6f4bd7d?s=128&d=identicon&r=PG&f=1", "display_name": "ZacSketches", "link": "https://stackoverflow.com/users/4256748/zacsketches"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2933, "favorite_count": 0, "closed_date": 1554600270, "accepted_answer_id": 55554773, "answer_count": 1, "score": 1, "last_activity_date": 1554598832, "creation_date": 1554598832, "question_id": 55554772, "link": "https://stackoverflow.com/questions/55554772/how-do-you-connect-to-mongodb-atlas-with-the-official-mongo-go-driver", "closed_reason": "Duplicate", "title": "How do you connect to MongoDB Atlas with the official mongo-go-driver", "body": "<p>I'm looking at the <a href=\"https://www.mongodb.com/blog/post/mongodb-go-driver-tutorial-part-1-connecting-using-bson-and-crud-operations\" rel=\"nofollow noreferrer\">tutorial</a> offered in conjunction with the release of the official <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">mongo-go-driver</a> and the connection example uses a MongoDB server on <code>localhost</code></p>\n\n<pre><code>// Set client options\nclientOptions := options.Client().ApplyURI(\"mongodb://localhost:27017\")\n</code></pre>\n\n<p>However, the new hosted MongoDB service <a href=\"https://www.mongodb.com/cloud/atlas\" rel=\"nofollow noreferrer\">Atlas</a> requires username and password to login. The connection string takes the format </p>\n\n<pre><code>mongodb://[username:password@]host1[/[database][?options]]\n</code></pre>\n\n<p>but there is no Golang example in the <a href=\"https://docs.atlas.mongodb.com/driver-connection/#driver-examples\" rel=\"nofollow noreferrer\">driver examples for Atlas</a>.</p>\n\n<p>So I'm wondering, what is the best way to log into Atlas without hard coding a password into a source file that will be posted on Github?</p>\n"}, {"tags": ["json", "go", "marshalling"], "comments": [{"owner": {"reputation": 1914, "user_id": 9811969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/184e2e46b8d8b8c483c85589709b8563?s=128&d=identicon&r=PG&f=1", "display_name": "Nik", "link": "https://stackoverflow.com/users/9811969/nik"}, "edited": false, "score": 0, "creation_date": 1554598650, "post_id": 55554434, "comment_id": 97810596, "body": "What is <code>blockchain</code>? Could you provide the initialization of the variable? May relate to <a href=\"https://stackoverflow.com/q/3010357/9811969\">stackoverflow.com/q/3010357/9811969</a>"}, {"owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "reply_to_user": {"reputation": 1914, "user_id": 9811969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/184e2e46b8d8b8c483c85589709b8563?s=128&d=identicon&r=PG&f=1", "display_name": "Nik", "link": "https://stackoverflow.com/users/9811969/nik"}, "edited": false, "score": 0, "creation_date": 1554602435, "post_id": 55554434, "comment_id": 97811040, "body": "I don&#39;t see how this could be cyclic. There is only one blockchain, containing many blocks."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1554615568, "post_id": 55554434, "comment_id": 97812842, "body": "The question is how many blocks? If you want to read in for example all bitcoin blocks ever created. You will need really a lot of memory."}, {"owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1554616680, "post_id": 55554434, "comment_id": 97813017, "body": "The error happens with 3, yes three, blocks so it must not be related to this little chain."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 1, "creation_date": 1554619865, "post_id": 55554434, "comment_id": 97813568, "body": "So let&#39;s try to get this error in the playground. My example works: <a href=\"https://play.golang.org/p/sVswvtR-aaH\" rel=\"nofollow noreferrer\">play.golang.org/p/sVswvtR-aaH</a> What is different there? Try to create the error inside the playground."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1554619933, "post_id": 55554434, "comment_id": 97813581, "body": "Something else: When searching for an error you should not print the error with <code>panic</code>. Use <code>fmt.Print</code> instead."}, {"owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1554661942, "post_id": 55554434, "comment_id": 97824508, "body": "Playground, Good idea! Here it is: <a href=\"https://play.golang.org/p/Dtf14gfGByq\" rel=\"nofollow noreferrer\">play.golang.org/p/Dtf14gfGByq</a> If you un comment lines 149-155 the error appears."}], "answers": [{"comments": [{"owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1554668718, "post_id": 55562674, "comment_id": 97826392, "body": "I see, very cool! Now, last issue. I need to have the output as valid <code>Json</code>. None of this <code>main.Blockchain{Blocks:[]main.Block{main.Block{Index:1</code> is valid <code>Json</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1554669995, "post_id": 55562674, "comment_id": 97826721, "body": "The output is valid JSON. I edited the program to make it easier to spot the JSON."}, {"owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1554671044, "post_id": 55562674, "comment_id": 97827001, "body": "I put the whole string <code>main.Blockchain{Blocks:[]main.Block{main.Block{Index:1, Timestamp:&quot;2009-11-10 23:00:00&quot;, Data:...</code> into <a href=\"https://jsonlint.com\" rel=\"nofollow noreferrer\">jsonlint.com</a> and it just lit up with errors."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1554673243, "post_id": 55562674, "comment_id": 97827531, "body": "@pigfox The program prints more than JSON. Copy and check the JSON only."}, {"owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1554685776, "post_id": 55562674, "comment_id": 97829685, "body": "I noticed and fixed! @Cerise Limon - Thank you!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1554669853, "last_edit_date": 1554669853, "creation_date": 1554664290, "answer_id": 55562674, "question_id": 55554434, "link": "https://stackoverflow.com/questions/55554434/golang-runtime-goroutine-stack-exceeds-1000000000-byte-limit/55562674#55562674", "title": "Golang runtime: goroutine stack exceeds 1000000000-byte limit", "body": "<p>The program runs out of stack space because the <code>Blockchain.MarshalJSON</code> method and <code>json.Marshal</code> function call each other recursively.  </p>\n\n<p>Fix by deleting <code>Blockchain.MarshalJSON</code> method. The method is not needed.</p>\n\n<p><a href=\"https://play.golang.org/p/vvXvRnRIpWL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vvXvRnRIpWL</a></p>\n"}], "owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1926, "favorite_count": 0, "accepted_answer_id": 55562674, "answer_count": 1, "score": -2, "last_activity_date": 1554669853, "creation_date": 1554594233, "last_edit_date": 1592644375, "question_id": 55554434, "link": "https://stackoverflow.com/questions/55554434/golang-runtime-goroutine-stack-exceeds-1000000000-byte-limit", "title": "Golang runtime: goroutine stack exceeds 1000000000-byte limit", "body": "<p>I get this error when I try to <code>Marshall</code> an object of nested structs.\nMy structs look like:</p>\n<pre><code>type Blockchain struct{\n    blocks []Block `json:&quot;blocks&quot;`\n    difficulty int `json:&quot;difficulty&quot;`\n}\n\ntype Block struct{\n    index int `json:&quot;index&quot;`\n    timestamp string `json:&quot;timestamp&quot;`\n    data string `json:&quot;data&quot;`\n    previousHash string `json:&quot;previousHash&quot;`\n    hash string `json:&quot;hash&quot;`\n    nonce int `json:&quot;nonce&quot;`\n}\n</code></pre>\n<p>When I try to inspect my structure with:</p>\n<pre><code>b, err := json.Marshal(blockchain)\nif err != nil {\n    panic(err)\n}\nfmt.Println(string(b))\n</code></pre>\n<p>I get:</p>\n<blockquote>\n<p>runtime: goroutine stack exceeds 1000000000-byte limit</p>\n<p>fatal error: stack overflow</p>\n<p>runtime stack:</p>\n<p>runtime.throw(0x4e4094, 0xe)</p>\n</blockquote>\n<p>Also, when initializing</p>\n<pre><code>var blockchain = new(Blockchain)\n\nfunc (blockchain *Blockchain) AddBlock(block Block) []Block {\n    block.previousHash = latestBlock().hash\n    blockchain.blocks = append(blockchain.blocks, mineBlock(blockchain.difficulty))\n    return blockchain.blocks\n}\n\nfunc latestBlock() Block{\n    return blockchain.blocks[len(blockchain.blocks)-1]\n}\n</code></pre>\n<p>When I do:</p>\n<pre><code>var s = fmt.Sprintf(&quot;%#+v&quot;, *blockchain)\nprint(s)\n</code></pre>\n<p>I get:</p>\n<pre><code>main.Blockchain{blocks:[]main.Block{main.Block{index:1, timestamp:&quot;2019-04-06 19:21:37&quot;, data:&quot;Genesis block&quot;, previousHash:&quot;&quot;, hash:&quot;54baff26aa7411352c7879c4ad4bdb86cae07d667d1ed1962225bf0f464f78a0&quot;, nonce:0}, main.Block{index:2, timestamp:&quot;2019-04-06 19:21:37&quot;, data:&quot;d.duck&quot;, previousHash:&quot;54baff26aa7411352c7879c4ad4bdb86cae07d667d1ed1962225bf0f464f78a0&quot;, hash:&quot;c4e5d38c907c5b5db77f651880121ebbcb75b1c26d476071d9d69e4ae70e6a11&quot;, nonce:1}, main.Block{index:3, timestamp:&quot;2019-04-06 19:21:37&quot;, data:&quot;dumbo&quot;, previousHash:&quot;c4e5d38c907c5b5db77f651880121ebbcb75b1c26d476071d9d69e4ae70e6a11&quot;, hash:&quot;12c3f3595ce28923204c87a6e244ec66c34a7efb13a3acd3b6b57cea75a629d8&quot;, nonce:2}, main.Block{index:4, timestamp:&quot;2019-04-06 19:21:37&quot;, data:&quot;clown&quot;, previousHash:&quot;12c3f3595ce28923204c87a6e244ec66c34a7efb13a3acd3b6b57cea75a629d8&quot;, hash:&quot;8907be04c22ed0bc1d7d7b7ce13cf86f11f6fb3261ee34aaafc1fe6a703320b5&quot;, nonce:3}, main.Block{index:5, timestamp:&quot;2019-04-06 19:21:37&quot;, data:&quot;cod&quot;, previousHash:&quot;8907be04c22ed0bc1d7d7b7ce13cf86f11f6fb3261ee34aaafc1fe6a703320b5&quot;, hash:&quot;2d514943c6d86940dfca66e720c2aeade7de1fa1a053d36f81cbb134c02d0f26&quot;, nonce:4}, main.Block{index:6, timestamp:&quot;2019-04-06 19:21:37&quot;, data:&quot;omaha, omaha&quot;, previousHash:&quot;2d514943c6d86940dfca66e720c2aeade7de1fa1a053d36f81cbb134c02d0f26&quot;, hash:&quot;ef630c9a270a0ac52a2f5a0e2821ea91807b2471e4e4f7204c2edb4f44dd231b&quot;, nonce:5}, main.Block{index:7, timestamp:&quot;2019-04-06 19:21:37&quot;, data:&quot;double&quot;, previousHash:&quot;ef630c9a270a0ac52a2f5a0e2821ea91807b2471e4e4f7204c2edb4f44dd231b&quot;, hash:&quot;0c72339be0b54f7e87fcf48adf13f1d3b0e00ba56660906e8283758a74591ca3&quot;, nonce:6}, main.Block{index:8, timestamp:&quot;2019-04-06 19:21:37&quot;, data:&quot;fake&quot;, previousHash:&quot;0c72339be0b54f7e87fcf48adf13f1d3b0e00ba56660906e8283758a74591ca3&quot;, hash:&quot;ca31e0372579f0bfb00ac2ddb2127de0dff4d500f7dd6c507db7439380a40862&quot;, nonce:7}, main.Block{index:9, timestamp:&quot;2019-04-06 19:21:37&quot;, data:&quot;reverse&quot;, previousHash:&quot;ca31e0372579f0bfb00ac2ddb2127de0dff4d500f7dd6c507db7439380a40862&quot;, hash:&quot;ce4a1386c3aa9e45d1a5d5d3cc5a7d9d0b4e0e2d153a7c9518369a3ee65d5368&quot;, nonce:8}}, difficulty:4}\n</code></pre>\n<p>The keys and fields are visible but the keys are not enclosed in double quotes like the values are.</p>\n<p>Updated the structs to have exportable fields.</p>\n<pre><code>type Blockchain struct{\n    Blocks []Block `json:&quot;blocks&quot;`\n    Difficulty int `json:&quot;difficulty&quot;`\n}\n\ntype Block struct{\n    Index int `json:&quot;index&quot;`\n    Timestamp string `json:&quot;timestamp&quot;`\n    Data string `json:&quot;data&quot;`\n    PreviousHash string `json:&quot;previousHash&quot;`\n    Hash string `json:&quot;hash&quot;`\n    Nonce int `json:&quot;nonce&quot;`\n}\n</code></pre>\n<p>When trying the same Marshal again I get the same error.</p>\n"}, {"tags": ["go", "github", "redis", "package"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 8, "last_activity_date": 1554591666, "last_edit_date": 1554591666, "creation_date": 1554585725, "answer_id": 55553581, "question_id": 55553553, "link": "https://stackoverflow.com/questions/55553553/how-to-pass-array-of-keys-to-mget-func-in-go-redis-package/55553581#55553581", "title": "how to pass array of keys to MGET func in go-redis package?", "body": "<p>Create a slice of strings with the keys. Call the function using <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"noreferrer\">variadic syntax</a>:</p>\n\n<pre><code>var keys []string\nkeys = append(keys, \"foo\")\nkeys = append(keys, \"bar\")\nsc := client.MGet(keys...)\n</code></pre>\n\n<p>The same approach works with Redigo, but use a slice of interface instead of a slice of strings:</p>\n\n<pre><code>var keys []interface{}\nkeys = append(keys, \"foo\")\nkeys = append(keys, \"bar\")\nr, err := conn.Do(\"MGET\", keys...)\n</code></pre>\n"}], "owner": {"reputation": 174, "user_id": 8851586, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Ycu_fMxp-6o/AAAAAAAAAAI/AAAAAAAAAAk/vtL002j3ynI/photo.jpg?sz=128", "display_name": "Gholamreza Eghbali", "link": "https://stackoverflow.com/users/8851586/gholamreza-eghbali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2491, "favorite_count": 0, "accepted_answer_id": 55553581, "answer_count": 1, "score": 5, "last_activity_date": 1554591666, "creation_date": 1554585454, "question_id": 55553553, "link": "https://stackoverflow.com/questions/55553553/how-to-pass-array-of-keys-to-mget-func-in-go-redis-package", "title": "how to pass array of keys to MGET func in go-redis package?", "body": "<p>I'm using go-redis package (also tried redigo) and want to get multiple values, it seems I must use <code>MGET()</code> function but function input is like <code>(keys ...string)</code> , is there any way so I can build an array of keys and pass to the function or any other hacky way to do this? in my case,the number of keys(and also keys) are not fixed and want to handle it dynamically</p>\n"}, {"tags": ["go", "jira", "custom-fields", "jira-rest-api", "jira-rest-java-api"], "answers": [{"tags": [], "owner": {"reputation": 35, "user_id": 6504462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e79024241e45fe2f23ac310cf60d9c?s=128&d=identicon&r=PG&f=1", "display_name": "Jukie", "link": "https://stackoverflow.com/users/6504462/jukie"}, "is_accepted": false, "score": 0, "last_activity_date": 1554681611, "creation_date": 1554681611, "answer_id": 55564724, "question_id": 55553533, "link": "https://stackoverflow.com/questions/55553533/convert-string-response-to-map-in-golang/55564724#55564724", "title": "Convert string response to map in golang", "body": "<p>I figured it out, type assertion is the way to solve this.</p>\n\n<pre><code>func getsomedata(issue_id string) {\n    issue, _, _ := jiraClient.Issue.Get(issue_id, nil)\n\n    // This returns as a slice of interfaces []interfaces{}\n    data := issue.Fields.Unknowns[\"customfield_12345\"]\n\n    // Will use the length of the slice in the for loop below\n    s := reflect.ValueOf(data)\n\n    // For each index index in the slice, do...\n    for i := 0; i &lt; s.Len(); i++ {\n        // Use type assertion to get the value I need for all indexes \"i\"\n        d := data.([]interface{})[i].(map[string]interface{})\n        fmt.Printf(\"%v\\n\", d[\"key\"].(string))\n    }\n} \n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 6504462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e79024241e45fe2f23ac310cf60d9c?s=128&d=identicon&r=PG&f=1", "display_name": "Jukie", "link": "https://stackoverflow.com/users/6504462/jukie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 209, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1554681611, "creation_date": 1554585223, "last_edit_date": 1554588567, "question_id": 55553533, "link": "https://stackoverflow.com/questions/55553533/convert-string-response-to-map-in-golang", "title": "Convert string response to map in golang", "body": "<p>I'm using <a href=\"https://godoc.org/github.com/andygrunwald/go-jira#IssueService.GetCustomFields\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/andygrunwald/go-jira#IssueService.GetCustomFields</a> to get a custom field and I'm attempting to consume some of the data. </p>\n\n<pre><code>func getsomedata(issue_id string) {\n    issue, _, _ := jiraClient.Issue.Get(issue_id, nil)\n    fields, _, _ := jiraClient.Issue.GetCustomFields(issue_id)\n    data := fields[\"customfield_123456\"]\n}\n</code></pre>\n\n<p>Something similar to the following (unformatted) is returned as a single string, how can I convert this back into a struct or map? The end goal is to store \"key.value\" and \"name.value\"</p>\n\n<pre><code>[\n  map[\n    key:key.value\n    name:name.value\n  ]\n  map[\n    key:key.value\n    name:name.value\n  ]\n]\n</code></pre>\n"}, {"tags": ["go", "heroku", "migrate", "go-modules"], "comments": [{"owner": {"reputation": 91778, "user_id": 354577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dI6cA.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/354577/chris"}, "edited": false, "score": 0, "creation_date": 1554590411, "post_id": 55553485, "comment_id": 97809304, "body": "What tool are you using for your migrations? <a href=\"https://github.com/steinbacher/goose\" rel=\"nofollow noreferrer\">goose</a>? Is <code>goose</code> in an interactive <code>heroku run</code> session?"}, {"owner": {"reputation": 91778, "user_id": 354577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dI6cA.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/354577/chris"}, "edited": false, "score": 0, "creation_date": 1554590962, "post_id": 55553485, "comment_id": 97809393, "body": "That should be &quot;Is <code>goose</code> <i>available</i> in an interactive <code>heroku run</code> session.&quot;"}, {"owner": {"reputation": 119, "user_id": 4516210, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-d1FS4LKdL5U/AAAAAAAAAAI/AAAAAAAAAA4/WCeKCZgYavM/photo.jpg?sz=128", "display_name": "Francisco Rangel", "link": "https://stackoverflow.com/users/4516210/francisco-rangel"}, "reply_to_user": {"reputation": 91778, "user_id": 354577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dI6cA.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/354577/chris"}, "edited": false, "score": 0, "creation_date": 1554603669, "post_id": 55553485, "comment_id": 97811211, "body": "You&#39;re right, forgot to add that. I&#39;m using <a href=\"https://github.com/golang-migrate/migrate\" rel=\"nofollow noreferrer\">migrate</a> @Chris . In an interactive session I don&#39;t really have the migrate command, I&#39;m also not doing anything special for it to be available though, that&#39;s what I would like to know how to do"}], "answers": [{"tags": [], "owner": {"reputation": 91778, "user_id": 354577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dI6cA.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/354577/chris"}, "is_accepted": false, "score": 1, "last_activity_date": 1554613056, "creation_date": 1554613056, "answer_id": 55555760, "question_id": 55553485, "link": "https://stackoverflow.com/questions/55553485/run-migrations-when-deploying-golang-application-to-heroku/55555760#55555760", "title": "Run migrations when deploying golang application to Heroku", "body": "<p>All of your dependencies should be defined such that Heroku can install them for you. For Go, Heroku supports <a href=\"https://devcenter.heroku.com/articles/go-dependencies-via-godep\" rel=\"nofollow noreferrer\">godep</a> and <a href=\"https://devcenter.heroku.com/articles/go-dependencies-via-govendor\" rel=\"nofollow noreferrer\">govendor</a>. If you're not already using one, pick one and start.</p>\n\n<p>Your dependency file should be committed to your repository. For godep that's <code>Godeps/Godeps.json</code> and for govendor it's <code>vendor/vendor.json</code>. Your dependencies themselves should <em>not</em> be committed.</p>\n\n<p>After you've added a dependency on <code>migrate</code> it should be available on Heroku. You can run <code>migrate up</code> and other commands via <code>heroku run bash</code>. Once you're comfortable running migrations manually you might want to consider adding a <a href=\"https://devcenter.heroku.com/articles/release-phase\" rel=\"nofollow noreferrer\">release phase command</a> to your <code>Procfile</code> so migrations get applied automatically when you deploy a new version.</p>\n"}], "owner": {"reputation": 119, "user_id": 4516210, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-d1FS4LKdL5U/AAAAAAAAAAI/AAAAAAAAAA4/WCeKCZgYavM/photo.jpg?sz=128", "display_name": "Francisco Rangel", "link": "https://stackoverflow.com/users/4516210/francisco-rangel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 407, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1554613183, "creation_date": 1554584809, "last_edit_date": 1554613183, "question_id": 55553485, "link": "https://stackoverflow.com/questions/55553485/run-migrations-when-deploying-golang-application-to-heroku", "title": "Run migrations when deploying golang application to Heroku", "body": "<p>I've been trying to set up migrations for a golang application on Heroku. I'm using native Go modules (vgo) and the official Heroku build pack. For migrations I'm using the <a href=\"https://github.com/golang-migrate/migrate\" rel=\"nofollow noreferrer\">migrate</a> package.</p>\n\n<p>The thing is, I could run migrations when the main function runs, but it feels a bit hacky, this would mean that every time the app restarts it will run the migrations. I would prefer to just run the schema migration when deploying.</p>\n\n<p>I'm not sure how this can be accomplished, when I log in to the instance the go binary is not installed, it's like the build pack only executes the main function. </p>\n\n<p>I could live with doing it with a Heroku CLI command but I can't find how to do this in the docs nor via Google.</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1554584944, "post_id": 55553332, "comment_id": 97808145, "body": "I tried this: ``` \tv, err := json.Marshal(&amp;blockchain) \tif err != nil { \t\tpanic(err.Error) \t} \tfmt.Println(string(v)) ``` Got this: ``` runtime: goroutine stack exceeds 1000000000-byte limit fatal error: stack overflow  ```"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1554586854, "post_id": 55553332, "comment_id": 97808581, "body": "@pigfox The code in the answer <a href=\"https://play.golang.org/p/v87C7fJC6MJ\" rel=\"nofollow noreferrer\">runs without error</a>.  Do the types in the question have any methods?"}, {"owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1554588849, "post_id": 55553332, "comment_id": 97809007, "body": "No, they do not not. The difference between the answer which uses a hard coded struct and my issue is that I have a pointer to a struct as you can see in my example above. json.Marshal(*blockchain)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1554664449, "post_id": 55553332, "comment_id": 97825196, "body": "@pigfox One of the types <b>does</b> have a method based on your comments in another question.  That method that is the cause of the problem.  In the future, please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}], "tags": [], "owner": {"reputation": 88487, "user_id": 6508, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6baa1023a5f700292f7e9791311e7f7a?s=128&d=identicon&r=PG", "display_name": "Jorge Ferreira", "link": "https://stackoverflow.com/users/6508/jorge-ferreira"}, "is_accepted": false, "score": 1, "last_activity_date": 1554583612, "creation_date": 1554583612, "answer_id": 55553332, "question_id": 55552918, "link": "https://stackoverflow.com/questions/55552918/string-from-struct-pointer/55553332#55553332", "title": "String from struct pointer", "body": "<p>The fields on structs need to be exported (start with capital letter). This is required because JSON marshalling uses reflection, and that requires the field to be exported (to be visible).</p>\n\n<p>Also <code>json.Marshal</code> first return value is the JSON.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\ntype Blockchain struct {\n    Blocks     []Block `json:\"blocks\"`\n    Difficulty int     `json:\"difficulty\"`\n}\n\ntype Block struct {\n    Index        int    `json:\"index\"`\n    Timestamp    string `json:\"timestamp\"`\n    Data         string `json:\"data\"`\n    PreviousHash string `json:\"previousHash\"`\n    Hash         string `json:\"hash\"`\n    Nonce        int    `json:\"nonce\"`\n}\n\nfunc main() {\n    bc := &amp;Blockchain{\n        Blocks: []Block{\n            Block{},\n        },\n        Difficulty: 1,\n    }\n    v, err := json.Marshal(bc)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(string(v))\n}\n</code></pre>\n\n<p>This prints:</p>\n\n<pre><code>{\"blocks\":[{\"index\":0,\"timestamp\":\"\",\"data\":\"\",\"previousHash\":\"\",\"hash\":\"\",\"nonce\":0}],\"difficulty\":1}\n</code></pre>\n"}], "owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1554583990, "creation_date": 1554580473, "last_edit_date": 1554583990, "question_id": 55552918, "link": "https://stackoverflow.com/questions/55552918/string-from-struct-pointer", "title": "String from struct pointer", "body": "<p>As a student of Go I encountered this problem.</p>\n\n<p>My ultimate goal of doing this is to convert <code>*blockchain</code> into a valid JSON string.</p>\n\n<p>My structs are:</p>\n\n<pre><code>type Blockchain struct{\n    blocks []Block `json:\"blocks\"`\n    difficulty int `json:\"difficulty\"`\n}\n\ntype Block struct{\n    index int `json:\"index\"`\n    timestamp string `json:\"timestamp\"`\n    data string `json:\"data\"`\n    previousHash string `json:\"previousHash\"`\n    hash string `json:\"hash\"`\n    nonce int `json:\"nonce\"`\n}   \n</code></pre>\n\n<p>I have the following code:</p>\n\n<pre><code>var s = fmt.Sprintf(\"%#v\", *blockchain)\nprint(s)\n</code></pre>\n\n<p>Which gives me the following:</p>\n\n<blockquote>\n  <p>main.Blockchain{blocks:[]main.Block{main.Block{index:1, timestamp:\"2019-04-06 12:50:54\", data:\"Genesis block\", previousHash:\"\", hash:\"eca16d7bdd20a91f471fc3231fa5de7d892fb540789673d64f29a7b93719b74b\", nonce:0}, main.Block{index:2, timestamp:\"2019-04-06 12:50:54\", data:\"d.duck\", previousHash:\"eca16d7bdd20a91f471fc3231fa5de7d892fb540789673d64f29a7b93719b74b\", hash:\"2096ccfa6fdd8305f0e31c2e6858173a21764be4c8e1d3d50c9c31193bf06a2a\", nonce:0}, main.Block{index:3, timestamp:\"2019-04-06 12:50:54\", data:\"dumbo\", previousHash:\"2096ccfa6fdd8305f0e31c2e6858173a21764be4c8e1d3d50c9c31193bf06a2a\", hash:\"d76d4a002c6dde01009e3122aa1ccfb455e1d453ac83e2a0eb123c6080943cdb\", nonce:0}}, difficulty:4}</p>\n</blockquote>\n\n<p>Obviously invalid JSON.</p>\n\n<p>Any suggestions?</p>\n\n<p>I also tried the following:</p>\n\n<pre><code>var json, err = json.Marshal(*blockchain)\n\nif err != nil{\n    panic(err.Error())\n}\nvar s = fmt.Sprintf(\"%#v\", json)\n\nprint(s)\n</code></pre>\n\n<p>It gave me the following:</p>\n\n<pre><code>[]byte{0x7b, 0x7d}\n</code></pre>\n"}, {"tags": ["go", "binary-search-tree", "trie"], "comments": [{"owner": {"reputation": 86, "user_id": 10005533, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fa7c0a25af1534a41ff68bdb3d6bdb1?s=128&d=identicon&r=PG", "display_name": "Oliver Jackman", "link": "https://stackoverflow.com/users/10005533/oliver-jackman"}, "edited": false, "score": 0, "creation_date": 1554583522, "post_id": 55552357, "comment_id": 97807836, "body": "I can&#39;t help with your algorithms, but have you checked out <a href=\"https://blevesearch.com/\" rel=\"nofollow noreferrer\">Bleve</a>?"}, {"owner": {"reputation": 95, "user_id": 8990391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8af6ab00586913e6491fbbf59a1a04f1?s=128&d=identicon&r=PG&f=1", "display_name": "Eduard Grigoryev", "link": "https://stackoverflow.com/users/8990391/eduard-grigoryev"}, "reply_to_user": {"reputation": 86, "user_id": 10005533, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fa7c0a25af1534a41ff68bdb3d6bdb1?s=128&d=identicon&r=PG", "display_name": "Oliver Jackman", "link": "https://stackoverflow.com/users/10005533/oliver-jackman"}, "edited": false, "score": 0, "creation_date": 1554588074, "post_id": 55552357, "comment_id": 97808856, "body": "Thanks for the comment. The fact is that I shouldn&#39;t use an existing solution to implement a full text search. And solution of my problem should definitely be easier than that of Bleve."}], "answers": [{"tags": [], "owner": {"reputation": 2503, "user_id": 7442673, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iTfit.jpg?s=128&g=1", "display_name": "m.raynal", "link": "https://stackoverflow.com/users/7442673/m-raynal"}, "is_accepted": true, "score": 0, "last_activity_date": 1554765579, "creation_date": 1554765579, "answer_id": 55583062, "question_id": 55552357, "link": "https://stackoverflow.com/questions/55552357/efficient-way-to-realize-full-text-search-in-golang/55583062#55583062", "title": "Efficient way to realize full text search in golang", "body": "<p>I can't really help you for the language specific part, but if it's of any help, here is a pseudocode that describes a Trie implementation along with a function to solve your current problem in a decently efficient manner.</p>\n\n<pre><code>struct TrieNode{\n    map[char] children      // maps character to children\n    set[int] contains       // set of all ids of documents that contain the word\n}\n\n// classic search function in trie, except it returns a set of document ids instead of a simple boolean\nfunction get_doc_ids(TrieNode node, string w, int depth){\n    if (depth == length(w)){\n        return node.contains\n    } else {\n        if (node.hasChild(w[depth]) {\n            return get_doc_ids(node.getChild(w[depth], w, depth+1)\n        } else {\n            return empty_set()\n        }\n    }\n}\n\n// the answering query function, as straight forward as it can be\nfunction answer_query(TrieNode root, list_of_words L){\n    n = length(L)\n    result = get_docs_ids(root, L[0], 0)\n    for i from 1 to n-1 do {\n        result = intersection(result, get_docs_ids(root, L[i], 0))  // set intersection \n        if (result.is_empty()){\n            break  // no documents contains them all, no need to check further\n        }\n    }\n    return result\n}\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 8990391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8af6ab00586913e6491fbbf59a1a04f1?s=128&d=identicon&r=PG&f=1", "display_name": "Eduard Grigoryev", "link": "https://stackoverflow.com/users/8990391/eduard-grigoryev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1980, "favorite_count": 2, "accepted_answer_id": 55583062, "answer_count": 1, "score": 2, "last_activity_date": 1554765579, "creation_date": 1554576406, "question_id": 55552357, "link": "https://stackoverflow.com/questions/55552357/efficient-way-to-realize-full-text-search-in-golang", "title": "Efficient way to realize full text search in golang", "body": "<p>I am trying to realize a simple full text search in golang but all my implementations turn out to be too slow to overcome the thresholds.</p>\n\n<p>The task is as follows:</p>\n\n<ul>\n<li><p>Documents are non-empty strings of lowercase words divided by spaces</p></li>\n<li><p>Each document has an implicit identifier equal to its index in the input array</p></li>\n<li><p>New() constructs the index</p></li>\n<li><p>Search(): accepts a query, which is also a string of lowercase words divided by spaces, and returns a sorted array of unique identifiers of documents that contains all words from the query regardless of their order</p></li>\n</ul>\n\n<p>Example:</p>\n\n<pre><code>index := New([]string{\n\"this is the house that jack built\",  //: 0\n\"this is the rat that ate the malt\",  //: 1\n})\n\nindex.Search(\"\")  // -&gt; []\nindex.Search(\"in the house that jack built\")  // -&gt; []\nindex.Search(\"malt rat\")  // -&gt; [1]\nindex.Search(\"is this the\")  // -&gt; [0, 1]\n</code></pre>\n\n<p>I have already tried to implement:</p>\n\n<ul>\n<li><p>a binary search tree for each document and for all documents all together</p></li>\n<li><p>a trie (prefix tree) for each document and for all documents all together</p></li>\n<li><p>inverted index search</p></li>\n</ul>\n\n<p>binary search tree (for all documents):</p>\n\n<pre><code>type Tree struct {\n    m           map[int]bool\n    word        string\n    left        *Tree\n    right       *Tree\n}\n\ntype Index struct {\n    tree *Tree\n}\n</code></pre>\n\n<p>binary search tree (a tree for each document):</p>\n\n<pre><code>type Tree struct {\n    word  string\n    left  *Tree\n    right *Tree\n}\n\ntype Index struct {\n    tree  *Tree\n    index int\n    next  *Index\n}\n</code></pre>\n\n<p>trie (for all documents):</p>\n\n<pre><code>type Trie struct {\n    m        map[uint8]*Trie\n    end_node map[int]bool\n}\n\ntype Index struct {\n    trie *Trie\n}\n</code></pre>\n\n<p>trie (for each document):</p>\n\n<pre><code>type Trie struct {\n    m        map[uint8]*Trie\n    end_node bool\n}\n\ntype Index struct {\n    trie  *Trie\n    index int\n    next  *Index\n}\n</code></pre>\n\n<p>inverted index:</p>\n\n<pre><code>type Index struct {\n    m map[string]map[int]bool\n}\n</code></pre>\n\n<p>New and Search implementation for inverted index:</p>\n\n<pre><code>// New creates a fulltext search index for the given documents\nfunc New(docs []string) *Index {\n    m := make(map[string]map[int]bool)\n\n    for i := 0; i &lt; len(docs); i++ {\n        words := strings.Fields(docs[i])\n        for j := 0; j &lt; len(words); j++ {\n            if m[words[j]] == nil {\n                m[words[j]] = make(map[int]bool)\n            }\n            m[words[j]][i+1] = true\n        }\n    }\n    return &amp;(Index{m})\n}\n\n// Search returns a slice of unique ids of documents that contain all words from the query.\nfunc (idx *Index) Search(query string) []int {\n    if query == \"\" {\n        return []int{}\n    }\n    ret := make(map[int]bool)\n    arr := strings.Fields(query)\n    fl := 0\n    for i := range arr {\n        if idx.m[arr[i]] == nil {\n            return []int{}\n        }\n        if fl == 0 {\n            for value := range idx.m[arr[i]] {\n                ret[value] = true\n            }\n            fl = 1\n        } else {\n            tmp := make(map[int]bool)\n            for value := range ret {\n                if idx.m[arr[i]][value] == true {\n                    tmp[value] = true\n                }\n            }\n            ret = tmp\n        }\n    }\n    ret_arr := []int{}\n    for value := range ret {\n        ret_arr = append(ret_arr, value-1)\n    }\n    sort.Ints(ret_arr)\n    return ret_arr\n}\n</code></pre>\n\n<p>Am I doing something wrong or is there a better algorithm for search in golang?</p>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["postgresql", "go"], "answers": [{"comments": [{"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1554576238, "post_id": 55552286, "comment_id": 97805870, "body": "Hello! I tested your code right now. It raise such error: <code>Cannot convert expression on type pq.Int64Array to type int64</code>. Do you have any ideas?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1554579453, "last_edit_date": 1554579453, "creation_date": 1554575899, "answer_id": 55552286, "question_id": 55552226, "link": "https://stackoverflow.com/questions/55552226/how-convert-pq-int64array-to-string/55552286#55552286", "title": "How convert pq.Int64Array to string?", "body": "<p>Because the type <code>pq.Int64Array</code> is a slice type, the application is scanning to a slice of slices. Scan to a slice only:</p>\n\n<pre><code>var identifiers pq.Int64Array\nif err := database.DBSQL.QueryRow(sqlStatement.String()).Scan(&amp;identifiers); err != nil {\n    log.Println(err)\n    utils.ResponseWithError(responseWriter, http.StatusInternalServerError, err.Error())\n    return\n}\n</code></pre>\n\n<p>Convert each id to a string and append to a buffer.  Insert separators between each id.  Convert the buffer to a string when done.</p>\n\n<pre><code>var buf []byte\nfor i, id := range identifiers {\n    if i &gt; 0 {\n        buf = append(buf, ',')\n    }\n    buf = strconv.AppendInt(buf, int64(id), 10)\n}\ns := string(buf)\n</code></pre>\n"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 746, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554579631, "creation_date": 1554575512, "question_id": 55552226, "link": "https://stackoverflow.com/questions/55552226/how-convert-pq-int64array-to-string", "title": "How convert pq.Int64Array to string?", "body": "<p>In <code>Golang</code> application I make sql query to <strong>PostgreSQL</strong> database which return me array of int.</p>\n\n<pre><code>var identifiers [] pq.Int64Array\n\n// Execute SQL query by \"database/sql\" package.\nif err := database.DBSQL.QueryRow(sqlStatement.String()).Scan(&amp;identifiers); err != nil {\n    log.Println(err)\n    utils.ResponseWithError(responseWriter, http.StatusInternalServerError, err.Error())\n    return\n}\n</code></pre>\n\n<p>How convert <code>identifiers</code> array with <code>pq.Int64Array</code> elements to string where elements of array separated by comma?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5830, "user_id": 3776927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46cb2cca9626c6d445bd05297be86251?s=128&d=identicon&r=PG&f=1", "display_name": "derpirscher", "link": "https://stackoverflow.com/users/3776927/derpirscher"}, "edited": false, "score": 1, "creation_date": 1554571193, "post_id": 55551504, "comment_id": 97804481, "body": "Depending on your struct it may be more expensive to find out what changed than to just write the whole record"}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1554573804, "post_id": 55551504, "comment_id": 97805214, "body": "Check out <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">gorm</a> although it also comes with its own limitations/problems."}, {"owner": {"reputation": 1461, "user_id": 1741753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a8f485be30960038f792beab9785ada?s=128&d=identicon&r=PG", "display_name": "John Corry", "link": "https://stackoverflow.com/users/1741753/john-corry"}, "edited": false, "score": 0, "creation_date": 1554607278, "post_id": 55551504, "comment_id": 97811754, "body": "I just write my update func to update everything except the password. In the handler I get the record, scan row into struct, marshal request JSON into that struct (overwriting DB values with those from request body if present) then pass struct to update method to save.."}], "answers": [{"tags": [], "owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "is_accepted": false, "score": 0, "last_activity_date": 1554575475, "creation_date": 1554575475, "answer_id": 55552218, "question_id": 55551504, "link": "https://stackoverflow.com/questions/55551504/how-to-determine-which-database-table-columns-need-to-be-updated-from-modified-s/55552218#55552218", "title": "How to determine which database table columns need to be updated from modified struct?", "body": "<p>There are plenty of ways to achieve that. For example you can use setters to change the values.So you can keep track of updated fields.\nlike so :  </p>\n\n<pre><code>type User struct {\n   ID string\n   Name string\n   Password string\n   updateFields map[string]bool\n}\n\nfunc (u *User) SetName(name string) {\n   u.Name = name\n   updateFields[\"name\"] = true\n}\n</code></pre>\n\n<p>You can use more automated way by reflection.</p>\n"}], "owner": {"reputation": 1, "user_id": 11321911, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cd589b18eff906dc1a1a2e1ae24bf15?s=128&d=identicon&r=PG&f=1", "display_name": "icecreamTruck", "link": "https://stackoverflow.com/users/11321911/icecreamtruck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1554575475, "creation_date": 1554570634, "question_id": 55551504, "link": "https://stackoverflow.com/questions/55551504/how-to-determine-which-database-table-columns-need-to-be-updated-from-modified-s", "title": "How to determine which database table columns need to be updated from modified struct?", "body": "<p>The problem that I am facing is more of a code design rather than specifically go related. I am building a simple CRUD application and everything seems to go nice and easy except the updating part: I have a struct type as simple as:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type User struct {\n   ID string\n   Name string\n   Password string\n}\n</code></pre>\n\n<p>and an interface for data storage layer:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Store interface {\n    ...\n    Update(user *User) error\n    ...\n}\n</code></pre>\n\n<p>The problem is that with most database drivers you can't just pass the whole struct instance and hope the their system knows which fields were modified, the whole document/row gets replaced. How should I track which fields were modified (so that I could update them in the storage layer accordingly)? Maybe pass all the fields I would like to modify to the Update function as a map of interface{}?</p>\n"}, {"tags": ["dictionary", "go", "memory-management"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1554566275, "post_id": 55550559, "comment_id": 97803033, "body": "First, both of these results stated 16ms and 3MB, so there may actually be no real difference (you have to run a proper benchmark). Converting a to a string within a map index expression is a special case that is optimized way by the compiler. If there is a difference, string keys are the most common key type, they have the most optimized codepath. There&#39;s really no reason to make maps work well with <code>byte</code> keys when optimized code would probably use <code>[256]int{}</code> rather than a map."}], "answers": [{"comments": [{"owner": {"reputation": 487, "user_id": 1866988, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/41d0826312945dee38a168f8daa38a14?s=128&d=identicon&r=PG", "display_name": "Fedir Petryk", "link": "https://stackoverflow.com/users/1866988/fedir-petryk"}, "edited": false, "score": 1, "creation_date": 1554637876, "post_id": 55551080, "comment_id": 97817645, "body": "BenchmarkRomanFast-8  200000000 7.42 ns/op   <a href=\"https://pastebin.com/k8Ejzmvz\" rel=\"nofollow noreferrer\">code</a>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1554571107, "last_edit_date": 1554571107, "creation_date": 1554568102, "answer_id": 55551080, "question_id": 55550559, "link": "https://stackoverflow.com/questions/55550559/mapbyteint-and-mapstringint-have-different-memory-usage/55551080#55551080", "title": "map[byte]int and map[string]int have different memory usage", "body": "<p>Benchmark your code, <code>romanToIntStr</code> and <code>romanToIntByt</code>. The difference between <code>romanToIntStr</code> and <code>romanToIntByt</code> is not significant. Your code, <code>romanToIntStr</code> and <code>romanToIntByt</code>, is not efficient. See <code>romanToIntArr</code>.</p>\n\n<hr>\n\n<p>Output:</p>\n\n<pre><code>$ go test roman2int_test.go -bench=. -benchmem\n\nBenchmarkRomanToIntStr-8    2725520   440 ns/op     0 B/op   0 allocs/op\nBenchmarkRomanToIntByt-8    2377992   499 ns/op     0 B/op   0 allocs/op\n\nBenchmarkRomanToIntArr-8   25643797    42.3 ns/op   0 B/op   0 allocs/op\n</code></pre>\n\n<p><code>roman2int_test.go</code>:</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc romanToIntStr(s string) int {\n    m := map[string]int{\n        \"I\": 1,\n        \"V\": 5,\n        \"X\": 10,\n        \"L\": 50,\n        \"C\": 100,\n        \"D\": 500,\n        \"M\": 1000,\n    }\n    result := 0\n    length := len(s)\n    last_element := length - 1\n    for i := 0; i &lt; last_element; i++ {\n        current := m[string(s[i])]\n        next := m[string(s[i+1])]\n        if current &lt; next {\n            result -= current\n        } else {\n            result += current\n        }\n    }\n    result += m[string(s[last_element])]\n    return result\n}\n\nfunc romanToIntByt(s string) int {\n    m := map[byte]int{\n        'I': 1,\n        'V': 5,\n        'X': 10,\n        'L': 50,\n        'C': 100,\n        'D': 500,\n        'M': 1000,\n    }\n    result := 0\n    length := len(s)\n    last_element := length - 1\n    for i := 0; i &lt; last_element; i++ {\n        current := m[s[i]]\n        next := m[s[i+1]]\n        if current &lt; next {\n            result -= current\n        } else {\n            result += current\n        }\n    }\n    result += m[s[last_element]]\n    return result\n}\n\nfunc romanToIntArr(s string) int {\n    m := [256]int{\n        'I': 1,\n        'V': 5,\n        'X': 10,\n        'L': 50,\n        'C': 100,\n        'D': 500,\n        'M': 1000,\n    }\n    result := 0\n    last := len(s) - 1\n    for i := 0; i &lt; last; i++ {\n        current := m[(s[i])]\n        next := m[(s[i+1])]\n        if current &lt; next {\n            result -= current\n        } else {\n            result += current\n        }\n    }\n    result += m[(s[last])]\n    return result\n}\n\nvar bench1942 = \"MCMXLII\"\n\nfunc BenchmarkRomanToIntStr(b *testing.B) {\n    for N := 0; N &lt; b.N; N++ {\n        romanToIntStr(bench1942)\n    }\n}\n\nfunc BenchmarkRomanToIntByt(b *testing.B) {\n    for N := 0; N &lt; b.N; N++ {\n        romanToIntByt(bench1942)\n    }\n}\n\nfunc BenchmarkRomanToIntArr(b *testing.B) {\n    for N := 0; N &lt; b.N; N++ {\n        romanToIntArr(bench1942)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 10971650, "user_type": "registered", "profile_image": "https://graph.facebook.com/601586270304848/picture?type=large", "display_name": "Luo Jigao", "link": "https://stackoverflow.com/users/10971650/luo-jigao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 2, "accepted_answer_id": 55551080, "answer_count": 1, "score": 0, "last_activity_date": 1554571107, "creation_date": 1554564269, "last_edit_date": 1554566738, "question_id": 55550559, "link": "https://stackoverflow.com/questions/55550559/mapbyteint-and-mapstringint-have-different-memory-usage", "title": "map[byte]int and map[string]int have different memory usage", "body": "<p>This question came from <a href=\"https://leetcode.com/problems/roman-to-integer/description/\" rel=\"nofollow noreferrer\">a little simple problem from LeetCode</a>. </p>\n\n<p><strong>This question is not so related with the LeetCode problemm itself. But it's related with two approaches, which only has difference at the type of <code>map</code>, to solve this LeetCode problem.</strong></p>\n\n<hr>\n\n<ol>\n<li>The first approach using <code>map[byte]int</code>:</li>\n</ol>\n\n<pre><code>func romanToInt(s string) int {\n    m := map[byte]int{\n        'I': 1,\n        'V': 5,\n        'X': 10,\n        'L': 50,\n        'C': 100,\n        'D': 500,\n        'M': 1000,\n    }\n    result := 0\n    length := len(s)\n    last_element := length - 1\n    for i := 0; i &lt; last_element; i++ {\n        current := m[s[i]]\n        next := m[s[i+1]]\n        if current &lt; next {\n            result -= current\n        } else {\n            result += current\n        }\n    }\n    result += m[s[last_element]]\n    return result\n}\n</code></pre>\n\n<p>How it online judged by LeetCode:</p>\n\n<pre><code>\u2714 Accepted\n  \u2714 3999/3999 cases passed (16 ms)\n  \u2714 Your runtime beats 100 % of golang submissions\n  \u2714 Your memory usage beats 22 % of golang submissions (3 MB)\n</code></pre>\n\n<hr>\n\n<ol start=\"2\">\n<li>The Second approach using <code>map[string]int</code>:</li>\n</ol>\n\n<pre><code>func romanToInt(s string) int {\n    m := map[string]int{\n        \"I\": 1,\n        \"V\": 5,\n        \"X\": 10,\n        \"L\": 50,\n        \"C\": 100,\n        \"D\": 500,\n        \"M\": 1000,\n    }\n    result := 0\n    length := len(s)\n    last_element := length - 1\n    for i := 0; i &lt; last_element; i++ {\n        current := m[string(s[i])]\n        next := m[string(s[i+1])]\n        if current &lt; next {\n            result -= current\n        } else {\n            result += current\n        }\n    }\n    result += m[string(s[last_element])]\n    return result\n}\n</code></pre>\n\n<p>How it online judged by LeetCode:</p>\n\n<pre><code>\u2714 Accepted\n  \u2714 3999/3999 cases passed (16 ms)\n  \u2714 Your runtime beats 100 % of golang submissions\n  \u2714 Your memory usage beats 100 % of golang submissions (3 MB)\n</code></pre>\n\n<hr>\n\n<p>Some word to the online evaluation:\nI had run this two versions more than 10 times in time interval 1 hour. And they achieve 22 % vs 100 % at <code>memory usage</code>.</p>\n\n<p><strong>What I expected:</strong></p>\n\n<p>I thought this first one using <code>map[byte]int</code> should be faster and memory-saver. </p>\n\n<p>Why faster: \nIn the second version, I have to cast the <code>rune</code> to <code>string</code> every time.\n(But the <a href=\"https://godbolt.org/\" rel=\"nofollow noreferrer\">compiler explorer</a> tells me that is not a big difference.)</p>\n\n<p>Why should be memory-saver: \nBecause <code>byte</code> is more lighter than <code>string</code>.</p>\n\n<hr>\n\n<p><strong>So final question:</strong></p>\n\n<p>why there is a difference at the <code>memory usage</code>?<br>\nAnd why is my expectation wrong?</p>\n"}, {"tags": ["go", "swagger-2.0"], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 2, "last_activity_date": 1554562463, "creation_date": 1554562463, "answer_id": 55550283, "question_id": 55550174, "link": "https://stackoverflow.com/questions/55550174/go-api-to-show-swagger-api-specification-json-in-html-swagger-ui/55550283#55550283", "title": "Go API to show swagger api specification (json) in html (Swagger UI)", "body": "<p>If you already have your APIs defined in YAML or JSON format, you can use the static 'dist' tree to render it from a browser:</p>\n\n<p><a href=\"https://github.com/swagger-api/swagger-ui/tree/master/dist\" rel=\"nofollow noreferrer\">https://github.com/swagger-api/swagger-ui/tree/master/dist</a></p>\n\n<p>Update <code>index.html</code> to point to your API doc via this tag:</p>\n\n<pre><code>url: \"https://petstore.swagger.io/v2/swagger.json\",\n</code></pre>\n\n<p>And if you want to serve this static tree from your go REST-API server, add the following handler:</p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"dist\"))\nhttp.Handle(\"/swagger/\", http.StripPrefix(\"/swagger/\", fs))\n</code></pre>\n\n<p>This will serve the swaggers docs off the <code>/swagger/</code> route - reading the content from the <code>dist</code> directory.</p>\n"}, {"comments": [{"owner": {"reputation": 9920, "user_id": 7599833, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74ae2f4b27f5f727270818eba261aa0b?s=128&d=identicon&r=PG", "display_name": "Helder Sepulveda", "link": "https://stackoverflow.com/users/7599833/helder-sepulveda"}, "edited": false, "score": 0, "creation_date": 1555082438, "post_id": 55654731, "comment_id": 97998412, "body": "But don&#39;t get me wrong, there are a lot of advantages of hosting your own swagger-ui, you can customize the UI to your liking, or pin to a specific version to prevent breaking changes from future releases"}], "tags": [], "owner": {"reputation": 9920, "user_id": 7599833, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74ae2f4b27f5f727270818eba261aa0b?s=128&d=identicon&r=PG", "display_name": "Helder Sepulveda", "link": "https://stackoverflow.com/users/7599833/helder-sepulveda"}, "is_accepted": false, "score": 0, "last_activity_date": 1555082007, "creation_date": 1555082007, "answer_id": 55654731, "question_id": 55550174, "link": "https://stackoverflow.com/questions/55550174/go-api-to-show-swagger-api-specification-json-in-html-swagger-ui/55654731#55654731", "title": "Go API to show swagger api specification (json) in html (Swagger UI)", "body": "<p>Here as an alternative to using the static <code>dist</code> code</p>\n\n<p>SwaggerUI has a <code>URL</code> parameter that you can provide your own swagger.json and it will render the UI with your definitions, here is an example:</p>\n\n<p><a href=\"http://petstore.swagger.io/?url=http://swagger-net-test.azurewebsites.net/swagger/docs/V1\" rel=\"nofollow noreferrer\">http://petstore.swagger.io/?url=http://swagger-net-test.azurewebsites.net/swagger/docs/V1</a></p>\n\n<p>As you can see you don't really need anything other than your own swagger spec and internet access</p>\n"}, {"tags": [], "owner": {"reputation": 3360, "user_id": 329463, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cc84f018e9d2d814cd7c1feffb6d624a?s=128&d=identicon&r=PG", "display_name": "vearutop", "link": "https://stackoverflow.com/users/329463/vearutop"}, "is_accepted": false, "score": 0, "last_activity_date": 1613211863, "creation_date": 1613211863, "answer_id": 66184045, "question_id": 55550174, "link": "https://stackoverflow.com/questions/55550174/go-api-to-show-swagger-api-specification-json-in-html-swagger-ui/66184045#66184045", "title": "Go API to show swagger api specification (json) in html (Swagger UI)", "body": "<p>For cases of self-contained applications (that may need to restrict access to external networks) there is a library that provides Swagger UI as a HTTP handler: <a href=\"https://github.com/swaggest/swgui\" rel=\"nofollow noreferrer\">https://github.com/swaggest/swgui</a>. You can simply plug it in your router.</p>\n<pre><code>package main\n\nimport (\n    &quot;net/http&quot;\n\n    &quot;github.com/swaggest/swgui/v3&quot;\n)\n\nfunc main() {\n    http.Handle(&quot;/&quot;, v3.NewHandler(&quot;My API&quot;, &quot;/swagger.json&quot;, &quot;/&quot;))\n    http.ListenAndServe(&quot;:8080&quot;, nil)\n}\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 11282800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c886139ecffc62e9a7bd5f22b432d7d?s=128&d=identicon&r=PG&f=1", "display_name": "rocks4530", "link": "https://stackoverflow.com/users/11282800/rocks4530"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1552, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1613211863, "creation_date": 1554561691, "last_edit_date": 1554562069, "question_id": 55550174, "link": "https://stackoverflow.com/questions/55550174/go-api-to-show-swagger-api-specification-json-in-html-swagger-ui", "title": "Go API to show swagger api specification (json) in html (Swagger UI)", "body": "<p>I have go application(gorilla/mux) that serves a specific port. I too have a swagger API specification in the form of json file. Is there any go API that can generate a swagger UI definition from the JSON file just like spring boot.\nI am looking at <a href=\"https://github.com/go-swagger/go-swagger\" rel=\"nofollow noreferrer\">https://github.com/go-swagger/go-swagger</a>, but i am not able to use this in my go-lang code. It seems this API can be used only from the command line.</p>\n"}, {"tags": ["database", "postgresql", "go", "struct"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1554559187, "post_id": 55549720, "comment_id": 97801034, "body": "<code>port</code> is a string, and you&#39;re trying to format it with <code>%d</code>."}], "answers": [{"comments": [{"owner": {"reputation": 659, "user_id": 1155514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mjZMX.jpg?s=128&g=1", "display_name": "Muhammad Tariq", "link": "https://stackoverflow.com/users/1155514/muhammad-tariq"}, "edited": false, "score": 0, "creation_date": 1605246401, "post_id": 55556820, "comment_id": 114597776, "body": "Saved my day! Thanks"}], "tags": [], "owner": {"reputation": 2859, "user_id": 6225565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iqBej.jpg?s=128&g=1", "display_name": "Shalauddin Ahamad Shuza", "link": "https://stackoverflow.com/users/6225565/shalauddin-ahamad-shuza"}, "is_accepted": true, "score": 1, "last_activity_date": 1554623840, "creation_date": 1554623840, "answer_id": 55556820, "question_id": 55549720, "link": "https://stackoverflow.com/questions/55549720/how-to-fix-database-structuring-problem-in-go-programming-language/55556820#55556820", "title": "How to fix database structuring problem in go programming language?", "body": "<p>This happened because you have mashup with data type. You have declared port number as string but when you are building the connection string you have specified port number as integer which will produce <code>host=localhost port=%!d(string=5432) user=postgres password=123 dbname=DatabaseName sslmode=disable</code> wrong connection string. Your connection string should be <code>host=localhost port=5432 user=postgres password=123 dbname=DatabaseName sslmode=disable</code>. You can change the port number data type from <code>string</code> to <code>int</code> in <code>struct</code></p>\n\n<pre><code>type Database struct {\n    host, user, password, dbname string\n    port                         int\n    db                           *sql.DB\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/yP3Y-0NdloQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/yP3Y-0NdloQ</a></p>\n\n<p>Or you can change the port number type from <code>%d</code> to <code>%s</code> when building connection string</p>\n\n<pre><code>psqlInfo := fmt.Sprintf(\"host=%s port=%s user=%s \"+\"password=%s dbname=%s sslmode=disable\", d.host, d.port, d.user, d.password, d.dbname)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/e61dOUg0MA-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/e61dOUg0MA-</a></p>\n"}], "owner": {"reputation": 13, "user_id": 11321290, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71bab3a586e4c6c26ddd6deb37763ac1?s=128&d=identicon&r=PG&f=1", "display_name": "Halil MENGU", "link": "https://stackoverflow.com/users/11321290/halil-mengu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 869, "favorite_count": 1, "accepted_answer_id": 55556820, "answer_count": 1, "score": 0, "last_activity_date": 1554623840, "creation_date": 1554558694, "question_id": 55549720, "link": "https://stackoverflow.com/questions/55549720/how-to-fix-database-structuring-problem-in-go-programming-language", "title": "How to fix database structuring problem in go programming language?", "body": "<p>I'm trying to create postgresql database struct to automate the system in Golang.</p>\n\n<p>This code is working;</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n\n    _ \"github.com/lib/pq\"\n)\n\nfunc checkError(err error){\n    if err!=nil{\n        panic(err)\n    }\n}\n\nconst (\n    host     = \"localhost\"\n    port     = 5432\n    user     = \"postgres\"\n    password = \"123\"\n    dbname   = \"DatabaseName\"\n)\n\nfunc main() {\n    psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\n        \"password=%s dbname=%s sslmode=disable\",\n        host, port, user, password, dbname)\n    db, err := sql.Open(\"postgres\", psqlInfo)\n    checkError(err)\n\n    err = db.Ping()\n    checkError(err)\n\n    defer db.Close()\n    fmt.Println(\"Successfully connected!\")\n}\n</code></pre>\n\n<blockquote>\n  <p>Result: Successfully connected!</p>\n</blockquote>\n\n<p>But When I'm trying to create a struct the system giving me an error;</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    _ \"github.com/lib/pq\"\n)\n\nfunc checkError(err error){\n    if err!=nil{\n        panic(err)\n    }\n}\n\ntype Database struct{\n    host, port, user, password, dbname string\n    db *sql.DB\n}\n\nfunc(d *Database) Open(){\n    psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\"password=%s dbname=%s sslmode=disable\", d.host, d.port, d.user, d.password, d.dbname)\n    db, err := sql.Open(\"postgres\", psqlInfo)\n    checkError(err)\n    d.db = db\n}\n\nfunc(d *Database) IsOpened() {\n    checkError(d.db.Ping())\n}\n\nfunc main() {\n    a := Database{host: \"localhost\", port: \"5432\", user: \"postgres\", password: \"123\", dbname: \"DatabaseName\"}\n    a.Open()\n    a.IsOpened()\n}\n</code></pre>\n\n<blockquote>\n  <p>Result: panic: dial tcp: lookup tcp/%!d(string=5432): getaddrinfow:\n  The specified class could not be found.</p>\n  \n  <p>goroutine 1 [running]: main.checkError(...)   /main.go:11</p>\n  \n  <p>main.(*Database).IsOpened(...)    /main.go:28\n  main.main()   /main.go:34\n  +0xcc</p>\n</blockquote>\n"}, {"tags": ["go", "variadic-functions", "variadic"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1554553701, "last_edit_date": 1554553701, "creation_date": 1554552855, "answer_id": 55548957, "question_id": 55548881, "link": "https://stackoverflow.com/questions/55548881/variadic-variable-expansion-in-fmt-println/55548957#55548957", "title": "Variadic Variable Expansion in fmt.Println", "body": "<p><code>[]int</code> is not the same as <code>[]interface{}</code>, so if you have an <code>[]int</code>, you can't pass that to <code>fmt.Println()</code> as the value for the variadic slice. You may pass it as-is, but that's gonna be an <code>[]interface{}</code> slice with a single value being the <code>[]int</code> slice.</p>\n\n<p><code>fmt.Println(a...)</code> is <strong>not</strong> the same as <code>fmt.Println(a[0],a[1],a[2])</code>.</p>\n\n<p><code>fmt.Println(a[0], a[1], a[2])</code> is equivalent to </p>\n\n<pre><code>fmt.Println([]interface{}{a[0], a[1], a[2]}...)\n</code></pre>\n\n<p>which is equivalent to</p>\n\n<pre><code>fmt.Println([]interface{}{\n    interface{}(a[0]),\n    interface{}(a[1]),\n    interface{}(a[2]),\n}...)\n</code></pre>\n\n<p>So when you pass <code>a[0]</code>, <code>a[1]</code> and <code>a[2]</code>, implicit <code>interface{}</code> values will be created, which will be implicitly wrapped in a slice.</p>\n\n<p>If you would want to pass elements of <code>a</code> to a function that expects a variadic parameter of <code>[]interface{}</code>, you have to \"manually\" create that slice beforehand, e.g.:</p>\n\n<pre><code>b := make([]interface{}, len(a))\nfor i, v := range a {\n    b[i] = v\n}\nfmt.Println(b...)\n</code></pre>\n\n<p>Try these examples on the <a href=\"https://play.golang.org/p/JgjKHOUSKT8\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Also see related question: <a href=\"https://stackoverflow.com/questions/39914447/unpacking-slice-of-slices/39915311#39915311\">Unpacking slice of slices</a></p>\n"}], "owner": {"reputation": 432, "user_id": 6639975, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dvwQi.jpg?s=128&g=1", "display_name": "GypsyCosmonaut", "link": "https://stackoverflow.com/users/6639975/gypsycosmonaut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "closed_date": 1554553534, "accepted_answer_id": 55548957, "answer_count": 1, "score": 1, "last_activity_date": 1554553701, "creation_date": 1554552209, "question_id": 55548881, "link": "https://stackoverflow.com/questions/55548881/variadic-variable-expansion-in-fmt-println", "closed_reason": "Duplicate", "title": "Variadic Variable Expansion in fmt.Println", "body": "<pre><code>package main\nimport \"fmt\"\nfunc main(){\n        a := []int{1,2,3}\n        fmt.Println(a...)\n}\n</code></pre>\n\n<p>Running this gives the following error</p>\n\n<p><code>./program.go:5: cannot use a (type []int) as type []interface {} in argument to fmt.Println</code></p>\n\n<p>From <code>godoc fmt Println</code></p>\n\n<pre><code>func Println(a ...interface{}) (n int, err error)\n</code></pre>\n\n<p><code>Println</code> accepts any value because it is an empty interface.</p>\n\n<p>What's confusing to me is that</p>\n\n<p><code>fmt.Println(a...)</code> is same as <code>fmt.Println(a[0],a[1],a[2])</code></p>\n\n<p>and yet one works but the other doesn't.</p>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "edited": false, "score": 0, "creation_date": 1554546120, "post_id": 55548047, "comment_id": 97798011, "body": "Uff literally I can only create wrappers around the exported types since I cannot call any private methods?"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 1, "creation_date": 1554551884, "post_id": 55548047, "comment_id": 97799345, "body": "actually <code>sarama.ClusterAdmin</code> it is meant to be implemented by yourself if needed. Just copy the struct implementing it and add what ever you need. I don&#39;t think you need to extend the interface itself."}], "tags": [], "owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "is_accepted": true, "score": 4, "last_activity_date": 1554545867, "last_edit_date": 1554545867, "creation_date": 1554545547, "answer_id": 55548047, "question_id": 55547994, "link": "https://stackoverflow.com/questions/55547994/extending-a-librarys-struct-interface/55548047#55548047", "title": "Extending a library&#39;s struct/interface", "body": "<p>You <strong>cannot</strong> extend the interface outside its package.</p>\n\n<p>What you can do instead is define a new interface that implements the old interface and then add your new method to the new interface. For example:</p>\n\n<pre><code>type ExtendedClusterAdmin interface {\n   sarama.ClusterAdmin\n   ListDetailedtopics()\n}\n</code></pre>\n\n<hr>\n\n<p>If you want to use private function within the package then you would have to do it inside the package itself. For example, with a patch.</p>\n"}], "owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 55548047, "answer_count": 1, "score": 0, "last_activity_date": 1554545867, "creation_date": 1554545137, "question_id": 55547994, "link": "https://stackoverflow.com/questions/55547994/extending-a-librarys-struct-interface", "title": "Extending a library&#39;s struct/interface", "body": "<p><strong>Use case</strong></p>\n\n<p>I am using Shopify's sarama libary which is a client library. More specifically I am using the <code>ClusterAdmin</code> struct which is great, however I want to add another method <code>ListDetailedTopics</code> to it and I must call ClusterAdmin's non public methods.</p>\n\n<p><a href=\"https://github.com/Shopify/sarama/blob/master/admin.go\" rel=\"nofollow noreferrer\">https://github.com/Shopify/sarama/blob/master/admin.go</a></p>\n\n<p><strong>Problem</strong></p>\n\n<p>I am not sure how I could \"extend\" the exported struct by my own method. I tried this:</p>\n\n<pre><code>func (ca *sarama.ClusterAdmin) ListDetailedtopics() {\n  b, err := ca.findAnyBroker() // This is a private method I need to call\n}\n</code></pre>\n\n<p>That did not work because \"invalid receiver type *sarama.ClusterAdmin (sarama.ClusterAdmin is an interface type)\". How can I extend the struct/interface by my own methods?</p>\n"}, {"tags": ["go", "go-modules", "govendor"], "answers": [{"comments": [{"owner": {"reputation": 1250, "user_id": 322097, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/9JXvl.jpg?s=128&g=1", "display_name": "AntonioHS", "link": "https://stackoverflow.com/users/322097/antoniohs"}, "edited": false, "score": 0, "creation_date": 1554619234, "post_id": 55555365, "comment_id": 97813469, "body": "Since issue is that the vendor folder is in one of my dependencies, my module depends on a repository that has the vendor in it. So what I had to do, following your tip, is to clone the dependency elsewhere in my hardisk, go to the <code>vendor&#47;golang.org&#47;x&#47;ne&#47;htmlt</code> folder and do <code>go mod init</code>.  Then the replace section in the root <code>go.mod</code> was   <code>replace golang.org&#47;x&#47;net&#47;html =&gt; ..&#47;..&#47;path&#47;elsewhere&#47;vendor&#47;golang.org&#47;x&#47;net&#47;html</code>  And now it works. Thanks!"}], "tags": [], "owner": {"reputation": 84923, "user_id": 1920232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iUA8y.jpg?s=128&g=1", "display_name": "peterm", "link": "https://stackoverflow.com/users/1920232/peterm"}, "is_accepted": true, "score": 1, "last_activity_date": 1554607825, "creation_date": 1554607825, "answer_id": 55555365, "question_id": 55547592, "link": "https://stackoverflow.com/questions/55547592/go-modules-and-dependencies-with-modified-vendors/55555365#55555365", "title": "Go modules and dependencies with modified vendors", "body": "<p>You can try <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\"><code>replace</code></a> directive. Something along the lines of</p>\n\n<p>First </p>\n\n<pre><code>cd ./vendor/golang.org/x/net/html\ngo mod init\n</code></pre>\n\n<p>Then in your root <code>go.mod</code></p>\n\n<pre><code>module your/super/module\n\nreplace golang.org/x/net/html =&gt; ./vendor/golang.org/x/net/html\n\nrequire golang.org/x/net/html v0.0.0\n\n</code></pre>\n\n<p>Note that both <code>require</code> and <code>replace</code> are required.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 8836433, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XhrvlG7TwVk/AAAAAAAAAAI/AAAAAAAAABE/dJiYtZC1l7M/photo.jpg?sz=128", "display_name": "Xiao Qian", "link": "https://stackoverflow.com/users/8836433/xiao-qian"}, "is_accepted": false, "score": 0, "last_activity_date": 1606463618, "creation_date": 1606463618, "answer_id": 65033748, "question_id": 55547592, "link": "https://stackoverflow.com/questions/55547592/go-modules-and-dependencies-with-modified-vendors/65033748#65033748", "title": "Go modules and dependencies with modified vendors", "body": "<p>After <code>go1.15</code> you can build with <code>-mod=readonly</code> to avoid imports only from the vendor directory.</p>\n<p>example:</p>\n<p><code>go build -mod=readonly -o ./build/project -ldflags &quot;-s -w&quot; main.go</code></p>\n"}], "owner": {"reputation": 1250, "user_id": 322097, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/9JXvl.jpg?s=128&g=1", "display_name": "AntonioHS", "link": "https://stackoverflow.com/users/322097/antoniohs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1112, "favorite_count": 0, "accepted_answer_id": 55555365, "answer_count": 2, "score": 4, "last_activity_date": 1606463618, "creation_date": 1554542144, "question_id": 55547592, "link": "https://stackoverflow.com/questions/55547592/go-modules-and-dependencies-with-modified-vendors", "title": "Go modules and dependencies with modified vendors", "body": "<p>I am trying to convert one Go project to the new modules standard, but I am having trouble with one dependency.</p>\n\n<p>That repository has vendored a library (in this case golang.org/x/net/html) to add some functionality to the library; meaning that it has modified the vendored dependency (added a method to a struct).</p>\n\n<p>So the problem is that after doing <code>go mod init</code>, when i execute <code>go get ./...</code> the system complains about a call to that added functionality, because it ignores the modified vendor and tries to import the upstream library instead.</p>\n\n<p>Is there any way to let <code>go mod</code> know that it should use the vendored dependency?</p>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 5139, "user_id": 11280830, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xBUiMFs_9JU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdVuWIFGXgyqpP2acaVJcI5V-3Q6Q/mo/photo.jpg?sz=128", "display_name": "Mihai", "link": "https://stackoverflow.com/users/11280830/mihai"}, "edited": false, "score": 0, "creation_date": 1554540231, "post_id": 55547207, "comment_id": 97796751, "body": "RUN commands are executed during build phase. During this phase there is no container yet. You need to define CMD or ENTRYPOINT in you r Dockerfile. These are commands that get executed when the containers are up and running."}, {"owner": {"reputation": 21, "user_id": 11320435, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_RCLOTL9drc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfbN_TCcksdZSMfzKE8pY5hkoccJQ/mo/photo.jpg?sz=128", "display_name": "Stas Lee", "link": "https://stackoverflow.com/users/11320435/stas-lee"}, "reply_to_user": {"reputation": 5139, "user_id": 11280830, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xBUiMFs_9JU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdVuWIFGXgyqpP2acaVJcI5V-3Q6Q/mo/photo.jpg?sz=128", "display_name": "Mihai", "link": "https://stackoverflow.com/users/11280830/mihai"}, "edited": false, "score": 0, "creation_date": 1554545241, "post_id": 55547207, "comment_id": 97797828, "body": "got it ! Thanks !"}], "answers": [{"tags": [], "owner": {"reputation": 5139, "user_id": 11280830, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xBUiMFs_9JU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdVuWIFGXgyqpP2acaVJcI5V-3Q6Q/mo/photo.jpg?sz=128", "display_name": "Mihai", "link": "https://stackoverflow.com/users/11280830/mihai"}, "is_accepted": false, "score": 0, "last_activity_date": 1554549762, "creation_date": 1554549762, "answer_id": 55548580, "question_id": 55547207, "link": "https://stackoverflow.com/questions/55547207/cannot-connect-to-db-host-within-docker-containers-from-api-service-to-db-servic/55548580#55548580", "title": "Cannot connect to db host within docker containers from api-service to db-service in order to do migration using goose in golang", "body": "<p>RUN commands are executed during build phase. During this phase there is no container yet. </p>\n\n<p>Commands that are meant to connect to other containers should be defined in CMD or ENTRYPOINT in the Dockerfile.</p>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 1, "last_activity_date": 1554553447, "creation_date": 1554553447, "answer_id": 55549048, "question_id": 55547207, "link": "https://stackoverflow.com/questions/55547207/cannot-connect-to-db-host-within-docker-containers-from-api-service-to-db-servic/55549048#55549048", "title": "Cannot connect to db host within docker containers from api-service to db-service in order to do migration using goose in golang", "body": "<p>First of all, let us have a deeper look into a Dockerfile. I have set up a <a href=\"https://github.com/mwmahlberg/so-postgres-compose\" rel=\"nofollow noreferrer\">repository for demo purposes for this question</a>, too.</p>\n\n<pre><code># We use a so called two stage build.\n# Basically this means we build our go binary in one image\n# which has the go compiler and all the required tools and libraries.\n# However, since we do not need those in our production image,\n# we copy the binary created into a basic alpine image\n# resulting in a much smaller image for production.\n\n# We define our image for the build environment...\nFROM golang:1.11-alpine3.8 as build\n\n# ...and copy our project directory tp the according place.\nCOPY . \"/go/src/github.com/mwmahlberg/so-postgres-compose\"\n# We set our work directory...\nWORKDIR /go/src/github.com/mwmahlberg/so-postgres-compose\n# ...and add git, which - forever reason, is not included into the golang image.\nRUN apk add git\n\n# We set up our dependency management and make sure all dependencies outside\n# the standard library are installed.\nRUN set -x &amp;&amp; \\\n    go get github.com/golang/dep/cmd/dep &amp;&amp; \\\n    dep ensure -v\n# Finally, we build our binary and name it accordingly    \nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o /apiserver\n\n# Now for the second stage, we use a basic alpine image...\nFROM alpine:3.8\n# ... update it...\nRUN apk --no-cache upgrade\n# .. and take the binary from the image we build above.\n# Note the location: [/usr]{/bin:/sbin} are reserved for\n# the OS's package manager. Binaries added to an OS by\n# the administrator which are not part of the OS's package\n# mangement system should always go below /usr/local/{bin,sbin}\nCOPY --from=build /apiserver /usr/local/bin/apiserver\n# Last but not least, we tell docker which binary to execute.\nENTRYPOINT [\"/usr/local/bin/apiserver\"]\n</code></pre>\n\n<p>The last line should actually do the trick: <code>ENTRYPOINT</code> specifies the command to be executed when a container is started. Arguments are appended to this command. So to add your connection string, you could do the following</p>\n\n<pre><code>api:\n  build: .\n  restart: always\n  command: \"host=db user=user dbname=dbname sslmode=disable password=123\"\n  ports:\n    - 8080:8080\n  links:\n    - db\n</code></pre>\n\n<p>The last thing you should do is to have a static configuration for a docker image, like you show in your example. You basically set a static connection string, which deprives you of much of the flexibility using containers.</p>\n\n<p>However, imho it is bad practice to use command line flags to configure containers, the first place. A much more flexible way is to use environment variables. For example, in kubernetes you would <a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/\" rel=\"nofollow noreferrer\">use a config map</a> to set up environment variables which in turn configure a pod. However, environment variables can be used with docker-compose or docker swarm, too.</p>\n\n<p>Hence, I would change the <code>docker-compose.yml</code> to something like this:</p>\n\n<pre><code>version: '3'\nservices:\n  db:\n    volumes:\n      - ./db/pgdata:/pgdata\n    image: postgres\n    ports:\n      - \"5432\"\n    restart: always\n    environment:\n      - POSTGRES_USER=user\n      - POSTGRES_DB=dbname\n      - POSTGRES_PASSWORD=123\n      - PGDATA=/pgdata\n\n  # adminer added for convenience\n  adminer:\n    image: adminer\n    restart: always\n    ports:\n      - 8081:8080\n    depends_on:\n      - db\n\n  api:\n    build: .\n    restart: always\n    ports:\n      - 8080:8080\n    depends_on:\n      - db\n    environment:\n      - POSTGRES_USER=user\n      - POSTGRES_DB=dbname\n      - POSTGRES_PASSWORD=123\n      - POSTGRES_HOST=db\n      - POSTGRES_PORT=5432    \n</code></pre>\n\n<p>and use the environment variables to configure the binary.</p>\n\n<p>I added a <a href=\"https://github.com/mwmahlberg/so-postgres-compose/blob/master/main.go#L33\" rel=\"nofollow noreferrer\">simple example how to use environment variables in Go</a> to the repo. Note that projects like <a href=\"https://github.com/spf13/cobra/cobra\" rel=\"nofollow noreferrer\">https://github.com/spf13/cobra/cobra</a> or <a href=\"https://gopkg.in/alecthomas/kingpin.v2\" rel=\"nofollow noreferrer\">https://gopkg.in/alecthomas/kingpin.v2</a> make it much easier to work with environment variables, as they provide automatic type conversion, the ability to easily set default values and much more.</p>\n\n<p>As for a more in depth reasoning why to use environment variables, you might want to read <a href=\"https://12factor.net/config\" rel=\"nofollow noreferrer\">part 3 of the 12 factor app methodology</a>.</p>\n\n<p>hth</p>\n"}], "owner": {"reputation": 21, "user_id": 11320435, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_RCLOTL9drc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfbN_TCcksdZSMfzKE8pY5hkoccJQ/mo/photo.jpg?sz=128", "display_name": "Stas Lee", "link": "https://stackoverflow.com/users/11320435/stas-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1554553447, "creation_date": 1554539004, "question_id": 55547207, "link": "https://stackoverflow.com/questions/55547207/cannot-connect-to-db-host-within-docker-containers-from-api-service-to-db-servic", "title": "Cannot connect to db host within docker containers from api-service to db-service in order to do migration using goose in golang", "body": "<p>goose is the migration tool that helps me to run all the *sql files and run up queries within database. I want to automate migrations(create tables and stuff) using this tool within the docker container on my api service. The problem is when docker runs command \"goose run\" it gets an error -goose run: dial tcp: lookup db on 192.168.63.6:53: no such host. </p>\n\n<p>docker-compose</p>\n\n<pre><code>services:\n  db:\n    build: ./db\n    volumes:\n      - ./db/pgdata:/pgdata\n    image: postgres\n    ports:\n      - \"5432\"\n    restart: always\n    environment:\n      - POSTGRES_USER=user\n      - POSTGRES_DB=dbname\n      - POSTGRES_PASSWORD=123\n      - PGDATA=/pgdata\n\n  api:\n    build:\n      context: ./api\n    restart: always\n    volumes:\n      - ./api:/go/src/github.com/gitlees/todoapp/api\n    ports:\n      - \"5000:8080\"\n    links: \n      - \"db\"\n</code></pre>\n\n<p>Api Dockerfile</p>\n\n<pre><code>RUN go get -u github.com/pressly/goose/cmd/goose\n\nRUN goose postgres \"host=db user=user dbname=dbname sslmode=disable password=123\" up\n</code></pre>\n"}, {"tags": ["go", "package", "subdirectory"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1554535509, "post_id": 55546574, "comment_id": 97795850, "body": "That&#39;s not possible in Go. If you need all the models all the time they should probably all be in the same package. Don&#39;t make tons of tiny packages in Go."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1554535328, "post_id": 55546622, "comment_id": 97795810, "body": "I think you misunderstood the question. The question is how to do some sort of wildcard import, importing multiple packages at once."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1554535473, "post_id": 55546622, "comment_id": 97795835, "body": "@Peter as in with wildcard? There is no wildcard in import, I think (<a href=\"https://stackoverflow.com/a/53356110/6309\">stackoverflow.com/a/53356110/6309</a>)"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 0, "last_activity_date": 1554533620, "creation_date": 1554533620, "answer_id": 55546622, "question_id": 55546574, "link": "https://stackoverflow.com/questions/55546574/how-to-import-all-sub-directories-from-a-certain-app-directory/55546622#55546622", "title": "How to import all sub-directories from a certain app directory?", "body": "<p>You would either:</p>\n\n<ul>\n<li>need to place <code>project_folder</code> in <code>$GOPATH/src</code> (as <a href=\"https://stackoverflow.com/q/33351387/6309\">in here</a>): the old way</li>\n<li>use a <code>go mod init project_folder</code> in order to declare a module named <code>project_folder</code>: the new way, with <strong><a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">go modules</a></strong>. (use <code>set GO111MODULE=on</code> or <code>export GO111MODULE=on</code>)</li>\n</ul>\n\n<p>In the latter case, your <code>project_folder</code> can be anywhere: no more <code>GOPATH</code>.</p>\n"}], "owner": {"reputation": 25, "user_id": 11320163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58deb7d0b4e4572c39f5fb2a861c0d61?s=128&d=identicon&r=PG", "display_name": "James Trt&#237;k", "link": "https://stackoverflow.com/users/11320163/james-trt%c3%adk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 1, "closed_date": 1554538686, "accepted_answer_id": 55546622, "answer_count": 1, "score": 0, "last_activity_date": 1554543403, "creation_date": 1554533130, "last_edit_date": 1554543403, "question_id": 55546574, "link": "https://stackoverflow.com/questions/55546574/how-to-import-all-sub-directories-from-a-certain-app-directory", "closed_reason": "Duplicate", "title": "How to import all sub-directories from a certain app directory?", "body": "<p>I am creating a http server with Golang. (I have a Php dev background.)\nIn the internal/app/model I plan on making several packages with artificial logic and I would wish to load all the sub-directories of the model folder in main.go.</p>\n\n<p>I have following folder structure:</p>\n\n<pre><code>[project folder]\n\\_cmd\n     \\_main.go\n.\n.\n.\n\\_internal\n          \\_app\n               \\_model\n                      \\_article\n                      \\_product\n</code></pre>\n\n<p>I have tried something in this sense without success:</p>\n\n<pre><code>import (\n    \"[project_folder]/[project]/internal/app/model/*\"\n)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 351, "user_id": 1774646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e594c1d84998cb4cdfe7008014788201?s=128&d=identicon&r=PG", "display_name": "abvarun226", "link": "https://stackoverflow.com/users/1774646/abvarun226"}, "is_accepted": true, "score": 1, "last_activity_date": 1554522104, "creation_date": 1554522104, "answer_id": 55545684, "question_id": 55545566, "link": "https://stackoverflow.com/questions/55545566/setting-values-of-concrete-struct-by-using-interface/55545684#55545684", "title": "Setting values of concrete struct by using interface", "body": "<p>You can use pointers like this,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    user := User{}\n\n    mw := SomeMiddleware{}\n    user.UserId = \"aaaa\"\n    mw.Process(&amp;user) // Send reference to user here (&amp;user)\n\n    fmt.Println(\"UserId: \" + user.UserId)\n}\n\ntype IUser interface {\n    SetUserId(string)\n}\n\ntype SomeMiddleware struct {\n}\n\nfunc (m *SomeMiddleware) Process(user IUser) { // Pointer receiver (m *SomeMiddleware)\n    user.SetUserId(\"userid1\")\n}\n\ntype User struct {\n    UserInfo\n}\n\ntype UserInfo struct {\n    UserId string\n}\n\nfunc (ui *UserInfo) SetUserId(userId string) {  // Pointer receiver (ui *UserInfo)\n    ui.UserId = userId\n}\n</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 9906848, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29ed63458c99b700675bde71fb3be71f?s=128&d=identicon&r=PG&f=1", "display_name": "jhurtas", "link": "https://stackoverflow.com/users/9906848/jhurtas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 55545684, "answer_count": 1, "score": 0, "last_activity_date": 1554522104, "creation_date": 1554520711, "question_id": 55545566, "link": "https://stackoverflow.com/questions/55545566/setting-values-of-concrete-struct-by-using-interface", "title": "Setting values of concrete struct by using interface", "body": "<p>I am trying to set the value of a property in a concrete struct, with a method that uses and interface implemented by that struct.  The struct is also composed by another struct.</p>\n\n<p>With the sample below userId value remains \"aaaa\" and is not updated to \"userid1\". </p>\n\n<p>How can I update values of struct through a method interface as parameter and the struct as argument?</p>\n\n<pre><code>func main() {\n\n    user:=User{}\n\n    mw:=SomeMiddleware{}\n    user.UserId=\"aaaa\"\n    mw.Process(user)\n\n    fmt.Println(\"UserId: \" + user.UserId)\n}\n\ntype IUser interface {\n   SetUserId(string)\n}\n\ntype SomeMiddleware struct {\n}\n\nfunc(m SomeMiddleware) Process(user IUser){\n    user.SetUserId(\"userid1\")\n}\n\n\ntype User struct {\n    UserInfo\n}\n\ntype UserInfo struct {\n    UserId string\n}\n\nfunc(ui UserInfo) SetUserId(userId string) {\n    ui.UserId=userId\n}\n</code></pre>\n"}, {"tags": ["go"], "owner": {"reputation": 141, "user_id": 7623165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69704fc06294638680f667f9cad69d84?s=128&d=identicon&r=PG&f=1", "display_name": "technoJ", "link": "https://stackoverflow.com/users/7623165/technoj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "closed_date": 1554535923, "answer_count": 0, "score": 1, "last_activity_date": 1554518257, "creation_date": 1554518006, "question_id": 55545344, "link": "https://stackoverflow.com/questions/55545344/get-the-total-length-of-a-sentense-including-white-space", "closed_reason": "Duplicate", "title": "Get the total length of a sentense including white space", "body": "<p>I'm trying to find the total length of a sentence(including whitespace). However I'm not quite getting the correct length as expected with the below code</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n  fmt.Print(\"Enter text: \")\n  var input string\n  fmt.Scanln(&amp;input)\n  fmt.Print(len(input))\n}\n</code></pre>\n\n<p>For the input \"My Computer\"</p>\n\n<p>Expected output : 11</p>\n\n<p>Actual output : 2</p>\n\n<p>I am new to Golang, appreciate any help in understanding me the issue with the code.</p>\n"}, {"tags": ["go", "flags"], "answers": [{"comments": [{"owner": {"reputation": 801, "user_id": 4391725, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5973ef6eb84598f93cf8e6f3af9dc82f?s=128&d=identicon&r=PG&f=1", "display_name": "jmvbxx", "link": "https://stackoverflow.com/users/4391725/jmvbxx"}, "edited": false, "score": 0, "creation_date": 1554518632, "post_id": 55545371, "comment_id": 97793474, "body": "Works like a charm. Thank you!"}], "tags": [], "owner": {"reputation": 1461, "user_id": 1741753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a8f485be30960038f792beab9785ada?s=128&d=identicon&r=PG", "display_name": "John Corry", "link": "https://stackoverflow.com/users/1741753/john-corry"}, "is_accepted": true, "score": 1, "last_activity_date": 1554518367, "creation_date": 1554518367, "answer_id": 55545371, "question_id": 55545303, "link": "https://stackoverflow.com/questions/55545303/how-to-pass-flag-variable-into-http-get-in-golang/55545371#55545371", "title": "How to pass flag variable into http.Get in Golang", "body": "<p>That's what <code>fmt.Sprintf</code> (<a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"nofollow noreferrer\">https://golang.org/pkg/fmt/#Sprintf</a>) is for.</p>\n\n<pre><code>response, err := http.Get(fmt.Sprintf(\"https://swapi.co/api/%s/1\", resourcePtr))\n</code></pre>\n"}], "owner": {"reputation": 801, "user_id": 4391725, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5973ef6eb84598f93cf8e6f3af9dc82f?s=128&d=identicon&r=PG&f=1", "display_name": "jmvbxx", "link": "https://stackoverflow.com/users/4391725/jmvbxx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 0, "accepted_answer_id": 55545371, "answer_count": 1, "score": 0, "last_activity_date": 1554518367, "creation_date": 1554517357, "question_id": 55545303, "link": "https://stackoverflow.com/questions/55545303/how-to-pass-flag-variable-into-http-get-in-golang", "title": "How to pass flag variable into http.Get in Golang", "body": "<p>I have a block of code which hardcodes the URL required for REST API that I am consuming. What I would like to do is, use the two flags to dynamically generate the URL. For example, something to the effect of:</p>\n\n<p><code>response, err := http.Get(\"https://swapi.co/api/%s/1\", resourcePtr)</code></p>\n\n<p>My current code is as follows:</p>\n\n<pre><code>func main() {\n\n    resourcePtr := flag.String(\"resource\", \"\", \"a string\")\n    idPtr := flag.Int(\"id\", 1, \"an int\")\n\n    flag.Parse()\n\n    response, err := http.Get(\"https://swapi.co/api/planets/1\")\n    if err != nil {\n        fmt.Printf(\"HTTP request failed with error %s\\n\", err)\n    } else {\n        data, _ := ioutil.ReadAll(response.Body)\n        fmt.Println(string(data))\n    }\n\n}\n</code></pre>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["go", "tcp", "kubernetes"], "comments": [{"owner": {"reputation": 1292, "user_id": 3443489, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/91bb9d2247e5e2f4b6c5ec3b94b87078?s=128&d=identicon&r=PG", "display_name": "MaurGi", "link": "https://stackoverflow.com/users/3443489/maurgi"}, "edited": false, "score": 0, "creation_date": 1554914027, "post_id": 55544914, "comment_id": 97928063, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/12741386/how-to-know-tcp-connection-is-closed-in-golang-net-package\">How to know TCP connection is closed in Golang net package?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1292, "user_id": 3443489, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/91bb9d2247e5e2f4b6c5ec3b94b87078?s=128&d=identicon&r=PG", "display_name": "MaurGi", "link": "https://stackoverflow.com/users/3443489/maurgi"}, "edited": false, "score": 0, "creation_date": 1554526260, "post_id": 55545640, "comment_id": 97794319, "body": "Thank you, yes we know of UDP and we already have some statsd services using it, but for several reasons, we need to have one that uses TCP."}], "tags": [], "owner": {"reputation": 499, "user_id": 1308313, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8f9232f7a37c2d6736fd6a73c43fc46f?s=128&d=identicon&r=PG", "display_name": "brianSan", "link": "https://stackoverflow.com/users/1308313/briansan"}, "is_accepted": false, "score": -1, "last_activity_date": 1554521503, "creation_date": 1554521503, "answer_id": 55545640, "question_id": 55544914, "link": "https://stackoverflow.com/questions/55544914/cannot-detect-that-a-tcp-service-in-kubernetes-has-no-pods-with-golang-app/55545640#55545640", "title": "Cannot detect that a tcp service in Kubernetes has no pods with golang app", "body": "<p>Is there a particular reason why you want to use a TCP connection? It looks like Statsd supports UDP mode <a href=\"https://www.datadoghq.com/blog/statsd/#how-does-statsd-work\" rel=\"nofollow noreferrer\">see here</a>. It seems like your desire to achieve resilience on your Statsd client would be better served if you opt to run the server over UDP.</p>\n"}, {"tags": [], "owner": {"reputation": 1292, "user_id": 3443489, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/91bb9d2247e5e2f4b6c5ec3b94b87078?s=128&d=identicon&r=PG", "display_name": "MaurGi", "link": "https://stackoverflow.com/users/3443489/maurgi"}, "is_accepted": true, "score": 0, "last_activity_date": 1554914081, "creation_date": 1554914081, "answer_id": 55617406, "question_id": 55544914, "link": "https://stackoverflow.com/questions/55544914/cannot-detect-that-a-tcp-service-in-kubernetes-has-no-pods-with-golang-app/55617406#55617406", "title": "Cannot detect that a tcp service in Kubernetes has no pods with golang app", "body": "<p>Ok so this is not a Kubernetes problem, but a golang one.</p>\n\n<p>This is basically a duplicate of <a href=\"https://stackoverflow.com/questions/12741386/how-to-know-tcp-connection-is-closed-in-golang-net-package?noredirect=1&amp;lq=1\">How to know TCP connection is closed in Golang net package?</a></p>\n"}], "owner": {"reputation": 1292, "user_id": 3443489, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/91bb9d2247e5e2f4b6c5ec3b94b87078?s=128&d=identicon&r=PG", "display_name": "MaurGi", "link": "https://stackoverflow.com/users/3443489/maurgi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 55617406, "answer_count": 2, "score": 1, "last_activity_date": 1554914081, "creation_date": 1554511916, "last_edit_date": 1554654576, "question_id": 55544914, "link": "https://stackoverflow.com/questions/55544914/cannot-detect-that-a-tcp-service-in-kubernetes-has-no-pods-with-golang-app", "title": "Cannot detect that a tcp service in Kubernetes has no pods with golang app", "body": "<p>I have a statsd client that pushes to a kubernetes-hosted statsd service in tcp.</p>\n\n<p>When I redeploy the service and update its pods on the server, the data stops flowing but I have no error on the statsd client.</p>\n\n<p>Based on <a href=\"https://stackoverflow.com/questions/12741386/how-to-know-tcp-connection-is-closed-in-golang-net-package\">this thread</a>, I have added a read detection to my golang library to see if I receive a message, but nothing.</p>\n\n<p>I start the connection, send statsd packets from the client, then after I while, I scale the statsd Service down to 0 pods, but the client continues to successfully read and write from the tcp channel without errors!</p>\n\n<p>When I scale the deployment back to 1, the old client does not reconnect and the client and the server continue to remain non-communicating forever.</p>\n\n<p>How can I receive an error from the client when the server replicas go to 0 in the Kubernetes service?</p>\n\n<p>The statsd client is a fork of <a href=\"https://github.com/alexcesaro/statsd\" rel=\"nofollow noreferrer\">https://github.com/alexcesaro/statsd</a></p>\n\n<p>Note that we are aware that statsd is used mostly in UDP but this is a custom flavor and for several reason we need one instance of this in TCP (already have several UDP ones and they don't have this problem)</p>\n\n<pre><code>...\n    c.w, err = net.DialTimeout(c.network, c.addr, 5*time.Second)\n...\n\nfunc (c *conn) checkTCPConnectionOpen() error {\n    if c.network[:3] == \"tcp\" {\n        one := []byte{}\n        _, err := c.w.Read(one)\n        return err\n    }\n    return nil\n}\n\nfunc (c *conn) flush(n int) {\n    if len(c.buf) == 0 {\n        return\n    }\n    if n == 0 {\n        n = len(c.buf)\n    }\n\n    err := c.checkTCPConnectionOpen()\n    c.handleError(err)\n\n    _, err = c.w.Write(c.buf[:n])\n    c.handleError(err)\n    if n &lt; len(c.buf) {\n        copy(c.buf, c.buf[n:])\n    }\n    c.buf = c.buf[:len(c.buf)-n]\n}\n</code></pre>\n"}, {"tags": ["go", "struct", "kubernetes-secrets"], "answers": [{"tags": [], "owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "is_accepted": false, "score": 3, "last_activity_date": 1554507811, "creation_date": 1554507811, "answer_id": 55544594, "question_id": 55544525, "link": "https://stackoverflow.com/questions/55544525/what-is-the-string-after-the-name-and-type-in-a-struct-in-golang/55544594#55544594", "title": "What is the string after the name and type in a struct in Golang?", "body": "<p>The <code>json:\"data,omitempty\" protobuf:\"bytes,2,rep,name=data\"</code> are called struct tags. Some useful links on the topic are:</p>\n\n<ul>\n<li>The official language spec <a href=\"https://golang.org/ref/spec#Tag\" rel=\"nofollow noreferrer\">here</a></li>\n<li>Some very well known ones <a href=\"https://github.com/golang/go/wiki/Well-known-struct-tags\" rel=\"nofollow noreferrer\">here</a></li>\n<li>A tutorial how to create custom ones <a href=\"https://sosedoff.com/2016/07/16/golang-struct-tags.html\" rel=\"nofollow noreferrer\">here</a>. </li>\n</ul>\n\n<p>The tags are part of the struct's definition and allow you to tell the struct how to store data, create mappings, do validations, etc. In fact, you'll see lots of them in Go packages that handle data.</p>\n"}], "owner": {"reputation": 23, "user_id": 10217413, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f0de0348ab0298db1972bc4e6343161?s=128&d=identicon&r=PG&f=1", "display_name": "mango", "link": "https://stackoverflow.com/users/10217413/mango"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 877, "favorite_count": 0, "closed_date": 1554507924, "answer_count": 1, "score": -1, "last_activity_date": 1554508143, "creation_date": 1554507294, "question_id": 55544525, "link": "https://stackoverflow.com/questions/55544525/what-is-the-string-after-the-name-and-type-in-a-struct-in-golang", "closed_reason": "Duplicate", "title": "What is the string after the name and type in a struct in Golang?", "body": "<p>I am looking at <a href=\"https://godoc.org/k8s.io/api/core/v1#Secret\" rel=\"nofollow noreferrer\">https://godoc.org/k8s.io/api/core/v1#Secret</a></p>\n\n<pre><code>type Secret struct {\n    metav1.TypeMeta `json:\",inline\"`\n    // Standard object's metadata.\n    // More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata\n    // +optional\n    metav1.ObjectMeta `json:\"metadata,omitempty\" protobuf:\"bytes,1,opt,name=metadata\"`\n\n    // Data contains the secret data. Each key must consist of alphanumeric\n    // characters, '-', '_' or '.'. The serialized form of the secret data is a\n    // base64 encoded string, representing the arbitrary (possibly non-string)\n    // data value here. Described in https://tools.ietf.org/html/rfc4648#section-4\n    // +optional\n    Data map[string][]byte `json:\"data,omitempty\" protobuf:\"bytes,2,rep,name=data\"`\n\n    // stringData allows specifying non-binary secret data in string form.\n    // It is provided as a write-only convenience method.\n    // All keys and values are merged into the data field on write, overwriting any existing values.\n    // It is never output when reading from the API.\n    // +k8s:conversion-gen=false\n    // +optional\n    StringData map[string]string `json:\"stringData,omitempty\" protobuf:\"bytes,4,rep,name=stringData\"`\n\n    // Used to facilitate programmatic handling of secret data.\n    // +optional\n    Type SecretType `json:\"type,omitempty\" protobuf:\"bytes,3,opt,name=type,casttype=SecretType\"`\n}\n</code></pre>\n\n<p>Take \n<code>Data map[string][]byte `json:\"data,omitempty\" protobuf:\"bytes,2,rep,name=data\"`\n</code> for example, I know <code>Data</code> is the name and <code>map[string][]byte</code> is the type, what is the third thing that follows? What does it do and when is it necessary to include this third thing?</p>\n"}, {"tags": ["go", "google-cloud-platform"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1554530291, "post_id": 55543740, "comment_id": 97794891, "body": "I am not able to find any documentation, because I don&#39;t know which exact package is behind <code>coputeService</code>. How does your imports look like? Did you try godoc.org?"}, {"owner": {"reputation": 73, "user_id": 3775490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a90c1f44c8f34c869b63493197d285e?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/3775490/siddharth"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1554655422, "post_id": 55543740, "comment_id": 97822518, "body": "Hi, This is the import i am using &quot;google.golang.org/api/compute/v1&quot; For your reference : <a href=\"https://cloud.google.com/compute/docs/reference/rest/v1/zones/list\" rel=\"nofollow noreferrer\">cloud.google.com/compute/docs/reference/rest/v1/zones/list</a>"}], "answers": [{"tags": [], "owner": {"reputation": 73, "user_id": 3775490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a90c1f44c8f34c869b63493197d285e?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/3775490/siddharth"}, "is_accepted": true, "score": 1, "last_activity_date": 1554742548, "creation_date": 1554742548, "answer_id": 55578247, "question_id": 55543740, "link": "https://stackoverflow.com/questions/55543740/how-to-add-filter-in-computeservice-zones-listproject-google-cloud-platform-ap/55578247#55578247", "title": "How to add filter in computeService.Zones.List(project) Google Cloud Platform API", "body": "<p>It will help someone in case:</p>\n\n<pre><code>req := computeService.Zones.List(\"ProjectName\")\nif err := req.Filter(\"name=us*\").Pages(ctx, func(page *compute.ZoneList) error {\n//Your code\n}\n\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 3775490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a90c1f44c8f34c869b63493197d285e?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth", "link": "https://stackoverflow.com/users/3775490/siddharth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 55578247, "answer_count": 1, "score": 0, "last_activity_date": 1554742548, "creation_date": 1554500659, "question_id": 55543740, "link": "https://stackoverflow.com/questions/55543740/how-to-add-filter-in-computeservice-zones-listproject-google-cloud-platform-ap", "title": "How to add filter in computeService.Zones.List(project) Google Cloud Platform API", "body": "<p>I am trying to filter the zone list, in the Google Cloud Platform API</p>\n\n<p>But I am not able to find any documentation in Google saying to put filter in the API:</p>\n\n<pre><code>req := computeService.Zones.List(project)\n</code></pre>\n\n<p>Above line of code will list the Zone in the Google Cloud Compute</p>\n\n<p>in command line we can do the same</p>\n\n<pre><code>gcloud compute zones list --filter=\"name:us-\"\n</code></pre>\n\n<p>Thanks,\nSid</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1554495933, "post_id": 55542847, "comment_id": 97788948, "body": "You cannot. It&#39;s up to the program being executed whether it buffers its output or not. Most things use <code>glibc</code>, which fully buffers stdout by default."}, {"owner": {"reputation": 5046, "user_id": 144213, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/30cf6f3b23d4f9c667978aeb25de9f6a?s=128&d=identicon&r=PG", "display_name": "Noah Watkins", "link": "https://stackoverflow.com/users/144213/noah-watkins"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554496108, "post_id": 55542847, "comment_id": 97789021, "body": "Good point. However, when I run <code>udevadm</code> on the CLI the output is immediate as well."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1554496256, "post_id": 55542847, "comment_id": 97789076, "body": "the <code>glibc</code> stdout is fully buffered by default, but line buffered when writing to a tty. If you want to introduce the additional burden of creating a pty, then you can get the output faster."}, {"owner": {"reputation": 5046, "user_id": 144213, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/30cf6f3b23d4f9c667978aeb25de9f6a?s=128&d=identicon&r=PG", "display_name": "Noah Watkins", "link": "https://stackoverflow.com/users/144213/noah-watkins"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1554496388, "post_id": 55542847, "comment_id": 97789117, "body": "Ahh, of course. Thanks. I suppose there must be a command that will run a target command in a ptty and pass stdout back through the pipe unbuffered?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1554496530, "post_id": 55542847, "comment_id": 97789174, "body": "Well, there&#39;s a series of syscalls you can use to create a pty to give to your program.  Library recommendation are off-topic for answers here, but take a look at <code>github.com&#47;kr&#47;pty</code> for example"}, {"owner": {"reputation": 5046, "user_id": 144213, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/30cf6f3b23d4f9c667978aeb25de9f6a?s=128&d=identicon&r=PG", "display_name": "Noah Watkins", "link": "https://stackoverflow.com/users/144213/noah-watkins"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554497641, "post_id": 55542847, "comment_id": 97789584, "body": "<code>stdbuf -oL ...</code> works ok"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1554510296, "post_id": 55542847, "comment_id": 97792579, "body": "See related this <a href=\"https://stackoverflow.com/questions/3332045/bash-force-execd-process-to-have-unbuffered-stdout\">related question</a>."}], "answers": [{"tags": [], "owner": {"reputation": 5046, "user_id": 144213, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/30cf6f3b23d4f9c667978aeb25de9f6a?s=128&d=identicon&r=PG", "display_name": "Noah Watkins", "link": "https://stackoverflow.com/users/144213/noah-watkins"}, "is_accepted": false, "score": 0, "last_activity_date": 1554497686, "creation_date": 1554497686, "answer_id": 55543239, "question_id": 55542847, "link": "https://stackoverflow.com/questions/55542847/reading-from-exec-command-stdout-without-buffering/55543239#55543239", "title": "Reading from exec command stdout without buffering", "body": "<p>I will propose that running <code>stdbuf -oL udevadm &lt;args&gt;</code> will achieve effectively what i\"m after (line buffered output).</p>\n"}], "owner": {"reputation": 5046, "user_id": 144213, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/30cf6f3b23d4f9c667978aeb25de9f6a?s=128&d=identicon&r=PG", "display_name": "Noah Watkins", "link": "https://stackoverflow.com/users/144213/noah-watkins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554497686, "creation_date": 1554495783, "question_id": 55542847, "link": "https://stackoverflow.com/questions/55542847/reading-from-exec-command-stdout-without-buffering", "title": "Reading from exec command stdout without buffering", "body": "<p>I'm running a command in Go via <code>exec.Command</code> and scanning the output. On some systems the output is immediate. But on some systems the output seems to be buffered. Unless the amount of data produced by the command is large enough, I don't actually receive the output.</p>\n\n<p>Is there anyway to get more immediate output, reliably?</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"log\"\n        \"os/exec\"\n        \"time\"\n)\n\nfunc main() {\n        cmd := exec.Command(\"udevadm\", \"monitor\")\n        stdout, err := cmd.StdoutPipe()\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        err = cmd.Start()\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        for {\n                p := make([]byte, 10)\n                n, _ := stdout.Read(p)\n                fmt.Println(\"@ \", time.Now().Unix(), \" \", n)\n        }\n}\n</code></pre>\n"}, {"tags": ["ssl", "go", "asn.1"], "answers": [{"tags": [], "owner": {"reputation": 518, "user_id": 2386276, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/056d4d69e6b2da152958bccc2538044a?s=128&d=identicon&r=PG", "display_name": "user2386276", "link": "https://stackoverflow.com/users/2386276/user2386276"}, "is_accepted": true, "score": 0, "last_activity_date": 1554496976, "creation_date": 1554496976, "answer_id": 55543086, "question_id": 55542717, "link": "https://stackoverflow.com/questions/55542717/is-there-an-interface-for-unmarshalling-a-tls-certificate-in-asn-1-format/55543086#55543086", "title": "Is there an interface for unmarshalling a TLS certificate in ASN.1 format", "body": "<p>The struct is in the <a href=\"https://golang.org/pkg/crypto/x509/#Certificate\" rel=\"nofollow noreferrer\">x509 package</a></p>\n"}], "owner": {"reputation": 518, "user_id": 2386276, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/056d4d69e6b2da152958bccc2538044a?s=128&d=identicon&r=PG", "display_name": "user2386276", "link": "https://stackoverflow.com/users/2386276/user2386276"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 55543086, "answer_count": 1, "score": 0, "last_activity_date": 1554496976, "creation_date": 1554495094, "question_id": 55542717, "link": "https://stackoverflow.com/questions/55542717/is-there-an-interface-for-unmarshalling-a-tls-certificate-in-asn-1-format", "title": "Is there an interface for unmarshalling a TLS certificate in ASN.1 format", "body": "<p>I'm parsing TLS records, taken from a PCAP file.</p>\n\n<p>I have the bytes of a TLS certificate in ASN.1 format (in a <code>[]byte</code>).</p>\n\n<p>I want to unmarshall this byte slice into a useful structure (avoiding having to manually parse ASN.1).</p>\n\n<p>I can't seem to find an interface for a TLS certificate that follows the <a href=\"https://tools.ietf.org/html/rfc5280#section-4.1\" rel=\"nofollow noreferrer\">RFC</a> in either <a href=\"https://golang.org/pkg/encoding/asn1/#pkg-overview\" rel=\"nofollow noreferrer\">encoding/asn1</a> nor <a href=\"https://golang.org/pkg/crypto/tls/\" rel=\"nofollow noreferrer\">crypto/tls</a>.</p>\n\n<p>Has this been created somewhere I can't find or do I need to write my own?</p>\n"}, {"tags": ["docker", "go", "docker-compose", "signals"], "comments": [{"owner": {"reputation": 15334, "user_id": 3348604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QybjW.jpg?s=128&g=1", "display_name": "Jan Garaj", "link": "https://stackoverflow.com/users/3348604/jan-garaj"}, "edited": false, "score": 0, "creation_date": 1554495143, "post_id": 55542550, "comment_id": 97788659, "body": "What is your docker version?"}, {"owner": {"reputation": 34123, "user_id": 16012, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a96d7d4f942af97c61081d92fa074ca3?s=128&d=identicon&r=PG", "display_name": "JoelFan", "link": "https://stackoverflow.com/users/16012/joelfan"}, "reply_to_user": {"reputation": 15334, "user_id": 3348604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QybjW.jpg?s=128&g=1", "display_name": "Jan Garaj", "link": "https://stackoverflow.com/users/3348604/jan-garaj"}, "edited": false, "score": 0, "creation_date": 1554495469, "post_id": 55542550, "comment_id": 97788783, "body": "@JanGaraj, docker version 18.09.2, docker-compose version 1.23.2, in my docker-compose.yml, I have: version: &#39;3.7&#39;"}, {"owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 0, "creation_date": 1554495986, "post_id": 55542550, "comment_id": 97788978, "body": "init should be a setting on the foo service, not a part of the build object."}, {"owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 1, "creation_date": 1554496022, "post_id": 55542550, "comment_id": 97788992, "body": "It&#39;s easier to assist if you provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 34123, "user_id": 16012, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a96d7d4f942af97c61081d92fa074ca3?s=128&d=identicon&r=PG", "display_name": "JoelFan", "link": "https://stackoverflow.com/users/16012/joelfan"}, "reply_to_user": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 0, "creation_date": 1554496277, "post_id": 55542550, "comment_id": 97789082, "body": "@BMitch... I fixed the question... it was a mistake in transcribing from my real file"}], "answers": [{"comments": [{"owner": {"reputation": 34123, "user_id": 16012, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a96d7d4f942af97c61081d92fa074ca3?s=128&d=identicon&r=PG", "display_name": "JoelFan", "link": "https://stackoverflow.com/users/16012/joelfan"}, "edited": false, "score": 0, "creation_date": 1554823294, "post_id": 55595917, "comment_id": 97888987, "body": "Does it matter that I&#39;m on Windows?"}, {"owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "reply_to_user": {"reputation": 34123, "user_id": 16012, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a96d7d4f942af97c61081d92fa074ca3?s=128&d=identicon&r=PG", "display_name": "JoelFan", "link": "https://stackoverflow.com/users/16012/joelfan"}, "edited": false, "score": 0, "creation_date": 1554829780, "post_id": 55595917, "comment_id": 97892329, "body": "I don&#39;t have a Windows environment on which to test."}], "tags": [], "owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "is_accepted": false, "score": 0, "last_activity_date": 1554822380, "creation_date": 1554822380, "answer_id": 55595917, "question_id": 55542550, "link": "https://stackoverflow.com/questions/55542550/init-true-does-not-forward-signals/55595917#55595917", "title": "init: true does not forward signals", "body": "<p>I'm unable to reproduce your issue:</p>\n\n<pre><code>$ docker-compose up -d            \nBuilding foo                                                                 \n...\nSuccessfully built 985c899d39fc\nSuccessfully tagged init-issue_foo:latest\nWARNING: Image for service foo was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.\nCreating init-issue_foo_1_5d74c24a9fce ... done\n\n$ docker-compose stop foo\nStopping init-issue_foo_1_e08f90ae3c56 ... done\n\n$ docker-compose logs foo\nAttaching to init-issue_foo_1_e08f90ae3c56\nfoo_1_e08f90ae3c56 | pid: 8\nfoo_1_e08f90ae3c56 | waiting\nfoo_1_e08f90ae3c56 | still waiting\nfoo_1_e08f90ae3c56 | still waiting\nfoo_1_e08f90ae3c56 | still waiting\nfoo_1_e08f90ae3c56 | still waiting\nfoo_1_e08f90ae3c56 | still waiting\nfoo_1_e08f90ae3c56 | still waiting\nfoo_1_e08f90ae3c56 | still waiting\nfoo_1_e08f90ae3c56 | still waiting\nfoo_1_e08f90ae3c56 | still waiting\nfoo_1_e08f90ae3c56 | terminated\nfoo_1_e08f90ae3c56 | got done\nfoo_1_e08f90ae3c56 | exiting\n</code></pre>\n\n<p>And if I try running it directly:</p>\n\n<pre><code>$ docker run -it --rm --init init-issue_foo\npid: 8\nwaiting\nstill waiting\n^Cinterrupt\ngot done\nexiting\n</code></pre>\n\n<p>In each case I see the \"got done\" line. If you are still not able to get this working successfully from the above example, please show your exact commands and their output that you run.</p>\n"}], "owner": {"reputation": 34123, "user_id": 16012, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a96d7d4f942af97c61081d92fa074ca3?s=128&d=identicon&r=PG", "display_name": "JoelFan", "link": "https://stackoverflow.com/users/16012/joelfan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 130, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1554822380, "creation_date": 1554494238, "last_edit_date": 1554755390, "question_id": 55542550, "link": "https://stackoverflow.com/questions/55542550/init-true-does-not-forward-signals", "title": "init: true does not forward signals", "body": "<p>I want my dockerized process to handle termination signals correctly, so I am using <code>init:true</code>.  I am using the following code in my <code>docker-compose.yml</code> file:</p>\n\n<pre><code>version: '3.7'\n\nservices:\n  foo:\n    build:\n      context: ./foo\n    init: true\n</code></pre>\n\n<p>However, the signal is not being received by my process.</p>\n\n<p>When I run my process <em>outside</em> of docker and hit Ctrl-C, I can see that the signal is being handled (my program prints a message in the signal handler), but <em>inside</em> of docker, the signal is not handled (my program doesn't print the message)</p>\n\n<p><strong>EDIT</strong>:</p>\n\n<p>Here is <code>foo/Dockerfile</code>:</p>\n\n<pre><code>FROM golang:1.11.4-alpine3.8 AS build\nWORKDIR /go/src/foo\nCOPY ./ ./\nRUN go build -a -tags netgo .\nFROM alpine:3.8\nWORKDIR /app\nCOPY --from=build /go/src/foo .\nCMD [\"./foo\"]\n</code></pre>\n\n<p>Here is foo/foo.go (just prints \"waiting\" messages in a loop until it receives a signal):</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"os\"\n  \"os/signal\"\n  \"time\"\n  \"syscall\"\n)\n\nvar done chan bool\nvar dur time.Duration\n\nfunc main() {    \n  sigs := make(chan os.Signal)\n  done = make(chan bool)\n  signal.Notify(sigs, syscall.SIGINT, syscall.SIGTERM)\n  pid := os.Getpid()\n  fmt.Println(\"pid:\", pid)\n\n  go func() {\n    sig := &lt;-sigs\n    fmt.Println(sig)\n    done &lt;- true\n  }()\n\n  fmt.Println(\"waiting\")\n\n  dur, _ = time.ParseDuration(\"2s\")\n\n  waitLoop()  \n\n  fmt.Println(\"exiting\")\n}\n\nfunc waitLoop() {\n  for {\n    select {\n      case _ = &lt;-done:\n       fmt.Println(\"got done\")\n       return\n\n      case &lt;- time.After(dur):\n    }\n\n    fmt.Println(\"still waiting\")\n  }\n}\n</code></pre>\n\n<p>When I build and run <code>foo.go</code> without Docker, when I hit Ctrl-C, the program exits gracefully (prints \"interrupt\", \"got done\" and \"exiting\").  When I run with Docker, none of these messages are printed.... it just exits.  In both cases, the pid printed is > 1.</p>\n"}, {"tags": ["image", "pdf", "go", "jpeg", "concat"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1554494240, "post_id": 55542284, "comment_id": 97788304, "body": "You described two attempts that &quot;don&#39;t work&quot; - what does &quot;not work&quot; mean? What happened? What specifically was the issue(s)?"}, {"owner": {"reputation": 361, "user_id": 4205778, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh3.googleusercontent.com/-67ocuJiNWxI/AAAAAAAAAAI/AAAAAAAAAFQ/fbNxuIQOe1M/photo.jpg?sz=128", "display_name": "Rakin Alam", "link": "https://stackoverflow.com/users/4205778/rakin-alam"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554494946, "post_id": 55542284, "comment_id": 97788593, "body": "I only see a single page with this code. The first page to he exact."}], "owner": {"reputation": 361, "user_id": 4205778, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh3.googleusercontent.com/-67ocuJiNWxI/AAAAAAAAAAI/AAAAAAAAAFQ/fbNxuIQOe1M/photo.jpg?sz=128", "display_name": "Rakin Alam", "link": "https://stackoverflow.com/users/4205778/rakin-alam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 358, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554495099, "creation_date": 1554492950, "last_edit_date": 1554495099, "question_id": 55542284, "link": "https://stackoverflow.com/questions/55542284/how-do-i-concat-multiple-image-into-a-single-image", "title": "How do I concat multiple image into a single image?", "body": "<p>I have converted pdf into a jpeg using go-fitz which gives me a list of jpeg in a directory. I am reading a list of images from a directory and then trying to combine them into a single image. The image is of type jpeg and works partially if I just use page 1 and 2 using the index. I want to stitch the pdf page jpeg images back into a single jpeg image. The end result of the code generate a single image with the first page.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/35964656/golang-how-to-concatenate-append-images-to-one-another\">Golang how to concatenate/append images to one another</a></p>\n\n<p>If I use image index 0 and 1 this code work. But not working in dynamic list with my code. But I will have a dynamic list of images that I need to put together into a single image. I am assuming it has something to do with the final image canvas size and adding it to the canvas. The code ends up having first and last page in a wide canvas and missing rest of the pages when I attempt the stack over flow example.</p>\n\n<pre><code>package converter\n\nimport (\n    \"fmt\"\n    \"image\"\n    \"image/draw\"\n    \"image/jpeg\"\n    \"os\"\n    \"path/filepath\"\n    \"strings\"\n\n    log \"github.com/sirupsen/logrus\"\n)\n\nfunc openAndDecode(imgPath string) image.Image {\n    img, err := os.Open(imgPath)\n    if err != nil {\n        log.Fatalf(\"Failed to open %s\", err)\n    }\n\n    decoded, _, err := image.Decode(img)\n    if err != nil {\n        log.Fatalf(\"Failed to decode %s\", err)\n    }\n    defer img.Close()\n\n    return decoded\n}\n\n// StichImages takes a directory of images and combine them into a single image\nfunc StichImages(dirPath string) {\n    fileList := []string{}\n    decodedImages := []image.Image{}\n    err := filepath.Walk(dirPath, func(path string, f os.FileInfo, err error) error {\n        fileList = append(fileList, path)\n        return nil\n    })\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // If there is only one image in folder no need to stich\n    if len(fileList) == 1 {\n        return\n    }\n\n    for _, filePath := range fileList {\n        if strings.Contains(filePath, \".jpg\") {\n            decodedImage := openAndDecode(filePath)\n            decodedImages = append(decodedImages, decodedImage)\n        }\n    }\n\n    outPutPath := filepath.Join(dirPath, \"output.jpg\")\n\n    if len(decodedImages) == 0 {\n        log.Error(fmt.Sprintf(\"No images found in: %s\", dirPath))\n    }\n\n    //starting position of the second image (bottom left)\n    startingPoint := image.Point{}\n    finalImageCanvas := image.Rectangle{image.Point{0, 0}, decodedImages[0].Bounds().Max}\n    rgba := image.NewRGBA(finalImageCanvas)\n\n    for index, newImage := range decodedImages {\n        if index == 0 {\n            startingPoint = image.Point{newImage.Bounds().Dx(), 0}\n            draw.Draw(rgba, newImage.Bounds(), newImage, image.Point{0, 0}, draw.Src)\n        } else {\n            newImageRect := image.Rectangle{startingPoint, startingPoint.Add(newImage.Bounds().Size())}\n            finalImageCanvas = image.Rectangle{image.Point{0, 0}, newImageRect.Max}\n            draw.Draw(rgba, newImageRect, newImage, image.Point{0, 0}, draw.Src)\n            startingPoint = image.Point{newImageRect.Bounds().Dx(), 0}\n        }\n    }\n\n    out, err := os.Create(outPutPath)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    var opt jpeg.Options\n    opt.Quality = 80\n\n    jpeg.Encode(out, rgba, &amp;opt)\n}\n\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 3522135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ca59b79f99a8bac0354c79c6053a2fe?s=128&d=identicon&r=PG&f=1", "display_name": "dt111", "link": "https://stackoverflow.com/users/3522135/dt111"}, "is_accepted": false, "score": 0, "last_activity_date": 1554926949, "creation_date": 1554926949, "answer_id": 55620578, "question_id": 55541067, "link": "https://stackoverflow.com/questions/55541067/how-to-use-singleflight-to-share-downloaded-large-size-file/55620578#55620578", "title": "How to use SingleFlight to share downloaded large size file?", "body": "<p><a href=\"https://github.com/golang/net/blob/master/http2/h2demo/h2demo.go#L181-L219\" rel=\"nofollow noreferrer\">https://github.com/golang/net/blob/master/http2/h2demo/h2demo.go#L181-L219</a>\nthis works. Turns out I need to return handler in singleFlight.Group.Do instead of the response. \nI don't know why</p>\n"}], "owner": {"reputation": 1, "user_id": 3522135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ca59b79f99a8bac0354c79c6053a2fe?s=128&d=identicon&r=PG&f=1", "display_name": "dt111", "link": "https://stackoverflow.com/users/3522135/dt111"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 221, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554926949, "creation_date": 1554487257, "question_id": 55541067, "link": "https://stackoverflow.com/questions/55541067/how-to-use-singleflight-to-share-downloaded-large-size-file", "title": "How to use SingleFlight to share downloaded large size file?", "body": "<p>I'm proxying a bunch of http GET calls through <code>singleflight</code>. But returned response is only seen by the first request. </p>\n\n<p>I also noticed a problem in my test. If the first request times out, the response will be lost.</p>\n\n<p>Let's say <code>r1,r2,r3</code> are requests that come in order. They are all grouped in one <code>groupKey</code>. If <code>r1</code> time out , <code>r2</code> and <code>r3</code> will wait until the shared HTTP call returns or until their own timeout.</p>\n\n<p>proxy code (credits to <a href=\"https://medium.com/@vCabbage/go-avoid-duplicate-requests-with-sync-singleflight-311601b3068b\" rel=\"nofollow noreferrer\">here</a>)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// add auth to the requst and proxy to target host\nvar serveReverseProxy = func(target string, res http.ResponseWriter, req *http.Request) {\n    log.Println(\"new request!\")\n    requestURL, _ := url.Parse(target)\n    proxy := httputil.NewSingleHostReverseProxy(requestURL)\n    req1, _ := http.NewRequest(req.Method, req.RequestURI, req.Body)\n    for k, v := range req.Header {\n        for _, vv := range v {\n            req1.Header.Add(k, vv)\n        }\n    }\n    req1.Header.Set(\"Authorization\", \"Bearer \"+\"some token\")\n    req1.Host = requestURL.Host\n\n    proxy.ServeHTTP(res, req1)\n}\n\nvar requestGroup singleflight.Group\nmockBackend := httptest.NewServer(http.HandlerFunc(func(res http.ResponseWriter, req *http.Request) {\n    groupKey := req.Host + req.RequestURI\n    name := req.Header.Get(\"From\")\n    ch := requestGroup.DoChan(groupKey, func() (interface{}, error) {\n        //increase key retention to 20s to make sure r1,r2,r3 are all in one group\n        go func() {\n            time.Sleep(20 * time.Second)\n            requestGroup.Forget(groupKey)\n            log.Println(\"Key deleted :\", groupKey)\n        }()\n\n        // proxy to some host and expect the result to be written in res\n        serveReverseProxy(\"https://somehost.com\", res, req)\n        return nil, nil\n    })\n\n    timeout := time.After(15 * time.Second)\n\n    var result singleflight.Result\n    select {\n    case &lt;-timeout: // Timeout elapsed, send a timeout message (504)\n        log.Println(name, \" timed out\")\n        http.Error(res, \"request timed out\", http.StatusGatewayTimeout)\n        return\n    case result = &lt;-ch: // Received result from channel\n    }\n\n    if result.Err != nil {\n        http.Error(res, result.Err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    if result.Shared {\n        log.Println(name, \" is shared\")\n    } else {\n        log.Println(name, \" not shared\")\n    }\n}))\n</code></pre>\n\n<p>I'd expect <code>r2</code>,<code>r3</code> to either</p>\n\n<ol>\n<li>at least see the result from their own reponseWriter</li>\n<li>timeout along with <code>r1</code></li>\n</ol>\n"}]