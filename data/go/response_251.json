[{"tags": ["go", "copy", "slice"], "comments": [{"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 1, "creation_date": 1572479808, "post_id": 58634721, "comment_id": 103577150, "body": "While the A.R. Answer is better, your attempt with the append inside a loop should also works."}], "answers": [{"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 2, "last_activity_date": 1572476307, "creation_date": 1572476307, "answer_id": 58634743, "question_id": 58634721, "link": "https://stackoverflow.com/questions/58634721/how-to-copy-a-slice-to-itself/58634743#58634743", "title": "How to copy a slice to itself", "body": "<p>Use <code>arr = append(arr, arr...)</code>, try <a href=\"https://play.golang.org/p/AD-r9SP610u\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    arr := []int{1, 2, 3}\n    arr = append(arr, arr...)\n    fmt.Println(arr)\n}\n\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[1 2 3 1 2 3]\n</code></pre>\n"}], "owner": {"reputation": 36, "user_id": 10938923, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gQHAm.jpg?s=128&g=1", "display_name": "Jack3G", "link": "https://stackoverflow.com/users/10938923/jack3g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 58634743, "answer_count": 1, "score": -1, "last_activity_date": 1572511522, "creation_date": 1572476159, "last_edit_date": 1572511522, "question_id": 58634721, "link": "https://stackoverflow.com/questions/58634721/how-to-copy-a-slice-to-itself", "title": "How to copy a slice to itself", "body": "<p>What I mean is, for example</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>arr := []int{1, 2, 3}\narr = copy(arr, arr)\nfmt.Println(arr) // Expectation: [1, 2, 3, 1, 2, 3] Reality: [1, 2, 3]\n</code></pre>\n\n<p>I also tried</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>for _, el := range(arr) {\n    arr = append(arr, el)\n}\n</code></pre>\n\n<p>None of these work.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1572477707, "post_id": 58633730, "comment_id": 103576687, "body": "You can have any number of files in your main package. I suggest you start with the documentation and see how packages work, which will probably provide a lot of insight into how you can modularize your code."}], "answers": [{"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": true, "score": 1, "last_activity_date": 1572475354, "creation_date": 1572475354, "answer_id": 58634595, "question_id": 58633730, "link": "https://stackoverflow.com/questions/58633730/how-to-modularize-handler-functions-and-routes/58634595#58634595", "title": "How to modularize handler functions and routes", "body": "<p>Here is how I do it. Say you have a ping handler which checks a database connection, and you have it in a package named <code>your/app/animal</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package animal\n\n...\n\nfunc Ping(db *sql.DB) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        if err := db.PingContext(context.TODO()); err != nil {\n            http.Error(w, err, http.StatusInternalServerError)\n        }\n    })\n}\n</code></pre>\n\n<p>You can set it up like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\n...\n\nfunc main() {\n   db, _ := sql.Open(\"foo\",os.GetEnv(\"DB\"))\n   http.Handle(\"/ping\",animal.Ping(db))\n   log.Fatal(http.ListenAndServe(os.GetEnv(\"BIND\"),nil)\n}\n</code></pre>\n"}], "owner": {"reputation": 1792, "user_id": 3068500, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0cf641fb92b7fd2625f7690aac7f424c?s=128&d=identicon&r=PG&f=1", "display_name": "Gambit2007", "link": "https://stackoverflow.com/users/3068500/gambit2007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "closed_date": 1572511638, "accepted_answer_id": 58634595, "answer_count": 1, "score": 0, "last_activity_date": 1572511621, "creation_date": 1572470006, "last_edit_date": 1572511621, "question_id": 58633730, "link": "https://stackoverflow.com/questions/58633730/how-to-modularize-handler-functions-and-routes", "closed_reason": "Duplicate", "title": "How to modularize handler functions and routes", "body": "<p>I realized that when building a web server, all of the routes and functions that handle them are in the <code>main.go</code> file.\nAs the application grows, I imagine it could be hard to keep track of everything.</p>\n\n<p>Is there a convention regarding \"storing\" the routes and handler functions in a file other than <code>main.go</code>?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1572468208, "post_id": 58633251, "comment_id": 103573687, "body": "That&#39;s all the code that i use, or you need something more specific?"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 2, "last_activity_date": 1572472292, "last_edit_date": 1572472292, "creation_date": 1572471587, "answer_id": 58634025, "question_id": 58633251, "link": "https://stackoverflow.com/questions/58633251/unmarshal-json-array-of-object-obtained-from-postgresql/58634025#58634025", "title": "Unmarshal Json Array of object obtained from postgresql", "body": "<p><strong>1.</strong></p>\n\n<p>As you can see from the documentation the <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"nofollow noreferrer\"><code>Scanner</code></a> interface, to be satisfied, requires the method</p>\n\n<pre><code>Scan(src interface{}) error\n</code></pre>\n\n<p>But your <code>*Coordinates</code> type implements a different method</p>\n\n<pre><code>Scan(value []interface{}) error\n</code></pre>\n\n<p>The types <code>interface{}</code> and <code>[]interface{}</code> are two very different things.</p>\n\n<p><strong>2.</strong></p>\n\n<p>The Scanner interface must be implemented on the type of the field which you want to pass as an argument to <a href=\"https://golang.org/pkg/database/sql/#Rows.Scan\" rel=\"nofollow noreferrer\"><code>rows.Scan</code></a>. That is, you've implemented your <code>Scan</code> method on <code>*Coordinates</code> but the type of the Location field is <code>[]Coordinates</code>.</p>\n\n<p>Again, same thing, the types <code>*Coordinates</code> and <code>[]Coordinates</code> are two very different things.</p>\n\n<hr>\n\n<p>So the solution is to implement the interface properly and on the proper type.</p>\n\n<p>Note that since Go doesn't allow adding methods to unnamed types, and <code>[]Coordinates</code> <em>is</em> an unnamed type, you need to declare a new type that you'll then use in place of <code>[]Coordinates</code>.</p>\n\n<pre><code>type CoordinatesSlice []Coordinates\n\nfunc (s *CoordinatesSlice) Scan(src interface{}) error {\n    switch v := src.(type) {\n    case []byte:\n        return json.Unmarshal(v, s)\n    case string:\n        return json.Unmarshal([]byte(v), s)\n    }\n    return errors.New(\"type assertion failed\")\n}\n\n// ...\n\ntype Business struct {\n    // ...\n    Location CoordinatesSlice `json:\"location,omitempty\"`\n    // ...\n}\n</code></pre>\n\n<hr>\n\n<p><strong>NOTE</strong></p>\n\n<p>If the business location will always have only <em>one</em> pair of coordinates store into the db as a jsonb object and change the <code>Location</code> type from <code>CoordinatesSlice</code> to <code>Coordinates</code> and accordingly move the <code>Scanner</code> implementation from <code>*CoordinatesSlice</code> to <code>*Coordinates</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "is_accepted": true, "score": 0, "last_activity_date": 1572475233, "creation_date": 1572475233, "answer_id": 58634571, "question_id": 58633251, "link": "https://stackoverflow.com/questions/58633251/unmarshal-json-array-of-object-obtained-from-postgresql/58634571#58634571", "title": "Unmarshal Json Array of object obtained from postgresql", "body": "<p>I know that this solution is really unoptimized, but it was the only way that it works.</p>\n\n<p>basically i have to obtain the json and then do an unmarshal into the Location attribute.</p>\n\n<pre><code>var location string = \"\"\n\nif err := json.Unmarshal([]byte(location), &amp;business.Location); err != nil { panic(err) }\n</code></pre>\n"}], "owner": {"reputation": 846, "user_id": 6582127, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/ijqtr.png?s=128&g=1", "display_name": "Luis Cardoza Bird", "link": "https://stackoverflow.com/users/6582127/luis-cardoza-bird"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1194, "favorite_count": 0, "accepted_answer_id": 58634571, "answer_count": 2, "score": 4, "last_activity_date": 1572475233, "creation_date": 1572467623, "last_edit_date": 1572471968, "question_id": 58633251, "link": "https://stackoverflow.com/questions/58633251/unmarshal-json-array-of-object-obtained-from-postgresql", "title": "Unmarshal Json Array of object obtained from postgresql", "body": "<p>I have a table in Postgres that is a Jsonb</p>\n\n<pre><code>Create Table Business(\n    id serial not null primary key,\n    id_category integer not null,\n    name varchar(50) not null,\n    owner varchar(200) not null,\n    coordinates jsonb not null,\n    reason varchar(300) not null,\n    foreign key(id_category) references Category(id)\n);\n</code></pre>\n\n<p>as you can see i <strong>store</strong> the <strong>coordinates</strong> as a <strong>jsonb</strong></p>\n\n<p>ex: </p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>Insert into Business(id_category, name, owner, coordinates, reason) \nvalues \n(1,'MyName','Owner', [{\"latitude\": 12.1268142, \"longitude\": -86.2754}]','Description')\n</code></pre>\n\n<p>the way that I extract the data and assign it is like this.</p>\n\n<pre><code>type Business struct {\n    ID int `json:\"id,omitempty\"`\n    Name string `json:\"name,omitempty\"`\n    Owner string `json:\"owner,omitempty\"`\n    Category string `json:\"category,omitempty\"`\n    Departments []string `json:\"departments,omitempty\"`\n    Location []Coordinates `json:\"location,omitempty\"`\n    Reason string `json:\"reason,omitempty\"`\n}\n\ntype Coordinates struct {\n    Latitude float64 `json:\"latitude,omitempty\"`\n    Longitude float64 `json:\"longitude,omitempty\"`\n}\n\nfunc (a Coordinates) Value() (driver.Value, error) {\n    return json.Marshal(a)\n}\n\nfunc (a *Coordinates) Scan(value []interface{}) error {\n    b, ok := value.([]byte)\n    if !ok {\n        return errors.New(\"type assertion to []byte failed\")\n    }\n    return json.Unmarshal(b, &amp;a)\n}\n</code></pre>\n\n<p>However, I keep receiving this message.</p>\n\n<blockquote>\n  <p>sql: Scan error on column index 3, name \"coordinates\": unsupported\n  Scan, storing driver.Value type []uint8 into type *models.Coordinates</p>\n</blockquote>\n\n<p>And the controller that I use to extract the information is this.</p>\n\n<pre><code>func (b *BusinessRepoImpl) Select() ([]models.Business, error) {\n    business_list := make([]models.Business, 0)\n    rows, err := b.Db.Query(\"SELECT business.id, business.name, business.owner, business.coordinates, business.reason_froggy, category.category FROM business INNER JOIN category on category.id = business.id_category group by business.id, business.name, business.owner, business.coordinates, business.reason_froggy, category.category\")\n    if err != nil {\n        return business_list, err\n    }\n    for rows.Next() {\n        business := models.Business{}\n        err := rows.Scan(&amp;business.ID, &amp;business.Name, &amp;business.Owner, &amp;business.Location, &amp;business.Reason, &amp;business.Category)\n        if err !=  nil {\n            break\n        }\n        business_list = append(business_list, business)\n    }\n    err = rows.Err()\n    if err != nil {\n        return business_list, err\n    }\n    return business_list, nil\n}\n</code></pre>\n\n<p>Can anyone please tell me how to solve this issue? Retrieve the json array of objects and assign it to the coordinates field inside Business.</p>\n"}, {"tags": ["http", "go", "handler"], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 43, "user_id": 6798064, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-UNtYC2qU6sI/AAAAAAAAAAI/AAAAAAAAGp0/KTiNPMabwaY/photo.jpg?sz=128", "display_name": "Sterisk", "link": "https://stackoverflow.com/users/6798064/sterisk"}, "edited": false, "score": 0, "creation_date": 1572473928, "post_id": 58633357, "comment_id": 103575698, "body": "@Sterisk, yes, sorry for confusion."}, {"owner": {"reputation": 43, "user_id": 6798064, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-UNtYC2qU6sI/AAAAAAAAAAI/AAAAAAAAGp0/KTiNPMabwaY/photo.jpg?sz=128", "display_name": "Sterisk", "link": "https://stackoverflow.com/users/6798064/sterisk"}, "edited": false, "score": 0, "creation_date": 1572523622, "post_id": 58633357, "comment_id": 103591288, "body": "Is there a way to interrupt a cmd.Run() inside ReallyLongFunction or can I only check closed() once it&#39;s completed?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 43, "user_id": 6798064, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-UNtYC2qU6sI/AAAAAAAAAAI/AAAAAAAAGp0/KTiNPMabwaY/photo.jpg?sz=128", "display_name": "Sterisk", "link": "https://stackoverflow.com/users/6798064/sterisk"}, "edited": false, "score": 0, "creation_date": 1572536205, "post_id": 58633357, "comment_id": 103598539, "body": "@Sterisk, expanded by answer. But you did not tell us an important detail: does your handler somehow deliver what that process generates at runtime to the client (like piping the process&#39; output to the client)?"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 8, "last_activity_date": 1573045604, "last_edit_date": 1573045604, "creation_date": 1572468175, "answer_id": 58633357, "question_id": 58633108, "link": "https://stackoverflow.com/questions/58633108/how-to-interrupt-an-http-handler/58633357#58633357", "title": "How to interrupt an HTTP handler?", "body": "<p>There's no way to forcibly tear a goroutine down from any code <em>external</em> to that goroutine.</p>\n\n<p>Hence the only way to actually interrupt processing is to periodically check whether the client is gone (or whether there's another signal to stop processing).</p>\n\n<p>Basically that would amount to structuring your handler something like this</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func ReallyLongFunction(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello World!\")\n\n    done := r.Context().Done()\n\n    // Check wheteher we're done\n\n    // do some small piece of stuff\n\n    // check whether we're done\n\n    // do another small piece of stuff\n\n    // \u2026rinse, repeat\n})\n</code></pre>\n\n<p>Now a way to check whether there was something written to a channel, but without blocking the operation is to use the \"select with default\" idiom:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>select {\n    case &lt;- done:\n        // We're done\n    default:\n}\n</code></pre>\n\n<p>This statemept executes the code in the \"// We're done\" block if and only if <code>done</code> was written to or was closed (which is the case with contexts), and otherwis the empty block in the <code>default</code> branch is executed.</p>\n\n<p>So we can refactor that to something like</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func ReallyLongFunction(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello World!\")\n\n    done := r.Context().Done()\n    closed := func () bool {\n        select {\n            case &lt;- done:\n                return true\n            default:\n                return false\n        }\n    }\n\n    if closed() {\n        return\n    }\n\n    // do some small piece of stuff\n\n    if closed() {\n        return\n    }\n\n    // do another small piece of stuff\n\n    // \u2026rinse, repeat\n})\n</code></pre>\n\n<hr>\n\n<h2>Stopping an external process started in an HTTP handler</h2>\n\n<p>To address the OP's comment\u2026</p>\n\n<p>The <code>os/exec.Cmd</code> type has the <code>Process</code> field, which is of type <code>os.Process</code> and that type supports the <code>Kill</code> method which forcibly brings the running process down.</p>\n\n<p>The only problem is that <code>exec.Cmd.Run</code> blocks until the process exits,\nso the goroutine which is executing it cannot execute other code, and if <code>exec.Cmd.Run</code> is called in an HTTP handler, there's no way to cancel it.</p>\n\n<p>How to best handle running a program in such an asynchronous manner heavily depends on how the process itself is organized but I'd roll like this:</p>\n\n<ol>\n<li><p>In the handler, prepare the process and then start it using <code>exec.Cmd.Start</code> (as opposed to <code>Run</code>).</p>\n\n<p>Check the error value <code>Start</code> have returned: if it's <code>nil</code>\nthe process has managed to start OK. Otherwise somehow communicate the failure to the client and quit the handler.</p>\n\n<p>Once the process is known to had started, the <code>exec.Cmd</code> value\nhas some of its fields populated with process-related information;\nof particular interest is the <code>Process</code> field which is of type\n<code>os.Process</code>: that type has the <code>Kill</code> method which may be used to forcibly bring the process down.</p></li>\n<li><p>Start a goroutine and pass it that <code>exec.Cmd</code> value and a channel of some suitable type (see below).</p>\n\n<p>That goroutine should call <code>Wait</code> on it and once it returns,\nit should communicate that fact back to the originating goroutine over that channel.</p>\n\n<p>Exactly what to communicate, is an open question as it depends\non whether you want to collect what the process wrote to its standard\noutput and error streams and/or may be some other data related to the process' activity.</p>\n\n<p>After sending the data, that goroutine exits.</p></li>\n<li><p>The main goroutine (executing the handler) should just call <code>exec.Cmd.Process.Kill</code> when it detect the handler should terminate.</p>\n\n<p>Killing the process eventually unblocks the goroutine which is executing <code>Wait</code> on that same <code>exec.Cmd</code> value as the process exits.</p>\n\n<p>After killing the process, the handler goroutine waits on the channel to hear back from the goroutine watching the process. The handler does something with that data (may be logs it or whatever) and exits.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 2, "last_activity_date": 1572469977, "last_edit_date": 1572469977, "creation_date": 1572468611, "answer_id": 58633455, "question_id": 58633108, "link": "https://stackoverflow.com/questions/58633108/how-to-interrupt-an-http-handler/58633455#58633455", "title": "How to interrupt an HTTP handler?", "body": "<p>You should cancel the goroutine from inside, so for a long calculation task, you may provide checkpoints, to stop and check for the cancelation:  </p>\n\n<p>Here is the tested code for the server which has e.g. long calculation task and <strong>checkpoints</strong> for the cancelation:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main() {\n    http.HandleFunc(`/`, func(w http.ResponseWriter, r *http.Request) {\n        ctx := r.Context()\n\n        log.Println(\"wait a couple of seconds ...\")\n        for i := 0; i &lt; 10; i++ { // long calculation\n            select {\n            case &lt;-ctx.Done():\n                log.Println(\"Client closed the connection:\", ctx.Err())\n                return\n            default:\n                fmt.Print(\".\")\n                time.Sleep(200 * time.Millisecond) // long calculation\n            }\n        }\n        io.WriteString(w, `Hi`)\n        log.Println(\"Done.\")\n    })\n    log.Println(http.ListenAndServe(\":8081\", nil))\n}\n</code></pre>\n\n<p>Here is the client code, which times out:</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main() {\n    log.Println(\"HTTP GET\")\n    client := &amp;http.Client{\n        Timeout: 1 * time.Second,\n    }\n    r, err := client.Get(`http://127.0.0.1:8081/`)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer r.Body.Close()\n    bs, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Println(\"HTTP Done.\")\n    log.Println(string(bs))\n}\n\n</code></pre>\n\n<p>You may use normal <a href=\"http://localhost:8081/\" rel=\"nofollow noreferrer\">browser</a> to check for not canclation, or close it, refresh it , disconect it, or ..., for the cancelation.</p>\n"}], "owner": {"reputation": 43, "user_id": 6798064, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-UNtYC2qU6sI/AAAAAAAAAAI/AAAAAAAAGp0/KTiNPMabwaY/photo.jpg?sz=128", "display_name": "Sterisk", "link": "https://stackoverflow.com/users/6798064/sterisk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 58633357, "answer_count": 2, "score": 0, "last_activity_date": 1573045604, "creation_date": 1572466941, "last_edit_date": 1572469144, "question_id": 58633108, "link": "https://stackoverflow.com/questions/58633108/how-to-interrupt-an-http-handler", "title": "How to interrupt an HTTP handler?", "body": "<p>Say I have a http handler like this:</p>\n\n<pre><code>func ReallyLongFunction(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintf(w, \"Hello World!\")\n        // run code that takes a long time here\n        // Executing dd command with cmd.Exec..., etc.\n\n})\n</code></pre>\n\n<p>Is there a way I can interrupt this function if the user refreshes the page or kills the request some other way without running the subsequent code and how would I do it?</p>\n\n<p>I tried doing this:</p>\n\n<pre><code>notify := r.Context().Done()\ngo func() {\n    &lt;-notify\n     println(\"Client closed the connection\")\n     s.downloadCleanup()\n     return\n}()\n</code></pre>\n\n<p>but the code after whenever I interrupt it still runs anyway.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1572469227, "creation_date": 1572469227, "answer_id": 58633576, "question_id": 58633080, "link": "https://stackoverflow.com/questions/58633080/best-way-to-constantly-receive-json-and-write-to-disk-based-on-time-period/58633576#58633576", "title": "Best way to constantly receive JSON and write to disk based on time period", "body": "<p>Your solution looks good, except for the  synchronization piece:</p>\n\n<pre><code>var (\n    messages Messages\n    lock sync.Mutex\n)\n\n...\n newmessage := &lt;-c\n lock.Lock()\n messages = append(messages, newmessage)\n lock.Unlock()\n</code></pre>\n\n<p>And for reading:</p>\n\n<pre><code>case &lt;-tick:\n    // Take a snapshot of messages, and reset it\n    lock.Lock()\n    msgs:=messages\n    messages=Messages{}\n    lock.Unlock()\n    content, _ := json.Marshal(msgs)\n    // No need for messages=nil\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 0, "last_activity_date": 1572516865, "creation_date": 1572516865, "answer_id": 58641053, "question_id": 58633080, "link": "https://stackoverflow.com/questions/58633080/best-way-to-constantly-receive-json-and-write-to-disk-based-on-time-period/58641053#58641053", "title": "Best way to constantly receive JSON and write to disk based on time period", "body": "<p>Here is a version that locks as little as possible and try to minimize allocations. It is also relatively simple and portable.</p>\n\n<p>It uses a single select to avoid additional locking mechanism and write the json file async to prevent blocking of the consumer channel.</p>\n\n<p>There is a dedicated json writer worker, that prevents an async call in the middle of the main select that would require additional JIT synchronization mechanism.</p>\n\n<p>I also added the required mechanisms to finish the program properly (IE: close producer, drain consumer, drain messages, wait for flush on disk).</p>\n\n<p><a href=\"https://play.golang.org/p/5k3DgrceqKH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5k3DgrceqKH</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"os\"\n    \"os/signal\"\n    \"sync\"\n    \"time\"\n)\n\ntype Message map[string]interface{}\ntype Messages []Message\n\nfunc main() {\n    c := make(chan Message)\n\n    go func() {\n        tick := time.Tick(200 * time.Millisecond)\n        s := make(chan os.Signal)\n        signal.Notify(s)\n        for {\n            select {\n            case &lt;-s:\n                close(c)\n                return\n            case &lt;-tick:\n                mb := []byte(`{ \"glossary\": { \"title\": \"example glossary\", \"GlossDiv\": { \"title\": \"S\", \"GlossList\": { \"GlossEntry\": { \"ID\": \"SGML\", \"SortAs\": \"SGML\", \"GlossTerm\": \"Standard Generalized Markup Language\", \"Acronym\": \"SGML\", \"Abbrev\": \"ISO 8879:1986\", \"GlossDef\": { \"para\": \"A meta-markup language, used to create markup languages such as DocBook.\", \"GlossSeeAlso\": [\"GML\", \"XML\"] }, \"GlossSee\": \"markup\" } } } } }`)\n                var message Message\n                json.Unmarshal(mb, &amp;message)\n                c &lt;- message\n            }\n        }\n    }()\n\n    var msgPool = sync.Pool{\n        New: func() interface{} {\n            return Messages{}\n        },\n    }\n    var wg sync.WaitGroup\n    wg.Add(1)\n    defer wg.Wait()\n    cMessages := make(chan Messages)\n    go func() {\n        defer wg.Done()\n        for messages := range cMessages {\n            log.Println(\"saved\", len(messages), \"messages\")\n            // content, _ := json.Marshal(messages)\n            // now := time.Now().Unix()\n            // filename := \"test\" + strconv.FormatInt(now, 10) + \".json\"\n            // err := ioutil.WriteFile(filename, content, 0644)\n            // if err != nil {\n            //     log.Println(err)\n            // }\n            msgPool.Put(messages)\n        }\n    }()\n\n    messages := msgPool.Get().(Messages)\n    save := time.Tick(1 * time.Second)\n    for {\n        select {\n        case newmessage, ok := &lt;-c:\n            if !ok {\n                &lt;-save\n                cMessages &lt;- messages\n                close(cMessages)\n                return\n            }\n            messages = append(messages, newmessage)\n        case &lt;-save:\n            cMessages &lt;- messages\n\n            messages = msgPool.Get().(Messages)\n            messages = messages[:0]\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 12299667, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAjuzoLVQEPDclx3A2j9-kTwq6fZPx4bnvdGN2ZUg=k-s128", "display_name": "GeekSmith", "link": "https://stackoverflow.com/users/12299667/geeksmith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1572516865, "creation_date": 1572466818, "question_id": 58633080, "link": "https://stackoverflow.com/questions/58633080/best-way-to-constantly-receive-json-and-write-to-disk-based-on-time-period", "title": "Best way to constantly receive JSON and write to disk based on time period", "body": "<p>I'm having difficulty coming up with a solution for constantly receiving JSON and appending it to a slice, then periodically based on a set time internal writing it to disk. I've come up with a solution however reading/writing to the same slice without any synchronization. </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"runtime\"\n    \"strconv\"\n    \"time\"\n)\n\ntype Message map[string]interface{}\ntype Messages []Message\n\nvar (\n    messages Messages\n)\n\nfunc main() {\n    c := make(chan Message)\n\n    var messages Messages\n\n    go func() {\n        tick := time.Tick(200 * time.Millisecond)\n        for {\n            select {\n            case &lt;-tick:\n                mb := []byte(`{ \"glossary\": { \"title\": \"example glossary\", \"GlossDiv\": { \"title\": \"S\", \"GlossList\": { \"GlossEntry\": { \"ID\": \"SGML\", \"SortAs\": \"SGML\", \"GlossTerm\": \"Standard Generalized Markup Language\", \"Acronym\": \"SGML\", \"Abbrev\": \"ISO 8879:1986\", \"GlossDef\": { \"para\": \"A meta-markup language, used to create markup languages such as DocBook.\", \"GlossSeeAlso\": [\"GML\", \"XML\"] }, \"GlossSee\": \"markup\" } } } } }`)\n                var message Message\n                json.Unmarshal(mb, &amp;message)\n                c &lt;- message\n            }\n        }\n    }()\n\n    go func() {\n        tick := time.Tick(30 * time.Second)\n\n        for {\n            select {\n            case &lt;-tick:\n                content, _ := json.Marshal(messages)\n                now := time.Now().Unix()\n                filename := \"test\" + strconv.FormatInt(now, 10) + \".json\"\n                err := ioutil.WriteFile(filename, content, 0644)\n                if err != nil {\n                    panic(err)\n                }\n\n                messages = nil\n            }\n        }\n    }()\n\n    for {\n        newmessage := &lt;-c\n        messages = append(messages, newmessage)\n    }\n}\n\n\n</code></pre>\n\n<p>Expecting 1 file per 30 seconds containing all messages received within last 30 seconds with no missed messages.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572459601, "post_id": 58631456, "comment_id": 103570129, "body": "I would dump it as JSON and rehydrate it from that."}, {"owner": {"reputation": 33, "user_id": 8464638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f024a285a0951332f8b8ce3718488e?s=128&d=identicon&r=PG&f=1", "display_name": "Lock-o-motiffe", "link": "https://stackoverflow.com/users/8464638/lock-o-motiffe"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572460259, "post_id": 58631456, "comment_id": 103570432, "body": "I tried solutions like this: json.MarshalIndent(myStruct, &quot;&quot;, &quot;\\t&quot;) but it prints field names with quotes, which is also not suitable for copy/paste. Maybe, you mean something else."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1572460920, "post_id": 58631456, "comment_id": 103570742, "body": "You can&#39;t copy/paste into a <code>.go</code> file, no - it&#39;s not Go, it&#39;s JSON. But you can just re-ingest the JSON you output using <code>json.Unmarshal</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1572461589, "post_id": 58631456, "comment_id": 103571022, "body": "Not that it would make copy+paste output for all cases, but did you try using <code>%#v</code>? It&#39;s documented as <code>a Go-syntax representation of the value</code>. Otherwise you can use a standard serialization format as suggested, or write your own formatter that does what you want with <code>GoString</code>"}, {"owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "edited": false, "score": 0, "creation_date": 1572464521, "post_id": 58631456, "comment_id": 103572214, "body": "Use <code>%#v</code> as suggested by JimB. This format qualifies types with a package name.  If that gets in the way, you can edit by hand or use a regexp to clean it up."}, {"owner": {"reputation": 33, "user_id": 8464638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f024a285a0951332f8b8ce3718488e?s=128&d=identicon&r=PG&f=1", "display_name": "Lock-o-motiffe", "link": "https://stackoverflow.com/users/8464638/lock-o-motiffe"}, "edited": false, "score": 0, "creation_date": 1572468010, "post_id": 58631456, "comment_id": 103573591, "body": "You are right! %#v returns exactly what is needed. Somehow I overlooked it. Thanks, everyone!"}], "owner": {"reputation": 33, "user_id": 8464638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7f024a285a0951332f8b8ce3718488e?s=128&d=identicon&r=PG&f=1", "display_name": "Lock-o-motiffe", "link": "https://stackoverflow.com/users/8464638/lock-o-motiffe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1572459276, "creation_date": 1572459276, "question_id": 58631456, "link": "https://stackoverflow.com/questions/58631456/printing-struct-in-a-format-suitable-for-copy-paste-to-tests-as-wantresult-val", "title": "Printing struct in a format suitable for copy/paste to tests as &quot;wantResult&quot; value", "body": "<p>I need to write tests for a function where the return result is a slice of large structs. It means that you need to write a test where \"wantResult\" should be filled with all these structs. The fastest way to fill it is to call a function and do copy/paste of the result into the test. However, I found that it is not easy to print a struct in a suitable format where you can just copy/paste it. </p>\n\n<pre><code>fmt.Printf(\"%v\",myStruct)\n</code></pre>\n\n<p>will print something like this:\n<code>[{field A field B field C} {field A field B field C}]</code> i.e. no quotes for strings, no commas between fields. </p>\n\n<pre><code>fmt.Printf(\"%+v\",myStruct)\n</code></pre>\n\n<p>will print something like this:\n<code>[{field A:value A field B:value B field C:value C} {field A:value A field B:value B field C:value C}]</code> - also no quotes, no commas between fields. </p>\n\n<p>Finally, I come up with the reflect solution which looks like this:</p>\n\n<pre><code>for _, oneStruct := range gotResult {\n                s := reflect.ValueOf(&amp;oneStruct).Elem()\n    typeOfs := s.Type()\n    fmt.Println(\"{\")\n    for i := 0; i &lt; s.NumField(); i++ {\n        f := s.Field(i)\n        switch f.Type().Name() {\n        case \"string\":\n                        fmt.Printf(\"%v:\\\"%v\\\",\\n\", typeOfs.Field(i).Name, f.Interface())\n        default :\n                        fmt.Printf(\"%v:%v,\\n\", typeOfs.Field(i).Name, f.Interface())\n        }\n    }\n    fmt.Println(\"},\")\n}\n</code></pre>\n\n<p>It works fine for simple flat structures with int, float and string field types. However, it looks cumbersome. Does anybody know something more elegant for this purpose?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572453114, "post_id": 58629846, "comment_id": 103567054, "body": "Have you considered implementing the Stringer interface?"}, {"owner": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572453341, "post_id": 58629846, "comment_id": 103567176, "body": "Can you explain more? I mentioned looking for a solution other than string processing. I am asking if Go has a built-in non-String processing way for that."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1572453493, "post_id": 58629846, "comment_id": 103567251, "body": "Implementing the stringer interface is no more string processing than using fmt. What you would do is have HeadEditor implement the <code>String() string</code> method which can simply return the desired text, this method is then automatically called by fmt when used with the <code>%s</code> verb (not sure about the <code>%v</code> verb)."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572453643, "post_id": 58629846, "comment_id": 103567336, "body": "works with %v as well it seems <a href=\"https://play.golang.org/p/rERpIuKJVEy\" rel=\"nofollow noreferrer\">play.golang.org/p/rERpIuKJVEy</a>"}], "answers": [{"comments": [{"owner": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "edited": false, "score": 0, "creation_date": 1572453638, "post_id": 58629963, "comment_id": 103567334, "body": "Yes, so the solution is this: fmt.Printf(&quot;%v approved balance for %v request. Balance: %v\\n&quot;, reflect.TypeOf(h).Elem().Name(), b.CustomerName, b.Balance)"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 4, "last_activity_date": 1572453204, "creation_date": 1572453204, "answer_id": 58629963, "question_id": 58629846, "link": "https://stackoverflow.com/questions/58629846/get-struct-name-without-fetching-package-name-or-pointer/58629963#58629963", "title": "Get Struct name without fetching package name or pointer", "body": "<p>You're close with the last one. As <code>Name()</code>'s documentation says:</p>\n\n<pre><code>// Name returns the type's name within its package for a defined type.\n// For other (non-defined) types it returns the empty string.\n</code></pre>\n\n<p>You're getting the empty string back because while <code>chain_of_responsibility.HeadEditor</code> is a defined type, <code>*chain_of_responsibility.HeadEditor</code> is not. You can get the type out from the pointer type with <code>Elem()</code>:</p>\n\n<pre><code>// Elem returns a type's element type.\n// It panics if the type's Kind is not Array, Chan, Map, Ptr, or Slice.\n</code></pre>\n\n<p>So, if it's not always going to be a pointer, you'll want to check first if it's a pointer or not before calling <code>Elem()</code>.</p>\n\n<p>Or you could make your code a lot simpler (and probably faster) by bailing on reflection and just giving your types a method that returns whatever string you want to use for each type, like <code>Type() string</code>. You could then define a <code>Typer</code> interface to encapsulate that method.</p>\n"}], "owner": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 58629963, "answer_count": 1, "score": 1, "last_activity_date": 1572458858, "creation_date": 1572452710, "last_edit_date": 1572458858, "question_id": 58629846, "link": "https://stackoverflow.com/questions/58629846/get-struct-name-without-fetching-package-name-or-pointer", "title": "Get Struct name without fetching package name or pointer", "body": "<p>I have a very simple code like this:</p>\n\n<pre><code>package chain_of_responsibility\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype CustomerBalanceRequest struct{\n    CustomerName string\n    Balance int\n}\n\ntype BalanceRequest interface {\n    Handle(request CustomerBalanceRequest)\n}\n\ntype HeadEditor struct{\n    Next BalanceRequest\n}\n\nfunc (h *HeadEditor) Handle(b CustomerBalanceRequest){\n    if b.Balance &lt; 1000 {\n        fmt.Printf(\"%T approved balance for %v request. Balance: %v\\n\", h, b.CustomerName, b.Balance)\n        fmt.Printf(\"%v approved balance for %v request. Balance: %v\\n\", reflect.TypeOf(h), b.CustomerName, b.Balance)\n        fmt.Printf(\"%v approved balance for %v request. Balance: %v\\n\", reflect.TypeOf(h).String(), b.CustomerName, b.Balance)\n        fmt.Printf(\"%v approved balance for %v request. Balance: %v\\n\", reflect.TypeOf(h).Name(), b.CustomerName, b.Balance)\n\n    } else{\n        h.Next.Handle(b)\n    }\n}\n</code></pre>\n\n<p>On fmt.Printf lines, I want to print the name of HeadEditor type. I use various ways to get that and this is my result:</p>\n\n<pre><code>*chain_of_responsibility.HeadEditor approved balance for John request. Balance: 500\n*chain_of_responsibility.HeadEditor approved balance for John request. Balance: 500\n*chain_of_responsibility.HeadEditor approved balance for John request. Balance: 500\n approved balance for John request. Balance: 500\n</code></pre>\n\n<p>The problem is on first 3 Printf calls, I can get the name of type, but they include pointer and package name. Is there any way that I can get only \"HeadEditor\" without package name and pointer and of course other than string processing solution like removing * and package name from the result.</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572453362, "post_id": 58629679, "comment_id": 103567188, "body": "Sounds like you&#39;re editing a file within your <code>.vscode</code> folder (e.g. the <code>launch.json</code> file you quoted) when you try to debug. Debug is relative to the file you have open (as you can see by the <code>${fileDirname}</code> in your config). If you only ever want to debug one binary in your project, you can override that setting to always point at that package."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572453953, "post_id": 58629679, "comment_id": 103567494, "body": "I don&#39;t really understand what should I do. I expect vscode do a go build as he is currently doing, and then launch debug. Is is a way to print result of ${fileDirname} to check the content ?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572454561, "post_id": 58629679, "comment_id": 103567767, "body": "As I said in the comment, just run debug with an actual Go file open instead of with your <code>launch.json</code> open."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572454871, "post_id": 58629679, "comment_id": 103567942, "body": "ah ok, you are right, I could get rid of the error :) Thanks ! You can put it as an answer"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1572455162, "creation_date": 1572455162, "answer_id": 58630469, "question_id": 58629679, "link": "https://stackoverflow.com/questions/58629679/finding-gitlab-com-company-project-vscode-latest/58630469#58630469", "title": "Finding gitlab.com/company/project/.vscode latest", "body": "<p>Sounds like you're editing a file within your .vscode folder (e.g. the launch.json file you quoted) when you try to debug. Debug is relative to the file you have open (as you can see by the <code>${fileDirname}</code> in your config). So the easiest fix is to make sure you have open the Go file you want to debug when you try to debug.</p>\n\n<p>If you only ever want to debug one binary in your project, you can override the <code>program</code> setting in <code>launch.json</code> to always point at that package.</p>\n"}], "owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "accepted_answer_id": 58630469, "answer_count": 1, "score": 1, "last_activity_date": 1572458895, "creation_date": 1572452112, "last_edit_date": 1572458895, "question_id": 58629679, "link": "https://stackoverflow.com/questions/58629679/finding-gitlab-com-company-project-vscode-latest", "title": "Finding gitlab.com/company/project/.vscode latest", "body": "<p>I'm trying to debug a go project with vscode, when I run debug with those settings:</p>\n\n<pre><code>{\n    // Use IntelliSense to learn about possible attributes.\n    // Hover to view descriptions of existing attributes.\n    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"Launch\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"auto\",\n            \"program\": \"${fileDirname}\",\n            \"envFile\": \"${workspaceFolder}/.env.local\",\n            \"args\": [],\n        }\n    ]\n}\n</code></pre>\n\n<p>I get: </p>\n\n<pre><code>go: finding gitlab.com/company/project/.vscode latest\ncan't load package: package gitlab.com/company/project/.vscode: unknown import path \"gitlab.com/company/project/.vscode\": cannot find module providing package gitlab.com/company/project/.vscode\nexit status 1\nProcess exiting with code: 1\n</code></pre>\n\n<p>What can I do to fix it ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572445854, "post_id": 58627581, "comment_id": 103562748, "body": "have the gateway package keep the instance initialized by runner"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1572446088, "post_id": 58627581, "comment_id": 103562897, "body": "I would strongly recommend against this design. This is the kind of runtime dynamic stuff that Ruby and Java love, but which goes against the grain of everything that Go is built on."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1572446463, "post_id": 58627581, "comment_id": 103563111, "body": "I could not agree more with @Adrian. The &quot;modules&quot; should be various &quot;main&quot;, configuring &quot;framework&quot; to utilize &quot;gateway&quot; and &quot;runner&quot;, not the other way around."}, {"owner": {"reputation": 11, "user_id": 6700332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d9dce5c2dac92a22063f81237a62e0c?s=128&d=identicon&r=PG&f=1", "display_name": "Ricardo", "link": "https://stackoverflow.com/users/6700332/ricardo"}, "edited": false, "score": 0, "creation_date": 1572448567, "post_id": 58627581, "comment_id": 103564418, "body": "The &quot;runner&quot; will be executed by the application server (fork), loads one &quot;module&quot;, execute and finish"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1572450043, "post_id": 58627581, "comment_id": 103565220, "body": "This is a terrible design. Please don&#39;t do things this way."}, {"owner": {"reputation": 11, "user_id": 6700332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d9dce5c2dac92a22063f81237a62e0c?s=128&d=identicon&r=PG&f=1", "display_name": "Ricardo", "link": "https://stackoverflow.com/users/6700332/ricardo"}, "edited": false, "score": 0, "creation_date": 1572455296, "post_id": 58627581, "comment_id": 103568164, "body": "Why is so terrible? Because use plugin? Because reflect with plugin? Yes, Go is not the best language for this dynamic stuff, but I cannot use other language"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1572458884, "post_id": 58627581, "comment_id": 103569803, "body": "Don&#39;t do &quot;dynamic stuff&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1572458980, "post_id": 58631025, "comment_id": 103569851, "body": "` &quot;../gateway&quot;` &lt;-- don&#39;t use relative imports. It&#39;s officially unsupported, and only works &quot;kind of by accident&quot;.See here: <a href=\"https://stackoverflow.com/q/38517593/13860\">stackoverflow.com/q/38517593/13860</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1572459014, "post_id": 58631025, "comment_id": 103569865, "body": "Your entire project looks like you&#39;re trying to fight against Go. You&#39;re using reflection, you&#39;re forcing plugins, you&#39;re using incorrect imports. I strongly encourage you to start fresh, read a book about Go idioms, and take a new approach."}], "tags": [], "owner": {"reputation": 11, "user_id": 6700332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d9dce5c2dac92a22063f81237a62e0c?s=128&d=identicon&r=PG&f=1", "display_name": "Ricardo", "link": "https://stackoverflow.com/users/6700332/ricardo"}, "is_accepted": false, "score": -1, "last_activity_date": 1572458927, "last_edit_date": 1572458927, "creation_date": 1572457418, "answer_id": 58631025, "question_id": 58627581, "link": "https://stackoverflow.com/questions/58627581/how-to-avoid-package-dependency/58631025#58631025", "title": "How to avoid package dependency", "body": "<p>There have been a lot of headaches with Go plugins, especially the plugin compiler version must exactly match the program's compiler version. But the example works.</p>\n\n<p><strong><em>runner/runner.go</em></strong></p>\n\n<pre><code>package main\n\nimport (\n  \"context\"\n  \"fmt\"\n  \"os\"\n  \"plugin\"\n  \"reflect\"\n\n  \"../gateway\"\n  \"../dep\"\n)\n\nvar a *gateway.Gateway\n\nfunc main() {\n  myModule := os.Args[1]\n\n  if _, err := plugin.Open(myModule); err != nil {\n    os.Exit(1)\n  }\n\n  mod, err := dep.NewModule()\n  if err != nil {\n    os.Exit(1)\n  }\n\n  a = gateway.NewGW()\n  ctx := context.WithValue(context.Background(), \"gateway\", a)\n\n  modreflect, err := mod.Init(ctx, dep.Config{})\n  if err != nil {\n    os.Exit(1)\n  }\n\n  if !modreflect.IsValid() {\n    os.Exit(1)\n  }\n\n  modnode, err := mod.Start(ctx)\n  if err != nil {\n    os.Exit(1002)\n  }\n\n  for {\n    if len(modnode) &lt;= 0 {\n      break\n    }\n\n    modnoderefl := modreflect.MethodByName(modnode)\n    if !modnoderefl.IsValid() {\n      break\n    }\n\n    result := modnoderefl.Call([]reflect.Value{reflect.ValueOf(ctx)})\n    if len(result) != 2 {\n      break\n    }\n\n    modnode = result[0].String()\n  }\n\n  mod.End(ctx)\n}\n</code></pre>\n\n<p><strong><em>gateway/gateway.go</em></strong></p>\n\n<pre><code>package gateway\n\ntype Gateway struct {}\n\nfun NewGW() *Gateway {\n  a := Gateway{}\n  return &amp;a\n}\n</code></pre>\n\n<p><strong><em>dep/dep.go</em></strong></p>\n\n<pre><code>package dep\n\nimport (\n  \"errors\"\n  \"context\"\n  \"reflect\"\n)\n\n// Config is a configuration provider.\ntype Config map[string]interface{}\n\n// Module is the interface implementated by types that\n// register themselves as modular plug-ins.\ntype Module interface {\n  Init(ctx context.Context, config Config) (reflect.Value,error)\n  Start(ctx context.Context) (string,error)\n  End(ctx context.Context) error\n}\n\nvar themod = []func() Module{}\n\nfunc RegisterModule(ctor func() Module) {\n  themod = append(themod, ctor)\n}\n\nfunc NewModule() (Module, error) {\n  if len(themod) == 0 {\n    return nil, errors.New(\"Module not registered\")\n  }\n  return themod[0](), nil\n}\n</code></pre>\n\n<p><strong><em>framework/framework.go</em></strong></p>\n\n<pre><code>package framework\n\nimport (\n    \"fmt\"\n  \"context\"\n  \"../gateway\"\n)\n\ntype PlayFileInput struct {\n  Path string\n}\n\nfunc Play(ctx context.Context, p PlayFileInput) error {\n  if a := ctx.Value(\"gateway\"); a != nil {\n\n    if a.(*gateway.Gateway) != nil {\n      _, err := a.(*gateway.Gateway).Exec(\"Playback\", p.Path)\n      return err\n    }\n  }\n\n  return nil\n}\n</code></pre>\n\n<p><strong><em>modules/sample.go</em></strong></p>\n\n<pre><code>package main\n\nimport \"C\"\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"os\"\n  \"reflect\"\n\n  \"../dep\"\n  \"../framework\"\n)\n\ntype MyModuleImpl struct {}\n\nfunc init() {\n  dep.RegisterModule(func() dep.Module {\n    return &amp;MyModuleImpl{}\n  })\n}\n\nfunc (m *MyModuleImpl) Init(ctx context.Context, config dep.Config) (reflect.Value, error) {\n  return reflect.ValueOf(m), nil\n}\n\nfunc (m *MyModuleImpl) Start(ctx context.Context) (string,error) {\n  return \"Menu_1\",nil\n}\nfunc (n *MyModuleImpl)Menu_1(ctx context.Context) (string, error) {\n  framework.Play(ctx, framework.PlayFileInput{Path: \"welcome.wav\"})\n  return \"Menu_2\",nil\n}\nfunc (n *MyModuleImpl)Menu_2(ctx context.Context) (string, error) {\n  return \"Menu_3\", nil\n}\n// ....\n// ....\nfunc (m *MyModuleImpl) End(ctx context.Context) error {\n  return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 6700332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d9dce5c2dac92a22063f81237a62e0c?s=128&d=identicon&r=PG&f=1", "display_name": "Ricardo", "link": "https://stackoverflow.com/users/6700332/ricardo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1572458927, "creation_date": 1572445563, "last_edit_date": 1572446634, "question_id": 58627581, "link": "https://stackoverflow.com/questions/58627581/how-to-avoid-package-dependency", "title": "How to avoid package dependency", "body": "<p>I have a project consisting of 4 parts:</p>\n\n<ol>\n<li><p>A gateway (gateway/gateway.go) it's a package that knows how to talk with an application server and open this connection channel.</p></li>\n<li><p>A runner (runner/runner.go) it's the main (go build -o runner/runner runner/runner.go) It loads and execute Modules (using reflect I run functions from the module)!</p></li>\n<li><p>A framework (framework/framework.go) Implements many functionalities calling the gateway.</p></li>\n<li><p>Modules (aka Plugins in Go) (modules/sample.go) (go build -buildmode plugin -o modules/sample.so ./modules/sample.go) Using the framework, does customer logic! When init I export the reflect.Value of struct, then runner can run methods of this struct.</p></li>\n</ol>\n\n<p>I want the runner instantiate the gateway and the framework obtain this instance without create a dependency between runner/framework.</p>\n\n<p>Why? To avoid Go error 'plugin was built with a different version of package' when runner loads the module! \nIf I update the runner (with the framework changed), I will invalidate old modules.</p>\n\n<p>I already do that using 2 ways I don't like: </p>\n\n<ol>\n<li><p>Using context, but all functions from module and framework need receive a parameter context, then framework extract the gateway.</p></li>\n<li><p>Just let the framework instantiate gateway, but then the runner cannot use gateway.</p></li>\n</ol>\n"}, {"tags": ["string", "csv", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 5, "creation_date": 1572444337, "post_id": 58627100, "comment_id": 103561792, "body": "this is a csv escape thingy, nothing to do with bytes.Buffer I believe. Basically two double quotes next to each other in csv means one double quote in &quot;reality&quot;. This is explained in the <a href=\"https://golang.org/pkg/encoding/csv/\" rel=\"nofollow noreferrer\">docs</a> of the package you&#39;re using."}, {"owner": {"reputation": 163, "user_id": 8362524, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XWpW7.jpg?s=128&g=1", "display_name": "Raj Thakur", "link": "https://stackoverflow.com/users/8362524/raj-thakur"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572444484, "post_id": 58627100, "comment_id": 103561878, "body": "true ! I feel the same. Im just finding it hard to understand that escape thing."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1572444869, "post_id": 58627100, "comment_id": 103562102, "body": "csv is a standard, see <a href=\"https://tools.ietf.org/html/rfc4180\" rel=\"nofollow noreferrer\">rfc4180</a> (section 2.7) if you need more clarification."}], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 8362524, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XWpW7.jpg?s=128&g=1", "display_name": "Raj Thakur", "link": "https://stackoverflow.com/users/8362524/raj-thakur"}, "edited": false, "score": 0, "creation_date": 1572446826, "post_id": 58627209, "comment_id": 103563353, "body": "Thanks icza, This really made sense.Thanks for helping me understand it with an example."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1572444859, "last_edit_date": 1592644375, "creation_date": 1572444472, "answer_id": 58627209, "question_id": 58627100, "link": "https://stackoverflow.com/questions/58627100/why-does-golang-bytes-buffer-behave-in-such-way/58627209#58627209", "title": "Why does golang bytes.Buffer behave in such way?", "body": "<p>In CSV double quotes (<code>&quot;</code>) are escaped as 2 double quotes. That's what you see.</p>\n<p>You encode a single <code>string</code> value which contains double quotes, so all those are replaced with 2 double quotes.</p>\n<p>When decoded, the result will contain 1 double quotes of course:</p>\n<pre><code>r := csv.NewReader(&amp;csvBuffer)\nrec, err := r.Read()\nfmt.Println(rec, err)\n</code></pre>\n<p>Outputs (try it on the <a href=\"https://play.golang.org/p/GnPlkTTF5Zo\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>[{&quot;agent&quot;:&quot;python-requests/2.19.1&quot;,&quot;api&quot;:&quot;/packing-slip/7e0a05b3&quot;}] &lt;nil&gt;\n</code></pre>\n<p>Quoting from package doc of <a href=\"https://golang.org/pkg/encoding/csv/\" rel=\"nofollow noreferrer\"><code>encoding/csv</code></a>:</p>\n<blockquote>\n<p>Within a quoted-field a quote character followed by a second quote character is considered a single quote.</p>\n<pre><code>&quot;the &quot;&quot;word&quot;&quot; is true&quot;,&quot;a &quot;&quot;quoted-field&quot;&quot;&quot;\n</code></pre>\n<p>results in</p>\n<pre><code>{`the &quot;word&quot; is true`, `a &quot;quoted-field&quot;`}\n</code></pre>\n</blockquote>\n<p>In CSV, the following are equivalent:</p>\n<pre><code>one,two\n</code></pre>\n<p>and</p>\n<pre><code>&quot;one&quot;,&quot;two&quot;\n</code></pre>\n<p>Now if the values would contain double quotes, that would indicate the end of the value. CSV handles this by substituting double quotes with 2 of them. The value <code>one&quot;1</code> is encoded as <code>one&quot;&quot;1</code> in CSV, e.g.:</p>\n<pre><code>&quot;one&quot;&quot;1&quot;,&quot;two&quot;&quot;2&quot;\n</code></pre>\n"}], "owner": {"reputation": 163, "user_id": 8362524, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XWpW7.jpg?s=128&g=1", "display_name": "Raj Thakur", "link": "https://stackoverflow.com/users/8362524/raj-thakur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 58627209, "answer_count": 1, "score": -1, "last_activity_date": 1572448735, "creation_date": 1572444098, "last_edit_date": 1572448735, "question_id": 58627100, "link": "https://stackoverflow.com/questions/58627100/why-does-golang-bytes-buffer-behave-in-such-way", "title": "Why does golang bytes.Buffer behave in such way?", "body": "<p>I recently faced a problem, where I'm writing to a <code>byte.Buffer</code> using a <code>writer</code>. But when I do <code>String()</code> on that <code>byte.Buffer</code> I'm getting an unexpected output (extra pair of double quotes added). Can you please help me understand it?</p>\n\n<p>Here is a code snippet of my problem! I just need help understanding why each word is surrounded by a double quote.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    var csvBuffer bytes.Buffer\n    wr := csv.NewWriter(&amp;csvBuffer)\n    data := []string{`{\"agent\":\"python-requests/2.19.1\",\"api\":\"/packing-slip/7123\"}`}\n    err := wr.Write(data)\n    if err != nil {\n        fmt.Println(\"WARNING: unable to write \", err)\n    }\n    wr.Flush()\n    fmt.Println(csvBuffer.String())\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<blockquote>\n  <p>{\"\"agent\"\":\"\"python-requests/2.19.1\"\",\"\"api\"\":\"\"/packing-slip/7123\"\"}</p>\n</blockquote>\n"}, {"tags": ["oracle", "go", "blob"], "answers": [{"tags": [], "owner": {"reputation": 299, "user_id": 7987576, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a1bb29ab3cd439fe89b5dcb93e6186a2?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas", "link": "https://stackoverflow.com/users/7987576/lucas"}, "is_accepted": true, "score": 1, "last_activity_date": 1572622448, "creation_date": 1572622448, "answer_id": 58661905, "question_id": 58626608, "link": "https://stackoverflow.com/questions/58626608/how-to-insert-image-as-blob-into-oracle-database/58661905#58661905", "title": "How to insert image as BLOB into Oracle Database", "body": "<p>After dozens of hours trying to figure out how to accomplish BLOB insertion into OracleDB using goracle Go driver, I got answer.</p>\n\n<p>TL;DR</p>\n\n<p>Full code (obviously adapt variables like DB connection and file location &amp;&amp; file name to your needs):</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"context\"\n    \"database/sql\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"time\"\ngoracle \"gopkg.in/goracle.v2\"\n)\n\nfunc main() {\n    fmt.Println(\"... Setting up Database Connection\")\n    testDb, err := sql.Open(\"goracle\",\n        \"sys\" +\n            \"/\" +\n            \"Oracle18\" +\n            \"@\" +\n            \"localhost:32118\" +\n            \"/\" +\n            \"XE as sysdba\")\n    if err != nil {\n        fmt.Println(\"... DB Setup Failed\")\n        fmt.Println(err)\n        return\n    }\n    defer testDb.Close()\n\n// Get file as bytes\ndat, err := ioutil.ReadFile(\"./sample.png\")\nif err != nil {\n    fmt.Println(\".....Error Opening File\")\n    fmt.Println(err)\n    return\n}\n\n// BLOB creation &amp;&amp; passing file into it\ndirectLob := goracle.Lob{ Reader: bytes.NewReader(dat[:])}\n\nfmt.Println(\"\\nINSERTING BLOB - starting....\")\n// Working BLOB insertion - INSERT COMMAND\n_, err = testDb.Exec(\"insert into AA_LIVE_FRAMES(id, frame) VALUES(:1, :2)\",  1, directLob)\nif err != nil {\n    fmt.Println(\".....Error Inserting BLOB\")\n    fmt.Println(err)\n    return\n}\nfmt.Println(\"\\nINSERTING BLOB - ended.\")\n\nfmt.Println(\"\\nSuccess\")\n}\n</code></pre>\n\n<p>This is working main.go file.</p>\n\n<p><strong>LONGER VERSION ANSWER</strong></p>\n\n<p><em>Why this took me so long if code is so simple?</em></p>\n\n<p>When I've started to work with that problem, I didn't find any tutorial or examples in the goracle documentation showing how to INSERT BLOB into OracleDB. Sure, there was this goracle.Lob structure with nice function - Read(). It was my first try, declare this goracle.Lob and use it's Read() function, but it gave me errors - nil address and so on. I didn't know why, tried to debug it - without results. Then I went deeper, I pull out some test codes from goracle package showing how to create temporary LOB - some of this code is shown in my question answer. Again, without success. Then, I was trying raw SQL, failed again (I think because my OracleDB is docker - creating directory, which is needed to insert BLOB into OracleDB didn't work; nvm).</p>\n\n<p>And finally, I am not sure why, I have tried struct literal:</p>\n\n<pre><code>directLob := goracle.Lob{ Reader: bytes.NewReader(dat[:])}\n</code></pre>\n\n<p>and worked.</p>\n\n<p>Alright, why I am typing all of this? Because, AFAIK, doing this:</p>\n\n<pre><code>directLob := goracle.Lob{ Reader: bytes.NewReader(dat[:])}\n</code></pre>\n\n<p>and this:</p>\n\n<pre><code>directLob := goracle.Lob{}\ndirectLob.Read(dat[:])\n</code></pre>\n\n<p>should be the same? Or am I completely wrong?</p>\n"}], "owner": {"reputation": 299, "user_id": 7987576, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a1bb29ab3cd439fe89b5dcb93e6186a2?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas", "link": "https://stackoverflow.com/users/7987576/lucas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 1, "accepted_answer_id": 58661905, "answer_count": 1, "score": 1, "last_activity_date": 1572622448, "creation_date": 1572442553, "last_edit_date": 1572446451, "question_id": 58626608, "link": "https://stackoverflow.com/questions/58626608/how-to-insert-image-as-blob-into-oracle-database", "title": "How to insert image as BLOB into Oracle Database", "body": "<p>I have a database with A_LOB_TABLE table:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Wr2oq.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Wr2oq.png\" alt=\"enter image description here\"></a></p>\n\n<p>I want to INSERT image as BLOB with any (let's say '1') ID to A_LOB_TABLE using goracle package.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)\ndefer cancel()\n\n// To have a valid LOB locator, we have to keep the Stmt around.\nqry := `DECLARE tmp BLOB;\nBEGIN\n  DBMS_LOB.createtemporary(tmp, TRUE, DBMS_LOB.SESSION);\n  :1 := tmp;\nEND;`\n    tx, err := testDb.BeginTx(ctx, nil)\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer tx.Rollback()\n\nstmt, err := tx.PrepareContext(ctx, qry)\nif err != nil {\n    fmt.Printf(\"%s: %w\", qry, err)\n}\ndefer stmt.Close()\nvar tmp goracle.Lob\nif _, err := stmt.ExecContext(ctx, goracle.LobAsReader(), sql.Out{Dest: &amp;tmp}); err != nil {\n    fmt.Printf(\"Failed to create temporary lob: %+v\", err)\n}\nfmt.Printf(\"tmp: %#v\", tmp)\n\n// Get file as bytes (it needs to be in the same dir as code is)\ndat, err := ioutil.ReadFile(\"./sample.png\")\nif err != nil {\n    fmt.Println(\".....Error Opening File\")\n    fmt.Println(err)\n    return\n}\n\nif _, err := tx.ExecContext(ctx,\n    \"BEGIN dbms_lob.append(:1, :2); END;\",\n    tmp, goracle.Lob{Reader: bytes.NewReader(dat[:])},\n); err != nil {\n    fmt.Printf(\"Failed to write buffer(%v) to lob(%v): %+v\", dat, tmp, err)\n}\n\n// INSERTING LOB - starting....\n_, err = testDb.Exec(\"insert into A_LOB_TABLE(id, image) VALUES(:1, :2)\",  1, tmp)\nif err != nil {\n    fmt.Println(\".....Error Inserting data - BLOB\")\n    fmt.Println(err)\n    return\n}\n// INSERTING LOB - ended.\n</code></pre>\n\n<p>It doesn't work though. It outputs error at line</p>\n\n<pre><code>_, err = testDb.Exec(\"insert into A_LOB_TABLE(id, image) VALUES(:1, :2)\",  1, tmp)\n</code></pre>\n\n<p>saying:</p>\n\n<blockquote>\n  <p>dpiStmt_execute(mode=32 arrLen=-1): ORA-22922: nonexistent LOB value</p>\n</blockquote>\n"}, {"tags": ["go", "go-modules", "gopath", "go-get"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1572439673, "post_id": 58625660, "comment_id": 103559005, "body": "In general, the import path won&#39;t be enough, since a <code>go.mod</code> may contain <code>replace</code> directives, and any packages from your module may be mapped to any other, and vice versa (e.g. <code>github.com&#47;gorilla&#47;mux</code> may be replaced with <code>namoled-core&#47;mux</code>)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572444678, "post_id": 58625660, "comment_id": 103561994, "body": "&quot;parts of my own project&quot; is also a concept that only exists for humans; Go itself has no notion of a &quot;project&quot;."}, {"owner": {"reputation": 220, "user_id": 10176454, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZmxR2.png?s=128&g=1", "display_name": "zergon321", "link": "https://stackoverflow.com/users/10176454/zergon321"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572452059, "post_id": 58625660, "comment_id": 103566438, "body": "@Adrian yeah, I know that, but things like <b>dep</b> and <b>Glide</b> somehow determine which dependencies are downloadable and must be added in index files."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 9058238, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--w8PxtulBdM/AAAAAAAAAAI/AAAAAAAAAAc/mqbiC7lU4rw/photo.jpg?sz=128", "display_name": "Elio Marcolino", "link": "https://stackoverflow.com/users/9058238/elio-marcolino"}, "is_accepted": false, "score": 0, "last_activity_date": 1572467971, "last_edit_date": 1572467971, "creation_date": 1572467442, "answer_id": 58633221, "question_id": 58625660, "link": "https://stackoverflow.com/questions/58625660/how-to-distinct-what-dependencies-are-downloadable/58633221#58633221", "title": "How to distinct what dependencies are downloadable?", "body": "<p>If you are using Go Modules, you can use the contents of the <code>go.sum</code> file to filter the downloadable dependencies out of the response provided by your method.</p>\n\n<p>Edit: One thing to keep in mind is that imports are related to packages while downloadable dependencies are related to modules. A module is composed of several packages and the packages have their module name as a prefix. So you may need to look in the <code>go.sum</code> file for entries that are prefixes for the package names returned by your method.</p>\n"}], "owner": {"reputation": 220, "user_id": 10176454, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZmxR2.png?s=128&g=1", "display_name": "zergon321", "link": "https://stackoverflow.com/users/10176454/zergon321"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572467971, "creation_date": 1572439411, "question_id": 58625660, "link": "https://stackoverflow.com/questions/58625660/how-to-distinct-what-dependencies-are-downloadable", "title": "How to distinct what dependencies are downloadable?", "body": "<p>I use this code to get a list of dependencies imported in a single <strong>Go</strong> source file:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// GetFileImports returns all the imports from the Golang source code file.\nfunc GetFileImports(filepath string) ([]string, error) {\n    fset := token.NewFileSet()\n    file, err := parser.ParseFile(fset, filepath, nil, parser.ImportsOnly)\n\n    if err != nil {\n        return nil, err\n    }\n\n    imports := make([]string, len(file.Imports))\n\n    for i := range file.Imports {\n        imports[i] = strings.Trim(file.Imports[i].Path.Value, \"\\\"\")\n    }\n\n    return imports, nil\n}\n</code></pre>\n\n<p>I get this list:</p>\n\n<pre><code>namoled-core/data\nnamoled-core/shared\nencoding/json\nfmt\nio/ioutil\nlog\nnet/http\ngithub.com/gorilla/mux\ngithub.com/gorilla/websocket\n</code></pre>\n\n<p>Where <code>namoled-core/data</code> and <code>namoled-core/shared</code> are parts of my own project, <code>github.com/gorilla/mux</code> and <code>github.com/gorilla/websocket</code> are downloadable dependencies, and all the rest are standard library dependencies. Is there a solid and unambiguous way to distinct dependencies from the current project, downloadable dependencies and standard library dependencies only by their import paths? Taking in account that project path may also be a <strong>Github</strong> link.</p>\n"}, {"tags": ["go", "viper-go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user12251171"}, "edited": false, "score": 0, "creation_date": 1572438967, "post_id": 58625464, "comment_id": 103558600, "body": "What you&#39;re looking for is schema validation, and is not something Viper does (as far as I&#39;m aware). <a href=\"https://github.com/spf13/viper/issues/702\" rel=\"nofollow noreferrer\">There&#39;s an open issue for it</a> though, if you want to voice your support and track it."}, {"owner": {"reputation": 3365, "user_id": 1569204, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/bd0db7459f9940095b1518fa7ec32a72?s=128&d=identicon&r=PG", "display_name": "Bruce Adams", "link": "https://stackoverflow.com/users/1569204/bruce-adams"}, "edited": false, "score": 0, "creation_date": 1572439280, "post_id": 58625464, "comment_id": 103558790, "body": "I saw that issue (which is poorly worded) but this is more fundamental. A file containing &quot;???&quot; is I believe incorrect syntactically as well as semantically."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572444778, "post_id": 58625464, "comment_id": 103562055, "body": "That&#39;s pretty vague - depending on the file type and where in the file, &quot;???&quot; is not necessary invalid. With no details it&#39;s hard to tell what you&#39;re talking about. Is this a JSON file? YAML file? XML? TOML? How is the file structured and where is the &quot;invalid&quot; content in that structure?"}, {"owner": {"reputation": 3365, "user_id": 1569204, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/bd0db7459f9940095b1518fa7ec32a72?s=128&d=identicon&r=PG", "display_name": "Bruce Adams", "link": "https://stackoverflow.com/users/1569204/bruce-adams"}, "edited": false, "score": 0, "creation_date": 1572448440, "post_id": 58625464, "comment_id": 103564352, "body": "A .properties file as I specified. viper also seems prescriptive as to the file extension used. Altered to clarify slightly."}], "answers": [{"tags": [], "owner": {"reputation": 3365, "user_id": 1569204, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/bd0db7459f9940095b1518fa7ec32a72?s=128&d=identicon&r=PG", "display_name": "Bruce Adams", "link": "https://stackoverflow.com/users/1569204/bruce-adams"}, "is_accepted": true, "score": 0, "last_activity_date": 1572837803, "creation_date": 1572837803, "answer_id": 58686801, "question_id": 58625464, "link": "https://stackoverflow.com/questions/58625464/validating-configurations-files-with-viper/58686801#58686801", "title": "Validating configurations files with viper", "body": "<p>I think the answer is no. viper does not validate java .properties files.\nI posted a bug report (or feature request depending on your point of view) as <a href=\"https://github.com/spf13/viper/issues/790\" rel=\"nofollow noreferrer\">https://github.com/spf13/viper/issues/790</a></p>\n"}], "owner": {"reputation": 3365, "user_id": 1569204, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/bd0db7459f9940095b1518fa7ec32a72?s=128&d=identicon&r=PG", "display_name": "Bruce Adams", "link": "https://stackoverflow.com/users/1569204/bruce-adams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 756, "favorite_count": 0, "accepted_answer_id": 58686801, "answer_count": 1, "score": -1, "last_activity_date": 1572837803, "creation_date": 1572438701, "last_edit_date": 1572449830, "question_id": 58625464, "link": "https://stackoverflow.com/questions/58625464/validating-configurations-files-with-viper", "title": "Validating configurations files with viper", "body": "<p>I was looking for a configuration parser for go and <a href=\"https://github.com/spf13/viper\" rel=\"nofollow noreferrer\">https://github.com/spf13/viper</a> seems to come highly recommended.</p>\n\n<p>I am very surprised to find that configuration files are not validated by default. \nViper parses files and extracts requested values from them but I cannot find a way to detect bad configuration.</p>\n\n<p>For instance I if create a (Java style) .properties file containing just \"???\" and nothing else. This is accepted without any error. </p>\n\n<p>I can understand the philosophy that you should ignore irrelevant configuration items but I desire more rigor. I would also like to reject anything that does not match the X=Y format in a properties file.</p>\n\n<p>To me this is a fatal flaw that suggests I should use a different package (or roll my own as usual).</p>\n\n<p>Have I missed something? Does viper in fact support detecting and rejecting bad configuration keys?</p>\n"}, {"tags": ["rest", "go", "go-echo"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1572441249, "post_id": 58625445, "comment_id": 103559955, "body": "<i>&quot;Is there anyway we can pass the map to the url query param?&quot;</i> no, there isn&#39;t. <i>&quot;or we really have to be specific in here?&quot;</i> only if implementing your own solution, or looking for a 3rd party solution that does what you want, is something you wanna avoid then yes, you have to be specific."}, {"owner": {"reputation": 319, "user_id": 7616247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-31aFbdT1DIk/AAAAAAAAAAI/AAAAAAAAABQ/uL2uRsjTbKg/photo.jpg?sz=128", "display_name": "Andy", "link": "https://stackoverflow.com/users/7616247/andy"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572472329, "post_id": 58625445, "comment_id": 103575201, "body": "I can understand if it makes much complication to the code it&#39;s better be specific, but why is it something we want to avoid? if we can add one single dynamic filter for the client to request, wouldn&#39;t it be simpler? client can filter whatever field they want by doing so."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572472722, "post_id": 58625445, "comment_id": 103575329, "body": "I did not say that you want to avoid XYZ. What I said was that, <b>only if</b> you want to avoid XYZ, <b>then</b> the only option left is ABC. The comment does not state which one is worse nor does it state which one is better, and it also does not state which one should be avoided nor does it state which one should be preferred."}, {"owner": {"reputation": 319, "user_id": 7616247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-31aFbdT1DIk/AAAAAAAAAAI/AAAAAAAAABQ/uL2uRsjTbKg/photo.jpg?sz=128", "display_name": "Andy", "link": "https://stackoverflow.com/users/7616247/andy"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572473831, "post_id": 58625445, "comment_id": 103575669, "body": "ah my bad, just re-read it through again. thanks."}], "owner": {"reputation": 319, "user_id": 7616247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-31aFbdT1DIk/AAAAAAAAAAI/AAAAAAAAABQ/uL2uRsjTbKg/photo.jpg?sz=128", "display_name": "Andy", "link": "https://stackoverflow.com/users/7616247/andy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 430, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1572446516, "creation_date": 1572438658, "last_edit_date": 1572446516, "question_id": 58625445, "link": "https://stackoverflow.com/questions/58625445/how-to-pass-a-map-as-query-parameter", "title": "How to pass a map as query parameter", "body": "<p>I'm using labstack Echo (v4.1.11) go framework to create a REST API.</p>\n\n<p>How do we/can we pass <code>map</code> query param in the URL? I tried adding the following struct for the request body</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>PaginationRequest struct {\n    Page   int64             `query:\"page\"`\n    Limit  int64             `query:\"limit\"`\n    Filter map[string]string `query:\"filter\"`\n}\n</code></pre>\n\n<p>and hoping I could got this url <code>http://host/endpoint?page=1&amp;limit=10&amp;filter[status]=1&amp;filter[user_id]=12</code> to work (read the <code>filter[\"status\"]</code> and <code>filter[\"user_id\"]</code></p>\n\n<p>But when I tried binding the incoming request to <code>PaginationRequest</code> it only read the <code>page</code> and <code>limit</code> parameter and <code>filter = nil</code></p>\n\n<p>I tried debug it into the <code>echo/bind.go</code> the Bind function in reading the <code>QueryParam</code> actually read <code>filter[status]</code> as plain string \"filter[status]\" as key. </p>\n\n<p>Is there anyway we can pass the map to the url query param? or we really have to be specific in here?</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda"], "comments": [{"owner": {"reputation": 2379, "user_id": 11890264, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-SXtQk-gEdk4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re59-8V4VJNT_1V9XoftvQAnn3mOw/photo.jpg?sz=128", "display_name": "Assael Azran", "link": "https://stackoverflow.com/users/11890264/assael-azran"}, "edited": false, "score": 0, "creation_date": 1572432701, "post_id": 58623559, "comment_id": 103555228, "body": "What kind of Lambda runtime are you using?"}, {"owner": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "reply_to_user": {"reputation": 2379, "user_id": 11890264, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-SXtQk-gEdk4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re59-8V4VJNT_1V9XoftvQAnn3mOw/photo.jpg?sz=128", "display_name": "Assael Azran", "link": "https://stackoverflow.com/users/11890264/assael-azran"}, "edited": false, "score": 0, "creation_date": 1572432752, "post_id": 58623559, "comment_id": 103555259, "body": "GoLang      is the language"}, {"owner": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "edited": false, "score": 0, "creation_date": 1572433051, "post_id": 58623559, "comment_id": 103555430, "body": "<a href=\"https://docs.aws.amazon.com/lambda/latest/dg/code-editor.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/lambda/latest/dg/code-editor.html</a>"}, {"owner": {"reputation": 162605, "user_id": 174777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6PnNW.jpg?s=128&g=1", "display_name": "John Rotenstein", "link": "https://stackoverflow.com/users/174777/john-rotenstein"}, "edited": false, "score": 0, "creation_date": 1572433367, "post_id": 58623559, "comment_id": 103555596, "body": "Scroll down to see the code editor."}, {"owner": {"reputation": 2379, "user_id": 11890264, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-SXtQk-gEdk4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re59-8V4VJNT_1V9XoftvQAnn3mOw/photo.jpg?sz=128", "display_name": "Assael Azran", "link": "https://stackoverflow.com/users/11890264/assael-azran"}, "edited": false, "score": 1, "creation_date": 1572433433, "post_id": 58623559, "comment_id": 103555630, "body": "I think go runtime does not support &quot;code inline&quot; but i&#39;m not sure"}, {"owner": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "reply_to_user": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "edited": false, "score": 0, "creation_date": 1572433480, "post_id": 58623559, "comment_id": 103555657, "body": "@Adiii have checked that but there is no option to go to that mode"}, {"owner": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "reply_to_user": {"reputation": 2379, "user_id": 11890264, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-SXtQk-gEdk4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re59-8V4VJNT_1V9XoftvQAnn3mOw/photo.jpg?sz=128", "display_name": "Assael Azran", "link": "https://stackoverflow.com/users/11890264/assael-azran"}, "edited": false, "score": 0, "creation_date": 1572433517, "post_id": 58623559, "comment_id": 103555678, "body": "@AssaelAzran Or maybe since I am deploying a go server, only the executable gets deployed on the aws lamda"}, {"owner": {"reputation": 2379, "user_id": 11890264, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-SXtQk-gEdk4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re59-8V4VJNT_1V9XoftvQAnn3mOw/photo.jpg?sz=128", "display_name": "Assael Azran", "link": "https://stackoverflow.com/users/11890264/assael-azran"}, "edited": false, "score": 0, "creation_date": 1572433639, "post_id": 58623559, "comment_id": 103555751, "body": "From my experience nodejs runtime works but .Net Core does not (uploading dll)"}], "answers": [{"comments": [{"owner": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "edited": false, "score": 0, "creation_date": 1572433447, "post_id": 58623824, "comment_id": 103555637, "body": "My code size, repository size = 1.4MB after unzipping the deployment package from AWS I get a binary executable of 8MB It is a go server, so I guess only the build is available in the lamda"}], "tags": [], "owner": {"reputation": 2134, "user_id": 7368965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29569b46e10e8108c2d193e8cd51cfca?s=128&d=identicon&r=PG&f=1", "display_name": "error404", "link": "https://stackoverflow.com/users/7368965/error404"}, "is_accepted": false, "score": -1, "last_activity_date": 1572432914, "creation_date": 1572432914, "answer_id": 58623824, "question_id": 58623559, "link": "https://stackoverflow.com/questions/58623559/where-is-the-visual-config-view-in-aws-lambda/58623824#58623824", "title": "Where is the visual config view in AWS Lambda?", "body": "<p>Based on the code size the AWS code editor will display the code. Since the size of the code/package is large AWS Code editor can't display the same.</p>\n\n<p>But you can download the package from AWS Lambda function using export.</p>\n\n<p>Kindly follow the below steps:</p>\n\n<ol>\n<li>Go to the lambda</li>\n<li>Select the lambda</li>\n<li>Click on Actions</li>\n<li>Select Export function</li>\n<li>You will get few options. <strong>Select Download deployment package.</strong></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 34972, "user_id": 3288890, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/sSQpx.jpg?s=128&g=1", "display_name": "Adiii", "link": "https://stackoverflow.com/users/3288890/adiii"}, "is_accepted": false, "score": 0, "last_activity_date": 1572433995, "creation_date": 1572433995, "answer_id": 58624114, "question_id": 58623559, "link": "https://stackoverflow.com/questions/58623559/where-is-the-visual-config-view-in-aws-lambda/58624114#58624114", "title": "Where is the visual config view in AWS Lambda?", "body": "<p>Beside below lamda limitation, It seems console lamda editor does not support go.</p>\n\n<p>However the documentation suggest to use code star.</p>\n\n<blockquote>\n  <p>You can also <strong>get started with AWS Lambda Go support through AWS\n  CodeStar</strong>. AWS CodeStar lets you quickly launch development projects\n  that include a sample application, source control and release\n  automation. With this announcement, AWS CodeStar introduced new\n  project templates for Go running on AWS Lambda. Select one of the\n  CodeStar Go project templates to get started. CodeStar makes it easy\n  to begin editing your Go project code in AWS Cloud9, an online IDE,\n  with just a few clicks.</p>\n</blockquote>\n\n<p><a href=\"https://aws.amazon.com/blogs/compute/announcing-go-support-for-aws-lambda/\" rel=\"nofollow noreferrer\">announcing-go-support-for-aws-lambda</a></p>\n\n<p><strong>Q: How do I create an AWS Lambda function using the Lambda console?</strong></p>\n\n<blockquote>\n  <p>If you are using <strong>Node.js or Python</strong>, you can author the code for your\n  function using code editor in the AWS Lambda console which lets you\n  author and test your functions, and view the results of function\n  executions in a robust, IDE-like environment</p>\n</blockquote>\n\n<p><a href=\"https://aws.amazon.com/lambda/faqs/\" rel=\"nofollow noreferrer\">lambda-faqs</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/4Hd2R.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4Hd2R.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>Deployment package size</strong></p>\n\n<pre><code>50 MB (zipped, for direct upload)\n\n250 MB (unzipped, including layers)\n\n3 MB (console editor)\n</code></pre>\n\n<p><a href=\"https://docs.aws.amazon.com/lambda/latest/dg/limits.html\" rel=\"nofollow noreferrer\">lambda limits</a> </p>\n\n<p><a href=\"https://docs.aws.amazon.com/lambda/latest/dg/lambda-go-how-to-create-deployment-package.html\" rel=\"nofollow noreferrer\">lambda-go-how-to-create-deployment-package</a></p>\n"}, {"tags": [], "owner": {"reputation": 2379, "user_id": 11890264, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-SXtQk-gEdk4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re59-8V4VJNT_1V9XoftvQAnn3mOw/photo.jpg?sz=128", "display_name": "Assael Azran", "link": "https://stackoverflow.com/users/11890264/assael-azran"}, "is_accepted": true, "score": 1, "last_activity_date": 1572434877, "last_edit_date": 1572434877, "creation_date": 1572434237, "answer_id": 58624196, "question_id": 58623559, "link": "https://stackoverflow.com/questions/58623559/where-is-the-visual-config-view-in-aws-lambda/58624196#58624196", "title": "Where is the visual config view in AWS Lambda?", "body": "<p>Code inline is supported only for interpreted languages (js for example) and not compiled languages.</p>\n"}], "owner": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 58624196, "answer_count": 3, "score": 0, "last_activity_date": 1590702129, "creation_date": 1572432119, "last_edit_date": 1590702129, "question_id": 58623559, "link": "https://stackoverflow.com/questions/58623559/where-is-the-visual-config-view-in-aws-lambda", "title": "Where is the visual config view in AWS Lambda?", "body": "<p>I have been trying to look at the code that is deployed in an aws lambda.\nThere is an existing go function that is running in the go lambda.\nHowever, I am not able to. AWS docs says we can look at the code through the visual config view, where is this view? This is the screen that I see, where is the view to see the code?\nPlease help.</p>\n\n<p>Or is it because we are using a go server, only the executable which is a binary is running in the lambda and hence we are not able to see the code?\n<a href=\"https://i.stack.imgur.com/2EzoH.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2EzoH.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1572440197, "post_id": 58621812, "comment_id": 103559328, "body": "How would it create a heap profile if it has no more memory with which to do so? Also, the kernel is going to send a SIGKILL, so there&#39;s nothing you could do at that point anyway. You need to profile your program under the same load before it gets killed."}], "owner": {"reputation": 1221, "user_id": 7171370, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/40d343e2fe3a3b6cc4d5c4f20c966f0e?s=128&d=identicon&r=PG&f=1", "display_name": "YuFeng Shen", "link": "https://stackoverflow.com/users/7171370/yufeng-shen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1572439553, "creation_date": 1572426367, "last_edit_date": 1572439553, "question_id": 58621812, "link": "https://stackoverflow.com/questions/58621812/how-to-collect-the-heap-info-when-the-go-program-is-killed-through-the-cgroup-wa", "title": "how to collect the heap info when the Go program is killed through the cgroup way?", "body": "<p>I am running a Go process under a cgroup with an OOM Killer, and I want to print the heap memory info by such as command \"go tool pprofhttp://localhost:6060/debug/pprof/heap\" or any other way which can figure out the top memory consumers when the process is killed (Btw, it is better to print the heap info by the Go process itself  such as call some method by the Go process), so I can know top memory consumers and fix it next time.</p>\n"}, {"tags": ["go", "timer", "channels", "routines"], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 5429087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9ecb7dc26f59a3f2f4b0d0fa3324729?s=128&d=identicon&r=PG&f=1", "display_name": "user5429087", "link": "https://stackoverflow.com/users/5429087/user5429087"}, "edited": false, "score": 0, "creation_date": 1572478079, "post_id": 58621509, "comment_id": 103576781, "body": "It wasn&#39;t an accident to stop the timer immediately. I would have preferred to create it but not yet start it ticking so that it only started ticking upon an event from the other channel but I didn&#39;t know how to do that. If I just set the var to the type *Timer instead of starting the timer then the select gets stuck so I had to get the timer started and then immediately stop it."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1572426839, "last_edit_date": 1572426839, "creation_date": 1572425298, "answer_id": 58621509, "question_id": 58620571, "link": "https://stackoverflow.com/questions/58620571/timer-example-using-timer-reset-not-working-as-described/58621509#58621509", "title": "Timer example using timer.Reset() not working as described", "body": "<p>You create a timer and you stop it immediately:</p>\n\n<pre><code>var tmr = time.NewTimer(time.Second)\ntmr.Stop()\n</code></pre>\n\n<p>This doesn't make any sense, I assume this is just an \"accident\" from your part.</p>\n\n<p>But going further, inside your loop:</p>\n\n<pre><code>    case _, ok := &lt;-watcher.Events:\n</code></pre>\n\n<p>When this happens, you claim this doesn't work:</p>\n\n<pre><code>        if !tmr.Stop() {\n            fmt.Println(`Ticker: CHAN DRAIN`)\n            &lt;-tmr.C // STOPS HERE AND GOES NO FURTHER\n        }\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/time/#Timer.Stop\" rel=\"nofollow noreferrer\"><code>Timer.Stop()</code></a> documents that it returns <code>true</code> if this call stops the timer, and <code>false</code> if the timer has already been stopped (or expired). But your timer was already stopped, right after its creation, so <code>tmr.Stop()</code> returns <code>false</code> properly, so you go inside the <code>if</code> and try to receive from <code>tmr.C</code>, but since the timer was \"long\" stopped, nothing will be sent on its channel, so this is a blocking (forever) operation.</p>\n\n<p>If you're the one stopping the timer explicitly with <code>timer.Stop()</code>, the recommended \"pattern\" to drain its channel doesn't make any sense and doesn't work for the 2nd <code>Timer.Stop()</code> call. </p>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": -1, "last_activity_date": 1572425519, "creation_date": 1572425519, "answer_id": 58621559, "question_id": 58620571, "link": "https://stackoverflow.com/questions/58620571/timer-example-using-timer-reset-not-working-as-described/58621559#58621559", "title": "Timer example using timer.Reset() not working as described", "body": "<p>your are miss-using the time.Timer.</p>\n\n<p>Try something simple like this</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n    timer := time.NewTimer(time.Second)\n    watcher := make(chan bool)\n    done := make(chan bool)\n    evs := make(chan bool)\n    go func() {\n        trigger := false\n        for {\n            select {\n            case &lt;-timer.C:\n                if trigger {\n                    trigger = false\n                    evs &lt;- true\n                }\n                timer.Reset(time.Second)\n\n            case _, ok := &lt;-watcher:\n                if !ok {\n                    return\n                }\n                trigger = true\n\n            case &lt;-done:\n                fmt.Println(`DONE TRIGGERED`)\n                return\n            }\n        }\n    }()\n    go func() {\n        for e := range evs {\n            log.Println(\"e\", e)\n        }\n    }()\n    // simulate multiple events\n    watcher &lt;- true\n    watcher &lt;- true\n    watcher &lt;- true\n    watcher &lt;- true\n    &lt;-time.After(time.Second + time.Millisecond*100)\n    watcher &lt;- true\n    watcher &lt;- true\n    watcher &lt;- true\n        &lt;-time.After(time.Second + time.Millisecond*100)\n\n    fmt.Println(\"Hello, playground\")\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1001, "user_id": 4044050, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Fawzb.jpg?s=128&g=1", "display_name": "Debashish", "link": "https://stackoverflow.com/users/4044050/debashish"}, "edited": false, "score": 0, "creation_date": 1583003954, "post_id": 58631999, "comment_id": 106973615, "body": "what if a go routine is listening on a timer channel and another go routine calls Reset() on the same timer even before the expiry of the timer? Is it some kind of violation ?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 1001, "user_id": 4044050, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Fawzb.jpg?s=128&g=1", "display_name": "Debashish", "link": "https://stackoverflow.com/users/4044050/debashish"}, "edited": false, "score": 1, "creation_date": 1583012158, "post_id": 58631999, "comment_id": 106975578, "body": "@Debashish: because channels are synchronization points, and <code>t.C</code> has one buffer entry, there are limited possibilities: either there <i>is</i> one tick in the channel, or there is none; either someone\u2014some Go routine; I like to think of them as people, or gophers\u2014*is* blocked in a receive, if is not; when you call <code>t.Stop</code>, either the goroutine that&#39;s sending ticks (which is a system goroutine) has started its send, or has not."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1583012639, "post_id": 58631999, "comment_id": 106975678, "body": "So: suppose goroutine A is <i>blocked</i> on a receive (<code>&lt;-t.C</code>), and no tick is in the channel now. Some other goroutine B\u2014it must be some other one; A is blocked in receive\u2014calls <code>t.Stop()</code>. Let&#39;s call the system&#39;s goroutine, that will send a tick if we don&#39;t stop it first, S. There are two cases: S has not and won&#39;t put a tick in <code>t.C</code> when B calls <code>t.Stop()</code>, or, S has-or-will put a tick in <code>t.C</code>. If S <i>won&#39;t</i> put a tick when B calls <code>t.Stop()</code>, A is now stuck, because no tick will show up."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1583012686, "post_id": 58631999, "comment_id": 106975686, "body": "While B can try to compensate for this, it&#39;s probably better to just write A in such a way that it won&#39;t get stuck: i.e., that it has a <i>conditional</i> receive, with a <code>select</code>."}, {"owner": {"reputation": 1001, "user_id": 4044050, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Fawzb.jpg?s=128&g=1", "display_name": "Debashish", "link": "https://stackoverflow.com/users/4044050/debashish"}, "edited": false, "score": 0, "creation_date": 1583013035, "post_id": 58631999, "comment_id": 106975762, "body": "@torek, for example a running timer <code>t</code> has spent <code>2 sec</code> of total <code>5 seconds</code> in a separate go routine and it is blocking in <code>t.C</code> channel ; and I call <code>t.Reset(10 sec)</code> from a different go routine. Will this cause <code>t.C</code> to unblock after <code>12 seconds ?</code>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1583013478, "post_id": 58631999, "comment_id": 106975850, "body": "Let&#39;s assign names to the goroutines, to make it easy to talk about them. Goroutine A is in <code>&lt;-t.C</code> and has been that way for 2 seconds. Goroutine B now calls <code>t.Reset(10*time.Second)</code>. Goroutine S (which is going to send a tick in 3 more seconds) <i>hasn&#39;t</i> tried to send a tick yet; B changes the remaining time to 10 seconds; so S will now eventually send a tick in 10 seconds. A will now wake up some time after a total of approximately 12 seconds, yes."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1583013623, "post_id": 58631999, "comment_id": 106975889, "body": "This kind of code is generally tricky though. What if A has been waiting for <i>5</i> seconds, not 2, and S <i>has</i> started and <i>is</i> in the process of sending a tick, when B calls <code>t.Reset(10)</code>? S will send another tick in 10 seconds. We can&#39;t tell what will happen then without knowing the rest of the code for A and B."}, {"owner": {"reputation": 1001, "user_id": 4044050, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Fawzb.jpg?s=128&g=1", "display_name": "Debashish", "link": "https://stackoverflow.com/users/4044050/debashish"}, "edited": false, "score": 0, "creation_date": 1583014124, "post_id": 58631999, "comment_id": 106975984, "body": "Actually I got this situation <a href=\"https://stackoverflow.com/questions/60466530/timer-reset-in-separate-go-routine\" title=\"timer reset in separate go routine\">stackoverflow.com/questions/60466530/&hellip;</a> and I found OP&#39;s question related. In the above case you mentioned about the duplicate tick received in A. It is OK in my case."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 3, "last_activity_date": 1572461539, "creation_date": 1572461539, "answer_id": 58631999, "question_id": 58620571, "link": "https://stackoverflow.com/questions/58620571/timer-example-using-timer-reset-not-working-as-described/58631999#58631999", "title": "Timer example using timer.Reset() not working as described", "body": "<p>Besides what <a href=\"https://stackoverflow.com/a/58621509/1256452\">icza said</a> (q.v.), note that the <a href=\"https://golang.org/pkg/time/#Timer.Stop\" rel=\"nofollow noreferrer\">documentation</a> says:</p>\n\n<blockquote>\n  <p>For example, assuming the program has not received from t.C already:</p>\n\n<pre><code>if !t.Stop() {\n        &lt;-t.C\n}\n</code></pre>\n  \n  <p>This cannot be done concurrent to other receives from the Timer's channel. </p>\n</blockquote>\n\n<p>One could argue that this is not a great example since it assumes that the timer was running at the time you called <code>t.Stop</code>.  But it does go on to mention that this is a <em>bad</em> idea if there's already some existing goroutine that is or may be reading from <code>t.C</code>.</p>\n\n<p>(The <code>Reset</code> documentation repeats all of this, and kind of in the wrong order because <code>Reset</code> sorts before <code>Stop</code>.)</p>\n\n<p>Essentially, the whole area is a bit <a href=\"https://www.merriam-webster.com/dictionary/fraught\" rel=\"nofollow noreferrer\">fraught</a>.  There's no good general answer, because there are at least three possible situations during the return from <code>t.Stop</code> back to your call:</p>\n\n<ul>\n<li>No one is listening to the channel, and no timer-tick is in the channel now.  This is often the case if the timer was already stopped <em>before</em> the call to <code>t.Stop</code>.  If the timer was already stopped, <code>t.Stop</code> always returns false.</li>\n<li>No one is listening to the channel, and a timer-tick is in the channel now.  This is always the case when the timer was running but <code>t.Stop</code> was unable to stop it from firing.  In this case, <code>t.Stop</code> returns false.  It's also the case when the timer <em>was</em> running but fired <em>before</em> you even called <code>t.Stop</code>, and had therefore stopped on its own, so that <code>t.Stop</code> was not able to stop it and returned false.</li>\n<li>Someone else is listening to the channel.</li>\n</ul>\n\n<p>In the last situation, you should do nothing.  In the first situation, you should do nothing.  In the second situation, you probably want to receive from the channel so as to clear it out.  That's what their example is for.</p>\n\n<p>One could argue that:</p>\n\n<pre><code>if !t.Stop() {\n        select {\n        case &lt;-t.C:\n        default:\n        }\n}\n</code></pre>\n\n<p>is a better example.  It does one non-blocking attempt that will consume the timer-tick if present, and does nothing if there is no timer-tick.  This works whether or not the timer was not actually running when you called <code>t.Stop</code>.  Indeed, it even works if <code>t.Stop</code> returns <code>true</code>, though in that case, <code>t.Stop</code> stopped the timer, so the timer never managed to put a timer-tick into the channel.  (Thus, if there is a datum in the channel, it must necessarily be left over from a previous failure to clear the channel.  If there are no such bugs, the attempt to receive was in turn unnecessary.)</p>\n\n<p>But, if <em>someone else</em>\u2014some other goroutine\u2014is or may be reading the channel, you should not do any of this at all.  There is no way to know who (you or them) will get any timer tick that might be in the channel despite the call to <code>Stop</code>.</p>\n\n<p>Meanwhile, if you're <em>not</em> going to use the timer any further, it's relatively harmless just to leave a timer-tick, if there is one, in the channel.  It will be garbage-collected when the channel itself is garbage-collected.  Of course, whether this is sensible depends on what you are doing with the timer, but in these cases it suffices to just call <code>t.Stop</code> and ignore its return value.</p>\n"}], "owner": {"reputation": 119, "user_id": 5429087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9ecb7dc26f59a3f2f4b0d0fa3324729?s=128&d=identicon&r=PG&f=1", "display_name": "user5429087", "link": "https://stackoverflow.com/users/5429087/user5429087"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1150, "favorite_count": 0, "accepted_answer_id": 58631999, "answer_count": 3, "score": 2, "last_activity_date": 1572461539, "creation_date": 1572421273, "last_edit_date": 1572426226, "question_id": 58620571, "link": "https://stackoverflow.com/questions/58620571/timer-example-using-timer-reset-not-working-as-described", "title": "Timer example using timer.Reset() not working as described", "body": "<p>I've been working with examples trying to get my first \"go routine\" running and while I got it running, it won't work as prescribed by the go documentation with the timer.Reset() function.</p>\n\n<p>In my case I believe that the way I am doing it is just fine because I don't actually care what's in the chan buffer, if anything. All as this is meant to do is trigger <code>case &lt;-tmr.C:</code> if anything happened on <code>case _, ok := &lt;-watcher.Events:</code> and then all goes quiet for at least one second. The reason for this is that <code>case _, ok := &lt;-watcher.Events:</code> can get from one to dozens of events microseconds apart and I only care once they are all done and things have settled down again.</p>\n\n<p>However I'm concerned that doing it the way that the documentation says you \"must do\" doesn't work. If I knew go better I would say the documentation is flawed because it assumes there is something in the buffer when there may not be but I don't know go well enough to have confidence in making that determination so I'm hoping some experts out there can enlighten me.</p>\n\n<p>Below is the code. I haven't put this up on playground because I would have to do some cleaning up (remove calls to other parts of the program) and I'm not sure how I would make it react to filesystem changes for showing it working.</p>\n\n<p>I've clearly marked in the code which alternative works and which doesn't.</p>\n\n<pre><code>func (pm *PluginManager) LoadAndWatchPlugins() error {\n\n  // DOING OTHER STUFF HERE\n\n    fmt.Println(`m1`)\n\n    done := make(chan interface{})\n    terminated := make(chan interface{})\n\n    go pm.watchDir(done, terminated, nil)\n    fmt.Println(`m2.pre-10`)\n\n    time.Sleep(10 * time.Second)\n\n    fmt.Println(`m3-post-10`)\n\n    go pm.cancelWatchDir(done)\n    fmt.Println(`m4`)\n\n    &lt;-terminated\n    fmt.Println(`m5`)\n\n    os.Exit(0) // Temporary for testing\n\n    return Err\n}\n\nfunc (pm *PluginManager) cancelWatchDir(done chan interface{}) {\n    fmt.Println(`t1`)\n\n    time.Sleep(5 * time.Second)\n    fmt.Println()\n    fmt.Println(`t2`)\n\n    close(done)\n}\n\nfunc (pm *PluginManager) watchDir(done &lt;-chan interface{}, terminated chan interface{}, strings &lt;-chan string) {\n\n  watcher, err := fsnotify.NewWatcher()\n    if err != nil {\n        Logger(\"watchDir::\"+err.Error(), `plugins`, Error)\n    }\n\n    //err = watcher.Add(pm.pluginDir)\n    err = watcher.Add(`/srv/plugins/`)\n    if err != nil {\n        Logger(\"watchDir::\"+err.Error(), `plugins`, Error)\n    }\n\n    var tmr = time.NewTimer(time.Second)\n    tmr.Stop()\n\n    defer close(terminated)\n    defer watcher.Close()\n    defer tmr.Stop()\n    for {\n        select {\n        case &lt;-tmr.C:\n            fmt.Println(`UPDATE FIRED`)\n            tmr.Stop()\n\n        case _, ok := &lt;-watcher.Events:\n            if !ok {\n                return\n            }\n\n            fmt.Println(`Ticker: STOP`)\n            /*\n             *  START OF ALTERNATIVES\n             *\n             *  THIS IS BY EXAMPLE AND STATED THAT IT \"MUST BE\" AT:\n             *      https://golang.org/pkg/time/#Timer.Reset\n             *\n             *  BUT DOESN'T WORK\n             */\n            if !tmr.Stop() {\n                fmt.Println(`Ticker: CHAN DRAIN`)\n                &lt;-tmr.C // STOPS HERE AND GOES NO FURTHER\n            }\n            /*\n             *  BUT IF I JUST DO THIS IT WORKS\n             */\n            tmr.Stop()\n            /*\n             *  END OF ALTERNATIVES\n             */\n\n            fmt.Println(`Ticker: RESET`)\n            tmr.Reset(time.Second)\n\n        case &lt;-done:\n            fmt.Println(`DONE TRIGGERED`)\n            return\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "edited": false, "score": 0, "creation_date": 1572423687, "post_id": 58621015, "comment_id": 103550506, "body": "Very helpful. But the source code of <code>gofmt_test.go</code> is a little complex. Snapshot testing feature should be added to <code>testing</code> package so that developer can use it out of the box."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "edited": false, "score": 2, "creation_date": 1572424572, "post_id": 58621015, "comment_id": 103550894, "body": "@slideshowp2: You&#39;re welcome to propose that on the Go issue tracker, but I doubt it will be accepted, as Go has a philosophy of not hiding complexity. And this can be easily supported by a third-party library, such as <a href=\"https://gitlab.com/flimzy/testy\" rel=\"nofollow noreferrer\">this one</a> which I wrote, which takes a slightly different approach, but same concept."}], "tags": [], "owner": {"reputation": 3237, "user_id": 9741769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4b0913fe3d348f510777caaf5540169?s=128&d=identicon&r=PG&f=1", "display_name": "Blokje5", "link": "https://stackoverflow.com/users/9741769/blokje5"}, "is_accepted": false, "score": 3, "last_activity_date": 1572423236, "creation_date": 1572423236, "answer_id": 58621015, "question_id": 58620488, "link": "https://stackoverflow.com/questions/58620488/how-can-i-do-snapshot-testing/58621015#58621015", "title": "How can I do snapshot testing?", "body": "<p>As far as I know, the <code>testing</code> Package does not support something like this out of the box. There is a pattern for Go that you can utilise called \"Golden file testing\". The convention is to store testdata in a <code>testdata</code> folder alongside your test. In this case you would store the rendered template in a so called \"golden file\". The test itself provides an <code>update</code> flag to write out the latest version (so that you don't have to manually maintain the output):</p>\n\n<pre><code>var update = flag.Bool(\"update\", false, \"update .golden files\")\nfunc TestProcessString(t *testing.T) {\n  vars := make(map[string]interface{})\n  vars[\"columnPrefix\"] = \"adgroup_performance_report\"\n  actual := processString(query, vars)\n  golden := filepath.Join(\u201ctestdata\u201d, \u201dperformance_report.golden\u201d)\n  if *update {\n    ioutil.WriteFile(golden, actual, 0644)\n  }\n  expected, _ := ioutil.ReadFile(golden)\n\n  if !bytes.Equal(actual, expected) {\n    t.Fatalf(\"Output did not match, expected %v, recieved %v, expected, actual)\n  }\n}\n</code></pre>\n\n<p>A nice example of this pattern can be found in the <code>gofmt</code> source code: <a href=\"https://golang.org/src/cmd/gofmt/gofmt_test.go\" rel=\"nofollow noreferrer\">https://golang.org/src/cmd/gofmt/gofmt_test.go</a></p>\n"}], "owner": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1572423236, "creation_date": 1572420879, "last_edit_date": 1572421241, "question_id": 58620488, "link": "https://stackoverflow.com/questions/58620488/how-can-i-do-snapshot-testing", "title": "How can I do snapshot testing?", "body": "<p>Does <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\">testing</a> package support snapshot testing?</p>\n\n<p>Here is my case:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n  \"bytes\"\n  \"fmt\"\n  \"html/template\"\n)\n\nfunc main() {\n  query := `\n    INSERT INTO \"ADGROUP_PERFORMANCE_REPORT\" (\n      {{.columnPrefix}}_adgroup_id, \n      {{.columnPrefix}}_adgroup_nme, \n      {{.columnPrefix}}_adgroup_status, \n      {{.columnPrefix}}_campaign_id, \n      {{.columnPrefix}}_campaign_nme, \n      {{.columnPrefix}}_campaign_status, \n      {{.columnPrefix}}_clicks, \n      {{.columnPrefix}}_impressions, \n      {{.columnPrefix}}_ctr, \n      {{.columnPrefix}}_average_cpc, \n      {{.columnPrefix}}_cost, \n      {{.columnPrefix}}_conversions, \n      {{.columnPrefix}}_average_position, \n      {{.columnPrefix}}_device, \n      google_adwords_client_customer_id\n    ) VALUES\n  `\n  vars := make(map[string]interface{})\n  vars[\"columnPrefix\"] = \"adgroup_performance_report\"\n  result := processString(query, vars)\n  fmt.Printf(\"result=%s\\n\", result)\n}\n\nfunc process(t *template.Template, vars interface{}) string {\n  var tmplBytes bytes.Buffer\n  err := t.Execute(&amp;tmplBytes, vars)\n  if err != nil {\n    panic(err)\n  }\n  return tmplBytes.String()\n}\n\nfunc processString(str string, vars interface{}) string {\n  tmpl, err := template.New(\"tmpl\").Parse(str)\n  if err != nil {\n    panic(err)\n  }\n  return process(tmpl, vars)\n}\n</code></pre>\n\n<p>Now I am going to write unit test for it, I would like use snapshot testing to test the structure of the SQL query string processed by <code>html/template</code> pkg.</p>\n\n<p>Here is the output in the stdout:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>result=\n    INSERT INTO \"ADGROUP_PERFORMANCE_REPORT\" (\n      adgroup_performance_report_adgroup_id, \n      adgroup_performance_report_adgroup_nme, \n      adgroup_performance_report_adgroup_status, \n      adgroup_performance_report_campaign_id, \n      adgroup_performance_report_campaign_nme, \n      adgroup_performance_report_campaign_status, \n      adgroup_performance_report_clicks, \n      adgroup_performance_report_impressions, \n      adgroup_performance_report_ctr, \n      adgroup_performance_report_average_cpc, \n      adgroup_performance_report_cost, \n      adgroup_performance_report_conversions, \n      adgroup_performance_report_average_position, \n      adgroup_performance_report_device, \n      google_adwords_client_customer_id\n    ) VALUES\n</code></pre>\n\n<p>I don't want to write this expected value duplicately in unit test file and assert it. I prefer using snapshot testing and it will generate a snapshot file. Something like <a href=\"https://jestjs.io/docs/en/snapshot-testing\" rel=\"nofollow noreferrer\">jestjs snapshot-testing</a></p>\n"}, {"tags": ["go", "traefik"], "answers": [{"tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": true, "score": 2, "last_activity_date": 1572422474, "last_edit_date": 1572422474, "creation_date": 1572421471, "answer_id": 58620611, "question_id": 58620310, "link": "https://stackoverflow.com/questions/58620310/can-not-use-traefik-with-dynamic-configuration-file/58620611#58620611", "title": "can not use traefik with dynamic configuration file", "body": "<p><code>entryPoints</code> is a slice, not a string.</p>\n\n<p>I'm not sure if you need to change the capitalization, but you definitely need to change it to a slice, like this:</p>\n\n<pre><code>entryPoints = [\"web\"]\n</code></pre>\n\n<p>You can find an example for it on <a href=\"https://docs.traefik.io/v2.0/routing/routers/#priority\" rel=\"nofollow noreferrer\">this page</a> under Priority > Set priorities -- using the File Provider.</p>\n\n<p>Also, the filename property is a string, so leave it as it was before. See <a href=\"https://docs.traefik.io/v2.0/routing/overview/#example-with-a-file-provider\" rel=\"nofollow noreferrer\">this link</a>:</p>\n\n<pre><code>filename = \"/etc/docker/dynamic_conf.toml\"\n</code></pre>\n"}], "owner": {"reputation": 158, "user_id": 2762170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2561d6a2aead67787bc6ab3e8ba60dfe?s=128&d=identicon&r=PG&f=1", "display_name": "no746", "link": "https://stackoverflow.com/users/2762170/no746"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2611, "favorite_count": 0, "accepted_answer_id": 58620611, "answer_count": 1, "score": 1, "last_activity_date": 1572423127, "creation_date": 1572420064, "last_edit_date": 1572423127, "question_id": 58620310, "link": "https://stackoverflow.com/questions/58620310/can-not-use-traefik-with-dynamic-configuration-file", "title": "can not use traefik with dynamic configuration file", "body": "<p>I'm trying to learn and use traefik.\nhere is my docker-compose.yaml:</p>\n\n<pre><code>version: \"3\"\n\nservices:\n\n  traefik:\n    image: \"traefik:v2.0\"\n    container_name: \"traefik\"\n    ports:\n      - \"80:80\"\n      - \"8080:8080\"\n    volumes:\n      - \"/var/run/docker.sock:/var/run/docker.sock\"\n      - ./traefik:/etc/traefik\n      - ./docker:/etc/docker\n\n  whoami:\n    image: \"containous/whoami\"\n    container_name: \"whoami\"\n\n</code></pre>\n\n<p>and here is my traefik.toml:</p>\n\n<pre><code>\n[entryPoints]\n  [entryPoints.web]\n    address = \":80\"\n\n[providers]\n  [providers.file]\n    filename = \"/etc/docker/dynamic_conf.toml\"\n  [providers.docker]\n    exposedByDefault = false\n\n[api]\n  insecure = true\n\n</code></pre>\n\n<p>and this is my dynamic_conf.toml:</p>\n\n<pre><code>[http]\n    [http.routers]\n        [http.routers.whoami]\n            rule = \"Host(`whoami.localhost`)\"\n            entrypoints = \"web\"\n            service = \"whoami\"\n</code></pre>\n\n<p>but when i build the image and run it, I get an error:</p>\n\n<pre><code>Cannot start the provider *file.Provider: toml: cannot load TOML value of type string into a Go slice\n</code></pre>\n\n<p>Screenshot: <a href=\"https://i.stack.imgur.com/TrxQE.png\" rel=\"nofollow noreferrer\">traefik errors</a></p>\n\n<p>I couldn't find out the reason, I searched and I changed </p>\n\n<pre><code>filename = \"/etc/docker/dynamic_conf.toml\"\n</code></pre>\n\n<p>to </p>\n\n<pre><code>filename = [\"/etc/docker/dynamic_conf.toml\"]\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 71, "user_id": 12198958, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-n_8S9Uh6fjw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reA37tasHS5h8aoC9sVf2C0JSDhRg/photo.jpg?sz=128", "display_name": "\u8881\u6811\u7acb", "link": "https://stackoverflow.com/users/12198958/%e8%a2%81%e6%a0%91%e7%ab%8b"}, "reply_to_user": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1572417079, "post_id": 58619341, "comment_id": 103548115, "body": "5* time.Second is too long..."}, {"owner": {"reputation": 71, "user_id": 12198958, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-n_8S9Uh6fjw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reA37tasHS5h8aoC9sVf2C0JSDhRg/photo.jpg?sz=128", "display_name": "\u8881\u6811\u7acb", "link": "https://stackoverflow.com/users/12198958/%e8%a2%81%e6%a0%91%e7%ab%8b"}, "reply_to_user": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1572417196, "post_id": 58619341, "comment_id": 103548147, "body": "Is there anything wrong with 1*time.Second\uff1f"}, {"owner": {"reputation": 71, "user_id": 12198958, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-n_8S9Uh6fjw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reA37tasHS5h8aoC9sVf2C0JSDhRg/photo.jpg?sz=128", "display_name": "\u8881\u6811\u7acb", "link": "https://stackoverflow.com/users/12198958/%e8%a2%81%e6%a0%91%e7%ab%8b"}, "reply_to_user": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1572418507, "post_id": 58619341, "comment_id": 103548529, "body": "Most request finished in 20ms. And the server  access log has no 499 or error. It seems net/http getIdleConnCh  waste  time."}], "answers": [{"comments": [{"owner": {"reputation": 1348, "user_id": 1180523, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/52d6fb2e4b01dcbc7a23db19c6d442b3?s=128&d=identicon&r=PG", "display_name": "skplunkerin", "link": "https://stackoverflow.com/users/1180523/skplunkerin"}, "edited": false, "score": 2, "creation_date": 1590081651, "post_id": 58623966, "comment_id": 109552174, "body": "Thank you for the quick files to test with. In researching what Timeout field fixes this <code>Client.Timeout exceeded while awaiting headers</code> error, only the <code>Client.Timeout</code> effects/fixes it. The error points to <code>Transport.ResponseHeaderTimeout</code> as the culprit, but increasing that timeout does nothing."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 10, "last_activity_date": 1572435621, "last_edit_date": 1572435621, "creation_date": 1572433481, "answer_id": 58623966, "question_id": 58619341, "link": "https://stackoverflow.com/questions/58619341/error-net-http-request-canceled-while-waiting-for-connection-client-timeout-e/58623966#58623966", "title": "Error: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)", "body": "<p>You need to <strong>increase</strong> the client <code>Timeout</code> value for your test.</p>\n\n<blockquote>\n  <p><code>net/http: request canceled (Client.Timeout exceeded while awaiting headers)</code></p>\n</blockquote>\n\n<p>This means your <code>Client.Timeout</code> value is less than your server response time, due to many reasons ( e.g. Busy, CPU overload, many requests per second you generated here, ...).</p>\n\n<p>Here a simple way to explain it and regenerate it:</p>\n\n<p>Run this server (which waits for <code>2 * time.Second</code> then sends back the response):</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main() {\n    http.HandleFunc(`/`, func(w http.ResponseWriter, r *http.Request) {\n        log.Println(\"wait a couple of seconds ...\")\n        time.Sleep(2 * time.Second)\n        io.WriteString(w, `Hi`)\n        log.Println(\"Done.\")\n    })\n    log.Println(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>Then run this client which times out in <code>1 * time.Second</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main() {\n    log.Println(\"HTTP GET\")\n    client := &amp;http.Client{\n        Timeout: 1 * time.Second,\n    }\n    r, err := client.Get(`http://127.0.0.1:8080/`)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer r.Body.Close()\n    bs, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Println(\"HTTP Done.\")\n    log.Println(string(bs))\n}\n</code></pre>\n\n<p>The output is (<code>Client.Timeout exceeded while awaiting headers</code>):</p>\n\n<pre><code>2019/10/30 11:05:08 HTTP GET\n2019/10/30 11:05:09 Get http://127.0.0.1:8080/: net/http: request canceled (Client.Timeout exceeded while awaiting headers)\nexit status 1\n</code></pre>\n\n<hr>\n\n<p>Note:<br>\nYou need to change these two settings accordingly (<code>http.Transport.ResponseHeaderTimeout</code> and <code>http.Client.Timeout</code>).</p>\n\n<p>You have set <code>ResponseHeaderTimeout: 60 * time.Second,</code> while <code>Client.Timeout</code> to half a second.</p>\n"}], "owner": {"reputation": 71, "user_id": 12198958, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-n_8S9Uh6fjw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reA37tasHS5h8aoC9sVf2C0JSDhRg/photo.jpg?sz=128", "display_name": "\u8881\u6811\u7acb", "link": "https://stackoverflow.com/users/12198958/%e8%a2%81%e6%a0%91%e7%ab%8b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17526, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1572435621, "creation_date": 1572414139, "question_id": 58619341, "link": "https://stackoverflow.com/questions/58619341/error-net-http-request-canceled-while-waiting-for-connection-client-timeout-e", "title": "Error: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)", "body": "<p>About 3~4minutes,Some Errors would happen in my log.</p>\n\n<p>net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)</p>\n\n<p>I try to find out where it takes time Using httptrace.\nhttptrace.GetConn\nhttptrace.GotConn</p>\n\n<p>I think it runs out of time before httptrace.GotConn.\nSo errors happend \nrequest canceled while waiting for connection</p>\n\n<p>My machine is ok.and this is my netstat.</p>\n\n<p>LAST_ACK 2 \nCLOSE_WAIT 7 \nESTABLISHED 108 \nSYN_SENT 3 \nTIME_WAIT 43</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/md5\"\n    \"encoding/hex\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"math/rand\"\n    \"net\"\n    \"net/http\"\n    \"net/http/httptrace\"\n    \"os\"\n    \"sync\"\n    \"time\"\n)\n\nvar Client *http.Client = &amp;http.Client{\n    Transport: &amp;http.Transport{\n        DisableKeepAlives:true,\n        Proxy: http.ProxyFromEnvironment,\n        DialContext: (&amp;net.Dialer{\n            Timeout:   3 * time.Second, // \u8fde\u63a5\u8d85\u65f6\n            KeepAlive: 10 * time.Second,\n            DualStack: true,\n        }).DialContext,\n        IdleConnTimeout:       120 * time.Second,\n        ResponseHeaderTimeout: 60 * time.Second,\n        ExpectContinueTimeout: 1 * time.Second,\n    },\n    Timeout: 500 * time.Millisecond,\n}\n\nfunc GenLogId() string {\n    h2 := md5.New()\n    rand.Seed(time.Now().Unix())\n    str := fmt.Sprintf(\"%d%d%d\", os.Getpid(), time.Now().UnixNano(), rand.Int())\n\n    h2.Write([]byte(str))\n    uniqid := hex.EncodeToString(h2.Sum(nil))\n\n    return uniqid\n}\n\nfunc main() {\n    var (\n        wg           sync.WaitGroup\n        maxParallel  int       = 50\n        parallelChan chan bool = make(chan bool, maxParallel)\n    )\n    for {\n        parallelChan &lt;- true\n        wg.Add(1)\n        go func() {\n            defer func() {\n                wg.Done()\n                &lt;-parallelChan\n            }()\n            testHttp2()\n        }()\n    }\n    wg.Wait()\n}\n\nfunc testHttp2() {\n    url := \"http://10.33.108.39:11222/index.php\"\n    req, _ := http.NewRequest(\"GET\", url, nil)\n\n    uniqId := GenLogId()\n    trace := &amp;httptrace.ClientTrace{\n        GetConn: func(hostPort string) {\n            fmt.Println(\"GetConn id:\", uniqId, time.Now().UnixNano(), hostPort)\n        },\n        GotConn: func(connInfo httptrace.GotConnInfo) {\n            fmt.Println(\"GotConn id:\", uniqId, time.Now().UnixNano(), connInfo.Conn.LocalAddr())\n        },\n\n        ConnectStart: func(network, addr string) {\n            fmt.Println(\"ConnectStart id:\", uniqId, time.Now().UnixNano(), network, addr)\n        },\n        ConnectDone: func(network, addr string, err error) {\n            fmt.Println(\"ConnectDone id:\", uniqId, time.Now().UnixNano(), network, addr, err)\n        },\n    }\n    req = req.WithContext(httptrace.WithClientTrace(req.Context(), trace))\n    resp, err := Client.Do(req)\n    if err != nil {\n        fmt.Println(\"err: id\", uniqId, time.Now().UnixNano(), err)\n        return\n    }\n\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n\n    if err != nil {\n        fmt.Println(\"error\", string(body))\n    }\n    return\n}\n</code></pre>\n\n<p>You can reproduce using my code. I am so confuse about the bug... \nThank you.</p>\n"}, {"tags": ["go", "deadlock"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1572414316, "post_id": 58619289, "comment_id": 103547412, "body": "Your code, copied to the <a href=\"https://play.golang.org/p/1Aw3blw7SDg\" rel=\"nofollow noreferrer\">Go Playground</a>, <i>does</i> abort with a deadlock error."}, {"owner": {"reputation": 65, "user_id": 12295189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de9659adeb85a4447d3d51911ef8462c?s=128&d=identicon&r=PG&f=1", "display_name": "wei", "link": "https://stackoverflow.com/users/12295189/wei"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1572414545, "post_id": 58619289, "comment_id": 103547463, "body": "Yes, It&#39;s true.But If you run it use the &quot;go run&quot; command, the deadlock error will not appeared, I don&#39;t know why"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1572417137, "post_id": 58619289, "comment_id": 103548132, "body": "What version of Go are you using? What <i>exactly</i> does one need to do to reproduce the problem? See <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1572424951, "post_id": 58620073, "comment_id": 103551054, "body": "TIL... Interesting."}, {"owner": {"reputation": 65, "user_id": 12295189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de9659adeb85a4447d3d51911ef8462c?s=128&d=identicon&r=PG&f=1", "display_name": "wei", "link": "https://stackoverflow.com/users/12295189/wei"}, "edited": false, "score": 0, "creation_date": 1572425814, "post_id": 58620073, "comment_id": 103551439, "body": "Thank you for your reply. This issue has been bothered me two days.Your reply is so helpful to me, but I still not clear about the details."}], "tags": [], "owner": {"reputation": 1052, "user_id": 7768287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ySIAC.png?s=128&g=1", "display_name": "Tiya Jose", "link": "https://stackoverflow.com/users/7768287/tiya-jose"}, "is_accepted": false, "score": 10, "last_activity_date": 1572418798, "creation_date": 1572418798, "answer_id": 58620073, "question_id": 58619289, "link": "https://stackoverflow.com/questions/58619289/why-doesnt-this-code-return-a-deadlock-error/58620073#58620073", "title": "Why doesn&#39;t this code return a &quot;deadlock&quot; error?", "body": "<p>Importing the net package starts background polling Goroutines that effectively disable the deadlock detector.</p>\n\n<p>You can see the discussion for a similar issue here: <a href=\"https://github.com/golang/go/issues/12734\" rel=\"noreferrer\">https://github.com/golang/go/issues/12734</a></p>\n"}], "owner": {"reputation": 65, "user_id": 12295189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de9659adeb85a4447d3d51911ef8462c?s=128&d=identicon&r=PG&f=1", "display_name": "wei", "link": "https://stackoverflow.com/users/12295189/wei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1572445770, "creation_date": 1572413675, "last_edit_date": 1572445770, "question_id": 58619289, "link": "https://stackoverflow.com/questions/58619289/why-doesnt-this-code-return-a-deadlock-error", "title": "Why doesn&#39;t this code return a &quot;deadlock&quot; error?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc Extract(url string) ([]string, error) {\n    http.Get(url)\n\n    var links []string\n    return links, nil\n}\n\nfunc crawl(url string) []string {\n    list, _ := Extract(url)\n    return list\n}\n\nfunc main() {\n    var ch = make(chan int)\n    ch &lt;- 1\n}\n</code></pre>\n\n<p>If I remove the net/http import, it will return a \"deadlock\" error as expected. But if I import this package, although I didn't invoke the Extract func, the \"deadlock\" will not appear.</p>\n"}, {"tags": ["go", "google-bigquery", "geolocation"], "comments": [{"owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "edited": false, "score": 0, "creation_date": 1572408942, "post_id": 58618623, "comment_id": 103546283, "body": "Please mention what strategies you have tried so far and what are the problems you&#39;re facing."}, {"owner": {"reputation": 13, "user_id": 3533087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60cec460274a9b2a3a63c02e8302d6f7?s=128&d=identicon&r=PG&f=1", "display_name": "user3533087", "link": "https://stackoverflow.com/users/3533087/user3533087"}, "reply_to_user": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "edited": false, "score": 0, "creation_date": 1572416668, "post_id": 58618623, "comment_id": 103548001, "body": "I have edited the question"}, {"owner": {"reputation": 4841, "user_id": 19880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/06e716fdfc96ee2ae1a67fec196f847a?s=128&d=identicon&r=PG", "display_name": "Michael Entin", "link": "https://stackoverflow.com/users/19880/michael-entin"}, "edited": false, "score": 0, "creation_date": 1572629450, "post_id": 58618623, "comment_id": 103630082, "body": "Looks like a typo - your column name is <code>IPs</code>, not <code>IP</code> in <code>SELECT @IPS as IPs</code>, but then you use name <code>IP</code> in <code>NET.SAFE_IP_FROM_STRING(IP)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 3533087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60cec460274a9b2a3a63c02e8302d6f7?s=128&d=identicon&r=PG&f=1", "display_name": "user3533087", "link": "https://stackoverflow.com/users/3533087/user3533087"}, "edited": false, "score": 0, "creation_date": 1572416433, "post_id": 58618682, "comment_id": 103547941, "body": "I have updated my question with what my code looks like. I get the error: unrecognized name as [11:77]. Please help me debug"}, {"owner": {"reputation": 39100, "user_id": 132438, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QJxe1.jpg?s=128&g=1", "display_name": "Felipe Hoffa", "link": "https://stackoverflow.com/users/132438/felipe-hoffa"}, "reply_to_user": {"reputation": 13, "user_id": 3533087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60cec460274a9b2a3a63c02e8302d6f7?s=128&d=identicon&r=PG&f=1", "display_name": "user3533087", "link": "https://stackoverflow.com/users/3533087/user3533087"}, "edited": false, "score": 0, "creation_date": 1572421395, "post_id": 58618682, "comment_id": 103549591, "body": "Were you able to run my query as published? Try it first please"}, {"owner": {"reputation": 13, "user_id": 3533087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60cec460274a9b2a3a63c02e8302d6f7?s=128&d=identicon&r=PG&f=1", "display_name": "user3533087", "link": "https://stackoverflow.com/users/3533087/user3533087"}, "edited": false, "score": 0, "creation_date": 1572448696, "post_id": 58618682, "comment_id": 103564501, "body": "Yes I was. Very Impressive; It took 17 seconds"}, {"owner": {"reputation": 39100, "user_id": 132438, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QJxe1.jpg?s=128&g=1", "display_name": "Felipe Hoffa", "link": "https://stackoverflow.com/users/132438/felipe-hoffa"}, "reply_to_user": {"reputation": 13, "user_id": 3533087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60cec460274a9b2a3a63c02e8302d6f7?s=128&d=identicon&r=PG&f=1", "display_name": "user3533087", "link": "https://stackoverflow.com/users/3533087/user3533087"}, "edited": false, "score": 0, "creation_date": 1572458808, "post_id": 58618682, "comment_id": 103569771, "body": "cool! so now we have to debug the code you pasted... maybe post a new question for that? (since the original question was answered here... now you just completely changed it)"}, {"owner": {"reputation": 13, "user_id": 3533087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60cec460274a9b2a3a63c02e8302d6f7?s=128&d=identicon&r=PG&f=1", "display_name": "user3533087", "link": "https://stackoverflow.com/users/3533087/user3533087"}, "edited": false, "score": 0, "creation_date": 1572574735, "post_id": 58618682, "comment_id": 103611262, "body": "I will leave it as is. This answer has helped me get from having no code to having some code, therefore still valid. Besides, the edits are available for anyone who wants to view the question&#39;s history. I had also mentioned my original intent was to do this with golang and that hasn&#39;t changed"}], "tags": [], "owner": {"reputation": 39100, "user_id": 132438, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QJxe1.jpg?s=128&g=1", "display_name": "Felipe Hoffa", "link": "https://stackoverflow.com/users/132438/felipe-hoffa"}, "is_accepted": false, "score": 0, "last_activity_date": 1572409015, "creation_date": 1572409015, "answer_id": 58618682, "question_id": 58618623, "link": "https://stackoverflow.com/questions/58618623/query-ip-geo-location-data-from-bigquery-open-database-geolite2/58618682#58618682", "title": "Query IP geo-location data from bigquery open database: geolite2", "body": "<p>Check out:</p>\n\n<ul>\n<li><a href=\"https://towardsdatascience.com/geolocation-with-bigquery-de-identify-76-million-ip-addresses-in-20-seconds-e9e652480bd2\" rel=\"nofollow noreferrer\">https://towardsdatascience.com/geolocation-with-bigquery-de-identify-76-million-ip-addresses-in-20-seconds-e9e652480bd2</a></li>\n</ul>\n\n<p>Query:</p>\n\n<pre><code>#standardSQL\n# replace with your source of IP addresses\n# here I'm using the same Wikipedia set from the previous article\nWITH source_of_ip_addresses AS (\n  SELECT REGEXP_REPLACE(contributor_ip, 'xxx', '0')  ip, COUNT(*) c\n  FROM `publicdata.samples.wikipedia`\n  WHERE contributor_ip IS NOT null  \n  GROUP BY 1\n)\nSELECT country_name, SUM(c) c\nFROM (\n  SELECT ip, country_name, c\n  FROM (\n    SELECT *, NET.SAFE_IP_FROM_STRING(ip) &amp; NET.IP_NET_MASK(4, mask) network_bin\n    FROM source_of_ip_addresses, UNNEST(GENERATE_ARRAY(9,32)) mask\n    WHERE BYTE_LENGTH(NET.SAFE_IP_FROM_STRING(ip)) = 4\n  )\n  JOIN `fh-bigquery.geocode.201806_geolite2_city_ipv4_locs`  \n  USING (network_bin, mask)\n)\nGROUP BY 1\nORDER BY 2 DESC\nQuery complete (20.9 seconds elapsed, 1.14 GB processed)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 3533087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60cec460274a9b2a3a63c02e8302d6f7?s=128&d=identicon&r=PG&f=1", "display_name": "user3533087", "link": "https://stackoverflow.com/users/3533087/user3533087"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 142, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572497328, "creation_date": 1572408532, "last_edit_date": 1572497328, "question_id": 58618623, "link": "https://stackoverflow.com/questions/58618623/query-ip-geo-location-data-from-bigquery-open-database-geolite2", "title": "Query IP geo-location data from bigquery open database: geolite2", "body": "<p>What query can I use to get geo-location data of an array of IPs length >= 1 from <a href=\"https://console.cloud.google.com/bigquery?p=bigquery-public-data&amp;d=geolite2&amp;page=dataset&amp;_ga=2.110883141.-1197906150.1568417357\" rel=\"nofollow noreferrer\">the bigquery open database: geolite2</a>. The array is defined in a golang program. \nThe error I get is: IP not defined at [11:77]</p>\n\n<pre><code>type IPValue struct {\n    IP string\n}\n\nfunc main()  {\n    ctx := context.Background()\n    client, err := bigquery.NewClient(ctx, \"{{project}}\")\n    if err != nil {\n        panic(err)\n    }\n\n    q := client.Query(`\n        WITH source_of_ip_addresses AS (\n            SELECT @IPS as IPs\n        )\n        SELECT city_name\n        FROM (\n            SELECT ip, city_name, c, latitude, longitude, geoname_id\n            FROM (\n                SELECT *, NET.SAFE_IP_FROM_STRING(IP) &amp; NET.IP_NET_MASK(4, mask) network_bin\n                FROM source_of_ip_addresses, UNNEST(GENERATE_ARRAY(9,32)) mask\n                WHERE BYTE_LENGTH(NET.SAFE_IP_FROM_STRING(IP)) = 4\n            )\n            JOIN ` + \"`fh-bigquery.geocode.201806_geolite2_city_ipv4_locs`\" + `\n            USING (network_bin, mask)\n        )\n    `)\n    q.DisableQueryCache = false\n    q.Parameters = []bigquery.QueryParameter {\n        {\n            Name: \"IPS\",\n            Value: []IPValue{\n                {\n                    IP: \"75.x.y.z\",\n                },\n            },\n        },\n    }\n    runErr := runAndRead(ctx, q)\n    log.Println(runErr)\n}\n</code></pre>\n"}, {"tags": ["go", "generate"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1572402289, "post_id": 58617849, "comment_id": 103545025, "body": "The arguments are specified in the <code>&#47;&#47;go:generate</code> comment.  If you need to specify the arguments on the command line, then it might be more appropriate to run the command directly than to use <code>go generate</code>."}, {"owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1572403268, "post_id": 58617849, "comment_id": 103545223, "body": "@CeriseLim&#243;n so if the arguments changes for every code generation the go:generate isn&#39;t a good option?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1572403877, "post_id": 58617849, "comment_id": 103545347, "body": "The <code>go generate</code> command is not a good option in this scenario.  What problem are you trying to solve by using <code>go generate</code> vs. running the command directly?"}, {"owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1572404225, "post_id": 58617849, "comment_id": 103545413, "body": "Whenever we introduce a new table in our system we have to write some boiler plate code in our existing files. That code is mainly a copy paste except that based on table name new variables are created."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1572404312, "post_id": 58617849, "comment_id": 103545430, "body": "OK, but what is the reason for using <code>go generate</code> instead of running the command directly?  What is the problem you are trying to solve."}, {"owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1572404425, "post_id": 58617849, "comment_id": 103545448, "body": "Was just going through <code>go generate</code> and thought I can use this to solve the problem. Currently I am using <code>make</code> file. I read through docs but couldn&#39;t find the solution so I posted here. I guess I have to stay with <code>make</code> file then."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1572444492, "post_id": 58617849, "comment_id": 103561881, "body": "If this only needs to run when you add a table, <code>go generate</code> seems like the wrong tool entirely; this should be a stand-alone executable. <code>go generate</code> is used for re-generatable code; e.g. anything where you&#39;d pull down the repo and run an initial build sequence of <code>go get;go generate;go build</code> to reproduce the generated files then build the project."}], "answers": [{"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": false, "score": 4, "last_activity_date": 1572413610, "creation_date": 1572413610, "answer_id": 58619285, "question_id": 58617849, "link": "https://stackoverflow.com/questions/58617849/how-to-pass-arguments-via-go-generate/58619285#58619285", "title": "How to pass arguments via go generate", "body": "<p>While I agree you may be better off using another solution, there isn't anything preventing usage of env vars (os specifics may vary) </p>\n\n<pre><code>\u279c  /tmp cat foo.go\n\npackage main\n\n//go:generate python run.py $ARG\n\nfunc main() {}\n</code></pre>\n\n<pre><code>\u279c  /tmp cat run.py\nimport sys\n\nprint sys.argv[1]\n</code></pre>\n\n<pre><code>\u279c  /tmp ARG=poop go generate foo.go\npoop\n</code></pre>\n"}], "owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 664, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1572413610, "creation_date": 1572401740, "question_id": 58617849, "link": "https://stackoverflow.com/questions/58617849/how-to-pass-arguments-via-go-generate", "title": "How to pass arguments via go generate", "body": "<p>Here is how my project is structure</p>\n\n<pre><code>\u251c\u2500\u2500 cmd\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 orders\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 scripts\n    \u2514\u2500\u2500 codegenerator.go\n</code></pre>\n\n<p>the <code>codegenerator.go</code> file is the file where i have put my code to generate the code. Here is the logic for <code>codegenerator.go</code></p>\n\n<ul>\n<li>rename <code>main.go</code> to <code>old_main.go</code></li>\n<li>read from <code>old_main.go</code> line by line and write to a new file called <code>main.go</code></li>\n<li>insert new lines/code blocks based on markers/placeholder in <code>main.go</code></li>\n<li>remove <code>old_main.go</code> file</li>\n</ul>\n\n<p>The <code>go:generate</code> directive is in <code>main.go</code> like this</p>\n\n<pre><code>//go:generate go run ../../scripts/codegenerator.go\n</code></pre>\n\n<p>I ran <code>go generate</code> from command line and wanted to pass in 3 arguments so that they can be utilized in <code>codegenerator.go</code>. here is my command and the errors i got (i executed this command on path <code>cmd/orders</code>)</p>\n\n<pre><code> $ go generate arg_one arg_two arg_three\ncan't load package: package arg_one: unknown import path \"arg_one\": cannot find module providing package arg_one\ncan't load package: package arg_two: unknown import path \"arg_two\": cannot find module providing package arg_two\ncan't load package: package arg_three: unknown import path \"arg_three\": cannot find module providing package arg_three\n</code></pre>\n\n<p>So the questions are</p>\n\n<ol>\n<li>Am i running <code>go generate</code> properly? </li>\n<li>How can i pass in arguments from <code>go generate</code> command line to the target script</li>\n</ol>\n"}, {"tags": ["json", "go", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 7401746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4edd9cbd96deeaebdc9682159615129f?s=128&d=identicon&r=PG&f=1", "display_name": "GeoWork", "link": "https://stackoverflow.com/users/7401746/geowork"}, "edited": false, "score": 0, "creation_date": 1572414023, "post_id": 58617776, "comment_id": 103547357, "body": "Thankyou, although not a solution in itself this led me to the correct answer and, I hope, improved my practice with bufio.Readers and error handling."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1572414308, "last_edit_date": 1572414308, "creation_date": 1572401074, "answer_id": 58617776, "question_id": 58617697, "link": "https://stackoverflow.com/questions/58617697/in-golang-json-unmarshal-works-in-playground-copy-pasted-json-but-not-in-actua/58617776#58617776", "title": "In golang json.Unmarshal() works in playground/copy pasted JSON but not in actual code", "body": "<p>The io_func function creates and discards a bufio.Reader and data the reader may have buffered. If the application calls io_func more than once, then the application may be discarding data read from the network. Fix by creating a single bufio.Reader outside the function and pass that single reader to each invocation of io_func.</p>\n\n<p>Always check and handle errors. The error returned from any of these functions may point you in the right direction for a fix.</p>\n\n<pre><code>func io_func(r *bufio.Reader, conn net.Conn, cmd string) (string, error) {\n    fmt.Fprintf(conn, cmd+\"\\n\")\n    header, err := r.ReadString('\\n')\n    if err != nil {\n        return \"\", err\n    }\n    if header == \"SUCCESS\\n\" {\n        return r.ReadString('\\n')\n    }\n    return \"\", nil\n}\n\n\n...\n\nr := bufio.NewReader(conn)\n\nbody, err := io_func(r, conn, cmd)\nif err != nil {\n    // handle error\n}\nvar obvs []Json_out\nerr = json.Unmarshal([]byte(body), &amp;obvs)\nif err != nil {\n    // handle error\n}\nfmt.Println(body)\nfmt.Println(obvs)\n\n// read next \nbody, err = io_func(r, conn, cmd)\nif err != nil {\n    // handle error\n}\n</code></pre>\n\n<p>The application uses newline to terminate the JSON body, but newline is valid whitespace in JSON.  If the peer includes a newline in the JSON, then the application will read a partial message.</p>\n"}, {"tags": [], "owner": {"reputation": 15, "user_id": 7401746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4edd9cbd96deeaebdc9682159615129f?s=128&d=identicon&r=PG&f=1", "display_name": "GeoWork", "link": "https://stackoverflow.com/users/7401746/geowork"}, "is_accepted": true, "score": 0, "last_activity_date": 1572413936, "creation_date": 1572413936, "answer_id": 58619317, "question_id": 58617697, "link": "https://stackoverflow.com/questions/58617697/in-golang-json-unmarshal-works-in-playground-copy-pasted-json-but-not-in-actua/58619317#58619317", "title": "In golang json.Unmarshal() works in playground/copy pasted JSON but not in actual code", "body": "<p>Following Cerise Lim\u00f3n's advice to properly handle error messages I determined the <code>osm_id</code> value in the JSON was being parsed by <code>json.Unmarshall</code> as number when taking the string from <code>io_func()</code>, although it wasn't doing so when the string was passed in manually in the playground example. Although I don't understand why this is so I would have picked it up with proper error handling.</p>\n\n<p>I altered barefoot code to return the <code>osm_id</code> explicitly in inverted commas since, although only ever composed of digits, I only use it as a string. It now works as expected. Equally I could have changed the type in the struct and convert in Go as needed. </p>\n"}], "owner": {"reputation": 15, "user_id": 7401746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4edd9cbd96deeaebdc9682159615129f?s=128&d=identicon&r=PG&f=1", "display_name": "GeoWork", "link": "https://stackoverflow.com/users/7401746/geowork"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 58619317, "answer_count": 2, "score": -1, "last_activity_date": 1572414308, "creation_date": 1572400259, "last_edit_date": 1572414139, "question_id": 58617697, "link": "https://stackoverflow.com/questions/58617697/in-golang-json-unmarshal-works-in-playground-copy-pasted-json-but-not-in-actua", "title": "In golang json.Unmarshal() works in playground/copy pasted JSON but not in actual code", "body": "<p>I am writing a program in Golang that interfaces with a modified version of the <a href=\"https://github.com/bmwcarit/barefoot\" rel=\"nofollow noreferrer\">barefoot</a> mapmatching library which returns results in json via netcat.</p>\n\n<p>My in my actual code <code>json.Unmarshal</code> will only parse the response to the nil value of the struct. But if print the json to console (see code snippet below) and <a href=\"https://play.golang.org/p/GapXP59kr-n\" rel=\"nofollow noreferrer\">copy paste into goplayground</a> it behaves as expected. </p>\n\n<p>I am wondering if this is an encoding issue that is bypassed when I copy paste from the console as a result.</p>\n\n<p>How do I get my code to process the same string as it is received from barefoot as when it is copy pasted from the console?</p>\n\n<p>Here is the relevant code snippet (structs are identical to goplayground)</p>\n\n<pre><code>body := io_func(conn, cmd)\n    var obvs []Json_out\n    json.Unmarshal([]byte(body), &amp;obvs)\n    fmt.Println(body)\n    fmt.Println(obvs)\n</code></pre>\n\n<p>and <code>io_func()</code> if relevant (the response is two lines, with a message on the first and a json string on the second)</p>\n\n<pre><code>func io_func(conn net.Conn, cmd string) string {\n    fmt.Fprintf(conn, cmd+\"\\n\")\n    r := bufio.NewReader(conn)\n    header, _ := r.ReadString('\\n')\n    if header == \"SUCCESS\\n\" {\n        resp, _ := r.ReadString('\\n')\n    return resp\n    } else {\n        return \"\"\n    }\n\n}\n</code></pre>\n"}, {"tags": ["azure", "google-app-engine", "go"], "comments": [{"owner": {"reputation": 2524, "user_id": 12163240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/434d7a72dcc252ef7b46e8b5efd2a792?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Ocando", "link": "https://stackoverflow.com/users/12163240/daniel-ocando"}, "edited": false, "score": 0, "creation_date": 1572433966, "post_id": 58616406, "comment_id": 103555937, "body": "Sorry, but I don&#39;t really understand your question. Do you have a Go application on Google Cloud Platform and you want to call its API or do you have an API outside of Google Cloud and you want to call it from newly created Go App engine?"}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "reply_to_user": {"reputation": 2524, "user_id": 12163240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/434d7a72dcc252ef7b46e8b5efd2a792?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Ocando", "link": "https://stackoverflow.com/users/12163240/daniel-ocando"}, "edited": false, "score": 0, "creation_date": 1572438294, "post_id": 58616406, "comment_id": 103558208, "body": "Hey ! My goal would be to rewrite my API in go (done) and publish it to google cloud platform. I newly created my app engine and tried gcloud app deploy . I am now looking to reach my API but no success.. so I look for anything that can help me to monitor or debug what is happening (such as logs?)"}], "answers": [{"comments": [{"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1572446311, "post_id": 58627519, "comment_id": 103563014, "body": "Hey ! Thanks for your answer. As mentioned in my Edit 1, I am already looking at these panel to monitor, but I don&#39;t get logs. It just appears sometimes when I deploy my app but that&#39;s it"}, {"owner": {"reputation": 1591, "user_id": 10053276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/831841800157687a198362eb5eface93?s=128&d=identicon&r=PG", "display_name": "Methkal Khalawi", "link": "https://stackoverflow.com/users/10053276/methkal-khalawi"}, "reply_to_user": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1572447202, "post_id": 58627519, "comment_id": 103563601, "body": "please, keep monitoring and get back to me tomorrow. I will help you further with this. if this keep persisting, you open a support ticket &quot;<a href=\"https://cloud.google.com/support/\" rel=\"nofollow noreferrer\">cloud.google.com/support</a>&quot; and they will give you more details on the issue."}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1572448327, "post_id": 58627519, "comment_id": 103564294, "body": "I am already trying to monitor since 2 days.. I tried to contact the support so I am waiting for them to come back to me. In the meantime, I will keep digging.."}, {"owner": {"reputation": 1591, "user_id": 10053276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/831841800157687a198362eb5eface93?s=128&d=identicon&r=PG", "display_name": "Methkal Khalawi", "link": "https://stackoverflow.com/users/10053276/methkal-khalawi"}, "reply_to_user": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1572449044, "post_id": 58627519, "comment_id": 103564668, "body": "please, let me know if they update you on something. I&#39;m interested in this issue."}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1572449091, "post_id": 58627519, "comment_id": 103564700, "body": "Will do ! And I am going to edit my question as well"}], "tags": [], "owner": {"reputation": 1591, "user_id": 10053276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/831841800157687a198362eb5eface93?s=128&d=identicon&r=PG", "display_name": "Methkal Khalawi", "link": "https://stackoverflow.com/users/10053276/methkal-khalawi"}, "is_accepted": false, "score": 0, "last_activity_date": 1572445383, "creation_date": 1572445383, "answer_id": 58627519, "question_id": 58616406, "link": "https://stackoverflow.com/questions/58616406/issues-while-moving-from-azure-to-google-cloud-service/58627519#58627519", "title": "Issues while moving from Azure to Google Cloud Service", "body": "<p>Google Cloud offers many ways to debug and monitor your application such as <a href=\"https://cloud.google.com/logging/docs/quickstart-sdk\" rel=\"nofollow noreferrer\">Stackdriver logging</a> where you monitor, debug and filter  the activity of your app. <a href=\"https://cloud.google.com/logging/docs/view/overview\" rel=\"nofollow noreferrer\">You can view logs and even export them</a>. Google Cloud also offers <a href=\"https://cloud.google.com/monitoring/docs/how-to\" rel=\"nofollow noreferrer\">Stackdriver monitoring</a> to make uptime checks of your system, alerting policies, chart for any metrics with metric explorer. add to that you can even create your own custom metrics yo use in Stackdriver monitoring.</p>\n"}], "owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1572967553, "creation_date": 1572389196, "last_edit_date": 1572967553, "question_id": 58616406, "link": "https://stackoverflow.com/questions/58616406/issues-while-moving-from-azure-to-google-cloud-service", "title": "Issues while moving from Azure to Google Cloud Service", "body": "<p>Based on my searches, I created a Project and deployed a couple of services following that link: <a href=\"https://codelabs.developers.google.com/codelabs/cloud-app-engine-go/index.html?index=..%2F..index#0\" rel=\"nofollow noreferrer\">https://codelabs.developers.google.com/codelabs/cloud-app-engine-go/index.html?index=..%2F..index#0</a></p>\n\n<p>After a lot of struggle I could deploy but now I am not even sure that an app is really running somewhere as I have no log at all (I didn\u2019t find any at least, just one telling <code>2019-10-29T21:56:21.890Z App Engine UpdateService users-service john.doe@email.com .........</code>), I haven\u2019t find any metrics, and I can\u2019t reach my API..</p>\n\n<p>My API currently defines 2 ports (gRPC &amp; REST), so I tried to ping the given address, adding port and without it, but no success as I can\u2019t reach my service..</p>\n\n<p>I am literally stuck right now, I tried a couple of log libraries regarding Google Cloud documentation but nothing seems to work for me, everything stays empty.</p>\n\n<pre><code>- \"google.golang.org/appengine/log\"\n- \"cloud.google.com/go/logging\"\n- \"log\"\n</code></pre>\n\n<p>Back to work this morning, after an hour I tried to re deploy my service and I got my 3 first logs</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    ...\n)\n\nfunc main() {\n\n\n    log.Print(\"Users Service\")\n    log.Println(\"Users Service\")\n    log.Printf(\"Users Service\")\n\n    log.Fatal(\"Heyyyyyyy\")\n\n//...\n</code></pre>\n\n<p>I edited my code, I added a print a bit later on in my main and re deploy. Now I don't have the first logs anymore.. It seems like I can log sometimes, but then, it stops working for a while and come back. Any idea?</p>\n\n<p>I tried to update my print function, still no success:</p>\n\n<pre><code>// appengineLog is actually the official package but I renamed it to use both \"log\" and \"appengine/log\"\n// import appengineLog \"google.golang.org/appengine/log\"\n\nfunc print(v string) {\n    log.Print(v)\n    log.Println(v)\n    log.Printf(\"%s\", v)\n    ctx, _ := context.WithTimeout(context.Background(), 2*time.Second)\n    appengineLog.Infof(ctx, \"%s\", v)\n    appengineLog.Debugf(ctx, \"%s\", v)\n    appengineLog.Errorf(ctx, \"%s\", v)\n    appengineLog.Warningf(ctx, \"%s\", v)\n    appengineLog.Criticalf(ctx, \"%s\", v)\n}\n\nfunc main() {\n    print(\"test\")\n    // ...\n}\n</code></pre>\n\n<p>The weird point is that I am getting <code>2019-10-29T21:56:21.890Z App Engine UpdateService users-service john.doe@email.com .........</code> messages for each deploy, so it means (to me) that my service got deployed so it should get started and print. The print is at the first line of my main so..</p>\n\n<h1>EDIT</h1>\n\n<p>As I am moving from Monolith to Microservices, I opted for Google Compute Engine which seems more appropriate for such deployment :)</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1572392849, "post_id": 58616204, "comment_id": 103543203, "body": "This may not be the problem, but an application should create a single client and reuse it.   It looks like the application creates a client per request based on the code in the question.  If the application does create a client per request, then the application must close the client."}, {"owner": {"reputation": 11, "user_id": 10200389, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VOm7Wdr22Ow/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qdbBCWrkkeBp4V-B3kgLlaIj1Z7A/mo/photo.jpg?sz=128", "display_name": "Jen Carlile", "link": "https://stackoverflow.com/users/10200389/jen-carlile"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1572398751, "post_id": 58616204, "comment_id": 103544354, "body": "thanks for that tip. It didn&#39;t address my problem about datastore calls hanging, but it will clean up my code."}, {"owner": {"reputation": 11647, "user_id": 507950, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0dabb66f0e0b88d90ccd9d0936e96f0e?s=128&d=identicon&r=PG", "display_name": "dodgy_coder", "link": "https://stackoverflow.com/users/507950/dodgy-coder"}, "edited": false, "score": 0, "creation_date": 1572674669, "post_id": 58616204, "comment_id": 103639776, "body": "Have you also changed the main() function to remove the appEngine.Main() call and replace it with http.ListenAndServe(..) as documented here - <a href=\"https://cloud.google.com/appengine/docs/standard/go112/building-app/\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/standard/go112/building-app</a> ?"}, {"owner": {"reputation": 11, "user_id": 10200389, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VOm7Wdr22Ow/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qdbBCWrkkeBp4V-B3kgLlaIj1Z7A/mo/photo.jpg?sz=128", "display_name": "Jen Carlile", "link": "https://stackoverflow.com/users/10200389/jen-carlile"}, "edited": false, "score": 0, "creation_date": 1572896196, "post_id": 58616204, "comment_id": 103696022, "body": "So, I think the issue was actually a stray, erroneous environment variable that was being set -- <code>export USE_DATASTORE_EMULATOR=true</code> -- that I believe was causing the connection error.  I&#39;m not 100% sure, but I think this was the culprit"}], "owner": {"reputation": 11, "user_id": 10200389, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VOm7Wdr22Ow/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qdbBCWrkkeBp4V-B3kgLlaIj1Z7A/mo/photo.jpg?sz=128", "display_name": "Jen Carlile", "link": "https://stackoverflow.com/users/10200389/jen-carlile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1572387758, "creation_date": 1572387758, "question_id": 58616204, "link": "https://stackoverflow.com/questions/58616204/issue-connecting-to-gcp-datastore-after-upgrading-appengine-from-golang-1-9-to-1", "title": "Issue connecting to GCP Datastore after upgrading AppEngine from golang 1.9 to 1.12", "body": "<p>I am in the process of upgrading my golang AppEngine app from Go v1.9 to Go v1.12.  As part of that, I'm replacing the appengine specific packages for accessing the datastore with the standard GCP datastore client library.</p>\n\n<p>Now when I run my code, any call to get or set data in the datastore hangs with no error.  In a debugging attempt I added a timeout to the context; when the request times out I get the error <code>\"latest connection error: connection error: desc = \"transport: Error while dialing dial tcp: address true: missing port in address\"</code></p>\n\n<p>I thought it might be an issue with needing to create a service account, so I followed the steps here: <a href=\"https://cloud.google.com/datastore/docs/reference/libraries#client-libraries-install-go\" rel=\"nofollow noreferrer\">Datastore mode Client Libraries</a>, but that didn't solve the problem.  I also tried calling <code>gcloud auth activate-service-account --key-file google-creds.json</code> from the command line, but it also seemed to have no effect.</p>\n\n<p>Any ideas what I'm doing wrong?  Here's a snippet of accessing the datastore from the application</p>\n\n<pre><code>client, err := datastore.NewClient(tctx, \"my-project-id\")\nif err != nil {\n    log.Panic(\"Error creating datastore client: \", err)\n}\nq = datastore.NewQuery(\"Project\").Order(\"-LastUpdated\")\n_, err := client.GetAll(tctx, q, &amp;projects)\nif err != nil {\n    log.Panicf(\"Error getting all projects: %v\", err)\n    return\n}\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "kubernetes-helm"], "comments": [{"owner": {"reputation": 2040, "user_id": 1192744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1a9fd94a1ff240fe0070546b49a7598?s=128&d=identicon&r=PG", "display_name": "LiquidPony", "link": "https://stackoverflow.com/users/1192744/liquidpony"}, "edited": false, "score": 0, "creation_date": 1572383634, "post_id": 58614929, "comment_id": 103540786, "body": "You do not need to escape the <code>@</code>.  Might be helpful to post the relevant sections of your <code>values.yaml</code> and <code>configmap.yaml</code> because what you&#39;ve posted so far should not result in an error."}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1572391844, "post_id": 58614929, "comment_id": 103542975, "body": "In the error message you quote, it looks like there&#39;s a newline after the <code>{{</code>.  Can you double-check that in your YAML file?"}, {"owner": {"reputation": 2051, "user_id": 1292036, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e456c41f1778dae481209d09889030ca?s=128&d=identicon&r=PG", "display_name": "leeman24", "link": "https://stackoverflow.com/users/1292036/leeman24"}, "reply_to_user": {"reputation": 2040, "user_id": 1192744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1a9fd94a1ff240fe0070546b49a7598?s=128&d=identicon&r=PG", "display_name": "LiquidPony", "link": "https://stackoverflow.com/users/1192744/liquidpony"}, "edited": false, "score": 0, "creation_date": 1572442316, "post_id": 58614929, "comment_id": 103560595, "body": "@LiquidPony, I have added the <code>values.yaml</code> snippet."}, {"owner": {"reputation": 2051, "user_id": 1292036, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e456c41f1778dae481209d09889030ca?s=128&d=identicon&r=PG", "display_name": "leeman24", "link": "https://stackoverflow.com/users/1292036/leeman24"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1572443620, "post_id": 58614929, "comment_id": 103561345, "body": "@DavidMaze, interesting. I didn&#39;t have a newline in the line I wanted substituted, but I did have a comment above and when I removed it, it started to work. <code># {{ .Values.env.INGRESS_CONTROLLER_ENDPOINT }} TEST this </code>"}, {"owner": {"reputation": 2051, "user_id": 1292036, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e456c41f1778dae481209d09889030ca?s=128&d=identicon&r=PG", "display_name": "leeman24", "link": "https://stackoverflow.com/users/1292036/leeman24"}, "edited": false, "score": 0, "creation_date": 1572448395, "post_id": 58614929, "comment_id": 103564330, "body": "This is what ended up working - <code>CELERY_BROKER_URL = &quot;amqp:&#47;&#47;{{.Values.env.RABBITMQ_USER}}:{{.Values.env.RABBITMQ&zwnj;&#8203;_PASSWORD}}@{{.Value&zwnj;&#8203;s.env.RABBITMQ_HOST}&zwnj;&#8203;}:{{.Values.env.RABB&zwnj;&#8203;ITMQ_PORT}}&#47;&quot;</code> I removed the spaces in between <code>{{</code> and <code>}}</code>."}, {"owner": {"reputation": 4058, "user_id": 9928809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5e7fd6b31a4a41febaef7ff868edc57?s=128&d=identicon&r=PG&f=1", "display_name": "Nick_Kh", "link": "https://stackoverflow.com/users/9928809/nick-kh"}, "edited": false, "score": 0, "creation_date": 1572507295, "post_id": 58614929, "comment_id": 103583279, "body": "@leeman24, Can you elaborate and finalize your solution research within an answer below?"}], "answers": [{"comments": [{"owner": {"reputation": 2051, "user_id": 1292036, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e456c41f1778dae481209d09889030ca?s=128&d=identicon&r=PG", "display_name": "leeman24", "link": "https://stackoverflow.com/users/1292036/leeman24"}, "edited": false, "score": 0, "creation_date": 1572532618, "post_id": 58645676, "comment_id": 103596378, "body": "I am not 100% sure why helm didn&#39;t like the spaces between curly braces but wanted to post an answer. If someone could comment on that, i&#39;m sure it&#39;ll be helpful for myself and others."}], "tags": [], "owner": {"reputation": 2051, "user_id": 1292036, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e456c41f1778dae481209d09889030ca?s=128&d=identicon&r=PG", "display_name": "leeman24", "link": "https://stackoverflow.com/users/1292036/leeman24"}, "is_accepted": false, "score": 2, "last_activity_date": 1572532559, "creation_date": 1572532559, "answer_id": 58645676, "question_id": 58614929, "link": "https://stackoverflow.com/questions/58614929/substitute-values-in-string-without-spaces-in-helm-unexpected-unclosed-action/58645676#58645676", "title": "Substitute Values in String Without Spaces in Helm - unexpected unclosed action in command", "body": "<p>There are two things I had to change to get my configuration to work.</p>\n\n<p>The first issue was that I was using a yaml comments vs. a template comment which tried to get substituted when running <code>helm install</code> so I removed it completely. I should have been using {{- /* This is a comment. */ -}} according to the helm documentation instead of #.</p>\n\n<p>The second issue was with the spaces between the curly braces <code>{{</code> and <code>}}</code>.</p>\n\n<p>Before:</p>\n\n<pre><code>CELERY_BROKER_URL = \"amqp://{{ .Values.env.RABBITMQ_USER }}:{{ .Values.env.RABBITMQ_PASSWORD }}@{{ .Values.env.RABBITMQ_HOST }}:{{ .Values.env.RABBITMQ_PORT }}/\"\n</code></pre>\n\n<p>After (working):</p>\n\n<pre><code>CELERY_BROKER_URL = \"amqp://{{.Values.env.RABBITMQ_USER}}:{{.Values.env.RABBITMQ_PASSWORD}}@{{.Values.env.RABBITMQ_HOST}}:{{.Values.env.RABBITMQ_PORT}}/\"\n</code></pre>\n"}], "owner": {"reputation": 2051, "user_id": 1292036, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e456c41f1778dae481209d09889030ca?s=128&d=identicon&r=PG", "display_name": "leeman24", "link": "https://stackoverflow.com/users/1292036/leeman24"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 954, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1572532559, "creation_date": 1572380834, "last_edit_date": 1572442292, "question_id": 58614929, "link": "https://stackoverflow.com/questions/58614929/substitute-values-in-string-without-spaces-in-helm-unexpected-unclosed-action", "title": "Substitute Values in String Without Spaces in Helm - unexpected unclosed action in command", "body": "<p>Right now, I am using helm to substitute variables in a file using values from my <code>values.yaml</code> file to create a ConfigMap which is working well for entries that are spaced correctly.</p>\n\n<p>I am having a problem with the following:</p>\n\n<pre><code>CELERY_BROKER_URL = \"amqp://admin:admin@{{ .Values.env.RABBITMQ_HOST }}:5672/\"\n</code></pre>\n\n<p>Results in this error when running <code>helm install</code>:</p>\n\n<pre><code>Error: render error in \"mynamespace-nonprod-chart/templates/configmap.yaml\": template: mynamespace-nonprod-chart/templates/configmap.yaml:10:4: executing \"mynamespace-nonprod-chart/templates/configmap.yaml\" at &lt;tpl (.Files.Glob \"conf/*\").AsConfig .&gt;: error calling tpl: Error during tpl function execution for \"settings.py: \\\"\\\\\\\"\\\\\\\"\\\\\\\"\\\\nDjango settings for imagegateway project.\\\\n\\\\nGenerated by 'django-admin\\n  startproject' using Django 1.11.3.\\\\n\\\\nFor more information on this file, see\\\\nhttps://docs.djangoproject.com/en/1.11/topics/settings/\\\\n\\\\nFor\\n  the full list of settings and their values, see\\\\nhttps://docs.djangoproject.com/en/1.11/ref/settings/\\\\n\\\\\\\"\\\\\\\"\\\\\\\"\\\\n\\\\nimport\\n  os\\\\n\\\\nfrom kombu import Exchange, Queue\\\\n\\\\n\\\\n# Image Config\\\\nIMAGE_ASPECT_RATIO\\n  = (4,3) # 4:3\\\\nMLS_BASE_URL = 'http://www.torontomls.net/MLSMULTIPHOTOS/FULL'\\\\nCALLBACK_KEY\\n  = 'SECRET'\\\\n\\\\nBASE_URL = 'https://media-dev.mydomain.ca'\\\\n\\\\n#\\n  Build paths inside the project like this: os.path.join(BASE_DIR, ...)\\\\nBASE_DIR\\n  = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\\\\n\\\\nMAXIMUM_HASH_DISTANCE\\n  = 5\\\\n\\\\n# SECURITY WARNING: keep the secret key used in production secret!\\\\nSECRET_KEY\\n  = 'mysecretkey'\\\\n\\\\n# SECURITY WARNING: don't run with debug turned on in production!\\\\n#\\n  DEBUG = False\\\\nDEBUG = True\\\\n\\\\nALLOWED_HOSTS = ['0.0.0.0', '*']\\\\n\\\\n# Celery\\\\n\\\\n#\\n  {{ .Values.env.INGRESS_CONTROLLER_ENDPOINT }} TEST this\\\\nCELERY_BROKER_URL = \\\\\\\"amqp://admin:xWQ7ye7YotNif@{{\\n  .Values.env.RABBITMQ_HOST }}:5672/\\\\\\\"\\\\nCELERY_ACCEPT_CONTENT = ['application/json']\\\\nCELERY_TASK_SERIALIZER\\n  = 'json'\\\\nCELERY_RESULT_SERIALIZER = 'json'\\\\nCELERY_RESULT_BACKEND = 'redis://dummyuser:R3dis0nEKS!@redis-imagegateway-dev-shared-headless'\\\\nCELERY_RESULT_PERSISTENT\\n  = False\\\\nCELERY_TIMEZONE = 'Canada/Eastern'\\\\nCELERY_ALWAYS_EAGER = False  \\\\nCELERY_ACKS_LATE\\n  = True  \\\\nCELERYD_PREFETCH_MULTIPLIER = 1\\\\nCELERY_TASK_PUBLISH_RETRY = True  \\\\nCELERY_DISABLE_RATE_LIMITS\\n  = False\\\\nCELERY_IMPORTS = ('garden.tasks', 'keeper.tasks', 'tourist.tasks',)\\\\nCELERY_DEFAULT_QUEUE\\n  = 'default'\\\\nCELERY_DEFAULT_EXCHANGE_TYPE = 'topic'\\\\nCELERY_DEFAULT_ROUTING_KEY\\n  = 'default'\\\\nCELERYD_TASK_SOFT_TIME_LIMIT = 60\\\\n\\\\nCELERY_TASK_QUEUES = (\\\\n    Queue('tourist',\\n  Exchange('tourist'), routing_key='tourist.#', queue_arguments={'x-max-priority':\\n  1}),\\\\n    Queue('default', Exchange('default'), routing_key='default', queue_arguments={'x-max-priority':\\n  5}),\\\\n    Queue('garden', Exchange('garden'), routing_key='garden.#', queue_arguments={'x-max-priority':\\n  10}),\\\\n    Queue('keeper', Exchange('keeper'), routing_key='keeper.#', queue_arguments={'x-max-priority':\\n  10}),\\\\n)\\\\n\\\\nCELERY_TASK_ROUTES = {\\\\n     'garden.tasks.fetch_mls_image' : {'queue':\\n  'garden'},\\\\n     'garden.tasks.save_image' : {'queue': 'garden'},\\\\n     'garden.tasks.do_callback'\\n  : {'queue': 'garden'},\\\\n     'garden.tasks.clear_cloudflare_cache' : {'queue': 'garden'},\\\\n\\n  \\\\    'tourist.tasks.get_fetcher' : {'queue': 'tourist'},\\\\n     'tourist.tasks.get_tour_urls'\\n  : {'queue': 'tourist'},\\\\n     'tourist.tasks.download_tour_images' : {'queue': 'tourist'},\\\\n\\n  \\\\    'tourist.tasks.smallest_image_size' : {'queue': 'tourist'},\\\\n     'tourist.tasks.hash_and_compare'\\n  : {'queue': 'tourist'},\\\\n     'tourist.tasks.process_tours' : {'queue': 'tourist'},\\\\n\\n  \\\\    'tourist.tasks.all_done' : {'queue': 'tourist'},\\\\n     'tourist.tasks.save_hd_images'\\n  : {'queue': 'tourist'},\\\\n     'keeper.tasks.create_sizes' : {'queue': 'keeper'},\\\\n\\n  \\\\    'celery_tasks.debug_task': {'queue': 'default'},\\\\n}\\\\n\\\\n# Application definition\\\\n\\\\nINSTALLED_APPS\\n  = [\\\\n    # Project\\\\n    'celery',\\\\n    'garden', # deals with retrieval of images\\\\n\\n  \\\\   'keeper', # deals with resizing and image processing tasks\\\\n    'tourist', #\\n  deals with virtual tours\\\\n    # Vendor Packages\\\\n    'djangocms_admin_style',\\\\n\\n  \\\\   # Django\\\\n    'django.contrib.admin',\\\\n    'django.contrib.auth',\\\\n    'django.contrib.contenttypes',\\\\n\\n  \\\\   'django.contrib.sessions',\\\\n    'django.contrib.messages',\\\\n    'django.contrib.staticfiles',\\\\n]\\\\n\\\\nMIDDLEWARE\\n  = [\\\\n    'django.middleware.security.SecurityMiddleware',\\\\n    'django.contrib.sessions.middleware.SessionMiddleware',\\\\n\\n  \\\\   'django.middleware.common.CommonMiddleware',\\\\n    'django.middleware.csrf.CsrfViewMiddleware',\\\\n\\n  \\\\   'django.contrib.auth.middleware.AuthenticationMiddleware',\\\\n    'django.contrib.messages.middleware.MessageMiddleware',\\\\n\\n  \\\\   'django.middleware.clickjacking.XFrameOptionsMiddleware',\\\\n]\\\\n\\\\nROOT_URLCONF\\n  = 'imagegateway.urls'\\\\n\\\\nTEMPLATES = [\\\\n    {\\\\n        'BACKEND': 'django.template.backends.django.DjangoTemplates',\\\\n\\n  \\\\       'DIRS': ['templates'],\\\\n        'APP_DIRS': True,\\\\n        'OPTIONS': {\\\\n\\n  \\\\           'context_processors': [\\\\n                'django.template.context_processors.debug',\\\\n\\n  \\\\               'django.template.context_processors.request',\\\\n                'django.contrib.auth.context_processors.auth',\\\\n\\n  \\\\               'django.contrib.messages.context_processors.messages',\\\\n            ],\\\\n\\n  \\\\       },\\\\n    },\\\\n]\\\\n\\\\nWSGI_APPLICATION = 'imagegateway.wsgi.application'\\\\n\\\\n\\\\n#\\n  Database\\\\n\\\\nDATABASES = {\\\\n    'default': {\\\\n        'ENGINE': 'django.db.backends.postgresql',\\\\n\\n  \\\\       'NAME': 'imagegateway',\\\\n        'USER': 'postgres',\\\\n        'PASSWORD':\\n  'PostGresQL123',\\\\n        'HOST': 'postgresql-imagegateway-dev-shared-headless',\\\\n\\n  \\\\       'PORT': 5432,\\\\n    }\\\\n}\\\\n\\\\n\\\\n# Password validation\\\\n\\\\nAUTH_PASSWORD_VALIDATORS\\n  = [\\\\n    {\\\\n        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',\\\\n\\n  \\\\   },\\\\n    {\\\\n        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',\\\\n\\n  \\\\   },\\\\n    {\\\\n        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',\\\\n\\n  \\\\   },\\\\n    {\\\\n        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',\\\\n\\n  \\\\   },\\\\n]\\\\n\\\\n\\\\n# Internationalization\\\\n\\\\nLANGUAGE_CODE = 'en-us'\\\\n\\\\nTIME_ZONE =\\n  'UTC'\\\\n\\\\nUSE_I18N = True\\\\n\\\\nUSE_L10N = True\\\\n\\\\nUSE_TZ = True\\\\n\\\\n\\\\n# Static files\\n  (CSS, JavaScript, Images)\\\\n\\\\nSTATIC_URL = '/static/'\\\\nSTATIC_ROOT = os.path.join(BASE_DIR,\\n  'static/')\\\\n\\\\n\\\\n# Media files (Images)\\\\n\\\\nMEDIA_URL = '/media/'\\\\n\\\\n# Controls whether\\n  Keras and backend is imported every server restart to improve restart times\\\\n# Only\\n  set the first bool!!! Then in production when DEBUG is set to false it will default\\n  to True.\\\\n# Example: \\\\n#    WITH_IMAGE_CLASSIFIER = True if DEBUG else True \\\\n#\\n  or WITH_IMAGE_CLASSIFIER = False if DEBUG else True\\\\nWITH_IMAGE_CLASSIFIER = True\\n  if DEBUG else True\\\\n\\\\n# 20MB\\\\nFILE_UPLOAD_MAX_MEMORY_SIZE = 20971520\\\\nDATA_UPLOAD_MAX_MEMORY_SIZE\\n  = 20971520\\\\n\\\\n# Cloudflare\\\\nCLOUDFLARE_API_URL = 'https://api.cloudflare.com/client/v4/'\\\\nCLOUDFLARE_API_KEY\\n  = ''\\\\nCLOUDFLARE_API_EMAIL = ''\\\\nCLOUDFLARE_ZONE_ID = ''\\\\n\\\"\\n\": parse error in \"mynamespace-nonprod-chart/templates/configmap.yaml\": template: mynamespace-nonprod-chart/templates/configmap.yaml:12: unexpected unclosed action in command\n</code></pre>\n\n<p>If I had set <code>env.RABBITMQ_HOST:rabbitmq.mydomain.com</code>, i'd expect the substituted value to be:</p>\n\n<pre><code>CELERY_BROKER_URL = \"amqp://admin:admin@rabbitmq.mydomain.com:5672/\"\n</code></pre>\n\n<p>Values:</p>\n\n<pre><code>useCustomApplicatonConfigs:\n  - mountPath: /var/www/html/django\n    type: py\n    name:\n      - settings\n\nenv:\n  CELERY_BROKER_URL: \"amqp://admin:xWQ7ye7YotNif@rabbitmq-imagegateway-dev-shared-headless:5672\"\n</code></pre>\n\n<p>Does anyone know the correct syntax for this? Do I need to escape the <code>@</code> or something?</p>\n\n<p>Edit: Added values section.</p>\n"}, {"tags": ["go", "streaming", "grpc"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1572380503, "post_id": 58614680, "comment_id": 103539521, "body": "You might want to use a real message queue, for example <a href=\"https://nats-io.github.io/docs/\" rel=\"nofollow noreferrer\">NATS</a> and <a href=\"https://nats-io.github.io/docs/developer/concepts/subjects.html\" rel=\"nofollow noreferrer\">subjects</a>"}, {"owner": {"reputation": 735, "user_id": 3133441, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/061b40f84ed127e36daadec671d60166?s=128&d=identicon&r=PG&f=1", "display_name": "ajtamwojtek", "link": "https://stackoverflow.com/users/3133441/ajtamwojtek"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1572382879, "post_id": 58614680, "comment_id": 103540496, "body": "Thank @MarkusWMahlberg. I agree that it would be better to use something more sophisticated but I still want to know do and don&#39;t of GRPC."}], "answers": [{"comments": [{"owner": {"reputation": 735, "user_id": 3133441, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/061b40f84ed127e36daadec671d60166?s=128&d=identicon&r=PG&f=1", "display_name": "ajtamwojtek", "link": "https://stackoverflow.com/users/3133441/ajtamwojtek"}, "edited": false, "score": 0, "creation_date": 1572382825, "post_id": 58614976, "comment_id": 103540470, "body": "Thanks, I did modify it a bit :) See my response."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 735, "user_id": 3133441, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/061b40f84ed127e36daadec671d60166?s=128&d=identicon&r=PG&f=1", "display_name": "ajtamwojtek", "link": "https://stackoverflow.com/users/3133441/ajtamwojtek"}, "edited": false, "score": 0, "creation_date": 1572382945, "post_id": 58614976, "comment_id": 103540529, "body": "Yours is racy. Also, to do that, you need to pass in a pointer receiver for EventsService."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1572381035, "creation_date": 1572381035, "answer_id": 58614976, "question_id": 58614680, "link": "https://stackoverflow.com/questions/58614680/how-to-create-server-for-persistent-stream-aka-pubsub-in-golang-grpc/58614976#58614976", "title": "How to create server for persistent stream (aka pubsub) in Golang GRPC", "body": "<p>The stream terminates when you return from the server function. Instead, you should receive events somehow, and send them to the client without returning from your server. There are probably many ways you can do this. Below is the sketch of one way of doing it.</p>\n\n<p>This relies on the server connection running on a separate goroutine. There is a Broadcast() function that will send messages to all connected clients. It looks like this:</p>\n\n<pre><code>var allRegisteredClients map[*pb.AgentProcess]chan Message\nvar clientsLock sync.RWMutex{}\n\nfunc Broadcast(msg Message) {\n  clientsLock.RLock()\n  for _,x:=range allRegisteredClients {\n      x&lt;-msg\n  }\n  clientsLock.RUnlock()\n}\n</code></pre>\n\n<p>Then, your clients have to register themselves, and process messages:</p>\n\n<pre><code>func (e EventsService) ListenForEvents(process *pb.AgentProcess, listener pb.EventsService_ListenForEventsServer) error {\n   clientsLock.Lock()\n   ch:=make(chan Message)\n   allRegisteredClients[process]=ch\n   clientsLock.Unlock()\n\n   for msg:=range ch {\n       // send message\n       // Deal with errors\n       // Deal with client terminations\n   }\n   clientsLock.Lock()\n   delete(allRegisteredClients,process)\n   clientsLock.Unlock()\n}\n</code></pre>\n\n<p>As I said, this is only a sketch of the idea.</p>\n"}, {"tags": [], "owner": {"reputation": 1733, "user_id": 10490857, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GA97O.jpg?s=128&g=1", "display_name": "Maxim", "link": "https://stackoverflow.com/users/10490857/maxim"}, "is_accepted": false, "score": 0, "last_activity_date": 1572382465, "creation_date": 1572382465, "answer_id": 58615286, "question_id": 58614680, "link": "https://stackoverflow.com/questions/58614680/how-to-create-server-for-persistent-stream-aka-pubsub-in-golang-grpc/58615286#58615286", "title": "How to create server for persistent stream (aka pubsub) in Golang GRPC", "body": "<p>You need to provide keepalive settings for grpc client and server</p>\n\n<ul>\n<li>See details here <a href=\"https://github.com/grpc/grpc/blob/master/doc/keepalive.md\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc/blob/master/doc/keepalive.md</a></li>\n<li>Examples <a href=\"https://github.com/grpc/grpc-go/tree/master/examples/features/keepalive\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc-go/tree/master/examples/features/keepalive</a></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 163, "user_id": 4227545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/52e478d8a6fc5120448c3b5229de3431?s=128&d=identicon&r=PG&f=1", "display_name": "deepg", "link": "https://stackoverflow.com/users/4227545/deepg"}, "edited": false, "score": 0, "creation_date": 1576896429, "post_id": 58615299, "comment_id": 105051897, "body": "Did this work out? how performant was this? didnt the connection break- since the connection can wait for a long time"}, {"owner": {"reputation": 112, "user_id": 5250103, "user_type": "registered", "profile_image": "https://graph.facebook.com/980441832000726/picture?type=large", "display_name": "Vinggui", "link": "https://stackoverflow.com/users/5250103/vinggui"}, "edited": false, "score": 0, "creation_date": 1591747380, "post_id": 58615299, "comment_id": 110172481, "body": "I need to reflect on this code to see if locks are not needed. Anyhow, it helped me constructing my code.  In my solution, I use longer deadlines and reconnection on the client side, to avoid other problems of indefinite calls."}], "tags": [], "owner": {"reputation": 735, "user_id": 3133441, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/061b40f84ed127e36daadec671d60166?s=128&d=identicon&r=PG&f=1", "display_name": "ajtamwojtek", "link": "https://stackoverflow.com/users/3133441/ajtamwojtek"}, "is_accepted": false, "score": 0, "last_activity_date": 1572382545, "creation_date": 1572382545, "answer_id": 58615299, "question_id": 58614680, "link": "https://stackoverflow.com/questions/58614680/how-to-create-server-for-persistent-stream-aka-pubsub-in-golang-grpc/58615299#58615299", "title": "How to create server for persistent stream (aka pubsub) in Golang GRPC", "body": "<p>I have managed to nail it down.</p>\n\n<p>Basically I never return from method <code>ListenForEvents</code>.\nIt creates channel, persists in global-like map of subscribed clients and keeps reading from that channel indefinitely.</p>\n\n<p>The whole implementation of server logic:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (e EventsService) ListenForEvents(process *pb.AgentProcess, listener pb.EventsService_ListenForEventsServer) error {\n    chans, exists := e.listeners[process.Hostname]\n\n    chanForThisClient := make(chan *pb.Event)\n\n    if !exists {\n        e.listeners[process.Hostname] = []chan *pb.Event{chanForThisClient}\n    } else {\n        e.listeners[process.Hostname] = append(chans, chanForThisClient)\n    }\n\n    for {\n        select {\n        case &lt;-listener.Context().Done():\n            return nil\n        case res := &lt;-chanForThisClient:\n            _ = listener.Send(res)\n        }\n    }\n\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 735, "user_id": 3133441, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/061b40f84ed127e36daadec671d60166?s=128&d=identicon&r=PG&f=1", "display_name": "ajtamwojtek", "link": "https://stackoverflow.com/users/3133441/ajtamwojtek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2292, "favorite_count": 1, "answer_count": 3, "score": 4, "last_activity_date": 1572382545, "creation_date": 1572379759, "last_edit_date": 1572381419, "question_id": 58614680, "link": "https://stackoverflow.com/questions/58614680/how-to-create-server-for-persistent-stream-aka-pubsub-in-golang-grpc", "title": "How to create server for persistent stream (aka pubsub) in Golang GRPC", "body": "<p>I am building service that needs to send events to all subscribed consumers in Pub/Sub manner eg. send one event to <strong>all currently connected clients</strong>.</p>\n\n<p>I am using Protobuf for that with the following proto definition:</p>\n\n<pre><code>service EventsService {\n  rpc ListenForEvents (AgentProcess) returns (stream Event) {}\n}\n</code></pre>\n\n<p>Both server &amp; client are written in Go.</p>\n\n<p>My problem is that when client initiates connection then the stream it is not long-lived, eg. when server returns from <code>ListenForEvents</code> method:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (e EventsService) ListenForEvents(process *pb.AgentProcess, listener pb.EventsService_ListenForEventsServer) error {\n    //persist listener here so it can be used later when backend needs to send some messages to client\n\n    return nil\n}\n</code></pre>\n\n<p>then the client almost instantly gets <code>EOF</code> error which means that server probably closed connection.</p>\n\n<p>What do I do so that the client is subscribed for a long time to the server? <strong>The main problem</strong> is that I might not have anything to send to the client when it calls <code>ListenForEvents</code> method on the server, this is why I want this stream <strong>to be long lived</strong> to be able to send messages later.</p>\n"}, {"tags": ["go", "devops", "influxdb", "logparser", "telegraf"], "comments": [{"owner": {"reputation": 41, "user_id": 10166122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc126b965d90e6ed8a7622dd28338e76?s=128&d=identicon&r=PG&f=1", "display_name": "tfalade", "link": "https://stackoverflow.com/users/10166122/tfalade"}, "edited": false, "score": 0, "creation_date": 1572554752, "post_id": 58614218, "comment_id": 103606711, "body": "When I changed the pattern to <code>%{SYSLOGTIMESTAMP:timestamp} %{HOSTNAME} (?&lt;prog&gt;multipathd?): (?&lt;message&gt;(.*(failed|failing|(remaining active paths)).*))</code> I was still able to match the first 2 log lines as expected, without matching the third log line. However, when I use this pattern inside inputs.logparser.grok, it still did not work, no input written to influxdb. Help PLEASE!"}], "answers": [{"tags": [], "owner": {"reputation": 54, "user_id": 3653254, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/poS6V.jpg?s=128&g=1", "display_name": "NikNye", "link": "https://stackoverflow.com/users/3653254/niknye"}, "is_accepted": false, "score": 0, "last_activity_date": 1573968661, "creation_date": 1573968661, "answer_id": 58897800, "question_id": 58614218, "link": "https://stackoverflow.com/questions/58614218/custom-pattern-to-filter-strings-when-using-telegraf-inputs-logparser-grok/58897800#58897800", "title": "custom pattern to filter strings when using telegraf inputs.logparser.grok", "body": "<p>If you run telegraf with the <code>--debug</code> flag, you will see that it is having an issue parsing the logs.</p>\n\n<pre><code>$ telegraf --debug --config ./telegraf.conf\n...\n2019-11-17T05:01:07Z D! Grok no match found for: \"Oct 29 03:29:03 dc-as-5p multipath: checker failed interface 8:0 in map 150gb\"\n2019-11-17T05:01:07Z D! Grok no match found for: \"Oct 29 03:29:03 dc-as-5p multipathd: checker failing interface 8:0 in map 150gb value=3\"\n2019-11-17T05:01:07Z D! Grok no match found for: \"Oct 29 03:26:03 dc-as-5p link: checker down remaining active paths interface 8:0 in map 150gb\"\n</code></pre>\n\n<p>This error message is misleading because, as your testing has shown, your regex pattern is correct.  The real issue is that you have not included a value to be logged in your regex.  </p>\n\n<p>A version of your regex to store the error message and timestamp might be:</p>\n\n<pre><code>    custom_patterns = '''FAIL_LOG %{SYSLOGTIMESTAMP:timestamp}.*(multipath).?: %{GREEDYDATA:message:string}'''\n</code></pre>\n\n<p>The value pattern can be found between <code>${}</code>.  Additional premade patterns can be found <a href=\"https://github.com/elastic/logstash/blob/v1.4.2/patterns/grok-patterns\" rel=\"nofollow noreferrer\">here</a>.  This will eliminate the first two errors above.  The results of these can be seen using the <code>--test</code> flag.</p>\n\n<pre><code>$telegraf --test --config ./telegraf.conf\n...\n&gt; logparser,host=pop-os,path=./test1 message=\"checker failed interface 8:0 in map 150gb\",timestamp=\"Oct 29 03:29:03 \" 1573968174161853621\n</code></pre>\n\n<p>For some reason the <code>--test</code> flag did not always output the results.  I would have to run the command multiple times before getting the above output.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 13815208, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GiNJRhDro5T15ApiIcys3i4by6oPthRyBZrJMWn=k-s128", "display_name": "Eric Clements", "link": "https://stackoverflow.com/users/13815208/eric-clements"}, "is_accepted": false, "score": 0, "last_activity_date": 1593116620, "creation_date": 1593116620, "answer_id": 62583749, "question_id": 58614218, "link": "https://stackoverflow.com/questions/58614218/custom-pattern-to-filter-strings-when-using-telegraf-inputs-logparser-grok/62583749#62583749", "title": "custom pattern to filter strings when using telegraf inputs.logparser.grok", "body": "<p>I summarised how I got custom log parsing in Telegraf/GROK to work in the following post: <a href=\"https://community.influxdata.com/t/custom-log-parsing-with-latest-tail-plugin-grok-and-influxdb-configuration-for-grafana/14986?u=eclements\" rel=\"nofollow noreferrer\">Custom log parsing with Telegraf/Tail Plugin/GROK</a>. Maybe it helps you or others debug similar problems.</p>\n<p>Maybe interessting for others reading this in 2020, that Telegraf's logparser is now replaced by the <a href=\"https://github.com/influxdata/telegraf/tree/master/plugins/inputs/tail\" rel=\"nofollow noreferrer\">Tail plugin</a>. Example in my post above.</p>\n<p>PS: My approach for your problem would be to not use regex at all, but to define three different patterns for each of the lines. This of course will only work if you have a low number of possible log errors/lines.</p>\n"}], "owner": {"reputation": 41, "user_id": 10166122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc126b965d90e6ed8a7622dd28338e76?s=128&d=identicon&r=PG&f=1", "display_name": "tfalade", "link": "https://stackoverflow.com/users/10166122/tfalade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2520, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1593116620, "creation_date": 1572377437, "last_edit_date": 1572537727, "question_id": 58614218, "link": "https://stackoverflow.com/questions/58614218/custom-pattern-to-filter-strings-when-using-telegraf-inputs-logparser-grok", "title": "custom pattern to filter strings when using telegraf inputs.logparser.grok", "body": "<p>I'm trying filter for particular words in a log file using regex, the goal is that any log line that matches the regex in custom_pattern will go into influxdb, log lines that do not match willbe ignored. When I tested the regex it works, even in golang playground (<a href=\"https://play.golang.org/p/_apzOVwwgl2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_apzOVwwgl2</a>). But when I use it in the telegraf conf file as it is below, it doesn't work, there's no input into influxdb. Is there something I'm missing that should added to the configuration?</p>\n\n<p>I've tested the regex on <a href=\"http://grokdebug.herokuapp.com/\" rel=\"nofollow noreferrer\">http://grokdebug.herokuapp.com/</a> and <a href=\"https://play.golang.org/p/_apzOVwwgl2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_apzOVwwgl2</a> it works but not in the  custom_patterns under [inputs.logparser.grok].</p>\n\n<p>Here is my grok config</p>\n\n<pre><code>[[inputs.logparser]]\n   files = [\"/var/log/test1\"]\n   from_beginning = true\n\n   [inputs.logparser.grok]\n      patterns = [\"%{FAIL_LOG}\"]\n      custom_patterns = '''FAIL_LOG ^.*?\\b(multipathd?)\\b.*?\\b(failed|failing|(remaining active paths))\\b.*?$'''\n</code></pre>\n\n<p>The pattern is supposed to match first 2 log lines like below and ignore the third line.</p>\n\n<pre><code>Oct 29 03:29:03 dc-as-5p multipath: checker failed interface 8:0 in map 150gb\nOct 29 03:29:03 dc-as-5p multipathd: checker failing interface 8:0 in map 150gb\nOct 29 03:26:03 dc-as-5p link: checker down remaining active paths interface 8:0 in map 150gb\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["mysql", "docker", "go"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 11774463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/978406904628ef419879d15e340fc7a1?s=128&d=identicon&r=PG&f=1", "display_name": "batboy", "link": "https://stackoverflow.com/users/11774463/batboy"}, "edited": false, "score": 0, "creation_date": 1572380052, "post_id": 58614443, "comment_id": 103539308, "body": "I changed `db, err = gorm.Open(&quot;mysql&quot;, &quot;user:pwd@(0.0.0.0:10000)/myDB?charset=utf8&amp;parseTime=true&quot;)&zwnj;&#8203;&#39; to &#39;db, err = gorm.Open(&quot;mysql&quot;, &quot;user:pwd@(db_private:10000)/myDB?charset=utf8&amp;parseTime=tru&zwnj;&#8203;e&quot;)&#39; but I still receive &#39;dial tcp 0.0.0.0:10000: connect: connection refused&#39;"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 63, "user_id": 11774463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/978406904628ef419879d15e340fc7a1?s=128&d=identicon&r=PG&f=1", "display_name": "batboy", "link": "https://stackoverflow.com/users/11774463/batboy"}, "edited": false, "score": 0, "creation_date": 1572382190, "post_id": 58614443, "comment_id": 103540242, "body": "Your code is still trying to connect to 0.0.0.0. Maybe something went wrong during image build? You&#39;re not running the changed program."}, {"owner": {"reputation": 63, "user_id": 11774463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/978406904628ef419879d15e340fc7a1?s=128&d=identicon&r=PG&f=1", "display_name": "batboy", "link": "https://stackoverflow.com/users/11774463/batboy"}, "edited": false, "score": 0, "creation_date": 1572385390, "post_id": 58614443, "comment_id": 103541369, "body": "I&#39;m doing docker system prune --volumes and then docker-compose build, am I missing something?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 63, "user_id": 11774463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/978406904628ef419879d15e340fc7a1?s=128&d=identicon&r=PG&f=1", "display_name": "batboy", "link": "https://stackoverflow.com/users/11774463/batboy"}, "edited": false, "score": 1, "creation_date": 1572406877, "post_id": 58614443, "comment_id": 103545905, "body": "One more thing: try db_private:3306, because that&#39;s the port open on the container. It is published as 10000 on the host."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 3, "last_activity_date": 1572378663, "creation_date": 1572378663, "answer_id": 58614443, "question_id": 58614060, "link": "https://stackoverflow.com/questions/58614060/cant-connect-to-mysql-container-from-golang-container/58614443#58614443", "title": "Can&#39;t connect to MySQL container from Golang container", "body": "<p>Your web app is running in a container, which means the address 0.0.0.0 is the container itself, not the host it is running on. Try connecting the db using <code>db_private</code> name instead of the address 0.0.0.0.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 14383459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c5b68acd18f14bdfc27f2e1ac7f33c0?s=128&d=identicon&r=PG&f=1", "display_name": "L&#253; Th&#224;nh Nh&#226;n", "link": "https://stackoverflow.com/users/14383459/l%c3%bd-th%c3%a0nh-nh%c3%a2n"}, "is_accepted": false, "score": 0, "last_activity_date": 1601710603, "last_edit_date": 1601710603, "creation_date": 1601706433, "answer_id": 64181370, "question_id": 58614060, "link": "https://stackoverflow.com/questions/58614060/cant-connect-to-mysql-container-from-golang-container/64181370#64181370", "title": "Can&#39;t connect to MySQL container from Golang container", "body": "<p>In my case, instead use <code>db_private</code> of Docker host, I get my local IP by running:</p>\n<p><code>ipconfig getifaddr en0</code> =&gt; 172.16.4.227</p>\n<p>Then I use this IP in my gorm SQL connection:</p>\n<pre><code>db, err = gorm.Open(&quot;mysql&quot;, &quot;user:pwd@(172.16.4.227:10000)/myDB?charset=utf8&amp;parseTime=true&quot;)\n</code></pre>\n<p>This worked for me</p>\n"}, {"tags": [], "owner": {"reputation": 3921, "user_id": 2061684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46ad823a3c12f55ee1103eeec268bc54?s=128&d=identicon&r=PG", "display_name": "jnovack", "link": "https://stackoverflow.com/users/2061684/jnovack"}, "is_accepted": false, "score": 1, "last_activity_date": 1601728549, "creation_date": 1601728549, "answer_id": 64184346, "question_id": 58614060, "link": "https://stackoverflow.com/questions/58614060/cant-connect-to-mysql-container-from-golang-container/64184346#64184346", "title": "Can&#39;t connect to MySQL container from Golang container", "body": "<p><code>0.0.0.0</code> is not your container's IP address.  It's a special address meaning &quot;all available interfaces&quot;.</p>\n<p>You are connecting from your Host to the Container with <code>0.0.0.0</code> because they do share an interface because you exposed the ports in your <code>docker-compose.yml</code> file.</p>\n<p>If your application is always going to live in a container, and your database is always going to live in a container, Docker provides a method for you to connect one to the other.</p>\n<p><code>db_private</code>, the service name, can be found from your <code>web</code> (or golang) container.</p>\n<p>This will always work, because Docker has an internal DNS server which your containers can use, no matter which IP address your containers have.</p>\n<pre><code>host&gt; docker-compose up -d\nhost&gt; docker-compose exec web /bin/sh\n web$ ping db_private\n</code></pre>\n<p>Yes, you always want to use <code>0.0.0.0</code> as bind interfaces within containers because you never know WHICH IP address you will get, so that's like a shortcut to say &quot;all&quot;.</p>\n"}], "owner": {"reputation": 63, "user_id": 11774463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/978406904628ef419879d15e340fc7a1?s=128&d=identicon&r=PG&f=1", "display_name": "batboy", "link": "https://stackoverflow.com/users/11774463/batboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1427, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1601728549, "creation_date": 1572376730, "last_edit_date": 1601727882, "question_id": 58614060, "link": "https://stackoverflow.com/questions/58614060/cant-connect-to-mysql-container-from-golang-container", "title": "Can&#39;t connect to MySQL container from Golang container", "body": "<p>I have 2 containers: a simple golang program and mysql.\nI can start both but the golang application can not connect to mysql. I receive <strong>Connection Refused</strong>.</p>\n<p>If I <code>docker exec</code> into the <strong>mysql</strong> container and try to connect locally with <code>mysql -u root -p</code> all works well.</p>\n<p>If on the the host I try to connect to the container with <code>mysql -h 0.0.0.0 -P 10000 -u root -p</code> all works well.</p>\n<p>I added <code>MYSQL_ROOT_HOST: '%'</code> in <code>docker-compose</code> and <code>bind-address = 0.0.0.0</code> into <code>mysqld.cnf</code> but still not working.</p>\n<p>What I'm doing wrong?</p>\n<p><strong>docker-compose</strong></p>\n<pre class=\"lang-yml prettyprint-override\"><code>    version: '3'\n    services:\n      web:\n        build:\n          context: .\n          dockerfile: docker/web/Dockerfile\n        ports:\n          - &quot;8081:8081&quot; # http\n          - &quot;443:443&quot; # https\n        links:\n          - db_private\n        volumes:\n         - ../../../../.:/go\n      db_private:\n        image: mysql:5.7\n        restart: always\n        environment:\n          MYSQL_DATABASE: ${MYSQL_DATABASE}\n          MYSQL_USER: ${MYSQL_USER}\n          MYSQL_PASSWORD: ${MYSQL_PASSWORD}\n          MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}\n          MYSQL_ROOT_HOST: '%'\n        ports:\n          - '10000:3306'\n        expose:\n          - '3306'\n        volumes:\n          - ./mysql-entry-point.sql:/docker-entrypoint-initdb.d\n          - private-db:/var/lib/mysql\n          - ./mysqld.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf\n    # Names our volume\n    volumes:\n      private-db:\n</code></pre>\n<p><strong>Web container Dockerfile</strong></p>\n<pre><code>    FROM golang:alpine\n    RUN mkdir /app\n    ADD . /app/\n    \n    WORKDIR /app\n    \n    RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add --no-cache bash git openssh\n    \n    RUN go get github.com/jinzhu/gorm\n    RUN go get github.com/jinzhu/gorm/dialects/mysql\n    RUN go get github.com/gin-gonic/gin\n    RUN go get github.com/gin-contrib/cors\n    \n    \n    RUN go build -o main .\n    RUN adduser -S -D -H -h /app appuser\n    USER appuser\n    CMD [&quot;./main&quot;]\n</code></pre>\n<p><strong>Golang file</strong></p>\n<pre class=\"lang-golang prettyprint-override\"><code>    package main\n    \n    import (\n        &quot;fmt&quot;\n        &quot;github.com/gin-gonic/gin&quot;\n        &quot;github.com/jinzhu/gorm&quot;\n        _ &quot;github.com/jinzhu/gorm/dialects/mysql&quot;\n        &quot;net/http&quot;\n        &quot;time&quot;\n    )\n    \n    var db *gorm.DB\n    \n    type (\n        FooModel struct {\n            Id        int64 `gorm:&quot;primary_key&quot;`\n            name      string\n        }\n    )\n    \n    func init() {\n        //open a db connection\n        var err error\n        db, err = gorm.Open(&quot;mysql&quot;, &quot;user:pwd@(0.0.0.0:10000)/myDB?charset=utf8&amp;parseTime=true&quot;)\n        if err != nil {\n            fmt.Println(err)\n            panic(&quot;failed to connect database&quot;)\n        }\n        //Migrate the schema\n        db.AutoMigrate(&amp;FooModel{})\n    \n        db.LogMode(true)\n    }\n    \n    // main inits routes\n    func main() {\n    \n        router := gin.Default()\n    \n        router.GET(&quot;/getExample&quot;, getExample)\n        \n        router.Run(&quot;0.0.0.0:8081&quot;)\n    }\n    \n    \n    func getExample(c *gin.Context) {\n    \n        c.JSON(http.StatusOK, gin.H{&quot;status&quot;: http.StatusOK, &quot;data&quot;: &quot;bye&quot;})\n    }\n</code></pre>\n<p><strong>I copy the <code>mysqld.cnf</code> in the container with this</strong></p>\n<pre><code>    [mysqld]\n    pid-file    = /var/run/mysqld/mysqld.pid\n    socket      = /var/run/mysqld/mysqld.sock\n    datadir     = /var/lib/mysql\n    #log-error  = /var/log/mysql/error.log\n    # By default we only accept connections from localhost\n    #bind-address   = 127.0.0.1\n    bind-address   = 0.0.0.0\n    # Disabling symbolic-links is recommended to prevent assorted security risks\n    symbolic-links=0\n</code></pre>\n"}, {"tags": ["dictionary", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 204, "user_id": 3454892, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/fc0827e5b4dd43779fed4d13991aeb4f?s=128&d=identicon&r=PG&f=1", "display_name": "poldy", "link": "https://stackoverflow.com/users/3454892/poldy"}, "edited": false, "score": 0, "creation_date": 1572376513, "post_id": 58613976, "comment_id": 103538002, "body": "Yes, that makes perfect sense. Thank you for pointing that out. I was staring at it too long to see it :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1572377806, "last_edit_date": 1572377806, "creation_date": 1572376353, "answer_id": 58613976, "question_id": 58613879, "link": "https://stackoverflow.com/questions/58613879/remove-duplicates-from-map-of-slices/58613976#58613976", "title": "Remove duplicates from map of slices", "body": "<p>You want all slices to be handled separately. E.g. you want to remove duplicates from the slice denoted by <code>x[\"key1\"]</code>, and you want to remove duplicates from the slice denoted by <code>x[\"key2\"]</code>. Which means you should \"reset\" <code>keys</code> when a new slice is being processed, yet you only initialize it once.</p>\n\n<p>As a consequence, if (by any chance) you process <code>x[\"key1\"]</code> first, and then you proceed to <code>x[\"key2\"]</code>, since <code>x[\"key1\"]</code> contains all the elements that  <code>x[\"key2\"]</code> does, no new elements will be found, so <code>\"key2\"</code> will be left out from the result entirely.</p>\n\n<p>Simply initialize <code>keys</code> before each slice, inside the loop:</p>\n\n<pre><code>for k, e := range x {\n    keys := make(map[string]bool)\n    for _, v := range e {\n        if _, val := keys[v]; !val {\n            keys[v] = true\n            result[k] = append(result[k], v)\n        }\n    }\n}\n</code></pre>\n\n<p>With this, the output will be (try it on the <a href=\"https://play.golang.org/p/b8zRoPT7s4t\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>map[key1:[1 1 2 3 3] key2:[1 2 2 3]]\nmap[key1:[1 2 3] key2:[1 2 3]]\n</code></pre>\n\n<p>Also note that you can use a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a> to create your initial map in a compact way like this:</p>\n\n<pre><code>x := map[string][]string{\n    \"key1\": {\"1\", \"1\", \"2\", \"3\", \"3\"},\n    \"key2\": {\"1\", \"2\", \"2\", \"3\"},\n}\n</code></pre>\n\n<p>And since you use <code>bool</code> in your <code>keys</code> map, you may simply check for existing elements like this (because indexing a map with a key that is not in it results in the zero value of the map's value type, which for <code>bool</code> is <code>false</code>, properly telling the element is not in the map):</p>\n\n<pre><code>if !keys[v] {\n    keys[v] = true\n    result[k] = append(result[k], v)\n}\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/sUeYdywKGkY\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>You can read more about this here: <a href=\"https://stackoverflow.com/questions/2050391/how-to-check-if-a-map-contains-a-key-in-go/43272888#43272888\">How to check if a map contains a key in Go?</a>; and <a href=\"https://stackoverflow.com/questions/33207197/how-can-i-create-an-array-that-contains-unique-strings/33207265#33207265\">How can I create an array that contains unique strings?</a></p>\n"}], "owner": {"reputation": 204, "user_id": 3454892, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/fc0827e5b4dd43779fed4d13991aeb4f?s=128&d=identicon&r=PG&f=1", "display_name": "poldy", "link": "https://stackoverflow.com/users/3454892/poldy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 58613976, "answer_count": 1, "score": 1, "last_activity_date": 1572377806, "creation_date": 1572375881, "last_edit_date": 1572376584, "question_id": 58613879, "link": "https://stackoverflow.com/questions/58613879/remove-duplicates-from-map-of-slices", "title": "Remove duplicates from map of slices", "body": "<p>I have a map of slices that I need to remove duplicates from. I think I'm close to the solution but I'm missing something that I can't quite figure out.</p>\n\n<p>Expected output: <code>map[key1:[1 2 3] key2:[1 2 3]]</code></p>\n\n<p>Actual output: <code>map[key2:[1 2 3]]</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    package main\n\n    import \"fmt\"\n\n    func main() {\n        x := make(map[string][]string)\n        keys := make(map[string]bool)\n        result := make(map[string][]string)\n\n        x[\"key1\"] = append(x[\"key1\"], \"1\")\n        x[\"key1\"] = append(x[\"key1\"], \"1\")\n        x[\"key1\"] = append(x[\"key1\"], \"2\")\n        x[\"key1\"] = append(x[\"key1\"], \"3\")\n        x[\"key1\"] = append(x[\"key1\"], \"3\")\n        x[\"key2\"] = append(x[\"key2\"], \"1\")\n        x[\"key2\"] = append(x[\"key2\"], \"2\")\n        x[\"key2\"] = append(x[\"key2\"], \"2\")\n        x[\"key2\"] = append(x[\"key2\"], \"3\")\n\n        fmt.Println(x)\n\n        for k, e := range x{\n            for _, v := range e {\n                if _, val := keys[v]; !val {\n                    keys[v] = true\n                    result[k] = append(result[k], v)\n                }\n            }\n        }\n        fmt.Println(result)\n    }\n</code></pre>\n\n<p>Example on the playground here: <a href=\"https://play.golang.org/p/HbycgyC5SI6\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1572373252, "post_id": 58613272, "comment_id": 103536720, "body": "Run <code>go mod tidy</code> to remove unused dependencies. Does it still show up after that?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1572373542, "post_id": 58613272, "comment_id": 103536843, "body": "I haven&#39;t seen this in a while, are you using go1.13?"}, {"owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "edited": false, "score": 0, "creation_date": 1572374491, "post_id": 58613272, "comment_id": 103537237, "body": "It still shows up after <code>go mod tidy</code>, and I&#39;m using Go 1.12."}], "answers": [{"tags": [], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "is_accepted": true, "score": 2, "last_activity_date": 1572374465, "creation_date": 1572374465, "answer_id": 58613567, "question_id": 58613272, "link": "https://stackoverflow.com/questions/58613272/how-to-track-down-where-a-dependency-comes-from-in-go-modules/58613567#58613567", "title": "How to track down where a dependency comes from in Go modules?", "body": "<p>I was able to 'patch' this problem by running <code>go get github.com/sourcegraph/go-diff</code> and adding this replace directive (cf. <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive</a>) in the module in which I was trying to update the dependency:</p>\n\n<pre><code>replace sourcegraph.com/sourcegraph/go-diff =&gt; github.com/sourcegraph/go-diff v0.5.1\n</code></pre>\n\n<p>After that, <code>go get -u github.com/myorg/mymodule</code> ran without errors.</p>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 0, "accepted_answer_id": 58613567, "answer_count": 1, "score": 2, "last_activity_date": 1572374465, "creation_date": 1572372990, "question_id": 58613272, "link": "https://stackoverflow.com/questions/58613272/how-to-track-down-where-a-dependency-comes-from-in-go-modules", "title": "How to track down where a dependency comes from in Go modules?", "body": "<p>I'd have a Go module, say <code>github.com/myorg/mymodule</code>, of which I'd like to update the version in another module. However, if I try to <code>go get -u</code> it, I get an <code>unexpected module path</code> error:</p>\n\n<pre><code>&gt; go get -u github.com/myorg/mymodule\ngo: sourcegraph.com/sourcegraph/go-diff@v0.5.1: parsing go.mod: unexpected module path \"github.com/sourcegraph/go-diff\"\ngo get: error loading module requirements\n</code></pre>\n\n<p>The fix for this has been documented at <a href=\"https://github.com/sourcegraph/go-diff/issues/35\" rel=\"nofollow noreferrer\">https://github.com/sourcegraph/go-diff/issues/35</a>: this module needs to be imported as <code>github.com/sourcegraph/go-diff/diff</code>, not <code>github.com/sourcegraph/go-diff</code>.</p>\n\n<p>The problem is, I don't know where to apply this fix - that is, which dependency is importing this sub-dependency the wrong way.</p>\n\n<p>In particular, <code>go-diff</code> does not appear in the <code>go.mod</code>, it only appears in <code>go.sum</code> (in several different modules):</p>\n\n<pre><code>&gt; grep go-diff go.mod\n&gt; grep go-diff go.sum\ngithub.com/pmezard/go-difflib v1.0.0 h1:4DBwDE0NGyQoBHbLQYPwSUPoCMWR5BEzIk/f1lZbAQM=\ngithub.com/pmezard/go-difflib v1.0.0/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4=\ngithub.com/sergi/go-diff v1.0.0/go.mod h1:0CfEIISq7TuYL3j771MWULgwwjU+GofnZX9QAmXWZgo=\nsourcegraph.com/sourcegraph/go-diff v0.5.0/go.mod h1:kuch7UrkMzY0X+p9CRK03kfuPQ2zzQcaEFbx8wA8rck=\n</code></pre>\n\n<p>I've tried using <code>go mod why</code>, but this simply reports that the module is not needed:</p>\n\n<pre><code>&gt; go mod why sourcegraph.com/sourcegraph/go-diff\n# sourcegraph.com/sourcegraph/go-diff\n(main module does not need package sourcegraph.com/sourcegraph/go-diff)\n</code></pre>\n\n<p>What is even more puzzling is that the error message mentions <code>go-diff@v0.5.1</code>, whereas the <code>go.sum</code> contains <code>go-diff v0.5.0</code>.</p>\n\n<p>All in all, how can I track down where this 'mis-import' of the <code>go-diff</code> dependency is happening so that I can update my version of that module?</p>\n"}, {"tags": ["json", "go", "marshalling"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1572372493, "post_id": 58613151, "comment_id": 103536409, "body": "<code>Data interface{}</code> would do it. The problem is for your success response, <code>_data</code> is a JSON array, not a JSON object, and only a JSON object can be unmarshaled into a <code>map</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1572372878, "post_id": 58613151, "comment_id": 103536576, "body": "Use <code>json.RawMessage</code> for Data, then after the status is unmarshaled based on its value allocate the correct struct for the Data and unmarshal the raw message into that."}, {"owner": {"reputation": 2648, "user_id": 1029654, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/11d1ed3a2d884420ff403355cd257814?s=128&d=identicon&r=PG", "display_name": "fonini", "link": "https://stackoverflow.com/users/1029654/fonini"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572373431, "post_id": 58613151, "comment_id": 103536801, "body": "@mkopriva Can you give me some example on that kind of allocation?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1572373879, "post_id": 58613151, "comment_id": 103536996, "body": "<a href=\"https://play.golang.org/p/OoGtjfvTcFM\" rel=\"nofollow noreferrer\">play.golang.org/p/OoGtjfvTcFM</a> there are variations to that of course and you don&#39;t have to do it exactly this way, what works best for you."}, {"owner": {"reputation": 2648, "user_id": 1029654, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/11d1ed3a2d884420ff403355cd257814?s=128&d=identicon&r=PG", "display_name": "fonini", "link": "https://stackoverflow.com/users/1029654/fonini"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572374795, "post_id": 58613151, "comment_id": 103537337, "body": "@mkopriva Thanks! Worked like a charm."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1572375848, "post_id": 58613151, "comment_id": 103537765, "body": "I would like to add on this: Usually, when you get an error response, you should have an according status code attached. So you simply could unmarshal to a struct when you have a status code of 200, and to a different struct on 400+"}], "owner": {"reputation": 2648, "user_id": 1029654, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/11d1ed3a2d884420ff403355cd257814?s=128&d=identicon&r=PG", "display_name": "fonini", "link": "https://stackoverflow.com/users/1029654/fonini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1572439260, "creation_date": 1572372392, "last_edit_date": 1572439260, "question_id": 58613151, "link": "https://stackoverflow.com/questions/58613151/how-to-marshal-variable-json-response-in-struct", "title": "How to marshal variable JSON response in struct", "body": "<p>I'm consuming an API which has some slightly different response when some validation error occurs.</p>\n\n<p>Success response:</p>\n\n<pre><code>{ \n   \"_status\":\"success\",\n   \"_data\":{ \n      \"id\":3901,\n      \"name\":\"Customer\",\n      \"age\":\"30\"\n   }\n}\n</code></pre>\n\n<p>Error response:</p>\n\n<pre><code>{ \n   \"_status\":\"error\",\n   \"_message\":\"Validation error\",\n   \"_data\":[ \n      { \n         \"_field\":\"name\",\n         \"_error\":\"You must inform a name\"\n      },\n      { \n         \"_field\":\"age\",\n         \"_error\":\"Age must be over 50\"\n      }\n   ]\n}\n</code></pre>\n\n<p>I've mapped the error response in the struct below, which works fine on error responses but fails on success responses.</p>\n\n<pre><code>type Response struct {\n    Status    string                  `json:\"_status\"`\n    Message *string                   `json:\"_message\"`\n    Data     []map[string]interface{} `json:\"_data\"`\n}\n</code></pre>\n\n<p>Is there a way to addapt the struct to work even with success responses?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1572368128, "post_id": 58611805, "comment_id": 103534457, "body": "I&#39;d be considering a redesign, in one of two directions: preferably, to give them all a shared interface so that in most cases you don&#39;t need to care what specific concrete type they are; or if that&#39;s truly impossible because the types are totally distinct, to cache them separately (if they&#39;re totally distinct, keeping them all in one bucket is just a &quot;big heap of stuff&quot;, like keeping users and posts in the same bucket - it makes no sense)."}, {"owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "edited": false, "score": 0, "creation_date": 1572369240, "post_id": 58611805, "comment_id": 103535003, "body": "I wrote a direct answer to the question, but now the answer button is gone.    Here&#39;s what I wrote: <a href=\"https://play.golang.org/p/hurJEJCFBNv\" rel=\"nofollow noreferrer\">play.golang.org/p/hurJEJCFBNv</a> ."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1572367292, "creation_date": 1572367292, "answer_id": 58611873, "question_id": 58611805, "link": "https://stackoverflow.com/questions/58611805/is-there-a-generic-way-to-assert-type/58611873#58611873", "title": "is there a Generic way to assert type?", "body": "<p>Go does not have generics, so what you want is not possible. If this really bothers you, you could use reflection to pass in the <a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"nofollow noreferrer\"><code>reflect.Type</code></a> of the values you want, use reflection to create and assemble that result slice, but it'll be slower than your individual functions.</p>\n\n<p>You could also use a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">type switch</a> to reduce the code repetition, but you cannot have \"dynamic\" return type. So the caller would still have to use a type assertion on the return value.</p>\n"}], "owner": {"reputation": 113, "user_id": 8907467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f32e824b247668176668723378a9384d?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Edwards", "link": "https://stackoverflow.com/users/8907467/chris-edwards"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "closed_date": 1572368436, "accepted_answer_id": 58611873, "answer_count": 1, "score": -1, "last_activity_date": 1572368492, "creation_date": 1572367051, "last_edit_date": 1572368402, "question_id": 58611805, "link": "https://stackoverflow.com/questions/58611805/is-there-a-generic-way-to-assert-type", "closed_reason": "Duplicate", "title": "is there a Generic way to assert type?", "body": "<p>I have found myself writing the same function X number of times to get different types of Items out of my go-cache. The duplicate functions are like so:</p>\n\n<pre><code>func TCPChecks() []*TCPCheck {\n    var result []*TCPCheck\n    for _, item := range Cache.Items() {\n        if check, ok := item.Object.(*TCPCheck); ok {\n            result = append(result, check)\n        }\n    }\n    return result\n}\n\nfunc HTTPChecks() []*HTTPCheck {\n    var result []*HTTPCheck\n    for _, item := range Cache.Items() {\n        if check, ok := item.Object.(*HTTPCheck); ok {\n            result = append(result, check)\n        }\n    }\n    return result\n}\n\nfunc VersionChecks() []*VersionCheck {\n    var result []*VersionCheck\n    for _, item := range Cache.Items() {\n        if check, ok := item.Object.(*VersionCheck); ok {\n            result = append(result, check)\n        }\n    }\n    return result\n}\n\nfunc PodChecks() []*PodCheck {\n    var result []*PodCheck\n    for _, item := range Cache.Items() {\n        if check, ok := item.Object.(*PodCheck); ok {\n            result = append(result, check)\n        }\n    }\n    return result\n}\n</code></pre>\n\n<p>I'm sure im doing things wrong in General but I'm still in the experimental stage and having a play.</p>\n\n<p>My question:</p>\n\n<p>is there a way to write a function such that I can say</p>\n\n<pre><code>func ChecksByType(t Type) []*Check {\n    var result []*Check\n    for _, item := range Cache.Items() {\n        if check, ok := item.Object.(t); ok {\n            result = append(result, check)\n        }\n    }\n    return result\n}\n\nChecksByType(*PodCheck)\n</code></pre>\n\n<p>My previous attempts result in the error </p>\n\n<pre><code>t is not a type\n</code></pre>\n\n<p>which I understand. I don't understand how to remove this duplication and have a generic function. </p>\n"}, {"tags": ["api", "http", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1572364423, "post_id": 58610989, "comment_id": 103532474, "body": "Please check all errors. Please check status code <code>res.StatusCode</code>. Please post what response headers you get <code>res.Header</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572364808, "post_id": 58610989, "comment_id": 103532679, "body": "Also consider whether you actually need all those headers. I&#39;d be surprised if you do. If the API is any could you should only need <code>Accept</code> and <code>Authorization</code>. <code>User-Agent</code>, <code>Host</code>, <code>Accept-Encoding</code> and <code>Connection</code> should all be handled for you properly by <code>http.Client</code>."}, {"owner": {"reputation": 124, "user_id": 9401138, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-f7mMGcdK0Ts/AAAAAAAAAAI/AAAAAAAAALo/HNRIXNfn7Ac/photo.jpg?sz=128", "display_name": "michael holstein", "link": "https://stackoverflow.com/users/9401138/michael-holstein"}, "edited": false, "score": 0, "creation_date": 1572364991, "post_id": 58610989, "comment_id": 103532769, "body": "I checked al errors, but they get passed. This is the header response <code>&amp;{200 OK 200 HTTP&#47;1.1 1 1 map[Content-Type:[application&#47;json; charset=utf-8] Expires:[-1] X-Frame-Options:[SAMEORIGIN] X-Xss-Protection:[1; mode=block] Date:[Tue, 29 Oct 2019 16:01:44 GMT] Cache-Control:[no-cache] X-Aspnet-Version:[4.0.30319] X-Content-Type-Options:[nosniff] Content-Length:[7106] Content-Encoding:[gzip] Connection:[keep-alive] Pragma:[no-cache]] 0xc000158040 7106 [] false false map[] 0xc0000da000 0xc0000a2370}</code>"}, {"owner": {"reputation": 124, "user_id": 9401138, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-f7mMGcdK0Ts/AAAAAAAAAAI/AAAAAAAAALo/HNRIXNfn7Ac/photo.jpg?sz=128", "display_name": "michael holstein", "link": "https://stackoverflow.com/users/9401138/michael-holstein"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572365436, "post_id": 58610989, "comment_id": 103532981, "body": "@Adrian Thanks for the advice. But with or without it doesn&#39;t make any difference. As I said I think it&#39;s something with decoding because in Postman it works perfectly"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1572366384, "creation_date": 1572366384, "answer_id": 58611633, "question_id": 58610989, "link": "https://stackoverflow.com/questions/58610989/when-calling-rest-api-with-http-newrequest-the-response-body-is-garbled/58611633#58611633", "title": "When calling rest API with http.NewRequest, the response body is garbled", "body": "<p>You ask the server to send the content compressed (<code>req.Header.Add(\"Accept-Encoding\", \"gzip, deflate\")</code>), and that's what you get: a gzip response, indicated by the response header: <code>Content-Encoding:[gzip]</code>.</p>\n\n<p>Remove that header (don't set <code>Accept-Encoding</code> request header), and you should get plain JSON response. Or decode the gzip response yourself.</p>\n\n<p>Note that if you omit this header, the default transport will still request <code>gzip</code> encoding, but then it will also transparently decode it. Since you request it explicitly, transparent, automatic decoding does not happen. This is documented at <a href=\"https://golang.org/pkg/net/http/#Transport\" rel=\"nofollow noreferrer\"><code>Transport.DisableCompression</code></a> field:</p>\n\n<pre><code>// DisableCompression, if true, prevents the Transport from\n// requesting compression with an \"Accept-Encoding: gzip\"\n// request header when the Request contains no existing\n// Accept-Encoding value. If the Transport requests gzip on\n// its own and gets a gzipped response, it's transparently\n// decoded in the Response.Body. However, if the user\n// explicitly requested gzip it is not automatically\n// uncompressed.\nDisableCompression bool\n</code></pre>\n"}], "owner": {"reputation": 124, "user_id": 9401138, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-f7mMGcdK0Ts/AAAAAAAAAAI/AAAAAAAAALo/HNRIXNfn7Ac/photo.jpg?sz=128", "display_name": "michael holstein", "link": "https://stackoverflow.com/users/9401138/michael-holstein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 1, "accepted_answer_id": 58611633, "answer_count": 1, "score": 0, "last_activity_date": 1572370599, "creation_date": 1572364289, "last_edit_date": 1572370599, "question_id": 58610989, "link": "https://stackoverflow.com/questions/58610989/when-calling-rest-api-with-http-newrequest-the-response-body-is-garbled", "title": "When calling rest API with http.NewRequest, the response body is garbled", "body": "<p>I try to call an API with Go. When using Postman everything is OK. But if I use the Go code from Postman the response is garbled/unclear.</p>\n\n<p>Down below the code I'm using:</p>\n\n<pre><code>func CallAPI() {\n    url := \"https://url\"\n\n    req, _ := http.NewRequest(\"GET\", url, nil)\n\n    req.Header.Add(\"Authorization\", \"Bearer Token is normaly here\")\n    req.Header.Add(\"User-Agent\", \"PostmanRuntime/7.19.0\")\n    req.Header.Add(\"Accept\", \"Accept: application/json\")\n    req.Header.Add(\"Cache-Control\", \"no-cache\")\n    req.Header.Add(\"Postman-Token\", \"Postman token normaly here\")\n    req.Header.Add(\"Host\", \"host normaly here\")\n    req.Header.Add(\"Accept-Encoding\", \"gzip, deflate\")\n    req.Header.Add(\"Connection\", \"keep-alive\")\n    req.Header.Add(\"cache-control\", \"no-cache\")\n\n    res, _ := http.DefaultClient.Do(req)\n\n    defer res.Body.Close()\n    body, _ := ioutil.ReadAll(res.Body)\n\n\n    fmt.Println(string(body))\n}\n</code></pre>\n\n<p>The response I get when I use <code>fmt.Println(string(body))</code> looks like below. I also tried other API's with this code and had the same result. </p>\n\n<pre><code>r\ufffd\u75f1\ufffd \n</code></pre>\n\n<p>I also tried to unmarshal the json to a struct and did get the following error \n<code>Invalid character '\\x1f' looking for beginning of value</code></p>\n\n<p>I think it's something about decoding. But I don't know what.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1572364473, "post_id": 58610824, "comment_id": 103532502, "body": "<code>101</code> is the the letter <code>e</code>. The <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">cgo documentation</a> lists a function specifically for converting C strings to Go, called: <code>C.GoString</code>"}], "answers": [{"tags": [], "owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "is_accepted": true, "score": 2, "last_activity_date": 1572373239, "last_edit_date": 1572373239, "creation_date": 1572369255, "answer_id": 58612396, "question_id": 58610824, "link": "https://stackoverflow.com/questions/58610824/passing-a-struct-containing-byte-to-syscall-and-read-its-content-after-executio/58612396#58612396", "title": "Passing a struct containing *byte to Syscall and read its content after execution", "body": "<p>1) I doubt that <code>cost char*</code> meant to be UTF16 encoded. So all what you need is just getting raw data:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>sensigrafo := \"en\\000\" // \\000 = 0 = null termination, \\0 does not valid\noptions := \"\\000\"\n\n...\n\nuintptr(*(*unsafe.Pointer)(unsafe.Pointer(&amp;sensigrafo))\nuintptr(*(*unsafe.Pointer)(unsafe.Pointer(&amp;options))\n\n// *(*unsafe.Pointer) are accessing the first field of string header:\ntype string struct {\n    data *byte\n    len int\n}\n\n// same with slices\n// but for them there's less ugly way:\nsensigrafo := []byte(\"en\\000\")\noptions := []byte(\"\\000\")\n\nuintptr(unsafe.Pointer(&amp;sensigrafo[0]))\nuintptr(unsafe.Pointer(&amp;options[0]))\n</code></pre>\n\n<p>2) C's <code>int</code> and Golang's <code>int</code> might have different sizeof, so this requires cgo declaration (<code>C.int</code>) or manual matching with random selection (try also int32, int64 if you don't want to use cgo)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type senseiErr struct {\n    code         C.int /* Golang's int32/int64 */\n    error_string *byte // pointer types are same as C's void* or Golang's unsafe.Pointer\n}\n</code></pre>\n\n<p>Wrong offset might cause error_string be empty or point to random addr.</p>\n\n<p>3) To read content you have to use same methods as C does (read data until null terminated byte, considering that *byte points to first element of string), but I propose to use already implemented runtime functions:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>//go:linkname gostringn runtime.gostringn\nfunc gostringn(p *byte, l int) string\n\n//go:linkname findnull runtime.findnull\n//go:nosplit\nfunc findnull(s *byte) int\n\n...\n\nerror_string := gostringn(err.error_string, findnull(err.error_string))\n\n// or cgo one:\n\ntype senseiErr struct {\n    code         C.int\n    error_string *C.char\n}\n\n...\n\nerror_string := C.GoString(err.error_string)\n</code></pre>\n"}], "owner": {"reputation": 199, "user_id": 795684, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a3dc2cf967abb27d3f18570117fcef38?s=128&d=identicon&r=PG", "display_name": "Riccardo Pedrielli", "link": "https://stackoverflow.com/users/795684/riccardo-pedrielli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 58612396, "answer_count": 1, "score": 1, "last_activity_date": 1572373239, "creation_date": 1572363795, "last_edit_date": 1572368583, "question_id": 58610824, "link": "https://stackoverflow.com/questions/58610824/passing-a-struct-containing-byte-to-syscall-and-read-its-content-after-executio", "title": "Passing a struct containing *byte to Syscall and read its content after execution", "body": "<p>I'm using <code>syscall.Syscall(...)</code> to call a C method in a dll.</p>\n\n<hr>\n\n<p>This is the C method signature:</p>\n\n<pre><code>SENSEI_API HSENSEI SENSEI_open(const char* sensigrafo, const char* options, SENSEI_ERR* se);\n</code></pre>\n\n<p>This is the <code>SENSEI_ERR</code> struct:</p>\n\n<pre><code>typedef struct\n{\n    int code;\n    char* error_string;\n} SENSEI_ERR;\n</code></pre>\n\n<hr>\n\n<p>In my GO program I declared a struct:</p>\n\n<pre><code>type senseiErr struct {\n    code         int\n    error_string *byte\n}\n</code></pre>\n\n<p>And tried to call the method:</p>\n\n<pre><code>    var nargs uintptr = 3\n    var err senseiErr\n\n    ret, _, callErr := syscall.Syscall(uintptr(senseiOpen),\n        nargs,\n        uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(\"en\"))),\n        uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(\"\"))),\n        uintptr(unsafe.Pointer(&amp;err)),\n    )\n</code></pre>\n\n<p>As you may have guessed, the <code>SENSEI_open</code> method fill the <code>SENSEI_ERR</code> argument with the code and the text of the error.</p>\n\n<p>Now I need to read the content of that error.</p>\n\n<p><code>err.code</code> actually has the correct value.</p>\n\n<p>About <code>err.error_string</code> I don't know. I'm new to GO and i have some questions:</p>\n\n<ul>\n<li>Since the C struct has the field <code>char* error_string</code>, is <code>error_string *byte</code> in my GO struct correct?\n\n<ul>\n<li>Should I use <code>[]byte</code> or something else?</li>\n</ul></li>\n<li>How do I read the content of the <code>error_string</code> field?\n\n<ul>\n<li><code>fmt.Println(err.error_string)</code> prints the memory address</li>\n<li><code>fmt.Println(*err.error_string)</code> prints always \"101\"</li>\n</ul></li>\n</ul>\n"}, {"tags": ["multithreading", "dictionary", "go", "thread-safety", "mutex"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1572360786, "post_id": 58609856, "comment_id": 103530374, "body": "<code>sync.Map</code> would not be well-suited for this scenario anyway, as there is no &quot;StoreIfMissing&quot; operation. The most obvious solution is to have a <code>map</code> that is guarded by a <code>sync.RWMutex</code>. When trying to write a value, lock the mutex, then only write the value if the key is not in the map."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1572360860, "post_id": 58609856, "comment_id": 103530417, "body": "You cannot write any values in go concurrently without synchronization, and tagging this with <code>mutex</code> implies you know you need a mutex, so what is the question exactly if you have a lock around the map already?"}, {"owner": {"reputation": 113, "user_id": 6899569, "user_type": "registered", "profile_image": "https://graph.facebook.com/954323951340089/picture?type=large", "display_name": "shota silagadze", "link": "https://stackoverflow.com/users/6899569/shota-silagadze"}, "edited": false, "score": 0, "creation_date": 1572360891, "post_id": 58609856, "comment_id": 103530437, "body": "In that case I need to stop all other reads too from accessing the value. also locking global mutex on every write operation is really time consuming. I just want to guard writing when its initializing value (not modifying already existing key - value)"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1572360943, "post_id": 58609856, "comment_id": 103530464, "body": "@shotasilagadze: You&#39;ve benchmarked this in your application? Are you sure it&#39;s not performant enough for your scenario?"}, {"owner": {"reputation": 113, "user_id": 6899569, "user_type": "registered", "profile_image": "https://graph.facebook.com/954323951340089/picture?type=large", "display_name": "shota silagadze", "link": "https://stackoverflow.com/users/6899569/shota-silagadze"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1572361038, "post_id": 58609856, "comment_id": 103530522, "body": "I just want to know the solution for this kind of scenario not for a particular case. @TimCooper"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1572361321, "post_id": 58609856, "comment_id": 103530703, "body": "&quot;I just want to guard writing when its initializing value (not modifying already existing key - value)&quot; So you intend to have a race condition on modifying existing values?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1572361420, "post_id": 58609856, "comment_id": 103530774, "body": "The solution for this &quot;this kind of scenario&quot; is almost always a mutex and map, until you have benchmarks proving otherwise. From the sync documentation: <code>The Map type is specialized. Most code should use a plain Go map instead, with separate locking or coordination, for better type safety and to make it easier to maintain other invariants along with the map content</code>"}, {"owner": {"reputation": 113, "user_id": 6899569, "user_type": "registered", "profile_image": "https://graph.facebook.com/954323951340089/picture?type=large", "display_name": "shota silagadze", "link": "https://stackoverflow.com/users/6899569/shota-silagadze"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1572361904, "post_id": 58609856, "comment_id": 103531041, "body": "@TimCooper I just don&#39;t change anything after inserting value. I just save something for further retrieval. that&#39;s it. I just want the insertion to be thread safe. what&#39;s so confusing here"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1572362360, "post_id": 58609856, "comment_id": 103531333, "body": "You can&#39;t have thread-safe insertions without also making all reads thread-safe. If the use is mostly-read, then use a RWMutex to allow multiple readers, but if there are going to be <i>any</i> writes you can&#39;t get around synchronization."}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 1, "last_activity_date": 1572361594, "last_edit_date": 1572361594, "creation_date": 1572361282, "answer_id": 58610062, "question_id": 58609856, "link": "https://stackoverflow.com/questions/58609856/how-to-safely-add-new-key-value-pair-into-go-native-map/58610062#58610062", "title": "How to safely add new key-value pair into go native map", "body": "<p>I would recommend the combination of <a href=\"https://godoc.org/sync#Map\" rel=\"nofollow noreferrer\"><code>sync.Map</code></a> to store the key-values and <a href=\"https://godoc.org/sync#Once\" rel=\"nofollow noreferrer\"><code>sync.Once</code></a> inside of the value to perform the one-time initialization.</p>\n\n<p>Here is an example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Value struct {\n    init       sync.Once\n    someValue  string\n}\n\nfunc (v *Value) Init() {\n    v.init.Do(func() {\n        // This function will only be executed one time\n        v.someValue = \"initialized\"\n    })\n}\n\nfunc main() {\n    var m sync.Map\n\n    v1, _ := m.LoadOrStore(\"key\", &amp;Value{})\n    v1.(*Value).Init() // init function is called\n\n    v2, _ := m.LoadOrStore(\"key\", &amp;Value{})\n    v2.(*Value).Init() // init function is not called\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 4, "last_activity_date": 1572361553, "creation_date": 1572361553, "answer_id": 58610144, "question_id": 58609856, "link": "https://stackoverflow.com/questions/58609856/how-to-safely-add-new-key-value-pair-into-go-native-map/58610144#58610144", "title": "How to safely add new key-value pair into go native map", "body": "<blockquote>\n  <p>Is there any way to organize code to add key safely when first encountered?</p>\n</blockquote>\n\n<p>No. You <em>need</em> proper synchronisation.</p>\n"}], "owner": {"reputation": 113, "user_id": 6899569, "user_type": "registered", "profile_image": "https://graph.facebook.com/954323951340089/picture?type=large", "display_name": "shota silagadze", "link": "https://stackoverflow.com/users/6899569/shota-silagadze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 58610144, "answer_count": 2, "score": -3, "last_activity_date": 1575459178, "creation_date": 1572360606, "last_edit_date": 1575459178, "question_id": 58609856, "link": "https://stackoverflow.com/questions/58609856/how-to-safely-add-new-key-value-pair-into-go-native-map", "title": "How to safely add new key-value pair into go native map", "body": "<p>I want to add a new key-value pair into Golang map from concurrent threads. Problem is that if there is a key present in the map we don't create new pair. From multithreaded perspective how to check the current condition and if key isn't present insert the key - value. </p>\n\n<p>Is there any way to organize code to add key safely when first encountered?</p>\n\n<p>The main problem is safely initializing mutex</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1572386120, "post_id": 58609530, "comment_id": 103541586, "body": "Seems like you should use <a href=\"https://godoc.org/google.golang.org/grpc#Server.GetServiceInfo\" rel=\"nofollow noreferrer\">godoc.org/google.golang.org/grpc#Server.GetServiceInfo</a> on the service to get a map from names to <code>ServiceInfo</code> instances."}, {"owner": {"reputation": 11, "user_id": 9051383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5NIDE.jpg?s=128&g=1", "display_name": "Holdno", "link": "https://stackoverflow.com/users/9051383/holdno"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1572401010, "post_id": 58609530, "comment_id": 103544787, "body": "This used after registered, what I want: if the xxx.pb.go package is &#39;test&#39;, I want to use the test._Auth_serviceDesc.ServiceName to found defined service, not write string"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1572401585, "post_id": 58609530, "comment_id": 103544884, "body": "You&#39;d need to have your test register the service (so that you can retrieve it), or, be in the same package so that you can access the un-exported name <code>_Auth_serviceDesc</code>."}], "answers": [{"tags": [], "owner": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "is_accepted": false, "score": 0, "last_activity_date": 1572468839, "creation_date": 1572468839, "answer_id": 58633497, "question_id": 58609530, "link": "https://stackoverflow.com/questions/58609530/how-to-get-service-desc-from-xxx-pb-go/58633497#58633497", "title": "how to get service desc from xxx.pb.go", "body": "<p>The only way to access the services and methods is via the <code>FileDescriptorProto</code> for the proto file(s).  Or, the v2 proto API contains a variable that will contain the descriptor proto in case you don't know the filenames (note that a single proto package may contain multiple files).</p>\n\n<p>Please see <a href=\"https://github.com/golang/protobuf/issues/489\" rel=\"nofollow noreferrer\">https://github.com/golang/protobuf/issues/489</a> for more discussion on this topic (and in particular, the last comment by dsnet for how the v2 proto API works in this regard).</p>\n"}], "owner": {"reputation": 11, "user_id": 9051383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5NIDE.jpg?s=128&g=1", "display_name": "Holdno", "link": "https://stackoverflow.com/users/9051383/holdno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 797, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1572490502, "creation_date": 1572359490, "last_edit_date": 1572490502, "question_id": 58609530, "link": "https://stackoverflow.com/questions/58609530/how-to-get-service-desc-from-xxx-pb-go", "title": "how to get service desc from xxx.pb.go", "body": "<p>when I use xxx.proto to generate a golang protobuf file<br>\nI see  </p>\n\n<pre><code>...\n\nvar _Auth_serviceDesc = grpc.ServiceDesc{\n    ServiceName: \"protobuf.Auth\",\n    HandlerType: (*AuthServer)(nil),\n    Methods: []grpc.MethodDesc{\n        {\n            MethodName: \"GenerateToken\",\n            Handler:    _Auth_GenerateToken_Handler,\n        },\n    },\n    Streams:  []grpc.StreamDesc{},\n    Metadata: \"auth.proto\",\n}\n</code></pre>\n\n<p>how can I get the <code>serviceDesc</code> out of this package?<br>\nI want to get service name and methods</p>\n"}, {"tags": ["go", "struct", "nested"], "comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 2, "creation_date": 1572354580, "post_id": 58608027, "comment_id": 103526904, "body": "If the type is already known, why do you need reflection?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572354592, "post_id": 58608027, "comment_id": 103526909, "body": "The <code>Kit_Details</code> field is a slice, you can use <a href=\"https://golang.org/pkg/reflect/#Value.Len\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#Value.Len</a> and <a href=\"https://golang.org/pkg/reflect/#Value.Index\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#Value.Index</a> to loop over the elements of the slice."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 7825560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f6167dd4b3967795e739552ae00501?s=128&d=identicon&r=PG&f=1", "display_name": "Suva", "link": "https://stackoverflow.com/users/7825560/suva"}, "edited": false, "score": 0, "creation_date": 1572525436, "post_id": 58608525, "comment_id": 103592290, "body": "if I want to store all the updated value in existing structure then what would be the way to do it. I am posting the way i am trying"}, {"owner": {"reputation": 451, "user_id": 5671644, "user_type": "registered", "profile_image": "https://graph.facebook.com/965230240198588/picture?type=large", "display_name": "Fahim Abrar", "link": "https://stackoverflow.com/users/5671644/fahim-abrar"}, "reply_to_user": {"reputation": 21, "user_id": 7825560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f6167dd4b3967795e739552ae00501?s=128&d=identicon&r=PG&f=1", "display_name": "Suva", "link": "https://stackoverflow.com/users/7825560/suva"}, "edited": false, "score": 0, "creation_date": 1572673773, "post_id": 58608525, "comment_id": 103639655, "body": "Please post your tried way in go playground @Suva. And also please accept my answer and give an upvote it is helpful for you. Thank you."}, {"owner": {"reputation": 21, "user_id": 7825560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f6167dd4b3967795e739552ae00501?s=128&d=identicon&r=PG&f=1", "display_name": "Suva", "link": "https://stackoverflow.com/users/7825560/suva"}, "edited": false, "score": 0, "creation_date": 1572851338, "post_id": 58608525, "comment_id": 103675311, "body": "@ Fahim,Please find go playground link  <a href=\"https://play.golang.org/p/7EKOtsyzCBJ\" rel=\"nofollow noreferrer\">play.golang.org/p/7EKOtsyzCBJ</a>"}], "tags": [], "owner": {"reputation": 451, "user_id": 5671644, "user_type": "registered", "profile_image": "https://graph.facebook.com/965230240198588/picture?type=large", "display_name": "Fahim Abrar", "link": "https://stackoverflow.com/users/5671644/fahim-abrar"}, "is_accepted": true, "score": 1, "last_activity_date": 1572356238, "creation_date": 1572356238, "answer_id": 58608525, "question_id": 58608027, "link": "https://stackoverflow.com/questions/58608027/how-to-use-reflection-to-set-nested-struct-field-values/58608525#58608525", "title": "How to use reflection to set nested struct field values", "body": "<p>You can use like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>v := reflect.ValueOf(test)\nfmt.Println(\"Value of test before update\", v)\nv.FieldByName(\"Kit_Details\").Index(0).FieldByName(\"KitStatus\").SetString(\"abcdsdf\")\n</code></pre>\n\n<p>You can use a loop to traverse all the elements and update them using <code>Index()</code>.</p>\n\n<p><a href=\"https://play.golang.org/p/WSsNfBC8EMM\" rel=\"nofollow noreferrer\">Go play ground link</a></p>\n"}], "owner": {"reputation": 21, "user_id": 7825560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63f6167dd4b3967795e739552ae00501?s=128&d=identicon&r=PG&f=1", "display_name": "Suva", "link": "https://stackoverflow.com/users/7825560/suva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 558, "favorite_count": 0, "accepted_answer_id": 58608525, "answer_count": 1, "score": 0, "last_activity_date": 1572356238, "creation_date": 1572354272, "last_edit_date": 1572355704, "question_id": 58608027, "link": "https://stackoverflow.com/questions/58608027/how-to-use-reflection-to-set-nested-struct-field-values", "title": "How to use reflection to set nested struct field values", "body": "<p>I'm using Go to create a nested struct and populate it. I have a custom field in the struct that I need to set myself, but it's a type used in a field of the outer struct. For example:</p>\n\n<pre><code>type Case struct {\n   CaseID            string         `json:\"caseID\"`\n   CaseStatus        string         `json:\"caseStatus\"`\n   Kit_Details       []Kit_Details  `json:\"kit_Details\"`\n}\n\ntype Kit_Details struct {\n    KitID          string    `json:\"kitID\"`\n    KitStatus      string    `json:\"kitStatus\"`\n}\n</code></pre>\n\n<p>I have created a nested struct. I want to update <code>KitStatus</code> fields using Case struct in my program.Means if I access Case struct from that how can i move to <code>Kit_Details</code> struct and update the field of a structure.\nCan somebody help me how to loop through the fields of Case struct using <code>FieldByName(\"KitStatus\")</code> and using <code>SetString(\"New value\")</code> to update the value of that field.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-platform", "google-cloud-storage"], "answers": [{"tags": [], "owner": {"reputation": 509, "user_id": 854176, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nazaG.jpg?s=128&g=1", "display_name": "afed", "link": "https://stackoverflow.com/users/854176/afed"}, "is_accepted": false, "score": 1, "last_activity_date": 1572355137, "creation_date": 1572355137, "answer_id": 58608246, "question_id": 58607328, "link": "https://stackoverflow.com/questions/58607328/how-to-upload-large-files-to-google-cloud-storage-with-gae-se-go112/58608246#58608246", "title": "How to upload large files to Google Cloud Storage with GAE/SE go112", "body": "<p>You will have to migrate to the Google Cloud client library to access GCS. <a href=\"https://godoc.org/cloud.google.com/go/storage\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/storage</a></p>\n"}], "owner": {"reputation": 33, "user_id": 10481741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42154f58d0a1b0f2fd0770b8bee07472?s=128&d=identicon&r=PG&f=1", "display_name": "touyu", "link": "https://stackoverflow.com/users/10481741/touyu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572425803, "creation_date": 1572351412, "last_edit_date": 1572425803, "question_id": 58607328, "link": "https://stackoverflow.com/questions/58607328/how-to-upload-large-files-to-google-cloud-storage-with-gae-se-go112", "title": "How to upload large files to Google Cloud Storage with GAE/SE go112", "body": "<p>I can use Blobstore API (blobstore.UploadURL) with GAE/SE go111, but it was abolished in GAE/SE go112.\nHow do I upload large files to GCS?</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 451, "user_id": 5671644, "user_type": "registered", "profile_image": "https://graph.facebook.com/965230240198588/picture?type=large", "display_name": "Fahim Abrar", "link": "https://stackoverflow.com/users/5671644/fahim-abrar"}, "is_accepted": false, "score": 3, "last_activity_date": 1572352083, "creation_date": 1572352083, "answer_id": 58607502, "question_id": 58606884, "link": "https://stackoverflow.com/questions/58606884/multiple-definition-when-using-cgo/58607502#58607502", "title": "multiple definition when using cgo", "body": "<p>This behavior is documented <a href=\"https://golang.org/cmd/cgo/#hdr-C_references_to_Go\" rel=\"nofollow noreferrer\">here</a> </p>\n\n<blockquote>\n  <p>Using //export in a file places a restriction on the preamble: since it is copied into two different C output files, it must not contain any definitions, only declarations. If a file contains both definitions and declarations, then the two output files will produce duplicate symbols and the linker will fail. To avoid this, definitions must be placed in preambles in other files, or in C source files.</p>\n</blockquote>\n"}], "owner": {"reputation": 197, "user_id": 3313450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef32fa1e6ba717f97b8abacd0b755037?s=128&d=identicon&r=PG&f=1", "display_name": "dingrui", "link": "https://stackoverflow.com/users/3313450/dingrui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 922, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572352083, "creation_date": 1572349751, "last_edit_date": 1572350695, "question_id": 58606884, "link": "https://stackoverflow.com/questions/58606884/multiple-definition-when-using-cgo", "title": "multiple definition when using cgo", "body": "<pre><code>package main\n\n/*\nint add(int a, int b) {\n    return a + b;\n}\n*/\nimport \"C\"\nimport \"fmt\"\n\nfunc main() {}\n\nfunc Test1() {\n    fmt.Println(C.add(1, 3))\n}\n\n//export Test2\nfunc Test2() {\n\n}\n</code></pre>\n\n<p>Compile the programe:</p>\n\n<pre><code>dingrui@dingrui-PC:~/Projects/gotest/array$ go build -o libtest.so -buildmode=c-shared main.go \n# command-line-arguments\n/tmp/go-build043762604/b001/_x002.o: In function `add':\n./main.go:5: multiple definition of `add'\n/tmp/go-build043762604/b001/_x001.o:/tmp/go-build/main.go:5: first defined here\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>If I delete the \"//export Test2\" line, it compile successfully.</p>\n"}, {"tags": ["multithreading", "go", "tcp", "network-programming"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1572348774, "post_id": 58606572, "comment_id": 103524108, "body": "Please don&#39;t use images of text. They are hard to read, and impossible for the visually impaired to read. They also can&#39;t be indexed or searched. Instead, just copy and paste the text directly into your post."}, {"owner": {"reputation": 38, "user_id": 9036766, "user_type": "registered", "profile_image": "https://graph.facebook.com/1982858405320546/picture?type=large", "display_name": "Muhammad Rehan Javed", "link": "https://stackoverflow.com/users/9036766/muhammad-rehan-javed"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1572349016, "post_id": 58606572, "comment_id": 103524201, "body": "Thanks Flimzy. I will keep that in mind in my future posts."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1572349032, "post_id": 58606572, "comment_id": 103524207, "body": "Thanks. Please update this post, too."}], "answers": [{"comments": [{"owner": {"reputation": 38, "user_id": 9036766, "user_type": "registered", "profile_image": "https://graph.facebook.com/1982858405320546/picture?type=large", "display_name": "Muhammad Rehan Javed", "link": "https://stackoverflow.com/users/9036766/muhammad-rehan-javed"}, "edited": false, "score": 0, "creation_date": 1572349065, "post_id": 58606643, "comment_id": 103524227, "body": "Thankyou Malt. It was quite helpful."}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1572350733, "post_id": 58606643, "comment_id": 103525028, "body": "Usually you use fix size message and padding when ever the message is short. Then on the server you read the right length. In your case <code>buffer := make([]byte, 5)</code> will get you the result you expect."}], "tags": [], "owner": {"reputation": 25103, "user_id": 3199595, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TwK8q.png?s=128&g=1", "display_name": "Malt", "link": "https://stackoverflow.com/users/3199595/malt"}, "is_accepted": false, "score": 3, "last_activity_date": 1572348776, "creation_date": 1572348776, "answer_id": 58606643, "question_id": 58606572, "link": "https://stackoverflow.com/questions/58606572/concurrency-issues-while-reading-and-writing-data-in-loop-in-tcp-client-server/58606643#58606643", "title": "Concurrency issues while reading and writing data in loop in TCP client server", "body": "<p>It isn't a concurrency issue. It's a networking issue.</p>\n\n<p>TCP is a <strong>stream</strong> protocol, as such, a single <code>read()</code> from a socket doesn't correspond to a single <code>write()</code> from the other side.</p>\n\n<p>Instead, reads return whatever is in the TCP buffer at the time of read, regardless whether it was sent by a single call to <code>write()</code> or a hundred.</p>\n\n<p>If you want to read the data from the socket as separate messages, you need a way of separating them by using a delimiter, counting bytes, or some other method.</p>\n"}], "owner": {"reputation": 38, "user_id": 9036766, "user_type": "registered", "profile_image": "https://graph.facebook.com/1982858405320546/picture?type=large", "display_name": "Muhammad Rehan Javed", "link": "https://stackoverflow.com/users/9036766/muhammad-rehan-javed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572348935, "creation_date": 1572348466, "last_edit_date": 1572348935, "question_id": 58606572, "link": "https://stackoverflow.com/questions/58606572/concurrency-issues-while-reading-and-writing-data-in-loop-in-tcp-client-server", "title": "Concurrency issues while reading and writing data in loop in TCP client server", "body": "<p>I was trying to create a client server model to learn some stuff and I just tried sending(writing) data from client to server in a loop and it just don't worked well. I think that there are some concurrency issues and the client writes faster to server and the server than read multiple statements in one go. How can I maintain this concurrency so that only one statement written by the client at a time is read by the server. Here is the code to illustrate the problem in a better.</p>\n\n<p>Here is the server handleConnection Function</p>\n\n<pre><code>func main() {\n\n    conn, err := net.Listen(\"tcp\", \":8080\")\n    if err != nil {\n        log.Println(\"Error:\", err)\n    }\n\n    for {\n        ln, err := conn.Accept()\n        if err != nil {\n            log.Println(\"Error:\", err)\n            continue\n        }\n\n        go handleConnection(ln)\n    }\n\n}\n\nfunc handleConnection(conn net.Conn) {\n    buffer := make([]byte, 4096)\n\n    for i := 0; i &lt; 10; i++ {\n        n, err := conn.Read(buffer)\n        if err != nil {\n            fmt.Println(err, i)\n        }\n\n        fmt.Printf(\"%s\\n\", buffer[:n])\n    }\n\n    fmt.Println(\"Done\")\n\n    conn.Close()\n}\n</code></pre>\n\n<p>Here is the client writing data to server in loop.</p>\n\n<pre><code>func main() {\n    conn, err := net.Dial(\"tcp\", \":8080\")\n    if err != nil {\n        log.Println(\"Error:\", err)\n        os.Exit(1)\n    }\n\n    for i := 0; i &lt; 10; i++ {\n        _, err = conn.Write([]byte(\"Rehan\"))\n        if err != nil {\n            fmt.Println(err, i)\n        }\n    }\n\n    fmt.Println(\"Done\")\n    conn.Close()\n}\n</code></pre>\n\n<p>This is the output by the server.\n<img src=\"https://i.stack.imgur.com/Wfaqn.jpg\" alt=\"![This is the Server output\">]<a href=\"https://i.stack.imgur.com/Wfaqn.jpg\" rel=\"nofollow noreferrer\">1</a></p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1572350962, "post_id": 58606514, "comment_id": 103525144, "body": "Are you using Go modules?  Or, is the dependent library in source control you can access at build time?  There\u2019s <code>go.mod</code> and <code>go get</code> syntax to reference specific commits, it you can push the library to a branch.  Including the <code>Dockerfile</code> in the question would also help understanding what your current build environment is like."}, {"owner": {"reputation": 157, "user_id": 7794585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bf2a2d3ad9fbb255a94137ef6ebf3e7?s=128&d=identicon&r=PG&f=1", "display_name": "sm4ll_3gg", "link": "https://stackoverflow.com/users/7794585/sm4ll-3gg"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1572354049, "post_id": 58606514, "comment_id": 103526676, "body": "@DavidMaze Yes, I am. Actually I&#39;m trying to do it without commit or push before testing if new changes are work. It prevents a lot of unworking commits in the source branch. So I&#39;m looking for a way to build the service with the dependency located outside of service source code"}, {"owner": {"reputation": 1158, "user_id": 6117625, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cff13813080b5f227531191b1dc96b60?s=128&d=identicon&r=PG&f=1", "display_name": "Dean coakley", "link": "https://stackoverflow.com/users/6117625/dean-coakley"}, "edited": false, "score": 0, "creation_date": 1572354498, "post_id": 58606514, "comment_id": 103526861, "body": "Not fully sure I understand the problem/question. But maybe <code>go mod vendor</code> can help, no? <a href=\"https://github.com/golang/go/wiki/Modules#how-do-i-use-vendoring-with-modules-is-vendoring-going-away\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}, {"owner": {"reputation": 157, "user_id": 7794585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bf2a2d3ad9fbb255a94137ef6ebf3e7?s=128&d=identicon&r=PG&f=1", "display_name": "sm4ll_3gg", "link": "https://stackoverflow.com/users/7794585/sm4ll-3gg"}, "reply_to_user": {"reputation": 1158, "user_id": 6117625, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cff13813080b5f227531191b1dc96b60?s=128&d=identicon&r=PG&f=1", "display_name": "Dean coakley", "link": "https://stackoverflow.com/users/6117625/dean-coakley"}, "edited": false, "score": 0, "creation_date": 1572355371, "post_id": 58606514, "comment_id": 103527328, "body": "@Deancoakley, unfortunately, it won&#39;t help. I need a way to use uncommitted (located outside the service&#39;s source code) changes in the dependency library during building docker container"}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 9686846, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e9fNh.png?s=128&g=1", "display_name": "i4nk1t", "link": "https://stackoverflow.com/users/9686846/i4nk1t"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1572410774, "post_id": 58606719, "comment_id": 103546657, "body": "@DavidMaze oh sorry , i wasn&#39;t aware about that , thanks , its good to know."}], "tags": [], "owner": {"reputation": 161, "user_id": 9686846, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e9fNh.png?s=128&g=1", "display_name": "i4nk1t", "link": "https://stackoverflow.com/users/9686846/i4nk1t"}, "is_accepted": false, "score": 0, "last_activity_date": 1572349989, "last_edit_date": 1572349989, "creation_date": 1572349108, "answer_id": 58606719, "question_id": 58606514, "link": "https://stackoverflow.com/questions/58606514/using-local-dependencies-when-docker-container-is-building/58606719#58606719", "title": "Using local dependencies when docker container is building", "body": "<p>Why don't you try to mount the library folder to container and define path in dockerfile, that way your image wont be large and the path will fetch you the dependent libraries from the mounted directory.</p>\n"}], "owner": {"reputation": 157, "user_id": 7794585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bf2a2d3ad9fbb255a94137ef6ebf3e7?s=128&d=identicon&r=PG&f=1", "display_name": "sm4ll_3gg", "link": "https://stackoverflow.com/users/7794585/sm4ll-3gg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 155, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572350752, "creation_date": 1572348280, "last_edit_date": 1572350752, "question_id": 58606514, "link": "https://stackoverflow.com/questions/58606514/using-local-dependencies-when-docker-container-is-building", "title": "Using local dependencies when docker container is building", "body": "<p>I have a service which transitively relies on some library (which is also being developed by me). The only way to test if the library changes are correct is to run the service.  </p>\n\n<h1>How could I do it locally</h1>\n\n<p>I have two versions of that library:  </p>\n\n<ul>\n<li>Stable version inside <code>vendor</code> folder</li>\n<li>Actual one with untested changes inside <code>GOPATH</code></li>\n</ul>\n\n<p>So I can just remove it from <code>vendor</code> and <code>go build</code> will work correctly using the version from <code>GOPATH</code>. </p>\n\n<hr>\n\n<p>The question is what is the best way to achieve the same behavior using <code>docker</code>?<br>\nThe obvious solution is just copy of local <code>GOPATH</code> into the container on build stage, but <code>GOPATH</code> size is very big and such approach is too expensive.  </p>\n"}, {"tags": ["go", "error-handling", "interface"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 10137588, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cmyqMiMfro4/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7obF8dRTrUQw2f-ndPrlrYNSu6YJA/mo/photo.jpg?sz=128", "display_name": "hy c", "link": "https://stackoverflow.com/users/10137588/hy-c"}, "edited": false, "score": 0, "creation_date": 1572400570, "post_id": 58605987, "comment_id": 103544693, "body": "Thank you, you saved my day. That is the code I copied from the Go Validator documentation and I did miss the type assertion part and I thought it has the same interface Error()."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1572362705, "last_edit_date": 1572362705, "creation_date": 1572346254, "answer_id": 58605987, "question_id": 58605845, "link": "https://stackoverflow.com/questions/58605845/why-i-cannot-use-error-for-type-validator-fielderror/58605987#58605987", "title": "Why I cannot use Error() for type validator.FieldError", "body": "<p>Your \"outer\" <code>err</code> is an <code>error</code> (which is returned by <a href=\"https://godoc.org/gopkg.in/go-playground/validator.v9#Validate.Struct\" rel=\"nofollow noreferrer\"><code>validate.Struct()</code></a>), it has an <code>Error()</code> method.</p>\n\n<p>But the <code>err</code> loop variable is not. You type assert <a href=\"https://godoc.org/gopkg.in/go-playground/validator.v9#ValidationErrors\" rel=\"nofollow noreferrer\"><code>validator.ValidationErrors</code></a> from the \"outer\" <code>err</code>, which is:</p>\n\n<pre><code>type ValidationErrors []FieldError\n</code></pre>\n\n<p>Where <a href=\"https://godoc.org/gopkg.in/go-playground/validator.v9#FieldError\" rel=\"nofollow noreferrer\"><code>FieldError</code></a> is an interface type but it has no <code>Error()</code> method.</p>\n\n<p>You may call and print the error string of the \"outer\" <code>err</code> variable, before or after (but not inside) the loop.</p>\n\n<pre><code>if err != nil {\n    fmt.Println(err.Error())\n    for _, err := range err.(validator.ValidationErrors) {\n        // ...\n    }\n}\n</code></pre>\n\n<p>To avoid such confusion, use a different name for the loop variable, especially since it's not of type <code>error</code>. <code>fieldErr</code> or simply <code>fe</code> (as in field error) would be a good name.</p>\n"}], "owner": {"reputation": 95, "user_id": 10137588, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cmyqMiMfro4/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7obF8dRTrUQw2f-ndPrlrYNSu6YJA/mo/photo.jpg?sz=128", "display_name": "hy c", "link": "https://stackoverflow.com/users/10137588/hy-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 572, "favorite_count": 0, "accepted_answer_id": 58605987, "answer_count": 1, "score": 2, "last_activity_date": 1572362705, "creation_date": 1572345730, "last_edit_date": 1572346508, "question_id": 58605845, "link": "https://stackoverflow.com/questions/58605845/why-i-cannot-use-error-for-type-validator-fielderror", "title": "Why I cannot use Error() for type validator.FieldError", "body": "<p>I am using go validator and everything is fine. I can use print everything from err but cannot use <code>Error()</code> or convert the <code>err</code> to <code>string</code>. Does anyone can help me with this?</p>\n\n<p>It shows</p>\n\n<pre><code>err.Error undefined (type validator.FieldError has no field or method Error)\n</code></pre>\n\n<p>My code:</p>\n\n<pre><code>err = validate.Struct(myData)\n\nif err != nil {\n\n    for _, err := range err.(validator.ValidationErrors) {\n        fmt.Println(err)\n        fmt.Println(err.Namespace())\n        fmt.Println(err.Field())\n        fmt.Println(err.StructNamespace())\n        fmt.Println(err.StructField())\n        fmt.Println(err.Tag())\n        fmt.Println(err.ActualTag())\n        fmt.Println(err.Kind())\n        fmt.Println(err.Type())\n        err.Error()\n\n    }\n\n    return\n}\n</code></pre>\n\n<p>Is there any way to use the interface <code>Error()</code>? Or convert the <code>err</code> to <code>string</code>?</p>\n"}, {"tags": ["python", "c", "opencv", "go", "image-processing"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1572341121, "post_id": 58603355, "comment_id": 103520118, "body": "share some code. might be a bug in the writing. Or maybe the pipeline is missing some filters"}, {"owner": {"reputation": 5093, "user_id": 302005, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eDmEQ.png?s=128&g=1", "display_name": "Pioz", "link": "https://stackoverflow.com/users/302005/pioz"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1572345902, "post_id": 58603355, "comment_id": 103522680, "body": "@mh-cbon I&#39;ve edited the question with my code."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1572346180, "post_id": 58603355, "comment_id": 103522816, "body": "great. However none of it make use of sift or orb. and the template matching method as mentioned in another thread is not capable of handling scale issue. It is more like patch detection. as explained in <a href=\"https://stackoverflow.com/a/58160295/4466350\">stackoverflow.com/a/58160295/4466350</a> <code>Off the bat, template matching doesn&#39;t directly help you match things that are scaled, rotated, or warped. Template matching is strictly concerned with measuring the similarity of two images exactly as they appear.</code>"}, {"owner": {"reputation": 27168, "user_id": 7355741, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6CMNt.jpg?s=128&g=1", "display_name": "fmw42", "link": "https://stackoverflow.com/users/7355741/fmw42"}, "edited": false, "score": 0, "creation_date": 1572366373, "post_id": 58603355, "comment_id": 103533497, "body": "template matching is scale and rotation sensitive. It only looks for positional matches of the same size and orientation. So if the template and the region in the larger image are similar, but have different sizes, then template matching won&#39;t work unless you try all sizes of the template. There are special tools for doing scale and rotation invariant template matching. But I am not sure if they exist in OpenCV."}, {"owner": {"reputation": 5093, "user_id": 302005, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eDmEQ.png?s=128&g=1", "display_name": "Pioz", "link": "https://stackoverflow.com/users/302005/pioz"}, "reply_to_user": {"reputation": 27168, "user_id": 7355741, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6CMNt.jpg?s=128&g=1", "display_name": "fmw42", "link": "https://stackoverflow.com/users/7355741/fmw42"}, "edited": false, "score": 0, "creation_date": 1572368158, "post_id": 58603355, "comment_id": 103534468, "body": "@fmw42 I&#39;ve tried my example with the template of the same scale and orientation, but I couldn&#39;t find any valid match."}, {"owner": {"reputation": 27168, "user_id": 7355741, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6CMNt.jpg?s=128&g=1", "display_name": "fmw42", "link": "https://stackoverflow.com/users/7355741/fmw42"}, "edited": false, "score": 0, "creation_date": 1572370988, "post_id": 58603355, "comment_id": 103535788, "body": "<code>@Pioz</code> That is likely because of the color differences and contrast inversion (white letters on black vs black letters on blue). Perhaps doing the template matching on edge extracted images might work better."}], "answers": [{"comments": [{"owner": {"reputation": 5093, "user_id": 302005, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eDmEQ.png?s=128&g=1", "display_name": "Pioz", "link": "https://stackoverflow.com/users/302005/pioz"}, "edited": false, "score": 2, "creation_date": 1572340186, "post_id": 58603672, "comment_id": 103519628, "body": "The answer to the question you have linked say: &quot;This can be done with template matching. To summarize (my understanding), template matching looks for an <i>exact</i> match of one image within another image.&quot; But in my case, it is not an exact match infact the icon I need to find is similar, not identical."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1572341308, "post_id": 58603672, "comment_id": 103520230, "body": "note that you could try the template matching with various scales as described in <a href=\"https://www.pyimagesearch.com/2015/01/26/multi-scale-template-matching-using-python-opencv/\" rel=\"nofollow noreferrer\">pyimagesearch.com/2015/01/26/&hellip;</a> in your case that could do it."}, {"owner": {"reputation": 32458, "user_id": 1485872, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/9XWSA.png?s=128&g=1", "display_name": "Ander Biguri", "link": "https://stackoverflow.com/users/1485872/ander-biguri"}, "reply_to_user": {"reputation": 5093, "user_id": 302005, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eDmEQ.png?s=128&g=1", "display_name": "Pioz", "link": "https://stackoverflow.com/users/302005/pioz"}, "edited": false, "score": 0, "creation_date": 1572361291, "post_id": 58603672, "comment_id": 103530681, "body": "@Pioz thing is, you have an advanced brain as a human and can identify things that are similar but not the same. But which parameters you use? If you use color, or if you use structure/edges, you will get different images. You need to <i>define</i> &quot;similar&quot; mathematically before you can find an algorithm that will work for you."}], "tags": [], "owner": {"reputation": 115, "user_id": 8863605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/870eee568cbe9ac5b57624dcddd9dc36?s=128&d=identicon&r=PG&f=1", "display_name": "Circle", "link": "https://stackoverflow.com/users/8863605/circle"}, "is_accepted": false, "score": 1, "last_activity_date": 1572337683, "creation_date": 1572337683, "answer_id": 58603672, "question_id": 58603355, "link": "https://stackoverflow.com/questions/58603355/find-similar-image-inside-another-image-with-opencv/58603672#58603672", "title": "Find similar image inside another image with opencv", "body": "<p>I believe this question has already been asked - <a href=\"https://stackoverflow.com/questions/7853628/how-do-i-find-an-image-contained-within-an-image\">here</a>. </p>\n\n<p>Templete matching is supposed to be one of the best techniques for this kind of image processing. So, if it's not working for you, try reviewing/sharing the code you have implemented. </p>\n"}, {"tags": [], "owner": {"reputation": 191, "user_id": 10337002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5574a5c094fddcea6aeabd609ce840da?s=128&d=identicon&r=PG&f=1", "display_name": "Beeti Sushruth", "link": "https://stackoverflow.com/users/10337002/beeti-sushruth"}, "is_accepted": false, "score": 0, "last_activity_date": 1572349343, "creation_date": 1572349343, "answer_id": 58606776, "question_id": 58603355, "link": "https://stackoverflow.com/questions/58603355/find-similar-image-inside-another-image-with-opencv/58606776#58606776", "title": "Find similar image inside another image with opencv", "body": "<p>This <a href=\"https://docs.opencv.org/master/dc/dc3/tutorial_py_matcher.html\" rel=\"nofollow noreferrer\">link</a> is related to OpenCV which explains <code>feature matching</code> and different techniques. There is also examples with code, which may come of use. Also if  <code>SIFT</code> doesn't give staisfactory result, try affine SIFT or <code>ASIFT</code>.</p>\n"}], "owner": {"reputation": 5093, "user_id": 302005, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/eDmEQ.png?s=128&g=1", "display_name": "Pioz", "link": "https://stackoverflow.com/users/302005/pioz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1155, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1572349343, "creation_date": 1572336236, "last_edit_date": 1572345841, "question_id": 58603355, "link": "https://stackoverflow.com/questions/58603355/find-similar-image-inside-another-image-with-opencv", "title": "Find similar image inside another image with opencv", "body": "<p>I have to understand if an image contains another similar image. Here 2 example:</p>\n\n<p>Inside this image: <a href=\"https://i.stack.imgur.com/hUkIR.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hUkIR.jpg\" alt=\"enter image description here\"></a> I need to find this image: <a href=\"https://i.stack.imgur.com/aiJXT.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/aiJXT.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>or inside this <a href=\"https://i.stack.imgur.com/oYLUo.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/oYLUo.png\" alt=\"enter image description here\"></a> find this <a href=\"https://i.stack.imgur.com/ur3MB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ur3MB.png\" alt=\"enter image description here\"></a>.</p>\n\n<p>The idea is: given an input image and a set of icons find which icon is present in the input image.</p>\n\n<p>I've tried using <code>MatchTemplate</code> and feature matching with ORB and SIFT but I couldn't find any valid matches.</p>\n\n<p>Here my try with <code>MatchTemplate</code> in Go:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"image/color\"\n\n    \"gocv.io/x/gocv\"\n)\n\nfunc main() {\n    matImage := gocv.IMRead(\"/Users/pioz/Desktop/samplex.jpg\", gocv.IMReadGrayScale)\n    // gocv.Canny(matImage, &amp;matImage, 200, 400)\n    matTemplate := gocv.IMRead(\"/Users/pioz/Desktop/eld.jpg\", gocv.IMReadGrayScale)\n    // gocv.Canny(matTemplate, &amp;matTemplate, 20, 40)\n    matResult := gocv.NewMat()\n    mask := gocv.NewMat()\n    gocv.MatchTemplate(matImage, matTemplate, &amp;matResult, gocv.TmCcoeffNormed, mask)\n    mask.Close()\n    minConfidence, maxConfidence, minLoc, maxLoc := gocv.MinMaxLoc(matResult)\n    fmt.Println(minConfidence, maxConfidence, minLoc, maxLoc)\n\n    gocv.Circle(&amp;matImage, minLoc, 10, color.RGBA{0, 0, 255, 1}, 10)\n    gocv.Circle(&amp;matImage, maxLoc, 10, color.RGBA{0, 0, 255, 1}, 10)\n\n    gocv.IMWrite(\"out/out.jpg\", matImage)\n}\n</code></pre>\n\n<p>Do you have any advice or snippet to solve this kind of problem?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 2, "last_activity_date": 1572330715, "creation_date": 1572330715, "answer_id": 58602387, "question_id": 58601982, "link": "https://stackoverflow.com/questions/58601982/whats-the-means-of-this-piece-of-go-codes-which-generated-by-thrift/58602387#58602387", "title": "What&#39;s the means of this piece of go codes which generated by thrift", "body": "<p>The code you are looking at is generated by a computer program.</p>\n\n<p>This particular computer program is defective / stupid: it imports packages that do not require importing in some cases, just in case it generated <em>different</em> code in which importing those packages would have been required.  In other words, <em>before</em> looking at what code it will generate, it just imports a bunch of things.</p>\n\n<p>To make up for this deficiency, after importing things it <em>might</em> not use otherwise, it has some <code>var</code> declarations that make the Go compilers think that those things <em>are</em> used, so that the compiler does not complain that (e.g.) <code>fmt</code> or <code>bytes</code> did not need to be imported.</p>\n\n<p>A smarter code-generator would inspect the code it is about to generate, figure out which imports are actually required, and emit those imports and skip the dummy <code>var</code> lines.</p>\n\n<p>(That is what the comment phrase:</p>\n\n<pre><code>naive import list construction\n</code></pre>\n\n<p>means: the code-generator naively generated a particular set of imports, without looking at the rest of the code it was generating.)</p>\n"}], "owner": {"reputation": 66, "user_id": 6026894, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Yt00XLMFnAo/AAAAAAAAAAI/AAAAAAAAABk/VyO6ebAWDEY/photo.jpg?sz=128", "display_name": "Junru Zhu", "link": "https://stackoverflow.com/users/6026894/junru-zhu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 58602387, "answer_count": 1, "score": -1, "last_activity_date": 1572330715, "creation_date": 1572327958, "question_id": 58601982, "link": "https://stackoverflow.com/questions/58601982/whats-the-means-of-this-piece-of-go-codes-which-generated-by-thrift", "title": "What&#39;s the means of this piece of go codes which generated by thrift", "body": "<p>This is piece of codes which generated by thrift official tutorial:\n<a href=\"https://thrift.apache.org/tutorial/go\" rel=\"nofollow noreferrer\">https://thrift.apache.org/tutorial/go</a></p>\n\n<p>I'm new to go, and could not guess what's the purpose of the codes from the comment. </p>\n\n<p>Googled with some keywords but no lucks.</p>\n\n<pre><code>package tutorial\n\nimport(\n    \"bytes\"\n    \"context\"\n    \"reflect\"\n    \"database/sql/driver\"\n    \"errors\"\n    \"fmt\"\n    \"github.com/apache/thrift/lib/go/thrift\"\n    \"shared\"\n\n)\n\n// (needed to ensure safety because of naive import list construction.)\nvar _ = thrift.ZERO\nvar _ = fmt.Printf\nvar _ = context.Background\nvar _ = reflect.DeepEqual\nvar _ = bytes.Equal\n</code></pre>\n"}, {"tags": ["json", "validation", "go", "request", "http-post"], "comments": [{"owner": {"reputation": 1052, "user_id": 7768287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ySIAC.png?s=128&g=1", "display_name": "Tiya Jose", "link": "https://stackoverflow.com/users/7768287/tiya-jose"}, "edited": false, "score": 1, "creation_date": 1572334358, "post_id": 58601947, "comment_id": 103517425, "body": "Check out this simple validator package for Go request validation: <a href=\"https://github.com/asaskevich/govalidator\" rel=\"nofollow noreferrer\">github.com/asaskevich/govalidator</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": true, "score": 6, "last_activity_date": 1572335721, "creation_date": 1572335721, "answer_id": 58603267, "question_id": 58601947, "link": "https://stackoverflow.com/questions/58601947/request-body-validation/58603267#58603267", "title": "Request body validation", "body": "<p>Reg validator package: <a href=\"https://godoc.org/gopkg.in/validator.v2\" rel=\"noreferrer\">https://godoc.org/gopkg.in/validator.v2</a></p>\n\n<pre><code>// main.go\npackage main\n\nimport (\n    \"net/http\"\n\n    \"github.com/gin-gonic/gin\"\n    \"gopkg.in/validator.v2\"\n)\n\ntype User struct {\n    Username string `json:\"username\" validate:\"min=1,max=16,regexp=^[a-zA-Z]*$\"`\n    Name     string `json:\"name\" validate:\"min=1,max=16\"`\n    Password string `json:\"password\" validate:\"min=1,max=16\"`\n}\n\nfunc loginHandler(ctx *gin.Context) {\n    var user User\n    if err := ctx.ShouldBindJSON(&amp;user); err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            \"error\": err.Error(),\n        })\n    }\n\n    if err := validator.Validate(user); err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            \"error\": err.Error(),\n        })\n    }\n}\n\nfunc main() {\n    r := gin.Default()\n    r.POST(\"/login\", loginHandler)\n    r.Run()\n}\n</code></pre>\n\n<p>Request: POST: localhost:8080/login</p>\n\n<pre><code>{\n    \"username\":\"123123\",\n    \"name\":\"golang\",\n    \"password\":\"gin\"\n}\n</code></pre>\n\n<p>Response: </p>\n\n<pre><code>{\n    \"error\": \"Username: regular expression mismatch \"\n}\n</code></pre>\n"}], "owner": {"reputation": 803, "user_id": 11324804, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100ef3bcefeb61283a72f73c4e90f323?s=128&d=identicon&r=PG&f=1", "display_name": "ligowsky", "link": "https://stackoverflow.com/users/11324804/ligowsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5227, "favorite_count": 0, "accepted_answer_id": 58603267, "answer_count": 1, "score": 4, "last_activity_date": 1610296897, "creation_date": 1572327709, "last_edit_date": 1610296897, "question_id": 58601947, "link": "https://stackoverflow.com/questions/58601947/request-body-validation", "title": "Request body validation", "body": "<p>I'm using gin to handle requests, but I'm having trouble validating data in a request body, e.g.</p>\n\n<pre><code>type User struct {\n    Username  string  `json:\"username\" binding:\"required,min=1,max=16\"`\n    Name  string  `json:\"name\" binding:\"required,min=1,max=16\"`\n    Password string `json:\"password\" binding:\"required,min=1,max=16\"`\n}\n\nfunc loginHandler(ctx *gin.Context) {\n    var user User\n    if err := ctx.ShouldBindJSON(&amp;user); err != nil {\n        ctx.JSON(http.StatusBadRequest, gin.H{\n            \"error\": err.Error(),\n        })\n}\n</code></pre>\n\n<p>How can I handle values with whitespaces like <code>\"  username \"</code> or <code>\" John   Doe \"</code>? As far as I know it's not possible to use regex in gin's validator. \nWhat are the best practices or patterns for request body validation in Golang? </p>\n"}, {"tags": ["go", "amazon-s3"], "answers": [{"tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": true, "score": 4, "last_activity_date": 1572320540, "last_edit_date": 1572320540, "creation_date": 1572320019, "answer_id": 58601134, "question_id": 58601105, "link": "https://stackoverflow.com/questions/58601105/how-to-convert-aws-writeatbuffer-to-an-io-reader/58601134#58601134", "title": "How to convert aws.WriteAtBuffer to an io.Reader?", "body": "<p>Use <a href=\"https://godoc.org/bytes#NewReader\" rel=\"nofollow noreferrer\">bytes.NewReader</a> to create an io.Reader on the <a href=\"https://godoc.org/github.com/aws/aws-sdk-go/aws#WriteAtBuffer.Bytes\" rel=\"nofollow noreferrer\">bytes in the buffer</a>:</p>\n\n<pre><code>result, err := uploader.Upload(&amp;s3manager.UploadInput{\n    Bucket: aws.String(targetS3Bucket),\n    Key:    aws.String(documentKey),\n    Body:   bytes.NewReader(buffer.Bytes()),\n})\n</code></pre>\n"}], "owner": {"reputation": 679, "user_id": 504055, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/3a6b45d359279adeb84a0f54ca4fda82?s=128&d=identicon&r=PG", "display_name": "Ogre", "link": "https://stackoverflow.com/users/504055/ogre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 685, "favorite_count": 0, "accepted_answer_id": 58601134, "answer_count": 1, "score": 0, "last_activity_date": 1572320540, "creation_date": 1572319718, "question_id": 58601105, "link": "https://stackoverflow.com/questions/58601105/how-to-convert-aws-writeatbuffer-to-an-io-reader", "title": "How to convert aws.WriteAtBuffer to an io.Reader?", "body": "<p>I need to download a file from S3, and then upload the same file into a different S3 bucket. So far I have:</p>\n\n<pre><code>sess := session.Must(session.NewSession())\ndownloader := s3manager.NewDownloader(sess)\n\nbuffer := aws.NewWriteAtBuffer([]byte{})\n\nn, err := downloader.Download(buffer, &amp;s3.GetObjectInput{\n    Bucket: aws.String(sourceS3Bucket),\n    Key:    aws.String(documentKey),\n})\n\nuploader := s3manager.NewUploader(sess)\nresult, err := uploader.Upload(&amp;s3manager.UploadInput{\n    Bucket: aws.String(targetS3Bucket),\n    Key:    aws.String(documentKey),\n    Body:   buffer,\n})\n</code></pre>\n\n<p>I have used an aws.WriteAtBuffer, as per the answer here: <a href=\"https://stackoverflow.com/a/48254996/504055\">https://stackoverflow.com/a/48254996/504055</a></p>\n\n<p>However, I am currently stuck on how to treat this buffer as something that implements the io.Reader interface, which is what the uploader's Upload method requires.</p>\n"}, {"tags": ["go", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 451, "user_id": 5671644, "user_type": "registered", "profile_image": "https://graph.facebook.com/965230240198588/picture?type=large", "display_name": "Fahim Abrar", "link": "https://stackoverflow.com/users/5671644/fahim-abrar"}, "is_accepted": true, "score": 2, "last_activity_date": 1572326980, "creation_date": 1572326980, "answer_id": 58601867, "question_id": 58600915, "link": "https://stackoverflow.com/questions/58600915/golang-module-use/58601867#58601867", "title": "Golang Module Use", "body": "<p>You are using version <a href=\"https://github.com/TheCacophonyProject/audiobait/tree/v2.0.0\" rel=\"nofollow noreferrer\">v2.0.0</a> of <code>github.com/TheCacophonyProject/audiobait</code>.</p>\n\n<p>This version doesn't contain <code>audiofilelibrary</code> package. But the <code>master</code> branch contains it.</p>\n\n<p>You can change your <code>go.mod</code> file like this to use the <code>master</code> branch.</p>\n\n<pre><code>module audiobaitpackagetest\n\ngo 1.13\n\nrequire github.com/TheCacophonyProject/audiobait master\n</code></pre>\n\n<p>Then run this commands:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go mod tidy\ngo mod vendor # if you want to vendor it\n</code></pre>\n"}], "owner": {"reputation": 573, "user_id": 3015449, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/csGZm.gif?s=128&g=1", "display_name": "davo36", "link": "https://stackoverflow.com/users/3015449/davo36"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 58601867, "answer_count": 1, "score": 0, "last_activity_date": 1572326980, "creation_date": 1572318105, "question_id": 58600915, "link": "https://stackoverflow.com/questions/58600915/golang-module-use", "title": "Golang Module Use", "body": "<p>I am trying to link to some code online: <a href=\"https://github.com/TheCacophonyProject/audiobait\" rel=\"nofollow noreferrer\">https://github.com/TheCacophonyProject/audiobait</a></p>\n\n<p>I am helping out with this project and have altered that repository to create a new package called audiofilelibrary.</p>\n\n<p>I am then trying to use that code in a very simple program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/TheCacophonyProject/audiobait/audiofilelibrary\"\n    \"github.com/TheCacophonyProject/audiobait/playlist\"\n)\n\nfunc main() {\n\n    audio := audioFileLibrary.AudioFileLibrary{}\n    fmt.Println(audio.soundsDirectory)\n    sched := playlist.Schedule{}\n    fmt.Println(sched.Description)\n\n}\n</code></pre>\n\n<p>You'll see I'm importing 2 packages from that repository, audiofilelibrary and playlist.  playlist works, audiofilelibrary does not.  They seem to be coded in the same way.</p>\n\n<p>This is the error I get:</p>\n\n<pre><code>$ go build\ngo: finding github.com/TheCacophonyProject/audiobait v2.0.0\ngo: finding github.com/nathan-osman/go-sunrise latest\ngo: finding github.com/TheCacophonyProject/audiobait/audiofilelibrary latest\nbuild audiobaitpackagetest: cannot load \ngithub.com/TheCacophonyProject/audiobait/audiofilelibrary: \ncannot find module providing package \ngithub.com/TheCacophonyProject/audiobait/audiofilelibrary\n</code></pre>\n\n<p>And this is my go.mod file, which is in a directory called audiobaitpackagetest:</p>\n\n<pre><code>module audiobaitpackagetest\n\ngo 1.13\n\nrequire github.com/TheCacophonyProject/audiobait v0.0.0-20191013210352-81b0afd9a085\n</code></pre>\n\n<p>I created the module with the command <code>go mod init audiobaitpackagetest</code>.</p>\n\n<p>How can I see the audiofilelibrary package please? As in, how can I import it into other code?</p>\n\n<p>The code for this question is all here, so it can be easily cloned and run: <a href=\"https://github.com/Davo36/audiobaitpackagetest\" rel=\"nofollow noreferrer\">https://github.com/Davo36/audiobaitpackagetest</a></p>\n\n<p>Any help much appreciated.</p>\n"}, {"tags": ["go", "networking"], "answers": [{"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 1, "last_activity_date": 1572321393, "creation_date": 1572321393, "answer_id": 58601255, "question_id": 58600784, "link": "https://stackoverflow.com/questions/58600784/translation-of-cidr-block-to-net-ip-type/58601255#58601255", "title": "Translation of CIDR block to net.IP type", "body": "<p>Well, this is being used at the root as a flag, and flags require the <a href=\"https://golang.org/pkg/flag/#Value\" rel=\"nofollow noreferrer\">flag.Value</a> interface.  And all that interface requires is that it is a <code>Stringer</code> and that it implements <code>Set(string) error</code>.  </p>\n\n<p><code>ipNetValue</code> does exactly that</p>\n\n<pre><code>func (ipnet ipNetValue) String() string {\n    n := net.IPNet(ipnet)\n    return n.String()\n}\n\nfunc (ipnet *ipNetValue) Set(value string) error {\n    _, n, err := net.ParseCIDR(strings.TrimSpace(value))\n    if err != nil {\n        return err\n    }\n    *ipnet = ipNetValue(*n)\n    return nil\n}\n</code></pre>\n\n<p>That leads us to <a href=\"https://golang.org/pkg/net/#ParseCIDR\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/#ParseCIDR</a>.</p>\n\n<p>Source: <a href=\"https://golang.org/src/net/ip.go?s=16363:16407#L699\" rel=\"nofollow noreferrer\">https://golang.org/src/net/ip.go?s=16363:16407#L699</a></p>\n"}], "owner": {"reputation": 1357, "user_id": 902171, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e328ca98eef09ca3806ea65bbe2aa3b5?s=128&d=identicon&r=PG", "display_name": "f-z-N", "link": "https://stackoverflow.com/users/902171/f-z-n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 58601255, "answer_count": 1, "score": 0, "last_activity_date": 1572343385, "creation_date": 1572316723, "last_edit_date": 1572343385, "question_id": 58600784, "link": "https://stackoverflow.com/questions/58600784/translation-of-cidr-block-to-net-ip-type", "title": "Translation of CIDR block to net.IP type", "body": "<p>I have this piece of code:</p>\n\n<pre><code>// redacted \nvar (\n        cidr        net.IPNet   \n        createCmd   = &amp;cobra.Command{\n            Use:   \"create\",\n            Short: \"create would create something useful\",\n            Long:  \"create submits a request for something useful creation based on parameters provided \",\n            Run: func(cmd *cobra.Command, args []string) {\n                //region comes from rootCmd\n\n                log.Infof(\"cidr: %v, ipmask: %v\", cidr, cidr.IP.DefaultMask())\n\n            },\n        }\n    )\n\nfunc init() {\n\n    createCmd.Flags().IPNetVar(&amp;cidr, \"vpc-cidr\", cidr, \"Vpc cidr range\")\n\n}\n\n// redacted\n</code></pre>\n\n<p>Ouput:</p>\n\n<pre><code>./somethinguseful create --cidr 192.168.100.0/24\nINFO[0000] cidr: {192.168.100.0 ffffff00}, ipmask: ffffff00\n</code></pre>\n\n<p>I am unable to comprehend at what stage does the command line argument 192.168.100.0/24 gets converted into an net.IP and Mask.</p>\n\n<p>Looking at <a href=\"https://chromium.googlesource.com/external/github.com/spf13/pflag/+/master/ipnet.go\" rel=\"nofollow noreferrer\">IPNet</a> code</p>\n\n<pre><code>func newIPNetValue(val net.IPNet, p *net.IPNet) *ipNetValue {\n    *p = val\n    return (*ipNetValue)(p) \n}\n// allocates default to pointer to net.IPNet if provided\n</code></pre>\n\n<p>There is no piece of code that translates input to the displayed output. How is the mask value calculated and printed out based on input which is cidr block. Any pointers please.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 0, "creation_date": 1572323633, "post_id": 58600189, "comment_id": 103514922, "body": "do you have &#39;js&#39; and &#39;css&#39; folders inside your &#39;pages&#39; folder?"}, {"owner": {"reputation": 1, "user_id": 5340664, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9d-a0pD69SU/AAAAAAAAAAI/AAAAAAAAAFU/EWb0keG2PKg/photo.jpg?sz=128", "display_name": "Sang Nguyen Trong", "link": "https://stackoverflow.com/users/5340664/sang-nguyen-trong"}, "reply_to_user": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 0, "creation_date": 1572327704, "post_id": 58600189, "comment_id": 103515652, "body": "I store &#39;js&#39; and &#39;css&#39; folders inside the &#39;pages&#39; folder, if I use &#39;/login/&#39;, it works, but not for &#39;/login&#39;"}, {"owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "edited": false, "score": 0, "creation_date": 1572328970, "post_id": 58600189, "comment_id": 103515954, "body": "update your code. <code>http.Handle(&quot;&#47;Login&#47;&quot;, http.StripPrefix(&quot;&#47;Login&quot;, fileServer))</code>. reference: <a href=\"https://stackoverflow.com/questions/28793619/golang-what-to-use-http-servefile-or-http-fileserver\" title=\"golang what to use http servefile or http fileserver\">stackoverflow.com/questions/28793619/&hellip;</a>"}, {"owner": {"reputation": 1, "user_id": 5340664, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9d-a0pD69SU/AAAAAAAAAAI/AAAAAAAAAFU/EWb0keG2PKg/photo.jpg?sz=128", "display_name": "Sang Nguyen Trong", "link": "https://stackoverflow.com/users/5340664/sang-nguyen-trong"}, "edited": false, "score": 0, "creation_date": 1572330324, "post_id": 58600189, "comment_id": 103516298, "body": "It works, but on the web browser, when I type <b>localhost:8080/Login</b> and press Enter, the path will automatically change to <b>localhost:8080/Login/</b>, I want to remove the last slash, the url must be <b>localhost:8080/Login</b>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1572334946, "post_id": 58600189, "comment_id": 103517658, "body": "This is how the default muxer works and cannot be changed without using a different muxer."}, {"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 1, "creation_date": 1572334971, "post_id": 58600189, "comment_id": 103517677, "body": "I think you don&#39;t really understand what&#39;s going on. It&#39;s hard to see how the url changing has anything to do with js and css files not loading."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1572336026, "post_id": 58600189, "comment_id": 103518050, "body": "@Volker, registering the same handler for /x/ and /x disables the redirect. <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#ServeMux</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1572338479, "post_id": 58600189, "comment_id": 103518942, "body": "@Peter Neat trick. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10914773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ryZPy.jpg?s=128&g=1", "display_name": "sober", "link": "https://stackoverflow.com/users/10914773/sober"}, "edited": false, "score": 0, "creation_date": 1572318258, "post_id": 58600929, "comment_id": 103514011, "body": "hope this helps"}, {"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 0, "creation_date": 1572334895, "post_id": 58600929, "comment_id": 103517637, "body": "I think this doesn&#39;t answer the question, and you seem to not understand what OP is asking"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1572335319, "post_id": 58600929, "comment_id": 103517799, "body": "The question is how to disable the automatic redirect from /Login to /Login/, not how to trim a trailing slash of a string."}], "tags": [], "owner": {"reputation": 3, "user_id": 10914773, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ryZPy.jpg?s=128&g=1", "display_name": "sober", "link": "https://stackoverflow.com/users/10914773/sober"}, "is_accepted": false, "score": -2, "last_activity_date": 1572318218, "creation_date": 1572318218, "answer_id": 58600929, "question_id": 58600189, "link": "https://stackoverflow.com/questions/58600189/golang-how-remove-the-last-trailing-slash-on-static-serving/58600929#58600929", "title": "Golang How remove the last trailing slash on static serving", "body": "<pre><code>package main\nimport (\n    \"fmt\"\n)\nfunc main() {\n  var s string = \"localhost:8080/Login/\"\n  fmt.Println(s)\n  for _,i := range s{\n    fmt.Println(\"hi,test data -&gt;\",string(i))\n  }\n  fmt.Println(\"This string len is \",len(s))\n  fmt.Println(\"You want \",string(s[0:len(s)-1]))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 0, "last_activity_date": 1572335118, "creation_date": 1572335118, "answer_id": 58603160, "question_id": 58600189, "link": "https://stackoverflow.com/questions/58600189/golang-how-remove-the-last-trailing-slash-on-static-serving/58603160#58603160", "title": "Golang How remove the last trailing slash on static serving", "body": "<p>You are basically mounting your frontend at \"/Login\".</p>\n\n<p>But your js and css are being requested from \"/\"</p>\n\n<p>So of course they won't be loaded.</p>\n\n<p>You have to either:</p>\n\n<ol>\n<li><p>Change your css and js references to be \"/Login/js/....\" and \"/Login/css/...\"</p>\n\n<p>This doesn't seem like what you actually want to do though</p></li>\n<li><p>Or, mount the frontend at \"/\"</p>\n\n<pre><code>http.Handle(\"/\", fileServer)\n</code></pre></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 1, "last_activity_date": 1572335834, "creation_date": 1572335834, "answer_id": 58603293, "question_id": 58600189, "link": "https://stackoverflow.com/questions/58600189/golang-how-remove-the-last-trailing-slash-on-static-serving/58603293#58603293", "title": "Golang How remove the last trailing slash on static serving", "body": "<p>user10753492 is correct. Because you're using rooted paths for the CSS and JS files the trailing slash doesn't matter as far as the requests for the CSS and JS files are concerned.</p>\n\n<p>As for the redirect to /Login/: <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\">this behavior is documented along with instructions on how to prevent that</a>:</p>\n\n<blockquote>\n  <p>If a subtree has been registered and a request is received naming the subtree root without its trailing slash, ServeMux redirects that request to the subtree root (adding the trailing slash). This behavior can be overridden with a separate registration for the path without the trailing slash.</p>\n</blockquote>\n\n<p>So if you don't want the redirect, register the same handler for both /Login and /Login/.</p>\n"}], "owner": {"reputation": 1, "user_id": 5340664, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9d-a0pD69SU/AAAAAAAAAAI/AAAAAAAAAFU/EWb0keG2PKg/photo.jpg?sz=128", "display_name": "Sang Nguyen Trong", "link": "https://stackoverflow.com/users/5340664/sang-nguyen-trong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1154, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1572335834, "creation_date": 1572310600, "question_id": 58600189, "link": "https://stackoverflow.com/questions/58600189/golang-how-remove-the-last-trailing-slash-on-static-serving", "title": "Golang How remove the last trailing slash on static serving", "body": "<p>I want to remove the last trailing slash in the path, ex: <strong>localhost:8080/Login/</strong> --> <strong>localhost:8080/Login</strong>. In code, I use <strong>/login</strong> instead of <strong>/login/</strong> but <strong>css</strong> and <strong>js</strong> don't work, please help!</p>\n\n<p>This is my code:</p>\n\n<p>Go file:</p>\n\n<pre><code>func main() {\n    fileServer := http.FileServer(http.Dir(\"pages\"))\n    //http.Handle(\"/Login/\", http.StripPrefix(\"/Login/\", fileServer))\n    http.Handle(\"/Login\", http.StripPrefix(\"/Login\", fileServer))\n\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>HTTP file:</p>\n\n<pre><code>&lt;link href=\"/css/bootstrap/bootstrap-4.3.1.css\" rel=\"stylesheet\" /&gt;\n&lt;script src=\"/js/bootstrap/bootstrap-4.3.1.js\"&gt;&lt;/script&gt;\n</code></pre>\n"}, {"tags": ["postgresql", "go", "url"], "comments": [{"owner": {"reputation": 5, "user_id": 7004648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/711f9c04151f1108aec3d6f466c64824?s=128&d=identicon&r=PG&f=1", "display_name": "Idoncare", "link": "https://stackoverflow.com/users/7004648/idoncare"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1572313296, "post_id": 58600187, "comment_id": 103513130, "body": "Thank you for your comment. But it can not read multiple ids from URL: domain_host/user/profile/details/list?user-ids=97&amp;user-ids=1&zwnj;&#8203;&amp;user-ids=15"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1572326760, "post_id": 58600187, "comment_id": 103515448, "body": "Stop using <code>interface{}</code> would help a lot."}], "answers": [{"tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": true, "score": 0, "last_activity_date": 1572314299, "last_edit_date": 1572314299, "creation_date": 1572313978, "answer_id": 58600525, "question_id": 58600187, "link": "https://stackoverflow.com/questions/58600187/how-to-read-list-of-query-params/58600525#58600525", "title": "How to read list of query params", "body": "<p>Parse the form and copy the <code>[]string</code> in the form to an <code>[]interface{}</code>. The Go FAQ <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">explains why copy is required</a>.</p>\n\n<pre><code>r.ParseForm()\nuserIDs := make([]interface{}, len(r.Form[\"user-id\"]))\nfor i, s := range r.Form[\"user-id\"] {\n   userIDs[i] = s\n}\n\nusers, err := users.ListUser(userIDs)\n</code></pre>\n\n<p>(The question and a comment disagree on the name of the query parameter. Adjust the code in the answer to match the actual name.)</p>\n"}], "owner": {"reputation": 5, "user_id": 7004648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/711f9c04151f1108aec3d6f466c64824?s=128&d=identicon&r=PG&f=1", "display_name": "Idoncare", "link": "https://stackoverflow.com/users/7004648/idoncare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 58600525, "answer_count": 1, "score": -1, "last_activity_date": 1572314524, "creation_date": 1572310579, "last_edit_date": 1572314524, "question_id": 58600187, "link": "https://stackoverflow.com/questions/58600187/how-to-read-list-of-query-params", "title": "How to read list of query params", "body": "<p>I have a method that takes a list of userIDs and return a list of users' details.</p>\n\n<pre><code>func ListUser(userIDs []interface{}) (users []User, err error) {\n    // query on DB based on userID and return list of users\n    return users, nil\n}\n</code></pre>\n\n<p>Now I want to expose an API endpoint for it. So, I am trying to get the userIDs from my URL.</p>\n\n<pre><code>func ListUserProfile(w http.ResponseWriter, r *http.Request) {\n    // I know I can get the single value using \n         //r.URL.Query().Get(\"user-id\")\n\n    // but here List user takes []interface{} as a argument\n    users, err := users.ListUser(userIDs)\n}\n</code></pre>\n\n<p>Is there have any way I can get the list of userIDS from my URL.</p>\n"}, {"tags": ["go", "gmail-api"], "comments": [{"owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1572308604, "post_id": 58599277, "comment_id": 103512311, "body": "Although I&#39;m not sure whether this is the direction you want, for example, how about using <a href=\"https://developers.google.com/gmail/api/guides/batch\" rel=\"nofollow noreferrer\">Batching Requests</a>?"}, {"owner": {"reputation": 74, "user_id": 3357984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7263d56135694c5f1f362759782f3b1?s=128&d=identicon&r=PG&f=1", "display_name": "not_fubar_yet", "link": "https://stackoverflow.com/users/3357984/not-fubar-yet"}, "reply_to_user": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1572325424, "post_id": 58599277, "comment_id": 103515226, "body": "yeah still seems like the only way, which is to be deprecated &lt; a year."}], "answers": [{"tags": [], "owner": {"reputation": 3463, "user_id": 12152337, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kYZUH.jpg?s=128&g=1", "display_name": "carlesgg97", "link": "https://stackoverflow.com/users/12152337/carlesgg97"}, "is_accepted": true, "score": 2, "last_activity_date": 1572340337, "creation_date": 1572340337, "answer_id": 58604314, "question_id": 58599277, "link": "https://stackoverflow.com/questions/58599277/gmail-api-batch-request-to-get-multiple-messages-at-once-golang/58604314#58604314", "title": "gmail api batch request to get multiple messages at once golang", "body": "<h3>Answer</h3>\n\n<p>There is a <a href=\"https://github.com/googleapis/google-api-go-client/issues/179\" rel=\"nofollow noreferrer\">Github issue</a> on the Go client's repo regarding this topic, and apparently it is not likely to see support for this feature anytime soon. It may, however, be implemented in the next generation of the client.</p>\n\n<h3>Possible workaround</h3>\n\n<p>You can implement yourself the batching feature, by making HTTP calls to the <code>www.googleapis.com/batch</code> or <code>www.googleapis.com/batch/api/version</code> endpoints. The former is due to be deprecated in <a href=\"https://developers.google.com/gmail/api/guides/batch\" rel=\"nofollow noreferrer\">August 12, 2020</a> but you can still use the latter past this date for <em>homogeneous</em> requests (in your case, doing GET requests based on messageId, you should have no problem doing so). You can read more about this in the following Official Google Developers Blog post: <a href=\"https://developers.googleblog.com/2018/03/discontinuing-support-for-json-rpc-and.html\" rel=\"nofollow noreferrer\">https://developers.googleblog.com/2018/03/discontinuing-support-for-json-rpc-and.html</a></p>\n"}], "owner": {"reputation": 74, "user_id": 3357984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7263d56135694c5f1f362759782f3b1?s=128&d=identicon&r=PG&f=1", "display_name": "not_fubar_yet", "link": "https://stackoverflow.com/users/3357984/not-fubar-yet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 58604314, "answer_count": 1, "score": 2, "last_activity_date": 1572340337, "creation_date": 1572302366, "question_id": 58599277, "link": "https://stackoverflow.com/questions/58599277/gmail-api-batch-request-to-get-multiple-messages-at-once-golang", "title": "gmail api batch request to get multiple messages at once golang", "body": "<p>Is there a batch Get messages? from the golang client library?</p>\n\n<p>I dont see it \n<a href=\"https://godoc.org/google.golang.org/api/gmail/v1\" rel=\"nofollow noreferrer\">https://godoc.org/google.golang.org/api/gmail/v1</a></p>\n\n<p>i can get a list of message ids, but have to get the message per Id, one at a time.</p>\n"}, {"tags": ["mysql", "go", "percona"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1572302247, "post_id": 58599236, "comment_id": 103511071, "body": "In the first <code>Exec</code> you set <code>autocommit=0</code>, so maybe you have to commit it after the <code>UPDATE</code> statement? Or set autocommit back to its original value after the first statement."}, {"owner": {"reputation": 23, "user_id": 11424320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdc13f9a1ff62ba9248ed8eee65cd742?s=128&d=identicon&r=PG&f=1", "display_name": "Uranus", "link": "https://stackoverflow.com/users/11424320/uranus"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1572302333, "post_id": 58599236, "comment_id": 103511093, "body": "I set autocommit to original value (autocommit=1) after <code>LOAD DATA</code>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1572302497, "post_id": 58599236, "comment_id": 103511131, "body": "Yes you do. I missed that. Sorry."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1572321803, "post_id": 58599236, "comment_id": 103514627, "body": "The fact that closing and reopening your connection fixes it, plus the fact that you are starting with <code>set autocommit = 0</code> (regardless of resetting it to 1) makes me very suspicious."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1572340713, "post_id": 58599236, "comment_id": 103519905, "body": "sql.Open does not return a connection. Go sql library maintains a connection pool behind the scenes. Each call to db.Exec or db.Query etc can run on different connections. Use a transaction to ensure calls are on the same database connection. See <a href=\"http://go-database-sql.org/modifying.html\" rel=\"nofollow noreferrer\">Modifying Data and Using Transactions</a>."}, {"owner": {"reputation": 23, "user_id": 11424320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdc13f9a1ff62ba9248ed8eee65cd742?s=128&d=identicon&r=PG&f=1", "display_name": "Uranus", "link": "https://stackoverflow.com/users/11424320/uranus"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1572370961, "post_id": 58599236, "comment_id": 103535774, "body": "@Mark Using <code>Begin()</code> and <code>Commit()</code> fixed the issue, but I can&#39;t say I understand why. Especially since other <code>.Exec()</code> commands work fine without Begin and Commit called."}], "owner": {"reputation": 23, "user_id": 11424320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdc13f9a1ff62ba9248ed8eee65cd742?s=128&d=identicon&r=PG&f=1", "display_name": "Uranus", "link": "https://stackoverflow.com/users/11424320/uranus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 257, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1572302506, "creation_date": 1572302018, "last_edit_date": 1572302506, "question_id": 58599236, "link": "https://stackoverflow.com/questions/58599236/go-sql-exec-not-changing-value-in-database", "title": "Go SQL Exec not changing value in database", "body": "<p>I wrote a program that creates and loads data into a database using <code>LOAD DATA INFILE</code>. The LOAD DATA part works fine, but after that I run UPDATE query. The update query returns nil as an error, and return that 1 row was affected (as expected). But when I check in the database, the value never changed. When I run UPDATE query manually in MySQL console, it works fine. Also, there are no locked or \"hanging\" queries. Here is the code:</p>\n\n<pre><code>// Load data\nvar loadDataCommand = fmt.Sprintf(\"set autocommit = 0; set foreign_key_checks = 0; set sql_log_bin = 0; LOAD DATA LOCAL INFILE '%s' INTO TABLE %s COLUMNS TERMINATED BY ',' IGNORE 1 LINES; commit; set autocommit = 1; set foreign_key_checks = 1; set sql_log_bin = 1;\", filepath.Join(directoryName, tableName + \".txt\"), tableName))\n_, err := db.Exec(loadDataCommand)\nif err != nil { panic(err) }\n\n\n// Update table\n_, err = db.Exec(fmt.Sprintf(\"UPDATE states.cities SET states.cities.online = %d WHERE states.cities.city_id = '%s'\", status, cityId))\n</code></pre>\n\n<p>The only way I managed to \"fix\" this is to close and reopen the database connection. This is how I open the connection. </p>\n\n<pre><code>newDbConnection, err := sql.Open(DatabaseDriver, DatabaseUser+\":\"+DatabasePassword+\"@tcp(\"+DatabaseAddress+\":3306)/\"+DatabaseName+\"?multiStatements=true\")\n\nif err == nil {\n    newDbConnection.SetMaxOpenConns(MaxNumberOfDatabaseConnections)\n    newDbConnection.SetMaxIdleConns(MaxNumberOfDatabaseConnections)\n    newDbConnection.SetConnMaxLifetime(MaxAgeOfDatabaseConnection)\n\n    db = newDbConnection\n}\n</code></pre>\n\n<p>Also if I run the UPDATE query before <code>LOAD DATA</code>, it works fine. The weirdest part is that the UPDATE query returns correct value (1 row affected) and nil as an error...</p>\n"}, {"tags": ["string", "go", "delimiter", "trim"], "answers": [{"tags": [], "owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "is_accepted": false, "score": 2, "last_activity_date": 1572300609, "creation_date": 1572300609, "answer_id": 58599044, "question_id": 58599012, "link": "https://stackoverflow.com/questions/58599012/remove-all-characters-after-a-delimiter-in-a-string/58599044#58599044", "title": "Remove all characters after a delimiter in a string", "body": "<p>Use the <a href=\"https://golang.org/pkg/net/url\" rel=\"nofollow noreferrer\"><code>url</code></a> package:</p>\n\n<pre><code>u, _ := url.Parse(\"SOME_URL_HERE\")\nu.Fragment = \"\"\nreturn u.String()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": true, "score": 2, "last_activity_date": 1572305866, "creation_date": 1572305866, "answer_id": 58599721, "question_id": 58599012, "link": "https://stackoverflow.com/questions/58599012/remove-all-characters-after-a-delimiter-in-a-string/58599721#58599721", "title": "Remove all characters after a delimiter in a string", "body": "<p>An improvement on the answer by Luke Joshua Park is to parse the URL relative to the URL of the source page. This creates an absolute URL from what might be relative URL on the page (scheme not specified, host not specified, relative path). Another improvement is to check and handle errors.</p>\n\n<pre><code>func clean(pageURL, linkURL string) (string, error) {\n    p, err := url.Parse(pageURL)\n    if err != nil {\n        return \"\", err\n    }\n    l, err := p.Parse(linkURL)\n    if err != nil {\n        return \"\", err\n    }\n    l.Fragment = \"\"   // chop off the fragment\n    return l.String()\n}\n</code></pre>\n\n<p>If you are not interested in getting an absolute URL, then chop off everything after the #.  This works because the only valid use of # in a URL is the fragment separator.</p>\n\n<pre><code> func clean(linkURL string) string {\n    i := strings.LastIndexByte(linkURL, '#')\n    if i &lt; 0 {\n        return linkURL\n    }\n    return linkURL[:i]\n }\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11656113"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 58599721, "answer_count": 2, "score": 0, "last_activity_date": 1572305866, "creation_date": 1572300416, "question_id": 58599012, "link": "https://stackoverflow.com/questions/58599012/remove-all-characters-after-a-delimiter-in-a-string", "title": "Remove all characters after a delimiter in a string", "body": "<p>I am building a web crawler application in golang.</p>\n\n<p>After downloading the HTML of a page, I separate out the URLs. \n I am presented with URLs that have \"#s\" in them, such as \"en.wikipedia.org/wiki/Race_condition#Computing\".  I would like to get rid of all characters following the \"#\", since these lead to the same page anyways.  Any advice for how to do so?</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1572403457, "post_id": 58599000, "comment_id": 103545267, "body": "Which version of <code>mongo-go-driver</code> ? Which version of Go ? Could you do a normal go build to test without the <code>gcloud</code> ? What&#39;s your operating system ? Cheers."}, {"owner": {"reputation": 57, "user_id": 7148186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xn46R.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/7148186/adam"}, "reply_to_user": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1572424973, "post_id": 58599000, "comment_id": 103551068, "body": "<b>go build</b> runs fine,and <b>go run main.go</b> starts the app, and all works fine locally. <b>go version go1.13.3</b> (I&#39;ve tried it on both linux and windows, with the same result). No Idea on the driver version...whatever you get when you run <b>go get go.mongodb.org/mongo-driver</b>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12559838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc869ea5fde34b09c55856f478be7c4a?s=128&d=identicon&r=PG&f=1", "display_name": "sticky_rice_eater", "link": "https://stackoverflow.com/users/12559838/sticky-rice-eater"}, "is_accepted": false, "score": 0, "last_activity_date": 1576739725, "last_edit_date": 1576739725, "creation_date": 1576733411, "answer_id": 59403759, "question_id": 58599000, "link": "https://stackoverflow.com/questions/58599000/gcloud-app-deploy-failing-with-mongo-driver-because-of-datadog-zstd/59403759#59403759", "title": "Gcloud app deploy failing with mongo-driver because of DataDog/zstd", "body": "<p>Have you tried specifying dependencies with <strong>go mod</strong> yet?\nI faced the same issue and finally can solved by generating <strong>go.mod</strong> file with these command,</p>\n\n<pre><code>GO111MODULE=on go mod init\n\nGO111MODULE=on go mod tidy\n</code></pre>\n\n<p><a href=\"https://cloud.google.com/functions/docs/writing/specifying-dependencies-go\" rel=\"nofollow noreferrer\">Here</a> is the details explanation.</p>\n"}], "owner": {"reputation": 57, "user_id": 7148186, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xn46R.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/7148186/adam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576739725, "creation_date": 1572300338, "question_id": 58599000, "link": "https://stackoverflow.com/questions/58599000/gcloud-app-deploy-failing-with-mongo-driver-because-of-datadog-zstd", "title": "Gcloud app deploy failing with mongo-driver because of DataDog/zstd", "body": "<p>I have been using mongo-driver in my project, deploying with gcloud app deploy for a while now. I recently rebuild my machine, and simply ran <strong>go get</strong> to get fetch ally my dependencies. Everything is compiling fine locally, however, <strong>gcloud app deploy</strong> fails:</p>\n\n<pre><code>    Failed to build app: building app with command '[go build -o /tmp/staging/usr/local/bin/start ***\\admin]', env '[PATH=/go/bin:/usr/local/go/bin:/builder/google-cloud-sdk/bin/:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin HOSTNAME=***HOME=/builder/home BUILDER_OUTPUT=/builder/outputs DEBIAN_FRONTEND=noninteractive GOROOT=/usr/local/go/ GOPATH=/go GOPATH=/tmp/staging/srv/gopath]': err=exit status 1, out=srv/gopath/src/go.mongodb.org/mongo-driver/x/mongo/driver/compression_cgo.go:15:2: cannot find package \"github.com/DataDog/zstd\" in any of:\n    /tmp/staging/srv/gopath/src/go.mongodb.org/mongo-driver/vendor/github.com/DataDog/zstd (vendor tree)\n    /usr/local/go/src/github.com/DataDog/zstd (from $GOROOT)\n    /tmp/staging/srv/gopath/src/github.com/DataDog/zstd (from $GOPATH).\n</code></pre>\n\n<p>Any ideas? app.yaml is just <strong>runtime: go113</strong></p>\n"}, {"tags": ["go", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 650, "user_id": 10556525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ccd7e7dd3b1906fd56323d918c77d3?s=128&d=identicon&r=PG&f=1", "display_name": "Joris", "link": "https://stackoverflow.com/users/10556525/joris"}, "is_accepted": true, "score": 4, "last_activity_date": 1572301706, "last_edit_date": 1572301706, "creation_date": 1572296739, "answer_id": 58598414, "question_id": 58598354, "link": "https://stackoverflow.com/questions/58598354/parsing-go-mod-unexpected-module-path-howett-net-plist/58598414#58598414", "title": "Parsing go.mod: unexpected module path &quot;howett.net/plist&quot;", "body": "<p>This module has its identity in <a href=\"https://github.com/DHowett/go-plist/blob/master/go.mod\" rel=\"nofollow noreferrer\"><code>go.mod</code></a> defined as <code>howett.net/plist</code> instead of <code>github.com/DHowett/go-plist</code>.</p>\n\n<p>If you run this, it should work fine:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go get howett.net/plist\n</code></pre>\n\n<p>See also <a href=\"https://github.com/golang/go/wiki/Modules#how-can-i-resolve-parsing-gomod-unexpected-module-path-and-error-loading-module-requirements-errors-caused-by-a-mismatch-between-import-paths-vs-declared-module-identity\" rel=\"nofollow noreferrer\">this entry</a> in the official Golang Wiki</p>\n"}, {"tags": [], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "is_accepted": false, "score": 0, "last_activity_date": 1572299958, "creation_date": 1572299958, "answer_id": 58598933, "question_id": 58598354, "link": "https://stackoverflow.com/questions/58598354/parsing-go-mod-unexpected-module-path-howett-net-plist/58598933#58598933", "title": "Parsing go.mod: unexpected module path &quot;howett.net/plist&quot;", "body": "<p>I ended up fixing this by replacing </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import \"github.com/DHowett/go-plist\n</code></pre>\n\n<p>everywhere in the module that I wanted to import by</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import \"howett.net/plist\n</code></pre>\n\n<p>and running <code>go mod tidy</code>. After that, I was able to import it without errors.</p>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 58598414, "answer_count": 2, "score": 1, "last_activity_date": 1572301706, "creation_date": 1572296425, "question_id": 58598354, "link": "https://stackoverflow.com/questions/58598354/parsing-go-mod-unexpected-module-path-howett-net-plist", "title": "Parsing go.mod: unexpected module path &quot;howett.net/plist&quot;", "body": "<p>I'd like to import a Go module which has the following in its <code>go.mod</code>:</p>\n\n<pre><code>&gt; grep plist go.mod\n    github.com/DHowett/go-plist v0.0.0-20180609054337-500bd5b9081b\n    howett.net/plist v0.0.0-20181124034731-591f970eefbb // indirect\n</code></pre>\n\n<p>However, if I try to <code>go get</code> that package I get the following error message:</p>\n\n<pre><code>go: github.com/DHowett/go-plist@v0.0.0-20181124034731-591f970eefbb: parsing go.mod: unexpected module path \"howett.net/plist\"\ngo get: error loading module requirements\n</code></pre>\n\n<p>I also get this error if I just try to <code>go get github.com/DHowett/go-plist</code>:</p>\n\n<pre><code>&gt; go get github.com/DHowett/go-plist\ngo: finding github.com/DHowett/go-plist latest\ngo: github.com/DHowett/go-plist@v0.0.0-20181124034731-591f970eefbb: parsing go.mod: unexpected module path \"howett.net/plist\"\ngo: error loading module requirements\n</code></pre>\n\n<p>How can I fix this error so that I can import that module?</p>\n"}, {"tags": ["go", "goland"], "comments": [{"owner": {"reputation": 1129, "user_id": 1073351, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8d1da17c32728856fd0a9aaeab3b48be?s=128&d=identicon&r=PG", "display_name": "Mark McWhirter", "link": "https://stackoverflow.com/users/1073351/mark-mcwhirter"}, "edited": false, "score": 0, "creation_date": 1572303902, "post_id": 58598304, "comment_id": 103511428, "body": "This would be more readable if you embedded the expected and actual code."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1572330129, "post_id": 58598304, "comment_id": 103516238, "body": "What happens if you run <code>mockery</code> on the same file from the CLI? Do you get the same results as in the IDE?"}, {"owner": {"reputation": 9, "user_id": 12286522, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OPFrNaW0zZ0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdWLAPuWdmm4452uTFesiPI5O6Vxg/photo.jpg?sz=128", "display_name": "Nathan Yang", "link": "https://stackoverflow.com/users/12286522/nathan-yang"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1572378495, "post_id": 58598304, "comment_id": 103538707, "body": "@dlsniper same behaviour. Basically it makes no difference running <code>mockery</code> either on a terminal or click the green triangular button on the interface file. After running other command such as <code>goimports</code> typically you need to to click on a source file to trigger the change but <code>mockery</code> doesn&#39;t even need you to do that."}, {"owner": {"reputation": 9, "user_id": 12286522, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OPFrNaW0zZ0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdWLAPuWdmm4452uTFesiPI5O6Vxg/photo.jpg?sz=128", "display_name": "Nathan Yang", "link": "https://stackoverflow.com/users/12286522/nathan-yang"}, "reply_to_user": {"reputation": 1129, "user_id": 1073351, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8d1da17c32728856fd0a9aaeab3b48be?s=128&d=identicon&r=PG", "display_name": "Mark McWhirter", "link": "https://stackoverflow.com/users/1073351/mark-mcwhirter"}, "edited": false, "score": 0, "creation_date": 1572378559, "post_id": 58598304, "comment_id": 103538732, "body": "@MarkMcWhirter thanks for pointing it out. I&#39;ve updated my question."}], "owner": {"reputation": 9, "user_id": 12286522, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-OPFrNaW0zZ0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdWLAPuWdmm4452uTFesiPI5O6Vxg/photo.jpg?sz=128", "display_name": "Nathan Yang", "link": "https://stackoverflow.com/users/12286522/nathan-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1572377771, "creation_date": 1572296196, "last_edit_date": 1572377771, "question_id": 58598304, "link": "https://stackoverflow.com/questions/58598304/running-mockery-changes-the-default-format-of-mock-interface-go", "title": "Running `mockery` changes the default format of `mock_interface.go`", "body": "<p>On my GoLand, I have both <code>go fmt</code> and <code>goimports</code> disabled, however, when I run the <code>mockery</code> command to re-generate <code>mock_interface.go</code> the format changes. It turns out that whether or not <code>goimports</code> and <code>go fmt</code> are on or off doesn't make a difference to the format changing during the re-generating process. All file watchers on my IDE are set to default and when my fellows run the same command their <code>mock_interface.go</code> files don't change format at all. And their file watchers are on.\nTo elaborate, we expect to see the auto-generated <code>mock_interface.go</code> to look like this:</p>\n\n<pre><code>import context \"context\"\nimport mock \"github.com/stretchr/testify/mock\"\nimport model \"github.com/some/repository\"\n</code></pre>\n\n<p>however, what I've got after running <code>mockery</code> is this:</p>\n\n<pre><code>import (\n    context \"context\"\n\n    mock \"github.com/stretchr/testify/mock\"\n    model \"github.com/some/repository\"\n)\n</code></pre>\n\n<p>Essentially, the imports look weirdly. Although it doesn't affect the coding logic at all, how do I fix it?</p>\n"}, {"tags": ["go", "psql", "pgx"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1572293213, "post_id": 58597639, "comment_id": 103508014, "body": "Advice: do not defer before the error check, if err is not nil rows <i>will</i> be nil and since you&#39;re defering before the error check the defer will be triggered upon return from the error check and Close will be called on a <code>nil</code> rows instance. Not good practice."}, {"owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572293822, "post_id": 58597639, "comment_id": 103508234, "body": "Thanks, not solving the problem but I&#39;ve updated my functions."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1572293918, "post_id": 58597639, "comment_id": 103508268, "body": "conn busy indicates that you&#39;re missing a Close call somewhere, probably in other parts of the program that share the DB instance."}, {"owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "edited": false, "score": 0, "creation_date": 1572294052, "post_id": 58597639, "comment_id": 103508317, "body": "ok, nothing to do with simultaneity of the request then ? I&#39;ll check again for the close call."}, {"owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "edited": false, "score": 0, "creation_date": 1572297567, "post_id": 58597639, "comment_id": 103509597, "body": "might have something to do with context also. Still looking."}], "answers": [{"tags": [], "owner": {"reputation": 650, "user_id": 10556525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ccd7e7dd3b1906fd56323d918c77d3?s=128&d=identicon&r=PG&f=1", "display_name": "Joris", "link": "https://stackoverflow.com/users/10556525/joris"}, "is_accepted": true, "score": 6, "last_activity_date": 1572298084, "creation_date": 1572298084, "answer_id": 58598634, "question_id": 58597639, "link": "https://stackoverflow.com/questions/58597639/how-to-make-multiple-query-in-a-very-short-interval-simultaneously/58598634#58598634", "title": "How to make multiple query in a very short interval / simultaneously", "body": "<p><code>pgx.Connect()</code> returns a <code>pgx.Conn</code> which cannot be used concurrently. This is what the <a href=\"https://godoc.org/github.com/jackc/pgx#Conn\" rel=\"noreferrer\">godocs</a> of this type state:</p>\n\n<blockquote>\n  <p>Conn is a PostgreSQL connection handle. It is not safe for concurrent usage. Use a connection pool to manage access to multiple database connections from multiple goroutines. </p>\n</blockquote>\n\n<p>So if you replace <code>pgx.Connect()</code> with <code>pgxpool.Connect()</code> from <code>github.com/jackc/pgx/pgxpool</code> you should be fine.</p>\n"}, {"comments": [{"owner": {"reputation": 341, "user_id": 8814467, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/810ced661ac8fff319d7b8fd3801c18c?s=128&d=identicon&r=PG&f=1", "display_name": "Aliy", "link": "https://stackoverflow.com/users/8814467/aliy"}, "edited": false, "score": 1, "creation_date": 1617038786, "post_id": 64600326, "comment_id": 118184377, "body": "thanks for the complete answer. just one question thou. why they did not mention it in their documentation and dont we always connect to db simultaneously? why is it designed as a single connection api? . @DhiaTN"}], "tags": [], "owner": {"reputation": 7775, "user_id": 5658350, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3vhKa.png?s=128&g=1", "display_name": "DhiaTN", "link": "https://stackoverflow.com/users/5658350/dhiatn"}, "is_accepted": false, "score": 2, "last_activity_date": 1604012023, "creation_date": 1604012023, "answer_id": 64600326, "question_id": 58597639, "link": "https://stackoverflow.com/questions/58597639/how-to-make-multiple-query-in-a-very-short-interval-simultaneously/64600326#64600326", "title": "How to make multiple query in a very short interval / simultaneously", "body": "<p>The <code>r.Db</code> returned by <code>pgx.Connect(context.Background(), os.Getenv(&quot;PSQL_URL&quot;))</code> if of type <code>*pgx.Conn</code> and represents a single connection which is not concurrency safe. Usually, you would like to use a connection pool to handle the concurrency for you and allows reusing open connection.\nTo use a connection pool replace the <code>import github.com/jackc/pgx/v4</code> with <code>github.com/jackc/pgx/v4/pgxpool</code> and connect with <code>pgxpool.Connect()</code> instead of <code>pgx.Connect()</code> and the api will be the same:</p>\n<pre><code>r.Pool := pgxpool.Connect(context.Background(), os.Getenv(&quot;PSQL_URL&quot;))\nr.Pool.Query(context.Background(), query)\n...\n</code></pre>\n<p>if at any given point you need to use a single connection to access some lower-level feature you can safely acquire a concurrent safe connection as follow:</p>\n<pre><code>conn, err := r.Pool.Acquire(context.Background())\nif err != nil {\n    fmt.Fprintln(os.Stderr, &quot;Error acquiring connection:&quot;, err)\n    os.Exit(1)\n}\ndefer conn.Release()\n...\n</code></pre>\n"}], "owner": {"reputation": 860, "user_id": 8162252, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-yd_PU1d6EQ4/AAAAAAAAAAI/AAAAAAAABb4/JZOdzUW7a-c/photo.jpg?sz=128", "display_name": "Ado Ren", "link": "https://stackoverflow.com/users/8162252/ado-ren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2035, "favorite_count": 0, "accepted_answer_id": 58598634, "answer_count": 2, "score": 4, "last_activity_date": 1604012023, "creation_date": 1572292860, "question_id": 58597639, "link": "https://stackoverflow.com/questions/58597639/how-to-make-multiple-query-in-a-very-short-interval-simultaneously", "title": "How to make multiple query in a very short interval / simultaneously", "body": "<p>Hey I'm getting an error message : <code>conn busy</code> from pgx</p>\n\n<p>I don't know how to solve this. Here is my function :</p>\n\n<pre><code>func (r *proverbRepo) SelectPendingProverbs(table string) (proverbs []domain.Proverb, err error) {\n    query := fmt.Sprintf(\"SELECT id, proverb literal FROM %s\", table)\n    rows, err := r.Db.Query(context.Background(), query)\n    defer rows.Close()\n\n    if err != nil {\n        return\n    }\n\n    for rows.Next() {\n        var prov domain.Proverb\n        if err = rows.Scan(&amp;prov.ID, &amp;prov.Literal); err != nil {\n            return\n        }\n        proverbs = append(proverbs, prov)\n    }\n    return\n}\n</code></pre>\n\n<p><code>r.Db</code> is <code>pgx.Connect(context.Background(), os.Getenv(\"PSQL_URL\"))</code></p>\n\n<p>I'm fetching two different table in a very short interval from two separate front end requests.</p>\n\n<p>The first request goes through, the other one returns the <code>conn busy</code> error message.</p>\n\n<p>I really don't know what to look for, would somebody help me ?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "is_accepted": true, "score": 1, "last_activity_date": 1572292505, "creation_date": 1572292505, "answer_id": 58597564, "question_id": 58597363, "link": "https://stackoverflow.com/questions/58597363/unmarshal-csv-to-struct-and-then-import/58597564#58597564", "title": "Unmarshal CSV to Struct and then Import", "body": "<blockquote>\n  <p>When I run main, I am receiving an error</p>\n  \n  <p>panic: strconv.ParseInt: parsing \"id\": invalid syntax</p>\n</blockquote>\n\n<p>I would guess you are parsing the header line of the CSV file by accident.</p>\n"}], "owner": {"reputation": 25, "user_id": 12145367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/040c01b147377742bc4c0a072827668b?s=128&d=identicon&r=PG&f=1", "display_name": "zquee12", "link": "https://stackoverflow.com/users/12145367/zquee12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 504, "favorite_count": 0, "accepted_answer_id": 58597564, "answer_count": 1, "score": 0, "last_activity_date": 1572292505, "creation_date": 1572291543, "question_id": 58597363, "link": "https://stackoverflow.com/questions/58597363/unmarshal-csv-to-struct-and-then-import", "title": "Unmarshal CSV to Struct and then Import", "body": "<p>I'm trying to learn Go.\nI'm working to unmarshal CSV records into structs so that I can then create inserts and import this data into my DB.</p>\n\n<p>I am looking for a way to automate marshaling, in a similar manner as encoding</p>\n\n<p>When I run main, I am receiving an error </p>\n\n<pre><code>panic: strconv.ParseInt: parsing \"id\": invalid syntax\n</code></pre>\n\n<p>I've written some code which is supposed to unmarshal my .csv records to struct </p>\n\n<pre><code>func Unmarshal(reader *csv.Reader, v interface{}) error {\n    record, err := reader.Read()\n    if err != nil {\n        return err\n    }\n    s := reflect.ValueOf(v).Elem()\n    if s.NumField() != len(record) {\n        return &amp;FieldMismatch{s.NumField(), len(record)}\n    }\n    for i := 0; i &lt; s.NumField(); i++ {\n        f := s.Field(i)\n        switch f.Type().String() {\n        case \"string\":\n            f.SetString(record[i])\n        case \"int\":\n            ival, err := strconv.ParseInt(record[i], 10, 0)\n            if err != nil {\n                return err\n            }\n            f.SetInt(ival)\n        default:\n            return &amp;UnsupportedType{f.Type().String()}\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>I created this struct in another file: </p>\n\n<pre><code>type InsertToDatabase struct {\n    ID         int `csv:\"id\"`\n    groupId    int `csv:\"group_id\"`\n    Name    string `csv:\"name\"`\n    Status int `csv:\"status\"`\n}\n</code></pre>\n\n<p>When main is run, it should run this bit of code and then parse through my .csv file to create inserts, which are then ran on my local DB.  </p>\n\n<pre><code>var InsertTest InsertToDatabase\n    reader := csv.NewReader(file)\n    for {\n        err := Unmarshal(reader, &amp;InsertTest)\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n            panic(err)\n        }\n        channel &lt;- InsertTest\n    }\n}\n</code></pre>\n\n<p>Is there a way to improve readability of this code? Also, should I  loop and call <code>.Read</code> to process one line at a time?</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1572292843, "post_id": 58597199, "comment_id": 103507864, "body": "Buffered channel or not I do not see no leaks, can you clarify why you think this code is leaking goroutines? (note: the arguments to time.Sleep are &quot;unfair&quot;)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1572293471, "post_id": 58597199, "comment_id": 103508100, "body": "Nothing is eading from <code>errChang</code> (<code>leaking</code> returns before it reads from the channel)."}, {"owner": {"reputation": 17, "user_id": 5632223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14543d8bc8bf50ac46ada740dd9494bf?s=128&d=identicon&r=PG&f=1", "display_name": "Rakoun", "link": "https://stackoverflow.com/users/5632223/rakoun"}, "edited": false, "score": 0, "creation_date": 1572298874, "post_id": 58597199, "comment_id": 103510061, "body": "When i run the program, the print statements for the number of goroutines, is 1 2, i would expect the num of goroutines in exit be back to 1. This is why im thinking is leaking."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572334759, "post_id": 58597199, "comment_id": 103517582, "body": "@Rakoun for the buffered version you get 1 2 because the goroutine sleeps longer than main, if you give it enough time you&#39;ll see it exit and be GCd, i.e. if you change main to sleep for <code>time.Second*5</code> for example you&#39;ll get 1 1. The unbuffered version actually does have a leak so my initial comment is partly incorrect. The leak is caused by the fact that the <code>leaking</code> function returns <i>before</i> receiving from the channel so the goroutine gets stuck at <code>errChang &lt;- xx</code>, i.e. if you put <code>&lt;-errChang</code> above the <code>return</code> statement, and increase the sleep time in main, you&#39;ll get 1 1 as well."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572334962, "post_id": 58597199, "comment_id": 103517670, "body": "@Rakoun here&#39;s the <a href=\"https://play.golang.com/p/hs5h_wVnxlK\" rel=\"nofollow noreferrer\">buffered</a> version with a more &quot;fair&quot; sleep time. And here&#39;s the <a href=\"https://play.golang.com/p/kf9tjUvAfiK\" rel=\"nofollow noreferrer\">unbuffered</a> version where the <code>leaking</code> function receives from the channel before returning."}], "answers": [{"comments": [{"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1572878908, "post_id": 58598817, "comment_id": 103688045, "body": "for clarification, was the root problem that the return statement made the receive from errChan unreachable?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 1, "creation_date": 1572888587, "post_id": 58598817, "comment_id": 103693052, "body": "@mevets: ... maybe? maybe not exactly? It depends on what you mean by &quot;root problem&quot; and/or &quot;made the receive ... unreachable&quot;. Any time you have some goroutine writing to a channel that no one is reading, that&#39;s likely to become a problem, and that did happen in the original code, so you could call that the root of the problem. But removing the <i>write</i> to the channel would solve it as well."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 1, "last_activity_date": 1572299196, "creation_date": 1572299196, "answer_id": 58598817, "question_id": 58597199, "link": "https://stackoverflow.com/questions/58597199/go-goroutines-leaking/58598817#58598817", "title": "Go goroutines leaking", "body": "<p><a href=\"https://play.golang.org/p/rBoiYRcWZc8\" rel=\"nofollow noreferrer\">Here, in the Go Playground</a>, is your original code with a few slight modifications:</p>\n\n<ul>\n<li>the delays are reduced, except for <code>time.Sleep(5)</code> which becomes <code>time.Sleep(time.Second)</code>;</li>\n<li>a <code>return</code> is removed because it becomes unnecessary;</li>\n<li>a <code>fmt.Println</code> is commented out, because with both the <code>return</code> and the uncommented <code>fmt.Println</code>, <code>go vet</code> complains about the unreachable <code>fmt.Println</code>;</li>\n<li>the channel stored in <code>errChang</code> is changed to unbuffered.</li>\n</ul>\n\n<p>When run, its output is:</p>\n\n<pre><code>1\nhola\n2\n</code></pre>\n\n<p>(with a small delay before the <code>2</code>), showing that indeed, the anonymous goroutine you started in function <code>leaking</code> is still running.</p>\n\n<p>If we <a href=\"https://play.golang.org/p/YCoTH-40v2m\" rel=\"nofollow noreferrer\">uncomment the commented-out <code>fmt.Println</code></a>, the output is:</p>\n\n<pre><code>1\nhola\n6\n1\n</code></pre>\n\n<p>(with the same slight delay before the final <code>1</code>) because we now wait for (and then print) the value computed in <code>return666</code> and sent over channel <code>errChang</code>.</p>\n\n<p>If we <a href=\"https://play.golang.org/p/o3eYngdYbfW\" rel=\"nofollow noreferrer\">keep the commented-out <code>fmt.Println</code> commented out and make the channel buffered</a>, the output becomes:</p>\n\n<pre><code>1\nhola\n1\n</code></pre>\n\n<p>as the anonymous goroutine is now able to push its value (6) into the channel.</p>\n\n<p>The channel itself would be garbage collected, along with the single value stored inside it, as there are no remaining references to the channel at this point.  Note, however, that simply making the channel buffered is not always sufficient.  If we <a href=\"https://play.golang.org/p/4Q592mmSNFm\" rel=\"nofollow noreferrer\">send two values down the channel</a>, the program returns to printing:</p>\n\n<pre><code>1\nhola\n2\n</code></pre>\n\n<p>as the anonymous goroutine succeeds in putting <code>6</code> into the channel but then blocks trying to put <code>42</code> in as well.</p>\n"}], "owner": {"reputation": 17, "user_id": 5632223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14543d8bc8bf50ac46ada740dd9494bf?s=128&d=identicon&r=PG&f=1", "display_name": "Rakoun", "link": "https://stackoverflow.com/users/5632223/rakoun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 534, "favorite_count": 0, "accepted_answer_id": 58598817, "answer_count": 1, "score": 0, "last_activity_date": 1572299196, "creation_date": 1572290652, "question_id": 58597199, "link": "https://stackoverflow.com/questions/58597199/go-goroutines-leaking", "title": "Go goroutines leaking", "body": "<p>Following this post about go-routines leaking, <a href=\"https://www.ardanlabs.com/blog/2018/11/goroutine-leaks-the-forgotten-sender.html\" rel=\"nofollow noreferrer\">https://www.ardanlabs.com/blog/2018/11/goroutine-leaks-the-forgotten-sender.html</a>, i tried to solve my leaking code. But adding a buffer to the channel it did not do the trick.</p>\n\n<p>My code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc main() {\n    fmt.Println(runtime.NumGoroutine())\n    leaking()\n    time.Sleep(5)\n    fmt.Println(runtime.NumGoroutine())\n}\n\nfunc leaking() {\n    errChang := make(chan int, 1)\n    go func() {\n        xx :=  return666()\n        errChang &lt;- xx\n    }()\n    fmt.Println(\"hola\")\n    return\n\n    fmt.Println(&lt;-errChang)\n}\n\nfunc return666() int {\n    time.Sleep(time.Second * 1)\n    return 6\n}\n</code></pre>\n\n<p>My initial code did not use a buffer, leading to the go-routine in the <em>leaking</em> function, .. to leak. Following the post i expected that by adding a buffer to the channel, it would have avoided leaking.</p>\n"}, {"tags": ["json", "go", "data-structures", "unmarshalling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1572290694, "post_id": 58597152, "comment_id": 103507024, "body": "The option you mention, is a good option. Do you have any specific reason why you believe it is not good enough?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572291013, "post_id": 58597152, "comment_id": 103507130, "body": "... an alternative to that, although personally I don&#39;t think it&#39;s a good option, would be to check the bytes for a string that can be present only in one response type but not the other and based on the result of that check allocate the correct struct and unmarshal into that. For example you could check if the json contains the string <code>&quot;id&quot;:</code> and if you&#39;re certain that xtr json would never contain that string, not as a property and not as a value, then you know that you can unmarshal the json into the min struct."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572293571, "post_id": 58597152, "comment_id": 103508135, "body": "Another option would be embedding a third type with the <code>FirstName</code> and <code>LastName</code> fields, and removing those fields from both other types. But I agree with mkopriva - I would just put all the fields directly in the one struct unless there&#39;s some good reason not to."}, {"owner": {"reputation": 1, "user_id": 12287437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0014a33da92f074debf01cebd7f0b015?s=128&d=identicon&r=PG&f=1", "display_name": "Burmuley", "link": "https://stackoverflow.com/users/12287437/burmuley"}, "edited": false, "score": 0, "creation_date": 1572361691, "post_id": 58597152, "comment_id": 103530926, "body": "Thank you guys for all the ideas.Those two types (<code>UsersUserMin</code> and <code>UsersUserSettingsXtr</code>) are used in other part of the code. So I just wanted to reuse it to avoid code duplication. But it seems the best option will be to directly define all fields in the type."}], "owner": {"reputation": 1, "user_id": 12287437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0014a33da92f074debf01cebd7f0b015?s=128&d=identicon&r=PG&f=1", "display_name": "Burmuley", "link": "https://stackoverflow.com/users/12287437/burmuley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1572290401, "creation_date": 1572290401, "question_id": 58597152, "link": "https://stackoverflow.com/questions/58597152/unmarshal-json-into-struct-with-multiple-embedded-structs-and-overlapping-fields", "title": "Unmarshal JSON into struct with multiple embedded structs and overlapping fields names", "body": "<p>I'm trying to parse an API response where response can be of two different types.</p>\n\n<p>In API's JSON schema this response is defined like this ():</p>\n\n<pre><code>\"account_user_settings\": {\n      \"type\": \"object\",\n      \"allOf\": [\n        {\n          \"$ref\": \"objects.json#/definitions/users_user_min\"\n        },\n        {\n          \"$ref\": \"objects.json#/definitions/users_user_settings_xtr\"\n        }\n      ]\n    }\n</code></pre>\n\n<p>So I defined several types:</p>\n\n<pre><code>type AccountUserSettings struct {\n    UsersUserMin\n    UsersUserSettingsXtr\n}\n\ntype UsersUserMin struct {\n    FirstName       string `json:\"first_name\"`\n    Id              int    `json:\"id\"`\n    LastName        string `json:\"last_name\"`\n}\n\ntype UsersUserSettingsXtr struct {\n    Bdate            string  `json:\"bdate\"`\n    City             string  `json:\"city\"`\n    Country          string  `json:\"country\"`\n    FirstName        string  `json:\"first_name\"`\n    LastName         string  `json:\"last_name\"`\n    Phone            string  `json:\"phone\"`\n}\n</code></pre>\n\n<p>Response contains JSON similar to this (only values were changed):</p>\n\n<p>First possible option (full):</p>\n\n<pre><code>{\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"bdate\": \"9.3.1950\",\n    \"city\": \"New York\",\n    \"country\": \"USA\",\n    \"phone\": \"+1 234 567 8910\",\n}\n</code></pre>\n\n<p>Second option (partial):</p>\n\n<pre><code>{\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"id\": 123\n}\n</code></pre>\n\n<p>The problem is that with this configuration I always miss values for fields <code>FirstName</code> and <code>LastName</code> after unmarshaling.</p>\n\n<p>If I exclude on of the embedded types from consolidating type (<code>AccountUserSettings</code>) then it works fine and all fields are properly filled.</p>\n\n<p>I have only one option for now how to resolve this, and don't think it's good enough - don't use embedding and enlist all fields directly in <code>AccountUserSettings</code>.</p>\n\n<p>Maybe there are any other options you know for similar cases?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 11992766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07bf9dadf87454587b0abffa158cfa9e?s=128&d=identicon&r=PG&f=1", "display_name": "temps hd", "link": "https://stackoverflow.com/users/11992766/temps-hd"}, "edited": false, "score": 0, "creation_date": 1572328254, "post_id": 58594411, "comment_id": 103515803, "body": "when i try print it, the result is &amp;{[0x40a0f0]}, any wrong ? i want to see what is inside the ValidateMessage{}"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 41, "user_id": 11992766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07bf9dadf87454587b0abffa158cfa9e?s=128&d=identicon&r=PG&f=1", "display_name": "temps hd", "link": "https://stackoverflow.com/users/11992766/temps-hd"}, "edited": false, "score": 0, "creation_date": 1572355918, "post_id": 58594411, "comment_id": 103527652, "body": "When you try to print what? Where? How?"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1572278840, "creation_date": 1572278840, "answer_id": 58594411, "question_id": 58594297, "link": "https://stackoverflow.com/questions/58594297/trying-to-create-reusable-append-to-struct-in-go/58594411#58594411", "title": "trying to create reusable append to struct in go", "body": "<p>There are a couple problems in your code. This one is generating your error (nothing to do with your append, or that method at all):</p>\n\n<pre><code>s1 := *ValidateMessage{}\n</code></pre>\n\n<p>This is not valid syntax. You probably meant <code>s1 := &amp;ValidateMessage{}</code>.</p>\n\n<pre><code>s1.AddError(&amp;ErrorValidate{\"theKey\", \"string\"})\n</code></pre>\n\n<p>You're trying to pass a <code>*ErrorValidate</code> to a function that takes a <code>ErrorValidate</code>. This should be <code>s1.AddError(ErrorValidate{\"theKey\", \"string\"})</code>.</p>\n"}], "owner": {"reputation": 41, "user_id": 11992766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07bf9dadf87454587b0abffa158cfa9e?s=128&d=identicon&r=PG&f=1", "display_name": "temps hd", "link": "https://stackoverflow.com/users/11992766/temps-hd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 58594411, "answer_count": 1, "score": -3, "last_activity_date": 1572278840, "creation_date": 1572278442, "question_id": 58594297, "link": "https://stackoverflow.com/questions/58594297/trying-to-create-reusable-append-to-struct-in-go", "title": "trying to create reusable append to struct in go", "body": "<p>i am trying to make reusable method / func in go to push valu struct to another slice/ array in struct </p>\n\n<p>i tried like this </p>\n\n<pre><code>\nimport (\n    \"fmt\"\n)\n\n\ntype ErrorValidate struct {\n    ErrorKey string \n    Message string  \n}\n\ntype ValidateMessage struct {\n     ErrorMessage []*ErrorValidate\n}\n\nfunc (v *ValidateMessage) AddError(err ErrorValidate) {\n    v.ErrorMessage = append(v.ErrorMessage, &amp;err)\n}\n\nfunc main() {\n    s1 := *ValidateMessage{}\n    s1.AddError(&amp;ErrorValidate{\"theKey\", \"string\"})\n    fmt.Println(*s1)\n}\n</code></pre>\n\n<p>got error <code>invalid indirect of ValidateMessage literal (type ValidateMessage)\n</code></p>\n\n<p>the link here <a href=\"https://play.golang.org/p/VjdsiZQLroF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VjdsiZQLroF</a></p>\n\n<p>on those case i have a func for Validate something and then i tried to push error message on ErrorValidate , but i keep using append in my conditional, i am trying to make it reduce but got error above</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1572269080, "post_id": 58591540, "comment_id": 103496489, "body": "Are you using Go modules to manage dependencies?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1572269473, "post_id": 58591540, "comment_id": 103496684, "body": "Use <code>go mod why</code> to find who is importing it. If it is unused: delete from go.mod"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1572270165, "post_id": 58591540, "comment_id": 103497044, "body": "Remove unused dependencies with <code>go mod tidy</code>."}, {"owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1572270529, "post_id": 58591540, "comment_id": 103497223, "body": "@Adrian I&#39;m not using go modules, just go get. @Volker I get <code>go: modules disabled inside GOPATH&#47;src by GO111MODULE=auto; see &#39;go help modules&#39;</code>. Started reading it, but it&#39;s a long read, so I&#39;ll get back to you if there&#39;s anything I can do with that information."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1572270933, "post_id": 58591540, "comment_id": 103497450, "body": "If you&#39;re not using modules then <code>go mod</code> commands aren&#39;t going to help you. It&#39;s a transitive dependency of something you&#39;re importing, <code>go list</code> will confirm that, but I don&#39;t think it will tell you what the source of the dependency is."}, {"owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "edited": false, "score": 0, "creation_date": 1572271114, "post_id": 58591540, "comment_id": 103497530, "body": "Alright. Yeah, <code>go mod</code>, of course gives me <code>go: cannot find main module</code> and <code>go list</code> just outputs the name of my own main package. I assume, then, that the problem is that the go module is not updated for one of my deps. I&#39;ll try to set <code>export GO111MODULE=off</code> in my pipelines and see if it solves the issue."}], "owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 183, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1572268206, "creation_date": 1572268206, "question_id": 58591540, "link": "https://stackoverflow.com/questions/58591540/go-get-downloads-unneeded-dependency", "title": "go get downloads unneeded dependency", "body": "<p>One of my pipelines (GitLab CI) recently started breaking with a dependency no longer being available:</p>\n\n<pre><code> $ go get\npackage github.com/go-resty/resty/v2: cannot find package \"github.com/go-resty/resty/v2\" in any of:\n    /usr/local/go/src/github.com/go-resty/resty/v2 (from $GOROOT)\n    /go/src/github.com/go-resty/resty/v2 (from $GOPATH)\n</code></pre>\n\n<p>I didn't recognize the package as one that we are using, so I tried to find out which dependency we're using that, in turn, depends on this package.</p>\n\n<p>After checking all my deps, I cannot find a dependency on this package. I've checked all the external dependencies my own system has, which are the below ones:</p>\n\n<pre><code>\"github.com/golang/protobuf/proto\"\n\"github.com/golang/protobuf/ptypes\"\n\"github.com/pkg/errors\"\nmgo \"gopkg.in/mgo.v2\"\n\"gopkg.in/mgo.v2/bson\"\n\"golang.org/x/net/html/charset\"\n\"github.com/PuerkitoBio/goquery\"\nimap \"github.com/emersion/go-imap\"\n\"github.com/emersion/go-imap/client\"\n\"github.com/sajari/docconv\"\n</code></pre>\n\n<p>I've also used tools such as <a href=\"https://github.com/kisielk/godepgraph\" rel=\"nofollow noreferrer\">godepgraph</a> to try to find nested deps. However, nothing I can find includes the package from the error.</p>\n\n<p>How can I find out why this package is downloaded when running <code>go get</code>?</p>\n"}, {"tags": ["go", "pdf", "wav"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1572277719, "post_id": 58589782, "comment_id": 103501136, "body": "What&#39;s the problem with replacing <code>LittleEndian</code> with <code>BigEndian</code> in this code?"}, {"owner": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1572355887, "post_id": 58589782, "comment_id": 103527636, "body": "@kostix this won&#39;t work. Player will not recognize the data"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1572374083, "post_id": 58589782, "comment_id": 103537085, "body": "I think I&#39;ve finally managed to get what you&#39;re after. So no, WAV (RIFF) files may only be big-endian when they start with the &quot;RIFX&quot; identifier, and if that does not work for you (and you have verified that with known-good files (not generated by your code)) then you have to find another solution. I have only managed to find <a href=\"https://en.wikipedia.org/wiki/Audio_Interchange_File_Format\" rel=\"nofollow noreferrer\">AIFF</a> which is naturally BE and appears to contain PCM data as well as WAV. You might try to play with that format instead."}, {"owner": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1572418728, "post_id": 58589782, "comment_id": 103548614, "body": "@kostix, thanks a lot"}], "owner": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1572274054, "creation_date": 1572260630, "last_edit_date": 1572274054, "question_id": 58589782, "link": "https://stackoverflow.com/questions/58589782/wav-big-endian-format-in-pdf", "title": "Wav big endian format in PDF", "body": "<p>When I parse PDF to extract .WAV from there it haven't headers. So I need to generate header for data in BigEndian format, because PDF WAV is stored in BigEndian and it is resource intensive to convert BigEndian to LittleEndian.\nHere I have code which generates wav header with littleendian data and works good:</p>\n\n<pre><code>bits := 16\n    pcmLen := len(samples) * 2\n    samplingRate := format.sampleRate\n    numChannels := format.channels\n    blockAlign := (numChannels * bits) &gt;&gt; 3\n    // jshint bitwise:true\n    RIFF := 0x46464952 // Resource Interchange File Format\n    WAVE := 0x45564157 // Wave\n    FMT := 0x20746D66  // Format\n    DATA := 0x61746164 // Audio Data\n    buf := new(bytes.Buffer)\n    _ = binary.Write(buf, binary.LittleEndian, uint32(RIFF))\n    _ = binary.Write(buf, binary.LittleEndian, uint32(32+pcmLen))\n    _ = binary.Write(buf, binary.LittleEndian, uint32(WAVE))\n    _ = binary.Write(buf, binary.LittleEndian, uint32(FMT))\n    _ = binary.Write(buf, binary.LittleEndian, uint32(16))\n    _ = binary.Write(buf, binary.LittleEndian, uint16(1))\n    _ = binary.Write(buf, binary.LittleEndian, uint16(numChannels))\n    _ = binary.Write(buf, binary.LittleEndian, uint32(samplingRate))\n    _ = binary.Write(buf, binary.LittleEndian, uint32(samplingRate*blockAlign))\n    _ = binary.Write(buf, binary.LittleEndian, uint16(blockAlign))\n    _ = binary.Write(buf, binary.LittleEndian, uint16(bits))\n    _ = binary.Write(buf, binary.LittleEndian, uint32(DATA))\n    _ = binary.Write(buf, binary.LittleEndian, uint32(pcmLen))\n</code></pre>\n\n<p>How to generate header for bigEndian? Is it possible?\nI have tried <a href=\"https://www.fileformat.info/format/riff/corion_rifx.htm\" rel=\"nofollow noreferrer\">RIFX</a> format but standard media players don't support it</p>\n"}, {"tags": ["go", "optimization", "struct", "interface"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1572255980, "post_id": 58588580, "comment_id": 103490649, "body": "Use the same type for each interface function."}, {"owner": {"reputation": 1674, "user_id": 4487542, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/f5Hr6.png?s=128&g=1", "display_name": "J&#233;r&#244;me", "link": "https://stackoverflow.com/users/4487542/j%c3%a9r%c3%b4me"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1572259710, "post_id": 58588580, "comment_id": 103492278, "body": "@Flimzy Ok I return an <code>interface{}</code> and this is working"}], "owner": {"reputation": 1674, "user_id": 4487542, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/f5Hr6.png?s=128&g=1", "display_name": "J&#233;r&#244;me", "link": "https://stackoverflow.com/users/4487542/j%c3%a9r%c3%b4me"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1572255530, "creation_date": 1572255530, "question_id": 58588580, "link": "https://stackoverflow.com/questions/58588580/avoid-code-duplication-using-interfaces-as-parameter", "title": "Avoid code duplication using interfaces as parameter", "body": "<p>I have multiples structs with common relation on another struct</p>\n\n<pre><code>type Question struct {\n    ID  int `json:\"id,omitempty\"`\n    ...\n}\n\ntype EvaluationQuestion struct {\n    Question   Question `json:\"question\" sql:\"-\"`\n    Min        int      `json:\"min\"`\n    Max        int      `json:\"max\"`\n    QuestionID int      `json:\"question_id,omitempty\"`\n}\n\ntype TextQuestion struct {\n    Question   Question `json:\"question\" sql:\"-\"`\n    MaxValue   int      `json:\"max_value\"`\n    QuestionID int      `json:\"question_id,omitempty\"`\n}\n</code></pre>\n\n<p>I also have a method to save data inside my database that will be the same for every struct, only the struct type will change</p>\n\n<pre><code>func CreateTextQuestion(textQuestion *TextQuestion) error {\n    question := textQuestion.Question\n\n    if err := database.Db.Insert(&amp;question); err != nil {\n        return err\n    }\n\n    textQuestion.QuestionID = question.ID\n\n    return database.Db.Insert(textQuestion)\n}\n</code></pre>\n\n<p>To avoid code duplication I tried to use interface that will implement methods for each struct (even if the is some duplication too...)</p>\n\n<pre><code>type Entity interface {\n    getQuestion() Question\n    questionID(int) TextQuestion\n}\n\nfunc (t TextQuestion) getQuestion() Question {\n    return t.Question\n}\n\nfunc (t TextQuestion) questionID(id int) TextQuestion {\n    t.QuestionID = id\n\n    return t\n}\n\nfunc (e EvaluationQuestion) getQuestion() Question {\n    return e.Question\n}\n\nfunc (e EvaluationQuestion) questionID(id int) EvaluationQuestion {\n    e.QuestionID = id\n\n    return e\n}\n</code></pre>\n\n<p>Then I updated my <code>Create</code> method to use this interface</p>\n\n<pre><code>func Create(entity Entity) error {\n    question := entity.getQuestion()\n\n    if err := database.Db.Insert(&amp;question); err != nil {\n        return err\n    }\n\n    questionType := entity.questionID(question.ID)\n\n    return database.Db.Insert(&amp;questionType)\n}\n</code></pre>\n\n<p>The problem is that my interface is not compatible with each struct, so I get compilation errors because the expected return type of my <code>questionID</code> method is not the correct one</p>\n\n<blockquote>\n  <p>api_1       | [00] handlers/choiceQuestion.go:28:39: cannot convert question (type models.ChoiceQuestion) to type models.Entity:\n  api_1       | [00]  models.ChoiceQuestion does not implement models.Entity (wrong type for models.questionID method)\n  api_1       | [00]      have models.questionID(int) models.ChoiceQuestion\n  api_1       | [00]      want models.questionID(int) models.TextQuestion</p>\n</blockquote>\n\n<p>Is there a way to avoid code duplication when dealing with multiple structs with Go?</p>\n\n<p>I also tried with type switch and reflection without success.</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 4914458, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vHofN.jpg?s=128&g=1", "display_name": "Cascax", "link": "https://stackoverflow.com/users/4914458/cascax"}, "is_accepted": false, "score": 0, "last_activity_date": 1590578668, "last_edit_date": 1590578668, "creation_date": 1590576563, "answer_id": 62041325, "question_id": 58587949, "link": "https://stackoverflow.com/questions/58587949/gorm-preload-nested-structs/62041325#62041325", "title": "Gorm Preload Nested Structs", "body": "<ul>\n<li>There is a spelling mistake in MyStruct1: <code>foriegnkey</code> &rarr; <code>foreignkey</code>.</li>\n<li>There is an extra space in <code>MyStruct1</code>'s tag value.</li>\n</ul>\n\n<p>These reasons make Gorm unable to analyze <code>MyStruct1</code>'s relationship.</p>\n\n<pre><code>type MyStruct1 struct {\n    Model\n    MainStructID int64     `json:\"-\"`\n    ID1          int64     `json:\"-\"`\n    ID2          int64     `json:\"-\"`\n    MyDefault1   MyStruct2 `gorm:\"foreignkey:ID;association_foreignkey:ID1\"`\n    MyDefault2   MyStruct2 `gorm:\"foreignkey:ID;association_foreignkey:ID2\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 587, "user_id": 1663898, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HR2fj.jpg?s=128&g=1", "display_name": "Deslyxia", "link": "https://stackoverflow.com/users/1663898/deslyxia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1590578668, "creation_date": 1572252721, "last_edit_date": 1572311398, "question_id": 58587949, "link": "https://stackoverflow.com/questions/58587949/gorm-preload-nested-structs", "title": "Gorm Preload Nested Structs", "body": "<pre class=\"lang-golang prettyprint-override\"><code>type MainStruct struct {\nDefaults\nFoo string\nBar string\nBaz int64\nStruct1  MyStruct1 `gorm:\"foreignkey:MainStructID\"`\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type MyStruct1 struct {\n    Defaults\n    MainStructID int64                  `json:\"-\"`       \n    ID1          int64                  `json:\"-\"` \n    ID2         int64                   `json:\"-\"` \n    MyDefault1     MyStruct2 `gorm: \"foriegnkey:ID;association_foreignkey:ID1\"`\n    MyDefault2    MyStruct2 `gorm: \"foriegnkey:ID;association_foreignkey:ID2\"`\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type MyStruct2 struct {\n    Defaults\n    Field1              string\n    Field2           string\n    Field3          string\n}\n</code></pre>\n\n<p>Given the above Structs I want to do something along the lines of </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>baseVersion MainStruct\ndb.Where(\"ID = ?\", myInputID).Preload(\"Struct1\").\n        Preload(\"Struct1.MyDefault1\").\n        Preload(\"Struct1.MyDefault2\").\n        First(&amp;baseVersion)\n</code></pre>\n\n<p>The issue I am having currently is that I am not getting back the data from struct2 at all. I think it is an issue with the gorm annotation in Struct1 creating the association ... but I am not sure what is wrong.</p>\n\n<p>No matter how I have tried to get the Preload od MyDefault1 and MyDefault2 to come in. I always wind up with an error that it cannot preload. My guess is that the gorm annotation is not completely correct ... but it seems to be following the pattern so I am not sure what to look at now. </p>\n"}, {"tags": ["docker", "go", "raspberry-pi", "arm"], "comments": [{"owner": {"reputation": 655, "user_id": 922975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc1820f4965263c02362ee15914171b6?s=128&d=identicon&r=PG", "display_name": "seblucas", "link": "https://stackoverflow.com/users/922975/seblucas"}, "edited": false, "score": 0, "creation_date": 1572278832, "post_id": 58585684, "comment_id": 103501757, "body": "Did you build this image on your pi ?"}], "answers": [{"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1572328458, "post_id": 58586251, "comment_id": 103515847, "body": "I think I have something working here <a href=\"https://github.com/kaihendry/sla/commit/8c5baca56e5674a28741d354b2f7ed3f6880bcfc\" rel=\"nofollow noreferrer\">github.com/kaihendry/sla/commit/&hellip;</a> but the manifest part doesn&#39;t appear to work properly when testing on rpi4 with <code>docker run -it hendry&#47;sla:latest</code>"}], "tags": [], "owner": {"reputation": 126, "user_id": 8804080, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Lv9wkRmxmMw/AAAAAAAAAAI/AAAAAAAAAFc/2hyzNA3hb-E/photo.jpg?sz=128", "display_name": "Matthew Berryman", "link": "https://stackoverflow.com/users/8804080/matthew-berryman"}, "is_accepted": false, "score": 2, "last_activity_date": 1572241632, "creation_date": 1572241632, "answer_id": 58586251, "question_id": 58585684, "link": "https://stackoverflow.com/questions/58585684/how-do-i-build-a-docker-image-for-an-arm-device/58586251#58586251", "title": "How do I build a Docker image for an ARM device?", "body": "<p>The <code>FROM golang</code> line will pull the appropriate architecture; they have arm v6 (older pi / pi 0 running raspbian) + arm v7 (newer pi running raspbian) and arm64 (newer pi running ubuntu) as part of a multi-arch docker image <a href=\"https://hub.docker.com/_/golang?tab=tags\" rel=\"nofollow noreferrer\">https://hub.docker.com/_/golang?tab=tags</a>  </p>\n\n<p>Your problem with exec format error (i.e. it is the wrong binary format) appears to just be the line <a href=\"https://github.com/kaihendry/sla/blob/a22d983340f3df794696e5c8e31cf3b89f7edd89/Dockerfile#L14\" rel=\"nofollow noreferrer\">https://github.com/kaihendry/sla/blob/a22d983340f3df794696e5c8e31cf3b89f7edd89/Dockerfile#L14</a> where your architecture is wrong for a pi; it should be GOARCH=arm (32 bit, non-ubuntu) or GOARCH=arm64 (ubuntu), additionally for 32 bit ARM (v6 and v7) you would also need to specify GOARM=6 or GOARM=7 per <a href=\"https://github.com/golang/go/wiki/GoArm\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/GoArm</a></p>\n\n<p>I have tested your code with a swap to to GOARCH=arm64 (and no GOARM required) and had it build and run on my pi3b+ running ubuntu.</p>\n\n<p>Noting for future reference I suspect my answer may change if/when raspbian switches to 64 bit. </p>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572241632, "creation_date": 1572235781, "question_id": 58585684, "link": "https://stackoverflow.com/questions/58585684/how-do-i-build-a-docker-image-for-an-arm-device", "title": "How do I build a Docker image for an ARM device?", "body": "<p>I'm noticing <code>exec user process caused \"exec format error\"</code> when trying to run a Docker image on a Raspberry Pi 4.</p>\n\n<p>First I'm bewildered that a Docker image is pulled that won't run on the platform to begin with. Nonetheless I am keen to make it work, but I don't know how.</p>\n\n<p>Here's the project: <a href=\"https://github.com/kaihendry/sla\" rel=\"nofollow noreferrer\">https://github.com/kaihendry/sla</a> How can I build ARM compatible images?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1572250484, "post_id": 58585557, "comment_id": 103488426, "body": "Don&#39;t ignore the error returned by Scan."}, {"owner": {"reputation": 6009, "user_id": 132127, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TnwQX.jpg?s=128&g=1", "display_name": "anta40", "link": "https://stackoverflow.com/users/132127/anta40"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1572346276, "post_id": 58585557, "comment_id": 103522862, "body": "Hmm I got this error: &quot;2019/10/29 17:50:32 http: panic serving [::1]:57463: sql: Scan error on column index 0, name &quot;checkin_time&quot;: converting NULL to string is unsupported&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 6009, "user_id": 132127, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TnwQX.jpg?s=128&g=1", "display_name": "anta40", "link": "https://stackoverflow.com/users/132127/anta40"}, "edited": false, "score": 0, "creation_date": 1572346034, "post_id": 58585647, "comment_id": 103522738, "body": "Aarrghh typo. After fixing the first <code>Println</code> (should use tmpcheckintime), well the result is still empty."}], "tags": [], "owner": {"reputation": 441, "user_id": 7596425, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VIafv.jpg?s=128&g=1", "display_name": "Andy Taton", "link": "https://stackoverflow.com/users/7596425/andy-taton"}, "is_accepted": false, "score": 1, "last_activity_date": 1572235365, "creation_date": 1572235365, "answer_id": 58585647, "question_id": 58585557, "link": "https://stackoverflow.com/questions/58585557/queryrow-scan-doesnt-read-values-properly/58585647#58585647", "title": "QueryRow.Scan() doesn&#39;t read values properly?", "body": "<p>The last two lines of code you post have you logging <code>tmpcheckouttime</code> twice in a row:</p>\n\n<pre><code>    fmt.Println(\"--&gt; checkin: \", tmpcheckouttime)\n    fmt.Println(\"--&gt; checkout: \", tmpcheckouttime)\n</code></pre>\n\n<p>If you fix the first <code>Println</code>, do you get what you expect?</p>\n"}], "owner": {"reputation": 6009, "user_id": 132127, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TnwQX.jpg?s=128&g=1", "display_name": "anta40", "link": "https://stackoverflow.com/users/132127/anta40"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1572235365, "creation_date": 1572234317, "question_id": 58585557, "link": "https://stackoverflow.com/questions/58585557/queryrow-scan-doesnt-read-values-properly", "title": "QueryRow.Scan() doesn&#39;t read values properly?", "body": "<p>I have a row like this:\n<a href=\"https://i.stack.imgur.com/V5MC1.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/V5MC1.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>Now I want to retrieve the <strong>checkin_time</strong> and <strong>checkout_time</strong>:\n<a href=\"https://i.stack.imgur.com/xsKwe.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xsKwe.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>OK I already got the correct query. Now run the query via Go code:</p>\n\n<pre><code>package controllers\n\nimport (\n    \"absensi/config\"\n    \"absensi/models\"\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc DoScanRow(w http.ResponseWriter, r *http.Request) {\n    var tmpcheckintime string\n    var tmpcheckouttime string\n    var param models.CheckinParam\n    var db = config.DBConnect()\n    json.NewDecoder(r.Body).Decode(&amp;param)\n\n    query1 := `SELECT checkin_time, checkout_time FROM oc_log WHERE userid=$1 AND userdate=$2;`\n    row := db.QueryRow(query1, param.UserId, time.Now().Format(\"2006-01-02\"))\n    row.Scan(&amp;tmpcheckintime, &amp;tmpcheckouttime)\n\n    fmt.Println(\"--&gt; id: \" + param.UserId)\n    fmt.Println(\"--&gt; date: \" + time.Now().Format(\"2006-01-02\"))\n    fmt.Println(\"--&gt; checkin: \", tmpcheckouttime)\n    fmt.Println(\"--&gt; checkout: \", tmpcheckouttime)\n\n}\n</code></pre>\n\n<p>If I send this payload via Postman:</p>\n\n<blockquote>\n  <p>{ \"id\": \"1234\", \"location\": \"(100,100)\", \"distance\": 4 }</p>\n</blockquote>\n\n<p>I get this:</p>\n\n<blockquote>\n  <p>--> id: 1234</p>\n  \n  <p>--> date: 2019-10-28</p>\n  \n  <p>--> checkin:</p>\n  \n  <p>--> checkout:</p>\n</blockquote>\n\n<p>Both checkin and checkout time are empty. Yet obviously only the checkout time is empty. What's wrong here?</p>\n"}, {"tags": ["json", "go", "marshalling", "unmarshalling"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1572253579, "post_id": 58585360, "comment_id": 103489650, "body": "That&#39;s not called unmarshaling, that&#39;s called converting (although if you want to do it in Go, it will involve both unmarshaling and marshaling)"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1572233073, "creation_date": 1572233073, "answer_id": 58585447, "question_id": 58585360, "link": "https://stackoverflow.com/questions/58585360/unmarshal-json-array-into-json-object/58585447#58585447", "title": "Unmarshal JSON Array into JSON Object", "body": "<p>You cannot do what you want using the standard library JSON package. I am not aware of any third-party JSON unmarshaler that can do this. You have to unmarshal the JSON to an intermediate structure that matches your input, and then convert that to the structure you need. If the structure of the <code>distances</code> is the same for all elements, and if you're trying to convert that input JSON to the output JSON you want, you can do that with a simple structure, like this:</p>\n\n<pre><code>type Result struct {\n  Distances map[string]float64\n}\n\nfunc process(input []byte) Result {\n  var data InputStruct\n  json.Unmarshal(input,&amp;data)\n  dest:=Result{Distances:make(map[string]float64)}\n  for _,dist:=range data.Distances {\n     dest.Distances[dist.Activity]=dist.Distance \n  }\n  return dest\n}\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 3552105, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0fb932c02e560beab96cfe6e46818d73?s=128&d=identicon&r=PG&f=1", "display_name": "user3552105", "link": "https://stackoverflow.com/users/3552105/user3552105"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1572233073, "creation_date": 1572232161, "question_id": 58585360, "link": "https://stackoverflow.com/questions/58585360/unmarshal-json-array-into-json-object", "title": "Unmarshal JSON Array into JSON Object", "body": "<p>I'm trying to work with an API that returns JSON data. Nested within the JSON is an array of Objects. The data is structured, and I'm trying to convert that array into an Object, but I'm coming up empty handed. </p>\n\n<p>In other words, I have this:</p>\n\n<pre><code>{\n  \"summary\": {\n    \"distances\": [\n      {\n        \"activity\": \"total\",\n        \"distance\": 2.83\n      },\n      {\n        \"activity\": \"tracked\",\n        \"distance\": 2.83\n      },\n      { ... },\n      { ... },\n      { ... },\n      { ... },\n      { ... }\n    ]\n  }\n}\n</code></pre>\n\n<p>And I'd like to have something like this:</p>\n\n<pre><code>  \"summary\": {\n    \"distances\": {\n       \"total\": 2.83,\n       \"tracked\": 2.83,\n       ...\n    ]\n  }\n}\n</code></pre>\n\n<p>I have written code that unmarshalls the JSON, but it only works if the format of the struct is the same as the JSON: <a href=\"https://play.golang.org/p/jsu_Ym8kRQd\" rel=\"nofollow noreferrer\">https://play.golang.org/p/jsu_Ym8kRQd</a></p>\n"}, {"tags": ["go", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": false, "score": 0, "last_activity_date": 1572271986, "creation_date": 1572271986, "answer_id": 58592513, "question_id": 58585078, "link": "https://stackoverflow.com/questions/58585078/binding-validations-does-not-work-when-request-body-is-array-of-objects/58592513#58592513", "title": "Binding validations does not work when request body is Array of objects", "body": "<p>The JSON will be parsed <a href=\"https://github.com/gin-gonic/gin/blob/393a63f3b020df89d42695064443760c7d0a0dc8/binding/json.go#L44-L56\" rel=\"nofollow noreferrer\">here</a> and then validated <a href=\"https://github.com/gin-gonic/gin/blob/393a63f3b020df89d42695064443760c7d0a0dc8/binding/default_validator.go#L21-L35\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>The comment on the default ValidateStruct method:</p>\n\n<blockquote>\n  <p>ValidateStruct receives any kind of type, but only performed struct or pointer to struct type.</p>\n</blockquote>\n\n<p>You can work around this by defining a struct, as it is needed, that holds your data:</p>\n\n<pre><code>type itemHolder struct {\n    Items []item\n}\n</code></pre>\n\n<p>Then defining a custom <a href=\"https://godoc.org/encoding/json#Unmarshaler\" rel=\"nofollow noreferrer\">Unmarshaler</a>, like this:</p>\n\n<pre><code>func (i *itemHolder) UnmarshalJSON(b []byte) error {\n    return json.Unmarshal(b, &amp;i.Items)\n}\n</code></pre>\n\n<p>Now <code>*itemHolder</code> implements <code>json.Unmarshaler</code>, which means in turn that it will be a struct that is supported by gin.</p>\n\n<p>This code should work now:</p>\n\n<pre><code>var items itemHolder\n\nerr := c.BindJSON(&amp;items)\nif err != nil {\n    // handle...\n}\n\n// use items.Items from here on\n</code></pre>\n\n<p>Please note that your marshal behaviour will change; so you should definitely implement the <a href=\"https://godoc.org/encoding/json#Marshaler\" rel=\"nofollow noreferrer\">Marshaler</a> interface if you need to.</p>\n"}], "owner": {"reputation": 299, "user_id": 8213652, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/P2mLR.jpg?s=128&g=1", "display_name": "Peggy", "link": "https://stackoverflow.com/users/8213652/peggy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1040, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1597182207, "creation_date": 1572229021, "last_edit_date": 1597182207, "question_id": 58585078, "link": "https://stackoverflow.com/questions/58585078/binding-validations-does-not-work-when-request-body-is-array-of-objects", "title": "Binding validations does not work when request body is Array of objects", "body": "<p>Gin's request validation feature is not working when the request body (JSON) represents an array of objects</p>\n\n<p>Ex:</p>\n\n<pre><code>[ \n   { \n      \"field1\":\"aaa\",\n      \"field2\":\"bbb\"\n   }\n]\n</code></pre>\n\n<p>code:</p>\n\n<pre><code>type item struct {\n    Field1 string `json:\"field1\" binding:\"required\"`\n    Field2 string `json:\"field2\" binding:\"required\"`\n}\n\nvar items []item\n\nerr := c.BindJSON(&amp;items)\n</code></pre>\n\n<p>To be more clear, the validation logic in gin is expecting the root object to be a struct and hence bails out when an array type gets passed.</p>\n\n<p>what is best way to validate each object in an array passed in the body?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 12283587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edf6b28dfe94be8030da9a30259a82f9?s=128&d=identicon&r=PG&f=1", "display_name": "Ferros", "link": "https://stackoverflow.com/users/12283587/ferros"}, "edited": false, "score": 0, "creation_date": 1572232920, "post_id": 58585284, "comment_id": 103484807, "body": "indeed, but the goal here is to take a string representation of a map object, like for example on printed out in logs (where it would be a string via copy/paste) and convert it back into a map object and then into a JSON object (or skip the convert into map entirely and just convert to JSON if that makes sense. Example: ```  func main(){   myMap := map[string]int{&quot;foo&quot;: 1, &quot;bar&quot;: 2}   fmt.Printf(&quot;%v&quot;, myMap) } ``` Would output: ``` map[foo:1 bar:2] ``` Which we would then take that string and convert back into map or JSON object"}, {"owner": {"reputation": 938, "user_id": 3894179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c6b1c2c08d1075995cb780ee8a2e36e?s=128&d=identicon&r=PG", "display_name": "Andra", "link": "https://stackoverflow.com/users/3894179/andra"}, "reply_to_user": {"reputation": 1, "user_id": 12283587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edf6b28dfe94be8030da9a30259a82f9?s=128&d=identicon&r=PG&f=1", "display_name": "Ferros", "link": "https://stackoverflow.com/users/12283587/ferros"}, "edited": false, "score": 0, "creation_date": 1572233332, "post_id": 58585284, "comment_id": 103484870, "body": "Yes, but it&#39;s the output format. If you want to evaluate it, you have to format it like this <code>&quot;map[string]int{\\&quot;foo\\&quot;: 1, \\&quot;bar\\&quot;: 2}&quot;</code>"}, {"owner": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "reply_to_user": {"reputation": 1, "user_id": 12283587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edf6b28dfe94be8030da9a30259a82f9?s=128&d=identicon&r=PG&f=1", "display_name": "Ferros", "link": "https://stackoverflow.com/users/12283587/ferros"}, "edited": false, "score": 2, "creation_date": 1572234421, "post_id": 58585284, "comment_id": 103485038, "body": "@Ferros <code>map[blah:1 stuff:2 list:3]</code> doesn&#39;t have enough information about the type. <code>blah</code> can be just a string, or a custom type that represents string, or whatever. It also goes same for the value. So it is hard to infer data types just from that string representation. Consider this example: <a href=\"https://play.golang.org/p/E_b0NWX7VkA\" rel=\"nofollow noreferrer\">play.golang.org/p/E_b0NWX7VkA</a>"}, {"owner": {"reputation": 1, "user_id": 12283587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edf6b28dfe94be8030da9a30259a82f9?s=128&d=identicon&r=PG&f=1", "display_name": "Ferros", "link": "https://stackoverflow.com/users/12283587/ferros"}, "edited": false, "score": 0, "creation_date": 1572300495, "post_id": 58585284, "comment_id": 103510592, "body": "Yep, make sense cause Go is statically typed where python isn&#39;t, so they can get away with that.  Made me realize that nested maps/slices would be a nightmare.  Okay I think we can call this not doable.  Thanks everyone for you help!"}], "tags": [], "owner": {"reputation": 938, "user_id": 3894179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c6b1c2c08d1075995cb780ee8a2e36e?s=128&d=identicon&r=PG", "display_name": "Andra", "link": "https://stackoverflow.com/users/3894179/andra"}, "is_accepted": false, "score": 0, "last_activity_date": 1572231345, "creation_date": 1572231345, "answer_id": 58585284, "question_id": 58585062, "link": "https://stackoverflow.com/questions/58585062/does-golang-have-something-like-pythons-ast-literal-eval-for-converting-a-str/58585284#58585284", "title": "Does Golang have something like python&#39;s ast.literal_eval() for converting a string representation of a map into an actual map object?", "body": "<p>The map representation in <code>myMap</code> is wrong. You should write it like this</p>\n\n<pre><code>map[string]int{\"foo\": 1, \"bar\": 2}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 12283587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/edf6b28dfe94be8030da9a30259a82f9?s=128&d=identicon&r=PG&f=1", "display_name": "Ferros", "link": "https://stackoverflow.com/users/12283587/ferros"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 237, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1572231345, "creation_date": 1572228883, "last_edit_date": 1572231180, "question_id": 58585062, "link": "https://stackoverflow.com/questions/58585062/does-golang-have-something-like-pythons-ast-literal-eval-for-converting-a-str", "title": "Does Golang have something like python&#39;s ast.literal_eval() for converting a string representation of a map into an actual map object?", "body": "<p>I need to convert the string representation of a map object into an actual map object in Go.  Python has this functionality via ast.literal_eval() and looking for something similar in Go.</p>\n\n<p>I've checked out Go's ast lib <a href=\"https://golang.org/pkg/go/ast\" rel=\"nofollow noreferrer\">https://golang.org/pkg/go/ast</a> but I'm not finding similar functionality. Also a third party lib <a href=\"https://github.com/apaxa-go/eval\" rel=\"nofollow noreferrer\">https://github.com/apaxa-go/eval</a> that \"appears\" to support this via their example code in the readme (though not specific to maps):</p>\n\n<pre><code>src:=\"int8(1*(1+2))\"\nexpr,err:=ParseString(src,\"\")\nif err!=nil{\n    return err\n}\nr,err:=expr.EvalToInterface(nil)\nif err!=nil{\n    return err\n}\nfmt.Printf(\"%v %T\", r, r)   // \"3 int8\"\n</code></pre>\n\n<p>But when attempting with a map:</p>\n\n<pre><code>myMap := \"map[blah:1 stuff:2 list:3]\"\nexpr, err := eval.ParseString(myMap, \"\")\nif err != nil{\n    log.Fatal(\"%v\", err)\n}\nlog.Printf(\"%v %T\", expr, expr)\nresult, err := expr.EvalToInterface(nil)\nif err != nil{\n    log.Fatal(\"%v\", err)\n}\nlog.Printf(\"%v %T\", result, result)\n</code></pre>\n\n<p>I get the following error message:</p>\n\n<pre><code>2019/10/27 18:38:27.242352 main.go:33: %vexpression:1:9: expected ']', found ':'\n</code></pre>\n\n<p>where line 33 is the expression:</p>\n\n<pre><code>expr, err := eval.ParseString(myMap, \"\")\n</code></pre>\n\n<p>I'm pretty new to Go so I might be approaching this from the wrong direction.  Any help would be appreciated.  The end goal is to take this string representation of a map and convert it to JSON.</p>\n"}, {"tags": ["go", "go-ethereum"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1572227917, "post_id": 58584954, "comment_id": 103483966, "body": "It shows an out of memory error. Maybe a leak?"}, {"owner": {"reputation": 1, "user_id": 7334281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff25b05fc93273e9fc9e05d1972285bd?s=128&d=identicon&r=PG&f=1", "display_name": "dj Wang", "link": "https://stackoverflow.com/users/7334281/dj-wang"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1572230856, "post_id": 58584954, "comment_id": 103484486, "body": "I know, I just want to know what is happend and why?"}], "owner": {"reputation": 1, "user_id": 7334281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff25b05fc93273e9fc9e05d1972285bd?s=128&d=identicon&r=PG&f=1", "display_name": "dj Wang", "link": "https://stackoverflow.com/users/7334281/dj-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 148, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1572227703, "creation_date": 1572227703, "question_id": 58584954, "link": "https://stackoverflow.com/questions/58584954/crashed-with-lots-of-error-response-authentication-needed-password-or-unlock", "title": "crashed with lots of error response &quot;authentication needed: password or unlock&quot;", "body": "<p>Our ethereum network node crashed on oct 24, with lots of error response \"authentication needed: password or unlock\". The QPS is about 1~2, which is very low. According to our ab test, the node can support at most 60 QPS invalid request.</p>\n\n<p>here are logs</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>WARN [10-24|18:29:47.975] Served eth_signTransaction               conn=45.76.106.157:6362    reqid=84   t=98.264\u00b5s    err=\"authentication needed: password or unlock\"\nWARN [10-24|18:29:48.062] Served eth_signTransaction               conn=144.48.63.243:50830   reqid=51   t=64.547\u00b5s    err=\"authentication needed: password or unlock\"\nINFO [10-24|18:29:48.224] Setting new local account                address=0x40A49838dd7f61666258254a2D9f611eFC408800\nINFO [10-24|18:29:48.232] Submitted transaction                    fullhash=0x699e9c6d24198c0bff1edf147ee133eb6c2acc326bf8e1becff635b2035b6a78 recipient=0x2E65E12b5f0fD1D58738c6F38dA7D57F5F183d1c\nfatal error: runtime: out of memory\nruntime stack:\nruntime.throw(0x10e662b, 0x16)\n    /usr/lib/go-1.11/src/runtime/panic.go:608 +0x72\nruntime.sysMap(0xc47c000000, 0x10000000, 0x23bc178)\n    /usr/lib/go-1.11/src/runtime/mem_linux.go:156 +0xc7\nruntime.(*mheap).sysAlloc(0x238d3e0, 0x10000000, 0x680031f220, 0x7fe5bdffacd8)\n    /usr/lib/go-1.11/src/runtime/malloc.go:619 +0x1c7\nruntime.(*mheap).grow(0x238d3e0, 0x8000, 0x0)\n    /usr/lib/go-1.11/src/runtime/mheap.go:920 +0x42\nruntime.(*mheap).allocSpanLocked(0x238d3e0, 0x8000, 0x23bc188, 0x0)\n    /usr/lib/go-1.11/src/runtime/mheap.go:848 +0x337\nruntime.(*mheap).alloc_m(0x238d3e0, 0x8000, 0x101, 0x149c0f8)\n    /usr/lib/go-1.11/src/runtime/mheap.go:692 +0x119\nruntime.(*mheap).alloc.func1()\n    /usr/lib/go-1.11/src/runtime/mheap.go:759 +0x4c\nruntime.(*mheap).alloc(0x238d3e0, 0x8000, 0x7fe5bd010101, 0x43ada0)\n    /usr/lib/go-1.11/src/runtime/mheap.go:758 +0x8a\nruntime.largeAlloc(0x10000000, 0x460101, 0xc46c000000)\n    /usr/lib/go-1.11/src/runtime/malloc.go:1019 +0x97\nruntime.mallocgc.func1()\n    /usr/lib/go-1.11/src/runtime/malloc.go:914 +0x46\nruntime.systemstack(0x0)\n    /usr/lib/go-1.11/src/runtime/asm_amd64.s:351 +0x66\nruntime.mstart()\n    /usr/lib/go-1.11/src/runtime/proc.go:1229\n\n...\n</code></pre>\n"}, {"tags": ["go", "nginx", "nginx-reverse-proxy"], "answers": [{"tags": [], "owner": {"reputation": 456, "user_id": 472427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/2bb9596cdff38909b67f70aecf36c557?s=128&d=identicon&r=PG", "display_name": "AndyM", "link": "https://stackoverflow.com/users/472427/andym"}, "is_accepted": false, "score": 1, "last_activity_date": 1572212047, "creation_date": 1572212047, "answer_id": 58583566, "question_id": 58583161, "link": "https://stackoverflow.com/questions/58583161/nginx-proxy-pass-on-giving-404-with-go-app/58583566#58583566", "title": "nginx proxy_pass on / giving 404 with go app", "body": "<p>Must have been a mixup somewhere between loaded configs and what I thought was loaded. I rebooted my vps and double checked everything config wise and its working now. </p>\n"}], "owner": {"reputation": 456, "user_id": 472427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/2bb9596cdff38909b67f70aecf36c557?s=128&d=identicon&r=PG", "display_name": "AndyM", "link": "https://stackoverflow.com/users/472427/andym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1572212047, "creation_date": 1572208715, "last_edit_date": 1572209025, "question_id": 58583161, "link": "https://stackoverflow.com/questions/58583161/nginx-proxy-pass-on-giving-404-with-go-app", "title": "nginx proxy_pass on / giving 404 with go app", "body": "<p>I've a simple go app which serves html via nginx proxy_pass. My issue is that I get a 404 on the / , the other  directives work fine. Any ideas ?</p>\n\n<p>nginx config file</p>\n\n<pre><code>server {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n\n location  / {\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_pass http://localhost:8001;\n      }\n\n location /codcall {\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_pass http://localhost:8001;\n   }\n location /codcall-dev {\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_pass http://localhost:8001;\n   }\n}\n</code></pre>\n\n<p>my go app routes</p>\n\n<pre><code>func main() {\n        http.HandleFunc(\"/\", indexHandler)\n        http.HandleFunc(\"/codcall\", indexHandler)\n        http.HandleFunc(\"/codcall-dev\", indexHandler)\n        http.ListenAndServe(\":8001\", nil)\n\n}\n</code></pre>\n"}, {"tags": ["multithreading", "go", "assembly", "parallel-processing", "atomic"], "comments": [{"owner": {"reputation": 35113, "user_id": 3826372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P0peM.png?s=128&g=1", "display_name": "Ross Ridge", "link": "https://stackoverflow.com/users/3826372/ross-ridge"}, "edited": false, "score": 2, "creation_date": 1572198944, "post_id": 58581820, "comment_id": 103478206, "body": "The XCHG instruction with a memory operand has an implicit LOCK which provides additional ordering guarantees over and above the x86&#39;s already strong default ordering of memory accesses. The fact that they&#39;ve used this instruction instead of the simple MOV to memory instruction necessary for an atomic store suggests that these additional guarantees are required for <code>atomic.StoreInt32</code>."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1572199056, "post_id": 58581820, "comment_id": 103478228, "body": "XCHGL does a bus lock if the operand is a memory address."}, {"owner": {"reputation": 1572, "user_id": 1354445, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2ddd831999b590a537efc3d42f981e02?s=128&d=identicon&r=PG", "display_name": "tna0y", "link": "https://stackoverflow.com/users/1354445/tna0y"}, "reply_to_user": {"reputation": 35113, "user_id": 3826372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P0peM.png?s=128&g=1", "display_name": "Ross Ridge", "link": "https://stackoverflow.com/users/3826372/ross-ridge"}, "edited": false, "score": 0, "creation_date": 1572199362, "post_id": 58581820, "comment_id": 103478288, "body": "@RossRidge Could you elaborate on strong default memory ordering in x86? Could n&#39;t find any information on that. Could this be the reason why the example given in the second half of the question works even without atomics?"}, {"owner": {"reputation": 35113, "user_id": 3826372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P0peM.png?s=128&g=1", "display_name": "Ross Ridge", "link": "https://stackoverflow.com/users/3826372/ross-ridge"}, "edited": false, "score": 1, "creation_date": 1572200304, "post_id": 58581820, "comment_id": 103478491, "body": "Sorry, I don&#39;t really know Go, so can&#39;t comment on your code, but you can see a summary of the x86 guarantees here: <a href=\"https://bartoszmilewski.com/2008/11/05/who-ordered-memory-fences-on-an-x86/\" rel=\"nofollow noreferrer\">bartoszmilewski.com/2008/11/05/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1572202065, "post_id": 58582193, "comment_id": 103478962, "body": "@RossRidge: good point, added a section at the top to explicitly make the point I intended."}], "tags": [], "owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": true, "score": 4, "last_activity_date": 1572201989, "last_edit_date": 1572201989, "creation_date": 1572201240, "answer_id": 58582193, "question_id": 58581820, "link": "https://stackoverflow.com/questions/58581820/what-is-the-point-of-atomic-load-and-atomic-store/58582193#58582193", "title": "What is the point of atomic.Load and atomic.Store", "body": "<p><strong>I don't know Go at all, but it looks like the x86-64 implementations of <code>.load()</code> and <code>.store()</code> <em>are</em> sequentially-consistent.</strong>  Presumably on purpose / for a reason!</p>\n\n<p><code>//go:noinline</code> on the load means the compiler can't reorder around a blackbox non-inline function, I assume.  On x86 that's all you need for the load side of sequential-consistency, or acq-rel.  A plain x86 <code>mov</code> load is an acquire load.</p>\n\n<p>The compiler-generated code gets to take advantage of <strong>x86's strongly-ordered memory model, which is sequential consistency + a store buffer (with store forwarding), i.e. acq/rel.</strong>  To recover sequential consistency, you only need to drain the store buffer after a release-store.</p>\n\n<p><code>.store()</code> is written in asm, loading its stack args and using <code>xchg</code> as a seq-cst store.</p>\n\n<hr>\n\n<p><code>XCHG</code> with memory has an implicit <code>lock</code> prefix which is a full barrier; it's an efficient alternative to <code>mov</code>+<code>mfence</code> to implement what C++ would call a <code>memory_order_seq_cst</code> store.</p>\n\n<p>It flushes the store buffer before later loads and stores are allowed to touch L1d cache.  <strong><a href=\"https://stackoverflow.com/questions/49107683/why-does-a-stdatomic-store-with-sequential-consistency-use-xchg\">Why does a std::atomic store with sequential consistency use XCHG?</a></strong></p>\n\n<p>See </p>\n\n<ul>\n<li><a href=\"https://bartoszmilewski.com/2008/11/05/who-ordered-memory-fences-on-an-x86/\" rel=\"nofollow noreferrer\">https://bartoszmilewski.com/2008/11/05/who-ordered-memory-fences-on-an-x86/</a></li>\n<li><a href=\"https://www.cl.cam.ac.uk/~pes20/cpp/cpp0xmappings.html\" rel=\"nofollow noreferrer\">C/C++11 mappings to processors\n</a> describes the sequences of instructions that implement relaxed load/store, acq/rel load/store, seq-cst load/store, and various barriers, on various ISAs.  So you can recognize things like xchg with memory.</li>\n<li><p><a href=\"https://stackoverflow.com/questions/40409297/does-lock-xchg-have-the-same-behavior-as-mfence\">Does lock xchg have the same behavior as mfence?</a> (TL:DR: yes except for maybe some corner cases with NT loads from WC memory, e.g. from video RAM).  You may see a dummy <code>lock add $0, (SP)</code> used as an alternative to <code>mfence</code> in some code.</p>\n\n<p>IIRC, AMD's optimization manual even recommends this.  It's good on Intel as well, especially on Skylake where <code>mfence</code> was strengthened by microcode update <a href=\"https://stackoverflow.com/questions/50494658/are-loads-and-stores-the-only-instructions-that-gets-reordered/50496379#50496379\">to fully block out-of-order exec</a>  even of ALU instructions (like lfence) as well as memory reordering.  (To fix an erratum with NT loads.)</p></li>\n<li><p><a href=\"https://preshing.com/20120913/acquire-and-release-semantics/\" rel=\"nofollow noreferrer\">https://preshing.com/20120913/acquire-and-release-semantics/</a></p></li>\n</ul>\n"}], "owner": {"reputation": 1572, "user_id": 1354445, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2ddd831999b590a537efc3d42f981e02?s=128&d=identicon&r=PG", "display_name": "tna0y", "link": "https://stackoverflow.com/users/1354445/tna0y"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 2, "accepted_answer_id": 58582193, "answer_count": 1, "score": 3, "last_activity_date": 1572203673, "creation_date": 1572198211, "last_edit_date": 1572203673, "question_id": 58581820, "link": "https://stackoverflow.com/questions/58581820/what-is-the-point-of-atomic-load-and-atomic-store", "title": "What is the point of atomic.Load and atomic.Store", "body": "<p>In the Go's memory model nothing is stated about atomics and their relation to memory fencing. </p>\n\n<p>Although many internal packages seem to rely on the memory ordering that could be provided if atomics created memory fences around them. See <a href=\"https://github.com/golang/go/issues/5045\" rel=\"nofollow noreferrer\">this issue</a> for details.</p>\n\n<p>After not understanding how it really works, I went to the sources, in particular <a href=\"https://github.com/golang/go/blob/master/src/runtime/internal/atomic/atomic_amd64.go\" rel=\"nofollow noreferrer\">src/runtime/internal/atomic/atomic_amd64.go</a> and found following implementations of <code>Load</code> and <code>Store</code>: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>//go:nosplit\n//go:noinline\nfunc Load(ptr *uint32) uint32 {\n    return *ptr\n}\n</code></pre>\n\n<p><code>Store</code> is implemented in <code>asm_amd64.s</code> in the same package.</p>\n\n<pre><code>TEXT runtime\u2215internal\u2215atomic\u00b7Store(SB), NOSPLIT, $0-12\n    MOVQ    ptr+0(FP), BX\n    MOVL    val+8(FP), AX\n    XCHGL   AX, 0(BX)\n    RET\n</code></pre>\n\n<p>Both look as if they had nothing to do with parallelism. </p>\n\n<p>I did look into other architectures but implementation seems to be equivalent.</p>\n\n<p>However, if atomics are indeed weak and provide no memory ordering guarantees, than the code below could fail, but it does not. </p>\n\n<p>As an addition I tried replacing atomic calls with simple assignments but it still produces consistent and \"successful\" result in both cases.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nfunc try() {\n    var a, b int32\n\n    go func() {\n        // atomic.StoreInt32(&amp;a, 1)\n        // atomic.StoreInt32(&amp;b, 1)\n        a = 1\n        b = 1\n    }()\n\n    for {\n        // if n := atomic.LoadInt32(&amp;b); n == 1 {\n        if n := b; n == 1 {\n            if a != 1 {\n                panic(\"fail\")\n            }\n            break\n        }\n        runtime.Gosched()\n    }\n}\n\nfunc main() {\n    n := 1000000000\n    for i := 0; i &lt; n ; i++ {\n        try()\n    }\n}\n</code></pre>\n\n<p>The next thought was that the compiler does some magic to provide ordering guarantees. So below is the listing of the variant with atomic <code>Store</code> and <code>Load</code> not commented. Full listing is available on the <a href=\"https://pastebin.com/zfFtfnWy\" rel=\"nofollow noreferrer\">pastebin</a>.</p>\n\n<pre><code>// Anonymous function implementation with atomic calls inlined\n\nTEXT %22%22.try.func1(SB) gofile../path/atomic.go\n        atomic.StoreInt32(&amp;a, 1)\n  0x816         b801000000      MOVL $0x1, AX\n  0x81b         488b4c2408      MOVQ 0x8(SP), CX\n  0x820         8701            XCHGL AX, 0(CX)\n        atomic.StoreInt32(&amp;b, 1)\n  0x822         b801000000      MOVL $0x1, AX\n  0x827         488b4c2410      MOVQ 0x10(SP), CX\n  0x82c         8701            XCHGL AX, 0(CX)\n    }()\n  0x82e         c3          RET\n</code></pre>\n\n<pre><code>// Important \"cycle\" part of try() function\n\n 0x6ca          e800000000      CALL 0x6cf      [1:5]R_CALL:runtime.newproc\n    for {\n  0x6cf         eb12            JMP 0x6e3\n        runtime.Gosched()\n  0x6d1         90          NOPL\n    checkTimeouts()\n  0x6d2         90          NOPL\n    mcall(gosched_m)\n  0x6d3         488d0500000000      LEAQ 0(IP), AX      [3:7]R_PCREL:runtime.gosched_m\u00b7f\n  0x6da         48890424        MOVQ AX, 0(SP)\n  0x6de         e800000000      CALL 0x6e3      [1:5]R_CALL:runtime.mcall\n        if n := atomic.LoadInt32(&amp;b); n == 1 {\n  0x6e3         488b442420      MOVQ 0x20(SP), AX\n  0x6e8         8b08            MOVL 0(AX), CX\n  0x6ea         83f901          CMPL $0x1, CX\n  0x6ed         75e2            JNE 0x6d1\n            if a != 1 {\n  0x6ef         488b442428      MOVQ 0x28(SP), AX\n  0x6f4         833801          CMPL $0x1, 0(AX)\n  0x6f7         750a            JNE 0x703\n  0x6f9         488b6c2430      MOVQ 0x30(SP), BP\n  0x6fe         4883c438        ADDQ $0x38, SP\n  0x702         c3          RET\n</code></pre>\n\n<p>As you can see, no fences or locks are in place again.</p>\n\n<p>Note: all tests are done on x86_64 and i5-8259U </p>\n\n<p><strong>The question:</strong></p>\n\n<p>So, is there any point of wrapping simple pointer dereference in a function call or is there some hidden meaning to it and why do these atomics still work as memory barriers? (if they do)</p>\n"}, {"tags": ["go", "mysql-connector"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1572199384, "creation_date": 1572199384, "answer_id": 58581962, "question_id": 58581713, "link": "https://stackoverflow.com/questions/58581713/build-command-line-arguments-cannot-load-go-sql-driver-mysql/58581962#58581962", "title": "build command-line-arguments: cannot load go-sql-driver/mysql", "body": "<p>Change the import to:</p>\n\n<pre><code>import _ \"github.com/go-sql-driver/mysql\"\n</code></pre>\n\n<p>Go imports must have the full path to the imported module.</p>\n"}], "owner": {"reputation": 25, "user_id": 11371899, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-q6t09GsWyVc/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbCUyPyy_w2OiwmI3uMWXZxOvSW9Ug/mo/photo.jpg?sz=128", "display_name": "Lex Ushakov", "link": "https://stackoverflow.com/users/11371899/lex-ushakov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572201999, "creation_date": 1572197250, "last_edit_date": 1572201999, "question_id": 58581713, "link": "https://stackoverflow.com/questions/58581713/build-command-line-arguments-cannot-load-go-sql-driver-mysql", "title": "build command-line-arguments: cannot load go-sql-driver/mysql", "body": "<p>I got an error</p>\n\n<pre><code>build command-line-arguments: cannot load go-sql-driver/mysql: malformed module path \"go-sql-driver/mysql\": missing dot in first path element\n</code></pre>\n\n<p>while application code is</p>\n\n<pre><code>package main\n\nimport \"database/sql\"\nimport _ \"go-sql-driver/mysql\"\n\nfunc main() {\n  db, err := sql.Open(\"mysql\", \"root:xxx@(127.0.0.1:3306)/dbname?parseTime=true\")\n  err := db.Ping()\n}\n</code></pre>\n\n<p>I'v done with <code>go get -u github.com/go-sql-driver/mysql</code>, and <code>go.mod</code> was updated, it looks fine.</p>\n\n<p>Can someone help to solve this?</p>\n"}, {"tags": ["google-app-engine", "go", "nginx", "google-cloud-platform"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1572242742, "post_id": 58581634, "comment_id": 103486328, "body": "Da codez, plz! Without the code, it is hard to find out what is going on..."}, {"owner": {"reputation": 1, "user_id": 2054002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb975c91d60a64212660954c412e3234?s=128&d=identicon&r=PG", "display_name": "Tai", "link": "https://stackoverflow.com/users/2054002/tai"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1572244787, "post_id": 58581634, "comment_id": 103486738, "body": "@MarkusWMahlberg I have added the code. Thanks."}, {"owner": {"reputation": 864, "user_id": 8456296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a114e79267550524bf4c8e48f08f3ee1?s=128&d=identicon&r=PG&f=1", "display_name": "dhauptman", "link": "https://stackoverflow.com/users/8456296/dhauptman"}, "edited": false, "score": 0, "creation_date": 1572276428, "post_id": 58581634, "comment_id": 103500463, "body": "Looking at other similar issues in Stackoverflow I see that this issue is often related to timeouts due to long running operations. Do you still get the same error if you increase the nginx keepalive_timeout parameter?"}], "owner": {"reputation": 1, "user_id": 2054002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb975c91d60a64212660954c412e3234?s=128&d=identicon&r=PG", "display_name": "Tai", "link": "https://stackoverflow.com/users/2054002/tai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1044, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1572272891, "creation_date": 1572196575, "last_edit_date": 1572272891, "question_id": 58581634, "link": "https://stackoverflow.com/questions/58581634/upstream-prematurely-closed-connection-while-reading-response-header-from-upstre", "title": "Upstream prematurely closed connection while reading response header from upstream, client:", "body": "<p>I'd appreciate some help. I have deployed Go on Google App Engine. The server shuts down for some time which means we cannot get the messages coming in. The trigger is from the upstream prematurely closed connection while reading response header from upstream, client: The error:</p>\n\n<pre><code>2019/10/27 08:25:26 [error] 23#23: *166 upstream prematurely closed connection while reading response header from upstream, client: 169.x.x.x, server: _, request: \"POST /api/v2/money/topup HTTP/1.1\", upstream: \"http://127.0.0.1:8081/api/v2/money/topup\", host: \u201cx.x.x\u201d\n{\n insertId:\u00a0\"5db55476000502bed07e4583\"\u00a0 \n labels:\u00a0{\n  clone_id:\u00a0\"00c61b117c10abbe48ef11bb1f4ad5987e3ba1611745455daf2a1d6634c62289065e6f871e6c\"\u00a0  \n }\n logName:\u00a0\"projects/showcase/logs/%2Fvar%2Flog%2Fnginx%2Ferror.log\"\u00a0 \n receiveTimestamp:\u00a0\"2019-10-27T08:25:26.334404825Z\"\u00a0 \n resource:\u00a0{\n  labels:\u00a0{\u2026}\u00a0  \n  type:\u00a0\"gae_app\"\u00a0  \n }\n textPayload:\u00a0\"2019/10/27 08:25:26 [error] 23#23: *166 upstream prematurely closed connection while reading response header from upstream, client: 169.254.1.1, server: _, request: \"POST /api/v2/money/topup HTTP/1.1\", upstream: \"http://127.0.0.1:8081/api/v2/money/topup\", host: \u201cx.x.x\u201d\u201d\u00a0 \n timestamp:\u00a0\"2019-10-27T08:25:26.328382Z\"\u00a0 \n}\n</code></pre>\n\n<p>The image breakdown is here: <a href=\"https://i.stack.imgur.com/ffeRP.png\" rel=\"nofollow noreferrer\">error log</a></p>\n\n<p>My Nginx.conf configuration setting:</p>\n\n<pre><code>events {\n    worker_connections 768;\n}\n\nhttp {\n    sendfile on;\n    tcp_nopush on;\n    tcp_nodelay on;\n    keepalive_timeout 650;\n    keepalive_requests 10000;\n    types_hash_max_size 2048;\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n\n    # Logs will appear on the Google Developer's Console when logged to this\n    # directory.\n    access_log /var/log/app_engine/app.log;\n    error_log /var/log/app_engine/app.log;\n\n    gzip on;\n    gzip_disable \"msie6\";\n\n    server {\n        # Google App Engine expects the runtime to serve HTTP traffic from\n        # port 8080.\n        listen 8080;\n        root /usr/share/nginx/www;\n        index index.html index.htm;\n    }\n}\n</code></pre>\n\n<p>And for the app.yaml is:</p>\n\n<pre><code>runtime: go111\ninstance_class: F2\nautomatic_scaling:\nmin_idle_instances: 5\nmax_idle_instances: automatic  # default value\nmin_pending_latency: 30ms  # default value\nmax_pending_latency: automatic\nmax_concurrent_requests: 50\n</code></pre>\n\n<p>The function that is being called:</p>\n\n<pre><code>func (h Handler) UpdateTopUps(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n\nvar payload model.C2BCallBack\ndefer r.Body.Close()\nerr := json.NewDecoder(r.Body).Decode(&amp;payload)\nif err != nil {\n    http.Error(w, \"Bad Request\", http.StatusBadRequest)\n    return\n}\n\nstr := spew.Sdump(payload)\nlog.Println(str)\n\nid := uuid.NewV4()\nif err != nil {\n    fmt.Printf(\"Something went wrong: %s\", err)\n    return\n}\n\nif len(payload.MSISDN) &gt; 0 {\n    amount := strings.Split(payload.TransAmount, \".\")\n    balance := strings.Split(payload.OrgAccountBalance, \".\")\n\n    var phoneNumber string\n    if strings.HasPrefix(payload.MSISDN, \"07\") {\n        phoneNumber = \"255\" + payload.MSISDN[1:]\n    } else {\n        phoneNumber = payload.MSISDN\n    }\n\n    res := h.database.Create(&amp;model.MpesaTransaction{MpesaTransactionId: id, TransID: payload.TransID, TransTime: payload.TransTime,\n        TransAmount: amount[0], BusinessShortCode: payload.BusinessShortCode, OrgAccountBalance: balance[0],\n        MSISDN: phoneNumber, FirstName: payload.FirstName, MiddleName: payload.MiddleName, LastName: payload.LastName})\n\n    if err != nil {\n        http.Error(w, \"Internal Server Error\", http.StatusInternalServerError)\n        return\n    }\n\n    h.updateWalletBalance(res.Value)\n}\n</code></pre>\n\n<p>}</p>\n\n<p>It works sometimes and then fails with the above error.</p>\n"}, {"tags": ["go", "go-modules", "apache-pulsar"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 12280542, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t35Os9BohOA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7jpB3NQZbEaXVAhfjpHyZ0pJkgg/photo.jpg?sz=128", "display_name": "Mithran Kulasekaran", "link": "https://stackoverflow.com/users/12280542/mithran-kulasekaran"}, "edited": false, "score": 0, "creation_date": 1572216753, "post_id": 58583247, "comment_id": 103482279, "body": "I tried it but it was not working, What is get after doing a <code>go build</code> is  <code>require ( \tgithub.com&#47;apache&#47;pulsar v2.4.1+incompatible \tgithub.com&#47;apache&#47;pulsar&#47;pulsar-client-go v0.0.0-20191027154418-6fb5fd207cfd )</code> which is like the C++ libs got the old version and it starts erroring out. ERROR: <code>go: finding github.com&#47;apache&#47;pulsar&#47;pulsar-client-go latest # github.com&#47;apache&#47;pulsar&#47;pulsar-client-go&#47;pulsar In file included from c_client.go:24:0,</code>"}, {"owner": {"reputation": 730, "user_id": 6161244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/990831a04db3b7c4a8ac83e67e00817d?s=128&d=identicon&r=PG", "display_name": "Constantin Konstantinidis", "link": "https://stackoverflow.com/users/6161244/constantin-konstantinidis"}, "reply_to_user": {"reputation": 21, "user_id": 12280542, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t35Os9BohOA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7jpB3NQZbEaXVAhfjpHyZ0pJkgg/photo.jpg?sz=128", "display_name": "Mithran Kulasekaran", "link": "https://stackoverflow.com/users/12280542/mithran-kulasekaran"}, "edited": false, "score": 0, "creation_date": 1572251431, "post_id": 58583247, "comment_id": 103488792, "body": "Which go version do you use ? Is any value set for GO111MODULE ?"}, {"owner": {"reputation": 21, "user_id": 12280542, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t35Os9BohOA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7jpB3NQZbEaXVAhfjpHyZ0pJkgg/photo.jpg?sz=128", "display_name": "Mithran Kulasekaran", "link": "https://stackoverflow.com/users/12280542/mithran-kulasekaran"}, "edited": false, "score": 0, "creation_date": 1572312289, "post_id": 58583247, "comment_id": 103512916, "body": "Verions <code>go version go1.13.3 linux&#47;amd64</code> , Yes GO11MODULE=yes is enabled i am able to get all the other dependencies only pulsar due to nested structure is having this issue."}, {"owner": {"reputation": 730, "user_id": 6161244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/990831a04db3b7c4a8ac83e67e00817d?s=128&d=identicon&r=PG", "display_name": "Constantin Konstantinidis", "link": "https://stackoverflow.com/users/6161244/constantin-konstantinidis"}, "reply_to_user": {"reputation": 21, "user_id": 12280542, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t35Os9BohOA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7jpB3NQZbEaXVAhfjpHyZ0pJkgg/photo.jpg?sz=128", "display_name": "Mithran Kulasekaran", "link": "https://stackoverflow.com/users/12280542/mithran-kulasekaran"}, "edited": false, "score": 0, "creation_date": 1572326001, "post_id": 58583247, "comment_id": 103515322, "body": "Details of documentation are <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Modules</a>. GO111MODULE=on (or auto on go1.13). Value &quot;yes&quot; gives unpredictable results."}, {"owner": {"reputation": 21, "user_id": 12280542, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t35Os9BohOA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7jpB3NQZbEaXVAhfjpHyZ0pJkgg/photo.jpg?sz=128", "display_name": "Mithran Kulasekaran", "link": "https://stackoverflow.com/users/12280542/mithran-kulasekaran"}, "edited": false, "score": 0, "creation_date": 1572492095, "post_id": 58583247, "comment_id": 103579547, "body": "Thanks, I tried both parameters for GO111MODULE,  on and auto but still it is getting the same error the submodule  becomes the latest like <code>require ( \tgithub.com&#47;apache&#47;pulsar v2.4.1+incompatible \tgithub.com&#47;apache&#47;pulsar&#47;pulsar-client-go v0.0.0-20191030143938-7b5693fed89a ) </code> after i do a go build"}, {"owner": {"reputation": 730, "user_id": 6161244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/990831a04db3b7c4a8ac83e67e00817d?s=128&d=identicon&r=PG", "display_name": "Constantin Konstantinidis", "link": "https://stackoverflow.com/users/6161244/constantin-konstantinidis"}, "reply_to_user": {"reputation": 21, "user_id": 12280542, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t35Os9BohOA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7jpB3NQZbEaXVAhfjpHyZ0pJkgg/photo.jpg?sz=128", "display_name": "Mithran Kulasekaran", "link": "https://stackoverflow.com/users/12280542/mithran-kulasekaran"}, "edited": false, "score": 0, "creation_date": 1572502586, "post_id": 58583247, "comment_id": 103581779, "body": "This seems intended as no error message displays; go get -u returns a similar log."}, {"owner": {"reputation": 21, "user_id": 12280542, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t35Os9BohOA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7jpB3NQZbEaXVAhfjpHyZ0pJkgg/photo.jpg?sz=128", "display_name": "Mithran Kulasekaran", "link": "https://stackoverflow.com/users/12280542/mithran-kulasekaran"}, "edited": false, "score": 0, "creation_date": 1573017743, "post_id": 58583247, "comment_id": 103739029, "body": "The major problem is after i tried to use modules , all the other libraries work, the root is downloading github.com/apache/pulsar with that tag, then it again downloads github.com/apache/pulsar/pulsar-client-go with the latest version the problem is since it uses C++ , cgo to maintain the dep it is not working."}, {"owner": {"reputation": 730, "user_id": 6161244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/990831a04db3b7c4a8ac83e67e00817d?s=128&d=identicon&r=PG", "display_name": "Constantin Konstantinidis", "link": "https://stackoverflow.com/users/6161244/constantin-konstantinidis"}, "reply_to_user": {"reputation": 21, "user_id": 12280542, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t35Os9BohOA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7jpB3NQZbEaXVAhfjpHyZ0pJkgg/photo.jpg?sz=128", "display_name": "Mithran Kulasekaran", "link": "https://stackoverflow.com/users/12280542/mithran-kulasekaran"}, "edited": false, "score": 0, "creation_date": 1573017900, "post_id": 58583247, "comment_id": 103739062, "body": "Issue <a href=\"https://github.com/golang/go/issues/34165\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/34165</a> reports the same problem which will be fixed in the next release go1.14."}], "tags": [], "owner": {"reputation": 730, "user_id": 6161244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/990831a04db3b7c4a8ac83e67e00817d?s=128&d=identicon&r=PG", "display_name": "Constantin Konstantinidis", "link": "https://stackoverflow.com/users/6161244/constantin-konstantinidis"}, "is_accepted": false, "score": 0, "last_activity_date": 1572209388, "creation_date": 1572209388, "answer_id": 58583247, "question_id": 58581050, "link": "https://stackoverflow.com/questions/58581050/how-to-use-go-modules-to-load-sub-directory-in-pulsar/58583247#58583247", "title": "How to use go modules to load sub directory in pulsar", "body": "<p>The latest release <code>v2.4.1</code> is on github.com/apache/pulsar and the line should read:</p>\n\n<pre><code>require  github.com/apache/pulsar v2.4.1\n</code></pre>\n\n<p>The module <code>pulsar-client-go</code> has no release (tag on github) and an error is reported.\nUsing <code>go get github.com/apache/pulsar</code> for instance should download all required dependencies.</p>\n"}], "owner": {"reputation": 21, "user_id": 12280542, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t35Os9BohOA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re7jpB3NQZbEaXVAhfjpHyZ0pJkgg/photo.jpg?sz=128", "display_name": "Mithran Kulasekaran", "link": "https://stackoverflow.com/users/12280542/mithran-kulasekaran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 186, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1572209388, "creation_date": 1572192230, "question_id": 58581050, "link": "https://stackoverflow.com/questions/58581050/how-to-use-go-modules-to-load-sub-directory-in-pulsar", "title": "How to use go modules to load sub directory in pulsar", "body": "<p>I am trying to use pulsar go client using go modules but not able to import with the correct version.</p>\n\n<p>Created a go.mod file with pulsar dependency and also added other dependencies, earlier I was using dep and everything was fine. Now I moved to go modules and other packages are fine except pulsar dependency, I am not sure like what i am Missing. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>module sample \ngo 1.13 \nrequire  github.com/apache/pulsar/pulsar-client-go/pulsar v2.4.1 \n</code></pre>\n\n<p>require github.com/apache/pulsar/pulsar-client-go: version \"v2.4.1\" invalid: unknown revision pulsar-client-go/v2.4.1</p>\n"}, {"tags": ["go", "kubernetes", "load-balancing"], "comments": [{"owner": {"reputation": 7464, "user_id": 2858934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/177f29dc8d5bede9c5045b3948149ebf?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2858934/thomas"}, "edited": false, "score": 0, "creation_date": 1572195175, "post_id": 58580778, "comment_id": 103477311, "body": "how do you make the requests?"}, {"owner": {"reputation": 803, "user_id": 11324804, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100ef3bcefeb61283a72f73c4e90f323?s=128&d=identicon&r=PG&f=1", "display_name": "ligowsky", "link": "https://stackoverflow.com/users/11324804/ligowsky"}, "reply_to_user": {"reputation": 7464, "user_id": 2858934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/177f29dc8d5bede9c5045b3948149ebf?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2858934/thomas"}, "edited": false, "score": 0, "creation_date": 1572196570, "post_id": 58580778, "comment_id": 103477672, "body": "@Thomas I open Postman, enter an IP address with the port 30036 and a path /ping. After that, I click the Send button several times and receive responses. Then I open logs of pods and see there that all requests go to 1 of 3 pods."}], "answers": [{"tags": [], "owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "is_accepted": false, "score": 2, "last_activity_date": 1572193050, "creation_date": 1572193050, "answer_id": 58581173, "question_id": 58580778, "link": "https://stackoverflow.com/questions/58580778/only-1-pod-handles-all-requests-in-kubernetes-cluster/58581173#58581173", "title": "Only 1 pod handles all requests in Kubernetes cluster", "body": "<p>In Kubernetes cluster, requests that are sent to k8s services are routed by <a href=\"https://kubernetes.io/docs/reference/command-line-tools-reference/kube-proxy/\" rel=\"nofollow noreferrer\">kube-proxy</a>. </p>\n\n<p>The default <code>kube-proxy</code> mode is <code>Iptalbles</code> since Kubernetes v1.2 and it allows faster packet resolution between Services and backend Pods. The load balancing between backend Pods is done directly via the <code>iptables rules</code>.</p>\n\n<p>Maybe you're not generating enough load which one pod cannot handle, that's why you're routed to the same pod from <code>kube-proxy</code>. </p>\n\n<p>You can also see the answer to this question for implementing custom <code>iptalbes-rule</code>:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/51857978/implementing-iptables-rules-on-kubernetes-nodes\">Implementing iptables rules on Kubernetes nodes</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 7464, "user_id": 2858934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/177f29dc8d5bede9c5045b3948149ebf?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2858934/thomas"}, "is_accepted": true, "score": 7, "last_activity_date": 1572197153, "creation_date": 1572197153, "answer_id": 58581703, "question_id": 58580778, "link": "https://stackoverflow.com/questions/58580778/only-1-pod-handles-all-requests-in-kubernetes-cluster/58581703#58581703", "title": "Only 1 pod handles all requests in Kubernetes cluster", "body": "<p>You are exposing a service using a NodePort, so there is no reverse proxy in place, but you directly connect to your Pod(s). This is a good choice to start with. (Later you might want to use an Ingress)</p>\n\n<p>What you are seeing is that only one Pod handles your requests. You expect that each request is load balanced to a different pod. And your assumption is correct, but the load balancing does not happen on HTTP request layer, but on the TCP layer.</p>\n\n<p>So when you have a persistent TCP connection and re-use it, you will not experience the load balancing that you expect. Since establishing a TCP connection is rather expensive latency wise usually an optimization is in place to avoid repeatedly opening new TCP connections: HTTP keep-alive.</p>\n\n<p>Keep alive is by default enabled in most frameworks and clients, this is true for Go as well.\nTry <code>s.SetKeepAlivesEnabled(false)</code> and see if that fixes your issue. (Recommended only for testing!)</p>\n\n<p>You can also use multiple different clients, f.e. from the command line with curl or disable keep-alive in Postman.</p>\n"}, {"comments": [{"owner": {"reputation": 437, "user_id": 1544034, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7639d4fbda4f7c8b33591d1db39cbbe6?s=128&d=identicon&r=PG", "display_name": "Hammad Dar", "link": "https://stackoverflow.com/users/1544034/hammad-dar"}, "edited": false, "score": 0, "creation_date": 1610885601, "post_id": 61559263, "comment_id": 116268017, "body": "Spot on!, solved my problem..."}], "tags": [], "owner": {"reputation": 131, "user_id": 11404823, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a7nu2.png?s=128&g=1", "display_name": "salanfe", "link": "https://stackoverflow.com/users/11404823/salanfe"}, "is_accepted": false, "score": 3, "last_activity_date": 1588422020, "creation_date": 1588422020, "answer_id": 61559263, "question_id": 58580778, "link": "https://stackoverflow.com/questions/58580778/only-1-pod-handles-all-requests-in-kubernetes-cluster/61559263#61559263", "title": "Only 1 pod handles all requests in Kubernetes cluster", "body": "<p>thanks to @Thomas for the great insight ! I tried playing with the request header and it solved the load balancing issue where all requests where only hitting a single replica, whereas for demos or testing, it useful to be able to distribute requests to all replicas</p>\n\n<p>from the doc:</p>\n\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Connection\" rel=\"nofollow noreferrer\">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Connection</a>\nConnection: keep-alive\nConnection: close</p>\n\n<p>This request always hits the same pod</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>curl -H \"Connection: keep-alive\" http://your-service:port/path\n</code></pre>\n\n<p>However, using <code>close</code>, the request balanced to all pods</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>curl -H \"Connection: close\" http://your-service:port/path\n</code></pre>\n"}], "owner": {"reputation": 803, "user_id": 11324804, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100ef3bcefeb61283a72f73c4e90f323?s=128&d=identicon&r=PG&f=1", "display_name": "ligowsky", "link": "https://stackoverflow.com/users/11324804/ligowsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 949, "favorite_count": 0, "accepted_answer_id": 58581703, "answer_count": 3, "score": 3, "last_activity_date": 1588422020, "creation_date": 1572190197, "last_edit_date": 1572191517, "question_id": 58580778, "link": "https://stackoverflow.com/questions/58580778/only-1-pod-handles-all-requests-in-kubernetes-cluster", "title": "Only 1 pod handles all requests in Kubernetes cluster", "body": "<p>Here is a manifest file for minikube Kubernetes, for a deployment and a service:</p>\n\n<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: hello-deployment\nspec:\n  selector:\n    matchLabels:\n      app: hello\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: hello\n    spec:\n      containers:\n      - name: hello\n        image: hello_hello\n        imagePullPolicy: Never\n        ports:\n        - containerPort: 4001\n          protocol: TCP\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: hello\nspec:\n  selector:\n    app: hello\n  ports:\n  - port: 4001\n    nodePort: 30036\n    protocol: TCP\n  type: NodePort\n</code></pre>\n\n<p>And a simple HTTP-server written in Golang</p>\n\n<pre><code>package main\nimport (\n    http \"net/http\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n    r := gin.Default()\n    r.GET(\"/ping\", func(c *gin.Context) {\n        c.JSON(200, gin.H{\n            \"message\": \"pong\",\n        })\n    })\n\n    server := &amp;http.Server{\n        Addr:    \":4001\",\n        Handler: r,\n    }\n\n    server.ListenAndServe()\n}\n</code></pre>\n\n<p>When I make several requests to <em>IP:30036/ping</em> and then open pod's logs, I can see that only 1 of 3 pods handles all requests. How to make other pods response on requests? </p>\n"}, {"tags": ["docker", "go", "continuous-integration", "gitlab-ci", "gitlab-ci-runner"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1572211435, "post_id": 58580587, "comment_id": 103481292, "body": "Aside: <a href=\"https://golang.org/doc/go1.9#vendor-dotdotdot\" rel=\"nofollow noreferrer\"><code>.&#47;...</code> doesn&#39;t match vendored packages since 1.9</a>. <code>go list | grep</code> isn&#39;t necessary anymore."}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 9179039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d52a27b11e71d7107acd9d3e183b592e?s=128&d=identicon&r=PG&f=1", "display_name": "thomasA", "link": "https://stackoverflow.com/users/9179039/thomasa"}, "edited": false, "score": 0, "creation_date": 1572207473, "post_id": 58580879, "comment_id": 103480398, "body": "Hi, Thanks for your help but it didn&#39;t fix"}], "tags": [], "owner": {"reputation": 12147, "user_id": 4378400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wsSe.jpg?s=128&g=1", "display_name": "Yury Fedorov", "link": "https://stackoverflow.com/users/4378400/yury-fedorov"}, "is_accepted": false, "score": 0, "last_activity_date": 1572190949, "creation_date": 1572190949, "answer_id": 58580879, "question_id": 58580587, "link": "https://stackoverflow.com/questions/58580587/gitlab-ci-cd-runner-error-unrecognized-import-path-golang/58580879#58580879", "title": "Gitlab CI/CD Runner error: &quot; unrecognized import path&quot; GOLANG", "body": "<p>You should use full paths in your import statements, e.g</p>\n\n<pre><code>website/src/routes\n</code></pre>\n\n<p>should become </p>\n\n<pre><code>gitlab.com/thomasaudo/website/src/routes\n</code></pre>\n\n<p>Also, it looks like you use <code>govendor</code>, so you are probably missing <code>govendor sync</code> command in one of your build steps.</p>\n"}], "owner": {"reputation": 97, "user_id": 9179039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d52a27b11e71d7107acd9d3e183b592e?s=128&d=identicon&r=PG&f=1", "display_name": "thomasA", "link": "https://stackoverflow.com/users/9179039/thomasa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 196, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572190949, "creation_date": 1572188852, "question_id": 58580587, "link": "https://stackoverflow.com/questions/58580587/gitlab-ci-cd-runner-error-unrecognized-import-path-golang", "title": "Gitlab CI/CD Runner error: &quot; unrecognized import path&quot; GOLANG", "body": "<p>I'm trying to implement CI/CD for a GO project</p>\n\n<p>This is my gitlab-ci.yml file:</p>\n\n<pre><code>image: golang:latest\n\nvariables:\n  REPO_NAME: gitlab.com/thomasaudo/website\n\nbefore_script:\n  - cd $GOPATH/src\n  - mkdir -p gitlab.com/$CI_PROJECT_NAMESPACE\n  - cd gitlab.com/$CI_PROJECT_NAMESPACE\n  - ln -s $CI_PROJECT_DIR\n  - cd $CI_PROJECT_NAME\n\nstages:\n  - test\n\nformat:\n  stage: test\n  script:\n    - go get ./...\n    - go fmt $(go list ./... | grep -v /vendor/)\n    - go vet $(go list ./... | grep -v /vendor/)\n    - go test -race $(go list ./... | grep -v /vendor/)\n</code></pre>\n\n<p>However, my runner stopped with the following error: <code>package website/src/routes: unrecognized import path \"website/src/routes\" (import path does not begin with hostname)</code></p>\n\n<p>Thanks for your help </p>\n"}, {"tags": ["sql", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 6058505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0fa421ba0fd010c72905a02da066176?s=128&d=identicon&r=PG&f=1", "display_name": "mulles3008", "link": "https://stackoverflow.com/users/6058505/mulles3008"}, "edited": false, "score": 0, "creation_date": 1604412202, "post_id": 58636178, "comment_id": 114335594, "body": "Thanks! If one needs to populate the categories slice on the products, <code>Joins(...).Preload(&quot;Categories&quot;)</code> seems to do the trick."}], "tags": [], "owner": {"reputation": 783, "user_id": 1182658, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e49c58e5bd4e6d903e6df296d51ff74e?s=128&d=identicon&r=PG", "display_name": "Anup", "link": "https://stackoverflow.com/users/1182658/anup"}, "is_accepted": true, "score": 0, "last_activity_date": 1572489061, "creation_date": 1572489061, "answer_id": 58636178, "question_id": 58580040, "link": "https://stackoverflow.com/questions/58580040/how-to-filter-table-with-entity-from-other-tables-related-by-many-to-many-relati/58636178#58636178", "title": "How to filter table with entity from other tables related by many to many relationship using GORM?", "body": "<p>I found some ways to query products based on category and AttributeValue. The best way I got is like bellow</p>\n\n<pre><code>    products := []*model.Product{}\n\n    s.db.Joins(\"INNER JOIN product_attribute ON product_attribute.product_id = \" +\n                    \"product.product_id AND product_attribute.attribute_value_id in (?)\", 2).\n    Joins(\"INNER JOIN product_category ON product_category.product_id = \" +\n                    \"product.product_id AND product_category.category_id in (?)\", 3).\n    Find(&amp;products)\n</code></pre>\n\n<p>After executing this, products slice will be populated with all the products that are in the category with category_id 3 and has AttributeValue with attribute_value_id 2. We can pass slice of string if we need to find products in multiple Category &amp; AttributeValue.</p>\n"}], "owner": {"reputation": 783, "user_id": 1182658, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e49c58e5bd4e6d903e6df296d51ff74e?s=128&d=identicon&r=PG", "display_name": "Anup", "link": "https://stackoverflow.com/users/1182658/anup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "accepted_answer_id": 58636178, "answer_count": 1, "score": 1, "last_activity_date": 1572570698, "creation_date": 1572184513, "last_edit_date": 1572570698, "question_id": 58580040, "link": "https://stackoverflow.com/questions/58580040/how-to-filter-table-with-entity-from-other-tables-related-by-many-to-many-relati", "title": "How to filter table with entity from other tables related by many to many relationship using GORM?", "body": "<p>I have Product table which is connected with the other two tables Categorie &amp; AttributeValue using many to many relationships. I am using GORM as an ORM. go struct for those tables are like bellow.</p>\n\n<pre><code>type Product struct {\n    ProductID               int                  `gorm:\"column:product_id;primary_key\" json:\"product_id\"`\n    Name                    string               `gorm:\"column:name\" json:\"name\"`\n    Categories              []Category           `gorm:\"many2many:product_category;foreignkey:product_id;association_foreignkey:category_id;association_jointable_foreignkey:category_id;jointable_foreignkey:product_id;\"`\n    AttributeValues         []AttributeValue     `gorm:\"many2many:product_attribute;foreignkey:product_id;association_foreignkey:attribute_value_id;association_jointable_foreignkey:attribute_value_id;jointable_foreignkey:product_id;\"`\n}\n\n\ntype Category struct {\n    CategoryID   int         `gorm:\"column:category_id;primary_key\" json:\"category_id\"`\n    Name         string      `gorm:\"column:name\" json:\"name\"`\n    Products     []Product   `gorm:\"many2many:product_category;foreignkey:category_id;association_foreignkey:product_id;association_jointable_foreignkey:product_id;jointable_foreignkey:category_id;\"`\n}\n\n\ntype AttributeValue struct {\n    AttributeValueID int    `gorm:\"column:attribute_value_id;primary_key\" json:\"attribute_value_id\"`\n    AttributeID      int    `gorm:\"column:attribute_id\" json:\"attribute_id\"`\n    Value            string `gorm:\"column:value\" json:\"value\"`\n    Products     []Product   `gorm:\"many2many:product_attribute;foreignkey:attribute_value_id;association_foreignkey:product_id;association_jointable_foreignkey:product_id;jointable_foreignkey:attribute_value_id;\"`\n}\n</code></pre>\n\n<p>If I want to query Product table by category I can do it like bellow which will return all products in a category with category_id 3.</p>\n\n<pre><code>cat := model.Category{}\ns.db.First(&amp;cat, \"category_id = ?\", 3)\nproducts := []*model.Product{}\ns.db.Model(&amp;cat).Related(&amp;products, \"Products\")\n</code></pre>\n\n<p>If I want to query the Product table by both Category &amp; AttributeValue how can I do that? Suppose I want to find all the products that are in category with category_id 3 and has AttributeValue with attribute_value_id 2?</p>\n"}, {"tags": ["go", "etcd"], "answers": [{"tags": [], "owner": {"reputation": 492, "user_id": 5348041, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/371c5851901ee7948893a6733c6fde85?s=128&d=identicon&r=PG&f=1", "display_name": "viggy28", "link": "https://stackoverflow.com/users/5348041/viggy28"}, "is_accepted": false, "score": 0, "last_activity_date": 1572218096, "creation_date": 1572218096, "answer_id": 58584168, "question_id": 58579846, "link": "https://stackoverflow.com/questions/58579846/go-client-watch-etcd-event-has-failed/58584168#58584168", "title": "go client watch etcd event has failed", "body": "<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"time\"\n\n    clientv3 \"go.etcd.io/etcd/clientv3\"\n)\n\nfunc main() {\n    cli, err := clientv3.New(clientv3.Config{\n        Endpoints:   []string{\"localhost:2379\", \"localhost:22379\", \"localhost:32379\"},\n        DialTimeout: 5 * time.Second,\n    })\n    if err != nil {\n        // handle error!\n    }\n    defer cli.Close()\n    ctx := context.Background()\n    rch := cli.Watch(ctx, \"foo\")\n    for wresp := range rch {\n        for _, ev := range wresp.Events {\n            fmt.Printf(\"%s %q : %q\\n\", ev.Type, ev.Kv.Key, ev.Kv.Value)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/sFTsc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/sFTsc.png\" alt=\"watch using etcdctl\"></a></p>\n\n<p>In case if you haven't seen, check out the <a href=\"https://godoc.org/go.etcd.io/etcd/clientv3#example-Watcher--Watch\" rel=\"nofollow noreferrer\">example</a> from the doc</p>\n\n<p>To debug further, do you mind sharing your code?</p>\n"}], "owner": {"reputation": 1, "user_id": 7859787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43d52b77b34d89c33746f1d52d644731?s=128&d=identicon&r=PG&f=1", "display_name": "jianming", "link": "https://stackoverflow.com/users/7859787/jianming"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 198, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572218096, "creation_date": 1572182865, "last_edit_date": 1572184831, "question_id": 58579846, "link": "https://stackoverflow.com/questions/58579846/go-client-watch-etcd-event-has-failed", "title": "go client watch etcd event has failed", "body": "<p>when i use the etcd client <code>go.etcd.io/etcd/clientv3</code> to watch the etcd event, i found that i will receive many responses with empty events.the\nlog below:</p>\n\n<blockquote>\n  <p>ime=\"2019-10-27T20:39:13+08:00\" level=debug msg=\"ETCD watch response:\n  {Header:{ClusterId:0 MemberId:0 Revision:0 RaftTerm:0} Events:[]\n  CompactRevision:0 Canceled:false Created:false closeErr:\n  cancelReason:}\" file=\"backend.go:135\" time=\"2019-10-27T20:39:13+08:00\"\n  level=debug msg=\"ETCD watch response: {Header:{ClusterId:0 MemberId:0\n  Revision:0 RaftTerm:0} Events:[] CompactRevision:0 Canceled:false\n  Created:false closeErr: cancelReason:}\" file=\"backend.go:135\"\n  time=\"2019-10-27T20:39:13+08:00\" level=debug msg=\"ETCD watch response:\n  {Header:{ClusterId:0 MemberId:0 Revision:0 RaftTerm:0} Events:[]\n  CompactRevision:0 Canceled:false Created:false closeErr:\n  cancelReason:}\" file=\"backend.go:135\" time=\"2019-10-27T20:39:13+08:00\"\n  level=debug msg=\"ETCD watch response: {Header:{ClusterId:0 MemberId:0\n  Revision:0 RaftTerm:0} Events:[] CompactRevision:0 Canceled:false\n  Created:false closeErr: cancelReason:}\" file=\"backend.go:135\"\n  time=\"2019-10-27T20:39:13+08:00\" level=debug msg=\"ETCD watch response:\n  {Header:{ClusterId:0 MemberId:0 Revision:0 RaftTerm:0} Events:[]\n  CompactRevision:0 Canceled:false Created:false closeErr:\n  cancelReason:}\" file=\"backend.go:135\" time=\"2019-10-27T20:39:13+08:00\"\n  level=debug msg=\"ETCD watch response: {Header:{ClusterId:0 MemberId:0\n  Revision:0 RaftTerm:0} Events:[] CompactRevision:0 Canceled:false\n  Created:false closeErr: cancelReason:}\" file=\"backend.go:135\"\n  time=\"2019-10-27T20:39:13+08:00\" level=debug msg=\"ETCD watch response:\n  {Header:{ClusterId:0 MemberId:0 Revision:0 RaftTerm:0} Events:[]\n  CompactRevision:0 Canceled:false Created:false closeErr:\n  cancelReason:}\" file=\"backend.go:135\" time=\"2019-10-27T20:39:13+08:00\"\n  level=debug msg=\"ETCD watch response: {Header:{ClusterId:0 MemberId:0\n  Revision:0 RaftTerm:0} Events:[] CompactRevision:0 Canceled:false\n  Created:false closeErr: cancelReason:}\" file=\"backend.go:135\"</p>\n</blockquote>\n\n<p>tips: backend.go:135 is:\nfmt.Printf(\"%v\", resp), the resp is received from watchChan</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>   func (e *EtcdClient) watchWithOptions(ctx context.Context, key string, opts ...clientv3.OpOption) clientv3.WatchChan {\n    if e.client == nil {\n        return nil\n    }\n\n    key = e.withPrefix(key)\n\n    return e.client.Watch(ctx, key, opts...)\n}\n\n// WatchPrefix watch the kvs change with same prefix\nfunc (e *EtcdClient) WatchPrefix(ctx context.Context, prefix string) clientv3.WatchChan {\n    return e.watchWithOptions(ctx, prefix, clientv3.WithPrefix(), clientv3.WithPrevKV())\n}\n</code></pre>\n\n<p>i excepted the put, delete events,but the actual output is invalid empty events</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1572178887, "post_id": 58579365, "comment_id": 103473541, "body": "You mean <a href=\"https://godoc.org/github.com/bussiere/GoTestDoc/project\" rel=\"nofollow noreferrer\">like this</a>?"}, {"owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1572179004, "post_id": 58579365, "comment_id": 103473571, "body": "yes but how to generate doc for function ? @Flimzy"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1572179069, "post_id": 58579365, "comment_id": 103473592, "body": "See <a href=\"https://blog.golang.org/godoc-documenting-go-code\" rel=\"nofollow noreferrer\">documenting Go code</a>."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1572179362, "post_id": 58579365, "comment_id": 103473653, "body": "Documentation for the main package isn&#39;t generated because it cannot be imported. Documentation for everything else appears automatically on godoc.org."}], "owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 385, "favorite_count": 1, "closed_date": 1572178974, "answer_count": 0, "score": 0, "last_activity_date": 1572179008, "creation_date": 1572178774, "last_edit_date": 1572178848, "question_id": 58579365, "link": "https://stackoverflow.com/questions/58579365/how-to-generate-doc-in-a-html-from-a-go-project-like-javadoc", "closed_reason": "Duplicate", "title": "How to generate doc in a html from a Go project like javadoc?", "body": "<p>Here is my project:</p>\n\n<p><a href=\"https://github.com/bussiere/GoTestDoc\" rel=\"nofollow noreferrer\">https://github.com/bussiere/GoTestDoc</a></p>\n\n<p>Here is my folder organisation:</p>\n\n<pre><code>go.mod\nproject\\\n    toto.go\ndoc\n</code></pre>\n\n<p>Here is toto.go:</p>\n\n<pre><code>// Copyright Some Company Corp.\n// All Rights Reserved\npackage main\n\n\n// here are the imports\nimport (\n    \"fmt\"\n)\n\n// Hello to say hello\nfunc Hello() {\n    fmt.Println(\"hello world\")\n\n}\n\n// main function here\nfunc main() {\n    Hello()\n}\n</code></pre>\n\n<p>How to generate the doc in html like javadoc?</p>\n\n<p>With doc for function etc.</p>\n\n<p>I'am using go1.13</p>\n"}, {"tags": ["go", "cross-compiling", "ubuntu-18.04"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1572217584, "post_id": 58578316, "comment_id": 103482423, "body": "how did you install go ?     <a href=\"https://golang.org/dl/\" rel=\"nofollow noreferrer\">golang.org/dl</a>    go is working fine on aws ec2 ubuntu 18.04"}, {"owner": {"reputation": 844, "user_id": 1726468, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/NULGa.png?s=128&g=1", "display_name": "Christian M. Raymonds", "link": "https://stackoverflow.com/users/1726468/christian-m-raymonds"}, "reply_to_user": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1572236431, "post_id": 58578316, "comment_id": 103485325, "body": "I installed go on my dev machine from golang.org/dl but, I don&#39;t have go compiler on my production machine for obvious reasons."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1572259458, "post_id": 58578316, "comment_id": 103492174, "body": "ok, so your dev machine is running Ubuntu 14.04?  And you compile on there and the binary doesn&#39;t work on 18.04?  Install the newest version of go on your dev machine and try again.  Also please add the uname -a outout for the dev machine and the EC2 to the question"}, {"owner": {"reputation": 844, "user_id": 1726468, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/NULGa.png?s=128&g=1", "display_name": "Christian M. Raymonds", "link": "https://stackoverflow.com/users/1726468/christian-m-raymonds"}, "edited": false, "score": 0, "creation_date": 1572264116, "post_id": 58578316, "comment_id": 103494151, "body": "<code>uname -a</code> is already there in the question. Thanks."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1592745636, "post_id": 58578316, "comment_id": 110528365, "body": "This is a 7 month old question. Did you find the explanation in the mean time ?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1592754381, "post_id": 58578316, "comment_id": 110531542, "body": "i would build the program using a docker image that replicates the target system."}], "owner": {"reputation": 844, "user_id": 1726468, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/NULGa.png?s=128&g=1", "display_name": "Christian M. Raymonds", "link": "https://stackoverflow.com/users/1726468/christian-m-raymonds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1592734397, "creation_date": 1572170435, "last_edit_date": 1592734397, "question_id": 58578316, "link": "https://stackoverflow.com/questions/58578316/go-program-from-ubuntu-14-04-x86-64-wont-run-on-ubuntu-18-04-x86-64", "title": "Go program from Ubuntu 14.04 x86_64 won&#39;t run on Ubuntu 18.04 x86_64", "body": "<p>I have been using Go for quite a long time and currently I am stuck.</p>\n<p>I started off with a <code>net/http program</code> that I had compiled on <code>Ubuntu 14.04 x86_64</code> and tried to run it on Amazon AWS EC2 running Ubuntu 18.04 on x86_64. It wouldn't work. I get <code>File Format Error</code>. I thought that maybe the <code>CGO</code> requirements were messing it up, so tried the <code>CGO_ENABLED=0</code> and <code>netgo</code> fix, didn't work.</p>\n<p>I started removing all the code to see where the problem lies and currently my code is:</p>\n<pre><code>package main\n\nimport &quot;fmt&quot;\n\n    func main() {\n        fmt.Println(&quot;Hello&quot;)\n   }\n</code></pre>\n<p>And my code still won't run. I have used the following build tags to be doubly sure:</p>\n<p><code>env GOARCH=amd64 GOOS=linux</code> but still all I get on the Ubuntu 18.04 is <code>Segmentation Fault (core dumped)</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2274, "user_id": 6476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1ca185cf4b12910506f46f431d2371?s=128&d=identicon&r=PG&f=1", "display_name": "kingkupps", "link": "https://stackoverflow.com/users/6476496/kingkupps"}, "edited": false, "score": 2, "creation_date": 1572164672, "post_id": 58577649, "comment_id": 103470645, "body": "Go does not allow you to set defaults as part of the struct definition. See this post for strategies to deal with this: <a href=\"https://stackoverflow.com/questions/37135193/how-to-set-default-values-in-go-structs\" title=\"how to set default values in go structs\">stackoverflow.com/questions/37135193/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 9612823, "user_type": "registered", "profile_image": "https://graph.facebook.com/2008348242751516/picture?type=large", "display_name": "Nicholas Simon Cronwright", "link": "https://stackoverflow.com/users/9612823/nicholas-simon-cronwright"}, "edited": false, "score": 0, "creation_date": 1572178639, "post_id": 58577697, "comment_id": 103473496, "body": "Thanks, yes I was aware of that, was just wondering if it was at all possible to do it another way. I cannot understand why that is not possible."}], "tags": [], "owner": {"reputation": 1201, "user_id": 7506861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfa43944dd74a96c82dfd990626da2d5?s=128&d=identicon&r=PG&f=1", "display_name": "Emily", "link": "https://stackoverflow.com/users/7506861/emily"}, "is_accepted": false, "score": 3, "last_activity_date": 1572164765, "creation_date": 1572164765, "answer_id": 58577697, "question_id": 58577649, "link": "https://stackoverflow.com/questions/58577649/can-i-include-formulas-in-a-struct-somehow/58577697#58577697", "title": "Can I include formulas in a struct somehow?", "body": "<p>Since <code>A</code> is invariant, this would be a good fit for a function, not a field.</p>\n\n<pre><code>type room struct {\n    L int\n    W int\n}\n\nfunc (r *room) area() int {\n    return r.L * r.W\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 39, "user_id": 9612823, "user_type": "registered", "profile_image": "https://graph.facebook.com/2008348242751516/picture?type=large", "display_name": "Nicholas Simon Cronwright", "link": "https://stackoverflow.com/users/9612823/nicholas-simon-cronwright"}, "edited": false, "score": 1, "creation_date": 1572178678, "post_id": 58577910, "comment_id": 103473510, "body": "Thanks, was just wondering if there was any way of making it happen within the struct so as not to add unnecessary code."}, {"owner": {"reputation": 675, "user_id": 12259996, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zse95.jpg?s=128&g=1", "display_name": "Simon", "link": "https://stackoverflow.com/users/12259996/simon"}, "reply_to_user": {"reputation": 39, "user_id": 9612823, "user_type": "registered", "profile_image": "https://graph.facebook.com/2008348242751516/picture?type=large", "display_name": "Nicholas Simon Cronwright", "link": "https://stackoverflow.com/users/9612823/nicholas-simon-cronwright"}, "edited": false, "score": 1, "creation_date": 1572201720, "post_id": 58577910, "comment_id": 103478855, "body": "You may be able to use some hacky struct tags to do that, but it&#39;s not very Go-like or recommended."}], "tags": [], "owner": {"reputation": 675, "user_id": 12259996, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zse95.jpg?s=128&g=1", "display_name": "Simon", "link": "https://stackoverflow.com/users/12259996/simon"}, "is_accepted": false, "score": 0, "last_activity_date": 1572166885, "creation_date": 1572166885, "answer_id": 58577910, "question_id": 58577649, "link": "https://stackoverflow.com/questions/58577649/can-i-include-formulas-in-a-struct-somehow/58577910#58577910", "title": "Can I include formulas in a struct somehow?", "body": "<p>If you would like to keep A as a Field, you can optionally preform the computation in a constructor.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type room struct {\n L int\n W int\n A int\n}\n\nfunc newRoom(length, width, int) room {\n  return room{\n    L: length,\n    W: width,\n    A: length * width,\n  }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 39, "user_id": 9612823, "user_type": "registered", "profile_image": "https://graph.facebook.com/2008348242751516/picture?type=large", "display_name": "Nicholas Simon Cronwright", "link": "https://stackoverflow.com/users/9612823/nicholas-simon-cronwright"}, "edited": false, "score": 0, "creation_date": 1577892529, "post_id": 59545402, "comment_id": 105275901, "body": "Thanks, a lot more detailed than I can understand though do get the idea of what you mean. It is appreciated, I am new to learning Go, and programming in general and any input helps."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1577803284, "last_edit_date": 1577803284, "creation_date": 1577802895, "answer_id": 59545402, "question_id": 58577649, "link": "https://stackoverflow.com/questions/58577649/can-i-include-formulas-in-a-struct-somehow/59545402#59545402", "title": "Can I include formulas in a struct somehow?", "body": "<p>If you think about what you're after, you'll see that basically your desire to \"not add unnecessary code\" is really about not <em>writing</em> any code <em>by hand,</em> rather than not <em>executing</em> any code: sure, if the type definition</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type room struct {\n L int\n W int\n A int = room.L*room.H\n}\n</code></pre>\n\n<p>could be possible in Go, that would mean the Go compiler would have make arrangements so than any code like this</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var r room\nr.L = 42\n</code></pre>\n\n<p>is compiled in a way to implicitly mutate <code>r.A</code>.</p>\n\n<p>In other words, the compiler must make sure that any modification of either <code>L</code> or <code>W</code> fields of any variable of type <code>room</code> in a program would also perform a calculaton and update the field <code>A</code> of each such variable.</p>\n\n<p>This poses several problems:</p>\n\n<ul>\n<li><p>What if your formula is trickier\u2014like, say, <code>A int = room.L/room.W</code>?</p>\n\n<p>First, given the casual Go rules for zero values of type <code>int</code>,\nan innocent declaration <code>var r room</code> would immediately crash the program because of the integer division by zero performed by the code inserted by the compiler to force the invariant being discussed.</p>\n\n<p>Second, even if we would invent a questionable rule of not calculating a formula on mere declarations (which, in Go, are also initializations), the problem would remain: what would happen in the following scenario?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var r room\nr.L = 42\n</code></pre>\n\n<p>As you can see, even if the compiler would not make the program crash on the first line, it would have to arrange for that on the second.</p>\n\n<p>Sure, we could add another questionable rule to sidestep the problem: either somehow \"mark\" each field as \"explicitly set\" or require the user to provide an explicit \"constructor\" for such types \"armed\" with a \"formula\".\nEither solution stinks in its own way: tracing write field access incurs performance costs <em>(some</em> fields now have a hidden flag which takes up space, and each access of such fields spends extra CPU counts), and having constructors goes again one of the cornerstone principles of the Go design: to have as little magic as possible.</p></li>\n<li><p>The formula creates a hidden write.</p>\n\n<p>This may not be obvious until you start writing \"harder-core\" Go programs for tasks it shines at\u2014highly concurrent code with lots of simultaneously working goroutines,\u2014but when you do you're forced to think about shared state and the ways it's mutated and\u2014consequently\u2014on the ways such mutations are synchronized to keep the program correct.</p>\n\n<p>So, let's suppose we protect access to either <code>W</code> or <code>L</code> with a mutex; how would the compiler make sure mutation of <code>A</code> is also proteted given that mutex operations are explicit (that is, a programmer explicitly codes locking/unlocking operations)?</p></li>\n<li><p>(A problem somewhat related to the previous one.)\nWhat if \"the formula\" does \"interesting things\"\u2014such as accessing/mutating external state?</p>\n\n<p>This could be anything from accessing global variables to querying databases to working with a filesystems to exchanges over IPC or via networking protocols.</p>\n\n<p>And this all could be very innocently-looking, like <code>A int = room.L * room.W * getCoefficient()</code> where all the nifty details are hidden in that <code>getCoefficient()</code> call.</p>\n\n<p>Sure, we, again, could work-around this by imposing an arbitrary limit on the compiler to only allow <em>explicit</em> access to the fields of the same enclosing type and only allow them to participate in simple expressions with no function calls or some \"whitelisted\" subset of them such as <code>math.Abs</code> or whatever.\nThis clearly reduces the usefulness of the feature while greatly complicating the language.</p></li>\n<li><p>What if \"the formula\" has non-linear complexity?</p>\n\n<p>Suppose, the formula is <code>O(N\u00b3)</code> with regard to the value of <code>W</code>.</p>\n\n<p>Then setting <code>W</code> on a value to 0 would be processed almost instantly but setting it to 10000 would slow the program down quite noticeably, and both of these outcomes would result form a seemingly not too different statements: <code>r.W = 0</code> vs <code>r.W = 10000</code>.</p>\n\n<p>This, again, goes agains the principle of having as little magic as possible.</p></li>\n<li><p>Why would we ony allow such things on struct types and not on arbitrary variables\u2014prodived they are all in the same lexical scope?</p>\n\n<p>This looks like another arbitrary restriction.</p></li>\n</ul>\n\n<p>And another\u2014supposedly\u2014the most obvious problem is what should happen when the programmer goes like</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var r room\nr.L = 2  // r.A is now 2\u00d70=0\nr.W = 5  // r.A is now 2\u00d75=10\nr.A = 42 // The invariant r.A = r.L\u00d7r.W is now broken\n</code></pre>\n\n<p>?</p>\n\n<hr>\n\n<p>Now you can see that all the problems above may be solved by merily coding what <em>you</em> need, say, with the following approach:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// use \"unexported\" fields\ntype room struct {\n l int\n w int\n a int\n}\n\nfunc (r *room) SetL(v int) {\n  r.l = v\n  updateArea()\n}\n\nfunc (r *room) SetW(v int) {\n  r.w = v\n  updateArea()\n}\n\nfunc (r *room) GetA() int {\n  return r.a\n}\n\nfunc (r *room) updateArea() {\n  r.a = r.l * r.w\n}\n</code></pre>\n\n<p>With this approach, you may be crystal-clear about all the issues above.</p>\n\n<p>Remember that the programs are written for humans to read and only then for machines to execute; it's paramount for proper <em>software engeneering</em> to keep the code as much without any magic or intricate hidden dependencies between various parts of of it as possible. Please remember that</p>\n\n<blockquote>\n  <p>Software engineering is what happens to programming\n  when you add time and other programmers.</p>\n  \n  <p>\u00a9 Russ Cox</p>\n</blockquote>\n\n<p><a href=\"https://talks.golang.org/2012/splash.article\" rel=\"nofollow noreferrer\">See more</a>.</p>\n"}], "owner": {"reputation": 39, "user_id": 9612823, "user_type": "registered", "profile_image": "https://graph.facebook.com/2008348242751516/picture?type=large", "display_name": "Nicholas Simon Cronwright", "link": "https://stackoverflow.com/users/9612823/nicholas-simon-cronwright"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1577803284, "creation_date": 1572164235, "last_edit_date": 1572178438, "question_id": 58577649, "link": "https://stackoverflow.com/questions/58577649/can-i-include-formulas-in-a-struct-somehow", "title": "Can I include formulas in a struct somehow?", "body": "<p>I am trying to create a struct which uses a formula to automatically create data in one of the struct fields when the other two values are entered.</p>\n\n<p>For example, I want to create a 2D rectangular room with <code>Length</code> and <code>Width</code> which are values that are entered. I would then like to include the formula <code>Area = Length * Width</code>  in the struct.</p>\n\n<p>Have tried and just get a syntax error :</p>\n\n<blockquote>\n  <p>syntax error: unexpected =, expecting semicolon or newline or }</p>\n</blockquote>\n\n<pre><code>// CURRENT CODE\ntype room struct {\n L int\n W int\n A int\n}\n// WOULD LIKE IT TO BE\ntype room struct {\n L int\n W int\n A int = room.L*room.H\n}\n</code></pre>\n"}, {"tags": ["c++", "go", "cgo"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1572158592, "post_id": 58577007, "comment_id": 103469723, "body": "Since C++ compilers normally mangle names and add secret arguments and so on, and cgo is designed to call unmangled C functions without secret extra arguments and so on, you must provide the C wrapper or write your C++ functions as C functions. C wrappers don&#39;t have standard ways to access C++ namespaces. See <a href=\"https://stackoverflow.com/q/18945419/1256452\">stackoverflow.com/q/18945419/1256452</a> for more."}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 8143761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0022b8722e6bea163b17f3cfa97a2d1?s=128&d=identicon&r=PG&f=1", "display_name": "quintin", "link": "https://stackoverflow.com/users/8143761/quintin"}, "is_accepted": true, "score": 2, "last_activity_date": 1572449109, "last_edit_date": 1572449109, "creation_date": 1572250764, "answer_id": 58587556, "question_id": 58577007, "link": "https://stackoverflow.com/questions/58577007/cgo-calling-functions-defined-in-a-c-that-are-in-namespaces/58587556#58587556", "title": "cgo Calling functions defined in a C++ (that are in namespaces)", "body": "<p>I figured it out by creating a C wrapper header file. Then I created a CPP file which bridges said C interface with the library CPP headers and library.</p>\n\n<p>The C header understands my library object as a void pointer, and my CPP implementation has to cast it in order to access all of its functions.</p>\n\n<p>The <code>extern \"C\"</code> part is very important and prevent Go from freaking out - It prevents the CPP compiler from mangling function names.</p>\n\n<p>Of course, also link the binary with the proper LDFLAGS.</p>\n\n<p>phoenix.h</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>typedef void CTalon;\n\n#ifdef __cplusplus\nextern \"C\" {\n#endif\n\nCTalon* CTRE_CreateTalon(int port);\n\nvoid CTRE_Set(CTalon* talon, double output);\n\nvoid CTRE_Follow(CTalon* slave, CTalon* master);\n\n#ifdef __cplusplus\n}\n#endif\n</code></pre>\n\n<p>phoenix.cpp</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include \"phoenix.h\" // My C wrapper header\n\n#include \"ctre/phoenix/motorcontrol/can/TalonSRX.h\" // Actual CPP header from library\n\n#define TALON(ctalon) ((ctre::TalonSRX*) ctalon) // Helper macro to make converting to library object easier. Optional\n\nnamespace ctre { // Specific to my library which has a lot of long namespaces. Unrelated to problem\n    using ctre::phoenix::motorcontrol::ControlMode;\n    using ctre::phoenix::motorcontrol::can::TalonSRX;\n}\n\nextern \"C\" {\n    CTalon* CTRE_CreateTalon(int port) {\n        return (CTalon*) new ctre::TalonSRX(port);\n    }\n\n    void CTRE_Set(CTalon* talon, double output) {\n        TALON(talon)-&gt;Set(ctre::ControlMode::PercentOutput, output);\n    }\n\n    void CTRE_Follow(CTalon* slave, CTalon* master) {\n        TALON(slave)-&gt;Follow(*(TALON(master)));\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 8143761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0022b8722e6bea163b17f3cfa97a2d1?s=128&d=identicon&r=PG&f=1", "display_name": "quintin", "link": "https://stackoverflow.com/users/8143761/quintin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "accepted_answer_id": 58587556, "answer_count": 1, "score": 0, "last_activity_date": 1572449109, "creation_date": 1572156360, "question_id": 58577007, "link": "https://stackoverflow.com/questions/58577007/cgo-calling-functions-defined-in-a-c-that-are-in-namespaces", "title": "cgo Calling functions defined in a C++ (that are in namespaces)", "body": "<p>I have a library that I want to use which only provides C++ header files and a static library. Go is unable to parse the namespaces that it is wrapped in.</p>\n\n<p>I have looked at this: <a href=\"https://stackoverflow.com/questions/1713214/how-to-use-c-in-go\">How to use C++ in Go?</a> and it makes sense, but there are no namespaces involved there.</p>\n\n<p>This is the C++ code in question that when imported causes issues (only the beginning shown):</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#pragma once\n#include &lt;stdint.h&gt;\n\nnamespace ctre {\nnamespace phoenix {\n</code></pre>\n\n<p>And here is the result of compiling:</p>\n\n<pre><code>./include/ctre/phoenix/ErrorCode.h:4:1: error: unknown type name 'namespace'\n namespace ctre {\n ^~~~~~~~~\n./include/ctre/phoenix/ErrorCode.h:4:16: error: expected '=', ',', ';', 'asm' or '__attribute__' before '{' token\n namespace ctre {\n</code></pre>\n\n<p>Is there any way that I can provide a C wrapper which avoids this problem?</p>\n"}, {"tags": ["amazon-web-services", "docker", "go", "aws-codebuild"], "answers": [{"tags": [], "owner": {"reputation": 675, "user_id": 12259996, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zse95.jpg?s=128&g=1", "display_name": "Simon", "link": "https://stackoverflow.com/users/12259996/simon"}, "is_accepted": false, "score": 1, "last_activity_date": 1572167430, "creation_date": 1572167430, "answer_id": 58577971, "question_id": 58576277, "link": "https://stackoverflow.com/questions/58576277/cant-run-aws-codebuild-local-build-script/58577971#58577971", "title": "Can&#39;t run AWS CodeBuild local build script", "body": "<p>Per <a href=\"https://aws.amazon.com/blogs/devops/announcing-local-build-support-for-aws-codebuild/\" rel=\"nofollow noreferrer\">https://aws.amazon.com/blogs/devops/announcing-local-build-support-for-aws-codebuild/</a> you must <code>git clone</code> the GitHub repository that contains the definition for those images: <a href=\"https://github.com/aws/aws-codebuild-docker-images\" rel=\"nofollow noreferrer\">https://github.com/aws/aws-codebuild-docker-images</a>. aws/codebuild/standard is not a DockerHub repository or a valid ECR repository.</p>\n"}, {"tags": [], "owner": {"reputation": 5018, "user_id": 12072431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Svf7M.png?s=128&g=1", "display_name": "shariqmaws", "link": "https://stackoverflow.com/users/12072431/shariqmaws"}, "is_accepted": false, "score": 2, "last_activity_date": 1572218789, "creation_date": 1572218789, "answer_id": 58584228, "question_id": 58576277, "link": "https://stackoverflow.com/questions/58576277/cant-run-aws-codebuild-local-build-script/58584228#58584228", "title": "Can&#39;t run AWS CodeBuild local build script", "body": "<p>First build and tag the CodeBuild docker image as described here:</p>\n\n<p><a href=\"https://github.com/aws/aws-codebuild-docker-images\" rel=\"nofollow noreferrer\">https://github.com/aws/aws-codebuild-docker-images</a></p>\n\n<p>Then run the following command making sure to update the image name and tag in the command:</p>\n\n<pre><code>./codebuild_build.sh -i &lt;image_name&gt;:&lt;image_tag&gt; -a /home/ec2-user/environment/artifacts -s /home/ec2-user/environment/sample-web-app\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 81, "user_id": 6329540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yOBR7.jpg?s=128&g=1", "display_name": "Urko", "link": "https://stackoverflow.com/users/6329540/urko"}, "edited": false, "score": 0, "creation_date": 1601023199, "post_id": 59598033, "comment_id": 113280605, "body": "AWS official documentation explains also: <a href=\"https://aws.amazon.com/blogs/devops/announcing-local-build-support-for-aws-codebuild/\" rel=\"nofollow noreferrer\">aws.amazon.com/blogs/devops/&hellip;</a>"}], "tags": [], "owner": {"reputation": 102532, "user_id": 248823, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6605deca5924e84df1a4847f607b87c6?s=128&d=identicon&r=PG", "display_name": "Marcin", "link": "https://stackoverflow.com/users/248823/marcin"}, "is_accepted": false, "score": 12, "last_activity_date": 1578274602, "last_edit_date": 1578274602, "creation_date": 1578211362, "answer_id": 59598033, "question_id": 58576277, "link": "https://stackoverflow.com/questions/58576277/cant-run-aws-codebuild-local-build-script/59598033#59598033", "title": "Can&#39;t run AWS CodeBuild local build script", "body": "<p>An example for using local build platform of <code>Ubuntu 18.04</code> with docker image identfier/tag <code>aws/codebuild/standard:3.0</code> to run few python unit tests (see below) as an example.</p>\n\n<h3>1. Make local docker image of <code>aws/codebuild/standard:3.0</code></h3>\n\n<p>The Ubuntu 18.04 platform is <a href=\"https://docs.aws.amazon.com/codebuild/latest/userguide/build-env-ref-available.html\" rel=\"noreferrer\">identified</a> as <code>aws/codebuild/standard:3.0</code> in docker</p>\n\n<pre><code># download definition of curated docker codebuild images\ngit clone https://github.com/aws/aws-codebuild-docker-images.git\n\n# got ubuntu version of intrest\ncd aws-codebuild-docker-images/ubuntu/standard/3.0/\n\n# build the image (this will take a time as the final image is &gt; 7GB)\ndocker build -t aws/codebuild/standard:3.0 .\n\n</code></pre>\n\n<h3>2. Download <code>codebuild_build.sh</code></h3>\n\n<pre><code>wget https://raw.githubusercontent.com/aws/aws-codebuild-docker-images/master/local_builds/codebuild_build.sh\n\nchmod u+x codebuild_build.sh\n</code></pre>\n\n<h3>3. Run the local build job</h3>\n\n<pre><code>./codebuild_build.sh -i aws/codebuild/standard:3.0 -a /tmp/artifacts -s ./application/\n</code></pre>\n\n<p>where <code>./application/</code> should be changed to your folder with the application you want to build. The folder should contain your <code>buildspec.yml</code>. \nMy example <code>buildspec.yml</code> was:</p>\n\n<pre><code>version: 0.2\n\nphases:\n  install:\n    runtime-versions:\n      python: 3.8\n  pre_build:\n    commands:\n      - echo Nothing to do in the pre_build phase...\n  build:\n    commands:\n      - echo Running my python unit tests on `date`\n      - python -m unittest test.py  \n  post_build:\n    commands:\n      - echo Build completed on `date`\n</code></pre>\n\n<p>Notice <code>- python -m unittest test.py</code> as I was executing unit tests in the build phase only.  The <code>test.py</code> was just an example from the Python docs: <a href=\"https://docs.python.org/3/library/unittest.html#basic-example\" rel=\"noreferrer\">https://docs.python.org/3/library/unittest.html#basic-example</a></p>\n\n<p>The <code>./codebuild_build.sh</code> will also pull Docker image <a href=\"https://hub.docker.com/r/amazon/aws-codebuild-local\" rel=\"noreferrer\">amazon/aws-codebuild-local\n</a> first time you execute it.</p>\n\n<h3>4. Example output:</h3>\n\n<pre><code>Removing agent-resources_build_1 ... done\nRemoving agent-resources_agent_1 ... done\nRemoving network agent-resources_default\nRemoving volume agent-resources_source_volume\nRemoving volume agent-resources_user_volume\nCreating network \"agent-resources_default\" with the default driver\nCreating volume \"agent-resources_source_volume\" with local driver\nCreating volume \"agent-resources_user_volume\" with local driver\nCreating agent-resources_agent_1 ... done\nCreating agent-resources_build_1 ... done\nAttaching to agent-resources_agent_1, agent-resources_build_1\nagent_1  | 2020/01/05 07:50:34 [Customer Config] Couldn't open specified customer config file: open /root/.aws/config: no such file or directory\nagent_1  | 2020/01/05 07:50:34 [Customer Config] Error parsing supplied customer config file: invalid argument\nagent_1  | [Container] 2020/01/05 07:50:35 Waiting for agent ping\nagent_1  | [Container] 2020/01/05 07:50:36 Waiting for DOWNLOAD_SOURCE\nagent_1  | [Container] 2020/01/05 07:50:36 Phase is DOWNLOAD_SOURCE\nagent_1  | [Container] 2020/01/05 07:50:36 CODEBUILD_SRC_DIR=/codebuild/output/src628986230/src\nagent_1  | [Container] 2020/01/05 07:50:36 YAML location is /codebuild/output/srcDownload/src/buildspec.yml\nagent_1  | [Container] 2020/01/05 07:50:36 No commands found for phase name: INSTALL\nagent_1  | [Container] 2020/01/05 07:50:36 Processing environment variables\nagent_1  | [Container] 2020/01/05 07:50:36 Moving to directory /codebuild/output/src628986230/src\nagent_1  | [Container] 2020/01/05 07:50:36 Registering with agent\nagent_1  | [Container] 2020/01/05 07:50:36 Phases found in YAML: 4\nagent_1  | [Container] 2020/01/05 07:50:36  INSTALL: 0 commands\nagent_1  | [Container] 2020/01/05 07:50:36  PRE_BUILD: 1 commands\nagent_1  | [Container] 2020/01/05 07:50:36  BUILD: 2 commands\nagent_1  | [Container] 2020/01/05 07:50:36  POST_BUILD: 1 commands\nagent_1  | [Container] 2020/01/05 07:50:36 Phase complete: DOWNLOAD_SOURCE State: SUCCEEDED\nagent_1  | [Container] 2020/01/05 07:50:36 Phase context status code:  Message: \nagent_1  | [Container] 2020/01/05 07:50:36 Entering phase INSTALL\nagent_1  | [Container] 2020/01/05 07:50:36 Running command echo \"Installing Python version 3.8 ...\"\nagent_1  | Installing Python version 3.8 ...\nagent_1  | \nagent_1  | [Container] 2020/01/05 07:50:36 Phase complete: INSTALL State: SUCCEEDED\nagent_1  | [Container] 2020/01/05 07:50:36 Phase context status code:  Message: \nagent_1  | [Container] 2020/01/05 07:50:36 Entering phase PRE_BUILD\nagent_1  | [Container] 2020/01/05 07:50:36 Running command echo Nothing to do in the pre_build phase...\nagent_1  | Nothing to do in the pre_build phase...\nagent_1  | \nagent_1  | [Container] 2020/01/05 07:50:36 Phase complete: PRE_BUILD State: SUCCEEDED\nagent_1  | [Container] 2020/01/05 07:50:36 Phase context status code:  Message: \nagent_1  | [Container] 2020/01/05 07:50:36 Entering phase BUILD\nagent_1  | [Container] 2020/01/05 07:50:36 Running command echo Runing my python unittests on `date`\nagent_1  | Runing my python unittests on Sun Jan 5 07:50:36 UTC 2020\nagent_1  | \nagent_1  | [Container] 2020/01/05 07:50:36 Running command python -m unittest test.py\nagent_1  | ...\nagent_1  | ----------------------------------------------------------------------\nagent_1  | Ran 3 tests in 0.000s\nagent_1  | \nagent_1  | OK\nagent_1  | \nagent_1  | [Container] 2020/01/05 07:50:37 Phase complete: BUILD State: SUCCEEDED\nagent_1  | [Container] 2020/01/05 07:50:37 Phase context status code:  Message: \nagent_1  | [Container] 2020/01/05 07:50:37 Entering phase POST_BUILD\nagent_1  | [Container] 2020/01/05 07:50:37 Running command echo Build completed on `date`\nagent_1  | Build completed on Sun Jan 5 07:50:37 UTC 2020\nagent_1  | \nagent_1  | [Container] 2020/01/05 07:50:37 Phase complete: POST_BUILD State: SUCCEEDED\nagent_1  | [Container] 2020/01/05 07:50:37 Phase context status code:  Message: \nagent-resources_agent_1 exited with code 0\nStopping agent-resources_build_1 ... done\nAborting on container exit...\n</code></pre>\n\n<h3>5. Check if the build job was successful or not?</h3>\n\n<p>In my case I just wanted to know if all unit tests in <code>test.py</code> were successful or not. For this you can just check the exit code from the <code>codebuild_build.sh</code></p>\n\n<pre><code>echo ${?}\n</code></pre>\n\n<p>This will return <code>0</code> if tests were successful, or <code>1</code> if not. Can verify this by modifying <code>test.py</code> so that the unit tests fail, and re-running <code>codebuild_build.sh</code>. This works because <code>python -m unittest test.py</code> exits with code of <code>0</code> when all tests pass, and <code>1</code> otherwise.</p>\n"}], "owner": {"reputation": 625, "user_id": 4439000, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2ef95ad9aa67b5ce7b1c05113a238364?s=128&d=identicon&r=PG&f=1", "display_name": "billcyz", "link": "https://stackoverflow.com/users/4439000/billcyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2968, "favorite_count": 0, "answer_count": 3, "score": 8, "last_activity_date": 1581741300, "creation_date": 1572144357, "question_id": 58576277, "link": "https://stackoverflow.com/questions/58576277/cant-run-aws-codebuild-local-build-script", "title": "Can&#39;t run AWS CodeBuild local build script", "body": "<p>I'm trying to run the CodeBuild locally for my golang project. I've pulled the docker image <code>amazon/aws-codebuild-local:latest</code> and run the CodeBuild script <code>./codebuild_build.sh -i aws/codebuild/standard:2.0 -s \"/project/src\"</code>, there is nothing happened. Then I captured the docker command generated in the script: <code>docker run -it -v //var/run/docker.sock:/var/run/docker.sock -e \"IMAGE_NAME=aws/codebuild/standard:2.0\" -e \"SOURCE=/project/src\" -e \"INITIATOR=me\" amazon/aws-codebuild-local:latest</code>.</p>\n\n<p>When I run the docker command, I got the following error:</p>\n\n<pre><code>Removing network agent-resources_default\nRemoving volume agent-resources_source_volume\nRemoving volume agent-resources_user_volume\nCreating network \"agent-resources_default\" with the default driver\nCreating volume \"agent-resources_source_volume\" with local driver\nCreating volume \"agent-resources_user_volume\" with local driver\nPulling build (aws/codebuild/standard:2.0)...\nERROR: The image for the service you're trying to recreate has been removed. If you continue, volume data could be lost. Consider backing up your data before continuing.\n\nContinue with the new image? [yN]y\nPulling build (aws/codebuild/standard:2.0)...\nERROR: pull access denied for aws/codebuild/standard, repository does not exist or may require 'docker login': denied: requested access to the resource is denied\n</code></pre>\n\n<p>I'm sure my docker is logged in, don't know what should I do next to solve the issue.</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "edited": false, "score": 0, "creation_date": 1572147870, "post_id": 58576189, "comment_id": 103468676, "body": "What Operating System are you building on?"}], "answers": [{"comments": [{"owner": {"reputation": 836, "user_id": 2643124, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/9kiH1.jpg?s=128&g=1", "display_name": "Alexey Shevelyov", "link": "https://stackoverflow.com/users/2643124/alexey-shevelyov"}, "edited": false, "score": 0, "creation_date": 1572274774, "post_id": 58576495, "comment_id": 103499535, "body": "I did install MinGW - it still throwing this error. Does this need to be configured a certain way?"}], "tags": [], "owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "is_accepted": false, "score": 1, "last_activity_date": 1572148462, "creation_date": 1572148462, "answer_id": 58576495, "question_id": 58576189, "link": "https://stackoverflow.com/questions/58576189/gcc-executable-file-not-found-in-path-when-using-mongo-go-driver/58576495#58576495", "title": "&quot;gcc&quot;: executable file not found in %PATH% when using mongo-go-driver", "body": "<p>The issue is that your library depends on <code>gcc</code> to run.</p>\n\n<h1>1. Linux/Containers</h1>\n\n<p>If you are running in a container, you can try two options:</p>\n\n<ol>\n<li>you can build your app without <code>CGO</code> with the following command: </li>\n</ol>\n\n<pre><code>RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o yourBinary\n</code></pre>\n\n<ol start=\"2\">\n<li>You can try to install <code>gcc</code> into your container. If it is an alpine based container, run </li>\n</ol>\n\n<pre><code>RUN apk update &amp;&amp; apk add --no-cache gcc\n</code></pre>\n\n<p>You could also need <code>musl-dev</code> package, but you should try without it first.</p>\n\n<h1>2. Windows</h1>\n\n<p>Since MacOS and most Linux distros come with GCC, I guess you could be using Windows. In this case, you need to install <a href=\"https://sourceforge.net/projects/mingw-w64/\" rel=\"nofollow noreferrer\">MinGW</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 671, "user_id": 445891, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/w7rWI.jpg?s=128&g=1", "display_name": "Mazdak", "link": "https://stackoverflow.com/users/445891/mazdak"}, "is_accepted": false, "score": 1, "last_activity_date": 1574810723, "last_edit_date": 1574810723, "creation_date": 1574808603, "answer_id": 59060540, "question_id": 58576189, "link": "https://stackoverflow.com/questions/58576189/gcc-executable-file-not-found-in-path-when-using-mongo-go-driver/59060540#59060540", "title": "&quot;gcc&quot;: executable file not found in %PATH% when using mongo-go-driver", "body": "<p>I know this is old but I ran into this problem too, About Alexey answer, on windows, you should install MinGW and add the path to win environment. You should follow <a href=\"http://www.codebind.com/cprogramming/install-mingw-windows-10-gcc/\" rel=\"nofollow noreferrer\">this</a>. In case MinGW did not work, you can install <a href=\"http://tdm-gcc.tdragon.net/\" rel=\"nofollow noreferrer\">this</a> one which worked perfectly for me on windows.</p>\n"}], "owner": {"reputation": 21, "user_id": 10611720, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-3xThjtAdypA/AAAAAAAAAAI/AAAAAAAAAIQ/ApSdx774Pkc/photo.jpg?sz=128", "display_name": "Muhammad Nurfilza", "link": "https://stackoverflow.com/users/10611720/muhammad-nurfilza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1208, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1574834717, "creation_date": 1572143236, "last_edit_date": 1574834717, "question_id": 58576189, "link": "https://stackoverflow.com/questions/58576189/gcc-executable-file-not-found-in-path-when-using-mongo-go-driver", "title": "&quot;gcc&quot;: executable file not found in %PATH% when using mongo-go-driver", "body": "<p>I want to use mongodb driver.But I get the following error: </p>\n\n<blockquote>\n  <p>go.mongodb.org/mongo-driver/vendor/github.com/DataDog/zstd\n  exec: \"gcc\": executable file not found in %PATH%</p>\n</blockquote>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "is_accepted": true, "score": 1, "last_activity_date": 1572140960, "creation_date": 1572140960, "answer_id": 58576057, "question_id": 58576030, "link": "https://stackoverflow.com/questions/58576030/golang-error-cannot-use-type-5int-as-type-int-in-argument-to-median/58576057#58576057", "title": "Golang Error : Cannot use (type [5]int) as type int in argument to median", "body": "<p>You're saying <code>median</code> is a variadic function but you're passing <code>arr</code> as the first argument instead of all the arguments.  You simply need to inform go to use <code>arr</code> as <em>all</em> the variadic arguments:</p>\n\n<pre><code>med := median(arr...)\n</code></pre>\n\n<p>Worked for me.  </p>\n"}], "owner": {"reputation": 1514, "user_id": 4056736, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/fb80113bb3b5cd54c8358680fd56bafc?s=128&d=identicon&r=PG&f=1", "display_name": "Prateek Narendra", "link": "https://stackoverflow.com/users/4056736/prateek-narendra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1279, "favorite_count": 0, "closed_date": 1572172502, "accepted_answer_id": 58576057, "answer_count": 1, "score": -1, "last_activity_date": 1572140960, "creation_date": 1572140530, "question_id": 58576030, "link": "https://stackoverflow.com/questions/58576030/golang-error-cannot-use-type-5int-as-type-int-in-argument-to-median", "closed_reason": "Duplicate", "title": "Golang Error : Cannot use (type [5]int) as type int in argument to median", "body": "<p>I have written a function to find the median of an odd length array--</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\nfunc median(arr ...int)(int){\n    sort.Ints(arr)\n    return arr[len(arr)/2]\n}\n\nfunc main() {\n\n    arr := []int{1,2,3}\n    med := median(arr)\n    fmt.Println(med)\n\n\n}\n</code></pre>\n\n<p>But on compilation, I get an error saying - <code>Cannot use arr (type [5]int) as type int in argument to median</code></p>\n\n<p>What exactly is the error? How do I fix this?</p>\n\n<p>PS - I do not want to modify the median function. But what is wrong with my type of <code>arr</code> that is causing this issue?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 1, "last_activity_date": 1572118378, "creation_date": 1572118378, "answer_id": 58574056, "question_id": 58573687, "link": "https://stackoverflow.com/questions/58573687/configure-go-build-go-test-etc-to-show-absolute-paths-in-diagnostic-messages/58574056#58574056", "title": "configure [go build]/[go test] etc to show absolute paths in diagnostic messages", "body": "<blockquote>\n  <p>Is there a way to configure the go tools to report absolute paths besides wrapping them and cding to random directories?</p>\n</blockquote>\n\n<p>No.</p>\n"}], "owner": {"reputation": 5900, "user_id": 931154, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/bTrZd.jpg?s=128&g=1", "display_name": "Gregory Nisbet", "link": "https://stackoverflow.com/users/931154/gregory-nisbet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 1, "accepted_answer_id": 58574056, "answer_count": 1, "score": 0, "last_activity_date": 1572118378, "creation_date": 1572115551, "question_id": 58573687, "link": "https://stackoverflow.com/questions/58573687/configure-go-build-go-test-etc-to-show-absolute-paths-in-diagnostic-messages", "title": "configure [go build]/[go test] etc to show absolute paths in diagnostic messages", "body": "<p>Is there a way to configure/direct <code>go build</code>, <code>go test</code> etc to report file locations using absolute paths? I frequently run <code>go build</code> from my editor (which parses the output) and it would be convenient if the current working directory of the <code>go build</code> process and the editor itself did not need to match.</p>\n\n<p>So far, the only solution I've found is to wrap <code>go build</code> in a script that determines absolute paths to files, then immediately <code>cd</code>s to a temporary directory before invoking <code>go build</code> with the <code>realpath</code>'d original arguments.</p>\n\n<p>Creating a temporary directory and <code>cd</code>'ing to it just to trick the go tools seems like a bizarre workaround, so I'm wondering if there's a more direct solution.</p>\n\n<p><em>Is there a way to configure the <code>go tools</code> to report absolute paths besides wrapping them and <code>cd</code>ing to random directories?</em></p>\n\n<p>Suppose that my <code>GOPATH</code> is <code>/go</code> and that I have the following file.</p>\n\n<pre><code>// /go/src/nonexistent-website.com/example-2019-10-26/main.go\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"hi\")\n}\n</code></pre>\n\n<p>Suppose I intentionally introduce an error in this file.</p>\n\n<pre><code>// /go/src/nonexistent-website.com/example-2019-10-26/main.go\npackage main\n\n// import (\n//  \"fmt\"\n// )\n\nfunc main() {\n    fmt.Println(\"hi\")\n}\n</code></pre>\n\n<p><code>go build main.go</code> reports the following error:</p>\n\n<pre><code>/go/src/nonexistent-website.com/example-2019-10-26$ go build main.go\n# command-line-arguments\n./main.go:9: undefined: fmt in fmt.Println\n   2\n</code></pre>\n\n<p><code>go build ...</code> still reports <code>./main.go</code> as the path to the file if given an absolute path</p>\n\n<pre><code>/go/src/nonexistent-website.com/example-2019-10-26$ go build `realpath main.go`\n# command-line-arguments\n./main.go:9: undefined: fmt in fmt.Println\n   2\n</code></pre>\n\n<p><code>go build</code> seems to produce paths relative to the directory it was invoked from:</p>\n\n<p>These are the paths that <code>go build</code> produces when directed to <code>cd</code> to the root directory first.</p>\n\n<pre><code>/go/src/nonexistent-website.com/example-2019-10-26$ (a=`realpath main.go` &amp;&amp; cd / &amp;&amp; go build $a)\n# command-line-arguments\ngo/src/nonexistent-website.com/example-2019-10-26/main.go:9: undefined: fmt in fmt.Println\n   2\n</code></pre>\n\n<p>It's possible to coax <code>go build</code> into emitting absolute paths by <code>cd</code>-ing to a directory that's guaranteed to be fresh</p>\n\n<pre><code>/go/src/nonexistent-website.com/example-2019-10-26$ (a=`realpath main.go` &amp;&amp; cd `mktemp -d` &amp;&amp; go build $a)\n# command-line-arguments\n/go/src/nonexistent-website.com/example-2019-10-26/main.go:9: undefined: fmt in fmt.Println\n   2\n</code></pre>\n"}, {"tags": ["datetime", "go", "time", "gofmt"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1572115045, "post_id": 58573578, "comment_id": 103463580, "body": "An alternative to Cerise&#39;s answer is to use <code>fmt</code> instead of <code>log</code>."}, {"owner": {"reputation": 1157, "user_id": 2653567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/RNYoa.png?s=128&g=1", "display_name": "HMLDude", "link": "https://stackoverflow.com/users/2653567/hmldude"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1572139019, "post_id": 58573578, "comment_id": 103467732, "body": "Any idea of how I would force the output to always be expressed, purely in the form of millisecond instead of microseconds? Even if the wall time is several minutes in length, I would like the time to be expressed purely in milliseconds."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1572164828, "post_id": 58573578, "comment_id": 103470676, "body": "How a time.Duration is printed is implemented by the <a href=\"https://golang.org/pkg/time/#Duration.String\" rel=\"nofollow noreferrer\"><code>String</code></a> method, which you cannot change. What you can do however is to use the <code>%d</code> verb and divide the duration by <code>time.Millisecond</code>. (<a href=\"https://play.golang.com/p/TFJhBeDA8hk\" rel=\"nofollow noreferrer\">play.golang.com/p/TFJhBeDA8hk</a>)"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1572114921, "creation_date": 1572114921, "answer_id": 58573601, "question_id": 58573578, "link": "https://stackoverflow.com/questions/58573578/how-to-suppress-date-when-printing-elapsed-time/58573601#58573601", "title": "How to suppress date when printing elapsed time", "body": "<p>To log without a date and time, clear the date and time flags:</p>\n\n<pre><code>log.SetFlags(log.Flags() &amp;^ (log.Ldate | log.Ltime))\n</code></pre>\n\n<p>Because the default flags are <code>(log.Ldate | log.Ltime)</code>, the following also works:</p>\n\n<pre><code>log.SetFlags(0)\n</code></pre>\n"}], "owner": {"reputation": 1157, "user_id": 2653567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/RNYoa.png?s=128&g=1", "display_name": "HMLDude", "link": "https://stackoverflow.com/users/2653567/hmldude"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 58573601, "answer_count": 1, "score": -1, "last_activity_date": 1572117402, "creation_date": 1572114733, "last_edit_date": 1572117402, "question_id": 58573578, "link": "https://stackoverflow.com/questions/58573578/how-to-suppress-date-when-printing-elapsed-time", "title": "How to suppress date when printing elapsed time", "body": "<p>I have the following Go code used to capture elapsed time:</p>\n\n<pre><code>import (\n \"time\"\n)\n\nstart := time.Now()\n...\nend := time.Since(start)\nlog.Printf(\"Elapsed Time:  %s\", end)\n</code></pre>\n\n<p>The output of which is:</p>\n\n<pre><code>2019/10/26 13:22:53 Elapsed Time :  41.867\u00b5s\n</code></pre>\n\n<p>I would like the output to be simply:</p>\n\n<pre><code>Elapsed Time :  41.867\u00b5s\n</code></pre>\n\n<p>Not sure how to supress the time packages default data/clock time output.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1572111107, "post_id": 58573039, "comment_id": 103462696, "body": "share some actual code please."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1572111684, "post_id": 58573039, "comment_id": 103462817, "body": "You could use that example, receive the results from a result channel, and order them."}, {"owner": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1572112027, "post_id": 58573039, "comment_id": 103462898, "body": "@mh-cbon the code is in the line. Either way I solved the issue. Answer posted below..."}], "answers": [{"tags": [], "owner": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "is_accepted": true, "score": 1, "last_activity_date": 1572112247, "creation_date": 1572112247, "answer_id": 58573277, "question_id": 58573039, "link": "https://stackoverflow.com/questions/58573039/go-worker-pattern-for-warm-workers/58573277#58573277", "title": "Go worker pattern for warm workers", "body": "<p>The solution is incredibly simple (I was definitely over-complicating it). Not sure how efficient this actually is but doubt it's not too terrible. Suggestions for a better pattern are still welcome:</p>\n\n<p>In the job definition declare a channel to feed back the result:</p>\n\n<pre><code>type Job struct {\n    Request string\n    Params  []string\n    Result chan Result\n}\n</code></pre>\n\n<p>Inside your worker rather than just exiting with a return, pass the result struct over the channel:</p>\n\n<pre><code>job.Result &lt;- Result{\n    Response: result.String(),\n    Headers:  []string{},\n}\n</code></pre>\n\n<p>Now inside the web handler just wait on the channel:</p>\n\n<pre><code>disatcher.jobQueue &lt;- job\nresult := &lt;- job.Result\n</code></pre>\n\n<p>Silly me. Don't know why that had to take 2 hours of effort. :-p lesson learned: Go concurrency is POWERFUL. Just don't overthink it.</p>\n"}], "owner": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 58573277, "answer_count": 1, "score": 1, "last_activity_date": 1572112247, "creation_date": 1572110463, "question_id": 58573039, "link": "https://stackoverflow.com/questions/58573039/go-worker-pattern-for-warm-workers", "title": "Go worker pattern for warm workers", "body": "<p>I'm working on a problem where I have a set of \"warm workers\". That means that they are maintained in memory, maintain their own contexts and are callable. I've been looking at various Go worker implementations but all depend on closures or simple calculation functions that return results.</p>\n\n<p>I found an example of a worker that lets me spin up my contexts and distribute tasks to them based on a max queue and max routine limit: <a href=\"https://github.com/cahitbeyaz/job-worker/blob/master/main.go#L131\" rel=\"nofollow noreferrer\">https://github.com/cahitbeyaz/job-worker/blob/master/main.go#L131</a></p>\n\n<p>However this pattern doesn't allow me to return a result from the context and feed it back. I'm also using a web server and so the web handler has to receive the result and respond accordingly.</p>\n\n<p>Is there a specific/better pattern I should/could follow or a way I could adapt the job-worker example?</p>\n\n<p>PS. At first I thought I could create a ResultQueue where results are pushed back and consumed by the web handler. I don't think the ordering of the queue can be counted on though.</p>\n"}, {"tags": ["go", "ptrace"], "comments": [{"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 2, "creation_date": 1572108991, "post_id": 58572777, "comment_id": 103462178, "body": "I hope you know that these &quot;anti tracing&quot; attempts are quite defeatable and will do <i>nothing</i> to deter a skilled attacker..."}, {"owner": {"reputation": 311, "user_id": 6284677, "user_type": "registered", "profile_image": "https://graph.facebook.com/572063506300614/picture?type=large", "display_name": "Bubun", "link": "https://stackoverflow.com/users/6284677/bubun"}, "reply_to_user": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1572109050, "post_id": 58572777, "comment_id": 103462192, "body": "Yap @JesperJuhl I know it. It can be bypassed by a simple breakpoint. I am just learning golang and trying to implement it as an experiment."}, {"owner": {"reputation": 311, "user_id": 6284677, "user_type": "registered", "profile_image": "https://graph.facebook.com/572063506300614/picture?type=large", "display_name": "Bubun", "link": "https://stackoverflow.com/users/6284677/bubun"}, "reply_to_user": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1572209655, "post_id": 58572777, "comment_id": 103480911, "body": "one possible way I have found is to use cgo and call that C function. But I wanna do it in a golang way."}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 1, "creation_date": 1573736367, "post_id": 58572777, "comment_id": 103986130, "body": "Here&#39;s how the standard library calls it: <a href=\"https://github.com/golang/go/blob/master/src/syscall/exec_linux.go#L511\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/syscall/exec_linux.go#L&zwnj;&#8203;511</a> ."}, {"owner": {"reputation": 311, "user_id": 6284677, "user_type": "registered", "profile_image": "https://graph.facebook.com/572063506300614/picture?type=large", "display_name": "Bubun", "link": "https://stackoverflow.com/users/6284677/bubun"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1574588124, "post_id": 58572777, "comment_id": 104279283, "body": "@MarkPlotnick Thank you so much. It is working as expected after a bit tweaking. _, _, res := syscall.RawSyscall(syscall.SYS_PTRACE, uintptr(syscall.PTRACE_TRACEME), 0, 0)"}, {"owner": {"reputation": 311, "user_id": 6284677, "user_type": "registered", "profile_image": "https://graph.facebook.com/572063506300614/picture?type=large", "display_name": "Bubun", "link": "https://stackoverflow.com/users/6284677/bubun"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1574588375, "post_id": 58572777, "comment_id": 104279347, "body": "@MarkPlotnick But after Doing This. All exec.Command() seems to stopped working.  It is just getting stuck without any errors. the program seems to be stopped altogether. But when I am trying to debug the program using gdb, It started working as before. Starting the program using debugger or strace, seems to make this code run smoothly."}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1574631640, "post_id": 58572777, "comment_id": 104290470, "body": "When you call <code>ptrace(PTRACE_TRACEME)</code>, whether in C or Go, it tells the kernel that your parent process is willing to handle events that will put the debugee process into ptrace-stop state. That includes execs and receipt of a signal. gdb can handle events like this. I haven&#39;t met a shell than can handle events like this. PTRACE_TRACEME isn&#39;t reversible; programs that use it for anti-debugging ought to just print an error message and exit."}, {"owner": {"reputation": 311, "user_id": 6284677, "user_type": "registered", "profile_image": "https://graph.facebook.com/572063506300614/picture?type=large", "display_name": "Bubun", "link": "https://stackoverflow.com/users/6284677/bubun"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1574835875, "post_id": 58572777, "comment_id": 104367051, "body": "@MarkPlotnick I didn&#39;t knew about it before. Well Is There any way to get it working?"}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1574855715, "post_id": 58572777, "comment_id": 104377306, "body": "I haven&#39;t thought about it. Maybe you can ask a new question with the additional conditions you want - being able to do an exec after the PTRACE_TRACEME - and someone else may be able to help."}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1574873553, "post_id": 58572777, "comment_id": 104387450, "body": "As for this question, please consider answering it yourself (in the text box near the bottom of this page) with the go code that you have written. I think it will be helpful to other people."}, {"owner": {"reputation": 311, "user_id": 6284677, "user_type": "registered", "profile_image": "https://graph.facebook.com/572063506300614/picture?type=large", "display_name": "Bubun", "link": "https://stackoverflow.com/users/6284677/bubun"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1574943411, "post_id": 58572777, "comment_id": 104412303, "body": "@MarkPlotnick Thank you so much for your help dude! Sure I&#39;ll post an answer for this. Thanks again!"}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1576082938, "post_id": 58572777, "comment_id": 104785855, "body": "I looked into this a little more. It&#39;s not the <code>execve</code> system call that pauses the debuggee - the go runtime does a <code>spawn</code> first and the execve is in a different thread. Rather, it&#39;s the <code>SIGCHLD</code> that the debuggee receives while in <code>exec.Command</code>, specifically while in <code>os.(*Process).blockUntilWaitable</code>. Adding a call to Ignore SIGCHLD doesn&#39;t change the outcome."}], "answers": [{"tags": [], "owner": {"reputation": 311, "user_id": 6284677, "user_type": "registered", "profile_image": "https://graph.facebook.com/572063506300614/picture?type=large", "display_name": "Bubun", "link": "https://stackoverflow.com/users/6284677/bubun"}, "is_accepted": true, "score": 0, "last_activity_date": 1615799388, "last_edit_date": 1615799388, "creation_date": 1574944226, "answer_id": 59088962, "question_id": 58572777, "link": "https://stackoverflow.com/questions/58572777/how-to-detect-if-ptrace-already-called-in-golang-linux/59088962#59088962", "title": "how to detect if ptrace already called in golang linux", "body": "<p>Based on @MarkPlotnick's comments, here is the golang Equivalent code for the c++ code posted by me.</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;syscall&quot;\n)\n\nfunc main() {\n    if isBeingTraced() {\n        fmt.Println(&quot;don't trace me !!&quot;)\n        return\n    }\n\n    fmt.Println(&quot;Not being traced...  (maybe)&quot;)\n}\n\nfunc isBeingTraced() bool { \n    _, _, res := syscall.RawSyscall(syscall.SYS_PTRACE, uintptr(syscall.PTRACE_TRACEME), 0, 0)\n    return res == 1\n}\n</code></pre>\n<p>Ref: <a href=\"https://github.com/golang/go/blob/master/src/syscall/exec_linux.go#L511\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/syscall/exec_linux.go#L511</a></p>\n<p>But the problem I have been with this code is, You cannot call exec.Command() after calling PTRACE_TRACEME.\nWill try to find a solution to this problem. and if I got any, I will reference it here.</p>\n"}], "owner": {"reputation": 311, "user_id": 6284677, "user_type": "registered", "profile_image": "https://graph.facebook.com/572063506300614/picture?type=large", "display_name": "Bubun", "link": "https://stackoverflow.com/users/6284677/bubun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 436, "favorite_count": 0, "accepted_answer_id": 59088962, "answer_count": 1, "score": 1, "last_activity_date": 1615799388, "creation_date": 1572108674, "last_edit_date": 1572274686, "question_id": 58572777, "link": "https://stackoverflow.com/questions/58572777/how-to-detect-if-ptrace-already-called-in-golang-linux", "title": "how to detect if ptrace already called in golang linux", "body": "<p>I am learning golang and I wanna implement a simple Linux anti-debugging method in golang. I have a CPP code which works in the same way I intended. But cannot do the same in golang. can you guys guide me how to do same in go?</p>\n\n<p>Here is the C++ Code I am using as a reference. </p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;sys/ptrace.h&gt;\n\n\nbool isBeingTraced(){\n    return ptrace(PTRACE_TRACEME, 0, 1, 0) == -1;\n}\n\nint main()\n{\n    if (isBeingTraced()) \n    {\n        printf(\"don't trace me !!\\n\");\n        return 1;\n    }\n    printf(\"Not being traced...  (maybe)\\n\");\n    return 0;\n}\n</code></pre>\n\n<p>And I wanna do the same thing in go lang.\nIs it even possible to do the same in go?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    if isBeingTraced() {\n        fmt.Println(\"don't trace me !!\")\n        return\n    }\n\n    fmt.Println(\"Not being traced...  (maybe)\")\n}\n\nfunc isBeingTraced() bool {\n    return true // How to Implement that Cpp Function here?\n}\n</code></pre>\n"}, {"tags": ["go", "nginx", "reverse-proxy", "ubuntu-18.04", "systemd"], "comments": [{"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1572105075, "post_id": 58572298, "comment_id": 103461225, "body": "the truncated log messages in your service status look like a stack trace."}, {"owner": {"reputation": 456, "user_id": 472427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/2bb9596cdff38909b67f70aecf36c557?s=128&d=identicon&r=PG", "display_name": "AndyM", "link": "https://stackoverflow.com/users/472427/andym"}, "reply_to_user": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1572106187, "post_id": 58572298, "comment_id": 103461481, "body": "oh yes - does that mean the goapp is dying under systemd  ? I&#39;ll maybe try getting systemd not to restart if it dies . Thanks for spotting."}, {"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1572106586, "post_id": 58572298, "comment_id": 103461549, "body": "restart isn&#39;t wrong, but if your service always dies that&#39;s going to stop it from handling requests.  Systemd service restarts should be rare.  <a href=\"https://unix.stackexchange.com/questions/225401/how-to-see-full-log-from-systemctl-status-service\" title=\"how to see full log from systemctl status service\">unix.stackexchange.com/questions/225401/&hellip;</a> can help you see the full logs."}, {"owner": {"reputation": 456, "user_id": 472427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/2bb9596cdff38909b67f70aecf36c557?s=128&d=identicon&r=PG", "display_name": "AndyM", "link": "https://stackoverflow.com/users/472427/andym"}, "reply_to_user": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1572107315, "post_id": 58572298, "comment_id": 103461728, "body": "Yes your correct- I meant to see if the app stayed dead. I&#39;ve now found the app is panicking under systemd but OK when manually run on the command line. I can see the following in log 2019/10/26 16:17:38 http: panic serving 127.0.0.1:50538: runtime error: invalid memory.  Thanks for the lead."}], "answers": [{"tags": [], "owner": {"reputation": 456, "user_id": 472427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/2bb9596cdff38909b67f70aecf36c557?s=128&d=identicon&r=PG", "display_name": "AndyM", "link": "https://stackoverflow.com/users/472427/andym"}, "is_accepted": false, "score": 0, "last_activity_date": 1572204742, "creation_date": 1572204742, "answer_id": 58582660, "question_id": 58572298, "link": "https://stackoverflow.com/questions/58572298/upstream-timeouts-between-goapp-systemd-nginx/58582660#58582660", "title": "Upstream timeouts between goapp systemd nginx", "body": "<p>Turns out the go program running under systemd could not find my template file. Once I put in the full path for the template file in the go app it worked.  </p>\n\n<p>So </p>\n\n<pre><code>t, _ := template.ParseFiles(\"template.gohtml\")\n</code></pre>\n\n<p>had to become </p>\n\n<pre><code>t, _ := template.ParseFiles(\"/home/myapp/mytemplates/template.gohtml\")\n</code></pre>\n\n<p>I also should have checked for my template var t not being nil.</p>\n"}], "owner": {"reputation": 456, "user_id": 472427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/2bb9596cdff38909b67f70aecf36c557?s=128&d=identicon&r=PG", "display_name": "AndyM", "link": "https://stackoverflow.com/users/472427/andym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572204742, "creation_date": 1572104882, "question_id": 58572298, "link": "https://stackoverflow.com/questions/58572298/upstream-timeouts-between-goapp-systemd-nginx", "title": "Upstream timeouts between goapp systemd nginx", "body": "<p>On ubuntu 18.04LTS I'm using nginx to reverse proxy my go app. </p>\n\n<p>It works when I run the goapp on command line, but when I've tried to put the goapp under systemd control.  nginx  gives a <code>\"502 Bad Gateway\".</code> I think its something to do with systemd, ports and maybe forking ?</p>\n\n<p>Any help would be greatly appreciated.  The nginx error log shows the following for each connection attempt:</p>\n\n<pre><code> 2019/10/26 15:24:52 [error] 11974#11974: *1 upstream prematurely closed connection while reading response header from upstream, client: 217.42.177.154, server: _, request: \"GET /codcall HTTP/1.1\", upstream: \"http://127.0.0.1:8001/codcall\", host: \"167.99.192.223\"\n</code></pre>\n\n<p>My systemd app config is as follows:</p>\n\n<pre><code>[Unit]\nDescription=CodCall web service\n\n[Service]\nType=simple\nRestart=always\nRestartSec=5s\nExecStart=/home/codcall/surf-get/codcall\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n\n<p>When running under systemd I get following for the status</p>\n\n<pre><code>codcall.service - CodCall web service\n   Loaded: loaded (/lib/systemd/system/codcall.service; disabled; vendor preset: enabled)\n   Active: active (running) since Sat 2019-10-26 15:24:07 UTC; 19min ago\n Main PID: 11847 (codcall)\n    Tasks: 6 (limit: 1152)\n   CGroup: /system.slice/codcall.service\n           \u2514\u250011847 /home/codcall/surf-get/codcall\n\nOct 26 15:37:41 codcall-ubuntu codcall[11847]: net/http.HandlerFunc.ServeHTTP(0x832a60, 0x8a2320, 0xc00025e0\nOct 26 15:37:41 codcall-ubuntu codcall[11847]:         /usr/lib/go-1.13/src/net/http/server.go:2007 +0x44\nOct 26 15:37:41 codcall-ubuntu codcall[11847]: net/http.(*ServeMux).ServeHTTP(0xb16240, 0x8a2320, 0xc00025e0\nOct 26 15:37:41 codcall-ubuntu codcall[11847]:         /usr/lib/go-1.13/src/net/http/server.go:2387 +0x1bd\nOct 26 15:37:41 codcall-ubuntu codcall[11847]: net/http.serverHandler.ServeHTTP(0xc0000ac000, 0x8a2320, 0xc0\nOct 26 15:37:41 codcall-ubuntu codcall[11847]:         /usr/lib/go-1.13/src/net/http/server.go:2802 +0xa4\nOct 26 15:37:41 codcall-ubuntu codcall[11847]: net/http.(*conn).serve(0xc0000783c0, 0x8a2c60, 0xc000014040)\nOct 26 15:37:41 codcall-ubuntu codcall[11847]:         /usr/lib/go-1.13/src/net/http/server.go:1890 +0x875\nOct 26 15:37:41 codcall-ubuntu codcall[11847]: created by net/http.(*Server).Serve\nOct 26 15:37:41 codcall-ubuntu codcall[11847]:         /usr/lib/go-1.13/src/net/http/server.go:2927 +0x38e\n</code></pre>\n\n<p>My go app is using the following to listen and serve:</p>\n\n<pre><code>func main() {\n        http.HandleFunc(\"/\", indexHandler)\n        http.ListenAndServe(\":8001\", nil)\n\n}\n</code></pre>\n\n<p>And my nginx config is as follows : I left the / in to check that nginx was running and still serves / as \"Welcome to nginx\"</p>\n\n<pre><code>server {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n\n location /codcall {\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_pass http://localhost:8001;\n   }\n\n\n        root /var/www/html;\n\n        # Add index.php to the list if you are using PHP\n        index index.html index.htm index.nginx-debian.html;\n\n        server_name _;\n\n        location / {\n                # First attempt to serve request as file, then\n                # as directory, then fall back to displaying a 404.\n                try_files $uri $uri/ =404;\n        }\n}\n</code></pre>\n"}, {"tags": ["go", "apache-kafka", "confluent-platform", "sarama"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1572104256, "post_id": 58572143, "comment_id": 103461038, "body": "<a href=\"https://github.com/segmentio/kafka-go#reader-\" rel=\"nofollow noreferrer\">github.com/segmentio/kafka-go#reader-</a> ?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1572104357, "post_id": 58572143, "comment_id": 103461059, "body": "<a href=\"https://docs.confluent.io/current/clients/confluent-kafka-go/index.html#Consumer.Seek\" rel=\"nofollow noreferrer\">docs.confluent.io/current/clients/confluent-kafka-go/&hellip;</a> ?"}], "answers": [{"tags": [], "owner": {"reputation": 60048, "user_id": 345490, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ql8CE.jpg?s=128&g=1", "display_name": "Icarus", "link": "https://stackoverflow.com/users/345490/icarus"}, "is_accepted": true, "score": 0, "last_activity_date": 1572111896, "creation_date": 1572111896, "answer_id": 58573242, "question_id": 58572143, "link": "https://stackoverflow.com/questions/58572143/how-to-consume-messages-from-the-beginning-to-a-particular-offset/58573242#58573242", "title": "How to consume messages from the beginning to a particular offset", "body": "<p>I am posting this as an answer because I am like 99.9% convinced that this is correct - you cannot specify the end offset on the Consumer. The Consumer API supports OOTB: </p>\n\n<ol>\n<li>Start at the beginning.</li>\n<li>Start at any arbitrary position. </li>\n<li>Start at the end.</li>\n</ol>\n\n<p>Note that there's no option for specifying ranges but you can easily do that yourself: simply start at the beginning and stop when you have read whatever number of messages you need (e.g. your final offset). </p>\n\n<p>See the section <code>Controlling Consumer Position</code> in <a href=\"https://kafka.apache.org/23/javadoc/index.html?org/apache/kafka/clients/consumer/KafkaConsumer.html\" rel=\"nofollow noreferrer\">the Official API</a></p>\n"}], "owner": {"reputation": 905, "user_id": 1879605, "user_type": "registered", "accept_rate": 2, "profile_image": "https://i.stack.imgur.com/T8uIg.jpg?s=128&g=1", "display_name": "Arsene", "link": "https://stackoverflow.com/users/1879605/arsene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 428, "favorite_count": 0, "accepted_answer_id": 58573242, "answer_count": 1, "score": 0, "last_activity_date": 1572117599, "creation_date": 1572103663, "last_edit_date": 1572117599, "question_id": 58572143, "link": "https://stackoverflow.com/questions/58572143/how-to-consume-messages-from-the-beginning-to-a-particular-offset", "title": "How to consume messages from the beginning to a particular offset", "body": "<p>I have the map between partitions number and offsets number of a given topic in kafka. I would like to consume all messages starting from the beginning to those particular partition/offset mapping using golang. In a nutshell I would like to know whether it is possible to consume messages in kafka from the beginning to a particular offset.</p>\n\n<p>I would like to know whether there are built-in tools or libraries that can help me do before I start implementing something.</p>\n"}, {"tags": ["docker", "go", "kubernetes", "grpc", "kubernetes-pod"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1572108417, "creation_date": 1572108417, "answer_id": 58572743, "question_id": 58572085, "link": "https://stackoverflow.com/questions/58572085/how-to-broadcast-grpc-streams-inter-pods/58572743#58572743", "title": "How to broadcast gRPC streams inter pods", "body": "<p>Maybe this is not possible for your use case, but have you thought about having a service in front of the worker, so instead of subscribing to both workers, you subscribe to one of the two? </p>\n\n<p>If you <em>need</em> to subscribe to both workers, one thing you can do is to use the k8s API client and watch the pod resource with a selector that selects your worker pod (by name, or some other label), and subscribe to it if a new one pops up. That'll probably require you to setup a cluster role and a cluster role binding for the listener pods so they can watch pod resources. This scheme will also allow you to unsubscribe from workers when they die.</p>\n"}, {"comments": [{"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1572167443, "post_id": 58572832, "comment_id": 103471121, "body": "@BurakSerdar I am confused, your answer says &quot;that is not possible&quot; and here that &quot;k8s already does it&quot;?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1572188308, "post_id": 58572832, "comment_id": 103475585, "body": "what may not be possible is using services. Using k8s apis works just fine for this scenario once the cluster role is setup and it works just the way you described. Even better, you do not have to poll. You will get notifications when pods are created. Also #2 in you description is how k8s services work."}, {"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1572292870, "post_id": 58572832, "comment_id": 103507879, "body": "@BurakSerdar here I meant to solve the problem inside the application, as you say it would be possible to re-use some k8s native functionalities, however seems that gRPC-API and the worker are custom components, you need anyway to integrate the required new logic into them"}], "tags": [], "owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "is_accepted": false, "score": 0, "last_activity_date": 1572167807, "last_edit_date": 1572167807, "creation_date": 1572109120, "answer_id": 58572832, "question_id": 58572085, "link": "https://stackoverflow.com/questions/58572085/how-to-broadcast-grpc-streams-inter-pods/58572832#58572832", "title": "How to broadcast gRPC streams inter pods", "body": "<p>As an idea: why not using a central configuration storage (like etcd, redis,..) to synchronize the workers with the gRPC-API, this kind of logic need to be managed by the application itself, in details:</p>\n\n<ol>\n<li>when a new worker-pod starts, it register itself on the configuration service</li>\n<li>when the application gRPC-API requires to establish a new connection, it looks on on the configuration service and the application chooses one: it is up to you to decide which kind of strategy you want to use there, round-robin, random, stickiness,...etc</li>\n<li>when a worker-pod is then shutted-down, the entry of that destination is removed from the configuration service. To avoid ghost entries, it is probably better in place a custom monitoring tool or that gRPC-API takes the responsibility to check the validity of the destination before start a new connection</li>\n</ol>\n\n<p>This should do the trick that you are looking for.</p>\n"}], "owner": {"reputation": 399, "user_id": 2463840, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/2994a05f9f3a71337e1d63cafe8b1fed?s=128&d=identicon&r=PG", "display_name": "Marcelo Dias", "link": "https://stackoverflow.com/users/2463840/marcelo-dias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 126, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1572167807, "creation_date": 1572103206, "question_id": 58572085, "link": "https://stackoverflow.com/questions/58572085/how-to-broadcast-grpc-streams-inter-pods", "title": "How to broadcast gRPC streams inter pods", "body": "<p>We have gRPC stream to share data between two micro services, an API and a Worker (both created in Golang). The intention is to listener about the status of jobs being processed by Worker service pods. So, the communication is one-directional (Worker sends updates to Api). The figure below shows it.\n<a href=\"https://i.stack.imgur.com/0eh2Z.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0eh2Z.png\" alt=\"enter image description here\"></a> </p>\n\n<p>Our problem is, how can I managed to know when Worker's pod scales up, in order to subscribe to new Worker pod (by stream)?</p>\n\n<p>The figure below shows the problem.</p>\n\n<p><a href=\"https://i.stack.imgur.com/6Vp7U.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6Vp7U.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 964, "user_id": 2575021, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f1ec1e86e45198215f91498d3d2c4134?s=128&d=identicon&r=PG", "display_name": "Vishal R", "link": "https://stackoverflow.com/users/2575021/vishal-r"}, "is_accepted": false, "score": 2, "last_activity_date": 1572096533, "creation_date": 1572096533, "answer_id": 58571219, "question_id": 58570915, "link": "https://stackoverflow.com/questions/58570915/how-to-generate-doc-from-a-go-program-in-go1-13/58571219#58571219", "title": "How to generate doc from a go program in go1.13", "body": "<p>This is something you might be looking for </p>\n\n<pre><code>godoc -html &lt;package-name&gt;\n</code></pre>\n\n<p>You can refer to <a href=\"https://blog.golang.org/godoc-documenting-go-code\" rel=\"nofollow noreferrer\">this link</a> for more details</p>\n"}, {"tags": [], "owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "is_accepted": false, "score": 0, "last_activity_date": 1572096811, "creation_date": 1572096811, "answer_id": 58571250, "question_id": 58570915, "link": "https://stackoverflow.com/questions/58570915/how-to-generate-doc-from-a-go-program-in-go1-13/58571250#58571250", "title": "How to generate doc from a go program in go1.13", "body": "<ol>\n<li>Move your package folder under <code>GOPATH</code> directory.</li>\n</ol>\n\n<pre><code>$GOPATH/src/github.com/username/my-package\n</code></pre>\n\n<ol start=\"2\">\n<li><p>Use <code>godoc</code> to generate documentation for go project. </p>\n\n<ul>\n<li>To generate html doc</li>\n</ul></li>\n</ol>\n\n<pre><code>godoc -html  github.com/username/my-package\n</code></pre>\n\n<ul>\n<li>Alternate option:</li>\n</ul>\n\n<pre><code>godoc -http=:6060\n</code></pre>\n\n<p>Now you can visit <code>http://localhost:6060/pkg/github.com/username/my-package</code> to browse the documentation of your package. </p>\n"}], "owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 481, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1572168007, "creation_date": 1572094213, "last_edit_date": 1572168007, "question_id": 58570915, "link": "https://stackoverflow.com/questions/58570915/how-to-generate-doc-from-a-go-program-in-go1-13", "title": "How to generate doc from a go program in go1.13", "body": "<p>Here is a little program toto.go </p>\n\n<pre><code>// Copyright Some Company Corp.\n// All Rights Reserved\npackage main\n\n\n// here are the imports\nimport (\n    \"fmt\"\n)\n\n// function to say hello\nfunc hello() {\n    fmt.Println(\"hello world\")\n\n}\n\n// Main function here\nfunc main() {\n    hello()\n}\n</code></pre>\n\n<p>How to generate an html documentation from this code ?</p>\n\n<p>Result : </p>\n\n<pre><code>godoc -html  github.com/bussiere/GoTestDoc \nflag provided but not defined: -html\nusage: godoc -http=localhost:6060\n  -analysis string\n        comma-separated list of analyses to perform (supported: type, pointer). See http://golang.org/lib/godoc/analysis/help.html\n  -goroot string\n        Go root directory (default \"/usr/lib/go-1.13\")\n  -http string\n        HTTP service address (default \"localhost:6060\")\n  -index\n        enable search index\n  -index_files string\n        glob pattern specifying index files; if not empty, the index is read from these files in sorted order\n  -index_interval duration\n        interval of indexing; 0 for default (5m), negative to only index once at startup\n  -index_throttle float\n        index throttle value; 0.0 = no time allocated, 1.0 = full throttle (default 0.75)\n  -links\n        link identifiers to their declarations (default true)\n  -maxresults int\n        maximum number of full text search results shown (default 10000)\n  -notes string\n        regular expression matching note markers to show (default \"BUG\")\n  -play\n        enable playground\n  -templates string\n        load templates/JS/CSS from disk in this directory\n  -timestamps\n        show timestamps with directory listings\n  -url string\n        print HTML for named URL\n  -v    verbose mode\n  -write_index\n        write index to a file; the file name must be specified with -index_files\n  -zip string\n        zip file providing the file system to serve; disabled if empty\n</code></pre>\n\n<p>So it seems lot of things have changed since last time.\nAnd it seems hard to find tutorial and doc up to date to make doc for golang in go1.13</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1222, "user_id": 1262265, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e7aa896614ada2c5e060a2b1b4b55f96?s=128&d=identicon&r=PG", "display_name": "nickolay.laptev", "link": "https://stackoverflow.com/users/1262265/nickolay-laptev"}, "edited": false, "score": 0, "creation_date": 1572090199, "post_id": 58570033, "comment_id": 103457934, "body": "Hey Downvoters, it makes no sense to downvote without any comment left :-)"}], "answers": [{"comments": [{"owner": {"reputation": 1222, "user_id": 1262265, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e7aa896614ada2c5e060a2b1b4b55f96?s=128&d=identicon&r=PG", "display_name": "nickolay.laptev", "link": "https://stackoverflow.com/users/1262265/nickolay-laptev"}, "edited": false, "score": 0, "creation_date": 1572087479, "post_id": 58570117, "comment_id": 103457449, "body": "Thanks. Is there native Abs function for Duration in Go?"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 1222, "user_id": 1262265, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e7aa896614ada2c5e060a2b1b4b55f96?s=128&d=identicon&r=PG", "display_name": "nickolay.laptev", "link": "https://stackoverflow.com/users/1262265/nickolay-laptev"}, "edited": false, "score": 1, "creation_date": 1572087630, "post_id": 58570117, "comment_id": 103457471, "body": "Not, like this, You may use <code>c := time.Duration(math.Abs(float64(a - b)))</code>, but it uses unnecessary floating point operation."}, {"owner": {"reputation": 1222, "user_id": 1262265, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e7aa896614ada2c5e060a2b1b4b55f96?s=128&d=identicon&r=PG", "display_name": "nickolay.laptev", "link": "https://stackoverflow.com/users/1262265/nickolay-laptev"}, "edited": false, "score": 0, "creation_date": 1572087807, "post_id": 58570117, "comment_id": 103457505, "body": "I would use a modified version of your answer. Abs can have if diff &lt; 0 { diff = -diff }. This will be a real Abs without substriction that doesn&#39;t relate to it"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 3, "last_activity_date": 1572088024, "last_edit_date": 1572088024, "creation_date": 1572087206, "answer_id": 58570117, "question_id": 58570033, "link": "https://stackoverflow.com/questions/58570033/absolute-difference-between-time-duration/58570117#58570117", "title": "Absolute difference between time.Duration", "body": "<p>Try this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    a := 1 * time.Second\n    b := 10 * time.Second\n    c := absDiff(a, b)\n    fmt.Println(c)         // 9s\n    fmt.Println(absDiff(b, a)) // 9s\n\n}\nfunc absDiff(a, b time.Duration) time.Duration {\n    if a &gt;= b {\n        return a - b\n    }\n    return b - a\n}\n</code></pre>\n\n<hr>\n\n<p>This is another form:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    a := 1 * time.Second\n    b := 10 * time.Second\n    c := abs(a - b)\n    fmt.Println(c) // 9s\n}\n\nfunc abs(a time.Duration) time.Duration {\n    if a &gt;= 0 {\n        return a\n    }\n    return -a\n}\n</code></pre>\n"}], "owner": {"reputation": 1222, "user_id": 1262265, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e7aa896614ada2c5e060a2b1b4b55f96?s=128&d=identicon&r=PG", "display_name": "nickolay.laptev", "link": "https://stackoverflow.com/users/1262265/nickolay-laptev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 676, "favorite_count": 0, "accepted_answer_id": 58570117, "answer_count": 1, "score": -1, "last_activity_date": 1572122427, "creation_date": 1572086576, "last_edit_date": 1572122427, "question_id": 58570033, "link": "https://stackoverflow.com/questions/58570033/absolute-difference-between-time-duration", "title": "Absolute difference between time.Duration", "body": "<p>I have 2 variables with time.Duration type. I need to find the difference in duration between them.<br>\nFor example v1 = 1sec and v2 = 10sec. The difference will be 9 sec. The same difference will be if v1 = 10sec and v2 = 1sec.<br>\nBoth variables can have different values for hours, minutes etc.</p>\n\n<p><strong>How can I do this in Go?</strong></p>\n\n<p>This is a trivial question but I'm new to Go.</p>\n\n<p><strong>Solution:</strong>\nI used a modified version of provided answer:</p>\n\n<pre><code>func abs(value time.Duration) time.Duration {\n    if value &lt; 0 {\n        return -value\n    }\n    return value\n}\n</code></pre>\n"}, {"tags": ["go", "reverse-proxy", "http2"], "answers": [{"comments": [{"owner": {"reputation": 85078, "user_id": 31610, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/20571f32acd27d2cf5f1b1f42ea1a75b?s=128&d=identicon&r=PG", "display_name": "Geo", "link": "https://stackoverflow.com/users/31610/geo"}, "edited": false, "score": 0, "creation_date": 1572121802, "post_id": 58570630, "comment_id": 103465118, "body": "Hi Barry, if we would make abstraction of the programming language, what would be the steps needed to do such an upgrade from the proxy&#39;s side? Is there a specific header that I should include before passing the request to the upstream? I tried some experiments with setting Upgrade header but it seems that the go reverse proxy does not like it."}, {"owner": {"reputation": 30128, "user_id": 2144578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6sbqF.png?s=128&g=1", "display_name": "Barry Pollard", "link": "https://stackoverflow.com/users/2144578/barry-pollard"}, "reply_to_user": {"reputation": 85078, "user_id": 31610, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/20571f32acd27d2cf5f1b1f42ea1a75b?s=128&d=identicon&r=PG", "display_name": "Geo", "link": "https://stackoverflow.com/users/31610/geo"}, "edited": false, "score": 0, "creation_date": 1572123625, "post_id": 58570630, "comment_id": 103465460, "body": "You wouldn\u2019t do the upgrade. You would just tell the proxy to connect to the backend and if both sides support HTTP/2 then it would happen as part of the connection setup. You don\u2019t upgrade a connection - you setup two independent connections. I don\u2019t think I\u2019m understanding your question to be honest. Maybe explaining exactly what you are trying to do (and about about why!) would help. Are you trying to effectively enable HTTP/2 support for a system that does not support it?"}, {"owner": {"reputation": 85078, "user_id": 31610, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/20571f32acd27d2cf5f1b1f42ea1a75b?s=128&d=identicon&r=PG", "display_name": "Geo", "link": "https://stackoverflow.com/users/31610/geo"}, "edited": false, "score": 0, "creation_date": 1572124607, "post_id": 58570630, "comment_id": 103465672, "body": "This is my usecse: I have many frontends, and one cloudfront distribution serving assets from an s3 bucket. I know that cloudfront supports HTTP/2, so I wanted to check how they load over HTTP/2. Basically, when a frontend requests for example image.png, depending on the frontend requesting the asset, I need to rewrite it to a specific path in the cloudfront distribution. Currently, the frontend does a request to the reverse proxy, the path gets rewritten, and then the request is sent to cloudfront."}], "tags": [], "owner": {"reputation": 30128, "user_id": 2144578, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6sbqF.png?s=128&g=1", "display_name": "Barry Pollard", "link": "https://stackoverflow.com/users/2144578/barry-pollard"}, "is_accepted": false, "score": 1, "last_activity_date": 1572091869, "creation_date": 1572091869, "answer_id": 58570630, "question_id": 58569795, "link": "https://stackoverflow.com/questions/58569795/is-it-possible-that-a-reverse-proxy-upgrades-a-http-1-1-connection-to-http2/58570630#58570630", "title": "Is it possible that a reverse proxy upgrades a http/1.1 connection to http2?", "body": "<p>Yes it\u2019s entirely possible.</p>\n\n<p>Many web proxies (most?) are HTTP proxies (also called level 7 proxies) and have two, separate, HTTP connections - one for the incoming \u201cfrontend\u201d and the other for the outgoing \u201cbackend\u201d. These two connections can have completely different settings - including supporting different HTTP versions.</p>\n\n<p>Other proxies are TCP proxies (also called level 4 proxies) and they have no concept of HTTP and just forward the TCP packets on and assume the otherwise will know what to do with them. In this case it is not possible\nTo have different HTTP versions.</p>\n\n<p>Saying that, <a href=\"https://stackoverflow.com/questions/41637076/http2-with-node-js-behind-nginx-proxy\">most of the benefit of HTTP/2 is for the front end connection</a> as HTTP/2 improves the performance impact of HTTP over high latency connections. Typically backend connections are over lower latency, higher bandwidth connections (maybe even in the same data centre). So while what you are asking is entirely possible whether you want to do this is more questionable. And it\u2019s probably because of that questionable benefit that many servers don\u2019t actually support backend connections over HTTP/2. <a href=\"https://httpd.apache.org/docs/2.4/mod/mod_proxy_http2.html\" rel=\"nofollow noreferrer\">Apache does but has it marked as experimental</a>. Nginx does not and <a href=\"https://trac.nginx.org/nginx/ticket/923\" rel=\"nofollow noreferrer\">say they won\u2019t</a>. I\u2019m not familiar with Go <a href=\"https://github.com/golang/go/issues/16696\" rel=\"nofollow noreferrer\">but looks like it might support this</a>.</p>\n"}], "owner": {"reputation": 85078, "user_id": 31610, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/20571f32acd27d2cf5f1b1f42ea1a75b?s=128&d=identicon&r=PG", "display_name": "Geo", "link": "https://stackoverflow.com/users/31610/geo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572091869, "creation_date": 1572084126, "question_id": 58569795, "link": "https://stackoverflow.com/questions/58569795/is-it-possible-that-a-reverse-proxy-upgrades-a-http-1-1-connection-to-http2", "title": "Is it possible that a reverse proxy upgrades a http/1.1 connection to http2?", "body": "<p>Not really sure whether is possible or not, but if you have a reverse proxy for HTTP/1.1 connections, would it be possible to ugprade from the reverse proxy, said connections to HTTP/2, if the destination is capable of serving HTTP/2? </p>\n\n<p>If it helps, the proxy is written in go, and it makes use of the <a href=\"https://golang.org/pkg/net/http/httputil/#ReverseProxy\" rel=\"nofollow noreferrer\">reverseproxy</a> package.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 1, "last_activity_date": 1572084419, "creation_date": 1572084419, "answer_id": 58569830, "question_id": 58569787, "link": "https://stackoverflow.com/questions/58569787/marshal-struct-array-to-xml-without-a-parent-tag/58569830#58569830", "title": "Marshal struct array to xml without a parent tag", "body": "<p>Just add <code>xml:\",chardata\"</code> tag to the <code>FirstName</code> filed:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    type Person struct {\n        XMLName   xml.Name `xml:\"person\"`\n        ID        int      `xml:\"id,attr\"`\n        FirstName string   `xml:\",chardata\"`\n    }\n\n    a := &amp;Person{\n        ID:        13,\n        FirstName: \"John\",\n    }\n    b := &amp;Person{\n        ID:        14,\n        FirstName: \"Doe\",\n    }\n    x := []*Person{}\n    x = append(x, a)\n    x = append(x, b)\n\n    enc := xml.NewEncoder(os.Stdout)\n    enc.Indent(\"  \", \"    \")\n    if err := enc.Encode(x); err != nil {\n        fmt.Printf(\"error: %v\\n\", err)\n    }\n}\n\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&lt;person id=\"13\"&gt;John&lt;/person&gt;\n&lt;person id=\"14\"&gt;Doe&lt;/person&gt;\n</code></pre>\n"}], "owner": {"reputation": 187, "user_id": 4595123, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-zCDAR0EowAA/AAAAAAAAAAI/AAAAAAAAAkM/qiQ2jFvIw90/photo.jpg?sz=128", "display_name": "Malaka Gunawardhana", "link": "https://stackoverflow.com/users/4595123/malaka-gunawardhana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 24, "favorite_count": 0, "accepted_answer_id": 58569830, "answer_count": 1, "score": 0, "last_activity_date": 1572084419, "creation_date": 1572084099, "question_id": 58569787, "link": "https://stackoverflow.com/questions/58569787/marshal-struct-array-to-xml-without-a-parent-tag", "title": "Marshal struct array to xml without a parent tag", "body": "<p>I am trying to marshal a go struct with an array into a <em>xml</em>. In this array I need to have a attribute for each element and a value. I do not need this to be inside a parent <em>xml</em> tag.</p>\n\n<p>I have the code below.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    type Person struct {\n        XMLName   xml.Name `xml:\"person\"`\n        Id        int      `xml:\"id,attr\"`\n        FirstName string\n    }\n\n    a := &amp;Person{\n       Id: 13,\n       FirstName: \"John\",\n    }\n    b := &amp;Person{\n       Id: 14,\n       FirstName: \"Doe\",\n    }\n    x := []*Person{}\n    x = append(x, a)\n    x = append(x, b)\n\n    enc := xml.NewEncoder(os.Stdout)\n    enc.Indent(\"  \", \"    \")\n    if err := enc.Encode(x); err != nil {\n        fmt.Printf(\"error: %v\\n\", err)\n    }\n}\n</code></pre>\n\n<p>It produces below output.</p>\n\n<pre><code>&lt;person id=\"13\"&gt;\n  &lt;FirstName&gt;John&lt;/FirstName&gt;\n&lt;/person&gt;\n&lt;person id=\"14\"&gt;\n  &lt;FirstName&gt;Doe&lt;/FirstName&gt;\n&lt;/person&gt;\n</code></pre>\n\n<p>But I need to make it as below.</p>\n\n<pre><code>&lt;person id=\"13\"&gt;John&lt;/person&gt;\n&lt;person id=\"14\"&gt;Doe&lt;/person&gt;\n</code></pre>\n\n<p>Any help on this is much appreciated. Can I do this with go?</p>\n"}]