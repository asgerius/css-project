[{"tags": ["go"], "comments": [{"owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 0, "creation_date": 1536186153, "post_id": 52194070, "comment_id": 91337965, "body": "Higher-order function return values is possible, but you cannot return a function which has a receiver on another type. Please expand your question to describe more concretely what you are trying to achieve."}, {"owner": {"reputation": 13, "user_id": 10322518, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SRuXsXUVnN4/AAAAAAAAAAI/AAAAAAAAAAc/b3lDZLzZeUI/photo.jpg?sz=128", "display_name": "Jacky Wang", "link": "https://stackoverflow.com/users/10322518/jacky-wang"}, "reply_to_user": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 0, "creation_date": 1536186855, "post_id": 52194070, "comment_id": 91338144, "body": "@Cosmic Ossifrage - If needed, the <code>myDecorator</code> function could have a receiver as <code>*myStruct</code>. I am actually using this decorator to wrap <code>fmt.Sprintf</code>, <code>Sprintln</code>, <code>Sprint</code> method to get <code>Logger.Debugln</code>, <code>Logger.Debugf</code>, <code>Logger.Warning</code>, ... methods, where <code>Logger</code> is a self-defined struct, since these functions shares almost the same behavior."}], "answers": [{"tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": true, "score": 1, "last_activity_date": 1536191561, "creation_date": 1536191561, "answer_id": 52194728, "question_id": 52194070, "link": "https://stackoverflow.com/questions/52194070/return-a-function-with-receiver-in-golang/52194728#52194728", "title": "Return a function with receiver in Golang", "body": "<p>As noted in <a href=\"https://stackoverflow.com/questions/52194070/return-a-function-with-receiver-in-golang?noredirect=1#comment91337965_52194070\">my comment</a>, you cannot modify the <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method set</a> of a type in the return from a function call, so directly extending the behavior of the <code>myStruct</code> struct is not possible in your \"decorator\" function as written.</p>\n\n<blockquote>\n  <p>I am actually using this decorator to wrap <code>fmt.Sprintf</code>, <code>Sprintln</code>, <code>Sprint</code> method to get <code>Logger.Debugln</code>, <code>Logger.Debugf</code>, <code>Logger.Warning</code>, ... methods, where <code>Logger</code> is a self-defined struct, since these functions shares almost the same behavior.</p>\n</blockquote>\n\n<p>You also will not be able to pass around the <code>fmt.Sprintf</code>, <code>fmt.Sprintln</code> and <code>fmt.Sprint</code> functions in a generic way, as they share different signatures:</p>\n\n<pre><code>func Print(a ...interface{}) (n int, err error)\nfunc Printf(format string, a ...interface{}) (n int, err error)\nfunc Println(a ...interface{}) (n int, err error)\n</code></pre>\n\n<p>so you will need to wrap these methods separately.</p>\n\n<p>It isn't entirely clear to me how you are seeking to wrap those methods to produce your <code>Logger</code> type.</p>\n\n<p>If you require each of those methods at the top level of your logger, they will need to be explicitly declared in your logging package or on your <code>Logger</code> type's interface. You cannot dynamically bind each level function at runtime, despite their obvious similarities; go is a statically-typed language so your types must be declared upfront.</p>\n\n<p>Defining the types explicitly will be the clearest solution, which is also in keeping with a key <a href=\"https://go-proverbs.github.io/\" rel=\"nofollow noreferrer\">go proverb</a>: <a href=\"https://www.youtube.com/watch?reload=9&amp;v=PAAkCSZUG1c&amp;t=14m35s\" rel=\"nofollow noreferrer\">\"Clear is better than clever.\"</a></p>\n\n<p>If necessary, you can declare each method as a simple wrapper of an internal method on your type which actually performs the printing logic, keeping repetition to a minimum.</p>\n\n<p>Here's a quick example I threw together to show the logic for some <code>Debug</code>, <code>Debugf</code> and <code>Debugln</code> endpoints. You can see the core logic is handled by a generic set of methods on the <code>Logger</code> type, and you can imagine how endpoints for other log levels could be trivially implemented.</p>\n\n<p>If repetition is <em>really</em> a problem, you could trivially write a code generator to automatically generate the log-level specific methods, calling on the core functionality explicitly declared in the various print functions. Remember you can declare receivers for a type in multiple source files in the same package, allowing some methods to be generated in some source files while others are implemented explicitly elsewhere.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\ntype Level string\n\nconst (\n    Debug Level = \"DEBUG\"\n    Error       = \"ERROR\"\n\n// etc.\n)\n\ntype Logger struct {\n    writer       io.Writer\n    prependLevel bool\n}\n\nfunc (l *Logger) print(level Level, msg string) {\n    var s string\n    if l.prependLevel {\n        s = string(level) + \": \"\n    }\n    s += msg\n    fmt.Fprint(l.writer, s)\n}\n\nfunc (l *Logger) printf(level Level, format string, a ...interface{}) {\n    l.print(level, fmt.Sprintf(format, a...))\n}\n\nfunc (l *Logger) println(level Level, msg string) {\n    l.printf(level, \"%s\\n\", msg)\n}\n\nfunc (l *Logger) Debug(msg string) {\n    l.print(Debug, msg)\n}\n\nfunc (l *Logger) Debugf(format string, a ...interface{}) {\n    l.printf(Debug, format, a...)\n}\n\nfunc (l *Logger) Debugln(msg string) {\n    l.println(Debug, msg)\n}\n\nfunc main() {\n    logger := Logger{os.Stderr, true}\n    logger.Debugln(\"A plain message with a new line\")\n    logger.Debugf(\n        (\"The most customizable log entry with some parameters: \" +\n            \"%s %v\\n\"),\n        \"myStr\", false,\n    )\n    logger.Debug(\"A bare print statement\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Bf_yQdtF8b2\" rel=\"nofollow noreferrer\">Playground link.</a></p>\n\n<hr>\n\n<h1>Third-party packages</h1>\n\n<p>In case you haven't yet done so, there are many third-party logging packages in Go which I would recommend considering, or at least assessing their interfaces to determine how others have approached similar tasks.</p>\n\n<p>Logrus is a Go logger with levels, for example. You can see in their source files how they explicitly declare their interface for each function at each log level, while using a more comprehensive version of the method above to reduce repetition in the core logging implementation: <a href=\"https://github.com/sirupsen/logrus/blob/3791101e143bf0f32515ac23e831475684f61229/logrus.go#L112-L150\" rel=\"nofollow noreferrer\">Interface</a> <a href=\"https://github.com/sirupsen/logrus/blob/3791101e143bf0f32515ac23e831475684f61229/entry.go#L199-L244\" rel=\"nofollow noreferrer\">Formatter implementations</a></p>\n"}], "owner": {"reputation": 13, "user_id": 10322518, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SRuXsXUVnN4/AAAAAAAAAAI/AAAAAAAAAAc/b3lDZLzZeUI/photo.jpg?sz=128", "display_name": "Jacky Wang", "link": "https://stackoverflow.com/users/10322518/jacky-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1588, "favorite_count": 0, "accepted_answer_id": 52194728, "answer_count": 1, "score": 1, "last_activity_date": 1536191561, "creation_date": 1536185906, "last_edit_date": 1536187221, "question_id": 52194070, "link": "https://stackoverflow.com/questions/52194070/return-a-function-with-receiver-in-golang", "title": "Return a function with receiver in Golang", "body": "<p>I am new to Golang. And I am trying to use a decorator which returns a function with a receiver. How can I do that?</p>\n\n<pre><code>type myStruct struct {\n    s string\n}\n\nfunc myFunc(s string) {\n    fmt.Println(s)\n}\n\n// Here I want to return a function with a receiver\nfunc (*myStruct) myDecorator(fn func(string)) (*myStruct)func(string){\n    return (ms *myStruct)func(s string) {\n        fn(ms+s)\n    }\n}\n\nfunc main() {\n    ms := myStruct{\"Hello\"}\n    // Some func is function with receiver as myStruct pointer\n    someFunc := myDecorator(myFunc)\n    // This is expected to print \"Hello world\"\n    ms.someFunc(\" world\")\n}\n</code></pre>\n"}, {"tags": ["go", "godeps"], "comments": [{"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1536194281, "post_id": 52194050, "comment_id": 91339559, "body": "@MartinTournoij I just assume that the issue is that I have to give some sort of flag to look in the vendor/ folder for deps."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1536194432, "post_id": 52194050, "comment_id": 91339580, "body": "No, you don&#39;t. The error output should actually says it&#39;s looking in the vendor directory (the part that you omitted)."}], "answers": [{"tags": [], "owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "is_accepted": false, "score": 1, "last_activity_date": 1536208229, "creation_date": 1536208229, "answer_id": 52196527, "question_id": 52194050, "link": "https://stackoverflow.com/questions/52194050/how-to-tell-my-go-build-to-look-in-the-vendor-folder-for-the-godep-libraries/52196527#52196527", "title": "How to tell my go build to look in the vendor folder for the godep libraries?", "body": "<p>The <code>vendor</code> directory does not function as expected if your source code lies outside of <code>GOPATH</code> (see <a href=\"https://github.com/golang/go/issues/14566\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/14566</a>). In the current <code>golang:latest</code> Docker image, <code>GOPATH</code> is set to <code>/go</code> so the simplest solution would be to copy your code into a subdirectory of <code>/go/src</code> and build from there.</p>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1464, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1536208229, "creation_date": 1536185756, "question_id": 52194050, "link": "https://stackoverflow.com/questions/52194050/how-to-tell-my-go-build-to-look-in-the-vendor-folder-for-the-godep-libraries", "title": "How to tell my go build to look in the vendor folder for the godep libraries?", "body": "<p>I have a simple Dockerfile that I am trying to build and run my Go REST API server.</p>\n\n<p>My Dockerfile so far is:  </p>\n\n<pre><code>FROM golang:latest\nRUN mkdir /app\nADD . /app/\nWORKDIR /app\nRUN go build -o main .\nCMD [\"/app/main\"]\n</code></pre>\n\n<p>When I run docker-compose up I get this error:</p>\n\n<pre><code>main.go:12:2: cannot find package \"github.com/bradfitz/gomemcache/memcache\" in any of:\n</code></pre>\n\n<p>I am using godeps and my vendor folder has all the libraries vendored, why isn't the build working in this case?</p>\n\n<p>Do I have to tell it to look in the vendor folder?</p>\n"}, {"tags": ["templates", "go", "go-templates"], "comments": [{"owner": {"reputation": 194, "user_id": 10322433, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ouTTb.png?s=128&g=1", "display_name": "blueheart", "link": "https://stackoverflow.com/users/10322433/blueheart"}, "edited": false, "score": 1, "creation_date": 1536186264, "post_id": 52193783, "comment_id": 91337994, "body": "I think it&#39;s pretty much the same issue here. &lt;<a href=\"https://stackoverflow.com/questions/10408646/how-to-import-and-use-different-packages-of-the-same-name-in-go-language\" title=\"how to import and use different packages of the same name in go language\">stackoverflow.com/questions/10408646/&hellip;</a>&gt;"}], "answers": [{"comments": [{"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "edited": false, "score": 0, "creation_date": 1536187204, "post_id": 52194133, "comment_id": 91338224, "body": "That&#39;s perfect! Thank you"}], "tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": true, "score": 7, "last_activity_date": 1586898717, "last_edit_date": 1586898717, "creation_date": 1536186343, "answer_id": 52194133, "question_id": 52193783, "link": "https://stackoverflow.com/questions/52193783/how-to-use-html-template-and-text-template-at-the-same-time-in-golang/52194133#52194133", "title": "How to use &quot;html/template&quot; and &quot;text/template&quot; at the same time in Golang", "body": "<p>I assume the issue you are facing is the conflicting imports between the identically-named <code>template</code> packages.</p>\n\n<p>In this case, use a named import for one or both packages to access its members via another name in the source file:</p>\n\n<pre><code>package mypackage\n\nimport (\n    htmltemplate \"html/template\"\n    texttemplate \"text/template\"\n)\n</code></pre>\n\n<p>Now write code which refers to the template packages as usual, but use the alias names <code>htmltemplate</code> or <code>texttemplate</code> in place of <code>template</code>.</p>\n"}], "owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 786, "favorite_count": 0, "closed_date": 1536194674, "accepted_answer_id": 52194133, "answer_count": 1, "score": 1, "last_activity_date": 1586898717, "creation_date": 1536183984, "question_id": 52193783, "link": "https://stackoverflow.com/questions/52193783/how-to-use-html-template-and-text-template-at-the-same-time-in-golang", "closed_reason": "Duplicate", "title": "How to use &quot;html/template&quot; and &quot;text/template&quot; at the same time in Golang", "body": "<p>I'm sending emails with Go, and I'm parsing both the subject and the HTML body from templates stored in a database. </p>\n\n<p>For the subject I wouldn't want <code>t.Parse()</code> to escape html entities since it isn't HTML, just plain text, but for the body this is exactly the behavior I want.</p>\n\n<p>How do I do both in the same file?</p>\n"}, {"tags": ["go", "worker-pool"], "answers": [{"tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": true, "score": 4, "last_activity_date": 1536229262, "last_edit_date": 1536229262, "creation_date": 1536184073, "answer_id": 52193805, "question_id": 52193437, "link": "https://stackoverflow.com/questions/52193437/suspend-worker-pool/52193805#52193805", "title": "Suspend worker pool", "body": "<p>If the database synchronization is to be implemented or at least signalled to the binary, you could abuse an <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"nofollow noreferrer\"><code>RWMutex</code></a> for this purpose.</p>\n\n<p>Use the <code>Read</code> side of the mutex when in the worker doing ordinary work, and require the  <code>Write</code> side to be held whenever the database synchronization actions are performed.</p>\n\n<p>Crucially, you must ensure <code>Read</code> is <em>only</em> held when work is actually taking place. If the worker is blocked awaiting more work, the read lock must <em>not</em> be held as this will starve pending writers.</p>\n\n<hr>\n\n<p>If you use this, I strongly recommend adding documentation to your code as to the expected behaviour of the mutex, as this would be somewhat nonstandard in terms of the Read and Write operations.</p>\n\n<p>You could also wrap it and export different methods from your derived interface with better names, if you would like a more general solution, as shown in the example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type WorkerGroupLocker struct {\n    sync.RWMutex\n}\n\nfunc (lock *WorkerGroupLocker) LockWorker() {\n    lock.RLock()\n}\n\nfunc (lock *WorkerGroupLocker) UnlockWorker() {\n    lock.RUnlock()\n}\n\nfunc (lock *WorkerGroupLocker) LockBackgroundSync() {\n    lock.Lock()\n}\n\nfunc (lock *WorkerGroupLocker) UnlockBackgroundSync() {\n    lock.Unlock()\n}\n</code></pre>\n\n<hr>\n\n<p>Any solution must solve these general problems:</p>\n\n<ul>\n<li>Asking all workers to stop working.</li>\n<li>Ensuring all workers have quiesced <em>before</em> the database work is allowed to start.</li>\n<li>Signalling workers that it is safe to continue working again.</li>\n</ul>\n\n<p>Alternative methods for doing so include the following, but in my opinion all of the below will be much more complex (and, therefore, prone to bugs) than using the mutex:</p>\n\n<ul>\n<li><blockquote>\n  <p>Close all the worker ?</p>\n</blockquote>\n\n<p>Asking workers to stop working before the database work goes ahead would achieve the mutual exclusion required. You need a way of signalling them to cease and a mechanism for detecting when this has indeed completed.</p>\n\n<p>One could argue in any event that you need this anyway to ensure you cleanly shutdown on program termination. However, program termination is fatal, so you don't need to be able to cleanly start and stop the pool in the same way as this database sync work would require.</p></li>\n<li><blockquote>\n  <p>Use a chan in the worker to prevent getting a job if suspended ?</p>\n</blockquote>\n\n<p>This would be complex to implement, as you would need to signal all workers to stop working and be assured they have indeed stopped actively processing jobs <em>before</em> starting work. The reverse is also required: a signal to start again.</p></li>\n</ul>\n\n<p>The simplest tool for the job which involves the least code is the mutex. I recommend using that.</p>\n"}], "owner": {"reputation": 220, "user_id": 1897184, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DFHEx.jpg?s=128&g=1", "display_name": "vmathieu", "link": "https://stackoverflow.com/users/1897184/vmathieu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 52193805, "answer_count": 1, "score": 0, "last_activity_date": 1536229262, "creation_date": 1536181911, "question_id": 52193437, "link": "https://stackoverflow.com/questions/52193437/suspend-worker-pool", "title": "Suspend worker pool", "body": "<p>With a golang implementation of worker pool that look like close than <a href=\"https://stackoverflow.com/a/45651488/1897184\">this</a></p>\n\n<p>I want to suspend my workers for few seconds, while doing a database synchronisation like a transaction process. I don't want my sync data being updated by another potential uncontrolled worker.</p>\n\n<p>What is the best way to suspend work ?</p>\n\n<ul>\n<li>Close all the worker ?</li>\n<li>Use a chan in the worker to prevent getting a job if suspended ?</li>\n<li>Use a global flag to setup a lock in each worker before handling job ?</li>\n</ul>\n\n<p>Thanks</p>\n"}, {"tags": ["xml", "parsing", "go", "struct", "slice"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536179977, "post_id": 52192985, "comment_id": 91335894, "body": "Do it the same way you did with <code>info</code>: an array of objects to receive the <code>member</code> elements, with those objects having a field to receive the <code>ref</code> attribute."}, {"owner": {"reputation": 127, "user_id": 7773959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f56a0e8721b91e43faa42e2f0d169143?s=128&d=identicon&r=PG&f=1", "display_name": "Max Mikhalchuk", "link": "https://stackoverflow.com/users/7773959/max-mikhalchuk"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536180722, "post_id": 52192985, "comment_id": 91336181, "body": "@Adrian Yea, I know about that. The problem is my database structure requires me to keep it like an array of strings, but not like an array of objects. I know that I can just then iterate through an array of objects and form an array of strings, but in my case it&#39;s not the best option (I have around 6,000,000,000 xml documents, so I need to have good speed)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1536185181, "post_id": 52192985, "comment_id": 91337704, "body": "In terms of performance, iterating a slice of strings is pretty negligible compared to parsing the XML into a struct in the first place."}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 0, "last_activity_date": 1536250528, "last_edit_date": 1536250528, "creation_date": 1536244974, "answer_id": 52206672, "question_id": 52192985, "link": "https://stackoverflow.com/questions/52192985/parse-xml-to-struct-containing-slice/52206672#52206672", "title": "Parse XML to struct containing slice", "body": "<p>Unfortunately there is no way to use the default XML unmarshaler to achieve your goal by using only struct field tags so you'll have to either:</p>\n\n<ol>\n<li>Extract a struct type for the \"Members\" field which has a \"ref\" field (similar to the \"Info\" type).</li>\n<li>Use a custom type for \"Member\" which is a string and implements <a href=\"https://golang.org/pkg/encoding/xml/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>xml.Unmarshaler</code></a> by extracting the value of the \"ref\" attribute from the associated XML element.</li>\n</ol>\n\n<p>Here is an example of how you can implement strategy #2 above (<a href=\"https://play.golang.com/p/M82C0ViugSd\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>type Group struct {\n  Id      string      `xml:\"id,attr\"`\n  Members []MemberRef `xml:\"member\"`\n  Info    []Info      `xml:\"info\"`\n}\n\ntype MemberRef string\n\nfunc (m *MemberRef) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n  *m = MemberRef(start.Attr[0].Value) // Assume only the \"ref\" attribute exists.\n  _, err := d.Token() // Consume and discard the synthetic xml.EndElement.\n  return err\n}\n\n// ...\nvar group Group\nerr := xml.Unmarshal([]byte(xmlstr), &amp;group)\nif err != nil {\n    panic(err)\n}\nfmt.Printf(\"%#v\\n\", group)\n// main.Group{Id:\"26659127\", Members:[]main.MemberRef{\"292403538\", \"298884289\", \"261728686\"}, Info:...\n</code></pre>\n\n<p>Note that you can even marshal this struct directly into the example JSON format you listed:</p>\n\n<pre><code>bs, err := json.MarshalIndent(group, \"\", \"  \")\nif err != nil {\n    panic(err)\n}\nfmt.Println(string(bs))\n// {\n//   \"Id\": \"26659127\",\n//   \"Members\": [\n//     \"292403538\",\n//     \"298884289\",\n//     \"261728686\"\n//   ],\n//   \"Info\": [\n//     ...\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 7773959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f56a0e8721b91e43faa42e2f0d169143?s=128&d=identicon&r=PG&f=1", "display_name": "Max Mikhalchuk", "link": "https://stackoverflow.com/users/7773959/max-mikhalchuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 52206672, "answer_count": 1, "score": 1, "last_activity_date": 1536250528, "creation_date": 1536179466, "question_id": 52192985, "link": "https://stackoverflow.com/questions/52192985/parse-xml-to-struct-containing-slice", "title": "Parse XML to struct containing slice", "body": "<h2>Situation:</h2>\n\n<p>I have this XML structure:</p>\n\n<pre><code>&lt;group id=\"26659127\"&gt;\n    &lt;member ref=\"292403538\"/&gt;\n    &lt;member ref=\"298884289\"/&gt;\n    &lt;member ref=\"261728686\"/&gt;\n    &lt;info k=\"name\" v=\"omega\"/&gt;\n    &lt;info k=\"rank\" v=\"16\"/&gt;\n&lt;/group&gt;\n</code></pre>\n\n<p>I need to convert this XML into this struct:</p>\n\n<pre><code>{\n    Id: \"26659127\",\n    Members: [\"26659127\", \"298884289\", \"261728686\"],\n    Info: [\n        {\n            Key: \"name\",\n            Value: \"omega\"\n        },\n        {\n            Key: \"rank\",\n            Value: \"16\"\n        }\n    ]\n}\n</code></pre>\n\n<h2>Problem:</h2>\n\n<p>I created a struct for parsing XML already:</p>\n\n<pre><code>type Group struct {\n    Id      string   `xml:\"id,attr\"`\n    Members []string `xml:\" \"`\n    Info    []Info   `xml:\"info\"`\n}\n\ntype Info struct {\n    Key     string   `xml:\"k,attr\"`\n    Value   string   `xml:\"v,attr\"`\n}\n</code></pre>\n\n<p>But, as you can see I haven't defined an expression for <code>Members</code> yet. Actually, I tried putting <code>xml:\"member,ref,attr\"</code> and <code>xml:\"member:ref,attr\"</code> in here, but it didn't work.</p>\n\n<h2>Question:</h2>\n\n<p>Is there a possibility to solve this issue? If yes, what expression I should use?</p>\n"}, {"tags": ["go", "aws-lambda", "aws-api-gateway", "aws-lambda-go"], "answers": [{"comments": [{"owner": {"reputation": 901, "user_id": 1922287, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/fafa15e29be87252bac078ac6a2a12f7?s=128&d=identicon&r=PG", "display_name": "laurids", "link": "https://stackoverflow.com/users/1922287/laurids"}, "edited": false, "score": 1, "creation_date": 1560182750, "post_id": 52192917, "comment_id": 99643026, "body": "Thank you, this really saved me from a headache :) The only downside is taking an <code>events.APIGatewayProxyRequest</code> as an input means writing pure json for the AWS Console &quot;Test&quot; functionality doesn&#39;t work anymore - I guess I need to wrap the request somehow, have you found a way around that?"}], "tags": [], "owner": {"reputation": 612, "user_id": 3794552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fb26e1ff41790c84b43636b09af508e?s=128&d=identicon&r=PG&f=1", "display_name": "Bimde", "link": "https://stackoverflow.com/users/3794552/bimde"}, "is_accepted": true, "score": 9, "last_activity_date": 1536179088, "creation_date": 1536179088, "answer_id": 52192917, "question_id": 52192916, "link": "https://stackoverflow.com/questions/52192916/aws-lambda-go-function-not-getting-request-body-when-called-via-api-gw/52192917#52192917", "title": "AWS Lambda Go function not getting request body when called via API GW", "body": "<p>Turns out, even though I wasn't able to find any documentation on this on a user-facing website, documentation does exist. Read this: <a href=\"https://github.com/aws/aws-lambda-go/blob/master/events/README_ApiGatewayEvent.md\" rel=\"noreferrer\">https://github.com/aws/aws-lambda-go/blob/master/events/README_ApiGatewayEvent.md</a></p>\n\n<p>Here's the simplest way I've figured out so far to receive data from and respond to a request from API GW:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"encoding/json\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n    \"github.com/aws/aws-lambda-go/events\"\n    \"log\"\n)\n\ntype myReturn struct {\n    Response string `json:\"response\"`\n}\n\nfunc handle(ctx context.Context, name events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {\n    log.Print(\"Request body: \", name)\n    log.Print(\"context \", ctx)\n    headers := map[string]string{\"Access-Control-Allow-Origin\": \"*\", \"Access-Control-Allow-Headers\": \"Origin, X-Requested-With, Content-Type, Accept\"}\n\n    code := 200\n    response, error := json.Marshal(myReturn{Response:\"Hello, \" + name.Body})\n    if error != nil {\n        log.Println(error)\n        response = []byte(\"Internal Server Error\")\n        code = 500\n    }\n\n    return events.APIGatewayProxyResponse {code, headers, string(response), false}, nil\n}\n\nfunc main() {\n    lambda.Start(handle)\n}\n</code></pre>\n\n<p>In this case, the <code>log.Print(\"Request body: \", name)</code> line results in the exact request body being logged. Problem solved.</p>\n\n<p>Note: Also I didn't have to create that <code>APIGWResponse</code> object from the question, the <code>events.APIGatewayProxyResponse</code> is the exact same thing, already made for you. These objects are all inside this class: <a href=\"https://github.com/aws/aws-lambda-go/blob/master/events/apigw.go\" rel=\"noreferrer\">https://github.com/aws/aws-lambda-go/blob/master/events/apigw.go</a></p>\n"}], "owner": {"reputation": 612, "user_id": 3794552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fb26e1ff41790c84b43636b09af508e?s=128&d=identicon&r=PG&f=1", "display_name": "Bimde", "link": "https://stackoverflow.com/users/3794552/bimde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5059, "favorite_count": 1, "accepted_answer_id": 52192917, "answer_count": 1, "score": 8, "last_activity_date": 1570492678, "creation_date": 1536179088, "last_edit_date": 1555436698, "question_id": 52192916, "link": "https://stackoverflow.com/questions/52192916/aws-lambda-go-function-not-getting-request-body-when-called-via-api-gw", "title": "AWS Lambda Go function not getting request body when called via API GW", "body": "<p>First off, one might say this question is very similar to <a href=\"https://stackoverflow.com/questions/41059440/http-request-body-not-getting-to-aws-lambda-function-via-aws-api-gateway\">HTTP request body not getting to AWS lambda function via AWS API Gateway</a> or <a href=\"https://stackoverflow.com/questions/41648467/getting-json-body-in-aws-lambda-via-api-gateway\">Getting json body in aws Lambda via API gateway</a></p>\n\n<p>However, none of these questions address using Golang, and the problem I have been having is finding an equivalent of the <code>event</code> parameter used everywhere in the Node.js documentation.</p>\n\n<p>Here's my Lambda Function: </p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"encoding/json\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n    \"github.com/aws/aws-lambda-go/events\"\n    \"log\"\n)\n\ntype MyReturn struct {\n    Response string `json:\"response\"`\n}\n\ntype APIGWResponse struct {\n    IsBase64Encoded bool              `json:\"isBase64Encoded\"`\n    StatusCode      int               `json:\"statusCode\"`\n    Headers         map[string]string `json:\"headers\"`\n    Body            string            `json:\"body\"`\n}\n\nfunc handle(ctx context.Context, name MyReturn) (APIGWResponse, error) {\n    log.Print(\"Called by \", name)\n    log.Print(\"context \", ctx)\n    headers := map[string]string{\"Access-Control-Allow-Origin\": \"*\", \"Access-Control-Allow-Headers\": \"Origin, X-Requested-With, Content-Type, Accept\"}\n\n    code := 200\n    response, error := json.Marshal(myReturn{Response:\"Hello, \" + name.Body})\n    if error != nil {\n        log.Println(error)\n        response = []byte(\"Internal Server Error\")\n        code = 500\n    }\n\n    return APIGWResponse{true, code, headers, string(response)}, nil\n}\n\nfunc main() {\n    lambda.Start(handle)\n}\n</code></pre>\n\n<p>Problem: the <code>MyReturn</code> object is not being filled with any value when called from API GW. The line <code>log.Print(\"Called by \", name)</code> results in nothing being appended to the <code>Called by</code> string.</p>\n\n<p>Request to API GW:</p>\n\n<pre><code> POST -&gt; body: '{\"name\":\"Bob\"}', headers: {'Content-Type': 'application/json'}\n</code></pre>\n\n<p>This is being performed in pure JS as follows: </p>\n\n<pre><code>const BASE_URL = \"https://my_api_id.execute-api.us-east-1.amazonaws.com/prod/\";\nconst TRIGGER_URL = \"my_lambda_function\";\n\nfunction toGW() {\n    fetch(BASE_URL + TRIGGER_URL, {\n        method: 'POST',\n        body: '{\"name\":\"Bimesh\"}',\n        headers:{\n            'Content-Type': 'application/json'\n        }\n    })\n    .then(data =&gt; data.json())\n    .then(json =&gt; console.log(json))\n    .catch(error =&gt; console.log(error));\n}\n</code></pre>\n\n<p>And yet, the exact same body works when testing it from the AWS Lambda console. </p>\n\n<p>Body: </p>\n\n<pre><code>{\"name\":\"Bob\"}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "edited": false, "score": 0, "creation_date": 1536177053, "post_id": 52192452, "comment_id": 91334693, "body": "when I run <code>gometalinter --vendor</code> on my root project I got nothing ..."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1536176895, "creation_date": 1536176895, "answer_id": 52192452, "question_id": 52192402, "link": "https://stackoverflow.com/questions/52192402/how-to-inspect-golang-code-and-ignore-vendor-library/52192452#52192452", "title": "how to inspect golang code and ignore vendor library", "body": "<p>Per <code>gometalinter --help</code>:</p>\n\n<pre><code>  --vendor                 Enable vendoring support (skips 'vendor' directories and sets GO15VENDOREXPERIMENT=1).\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 52192452, "answer_count": 1, "score": -2, "last_activity_date": 1536176895, "creation_date": 1536176657, "question_id": 52192402, "link": "https://stackoverflow.com/questions/52192402/how-to-inspect-golang-code-and-ignore-vendor-library", "title": "how to inspect golang code and ignore vendor library", "body": "<p>I want to use gometalinter on my local project, the problem is when I run it like <code>gometalinter ./...</code> its inspect also the <code>vendor</code> folder which I want to ignore, I try to find somthing and find this\n<code>gometalinter ./... -excludepkg ./vendor...</code> which doesnt help, also the <strong>vendor</strong> lib is inspected, any idea how to avoid it ?</p>\n"}, {"tags": ["json", "go", "types", "interface", "hashmap"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1536175338, "post_id": 52192069, "comment_id": 91333945, "body": "Please post a sample map and the format of json you want to create. Add more code to recreate the issue."}, {"owner": {"reputation": 3266, "user_id": 5179478, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/P2K06.jpg?s=128&g=1", "display_name": "ceckenrode", "link": "https://stackoverflow.com/users/5179478/ceckenrode"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1536175533, "post_id": 52192069, "comment_id": 91334028, "body": "Added, though I think I&#39;m just stuck on the nested arrays. Thanks!"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1536175716, "post_id": 52192069, "comment_id": 91334105, "body": "How you are getting this data that you are saving to variable of map type. Show the variable data you are getting."}, {"owner": {"reputation": 3266, "user_id": 5179478, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/P2K06.jpg?s=128&g=1", "display_name": "ceckenrode", "link": "https://stackoverflow.com/users/5179478/ceckenrode"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1536175937, "post_id": 52192069, "comment_id": 91334205, "body": "It&#39;s not coming from an API or anywhere externally, I need to manually create it to pass in as configuration for another library."}], "answers": [{"comments": [{"owner": {"reputation": 3266, "user_id": 5179478, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/P2K06.jpg?s=128&g=1", "display_name": "ceckenrode", "link": "https://stackoverflow.com/users/5179478/ceckenrode"}, "edited": false, "score": 0, "creation_date": 1536175816, "post_id": 52192190, "comment_id": 91334151, "body": "Ahh so an approach would be to define the nested types beforehand. Makes sense! Thanks!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536175827, "post_id": 52192190, "comment_id": 91334156, "body": "This answer is correct, but doesn&#39;t attempt to explain <i>why</i> it&#39;s correct."}], "tags": [], "owner": {"reputation": 2312, "user_id": 3254692, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/pg8j6.jpg?s=128&g=1", "display_name": "Omar Faroque Anik", "link": "https://stackoverflow.com/users/3254692/omar-faroque-anik"}, "is_accepted": false, "score": 6, "last_activity_date": 1549807934, "last_edit_date": 1549807934, "creation_date": 1536175727, "answer_id": 52192190, "question_id": 52192069, "link": "https://stackoverflow.com/questions/52192069/how-can-i-type-an-array-of-mixed-types-in-golang/52192190#52192190", "title": "How can I type an array of mixed types in golang?", "body": "<p>Here is a basic example of doing it: </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n  primes := [6]int {2, 3, 5, 7, 11, 13}\n  mixed := []interface{} {\"foo\", 10, primes }\n  //fmt.Println(mixed...)\n\n  test := map[string]interface{} {\n    \"omar\":mixed,\n  }\n\n  fmt.Println(test[\"omar\"])\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3266, "user_id": 5179478, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/P2K06.jpg?s=128&g=1", "display_name": "ceckenrode", "link": "https://stackoverflow.com/users/5179478/ceckenrode"}, "edited": false, "score": 0, "creation_date": 1536176022, "post_id": 52192195, "comment_id": 91334241, "body": "Thanks for explaining! The inline approach is a little closer to what I was getting at. I think this is the best answer, thanks!"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1536175756, "creation_date": 1536175756, "answer_id": 52192195, "question_id": 52192069, "link": "https://stackoverflow.com/questions/52192069/how-can-i-type-an-array-of-mixed-types-in-golang/52192195#52192195", "title": "How can I type an array of mixed types in golang?", "body": "<p>Slice/array/map literals all work the same way, <a href=\"https://tour.golang.org/moretypes/20\" rel=\"nofollow noreferrer\">as explained in the tour</a> - each value literal just needs the type specified when the containing type doesn't already specify the type (i.e. a map/slice/array of an interface type), and every list of values is enclosed in braces <code>{}</code>, not brackets <code>[]</code> as in JSON:</p>\n\n<pre><code>   \"req\": []interface{}{[]interface{}{[]interface{}{0, \"all\", []interface{}{0}}}},\n</code></pre>\n\n<p>Note that the last element could also be written as <code>[]int{0}</code>.</p>\n"}], "owner": {"reputation": 3266, "user_id": 5179478, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/P2K06.jpg?s=128&g=1", "display_name": "ceckenrode", "link": "https://stackoverflow.com/users/5179478/ceckenrode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4419, "favorite_count": 1, "accepted_answer_id": 52192195, "answer_count": 2, "score": 2, "last_activity_date": 1549807934, "creation_date": 1536175193, "last_edit_date": 1536175484, "question_id": 52192069, "link": "https://stackoverflow.com/questions/52192069/how-can-i-type-an-array-of-mixed-types-in-golang", "title": "How can I type an array of mixed types in golang?", "body": "<p>I'm writing out a map which I need to convert to JSON, and one of the required values is an array of mixed type.</p>\n\n<pre><code>var models = map[string]interface{} {\n   ...\n   \"req\": [[0, \"all\", [0]]],\n   ...\n}\n</code></pre>\n\n<p>Is there a way to assign a type to this nested array? Or is there a better approach for creating this JSON than a map?</p>\n\n<p><strong>Edit:</strong> Getting closer I think, unsure what to do about the nested arrays </p>\n\n<pre><code>var models = map[string]interface{} {\n       ...\n       \"req\": []interface{}{[[0, \"all\", [0]]]},\n       ...\n    }\n</code></pre>\n\n<p><strong>Edit:</strong> The entire JSON I'm looking to create, I'm just stuck on the \"req\" key, but since it was requested:</p>\n\n<pre><code>{\n    1388596687391: {\n      veArs: [],\n      name: 'Basic-f15d2',\n      tags: ['Tag'],\n      did: 1435588830424,\n      usn: -1,\n      req: [[0, 'all', [0]]],\n      flds: [\n        {\n          name: 'Front',\n          media: [],\n          sticky: false,\n          rtl: false,\n          ord: 0,\n          font: 'Arial',\n          size: 20\n        },\n        {\n          name: 'Back',\n          media: [],\n          sticky: false,\n          rtl: false,\n          ord: 1,\n          font: 'Arial',\n          size: 20\n        }\n      ],\n      sortf: 0,\n      latexPre:\n        '\\\\documentclass[12pt]{article}\\n\\\\special{papersize=3in,5in}\\n\\\\usepackage[utf8]{inputenc}\\n\\\\usepackage{amssymb,amsmath}\\n\\\\pagestyle{empty}\\n\\\\setlength{\\\\parindent}{0in}\\n\\\\begin{document}\\n',\n      tmpls: [\n        {\n          name: 'Card 1',\n          qfmt: questionFormat,\n          did: null,\n          bafmt: '',\n          afmt: answerFormat,\n          ord: 0,\n          bqfmt: ''\n        }\n      ],\n      latexPost: '\\\\end{document}',\n      type: 0,\n      id: 1388596687391,\n      css,\n      mod: 1435645658\n    }\n  }\n</code></pre>\n"}, {"tags": ["file", "http", "go", "gorilla", "fileserver"], "answers": [{"comments": [{"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1536177341, "post_id": 52192329, "comment_id": 91334811, "body": "So dir doesn&#39;t work ~ <code>r.PathPrefix(&quot;&#47;files&#47;&quot;).Handler(http.StripPrefix(&quot;&#47;files&#47;&quot;,  \thttp.FileServer(http.Dir(dir))))</code> results in <code>.&#47;main.go:123: undefined: dir</code>. As far as I can tell dir is not a reserved word. I&#39;ll look into making a call through postman and see what happens. EDIT: oic - dir simply === &#39;.&#39;. Hmmm....."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1536177647, "post_id": 52192329, "comment_id": 91334940, "body": "<code>dir</code> is a flag, so don&#39;t elide part of my example code. It defaults to the current directory - <code>.</code> - but is overridden when you pass the flag, as I did in my example."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1536177749, "post_id": 52192329, "comment_id": 91334994, "body": "ooooohhhhhhhhhhh that makes sense."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1536178105, "post_id": 52192329, "comment_id": 91335146, "body": "So, if I use <code>r.PathPrefix(&quot;&#47;files&#47;&quot;).Handler(http.StripPrefix(&quot;&#47;files&#47;&quot;,  http.FileServer(http.Dir(&quot;&#47;go&#47;src&#47;github.com&#47;patientplatypus&zwnj;&#8203;&#47;webserver&#47;files&#47;&quot;))&zwnj;&#8203;))</code> and postman <code>http:&#47;&#47;localhost:8000&#47;files&#47;blah.txt</code> where <code>blah.txt</code> exists, I get <code>200OK</code> with no body. If I do the same with <code>blah2.txt</code> where <code>blah2.txt</code> <i>doesn&#39;t exist</i> I get the same. Something seems very wrong. (<code>blah.txt</code> has some <code>helloworld</code> in it btw)."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1536178663, "post_id": 52192329, "comment_id": 91335365, "body": "My suggestion: clean up your post. Remove the JavaScript part. Focus on the Go piece, and lay out a minimal example that someone can copy paste and run. You haven&#39;t done that yet, so there&#39;s something else in the mix here - another route, perhaps?"}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1536178694, "post_id": 52192329, "comment_id": 91335378, "body": "And the results of a curl request on both <code>blah.txt</code> and <code>blah2.txt</code> confirm that the content length in both cases is 0, as well as <code>test.jpg</code>. All of them also appear to be trying to return a content type of text which is very strange. <a href=\"https://gist.github.com/patientplatypus/54e4077dd251afb5a587bb38063bfaaf\" rel=\"nofollow noreferrer\">gist.github.com/patientplatypus/&hellip;</a>."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": false, "score": 1, "last_activity_date": 1536176306, "creation_date": 1536176306, "answer_id": 52192329, "question_id": 52191541, "link": "https://stackoverflow.com/questions/52191541/gorilla-golang-pathprefix-not-serving-files/52192329#52192329", "title": "Gorilla Golang Pathprefix not serving files", "body": "<p>Can you eliminate the JavaScript client from this, and make a simple <code>curl</code> request? Replace the image with a simple text file to remove any possible Content-Type / MIME detection issues.</p>\n\n<p>(Slightly) adapting the example posted in the <code>gorilla/mux</code> docs: <a href=\"https://github.com/gorilla/mux#static-files\" rel=\"nofollow noreferrer\">https://github.com/gorilla/mux#static-files</a></p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>func main() {\n    var dir string\n\n    flag.StringVar(&amp;dir, \"dir\", \".\", \"the directory to serve files from. Defaults to the current dir\")\n    flag.Parse()\n    r := mux.NewRouter()\n\n    r.PathPrefix(\"/files/\").Handler(\n        http.StripPrefix(\"/files/\",\n            http.FileServer(\n                http.Dir(dir),\n            ),\n        ),\n    )\n\n    addr := \"127.0.0.1:8000\"\n    srv := &amp;http.Server{\n        Handler:      r,\n        Addr:         addr,\n        WriteTimeout: 15 * time.Second,\n        ReadTimeout:  15 * time.Second,\n    }\n\n    log.Printf(\"listening on %s\", addr)\n    log.Fatal(srv.ListenAndServe())\n}\n</code></pre>\n\n<p><strong>Running the Server</strong></p>\n\n<pre><code>\u279c  /mnt/c/Users/matt/Dropbox  go run static.go -dir=\"/home/matt/go/src/github.com/gorilla/mux\"\n2018/09/05 12:31:28 listening on 127.0.0.1:8000\n</code></pre>\n\n<p><strong>Getting a file</strong></p>\n\n<pre><code>\u279c  ~  curl -sv localhost:8000/files/mux.go | head\n*   Trying 127.0.0.1...\n* Connected to localhost (127.0.0.1) port 8000 (#0)\n&gt; GET /files/mux.go HTTP/1.1\n&gt; Host: localhost:8000\n&gt; User-Agent: curl/7.47.0\n&gt; Accept: */*\n&gt;\n&lt; HTTP/1.1 200 OK\n&lt; Accept-Ranges: bytes\n&lt; Content-Length: 17473\n&lt; Content-Type: text/plain; charset=utf-8\n&lt; Last-Modified: Mon, 03 Sep 2018 14:33:19 GMT\n&lt; Date: Wed, 05 Sep 2018 19:34:13 GMT\n&lt;\n{ [16384 bytes data]\n* Connection #0 to host localhost left intact\n// Copyright 2012 The Gorilla Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style\n// license that can be found in the LICENSE file.\n\npackage mux\n\nimport (\n        \"errors\"\n        \"fmt\"\n        \"net/http\"\n</code></pre>\n\n<hr>\n\n<p>Note that the \"correct\" way to achieve this is as per your first example:</p>\n\n<pre><code>r.PathPrefix(\"/files/\").Handler(http.StripPrefix(\"/files/\", \nhttp.FileServer(http.Dir(\"/go/src/github.com/patientplatypus/webserver/files/\"))))\n</code></pre>\n\n<ul>\n<li>Strip the <code>/files/</code> prefix from the path, so that the file-server doesn't attempt to find <code>/files/go/src/...</code> instead.</li>\n<li>Ensure that <code>/go/src/...</code> is correct - you are providing an absolute path from the root of your filesystem, NOT from your home directory (is this your intent?)</li>\n<li>If that is your intent, make sure that <code>/go/src/...</code> is readable by the user your application is running as.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 76, "user_id": 2014640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/231f12584c6c45ca62a176ba332eaca0?s=128&d=identicon&r=PG", "display_name": "John Murphy", "link": "https://stackoverflow.com/users/2014640/john-murphy"}, "is_accepted": false, "score": 0, "last_activity_date": 1536179355, "creation_date": 1536179355, "answer_id": 52192957, "question_id": 52191541, "link": "https://stackoverflow.com/questions/52191541/gorilla-golang-pathprefix-not-serving-files/52192957#52192957", "title": "Gorilla Golang Pathprefix not serving files", "body": "<p>I usually just bundle file assets into my compiled application. Then the application will run and retrieve assets the same way whether you run in a container or locally.  Here's <a href=\"https://www.thepolyglotdeveloper.com/2017/03/bundle-html-css-javascript-served-golang-application/\" rel=\"nofollow noreferrer\">a link</a> to one approach.  I've used go-bindata in the past but it appears as if this package is no longer maintained but there are many <a href=\"https://tech.townsourced.com/post/embedding-static-files-in-go/\" rel=\"nofollow noreferrer\">alternatives available</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1536200062, "post_id": 52193112, "comment_id": 91340690, "body": "You should do <a href=\"https://stackoverflow.com/questions/52191541/gorilla-golang-pathprefix-not-serving-files#comment91335365_52192329\">what @elithrar suggested</a>."}], "tags": [], "owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "is_accepted": false, "score": 0, "last_activity_date": 1536180097, "creation_date": 1536180097, "answer_id": 52193112, "question_id": 52191541, "link": "https://stackoverflow.com/questions/52191541/gorilla-golang-pathprefix-not-serving-files/52193112#52193112", "title": "Gorilla Golang Pathprefix not serving files", "body": "<p>So, this is not a great solution, but it works (for the moment). I saw this post: <a href=\"https://stackoverflow.com/questions/28793619/golang-what-to-use-http-servefile-or-http-fileserver\">Golang. What to use? http.ServeFile(..) or http.FileServer(..)?</a>, and apparently you can use the lower level api <code>servefile</code> rather than fileserver which has added protections.</p>\n\n<p>So I can use </p>\n\n<p><code>r.HandleFunc(\"/files/{filename}\", util.ServeFiles)</code></p>\n\n<p>and </p>\n\n<pre><code>func ServeFiles(w http.ResponseWriter, req *http.Request){\n    fmt.Println(\"inside ServeFiles\")\n    vars := mux.Vars(req)\n    fileloc := \"/go/src/github.com/patientplatypus/webserver/files\"+\"/\"+vars[\"filename\"]\n    http.ServeFile(w, req, fileloc)\n}\n</code></pre>\n\n<p>Again not a great solution and I'm not thrilled - I'll have to pass along some auth stuff in the get request params in order to prevent 1337h4x0rZ. If anyone knows how to get pathprefix up and running please let me know and I can refactor. Thank you everyone who helped!</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12229388, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-t1yl5nwr5V8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcdY8J3cVgm53_JC3ltxzb6oZUPmw/photo.jpg?sz=128", "display_name": "Sine", "link": "https://stackoverflow.com/users/12229388/sine"}, "is_accepted": false, "score": 0, "last_activity_date": 1571271997, "last_edit_date": 1571271997, "creation_date": 1571269759, "answer_id": 58423045, "question_id": 52191541, "link": "https://stackoverflow.com/questions/52191541/gorilla-golang-pathprefix-not-serving-files/58423045#58423045", "title": "Gorilla Golang Pathprefix not serving files", "body": "<p>I am on the exact same page with you, totally same, and I've been investigating this thing to make it work for the whole day. I curled, and it also gave me back 200 with 0 bytes as you mentioned in the comments above. I was blaming docker.</p>\n\n<p>And it worked finally, and the only (...) change is I removed the trailing slash inside the <code>http.Dir()</code></p>\n\n<p>E.g.: In your example, make this: <code>http.FileServer(http.Dir(\"/go/src/github.com/patientplatypus/webserver/files\"))))</code>, don't add the last slash to make it <code>.../files/</code></p>\n\n<p>And it Worked. It showed up the picture, and the curl result as well: </p>\n\n<pre><code>HTTP/2 200 \n accept-ranges: bytes\n content-type: image/png\n last-modified: Tue, 15 Oct 2019 22:27:48 GMT\n content-length: 107095\n</code></pre>\n"}], "owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 899, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1571271997, "creation_date": 1536172653, "last_edit_date": 1536178334, "question_id": 52191541, "link": "https://stackoverflow.com/questions/52191541/gorilla-golang-pathprefix-not-serving-files", "title": "Gorilla Golang Pathprefix not serving files", "body": "<p>I have a file in the folder <code>files</code> located in the root of my Golang project directory called <code>test.jpg</code>. So that would be <code>./files/test.jpg</code>    that I want to serve to my front end and I am having difficulties. </p>\n\n<p>My golang project is in a docker file with the following volume attached. (Basically this says that <code>/go/.../webserver</code> in the docker container can read and write out of <code>./</code> on the server) </p>\n\n<pre><code>volumes:\n  - ./:/go/src/github.com/patientplatypus/webserver/\n</code></pre>\n\n<p>I am using <code>gorilla/mux</code> for routing as defined by: </p>\n\n<pre><code>r := mux.NewRouter()\n</code></pre>\n\n<p>Here are some of my attempts at trying to get the PathPrefix to be properly formatted:</p>\n\n<pre><code>r.PathPrefix(\"/files/\").Handler(http.StripPrefix(\"/files/\", \nhttp.FileServer(http.Dir(\"/go/src/github.com/patientplatypus/webserver/files/\"))))\n</code></pre>\n\n<p>or</p>\n\n<pre><code>r.PathPrefix(\"/files\").Handler(http.FileServer(http.Dir(\"./files/\")))\n</code></pre>\n\n<p>or</p>\n\n<pre><code>r.PathPrefix(\"/files/\").Handler(http.StripPrefix(\"/files/\",  \nhttp.FileServer(http.Dir(\"./\"))))\n</code></pre>\n\n<p>or </p>\n\n<pre><code>r.PathPrefix(\"/files/\").Handler(http.FileServer(\nhttp.Dir(\"/go/src/github.com/patientplatypus/webserver/\")))\n</code></pre>\n\n<p>I had previously successfully written to the server with the following command:</p>\n\n<pre><code>newPath := filepath.Join(\"/go/src/github.com/patientplatypus/webserver/files\", \n\"test.jpg\")\nnewFile, err := os.Create(newPath)\n</code></pre>\n\n<p>So my intuition is that the first of my attempts should be the correct one, specfying the entirety of the <code>/go/.../files/</code> path.</p>\n\n<p>In any case, each of my attempts successfully returns a <code>200OK</code> to my front end with <em>an empty response.data</em> as shown here:</p>\n\n<pre><code>Object { data: \"\", status: 200, statusText: \"OK\",\nheaders: {\u2026}, config: {\u2026}, request: XMLHttpRequest }\n</code></pre>\n\n<p>which is coming from a simple js frontside http request using the <code>axios</code> package: </p>\n\n<pre><code>        axios({\n            method: 'get',\n            url: 'http://localhost:8000/files/test.jpg',\n        })\n        .then(response =&gt; {\n            //handle success\n            console.log(\"inside return for test.jpg and value \n            of response: \")\n            console.log(response);\n            console.log(\"value of response.data: \")\n            console.log(response.data)\n            this.image = response.data;\n        })\n        .catch(function (error) {\n            //handle error\n            console.log(error);\n        });\n</code></pre>\n\n<p>My only guess as to why this is happening is that it doesn't see the file and so returns nothing.</p>\n\n<p>For such a seemingly trivial problem, I am in the guess and check stage and I don't know how to debug further. If anyone has any ideas please let me know.</p>\n\n<p>Thanks!</p>\n\n<p>EDIT: </p>\n\n<p>In order to be completely clear, here is the entirety of my main.go file (only 150 lines) with all the routing. There is a piece of middleware that handles JWT auth, but in this case it ignores this route, and there is middleware to handle CORS. </p>\n\n<p>Line in question is highlighted: <a href=\"https://gist.github.com/patientplatypus/36230e665051465cd51291e17825f1f5#file-main-go-L122\" rel=\"nofollow noreferrer\">https://gist.github.com/patientplatypus/36230e665051465cd51291e17825f1f5#file-main-go-L122</a>.</p>\n\n<p>Also, here is my docker-compose file that shows what the volumes are (please ignore the sleep command to boot postgres - I understand it's not the ideal implementation)</p>\n\n<p><a href=\"https://gist.github.com/patientplatypus/2569550f667c0bee51287149d1c49568\" rel=\"nofollow noreferrer\">https://gist.github.com/patientplatypus/2569550f667c0bee51287149d1c49568</a>.</p>\n\n<p>There should be no other information necessary to debug.</p>\n\n<p>Also...some people have wanted me to show that the file exists in the container. </p>\n\n<pre><code>patientplatypus:~/Documents/zennify.me:11:49:09$docker exec \nbackend_app_1 ls /go/src/github.com/patientplatypus/webserver/files\ntest.jpg\n</code></pre>\n\n<p>Shows that it does.</p>\n\n<p>CLARIFICATION: </p>\n\n<p>I was not properly using Axios to buffer the array, and get an image. An example of that working is here: </p>\n\n<pre><code>        //working example image\n        var imageurl = 'https://avatars2.githubusercontent.com/u/5302751?v=3&amp;s=88';\n        //my empty server response\n        //var imageurl = 'http://localhost:8000/files/test.jpg';\n        axios.get(imageurl, {\n            responseType: 'arraybuffer'\n        })\n        .then( response =&gt; {\n            console.log('value of response: ', response);\n            console.log('value of response.data: ', response.data);\n            const base64 = btoa(\n                new Uint8Array(response.data).reduce(\n                    (data, byte) =&gt; data + String.fromCharCode(byte),\n                    '',\n                ),\n            );\n            console.log('value of base64: ', base64);\n            this.image = \"data:;base64,\" + base64 \n        });\n</code></pre>\n\n<p>However, this does not change the underlying problem that it appears that golang is not returning any data (response.data is empty). Just FYI that I have confirmed a working axios and that doesn't fix the issue.</p>\n"}, {"tags": ["go", "mqtt", "paho"], "comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1536167293, "post_id": 52189643, "comment_id": 91330314, "body": "if the broker and client are on different servers, are you sure, the server remains awake for network connection?"}, {"owner": {"reputation": 336, "user_id": 7143346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a01e970a819864e38e4b33fd915a81d?s=128&d=identicon&r=PG&f=1", "display_name": "xyz", "link": "https://stackoverflow.com/users/7143346/xyz"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1536167852, "post_id": 52189643, "comment_id": 91330556, "body": "yes, they are on different servers. I am positive the broker is working fine, because it was other subscriptors working just fine. @whitespace"}], "owner": {"reputation": 336, "user_id": 7143346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a01e970a819864e38e4b33fd915a81d?s=128&d=identicon&r=PG&f=1", "display_name": "xyz", "link": "https://stackoverflow.com/users/7143346/xyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 335, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1536164381, "creation_date": 1536164381, "question_id": 52189643, "link": "https://stackoverflow.com/questions/52189643/sporadic-disconnection-of-mqtt-client-in-golang", "title": "Sporadic Disconnection of mqtt client in Golang", "body": "<p>I am using paho mqtt client in GO to connect to a broker. Everything works fine for a while, in which I can publish to topics and listen to any subscription. After a while the client loses connection to the broker, for no apparent reason with this log:</p>\n\n<pre><code>[MQTT] ERROR: 2018/09/04 17:31:30 [net] outgoing stopped with error write tcp IP1 -&gt; IP2: write: broken pipe\n[MQTT] ERROR: 2018/09/04 17:31:30 [net] logic received from error channel, other components have errored, stopping\n</code></pre>\n\n<p>I am connecting to the broker like this:</p>\n\n<pre><code>opts := mqtt.NewClientOptions().\n    AddBroker(broker).\n    SetClientID(fmt.Sprintf(\"%s-%v\", ProgramName, time.Now().Unix())).\n    SetUsername(username).\n    SetPassword(password).\n    SetOrderMatters(true)\nif tlsConfig != nil {\n    opts.SetTLSConfig(tlsConfig)\n}\n\npahoClient := mqtt.NewClient(opts)\nclient = &amp;DefaultMQTTClient{\n    c:            pahoClient,\n    subscribeQoS: subscribeQoS,\n    publishQoS:   publishQoS,\n    name:         name,\n    log: Log.WithPrefix(\"mqtt\").WithFields(logrus.Fields{\n        \"name\":   name,\n        \"broker\": broker,\n    }),\n}\n\nclient.Log().Debug(\"connecting to mqtt broker\")\nif err = client.Connect(); err != nil {\n    err = client.Log().Trace(err, \"failed to connect to mqtt broker\")\n    return\n}\nclient.Log().Info(\"established connection with mqtt broker\")\n</code></pre>\n\n<p>And the version of paho that I am using is 1.0.0. Any hint is welcome!</p>\n"}, {"tags": ["mongodb", "go", "uuid", "mgo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1536156916, "post_id": 52187082, "comment_id": 91324302, "body": "Please post what you see on your console after running the <code>db.&lt;yourcollname&gt;.find()</code> command."}, {"owner": {"reputation": 1132, "user_id": 758667, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/32362f67f7ed51a95ad502da44426600?s=128&d=identicon&r=PG", "display_name": "sheshkovsky", "link": "https://stackoverflow.com/users/758667/sheshkovsky"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536157732, "post_id": 52187082, "comment_id": 91324834, "body": "@icza I added result of query you asked to my question."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536159652, "post_id": 52187082, "comment_id": 91326186, "body": "Are you sure you&#39;re not getting an error from <code>uuid.FromString</code>? In the posted code, you&#39;re discarding errors."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536159753, "post_id": 52187680, "comment_id": 91326260, "body": "I&#39;ve never had to do this and I&#39;ve used UUID with Mongo pretty extensively. It seems to work fine just passing the UUID directly (not converted to string or wrapped in <code>bson.Binary</code>)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536160649, "post_id": 52187680, "comment_id": 91326852, "body": "@Adrian If the value stored in MongoDB is a <code>bson.UUID</code> value, filtering by the hex UUID string will not match it (not with the dashed version, nor without dashes), neither will filtering by the raw byte slice (I&#39;ve tried all these). Maybe in your case the value stored in the database was just a string value or raw binary data and not of type <code>bson.UUID</code>?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536161902, "post_id": 52187680, "comment_id": 91327594, "body": "The hex UUID string will not match it, no - hence my saying <i>not</i> converted to string. The raw binary data should match - i.e., if you use the same data type you put in the field to upsert the document to query that field, it should work with no additional conversion."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536166704, "post_id": 52187680, "comment_id": 91330025, "body": "Not sure what you mean - <code>bson.UUID</code> is never mentioned in the question or OP&#39;s comments, BSON has no UUID type natively (it has ObjectID, which is similar but not technically a UUID), and the quoted document&#39;s <code>j</code> field is <code>BinData</code> type 3 (object), not type 7 (object ID)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536169981, "post_id": 52187680, "comment_id": 91331605, "body": "@Adrian You&#39;re right, my wording was unclear / confusing. Removing those comments."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1536169962, "last_edit_date": 1536169962, "creation_date": 1536158004, "answer_id": 52187680, "question_id": 52187082, "link": "https://stackoverflow.com/questions/52187082/how-to-query-uuid-field-in-mongodb-using-mgo-golang-client/52187680#52187680", "title": "How to query UUID field in mongodb using mgo (golang client)?", "body": "<p>The <code>j</code> property in your MongoDB documents is of type <code>BinData</code> type 3, so using a filter where you match it against a string will never yield any results.</p>\n\n<p>Your second attempt is on the right track. Except that you are filtering for the UTF-8 byte sequences of the hex representation of the UUID string (this is how Go stores strings in memory, this is what a <code>string</code> -> <code>[]byte</code> conversion yields). This again will never yield any results.</p>\n\n<p>And the reason is that the binary data you have to provide in <code>bson.Binary</code> is not the above mentioned value, but the raw bytes of the UUID.</p>\n\n<p>So what you have to do is hex-decode the UUID (which is given to you as the hex representation), and use this binary data.</p>\n\n<pre><code>data, err := hex.DecodeString(m.ID)\nif err != nil {\n    panic(err)\n}\n\ne := c.Find(bson.M{\"j\": bson.Binary{\n    Kind: bson.BinaryUUIDOld,\n    Data: data,\n}}).One(&amp;job)\n</code></pre>\n\n<p>Note that you have to pass the UUID to <a href=\"https://golang.org/pkg/encoding/hex/#DecodeString\" rel=\"nofollow noreferrer\"><code>hex.DecodeString()</code></a> without dashes, so you don't even need any 3rd party libs to process the UUID strings you have.</p>\n\n<p>Also please note that <code>gopkg.in/mgo.v2</code> is not maintained anymore. Instead use the community supported fork: <a href=\"https://github.com/globalsign/mgo\" rel=\"nofollow noreferrer\"><code>github.com/globalsign/mgo</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1359, "user_id": 113316, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4772c3b95b4065144bb7f26dd24eae37?s=128&d=identicon&r=PG", "display_name": "rajeshnair", "link": "https://stackoverflow.com/users/113316/rajeshnair"}, "is_accepted": false, "score": 0, "last_activity_date": 1536158047, "creation_date": 1536158047, "answer_id": 52187701, "question_id": 52187082, "link": "https://stackoverflow.com/questions/52187082/how-to-query-uuid-field-in-mongodb-using-mgo-golang-client/52187701#52187701", "title": "How to query UUID field in mongodb using mgo (golang client)?", "body": "<p>This is because the UUID is stored as binary data and you need to convert that to string in order to query it</p>\n\n<p>Look at this answer on how to convert mongo bindata to string and modify your <code>FromString</code> </p>\n\n<p><a href=\"https://stackoverflow.com/questions/8244110/get-bindata-uuid-from-mongo-as-string\">Get BinData UUID from Mongo as string</a></p>\n"}, {"tags": [], "owner": {"reputation": 97, "user_id": 8171348, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CowM9oWopyU/AAAAAAAAAAI/AAAAAAAAABQ/a4LfNd7efL4/photo.jpg?sz=128", "display_name": "Kunal", "link": "https://stackoverflow.com/users/8171348/kunal"}, "is_accepted": false, "score": 1, "last_activity_date": 1543293015, "creation_date": 1543293015, "answer_id": 53492785, "question_id": 52187082, "link": "https://stackoverflow.com/questions/52187082/how-to-query-uuid-field-in-mongodb-using-mgo-golang-client/53492785#53492785", "title": "How to query UUID field in mongodb using mgo (golang client)?", "body": "<p>If you have GUID to query with, following conversion worked for me (reorders the key bytes and then converts to hex decode): </p>\n\n<pre><code>func CsuuidToBinary(key string) []byte {\n    hexStr := strings.Replace(key, \"-\", \"\", -1)\n    first := hexStr[6:8] + hexStr[4:6] + hexStr[2:4] + hexStr[0:2]\n    second := hexStr[10:12] + hexStr[8:10]\n    third := hexStr[14:16] + hexStr[12:14]\n    fourth := hexStr[16:len(hexStr)]\n    hexStr = first + second + third + fourth\n\n    data, _ := hex.DecodeString(hexStr)\n    return data\n}\n</code></pre>\n\n<p>and then: </p>\n\n<pre><code>    data := CsuuidToBinary(guidKey)\n\n    var a A\n    err := collection.Find(bson.M{\"SomeKey\": bson.Binary{Kind: 0x03, Data: data,}}).One(&amp;a)\n</code></pre>\n"}], "owner": {"reputation": 1132, "user_id": 758667, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/32362f67f7ed51a95ad502da44426600?s=128&d=identicon&r=PG", "display_name": "sheshkovsky", "link": "https://stackoverflow.com/users/758667/sheshkovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2620, "favorite_count": 0, "accepted_answer_id": 52187680, "answer_count": 3, "score": 1, "last_activity_date": 1543293015, "creation_date": 1536156224, "last_edit_date": 1536159012, "question_id": 52187082, "link": "https://stackoverflow.com/questions/52187082/how-to-query-uuid-field-in-mongodb-using-mgo-golang-client", "title": "How to query UUID field in mongodb using mgo (golang client)?", "body": "<p>I have problems with queries on UUID filed in my mongo collection. Mongo document structure is like:</p>\n\n<pre><code>{\n    \"_id\": {\n        \"$oid\": \"5acf7faff5f02b0001e9fda1\"\n    },\n    \"j\": {\n        \"$uuid\": \"d0459793-3ec0-71fd-319e-b959af081db6\"\n    },\n    \"s\": \"ok\",\n    \"creation_date\": {\n        \"$date\": \"2018-04-12T15:47:59.003Z\"\n    }\n}\n</code></pre>\n\n<p>I want to get document, passing <code>j</code> uuid (not ObjectID). I create mongo connection, and I get my collection, then I try to execute this query:</p>\n\n<pre><code>import (    \n       mgo \"gopkg.in/mgo.v2\"\n       \"gopkg.in/mgo.v2/bson\"\n)\n...\nvar job *Job\nuid, _ := uuid.FromString(m.ID)\ne := c.Find(bson.M{\"j\": uid.String()}).One(&amp;job)\n</code></pre>\n\n<p>but <code>e</code> is always equal to \"not found\". </p>\n\n<p><code>m.ID</code> is string of uuid without dashes<code>-</code> so I convert it to <code>uuid.UUID</code>.</p>\n\n<p>Other queries like <code>c.Find(bson.M{\"s\": \"ok\"}).All(&amp;jobs)</code> work fine, so I'm sure about connection &amp; collection.</p>\n\n<p>Using golang 1.11 &amp; mongodb 3.6.</p>\n\n<p>UPDATE:</p>\n\n<p>When I do <code>db.mycol.find()</code> from mongo console result is a list of documents like:</p>\n\n<pre><code>{ \"_id\" : ObjectId(\"5acf5b0ac7fb0700010040ac\"), \"j\" : BinData(3,\"amOjUW1oQQ6dNsvLrQuDhg==\"), \"s\" : \"ok\", \"creation_date\" : ISODate(\"2018-04-12T13:11:38.365Z\") }\n</code></pre>\n\n<p>so I tried to modify my query like this: </p>\n\n<pre><code>e := c.Find(bson.M{\"j\": bson.Binary{0x03, []byte(m.ID)}}).One(&amp;job)\n</code></pre>\n\n<p>And still it does not return the document.</p>\n"}, {"tags": ["go", "vgo", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": true, "score": 0, "last_activity_date": 1564515302, "creation_date": 1564515302, "answer_id": 57278892, "question_id": 52186774, "link": "https://stackoverflow.com/questions/52186774/how-to-import-non-go-directories-e-g-c-src-with-go-modules/57278892#57278892", "title": "How to import non-go directories (e.g: C src/) with go modules?", "body": "<p>The <code>go</code> tool only tracks C sources that are in the same directory as an imported Go package \u2014 that's a deeply-engrained assumption of the cache-invalidation algorithm.</p>\n\n<p>Ideally, you should send a PR to <code>cloudflare/golz4</code> to put the C sources in the same directory as the Go wrapper.</p>\n"}], "owner": {"reputation": 35, "user_id": 3575507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/926d416ee6aedd1b2a15c35ae15ac996?s=128&d=identicon&r=PG&f=1", "display_name": "Leeios", "link": "https://stackoverflow.com/users/3575507/leeios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "accepted_answer_id": 57278892, "answer_count": 1, "score": 0, "last_activity_date": 1564515302, "creation_date": 1536155346, "question_id": 52186774, "link": "https://stackoverflow.com/questions/52186774/how-to-import-non-go-directories-e-g-c-src-with-go-modules", "title": "How to import non-go directories (e.g: C src/) with go modules?", "body": "<p>I use <a href=\"https://github.com/cloudflare/golz4\" rel=\"nofollow noreferrer\">https://github.com/cloudflare/golz4</a> which is a go interface to C code. So the <code>src/</code> directory is mandatory in the dep tree.</p>\n\n<p>Most dependency management ignore those directories (without <code>.go</code> files) but leave an option to force it.</p>\n\n<p>e.g: go dep has</p>\n\n<pre><code># [prune]\n#   unused-packages = true\n</code></pre>\n\n<p>Vgo/Go1.11 mod ignore those directories but is there an option to force import them ?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["mongodb", "go", "match", "aggregation", "mgo"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1536151124, "post_id": 52185111, "comment_id": 91320374, "body": "Please show some code."}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 1, "creation_date": 1536152273, "post_id": 52185111, "comment_id": 91321111, "body": "The field still exists - it&#39;s an empty array, so just add an $or where <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/size/index.html\" rel=\"nofollow noreferrer\">$size</a> is 0."}, {"owner": {"reputation": 1, "user_id": 8324476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a9a0a21ad59946ef091843d60396d30?s=128&d=identicon&r=PG&f=1", "display_name": "Deep Inside", "link": "https://stackoverflow.com/users/8324476/deep-inside"}, "reply_to_user": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1536156140, "post_id": 52185111, "comment_id": 91323821, "body": "@AlexBlex, I love u) The request is: db.banners.find({&quot;$or&quot;: [{&quot;Countries&quot;: &quot;e227925b-a722-40a7-b599-8c44afbb3cd5&quot;}, {&quot;Countries&quot;: {&quot;$size&quot;: 0}}]})"}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1536156619, "post_id": 52185111, "comment_id": 91324115, "body": "It definitely is, but it&#39;s not aggregation. The docs for the $size you are using is <a href=\"https://docs.mongodb.com/manual/reference/operator/query/size/index.html\" rel=\"nofollow noreferrer\">here</a>."}], "owner": {"reputation": 1, "user_id": 8324476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a9a0a21ad59946ef091843d60396d30?s=128&d=identicon&r=PG&f=1", "display_name": "Deep Inside", "link": "https://stackoverflow.com/users/8324476/deep-inside"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1536155684, "creation_date": 1536150426, "last_edit_date": 1536155684, "question_id": 52185111, "link": "https://stackoverflow.com/questions/52185111/mongodb-match-by-field-in-documents-array-if-it-exists-if-not-skip-match-by", "title": "MongoDB match by field in document&#39;s array if it exists, if not -&gt; skip match by this field", "body": "<p>I've got collection named 'banners'.\nIf user choosed Continent and Country the body of this document will be:</p>\n\n<pre><code> \"Continents\" : [ \n     4, \n     6\n ],\n \"Countries\" : [ \n     \"74d06620-79b1-4449-9a17-848169d514ce\"\n ]\n</code></pre>\n\n<p>But, if user choosed all Countries in this Continent:</p>\n\n<pre><code> \"Continents\" : [ \n     4, \n     6\n ],\n \"Countries\" : [],\n</code></pre>\n\n<p>How can i match in aggregation by field in document's array if it exists, if not -> skip match by this field and continue searching? \nAny help would be appreciated)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1536148919, "post_id": 52184612, "comment_id": 91318986, "body": "Use the <a href=\"https://github.com/alecthomas/gometalinter\" rel=\"nofollow noreferrer\">go meta linter</a> locally and / or during your CI build, goreportcard.com uses that too."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536148977, "post_id": 52184612, "comment_id": 91319030, "body": "The source code is available on github, so you should be able to make it do whatever you want, as long as you don&#39;t care that it&#39;s running on the goreportcard.com domain name."}], "answers": [{"comments": [{"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1536173897, "post_id": 52185556, "comment_id": 91333271, "body": "thanks , so how should I test it to simulate the go reports card?"}], "tags": [], "owner": {"reputation": 333, "user_id": 8989452, "user_type": "registered", "profile_image": "https://graph.facebook.com/1517851688282463/picture?type=large", "display_name": "Krzysztof Skolimowski", "link": "https://stackoverflow.com/users/8989452/krzysztof-skolimowski"}, "is_accepted": true, "score": 3, "last_activity_date": 1536151715, "creation_date": 1536151715, "answer_id": 52185556, "question_id": 52184612, "link": "https://stackoverflow.com/questions/52184612/go-report-card-run-for-local-project-private-git/52185556#52185556", "title": "Go report card run for local project/private git", "body": "<p>You can achieve same results via running following file checkers and linters locally: </p>\n\n<p><code>gofmt\ngo_vet\ngocyclo\ngolint \nineffassign\nlicense\nmisspell</code></p>\n\n<p>all of them can be run from command line. </p>\n\n<p>if you want to have one tool I would recommend gometalinter. \n<a href=\"https://github.com/alecthomas/gometalinter\" rel=\"nofollow noreferrer\">https://github.com/alecthomas/gometalinter</a></p>\n\n<p><code>go get -u github.com/alecthomas/gometalinter\ngometalinter --install\ngometalinter --deadline=90s --disable-all ... #other flags\n</code></p>\n"}, {"tags": [], "owner": {"reputation": 14451, "user_id": 1334561, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LhV7w.jpg?s=128&g=1", "display_name": "Muhammad Soliman", "link": "https://stackoverflow.com/users/1334561/muhammad-soliman"}, "is_accepted": false, "score": 2, "last_activity_date": 1583360850, "last_edit_date": 1583360850, "creation_date": 1582610764, "answer_id": 60388411, "question_id": 52184612, "link": "https://stackoverflow.com/questions/52184612/go-report-card-run-for-local-project-private-git/60388411#60388411", "title": "Go report card run for local project/private git", "body": "<p>Here's how you install and get report locally or in private server:</p>\n\n<p>1) Prerequisites (Before you run <code>goreportcard-cli</code>, it needs to install some dependencies) </p>\n\n<pre><code>$ go get -u golang.org/x/lint/golint\n\n$ go get github.com/fzipp/gocyclo\n\n$ go get -u github.com/client9/misspell/cmd/misspell\n\n$ go get github.com/gordonklaus/ineffassign\n\n#deprecated, a reported issue in goreportcard-cli to switch to use golangcli-lint instead\n$ go get github.com/alecthomas/gometalinter\n</code></pre>\n\n<p>2) Now, Install <code>cli</code> and then run it within your project dir: </p>\n\n<pre><code>#get whole project (for demo purpose only) \ngo get github.com/gojp/goreportcard/...\n</code></pre>\n\n<p><strong>Note</strong>: In real environment, you may need to only instal <code>cli</code></p>\n\n<pre><code>$ go get github.com/gojp/goreportcard/cmd/goreportcard-cli\n</code></pre>\n\n<p>3) Testing it: Go to the project (private repo or run it within your local project) </p>\n\n<pre><code>$ cd $GOPATH/src/github.com/gojp/goreportcard\n$ goreportcard-cli\n</code></pre>\n\n<p>You should get something like this </p>\n\n<pre><code>\u276f goreportcard-cli\nGrade: A+ (98.9%)\nFiles: 403\nIssues: 39\ngofmt: 100%\ngo_vet: 99%\ngolint: 100%\ngocyclo: 91%\nineffassign: 99%\nlicense: 100%\nmisspell: 100%\n</code></pre>\n"}], "owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1186, "favorite_count": 1, "accepted_answer_id": 52185556, "answer_count": 2, "score": 1, "last_activity_date": 1583360850, "creation_date": 1536148789, "last_edit_date": 1536148885, "question_id": 52184612, "link": "https://stackoverflow.com/questions/52184612/go-report-card-run-for-local-project-private-git", "title": "Go report card run for local project/private git", "body": "<p>I want to use the <code>go report</code> but my project is in private repo. is it possible ? or on local project (in my machine)</p>\n\n<p><a href=\"https://goreportcard.com/\" rel=\"nofollow noreferrer\">https://goreportcard.com/</a></p>\n\n<p>I want to verify that I'm in the right way and I currently cannot remove the private restriction.</p>\n"}, {"tags": ["xml", "string", "go", "marshalling"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1536139187, "post_id": 52181503, "comment_id": 91312966, "body": "<code>Encode()</code> is to encode some Go value into XML. You already have an XML, that&#39;s why encoding it (again) will apply escaping. If you don&#39;t want that, just write your source to the output as-is."}, {"owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536139764, "post_id": 52181503, "comment_id": 91313374, "body": "Sorry . I edited ."}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1536145798, "post_id": 52181503, "comment_id": 91317016, "body": "Are you wanting the encoder to ignore the <code>Message</code> field completely? If so, use <code>`xml:&quot;-&quot;`</code> instead."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1536142161, "last_edit_date": 1536142161, "creation_date": 1536139996, "answer_id": 52181802, "question_id": 52181503, "link": "https://stackoverflow.com/questions/52181503/func-encode-encoding-all-part-of-xml/52181802#52181802", "title": "func Encode(), encoding all part of xml", "body": "<p>Mission of <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow noreferrer\"><code>encoding/xml</code></a> is to produce <em>valid</em> XML documents. Escaping the <code>&lt;</code> and <code>&gt;</code> characters is a must for a valid XML. Don't worry, the content of <code>&lt;message&gt;</code> will be <code>This is &lt;myText&gt;</code>, but this text must appear as <code>This is &amp;lt;myText&amp;gt;</code> in the source of XML.</p>\n\n<p>Note that using the <code>xml:\",innerxml\"</code> tag value you could force outputting raw XML data as documented at <a href=\"https://golang.org/pkg/encoding/xml/#Marshal\" rel=\"nofollow noreferrer\"><code>xml.Marshal()</code></a>:</p>\n\n<blockquote>\n<pre><code>- a field with tag \",innerxml\" is written verbatim, not subject\n  to the usual marshaling procedure.\n</code></pre>\n</blockquote>\n\n<p>Like this:</p>\n\n<pre><code>type rawxml struct {\n    Data string `xml:\",innerxml\"`\n}\ntype body struct {\n    Message rawxml `xml:\"message\"`\n}\nmyXml := body{\n    Message: rawxml{\"This is &lt;myText&gt;\"},\n}\n</code></pre>\n\n<p>This would output (try it on the <a href=\"https://play.golang.org/p/ZD8aUdZfcDO\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&lt;body&gt;\n  &lt;message&gt;This is &lt;myText&gt;&lt;/message&gt;\n&lt;/body&gt;\n</code></pre>\n\n<p>Or implementing and using custom <a href=\"https://golang.org/pkg/encoding/xml/#Marshaler\" rel=\"nofollow noreferrer\"><code>xml.Marshaler</code></a>, but again, <strong>this is invalid XML</strong>, this is not what you want. What you have right now is exactly what you want.</p>\n"}], "owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 52181802, "answer_count": 1, "score": 0, "last_activity_date": 1536142240, "creation_date": 1536139111, "last_edit_date": 1536142240, "question_id": 52181503, "link": "https://stackoverflow.com/questions/52181503/func-encode-encoding-all-part-of-xml", "title": "func Encode(), encoding all part of xml", "body": "<p>This is code :</p>\n\n<pre><code>import (\n\"bytes\"\n\"encoding/xml\"\n\"fmt\")\n\nfunc main() {\ntype body struct {\n    Message string `xml:\"message\"`\n}\nmyXml := body{\n    Message:\"This is &lt;myText&gt;\",\n}\n\n    w := &amp;bytes.Buffer{}\n        enc := xml.NewEncoder(w)\n        enc.Indent(\"\", \"  \")\n        if err := enc.Encode(myXml); err != nil {\n            panic(err)\n        }\n        request := w.String()\n        fmt.Println(request)\n    }\n</code></pre>\n\n<p>Is there any way that the value of field message do not encode.I want  not encode.\nThis is result :</p>\n\n<pre><code>&lt;body&gt;\n  &lt;message&gt;This is &amp;lt;myText&amp;gt;&lt;/message&gt;\n&lt;/body&gt;\n</code></pre>\n"}, {"tags": ["algorithm", "go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": true, "score": 0, "last_activity_date": 1536167913, "creation_date": 1536167913, "answer_id": 52190421, "question_id": 52179763, "link": "https://stackoverflow.com/questions/52179763/computing-mod-inverse/52190421#52190421", "title": "Computing mod inverse", "body": "\n\n<blockquote>\n  <p>Is this a bad style, should I have something like a <code>WaitGroup</code>?</p>\n</blockquote>\n\n<p>A wait group solves a different problem.</p>\n\n<p>In general, to be a responsible go citizen here and ensure your code runs <em>and tidies up behind itself</em>, you may need to do a combination of:</p>\n\n<ol>\n<li>Signal to the spawned goroutines to stop their calculations when the result of the computation has been found elsewhere.</li>\n<li>Ensure a synchronous process waits for the goroutines to stop before returning. This is not mandatory if they properly respond to the signal in #1, but if you don't wait, there will be no guarantee they have terminated before the parent goroutine continues.</li>\n</ol>\n\n<p>In your example program, which performs this task and then quits, there is strictly no need to do either. As <a href=\"https://stackoverflow.com/questions/52179763/computing-mod-inverse#comment91311456_52180399\">this comment</a> indicates, your program's <code>main</code> method terminates upon a satisfactory answer being found, at which point the program will end, any goroutines will be summarily terminated, and the operating system will tidy up any consumed resources. Waiting for goroutines to stop is unnecessary.</p>\n\n<p>However, if you wrapped this code up into a library or it became part of a long running \"inverse prime calculation\" service, it would be desirable to tidy up the goroutines you spawned to avoid wasting cycles unnecessarily. Additionally, in general, you may have other scenarios in which goroutines store state, hold handles to external resources, or hold handles to internal objects which you risk leaking if not properly tidied away \u2013 it is desirable to properly close these.</p>\n\n<hr>\n\n<h1>Communicating the requirement to stop working</h1>\n\n<p>There are several approaches to communicate this. I don't claim this is an exhaustive list! <sub>(Please do suggest other general-purpose methods in the comments or by proposing edits to the post.)</sub></p>\n\n<h2>Using a special channel</h2>\n\n<p>Signal the child goroutines by closing a special \"shutdown\" channel reserved for the purpose. This exploits the channel <a href=\"https://dave.cheney.net/2014/03/19/channel-axioms\" rel=\"nofollow noreferrer\">axiom</a>:</p>\n\n<blockquote>\n  <p>A receive from a closed channel returns the zero value immediately</p>\n</blockquote>\n\n<p>On receiving from the shutdown channel, the goroutine should immediately arrange to tidy any local state and return from the function. Your earlier question had example code which implemented this; a version of the pattern is:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func myGoRoutine(shutdownChan &lt;-chan struct{}) {\n    select {\n    case &lt;-shutdownChan:\n        // tidy up behaviour goes here\n        return\n    // You may choose to listen on other channels here to implement\n    // the primary behaviour of the goroutine.\n    }\n}\n\nfunc main() {\n    shutdownChan := make(chan struct{})\n    go myGoRoutine(shutdownChan)\n\n    // some time later\n    close(shutdownChan)\n}\n</code></pre>\n\n<p>In this instance, the shutdown logic is wasted because the <code>main()</code> method will immediately return after the call to <code>close</code>. This will race with the shutdown of the goroutine, but we should assume it will not properly execute its tidy-up behaviour. Point 2 addresses ways to fix this.</p>\n\n<h2>Using a context</h2>\n\n<p>The <code>context</code> package provides the option to create a context which can be cancelled. On cancellation, a channel exposed by the context's <code>Done()</code> method will be closed, which signals time to return from the goroutine.</p>\n\n<p>This approach is approximately the same as the previous method, with the exception of neater encapsulation and the availability of a context to pass to downstream calls in your goroutine to cancel nested calls where desired. Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func myGoRoutine(ctx context.Context) {\n    select {\n    case &lt;-ctx.Done():\n        // tidy up behaviour goes here\n        return\n    // Put real behaviour for the goroutine here.\n    }\n}\n\nfunc main() {\n    // Get a context (or use an existing one if you are provided with one\n    // outside a `main` method:\n    ctx := context.Background()\n\n    // Create a derived context with a cancellation method\n    ctx, cancel := context.WithCancel(ctx)\n\n    go myGoRoutine(ctx)\n\n    // Later, when ready to quit\n    cancel()\n}\n</code></pre>\n\n<p>This has the same bug as the other case in that the <code>main</code> method will not wait for the child goroutines to quit before returning.</p>\n\n<h1>Waiting (or \"join\"ing) for child goroutines to stop</h1>\n\n<p>The code which closes the shutdown channel or closes the context in the above examples will not wait for child goroutines to stop working before continuing. This may be acceptable in some instances, while in others you may require the guarantee that goroutines have stopped before continuing.</p>\n\n<p><code>sync.WaitGroup</code> can be used to implement this requirement. The <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">documentation</a> is comprehensive. A wait group is a counter which should be incremented using its <code>Add</code> method on starting a goroutine and decremented using its <code>Done</code> method when a goroutine completes. Code can wait for the counter to return to zero by calling its <code>Wait</code> method, which blocks until the condition is true. All calls to <code>Add</code> must occur before a call to <code>Wait</code>.</p>\n\n<p>Example code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    var wg sync.WaitGroup\n\n    // Increment the WaitGroup with the number of goroutines we're\n    // spawning.\n    wg.Add(1)\n\n    // It is common to wrap a goroutine in a function which performs\n    // the decrement on the WaitGroup once the called function returns\n    // to avoid passing references of this control logic to the\n    // downstream consumer.\n    go func() {\n        // TODO: implement a method to communicate shutdown.\n        callMyFunction()\n        wg.Done()\n    }()\n\n    // Indicate shutdown, e.g. by closing a channel or cancelling a\n    // context.\n\n    // Wait for goroutines to stop\n    wg.Wait()\n}\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>Is there a more idiomatic way to do this computation?</p>\n</blockquote>\n\n<p>This algorithm is certainly parallelizable through use of goroutines in the manner you have defined. As the work is CPU-bound, the limitation of goroutines to the number of available CPUs makes sense (in the absence of other work on the machine) to benefit from the available compute resource.</p>\n\n<p>See <a href=\"https://stackoverflow.com/a/52180399/1113760\">peterSO's answer</a> for a bug fix.</p>\n"}, {"tags": [], "owner": {"reputation": 30866, "user_id": 1139393, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4f7f66aa636f33c3e5784d3581213ba8?s=128&d=identicon&r=PG", "display_name": "Peter de Rivaz", "link": "https://stackoverflow.com/users/1139393/peter-de-rivaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1536415830, "creation_date": 1536415830, "answer_id": 52236107, "question_id": 52179763, "link": "https://stackoverflow.com/questions/52179763/computing-mod-inverse/52236107#52236107", "title": "Computing mod inverse", "body": "<blockquote>\n  <p>Is there a more idiomatic way to do this computation?</p>\n</blockquote>\n\n<p>You don't actually need a loop to compute this.</p>\n\n<p>If you use the <a href=\"https://golang.org/pkg/math/big/#Int.GCD\" rel=\"nofollow noreferrer\">GCD function</a> (part of the standard library), you get returned numbers x and y such that:</p>\n\n<pre><code>x*P+y*Base=1 \n</code></pre>\n\n<p>this means that x is the answer you want (because x*P = 1 modulo Base):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nconst (\n    P    = 1000099\n    Base = 1&lt;&lt;31 - 1\n)\n\nfunc main() {\n    bigP := big.NewInt(P)\n    bigBase := big.NewInt(Base)\n    // Compute inverse of bigP modulo bigBase\n    bigGcd := big.NewInt(0)\n    bigX := big.NewInt(0)\n    bigGcd.GCD(bigX,nil,bigP,bigBase)\n    // x*bigP+y*bigBase=1 \n    // =&gt; x*bigP = 1 modulo bigBase\n    fmt.Println(bigX)\n}\n</code></pre>\n"}], "owner": {"reputation": 5043, "user_id": 474772, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/543126f859fa173bba7ad18b636ef59d?s=128&d=identicon&r=PG", "display_name": "Mariy", "link": "https://stackoverflow.com/users/474772/mariy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 52190421, "answer_count": 2, "score": 1, "last_activity_date": 1536415830, "creation_date": 1536133546, "question_id": 52179763, "link": "https://stackoverflow.com/questions/52179763/computing-mod-inverse", "title": "Computing mod inverse", "body": "<p>I want to compute the inverse element of a prime in modular arithmetic.\nIn order to speed things up I start a few goroutines which try to find the element in a certain range. When the first one finds the element, it sends it to the main goroutine and at this point I want to terminate the program. So I call <code>close</code> in the main goroutine, but I don't know if the goroutines will finish their execution (I guess not). So a few questions arise:</p>\n\n<p>1) Is this a bad style, should I have something like a <code>WaitGroup</code>?</p>\n\n<p>2) Is there a more idiomatic way to do this computation?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nconst (\n    Procs = 8\n    P     = 1000099\n    Base  = 1&lt;&lt;31 - 1\n)\n\nfunc compute(start, end uint64, finished chan struct{}, output chan uint64) {\n    for i := start; i &lt; end; i++ {\n        select {\n        case &lt;-finished:\n            return\n        default:\n            break\n        }\n        if i*P%Base == 1 {\n            output &lt;- i\n        }\n    }\n}\n\nfunc main() {\n    finished := make(chan struct{})\n    output := make(chan uint64)\n\n    for i := uint64(0); i &lt; Procs; i++ {\n        start := i * (Base / Procs)\n        end := (i + 1) * (Base / Procs)\n        go compute(start, end, finished, output)\n    }\n\n    fmt.Println(&lt;-output)\n    close(finished)\n}\n</code></pre>\n"}, {"tags": ["go", "ipfs"], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 6292860, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XPHLZwzTO8s/AAAAAAAAAAI/AAAAAAAAABE/vyqfQHXRjAE/photo.jpg?sz=128", "display_name": "Shirish Patel", "link": "https://stackoverflow.com/users/6292860/shirish-patel"}, "is_accepted": false, "score": 2, "last_activity_date": 1539189451, "creation_date": 1539189451, "answer_id": 52744996, "question_id": 52179737, "link": "https://stackoverflow.com/questions/52179737/using-go-ipfs-programmatically/52744996#52744996", "title": "Using Go-IPFS Programmatically", "body": "<p>You may want to breakdown your question into smaller pieces, I have been playing with a source code of go-ipfs for a while and here's the general instruction I could give you:</p>\n\n<ol>\n<li>Most of the data structures like, context, DAG, IPFSNode and so on are defined in form of go structures, and you should be able to find them in gx/.../... directory where also you should be able to see detailed information about each variable used ( simple string search through the directory should get you to your needed source file)</li>\n<li>All the methods are defined in folder github.com/../.. directory</li>\n<li>Clear the concept of pointers as they are using pointers most of the time to pass parameters to functions</li>\n</ol>\n"}], "owner": {"reputation": 359, "user_id": 1780864, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8329d30a585c29c0c4f291d8df1fa87e?s=128&d=identicon&r=PG&f=1", "display_name": "Aurelius", "link": "https://stackoverflow.com/users/1780864/aurelius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 873, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1539189451, "creation_date": 1536133476, "last_edit_date": 1536165786, "question_id": 52179737, "link": "https://stackoverflow.com/questions/52179737/using-go-ipfs-programmatically", "title": "Using Go-IPFS Programmatically", "body": "<p>I would love to be able to use Go-IPFS within my Go program, however it is totally undocumented. This is where my reasearch lead me:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n    \"path/filepath\"\n\n    \"gx/ipfs/QmSP88ryZkHSRn1fnngAaV2Vcn63WUJzAavnRM9CVdU1Ky/go-ipfs-cmdkit/files\"\n\n    \"github.com/ipfs/go-ipfs/core\"\n    \"github.com/ipfs/go-ipfs/core/coreunix\"\n)\n\nfunc main() {\n    ctx := context.Background()\n\n    node, err := core.NewNode(ctx, &amp;core.BuildCfg{})\n    if err != nil {\n        log.Fatalf(\"Failed to start IPFS node: %v\", err)\n    }\n    reader, err := coreunix.Cat(ctx, node, \"QmPZ9gcCEpqKTo6aq61g2nXGUhM4iCL3ewB6LDXZCtioEB\")\n    if err != nil {\n        log.Fatalf(\"Failed to look up IPFS welcome page: %v\", err)\n    }\n    blob, err := ioutil.ReadAll(reader)\n    if err != nil {\n        log.Fatalf(\"Failed to retrieve IPFS welcome page: %v\", err)\n    }\n    fmt.Println(string(blob))\n}\n</code></pre>\n\n<p>However I am not sure about the difference of </p>\n\n<p><code>context.Background()</code> Vs <code>context.TODO()</code> Vs <code>context.WithCancel(context.Background())</code>.</p>\n\n<p>And most importantly, how can choose where IPFS will put the IPFS repo and make sure it also initializes it? </p>\n\n<p>How can I enable and use Pubsub along with its commands <code>subscribe</code> and <code>publish</code>? </p>\n\n<p>How can I add and pin a file to IPFS with the possibility to also input a stream for big files? </p>\n\n<p>Is <code>coreunix.Cat</code> suitable to read files with a stream as well?</p>\n\n<p>How can I keep the node \"listening\" like when you run the ipfs daemon from the CLI and have everything runnng on all the ports like webui, swarm, etc.?</p>\n\n<p>How about this to add files? Does this use streams or reads the entire file into memory? How can this be improved?</p>\n\n<pre><code>func addFile(ctx *context.Context, node *core.IpfsNode, path *string) error {\n    file, err := os.Open(*path)\n    if err != nil {\n        return err\n    }\n    adder, err := coreunix.NewAdder(*ctx, node.Pinning, node.Blockstore, node.DAG)\n    if err != nil {\n        return err\n    }\n    filename := filepath.Base(*path)\n    fileReader := files.NewReaderFile(filename, filename, file, nil)\n    adder.AddFile(fileReader)\n    adder.PinRoot()\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19583, "user_id": 3026283, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/SyT5b.png?s=128&g=1", "display_name": "H&#233;ctor", "link": "https://stackoverflow.com/users/3026283/h%c3%a9ctor"}, "edited": false, "score": 1, "creation_date": 1536133320, "post_id": 52179626, "comment_id": 91309383, "body": "<code>a := []aclStruct{aclStruct{&quot;A&quot;}, aclStruct{&quot;B&quot;}, aclStruct{&quot;C&quot;}}</code>"}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 4, "creation_date": 1536133321, "post_id": 52179626, "comment_id": 91309386, "body": "The first argument of <code>append</code> should be a slice."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1536134021, "post_id": 52179626, "comment_id": 91309799, "body": "Thats how append works. It appends elements to a slice. The Tour of Go might explain slices and how to manipulate them in more detail."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536153748, "post_id": 52179798, "comment_id": 91322141, "body": "The first argument must be a <i>slice</i>, not an array. <code>append</code> does not accept arrays."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536169827, "post_id": 52179798, "comment_id": 91331534, "body": "Also your second example is invalid, you cannot use the <code>...</code> syntax in an array or slice literal."}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 0, "last_activity_date": 1536169207, "last_edit_date": 1536169207, "creation_date": 1536133625, "answer_id": 52179798, "question_id": 52179626, "link": "https://stackoverflow.com/questions/52179626/how-to-add-more-data-into-struct-with-append-or-without-append/52179798#52179798", "title": "How to add more data into struct with append or without append?", "body": "<p>first argument of append must be a slice so correct way of doing it is:\n<code>a := append([]aclStruct{aclStruct{\"A\"}}, aclStruct{\"B\"}, aclStruct{\"C\"})</code></p>\n\n<p>or</p>\n\n<p><code>append([]aclStruct{{\"A\"}}, aclStruct{\"B\"}, aclStruct{\"C\"})</code></p>\n\n<p>a way of doing it without append is:</p>\n\n<pre><code>a := []aclStruct{aclStruct{\"A\"}, aclStruct{\"B\"}}\nappendedArray := []aclStruct{aclStruct{\"C\"}, a...}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 333, "user_id": 8989452, "user_type": "registered", "profile_image": "https://graph.facebook.com/1517851688282463/picture?type=large", "display_name": "Krzysztof Skolimowski", "link": "https://stackoverflow.com/users/8989452/krzysztof-skolimowski"}, "is_accepted": false, "score": 1, "last_activity_date": 1536133940, "creation_date": 1536133940, "answer_id": 52179906, "question_id": 52179626, "link": "https://stackoverflow.com/questions/52179626/how-to-add-more-data-into-struct-with-append-or-without-append/52179906#52179906", "title": "How to add more data into struct with append or without append?", "body": "<p>If you want to declare slice of three elements use: \n<code>\na := []aclStruct{aclStruct{\"A\"}, aclStruct{\"B\"}, aclStruct{\"C\"}}\n</code></p>\n\n<p><code>append</code> should be used to modify currently existing slice (it <em>appends</em> to a slice). It is throwing an error, because first argument should be a slice. </p>\n\n<p>if you want to use it: </p>\n\n<p><code>var a []aclStruct \nappend(a, aclStruct{\"A\"})\n</code></p>\n\n<p>GoDoc answers the question well: </p>\n\n<p><code>func append(slice []Type, elems ...Type) []Type</code></p>\n\n<p>The append built-in function appends elements to the end of a slice. If it has sufficient capacity, the destination is resliced to accommodate the new elements. If it does not, a new underlying array will be allocated. Append returns the updated slice. It is therefore necessary to store the result of append, often in the variable holding the slice itself:</p>\n\n<p><code>slice = append(slice, elem1, elem2)\nslice = append(slice, anotherSlice...)</code></p>\n"}, {"tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": true, "score": 3, "last_activity_date": 1536140185, "last_edit_date": 1536140185, "creation_date": 1536134212, "answer_id": 52179991, "question_id": 52179626, "link": "https://stackoverflow.com/questions/52179626/how-to-add-more-data-into-struct-with-append-or-without-append/52179991#52179991", "title": "How to add more data into struct with append or without append?", "body": "<blockquote>\n  <p>Even not sure sure it's a right way for struct because on array it's works fine.</p>\n</blockquote>\n\n<p>The <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\">append function</a> appends elements to the end of a <strong>slice</strong>.</p>\n\n<p>structs are declared statically. There is simply no way in Go to change their structure to add fields to them at runtime.</p>\n\n<p>If you want a <em>slice of structs</em>, which you may use to track multiple representations of the struct, perhaps with different data points, you can build that structure in several ways:</p>\n\n<ul>\n<li><p>Using <code>append</code>, ensuring the first argument passed is a (possibly empty) slice: </p>\n\n<pre><code>a := append([]aclStruct{}, aclStruct{\"A\"}, ...)\n</code></pre></li>\n<li><p>Declare the slice variable <code>a</code> and pass this to <code>append</code>:</p>\n\n<pre><code>var a []aclStruct{}\na = append(a, aclStruct{\"A\"}, ...)\n</code></pre></li>\n<li><p>Declaring and initializing the slice with values inline:</p>\n\n<pre><code>a := []aclStruct{{\"A\"}, {\"B\"}}\n</code></pre>\n\n<p>Note that you don't need to re-specify the concrete type for each slice element, as it can be inferred from the type of the slice)</p></li>\n</ul>\n"}], "owner": {"reputation": 894, "user_id": 1947741, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S3zyB.png?s=128&g=1", "display_name": "amku91", "link": "https://stackoverflow.com/users/1947741/amku91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2775, "favorite_count": 0, "accepted_answer_id": 52179991, "answer_count": 3, "score": -3, "last_activity_date": 1536169207, "creation_date": 1536133141, "last_edit_date": 1536134033, "question_id": 52179626, "link": "https://stackoverflow.com/questions/52179626/how-to-add-more-data-into-struct-with-append-or-without-append", "title": "How to add more data into struct with append or without append?", "body": "<p>Well we can use Golang built in append method to add more data into a defined struct. e.g.</p>\n\n<pre><code>type aclStruct struct { acl string}\n\na := []aclStruct{aclStruct{\"A\"}, aclStruct{\"B\"}}\n\na = append(a, aclStruct{\"C\"})\n</code></pre>\n\n<p>No Doubt it's working. But when I tried without append method it's producing an error. E.g.</p>\n\n<p>What I am trying to do is :</p>\n\n<pre><code>a := append(aclStruct{\"A\"}, aclStruct{\"B\"}, aclStruct{\"C\"})\n</code></pre>\n\n<p>Even not sure sure it's a right way for struct because on array it's works fine. Also is there any way of doing this without using of append ?</p>\n\n<p>Any Help??</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1536134492, "creation_date": 1536134492, "answer_id": 52180093, "question_id": 52179456, "link": "https://stackoverflow.com/questions/52179456/can-i-get-some-help-to-reason-about-the-concurrent-prime-sieve-example/52180093#52180093", "title": "Can I get some help to reason about the `concurrent prime sieve` example?", "body": "<ol>\n<li><p>This is why it is called a prime sieve. Each channel connects one sieve/Filter to the next one (coarser sieve). That is why you connect input to output sieves:</p>\n\n<p>sieve out multiples of 2  --->  sieve out multiples of 3  ---> sieve out multiples of 5 ---> sieve out ....</p>\n\n<p>You see: What flows out of one sieve goes to the next sieve/Filter.</p></li>\n<li><p>I do not understand the question. 9 is not devisable by 2 so it passes the 2-Filter. 9 is devisable by 3 so it is stopped by the 3-Filter.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 0, "last_activity_date": 1536135338, "creation_date": 1536135338, "answer_id": 52180356, "question_id": 52179456, "link": "https://stackoverflow.com/questions/52179456/can-i-get-some-help-to-reason-about-the-concurrent-prime-sieve-example/52180356#52180356", "title": "Can I get some help to reason about the `concurrent prime sieve` example?", "body": "<ul>\n<li>in a simple way imagine every channel is a set of numbers (first channel which gets fed by <code>generate</code> func contains all integer numbers) with a leading number which is the first one (we get it by <code>prime := &lt;-ch</code>). then it checks if other numbers of the set (numbers sent to channel) is prime from the leadeing number, and put primes to the next set. notice it keeps going in the background (and you will run out of memory space ofc) and proceed to the next level which is using the next number set (or channel) and compare its numbers with leading number and so on. so the first element of every channel is prime (mathematical logic) and other numbers will survive (get to next channel) only if its prime to first element</li>\n<li>the reason 10 is checked once is it gets out of system when we check it compare it with 2 cuase its not prime to 2, but you can see that numbers like 19 which is prime to every number below it get checked by every lower prime number till 17</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 6579, "user_id": 3259128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a34a698cbdf0380f41883d2604d40c0?s=128&d=identicon&r=PG", "display_name": "rista404", "link": "https://stackoverflow.com/users/3259128/rista404"}, "is_accepted": false, "score": 0, "last_activity_date": 1586111692, "creation_date": 1586111692, "answer_id": 61047569, "question_id": 52179456, "link": "https://stackoverflow.com/questions/52179456/can-i-get-some-help-to-reason-about-the-concurrent-prime-sieve-example/61047569#61047569", "title": "Can I get some help to reason about the `concurrent prime sieve` example?", "body": "<p>I had the same questions, and wrote <a href=\"https://risticnikola.com/sieve-of-eratosthenes-in-go\" rel=\"nofollow noreferrer\">an article</a> after figuring it out. Hope it helps.</p>\n"}], "owner": {"reputation": 4483, "user_id": 2801947, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/88a27d87ce6a8c5e02bc7322ca651910?s=128&d=identicon&r=PG&f=1", "display_name": "Xiaohe Dong", "link": "https://stackoverflow.com/users/2801947/xiaohe-dong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 178, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1586111692, "creation_date": 1536132546, "last_edit_date": 1536133057, "question_id": 52179456, "link": "https://stackoverflow.com/questions/52179456/can-i-get-some-help-to-reason-about-the-concurrent-prime-sieve-example", "title": "Can I get some help to reason about the `concurrent prime sieve` example?", "body": "<p>I am very new to go, Can someone help me to reason about this example:</p>\n\n<pre><code>// A concurrent prime sieve\n\npackage main\n\n// Send the sequence 2, 3, 4, ... to channel 'ch'.\nfunc Generate(ch chan&lt;- int) {\n    for i := 2; ; i++ {\n        ch &lt;- i // Send 'i' to channel 'ch'.\n    }\n}\n\n// Copy the values from channel 'in' to channel 'out',\n// removing those divisible by 'prime'.\nfunc Filter(in &lt;-chan int, out chan&lt;- int, prime int) {\n    for {\n        i := &lt;-in // Receive value from 'in'.\n        println(\"debug\", i, prime)\n        if i%prime != 0 {\n            out &lt;- i // Send 'i' to 'out'.\n        }\n    }\n}\n\n// The prime sieve: Daisy-chain Filter processes.\nfunc main() {\n    ch := make(chan int) // Create a new channel.\n    go Generate(ch)      // Launch Generate goroutine.\n    for i := 0; i &lt; 10; i++ {\n        prime := &lt;-ch\n        print(prime, \"\\n\")\n        ch1 := make(chan int)\n        go Filter(ch, ch1, prime)\n        ch = ch1\n    }\n}\n</code></pre>\n\n<p>(<a href=\"https://play.golang.org/p/Txr-_99NbbL\" rel=\"nofollow noreferrer\">Go Playground</a>)</p>\n\n<p>There were 2 points I am still very confused, it would be much appreciated if some one can give me some insight about the code.</p>\n\n<ol>\n<li><p><code>ch = ch1</code> it looks elegant, the result is defnitely inaccurate without this line, but I don\u2019t know the details why need to keep updating the input channel with output channel. </p></li>\n<li><p>I also added some debug information. I am very surprised all non prime number is filtered out very efficiently. i.e 10 (not prime) is just checked once. There was no <code>debug 10 3</code> after <code>debug 10 2</code>. I suspect it is <code>if i%prime != 0</code> do the trick. but how is consistently working with number <code>9</code>.</p></li>\n</ol>\n\n<p>Debug output:</p>\n\n<pre><code>debug 9 2\ndebug 9 3\ndebug 10 2\ndebug 11 2\ndebug 11 3\n</code></pre>\n"}, {"tags": ["go", "sha256", "hmac"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536126821, "post_id": 52177885, "comment_id": 91305917, "body": "Please explain why the second version should work when you reuse the same hmac for all signatures? The second version is wrong, the first okay. So use the first."}, {"owner": {"reputation": 19, "user_id": 1275628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1a1d7eee6b9f02e60a55e00630d49b2?s=128&d=identicon&r=PG", "display_name": "user1275628", "link": "https://stackoverflow.com/users/1275628/user1275628"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536127072, "post_id": 52177885, "comment_id": 91306009, "body": "Ok, at least it should fail with second request (with your point), but it fails with first request. I think that hmac is just generator.. Is not it?"}, {"owner": {"reputation": 19, "user_id": 1275628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1a1d7eee6b9f02e60a55e00630d49b2?s=128&d=identicon&r=PG", "display_name": "user1275628", "link": "https://stackoverflow.com/users/1275628/user1275628"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536127499, "post_id": 52177885, "comment_id": 91306203, "body": "h.Reset() helps after h.Sum(nil) helps me."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536127762, "post_id": 52177885, "comment_id": 91306318, "body": "You did not show show code that demonstrates that the second does not produce the same output than the first. I claim they work the same on first invocation: <a href=\"https://play.golang.org/p/GTtoR6r2kpz\" rel=\"nofollow noreferrer\">play.golang.org/p/GTtoR6r2kpz</a> . And yes. Reseting the Hash should work."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536127861, "post_id": 52177885, "comment_id": 91306372, "body": "Btw: Instead of <code>h.Write(token); h.Sum(nil)</code> just do a <code>h.Sum(token)</code>."}, {"owner": {"reputation": 19, "user_id": 1275628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1a1d7eee6b9f02e60a55e00630d49b2?s=128&d=identicon&r=PG", "display_name": "user1275628", "link": "https://stackoverflow.com/users/1275628/user1275628"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536218037, "post_id": 52177885, "comment_id": 91345960, "body": "Ok, thank you! I try it."}], "answers": [{"tags": [], "owner": {"reputation": 191, "user_id": 5414295, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZZidugW_NxY/AAAAAAAAAAI/AAAAAAAAABc/mOmrcicYubY/photo.jpg?sz=128", "display_name": "TTKDroid", "link": "https://stackoverflow.com/users/5414295/ttkdroid"}, "is_accepted": false, "score": 0, "last_activity_date": 1536389909, "last_edit_date": 1536389909, "creation_date": 1536389520, "answer_id": 52232793, "question_id": 52177885, "link": "https://stackoverflow.com/questions/52177885/golang-crypto-hmac-global-hash-object/52232793#52232793", "title": "Golang crypto/hmac global hash object", "body": "<p>Try this, it may be failing due to base64 padding. Use <code>RawStdEncoding</code> instead</p>\n\n<pre><code>func HMAC256(payload string, secret string) string {\n   sig := hmac.New(sha256.New,[]byte(secret))\n   sig.Write([]byte(payload))\n   return b64Encode(string(sig.Sum(nil)[:]))\n}\n\n\nfunc b64Encode(text string) string {\n   return base64.RawStdEncoding.EncodeToString([]byte(text))\n }\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 1275628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1a1d7eee6b9f02e60a55e00630d49b2?s=128&d=identicon&r=PG", "display_name": "user1275628", "link": "https://stackoverflow.com/users/1275628/user1275628"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 373, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1536389909, "creation_date": 1536126423, "question_id": 52177885, "link": "https://stackoverflow.com/questions/52177885/golang-crypto-hmac-global-hash-object", "title": "Golang crypto/hmac global hash object", "body": "<p>I try to use global hmac hash for generating signature. Code works well, but generated signature doesn't satisfy 3rd party integration checker. If hmac hash will be created for each 'signature generation' process it will works fine.</p>\n\n<p>Works fine - signature is accepted by 3rd party:</p>\n\n<pre><code>func tokenSignatureFunc(key string) tokenSignType {\n    signToken := func(token string) []byte {\n        h := hmac.New(sha256.New, []byte(key))\n        h.Write([]byte(token))\n        signature := h.Sum(nil)\n        base64Signature := make([]byte, base64.StdEncoding.EncodedLen(len(signature)))\n        base64.StdEncoding.Encode(base64Signature, signature)\n        return base64Signature\n    }\n    return signToken\n}\n</code></pre>\n\n<p>Doesn't work - signature is not accepted by 3rd party:</p>\n\n<pre><code>func tokenSignatureFunc(key string) tokenSignType {\n    h := hmac.New(sha256.New, []byte(key))\n    signToken := func(token string) []byte {\n        h.Write([]byte(token))\n        signature := h.Sum(nil)\n        base64Signature := make([]byte, base64.StdEncoding.EncodedLen(len(signature)))\n        base64.StdEncoding.Encode(base64Signature, signature)\n        return base64Signature\n    }\n    return signToken\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "is_accepted": false, "score": 4, "last_activity_date": 1536125800, "last_edit_date": 1536125800, "creation_date": 1536125355, "answer_id": 52177664, "question_id": 52177142, "link": "https://stackoverflow.com/questions/52177142/why-i-got-j-0-rather-than-777/52177664#52177664", "title": "Why I got j 0 rather than 777", "body": "<p>TL;DR: Use <code>unsafe.Offsetof()</code> instead of <code>unsafe.Sizeof()</code>. See <a href=\"https://stackoverflow.com/questions/381244/purpose-of-memory-alignment#381368\">Purpose of memory alignment</a> for more information.</p>\n\n<p>Fields in a struct (or even variables) don't necessarily occur immediately\nafter the other in memory. It is possible that there are gaps due to how the\ndata types are aligned. This alignment differs based on the word size and the\nsize of the data type.</p>\n\n<p>In your example, you're trying to access <code>v.j</code> using pointer arithmetic by\nadding to the pointer of <code>v.i</code> the size of <code>v.i</code> (which is 4 bytes). This will\nhappen to work alright on 32-bit systems because the word size there is 4 bytes\nand the next field, <code>v.j</code>, will be aligned to 4 bytes in memory. Try it out by\nsetting the environment variable <code>GOARCH=386</code> before executing the program\n(<code>386</code> is a 32-bit architecture). </p>\n\n<p>On a 64-bit system though, <code>v.j</code> will be aligned to 8 bytes in memory so that\nthe processor can fetch the whole 8-byte field from memory in one shot. If it was\nnot aligned to 8 bytes (the word size), it would need two fetches to get the\nwhole value since it would be stored in two different words. As a result, the value at <code>&amp;v.i</code> + 4 bytes is not the start point\nof <code>v.j</code>. It instead points to an area of memory that's <strong>not</strong> allocated to any field, and hence <code>v.j</code> isn't actually modified.</p>\n\n<p>The right way to do it though is to get Go to give you the information of where\n<code>v.j</code> starts in memory using <code>unsafe.Offsetof(v.j)</code>. You can then store an\n<code>int64</code> value in that location.</p>\n\n<p>Here's a slightly modified version of your code to demonstrate the problem. It\nprints the hex values of each byte in the struct.</p>\n\n<pre><code>// Slightly modified original code to print all the bytes in the struct\npackage main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype V struct {\n    i int32\n    j int64\n}\n\nfunc (v *V) PrintI() {\n    fmt.Println(v.i)\n}\nfunc (v *V) PrintJ() {\n    fmt.Println(v.j)\n}\n\n// PrintStruct prints every byte in the struct individually\nfunc (v *V) PrintStruct() {\n    for i := uintptr(0); i &lt; unsafe.Sizeof(*v); i++ {\n        b := (*byte)(unsafe.Pointer(uintptr(unsafe.Pointer(v)) + i))\n        fmt.Printf(\"%2d %02x\\n\", i, *b)\n    }\n}\n\nfunc main() {\n    v := new(V)\n    iPointer := (*int32)(unsafe.Pointer(v))\n    // Use hex values so they're easy to see in the output\n    *iPointer = int32(0x01020304) // 4 bytes\n    jPointer := (*int64)(unsafe.Pointer(uintptr(unsafe.Pointer(v)) + uintptr(unsafe.Sizeof(int32(0)))))\n    *jPointer = int64(0x08090A0B0C0D0E0F) // 8 bytes\n\n    fmt.Println(\"Assign using offset Sizeof\")\n    v.PrintStruct()\n    fmt.Println(\"\")\n\n    v = new(V)\n    v.i = 0x01020304\n    v.j = 0x08090A0B0C0D0E0F\n    fmt.Println(\"Assign directly to the fields\")\n    v.PrintStruct()\n}\n</code></pre>\n\n<p>This is the output I get when running on a 64-bit machine which stores data in little endian order:</p>\n\n<pre><code>Assign using offset Sizeof\n 0 04\n 1 03\n 2 02\n 3 01\n 4 0f\n 5 0e\n 6 0d\n 7 0c\n 8 0b\n 9 0a\n10 09\n11 08\n12 00\n13 00\n14 00\n15 00\n\nAssign directly to the fields\n 0 04\n 1 03\n 2 02\n 3 01\n 4 c0\n 5 00\n 6 00\n 7 00\n 8 0f\n 9 0e\n10 0d\n11 0c\n12 0b\n13 0a\n14 09\n15 08\n</code></pre>\n\n<p>Notice how the value gets assigned to a different (incorrect) location in\nmemory when using trying to store the value at an offset of the size of\n<code>int32</code>. Change <code>unsafe.Sizeof(int32(0))</code> to <code>unsafe.Offsetof(v.j)</code> and that\nshould give you the right result.</p>\n"}], "owner": {"reputation": 349, "user_id": 6403253, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wOwRz.jpg?s=128&g=1", "display_name": "Layne Liu", "link": "https://stackoverflow.com/users/6403253/layne-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1536125800, "creation_date": 1536122237, "question_id": 52177142, "link": "https://stackoverflow.com/questions/52177142/why-i-got-j-0-rather-than-777", "title": "Why I got j 0 rather than 777", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype V struct {\n    i int32\n    j int64\n}\n\nfunc (v *V) PrintI() {\n    fmt.Println(v.i)\n}\nfunc (v *V) PrintJ() {\n    fmt.Println(v.j)\n}\n\nfunc main() {\n    v := new(V)\n    iPointer := (*int32)(unsafe.Pointer(v))\n    *iPointer = int32(666)\n    v.PrintI()\n    jPointer := (*int64)(unsafe.Pointer(uintptr(unsafe.Pointer(v)) + uintptr(unsafe.Sizeof(int32(0)))))\n    *jPointer = int64(777)\n    v.PrintJ()\n}\n</code></pre>\n\n<p>I get the sample code from [<a href=\"https://studygolang.com/articles/1414]\" rel=\"nofollow noreferrer\">https://studygolang.com/articles/1414]</a>, I can't figure out why I always get j's value is 0.</p>\n"}, {"tags": ["go", "gorp"], "comments": [{"owner": {"reputation": 1716, "user_id": 695867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45d624c0405e2368e571c51fccc69704?s=128&d=identicon&r=PG", "display_name": "Sam Choukri", "link": "https://stackoverflow.com/users/695867/sam-choukri"}, "edited": false, "score": 0, "creation_date": 1536183904, "post_id": 52177007, "comment_id": 91337316, "body": "Do your types have only non-exported fields? Only exported fields will be serialized to json."}, {"owner": {"reputation": 1780, "user_id": 1010240, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c24b19732194b2f91249a8ee69e6a386?s=128&d=identicon&r=PG", "display_name": "rsan", "link": "https://stackoverflow.com/users/1010240/rsan"}, "reply_to_user": {"reputation": 1716, "user_id": 695867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45d624c0405e2368e571c51fccc69704?s=128&d=identicon&r=PG", "display_name": "Sam Choukri", "link": "https://stackoverflow.com/users/695867/sam-choukri"}, "edited": false, "score": 0, "creation_date": 1536185265, "post_id": 52177007, "comment_id": 91337728, "body": "Nop, all are exported fields. And if I duplicate the code as shown it works. If I try to compose using the Base struct as mentioned by @danicheeta I get empty data."}], "answers": [{"comments": [{"owner": {"reputation": 1780, "user_id": 1010240, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c24b19732194b2f91249a8ee69e6a386?s=128&d=identicon&r=PG", "display_name": "rsan", "link": "https://stackoverflow.com/users/1010240/rsan"}, "edited": false, "score": 0, "creation_date": 1536159773, "post_id": 52178111, "comment_id": 91326276, "body": "Hi @danicheeta, I already tested that but It does&#39;t work. I guess the SQL library in Go uses reflection to read the types of this Scan and Value function so it returns a wrong Json where the Marshal and Unmarshal is executed in the Base class and not in the Type2, Type3, Type4."}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "reply_to_user": {"reputation": 1780, "user_id": 1010240, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c24b19732194b2f91249a8ee69e6a386?s=128&d=identicon&r=PG", "display_name": "rsan", "link": "https://stackoverflow.com/users/1010240/rsan"}, "edited": false, "score": 0, "creation_date": 1536170161, "post_id": 52178111, "comment_id": 91331681, "body": "no, it simply calls scan in <a href=\"https://golang.org/src/database/sql/convert.go#L341\" rel=\"nofollow noreferrer\">here</a> ,can you give more info about the error ? put a panic in begining of scan to see if its even being called"}, {"owner": {"reputation": 1780, "user_id": 1010240, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c24b19732194b2f91249a8ee69e6a386?s=128&d=identicon&r=PG", "display_name": "rsan", "link": "https://stackoverflow.com/users/1010240/rsan"}, "edited": false, "score": 0, "creation_date": 1536177712, "post_id": 52178111, "comment_id": 91334974, "body": "Thanks for the reply @danicheeta, the main problem is not in golang SQL but because when adding the new Base struct it breake my JSON transformation. I elaborated the question putting some examples."}, {"owner": {"reputation": 1716, "user_id": 695867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45d624c0405e2368e571c51fccc69704?s=128&d=identicon&r=PG", "display_name": "Sam Choukri", "link": "https://stackoverflow.com/users/695867/sam-choukri"}, "edited": false, "score": 0, "creation_date": 1536196679, "post_id": 52178111, "comment_id": 91339993, "body": "This will not work because the embedded struct <code>Base</code> cannot access the other fields of the embedding structs <code>Type2</code>, <code>Type3</code>, and <code>Type4</code>. Because struct embedding is composition and not inheritance, <code>Type2</code> (and the others) <i>has a</i> <code>Base</code>, but <i>is NOT a</i> <code>Base</code>. Calling <code>Type2.Value()</code> resolves to <code>Type2.Base.Value()</code> which only has access to the <code>Base</code> value. It returns an empty json string <code>{}</code> simply because the <code>Base</code> value does not have any fields. Try adding a dummy exported field to the <code>Base</code> struct and see if it gets serialized."}, {"owner": {"reputation": 1780, "user_id": 1010240, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c24b19732194b2f91249a8ee69e6a386?s=128&d=identicon&r=PG", "display_name": "rsan", "link": "https://stackoverflow.com/users/1010240/rsan"}, "reply_to_user": {"reputation": 1716, "user_id": 695867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45d624c0405e2368e571c51fccc69704?s=128&d=identicon&r=PG", "display_name": "Sam Choukri", "link": "https://stackoverflow.com/users/695867/sam-choukri"}, "edited": false, "score": 0, "creation_date": 1536201292, "post_id": 52178111, "comment_id": 91340960, "body": "@SamChoukri yes, exactly that is what happens. So returning to the original question, is there a way to avoid all that code duplication? Maybe is just my stubbornness coming from functional or POO languages that I feel that I should get rid of all those duplicated methods... :)"}, {"owner": {"reputation": 1716, "user_id": 695867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45d624c0405e2368e571c51fccc69704?s=128&d=identicon&r=PG", "display_name": "Sam Choukri", "link": "https://stackoverflow.com/users/695867/sam-choukri"}, "reply_to_user": {"reputation": 1780, "user_id": 1010240, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c24b19732194b2f91249a8ee69e6a386?s=128&d=identicon&r=PG", "display_name": "rsan", "link": "https://stackoverflow.com/users/1010240/rsan"}, "edited": false, "score": 0, "creation_date": 1536203231, "post_id": 52178111, "comment_id": 91341312, "body": "@rsan You can use <code>go generate</code> to automate the creation of the nearly duplicate methods (probably not worth it for just a few types). Or wait for generics coming in Go 2.0."}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1536474014, "post_id": 52178111, "comment_id": 91432267, "body": "Sam is right, the whole approach was wrong. came up with an idea using interfaces. are you comfortable using it in your struct ?"}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 0, "last_activity_date": 1536127550, "creation_date": 1536127550, "answer_id": 52178111, "question_id": 52177007, "link": "https://stackoverflow.com/questions/52177007/avoid-duplicated-code-when-rewriting-scan-and-value-methods-in-each-type-when-us/52178111#52178111", "title": "Avoid duplicated code when rewriting Scan and Value methods in each type when usign go sql", "body": "<p>here's a solution:</p>\n\n<pre><code>type Base struct {}\n\ntype Type2 struct { Base, some primitives... }\ntype Type3 struct { Base, some primitives... }\ntype Type4 struct { Base, some primitives... }\n\nfunc (q Base) Value() (driver.Value, error) {\n    return json.Marshal(q)\n}\n\nfunc (q *Base) Scan(src interface{}) error {\n    source, _ := src.([]byte)\n    if string(source) == \"null\" {\n        return nil\n    }\n    return json.Unmarshal(source, q)\n}\n</code></pre>\n\n<p>notice that Base embeded in structs should not have a var before it (i mean <code>type Type2 struct { b Base, some primitives... }</code>)</p>\n"}], "owner": {"reputation": 1780, "user_id": 1010240, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c24b19732194b2f91249a8ee69e6a386?s=128&d=identicon&r=PG", "display_name": "rsan", "link": "https://stackoverflow.com/users/1010240/rsan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536178378, "creation_date": 1536121176, "last_edit_date": 1536178378, "question_id": 52177007, "link": "https://stackoverflow.com/questions/52177007/avoid-duplicated-code-when-rewriting-scan-and-value-methods-in-each-type-when-us", "title": "Avoid duplicated code when rewriting Scan and Value methods in each type when usign go sql", "body": "<p>Golan SQL plus Gorp expect that all types include a Scan and Value method attached to the type in order to read the Rows to a struct. This is adding a lot of boilerplate code in my project even when the methods can be generalized because I am writing JSON to this columns.</p>\n\n<pre><code>type Type1 struct {\n Type2 Type2\n Type3 Type3\n Type4 Type4\n}\n\ntype Type2 struct { some primitives... }\ntype Type3 struct { some primitives... }\ntype Type4 struct { some primitives... }\n\n\nfunc (q Type2) Value() (driver.Value, error) {\n    return json.Marshal(q)\n}\n\nfunc (q *Type2) Scan(src interface{}) error {\n    source, _ := src.([]byte)\n    if string(source) == \"null\" {\n        return nil\n    }\n    return json.Unmarshal(source, q)\n}\n\nfunc (q Type3) Value() (driver.Value, error) {\n    return json.Marshal(q)\n}\n\nfunc (q *Type3) Scan(src interface{}) error {\n    source, _ := src.([]byte)\n    if string(source) == \"null\" {\n        return nil\n    }\n    return json.Unmarshal(source, q)\n}\n\nfunc (q Type4) Value() (driver.Value, error) {\n    return json.Marshal(q)\n}\n\nfunc (q *Type4) Scan(src interface{}) error {\n    source, _ := src.([]byte)\n    if string(source) == \"null\" {\n        return nil\n    }\n    return json.Unmarshal(source, q)\n}\n</code></pre>\n\n<p>Is there a way to avoid defining all those identical Value and Scan Methods for each of my Structs?</p>\n\n<p>The table should look like this:</p>\n\n<pre><code>Table: Type1\n-----------------------\nROW   Type2                Type3               Type4\n1     {\"name\": \"MyName\"}   {\"other\": \"bla\"}    {\"other\": \"bla\"}\n</code></pre>\n\n<p>I tried using composition as @danicheeta recommend:</p>\n\n<pre><code>type Base struct {} \ntype Type2 struct { Base, some primitives... }\n\nfunc (q Base) Value() (driver.Value, error) {\n    return json.Marshal(q)\n}\n\nfunc (q *Base) Scan(src interface{}) error {\n    source, _ := src.([]byte)\n    if string(source) == \"null\" {\n        return nil\n    }\n    return json.Unmarshal(source, q)\n}\n</code></pre>\n\n<p>But if I execute an insert to the database the result is:</p>\n\n<pre><code>Table: Type1\n-----------------------\nROW   Type2                Type3               Type4\n1     {}                   {}                  {}\n</code></pre>\n\n<p>Similarly if I have already inserted \"manually\" in the database this:</p>\n\n<pre><code>Table: Type1\n    -----------------------\n    ROW   Type2                Type3               Type4\n    1     {\"name\": \"MyName\"}   {\"other\": \"bla\"}    {\"other\": \"bla\"}\n</code></pre>\n\n<p>And try to do a <code>select * from Type1</code> I get:</p>\n\n<pre><code>Type1: {\n   Type2: {}\n   Type3: {}\n   Type4: {}\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1721, "user_id": 9070959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3fc72be4dddc4ff4156a7d875912d67?s=128&d=identicon&r=PG&f=1", "display_name": "emsimpson92", "link": "https://stackoverflow.com/users/9070959/emsimpson92"}, "edited": false, "score": 2, "creation_date": 1536103482, "post_id": 52175143, "comment_id": 91301094, "body": "Why would you be able to take the address of an undeclared variable? If it doesn&#39;t exist in the memory you can&#39;t get the address."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1536104033, "post_id": 52175143, "comment_id": 91301192, "body": "<a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">Addressability is discussed in the language specifcaiton</a>. The int32 value 0 is not addressable."}, {"owner": {"reputation": 347, "user_id": 7037030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oizYo.jpg?s=128&g=1", "display_name": "Vitaliy Andrianov", "link": "https://stackoverflow.com/users/7037030/vitaliy-andrianov"}, "edited": false, "score": 0, "creation_date": 1536104831, "post_id": 52175143, "comment_id": 91301332, "body": "Thanks! But is there any other standard method that creates pointer? As I can see, this works just fine... func getAdress(s int32) *int32 { \treturn &amp;s }"}, {"owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "edited": false, "score": 4, "creation_date": 1536106345, "post_id": 52175143, "comment_id": 91301587, "body": "@VitaliyAndrianovin this particular case, you can use <code>new(int32)</code> to create a pointer to an <code>int32</code> with value <code>0</code>. If you need a pointer to a non-zero value, a variable declaration would be necessary. You can then pass a pointer to the variable. (you can&#39;t pass a pointer to a constant)"}, {"owner": {"reputation": 347, "user_id": 7037030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oizYo.jpg?s=128&g=1", "display_name": "Vitaliy Andrianov", "link": "https://stackoverflow.com/users/7037030/vitaliy-andrianov"}, "edited": false, "score": 0, "creation_date": 1536107861, "post_id": 52175143, "comment_id": 91301848, "body": "Ok it was a bad example with 0 constant =D. I&#39;ll replace it with <code>time.Now().Unix()</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1536108058, "post_id": 52175143, "comment_id": 91301883, "body": "Either assign to a variable or write a the <code>getAddress</code> helper as you propose.  Why do you need the address?  Perhaps there&#39;s a higher-level problem that can be solved without taking the address of a function return."}, {"owner": {"reputation": 347, "user_id": 7037030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oizYo.jpg?s=128&g=1", "display_name": "Vitaliy Andrianov", "link": "https://stackoverflow.com/users/7037030/vitaliy-andrianov"}, "edited": false, "score": 0, "creation_date": 1536108714, "post_id": 52175143, "comment_id": 91301991, "body": "Just trying to .Marshal() big message with protobuf. So I have to use automatically generated code from .proto file. And this code has strange signature with lots of pointers"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1536115337, "creation_date": 1536115337, "answer_id": 52176323, "question_id": 52175143, "link": "https://stackoverflow.com/questions/52175143/pointer-to-expression-result-in-go/52176323#52176323", "title": "Pointer to expression result in go", "body": "<p>In the question comments, OP says that the pointers are needed for a protobuf message.</p>\n\n<p>The <a href=\"https://godoc.org/github.com/golang/protobuf/proto\" rel=\"nofollow noreferrer\">proto</a> package provides helper functions for creating pointers to integers and other values.</p>\n\n<p>Use the <a href=\"https://godoc.org/github.com/golang/protobuf/proto#Uint32\" rel=\"nofollow noreferrer\">proto.Uint32</a> function to get a pointer to a uint32.</p>\n\n<pre><code>x.Time = proto.Uint32(u)\n</code></pre>\n"}], "owner": {"reputation": 347, "user_id": 7037030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oizYo.jpg?s=128&g=1", "display_name": "Vitaliy Andrianov", "link": "https://stackoverflow.com/users/7037030/vitaliy-andrianov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 52176323, "answer_count": 1, "score": -2, "last_activity_date": 1536115337, "creation_date": 1536103310, "last_edit_date": 1536108000, "question_id": 52175143, "link": "https://stackoverflow.com/questions/52175143/pointer-to-expression-result-in-go", "title": "Pointer to expression result in go", "body": "<p>Can I create a pointer to expression result without making new variable in Go?</p>\n\n<pre><code>package test\n\nfunc foo(*uint32) {\n\n}\n\nfunc main() {\n    foo(&amp;(uint32(time.Now().Unix()))) //this line gives me error\n    //cannot take the address of uint32(...\n}\n</code></pre>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 3, "creation_date": 1536099507, "post_id": 52174644, "comment_id": 91300230, "body": "You&#39;re trying to pass an <code>T2</code> to a function which wants a <code>anotherPackage.S1</code>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1536118749, "post_id": 52174644, "comment_id": 91303722, "body": "If the compiler tells you you cannot do it than you cannot do it. Go is statically typed with no inheritance. You must provide the correct type. So what is the <i>actual</i> question?"}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1536113960, "post_id": 52176179, "comment_id": 91302810, "body": "&quot;because Go does not support polymorphism&quot; --- go provides (parametric) polymorphism via interfaces."}, {"owner": {"reputation": 21, "user_id": 10317676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a34d1d201c7b30d0143c3d6fbe2b4e5?s=128&d=identicon&r=PG", "display_name": "tomocy", "link": "https://stackoverflow.com/users/10317676/tomocy"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1536125210, "post_id": 52176179, "comment_id": 91305315, "body": "@zerkms oh yes!"}], "tags": [], "owner": {"reputation": 21, "user_id": 10317676, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a34d1d201c7b30d0143c3d6fbe2b4e5?s=128&d=identicon&r=PG", "display_name": "tomocy", "link": "https://stackoverflow.com/users/10317676/tomocy"}, "is_accepted": false, "score": 2, "last_activity_date": 1536113796, "creation_date": 1536113796, "answer_id": 52176179, "question_id": 52174644, "link": "https://stackoverflow.com/questions/52174644/golang-cannot-use-type-as-type-in-argument/52176179#52176179", "title": "Golang cannot use type as type in argument", "body": "<p>You cannot do that in Go like other Object-oriented language because Go does not support polymorphism. How about using T1 interface as the parameter to ExportedFunction instead of S1.\nexample\n<a href=\"https://play.golang.org/p/72hgbSwNkaS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/72hgbSwNkaS</a></p>\n"}], "owner": {"reputation": 151, "user_id": 8383300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41350d223ff4a6f43472bbc2fa53c78d?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Murin", "link": "https://stackoverflow.com/users/8383300/jacob-murin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4961, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1555563877, "creation_date": 1536099297, "last_edit_date": 1555563877, "question_id": 52174644, "link": "https://stackoverflow.com/questions/52174644/golang-cannot-use-type-as-type-in-argument", "title": "Golang cannot use type as type in argument", "body": "<p>I am new to Go language and I am trying to get familiar with interfaces and their assignability. </p>\n\n<p>I am trying to pass an argument from a <code>struct</code> into a <code>function</code> which is imported from another <code>package</code>.</p>\n\n<p><strong>main.go</strong> package:</p>\n\n<pre><code>package main  \n\nimport {\n  anotherPackage\n}\n\ntype I1 interface {\n  anotherPackage.I2\n}\n\ntype T1 struct {\n  *anotherPackage.S1\n}\n\ntype T2 struct {\n  variable1 T1\n}\n\ntype T3 struct {\n  variable2 T2\n}\n\nfunc handler() {\n  var fromI I\n  var input = T3{}\n\n  template := fromI.ExportedFunction(input.T3.variable1)\n}\n\nfunc main() {\n  handler()\n}\n</code></pre>\n\n<p><strong>anotherPackage.go</strong> package</p>\n\n<pre><code>package anotherPackage\n\ntype I2 interface {\n  ExportedFunction(S1)\n}\n\ntype S1 struct {\n  Path string\n  File string\n}\n\ntype S2 struct {}\n\nfunc (s2 *S2) ExportedFunction(s1 S1) {}\n</code></pre>\n\n<p>I keep getting an error:  </p>\n\n<blockquote>\n  <p><code>cannot use input.T3.variable1 (type T1) as type anotherPackage.S1 in argument to fromI.ExportedFunction</code></p>\n</blockquote>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 7910369, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ce9483d46ec95699188822a70508d9d9?s=128&d=identicon&r=PG&f=1", "display_name": "Al-geBra", "link": "https://stackoverflow.com/users/7910369/al-gebra"}, "edited": false, "score": 0, "creation_date": 1536100518, "post_id": 52174774, "comment_id": 91300443, "body": "Unfortunately, I solved it after some more dabbing. Thanks!"}], "tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": true, "score": 5, "last_activity_date": 1536618850, "last_edit_date": 1536618850, "creation_date": 1536100338, "answer_id": 52174774, "question_id": 52174632, "link": "https://stackoverflow.com/questions/52174632/obtaining-first-character-of-each-string-in-array-of-strings/52174774#52174774", "title": "Obtaining first character of each string in Array of Strings", "body": "<blockquote>\n  <p>something like in java where one has the method/function charAt()</p>\n</blockquote>\n\n<p>In go, strings are immutable byte sequences with the contents encoded in UTF-8. The string representation is roughly, but not exactly, equivalent to a <code>[]byte</code> slice (the distinction is unimportant for the purposes of this answer).</p>\n\n<p>There are various library approaches you can use in go:</p>\n\n<ul>\n<li><p>If your string is guaranteed to consist of ASCII or other single-byte characters, you can simply index the string to recover bytes at arbitrary positions. Indexing the string at the <code>i</code>th position will return the byte at that location. In your case, this would be <code>str[0]</code>.</p></li>\n<li><p>If you specifically seek the first <em>character</em>, rather than the first byte, and your string may contain higher byte order Unicode code points, you need to decode the string as Unicode accordingly. The <a href=\"https://golang.org/pkg/unicode/utf8/\" rel=\"nofollow noreferrer\"><code>unicode/utf8</code></a> package provides support for this. Code like the following in your loop in <code>acronym</code> will properly decode the first UTF-8-encoded rune of each string <code>str</code> for you:</p></li>\n</ul>\n\n<pre class=\"lang-golang prettyprint-override\"><code>for _, str := range arrayOfStrings {\n    r, _ := utf8.DecodeRuneInString(str)\n    acr = acr + string(r)\n}\n</code></pre>\n\n<p>You should note the documentation for the <code>DecodeRuneInString</code> method around error conditions:</p>\n\n<blockquote>\n  <p>If s is empty it returns (RuneError, 0). Otherwise, if the encoding is invalid, it returns (RuneError, 1). Both are impossible results for correct, non-empty UTF-8. </p>\n</blockquote>\n\n<p>If either condition is possible in your system, ensure you add appropriate error handling logic to check the return result.</p>\n"}], "owner": {"reputation": 137, "user_id": 7910369, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ce9483d46ec95699188822a70508d9d9?s=128&d=identicon&r=PG&f=1", "display_name": "Al-geBra", "link": "https://stackoverflow.com/users/7910369/al-gebra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 623, "favorite_count": 0, "accepted_answer_id": 52174774, "answer_count": 1, "score": 0, "last_activity_date": 1536618850, "creation_date": 1536099225, "question_id": 52174632, "link": "https://stackoverflow.com/questions/52174632/obtaining-first-character-of-each-string-in-array-of-strings", "title": "Obtaining first character of each string in Array of Strings", "body": "<p>I am new to golang and I am trying to obtain the first character of a string in an array of strings. It seems like it would be easy, but I don't know how to approach it. Here is what I have done thus far:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"strings\"\n)\n\nfunc acronym(s string) (acr string) {\n\n    // TODO: Your code here\n    var arrayOfStrings []string\n    arrayOfStrings = strings.Split(s, \" \") //split string s into an array of strings based on space delimeter \" \"\n    for _, str := range arrayOfStrings {\n        fmt.Println(str)\n    }\n    return acr\n}\n\nfunc main() {\n    s := \"Pan Galactic Gargle Blaster\"\n    if len(os.Args) &gt; 1 {\n        s = strings.Join(os.Args, \" \")\n    }\n    fmt.Println(acronym(s))\n}\n</code></pre>\n\n<p>I want the resulting string to be PGGB I am a bit stuck as I have only looped through the array of strings, but i can't think of something like in java where one has the method/function charAt(). Thanks!</p>\n"}, {"tags": ["postgresql", "go", "resource-leak"], "answers": [{"tags": [], "owner": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "is_accepted": true, "score": 2, "last_activity_date": 1536134857, "last_edit_date": 1536134857, "creation_date": 1536097926, "answer_id": 52174452, "question_id": 52174361, "link": "https://stackoverflow.com/questions/52174361/if-a-go-sql-db-is-closed-do-any-unclosed-prepared-queries-get-closed/52174452#52174452", "title": "If a Go sql.DB is closed, do any unclosed prepared queries get closed?", "body": "<p>Technically <code>database/sql</code> <a href=\"https://golang.org/pkg/database/sql/#DB.Prepare\" rel=\"nofollow noreferrer\">definitely expects you to close your own prepared statements</a> and doesn't do it for you when the DB or DC is closed.  Further I thought it was possible the server might cleanup the backend memory when your program exits but PostgreSQL will also not clean it up...</p>\n\n<p><a href=\"https://github.com/lib/pq/issues/446\" rel=\"nofollow noreferrer\">https://github.com/lib/pq/issues/446</a></p>\n\n<p>If you get the implicit Prepare then <code>database/sql</code> will handle cleaning up for you but that'll be less efficient if you're running these queries over and over so I'd strongly encourage you to clean up after yourself with a:</p>\n\n<pre><code>defer stmt.Close()\n</code></pre>\n\n<p>or similar.</p>\n"}], "owner": {"reputation": 36033, "user_id": 115751, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/FkIiK.png?s=128&g=1", "display_name": "WilliamKF", "link": "https://stackoverflow.com/users/115751/williamkf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 807, "favorite_count": 0, "accepted_answer_id": 52174452, "answer_count": 1, "score": 4, "last_activity_date": 1536134857, "creation_date": 1536097397, "question_id": 52174361, "link": "https://stackoverflow.com/questions/52174361/if-a-go-sql-db-is-closed-do-any-unclosed-prepared-queries-get-closed", "title": "If a Go sql.DB is closed, do any unclosed prepared queries get closed?", "body": "<p>In a Go program using <code>database/sql</code>, will any unclosed prepared queries be closed when I <code>Close</code> the Postgres DB I'm using?</p>\n\n<p>I've cut this down to a very simple example that does not need the <code>Prepare</code> but still shows the question (I believe I could just pass query string to <code>QueryRow</code> and get an implicit <code>Prepare</code>, but leave it explicit here so I can ask my question):</p>\n\n<pre><code>import (\n    \"database/sql\"\n)\n\n// Store struct is the postgres\ntype Store struct {\n    pq *sql.DB\n}\n\ntype Info struct {\n    ID      string `json:\"id\"`\n    Name    string `json:\"name\"`\n}\n\nfunc (s *Store) GetInfo(id string) Info {\n    defer s.pq.Close()\n    stmt, err := s.pq.Prepare(`\n            SELECT id, name \n            FROM info \n            WHERE id = $1 LIMIT 1\n            `)\n    if err != nil {\n        return Info{}\n    }\n    var res Info\n    _ = stmt.QueryRow(id).Scan(&amp;res.ID, &amp;res.Name)\n    return res\n}\n</code></pre>\n"}, {"tags": ["go", "rune"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1536095866, "post_id": 52174097, "comment_id": 91299109, "body": "Try declaring a rune, not giving it a value and returning it <a href=\"https://golang.org/doc/go1#rune\" rel=\"nofollow noreferrer\">golang.org/doc/go1#rune</a>"}, {"owner": {"reputation": 1203, "user_id": 398520, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8ea6d2ca77fb71eff7882f9744b4de19?s=128&d=identicon&r=PG", "display_name": "user398520", "link": "https://stackoverflow.com/users/398520/user398520"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1536095966, "post_id": 52174097, "comment_id": 91299147, "body": "Tried this already: <code>missing argument to conversion to rune: rune()</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1203, "user_id": 398520, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8ea6d2ca77fb71eff7882f9744b4de19?s=128&d=identicon&r=PG", "display_name": "user398520", "link": "https://stackoverflow.com/users/398520/user398520"}, "edited": false, "score": 1, "creation_date": 1536097023, "post_id": 52174243, "comment_id": 91299522, "body": "I see this in my test: expected: &quot;hello &#39; &quot; \t\t\t         actual  : &quot;hello &#39; \\x00&quot;"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1203, "user_id": 398520, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8ea6d2ca77fb71eff7882f9744b4de19?s=128&d=identicon&r=PG", "display_name": "user398520", "link": "https://stackoverflow.com/users/398520/user398520"}, "edited": false, "score": 0, "creation_date": 1536097079, "post_id": 52174243, "comment_id": 91299538, "body": "Try it here: <a href=\"https://play.golang.org/p/UNH02IuXQJL\" rel=\"nofollow noreferrer\">play.golang.org/p/UNH02IuXQJL</a> Works for me with your <code>yo</code> example"}, {"owner": {"reputation": 1203, "user_id": 398520, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8ea6d2ca77fb71eff7882f9744b4de19?s=128&d=identicon&r=PG", "display_name": "user398520", "link": "https://stackoverflow.com/users/398520/user398520"}, "edited": false, "score": 0, "creation_date": 1536097177, "post_id": 52174243, "comment_id": 91299572, "body": "I used the playground but my test shows a different result including \\x00, rune(-1) works"}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": false, "score": 2, "last_activity_date": 1536096652, "creation_date": 1536096652, "answer_id": 52174243, "question_id": 52174097, "link": "https://stackoverflow.com/questions/52174097/how-to-return-a-blank-rune/52174243#52174243", "title": "How to return a blank rune", "body": "<p>From what I understand, a rune is actually an integer value mapped to a unicode character, so this piece of code actually returns the <code>\\0</code> character if the condition check fails:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"unicode\"\n)\n\nfunc main() {\n    fmt.Println(CleanUp(\"helloworld ' \\x10\"))\n}\n\nfunc CleanUp(s string) string {\n\n    clean := func(r rune) rune {\n        if unicode.IsPrint(r) || r == rune('\\n') {\n            return r\n        }\n        return rune(0)\n    }\n\n    return strings.Map(clean, s)\n}\n</code></pre>\n\n<p>Outputs</p>\n\n<p><code>helloworld '</code></p>\n"}, {"tags": [], "owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "is_accepted": true, "score": 4, "last_activity_date": 1536096951, "creation_date": 1536096951, "answer_id": 52174295, "question_id": 52174097, "link": "https://stackoverflow.com/questions/52174097/how-to-return-a-blank-rune/52174295#52174295", "title": "How to return a blank rune", "body": "<p>If you want to eliminate runes, a \"blank rune\" is not the way to go. That would not eliminate anything.</p>\n\n<p>Assuming you're talking about <a href=\"https://golang.org/pkg/strings/#Map\" rel=\"nofollow noreferrer\"><code>strings.Map</code></a>, the docs say</p>\n\n<blockquote>\n  <p>If mapping returns a negative value, the character is dropped from the string with no replacement.</p>\n</blockquote>\n\n<p>Have your mapper return a negative value to indicate that a rune should be discarded.</p>\n"}], "owner": {"reputation": 1203, "user_id": 398520, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8ea6d2ca77fb71eff7882f9744b4de19?s=128&d=identicon&r=PG", "display_name": "user398520", "link": "https://stackoverflow.com/users/398520/user398520"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3744, "favorite_count": 0, "accepted_answer_id": 52174295, "answer_count": 2, "score": 5, "last_activity_date": 1536147478, "creation_date": 1536095754, "last_edit_date": 1536147478, "question_id": 52174097, "link": "https://stackoverflow.com/questions/52174097/how-to-return-a-blank-rune", "title": "How to return a blank rune", "body": "<p>I'm looking at the <code>string.Map</code> function which must take a mapping function which returns a rune. I would like to eliminate runes that resolves false with a call to: <code>unicode.IsPrint()</code></p>\n\n<p><code>func Map(mapping func(rune) rune, s string) string</code></p>\n\n<p>My function looks something like this:</p>\n\n<pre><code>func main() { \nfunc CleanUp(s string) string {\n\n    clean := func(r rune) rune {\n        if unicode.IsPrint(r) || r == rune('\\n') {\n            return r\n        }\n        return rune('')\n    }\n\nstrings.Map(clean, s)\n}\n</code></pre>\n\n<p>It should clean something like this <code>\"helloworld ' \\x10\"</code> to     <code>\"helloworld ' \"</code></p>\n\n<p>But <code>rune('')</code> is invalid. How can I return a blank or empty rune?</p>\n"}, {"tags": ["go", "undefined", "slice", "shuffle"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536089352, "post_id": 52172794, "comment_id": 91296329, "body": "Please show full code."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1536089958, "post_id": 52172794, "comment_id": 91296602, "body": "The code compiles without errors. <a href=\"https://play.golang.org/p/GMOrI4I6Z5V\" rel=\"nofollow noreferrer\">play.golang.org/p/GMOrI4I6Z5V</a>"}], "answers": [{"comments": [{"owner": {"reputation": 251, "user_id": 3407591, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/dcd13c108bd208b51d40d48973dfd290?s=128&d=identicon&r=PG&f=1", "display_name": "user3407591", "link": "https://stackoverflow.com/users/3407591/user3407591"}, "edited": false, "score": 0, "creation_date": 1536149576, "post_id": 52174043, "comment_id": 91319424, "body": "Thank you, in my course we are using ubuntu terminal on windows. My go installation on windows was up to date but not on the ubuntu terminal. After updating it, everything was working. I thought they used the same go installation, but i guess not."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 7, "last_activity_date": 1536095409, "last_edit_date": 1592644375, "creation_date": 1536095409, "answer_id": 52174043, "question_id": 52172794, "link": "https://stackoverflow.com/questions/52172794/getting-undefined-rand-shuffle-in-golang/52174043#52174043", "title": "Getting undefined rand.Shuffle in golang", "body": "<blockquote>\n<p><a href=\"https://golang.org/doc/go1.10\" rel=\"noreferrer\">Go 1.10 Release Notes</a> (February 2018)</p>\n<p>Minor changes to the library</p>\n<p>math/rand</p>\n<p>The new Shuffle function and corresponding Rand.Shuffle method shuffle an input sequence.</p>\n</blockquote>\n<hr />\n<p>For the <code>rand.Shuffle</code> function, you need at least Go 1.10.</p>\n<p>Run <code>go version</code> to check your version.</p>\n"}], "owner": {"reputation": 251, "user_id": 3407591, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/dcd13c108bd208b51d40d48973dfd290?s=128&d=identicon&r=PG&f=1", "display_name": "user3407591", "link": "https://stackoverflow.com/users/3407591/user3407591"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1392, "favorite_count": 1, "accepted_answer_id": 52174043, "answer_count": 1, "score": 2, "last_activity_date": 1536095409, "creation_date": 1536089095, "last_edit_date": 1536089646, "question_id": 52172794, "link": "https://stackoverflow.com/questions/52172794/getting-undefined-rand-shuffle-in-golang", "title": "Getting undefined rand.Shuffle in golang", "body": "<p>So I have a slice of letters and want to shuffle them.\nI've implemented this code snippet:</p>\n\n<pre><code>rand.Shuffle(len(letters), func(i, j int) {\n    letters[i], letters[j] = letters[j], letters[i]\n)}\n</code></pre>\n\n<p>When running the program it gets stuck at the first line saying: \"undefined: rand.Shuffle\".\nin my import declaration i have imported \"math/rand\"\nI also run this code snippet before the snippet with a problem:</p>\n\n<pre><code>rand.Seed(seed)\n</code></pre>\n\n<p>Where \"seed\" is given earlier in the code.</p>\n\n<p>Also what i want is to shuffle a word but don't touch the first and last letter. Is there an easy solution to this. I have written the code like this:</p>\n\n<pre><code>rand.Shuffle(len(letters), func(i, j int) {\n    if i &gt; 0 &amp;&amp; i &lt; (len(letters) - 1) &amp;&amp; j &gt; 0 &amp;&amp; j &lt; (len(letters) - 1){\n        letters[i], letters[j] = letters[j], letters[i] \n    }\n})\n</code></pre>\n\n<p>Full code:</p>\n\n<pre><code>import (\n    \"math/rand\"\n    \"strings\"\n    \"regexp\"\n)\n\nfunc splitText(text string) []string {\n    re := regexp.MustCompile(\"[A-Za-z0-9']+|[':;?().,!\\\\ ]\")\n    return re.FindAllString(text, -1)\n}\n\nfunc scramble(text string, seed int64) string {\ntoken := splitText(text)\nrand.Seed(seed)\nif len(token) != 0{\n    for i := 0; i &lt; len(token); i++{\n        word := token[i]\n        if len(word) &gt; 3{\n            letters := strings.Split(word, \"\")\n            rand.Shuffle(len(letters), func(i, j int) { \n                if i &gt; 0 &amp;&amp; i &lt; (len(letters) - 1) &amp;&amp; j &gt; 0 &amp;&amp; j &lt; (len(letters) - 1){\n                    letters[i], letters[j] = letters[j], letters[i] \n                }\n            })\n            token[i] = strings.Join(letters, \"\")\n        }\n    }\n}\n\nreturnString := strings.Join(token, \"\")\nreturn returnString\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1198, "user_id": 1406177, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/9d9dd48e5fd672255278b435bd63b661?s=128&d=identicon&r=PG", "display_name": "user1406177", "link": "https://stackoverflow.com/users/1406177/user1406177"}, "edited": false, "score": 0, "creation_date": 1536088952, "post_id": 52172529, "comment_id": 91296142, "body": "It works! One question though? What does the <code>64</code> represent in <code>strconv.ParseUint(s, 2, 64)</code>?"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1198, "user_id": 1406177, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/9d9dd48e5fd672255278b435bd63b661?s=128&d=identicon&r=PG", "display_name": "user1406177", "link": "https://stackoverflow.com/users/1406177/user1406177"}, "edited": false, "score": 0, "creation_date": 1536089460, "post_id": 52172529, "comment_id": 91296375, "body": "it represents the bit size: The bitSize argument specifies the integer type that the result must fit into. Bit sizes 0, 8, 16, 32, and 64 correspond to int, int8, int16, int32, and int64. For a bitSize below 0 or above 64 an error is returned."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1198, "user_id": 1406177, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/9d9dd48e5fd672255278b435bd63b661?s=128&d=identicon&r=PG", "display_name": "user1406177", "link": "https://stackoverflow.com/users/1406177/user1406177"}, "edited": false, "score": 0, "creation_date": 1536089542, "post_id": 52172529, "comment_id": 91296410, "body": "Basically if your bitsize is 8 the biggest number that can fit is 256"}, {"owner": {"reputation": 1198, "user_id": 1406177, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/9d9dd48e5fd672255278b435bd63b661?s=128&d=identicon&r=PG", "display_name": "user1406177", "link": "https://stackoverflow.com/users/1406177/user1406177"}, "edited": false, "score": 0, "creation_date": 1536091020, "post_id": 52172529, "comment_id": 91297093, "body": "What is the longest value <code>s</code> can have? I want <code>s</code> to have 128 values."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1198, "user_id": 1406177, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/9d9dd48e5fd672255278b435bd63b661?s=128&d=identicon&r=PG", "display_name": "user1406177", "link": "https://stackoverflow.com/users/1406177/user1406177"}, "edited": false, "score": 0, "creation_date": 1536092865, "post_id": 52172529, "comment_id": 91297957, "body": "Quote from my answer: <code>bit size (0 to 64)</code>"}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 4, "last_activity_date": 1536088343, "last_edit_date": 1536088343, "creation_date": 1536087765, "answer_id": 52172529, "question_id": 52172290, "link": "https://stackoverflow.com/questions/52172290/binary-string-to-hex/52172529#52172529", "title": "Binary string to hex", "body": "<p>You can do the exact same thing the other way, since <code>ParseInt</code> allows you to pass the base of the number (decimal, hexadecimal, binary, etc.)</p>\n\n<blockquote>\n  <p>ParseInt interprets a string s in the given base (0, 2 to 36) and bit size (0 to 64) and returns the corresponding value i.</p>\n</blockquote>\n\n<p>Then, once you changed the base in the <code>ParseUint</code> call from 16 to 2, you'll need to change your <code>Sprintf</code> call to print the number to hexadecimal, using the <code>%x</code> format flag.</p>\n\n<p>Please note however that using <code>ParseUint</code> followed by a call to <code>Sprintf</code> might not be the most performant solution.</p>\n\n<p>See this example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc parseBinToHex(s string) string {\n    ui, err := strconv.ParseUint(s, 2, 64)\n    if err != nil {\n        return \"error\"\n    }\n\n    return fmt.Sprintf(\"%x\", ui)\n}\n\nfunc main() {\n    fmt.Println(parseBinToHex(\"11101\"))\n}\n</code></pre>\n\n<p>Output gives</p>\n\n<p><code>1d</code></p>\n\n<p>Feel free to play around with it on the <a href=\"https://play.golang.org/p/d7yDh1byOm8\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 1198, "user_id": 1406177, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/9d9dd48e5fd672255278b435bd63b661?s=128&d=identicon&r=PG", "display_name": "user1406177", "link": "https://stackoverflow.com/users/1406177/user1406177"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1635, "favorite_count": 1, "accepted_answer_id": 52172529, "answer_count": 1, "score": 1, "last_activity_date": 1536088539, "creation_date": 1536086642, "question_id": 52172290, "link": "https://stackoverflow.com/questions/52172290/binary-string-to-hex", "title": "Binary string to hex", "body": "<p>I have a string with 128 values like <code>011100010...</code>. I would like to convert this to a hex string. What I found was the other direction:</p>\n\n<pre><code>func partHexToBin(s string) string {\n    ui, err := strconv.ParseUint(s, 16, 8)\n    if err != nil {\n        return \"\"\n    }\n\n    return fmt.Sprintf(\"%016b\", ui)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 1, "creation_date": 1536085540, "post_id": 52171960, "comment_id": 91294816, "body": "so far, you are on the track to creating a function which will accept an interface, and switch code based on type. You shouldn&#39;t be getting any error of the type, &quot;At the moment I get an error, that function expects another type as an input&quot;, can you copy paste the error you are getting here?"}, {"owner": {"reputation": 792, "user_id": 2508468, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/767532940df8fe6804390e133118badc?s=128&d=identicon&r=PG", "display_name": "vdolez", "link": "https://stackoverflow.com/users/2508468/vdolez"}, "edited": false, "score": 0, "creation_date": 1536085655, "post_id": 52171960, "comment_id": 91294863, "body": "If variableFunc is dynamic, maybe it would help to see its pseudo-code or its logic ? Sorry, I don&#39;t quite get what you mean to achieve."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 792, "user_id": 2508468, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/767532940df8fe6804390e133118badc?s=128&d=identicon&r=PG", "display_name": "vdolez", "link": "https://stackoverflow.com/users/2508468/vdolez"}, "edited": false, "score": 0, "creation_date": 1536085997, "post_id": 52171960, "comment_id": 91294997, "body": "@vdolez, I believe it doesn&#39;t really matter in this case, just imagine they are different. Like objA needs <code>objA.x+objA.y</code>, but objB needs <code>objB.z * 150 - objB.n</code>"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1536086061, "post_id": 52171960, "comment_id": 91295029, "body": "@whitespace, if I put interfaces everywhere - I&#39;ll need additional switch-case inside of <code>variableFunc</code> - I wish to avoid it, as one already exists"}, {"owner": {"reputation": 792, "user_id": 2508468, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/767532940df8fe6804390e133118badc?s=128&d=identicon&r=PG", "display_name": "vdolez", "link": "https://stackoverflow.com/users/2508468/vdolez"}, "edited": false, "score": 0, "creation_date": 1536086156, "post_id": 52171960, "comment_id": 91295071, "body": "can&#39;t you pass the variableFunc as a an additional parameter of the encapsulating function ? it seems to me this functions are already defined somewhere (maybe in a DB ?) and not so <i>dynamic</i>"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 792, "user_id": 2508468, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/767532940df8fe6804390e133118badc?s=128&d=identicon&r=PG", "display_name": "vdolez", "link": "https://stackoverflow.com/users/2508468/vdolez"}, "edited": false, "score": 0, "creation_date": 1536086326, "post_id": 52171960, "comment_id": 91295122, "body": "@vdolez, true, logics are static and known, but dynamic is <code>variableFunc</code> which applies needed logic. How do I pass a function which can also be changed? Again <code>if .. else ..</code> inside a loop?"}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 1, "creation_date": 1536086521, "post_id": 52171960, "comment_id": 91295187, "body": "@Alexey, why? if variableFunc is a function which is meant to handle a specific type, it can be done by type-asserting the interface <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">tour.golang.org/methods/15</a>. On the other hand if you are creating a multi interface variable type function inside another dynamic function, you will indeed end up using more switch statements. So the question here, is the encapsulating function and the variableFunc both meant to be &quot;dynamic&quot;, or is the encapsulating function &quot;static&quot;, while variableFunc is &quot;dynamic&quot;?"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1536086803, "post_id": 52171960, "comment_id": 91295306, "body": "@whitespace, every struct requires specific existing and predefined logic/function - it is known. I don&#39;t know how to call needed function depending on the <b>dynObject</b> type, without additional switch-case"}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1536087374, "post_id": 52171960, "comment_id": 91295542, "body": "@Alexey, I may be wrong but I think &quot;Of course I tried to create a predefined func., and with interfaces then somehow redefine it inside of existing switch-case&quot;  is the easiest approach. If you tried creating the functions using interface type, it would not work, that might be your issue."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1536087924, "post_id": 52171960, "comment_id": 91295748, "body": "@whitespace, for example, I tried predefining like this: <code>var variableFunc func(interface{}, *Human) int</code> - it doesn&#39;t work, as I can&#39;t put another function atop of it later. Can you show a working example?"}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 2, "creation_date": 1536103126, "post_id": 52171960, "comment_id": 91301031, "body": "Couldn&#39;t you just add 2 functions to each of the structs (like <code>DoWork()</code> and <code>HandleHuman(*Human) int</code>) which implement the struct-specific logic? Then you could also create an interface, which contains these functions and your base function can take an argument of that interface type. Then all you have to do is call the 2 functions. This approach also gets rid of the first switch, as you only have to call the <code>DoWork()</code> function."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536136950, "post_id": 52171960, "comment_id": 91311496, "body": "This looks like an XY Problem. You probably don&#39;t actually need a dynamic function, but are too focused on your imagined solution to see the bigger picture. Can you explain the larger problem you&#39;re trying to solve?"}], "answers": [{"comments": [{"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1536122112, "post_id": 52176708, "comment_id": 91304413, "body": "Close. But you skip some things: there is a job to do inside my switch-case, then it&#39;s result is being used to calculate other variables (middle section in my example), and only after that I call <code>variableFunc()</code>. In your example I can&#39;t call <code>div()</code> or <code>sayHello()</code> so soon because not all needed parameters are known yet. In my case it&#39;s like switch-case after switch-case where I wish to avoid the second switch at least."}], "tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": 0, "last_activity_date": 1536138719, "last_edit_date": 1536138719, "creation_date": 1536118648, "answer_id": 52176708, "question_id": 52171960, "link": "https://stackoverflow.com/questions/52171960/create-a-dynamic-function/52176708#52176708", "title": "Create a dynamic function", "body": "<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    common(4)\n    common(\"whitespace\")\n}\nfunc common(a interface{}) {\n    switch a.(type) {\n    case int:\n        div(a.(int), 2)\n        break\n    case string:\n        sayHello(a.(string))\n        break\n    default:\n        //nothing\n    }\n    return\n}\nfunc div(a, b int) {\n    fmt.Printf(\"%d\", a/b)\n    return\n}\nfunc sayHello(a string) {\n    fmt.Printf(\"%s\", a)\n}\n</code></pre>\n\n<p><code>main</code> function calls a <code>common</code> function, this in turn calls two different functions, which have different function signatures. You can see that they perform different actions. So this will print different results for different inputs. If calling different functions inside your switch statement is what you, wanted to do(as much I can glean from your comments), then this should do it. Let me know.</p>\n\n<hr>\n\n<blockquote>\n  <p>there is a job to do inside my switch-case, then it's result is being used to calculate other variables (middle section in my example), and only after that I call variableFunc()</p>\n</blockquote>\n\n<pre><code>package stackoverflow\n\nimport \"fmt\"\n\nfunc common(a interface{}) {\n    switch a.(type) {\n    case int:\n        defer func(b int) {\n            fmt.Printf(\"%d \\n\", b/2)\n        }(a.(int))\n        break\n    case string:\n        defer func(b string) {\n            fmt.Printf(\"hello %s \\n\", b)\n        }(a.(string))\n        break\n    default:\n        //nothing\n    }\n\n    //do something here\n    fmt.Println(\"did something here test\")\n    // the function gets called after\n    return\n}\n</code></pre>\n\n<p>you can use defer. So, this isn't a conventional use of defer. But technically it can be used for something like this. The above functionality will execute only after <code>//something</code> gets done, which I believe is the kind of flexibility you are after. If some function panics, this statement will come in between execution and exiting. So, you have to know what you are doing. </p>\n\n<hr>\n\n<p>Or you can use this, in case you have parameters coming in at a later stage.</p>\n\n<pre><code>package stackoverflow\n\nimport \"fmt\"\n\nfunc common(a interface{}) {\n    var f func(interface{}, int)\n    switch a.(type) {\n    case int:\n        f = func(s interface{}, b int) {\n            fmt.Printf(\"%d and %d\\n\", s.(int)/2, b)\n        }\n        break\n    case string:\n        f = func(b interface{}, c int) {\n            fmt.Printf(\"hello %s and %d \\n\", b.(string), c)\n        }\n        break\n    default:\n        //nothing\n    }\n    //do something here\n    fmt.Println(\"did something here test\")\n    // the function gets called after\n    var x int = 21\n\n    f(a, x)\n\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 438, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1536138719, "creation_date": 1536085032, "last_edit_date": 1536136887, "question_id": 52171960, "link": "https://stackoverflow.com/questions/52171960/create-a-dynamic-function", "title": "Create a dynamic function", "body": "<p>There is an existing logic I need to achieve in Golang. In general it is something like:</p>\n\n<pre><code>// Function receives an object with a variable type (struct)\nfunc(dynObject interface{}) {\n\n    var variableFunc ... // What should be here?\n\n    // Some things to do depending on the input param type\n    switch dynObject.(type) {\n    case *objA:\n        // do some job\n    case *objB:\n        // do some job\n    }\n\n    // ...\n    // Creating and calculating some variables for the following loop\n    // ...\n\n    humans := []*Humans{ ....... }\n    sum := []int{}\n\n    for _, human := range humans {\n        result := variableFunc(dynObject, human)\n        sum = append(sum, result)\n    }\n}\n</code></pre>\n\n<p>As you see - as an input there is a <strong>dynObject</strong> which is a struct, but can be any of some predefined structs. Later there is a function <code>variableFunc</code> which must take this object and process, and processing logic also depends on the type. So type <strong>objA</strong> requires different logic than <strong>objB</strong>.</p>\n\n<p>I don't know a normal way to implement this. How do I create this dynamic function, which can take different structs as input and apply needed logic to it? At the moment I get an error, that function expects another type as an input. And I wish to avoid additional switch-case, because one already exists.</p>\n\n<p>Of course I tried to create a predefined func., and with interfaces, then somehow redefine it inside of existing switch-case, but no luck. I need your help</p>\n"}, {"tags": ["go", "slack-api"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536086526, "post_id": 52171649, "comment_id": 91295189, "body": "Are you sure the <code>Notify*</code> functions are being called? What is the implementation of the <code>SlackNotifier</code>?"}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 1, "creation_date": 1536086756, "post_id": 52171649, "comment_id": 91295283, "body": "<code>logrus.WithError(err).Error(&quot;Error sending Slack message&quot;)</code> is the part of your code, that handles error logging. if its not set to stdOut, you wont see it on terminal, it might be logging that in some error log. What you can do here is to debug the code to see if <code>NotifyLoanSpecialist</code> and <code>NotifyRiskAnalyst</code> are actually being called."}], "owner": {"reputation": 21, "user_id": 7711770, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mLsay.jpg?s=128&g=1", "display_name": "J.Lara", "link": "https://stackoverflow.com/users/7711770/j-lara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1536083621, "creation_date": 1536083621, "question_id": 52171649, "link": "https://stackoverflow.com/questions/52171649/unable-to-send-notifications-via-slack-in-go", "title": "Unable to send notifications via slack in Go", "body": "<p>I am trying to use the Slack API to send notifications when one of my company's Loan Specialists or Risk Analysts are assigned to a casefile.</p>\n\n<p>Here is the Update function that sends Updates to a casefile to our database, which is where I call the slack notification functions I mention above.</p>\n\n<pre><code>func (r *Routes) UpdateCasefile(c echo.Context) error {\n    var ur update.UpdateRequest\n\n    err := c.Bind(&amp;ur)\n    if err != nil {\n        return handleErr(err, \"Error binding JSONUpdateRequest\")\n    }\n\n    if err := ur.ToGorm(r.db, &amp;casefile.Casefile{}).Error; err != nil {\n        return handleErr(err, \"Error updating Casefile\")\n    }\n\n    var updated casefile.Casefile\n    if err := r.db.Where(\"id = ?\", ur.EntityID).First(&amp;updated).Error;\n    err != nil {\n        return handleErr(err, \"Error recalling updated Casefile\")\n    }\n\n    cf := &amp;casefile.Casefile{\n        ID:                     updated.ID,\n        Name:                   updated.Name,\n        LoanAmount:             updated.LoanAmount,\n        AssignedLoanSpecialist: updated.AssignedLoanSpecialist,\n        AssignedRiskAnalyst:    updated.AssignedRiskAnalyst,\n        Business:               updated.Business,\n    }\n\n    if ur.Updates[\"assigned_risk_analyst\"] != nil {\n        NotifyRiskAnalyst(cf)\n    }\n\n    if ur.Updates[\"assigned_loan_specialist\"] != nil {\n        NotifyLoanSpecialist(cf)\n    }\n\n    go func() {\n        events.Bus.Events &lt;- &amp;events.EventMessage{\n            EventType: events.EventActivity,\n            Payload: &amp;casefile.Activity{\n                CasefileID: ur.EntityID,\n                Type:       \"UPDATE\",\n                User:       auth.GetEmail(c),\n                Message:    ur.FormatUpdateMessage(),\n             },\n         }\n    }()\n\n    return c.JSON(http.StatusOK, updated)\n}\n</code></pre>\n\n<p>Here are the functions that are <em>supposed</em> to send notifications via one of our slack channels when a Loan Specialist or Risk Analyst are assigned to a casefile.</p>\n\n<pre><code>func NotifyRiskAnalyst(cf *casefile.Casefile) {\n    title := fmt.Sprintf(\"Casefile  &lt;https://COMPANYWEBSITE/case/%s|%s&gt;, assigned to &lt;@%s&gt; at %s\", cf.ID, cf.Name, cf.AssignedRiskAnalyst, cf.CreatedAt.Format(\"2006-01-02 15:04 -0700 MST\"))\n\n    err := common.NewSlackNotifier(\"#test\").Notify(common.SlackMessage{\n        Attachments: []common.SlackAttachment{\n            {\n                Color:    \"#008BF8\",\n                Fallback: title,\n                Pretext:  title,\n                Fields: []common.SlackField{\n                    {\n                        Title: cf.Name,\n                        Value:   fmt.Sprintf(\"https:/COMPANYWEBSITE/case/%s\", cf.ID),\n                    },\n                },\n            },\n        }})\n\n    if err != nil {\n        logrus.WithError(err).Error(\"Error sending Slack message\")\n    }\n}\n\nfunc NotifyLoanSpecialist(cf *casefile.Casefile) {\n    title := fmt.Sprintf(\"Casefile  &lt;https://COMPANYWEBSITE/case/%s|%s&gt;, assigned to &lt;@%s&gt; at %s\", cf.ID, cf.Name, cf.AssignedLoanSpecialist, cf.CreatedAt.Format(\"2006-01-02 15:04 -0700 MST\"))\n\n    err := common.NewSlackNotifier(\"#test\").Notify(common.SlackMessage{\n        Attachments: []common.SlackAttachment{\n            {\n                Color:    \"#008BF8\",\n                Fallback: title,\n                Pretext:  title,\n                Fields: []common.SlackField{\n                    {\n                        Title: cf.Name,\n                        Value: fmt.Sprintf(\"https://COMPANYWEBSITE.io/case/%s\", cf.ID),\n                    },\n                },\n            },\n        }})\n\n    if err != nil {\n        logrus.WithError(err).Error(\"Error sending Slack message\")\n    }\n}\n</code></pre>\n\n<p>I'm not getting any errors in my terminal, but the slack notifications aren't sending. I'm not entirely sure where I'm going wrong, but any help will be much appreciated!</p>\n"}, {"tags": ["go", "mux"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536079254, "post_id": 52170547, "comment_id": 91291999, "body": "What is wrong with net/url.Values.Encode() ?"}, {"owner": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536080198, "post_id": 52170547, "comment_id": 91292403, "body": "not sure I follow ? sorry maybe my question is not clear enough"}, {"owner": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536080497, "post_id": 52170547, "comment_id": 91292548, "body": "I hope it is clearer with new edit. In short, I want to manually add query parameters in the validation phase before starting to handle the request, which is done in another <code>function</code> that calls <code>ValidateParameters()</code>, but it is does not have any effect."}, {"owner": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536080925, "post_id": 52170547, "comment_id": 91292748, "body": "not sure why this is downvoted, it could help somebody"}], "answers": [{"tags": [], "owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "is_accepted": true, "score": 5, "last_activity_date": 1536080473, "creation_date": 1536080473, "answer_id": 52170994, "question_id": 52170547, "link": "https://stackoverflow.com/questions/52170547/unable-to-set-query-parameters-manually-for-a-rest-api-using-mux/52170994#52170994", "title": "Unable to set query parameters manually for a rest api (using mux)", "body": "<p>The problem is that <code>r.URL.Query()</code> parses the url, creates the map of parameters and returns it. This is done with every <code>.Query()</code> call.</p>\n\n<p>This should work:</p>\n\n<pre><code>params := r.URL.Query()\nparams.Set(\"key\", \"value\")\nr.URL.RawQuery = params.Encode()\n</code></pre>\n"}], "owner": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 551, "favorite_count": 0, "accepted_answer_id": 52170994, "answer_count": 1, "score": 1, "last_activity_date": 1536080829, "creation_date": 1536078534, "last_edit_date": 1536080829, "question_id": 52170547, "link": "https://stackoverflow.com/questions/52170547/unable-to-set-query-parameters-manually-for-a-rest-api-using-mux", "title": "Unable to set query parameters manually for a rest api (using mux)", "body": "<p>I am implementing a Rest api using mux. After validating some parameters, I am trying to fill the missing parameters with some default values which I process later by the method that handles the request, however, I noticed that setting query parameters manually does not have any effect, unless the raw query is directly changed which is a bit hacky:</p>\n\n<pre><code>func ValidateParameters(r *http.Request) (bool) {\n\n     test := r.URL.Query().Get(\"test\")\n\n   // if test is not provided set some default value\n\n    if test == \"\" {\n\n        r.URL.Query().Set(\"test\", \"Test1\") //not working\n        r.URL.Query().Add(\"test\", \"Test2\") //not working\n        r.URL.RawQuery = r.URL.RawQuery + \"&amp;Test=Test3\" // the only method working\n\n     }\n\n       // more code\n\n}\n</code></pre>\n\n<p>The handler is in another file, so I want to be able to do <code>test := r.URL.Query().Get(\"test\")</code> and get the value that I set inside <code>ValidateParameters</code> which is called by the request handler, but this is not working. </p>\n\n<p>any explanation to that ? any way to work around it ? </p>\n\n<p>Thanks. </p>\n"}, {"tags": ["debugging", "go", "goland"], "comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 3, "creation_date": 1536073141, "post_id": 52168931, "comment_id": 91288589, "body": "update dlv <code>go get -u github.com&#47;derekparker&#47;delve&#47;cmd&#47;dlv</code>"}], "answers": [{"comments": [{"owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "edited": false, "score": 1, "creation_date": 1536075313, "post_id": 52169139, "comment_id": 91290023, "body": "I was running 2018.1.4. After installing 2018.2.2 it now works, thanks."}, {"owner": {"reputation": 1105, "user_id": 1117937, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8df761b88deb3c8709ac8c909f565092?s=128&d=identicon&r=PG", "display_name": "DAB", "link": "https://stackoverflow.com/users/1117937/dab"}, "edited": false, "score": 0, "creation_date": 1538493768, "post_id": 52169139, "comment_id": 92157290, "body": "what&#39;s the diff? i&#39;m using the command line to build with <code>go build -o _debugbuild -gcflags &quot;-N -l&quot; -v .&#47;src&#47;app&#47;</code> and when i run it, i get the same error before goland is even opened. previously it would prevent execution until goland attempted to connect"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1538557087, "post_id": 52169139, "comment_id": 92180065, "body": "I&#39;m not sure I understand what happens in your case, but in the original question the problem was that the builtin version of Delve was compiled with an older version of Go and upgrading the IDE allowed delve to be updated to a version compiled with the latest available. Also, depending on which Go version you are using, the command should be ` go build -o binary -gcflags=&quot;all=-N -l&quot; -v ./src/app ` in order to make sure that all packages in the binary have the ` -N -l ` flags applied (this is needed from Go 1.10 or newer)."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 4, "last_activity_date": 1536073215, "creation_date": 1536073215, "answer_id": 52169139, "question_id": 52168931, "link": "https://stackoverflow.com/questions/52168931/failed-to-debug-binary-could-not-launch-process-could-not-find-debug-line-s/52169139#52169139", "title": "Failed to debug binary - &quot;could not launch process: could not find .debug_line section in binary&quot;", "body": "<p>It seems you are using an outdated version of GoLand, 2018.1.4. Upgrade to 2018.2.2 and the issue will disappear.</p>\n"}], "owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3275, "favorite_count": 0, "accepted_answer_id": 52169139, "answer_count": 1, "score": 2, "last_activity_date": 1536073215, "creation_date": 1536072515, "question_id": 52168931, "link": "https://stackoverflow.com/questions/52168931/failed-to-debug-binary-could-not-launch-process-could-not-find-debug-line-s", "title": "Failed to debug binary - &quot;could not launch process: could not find .debug_line section in binary&quot;", "body": "<p>I am working with GoLand IDE and I have the following simple code:  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\n\nfunc main() {\n    start := time.Now()\n    time.Sleep(2 * time.Second)\n    elapsed := time.Since(start)\n    fmt.Println(\"elapsed: %s\", elapsed)\n}\n</code></pre>\n\n<p>When I run it, it works fine and I see the output.<br>\nWhen I put breakpoint in one of the lines I received the following error:  </p>\n\n<pre><code>GOROOT=/usr/local/go #gosetup  \nGOPATH=/root/go #gosetup  \n/usr/local/go/bin/go build -o /tmp/___go_build_mymain_go -gcflags \"all=-N -l\" /root/go/src/myproj/mymain.go #gosetup  \n/home/myuser/Desktop/GoLand-2018.1.4/plugins/go/lib/dlv/linux/dlv --listen=localhost:35607 --headless=true --api-version=2 --backend=default exec /tmp/___go_build_mymain_go -- #gosetup  \ncould not launch process: could not find .debug_line section in binary  \n\nDebugger finished with exit code 1  \n</code></pre>\n\n<p>I didn't find any information regarding this error.<br>\nI read about debugging in Go and it was mentioned to use <code>-gcflags \"all=-N -l\"</code> which is being used.  </p>\n\n<p>What can be the reason for this fail?  </p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536072304, "post_id": 52168809, "comment_id": 91288019, "body": "The &quot;m=&quot; value is the monotonic portion of the clock. See <a href=\"https://golang.org/pkg/time/#Time.String\" rel=\"nofollow noreferrer\">here</a>. This part doesn&#39;t get marshaled as JSON, so cannot be unmarshaled."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1536072324, "post_id": 52168809, "comment_id": 91288038, "body": "The <code>m</code> value in a <code>time.Time</code> is the monotonic clock addition for improved timing accuracy. You can use <code>time.Truncate(0)</code> to eliminate it"}, {"owner": {"reputation": 4411, "user_id": 751579, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/iux9g.png?s=128&g=1", "display_name": "davidbak", "link": "https://stackoverflow.com/users/751579/davidbak"}, "edited": false, "score": 1, "creation_date": 1536072373, "post_id": 52168809, "comment_id": 91288069, "body": "This is a not obvious gotcha."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1536072457, "creation_date": 1536072457, "answer_id": 52168905, "question_id": 52168809, "link": "https://stackoverflow.com/questions/52168809/unexpected-fail-with-marshalling-unmarshalling-time-object-in-golang/52168905#52168905", "title": "Unexpected fail with marshalling/unmarshalling time object in Golang", "body": "<p>Per <a href=\"https://golang.org/pkg/time/#hdr-Monotonic_Clocks\" rel=\"nofollow noreferrer\">the documentation</a>, the <code>m</code> value is the monotonic clock value, which can be removed using <a href=\"https://golang.org/pkg/time/#Time.Truncate\" rel=\"nofollow noreferrer\"><code>Truncate</code></a> for comparisons not for the purpose of timing. The <code>m</code> field does not match because it is omitted from JSON, it is only generated by <code>time.Now()</code>.</p>\n\n<p>Try like so:</p>\n\n<pre><code>// values\nnow := time.Now().Truncate(0)  // Truncate to remove monotonic clock portion\ntimeToJSON, _ := json.Marshal(now)\nvar obj time.Time\njson.Unmarshal(timeToJSON, &amp;obj)\n</code></pre>\n\n<p>The monotonic clock offset was added in order to allow for accurate timing of durations which span a wall clock change (e.g. NTP update, DST change, or leap second/smear).</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1536072464, "last_edit_date": 1592644375, "creation_date": 1536072464, "answer_id": 52168907, "question_id": 52168809, "link": "https://stackoverflow.com/questions/52168809/unexpected-fail-with-marshalling-unmarshalling-time-object-in-golang/52168907#52168907", "title": "Unexpected fail with marshalling/unmarshalling time object in Golang", "body": "<p><code>time.String()</code> is not a reliable way to testing a time's value (unless you care about the monotonic clock value, as well).  From <a href=\"https://golang.org/pkg/time/#Time.String\" rel=\"nofollow noreferrer\">the docs</a> (Emphasis added):</p>\n<blockquote>\n<h1>func (Time) String</h1>\n<pre><code>func (t Time) String() string\n</code></pre>\n<p>String returns the time formatted using the format string</p>\n<pre><code>&quot;2006-01-02 15:04:05.999999999 -0700 MST&quot;\n</code></pre>\n<p>If the time has a monotonic clock reading, the returned string includes a final field &quot;m=\u00b1&quot;, where value is the monotonic clock reading formatted as a decimal number of seconds.</p>\n<p><strong>The returned string is meant for debugging; for a stable serialized representation, use t.MarshalText, t.MarshalBinary, or t.Format with an explicit format string.</strong></p>\n</blockquote>\n<p>For your use-case, it would be better to use the output of <code>time.MarshalText()</code>instead of <code>time.String()</code>:</p>\n<pre><code>expected, _ := now.MarshalText()\nactual, _ := obj.MarshalText()\n\nif !assert.Equal(string(expected), string(actual)) ...\n</code></pre>\n"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 0, "accepted_answer_id": 52168905, "answer_count": 2, "score": 0, "last_activity_date": 1536072464, "creation_date": 1536072139, "question_id": 52168809, "link": "https://stackoverflow.com/questions/52168809/unexpected-fail-with-marshalling-unmarshalling-time-object-in-golang", "title": "Unexpected fail with marshalling/unmarshalling time object in Golang", "body": "<p>Unmarshalling a marshalled time object is failing, because of a few characters</p>\n\n<p><strong>Test</strong></p>\n\n<p>declare the following:</p>\n\n<pre><code>// values\nnow := time.Now()\ntimeToJSON, _ := json.Marshal(now)\nvar obj time.Time\njson.Unmarshal(timeToJSON, &amp;obj)\n</code></pre>\n\n<p>then do the following test logic: </p>\n\n<pre><code>if !assert.Equal(t,\n    now.String(),\n    obj.String()) {\n    t.FailNow()\n}\n</code></pre>\n\n<p><strong>Expected</strong> </p>\n\n<p>the test to pass, and the two objects to be equal</p>\n\n<p><strong>Actual</strong></p>\n\n<p>It fails:</p>\n\n<pre><code>--- FAIL: TestFromJSON (0.00s)\n    D:\\dev2017\\GO\\src\\ezsoft\\apiserver_sdk\\model\\delete\\deleteModel_test.go:94: \n            Error Trace:    deleteModel_test.go:94\n            Error:          Not equal: \n                            expected: \"2018-09-04 10:36:18.3627338 -0400 EDT m=+0.014000801\"\n                            actual  : \"2018-09-04 10:36:18.3627338 -0400 EDT\"\n\n                            Diff:\n                            --- Expected\n                            +++ Actual\n                            @@ -1 +1 @@\n                            -2018-09-04 10:36:18.3627338 -0400 EDT m=+0.014000801\n                            +2018-09-04 10:36:18.3627338 -0400 EDT\n            Test:           TestFromJSON\nFAIL\nFAIL    ezsoft/apiserver_sdk/model/delete   1.336s\nError: Tests failed.\n</code></pre>\n\n<p><strong>NOTE</strong></p>\n\n<p>I notice that, upon inspecting the output, that, somehow, some <code>m=+[blah]</code> is being appended to expected/actual. </p>\n\n<p>I don't know why, however, and <a href=\"https://tools.ietf.org/html/rfc3339\" rel=\"nofollow noreferrer\">skimming RFC 3339</a> doesn't give me any hints why. </p>\n"}, {"tags": ["multithreading", "go", "goroutine", "postgresql-9.5", "locks"], "comments": [{"owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536070886, "post_id": 52168321, "comment_id": 91286974, "body": "Well that&#39;s the part I&#39;m not sure of.If the lock is go-routine-exclusive so to say, then I expect only one instance to get the lock (once). If it is not go-routine-exclusive, then I expect all ten instances to get it succesffully on the first attempt and then - yes, it would be locked 10 times."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1536070909, "post_id": 52168321, "comment_id": 91286998, "body": "I&#39;m not sure what <code>gorp.DBMap</code> is, but all your routines are sharing it, which means they are all sharing the same connection/pool. Postgres has no awareness of goroutines, only connections. A Postgres lock will exclude other processes connected to the same database; if you want to control exclusion among goroutines within a program, use Go synchronization methods (e.g. channels or mutexes)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536070963, "post_id": 52168321, "comment_id": 91287038, "body": "I misread--you&#39;re always trying to lock the same id (<code>4</code>)."}, {"owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "edited": false, "score": 1, "creation_date": 1536071020, "post_id": 52168321, "comment_id": 91287080, "body": "Ahhh I see now! So every time I call <code>dbMap.Exec(...)</code> it chooses a random connection from the connection pool. When it&#39;s the same connection that initially got the lock - I succeed in getting it again, even if it is done from a different goroutine."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536071056, "post_id": 52168321, "comment_id": 91287109, "body": "The answer to your first question, BTW, &quot;What should I expect to be protected...?&quot; -- Nothing. This is just an advisory lock. The semantics of what it means is 100% up to your application. See <a href=\"https://www.postgresql.org/docs/9.4/static/explicit-locking.html\" rel=\"nofollow noreferrer\">here</a> for more explanation."}, {"owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "edited": false, "score": 1, "creation_date": 1536072751, "post_id": 52168321, "comment_id": 91288332, "body": "Indeed when I use separate transactions instead of the connection pool - only one transaction succeeds in getting the lock. Furthermore, the goroutine that owns the &#39;winning&#39; transaction can use it to acquire the lock any number of times (before the it unlocks of course)."}, {"owner": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "edited": false, "score": 0, "creation_date": 1536097214, "post_id": 52168321, "comment_id": 91299585, "body": "@AlexGordon Sounds like this is more about understanding the semantics of the connection pool and the advisory locks functionality?  Is this answered at this point?"}, {"owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "reply_to_user": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "edited": false, "score": 0, "creation_date": 1536133749, "post_id": 52168321, "comment_id": 91309623, "body": "@stderr It is indeed. I\u2019ve reproduced with transactions instead of dbMap and it behaved as expected."}], "answers": [{"tags": [], "owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "is_accepted": false, "score": 0, "last_activity_date": 1557152872, "creation_date": 1557152872, "answer_id": 56007204, "question_id": 52168321, "link": "https://stackoverflow.com/questions/52168321/postgres-lock-behaves-inconsistently-over-different-goroutines/56007204#56007204", "title": "Postgres lock behaves inconsistently over different goroutines", "body": "<p>After some months of experience with PostgreSQL via gorp, I think I understand this behaviour:</p>\n\n<ul>\n<li><code>gorp</code> maintains a connection pool.</li>\n<li>Whenever we create a transaction, one of these connections will be picked in random(?).</li>\n<li><code>dbMap.SomeCommand()</code> creates a transaction, executes some command and commits the transaction.</li>\n<li><code>pg_try_advisory_lock</code> works on the <a href=\"https://www.postgresql.org/docs/9.1/functions-admin.html\" rel=\"nofollow noreferrer\"><strong>session</strong> level</a>.</li>\n<li><a href=\"https://www.postgresql-archive.org/When-the-Session-ends-in-PGSQL-td4538986.html\" rel=\"nofollow noreferrer\">A session is synonymous with a TCP connection</a>, so is by no means stable or permanent.</li>\n<li>A connection from the pool keeps using the same session when possible, but will reset it when needed.</li>\n</ul>\n\n<p>Whenever we execute <code>dbMap.SelectStr(\"SELECT pg_try_advisory_lock(4);\")</code>, a connection is selected from the pool. Then a transaction is created, it acquires the lock <strong>on the session level</strong> and then it's committed.</p>\n\n<p>When another go-routine attempts to do the same, there's a chance that it will use the <strong>same session</strong>, probably depending on the connection that is taken from the pool. Since the locking is done on the session level - the new transaction is able to acquire the lock again.</p>\n"}], "owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1557152872, "creation_date": 1536070451, "question_id": 52168321, "link": "https://stackoverflow.com/questions/52168321/postgres-lock-behaves-inconsistently-over-different-goroutines", "title": "Postgres lock behaves inconsistently over different goroutines", "body": "<p>I've encountered some inconsistent behaviour with <code>pg_locks</code> on go routines and PostgreSQL 9.5.</p>\n\n<p>When I create additional <code>goroutines</code> and call <code>SELECT pg_try_advisory_lock(1);</code> the results are inconsistent.</p>\n\n<p>I can try to get the lock at some moment, fail, try again and manage to get it, without anyone explicitly releasing the lock in the meanwhile.</p>\n\n<p>I've created the a small program to reproduce the issue.</p>\n\n<h3>Program flow</h3>\n\n<ol>\n<li>Create 10 goroutines. Each one of them tries to get the same lock on initialization.</li>\n<li>Every second, each instance would try to get the lock again, if it didn't get it already.</li>\n<li>Every second I probe all instances and count how many already got the lock.</li>\n</ol>\n\n<h3>Expected behaviour:</h3>\n\n<p>Only 1 goroutine would have the lock at any given moment.</p>\n\n<h3>Actual results:</h3>\n\n<p>The number of goroutines that manage to aquire the lock increases over time.</p>\n\n<hr>\n\n<pre><code>package main\n\nvar dbMap *gorp.DbMap // init code omitted for brevity\n\nfunc main() {\n    setup(10)\n    fmt.Println(\"after initialization,\", countOwners(), \"instances of lockOwners have the lock!\")\n\n    for {\n        if _, err := dbMap.Exec(\"SELECT pg_sleep(1)\"); err != nil {\n            panic(err)\n        }\n\n        fmt.Println(countOwners(), \"instances of lockOwners have the lock!\")\n    }\n}\n\nfunc countOwners() int {\n    possessLock := 0\n    for _, lo := range los {\n        if lo.hasLock {\n            possessLock++\n        }\n    }\n    return possessLock\n}\n\nvar los []*lockOwner\n\nfunc setup(instanceCount int) {\n    var wg sync.WaitGroup\n    for i := 0; i &lt; instanceCount; i++ {\n        wg.Add(1)\n        newInstance := lockOwner{}\n        los = append(los, &amp;newInstance)\n        go newInstance.begin(time.Second, &amp;wg, i+1)\n    }\n    wg.Wait()\n}\n\ntype lockOwner struct {\n    id      int\n    ticker  *time.Ticker\n    hasLock bool\n}\n\nfunc (lo *lockOwner) begin(interval time.Duration, wg *sync.WaitGroup, id int) {\n    lo.ticker = time.NewTicker(interval)\n    lo.id = id\n    go func() {\n        lo.tryToGetLock()\n        wg.Done()\n        for range lo.ticker.C {\n            lo.tryToGetLock()\n        }\n    }()\n}\n\nfunc (lo *lockOwner) tryToGetLock() {\n\n    if lo.hasLock {\n        return\n    }\n\n    locked, err := dbMap.SelectStr(\"SELECT pg_try_advisory_lock(4);\")\n    if err != nil {\n        panic(err)\n    }\n\n    if locked == \"true\" {\n        fmt.Println(lo.id, \"Did get lock!\")\n        lo.hasLock = true\n    }\n}\n</code></pre>\n\n<p>The output of this program varies, but usually something along the lines:</p>\n\n<pre><code>1 Did get lock!\nafter initialization, 1 instances of lockOwners have the lock!\n1 instances of lockOwners have the lock!\n2 Did get lock!\n2 instances of lockOwners have the lock!\n2 instances of lockOwners have the lock!\n7 Did get lock!\n3 instances of lockOwners have the lock!\n3 instances of lockOwners have the lock!\n6 Did get lock!\n4 instances of lockOwners have the lock!\n</code></pre>\n\n<hr>\n\n<h1>My question:</h1>\n\n<ol>\n<li>What should I expect to be protected when using <code>pg_locks</code> this way?</li>\n<li>What is the reason some goroutine fails to acquire the lock?</li>\n<li><p>What is the reason the same goroutine succeeds doing so on the next attempt?</p>\n\n<ul>\n<li>Could it be that the thread is the resource being locked and every time a <code>goroutine</code> triggers it does so from a different thread? That would explain the inconsistent behaviour.</li>\n</ul></li>\n</ol>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 2, "creation_date": 1536068373, "post_id": 52167373, "comment_id": 91285233, "body": "Could you write a little bit more? I have no idea what your problem is and what your target is."}, {"owner": {"reputation": 533, "user_id": 771564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bd4c92dcc00d019e3f6a2a858b803f?s=128&d=identicon&r=PG", "display_name": "Peter Mellett", "link": "https://stackoverflow.com/users/771564/peter-mellett"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1536068639, "post_id": 52167373, "comment_id": 91285418, "body": "@apxp I think the problem is that static assets are getting routed through the router.GET line not the router.Static line. Is this right @dawenxi?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536070712, "post_id": 52167373, "comment_id": 91286845, "body": "It sounds like you may just need to add a <code>&lt;base&gt;</code> to your HTML, but with no code to look at it&#39;s hard to say for certain."}], "owner": {"reputation": 1, "user_id": 10315114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5306945b83f050fa5df460239b2ae37b?s=128&d=identicon&r=PG&f=1", "display_name": "dawenxi", "link": "https://stackoverflow.com/users/10315114/dawenxi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1536068474, "creation_date": 1536067350, "last_edit_date": 1536068474, "question_id": 52167373, "link": "https://stackoverflow.com/questions/52167373/how-to-change-the-url-of-static-file-when-i-use-the-parameters-in-path", "title": "How to change the url of static file when I use the Parameters in path", "body": "<pre><code>router.Static(\"/static\", config.STATIC_PATH)\nrouter.LoadHTMLGlob(config.TEMPLATE_PATH+\"/*\")\nrouter.GET(\"/user:uname\",handlers.Index )\n</code></pre>\n\n<p>The href of css file will become \"/user/static/css/fontawesome.css\",gin add \"user\"\non all the href of css, js in index.html,how to avoid that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4073, "user_id": 9926383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4YBxe.jpg?s=128&g=1", "display_name": "kalehmann", "link": "https://stackoverflow.com/users/9926383/kalehmann"}, "edited": false, "score": 1, "creation_date": 1536063219, "post_id": 52166062, "comment_id": 91281722, "body": "You try to return the closure from iterPermutation and not the result of the closure"}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1536065863, "last_edit_date": 1536065863, "creation_date": 1536063527, "answer_id": 52166195, "question_id": 52166062, "link": "https://stackoverflow.com/questions/52166062/writing-next-permutation-in-go-using-closure-what-is-wrong-with-my-code/52166195#52166195", "title": "Writing next Permutation in Go using closure, what is wrong with my code", "body": "<p>Golang spec for <a href=\"https://golang.org/ref/spec#Return_statements\" rel=\"nofollow noreferrer\">Return statements</a> described:</p>\n\n<blockquote>\n  <p>The return value or values may be explicitly listed in the \"return\"\n  statement. Each expression must be single-valued and assignable to the\n  corresponding element of the function's result type.</p>\n</blockquote>\n\n<p>The function called for permutation should contains two values in return one for the array and another for the boolean. Since you are assigning two variables from the function return:</p>\n\n<pre><code>a := []int{0,1,2,3,4}\nnextPermutation, exists := iterPermutation(a) // it should return two values one for nextPermutation which is an array and other is exists which might be a boolean value.\nfor exists {\n    nextPermutation()\n}\n</code></pre>\n\n<p>For below error:</p>\n\n<blockquote>\n  <p>\"cannot use func literal (type func() []int) as type []int in return\n  argument\"</p>\n</blockquote>\n\n<p>you are returning func() literal enclosed inside the closure function of permutation along with boolean value, so change the return type as:</p>\n\n<pre><code>package main\n\nfunc main(){\n    a := []int{0,1,2,3,4}\n    nextPermutation, _ := iterPermutation(a)\n        nextPermutation()\n}\n\nfunc iterPermutation(a []int) ((func() []int), bool) { // return both values\n    return func() []int {\n        i := len(a) - 2\n\n        for i &gt;= 0 &amp;&amp; a[i+1] &lt;= a[i] {\n            i--\n        }\n        if i &lt; 0 {\n            return a\n        }\n\n        j := len(a) - 1\n        for j &gt;= 0 &amp;&amp; a[j] &lt;= a[i] {\n            j--\n        }\n\n        a[i], a[j] = a[j], a[i]\n\n        for k, l := i, len(a)-1; k &lt; l; k, l = k+1, l-1 {\n            a[k], a[l] = a[l], a[k]\n        }\n        return a\n    }, true // add boolean value to return from the function.\n}\n</code></pre>\n\n<p>Working answer on <a href=\"https://play.golang.org/p/BJlQPqbyzDa\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 2274, "user_id": 7567579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab9644beeb1d324d1247b2951d28927?s=128&d=identicon&r=PG", "display_name": "Emin Laletovic", "link": "https://stackoverflow.com/users/7567579/emin-laletovic"}, "is_accepted": false, "score": 0, "last_activity_date": 1536066213, "creation_date": 1536066213, "answer_id": 52167003, "question_id": 52166062, "link": "https://stackoverflow.com/questions/52166062/writing-next-permutation-in-go-using-closure-what-is-wrong-with-my-code/52167003#52167003", "title": "Writing next Permutation in Go using closure, what is wrong with my code", "body": "<p>I'm going to ignore the \"permutation\" logic inside your closure and focus on couple of concepts that you need to be aware of so it would work like you've planned to with your code. Correct me if I'm wrong, but you want to get array of item from your closure until <code>exists</code> is false, right?</p>\n\n<p>First of all, to have <code>nextPermutation, exists := iterPermutation(a)</code> compile properly, <code>iterPermutation</code> needs to return two values like so:</p>\n\n<pre><code>func iterPermutation(a []int) (func() []int, bool) {\n   exists := true\n   return func() []int {\n      //rest of your code\n      if i &lt; 0 {\n        exists = false\n        return a\n      }\n      //rest of your code\n   }, exists\n} \n</code></pre>\n\n<p>Next problem you face is the fact that, with the above approach, you will have with the <code>exists</code> value. Since you are returning a value for <code>exists</code>, any change to <code>exists</code> will not be propagated beyond the scope of <code>iterPermutation</code>. You can fix this problem by returning a pointer. This is one way of implementing it:</p>\n\n<pre><code>a := []int{0,1,2,3,4}\nnextPermutation, check := iterPermutation(a)\n\nwhile check.Exists {\n   nextPermutation()\n}\n\ntype Check struct {\n    Exists bool \n}\n\nfunc iterPermutation(a []int) (func() []int, *Check) {\ncheck:= &amp;Check{\n          Exists: true,\n}   \nreturn func() []int {\n        i := len(a) - 2\n\n        for i &gt;= 0 &amp;&amp; a[i+1] &lt;= a[i] {\n            i--\n        }\n        if i &lt; 0 {\n        check.Exists = false //this is put here as an example\n            return a\n        }\n\n        j := len(a) - 1\n        for j &gt;= 0 &amp;&amp; a[j] &lt;= a[i] {\n            j--\n        }\n\n        a[i], a[j] = a[j], a[i]\n\n        for k, l := i, len(a)-1; k &lt; l; k, l = k+1, l-1 {\n            a[k], a[l] = a[l], a[k]\n        }\n        return a\n    }, check\n}\n</code></pre>\n\n<p>When you return a pointer of <code>Check</code> type, any change to it in the <code>iterPermutation</code> or in your closure is visible outside of these as well, since you are accessing a memory reference. </p>\n"}], "owner": {"reputation": 35, "user_id": 10314829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e70667a7db2264ea1aeb86706221c80?s=128&d=identicon&r=PG&f=1", "display_name": "NewToGo", "link": "https://stackoverflow.com/users/10314829/newtogo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1536066213, "creation_date": 1536063026, "last_edit_date": 1536064085, "question_id": 52166062, "link": "https://stackoverflow.com/questions/52166062/writing-next-permutation-in-go-using-closure-what-is-wrong-with-my-code", "title": "Writing next Permutation in Go using closure, what is wrong with my code", "body": "<p>I have written a function \"iterPermutation\" which uses closure. I want to return array and boolean from the closure which I could not do. So tried only array but it still gives an error</p>\n\n<blockquote>\n  <p>cannot use func literal (type func() []int) as type []int in return\n  argument</p>\n</blockquote>\n\n<p>I want to use iterPermutation like</p>\n\n<pre><code>a := []int{0,1,2,3,4}\nnextPermutation, exists := iterPermutation(a)\nfor exists {\n    nextPermutation()\n}\n\nfunc iterPermutation(a []int) []int {\n    return func() []int {\n        i := len(a) - 2\n\n        for i &gt;= 0 &amp;&amp; a[i+1] &lt;= a[i] {\n            i--\n        }\n        if i &lt; 0 {\n            return a\n        }\n\n        j := len(a) - 1\n        for j &gt;= 0 &amp;&amp; a[j] &lt;= a[i] {\n            j--\n        }\n\n        a[i], a[j] = a[j], a[i]\n\n        for k, l := i, len(a)-1; k &lt; l; k, l = k+1, l-1 {\n            a[k], a[l] = a[l], a[k]\n        }\n        return a\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "assertion", "go-interface"], "comments": [{"owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "edited": false, "score": 1, "creation_date": 1536064219, "post_id": 52164276, "comment_id": 91282366, "body": "What kind of processing are you trying to do with the <code>Pix</code> field? I&#39;m curious because though the <code>Pix</code> field for different image types is of type <code>[]uint8</code>, the actual contents of the slice is not consistent. For example, the <code>CMYK</code> image type stores values for C, M, Y and K one after the other in the slice for each pixel, but <code>Alpha</code> stores just one value for each pixel. That&#39;s why the <code>image.Image</code> interface has an <code>At()</code> method returning a <code>color.Color</code> value for any given pixel."}, {"owner": {"reputation": 1250, "user_id": 1417895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1db3339ff886043c56e89b2a25e3e6fd?s=128&d=identicon&r=PG", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1417895/andrey"}, "reply_to_user": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "edited": false, "score": 0, "creation_date": 1536065265, "post_id": 52164276, "comment_id": 91283069, "body": "Then I calculate average color. Getting color of every pixel with <code>img.At(x, y).RGBA()</code> is slower than processing <code>[]uint8</code>: ~530ms vs ~315ms on an image with resolution 3840x1200. I handle a lot if images so I have decided to use img.Pix. But Python with library &quot;pillow&quot; is faster: ~215ms :)."}, {"owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "edited": false, "score": 0, "creation_date": 1536065548, "post_id": 52164276, "comment_id": 91283226, "body": "Do you need that performance gain? If yes, are you sure that you&#39;re getting the right results without taking into account the image type? Especially for image types that have multiple components (eg. CMYK, NRGBA64 etc) where I assume you need to compute the average for each component."}, {"owner": {"reputation": 1250, "user_id": 1417895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1db3339ff886043c56e89b2a25e3e6fd?s=128&d=identicon&r=PG", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1417895/andrey"}, "reply_to_user": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "edited": false, "score": 0, "creation_date": 1536065984, "post_id": 52164276, "comment_id": 91283529, "body": "I could do it without optimization, but why not for fun. Images are png, jpeg or tiff, colorful (4 channels) or grey (1 channel). Results checked with the help of imagemagick."}], "answers": [{"comments": [{"owner": {"reputation": 1250, "user_id": 1417895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1db3339ff886043c56e89b2a25e3e6fd?s=128&d=identicon&r=PG", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1417895/andrey"}, "edited": false, "score": 0, "creation_date": 1536058945, "post_id": 52164510, "comment_id": 91278951, "body": "Yes, <code>switch</code> slipped from my mind. Switch looks a bit nicer. But is it possible in golang to assert interface to its type (&quot;%T&quot;)? In general case there may be tens of different types."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1250, "user_id": 1417895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1db3339ff886043c56e89b2a25e3e6fd?s=128&d=identicon&r=PG", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1417895/andrey"}, "edited": false, "score": 1, "creation_date": 1536059593, "post_id": 52164510, "comment_id": 91279363, "body": "@Andrey Go is a statically typed language. You can only type-assert to a concrete type or another interface type, but the type must be known at compile-time. Use the 2nd approach with reflection."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1536058303, "last_edit_date": 1536058303, "creation_date": 1536058000, "answer_id": 52164510, "question_id": 52164276, "link": "https://stackoverflow.com/questions/52164276/assert-interface-to-its-type/52164510#52164510", "title": "Assert interface to its type", "body": "<p>Your big <code>if ... else</code> structure could be simplified by using a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"noreferrer\">type switch</a> like this:</p>\n\n<pre><code>func getPixels(img image.Image) ([]uint8, error) {\n    switch i := img.(type) {\n    case *image.NRGBA:\n        return i.Pix, nil\n    case *image.Alpha:\n        return i.Pix, nil\n    case *image.Alpha16:\n        return i.Pix, nil\n    case *image.CMYK:\n        return i.Pix, nil\n        // ...\n    }\n    return nil, fmt.Errorf(\"unknown image type %T\", img)\n}\n</code></pre>\n\n<p>Where you still have to list all possible types, but it's nicer.</p>\n\n<p>Since all image implementations are struct pointers having a field named <code>Pix</code>, you may use reflection to get that field. This implementation will handle future image implementations without any change (if they will also be structs with a <code>Pix</code> field).</p>\n\n<p>This is how it would look like:</p>\n\n<pre><code>func getPix(img image.Image) ([]uint8, error) {\n    v := reflect.ValueOf(img)\n    if v.Kind() == reflect.Ptr {\n        v = v.Elem()\n    }\n\n    if v.Kind() == reflect.Struct {\n        pv := v.FieldByName(\"Pix\")\n        if pv.IsValid() {\n            if pix, ok := pv.Interface().([]uint8); ok {\n                return pix, nil\n            }\n        }\n    }\n\n    return nil, fmt.Errorf(\"unknown image type %T\", img)\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>fmt.Println(getPix(&amp;image.NRGBA{}))\nfmt.Println(getPix(&amp;image.RGBA{}))\n\ntype unknownImage struct{ image.Image }\nfmt.Println(getPix(unknownImage{}))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/tXEX5l_R677\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[] &lt;nil&gt;\n[] &lt;nil&gt;\n[] unknown image type main.unknownImage\n</code></pre>\n"}], "owner": {"reputation": 1250, "user_id": 1417895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1db3339ff886043c56e89b2a25e3e6fd?s=128&d=identicon&r=PG", "display_name": "Andrey", "link": "https://stackoverflow.com/users/1417895/andrey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 668, "favorite_count": 0, "accepted_answer_id": 52164510, "answer_count": 1, "score": 3, "last_activity_date": 1536058303, "creation_date": 1536057246, "last_edit_date": 1536057709, "question_id": 52164276, "link": "https://stackoverflow.com/questions/52164276/assert-interface-to-its-type", "title": "Assert interface to its type", "body": "<p>I can't gracefully get pixels of an image as array in general case.</p>\n\n<pre><code>f, err := os.Open(imgPath)\ncheck(err)\ndefer f.Close()\nimg, _, err := image.Decode(bufio.NewReader(f))\ncheck(err)\npixels, err := getPixels(img)\ncheck(err)\n// Logic with pixels.\n</code></pre>\n\n<p>Now function getPixels looks like this:</p>\n\n<pre><code>func getPixels(img image.Image) ([]uint8, error) {\n    if i, ok := img.(*image.NRGBA); ok {\n        return i.Pix, nil\n    } else if i, ok := img.(*image.Alpha); ok {\n        return i.Pix, nil\n    } else if i, ok := img.(*image.Alpha16); ok {\n        return i.Pix, nil\n    } else if i, ok := img.(*image.CMYK); ok {\n        return i.Pix, nil\n    } else if i, ok := img.(*image.Gray); ok {\n        return i.Pix, nil\n    } else if i, ok := img.(*image.Gray16); ok {\n        return i.Pix, nil\n    } else if i, ok := img.(*image.NRGBA64); ok {\n        return i.Pix, nil\n    } else if i, ok := img.(*image.Paletted); ok {\n        return i.Pix, nil\n    } else if i, ok := img.(*image.RGBA); ok {\n        return i.Pix, nil\n    } else if i, ok := img.(*image.RGBA64); ok {\n        return i.Pix, nil\n    }\n    return nil, fmt.Errorf(\"unknown image type %T\", img)\n}\n</code></pre>\n\n<p>But I think this is ugly. Golang knows type of image and I would prefer something like this:</p>\n\n<pre><code>func getPixels(img image.Image) ([]uint8, error) {\n    if i, ok := img.(eval(fmt.Sprintf(\"%T\", img))); ok {\n        return i.Pix, nil\n    }\n    return nil, fmt.Errorf(\"unknown image type %T\", img)\n}\n</code></pre>\n\n<p>I also can't assert to <code>reflect.TypeOf(img)</code>. Maybe there is a way to get type from <code>reflect.Type</code> interface?</p>\n"}, {"tags": ["go", "ethereum", "go-ethereum", "glide-golang", "tendermint"], "answers": [{"tags": [], "owner": {"reputation": 53, "user_id": 7034353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89f8025609bd193b080fe27efbae06e4?s=128&d=identicon&r=PG&f=1", "display_name": "SinTan1071", "link": "https://stackoverflow.com/users/7034353/sintan1071"}, "is_accepted": true, "score": 0, "last_activity_date": 1536892513, "creation_date": 1536892513, "answer_id": 52324235, "question_id": 52163996, "link": "https://stackoverflow.com/questions/52163996/install-go-ethereum-dependencies-and-tendermint-dependencies-with-glide/52324235#52324235", "title": "install go-ethereum dependencies and tendermint dependencies with glide", "body": "<p>I figure it out, just set the mirror, and ignore some package, like this</p>\n\n<pre><code>glide mirror set https://golang.org/x/mobile https://github.com/golang/mobile --vcs git\nglide mirror set https://golang.org/x/crypto https://github.com/golang/crypto --vcs git\n....\n</code></pre>\n\n<p>ignore</p>\n\n<pre><code>- github.com/prometheus/prometheus/util/flock\n- golang.org/x/sys/cpu\n- golang.org/x/net/http2/hpack\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 7034353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89f8025609bd193b080fe27efbae06e4?s=128&d=identicon&r=PG&f=1", "display_name": "SinTan1071", "link": "https://stackoverflow.com/users/7034353/sintan1071"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 52324235, "answer_count": 1, "score": -1, "last_activity_date": 1553437803, "creation_date": 1536056236, "last_edit_date": 1553437803, "question_id": 52163996, "link": "https://stackoverflow.com/questions/52163996/install-go-ethereum-dependencies-and-tendermint-dependencies-with-glide", "title": "install go-ethereum dependencies and tendermint dependencies with glide", "body": "<p>I'm using \"glide\" to manage my go packages, here is my glide.yaml:</p>\n\n<pre><code>package: github.com/my-project\nimport:\n- package: github.com/ethereum/go-ethereum\n  version: 1.8.14\n  subpackages:\n  - cmd/utils\n  - common\n  - common/hexutil\n  - consensus/ethash\n  - core\n  - core/state\n  - core/types\n  - core/vm\n  - eth\n  - ethdb\n  - event\n  - log\n  - node\n  - p2p\n  - params\n  - rlp\n  - rpc\n- package: github.com/tendermint/tendermint\n  version: 0.23.0\n  subpackages:\n  - abci/types\n  - libs/log\n  - rpc/lib/client\n- package: gopkg.in/urfave/cli.v1\ntestImport:\n- package: github.com/stretchr/testify\n  subpackages:\n  - assert\n- package: github.com/tendermint/go-amino\n</code></pre>\n\n<p>when I run glide install, then some errors show up:</p>\n\n<pre><code>[INFO]  --&gt; Fetching updates for github.com/mattn/go-colorable\n[INFO]  --&gt; Fetching updates for github.com/huin/goupnp\n[INFO]  --&gt; Fetching updates for github.com/jackpal/go-nat-pmp\n[ERROR] Error scanning github.com/prometheus/prometheus/util/flock: \ncannot find package \".\" in:\n    /root/.glide/cache/src/https-github.com-prometheus- prometheus/util/flock\n[INFO]  --&gt; Fetching updates for github.com/elastic/gosigar\n[INFO]  --&gt; Fetching updates for github.com/mohae/deepcopy\n[INFO]  --&gt; Fetching updates for github.com/influxdata/influxdb\n</code></pre>\n\n<p>...</p>\n\n<pre><code>[ERROR] Error scanning golang.org/x/sys/cpu: cannot find package \".\" in:\n/root/.glide/cache/src/https-github.com-golang-sys/cpu\n[INFO]  --&gt; Fetching updates for github.com/matttproud/golang_protobuf_extensions\n[INFO]  --&gt; Setting version for github.com/matttproud/golang_protobuf_extensions to 3247c84500bff8d9fb6d579d800f20b3e091582c. \n[ERROR] Failed to retrieve a list of dependencies: Error resolving imports\n</code></pre>\n\n<p>so I try to change the glide mirror to my local file (I have cloned all the dependencies already), but it still not work, if someone know how to deal with it, please give me a hand, thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1536051834, "post_id": 52162151, "comment_id": 91274715, "body": "I highly recommend the Tour of Go which explains all these details with lots of examples and exercises."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1536065375, "post_id": 52162151, "comment_id": 91283129, "body": "See <a href=\"https://tour.golang.org/moretypes/1\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/1</a> et seq."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1536050381, "creation_date": 1536050381, "answer_id": 52162188, "question_id": 52162151, "link": "https://stackoverflow.com/questions/52162151/why-do-we-add-in-the-following-script-if-it-does-not-make-any-change-on-the-r/52162188#52162188", "title": "Why do we add &amp; in the following script, if it does not make any change on the result?", "body": "<p>I assume you're talking about <code>Vertex</code> vs <code>&amp;Vertex</code>?  Yes, adding <code>&amp;</code> means that <code>v</code> now contains an address to a struct of type <code>Vertex</code>, whereas without the <code>&amp;</code>, <code>v</code> would hold the struct directly.</p>\n\n<p>In your example, using the address, or the struct directly, makes no difference.  In many other cases, the distinction is very important.</p>\n"}], "owner": {"reputation": 3, "user_id": 10313873, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_aUIlp7YZw0/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaNMhVVSOFkujdVsq4_QNjCWkFqDHQ/mo/photo.jpg?sz=128", "display_name": "Go Learner", "link": "https://stackoverflow.com/users/10313873/go-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "closed_date": 1536065414, "accepted_answer_id": 52162188, "answer_count": 1, "score": -5, "last_activity_date": 1536050381, "creation_date": 1536050239, "question_id": 52162151, "link": "https://stackoverflow.com/questions/52162151/why-do-we-add-in-the-following-script-if-it-does-not-make-any-change-on-the-r", "closed_reason": "Not suitable for this site", "title": "Why do we add &amp; in the following script, if it does not make any change on the result?", "body": "<pre><code>package main\nimport (\n  \"fmt\"\n  \"math\"\n    \"reflect\"\n)\ntype Vertex struct {\n  X, Y float64\n}\nfunc (v *Vertex) Scale(f float64) {\n  v.X = v.X * f\n  v.Y = v.Y * f\n}\nfunc (v *Vertex) Abs() float64 {\n  return math.Sqrt(v.X*v.X + v.Y*v.Y)\n}\nfunc main() {\n  v := &amp;Vertex{3, 4} // Whether or not with \"&amp;\", the values don't change below.\n  fmt.Printf(\"Before scaling: %+v, Abs: %v\\n\", v, v.Abs())\n  v.Scale(5)\n  fmt.Printf(\"After scaling: %+v, Abs: %v\\n\", v, v.Abs())\n    fmt.Println(reflect.TypeOf(Vertex{3,4}))\n}\n</code></pre>\n\n<hr>\n\n<p>Hello, I am learning golang now. I do not understand what is the use of adding \"&amp;\", if it does not make any change on the result value? </p>\n\n<p>I thought we add \"&amp;\" to variables to get the memory address. If we can add \"&amp;\" to Vertex{3,4}, does this mean it is variable? Confused. </p>\n"}, {"tags": ["json", "string", "dictionary", "go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1536053568, "last_edit_date": 1592644375, "creation_date": 1536048683, "answer_id": 52161688, "question_id": 52161555, "link": "https://stackoverflow.com/questions/52161555/how-to-custom-marshal-map-keys-in-json/52161688#52161688", "title": "How to custom marshal map keys in JSON", "body": "<p>This is the expected outcome, which is documented at <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json.Marshal()</code></a>:</p>\n<blockquote>\n<p>Map values encode as JSON objects. The map's key type must either be a string, an integer type, or implement encoding.TextMarshaler. The map keys are sorted and used as JSON object keys by applying the following rules, subject to the UTF-8 coercion described for string values above:</p>\n<pre><code>- string keys are used directly\n- encoding.TextMarshalers are marshaled\n- integer keys are converted to strings\n</code></pre>\n</blockquote>\n<p>Note that map keys are handled differently than values of properties because map keys in JSON are the property names which are always <code>string</code> values (while property values may be JSON text, number and boolean values).</p>\n<p>As per the doc, if you want it to work for map keys as well, implement <a href=\"https://golang.org/pkg/encoding/#TextMarshaler\" rel=\"nofollow noreferrer\"><code>encoding.TextMarshaler</code></a>:</p>\n<pre><code>func (a Int) MarshalText() (text []byte, err error) {\n    test := a / 10\n    return []byte(fmt.Sprintf(&quot;%d-%d&quot;, a, test)), nil\n}\n</code></pre>\n<p><em>(Note that <code>MarshalText()</code> is ought to return &quot;just&quot; simple text, not JSON text, hence we omit JSON marshaling in it!)</em></p>\n<p>With this, output will be (try it on the <a href=\"https://play.golang.org/p/1sX3GuPrpyW\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>array [&quot;100-10&quot;,&quot;200-20&quot;] &lt;nil&gt;\nmap wtf? {&quot;100-10&quot;:true,&quot;200-20&quot;:true} &lt;nil&gt;\nmap must be: {&quot;100-10&quot;:true, &quot;200-20&quot;:true}\n</code></pre>\n<p>Note that <code>encoding.TextMarshaler</code> is enough as that is also checked when marsaling as values, not just for map keys. So you don't have to implement both <code>encoding.TextMarshaler</code> and <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\"><code>json.Marshaler</code></a>.</p>\n<p>If you do implement both, you can have different output when the value is marshaled as a &quot;simple&quot; value and as a map key because <code>json.Marshaler</code> takes precedence when generating a value:</p>\n<pre><code>func (a Int) MarshalJSON() ([]byte, error) {\n    test := a / 100\n    return json.Marshal(fmt.Sprintf(&quot;%d-%d&quot;, a, test))\n}\n\nfunc (a Int) MarshalText() (text []byte, err error) {\n    test := a / 10\n    return []byte(fmt.Sprintf(&quot;%d-%d&quot;, a, test)), nil\n}\n</code></pre>\n<p>This time the output will be (try it on the <a href=\"https://play.golang.org/p/nxEyRw94rgg\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>array [&quot;100-1&quot;,&quot;200-2&quot;] &lt;nil&gt;\nmap wtf? {&quot;100-10&quot;:true,&quot;200-20&quot;:true} &lt;nil&gt;\nmap must be: {&quot;100-10&quot;:true, &quot;200-20&quot;:true}\n</code></pre>\n"}], "owner": {"reputation": 2555, "user_id": 8457803, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o9dhW.jpg?s=128&g=1", "display_name": "Martin Prestone", "link": "https://stackoverflow.com/users/8457803/martin-prestone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2992, "favorite_count": 0, "accepted_answer_id": 52161688, "answer_count": 1, "score": 6, "last_activity_date": 1536053664, "creation_date": 1536048129, "last_edit_date": 1536053664, "question_id": 52161555, "link": "https://stackoverflow.com/questions/52161555/how-to-custom-marshal-map-keys-in-json", "title": "How to custom marshal map keys in JSON", "body": "<p>I can't understand a strange behavior of custom marshal <code>int</code> to <code>string</code>.</p>\n\n<p>Here is an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Int int\n\nfunc (a Int) MarshalJSON() ([]byte, error) {\n    test := a / 10\n    return json.Marshal(fmt.Sprintf(\"%d-%d\", a, test))\n}\n\nfunc main() {\n\n    array := []Int{100, 200}\n    arrayJson, _ := json.Marshal(array)\n    fmt.Println(\"array\", string(arrayJson))\n\n    maps := map[Int]bool{\n        100: true,\n        200: true,\n    }\n    mapsJson, _ := json.Marshal(maps)\n    fmt.Println(\"map wtf?\", string(mapsJson))\n    fmt.Println(\"map must be:\", `{\"100-10\":true, \"200-20\":true}`)\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>array [\"100-10\",\"200-20\"]\nmap wtf? {\"100\":true,\"200\":true}\nmap must be: {\"100-10\":true, \"200-20\":true}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iiUyL2Hc5h_P\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iiUyL2Hc5h_P</a></p>\n\n<p>What am I missing?</p>\n"}, {"tags": ["unit-testing", "http", "go", "gomega"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536048496, "post_id": 52161513, "comment_id": 91272798, "body": "There&#39;s nothing obvious in this function that would make it non-idempotent. You may need to include additional code to expose the problem."}, {"owner": {"reputation": 1811, "user_id": 1693831, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Pe08p.png?s=128&g=1", "display_name": "category", "link": "https://stackoverflow.com/users/1693831/category"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536049919, "post_id": 52161513, "comment_id": 91273559, "body": "I&#39;ve found the problem - in <code>serveTestReq</code> I need to return <code>rr</code>, and check there for the HTTP Response."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536049965, "post_id": 52161513, "comment_id": 91273581, "body": "Glad you found the solution"}], "answers": [{"tags": [], "owner": {"reputation": 1811, "user_id": 1693831, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Pe08p.png?s=128&g=1", "display_name": "category", "link": "https://stackoverflow.com/users/1693831/category"}, "is_accepted": false, "score": 0, "last_activity_date": 1536050680, "creation_date": 1536050680, "answer_id": 52162286, "question_id": 52161513, "link": "https://stackoverflow.com/questions/52161513/wrapping-httptest-methods-in-a-helper-function/52162286#52162286", "title": "Wrapping httptest methods in a helper function", "body": "<p>The problem was that I wasn't checking for the HTTP Response generated in the function. The correct function looks like: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func serveTestReq(payload string, route string, method string, handlerfunc func(w http.ResponseWriter, r *http.Request), token string) *httptest.RepsonseRecorder {\n        body := strings.NewReader(payload)\n        req, err := http.NewRequest(method, route, body)\n        Expect(err).NotTo(HaveOccurred())\n\n        req.Header.Add(\"Content\", \"application/json\")\n        req.Header.Add(\"Authorization\", \"Bearer \"+token)\n\n        handler := authMiddleware(handlerfunc)\n        rr := httptest.NewRecorder()\n        handler.ServeHTTP(rr, req)\n\n        return rr\n\n}\n</code></pre>\n"}], "owner": {"reputation": 1811, "user_id": 1693831, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Pe08p.png?s=128&g=1", "display_name": "category", "link": "https://stackoverflow.com/users/1693831/category"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536050680, "creation_date": 1536048003, "question_id": 52161513, "link": "https://stackoverflow.com/questions/52161513/wrapping-httptest-methods-in-a-helper-function", "title": "Wrapping httptest methods in a helper function", "body": "<p>In my handler tests, I use the pattern of serving a test request with an authentication token in the header a large number of times. To abstract this, and save myself a large number of lines, I've written the following function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func serveTestReq(payload string, route string, method string, handlerfunc func(w http.ResponseWriter, r *http.Request), token string) {\n        body := strings.NewReader(payload)\n        req, err := http.NewRequest(method, route, body)\n        Expect(err).NotTo(HaveOccurred())\n\n        req.Header.Add(\"Content\", \"application/json\")\n        req.Header.Add(\"Authorization\", \"Bearer \"+token)\n\n        handler := authMiddleware(handlerfunc)\n        rr := httptest.NewRecorder()\n        handler.ServeHTTP(rr, req)\n\n}\n</code></pre>\n\n<p>However if I call this function twice (to test for idempotent <code>POST</code>s, for example) the request seems to only be served once. Is there something wrong with the above function?</p>\n"}, {"tags": ["unit-testing", "testing", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1536047217, "post_id": 52161263, "comment_id": 91272126, "body": "There is no &quot;right&quot; or &quot;wrong&quot; answer to this, but I would store the words in a separate file, probably in a directory called <code>test&#47;</code>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1536047556, "post_id": 52161263, "comment_id": 91272344, "body": "0.21M is not much for a slice unless you run on tiny hardware. If in doubt: measure."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 6, "creation_date": 1536047969, "post_id": 52161263, "comment_id": 91272547, "body": "@Flimzy Store the file in a folder named <code>testdata</code>, that is special and reserved for exactly this (<a href=\"https://github.com/golang/go/issues/14715\" rel=\"nofollow noreferrer\">reference</a>)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1536047992, "post_id": 52161263, "comment_id": 91272559, "body": "@icza: Today I learned something new..."}, {"owner": {"reputation": 43, "user_id": 9748966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a42158772ceb3c347879d0f52c35447c?s=128&d=identicon&r=PG", "display_name": "Alex T. Liu", "link": "https://stackoverflow.com/users/9748966/alex-t-liu"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536110913, "post_id": 52161263, "comment_id": 91302359, "body": "@Volker yes you are right, I think it&#39;s not much for a slice at that size"}, {"owner": {"reputation": 43, "user_id": 9748966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a42158772ceb3c347879d0f52c35447c?s=128&d=identicon&r=PG", "display_name": "Alex T. Liu", "link": "https://stackoverflow.com/users/9748966/alex-t-liu"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536111218, "post_id": 52161263, "comment_id": 91302399, "body": "@icza thanks for pointing this <code>testdata</code> out"}, {"owner": {"reputation": 43, "user_id": 9748966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a42158772ceb3c347879d0f52c35447c?s=128&d=identicon&r=PG", "display_name": "Alex T. Liu", "link": "https://stackoverflow.com/users/9748966/alex-t-liu"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536111334, "post_id": 52161263, "comment_id": 91302418, "body": "@Flimzy yes i think store the words in a separate file will be much neater"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 9748966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a42158772ceb3c347879d0f52c35447c?s=128&d=identicon&r=PG", "display_name": "Alex T. Liu", "link": "https://stackoverflow.com/users/9748966/alex-t-liu"}, "edited": false, "score": 0, "creation_date": 1536110603, "post_id": 52161785, "comment_id": 91302308, "body": "I think the idea of putting test data in <code>testdata</code> is fantastic, this is exactly the answer I&#39;m looking for, thanks for your help."}], "tags": [], "owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "is_accepted": true, "score": 2, "last_activity_date": 1536049581, "last_edit_date": 1536049581, "creation_date": 1536048991, "answer_id": 52161785, "question_id": 52161263, "link": "https://stackoverflow.com/questions/52161263/how-to-write-a-go-test-that-need-massive-test-case/52161785#52161785", "title": "how to write a go test that need massive test case", "body": "<p>Test data is usually stored in a directory named <code>testdata</code> to keep it separate from the other source code or data files (see the docs from the command <code>go help test</code>). The <code>go</code> tool ignores stuff inside that directory.</p>\n\n<p>210,000 words should take up only single digit megabytes of RAM anyway, which isn't much. Just have a helper function that reads the words from the file before each test (perhaps caching them), or define a <a href=\"https://golang.org/pkg/testing/#hdr-Main\" rel=\"nofollow noreferrer\"><code>TestMain()</code></a> function which reads them once and stores them in a global variable for access by tests that are subsequently run.</p>\n\n<p><em>Edit</em>: Regarding best practices, it's sometimes nicer to store test data in <code>testdata</code> even if the data isn't large. For example, I sometimes need to use multiple short JSON snippets in test cases, and perhaps use them more than once. Storing them in appropriately named files under a subdirectory of <code>testdata</code> can be more readable than littering Go code with a bunch of JSON snippets.</p>\n\n<p>The slight loss of performance is generally not an issue in tests. Whichever method makes the code easier to understand could be the 'best practice'.</p>\n"}], "owner": {"reputation": 43, "user_id": 9748966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a42158772ceb3c347879d0f52c35447c?s=128&d=identicon&r=PG", "display_name": "Alex T. Liu", "link": "https://stackoverflow.com/users/9748966/alex-t-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 52161785, "answer_count": 1, "score": 1, "last_activity_date": 1536049581, "creation_date": 1536047088, "question_id": 52161263, "link": "https://stackoverflow.com/questions/52161263/how-to-write-a-go-test-that-need-massive-test-case", "title": "how to write a go test that need massive test case", "body": "<p>Let's say I have a list that has about 210000 english words. </p>\n\n<ul>\n<li>I need to use all these 210000 words as test case. </li>\n<li>I need to make sure every words in that list is covered every time I run my test.</li>\n</ul>\n\n<p>The question is: What is the best practices to store these words in my test? </p>\n\n<p>should I save all these words in a slice (will it be too large a slice? ), or should I save these words in a external file (like words.txt) and load the file line by line when needed?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536046873, "post_id": 52161097, "comment_id": 91271912, "body": "I don&#39;t fully understand your input format. Can you include a couple examples of this &quot;dynamic date range&quot; you&#39;re describing?"}, {"owner": {"reputation": 121, "user_id": 8947822, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-HiaMBkFkhpY/AAAAAAAAAAI/AAAAAAAArK4/OKIX8_xoG6g/photo.jpg?sz=128", "display_name": "Connor", "link": "https://stackoverflow.com/users/8947822/connor"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536047186, "post_id": 52161097, "comment_id": 91272095, "body": "@Flimzy in the bpi section I can request from the api a date range so it could be a list of a 100 days of data"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536047253, "post_id": 52161097, "comment_id": 91272153, "body": "That looks like a simple map. Is there some reason <code>map[string]float64</code> won&#39;t work for you?"}, {"owner": {"reputation": 121, "user_id": 8947822, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-HiaMBkFkhpY/AAAAAAAAAAI/AAAAAAAArK4/OKIX8_xoG6g/photo.jpg?sz=128", "display_name": "Connor", "link": "https://stackoverflow.com/users/8947822/connor"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536047398, "post_id": 52161097, "comment_id": 91272239, "body": "The current way I have it is working for me but I&#39;m wondering if I&#39;m going about it in an overly complicated fashion."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1536047452, "post_id": 52161097, "comment_id": 91272273, "body": "The method you have in your question is overly complicated, yes.  Unless there are surprises you haven&#39;t described, just unmarshal to a struct with a field like this:  <code>BPI map[string]float64</code>"}, {"owner": {"reputation": 121, "user_id": 8947822, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-HiaMBkFkhpY/AAAAAAAAAAI/AAAAAAAArK4/OKIX8_xoG6g/photo.jpg?sz=128", "display_name": "Connor", "link": "https://stackoverflow.com/users/8947822/connor"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536047507, "post_id": 52161097, "comment_id": 91272313, "body": "Got it I&#39;ll give it a try. Thanks for your help!"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1536047641, "post_id": 52161097, "comment_id": 91272392, "body": "Your JSON is not unstructured or dynamic."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536067642, "post_id": 52161097, "comment_id": 91284712, "body": "No JSON is unstructured. JSON is the structure. If it&#39;s unstructured, it&#39;s not valid JSON."}], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 1, "last_activity_date": 1536072052, "last_edit_date": 1536072052, "creation_date": 1536060676, "answer_id": 52165332, "question_id": 52161097, "link": "https://stackoverflow.com/questions/52161097/unmarshalling-json-data-into-map-in-go/52165332#52165332", "title": "Unmarshalling Json data into map in Go", "body": "<p>Assuming that you know the top level keys, e.g. <code>bpi</code>, <code>disclaimer</code>, <code>time</code> etc and that the \"dynamic data pairs\" that you are talking about are part of the <code>bpi</code> field, and that the key and value types of each of the members of <code>bpi</code> are always <code>string: decimal number</code> you do something like....</p>\n\n<pre><code>type APIResp struct {\n    BPI        map[string]float64 `json:\"bpi\"`\n    Disclaimer string\n    // other fields\n}\n</code></pre>\n\n<p>Now each of your pairs will be typed correctly and contained in the <code>APIResp.BPI</code> map. Unmarshal as you are doing already;</p>\n\n<pre><code>var r APIResp\nerr := json.Unmarshal(body, &amp;r)\n// TODO: check err\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 8947822, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-HiaMBkFkhpY/AAAAAAAAAAI/AAAAAAAArK4/OKIX8_xoG6g/photo.jpg?sz=128", "display_name": "Connor", "link": "https://stackoverflow.com/users/8947822/connor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 52165332, "answer_count": 1, "score": 0, "last_activity_date": 1536098343, "creation_date": 1536046463, "last_edit_date": 1536098343, "question_id": 52161097, "link": "https://stackoverflow.com/questions/52161097/unmarshalling-json-data-into-map-in-go", "title": "Unmarshalling Json data into map in Go", "body": "<p>I am dealing with an api that returns json data such as:</p>\n\n<pre><code>    {\n  \"bpi\": {\n    \"2018-06-01\": 128.2597,\n    \"2018-06-02\": 127.3648\n  },\n  \"disclaimer\": \"something here.\",\n  \"time\": {\n    \"updated\": \"Sep 6, 2013 00:03:00 UTC\",\n    \"updatedISO\": \"2013-09-06T00:03:00+00:00\"\n  }\n</code></pre>\n\n<p>However the price data that has the accompanying dates can return a dynamic date range (ie could be anything from 1 data pair to 1000).</p>\n\n<p>I'm trying to take only the date and price pairs and put them into a map for later consumption, but I'm not finding a straight forward way of doing it. When I put this into a json-to-go auto struct generator it will create a statically and named struct for the pricing.</p>\n\n<p>This is my best attempt at handling the data dynamically. I am passing an empty interface from the response body of the http get, specifically:</p>\n\n<p><code>var unstructuredJSON interface{}\n json.Unmarshal(body, &amp;unstructuredJSON)</code></p>\n\n<p>and passing the unstructuredJSON to the function:</p>\n\n<pre><code>func buildPriceMap(unstructuredJSON interface{}, priceMap map[string]float64) {\njsonBody := unstructuredJSON.(map[string]interface{})\n\nfor k, v := range jsonBody {\n    switch vv := v.(type) {\n    case string:\n        // Do Nothing\n    case float64:\n        priceMap[k] = vv\n    case interface{}:\n        buildPriceMap(vv, priceMap)\n    default:\n        log.Fatal(\"Json unknown data handling unmarshal error: \", k, vv)\n    }\n}\n</code></pre>\n\n<p>Is there a better way to do this?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1536052496, "post_id": 52161008, "comment_id": 91275106, "body": "lots of views :) but as I didnt receive any comment/answer , is that so complicated to achive with golang? in node.js I&#39;ve used Lodash to deal with this such of scenario but in golang I didnt find something similar which make it a bit harder to handle"}, {"owner": {"reputation": 365, "user_id": 2130607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6423be6ad9f861ddba9f1f1016cf2b4?s=128&d=identicon&r=PG", "display_name": "Kebeng", "link": "https://stackoverflow.com/users/2130607/kebeng"}, "edited": false, "score": 0, "creation_date": 1536058932, "post_id": 52161008, "comment_id": 91278942, "body": "i think it happens because you have 2 struct with <code>app1</code> and you update it by using map, so it will only update the last one assigned to the map"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1536068267, "creation_date": 1536046175, "last_edit_date": 1536068267, "question_id": 52161008, "link": "https://stackoverflow.com/questions/52161008/match-data-from-structs-objects", "title": "Match data from structs objects", "body": "<p>in the following code (which I re-used from previous question) we need to match objects according to matching <strong>keys</strong> values</p>\n\n<blockquote>\n  <p>The keys are the value of</p>\n</blockquote>\n\n<p>From model <code>internalConfig</code></p>\n\n<p><strong>type</strong></p>\n\n<p>From external config</p>\n\n<p><strong>app-type</strong></p>\n\n<p>In case we have 'match' (in the value) we need to replace the data from the external config and update the internal config</p>\n\n<p><strong>e.g</strong>. if for zone2 app-type=app1  is equal to internal config type=app1 we need to change the content from external config to be </p>\n\n<p><strong>from</strong> </p>\n\n<pre><code>- name: TEST\n  type: app1\n  target: ./\n</code></pre>\n\n<p>to (since app1 is equal in internal and external config- we are updating the data from external to internal) </p>\n\n<pre><code>- name: TEST\n  type: AZURE \n  target: ./\n</code></pre>\n\n<p>given the above data the internal config should look after the match like</p>\n\n<p><strong>At the end it should look like</strong></p>\n\n<pre><code>- name: TEST\n  type: AZURE \n  target: ./\n\n- name: TEST3\n  type: HEROKU\n  target: ./\n\n- name: TEST2\n  type: app3\n  target: ./\n\n- name: TEST2\n  type: AZURE \n  target: ./\n</code></pre>\n\n<p>Im trying the following but I wasn\u2019t able to match all the objects in case I\u2019ve more then one entry to the same key \ne.g.  app1 \u201ckey\u201d is in the first and the last entry, so my code is update only the first entry</p>\n\n<pre><code>- name: TEST\n  type: app1\n  target: ./\n\n- name: TEST3\n  type: app2\n  target: ./\n\n- name: TEST2\n  type: app3\n  target: ./\n\n- name: TEST2\n  type: app1\n  target: ./\n</code></pre>\n\n<p>Any idea how could I resolve this ? this is what i've tried which works <strong>only on the first match</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/yaml.v2\"\n    \"log\"\n)\n\n\ntype InternalConfig struct {\n    Models []Imodel `yaml:\"models\"`\n}\n\ntype Imodel struct {\n    Name   string `yaml:\"name\"`\n    Type   string `yaml:\"type\"`\n    Target string `yaml:\"target\"`\n}\n\nvar internalConfig = []byte(`\nmodels:\n   - name: TEST\n     type: app1\n     target: ./\n\n   - name: TEST3\n     type: app2\n     target: ./\n\n   - name: TEST2\n     type: app3\n     target: ./\n\n   - name: TEST2\n     type: app1\n     target: ./\n`)\n\ntype ExternalConfig struct {\n    Landscape Zone `yaml:\"Landscape\"`\n}\n\ntype Zone struct {\n    Zone   string   `yaml:\"zone\"`\n    Models []Emodel `yaml:\"models\"`\n}\n\ntype Emodel struct {\n    AppType     string `yaml:\"app-type\"`\n    ServiceType string `yaml:\"service-type\"`\n}\n\nvar externalConfig = []byte(`\nLandscape:\n  zone: zone1\n  models:\n    - app-type: app1\n      service-type: GCP\n    - app-type: app2\n      service-type: AMAZON\n  zone: zone2\n  models:\n    - app-type: app1\n      service-type: AZURE\n    - app-type: app2\n      service-type: HEROKU\n`)\n\nfunc main() {\n    iCfgYaml := InternalConfig{}\n    if err := yaml.Unmarshal(internalConfig, &amp;iCfgYaml); err != nil {\n        log.Fatalf(\"error in model InternalConfig: %v\", err)\n    }\n\n    eCfgYaml := ExternalConfig{}\n    if err := yaml.Unmarshal(externalConfig, &amp;eCfgYaml); err != nil {\n        log.Fatalf(\"error in model ExternalConfig: %v\", err)\n    }\n    if err := UpdateInternalState(&amp;iCfgYaml, eCfgYaml, \"zone2\"); err != nil {\n        log.Fatalf(\"Error updating internal config: %v\", err)\n    }\n    fmt.Printf(\"DBG: %+v\\n\", iCfgYaml)\n}\n\nfunc UpdateInternalState(iCfg *InternalConfig, eCfg ExternalConfig, zone string) error {\n    ilm := make(map[string]int)\n    for i, v := range iCfg.Models {\n        ilm[v.Type] = i\n    }\n    for _, em := range eCfg.Landscape.Models {\n        if eCfg.Landscape.Zone == zone {\n\n            if i, ok := ilm[em.AppType]; ok {\n                iCfg.Models[i].Type = em.ServiceType\n            }\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>if you run the code above, this is the data you will get</p>\n\n<pre><code>{Models:[\n{Name:TEST Type:app1 Target:./} \n{Name:TEST3 Type:HEROKU Target:./} \n{Name:TEST2 Type:app3 Target:./} \n{Name:TEST2 Type:AZURE Target:./}]}\n</code></pre>\n\n<p><strong>The first entry doesn't updated</strong> </p>\n\n<p><a href=\"https://play.golang.org/p/5f3Ad9Z7fqY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5f3Ad9Z7fqY</a></p>\n\n<p>If needs more clarification please let me know</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 30856, "user_id": 105562, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/e66ceae48943526967c5118011e58b63?s=128&d=identicon&r=PG", "display_name": "Travis Reeder", "link": "https://stackoverflow.com/users/105562/travis-reeder"}, "edited": false, "score": 0, "creation_date": 1536073296, "post_id": 52160934, "comment_id": 91288676, "body": "Thanks, that works, and I had actually tried that, but I used <code>SetPrec(128)</code> and that doesn&#39;t work. Turns out 128 and 64 don&#39;t work, work but everything around it does... Any idea why that is? See results here: <a href=\"https://play.golang.org/p/KLnPY8cqKpe\" rel=\"nofollow noreferrer\">play.golang.org/p/KLnPY8cqKpe</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 30856, "user_id": 105562, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/e66ceae48943526967c5118011e58b63?s=128&d=identicon&r=PG", "display_name": "Travis Reeder", "link": "https://stackoverflow.com/users/105562/travis-reeder"}, "edited": false, "score": 0, "creation_date": 1536074785, "post_id": 52160934, "comment_id": 91289646, "body": "@TravisReeder I assume it is due to the fact that <code>0.001</code> cannot be represented precisely, and when using finite bits, the implementation rounds <code>0.001</code> to the closest number representable using the given precision. Sometimes it might mean to round up, sometimes to round down."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1536046458, "last_edit_date": 1536046458, "creation_date": 1536045899, "answer_id": 52160934, "question_id": 52160754, "link": "https://stackoverflow.com/questions/52160754/strange-loss-of-precision-multiplying-big-float/52160934#52160934", "title": "Strange loss of precision multiplying big.Float", "body": "<p>The difference in output is due to imprecise representation of base 10 floating point numbers in <code>float64</code> (<a href=\"https://en.wikipedia.org/wiki/IEEE_754\" rel=\"nofollow noreferrer\">IEEE-754 format</a>) and the default precision and rounding of <a href=\"https://golang.org/pkg/math/big/#Float\" rel=\"nofollow noreferrer\"><code>big.Float</code></a>.</p>\n\n<p>See this simple code to verify:</p>\n\n<pre><code>fmt.Printf(\"%.30f\\n\", 0.001)\nf, ok := new(big.Float).SetString(\"0.001\")\nfmt.Println(f.Prec(), ok)\n</code></pre>\n\n<p>Output of the above (try it on the <a href=\"https://play.golang.org/p/-lYbQw1U8lE\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0.001000000000000000020816681712\n64 true\n</code></pre>\n\n<p>So what we see is that the <code>float64</code> value <code>0.001</code> is not exactly <code>0.001</code>, and the default precision of <code>big.Float</code> is 64.</p>\n\n<p>If you increase the precision of the number you set via a <code>string</code> value, you will see the same output:</p>\n\n<pre><code>s := \"0.001\"\nf := new(big.Float)\nf.SetPrec(100)\nf.SetString(s)\nfmt.Println(s)\nfmt.Println(BigFloatToBigInt(f))\n</code></pre>\n\n<p>Now output will also be the same (try it on the <a href=\"https://play.golang.org/p/LjWbA8-YKcc\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0.001\n1000000000000000\n</code></pre>\n"}], "owner": {"reputation": 30856, "user_id": 105562, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/e66ceae48943526967c5118011e58b63?s=128&d=identicon&r=PG", "display_name": "Travis Reeder", "link": "https://stackoverflow.com/users/105562/travis-reeder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536047087, "creation_date": 1536045156, "last_edit_date": 1536047087, "question_id": 52160754, "link": "https://stackoverflow.com/questions/52160754/strange-loss-of-precision-multiplying-big-float", "title": "Strange loss of precision multiplying big.Float", "body": "<p>If you parse a string into a big.Float like <code>f.SetString(\"0.001\")</code>, then multiply it, I'm seeing a loss of precision. If I use <code>f.SetFloat64(0.001)</code>, I don't lose precision. Even doing a <code>strconv.ParseFloat(\"0.001\", 64)</code>, then calling <code>f.SetFloat()</code> works.</p>\n\n<p>Full example of what I'm seeing here: </p>\n\n<p><a href=\"https://play.golang.org/p/_AyTHJJBUeL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_AyTHJJBUeL</a></p>\n\n<p>Expanded from this question: <a href=\"https://stackoverflow.com/a/47546136/105562\">https://stackoverflow.com/a/47546136/105562</a></p>\n"}, {"tags": ["go", "httpclient"], "comments": [{"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 2, "creation_date": 1536043018, "post_id": 52160030, "comment_id": 91269880, "body": "What is the req.StatusCode in the nil cases?  I also think the server code is more important for this issue."}, {"owner": {"reputation": 447, "user_id": 3116634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ATBrw.jpg?s=128&g=1", "display_name": "Avinash", "link": "https://stackoverflow.com/users/3116634/avinash"}, "reply_to_user": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1536045306, "post_id": 52160030, "comment_id": 91271066, "body": "Haven&#39;t traced yet, +1 for suggesting."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536068369, "post_id": 52160030, "comment_id": 91285229, "body": "If it&#39;s the server that has the high goroutine count (it&#39;s unclear from the question but that&#39;s the impression I get), then we need to see the server code, not the client code."}, {"owner": {"reputation": 942, "user_id": 1320685, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07168c459dcd35c128757f8529306160?s=128&d=identicon&r=PG", "display_name": "Kevin Lyda", "link": "https://stackoverflow.com/users/1320685/kevin-lyda"}, "edited": false, "score": 0, "creation_date": 1537164396, "post_id": 52160030, "comment_id": 91667387, "body": "What&#39;s the ulimit on the number of open files?"}, {"owner": {"reputation": 349, "user_id": 774282, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/928238c89437d1bc4b6bf8c4f6a5c70b?s=128&d=identicon&r=PG", "display_name": "shiva", "link": "https://stackoverflow.com/users/774282/shiva"}, "reply_to_user": {"reputation": 942, "user_id": 1320685, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/07168c459dcd35c128757f8529306160?s=128&d=identicon&r=PG", "display_name": "Kevin Lyda", "link": "https://stackoverflow.com/users/1320685/kevin-lyda"}, "edited": false, "score": 0, "creation_date": 1537340249, "post_id": 52160030, "comment_id": 91743773, "body": "@KevinLyda ulimit is 64000"}, {"owner": {"reputation": 447, "user_id": 3116634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ATBrw.jpg?s=128&g=1", "display_name": "Avinash", "link": "https://stackoverflow.com/users/3116634/avinash"}, "reply_to_user": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1537340665, "post_id": 52160030, "comment_id": 91743976, "body": "@ZAky, As you mentioned, I have traced the error, the client is returning &quot;dial tcp xyz.com : socket: too many open files&quot;"}, {"owner": {"reputation": 447, "user_id": 3116634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ATBrw.jpg?s=128&g=1", "display_name": "Avinash", "link": "https://stackoverflow.com/users/3116634/avinash"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1537340807, "post_id": 52160030, "comment_id": 91744053, "body": "@Adrian, It&#39;s an another project(micro service), and it&#39;s working well indepdently."}], "owner": {"reputation": 447, "user_id": 3116634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ATBrw.jpg?s=128&g=1", "display_name": "Avinash", "link": "https://stackoverflow.com/users/3116634/avinash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1536043099, "creation_date": 1536042510, "last_edit_date": 1536043099, "question_id": 52160030, "link": "https://stackoverflow.com/questions/52160030/http-client-returning-result-as-null", "title": "HTTP client returning result as null", "body": "<p>We are running core go server in production under load balancer and other stuff. </p>\n\n<p>Now when goroutine count(with pprof trace) is more than 2500, our HTTP client is returning nil as result.</p>\n\n<p><a href=\"https://i.stack.imgur.com/fXDbD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fXDbD.png\" alt=\"PPROD Trace\"></a></p>\n\n<p>Here is my code for HTTP client.</p>\n\n<pre><code>client := &amp;http.Client{\nTimeout:   time.Second * 130,\nTransport: netTransport,\nCheckRedirect: func(req *http.Request, via []*http.Request) error {\n    return http.ErrUseLastResponse\n},\n}\nctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)\ndefer cancel()\ngo func() {\n    select {\n    case &lt;-ctx.Done():\n        log.Error(ctx.Err()) // prints \"context deadline exceeded\"\n        return\n    }\n}()\nvars := mux.Vars(r)\nvalidateTokenURL = authURL + \"/\" + vars[\"resource\"] + \"/authorized\" + \"?url=\" + path\nreq, _ := http.NewRequest(\"GET\", validateTokenURL, nil)\nreq.Header = r.Header\nreq = req.WithContext(ctx)\nres, error := client.Do(req)\n\nif error != nil {\n    log.Error(\"The group's number increased tremendously!\")\n    return nil, nil, false\n}\nbody, err := ioutil.ReadAll(res.Body)\nif err != nil {\n    log.Error(err.Error())\n}\njson.Unmarshal(body, &amp;responseBody)\nres.Body.Close()\nif _, ok := responseBody[\"data\"]; ok &amp;&amp; strings.Compare(reflect.TypeOf(responseBody[\"data\"]).String(), \"string\") == 0 &amp;&amp; strings.Compare(responseBody[\"data\"].(string), \"ok\") == 0 {\n    return responseBody, res, true\n}\nreturn responseBody, res, false\n}\n</code></pre>\n\n<p>I have set ulimit to approx 8 GB, plus we have 16 GB as RAM. Memory uses is less than 20%. </p>\n\n<p>Can anyone help us to figure it out what we are missing?</p>\n"}, {"tags": ["go", "time", "gmt"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536042789, "post_id": 52157392, "comment_id": 91269780, "body": "You can&#39;t format a timestamp as GMT, because GMT isn&#39;t a format. It&#39;s a timezone."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1536021495, "creation_date": 1536021495, "answer_id": 52157426, "question_id": 52157392, "link": "https://stackoverflow.com/questions/52157392/how-do-i-format-a-timestamp-as-gmt-in-go/52157426#52157426", "title": "How do I format a timestamp as GMT in Go?", "body": "<p>Use the <a href=\"https://godoc.org/net/http#TimeFormat\" rel=\"noreferrer\">http.TimeFormat</a> layout to format times for HTTP headers.  This layout assumes a time in the UTC location.</p>\n\n<pre><code> s := t.UTC().Format(http.TimeFormat)\n</code></pre>\n\n<p>If the time is known to be in UTC, then the call to UTC() can be skipped:</p>\n\n<pre><code> s := t.Format(http.TimeFormat)\n</code></pre>\n"}], "owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2662, "favorite_count": 3, "accepted_answer_id": 52157426, "answer_count": 1, "score": 2, "last_activity_date": 1536022401, "creation_date": 1536021160, "question_id": 52157392, "link": "https://stackoverflow.com/questions/52157392/how-do-i-format-a-timestamp-as-gmt-in-go", "title": "How do I format a timestamp as GMT in Go?", "body": "<p>I need to format a timestamp with RFC2616, the standard for HTTP dates. However, the standard says:</p>\n\n<blockquote>\n  <p>All HTTP date/time stamps MUST be represented in Greenwich Mean Time (GMT), without exception.</p>\n</blockquote>\n\n<p>From a little digging GMT and UTC are not the same thing. Is there a proper way to convert a timestamp to GMT in Go?</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1536016676, "post_id": 52156997, "comment_id": 91264322, "body": "In this case <code>wg.Wait()</code> shouldn&#39;t be right after the go routine?"}, {"owner": {"reputation": 75598, "user_id": 226897, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/02f02fcd0e0adfd6f5d5d1d594a8953c?s=128&d=identicon&r=PG", "display_name": "Abe Miessler", "link": "https://stackoverflow.com/users/226897/abe-miessler"}, "reply_to_user": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1536016875, "post_id": 52156997, "comment_id": 91264356, "body": "@HamzaAnis - hrrm - it&#39;s not <i>right</i> after the go routine right?  It&#39;s after the two <code>for</code> loops.  Does that change anything?"}, {"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 1, "creation_date": 1536017835, "post_id": 52156997, "comment_id": 91264545, "body": "Ok, I understand the problem, you are getting different number of values here and order doesn&#39;t matter in your case. wg.Wait() should be after the go routine when  you would have needed ordered data in the array ."}, {"owner": {"reputation": 75598, "user_id": 226897, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/02f02fcd0e0adfd6f5d5d1d594a8953c?s=128&d=identicon&r=PG", "display_name": "Abe Miessler", "link": "https://stackoverflow.com/users/226897/abe-miessler"}, "reply_to_user": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1536019235, "post_id": 52156997, "comment_id": 91264786, "body": "@HamzaAnis - you are right - that fixed it.  Can you explain why that works? I assumed <code>wg.Wait</code> was just telling everything to wait for all the go routines to finish and that it didn&#39;t really matter if it was after the call to the go routine or right before the function exited?"}, {"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1536021316, "post_id": 52156997, "comment_id": 91265112, "body": "Yes you are right. It waits for all the go routines to finish and what was happening before is that while the routine was appending value in the slice the routine was ending and the <code>append</code> wasn&#39;t completing. that&#39;s why there were different length of slice."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1536032825, "post_id": 52156997, "comment_id": 91267095, "body": "Always run concurrent code under the race detector."}], "answers": [{"tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": true, "score": 2, "last_activity_date": 1536020237, "creation_date": 1536020237, "answer_id": 52157315, "question_id": 52156997, "link": "https://stackoverflow.com/questions/52156997/inconsistent-results-with-concurrent-function/52157315#52157315", "title": "Inconsistent results with concurrent function?", "body": "<p>the <code>lengths = append(lengths, length)</code> is getting executed concurrently. This is not safe and will cause problems like missing entries from slice. You can fix this by wrapping the append calls in a mutex, or have the gorountines publish their results to a channel and have a single place that collects them up into a slice.</p>\n"}], "owner": {"reputation": 75598, "user_id": 226897, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/02f02fcd0e0adfd6f5d5d1d594a8953c?s=128&d=identicon&r=PG", "display_name": "Abe Miessler", "link": "https://stackoverflow.com/users/226897/abe-miessler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 52157315, "answer_count": 1, "score": -3, "last_activity_date": 1536020237, "creation_date": 1536016339, "question_id": 52156997, "link": "https://stackoverflow.com/questions/52156997/inconsistent-results-with-concurrent-function", "title": "Inconsistent results with concurrent function?", "body": "<p>I am trying to process lines from a file concurrently, but for some reason I appear to be getting inconsistent results.  A simplified version of my code is below:</p>\n\n<pre><code>  var wg sync.WaitGroup\n  semaphore := make(chan struct{}, 2)\n  lengths:= []int{}\n\n  for _, file := range(args[1:]){\n    // Open the file and start reading it\n    reader, err := os.Open(file)\n    if err != nil {\n      fmt.Println(\"Problem reading input file:\", file)\n      fmt.Println(\"Error:\", err)\n      os.Exit(0)\n    }\n    scanner := bufio.NewScanner(reader)\n    // Start streaming lines\n    for scanner.Scan() {\n      wg.Add(1)\n      text := scanner.Text()\n      semaphore &lt;- struct{}{}\n      go func(line string) {\n          length := getInformation(line)\n          lengths = append(lengths, length)\n          &lt;-semaphore\n          wg.Done()\n      }(text)\n    }\n  }\n  wg.Wait()\n  sort.Ints(lengths)\n  fmt.Println(\"Lengths:\", lengths)\n</code></pre>\n\n<p>The <code>getInformation</code> function is just returning the length of the line.  I then take that line and add it to an array.  The issue I'm having is that when I run this multiple times against the same file I get different number of items in my array.  I had assumed that since I was using a <code>waitGroup</code> that all lines would be processed every time and therefore the contents of <code>lengths</code> would be the same, but this does not appear to be the case.  Can anyone see what I am doing wrong here?</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1536030756, "post_id": 52156444, "comment_id": 91266681, "body": "is the buffer empty?"}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1536031384, "post_id": 52156444, "comment_id": 91266801, "body": "you are not supposed to pass string type to c, use <code>C.CBytes()</code>, instead of creating <code>BufStr</code> and passing it."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1536043336, "post_id": 52156444, "comment_id": 91270051, "body": "@nilsocket yes you are right, I wasn&#39;t sure about it is the right way of writing. The C function returns buffer via void*buffer, which is something I wish to receive."}], "answers": [{"comments": [{"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1536043396, "post_id": 52159645, "comment_id": 91270093, "body": "Thank you! Is it safe for garbage collection? is buffer under the Go GC control?"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "reply_to_user": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 1, "creation_date": 1536043604, "post_id": 52159645, "comment_id": 91270200, "body": "It is safe, as long as you do not keep a pointer to this buffer in your C code you will have no problems. Your buffer is in Go, you just let C write to it for a while."}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 1, "last_activity_date": 1536040685, "creation_date": 1536040685, "answer_id": 52159645, "question_id": 52156444, "link": "https://stackoverflow.com/questions/52156444/how-to-return-byte-from-internal-void-in-c-function-by-cgo/52159645#52159645", "title": "How to return []byte from internal void * in C function by CGO?", "body": "<p>Assuming that your <code>parser_shift</code> function returns the number of bytes actually stored in the buffer, you can do something like this:</p>\n\n<pre><code>func (p *Parser) Shift() []byte {\n    var buffer [8192]byte\n    parsed := int(C.parser_shift(p.Cparser, unsafe.Pointer(&amp;buffer[0]), C.int(len(buffer))))\n    return buffer[:parsed]\n}\n</code></pre>\n\n<p>There is no need to convert to or from string, just pass it the memory that you want it to write to.</p>\n"}], "owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 867, "favorite_count": 0, "accepted_answer_id": 52159645, "answer_count": 1, "score": 0, "last_activity_date": 1536040685, "creation_date": 1536010889, "question_id": 52156444, "link": "https://stackoverflow.com/questions/52156444/how-to-return-byte-from-internal-void-in-c-function-by-cgo", "title": "How to return []byte from internal void * in C function by CGO?", "body": "<p>I am wrapping an C function with the following definition:</p>\n\n<pre><code>int parser_shift(parser* parser, void* buffer, int length);\n</code></pre>\n\n<p>It removes up to length bytes from internal buffer of unparsed bytes, storing them in the given buffer.</p>\n\n<p>Now I wish to wrap it into a Go function with the following definition:</p>\n\n<pre><code>func (p *Parser) Shift() []byte {\n    var buffer []byte\n    // TODO:\n\n    return buffer\n}\n</code></pre>\n\n<p>What is the right way of writing to finish the TODO in above with CGO? </p>\n\n<p>I tried the following way, however it crashed with error: Error in \"/path/to/my/program': free(): invalid next size (fast): 0x00007f8fe0000aa0:</p>\n\n<pre><code>var buffer []byte\nbufStr := C.CString(string(buffer))\ndefer C.free(unsafe.Pointer(bufStr))\nC.parser_shift(p.Cparser, unsafe.Pointer(bufStr), C.int(8192))\nbuffer = []byte(C.GoString(bufStr))\nreturn buffer\n</code></pre>\n"}, {"tags": ["mysql", "go", "timeout", "connection-timeout"], "comments": [{"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1536040777, "post_id": 52156175, "comment_id": 91268916, "body": "<a href=\"https://dev.mysql.com/doc/refman/8.0/en/mysql-options.html\" rel=\"nofollow noreferrer\">dev.mysql.com/doc/refman/8.0/en/mysql-options.html</a> Play with <code>MYSQL_OPT_READ_TIMEOUT</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1398, "user_id": 403849, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/c621d6fd088d4441d9037922af06aac7?s=128&d=identicon&r=PG", "display_name": "adavea", "link": "https://stackoverflow.com/users/403849/adavea"}, "edited": false, "score": 1, "creation_date": 1536172152, "post_id": 52178849, "comment_id": 91332548, "body": "Yup!  In fact that&#39;s the bug report I made at the same time as this question to let them know about the issue haha.  Once there&#39;s a solution there, we should know the solution here as well.  That&#39;s good to know about the 1s workaround, thanks!"}], "tags": [], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "is_accepted": false, "score": 1, "last_activity_date": 1536130343, "creation_date": 1536130343, "answer_id": 52178849, "question_id": 52156175, "link": "https://stackoverflow.com/questions/52156175/how-can-i-get-golang-mysql-driver-to-timeout-pings-in-2-seconds/52178849#52178849", "title": "How can I get golang mysql driver to timeout pings in 2 seconds?", "body": "<p>Could it be this issue: <a href=\"https://github.com/golang/go/issues/27476\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/27476</a> ?</p>\n\n<p>My issue is slightly different, it times out one 1s but not 2s or 3s!\n<a href=\"https://media.dev.unee-t.com/2018-09-05/pingcontext.mp4\" rel=\"nofollow noreferrer\">https://media.dev.unee-t.com/2018-09-05/pingcontext.mp4</a></p>\n\n<p>My source is here: <a href=\"https://media.dev.unee-t.com/2018-09-05/main.go\" rel=\"nofollow noreferrer\">https://media.dev.unee-t.com/2018-09-05/main.go</a></p>\n"}, {"tags": [], "owner": {"reputation": 361, "user_id": 9920156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ac2bc5c7c6136831e7429601198890f?s=128&d=identicon&r=PG&f=1", "display_name": "Amjad Hussain Syed", "link": "https://stackoverflow.com/users/9920156/amjad-hussain-syed"}, "is_accepted": false, "score": 0, "last_activity_date": 1618823327, "creation_date": 1618823327, "answer_id": 67159089, "question_id": 52156175, "link": "https://stackoverflow.com/questions/52156175/how-can-i-get-golang-mysql-driver-to-timeout-pings-in-2-seconds/67159089#67159089", "title": "How can I get golang mysql driver to timeout pings in 2 seconds?", "body": "<p>I use the following MySQL DSN format to timeout in 2s and it works perfectly fine.</p>\n<pre><code>user:password@tcp(localhost:80)/dbname?timeout=2s\n</code></pre>\n"}], "owner": {"reputation": 1398, "user_id": 403849, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/c621d6fd088d4441d9037922af06aac7?s=128&d=identicon&r=PG", "display_name": "adavea", "link": "https://stackoverflow.com/users/403849/adavea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2606, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1618823327, "creation_date": 1536008608, "last_edit_date": 1536172194, "question_id": 52156175, "link": "https://stackoverflow.com/questions/52156175/how-can-i-get-golang-mysql-driver-to-timeout-pings-in-2-seconds", "title": "How can I get golang mysql driver to timeout pings in 2 seconds?", "body": "<p>I am having some trouble figuring out how to make a database connection-attempt timeout properly in Go.  I am using some of the examples at <a href=\"https://golang.org/src/database/sql/example_test.go\" rel=\"nofollow noreferrer\">this excellent resource</a> as a base.  I believe I am setting up everything correctly, but my pings just refuse to time out after 2 seconds.  I've extracted the code in question into a sample program as follows.  Note that there is no database running at 172.1.2.3.</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\" //MySQL driver\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n    log.Print(\"Trying to ping database!\")\n\n    //Prepare a \"context\" to execute queries in, this will allow us to use timeouts\n    var bgCtx = context.Background()\n    var ctx2SecondTimeout, cancelFunc2SecondTimeout = context.WithTimeout(bgCtx, time.Second*2)\n    defer cancelFunc2SecondTimeout()\n\n    //Open  database connection\n    db, err := sql.Open(\"mysql\", \"root:@tcp(172.1.2.3)/testdb?parseTime=true\")\n    if err != nil {\n        log.Printf(\"Unable to open db, %s\", err.Error())\n        return\n    }\n    log.Print(\"Successfully called open()\")\n\n    //Ping database connection with 2 second timeout\n    err = db.PingContext(ctx2SecondTimeout)\n    if err != nil {\n        log.Printf(\"Can't ping database server in order to use storage, %s\", err.Error())\n        return\n    }\n    log.Print(\"Successfully pinged database!\")\n}\n</code></pre>\n\n<p>Running the program should take up to about 2 seconds, but instead it takes 2+ minutes:</p>\n\n<pre><code>$ go run lambdatry.go\n2018/09/03 16:33:33 Trying to ping database!\n2018/09/03 16:33:33 Successfully called open()\n2018/09/03 16:35:43 Can't ping database server in order to use storage, dial tcp 172.1.2.3:3306: connect: connection timed out\n</code></pre>\n\n<p>If I change the IP of the \"database\" (I just picked a random IP so there's no database at this address) the database sometimes times out immediately and sometimes takes a really long time to timeout.</p>\n\n<p>I am running go 1.10.1 on ubuntu 18.04.  </p>\n"}, {"tags": ["mysql", "sql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1536008828, "post_id": 52156146, "comment_id": 91262634, "body": "You have NULLs in some of your table&#39;s columns and you are trying to scan those into a &quot;plain&quot; string field. That will not work in Go, the error returned from Scan should indicate that, or maybe it causes panic (i forget)."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1536008882, "post_id": 52156146, "comment_id": 91262644, "body": "... use the <code>sql.NullXxx</code> types, e.g. <a href=\"https://golang.org/pkg/database/sql/#NullString\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/#NullString</a> for column values that can be NULL."}, {"owner": {"reputation": 67, "user_id": 8450785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8648342035d0dd5f2dd72dfbfe13a183?s=128&d=identicon&r=PG&f=1", "display_name": "Hierarchy", "link": "https://stackoverflow.com/users/8450785/hierarchy"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1536012936, "post_id": 52156146, "comment_id": 91263646, "body": "I think I got it now. Will check this in the morning, guess I&#39;m just too tired right now. Thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 67, "user_id": 8450785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8648342035d0dd5f2dd72dfbfe13a183?s=128&d=identicon&r=PG&f=1", "display_name": "Hierarchy", "link": "https://stackoverflow.com/users/8450785/hierarchy"}, "is_accepted": false, "score": 0, "last_activity_date": 1536047948, "creation_date": 1536047948, "answer_id": 52161499, "question_id": 52156146, "link": "https://stackoverflow.com/questions/52156146/golang-mysql-select-statement-returns-only-the-first-value/52161499#52161499", "title": "Golang mysql select * statement returns only the first value", "body": "<p>I changed string to sql.NullString in my struct and am now getting all the data from the database.\nThank you @mkopriva for your help.</p>\n\n<pre><code>type Device struct {\ndevice_id           string\ndevice_name         sql.NullString\ndevice_type         string\ndevice_currentstate sql.NullString\ndevice_tobestate    sql.NullString\nhouse_name          string\nroom_id             sql.NullString\n</code></pre>\n\n<p>}</p>\n"}], "owner": {"reputation": 67, "user_id": 8450785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8648342035d0dd5f2dd72dfbfe13a183?s=128&d=identicon&r=PG&f=1", "display_name": "Hierarchy", "link": "https://stackoverflow.com/users/8450785/hierarchy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1091, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1536063906, "creation_date": 1536008376, "last_edit_date": 1536063906, "question_id": 52156146, "link": "https://stackoverflow.com/questions/52156146/golang-mysql-select-statement-returns-only-the-first-value", "title": "Golang mysql select * statement returns only the first value", "body": "<p>I'm trying to figure out what's wrong with my code. \nWhen I try to scan() every row, which is returned by my mysql query and write it's values inside a struct I've created, only the first value of the first column will show in my struct everything else is just \"\".\nPlease help me. I'm totaly clueless.</p>\n\n<pre><code>    type Device struct{\n    device_id string\n    device_name string\n    device_type string\n    device_currentstate string\n    device_tobestate string\n    house_name string\n    room_id string}\n\nfunc GetUnmappedDevicesFromDb(houseName string) []Device {\ndb, err := sql.Open(\"mysql\", connectionString)\ndb.Ping()\nstatement := \"SELECT device_id, device_name, device_type, device_currentstate, device_tobestate, house_name, room_id FROM smarthomed.devices WHERE house_name='\" + houseName + \"' AND room_id IS NULL;\"\nstmt, err := db.Prepare(statement)\ndefer stmt.Close()\nrows, err := stmt.Query()\ndefer rows.Close()\nres := []Device{}\nfor rows.Next() {\n    d := Device{}\n    err = rows.Scan(&amp;d.device_id, &amp;d.device_name, &amp;d.device_type, &amp;d.device_currentstate, &amp;d.device_tobestate, &amp;d.house_name, &amp;d.room_id)\n    res = append(res, d)\n    if err != nil {\n        fmt.Println(err)\n    }\n}\nif err != nil {\n    fmt.Println(err)\n}\ndefer db.Close()\nreturn res\n</code></pre>\n\n<p>}</p>\n\n<p><a href=\"https://i.stack.imgur.com/GOPtZ.png\" rel=\"nofollow noreferrer\">struct after scan() method</a>  </p>\n\n<p><a href=\"https://i.stack.imgur.com/kIXrL.png\" rel=\"nofollow noreferrer\">device table in mysql database</a></p>\n"}, {"tags": ["testing", "go", "integration-testing"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1536013110, "post_id": 52155374, "comment_id": 91263682, "body": "Also posted here: <a href=\"https://www.reddit.com/r/golang/comments/9cocm3/approaches_to_testing_negative_scenarios/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/9cocm3/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 820, "user_id": 272787, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/HadKK.jpg?s=128&g=1", "display_name": "Anton Sergeyev", "link": "https://stackoverflow.com/users/272787/anton-sergeyev"}, "edited": false, "score": 0, "creation_date": 1536047216, "post_id": 52155954, "comment_id": 91272125, "body": "Thanks for the answer. It sounds reasonable and I had similar thoughts, but was under the impression that easier (and maybe dirtier) methods should exist."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1536006987, "creation_date": 1536006987, "answer_id": 52155954, "question_id": 52155374, "link": "https://stackoverflow.com/questions/52155374/approaches-to-testing-negative-scenarios-in-go/52155954#52155954", "title": "Approaches to testing negative scenarios in Go", "body": "<p>Using interfaces and custom / mocked implementations for testing <em>is</em> the way to do this. If you want to test most of your code, it is worth making the switch now. If you don't want to test most of your code just a tiny part of it, then what's the point of even bothering with the test? They won't ensure you of anything, on the contrary, they will give you the\u2013false\u2013illusion that \"everything\" is fine.</p>\n\n<p>If you don't want to use and mock interfaces, another way would be to mock the database server itself, but let's face it, it would be even more work.</p>\n\n<p>Just use interfaces. It's never too late to refactor. It is something always worth doing on the long run.</p>\n\n<p>Also note that you can do this \"switch\" gradually. Just create an interface that contains the functionality used by the code you want to test. You don't need to \"touch\" the rest of your code. Change the testable code to use the interface, which then you can mock in your tests. This is easy in Go.</p>\n"}], "owner": {"reputation": 820, "user_id": 272787, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/HadKK.jpg?s=128&g=1", "display_name": "Anton Sergeyev", "link": "https://stackoverflow.com/users/272787/anton-sergeyev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 0, "closed_date": 1536042431, "accepted_answer_id": 52155954, "answer_count": 1, "score": 2, "last_activity_date": 1536034472, "creation_date": 1536003155, "last_edit_date": 1536034472, "question_id": 52155374, "link": "https://stackoverflow.com/questions/52155374/approaches-to-testing-negative-scenarios-in-go", "closed_reason": "Opinion-based", "title": "Approaches to testing negative scenarios in Go", "body": "<p>I'm wondering if there's an accepted/idiomatic way of testing an unexpected behavior when working with external systems (such as databases). These are mostly cases within \"if err != nil {...}\", when normally the error just doesn't happen and you don't control it through the inputs.</p>\n\n<p>One \"right\" way of doing that is probably defining an interface and a mock structure that would return error when you need it. But if I already have a significant amount of code that doesn't work with interfaces, bringing them just for the sake of testing a couple of scenarios seems tiresome.</p>\n\n<p>So does anyone know and use different approaches? For example, in dynamic languages such as php and js a function/method behavior can be easily overridden with a mocking library or even manually, which is quite useful when writing tests.</p>\n"}, {"tags": ["docker", "go", "dockerfile"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536001921, "post_id": 52155128, "comment_id": 91260484, "body": "But you have two basic approaches available: 1) Have your Dockerfile clone your git repo the same way you would out of docker (i.e. <code>git clone ...</code>).  2) Have a build script in your git repo that builds the docker image for you, and pushes it to your Docker repo (i.e. Dockerhub)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536002226, "post_id": 52155128, "comment_id": 91260588, "body": "What specific problems are you having building your Docker image? What error do you get? Or what problem do you have with the produced image?"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 9291734, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2q0Zzpg3y3w/AAAAAAAAAAI/AAAAAAAAARg/TUr3druRPKo/photo.jpg?sz=128", "display_name": "TannerDanger", "link": "https://stackoverflow.com/users/9291734/tannerdanger"}, "edited": false, "score": 2, "creation_date": 1536003032, "post_id": 52155232, "comment_id": 91260843, "body": "Although you got downvoted, and this isn&#39;t really related to my question, this is actually a super useful suggestion and I will for sure be looking at that. Thank you."}, {"owner": {"reputation": 31, "user_id": 9291734, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2q0Zzpg3y3w/AAAAAAAAAAI/AAAAAAAAARg/TUr3druRPKo/photo.jpg?sz=128", "display_name": "TannerDanger", "link": "https://stackoverflow.com/users/9291734/tannerdanger"}, "edited": false, "score": 1, "creation_date": 1536013315, "post_id": 52155232, "comment_id": 91263720, "body": "I actually ended up just doing what you suggested and it was a lot easier than what I think I was trying to do. Thanks for pointing me in the right direction."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 0, "last_activity_date": 1536002312, "creation_date": 1536002312, "answer_id": 52155232, "question_id": 52155128, "link": "https://stackoverflow.com/questions/52155128/how-write-dockerfile-to-properly-pull-code-from-my-github/52155232#52155232", "title": "How write dockerfile to properly pull code from my github", "body": "<p>Github supports <a href=\"https://developer.github.com/webhooks/\" rel=\"nofollow noreferrer\">Webhooks</a> which can be used to do all sorts of things automagically when you push to a git repo. Since you're already running a web server on your home box, why don't you have Github send a POST request to that when it receives a commit on <code>master</code> and have your home box re-download the git repo and restart web services from that?</p>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 9291734, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2q0Zzpg3y3w/AAAAAAAAAAI/AAAAAAAAARg/TUr3druRPKo/photo.jpg?sz=128", "display_name": "TannerDanger", "link": "https://stackoverflow.com/users/9291734/tannerdanger"}, "edited": false, "score": 0, "creation_date": 1536003593, "post_id": 52155348, "comment_id": 91261011, "body": "Thanks for your reply. Because this project is a work in progress, I think I want the second method since changes will be made often. Does this method work if the entire project is contained within that &quot;website&quot; directory? All of the code that is needed to run will pull from my GitHub."}], "tags": [], "owner": {"reputation": 169, "user_id": 8948146, "user_type": "registered", "profile_image": "https://graph.facebook.com/100007428336811/picture?type=large", "display_name": "Igor Skobelev", "link": "https://stackoverflow.com/users/8948146/igor-skobelev"}, "is_accepted": false, "score": 1, "last_activity_date": 1536002954, "creation_date": 1536002954, "answer_id": 52155348, "question_id": 52155128, "link": "https://stackoverflow.com/questions/52155128/how-write-dockerfile-to-properly-pull-code-from-my-github/52155348#52155348", "title": "How write dockerfile to properly pull code from my github", "body": "<p>There are several strategies:</p>\n\n<ul>\n<li><strong>Using of pre-build app</strong>. Build your app using \n<code>go build</code> command according to target system architecture and OS (using GOOS and GOARCH system variable for example) then use COPY docker command to move this builded file (with assets and templates) to your WORKDIR and finally run it via CMD or ENTRYPOINT (last is preferable). Dockerfile for this example will look like:</li>\n</ul>\n\n<blockquote>\n  <p>FROM scratch</p>\n  \n  <p>ENV PORT 8000 EXPOSE $PORT</p>\n  \n  <p>COPY advent / CMD [\"/advent\"]</p>\n</blockquote>\n\n<ul>\n<li><strong>Build by dockerfile</strong>. Typical Dockerfile:</li>\n</ul>\n\n<blockquote>\n<pre><code># Start from a Debian image with the latest version of Go installed\n# and a workspace (GOPATH) configured at /go.\nFROM golang\n\n# Copy the local package files to the container's workspace.\nADD . /go/src/github.com/golang/example/outyet\n\n# Build the outyet command inside the container.\n# (You may fetch or manage dependencies here,\n# either manually or with a tool like \"godep\".)\nRUN go install github.com/golang/example/outyet\n\n# Run the outyet command by default when the container starts.\nENTRYPOINT /go/bin/outyet\n\n# Document that the service listens on port 8080.\nEXPOSE 8080\n</code></pre>\n</blockquote>\n\n<ul>\n<li><strong>Using GitHub</strong>. Build your app and pull to dockerhub as ready to use image.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 9291734, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2q0Zzpg3y3w/AAAAAAAAAAI/AAAAAAAAARg/TUr3druRPKo/photo.jpg?sz=128", "display_name": "TannerDanger", "link": "https://stackoverflow.com/users/9291734/tannerdanger"}, "is_accepted": false, "score": 0, "last_activity_date": 1536013241, "creation_date": 1536013241, "answer_id": 52156715, "question_id": 52155128, "link": "https://stackoverflow.com/questions/52155128/how-write-dockerfile-to-properly-pull-code-from-my-github/52156715#52156715", "title": "How write dockerfile to properly pull code from my github", "body": "<p>I was able to solve my issue by just creating an automated build through docker hub, and just using this for my dockerfile:</p>\n\n<pre><code>FROM golang-onbuild\nEXPOSE &lt;ports&gt;\n</code></pre>\n\n<p>It isn't exactly the correct answer to my question, but it is an effective workaround. The automated build connects with my github repo the way I was hoping my dockerfile would.</p>\n"}], "owner": {"reputation": 31, "user_id": 9291734, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2q0Zzpg3y3w/AAAAAAAAAAI/AAAAAAAAARg/TUr3druRPKo/photo.jpg?sz=128", "display_name": "TannerDanger", "link": "https://stackoverflow.com/users/9291734/tannerdanger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 52155232, "answer_count": 3, "score": 0, "last_activity_date": 1536013241, "creation_date": 1536001651, "last_edit_date": 1536002938, "question_id": 52155128, "link": "https://stackoverflow.com/questions/52155128/how-write-dockerfile-to-properly-pull-code-from-my-github", "title": "How write dockerfile to properly pull code from my github", "body": "<p>I'm working on building a website in Go, which is hosted on my home server via docker. </p>\n\n<p><strong>What I'm trying to do:</strong>\nI make changes to my website/server locally, then push them to github. I'd like to write a dockerfile such that it pulls this data from my github, builds the image, which my docker-compose file will then use to create the container.</p>\n\n<p>Unfortunately, all of my attempts have been somewhat close but wrong. </p>\n\n<pre><code>FROM golang:1.8-onbuild\nMAINTAINER &lt;my info&gt;\nRUN go get &lt;my github url&gt;\nENV webserver_path /website/\nENV PATH $PATH: webserver_path\nCOPY website/ .\nRUN go build .\nENTRYPOINT ./website\nEXPOSE &lt;ports&gt;\n</code></pre>\n\n<p>This file is kind of a combination of a few small guides I found through google searches, but none quite gave me the information I needed and it never quite worked. </p>\n\n<p>I'm hoping somebody with decent docker experience can just put a Dockerfile together for me to use as a guide so I can find what I'm doing wrong? I think what I'm looking for can be done in only a few lines, and mine is a little more verbose than needed. </p>\n\n<p><strong>ADDITIONAL BUT PROBABLY UNNECESSARY INFORMATION BELOW</strong> </p>\n\n<p>Project layout:</p>\n\n<p><a href=\"https://i.stack.imgur.com/EL0NM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/EL0NM.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>Data</strong>: is where my go files are Sidenote: This was throwing me errors when trying to build image, something about not being in the environment path. Not sure if that is helpful</p>\n\n<p><strong>Static</strong>: CSS, JS, Images</p>\n\n<p><strong>TPL</strong>: go template files</p>\n\n<p><strong>Main.go</strong>: launches server/website</p>\n"}, {"tags": ["file", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1535998704, "post_id": 52154609, "comment_id": 91259465, "body": "As with all questions of best performance, the only way to know is to test the different options under your specific workload, and see which performs best."}, {"owner": {"reputation": 2719, "user_id": 4177876, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/i7xAG.jpg?s=128&g=1", "display_name": "Seenu S", "link": "https://stackoverflow.com/users/4177876/seenu-s"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1612593387, "post_id": 52154609, "comment_id": 116820385, "body": "This blog looks good to me <a href=\"https://medium.com/swlh/processing-16gb-file-in-seconds-go-lang-3982c235dfa2\" rel=\"nofollow noreferrer\">medium.com/swlh/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 14, "last_activity_date": 1536000416, "last_edit_date": 1536000416, "creation_date": 1535999769, "answer_id": 52154800, "question_id": 52154609, "link": "https://stackoverflow.com/questions/52154609/fastest-way-of-reading-huge-file-in-go-lang-with-small-ram/52154800#52154800", "title": "Fastest way of reading huge file in go lang with small RAM", "body": "<p>There's basically two different ways to approach parsing a file: document parsing and stream parsing.</p>\n\n<p>Document parsing reads the data from the file and turns it into a big set of objects that you can query, like the HTML <a href=\"https://en.wikipedia.org/wiki/Document_Object_Model\" rel=\"noreferrer\">DOM</a> in a browser. The advantage is you have the complete data at your fingertips, this is often simpler. The disadvantage is you have to store it all in memory.</p>\n\n<pre><code>dom = parse(stuff)\n\n// now do whatever you like with the dom\n</code></pre>\n\n<p>Stream parsing instead reads a single element at a time and presents it to you for immediate use, then it moves on to the next one.</p>\n\n<pre><code>for element := range stream(stuff) {\n    ...examine one element at a time...\n}\n</code></pre>\n\n<p>The advantage is you don't have to load the whole thing into memory. The disadvantage is you must work with the data as it goes by. This is very useful for searches or anything else which needs to process one by one.</p>\n\n<hr>\n\n<p>Fortunately Go provides libraries to handle the common formats for you.</p>\n\n<p>A simple example is handling a CSV file.</p>\n\n<pre><code>package main\n\nimport(\n    \"encoding/csv\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"io\"\n)\n\nfunc main() {\n    file, err := os.Open(\"test.csv\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    parser := csv.NewReader(file)\n\n    ...\n}\n</code></pre>\n\n<p>We can slurp the whole thing into memory as a big <code>[][]string</code>.</p>\n\n<pre><code>records, err := parser.ReadAll()\nif err != nil {\n    log.Fatal(err)\n}\n\nfor _,record := range records {\n    fmt.Println(record)\n}\n</code></pre>\n\n<p>Or we can save a bunch of memory and deal with the rows one at a time.</p>\n\n<pre><code>for {\n    record, err := parser.Read()\n    if err == io.EOF {\n        break\n    }\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(record)\n}\n</code></pre>\n\n<p>Since every line of a CSV is functionally the same, processing it one row at a time makes the most sense.</p>\n\n<p>JSON and XML are more complex because they are large, nested structures, but they can also be streamed. There's <a href=\"https://golang.org/pkg/encoding/json/#example_Decoder_Decode_stream\" rel=\"noreferrer\">an example of streaming in the encoding/json documentation</a>.</p>\n\n<hr>\n\n<p>What if your code isn't a simple loop? What if you want to take advantage of concurrency? Use a channel and a goroutine to feed it concurrent with the rest of the program.</p>\n\n<pre><code>records := make( chan []string )\ngo func() {\n    parser := csv.NewReader(file)\n\n    defer close(records)\n    for {\n        record, err := parser.Read()\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        records &lt;- record\n    }\n}();\n</code></pre>\n\n<p>Now you can pass <code>records</code> to a function which can process them.</p>\n\n<pre><code>func print_records( records chan []string ) {\n    for record := range records {\n        fmt.Println(record)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2719, "user_id": 4177876, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/i7xAG.jpg?s=128&g=1", "display_name": "Seenu S", "link": "https://stackoverflow.com/users/4177876/seenu-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5630, "favorite_count": 4, "closed_date": 1536006183, "accepted_answer_id": 52154800, "answer_count": 1, "score": 1, "last_activity_date": 1536000416, "creation_date": 1535998626, "last_edit_date": 1592644375, "question_id": 52154609, "link": "https://stackoverflow.com/questions/52154609/fastest-way-of-reading-huge-file-in-go-lang-with-small-ram", "closed_reason": "Needs more focus", "title": "Fastest way of reading huge file in go lang with small RAM", "body": "<p>I want to read the data from the different text or json or csv files. Which is the approach should I follow?</p>\n<p>I have read these blogs <a href=\"https://kgrz.io/reading-files-in-go-an-overview.html\" rel=\"nofollow noreferrer\">File read</a>, <a href=\"https://www.reddit.com/r/golang/comments/55pyas/how_to_read_2gb_text_file_with_small_ram/?sort=confidence\" rel=\"nofollow noreferrer\">read 2GB text file with small RAM</a> for the different approach for file reading.</p>\n<h1>Different approach:</h1>\n<pre><code>* Reading a file in chunks\n* Reading file chunks concurrently\n* Reading the entire file into memory\n* Splitting a long string into words\n* Scanning word by word\n</code></pre>\n<p>Not able to find out the fastest way of reading the file with small RAM.</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "aws-sdk"], "comments": [{"owner": {"reputation": 449, "user_id": 622117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be095c654392f0bae22406e35213260b?s=128&d=identicon&r=PG", "display_name": "ekeyser", "link": "https://stackoverflow.com/users/622117/ekeyser"}, "edited": false, "score": 1, "creation_date": 1535994430, "post_id": 52153716, "comment_id": 91257919, "body": "Does your invoking lambda have privileges to invoke lambda calls?"}], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 7696326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4324de88ad3e0a7229a3021268d2422b?s=128&d=identicon&r=PG&f=1", "display_name": "randy", "link": "https://stackoverflow.com/users/7696326/randy"}, "edited": false, "score": 0, "creation_date": 1536020732, "post_id": 52153961, "comment_id": 91265013, "body": "Thanks @yorodm! I started messing around with the above thanks to your comment and finally got it to work! I needed to include the json body object in the payload as well, which wasn&#39;t super clear in the docs originally (I thought it was all the body). For those that see this later check out my edit to see how I fixed it."}], "tags": [], "owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "is_accepted": false, "score": 3, "last_activity_date": 1535994783, "creation_date": 1535994783, "answer_id": 52153961, "question_id": 52153716, "link": "https://stackoverflow.com/questions/52153716/how-do-you-invoke-a-lambda-function-within-another-lambda-function-using-golang/52153961#52153961", "title": "How do you invoke a Lambda function within another Lambda function using golang", "body": "<p>Problem seems to be you're not passing a proper API Gateway Proxy Request Event to your consumer lambda:</p>\n\n<p>If you take a look at <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/eventsources.html#eventsources-api-gateway-request\" rel=\"nofollow noreferrer\">Amazon's sample events page</a> you can see that API Gateway events have the following structure (more or less)</p>\n\n<pre><code>{\n  \"path\": \"/test/hello\",\n  \"headers\": {\n    \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\",\n    \"Accept-Encoding\": \"gzip, deflate, lzma, sdch, br\",\n    \"Accept-Language\": \"en-US,en;q=0.8\",\n    \"CloudFront-Forwarded-Proto\": \"https\",\n    \"CloudFront-Is-Desktop-Viewer\": \"true\",\n    \"CloudFront-Is-Mobile-Viewer\": \"false\",\n    \"CloudFront-Is-SmartTV-Viewer\": \"false\",\n    \"CloudFront-Is-Tablet-Viewer\": \"false\",\n    \"CloudFront-Viewer-Country\": \"US\",\n    \"Host\": \"wt6mne2s9k.execute-api.us-west-2.amazonaws.com\",\n    \"Upgrade-Insecure-Requests\": \"1\",\n    \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36 OPR/39.0.2256.48\",\n    \"Via\": \"1.1 fb7cca60f0ecd82ce07790c9c5eef16c.cloudfront.net (CloudFront)\",\n    \"X-Amz-Cf-Id\": \"nBsWBOrSHMgnaROZJK1wGCZ9PcRcSpq_oSXZNQwQ10OTZL4cimZo3g==\",\n    \"X-Forwarded-For\": \"192.168.100.1, 192.168.1.1\",\n    \"X-Forwarded-Port\": \"443\",\n    \"X-Forwarded-Proto\": \"https\"\n  },\n  \"pathParameters\": {\n    \"proxy\": \"hello\"\n  },\n  \"requestContext\": {\n    \"accountId\": \"123456789012\",\n    \"resourceId\": \"us4z18\",\n    \"stage\": \"test\",\n    \"requestId\": \"41b45ea3-70b5-11e6-b7bd-69b5aaebc7d9\",\n    \"identity\": {\n      \"cognitoIdentityPoolId\": \"\",\n      \"accountId\": \"\",\n      \"cognitoIdentityId\": \"\",\n      \"caller\": \"\",\n      \"apiKey\": \"\",\n      \"sourceIp\": \"192.168.100.1\",\n      \"cognitoAuthenticationType\": \"\",\n      \"cognitoAuthenticationProvider\": \"\",\n      \"userArn\": \"\",\n      \"userAgent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.82 Safari/537.36 OPR/39.0.2256.48\",\n      \"user\": \"\"\n    },\n    \"resourcePath\": \"/{proxy+}\",\n    \"httpMethod\": \"GET\",\n    \"apiId\": \"wt6mne2s9k\"\n  },\n  \"resource\": \"/{proxy+}\",\n  \"httpMethod\": \"GET\",\n  \"queryStringParameters\": {\n    \"name\": \"me\"\n  },\n  \"stageVariables\": {\n    \"stageVarName\": \"stageVarValue\"\n  }\n}\n</code></pre>\n\n<p>As you can see most fields are related to HTTP stuff, that's because API Gateway is meant as a way to expose your lambda functions to the web (a.k.a. make REST APIS). You can either change your lambda to accept the new event type (it must be a JSON serializable type) or use as string and serialize it yourself.</p>\n"}, {"tags": [], "owner": {"reputation": 1765, "user_id": 6464013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/800b098105b883e97c66cc3227a58807?s=128&d=identicon&r=PG", "display_name": "amittn", "link": "https://stackoverflow.com/users/6464013/amittn"}, "is_accepted": false, "score": 3, "last_activity_date": 1537383797, "last_edit_date": 1537383797, "creation_date": 1536013351, "answer_id": 52156723, "question_id": 52153716, "link": "https://stackoverflow.com/questions/52153716/how-do-you-invoke-a-lambda-function-within-another-lambda-function-using-golang/52156723#52156723", "title": "How do you invoke a Lambda function within another Lambda function using golang", "body": "<p>I think you need to make sure you are selecting <code>Use lambda proxy integration</code> this will let you receive the payload data.</p>\n\n<p><a href=\"https://i.stack.imgur.com/CnrYt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CnrYt.png\" alt=\"API Gateway integration \"></a></p>\n"}, {"comments": [{"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "edited": false, "score": 0, "creation_date": 1606917575, "post_id": 52157748, "comment_id": 115107950, "body": "What about the permission?"}], "tags": [], "owner": {"reputation": 147, "user_id": 7696326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4324de88ad3e0a7229a3021268d2422b?s=128&d=identicon&r=PG&f=1", "display_name": "randy", "link": "https://stackoverflow.com/users/7696326/randy"}, "is_accepted": false, "score": 3, "last_activity_date": 1536025333, "creation_date": 1536025333, "answer_id": 52157748, "question_id": 52153716, "link": "https://stackoverflow.com/questions/52153716/how-do-you-invoke-a-lambda-function-within-another-lambda-function-using-golang/52157748#52157748", "title": "How do you invoke a Lambda function within another Lambda function using golang", "body": "<p>Thanks to @yorodm's input I had to include the body object into the payload as well.</p>\n\n<p>Here is the full solution to invoke a lambda function within another lambda function using golang</p>\n\n<pre><code>region := os.Getenv(\"AWS_REGION\")\nsession, err := session.NewSession(&amp;aws.Config{ // Use aws sdk to connect to dynamoDB\n    Region: &amp;region,\n})\nsvc := invoke.New(session)\n\nbody, err := json.Marshal(map[string]interface{}{\n    \"name\": \"Jimmy\",\n})\n\ntype Payload struct {\n    // You can also include more objects in the structure like below, \n    // but for my purposes body was all that was required\n    // Method string `json:\"httpMethod\"`\n    Body string `json:\"body\"`\n}\np := Payload{\n    // Method: \"POST\",\n    Body: string(body),\n}\npayload, err := json.Marshal(p) \n // Result should be: {\"body\":\"{\\\"name\\\":\\\"Jimmy\\\"}\"} \n // This is the required format for the lambda request body.\n\nif err != nil {\n    fmt.Println(\"Json Marshalling error\")\n}\nfmt.Println(string(payload))\n\ninput := &amp;invoke.InvokeInput{\n    FunctionName:   aws.String(\"invokeConsume\"),\n    InvocationType: aws.String(\"RequestResponse\"),\n    LogType:        aws.String(\"Tail\"),\n    Payload:        payload,\n}\nresult, err := svc.Invoke(input)\nif err != nil {\n    fmt.Println(\"error\")\n    fmt.Println(err.Error())\n}\nvar m map[string]interface{}\njson.Unmarshal(result.Payload, &amp;m)\nfmt.Println(m[\"body\"])\n\ninvokeReponse, err := json.Marshal(m[\"body\"])\nresp := Response{\n    StatusCode:      200,\n    IsBase64Encoded: false,\n    Headers: map[string]string{\n        \"Content-Type\": \"application/json\",\n    },\n    Body: string(invokeReponse),\n}\nfmt.Println(resp)\n\nreturn resp, nil\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12882, "user_id": 61821, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/fcd8955232c3227780d711a062a65448?s=128&d=identicon&r=PG", "display_name": "Priyank Bolia", "link": "https://stackoverflow.com/users/61821/priyank-bolia"}, "is_accepted": false, "score": 0, "last_activity_date": 1615409884, "creation_date": 1615409884, "answer_id": 66572741, "question_id": 52153716, "link": "https://stackoverflow.com/questions/52153716/how-do-you-invoke-a-lambda-function-within-another-lambda-function-using-golang/66572741#66572741", "title": "How do you invoke a Lambda function within another Lambda function using golang", "body": "<p>AWS SDK has an example:\n<a href=\"https://github.com/awsdocs/aws-doc-sdk-examples/blob/master/go/example_code/lambda/aws-go-sdk-lambda-example-run-function.go\" rel=\"nofollow noreferrer\">https://github.com/awsdocs/aws-doc-sdk-examples/blob/master/go/example_code/lambda/aws-go-sdk-lambda-example-run-function.go</a></p>\n<pre><code>package main\n\nimport (\n    &quot;github.com/aws/aws-sdk-go/aws&quot;\n    &quot;github.com/aws/aws-sdk-go/aws/session&quot;\n    &quot;github.com/aws/aws-sdk-go/service/lambda&quot;\n    \n    &quot;encoding/json&quot;\n    &quot;fmt&quot;\n    &quot;os&quot;\n    &quot;strconv&quot;\n)\n\ntype getItemsRequest struct {\n    SortBy     string\n    SortOrder  string\n    ItemsToGet int\n}\n\ntype getItemsResponseError struct {\n    Message string `json:&quot;message&quot;`\n}\n\ntype getItemsResponseData struct {\n    Item string `json:&quot;item&quot;`\n}\n\ntype getItemsResponseBody struct {\n    Result string                 `json:&quot;result&quot;`\n    Data   []getItemsResponseData `json:&quot;data&quot;`\n    Error  getItemsResponseError  `json:&quot;error&quot;`\n}\n\ntype getItemsResponseHeaders struct {\n    ContentType string `json:&quot;Content-Type&quot;`\n}\n\ntype getItemsResponse struct {\n    StatusCode int                     `json:&quot;statusCode&quot;`\n    Headers    getItemsResponseHeaders `json:&quot;headers&quot;`\n    Body       getItemsResponseBody    `json:&quot;body&quot;`\n}\n\nfunc main() {\n    // Create Lambda service client\n    sess := session.Must(session.NewSessionWithOptions(session.Options{\n        SharedConfigState: session.SharedConfigEnable,\n    }))\n\n    client := lambda.New(sess, &amp;aws.Config{Region: aws.String(&quot;us-west-2&quot;)})\n\n    // Get the 10 most recent items\n    request := getItemsRequest{&quot;time&quot;, &quot;descending&quot;, 10}\n\n    payload, err := json.Marshal(request)\n    if err != nil {\n        fmt.Println(&quot;Error marshalling MyGetItemsFunction request&quot;)\n        os.Exit(0)\n    }\n\n    result, err := client.Invoke(&amp;lambda.InvokeInput{FunctionName: aws.String(&quot;MyGetItemsFunction&quot;), Payload: payload})\n    if err != nil {\n        fmt.Println(&quot;Error calling MyGetItemsFunction&quot;)\n        os.Exit(0)\n    }\n\n    var resp getItemsResponse\n\n    err = json.Unmarshal(result.Payload, &amp;resp)\n    if err != nil {\n        fmt.Println(&quot;Error unmarshalling MyGetItemsFunction response&quot;)\n        os.Exit(0)\n    }\n\n    // If the status code is NOT 200, the call failed\n    if resp.StatusCode != 200 {\n        fmt.Println(&quot;Error getting items, StatusCode: &quot; + strconv.Itoa(resp.StatusCode))\n        os.Exit(0)\n    }\n\n    // If the result is failure, we got an error\n    if resp.Body.Result == &quot;failure&quot; {\n        fmt.Println(&quot;Failed to get items&quot;)\n        os.Exit(0)\n    }\n\n    // Print out items\n    if len(resp.Body.Data) &gt; 0 {\n        for i := range resp.Body.Data {\n            fmt.Println(resp.Body.Data[i].Item)\n        }\n    } else {\n        fmt.Println(&quot;There were no items&quot;)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 7696326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4324de88ad3e0a7229a3021268d2422b?s=128&d=identicon&r=PG&f=1", "display_name": "randy", "link": "https://stackoverflow.com/users/7696326/randy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4343, "favorite_count": 1, "answer_count": 4, "score": 9, "last_activity_date": 1615409884, "creation_date": 1535993328, "last_edit_date": 1536021021, "question_id": 52153716, "link": "https://stackoverflow.com/questions/52153716/how-do-you-invoke-a-lambda-function-within-another-lambda-function-using-golang", "title": "How do you invoke a Lambda function within another Lambda function using golang", "body": "<p>I'm trying to invoke a lambda func within another lambda func. I have the invokaction of the lambda function working, however, I can't seem to get the consuming lambda function to receive the payload/body from the sending lambda function. </p>\n\n<p><a href=\"https://godoc.org/github.com/aws/aws-sdk-go/service/lambda#example-Lambda-Invoke-Shared00\" rel=\"noreferrer\">Lambda go doc on invoking a lambda func</a></p>\n\n<p>Here's my sending/invoking lambda func</p>\n\n<pre><code>type Response events.APIGatewayProxyResponse\n\nfunc Handler(ctx context.Context) (Response, error) {\n    region := os.Getenv(\"AWS_REGION\")\n    session, err := session.NewSession(&amp;aws.Config{ // Use aws sdk to connect to dynamoDB\n        Region: &amp;region,\n    })\n    svc := invoke.New(session)\n\n    payload, err := json.Marshal(map[string]interface{}{\n        \"message\": \"message to other lambda func\",\n    })\n\n    if err != nil {\n        fmt.Println(\"Json Marshalling error\")\n    }\n    input := &amp;invoke.InvokeInput{\n        FunctionName:   aws.String(\"invokeConsume\"),\n        InvocationType: aws.String(\"RequestResponse\"),\n        LogType:        aws.String(\"Tail\"),\n        Payload:        payload,\n    }\n    result, err := svc.Invoke(input)\n    if err != nil {\n        fmt.Println(\"error\")\n        fmt.Println(err.Error())\n    }\n    var m map[string]interface{}\n    json.Unmarshal(result.Payload, &amp;m)\n    fmt.Println(m[\"body\"])\n\n    body, err := json.Marshal(m[\"body\"])\n    resp := Response{\n        StatusCode:      200,\n        IsBase64Encoded: false,\n        Headers: map[string]string{\n            \"Content-Type\": \"application/json\",\n        },\n        Body: string(body),\n    }\n    fmt.Println(resp)\n\n    return resp, nil\n}\nfunc main() {\n    lambda.Start(Handler)\n}\n</code></pre>\n\n<p>The response I get from invoked lambda...</p>\n\n<pre><code>{200 map[Content-Type:application/json] \"{\\\"message\\\":\\\"Something\\\"}\" false} \n</code></pre>\n\n<p>My consuming lambda function</p>\n\n<pre><code>type Response events.APIGatewayProxyResponse\n\nfunc Handler(ctx context.Context, req events.APIGatewayProxyRequest) (Response, error) {\n    fmt.Println(req)\n\n    var m map[string]interface{}\n    err := json.Unmarshal([]byte(req.Body), &amp;m)\n    if err != nil {\n        fmt.Println(\"Json Unmarshalling error\")\n        fmt.Println(err.Error())\n    }\n    fmt.Println(m)\n\n    body, _ := json.Marshal(map[string]interface{}{\n        \"message\": \"Something\",\n    })\n    resp := Response{\n        StatusCode:      200,\n        IsBase64Encoded: false,\n        Headers: map[string]string{\n            \"Content-Type\": \"application/json\",\n        },\n        Body: string(body),\n    }\n    return resp, nil\n}\nfunc main() {\n    lambda.Start(Handler)\n}\n</code></pre>\n\n<p>The logs from the consuming lambda func</p>\n\n<pre><code>{ map[] map[] map[] map[] { { } map[] } false}\nJson Unmarshalling error\nunexpected end of JSON input\nmap[]\n</code></pre>\n\n<p>It seems that the consuming lambda function isn't receiving any events.APIGatewayProxyRequest, however I'm not sure why.</p>\n\n<p><strong>EDIT:</strong>\nMy solution - I had to also include the json body object in the payload. Here's how I solved it</p>\n\n<pre><code>body, err := json.Marshal(map[string]interface{}{\n    \"name\": \"Jimmy\",\n})\ntype Payload struct {\n    Body string `json:\"body\"`\n}\np := Payload{\n    Body: string(body),\n}\npayload, err := json.Marshal(p) // This should give you {\"body\":\"{\\\"name\\\":\\\"Jimmy\\\"}\"} if you print it out which is the required format for the lambda request body.\n</code></pre>\n"}, {"tags": ["c++", "go", "cgo"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2100815"}, "edited": false, "score": 1, "creation_date": 1535991367, "post_id": 52153262, "comment_id": 91256804, "body": "Link in question doesn&#39;t work."}, {"owner": {"reputation": 83072, "user_id": 1413395, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wNQa.jpg?s=128&g=1", "display_name": "\u03c0\u03ac\u03bd\u03c4\u03b1 \u1fe5\u03b5\u1fd6", "link": "https://stackoverflow.com/users/1413395/%cf%80%ce%ac%ce%bd%cf%84%ce%b1-%e1%bf%a5%ce%b5%e1%bf%96"}, "edited": false, "score": 0, "creation_date": 1535991968, "post_id": 52153262, "comment_id": 91257074, "body": "<i>&quot;so I have no idea what to pass from C&quot;</i> probably some POD structure arrays."}, {"owner": {"reputation": 1506, "user_id": 8689709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cd57855e7bff23fbca35abc8ddc0073?s=128&d=identicon&r=PG", "display_name": "Bill Zelenko", "link": "https://stackoverflow.com/users/8689709/bill-zelenko"}, "edited": false, "score": 0, "creation_date": 1536001517, "post_id": 52153262, "comment_id": 91260357, "body": "Link in question DOES work for me."}, {"owner": {"reputation": 23130, "user_id": 8586227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRnwg.png?s=128&g=1", "display_name": "Davis Herring", "link": "https://stackoverflow.com/users/8586227/davis-herring"}, "edited": false, "score": 0, "creation_date": 1536904461, "post_id": 52153262, "comment_id": 91598258, "body": "Are these sophisticated objects <i>created</i> by the C++ library, or is the client expected to construct them?"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 1, "creation_date": 1536920917, "post_id": 52153262, "comment_id": 91606751, "body": "You either <i>convert</i> your data or <i>wrap</i> it (in practice you wrap a pointer to it) and provide access to it with C-style functions."}], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 144, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1536922792, "creation_date": 1535991089, "last_edit_date": 1536922792, "question_id": 52153262, "link": "https://stackoverflow.com/questions/52153262/wrapping-c-function-with-arguments-of-non-primitive-data-types", "title": "Wrapping C++ function with arguments of non-primitive data types", "body": "<p><code>Go</code> vs <code>C++</code> interoperability has been discussed many times so far (<a href=\"https://stackoverflow.com/questions/1713214/how-to-use-c-in-go\">here</a>, for example), and generally it has been shown that it's possible to wrap <code>C++</code> functions in <code>C</code> functions, and than to wrap <code>C</code> functions in <code>CGO</code> functions. This is the way how to use <code>C++</code> code in <code>Go</code> application. However, the most of examples consider only functions with parameters of primitive data types (like <code>int</code> or <code>char *</code>).</p>\n\n<p>But what if <code>C++</code> function expects STL containers like <code>std::vector</code> or <code>std::set</code> to be passed? There are no equivalents for them in <code>C</code>, so I have no idea what to pass from <code>C</code> to <code>C++</code>.</p>\n\n<pre><code>static Status GetApproximateMemoryUsageByType(\n      const std::vector&lt;DB*&gt;&amp; dbs,\n      const std::unordered_set&lt;const Cache*&gt; cache_set,\n      std::map&lt;MemoryUtil::UsageType, uint64_t&gt;* usage_by_type);\n</code></pre>\n\n<p><strong>UPD</strong></p>\n\n<p>Just for the reference, here is the example of how this problem was <a href=\"https://github.com/facebook/rocksdb/commit/0bd2ede10e97944798449e0f954658fac8bfdbd2\" rel=\"nofollow noreferrer\">solved</a>. This is a real function from <code>RocksDB C++ API</code>. In order to use it in <code>Go</code>, it should be wrapped in function (or several functions) that are written in <code>C++</code>, but look like as just they're written in plain <code>C</code>. These wrappers are compiled to library with <code>Go</code> binary links against.</p>\n"}, {"tags": ["azure", "go", "terraform"], "comments": [{"owner": {"reputation": 1678, "user_id": 872496, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9f14f81481ca61ef53fe445dfa7a2f52?s=128&d=identicon&r=PG", "display_name": "rudolf_franek", "link": "https://stackoverflow.com/users/872496/rudolf-franek"}, "edited": false, "score": 0, "creation_date": 1535989729, "post_id": 52152153, "comment_id": 91256126, "body": "Could you please describe more in detail what you have done so far? Perhaps provide some simplified code sample."}, {"owner": {"reputation": 39151, "user_id": 2291321, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24a41cddd8faf69e3fbd0a778ba6fedf?s=128&d=identicon&r=PG&f=1", "display_name": "ydaetskcoR", "link": "https://stackoverflow.com/users/2291321/ydaetskcor"}, "edited": false, "score": 1, "creation_date": 1536003903, "post_id": 52152153, "comment_id": 91261115, "body": "Why not use something like <a href=\"https://github.com/mantl/terraform.py\" rel=\"nofollow noreferrer\">github.com/mantl/terraform.py</a> or even <a href=\"https://github.com/adammck/terraform-inventory\" rel=\"nofollow noreferrer\">github.com/adammck/terraform-inventory</a>?"}], "owner": {"reputation": 1, "user_id": 4244999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DPBN8.jpg?s=128&g=1", "display_name": "Sadegh Solati", "link": "https://stackoverflow.com/users/4244999/sadegh-solati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1535996104, "creation_date": 1535986686, "last_edit_date": 1535996104, "question_id": 52152153, "link": "https://stackoverflow.com/questions/52152153/accessing-terraform-state-files-in-a-provider", "title": "Accessing Terraform state files in a provider", "body": "<p>I want to create a new provider for terraform. It is suppose to read the state files produced by Azure provider and create an Ansible inventory file out of it. I am using this guide as a base <a href=\"https://www.terraform.io/docs/extend/writing-custom-providers.html\" rel=\"nofollow noreferrer\">https://www.terraform.io/docs/extend/writing-custom-providers.html</a></p>\n\n<p>These are my solutions until now:</p>\n\n<ol>\n<li>Reading the states JSON files with go.</li>\n<li>using depends_on = [\"Azure.example\"] in my Ansible provider and get access to variables how it is done here <a href=\"https://stackoverflow.com/a/45492093/4244999\">https://stackoverflow.com/a/45492093/4244999</a></li>\n</ol>\n\n<p>How can I read the state files into a provider as variables with terraform functions? </p>\n"}, {"tags": ["windows", "go", "registry"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 10310948, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Eg_nFjZxNrw/AAAAAAAAAAI/AAAAAAAAAAA/nSW0BJfaX8k/photo.jpg?sz=128", "display_name": "Igor TonKy", "link": "https://stackoverflow.com/users/10310948/igor-tonky"}, "is_accepted": false, "score": 0, "last_activity_date": 1536056882, "creation_date": 1536056882, "answer_id": 52164174, "question_id": 52152150, "link": "https://stackoverflow.com/questions/52152150/golang-org-x-sys-windows-registry-k-keyreadsubkeynames-returns-empty-slice/52164174#52164174", "title": "golang.org/x/sys/windows/registry (k Key)ReadSubKeyNames() returns empty slice", "body": "<p>I figured it out - should have used (k Key)ReadValueNames to get keys of values.</p>\n"}], "owner": {"reputation": 1, "user_id": 10310948, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Eg_nFjZxNrw/AAAAAAAAAAI/AAAAAAAAAAA/nSW0BJfaX8k/photo.jpg?sz=128", "display_name": "Igor TonKy", "link": "https://stackoverflow.com/users/10310948/igor-tonky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 245, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536056882, "creation_date": 1535986676, "last_edit_date": 1535988136, "question_id": 52152150, "link": "https://stackoverflow.com/questions/52152150/golang-org-x-sys-windows-registry-k-keyreadsubkeynames-returns-empty-slice", "title": "golang.org/x/sys/windows/registry (k Key)ReadSubKeyNames() returns empty slice", "body": "<p>I'm trying to read a list of registry names under the given key, but i get an empty slice of strings, instead of actual registry data. Anything i'm doing incorrectly here?</p>\n\n<p>Expected result: []string{\"ApplicationBase\", \"RunTimeVersion\", ...}</p>\n\n<p>Actual result printed by CMD: \"PS Sub Key Names: []\"</p>\n\n<pre><code>k, err := registry.OpenKey(registry.LOCAL_MACHINE,`SOFTWARE\\Microsoft\\PowerShell\\1\\PowerShellEngine`, registry.QUERY_VALUE|registry.ENUMERATE_SUB_KEYS)\n\nif err != nil {\n    log.Fatal(err)\n}   \n\ndefer k.Close()\n\nsn, err := k.ReadSubKeyNames(-1)\n\nif err != nil {\n    log.Fatal(err)\n}   \n\nfmt.Printf(\"PS Sub Key Names: %q\\n\", sn) \n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1535986992, "post_id": 52152042, "comment_id": 91254797, "body": "From first glance, I can tell that you overnormalized your data, unless including CoverImage is going to break the 16MB document limit. As per the exclusion, <code>bson:&quot;-&quot;</code> should do what you want, as unexporting the field would do, too. Maybe I do not get the actual problem."}, {"owner": {"reputation": 119, "user_id": 3352563, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6fcafa11b3e76b26d9718485d4c1142?s=128&d=identicon&r=PG", "display_name": "vasconcelosvcd", "link": "https://stackoverflow.com/users/3352563/vasconcelosvcd"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1535987817, "post_id": 52152042, "comment_id": 91255176, "body": "The problem is simple, adding <code>bson:&quot;-&quot;</code> &quot;$lookup&quot; don&#39;t unmarshall to the field, so I cannot put the exclusion, therefore is saving to mongo, I only want a way to not pre-processing  the request before inserting to mongo. (removing the field mannualy)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536068571, "post_id": 52152042, "comment_id": 91285372, "body": "So what you want is to have it read the field <i>from</i> mongo, but not write it <i>to</i> mongo? Is that right?"}, {"owner": {"reputation": 119, "user_id": 3352563, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6fcafa11b3e76b26d9718485d4c1142?s=128&d=identicon&r=PG", "display_name": "vasconcelosvcd", "link": "https://stackoverflow.com/users/3352563/vasconcelosvcd"}, "edited": false, "score": 0, "creation_date": 1536070551, "post_id": 52152042, "comment_id": 91286725, "body": "Yeah, I need it to read from the other collection but I don&#39;t want to save it in the first collection. this is happening because it&#39;s in my struct without exclusion so mongo write it, but if I put the exclusion the &quot;$lookup&quot; don&#39;t unmarshall the field."}, {"owner": {"reputation": 119, "user_id": 3352563, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6fcafa11b3e76b26d9718485d4c1142?s=128&d=identicon&r=PG", "display_name": "vasconcelosvcd", "link": "https://stackoverflow.com/users/3352563/vasconcelosvcd"}, "edited": false, "score": 0, "creation_date": 1536070613, "post_id": 52152042, "comment_id": 91286779, "body": "Basically <code>GalleryList []*File &#39;bson:&quot;-&quot;&#39;</code>  don&#39;t unmarshall with &quot;$lookup&quot;and <code>GalleryList []*File</code> unmarshall&#39;s but it&#39;s write to mongo either."}, {"owner": {"reputation": 31, "user_id": 11289618, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5afe8870a2adf219d64b2addb91fb45?s=128&d=identicon&r=PG&f=1", "display_name": "joeyave", "link": "https://stackoverflow.com/users/11289618/joeyave"}, "edited": false, "score": 0, "creation_date": 1616269521, "post_id": 52152042, "comment_id": 117962041, "body": "You can use $set operator to update only those fields that you want to."}], "owner": {"reputation": 119, "user_id": 3352563, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6fcafa11b3e76b26d9718485d4c1142?s=128&d=identicon&r=PG", "display_name": "vasconcelosvcd", "link": "https://stackoverflow.com/users/3352563/vasconcelosvcd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 861, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1616269521, "creation_date": 1535986187, "last_edit_date": 1535990058, "question_id": 52152042, "link": "https://stackoverflow.com/questions/52152042/bson-doesnt-unmarshall-and-ignore-on-insert", "title": "bson:&quot;-&quot; doesn&#39;t unmarshall and ignore on insert", "body": "<p>I have been facing some difficulties with $lookup:</p>\n\n<p>My struct:</p>\n\n<pre><code>type Item struct {\n    ID          bson.ObjectId   `json:\"id\" bson:\"_id\"`\n    Name        string          `json:\"name\" bson:\"name\"`\n    Description string          `json:\"description\" bson:\"description\"`\n    CoverImage  bson.ObjectId   `json:\"cover_image,omitempty\" bson:\"cover_image,omitempty\"`\n    GalleryList []*File\n}\n\npipeline := []bson.M{\n    bson.M{\n        \"$lookup\": bson.M{\n            \"from\":         \"files\",\n            \"localField\":   \"cover_image\",\n            \"foreignField\": \"_id\",\n            \"as\":           \"gallerylist\",\n    },\n}\n</code></pre>\n\n<p>So, what I want to do is use $lookup to get structs with matching ID on collection \"files\" with the \"cover_image\" field ID.</p>\n\n<p>Until here it's ok, the problem is: </p>\n\n<p>If <code>'bson:\"-\"'</code> is on GalleryList, the pipeline don't unmarshall on the field</p>\n\n<p>Ex: <code>GalleryList []*File 'bson:\"-\"'</code></p>\n\n<p>And I don't want GalleryList to be stored inside mongo.</p>\n\n<p>Is there anything that I can to GalleryList don't be inserted with the rest of the struct.</p>\n\n<p>Does I really need to remove this on the frontend or remove manually before inserting on mongo?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "compilation"], "comments": [{"owner": {"reputation": 6478, "user_id": 1930535, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/R3UZw.png?s=128&g=1", "display_name": "Appleshell", "link": "https://stackoverflow.com/users/1930535/appleshell"}, "edited": false, "score": 2, "creation_date": 1535984282, "post_id": 52151503, "comment_id": 91253265, "body": "<code>chown</code>/<code>chmod</code> the cache directory in your home path, but that&#39;s a separate thing that has nothing to do with the error. You must have made a mistake during the installation, here&#39;s a github thread where some people encountered the same issue as you: <a href=\"https://github.com/golang/go/issues/27269\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/27269</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "edited": false, "score": 0, "creation_date": 1591895853, "post_id": 52152172, "comment_id": 110236330, "body": "I didn&#39;t understand what is the solution? You just explained what is <code>GOPATH</code> and <code>GOROOT</code> but what is the solution that will help the user?"}], "tags": [], "owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "is_accepted": false, "score": 2, "last_activity_date": 1535986750, "creation_date": 1535986750, "answer_id": 52152172, "question_id": 52151503, "link": "https://stackoverflow.com/questions/52151503/failed-to-compile-go-file-initialization-failure-xxxx-redeclared-in-this-bl/52152172#52152172", "title": "Failed to compile Go file - &quot;initialization failure...xxxx redeclared in this block&quot;", "body": "<p>Gopath </p>\n\n<pre><code>The GOPATH environment variable lists places to look for Go code.\nOn Unix, the value is a colon-separated string. On Windows, the value \nis a semicolon-separated string. On Plan 9, the value is a list.\n\nGOPATH must be set to get, build and install packages outside the standard Go tree.\nUse tool like dep to segregate your different go project, maintaining your project dependencies. \n</code></pre>\n\n<p>Goroot</p>\n\n<pre><code> The Go binary distributions assume they will be installed in /usr/local/go (or c:\\Go under Windows), but it is possible to install \nthe Go tools to a different location. In this case you must set the \nGOROOT environment variable to point to the directory in which it was installed.\n</code></pre>\n\n<p>so its always preferred to make your own gopath for compiling your code.\nGOPATH is for your own go projects / 3rd party libraries (downloaded with \"go get\").</p>\n"}, {"tags": [], "owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "is_accepted": true, "score": 0, "last_activity_date": 1591897173, "creation_date": 1591897173, "answer_id": 62330298, "question_id": 52151503, "link": "https://stackoverflow.com/questions/52151503/failed-to-compile-go-file-initialization-failure-xxxx-redeclared-in-this-bl/62330298#62330298", "title": "Failed to compile Go file - &quot;initialization failure...xxxx redeclared in this block&quot;", "body": "<p>Re-install Go fixed the issue.<br>\nThe problem happened because I installed new version of Go on top a previous one.  </p>\n\n<p><strong>The solution:</strong><br>\n1. <a href=\"https://stackoverflow.com/a/42186042/2153777\">Remove Go</a>: <code>rm -rvf /usr/local/go/</code><br>\n2. Install it again from <a href=\"https://golang.org/doc/install?download=go1.14.4.linux-amd64.tar.gz\" rel=\"nofollow noreferrer\">Golang website</a>:    </p>\n\n<pre><code>cd ~/go/Downloads\n// Depends on the version you download\ntar -C /usr/local -xzf go1.14.4.linux-amd64.tar.gz\nexport PATH=$PATH:/usr/local/go/bin\ncd ~/go/src/myproj/\ngo build\n// no errors\n</code></pre>\n"}], "owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1760, "favorite_count": 0, "accepted_answer_id": 62330298, "answer_count": 2, "score": -2, "last_activity_date": 1591897173, "creation_date": 1535984017, "question_id": 52151503, "link": "https://stackoverflow.com/questions/52151503/failed-to-compile-go-file-initialization-failure-xxxx-redeclared-in-this-bl", "title": "Failed to compile Go file - &quot;initialization failure...xxxx redeclared in this block&quot;", "body": "<p>I am new in Go and I follow the instructions in the <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">website</a> and the <a href=\"https://www.youtube.com/watch?v=h7RILbHoLBA\" rel=\"nofollow noreferrer\">youtube video</a> I am getting the follow errors when I run <code>go build hello.go</code>:  </p>\n\n<pre><code>go: disabling cache (/home/myuser/.cache/go-build) due to initialization failure: open /home/myuser/.cache/go-build/log.txt: permission denied\n# runtime\n/usr/local/go/src/runtime/map.go:64:2: bucketCntBits redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/hashmap.go:64:18\n/usr/local/go/src/runtime/map.go:65:2: bucketCnt redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/hashmap.go:65:23\n/usr/local/go/src/runtime/map.go:69:2: loadFactorNum redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/hashmap.go:69:18\n/usr/local/go/src/runtime/map.go:70:2: loadFactorDen redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/hashmap.go:70:18\n/usr/local/go/src/runtime/map.go:76:2: maxKeySize redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/hashmap.go:76:17\n/usr/local/go/src/runtime/map.go:77:2: maxValueSize redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/hashmap.go:77:17\n/usr/local/go/src/runtime/map.go:82:2: dataOffset redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/hashmap.go:85:4\n/usr/local/go/src/runtime/map.go:91:2: empty redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/hashmap.go:91:19\n/usr/local/go/src/runtime/map.go:92:2: evacuatedEmpty redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/hashmap.go:92:19\n/usr/local/go/src/runtime/map.go:93:2: evacuatedX redeclared in this block\n    previous declaration at /usr/local/go/src/runtime/hashmap.go:93:19\n/usr/local/go/src/runtime/map.go:93:2: too many errors\n</code></pre>\n\n<p>It wrote <code>permission denied</code> but I tried to run it with <code>sudo go build</code> and it also failed with:  </p>\n\n<blockquote>\n  <p>sudo: go: command not found</p>\n</blockquote>\n\n<p>I am working on Ubuntu 16.4. \nMy go file <code>hello.go</code> is in <code>$HOME/Desktop/go/src/hello</code>.  </p>\n\n<p>My file <code>$HOME/myuser/.profile</code> contains:<br>\n<code>PATH=\"$HOME/bin:$HOME/.local/bin:$PATH:/usr/local/go/bin\"</code>  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 5, "creation_date": 1535979195, "post_id": 52150146, "comment_id": 91250290, "body": "replace <code>[]Pixel{ {X:...}, {X:...}}</code> with:  <code>[]interface{}{ Pixel{X:...}, Pixel{X:...}}</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535979442, "post_id": 52150234, "comment_id": 91250433, "body": "just curious why did you mention, &quot;<b>come up with something not requiring the empty interface</b>&quot;, any article for further reading?"}, {"owner": {"reputation": 766, "user_id": 386590, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/2DQYZ.jpg?s=128&g=1", "display_name": "Amine Kerkeni", "link": "https://stackoverflow.com/users/386590/amine-kerkeni"}, "edited": false, "score": 0, "creation_date": 1535979872, "post_id": 52150234, "comment_id": 91250674, "body": "What I am trying to do is to create a container that holds instances of objects inheriting from the same parent object, I used a pure interface here to make things easy to understand but it could be my own custom interface."}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 766, "user_id": 386590, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/2DQYZ.jpg?s=128&g=1", "display_name": "Amine Kerkeni", "link": "https://stackoverflow.com/users/386590/amine-kerkeni"}, "edited": false, "score": 4, "creation_date": 1535979898, "post_id": 52150234, "comment_id": 91250694, "body": "@AmineKerkeni inheritance is not a thing in Go."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 766, "user_id": 386590, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/2DQYZ.jpg?s=128&g=1", "display_name": "Amine Kerkeni", "link": "https://stackoverflow.com/users/386590/amine-kerkeni"}, "edited": false, "score": 1, "creation_date": 1535981050, "post_id": 52150234, "comment_id": 91251311, "body": "@AmineKerkeni The empty interface is not a &quot;pure&quot; interface, it is a worm of cans and other stuff. If you want to collect two different things (Pixels and Vertices) look what operations you perform on them in common. Extract that into an interface and let your container hold that interfaces. If you never do the same stuff to your elements: Don&#39;t carry them in the same container."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 3, "last_activity_date": 1535979307, "creation_date": 1535979307, "answer_id": 52150234, "question_id": 52150146, "link": "https://stackoverflow.com/questions/52150146/how-to-initialize-a-array-of-interface-in-golang/52150234#52150234", "title": "How to initialize a array of interface in golang?", "body": "<blockquote>\n  <p>Is there a way to force the compiler to accept array initialization with a specific struct while declaring it as an array of interface?</p>\n</blockquote>\n\n<p>No. Basically you cannot force the Go compiler to anything.</p>\n\n<p>See also the FAQ: <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">https://golang.org/doc/faq#convert_slice_of_interface</a></p>\n\n<p>You must supply a <code>[]interface{}</code>.</p>\n\n<p>But please stop doing this and come up with something not requiring the empty interface.</p>\n"}, {"tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": true, "score": 11, "last_activity_date": 1535979850, "creation_date": 1535979850, "answer_id": 52150373, "question_id": 52150146, "link": "https://stackoverflow.com/questions/52150146/how-to-initialize-a-array-of-interface-in-golang/52150373#52150373", "title": "How to initialize a array of interface in golang?", "body": "<p>If you have to create a slice of values for passing to something that requires a slice of <code>interface{}</code> (which, depending on the context, may or may not be appropriate design) or a slice of any more specific interface, you have to specify each element fully, like this:</p>\n\n<pre><code>[]interface{}{ \n    Pixel{X: 12.5, Y: 23.4},\n    Pixel{X: 17.2, Y: 7.9},\n}\n</code></pre>\n\n<p>That also means that you can pass things like:</p>\n\n<pre><code>[]interface{}{\n    Pixel{X: 12.5, Y: 23.4},\n    Vertex{X: 10.7, Y: 13.3, Z: 25.1},\n}\n</code></pre>\n\n<p>which is hardly something you intended, and compiler won't warn you. I don't see that a big deal for the testing code, though.</p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536068687, "post_id": 52150641, "comment_id": 91285457, "body": "Creating the <code>Pixels</code> and <code>Vertexs</code> types is unnecessary here, you could just do <code>values: []Pixel{...}</code> if you wanted to do it this way."}, {"owner": {"reputation": 9, "user_id": 10300353, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MSqUWml8dF0/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaOwPi2EnRXyT66CVXAMUYzVvUXOUg/mo/photo.jpg?sz=128", "display_name": "Hamdi Belhassen", "link": "https://stackoverflow.com/users/10300353/hamdi-belhassen"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536159410, "post_id": 52150641, "comment_id": 91326037, "body": "Yes @Adrian sure you could do that too but just to make it clearer ( I usually do that)"}], "tags": [], "owner": {"reputation": 9, "user_id": 10300353, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MSqUWml8dF0/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaOwPi2EnRXyT66CVXAMUYzVvUXOUg/mo/photo.jpg?sz=128", "display_name": "Hamdi Belhassen", "link": "https://stackoverflow.com/users/10300353/hamdi-belhassen"}, "is_accepted": false, "score": 0, "last_activity_date": 1535980898, "creation_date": 1535980898, "answer_id": 52150641, "question_id": 52150146, "link": "https://stackoverflow.com/questions/52150146/how-to-initialize-a-array-of-interface-in-golang/52150641#52150641", "title": "How to initialize a array of interface in golang?", "body": "<p>To be able to initialize you need to input a type to the interface and not an array of type, so suggest you to change as follow:</p>\n\n<pre><code>    type Pixel struct {\n    X float64\n    Y float64\n}\ntype Pixels []Pixel\n\ntype Vertex struct {\n    X float64\n    Y float64\n    Z float64\n}\ntype Vertexs []Vertex\ntype testpair struct {\n    filename string\n    values   interface{}\n}\nvar tests = map[string]testpair{\n    \"test1\": {\n        filename: \"file1.csv\",\n        values: Pixels{\n            Pixel{X: 12.5, Y: 23.4},\n            Pixel{X: 17.2, Y: 7.9}}},\n    \"test2\": {\n        filename: \"file2.csv\",\n        values: Vertexs{\n            Vertex{X: 10.7, Y: 13.3, Z: 25.1},\n            Vertex{X: 18.3, Y: 16.9, Z: 16.4}}}}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2072, "user_id": 1195266, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/6c5Fj.jpg?s=128&g=1", "display_name": "Macilias", "link": "https://stackoverflow.com/users/1195266/macilias"}, "is_accepted": false, "score": 1, "last_activity_date": 1550223596, "creation_date": 1550223596, "answer_id": 54706451, "question_id": 52150146, "link": "https://stackoverflow.com/questions/52150146/how-to-initialize-a-array-of-interface-in-golang/54706451#54706451", "title": "How to initialize a array of interface in golang?", "body": "<p>I had the same problem but was about to use primitives so this suggested solution here want work.\nIn that case I helped my self out with:</p>\n\n<pre><code>args := make([]interface{}, 2)\nargs[0] = \"some string\"\nargs[1] = 1 //some int\n</code></pre>\n"}], "owner": {"reputation": 766, "user_id": 386590, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/2DQYZ.jpg?s=128&g=1", "display_name": "Amine Kerkeni", "link": "https://stackoverflow.com/users/386590/amine-kerkeni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7997, "favorite_count": 2, "accepted_answer_id": 52150373, "answer_count": 4, "score": 4, "last_activity_date": 1550223596, "creation_date": 1535979037, "question_id": 52150146, "link": "https://stackoverflow.com/questions/52150146/how-to-initialize-a-array-of-interface-in-golang", "title": "How to initialize a array of interface in golang?", "body": "<p>I want to initialize a map containing a list of interface without having to add them one by one: </p>\n\n<pre><code>type Pixel struct {\n    X float64\n    Y float64\n}\n\ntype Vertex struct {\n    X float64\n    Y float64\n    Z float64\n}\ntype testpair struct {\n    filename       string\n    values     []interface{}\n}\nvar tests = map[string]testpair{\n   \"test1\": {\n               filename: \"file1.csv\",\n               values:  []Pixel{\n                           {X: 12.5, Y: 23.4},\n                           {X: 17.2, Y: 7.9},\n                      }\n            },\n   \"test2\": {\n               filename: \"file2.csv\",\n               values:  []Vertex{\n                           {X: 10.7, Y: 13.3, Z: 25.1},\n                           {X: 18.3, Y: 16.9, Z: 16.4},\n                      }\n            }, \n}\n</code></pre>\n\n<p>The compiler would output such an error:</p>\n\n<blockquote>\n  <p>cannot use []Pixel literal (type []Pixel) as type []interface {} in field value</p>\n</blockquote>\n\n<p>If I switch []interface{} to []Pixel, I can initialize the map but I can do it only with a unique type Pixel or Vertex.</p>\n\n<p>Is there a way to force the compiler to accept array initialization with a specific struct while declaring it as an array of interface? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "edited": false, "score": 0, "creation_date": 1535977286, "post_id": 52149661, "comment_id": 91249286, "body": "If both of your snippets are <code>.go</code> files within the same directory then you already have the definition for person in your second file."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10133356"}, "edited": false, "score": 0, "creation_date": 1535977680, "post_id": 52149661, "comment_id": 91249507, "body": "Like I said I am new and do not understand what the error means. I am creating an instance of a struct and make it do something. The files are not in the same folder"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1535977939, "post_id": 52149661, "comment_id": 91249650, "body": "I highly recommend taking the Tour of Go. It comes with all the boilerplate properly set up and you can get your feet wet with the language without too much ado. Also not that running <code>go install</code> is never needed. Do not assume things, e.g. go install has nothing to do with whether you can or cannot use a package in an other package."}], "answers": [{"tags": [], "owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "is_accepted": false, "score": -1, "last_activity_date": 1535982046, "creation_date": 1535982046, "answer_id": 52150952, "question_id": 52149661, "link": "https://stackoverflow.com/questions/52149661/cannot-find-go-package/52150952#52150952", "title": "cannot find Go package", "body": "<p>the proper way to import a local package and use it would be</p>\n\n<pre><code>import person \"./dirnameOfPackage\"\n\nfunc main(){\n    var p Person\n    p.FirstName = \"yourName\"\n    p.LastName = \"lastname\"\n}\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user10133356"}, "edited": false, "score": 0, "creation_date": 1536071025, "post_id": 52151737, "comment_id": 91287089, "body": "Thank you for your answer this explains it and solves my problem. Detail for newbies is a blessing"}], "tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": true, "score": 1, "last_activity_date": 1535987048, "last_edit_date": 1535987048, "creation_date": 1535984942, "answer_id": 52151737, "question_id": 52149661, "link": "https://stackoverflow.com/questions/52149661/cannot-find-go-package/52151737#52151737", "title": "cannot find Go package", "body": "<p><code>non declartion statement outside function body</code> refers to this part of your code</p>\n\n<pre><code>p := Person {\nFirstName : \"Shiju\",\nLastName : \"Varghese\",\nDob : time.Date(1979, time.February, 17, 0, 0, 0, 0, time.UTC),\nEmail : \"shiju@email.com\",\nLocation : \"Kochi\",\n}\n\np. PrintName()\np. PrintDetails()\n</code></pre>\n\n<p>you need to put that insde some function, <code>main</code> function for instance.\nalso when you initiate a type, you need to refer it by its package name, for example, <code>me:=person.Person{}</code>, that should take care of <code>type Person not found</code>. If you are calling a type or function within the same package you don't need to do that. If its the same package, you will not need to <code>import</code> it either.</p>\n"}, {"tags": [], "owner": {"reputation": 13, "user_id": 9076380, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ji9nbE0HKFU/AAAAAAAAAAI/AAAAAAAAAB8/5AWNlP1EQUw/photo.jpg?sz=128", "display_name": "RomanKosiy", "link": "https://stackoverflow.com/users/9076380/romankosiy"}, "is_accepted": false, "score": 0, "last_activity_date": 1536073896, "creation_date": 1536073896, "answer_id": 52169374, "question_id": 52149661, "link": "https://stackoverflow.com/questions/52149661/cannot-find-go-package/52169374#52169374", "title": "cannot find Go package", "body": "<p>Hope this will help to solve your problem. If you want to declare your person outside of the function you should use var as well as you cant use methods outside of the functions</p>\n\n<pre><code>package main\n\nimport (\n    \"person\"\n)\n\nvar p person.Person = Person {\n FirstName : \"Shiju\",\n LastName : \"Varghese\",\n Dob : time.Date(1979, time.February, 17, 0, 0, 0, 0, time.UTC),\n Email : \"shiju@email.com\",\n Location : \"Kochi\",\n}\n\nfunc main(){\n   p.PrintName()\n   p.PrintDetails()   \n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10133356"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 52151737, "answer_count": 3, "score": -4, "last_activity_date": 1536073896, "creation_date": 1535977082, "last_edit_date": 1535978087, "question_id": 52149661, "link": "https://stackoverflow.com/questions/52149661/cannot-find-go-package", "title": "cannot find Go package", "body": "<p>I am new at learning Go. I read that if I create a package and I use the install function that, that package will be available throughout my program. Yet after creating the following package and running the 'go install' command the package is not available to my program:</p>\n\n<pre><code>package person\n\nimport (\n \"fmt\"\n \"time\"\n)\n\n//Person struct\ntype Person struct {\n FirstName, LastName string\n Dob                 time.Time\n Email, Location     string\n}\n\n//PrintName method\nfunc (p Person) PrintName() {\n  fmt.Printf(\"\\n%s %s\\n\", p.FirstName, p.LastName)\n}\n\n//PrintDetails Method\nfunc (p Person) PrintDetails() {\n  fmt.Printf(\"[Date of Birth: %s, Email: %s, Location: %s ]\\n\", p.Dob.String(), p.Email,\n    p.Location)\n}\n</code></pre>\n\n<p>and then creating the following main function either gives me 'syntax error: non-declaration statement outside function body' or it says the package is not found if I only use the package name which is what I learned I can do</p>\n\n<pre><code>package main\n\nimport (\n\"person\"\n)\n\np := Person {\nFirstName : \"Shiju\",\nLastName : \"Varghese\",\nDob : time.Date(1979, time.February, 17, 0, 0, 0, 0, time.UTC),\nEmail : \"shiju@email.com\",\nLocation : \"Kochi\",\n}\n\np. PrintName()\np. PrintDetails()\n</code></pre>\n\n<p>What am I doing wrong please? </p>\n"}, {"tags": ["image", "ubuntu", "go", "png"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 6, "creation_date": 1535972825, "post_id": 52148483, "comment_id": 91246691, "body": "Most likely it is a valid image, but not a PNG image. Use the general <a href=\"https://golang.org/pkg/image/#Decode\" rel=\"nofollow noreferrer\"><code>image.Decode()</code></a> function which detects the image type based on a registry. Don&#39;t forget to import <code>image&#47;png</code>, <code>image&#47;jpeg</code> and <code>image&#47;gif</code> for it to recognize those formats (the imports will register the formats; use blank import if you don&#39;t use those packages)."}, {"owner": {"reputation": 3271, "user_id": 2865564, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/100000338538498/picture?type=large", "display_name": "Nicolas El Khoury", "link": "https://stackoverflow.com/users/2865564/nicolas-el-khoury"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1535973360, "post_id": 52148483, "comment_id": 91246998, "body": "Can you please explain the cause and the solution? It is a PNG image, since it has a PNG extension, and the Content-Type is PNG. Moreover, the image is successfully opened by some programs, namely imageMagick in ubuntu and photos in Windows, but not with image Viewer in Ubuntu"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1535974289, "post_id": 52148483, "comment_id": 91247526, "body": "The format of an image is not defined by the extension of its name nor an associated content type. You can take a JPEG image and rename it to have a <code>.png</code> extension, that will not make it a PNG image, it will still be a JPEG image. The format of an image is defined by its content. Please report back if my suggestion solves your issue."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1535976334, "post_id": 52148483, "comment_id": 91248719, "body": "Check what the file actually is (name and content type are irrelevant) with <code>file</code>."}, {"owner": {"reputation": 27168, "user_id": 7355741, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6CMNt.jpg?s=128&g=1", "display_name": "fmw42", "link": "https://stackoverflow.com/users/7355741/fmw42"}, "edited": false, "score": 0, "creation_date": 1535994425, "post_id": 52148483, "comment_id": 91257917, "body": "Post a zipped version of your file to protect it from being changed by this forum. Then others can check what the format actually is."}, {"owner": {"reputation": 3271, "user_id": 2865564, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/100000338538498/picture?type=large", "display_name": "Nicolas El Khoury", "link": "https://stackoverflow.com/users/2865564/nicolas-el-khoury"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536062695, "post_id": 52148483, "comment_id": 91281366, "body": "@icza you are right. I am posting an answer to my question."}], "answers": [{"comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1536066020, "post_id": 52166016, "comment_id": 91283550, "body": "The content-type used by the web server is derived from the file extension with most web servers (go&#39;s built in http server is actually an exception). On such web servers, it can only be as accurate as the file extension."}], "tags": [], "owner": {"reputation": 3271, "user_id": 2865564, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/100000338538498/picture?type=large", "display_name": "Nicolas El Khoury", "link": "https://stackoverflow.com/users/2865564/nicolas-el-khoury"}, "is_accepted": false, "score": 1, "last_activity_date": 1536062890, "creation_date": 1536062890, "answer_id": 52166016, "question_id": 52148483, "link": "https://stackoverflow.com/questions/52148483/invalid-format-not-a-png-file/52166016#52166016", "title": "Invalid format: not a PNG file", "body": "<p>Aparently, even though the extension name is .png, and its content type is PNG, it is not necessarily a PNG image. The only way to know for sure is by examining the image header.</p>\n\n<p>One way to overcome this problem with GoLang is to use the general <code>image.Decode()</code> function which detects the image type based on a registry as suggested by @icza</p>\n"}], "owner": {"reputation": 3271, "user_id": 2865564, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/100000338538498/picture?type=large", "display_name": "Nicolas El Khoury", "link": "https://stackoverflow.com/users/2865564/nicolas-el-khoury"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1809, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1536062890, "creation_date": 1535972680, "last_edit_date": 1535974046, "question_id": 52148483, "link": "https://stackoverflow.com/questions/52148483/invalid-format-not-a-png-file", "title": "Invalid format: not a PNG file", "body": "<p>I have a code that downloads images from AWS S3, decodes them, and resizes them. The code supports images with PNG and JPG/JPEG formats. </p>\n\n<p>Here is how I download the images from AWS S3:</p>\n\n<pre><code>//downloads an image from S3\nfunc downloadImage(bucket string, item string) error {\nfile, err := os.Create(strings.Split(item, \"/\")[len(strings.Split(item, \"/\"))-1])\nif err != nil {\n    fmt.Println(\"Unable to open file\", err)\n    return err\n}\n//create a new AWS session\nsess, err := session.NewSession(&amp;aws.Config{\n    Region: aws.String(\"eu-west-1\")},\n)\n//create the s3 downloader\ndownloader := s3manager.NewDownloader(sess)\n\ndefer file.Close()\n//download the image from S3\nnumBytes, err := downloader.Download(file,\n    &amp;s3.GetObjectInput{\n        Bucket: aws.String(bucket),\n        Key:    aws.String(item),\n    })\nif err != nil {\n    fmt.Println(\"Unable to download item\", item)\n    fmt.Println(err)\n    return err\n}\n\nfmt.Println(\"Downloaded\", file.Name(), numBytes, \"bytes\")\nreturn nil\n}\n</code></pre>\n\n<p>Here is how I decode the images: </p>\n\n<pre><code>file, err := os.Open(image)\nif err != nil {\n    fmt.Println(err)\n    return err\n}\nif strings.Split(image, \".\")[len(strings.Split(image, \".\"))-1] == \"jpg\" ||\n    strings.Split(image, \".\")[len(strings.Split(image, \".\"))-1] == \"jpeg\" {\n    img, err := jpeg.Decode(file)\n\n    if err != nil {\n        fmt.Println(err)\n        return err\n    }\n    file.Close()\n}\nelse if strings.Split(image, \".\")[len(strings.Split(image, \".\"))-1] == \"png\" {\n    img, err := png.Decode(file)\n\n    if err != nil {\n        fmt.Println(err)\n        return err\n    }\n    file.Close()\n}\n</code></pre>\n\n<p>The images are downloaded, decoded, and resized successfully. A problem arises when the code downloads some PNG images (not all), and tries to decode them. It can't.</p>\n\n<p>it generates the following error:</p>\n\n<pre><code>png: invalid format: not a PNG file\n</code></pre>\n\n<p>I am running everything on top of an Ubuntu 16.04. What is weird is that if I open this image using Image viewer, it generates the same error. However, if I open using any other program, such as: ImageMagick, the image opens without any complaint.</p>\n\n<p>How can I overcome this issue in the Golang code?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "is_accepted": false, "score": 3, "last_activity_date": 1535974448, "last_edit_date": 1535974448, "creation_date": 1535969408, "answer_id": 52147574, "question_id": 52147211, "link": "https://stackoverflow.com/questions/52147211/a-question-about-main-routine-and-a-child-routine-listening-on-the-same-channel/52147574#52147574", "title": "A question about main routine and a child routine listening on the same channel simultaneously", "body": "<p>In your case, <code>Goroutine closing</code> will always be executed and it will always be printed before <code>Application stopped</code>, because your <code>stop</code> channel is not buffered. This means that the sending will block until the result is received. </p>\n\n<p>In your code, the <code>stop &lt;- true</code> in your <code>main</code> will block until the goroutine has received the value, causing the channel to be empty again. Then the <code>&lt;-stop</code> in your main will block until another value is sent to the channel, which happens when your goroutine returns after printing <code>Goroutine closing</code>.</p>\n\n<p>If you would initialize your channel in a buffered fashion </p>\n\n<pre><code>stop := make(chan bool, 1)\n</code></pre>\n\n<p>then <code>Goroutine closing</code> might not be executed. To see this, you can add a <a href=\"https://golang.org/pkg/time/#Sleep\" rel=\"nofollow noreferrer\"><code>time.Sleep</code></a> right after printing <code>Tick</code>, as this makes this case more likely (it will occur everytime you press <kbd>Ctrl</kbd>+<kbd>C</kbd> during the sleep).</p>\n\n<p>Using a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a> to wait for goroutines to finish is a good alternative, especially if you have to wait for more than one goroutine. You can also use a <a href=\"https://golang.org/pkg/context/#Context\" rel=\"nofollow noreferrer\"><code>context.Context</code></a> to stop goroutines. Reworking your code to use these two methods could look something like this:</p>\n\n<pre><code>func main() {\n    c := make(chan os.Signal, 1)\n    signal.Notify(c)\n\n    ticker := time.NewTicker(time.Second)\n    ctx, cancel := context.WithCancel(context.Background())\n    var wg sync.WaitGroup\n\n    wg.Add(1)\n    go func() {\n        defer func() { wg.Done() }()\n        for {\n            select {\n            case &lt;-ctx.Done():\n                fmt.Println(\"Goroutine closing\")\n                return\n            case &lt;-ticker.C:\n                fmt.Println(\"Tick\")\n                time.Sleep(time.Second)\n            }\n        }\n    }()\n\n    &lt;-c\n    ticker.Stop()\n\n    cancel()\n\n    wg.Wait()\n\n    fmt.Println(\"Application stopped\")\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 5710380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b036e2fb9f6afed70f8db81081fd9eb?s=128&d=identicon&r=PG&f=1", "display_name": "Scala", "link": "https://stackoverflow.com/users/5710380/scala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1535974564, "creation_date": 1535968040, "last_edit_date": 1535974564, "question_id": 52147211, "link": "https://stackoverflow.com/questions/52147211/a-question-about-main-routine-and-a-child-routine-listening-on-the-same-channel", "title": "A question about main routine and a child routine listening on the same channel simultaneously", "body": "<pre><code>func main() {\n    c := make(chan os.Signal, 1)\n    signal.Notify(c)\n\n    ticker := time.NewTicker(time.Second)\n    stop := make(chan bool)\n\n    go func() {\n        defer func() { stop &lt;- true }()\n        for {\n            select {\n            case &lt;-ticker.C:\n                fmt.Println(\"Tick\")\n            case &lt;-stop:\n                fmt.Println(\"Goroutine closing\")\n                return\n            }\n        }\n    }()\n\n    &lt;-c\n    ticker.Stop()\n\n    stop &lt;- true\n\n    &lt;-stop\n    fmt.Println(\"Application stopped\")\n}\n</code></pre>\n\n<p>No matter how many times I run the code above, I got the same result. That is, \"Goroutine closing\" is always printed before \"Application stopped\" after I press <kbd>Ctrl</kbd>+<kbd>C</kbd>.</p>\n\n<p>I think, theoretically, there is a chance that \"Goroutine closing\" won't be printed at all. Am I right? Unfortunately, I never get this theoretical result.</p>\n\n<p>BTW: I know reading and writing a channel in one routine should be avoided. Ignore that temporarily.</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "edited": false, "score": 0, "creation_date": 1535967760, "post_id": 52146759, "comment_id": 91243897, "body": "Any docs about the behavior of <code>close()</code>? I haven&#39;t found that on golang spec."}, {"owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "edited": false, "score": 0, "creation_date": 1535977458, "post_id": 52146759, "comment_id": 91249394, "body": "Thank you guys for the info:)"}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 4, "last_activity_date": 1535967508, "last_edit_date": 1535967508, "creation_date": 1535966514, "answer_id": 52146759, "question_id": 52146709, "link": "https://stackoverflow.com/questions/52146709/does-closing-a-channel-block-until-the-receiver-read-it/52146759#52146759", "title": "Does closing a channel block until the receiver read it", "body": "<p>No. Use a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a> instead.</p>\n"}], "owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1289, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1535989811, "creation_date": 1535966343, "last_edit_date": 1535989811, "question_id": 52146709, "link": "https://stackoverflow.com/questions/52146709/does-closing-a-channel-block-until-the-receiver-read-it", "title": "Does closing a channel block until the receiver read it", "body": "<p>I've implemented a method to shutdown my server by closing a channel, so other goroutines read the closed channel then exit. After the shutdown, I need to do some cleaning with server data, if <code>close()</code> blocks until all other goroutines read the closed channel, I can access the data without lock. So the question is: does closing a channel block until the receiver read from it? Below is the example code:</p>\n\n<pre><code>package main\n\ntype server struct {\n    chStop chan struct{}\n    data map[int]interface{}\n}\n\nfunc newServer() *server {\n    return &amp;server {\n        chStop: make(chan struct{})\n    }\n}\n\nfunc (s *server) stop() {\n    close(s.chStop)\n    // do something with s.data\n    ...\n    // if other goroutines already read closed s.chStop and exited,\n    // we can access s.data without lock\n}\n\nfunc (s *server) run2() {\n    ...\n    for {\n        select{\n        case &lt;-s.chStop:\n            return\n        case &lt;- other channel:\n        // access s.data with lock\n        }\n    }\n}\n\nfunc (s *server) run() {\n    ch := make(chan struct{})\n    ...\n    for {\n        select{\n        case &lt;-s.chStop:\n            return\n        case &lt;- ch:\n            // access s.data with lock\n        }\n    }\n}\n\nfunc main() {\n    s := newServer()\n    go s.run()\n    go s.run2()\n    s.stop()\n}\n</code></pre>\n"}, {"tags": ["database", "mongodb", "go", "struct", "mgo"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1535965664, "post_id": 52146057, "comment_id": 91242704, "body": "Export your fields!!!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1535965690, "post_id": 52146057, "comment_id": 91242730, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/34479595/go-nested-object-with-mgo-adapter\">Go nested object with mgo adapter</a>"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 10203333, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1yzK.png?s=128&g=1", "display_name": "Justin Johnson", "link": "https://stackoverflow.com/users/10203333/justin-johnson"}, "edited": false, "score": 0, "creation_date": 1535969378, "post_id": 52146164, "comment_id": 91244893, "body": "Can we talk on mail or discord?! Pleas? Can you give your id?!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 31, "user_id": 10203333, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1yzK.png?s=128&g=1", "display_name": "Justin Johnson", "link": "https://stackoverflow.com/users/10203333/justin-johnson"}, "edited": false, "score": 0, "creation_date": 1535969735, "post_id": 52146164, "comment_id": 91245095, "body": "@JustinJohnson Talk about what? Ask here."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1535966651, "last_edit_date": 1535966651, "creation_date": 1535964369, "answer_id": 52146164, "question_id": 52146057, "link": "https://stackoverflow.com/questions/52146057/golang-mgo-finding/52146164#52146164", "title": "Golang mgo Finding", "body": "<p>You have to export all struct fields subject to marshaling / unmarshaling, so change their name to start with capital letter:</p>\n\n<pre><code>type Person struct {\n    Id       bson.ObjectId `bson:\"_id,omitempty\"`//`json:\"id\" bson:\"_id,omitempty\"`\n    Username string        `json:\"username\" bson:\"username\"`\n    Score    string        `json:\"score\" bson:\"score\"`\n    Level    string        `json:\"level\" bson:\"level\"`\n}\n</code></pre>\n\n<p>Also note that to find a document by its ID, you may use <a href=\"https://godoc.org/github.com/globalsign/mgo#Collection.FindId\" rel=\"nofollow noreferrer\"><code>Collection.FindId()</code></a>:</p>\n\n<pre><code>err = c.FindId(bson.ObjectIdHex(id)).\n    Select(bson.M{\"username\": 1, \"score\":1, \"level\": 1}).One(&amp;result)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 10203333, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1yzK.png?s=128&g=1", "display_name": "Justin Johnson", "link": "https://stackoverflow.com/users/10203333/justin-johnson"}, "edited": false, "score": 0, "creation_date": 1535969807, "post_id": 52147639, "comment_id": 91245134, "body": "&quot;+1&quot; Thank you soo much"}, {"owner": {"reputation": 31, "user_id": 10203333, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1yzK.png?s=128&g=1", "display_name": "Justin Johnson", "link": "https://stackoverflow.com/users/10203333/justin-johnson"}, "edited": false, "score": 0, "creation_date": 1535969971, "post_id": 52147639, "comment_id": 91245215, "body": "Do you use Go for back-end?"}, {"owner": {"reputation": 16, "user_id": 8694642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf85740c28c5dc355d3f751f01e1d69f?s=128&d=identicon&r=PG", "display_name": "Hadi Taghiloo", "link": "https://stackoverflow.com/users/8694642/hadi-taghiloo"}, "reply_to_user": {"reputation": 31, "user_id": 10203333, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1yzK.png?s=128&g=1", "display_name": "Justin Johnson", "link": "https://stackoverflow.com/users/10203333/justin-johnson"}, "edited": false, "score": 0, "creation_date": 1535970127, "post_id": 52147639, "comment_id": 91245297, "body": "You&#39;re welcome! Yes, I use GO! For my work is BEST! :))"}], "tags": [], "owner": {"reputation": 16, "user_id": 8694642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf85740c28c5dc355d3f751f01e1d69f?s=128&d=identicon&r=PG", "display_name": "Hadi Taghiloo", "link": "https://stackoverflow.com/users/8694642/hadi-taghiloo"}, "is_accepted": true, "score": 0, "last_activity_date": 1535969625, "creation_date": 1535969625, "answer_id": 52147639, "question_id": 52146057, "link": "https://stackoverflow.com/questions/52146057/golang-mgo-finding/52147639#52147639", "title": "Golang mgo Finding", "body": "<p>Just you should use the capital letter in first of struct names!\nAnd also you don't need </p>\n\n<pre><code> Select(bson.M{\"username\": 1, \"score\":1, \"level\": 1})\n</code></pre>\n\n<p>You can write :</p>\n\n<pre><code>err = c.FindId(bson.ObjectIdHex(id)).One(&amp;result)\n</code></pre>\n\n<p>Good Luck :))</p>\n"}], "owner": {"reputation": 31, "user_id": 10203333, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1yzK.png?s=128&g=1", "display_name": "Justin Johnson", "link": "https://stackoverflow.com/users/10203333/justin-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 52147639, "answer_count": 2, "score": 0, "last_activity_date": 1535969625, "creation_date": 1535963938, "last_edit_date": 1535966676, "question_id": 52146057, "link": "https://stackoverflow.com/questions/52146057/golang-mgo-finding", "title": "Golang mgo Finding", "body": "<p>I try to find my user in MongoDB but when I run this code :</p>\n\n<pre><code>type Person struct {\n    Id bson.ObjectId `bson:\"_id,omitempty\"`//`json:\"id\" bson:\"_id,omitempty\"`\n    username string `json:\"username\" bson:\"username\"`\n    score string `json:\"score\" bson:\"score\"`\n    level string `json:\"level\" bson:\"level\"`\n}\n\nresult := Person{}\nvar id = \"5b8a45912ed6f24d945bee38\"\nerr = c.Find(bson.M{\"_id\":bson.ObjectIdHex(id)}).Select(bson.M{\"username\": 1, \"score\":1, \"level\": 1}).One(&amp;result)\n\nfmt.Println(result)\n</code></pre>\n\n<p>Just It show me :</p>\n\n<p><code>{ObjectIdHex(\"5b8a45912ed6f24d945bee38\")   }</code></p>\n\n<p>And don't return other value!</p>\n\n<p>Thank you so much for your time!</p>\n"}, {"tags": ["api", "docker", "go", "sdk"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1535970084, "post_id": 52145231, "comment_id": 91245273, "body": "If you run the thing you&#39;re trying to run as the main process in the <code>ContainerCreate</code> call, its stdout and stderr will come back in the <code>ContainerLogs</code> call.  This is the CLI equivalent of just running the command in <code>docker run</code>.  You don&#39;t need a separate <code>ContainerExecStart</code> (<code>docker exec</code>) here."}, {"owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1535972698, "post_id": 52145231, "comment_id": 91246628, "body": "@DavidMaze I am very excited that someone can answer my question. I tried some methods based on your suggestion, but I can&#39;t get the result. Maybe I understand it wrong. could you explain more clearly? Thanks!"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1535972874, "post_id": 52145231, "comment_id": 91246716, "body": "Delete the two <code>ContainerExec...</code> calls.  Change the <code>Cmd:</code> in the <code>ContainerCreate</code> call to have the <code>{&quot;echo&quot;, &quot;hello&quot;}</code> or the thing you&#39;re actually trying to run."}, {"owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1535973481, "post_id": 52145231, "comment_id": 91247064, "body": "@DavidMaze I understand you said now, but I want to exec two different cmds in same running container, for example, first run <code>go build main.go</code>, and then run &quot;go run main.exe&quot;, so I want to create another exec to run another cmd. could you give me some ideas? I try so many methods.."}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1535973846, "post_id": 52145231, "comment_id": 91247245, "body": "A shell script; run the &quot;build&quot; step <a href=\"https://docs.docker.com/get-started/part2/\" rel=\"nofollow noreferrer\">in a Dockerfile</a>; write some sort of networked controller that runs inside the worker container and accepts abstract commands like &quot;build it&quot;; don&#39;t use Docker at all for this kind of workflow."}, {"owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1535974622, "post_id": 52145231, "comment_id": 91247714, "body": "@DavidMaze ok, I will try to do, Another alternative is: After create container use sdk, I directly use golang like <code>cmd := exec.Command(&quot;docker&quot;,&quot;exec&quot;)</code> to invoke <code>docker exec</code>, I explain why I do that, I want to implement online compiler,  someone say docker container is good for that. After recv codes from web browser, I <b>compile</b> and <b>run</b> in container, get stdout, stderr , send back to front-end, that&#39;s all. Thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 521, "user_id": 9656767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a24ec0459765f262a759bfb453165633?s=128&d=identicon&r=PG", "display_name": "Tyhal", "link": "https://stackoverflow.com/users/9656767/tyhal"}, "is_accepted": false, "score": 1, "last_activity_date": 1578783710, "creation_date": 1578783710, "answer_id": 59699419, "question_id": 52145231, "link": "https://stackoverflow.com/questions/52145231/cannot-get-logs-from-docker-container-using-golang-docker-sdk/59699419#59699419", "title": "cannot get logs from docker container using golang docker sdk", "body": "<p>Instead of <em>ContainerExecStart</em> replace it with <em>ContainerExecAttach</em></p>\n\n<pre><code>attach, err := dockerClient.ContainerExecAttach(ctx, idResponse.ID, config)\nif err != nil {\n    return err\n}\ndefer attach.Close()\ngo io.Copy(os.Stdout, attach.Reader)\n</code></pre>\n"}], "owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1875, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1596924711, "creation_date": 1535960621, "last_edit_date": 1535962319, "question_id": 52145231, "link": "https://stackoverflow.com/questions/52145231/cannot-get-logs-from-docker-container-using-golang-docker-sdk", "title": "cannot get logs from docker container using golang docker sdk", "body": "<p>I want to compile untrusted code in docker container, so I want to test exec command</p>\n\n<pre><code>import (\n\"context\"\n\"github.com/docker/docker/api/types\"\n\"github.com/docker/docker/api/types/container\"\n\"github.com/docker/docker/client\"\nlog \"github.com/sirupsen/logrus\"\n\"io\"\n\"os\"\n)\n\nfunc main() {\ndockerClient, err := client.NewClientWithOpts(client.WithVersion(\"1.38\"))\nif err != nil{\n    log.Error(\"error when create dockerClient \",err)\n}\n\nctx := context.Background()\n\ncontainer, err := dockerClient.ContainerCreate(ctx,&amp;container.Config{\n    Image:\"golang\",\n    OpenStdin:true,\n    Tty:true,\n    AttachStdin:true,\n    Cmd:[]string{\"bash\"},\n    AttachStdout:true,\n    AttachStderr:true,\n\n\n},nil,nil,\"\")\n\nif err := dockerClient.ContainerStart(ctx,container.ID,types.ContainerStartOptions{});err != nil{\n    log.Error(\"error when start container\", err)\n    return\n}\n\nidResponse, err :=dockerClient.ContainerExecCreate(ctx,container.ID,types.ExecConfig{\n    Cmd:[]string{\"echo\",\"hello\"},\n    Tty:true,\n    AttachStderr:true,\n    AttachStdout:true,\n    AttachStdin:true,\n    Detach:true,\n})\n\nif err := dockerClient.ContainerExecStart(ctx,idResponse.ID,types.ExecStartCheck{\n\n}); err != nil{\n    log.Error(\"error when exec start \", err)\n}\n\nreader, err :=dockerClient.ContainerLogs(ctx,container.ID,types.ContainerLogsOptions{\n    ShowStdout:true,\n    ShowStderr:true,\n\n\n})\n\nif err != nil{\n    log.Error(\"error when containerLogs\",err)\n}\n\ngo io.Copy(os.Stdout,reader)\n\n&lt;- make(chan struct{})\n</code></pre>\n\n<p>}</p>\n\n<p>as you can see, I create an new exec process, exec a new cmd called \"echo hello\", I want to get output from running container and show in my golang console. but not working, could you help me to solve? I try so many ways but not worked.</p>\n\n<p>and I also try to remove <code>dockerClient.ContainerLogs</code> block, replace with</p>\n\n<pre><code>conn, err :=dockerClient.ContainerAttach(ctx,container.ID,types.ContainerAttachOptions{\n    Stdout:true,\n    Stderr:true,\n    Stdin:true,\n    Stream:true,\n    Logs:true,\n})\n\ngo io.Copy(os.Stdout,conn.Reader)\n</code></pre>\n\n<p>but still cannot get logs from container. When I run above code, my console is empty, expected result is have \"hello\" in my console.</p>\n"}, {"tags": ["go", "visual-studio-code"], "answers": [{"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 1, "last_activity_date": 1535961291, "creation_date": 1535961291, "answer_id": 52145415, "question_id": 52144400, "link": "https://stackoverflow.com/questions/52144400/how-to-run-a-make-file-on-save-in-vs-code-using-go-extension/52145415#52145415", "title": "How to run a make file on save in VS Code - using go extension", "body": "<blockquote>\n  <p>How can I run a make build on save in VS Code on save event?</p>\n</blockquote>\n\n<p>The <a href=\"https://code.visualstudio.com/docs/languages/go#_build-lint-and-vet\" rel=\"nofollow noreferrer\">Build, Lint and Vet</a> of the VSCode Go extension from Microsoft (v1.26) currently based on <code>go build</code>. You can choose the preset option for <code>package</code> (default), <code>workspace</code>, or <code>off</code>. See <a href=\"https://github.com/Microsoft/vscode-go/blob/master/src/goBuild.ts\" rel=\"nofollow noreferrer\">vscode-go/goBuild.ts</a></p>\n\n<p>If you would like to have a custom build i.e. <code>make build</code> on your workspace, you can set <a href=\"https://code.visualstudio.com/Docs/editor/tasks#_custom-tasks\" rel=\"nofollow noreferrer\">VSCode Custom Tasks</a> instead. </p>\n"}], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1768, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535961291, "creation_date": 1535957005, "question_id": 52144400, "link": "https://stackoverflow.com/questions/52144400/how-to-run-a-make-file-on-save-in-vs-code-using-go-extension", "title": "How to run a make file on save in VS Code - using go extension", "body": "<p>How can I run a <code>make build</code> on save in VS Code on save event?</p>\n\n<p>I can see that I can do something like the following.</p>\n\n<pre><code>{\n    \"go.buildOnSave\": \"workspace\"\n}\n</code></pre>\n\n<p>I guess the lack doc. is be cause  it is just basic VS Code - on setting a command.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 4, "creation_date": 1535928477, "post_id": 52141505, "comment_id": 91232818, "body": "What is your actual problem? You have posted your code and your test, okay. What kind of help are you looking for? PS: it also would be ideal if you provided minimal yet complete examples which are possible to run on <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">play.golang.org</a> with little to no modifications."}, {"owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 2, "creation_date": 1535928543, "post_id": 52141505, "comment_id": 91232830, "body": "Please provide a <a href=\"http://sscce.org/\" rel=\"nofollow noreferrer\">short, self contained, correct example</a>. Furthermore, please specify the structure of your inputs (including an example, preferably) and the expected outputs. It is unclear to me from your question precisely what you are trying to accomplish."}, {"owner": {"reputation": 11, "user_id": 10307897, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WwqsqYZAuXo/AAAAAAAAAAI/AAAAAAAABAE/A9CQDssQB8M/photo.jpg?sz=128", "display_name": "Ananya Aswin", "link": "https://stackoverflow.com/users/10307897/ananya-aswin"}, "edited": false, "score": 1, "creation_date": 1535928964, "post_id": 52141505, "comment_id": 91232897, "body": "I just need to know how I could possibly take a string such as &quot;hi li le&quot; and make it into an array of strings such as [&quot;hi&quot;,&quot;li&quot;,&quot;le&quot;]"}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "edited": false, "score": 0, "creation_date": 1535961315, "post_id": 52141505, "comment_id": 91240475, "body": "Please read <a href=\"//meta.stackoverflow.com/q/326569\">Under what circumstances may I add \u201curgent\u201d or other similar phrases to my question, in order to obtain faster answers?</a> - the summary is that this is not an ideal way to address volunteers, and is probably counterproductive to obtaining answers. Please refrain from adding this to your questions."}], "answers": [{"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 3, "last_activity_date": 1535933351, "last_edit_date": 1535933351, "creation_date": 1535932695, "answer_id": 52141851, "question_id": 52141505, "link": "https://stackoverflow.com/questions/52141505/taking-a-string-and-splitting-it-into-an-array-of-strings-in-golang/52141851#52141851", "title": "Taking a string and splitting it into an array of strings in Golang", "body": "<blockquote>\n  <p><em>I just need to know how I could possibly take a string such as \"hi li le\" and make it into an array of strings such as [\"hi\",\"li\",\"le\"]</em></p>\n</blockquote>\n\n<p>Yes with <a href=\"https://golang.org/pkg/strings/#Split\" rel=\"nofollow noreferrer\"><code>strings.Split</code></a> or <a href=\"https://golang.org/pkg/strings/#Fields\" rel=\"nofollow noreferrer\"><code>strings.Fields</code></a>.</p>\n\n<pre><code>for _, word := range strings.Fields(\"hi li le\") {\n    fmt.Println(word)\n}\n</code></pre>\n\n<p>Here's a way to do it manually, for illustration.</p>\n\n<pre><code>func split(tosplit string, sep rune) []string {\n    var fields []string\n\n    last := 0\n    for i,c := range tosplit {\n        if c == sep {\n            // Found the separator, append a slice\n            fields = append(fields, string(tosplit[last:i]))\n            last = i + 1\n        } \n    }\n\n    // Don't forget the last field\n    fields = append(fields, string(tosplit[last:]))\n\n    return fields\n}\n\nfunc main() {\n    str := \"hello world stuff\"\n    for _,field := range split(str, ' ') {\n        fmt.Println(field)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10307897, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WwqsqYZAuXo/AAAAAAAAAAI/AAAAAAAABAE/A9CQDssQB8M/photo.jpg?sz=128", "display_name": "Ananya Aswin", "link": "https://stackoverflow.com/users/10307897/ananya-aswin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2606, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1535961280, "creation_date": 1535928187, "last_edit_date": 1535961280, "question_id": 52141505, "link": "https://stackoverflow.com/questions/52141505/taking-a-string-and-splitting-it-into-an-array-of-strings-in-golang", "title": "Taking a string and splitting it into an array of strings in Golang", "body": "<p>I am trying to take an array and split it into an array of strings, this is my code:</p>\n\n<pre><code>if split != \"\" {\n\n    for i := 0; i &lt; len(split); i++ {\n\n        for j := 0; j &lt; len(split); j += 0 {\n\n            splits := []byte(split)\n\n            if splits[i] == ' ' {\n\n\n                result := split[i] - split[j]\n\n                for k := 0; k &lt;= i; k++ {\n\n                    fitting := make([]byte, result)\n                    fitting[k] = splits[k]\n                    fmt.Println(fitting[k])\n\n                    if k &gt; i-1 {\n\n                        fittings := string(fitting[:])\n                        word := []string{}\n                        words := append(word, fittings)\n                        fmt.Println(split, words)\n                    }\n                }\n\n            }\n        }\n    }\n}\nreturn Strings(split)\n</code></pre>\n\n<p>and this is my test case:</p>\n\n<pre><code>fmt.Println(actual, expected)\n\nfor i := 0; i &lt; len(expected); i++ {\n\n    if actual[i] != expected[i] {\n        t.Errorf(\"does not match\")\n        t.Fail()\n    }\n\n}\n}\n</code></pre>\n\n<p>None of it is really working.</p>\n"}, {"tags": ["go", "go-http"], "answers": [{"tags": [], "owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "is_accepted": false, "score": 2, "last_activity_date": 1535925295, "creation_date": 1535925295, "answer_id": 52141304, "question_id": 52141282, "link": "https://stackoverflow.com/questions/52141282/http-fileserverhttp-dir-not-working-in-separate-package/52141304#52141304", "title": "&quot;http.FileServer(http.Dir...))&quot; not working in separate package", "body": "<p>The path you give to <code>http.Dir</code> is relative to where the application is run (its working directory, the root of the directory tree you posted, in your case) and not relative to where the <code>.go</code> file is. Just change the path to <code>./web/views</code> and it should work.</p>\n\n<p>In your case, the <code>404 Not Found</code> is returned, because there is no <code>views</code> folder at the top level of your directory tree and therefore there are no files to be served.</p>\n"}, {"tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": true, "score": 5, "last_activity_date": 1535926883, "creation_date": 1535926883, "answer_id": 52141410, "question_id": 52141282, "link": "https://stackoverflow.com/questions/52141282/http-fileserverhttp-dir-not-working-in-separate-package/52141410#52141410", "title": "&quot;http.FileServer(http.Dir...))&quot; not working in separate package", "body": "<p>Remember that Go is a compiled language; most everything the program does happens at runtime.</p>\n\n<p>In particular, in this case, the call to <code>http.Dir()</code> happens at runtime, and that means that the path is evaluated at runtime.</p>\n\n<p>Because the path you have given is relative, it is therefore relative to the working directory from which you run the application. The directory in which the source code resided is not relevant here.</p>\n\n<p>In one invocation to <code>http.Dir()</code> you give the argument <code>./web/views</code>, but in the other, you give the argument <code>./views</code>. It turns out that the correct path based on the directory from which you executed the program was <code>./web/views</code>. When you execute the program with the wrong path, you get <code>404 page not found</code> errors because the path specified did not exist in your working directory.</p>\n"}], "owner": {"reputation": 3014, "user_id": 3449806, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Pp2Ee.jpg?s=128&g=1", "display_name": "sean", "link": "https://stackoverflow.com/users/3449806/sean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 0, "accepted_answer_id": 52141410, "answer_count": 2, "score": 0, "last_activity_date": 1535958646, "creation_date": 1535925021, "last_edit_date": 1535958646, "question_id": 52141282, "link": "https://stackoverflow.com/questions/52141282/http-fileserverhttp-dir-not-working-in-separate-package", "title": "&quot;http.FileServer(http.Dir...))&quot; not working in separate package", "body": "<p>Directory tree:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 web\n    \u251c\u2500\u2500 app.go\n    \u2514\u2500\u2500 views\n        \u251c\u2500\u2500 index.html\n        \u2514\u2500\u2500 js\n            \u2514\u2500\u2500 app.jsx\n</code></pre>\n\n<p>This works:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n)\n\nfunc main() {\n    http.Handle(\"/\", http.FileServer(http.Dir(\"./web/views\")))\n    http.ListenAndServe(\":3000\", nil)\n}\n</code></pre>\n\n<p>But this returns <code>404 page not found</code>:</p>\n\n<p>main.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"{dir with main.go}/web\"\n)\n\nfunc main() {\n    web.StartHttp()\n}\n</code></pre>\n\n<p>app.go:</p>\n\n<pre><code>package web\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc StartHttp() {\n    fmt.Println(\"STARTHTTP - CHECK 01\")\n\n    http.Handle(\"/\", http.FileServer(http.Dir(\"./views\")))\n    http.ListenAndServe(\":3000\", nil)\n}\n</code></pre>\n\n<p>The terminal prints <code>STARTHTTP - CHECK 01</code>, so the <code>StartHttp()</code> function is called, and the terminal asks to allow incoming network connections, so the http server seems to be listening on the port.</p>\n\n<p>Is there some type of context not being passed to the other package?</p>\n"}, {"tags": ["sql", "go", "stored-procedures", "mysql-workbench"], "comments": [{"owner": {"reputation": 2274, "user_id": 7567579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab9644beeb1d324d1247b2951d28927?s=128&d=identicon&r=PG", "display_name": "Emin Laletovic", "link": "https://stackoverflow.com/users/7567579/emin-laletovic"}, "edited": false, "score": 0, "creation_date": 1535971453, "post_id": 52140999, "comment_id": 91246008, "body": "which mysql library for golang are you using?"}, {"owner": {"reputation": 57, "user_id": 10307696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b452bdb04c17238e399fcee29772eb2?s=128&d=identicon&r=PG&f=1", "display_name": "Renan Angelini Ferrari", "link": "https://stackoverflow.com/users/10307696/renan-angelini-ferrari"}, "reply_to_user": {"reputation": 2274, "user_id": 7567579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab9644beeb1d324d1247b2951d28927?s=128&d=identicon&r=PG", "display_name": "Emin Laletovic", "link": "https://stackoverflow.com/users/7567579/emin-laletovic"}, "edited": false, "score": 0, "creation_date": 1536008094, "post_id": 52140999, "comment_id": 91262416, "body": "I use this <a href=\"https://github.com/go-sql-driver/mysql\" rel=\"nofollow noreferrer\">github.com/go-sql-driver/mysql</a>."}, {"owner": {"reputation": 471, "user_id": 344591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dq3CU.jpg?s=128&g=1", "display_name": "C. Bess", "link": "https://stackoverflow.com/users/344591/c-bess"}, "edited": false, "score": 0, "creation_date": 1577898438, "post_id": 52140999, "comment_id": 105277334, "body": "For others, here is another working example in golang: <a href=\"https://gist.github.com/cbess/d14f8ec78bf239b72645246c9ee3f67b\" rel=\"nofollow noreferrer\">gist.github.com/cbess/d14f8ec78bf239b72645246c9ee3f67b</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2274, "user_id": 7567579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab9644beeb1d324d1247b2951d28927?s=128&d=identicon&r=PG", "display_name": "Emin Laletovic", "link": "https://stackoverflow.com/users/7567579/emin-laletovic"}, "is_accepted": true, "score": 1, "last_activity_date": 1536048513, "creation_date": 1536048513, "answer_id": 52161647, "question_id": 52140999, "link": "https://stackoverflow.com/questions/52140999/return-of-mysql-procedure-using-golang/52161647#52161647", "title": "Return of mysql procedure using golang", "body": "<p>You can see <a href=\"https://github.com/go-sql-driver/mysql/issues/656\" rel=\"nofollow noreferrer\">here</a> that usage of <code>out</code> parameter is not yet implemented for <code>https://github.com/go-sql-driver/mysql</code> library.</p>\n\n<p>I'm not sure what you want to do with your code, but if you want to return only one value, you can do something like this:</p>\n\n<p>Stored procedure:</p>\n\n<pre><code>drop procedure if exists PESSOA_TESTE;\n\ndelimiter $$\n\n\ncreate procedure PESSOA_TESTE(IN psaida int)\n\nbegin\nSET psaida = 2;\nselect psaida;\n\nend\n\n$$\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>   var GerenciaBD GERENCIABD\n    var PontoExecucao int\n\n    GerenciaBD.F_GERENCIABD_ABRIR_CONEXAO_MYSQL()\n\n    GerenciaBD.DataBase.QueryRowContext(context.TODO(),\"CALL PESSOA_TESTE(?)\", PontoExecucao).Scan(&amp;PontoExecucao)\n\n    println(PontoExecucao)\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 10307696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b452bdb04c17238e399fcee29772eb2?s=128&d=identicon&r=PG&f=1", "display_name": "Renan Angelini Ferrari", "link": "https://stackoverflow.com/users/10307696/renan-angelini-ferrari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1609, "favorite_count": 0, "accepted_answer_id": 52161647, "answer_count": 1, "score": 3, "last_activity_date": 1536048513, "creation_date": 1535922026, "last_edit_date": 1535922440, "question_id": 52140999, "link": "https://stackoverflow.com/questions/52140999/return-of-mysql-procedure-using-golang", "title": "Return of mysql procedure using golang", "body": "<p>I'm having a problem getting the return of a procedure using golang. If I remove the parameters from the procedure the procedure is executed normally, however, when I need to get the return (OUT parameter) I can not get it and the procedure is not executed. To make the tests simpler and to get help, I created a simple procedure as below and I want to get the return of it.</p>\n\n<p>Follow procedure below:</p>\n\n<hr>\n\n<pre><code>drop procedure if exists PESSOA_TESTE;\n\ndelimiter $$\n\n\ncreate procedure PESSOA_TESTE(out psaida int)\n\nbegin\n\nset psaida = 2;\n\nend\n\n$$\n</code></pre>\n\n<p>Now it follows the section of golang code that I'm using to try to get the value 2 specified in the procedure.</p>\n\n<pre><code>var GerenciaBD GERENCIABD\nvar PontoExecucao int\n\nGerenciaBD.F_GERENCIABD_ABRIR_CONEXAO_MYSQL()\n\nGerenciaBD.DataBase.ExecContext(context.TODO(),\"call PESSOA_TESTE\", sql.Named(\"psaida\", sql.Out{Dest:&amp;PontoExecucao}))\n\nprintln(PontoExecucao)\n</code></pre>\n\n<p>When executing I have as answer 0 and not 2, which is the one specified in the procedure.</p>\n\n<p>My golang version is at 1.10.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1535958764, "post_id": 52140889, "comment_id": 91239222, "body": "@Volker: Duplicate of which question?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535961703, "post_id": 52140889, "comment_id": 91240670, "body": "@Flimzy That&#39;s what I&#39;m too lazy too look up."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1535962027, "post_id": 52140889, "comment_id": 91240848, "body": "@Volker haha... understood"}], "answers": [{"comments": [{"owner": {"reputation": 2222, "user_id": 3918590, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/100000168044240/picture?type=large", "display_name": "Mustafa Mamun", "link": "https://stackoverflow.com/users/3918590/mustafa-mamun"}, "edited": false, "score": 0, "creation_date": 1535959455, "post_id": 52140940, "comment_id": 91239575, "body": "Thank you very much :). I got the problem now."}], "tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": true, "score": 2, "last_activity_date": 1535921510, "creation_date": 1535921510, "answer_id": 52140940, "question_id": 52140889, "link": "https://stackoverflow.com/questions/52140889/slice-of-struct-value-always-overwritten-by-the-last-index/52140940#52140940", "title": "Slice of struct value always overwritten by the last index", "body": "<p><code>for _, personone := range persons {</code></p>\n\n<p>in this statement <code>personone</code> is a variable that is declared once and is overwritten on every iteration.</p>\n\n<p>Then you obtain its address in this statement <code>getName(newRecord, &amp;personone)</code>.</p>\n\n<p>So you pass the same address every time, which is changed in every iteration.</p>\n\n<p>So you end up having the same value, since you have assigned the same address.</p>\n\n<p>How to fix: don't use pointers if you don't actually need them.</p>\n\n<p>A super dirty hack would be to make a copy of the structure explicitly <a href=\"https://play.golang.org/p/Sp4xD88rfvE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Sp4xD88rfvE</a></p>\n\n<pre><code>for _, personone := range persons {\n    personone := personone // &lt;-- see here\n    newRecord := &amp;Record{}\n    getName(newRecord, &amp;personone)\n    Records = append(Records, newRecord)\n}\n</code></pre>\n\n<p>but I really would not recommend you doing that</p>\n"}], "owner": {"reputation": 2222, "user_id": 3918590, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/100000168044240/picture?type=large", "display_name": "Mustafa Mamun", "link": "https://stackoverflow.com/users/3918590/mustafa-mamun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 52140940, "answer_count": 1, "score": 0, "last_activity_date": 1535958747, "creation_date": 1535921075, "last_edit_date": 1535958747, "question_id": 52140889, "link": "https://stackoverflow.com/questions/52140889/slice-of-struct-value-always-overwritten-by-the-last-index", "title": "Slice of struct value always overwritten by the last index", "body": "<p>I am not able to understand the behavior of this code block. What I am doing wrong and what should be the proper way to do this?</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"strconv\"\n)\n\ntype Record struct {\n    name *string\n}\ntype person struct {\n    name string\n}\n\nfunc main() {\n    var Records []*Record\n    var persons []person\n    for i := 0; i &lt; 10; i++ {\n        newValue := person{name: strconv.Itoa(i)}\n        persons = append(persons, newValue)\n    }\n    for _, personone := range persons {\n        newRecord := &amp;Record{}\n        getName(newRecord, &amp;personone)\n        Records = append(Records, newRecord)\n    }\n    for _, record := range Records {\n        fmt.Println(*record.name)\n    }\n\n}\n\nfunc getName(record *Record, value *person) {\n    record.name = &amp;value.name\n}\n</code></pre>\n\n<p>I am expecting this code to print 0 to 9, but it always prints 9, the last value.</p>\n"}, {"tags": ["go", "dbus", "wpa-supplicant"], "comments": [{"owner": {"reputation": 698, "user_id": 6423991, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_pHm3F9zbNw/AAAAAAAAAAI/AAAAAAAAAQE/bR6qITWzgfU/photo.jpg?sz=128", "display_name": "Bharat Chhabra", "link": "https://stackoverflow.com/users/6423991/bharat-chhabra"}, "edited": false, "score": 0, "creation_date": 1580448981, "post_id": 52139925, "comment_id": 106108318, "body": "Can you create a rest api using this? I want to run a Rest API on PI so that I can change and get all the available Wifi&#39;s inside a client."}], "answers": [{"comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 4, "creation_date": 1535915990, "post_id": 52139926, "comment_id": 91230232, "body": "This is not a place for advertising your own code (even though it might be useful), especially not as an answer to your own question and without any mentioning that this is your code."}], "tags": [], "owner": {"reputation": 109, "user_id": 19916, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fb04e749efad591da53d2ef1ff8815c4?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Berner", "link": "https://stackoverflow.com/users/19916/mark-berner"}, "is_accepted": false, "score": 1, "last_activity_date": 1535918063, "last_edit_date": 1535918063, "creation_date": 1535912825, "answer_id": 52139926, "question_id": 52139925, "link": "https://stackoverflow.com/questions/52139925/golang-api-to-wpa-supplicant/52139926#52139926", "title": "Golang API to WPA Supplicant", "body": "<p>Answering to my own question...</p>\n\n<p><strong>wpa-connect</strong> - API for connection Linux device to Wi-Fi Network (Golang)</p>\n\n<p>This package was developed as part of IoT project in order to add Wi-Fi connectivity to headless Raspberry Pi like devices. No need to <strong>connman</strong> or <strong>Network Manager</strong> be installed.\n<strong>wpa-connect</strong> communicates with WPA supplicant over D-Bus (linux message bus system).</p>\n\n<p>Github repository\n<a href=\"https://github.com/mark2b/wpa-connect\" rel=\"nofollow noreferrer\">https://github.com/mark2b/wpa-connect</a></p>\n\n<p>Examples\nConnect to Wi-Fi network</p>\n\n<pre><code>import wifi \"github.com/mark2b/wpa-connect\"\n\nif conn, err := wifi.ConnectManager.Connect(ssid, password, time.Second * 60); err == nil {\n    fmt.Println(\"Connected\", conn.NetInterface, conn.SSID, conn.IP4.String(), conn.IP6.String())\n} else {\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>Scan for Wi-Fi networks</p>\n\n<pre><code>import wifi \"github.com/mark2b/wpa-connect\"\n\nif bssList, err := wifi.ScanManager.Scan(); err == nil {\n    for _, bss := range bssList {\n        print(bss.SSID, bss.Signal, bss.KeyMgmt)\n    }\n}\n</code></pre>\n\n<p>Package released under a MIT license.</p>\n"}], "owner": {"reputation": 109, "user_id": 19916, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fb04e749efad591da53d2ef1ff8815c4?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Berner", "link": "https://stackoverflow.com/users/19916/mark-berner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1268, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1535918251, "creation_date": 1535912825, "last_edit_date": 1535918251, "question_id": 52139925, "link": "https://stackoverflow.com/questions/52139925/golang-api-to-wpa-supplicant", "title": "Golang API to WPA Supplicant", "body": "<p>I need connect headless IoT device (Raspberry Pi) to Wi-Fi Network. I have custom Linux built using YoctoProject. I don't have <strong>connman</strong> or <strong>Network Manager</strong> installed. There is only WPA Supplicant.\nMy services are written in Golang. </p>\n\n<p>Call <strong>wpa_cli</strong> is too tricky and not reliable. \nTrying few available packages, I have decided to write my own.\nSee below in answer. </p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1535898016, "post_id": 52137847, "comment_id": 91225343, "body": "Where does the number 5973974 come from? Is it someone\u2019s phone number?"}, {"owner": {"reputation": 127, "user_id": 7773959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f56a0e8721b91e43faa42e2f0d169143?s=128&d=identicon&r=PG&f=1", "display_name": "Max Mikhalchuk", "link": "https://stackoverflow.com/users/7773959/max-mikhalchuk"}, "reply_to_user": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1535898131, "post_id": 52137847, "comment_id": 91225367, "body": "@DietrichEpp  It&#39;s just the quantity of the <code>xml</code> document in the file."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1535898478, "post_id": 52137847, "comment_id": 91225473, "body": "Please post an example of xml you are using it will help us to check if the data is unmarshalled or not."}, {"owner": {"reputation": 127, "user_id": 7773959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f56a0e8721b91e43faa42e2f0d169143?s=128&d=identicon&r=PG&f=1", "display_name": "Max Mikhalchuk", "link": "https://stackoverflow.com/users/7773959/max-mikhalchuk"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1535899464, "post_id": 52137847, "comment_id": 91225732, "body": "@Himanshu Just added the example of xml file. Now when I run the program with the small example of  xml file I can see error <code>fatal error: all goroutines are asleep - deadlock!</code>"}], "answers": [{"tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": 0, "last_activity_date": 1535911389, "last_edit_date": 1535911389, "creation_date": 1535908708, "answer_id": 52139361, "question_id": 52137847, "link": "https://stackoverflow.com/questions/52137847/doesnt-receive-a-message-from-a-channel/52139361#52139361", "title": "Doesn&#39;t receive a message from a channel", "body": "<p>I don't know if this will help you, but your condition, <code>if p2Rc[2]==114</code> is never satisfied, then you go ahead and start listening to a channel. Which never receives an input. Also, there are better ways of listening to channels, <code>select</code> for instance, here is an example <a href=\"https://tour.golang.org/concurrency/5\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/5</a>. </p>\n\n<p>I think the main question here is what is this(code) meant to do? and where does the above said condition fall into that process?. If that is clear, I can update with a better response.</p>\n"}, {"comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1535952213, "post_id": 52140243, "comment_id": 91236860, "body": "I think you meant to add <code>defer wg.Done()</code> in <code>&#47;&#47;Element reader</code>, other than that great reply, thanks!"}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 3, "last_activity_date": 1535956193, "last_edit_date": 1535956193, "creation_date": 1535915322, "answer_id": 52140243, "question_id": 52137847, "link": "https://stackoverflow.com/questions/52137847/doesnt-receive-a-message-from-a-channel/52140243#52140243", "title": "Doesn&#39;t receive a message from a channel", "body": "<p>First, let's get this out of the way: you can't parse XML line by line. You're lucky that your file happens to be one tag per line, but that can't be taken for granted. You <em>must</em> parse the whole XML document.</p>\n\n<p>By processing line by line you're trying to shove <code>&lt;tag&gt;</code> and <code>&lt;member&gt;</code> into a struct designed for <code>&lt;relation&gt;</code>. Instead, use <a href=\"https://golang.org/pkg/encoding/xml/#NewDecoder\" rel=\"nofollow noreferrer\"><code>xml.NewDecoder</code></a> and let that process the file for you.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"os\"\n    \"log\"\n)\n\ntype Osm struct {\n    XMLName     xml.Name    `xml:\"osm\"`\n    Relations   []Relation  `xml:\"relation\"`\n}\ntype Relation struct {\n    XMLName     xml.Name    `xml:\"relation\"`\n    ID          string      `xml:\"id,attr\"`\n    User        string      `xml:\"user,attr\"`\n    Uid         string      `xml:\"uid,attr\"`\n    Members     []Member    `xml:\"member\"`\n    Tags        []Tag       `xml:\"tag\"`\n}\ntype Member struct {\n    XMLName     xml.Name    `xml:\"member\"`\n    Ref         string      `xml:\"ref,attr\"`\n    Type        string      `xml:\"type,attr\"`\n    Role        string      `xml:\"role,attr\"`\n}\ntype Tag struct {\n    XMLName     xml.Name    `xml:\"tag\"`\n    Key         string      `xml:\"k,attr\"`\n    Value       string      `xml:\"v,attr\"`\n}\n\nfunc main() {\n    reader, err := os.Open(\"test.xml\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer reader.Close()\n\n    decoder := xml.NewDecoder(reader)\n\n    osm := &amp;Osm{}\n    err = decoder.Decode(&amp;osm)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(osm)\n}\n</code></pre>\n\n<p><code>Osm</code> and the other structs are analogous to the XML schema you expect. <code>decoder.Decode(&amp;osm)</code> applies that schema.</p>\n\n<p>If you just want to extract part of the XML, <a href=\"https://stackoverflow.com/questions/27527561/golang-how-to-extract-part-of-an-xml-file-as-a-string\">see the answers to <em>How to extract part of an XML file as a string?</em></a>.</p>\n\n<p>The rest of the answer will cover just the use of channels and goroutines. The XML part will be dropped.</p>\n\n<hr>\n\n<p>If you add a few debugging statements you find that <code>parseRelation</code> is never called which means the <code>channel</code> is empty and <code>fmt.Println(&lt;- channel)</code> sits around waiting for an empty channel which is never closed. So once you're done processing, close the channel.</p>\n\n<pre><code>  for {\n    p2Rc, err := reader.ReadSlice('\\n')\n\n    ...\n  }\n  close(channel)\n</code></pre>\n\n<p>Now we get <code>{ [] []}</code> 5973974 times.</p>\n\n<pre><code>for i := 0; i &lt; 5973974; i++ {\n  fmt.Println(&lt;- channel)\n}\n</code></pre>\n\n<p>That's trying to read from the channel 5973974 times. That defeats the point of channels. Instead, <a href=\"https://gobyexample.com/range-over-channels\" rel=\"nofollow noreferrer\">read from the channel using <code>range</code></a>.</p>\n\n<pre><code>for thing := range channel {\n    fmt.Println(thing)\n}\n</code></pre>\n\n<p>Now at least it finishes!</p>\n\n<p>But there's a new problem. If it actually finds a thing, like if you change <code>if p2Rc[2] == 114 {</code> to <code>if p2Rc[2] == 32 {</code>, you'll get a <code>panic: send on closed channel</code>. This is because <code>parseRelation</code> is running in parallel to the reader and might try to write after the main reading code is finished and has closed the channel. You have to make sure everyone using the channel is done before closing it.</p>\n\n<p>To fix this requires a fairly major redesign.</p>\n\n<hr>\n\n<p>Here's an example of a simple program that reads lines from a file, puts them into a channel, and has a worker read from that channel.</p>\n\n<pre><code>func main() {\n    reader, err := os.Open(\"test.xml\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer reader.Close()\n\n    // Use the simpler bufio.Scanner\n    scanner := bufio.NewScanner(reader)\n\n    // A buffered channel for input\n    lines := make(chan string, 10)\n\n    // Work on the lines\n    go func() {\n        for line := range lines {\n            fmt.Println(line)\n        }\n    }()\n\n    // Read lines into the channel\n    for scanner.Scan() {\n        lines &lt;- scanner.Text()\n    }\n    if err := scanner.Err(); err != nil {\n        log.Fatal(err)\n    }\n\n    // When main exits, channels gracefully close.\n}\n</code></pre>\n\n<p>This works fine because <code>main</code> is special and cleans up channels when it exits. But what if the reader and writer were both goroutines?</p>\n\n<pre><code>// A buffered channel for input\nlines := make(chan string, 10)\n\n// Work on the lines\ngo func() {\n    for line := range lines {\n        fmt.Println(line)\n    }\n}()\n\n// Read lines into the channel\ngo func() {\n    for scanner.Scan() {\n        lines &lt;- scanner.Text()\n    }\n    if err := scanner.Err(); err != nil {\n        log.Fatal(err)\n    }\n}()\n</code></pre>\n\n<p>Empty. <code>main</code> exits and shuts down the channel before the goroutines can do their job. We need a way to let <code>main</code> know to wait until processing is finished. There's a couple ways to do this. One is with <a href=\"https://gobyexample.com/channel-synchronization\" rel=\"nofollow noreferrer\">another channel to synchronize processing</a>.</p>\n\n<pre><code>// A buffered channel for input\nlines := make(chan string, 10)\n\n// A channel for main to wait for\ndone := make(chan bool, 1)\n\n// Work on the lines\ngo func() {\n    for line := range lines {\n        fmt.Println(line)\n    }\n\n    // Indicate the worker is done\n    done &lt;- true\n}()\n\n// Read lines into the channel\ngo func() {\n    // Explicitly close `lines` when we're done so the workers can finish\n    defer close(lines)\n\n    for scanner.Scan() {\n        lines &lt;- scanner.Text()\n    }\n    if err := scanner.Err(); err != nil {\n        log.Fatal(err)\n    }\n}()\n\n// main will wait until there's something to read from `done`\n&lt;-done\n</code></pre>\n\n<p>Now <code>main</code> will fire off the reader and worker goroutines and buffer waiting for something on <code>done</code>. The reader will fill <code>lines</code> until its done reading and then close it. In parallel the worker will read from <code>lines</code> and write to <code>done</code> once its done reading.</p>\n\n<p>The other option is to use <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">sync.WaitGroup</a>.</p>\n\n<pre><code>// A buffered channel for input\nlines := make(chan string, 10)\n\nvar wg sync.WaitGroup\n\n// Note that there is one more thing to wait for\nwg.Add(1)\ngo func() {\n    // Tell the WaitGroup we're done\n    defer wg.Done()\n\n    for line := range lines {\n        fmt.Println(line)\n    }\n}()\n\n// Read lines into the channel\ngo func() {\n    defer close(lines)\n\n    for scanner.Scan() {\n        lines &lt;- scanner.Text()\n    }\n    if err := scanner.Err(); err != nil {\n        log.Fatal(err)\n    }\n}()\n\n// Wait until everything in the WaitGroup is done\nwg.Wait()\n</code></pre>\n\n<p>As before, <code>main</code> launches the reader and worker goroutines, but now it adds 1 to a WaitGroup just before launching the worker. Then it waits until <code>wg.Wait()</code> returns. The reader works the same as before, closing the <code>lines</code> channel when its finished. The worker now calls <code>wg.Done()</code> when its finished decrementing the WaitGroup's count and allowing <code>wg.Wait()</code> to return.</p>\n\n<p>Each technique has advantages and disadvantages. <code>done</code> is more flexible, it chains better, and can be safer if you can wrap your head around it. WaitGroups are simpler and easier to wrap your head around, but require that every goroutine share a variable.</p>\n\n<hr>\n\n<p>If we wanted to add to this chain of processing, we can do so. Say we have a goroutine that reads the lines, one that processes them in XML elements, and one that does something with the elements.</p>\n\n<pre><code>// A buffered channel for input\nlines := make(chan []byte, 10)\nelements := make(chan *RS)\n\nvar wg sync.WaitGroup\n\n// Worker goroutine, turn lines into RS structs\nwg.Add(1)\ngo func() {\n    defer wg.Done()\n    defer close(elements)\n\n    for line := range lines {\n        if line[2] == 32 {\n            fmt.Println(\"Begin\")\n            fmt.Println(string(line))\n            fmt.Println(\"End\")\n\n            rs := &amp;RS{}\n            xml.Unmarshal(line, &amp;rs)\n            elements &lt;- rs\n        }\n    }\n}()\n\n// File reader\ngo func() {\n    defer close(lines)\n\n    for scanner.Scan() {\n        lines &lt;- scanner.Bytes()\n    }\n    if err := scanner.Err(); err != nil {\n        log.Fatal(err)\n    }\n}()\n\n// Element reader\nwg.Add(1)\ngo func() {\n    defer wg.Done()\n\n    for element := range elements {\n        fmt.Println(element)\n    }\n}()\n\nwg.Wait()\n</code></pre>\n\n<p>This produces empty structs because you're trying to shove individual lines of XML into a struct representing the complete <code>&lt;relationship&gt;</code> tag. But it demonstrates how you can add more workers to the chain.</p>\n"}], "owner": {"reputation": 127, "user_id": 7773959, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f56a0e8721b91e43faa42e2f0d169143?s=128&d=identicon&r=PG&f=1", "display_name": "Max Mikhalchuk", "link": "https://stackoverflow.com/users/7773959/max-mikhalchuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 613, "favorite_count": 0, "accepted_answer_id": 52140243, "answer_count": 2, "score": 0, "last_activity_date": 1535956193, "creation_date": 1535897814, "last_edit_date": 1535918045, "question_id": 52137847, "link": "https://stackoverflow.com/questions/52137847/doesnt-receive-a-message-from-a-channel", "title": "Doesn&#39;t receive a message from a channel", "body": "<h2>Edit:</h2>\n\n<p>After I added a small part of file I was using (7 GB) and tried to run the program, I could see this:</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan receive]:\nmain.main()\n    /media/developer/golang/manual/examples/sp/v2/sp.v2.go:71 +0x4a9\nexit status 2\n</code></pre>\n\n<h2>Situation:</h2>\n\n<p>I'm completely new to GO, so I'm sorry if my question is really simple.</p>\n\n<p>I am trying to stream <code>xml</code> file, split documents and then parse them in different GO Routines.</p>\n\n<p>Example of XML file I'm using:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;osm version=\"0.6\" generator=\"CGImap 0.0.2\"&gt;\n    &lt;relation id=\"56688\" user=\"kmvar\" uid=\"56190\" visible=\"true\" version=\"28\" changeset=\"6947637\" timestamp=\"2011-01-12T14:23:49Z\"&gt;\n        &lt;member type=\"node\" ref=\"294942404\" role=\"\"/&gt;\n        &lt;member type=\"node\" ref=\"364933006\" role=\"\"/&gt;\n        &lt;tag k=\"name\" v=\"K\u00fcstenbus Linie 123\"/&gt;\n        &lt;tag k=\"network\" v=\"VVW\"/&gt;\n        &lt;tag k=\"route\" v=\"bus\"/&gt;\n        &lt;tag k=\"type\" v=\"route\"/&gt;\n    &lt;/relation&gt;\n    &lt;relation id=\"98367\" user=\"jdifh\" uid=\"92834\" visible=\"true\" version=\"28\" changeset=\"6947637\" timestamp=\"2011-01-12T14:23:49Z\"&gt;\n        &lt;member type=\"node\" ref=\"294942404\" role=\"\"/&gt;\n        &lt;member type=\"way\" ref=\"4579143\" role=\"\"/&gt;\n        &lt;member type=\"node\" ref=\"249673494\" role=\"\"/&gt;\n        &lt;tag k=\"name\" v=\"K\u00fcstenbus Linie 123\"/&gt;\n        &lt;tag k=\"network\" v=\"VVW\"/&gt;\n        &lt;tag k=\"operator\" v=\"Regionalverkehr K\u00fcste\"/&gt;\n        &lt;tag k=\"ref\" v=\"123\"/&gt;\n    &lt;/relation&gt;\n    &lt;relation id=\"72947\" user=\"schsu\" uid=\"92374\" visible=\"true\" version=\"28\" changeset=\"6947637\" timestamp=\"2011-01-12T14:23:49Z\"&gt;\n        &lt;member type=\"node\" ref=\"294942404\" role=\"\"/&gt;\n        &lt;tag k=\"name\" v=\"K\u00fcstenbus Linie 123\"/&gt;\n        &lt;tag k=\"type\" v=\"route\"/&gt;\n    &lt;/relation&gt;\n    &lt;relation id=\"93742\" user=\"doiff\" uid=\"61731\" visible=\"true\" version=\"28\" changeset=\"6947637\" timestamp=\"2011-01-12T14:23:49Z\"&gt;\n        &lt;member type=\"node\" ref=\"294942404\" role=\"\"/&gt;\n        &lt;member type=\"node\" ref=\"364933006\" role=\"\"/&gt;\n        &lt;tag k=\"route\" v=\"bus\"/&gt;\n        &lt;tag k=\"type\" v=\"route\"/&gt;\n    &lt;/relation&gt;\n&lt;/osm&gt;\n</code></pre>\n\n<p>I have this snippet of code:</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/xml\"\n  \"bufio\"\n  \"fmt\"\n  \"os\"\n  \"io\"\n)\n\ntype RS struct {\n  I string `xml:\"id,attr\"`\n  M []struct {\n    I string `xml:\"ref,attr\"`\n    T string `xml:\"type,attr\"`\n    R string `xml:\"role,attr\"`\n  } `xml:\"member\"`\n  T []struct {\n    K string `xml:\"k,attr\"`\n    V string `xml:\"v,attr\"`\n  } `xml:\"tag\"`\n}\n\nfunc main() {\n  p1D, err := os.Open(\"/media/developer/Transcend/osm/xml/relations.xml\")\n\n  if err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n  }\n\n  defer p1D.Close()\n\n  reader := bufio.NewReader(p1D)\n\n  var count int32\n  var element string\n\n  channel := make(chan RS) // channel\n\n  for {\n    p2Rc, err := reader.ReadSlice('\\n')\n    if err != nil {\n      if err == io.EOF {\n        break\n      } else {\n        fmt.Println(err)\n        os.Exit(1)\n      }\n    }\n\n    var p2Rs = string(p2Rc)\n\n    if p2Rc[2] == 114 {\n      count++\n\n      if (count != 1) {\n        go parseRelation(element, channel)\n      }\n\n      element = \"\"\n      element += p2Rs\n    } else {\n      element += p2Rs\n    }\n  }\n\n  for i := 0; i &lt; 5973974; i++ {\n    fmt.Println(&lt;- channel)\n  }\n}\n\nfunc parseRelation(p1E string, channel chan RS) {\n  var rs RS\n  xml.Unmarshal([]byte(p1E), &amp;rs)\n\n  channel &lt;- rs\n}\n</code></pre>\n\n<p>It is supposed to print each struct, but I see nothing. The program just hangs.</p>\n\n<p>I tested streamer and splitter (just added <code>fmt.Println(rs)</code> in function <strong>parseRelation</strong> before sending message into the channel). I could see structs. So, the problems are in sending and receiving messages.</p>\n\n<h2>Problem:</h2>\n\n<p>I have no idea how to solve this issue. Tried changing the type of the messages in the channel (from <code>RS</code> to <code>string</code>) and sending just one string every time. But it also didn't help (I could see nothing)</p>\n"}, {"tags": ["go", "encoding", "redis"], "comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1535896880, "post_id": 52137651, "comment_id": 91225068, "body": "you can use  in <code>fmt.Printf(&quot;%v&quot;,res)</code> instead of <code>fmt.Println(res)</code>. It prints <code>bytes</code>."}, {"owner": {"reputation": 659, "user_id": 6845084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253b377ee6c971f363de927136d30117?s=128&d=identicon&r=PG", "display_name": "Palash Nigam", "link": "https://stackoverflow.com/users/6845084/palash-nigam"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1535899760, "post_id": 52137651, "comment_id": 91225818, "body": "No I want to store the data in a variable. How can I do that? @whitespace"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1535900731, "last_edit_date": 1535900731, "creation_date": 1535900081, "answer_id": 52138148, "question_id": 52137651, "link": "https://stackoverflow.com/questions/52137651/how-does-redis-cli-encode-the-string-values-returned-on-executing-a-get-on-hlls/52138148#52138148", "title": "How does redis-cli encode the string values returned on executing a GET on HLLs or bitmaps?", "body": "<p>The redis-cli and the Go program get the same result for GET on some key. The difference that you are observing is how the result value is formatted for output. </p>\n\n<p>The Go program in the question writes the data as is. </p>\n\n<p>The redis-cli code for encoding output is <a href=\"https://github.com/antirez/redis/blob/febe102bf6d94428779f3943aea5947893301912/src/sds.c#L870-L899\" rel=\"nofollow noreferrer\">here</a>. The function uses typical backslash escapes for newlines, quotes, etc and <code>\\x&lt;hex number&gt;</code> for other non-printable bytes.  </p>\n\n<p>Use the fmt package \"%q\" verb to output data in a similar format:</p>\n\n<pre><code>fmt.Printf(\"%q\\n\", res)\n</code></pre>\n\n<p>If you need the exact same format, then a translation of the internal Redis function to Go required.</p>\n"}], "owner": {"reputation": 659, "user_id": 6845084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253b377ee6c971f363de927136d30117?s=128&d=identicon&r=PG", "display_name": "Palash Nigam", "link": "https://stackoverflow.com/users/6845084/palash-nigam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 969, "favorite_count": 0, "accepted_answer_id": 52138148, "answer_count": 1, "score": 1, "last_activity_date": 1535900731, "creation_date": 1535896145, "question_id": 52137651, "link": "https://stackoverflow.com/questions/52137651/how-does-redis-cli-encode-the-string-values-returned-on-executing-a-get-on-hlls", "title": "How does redis-cli encode the string values returned on executing a GET on HLLs or bitmaps?", "body": "<p>Suppose I have a bitmap that I have set using the following commands</p>\n\n<pre><code>setbit key 0 1\nsetbit key 1 1\nsetbit key 2 0\nsetbit key 3 1\nsetbit key 4 1\n</code></pre>\n\n<p>When I run get on this key from the redis-cli I get the following result: <code>\"\\xd8\"</code></p>\n\n<p>But when I do it using a <a href=\"https://godoc.org/github.com/go-redis/redis\" rel=\"nofollow noreferrer\">go-redis API</a> I get a different result which is this: \ufffd @</p>\n\n<p>To get the above result I have used the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/go-redis/redis\"\n)\n\nfunc main() {\n    client := redis.NewClient(&amp;redis.Options{\n        Addr:     \"localhost:6379\",\n        Password: \"\",\n        DB:       0,\n    })\n\n    pong, _ := client.Ping().Result()\n    fmt.Println(pong)\n\n    client.SetBit(\"key\", 0, 1)\n    client.SetBit(\"key\", 1, 1)\n    client.SetBit(\"key\", 2, 0)\n    client.SetBit(\"key\", 3, 1)\n    client.SetBit(\"key\", 4, 1)  \n\n    res := client.Get(\"bmk\").Val()\n    fmt.Println(res)\n\n}\n</code></pre>\n\n<p>I cannot find it anywhere in the redis docs which kind of encoding the cli uses to produce such results. I would like to convert the results to the same format in my go program as well.</p>\n\n<p>Can someone please tell me what kind of encoding this is and how can I convert the result received from the Redis API to the one obtained by the CLI ?</p>\n"}, {"tags": ["go", "windows-xp"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 6, "creation_date": 1535894168, "post_id": 52137098, "comment_id": 91224387, "body": "Dropping support generally doesn&#39;t mean that a thing is guaranteed not to work--but rather that it&#39;s not guaranteed to work. No doubt, certain features of Go 1.11 and/or the standard library will fail on Windows XP. As long as you don&#39;t use those features, there&#39;s a reasonable chance your software will work just fine."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535895002, "post_id": 52137098, "comment_id": 91224615, "body": "I don&#39;t know why someone downvoted (it wasn&#39;t me). But asking people to explain their downvotes really isn&#39;t appropriate. They&#39;re anonymous for a reason."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1535897657, "post_id": 52137098, "comment_id": 91225250, "body": "@Marged, I&#39;d say your question is simply <a href=\"https://stackoverflow.com/help/on-topic\">not on-topic for SO</a> and that&#39;s why it gets downvoted. I, personally, find this question both interesting and supposedly useful to some folks (because I think I was in your boots, that is to say) but this does not change the fact it&#39;s off-topic. You would have been better off posting it to the mailing list instead."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1535902180, "post_id": 52137098, "comment_id": 91226503, "body": "@kostix: If it&#39;s off-topic, it should get VtCed, not DVed. At present, there are no close votes at all. So the off-topic theory doesn&#39;t seem to be very substantiated. Personally, I think the question is perfectly on-topic, and also not worthy of a downvote. The only reason I didn&#39;t up-vote is that the answer seems rather self-evident, so not especially interesting."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1535922372, "post_id": 52137098, "comment_id": 91231770, "body": "A quick search of the source revealed a couple of (minor) features that were on hold because of the need to support XP. You&#39;ll probably be fine if you never run across them. But of course, if you still have an XP machine, you need to take it out back and shoot it."}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1535922663, "post_id": 52137098, "comment_id": 91231828, "body": "@MichaelHampton Thanks you, is there a specific text I could search for in order to find the features you mentioned ?"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1535922677, "post_id": 52137098, "comment_id": 91231834, "body": "I searched github.com/golang/go for &quot;Windows XP&quot;."}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1535922730, "post_id": 52137098, "comment_id": 91231847, "body": "@MichaelHampton OK, that sounds feasible ;-)"}], "answers": [{"comments": [{"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1535896781, "post_id": 52137703, "comment_id": 91225046, "body": "Thanks a lot, this is really helpful. It would be interesting to know when/if it is planned to add Windows 7 only API calls or even &quot;worse&quot; to have the compiler produce binaries that are marked as Windows 7 only (in the PE header or alike). As long as I can create a binary I can test it in my dead platform and hope for the best ;-)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1535896894, "post_id": 52137703, "comment_id": 91225071, "body": "@Marged, that&#39;s not really a question for SO. Please post a message to <a href=\"https://groups.google.com/forum/#!forum/golang-nuts\" rel=\"nofollow noreferrer\">the mailing list</a>."}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1535897001, "post_id": 52137703, "comment_id": 91225113, "body": "Thanks again, I will do so. I didn&#39;t find the relevant issue but with your help I was able to"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 1, "creation_date": 1535897342, "post_id": 52137703, "comment_id": 91225190, "body": "@Marged, one last note you might find useful. I somewhat share you pain as I had to support some stuff working on XP at my ex-$dayjob for up to 2016 (and they still have it lingering in parts of the infrastructure). And from my experiece, the way you usually do this is to &quot;get frozen&quot; along with the platform. For instance, we still had copies of Delphi 7 to do occasional bugfixing of some oldish piece of software. D7 was as unmaintained as XP, even <i>more</i> unmaintained, I&#39;d say."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 1, "creation_date": 1535897411, "post_id": 52137703, "comment_id": 91225202, "body": "@Marged,  I mean, after Go really seizes working on XP you still may clutch on the last version which did; fixing 3rd-party packages to work with that Go version may be easier than trying to get a fresh Go version to build. And as to security issues, you have them anyway with your platform so\u2026 oh, well ;-)"}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1535898278, "post_id": 52137703, "comment_id": 91225418, "body": "I know the situation, I still have djgpp in my toolbox when I need to update software on MS-DOS ;-)"}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1589753422, "post_id": 52137703, "comment_id": 109412000, "body": "I guess now is the time: I built a program with golang 1.14.2 and when I run it on Windows XP I get \u2026&quot;is no valid win32 application&quot;"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1589791339, "post_id": 52137703, "comment_id": 109422817, "body": "@Marged, just to be sure: if you&#39;re cross-compiling on an <code>amd64</code> platform, are you sure you make Go build for <code>386</code>?"}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1589829384, "post_id": 52137703, "comment_id": 109443798, "body": "Yes and I checked it with a PE dumper"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 5, "last_activity_date": 1535899328, "last_edit_date": 1535899328, "creation_date": 1535896565, "answer_id": 52137703, "question_id": 52137098, "link": "https://stackoverflow.com/questions/52137098/go-after-1-10-and-support-of-windows-xp/52137703#52137703", "title": "Go after 1.10 and support of Windows XP", "body": "<p><a href=\"https://github.com/golang/go/issues/23380\" rel=\"nofollow noreferrer\">Issue #23380</a> is the relevant discussion.</p>\n\n<p>In short:</p>\n\n<blockquote>\n  <p>Note that even if 1.10 is the last version to support XP, you'd get bugfix backports until 1.11 is out, and security backports until 1.12 is out. That means until January 2019 &lt;\u2026></p>\n</blockquote>\n\n<hr>\n\n<p>As to supporting Windows XP, there are both technical and non-technical reasons.\nSupporting a platform requires:</p>\n\n<ul>\n<li><p>Someone who has access to it, and an incentive to work on it\n(either paid or unpaid).</p>\n\n<p>The most active Go-on-Windows developer, Alex Brainman,\nseems to have no interest in XP anymore.</p></li>\n<li><p>This platform must be supported on autobuilders which are part of the Go release / QA process.</p>\n\n<p>An autobuilder must be supported by someone.</p></li>\n<li><p>Bugs specific to a platform must be fixed and <em>tested.</em></p>\n\n<p>For instance, that issue refers to <a href=\"https://github.com/golang/go/issues/23375\" rel=\"nofollow noreferrer\">#23375</a> which happens only on Windows XP (SP3).\nBut even if a bug was specific to Windows in general\u2014as opposed\nto Windows XP, a fix for it would have to be tested on XP anyway.</p></li>\n</ul>\n\n<p>Hence, unfortunately, if there is no interest in supported Go on Windows XP coming from some \"powerful entities\"\u2014such as corporations\u2014the best you can do is to actually work towards still supporting this by yourself, FWIW.</p>\n\n<hr>\n\n<p>Also note that even after the support is officially ended, you still might have success building newer Go releases  from the source (which is reasonably simple since Go 1.5 as Go is now built using (an older release of) Go).</p>\n\n<p>Hence a real show-stopper would be the Go team hitting some roadblock which would just <em>require</em> some kernel feature not present in Windows XP.\nA good example was <a href=\"https://groups.google.com/d/topic/golang-nuts/n2QQUxdltd0/discussion\" rel=\"nofollow noreferrer\">some difficulty with SEH handling on Windows 2000</a> which eventually led to dropping support for that OS.</p>\n"}], "owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3318, "favorite_count": 1, "accepted_answer_id": 52137703, "answer_count": 1, "score": 5, "last_activity_date": 1535923157, "creation_date": 1535891829, "last_edit_date": 1535923157, "question_id": 52137098, "link": "https://stackoverflow.com/questions/52137098/go-after-1-10-and-support-of-windows-xp", "title": "Go after 1.10 and support of Windows XP", "body": "<p>First of all: I know that Windows XP is end of life, insanely insecure, a big risk and that everyone still using it will be doomed for ever.\nNonetheless I have to provide an application that can also run on Windows XP and I do so using Go.\nIn 1.10 it was announced that XP will no longer be supported and 1.11 confirms this in the <a href=\"https://golang.org/doc/go1.11\" rel=\"noreferrer\">release notes</a>: </p>\n\n<blockquote>\n  <p>As announced in the Go 1.10 release notes, Go 1.11 now requires\n  OpenBSD 6.2 or later, macOS 10.10 Yosemite or later, or Windows 7 or\n  later; support for previous versions of these operating systems has\n  been removed.</p>\n</blockquote>\n\n<p>I compiled my application with 1.11 and tried to execute it on a Windows XP SP3 virtual machine. It could be executed successfully !\nThen I thought that the revoked support for Windows XP only applies to the development toolchain but even that can still be executed on Windows XP:\n<a href=\"https://i.stack.imgur.com/nmdCT.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/nmdCT.png\" alt=\"enter image description here\"></a></p>\n\n<p>As you can see the main go binary still runs on XP too. Is it already known when it will no longer be possible to run golang compiled exes on Windows XP because of technical limitations  or if certain methods will fail because they can no longer work because of missing APIs on XP ? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1535894309, "post_id": 52137089, "comment_id": 91224421, "body": "&quot;the application seems to crash in a very peculiar way&quot; -- What way? Show your error/stack trace, please."}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 3, "creation_date": 1535894806, "post_id": 52137089, "comment_id": 91224559, "body": "the application is not waiting for a response after calling <code>ValidateIp</code>, Your <code>httpClient</code>, waits 2 seconds for response, during this time, your main thread completes execution and exits."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1535895076, "post_id": 52137089, "comment_id": 91224635, "body": "I assume that there is no crash. The application just exits. That&#39;s to be expected, since you are not waiting for the goroutines to finish. main just returns, terminating the program. Aside from that, you should disable keep-alive in the HTTP client, and  pointers to channels are, erm, pointless (just use <code>chan string</code>)."}, {"owner": {"reputation": 1274, "user_id": 2229234, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d6f057a3d61e8aba4e42a7d86550b5b8?s=128&d=identicon&r=PG", "display_name": "Kamil Janowski", "link": "https://stackoverflow.com/users/2229234/kamil-janowski"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535900268, "post_id": 52137089, "comment_id": 91225972, "body": "@Flimzy if you read the whole thread, you would know it. There is no stack trace. The routine just never ends"}, {"owner": {"reputation": 1274, "user_id": 2229234, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d6f057a3d61e8aba4e42a7d86550b5b8?s=128&d=identicon&r=PG", "display_name": "Kamil Janowski", "link": "https://stackoverflow.com/users/2229234/kamil-janowski"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 1, "creation_date": 1535900271, "post_id": 52137089, "comment_id": 91225976, "body": "@whitespace unfortunately this is not the case at the moment. Obviously this will happen, but for the time being the main thread takes many hours to finish. Only the itaration through such a large number of IPs takes a lot of time. I haven&#39;t seen the application actually end yet and yet I have seen the application not hitting the break point when executed in a separate routine"}, {"owner": {"reputation": 1274, "user_id": 2229234, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d6f057a3d61e8aba4e42a7d86550b5b8?s=128&d=identicon&r=PG", "display_name": "Kamil Janowski", "link": "https://stackoverflow.com/users/2229234/kamil-janowski"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1535900304, "post_id": 52137089, "comment_id": 91225988, "body": "@Peter no the application doesn&#39;t end. the main thread has enough work for the next few hours"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1535901331, "post_id": 52137089, "comment_id": 91226285, "body": "@KamilJanowski It sounds like the program is blocked. To find where it&#39;s blocked, dump the goroutine stack traces by sending the process a SIGQUIT."}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1535966873, "post_id": 52137089, "comment_id": 91243383, "body": "You should add various logging lines to your code to track down how your code is run. There is no point guessing blindly what went wrong. I guess your fan-out is blocked somewhere so it is not actually fanning out the works."}, {"owner": {"reputation": 1274, "user_id": 2229234, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d6f057a3d61e8aba4e42a7d86550b5b8?s=128&d=identicon&r=PG", "display_name": "Kamil Janowski", "link": "https://stackoverflow.com/users/2229234/kamil-janowski"}, "edited": false, "score": 0, "creation_date": 1535983961, "post_id": 52137089, "comment_id": 91253039, "body": "I know what line gets stuck and I described it, but I cannot debug the internal go libraries to figure out what got stuck over there"}], "owner": {"reputation": 1274, "user_id": 2229234, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d6f057a3d61e8aba4e42a7d86550b5b8?s=128&d=identicon&r=PG", "display_name": "Kamil Janowski", "link": "https://stackoverflow.com/users/2229234/kamil-janowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1535891743, "creation_date": 1535891743, "question_id": 52137089, "link": "https://stackoverflow.com/questions/52137089/http-request-fails-when-executed-asynchronously", "title": "HTTP request fails when executed asynchronously", "body": "<p>I'm trying to write a tiny application in Go that can send an HTTP request to all IP addresses in hopes to find a specific content. The issue is that the application seems to crash in a very peculiar way when the call is executed asynchronously.</p>\n\n<p>ip/validator.go</p>\n\n<pre><code>package ip\n\nimport (\n    \"io/ioutil\"\n    \"net/http\"\n    \"regexp\"\n    \"time\"\n)\n\ntype ipValidator struct {\n    httpClient http.Client\n    path       string\n    exp        *regexp.Regexp\n    confirmationChannel *chan string\n}\n\nfunc (this *ipValidator) validateUrl(url string) bool {\n    response, err := this.httpClient.Get(url)\n    if err != nil {\n        return false\n    }\n    defer response.Body.Close()\n\n    if response.StatusCode != http.StatusOK {\n        return false\n    }\n\n    bodyBytes, _ := ioutil.ReadAll(response.Body)\n\n    result := this.exp.Match(bodyBytes)\n\n    if result &amp;&amp; this.confirmationChannel != nil {\n        *this.confirmationChannel &lt;- url\n    }\n    return result\n}\n\nfunc (this *ipValidator) ValidateIp(addr ip) bool {\n    httpResult := this.validateUrl(\"http://\" + addr.ToString() + this.path)\n    httpsResult := this.validateUrl(\"https://\" + addr.ToString() + this.path)\n\n    return httpResult || httpsResult\n}\n\nfunc (this *ipValidator) GetSuccessChannel() *chan string {\n    return this.confirmationChannel\n}\n\nfunc NewIpValidadtor(path string, exp *regexp.Regexp) ipValidator {\n    return newValidator(path, exp, nil)\n}\n\nfunc NewAsyncIpValidator(path string, exp *regexp.Regexp) ipValidator {\n    c := make(chan string)\n    return newValidator(path, exp, &amp;c)\n}\n\nfunc newValidator(path string, exp *regexp.Regexp, c *chan string) ipValidator {\n    httpClient := http.Client{\n        Timeout: time.Second * 2,\n    }\n    return ipValidator{httpClient, path, exp, c}\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"./ip\"\n    \"fmt\"\n    \"os\"\n    \"regexp\"\n)\n\nfunc processOutput(c *chan string) {\n    for true {\n        url := &lt;- *c\n        fmt.Println(url)\n    }\n}\n\nfunc main() {\n    args := os.Args[1:]\n    fmt.Printf(\"path: %s regex: %s\", args[0], args[1])\n\n    regexp, regexpError := regexp.Compile(args[1])\n    if regexpError != nil {\n        fmt.Println(\"The provided regexp is not valid\")\n        return\n    }\n    currentIp, _ := ip.NewIp(\"172.217.22.174\")\n    validator := ip.NewAsyncIpValidator(args[0], regexp)\n    successChannel := validator.GetSuccessChannel()\n\n    go processOutput(successChannel)\n\n    for currentIp.HasMore() {\n        go validator.ValidateIp(currentIp)\n        currentIp = currentIp.Increment()\n    }\n}\n</code></pre>\n\n<p>Note the line that says <code>go validator.ValidateIp(currentIp)</code> in main.go. Should I remove the word \"go\" to execute everything within the main routine, the code works as expected -> it sends requests to IP addresses starting 172.217.22.174 and should one of them return a legitimate result that matches the regexp that the ipValidator was initialized with, the URL is passed to the channel and the value is printed out by <code>processOutput</code> function from main.go. The issue is that simply adding <code>go</code> in front of <code>validator.ValidateIp(currentIp)</code> breaks that functionality. In fact, according to the debugger, I never seem to go past the line that says <code>response, err := this.httpClient.Get(url)</code> in validator.go.</p>\n\n<p>The struggle is real. Should I decide to scan the whole internet, there's 256^4 IP addresses to go through. It will take years, unless I find a way to split the process into multiple routines. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1535875366, "post_id": 52135054, "comment_id": 91220066, "body": "String literals are part of source code files, which are always UTF8."}, {"owner": {"reputation": 9712, "user_id": 66907, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f45da391d77044534895e4dd3770ffd2?s=128&d=identicon&r=PG", "display_name": "Sascha", "link": "https://stackoverflow.com/users/66907/sascha"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1535884475, "post_id": 52135054, "comment_id": 91221996, "body": "@zerkms you should post as an answer"}, {"owner": {"reputation": 18759, "user_id": 2226988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c6fbec3a71b2e95e4a6e41478deb379?s=128&d=identicon&r=PG", "display_name": "Tom Blodget", "link": "https://stackoverflow.com/users/2226988/tom-blodget"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1535941866, "post_id": 52135054, "comment_id": 91234886, "body": "@zerkms &quot;string literals always contain UTF-8 text&quot; means they are emitted by the compiler as string values with the text encoded with UTF-8. It has nothing to do with the encoding of the source files (which, yes, is UTF-8). The string literal could be &quot;\\u20ac&quot; and the compiler would interpret it and emit it with UTF-8. <code>len(&quot;\\u20ac&quot;)==3</code>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 18759, "user_id": 2226988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c6fbec3a71b2e95e4a6e41478deb379?s=128&d=identicon&r=PG", "display_name": "Tom Blodget", "link": "https://stackoverflow.com/users/2226988/tom-blodget"}, "edited": false, "score": 0, "creation_date": 1535942115, "post_id": 52135054, "comment_id": 91234937, "body": "@TomBlodget what UTF-8 would be emitted for <code>&quot;\\xf0&quot;</code> string literal, given <code>0xF0</code> is not a valid UTF-8 sequence? I see that the first and the only byte there is <code>240</code> <a href=\"https://play.golang.org/p/7f9gKHpLlRw\" rel=\"nofollow noreferrer\">play.golang.org/p/7f9gKHpLlRw</a>. How does it comply with what you said &quot;as string values with the text encoded with UTF-8&quot;?"}, {"owner": {"reputation": 18759, "user_id": 2226988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c6fbec3a71b2e95e4a6e41478deb379?s=128&d=identicon&r=PG", "display_name": "Tom Blodget", "link": "https://stackoverflow.com/users/2226988/tom-blodget"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1535942296, "post_id": 52135054, "comment_id": 91234964, "body": "@zerkms You have to take in the whole description from the Go documentation, as quoted in the question."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 18759, "user_id": 2226988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c6fbec3a71b2e95e4a6e41478deb379?s=128&d=identicon&r=PG", "display_name": "Tom Blodget", "link": "https://stackoverflow.com/users/2226988/tom-blodget"}, "edited": false, "score": 0, "creation_date": 1535942878, "post_id": 52135054, "comment_id": 91235074, "body": "@TomBlodget yes, now I see where I was wrong, thank you."}], "answers": [{"tags": [], "owner": {"reputation": 169, "user_id": 8948146, "user_type": "registered", "profile_image": "https://graph.facebook.com/100007428336811/picture?type=large", "display_name": "Igor Skobelev", "link": "https://stackoverflow.com/users/8948146/igor-skobelev"}, "is_accepted": false, "score": -4, "last_activity_date": 1535878635, "creation_date": 1535878635, "answer_id": 52135428, "question_id": 52135054, "link": "https://stackoverflow.com/questions/52135054/difference-between-string-values-and-string-literals/52135428#52135428", "title": "Difference between string values and string literals", "body": "<p>In general, there is no difference between string value and literal. String literal is just one of ways to initialize new string variable (string as is).</p>\n"}, {"tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": false, "score": 7, "last_activity_date": 1579163791, "last_edit_date": 1579163791, "creation_date": 1535905493, "answer_id": 52138909, "question_id": 52135054, "link": "https://stackoverflow.com/questions/52135054/difference-between-string-values-and-string-literals/52138909#52138909", "title": "Difference between string values and string literals", "body": "<p>This distinction rests on the definitions in the <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">Go language specification</a> of a string <em>literal</em> and a string <em>value</em>:</p>\n\n<blockquote>\n  <p><strong>String literal</strong>: A string literal represents a <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">string constant</a> obtained from concatenating a sequence of characters.</p>\n  \n  <p><strong>String value</strong>: A string value is a (possibly empty) sequence of bytes.</p>\n</blockquote>\n\n<p>and the requirement that source code is represented in source files encoded as UTF-8 text:</p>\n\n<blockquote>\n  <p><strong>Source code representation</strong>: Source code is Unicode text encoded in UTF-8.</p>\n</blockquote>\n\n<p>Most crucially, note that a string literal is defined to be a constant, so its value is defined entirely at compile time.</p>\n\n<hr>\n\n<p>Consider the set of valid Go source files to be those files which adhere to the language spec. By definition, such source files must be encoded using valid UTF-8. As a string literal's value is known at compile time from the contents of the source files, we see by construction that any string literal must contain valid UTF-8 text.</p>\n\n<p>If we ignore byte-level escape sequences, we can see further that the compiled output of the string literal in the resulting binary must also contain valid UTF-8, as it is compiled from a UTF-8 value in the source file.</p>\n\n<hr>\n\n<h1>Sequences of bytes? A generalisation</h1>\n\n<p>However, string <strong>values</strong> are <a href=\"https://golang.org/ref/spec#String_types\" rel=\"nofollow noreferrer\">defined</a> to be sequences of bytes,<sup>1</sup> so there is no requirement that they themselves contain valid UTF-8. Such non-UTF-8 text may arise from values received by the program from inputs other than string literals defined at compile time, such as data received over sockets or local pipes, read from a file, or string literals which contain byte-level escape sequences.</p>\n\n<p><sup>1</sup><sub>As the blog post says, this sequence of bytes may be considered to be a byte slice (<code>[]byte</code>) for most purposes. However, this is not strictly correct as the underlying implementation does not use a slice; strings are immutable and do not require to separately track their capacity. Calling <code>cap(str)</code> where <code>str</code> is of type <code>string</code> <a href=\"https://play.golang.org/p/dl4om__0ZZO\" rel=\"nofollow noreferrer\">is an error</a>.</sub></p>\n\n<h1>Byte-level escape sequences</h1>\n\n<p>Byte-level escape sequences provide a mechanism for encoding non-UTF-8 values using a UTF-8 representation. Such sequences allow arbitrary bytes to be represented in a UTF-8 format to produce valid Go source files and satisfy the language spec.</p>\n\n<p>For example, the byte sequence <code>b2 bd</code> (where bytes are here represented as space-delimited two-digit hexadecimal numbers) is <a href=\"https://play.golang.org/p/mMzGgGcaWbA\" rel=\"nofollow noreferrer\">not valid UTF-8</a>. Attempting to decode this byte sequence using a UTF-8 decoder will produce an error:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var seq = \"\\xb2\\xbd\"\nfmt.Println(\"Is 'seq' valid UTF-8 text?\", utf8.Valid([]byte(seq)))\n</code></pre>\n\n\n\n<pre><code>$ go run ./main.go\nIs 'seq' valid UTF-8 text? false\n</code></pre>\n\n<p>Consequently, while such a byte sequence can be stored in a string in Go, it is not possible to express directly in a Go source file. Any source file which does so is invalid Go and the lexer will reject it (see below).</p>\n\n<p>A backslash-escape sequence provides a mechanism for decomposing this byte string into a valid UTF-8 representation which satisfies the toolchain. The interpreted Go string literal <code>\"\\xb2\\xbd\"</code> represents the string using a sequence of ASCII characters, which can be expressed in UTF-8. When compiled, this sequence is parsed to produce a string in the compiled output containing the byte sequence <code>b2 bd</code>.</p>\n\n<hr>\n\n<h1>Example</h1>\n\n<p>I'll provide a working example to demonstrate this more concretely. As we will be generating invalid source files, I cannot readily use the Go playground for this; I used the go toolchain on my machine. The toolchain is <code>go version go1.11 darwin/amd64</code>.</p>\n\n<p>Consider the following simple Go program where values may be specified for the string <code>myStr</code>. For convenience, we replace the whitespace (the byte sequence <code>20 20 20</code> after the string <code>my value:</code>) with the desired bytes. This allows us to easily find the compiled output when disassembling binaries later.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    myStr := \"my value:   \"\n    fmt.Println(myStr)\n}\n</code></pre>\n\n<p>I used a hex editor to insert the invalid UTF-8 byte sequence <code>b2 bd</code> into the final bytes of the whitespace in <code>myStr</code>. Representation below; other lines elided for brevity:</p>\n\n<pre><code>00000030: 203a 3d20 22b2 bd20 220a 0966 6d74 2e50   := \".. \"..fmt.P\n</code></pre>\n\n<p>Attempting to build this file results in the error:</p>\n\n<pre><code>$ go build ./test.go\n# command-line-arguments\n./test.go:6:12: invalid UTF-8 encoding\n</code></pre>\n\n<p>If we open the file in an editor, it interprets the bytes in its own way (likely to be platform-specific) and, on save, emits valid UTF-8. On this OS X-based system, using <code>vim</code>, the sequence is interpreted as Unicode U+00B2 U+00BD, or <code>\u00b2\u00bd</code>. This satisfies the compiler, but the source file and hence compiled binary now contains a different byte sequence than the one originally intended. The code dump below exhibits the sequence <code>c2 b2 c2 bd</code>, as does a hex dump of the source file. (See the final two bytes of line 1 and first two bytes of line 2.)</p>\n\n<pre><code>$ gobjdump -s -j __TEXT.__rodata test | grep -A1 \"my value\"                                                                                         \n 10c4c50 63746f72 796d7920 76616c75 653ac2b2  ctorymy value:..\n 10c4c60 c2bd206e 696c2065 6c656d20 74797065  .. nil elem type\n</code></pre>\n\n<p>To recover the original byte sequence, we can change the string definition thus:</p>\n\n<pre><code>myStr := \"my value: \\xb2\\xbd\"\n</code></pre>\n\n<p>Dumping the source file produced by the editor yields a valid UTF-8 sequence <code>5c 78 62 32 5c 78 62 64</code>, the UTF-8 encoding of the ASCII characters <code>\\xb2\\xbd</code>:</p>\n\n<pre><code>00000030: 203a 3d20 226d 7920 7661 6c75 653a 205c   := \"my value: \\\n00000040: 7862 325c 7862 6422 0a09 666d 742e 5072  xb2\\xbd\"..fmt.Pr\n</code></pre>\n\n<p>Yet the binary produced by building this source file demonstrates the compiler has transformed this string literal to contain the desired <code>b2 bd</code> sequence (final two bytes of the fourth column):</p>\n\n<pre><code>10c48b0 6d792076 616c7565 3a20b2bd 6e6f7420  my value: ..not\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 9269433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14d5a987bee009f9ddd2521fb7c98476?s=128&d=identicon&r=PG", "display_name": "user9269433", "link": "https://stackoverflow.com/users/9269433/user9269433"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 951, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1579163791, "creation_date": 1535875021, "question_id": 52135054, "link": "https://stackoverflow.com/questions/52135054/difference-between-string-values-and-string-literals", "title": "Difference between string values and string literals", "body": "<p>According to this golang blog post (<a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">https://blog.golang.org/strings</a>) on strings, there is a line that states \"...<strong>string values</strong> can contain arbitrary bytes; as we showed in this one, <strong>string literals</strong> always contain UTF-8 text as long as they have no byte-level escapes.\"</p>\n\n<p>What's the difference?</p>\n"}, {"tags": ["asynchronous", "go", "request"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 5, "creation_date": 1535870702, "post_id": 52134606, "comment_id": 91219290, "body": "Every incoming request is handled in its own goroutine already."}, {"owner": {"reputation": 20745, "user_id": 100240, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8b3c8e553b1eea4d6d8d52f94d25bd63?s=128&d=identicon&r=PG", "display_name": "Moon", "link": "https://stackoverflow.com/users/100240/moon"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1535870785, "post_id": 52134606, "comment_id": 91219300, "body": "@zerkms Thank you for the info. I was not able to confirm that on gin&#39;s documentation. That makes sense. I guess I don&#39;t have to worry about making a single http request async in that case."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1535870858, "post_id": 52134606, "comment_id": 91219308, "body": "It uses the standard go&#39;s <code>http</code> to handle requests <a href=\"https://github.com/gin-gonic/gin/blob/master/gin.go#L287\" rel=\"nofollow noreferrer\">github.com/gin-gonic/gin/blob/master/gin.go#L287</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1535870892, "post_id": 52134606, "comment_id": 91219314, "body": "Ignoring error handling and what not, the best approach is in the first snippet.  There&#39;s no need for non-blocking in this example."}, {"owner": {"reputation": 20745, "user_id": 100240, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8b3c8e553b1eea4d6d8d52f94d25bd63?s=128&d=identicon&r=PG", "display_name": "Moon", "link": "https://stackoverflow.com/users/100240/moon"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1535870947, "post_id": 52134606, "comment_id": 91219320, "body": "@ThunderCat Thank you!"}, {"owner": {"reputation": 704, "user_id": 4792552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a528513962a9c962ff32df92a1a350b?s=128&d=identicon&r=PG", "display_name": "Berkant Ipek", "link": "https://stackoverflow.com/users/4792552/berkant-ipek"}, "edited": false, "score": 1, "creation_date": 1535872875, "post_id": 52134606, "comment_id": 91219632, "body": "You can&#39;t make this happen if you want to return the response from tmp.com to client back. HTTP is synchronous protocol: the client issues a request and waits for a response."}, {"owner": {"reputation": 2400, "user_id": 6112685, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RAHsYhTeNC0/AAAAAAAAAAI/AAAAAAAAAsc/A5bLML9T638/photo.jpg?sz=128", "display_name": "Abhay", "link": "https://stackoverflow.com/users/6112685/abhay"}, "edited": false, "score": 0, "creation_date": 1535954813, "post_id": 52134606, "comment_id": 91237636, "body": "All requests are independent of each other. Unless you have external resources hold by any requests... Nothing there to blocks your request.."}], "answers": [{"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 0, "last_activity_date": 1535875794, "creation_date": 1535875794, "answer_id": 52135140, "question_id": 52134606, "link": "https://stackoverflow.com/questions/52134606/how-to-make-non-blocking-http-request-in-go-lang/52135140#52135140", "title": "How to make non-blocking http request in go lang?", "body": "<p>that cannot work, as commented, the http protocol is synchronous.</p>\n\n<p>In the op code the response is sent and written, by the underlying framework, before the parallel <code>makeRequest</code> function call finished its job.</p>\n\n<p>If the response is ever written to the client, the client must actively refuse it, as this is not a normal behavior for this protocol.</p>\n\n<p>What is unfortunate in OP code is that the <code>gin</code> package won t trigger an error if it tries to write on a closed response.</p>\n"}, {"tags": [], "owner": {"reputation": 141, "user_id": 157926, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/miq4s.jpg?s=128&g=1", "display_name": "derek kenney", "link": "https://stackoverflow.com/users/157926/derek-kenney"}, "is_accepted": false, "score": 1, "last_activity_date": 1536027841, "creation_date": 1536027841, "answer_id": 52157993, "question_id": 52134606, "link": "https://stackoverflow.com/questions/52134606/how-to-make-non-blocking-http-request-in-go-lang/52157993#52157993", "title": "How to make non-blocking http request in go lang?", "body": "<p>As answered already, each HTTP request is handled in it's own go routine. HTTP is a natural fit for the request/response pattern. If you really needed to communicate asynchronously over HTTP you could use a callback function. However I would suggest using event based messaging.</p>\n"}], "owner": {"reputation": 20745, "user_id": 100240, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8b3c8e553b1eea4d6d8d52f94d25bd63?s=128&d=identicon&r=PG", "display_name": "Moon", "link": "https://stackoverflow.com/users/100240/moon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7653, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1536027841, "creation_date": 1535870407, "question_id": 52134606, "link": "https://stackoverflow.com/questions/52134606/how-to-make-non-blocking-http-request-in-go-lang", "title": "How to make non-blocking http request in go lang?", "body": "<p>This is my 2nd day of learning go lang and I'm trying to figure out how to make non-blocking http request.</p>\n\n<p>I'm using gin framework and I have very simple code as below.</p>\n\n<pre><code>func main() {\n    r := gin.Default()\n\n    r.GET(\"test\", func(c *gin.Context){\n        request := gorequest.New()\n        _, body, _ := request.Get(\"http://tmp.com\").End()\n        c.JSON(200, body)\n    })\n\n    r.Run()\n}\n</code></pre>\n\n<p>tmp.com is a local server, which takes 0.5 second to response (I created it for testing)</p>\n\n<p>When I do a simple ab test on the go server with <code>wrk -t2 -c50 http://127.0.0.1:8080/test</code>, I get about 8 requests/sec.</p>\n\n<p>It looks like the request is getting blocked.</p>\n\n<p>I've tried to separate the request into a function then call it with \"go\" to use coroutine, but that simply returned nothing.</p>\n\n<p>My revised code is</p>\n\n<pre><code>func makeRequest(c *gin.Context) {\n    request := gorequest.New()\n    _, body, _ := request.Get(\"http://tmp.com\").End()\n    c.JSON(200, body)\n}\n\nfunc main() {\n    r := gin.Default()\n\n    r.GET(\"test\", func(c *gin.Context){\n        go makeRequest(c)\n    })\n\n    r.Run()\n}\n</code></pre>\n\n<p>Is there a simple way to make non-blocking request? or what's the best approach in this case?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "edited": false, "score": 1, "creation_date": 1535860628, "post_id": 52133823, "comment_id": 91218024, "body": "You can compose <code>B</code> in <code>A</code>. Then assign or copy <code>A.B</code> to the new <code>B</code> instance"}, {"owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "reply_to_user": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "edited": false, "score": 0, "creation_date": 1535862484, "post_id": 52133823, "comment_id": 91218218, "body": "@nos you&#39;re right, so this is the only way to solve the inherent?"}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1535864788, "post_id": 52133823, "comment_id": 91218466, "body": "There is polymorphism in go it&#39;s just not through inheritance.  Instead you have different structs implement the same interface.  This has some advantages as inheritance can be restrictive as you can either only have one supertype or have to solve the &quot;diamond problem&quot;"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535878530, "post_id": 52133823, "comment_id": 91220687, "body": "You cannot convert anything in Go to a &quot;base class&quot;, because there are no classes in Go."}], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 1, "last_activity_date": 1535862899, "creation_date": 1535862899, "answer_id": 52133993, "question_id": 52133823, "link": "https://stackoverflow.com/questions/52133823/convert-struct-to-base-class/52133993#52133993", "title": "Convert struct to base class", "body": "<p>You can do that with embedded fields.  See Struct Types in the <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">Go Language Specification</a>, e.g.:</p>\n\n<blockquote>\n  <p>Field names may be specified explicitly (IdentifierList) or implicitly (EmbeddedField).</p>\n</blockquote>\n\n<p>With an embedded field, you can copy the fields in one struct to the struct in which it is an embedded field with a simple assignment to the field.</p>\n\n<p>Here's a complete, runnable example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Shared struct {\n    Id   int\n    Name string\n}\n\ntype A struct {\n    Count int\n    Shared\n}\n\ntype B struct {\n    Color string\n    Shared\n}\n\nfunc main() {\n    shared := Shared{\n        Id:   1,\n        Name: \"john\",\n    }\n    a := A{\n        Count:  5,\n        Shared: shared,\n    }\n    b := B{\n        Color: \"green\",\n    }\n    b.Shared = a.Shared\n    c := map[string]interface{}{\n        `a`: a,\n        `b`: b,\n    }\n    msg, err := json.Marshal(c)\n    if err != nil {\n        fmt.Printf(\"Marshal error: %s\\n\", err)\n    }\n    fmt.Println(string(msg))\n}\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>{\"a\":{\"Count\":5,\"Id\":1,\"Name\":\"john\"},\"b\":{\"Color\":\"green\",\"Id\":1,\"Name\":\"john\"}}\n</code></pre>\n"}], "owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1535878494, "creation_date": 1535860312, "last_edit_date": 1535878494, "question_id": 52133823, "link": "https://stackoverflow.com/questions/52133823/convert-struct-to-base-class", "title": "Convert struct to base class", "body": "<p>In my understanding, there is no inherent and polymorphism in golang, so how to get the sub-struct from a given struct? For example, struct A has several attributes:</p>\n\n<pre><code>type A struct {\n    a int\n    b string\n    c *float64\n    d []byte\n    e map[string]interface{}\n}\n</code></pre>\n\n<p>I want to delete the <code>e</code>:</p>\n\n<pre><code>type B struct {\n    a int\n    b string\n    c *float64\n    d []byte\n}\n</code></pre>\n\n<p>So is there any way to convert A to B except copy variables one by one?</p>\n"}, {"tags": ["go", "go-reflect"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1535844009, "last_edit_date": 1535844009, "creation_date": 1535842733, "answer_id": 52132772, "question_id": 52132517, "link": "https://stackoverflow.com/questions/52132517/v-elem-vs-indirectv-when-passing-in-result-of-a-reflect-newtype/52132772#52132772", "title": "v.Elem() Vs Indirect(v) when passing in result of a reflect.New(Type)", "body": "<p>Let's break down the following line:</p>\n\n<pre><code>log.Println(reflect.ValueOf(newitem).Elem())\n</code></pre>\n\n<p>The value <code>newItem</code> is a reflect.Value.  The expression <code>reflect.ValueOf(newItem)</code> returns a <code>reflect.Value</code> containing a <code>reflect.Value</code>.  Because the contained value is not a pointer or interface, the call to <code>Elem()</code> panics.</p>\n\n<p>The following line does not panic because reflect.Indirect returns its argument if the argument is not a pointer type.</p>\n\n<pre><code> log.Println(reflect.Indirect(reflect.ValueOf(newitem))) \n</code></pre>\n\n<p>The problem is that the application is wrapping reflect.Values with reflect.Values. Use the reflect.Value directly as in the following code:</p>\n\n<pre><code>log.Println(reflect.Indirect(newitem))\nlog.Println(newitem.Elem())\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/sZAa6uW4Cup\" rel=\"noreferrer\">Run it on the Playground!</a></p>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 1, "accepted_answer_id": 52132772, "answer_count": 1, "score": 2, "last_activity_date": 1535878567, "creation_date": 1535839428, "last_edit_date": 1535878567, "question_id": 52132517, "link": "https://stackoverflow.com/questions/52132517/v-elem-vs-indirectv-when-passing-in-result-of-a-reflect-newtype", "title": "v.Elem() Vs Indirect(v) when passing in result of a reflect.New(Type)", "body": "<p>My question is related to this question here:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/24318389/golang-elem-vs-indirect-in-the-reflect-package\">golang - Elem Vs Indirect in the reflect package</a></p>\n\n<p>Basically it claims that the expression below is true if <code>someX</code> is a <code>reflect.Value</code> that contains a pointer</p>\n\n<pre><code>reflect.Indirect(reflect.ValueOf(someX)) === reflect.ValueOf(someX).Elem()\n</code></pre>\n\n<p>If that is the case, then why does my code below crash on the last line?</p>\n\n<pre><code>package main\n\nimport (\n  \"reflect\"\n  \"log\"\n)\n\ntype Person struct {\n  Name string\n\n}\n\nfunc main() {\n\n\nnewitem := reflect.New(reflect.ValueOf(Person{}).Type())\n\nlog.Println(reflect.TypeOf(newitem)) // shows reflect.Value\nlog.Println(newitem.Type().Kind()) // shows it is a ptr\n\nlog.Println(reflect.Indirect(reflect.ValueOf(newitem))) // this line does not cause panic\nlog.Println(reflect.ValueOf(newitem).Elem()) // this line causes panic\n\n}\n</code></pre>\n\n<p>I've been having a hard time understanding the reflect package in Go, and it is likely I've misunderstood some fundamental aspects of the Go language as denoted in stack overflow questions I've been asking the past week.</p>\n"}, {"tags": ["postgresql", "go", "interface", "abstraction"], "comments": [{"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 1, "creation_date": 1535860195, "post_id": 52132302, "comment_id": 91217968, "body": "If that&#39;s what you&#39;re looking for, accept that you&#39;ll be giving up performance for convenience, and either use an ORM package like <a href=\"http://gorm.io/\" rel=\"nofollow noreferrer\">GORM</a> or use a language other than Go.  I don&#39;t recommend trying to write your own ORM -- which sounds like the direction you&#39;re currently headed in -- as it&#39;s a notorious tempting quagmire, see e.g. <a href=\"https://martinfowler.com/bliki/OrmHate.html\" rel=\"nofollow noreferrer\">ORM Hate by Martin Fowler</a> (&quot;the Vietnam of computer science&quot;).  If you want performance and convenience look to code generation (or even just a powerful text editor and some elbow grease) instead."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "reply_to_user": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1535989303, "post_id": 52132302, "comment_id": 91255917, "body": "Maybe it&#39;s bloody minded purism, but I really don&#39;t want to solve my problem by adding an abstraction between me and the db. I&#39;m wary of using dependencies unless I have to (like a graphing library or some such), because it adds another black box where errors can occur that I have to debug. I&#39;m not convinced that the postgres drivers are not good enough yet, sorry :&lt;."}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1535999597, "post_id": 52132302, "comment_id": 91259704, "body": "I don&#39;t advocate GORM unless you&#39;re looking for really rapid development. My purism would prevent me from using a single write handler -- which you say you want to do -- reflection is too high a performance cost for me to accept in most applications, and added complexity as well which makes room for lots of bugs. So basically nothing but downside from my perspective. Instead I would just parse the DDL and generate query functions automatically: compile-time work rather than runtime work. But to each his own."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "reply_to_user": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1536001786, "post_id": 52132302, "comment_id": 91260431, "body": "Well, yeah idk. I&#39;m probably not going to use the reflect abstraction written below as I&#39;m worried about how to reason about the code later (DRY vs. &#39;how the heck did I do this 6 months ago&#39;). Shrug. Go needs generics."}], "answers": [{"comments": [{"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1535896348, "post_id": 52136020, "comment_id": 91224955, "body": "I&#39;d like to do a combination of 2) and 3) but I&#39;m not sure how. Can you be more specific?"}, {"owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "reply_to_user": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 1, "creation_date": 1535920543, "post_id": 52136020, "comment_id": 91231367, "body": "Sure. But could you add at least two different structs you plan in using? I can invent mine, of course, for the example, but I think that will be more efficient if I use something you plan to use later."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1535921561, "post_id": 52136020, "comment_id": 91231608, "body": "Oh hey thanks for getting back to me @alexey. Well my structs will all be single layer deep json calls with arrays of strings, ints, floats, or plain strings. Something like this <a href=\"https://hastebin.com/emejicasud.cpp\" rel=\"nofollow noreferrer\">hastebin.com/emejicasud.cpp</a>. Thanks for your help!"}, {"owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "reply_to_user": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1535996640, "post_id": 52136020, "comment_id": 91258717, "body": "I added a gist for you."}], "tags": [], "owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "is_accepted": true, "score": 2, "last_activity_date": 1535996585, "last_edit_date": 1535996585, "creation_date": 1535883470, "answer_id": 52136020, "question_id": 52132302, "link": "https://stackoverflow.com/questions/52132302/abstracting-psql-write-query/52136020#52136020", "title": "Abstracting PSQL Write Query", "body": "<p>The feature you're looking for is called generics.<br>\nGenerics are not supported by Go 1.x<br>\nLuckily for us, there's a <a href=\"https://go.googlesource.com/proposal/+/master/design/go2draft-contracts.md\" rel=\"nofollow noreferrer\">proposal for them for Go 2 (called Contracts)</a></p>\n\n<p>What can you do until then?</p>\n\n<ol>\n<li>Duplicate your code (probably what you're doing now)</li>\n<li><p>Use interfaces<br>\nIf you know that this method will always query by email, you could create simple interface for that purpose: <code>type Emailer interface { Email() string }</code></p></li>\n<li><p>Use empty interface (<code>interface{}</code>) and reflection to figure out what columns you have. </p></li>\n<li><p>Write your own generator. A bit like (1), but you don't have to do this yourself.</p></li>\n</ol>\n\n<p>Here's the gist of it:\n<a href=\"https://play.golang.org/p/A_2YKWLvmn-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/A_2YKWLvmn-</a></p>\n"}], "owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 52136020, "answer_count": 1, "score": 0, "last_activity_date": 1535996585, "creation_date": 1535837058, "last_edit_date": 1535878589, "question_id": 52132302, "link": "https://stackoverflow.com/questions/52132302/abstracting-psql-write-query", "title": "Abstracting PSQL Write Query", "body": "<p>I have a typical function that takes a post request from the frontend and decodes the data into a struct in order to put it into a psql database. You can see the code below. My problem is that I want to be able to abstract this function so that I can give it any amount of variables of any type so that for every request I don't have to have a separate write handler.</p>\n\n<p>It looks difficult because I would have to somehow pass in a way to abstract <code>var profitReq profitReq</code> to work for any struct. If golang had some sort of eval string method I would know how to do this, but someone correct me if I'm wrong, but I don't think that it does. </p>\n\n<p>The other place I need to change is in QueryRow - I have to be able to pass it in a variable number of variables. I could construct the string easily enough, but I'm not sure how to append variables to that QueryRow necessarily. If I append all the variables to an array for example, I can't pass that array into QueryRow as that's not how it's structured. Again, here some sort of eval statement would help. </p>\n\n<p>I'm new to golang, but I've seen a lot of cool things related to interfaces, which I admittedly don't understand very well. Would there be a way to use an interface here that would help?</p>\n\n<p>Thanks to anyone who can help!</p>\n\n<pre><code>func Write_profit_table(profitWriteChannel chan string, profitType string, req *http.Request) {\n    var profitReq profitReq;\n    err := json.NewDecoder(req.Body).Decode(&amp;profitReq);\n    if err!=nil{\n        log.Panic(err)\n    }\n\n    NotInDB, _ := Search_userinfo_table(profitReq.Email)\n\n    if NotInDB == false {\n        var lastInsertId int\n        err2 := db.QueryRow(\"INSERT INTO profit(email, type, dateArray, amount, interest, compounded, recurring, name, description, profitFrom) \n                VALUES($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) returning uid;\", \n                profitReq.Email, profitReq.Type, pq.Array(profitReq.DateArray), profitReq.Profit, profitReq.Interest, \n                profitReq.Compounded, profitReq.Recurring, profitReq.Name, profitReq.Description, profitReq.ProfitFrom).Scan(&amp;lastInsertId);\n        if err2!=nil{\n            log.Panic(err2)\n        }\n    }\n\n    profitWriteChannel&lt;-\"finished writing to profit\"\n}\n</code></pre>\n"}, {"tags": ["templates", "go", "go-templates"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1535868380, "post_id": 52132990, "comment_id": 91218932, "body": "Can you please provide the link where it&#39;s explained on the missing <code>.</code> I didnt find it in links , but your example solved my issue. thank you very much !!!"}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1535875490, "post_id": 52132990, "comment_id": 91220093, "body": "In the linked section (Actions) of the <a href=\"https://golang.org/pkg/text/template/#hdr-Actions\" rel=\"nofollow noreferrer\"><code>text&#47;template</code></a> documentation, they state: <code>{{template &quot;name&quot; pipeline}}</code> - The template with the specified name is executed with dot set to the value of the pipeline. Right above that it says: <code>{{template &quot;name&quot;}}</code> - The template with the specified name is executed with nil data."}], "tags": [], "owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "is_accepted": true, "score": 0, "last_activity_date": 1535845900, "creation_date": 1535845900, "answer_id": 52132990, "question_id": 52132061, "link": "https://stackoverflow.com/questions/52132061/divide-template-for-several-file-doesnt-provide-data/52132990#52132990", "title": "Divide template for several file doesn&#39;t provide data", "body": "<p>When you use <code>template</code> to invoke another template, <code>dot</code> is not set by default, but you can pass the value as an (optional) second parameter to <code>template</code> like this:</p>\n\n<pre><code>{{template \"name\"  pipeline}}\n</code></pre>\n\n<p>In your case, your <code>main.txt</code> template should be</p>\n\n<pre><code>{{template \"start\" .}}\n...\n{{template \"end\" .}}\n</code></pre>\n\n<p>to pass the value of <code>dot</code> down to the <code>start</code> and <code>end</code> template.</p>\n\n<p>Because the value of <code>dot</code> can be set this way, it is also possible to split templates up into multiple files in more complex ways. For example, you could have an HTML template to display the user information in a card-style fashion, and wherever you want to insert this card in your output, you can just invoke the template and pass it the user, even when the surrounding template needs other information as well or in a loop.</p>\n\n<p>For more details, check the <a href=\"https://golang.org/pkg/text/template/#hdr-Actions\" rel=\"nofollow noreferrer\"><code>text/template</code></a> docs. This works both for <code>text/template</code> and <code>html/template</code>, but is only documented explicitly for <code>text/template</code>, while there is a note at the start of documentation for <code>html/template</code> telling you, where the detailed documentation can be found.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 52132990, "answer_count": 1, "score": 0, "last_activity_date": 1535845900, "creation_date": 1535834830, "last_edit_date": 1535835683, "question_id": 52132061, "link": "https://stackoverflow.com/questions/52132061/divide-template-for-several-file-doesnt-provide-data", "title": "Divide template for several file doesn&#39;t provide data", "body": "<p>I've template with 1 file (original file)<strong>which works as expected</strong>, now when it comes bigger I've started to divide it to <code>3 files</code> and just copy and paste the data from the original file to 3 files and I was able to see that the template was executed successfully but the data is missing in the <code>start</code> and the <code>end</code> template ,just the <code>main</code> template receive the data properly from <code>structData</code></p>\n\n<p>for example</p>\n\n<pre><code>startTemple.txt\n\n{{define \"start\"}}\n...\n\n{{end}}\n\n\nmain.txt (here i include both template)\n\n{{template \"start\"}}\n...\n\n{{template \"end\"}}\n\n\nendTemplate.txt\n\n\n{{define \"end\"}}\n...\n{{end}}\n</code></pre>\n\n<p><strong>I use the following</strong></p>\n\n<pre><code>t, err := template.New(mainTemplateName).Funcs(funcMap).ParseFiles(startPath, mainPath, endPath)\n\nerr = t.Execute(templFile, structData)\nif err != nil {\n    logs.Logger.Error(err)\n}\n</code></pre>\n\n<p>I use the exact code as before and the issue is that the data from <code>structData</code> is not appear in <code>start</code> and <code>end</code> template after generation, just in the <code>main</code> is getting the structData properly, what could I be missing here ?</p>\n\n<p>the <strong>templates</strong> (start main end) was generated successfully with the <strong>hardcoded data</strong>, but the data which should come from <code>structData</code>, is not add during the generation to the <code>start</code> and <code>end</code> templates </p>\n\n<p>Should I add the <code>structData</code> also to the <code>start</code> and <code>end</code> somehow ?</p>\n"}, {"tags": ["macos", "go", "bonjour", "mdns"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1535831643, "post_id": 52131336, "comment_id": 91213829, "body": "This just means that your system&#39;s concept of its own hostname is not reflected in DNS."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535831677, "post_id": 52131336, "comment_id": 91213838, "body": "If your goal is to determine your machine&#39;s IP address, that&#39;s also not especially straight forward, as a machine may have multiple IP addresse."}, {"owner": {"reputation": 1, "user_id": 7909468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e516ecd1a978375c0a9979a31f09b1a7?s=128&d=identicon&r=PG&f=1", "display_name": "andyandpandy", "link": "https://stackoverflow.com/users/7909468/andyandpandy"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535834874, "post_id": 52131336, "comment_id": 91214581, "body": "Is there a way to change my system&#39;s concept of its own hostname so it will reflect my DNS?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535834958, "post_id": 52131336, "comment_id": 91214604, "body": "That depends on too many things for a single answer."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 7909468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e516ecd1a978375c0a9979a31f09b1a7?s=128&d=identicon&r=PG&f=1", "display_name": "andyandpandy", "link": "https://stackoverflow.com/users/7909468/andyandpandy"}, "edited": false, "score": 0, "creation_date": 1535833707, "post_id": 52131700, "comment_id": 91214335, "body": "Thank you for responding. I attempted the export GODEBUG=netdns=cgo, but this didn&#39;t have any impact.  Is there any way to have my hostname reflect in my DNS as @Flimzy mentioned?  Overriding the net package and using alternative implementations just seems weird  seeing as my friend&#39;s macbook had no issues with this."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 1, "user_id": 7909468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e516ecd1a978375c0a9979a31f09b1a7?s=128&d=identicon&r=PG&f=1", "display_name": "andyandpandy", "link": "https://stackoverflow.com/users/7909468/andyandpandy"}, "edited": false, "score": 0, "creation_date": 1535836176, "post_id": 52131700, "comment_id": 91214868, "body": "Assuming your friend can resolve your hostname, it is not a problem of your computer announcing the dns, its a problem of the golang dns resolver implementation not being able, on your computer, to resolve the dns. Maybe you and your friend have not installed golang the same way, or some libraries. IDK macos sorry. FTR mdns let you announce any dns, you might try to go down that way."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 1, "user_id": 7909468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e516ecd1a978375c0a9979a31f09b1a7?s=128&d=identicon&r=PG&f=1", "display_name": "andyandpandy", "link": "https://stackoverflow.com/users/7909468/andyandpandy"}, "edited": false, "score": 0, "creation_date": 1535896526, "post_id": 52131700, "comment_id": 91224998, "body": "can you show the output of <code>GODEBUG=netdns=1 go run main.go</code> and <code>GODEBUG=netdns=cgo+1 go run main.go</code> ?"}, {"owner": {"reputation": 1, "user_id": 7909468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e516ecd1a978375c0a9979a31f09b1a7?s=128&d=identicon&r=PG&f=1", "display_name": "andyandpandy", "link": "https://stackoverflow.com/users/7909468/andyandpandy"}, "edited": false, "score": 0, "creation_date": 1535900128, "post_id": 52131700, "comment_id": 91225927, "body": "GODEBUG=netdns=1 go run main.go outputs <code>Name: My-Macbook.local Error: &lt;nil&gt; go package net: using cgo DNS resolver [] lookup My-Macbook.local: no such host</code>  GODEBUG=netdns=cgo+1 go run main.go outputs <code>Name: My-Macbook.local Error: &lt;nil&gt; go package net: using cgo DNS resolver [] lookup My-Macbook.local: no such host</code>"}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 2, "last_activity_date": 1535832176, "last_edit_date": 1535832176, "creation_date": 1535831749, "answer_id": 52131700, "question_id": 52131336, "link": "https://stackoverflow.com/questions/52131336/net-lookuphost-outputs-no-such-host-after-using-os-hostname/52131700#52131700", "title": "net.LookUpHost() outputs no such host after using os.Hostname()", "body": "<p>The <code>.local</code> address you are trying to resolve is not a regular DNS entry, its a special one for local networks. It has several names such as <code>bonjour</code>, <code>avahi</code> etc. The RFC calls it <code>mdns</code> <a href=\"https://en.wikipedia.org/wiki/.local\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/.local</a>, see also <a href=\"https://en.wikipedia.org/wiki/Zero-configuration_networking#DNS-SD\" rel=\"nofollow noreferrer\">dns service discovery</a>.</p>\n\n<p>According to the <a href=\"https://golang.org/pkg/net/\" rel=\"nofollow noreferrer\">doc</a> you should try to set this environment variable <code>export GODEBUG=netdns=cgo</code> in order to force the golang dns resolver to call for the system libraries. Indeed the pure golang DNS resolver <a href=\"https://github.com/docker/machine/issues/3297\" rel=\"nofollow noreferrer\">does not resolve mdns</a>.</p>\n\n<p>You could also try an alternate mdns golang implementation such as <a href=\"https://github.com/hashicorp/mdns\" rel=\"nofollow noreferrer\">https://github.com/hashicorp/mdns</a></p>\n\n<p>Note also that the net package provides a <code>DefaultResolver</code> variable that you may override with a custom implementation to resolve <code>\\.local$</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 7909468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e516ecd1a978375c0a9979a31f09b1a7?s=128&d=identicon&r=PG&f=1", "display_name": "andyandpandy", "link": "https://stackoverflow.com/users/7909468/andyandpandy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 965, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1535837055, "creation_date": 1535829061, "last_edit_date": 1535837055, "question_id": 52131336, "link": "https://stackoverflow.com/questions/52131336/net-lookuphost-outputs-no-such-host-after-using-os-hostname", "title": "net.LookUpHost() outputs no such host after using os.Hostname()", "body": "<p>I'm currently attempting to learn the programming language go and stubbled across this weird problem. \nI've created a simple go application that gets the Hostname succesfully, which I then try to get my addresses with. Finally I iterate over these addresses.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"strconv\"\n)\n\nfunc main() {\n    name, error := os.Hostname()\n    fmt.Println(\"Name: \" + name)\n    fmt.Print(\"Error: \")\n    fmt.Println(error)\n\n    addrs, err := net.LookupHost(name)\n\n    fmt.Println(addrs)\n\n    fmt.Println(err)\n\n    for indx, addr := range addrs {\n        fmt.Println(\"Address number \" + strconv.Itoa(indx) + \": \" + addr)\n    }\n}\n</code></pre>\n\n<p>The output of this is the following: </p>\n\n<pre><code>Name: My-macbook.local\nError: &lt;nil&gt;\n[]\nlookup My-macbook.local: no such host\n</code></pre>\n\n<p>I also tried using net.LookUpIP(name), which resulted in the same. I'm connected to the internet and I checked that I had an ip address in system preferences -> network. I am currently on a Macbook Pro with macOS Sierra.</p>\n\n<p>My friend ran the exact same code with the exact same version of go and had two addresses returned so do I have something preventing me from seeing my Ip addresses. Has anyone experienced this before?</p>\n"}, {"tags": ["go", "lets-encrypt"], "answers": [{"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 2, "last_activity_date": 1535832778, "creation_date": 1535832778, "answer_id": 52131829, "question_id": 52129908, "link": "https://stackoverflow.com/questions/52129908/can-i-have-a-dynamic-host-policty-with-autocert/52131829#52131829", "title": "Can I have a dynamic host policty with autocert?", "body": "<blockquote>\n  <p>Does it have to return a function?</p>\n</blockquote>\n\n<p>yes, this is part of the signature of the <a href=\"https://github.com/golang/crypto/blob/master/acme/autocert/autocert.go#L92\" rel=\"nofollow noreferrer\">autocert.Manager</a> struct.</p>\n\n<p>The <a href=\"https://github.com/golang/crypto/blob/master/acme/autocert/autocert.go#L120\" rel=\"nofollow noreferrer\">Manager.HostPolicy</a> field is of type <a href=\"https://github.com/golang/crypto/blob/master/acme/autocert/autocert.go#L60\" rel=\"nofollow noreferrer\">autocert.HostPolicy</a>, which is, indeed, a function of type <code>func(ctx context.Context, host string) error</code>.</p>\n\n<blockquote>\n  <p>What would a skeleton structure look for a custom hostPolicy implementation?</p>\n</blockquote>\n\n<p>You simply set a custom function for the HostPolicy field to implement the logic to query the database.</p>\n\n<pre><code>m := autocert.Manager{\n    // ... more fields here\n    HostPolicy: func(ctx context.Context, host string) error{\n        // implement database calls here\n        return nil \n    },\n}\n</code></pre>\n\n<p>As per the doc, you should return an error to reject an host.</p>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1535832778, "creation_date": 1535818058, "question_id": 52129908, "link": "https://stackoverflow.com/questions/52129908/can-i-have-a-dynamic-host-policty-with-autocert", "title": "Can I have a dynamic host policty with autocert?", "body": "<p>I am looking at some sample code for using autocert with a go web server.</p>\n\n<p>Would it be possible for the hostPolicy implementation to by dynamic i.e. read the while listed hosts from the database (as they will change constantly).</p>\n\n<pre><code>m := autocert.Manager{\n        Cache:      certcache,\n        Prompt:     autocert.AcceptTOS,\n        HostPolicy: hostPolicy,\n    }\n</code></pre>\n\n<p>What would a skeleton structure look for a custom hostPolicy implementation?</p>\n\n<p><a href=\"https://github.com/golang/crypto/blob/master/acme/autocert/autocert.go#L60\" rel=\"nofollow noreferrer\">https://github.com/golang/crypto/blob/master/acme/autocert/autocert.go#L60</a></p>\n\n<p>Is has to return a function?</p>\n"}, {"tags": ["go", "travis-ci"], "answers": [{"tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": true, "score": 3, "last_activity_date": 1535820008, "creation_date": 1535820008, "answer_id": 52130209, "question_id": 52129841, "link": "https://stackoverflow.com/questions/52129841/creating-temp-file-with-extension-in-go-within-travisci/52130209#52130209", "title": "Creating temp file with extension in Go within TravisCI", "body": "<p>The feature of replacing the first asterisk with the random value was <a href=\"https://tip.golang.org/doc/go1.11#io/ioutil\" rel=\"nofollow noreferrer\">added in Go 1.11</a>. It looks like you are using go 1.10 for your Travis CI runs so the asterisk won't be replaced. </p>\n"}], "owner": {"reputation": 2620, "user_id": 6489829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a56125658a5592143ade081194b89d6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Gore", "link": "https://stackoverflow.com/users/6489829/jack-gore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 511, "favorite_count": 0, "accepted_answer_id": 52130209, "answer_count": 1, "score": 0, "last_activity_date": 1535820008, "creation_date": 1535817556, "question_id": 52129841, "link": "https://stackoverflow.com/questions/52129841/creating-temp-file-with-extension-in-go-within-travisci", "title": "Creating temp file with extension in Go within TravisCI", "body": "<p>I am working on testing an application of mine, for which I need to create temporary files with specific extensions. My goal is to create files in a temp directory that look similar to this <code>example123.ac.json</code>.</p>\n\n<p>In order to do this I am using <code>ioutil.TempDir</code> and <code>ioutil.TempFile</code>.</p>\n\n<p><a href=\"https://github.com/JonathonGore/travisci-bug\" rel=\"nofollow noreferrer\">Here</a> is a small contrived example of what I am doing.</p>\n\n<p><strong>main.go:</strong></p>\n\n<pre><code>package main\n\nfunc main() {\n}\n</code></pre>\n\n<p><strong>main_test.go:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"testing\"\n)\n\nfunc TestMain(t *testing.T) {\n    dir, err := ioutil.TempDir(\"\", \"testing\")\n    if err != nil {\n        t.Fatalf(\"unable to create temp directory for testing\")\n    }\n    defer os.RemoveAll(dir)\n\n    file, err := ioutil.TempFile(dir, \"*.ac.json\") // Create a temporary file with '.ac.json' extension\n    if err != nil {\n        t.Fatalf(\"unable to create temporary file for testing\")\n    }\n\n    fmt.Printf(\"created the following file: %v\\n\", file.Name())\n}\n</code></pre>\n\n<p>When I run the tests locally on my Mac with <code>go test</code> the following is outputted from the <code>fmt.Printf</code> is</p>\n\n<pre><code>$ go test\ncreated the following file: /var/folders/tj/1_mxwn350_d2c5r9b_2zgy7m0000gn/T/testing566832606/900756901.ac.json\nPASS\nok      github.com/JonathonGore/travisci-bug    0.004s\n</code></pre>\n\n<p>So it works as expected but when I run it in TravisCI the following is outputted from the Printf statement:</p>\n\n<p><code>created the following file: /tmp/testing768620677/*.ac.json193187872</code></p>\n\n<p>For some reason it is using the literal asterisk inside TravisCI but not when running on my own computer.</p>\n\n<p><a href=\"https://travis-ci.org/JonathonGore/travisci-bug\" rel=\"nofollow noreferrer\">Here</a> is a link to the TravisCI logs if interested.</p>\n\n<p>For completeness here is my <code>.travis.yml</code>:</p>\n\n<pre><code>language: go\ngo:\n  - \"1.10\"\n</code></pre>\n\n<p>Anyone have any idea what is going on here? Or am I missing something obvious?</p>\n"}, {"tags": ["go", "hyperledger-fabric", "channel"], "comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535820998, "post_id": 52129776, "comment_id": 91210987, "body": "I&#39;m sorry you are not supposed to <code>make</code> in your code, since you are getting it from another <code>func()</code>"}, {"owner": {"reputation": 3014, "user_id": 3449806, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Pp2Ee.jpg?s=128&g=1", "display_name": "sean", "link": "https://stackoverflow.com/users/3449806/sean"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535821041, "post_id": 52129776, "comment_id": 91211002, "body": "Understood, thanks for taking a look at it."}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535824246, "post_id": 52129776, "comment_id": 91211860, "body": "I just checked out by writing some similar examples, it works fine in my case."}, {"owner": {"reputation": 3014, "user_id": 3449806, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Pp2Ee.jpg?s=128&g=1", "display_name": "sean", "link": "https://stackoverflow.com/users/3449806/sean"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535828810, "post_id": 52129776, "comment_id": 91213105, "body": "Yea, it&#39;s possible something not directly related is causing the timeout, that&#39;s why I&#39;m hoping to find a better way to debug the channel processes - I need some more detail between the <code>eventService.RegisterChaincodeEvent</code> return and the original <code>RegisterChaincodeEvent</code> call."}], "owner": {"reputation": 3014, "user_id": 3449806, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/Pp2Ee.jpg?s=128&g=1", "display_name": "sean", "link": "https://stackoverflow.com/users/3449806/sean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1535821083, "creation_date": 1535817101, "last_edit_date": 1535821083, "question_id": 52129776, "link": "https://stackoverflow.com/questions/52129776/go-channel-in-select-statement-not-returning", "title": "Go channel in select statement - not returning", "body": "<p>I'm new to golang channels in select statements, so I might be missing something obvious here.</p>\n\n<p>I'm using the hyperledger fabric-sdk-go library [1] which uses select statements to wait for responses to executions on the blockchain.</p>\n\n<p>Here is where, in my own code, I call the execution and wait for the response on a channel:</p>\n\n<pre><code>func (mgr *Manager) InvokeTest(value string) (string, error) {\n\n    . . .{code excluded here}. . .\n    fmt.Println(\"InvokeTest - CHECK 01\")\n\n    reg, notifier, err := mgr.client.RegisterChaincodeEvent(mgr.ChaincodeID, eventID)\n    if err != nil {\n        return \"\", err\n    }\n    defer mgr.client.UnregisterChaincodeEvent(reg)\n\n    . . .{code excluded here}. . .\n    fmt.Println(\"InvokeTest - CHECK 02\")\n\n    // Wait for the result of the submission\n    select {\n    case ccEvent := &lt;-notifier:\n        fmt.Printf(\"Received CC event: %v\\n\", ccEvent)\n    case &lt;-time.After(time.Second * 20):\n        return \"\", fmt.Errorf(\"did NOT receive CC event for eventId(%s)\", eventID)\n    }\n\n    return string(response.TransactionID), nil\n}\n</code></pre>\n\n<p>Here is the <code>RegisterChaincodeEvent</code> function in the library (I added the <code>WriteString</code> for logging:</p>\n\n<pre><code>func (cc *Client) RegisterChaincodeEvent(chainCodeID string, eventFilter string) (fab.Registration, &lt;-chan *fab.CCEvent, error) {\n\n    //-------------------------------\n    . . .WriteString(\"----- chclient-RegisterChaincodeEvent - BEGIN -----\\r\") . . .\n    //-------------------------------\n\n    // Register callback for CE\n    return cc.eventService.RegisterChaincodeEvent(chainCodeID, eventFilter)\n}\n</code></pre>\n\n<p>...and here is the <code>eventService.RegisterChaincodeEvent</code> function (again, <code>WriteString</code> added for logging:</p>\n\n<pre><code>func (s *Service) RegisterChaincodeEvent(ccID, eventFilter string) (fab.Registration, &lt;-chan *fab.CCEvent, error) {\n\n    //-------------------------------\n    . . .WriteString(\"----- service-RegisterChaincodeEvent - BEGIN -----\\r\") . . .\n    //-------------------------------\n\n    . . .{code excluded here}. . .\n\n    eventch := make(chan *fab.CCEvent, s.eventConsumerBufferSize)\n    regch := make(chan fab.Registration)\n    errch := make(chan error)\n\n    if err := s.Submit(dispatcher.NewRegisterChaincodeEvent(ccID, eventFilter, eventch, regch, errch)); err != nil {\n\n        //-------------------------------\n        . . .WriteString(\"service-RegisterChaincodeEvent - CHECK DISP ERR\\r\") . . .\n        //-------------------------------\n\n        return nil, nil, errors.WithMessage(err, \"error registering for chaincode events\")\n    }\n\n    select {\n    case response := &lt;-regch:\n\n        //-------------------------------\n        . . .WriteString(\"service-RegisterChaincodeEvent - CHECK 01\\r\") . . .\n        //-------------------------------\n\n        return response, eventch, nil\n    case err := &lt;-errch:\n        return nil, nil, err\n    }\n}\n</code></pre>\n\n<p>...and here is the terminal log:</p>\n\n<pre><code>InvokeTest - CHECK 01\nInvokeTest - CHECK 02\ndid NOT receive CC event for eventId(eventInvoke)\n</code></pre>\n\n<p>...and the relevant log lines from the library functions:</p>\n\n<pre><code>----- chclient-RegisterChaincodeEvent - BEGIN -----\n----- service-RegisterChaincodeEvent - BEGIN -----\nservice-RegisterChaincodeEvent - CHECK 01\n</code></pre>\n\n<p>So it appears that the library is functioning properly and the <code>RegisterChaincodeEvent</code> functions are returning a response on the channel.  Why would my own select statement not be picking up the channel response?  How can I debug the select/channel blocking process to see why it is timing out?</p>\n\n<p>[1] <a href=\"https://github.com/hyperledger/fabric-sdk-go\" rel=\"nofollow noreferrer\">https://github.com/hyperledger/fabric-sdk-go</a></p>\n"}, {"tags": ["go", "circleci-2.0"], "answers": [{"comments": [{"owner": {"reputation": 13993, "user_id": 232794, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/o1pji.png?s=128&g=1", "display_name": "Sardathrion - against SE abuse", "link": "https://stackoverflow.com/users/232794/sardathrion-against-se-abuse"}, "edited": false, "score": 1, "creation_date": 1585666258, "post_id": 52320441, "comment_id": 107838384, "body": "<code>dmesg</code> does not work on docker images in CircleCI. Unless you found a way to make it work?\u2026"}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "reply_to_user": {"reputation": 13993, "user_id": 232794, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/o1pji.png?s=128&g=1", "display_name": "Sardathrion - against SE abuse", "link": "https://stackoverflow.com/users/232794/sardathrion-against-se-abuse"}, "edited": false, "score": 1, "creation_date": 1585668574, "post_id": 52320441, "comment_id": 107839849, "body": "@Sardathrion: thanks for the note. You are quite right, I tried <code>dmesg</code> just now in an Alpine container. Would I be right in thinking that an individual process within a container would be <code>kill</code>ed (by the host or by Docker) in the case of that task exceeding the container&#39;s memory limit?"}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "reply_to_user": {"reputation": 13993, "user_id": 232794, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/o1pji.png?s=128&g=1", "display_name": "Sardathrion - against SE abuse", "link": "https://stackoverflow.com/users/232794/sardathrion-against-se-abuse"}, "edited": false, "score": 0, "creation_date": 1585668703, "post_id": 52320441, "comment_id": 107839939, "body": "I don&#39;t recall the my information I used in relation to this answer, but any CI environment will bump into this problem in some fashion, regardless of whether they are Dockerised. I expect that a &quot;killed&quot; OS message should be available from somewhere - could this maybe be run on the host, and still be reasonably detailed about what was killed in a container?"}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "reply_to_user": {"reputation": 13993, "user_id": 232794, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/o1pji.png?s=128&g=1", "display_name": "Sardathrion - against SE abuse", "link": "https://stackoverflow.com/users/232794/sardathrion-against-se-abuse"}, "edited": false, "score": 0, "creation_date": 1585668775, "post_id": 52320441, "comment_id": 107839985, "body": "(Thinking about it, I think container level processes should be individually killable by the host, since &quot;containers don&#39;t exist&quot; - they are just an illusion set up by a number of processes sharing the same cgroup. But I would be interested to hear your thoughts)."}, {"owner": {"reputation": 13993, "user_id": 232794, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/o1pji.png?s=128&g=1", "display_name": "Sardathrion - against SE abuse", "link": "https://stackoverflow.com/users/232794/sardathrion-against-se-abuse"}, "edited": false, "score": 1, "creation_date": 1585834120, "post_id": 52320441, "comment_id": 107906455, "body": "Based on my little imperfect experience, using some <code>sleep</code> statement had the effect of allowing the build to pass <i>sometimes</i>. I can build the code just fine (using the same commands) on a toy VM with much less capacity as &quot;normal&quot; so thought that adding <code>sleep</code> would help. However, this create a horrid Heisenbug that is not worth it. I am now paying for CircleCI and move to &quot;xlarge&quot; machines and the problem has vanished."}], "tags": [], "owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "is_accepted": true, "score": 6, "last_activity_date": 1536921628, "last_edit_date": 1592644375, "creation_date": 1536866411, "answer_id": 52320441, "question_id": 52129612, "link": "https://stackoverflow.com/questions/52129612/golang-circleci-2-0-test-failing-with-signal-killed/52320441#52320441", "title": "Golang CircleCI 2.0 test failing with signal: killed", "body": "<p>There are two clues here that suggest you are consuming too much memory, and the OS is forcibly killing your &quot;rogue&quot; process. They are:</p>\n<blockquote>\n<p>killed</p>\n<p>cannot allocate memory</p>\n</blockquote>\n<p>You can confirm this by getting an SSH session at the end of a failed build, and examining the kill history using <code>dmesg</code>. If it gives you a <a href=\"https://unix.stackexchange.com/questions/282155/what-is-the-out-of-memory-message-sacrifice-child\">&quot;sacrifice child&quot;</a> message, then you hit a memory limit so severe that the OS was forced to remove a process from memory.</p>\n<p>You have several options. I put them here in the order I would suggest you prefer them:</p>\n<ul>\n<li>Reduce your memory consumption by making changes to your Go program</li>\n<li>Ask CircleCI to set you up with a larger Docker container (this will be a chargeable option). The default is 4G, I believe 8G and 16G are available</li>\n<li>Swap to a Machine executor (presently free of charge, subject to change). This gives you 8G of RAM, but you lose some of the flexibility of the Docker approach (e.g. you have to use one of a few preset base images).</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 9594, "user_id": 448734, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/94ccfc629c6862b5950de3512742bcae?s=128&d=identicon&r=PG", "display_name": "Bryan", "link": "https://stackoverflow.com/users/448734/bryan"}, "is_accepted": false, "score": 1, "last_activity_date": 1589279374, "creation_date": 1589279374, "answer_id": 61749396, "question_id": 52129612, "link": "https://stackoverflow.com/questions/52129612/golang-circleci-2-0-test-failing-with-signal-killed/61749396#61749396", "title": "Golang CircleCI 2.0 test failing with signal: killed", "body": "<p>What worked for me in this situation was <code>go test -p 1</code> to tell Go to run just one compilation at a time.</p>\n\n<p>Without that Go will run the number of CPUs you have, which by default on CircleCI is two.</p>\n"}], "owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2620, "favorite_count": 1, "accepted_answer_id": 52320441, "answer_count": 2, "score": 3, "last_activity_date": 1589279374, "creation_date": 1535815953, "question_id": 52129612, "link": "https://stackoverflow.com/questions/52129612/golang-circleci-2-0-test-failing-with-signal-killed", "title": "Golang CircleCI 2.0 test failing with signal: killed", "body": "<p>I am migrating to circleci2.0 and after successful build when tests are executed they are randomly failing with following error messages</p>\n\n<pre><code>/usr/local/go/pkg/tool/linux_amd64/link: signal: killed\n/usr/local/go/pkg/tool/linux_amd64/link: flushing $WORK/b462/payment_step_svc.test: write $WORK/b462/svc.test: cannot allocate memory\n</code></pre>\n\n<p>I used the following config</p>\n\n<pre><code>jobs:\n  build:\n    docker:\n      - image: circleci/golang:latest\n      - image: rabbitmq:3.5.4\n      - image: redis\n\n    working_directory: /go/src/github.com/soniabhishek/taskrunner\n\n    environment:\n      GOOS: linux\n      GOARCH: amd64\n      GOPATH: /go\n\n    steps:\n      - checkout\n      - run:\n          name: Get dependencies\n          command: go get -t -d -v ./...\n      - run:\n          name: Build all\n          command: go build ./...\n      - run:\n          name: Test all\n          command: go test -v ./...\n</code></pre>\n\n<p>I have tried for many golang versions other than latest like (1.10.3).</p>\n\n<p>Although I found the <strong>hack</strong> for this but I am not sure why is this happening,\nall my tests run when I use <strong><em>CGO_ENABLED=0</em></strong></p>\n\n<p>Would like to know why is this issue occurring and permanent solution for this</p>\n"}, {"tags": ["image", "go", "garbage-collection"], "comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535811783, "post_id": 52128943, "comment_id": 91208416, "body": "usually I think <code>gc</code> clears only when heap memory is doubled, and if it&#39;s too high frequently, once try adding this <code>defer runtime.GC()</code> at the very beginning of your load func. This runs <code>gc</code> and clears everything."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1535812848, "post_id": 52128943, "comment_id": 91208691, "body": "How do you measure memory consumption? Note that just because the GC reclaims memory this does not necessarily mean that it&#39;s returned to the OS. The runtime keeps the memory around for a bit (more than five minutes is not unusual) in case it&#39;s needed for something else soon, so the GC&#39;s work cannot be accurately observed with OS tooling (use <a href=\"https://golang.org/pkg/runtime/#ReadMemStats\" rel=\"nofollow noreferrer\">runtime.ReadMemStats</a> instead)."}, {"owner": {"reputation": 11, "user_id": 9476610, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-GAT0chVgHYg/AAAAAAAAAAI/AAAAAAAAAGU/k2hH-9qGcCI/photo.jpg?sz=128", "display_name": "gjh33", "link": "https://stackoverflow.com/users/9476610/gjh33"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1535844565, "post_id": 52128943, "comment_id": 91216282, "body": "@Peter This is probably the correct answer. I am in fact just using a simple task manager. I think I expected it to be free because I&#39;m trying to Go as a language closer to the likes of C and C++ with low overhead and strong control, but more and more I&#39;m seeing this may not be what Go is. Still an awesome language"}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535822149, "post_id": 52129207, "comment_id": 91211285, "body": "@nilsocket, JFTR, they are &quot;goroutines&quot;, not &quot;go-routines&quot;. It may be grammatically incorrect to call them like this but this is how <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">the language spec</a> and any other resource on Go calls them. Thanks for the other suggested changes, though!"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1535827633, "post_id": 52129207, "comment_id": 91212780, "body": "to add up on this answer, <a href=\"https://www.youtube.com/watch?v=n59VtiRx34s\" rel=\"nofollow noreferrer\">youtube.com/watch?v=n59VtiRx34s</a>"}, {"owner": {"reputation": 11, "user_id": 9476610, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-GAT0chVgHYg/AAAAAAAAAAI/AAAAAAAAAGU/k2hH-9qGcCI/photo.jpg?sz=128", "display_name": "gjh33", "link": "https://stackoverflow.com/users/9476610/gjh33"}, "edited": false, "score": 0, "creation_date": 1535844072, "post_id": 52129207, "comment_id": 91216225, "body": "I phrased that poorly. What I meant to say was not that the GC is collected when I exit scope. I do know that. I meant that the fact I have no external reference and it is out of scope would make me expect in the next GC sweep it will get marked for collection. However after waiting 10 minutes my memory footprint did not change. My program is running a loop that is just telling GL to render to the screen, so the program is active, and not referencing the memory I allocated. Therefore I don&#39;t understand why it&#39;s not being cleared during GC cycles"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 11, "user_id": 9476610, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-GAT0chVgHYg/AAAAAAAAAAI/AAAAAAAAAGU/k2hH-9qGcCI/photo.jpg?sz=128", "display_name": "gjh33", "link": "https://stackoverflow.com/users/9476610/gjh33"}, "edited": false, "score": 0, "creation_date": 1535891428, "post_id": 52129207, "comment_id": 91223661, "body": "@gjh33, ah, you then may experience what @Peter explained: the GC keeps collected memory for itself for some time\u2014in an assumption it may get requested. A special background goroutine called &quot;scavenger&quot; marks complete freed pages as &quot;not needed&quot; (using the <code>madvise(2)</code> call on Linux and similar means on other platforms) so that the OS can request those pages when it needs them. It means that monitoring RSS of a running Go process is not exactly futile but it&#39;s rather pointless w/o also monitoring the GC stats of the process itself."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 4, "last_activity_date": 1535821971, "last_edit_date": 1535821971, "creation_date": 1535813193, "answer_id": 52129207, "question_id": 52128943, "link": "https://stackoverflow.com/questions/52128943/go-gc-doesnt-seem-to-be-collecting-my-unreferenced-pointers-for-image-loading/52129207#52129207", "title": "Go GC Doesn&#39;t seem to be collecting my unreferenced pointers for image loading?", "body": "<blockquote>\n  <p>when I leave scope of the function, I would hope this memory gets cleared</p>\n</blockquote>\n\n<p>This is a chief misconception: Go is a garbage-collected language, and this means the memory is only freed during so-called garbage collections, which happen <em>periodically</em>\nand are not in any way triggered by variables in the code being executed getting out of scope.</p>\n\n<p>It suffices to say that in the GC algorithm Go implements, each scan consists of two consecutive phases: scanning and sweeping.\nDuring the scan phase, all the live objects are traversed (via pointers they maintain to each other, if any, and those which are unreachable via the stacks of the running goroutines and global variables are marked for freeing which happens during the sweep phase.</p>\n\n<p>The Go runtime implements a quite sophisticated \"estimator\" which tries to deduce at which <em>target heap size</em> to start the next GC session in order to strike a balance between the heap usage and the CPU cost paid for performing a GC session.</p>\n\n<p>This means two things:</p>\n\n<ul>\n<li>In Go, the fact you lost all references to a chunk of allocated memory means nothing to the runtime: this fact will only be considered during the next GC cycle.</li>\n<li>In an idling program, which performs no allocations, a piece of allocated memory has a chance of not being collected at all\u2014since no GC cycle will ever be performed.</li>\n</ul>\n\n<hr>\n\n<p>On a side note, the original mental image of how a GC\nworks which you held is not untrue <em>per se</em>\u2014there indeed exist programming languages with no explicit memory management which actually de-allocate the memory in cases like the one you have mentioned. This is typical for scripting (at least originally) programming languages such as Python, Tcl, Perl (\u2264 5 at least) etc. These languages use so-called reference-counting for the <em>values</em> they operate with. The logic is basically that every assignment of a value to a variable (including passing it as a function's argument) increments a number of references recorded for that variable, and when the execution leaves the scope of a variable, the refcount of the value held in it is decremented. When a value's refcount drops to 0, the value is freed.</p>\n\n<p>This approach works, and appears to be natural, but it has certain downsides such as:</p>\n\n<ul>\n<li>The need to maintain a refcount field for each value.</li>\n<li>The need to spend CPU cycles each time that field has to be updated (add to that also the CPU cache thrashing).</li>\n<li>Inability of this scheme to deal with cyclic references.</li>\n</ul>\n\n<p>I would also add to this that this scheme does not play well with concurrent access to the variables: if you add concurrency (as in Go) in the mix, you'll end up with the requirement for all updates of these refcount fields to be mutually exclusive and with unfunny problems following such as how to deal with the case when one thread of execution unreferences a value, notices the refcount crossed the zero and frees the value and then another thread waiting on the former to increment the reference gets unblocked and finds out the value it wanted to reference does not exist any more.</p>\n"}], "owner": {"reputation": 11, "user_id": 9476610, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-GAT0chVgHYg/AAAAAAAAAAI/AAAAAAAAAGU/k2hH-9qGcCI/photo.jpg?sz=128", "display_name": "gjh33", "link": "https://stackoverflow.com/users/9476610/gjh33"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "closed_date": 1535987806, "answer_count": 1, "score": -2, "last_activity_date": 1535844125, "creation_date": 1535811376, "last_edit_date": 1535844125, "question_id": 52128943, "link": "https://stackoverflow.com/questions/52128943/go-gc-doesnt-seem-to-be-collecting-my-unreferenced-pointers-for-image-loading", "closed_reason": "Needs details or clarity", "title": "Go GC Doesn&#39;t seem to be collecting my unreferenced pointers for image loading?", "body": "<p>I'm working on a project in Go with OpenGL and have code to load an image file via the go/image library. This function leaves no permanent pointers and then I leave scope of the function. I would hope this memory gets cleared on the next GC cycle, but it does not appear to. I'm hoping someone who understands go a little better can help me see why the image isn't being cleared.</p>\n\n<p>Gist of the code: <a href=\"https://gist.github.com/gjh33/62a75ccde6a7d849311804d31d7ee9ff\" rel=\"nofollow noreferrer\">https://gist.github.com/gjh33/62a75ccde6a7d849311804d31d7ee9ff</a></p>\n\n<p>When not calling this method, memory footprint is 17mb, when calling this method it is 40mb. At no point is this memory GC'd even after waiting 5 minutes.</p>\n\n<p>Some things to keep in mind if you haven't worked with openGL in go:</p>\n\n<ul>\n<li>The converstions to unsafe pointers(Line 41) happen via: <a href=\"https://github.com/go-gl/gl/blob/master/v3.2-core/gl/conversions.go\" rel=\"nofollow noreferrer\">https://github.com/go-gl/gl/blob/master/v3.2-core/gl/conversions.go</a></li>\n<li>I'm using go-gl v3.2-core</li>\n<li>If you need more information or context, just ask</li>\n</ul>\n"}, {"tags": ["postgresql", "go"], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 5, "last_activity_date": 1535807539, "creation_date": 1535807539, "answer_id": 52128434, "question_id": 52128388, "link": "https://stackoverflow.com/questions/52128388/golang-record-ids-are-0/52128434#52128434", "title": "Golang record ids are 0", "body": "<p><code>database/sql</code> package does not provide to scan the data directly to a struct, you should iterate over the rows returned from the database query and then scan the data into struct as:</p>\n\n<pre><code>var cars []cars\nfor rows.Next() {\n        var car cars\n        err = rows.Scan(&amp;c.ID, &amp;c.Name)\n        if err != nil {\n                log.Fatalf(\"Scan: %v\", err)\n        }\n        cars = append(cars, car)\n}\nfmt.Println(cars)\n</code></pre>\n\n<p>Or you can use extension for sql package name <a href=\"https://github.com/jmoiron/sqlx\" rel=\"noreferrer\">sqlx</a> which will provide you to directly scan the result into the slice of struct as:</p>\n\n<pre><code>cars := []cars{}\ndb.Select(&amp;cars, \"SELECT * from cars\")\n</code></pre>\n"}], "owner": {"reputation": 779, "user_id": 5082396, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ecb90aafcaa063edf9fe1161289be637?s=128&d=identicon&r=PG&f=1", "display_name": "pro", "link": "https://stackoverflow.com/users/5082396/pro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 52128434, "answer_count": 1, "score": 2, "last_activity_date": 1535807978, "creation_date": 1535807164, "last_edit_date": 1535807978, "question_id": 52128388, "link": "https://stackoverflow.com/questions/52128388/golang-record-ids-are-0", "title": "Golang record ids are 0", "body": "<p>I have the following <strong>Car</strong> model and a <strong>cars</strong> slice: </p>\n\n<pre><code>type Car struct {\n    ID     int    `json:\"id\"`\n    Name  string `json:\"title\"`\n}\n\nvar cars []Car\n</code></pre>\n\n<p>On a Postgres database, I have created a <strong>cars</strong> table to save <strong>car</strong> records.</p>\n\n<pre><code>create table cars (id serial, name varchar);\n</code></pre>\n\n<p>And saved, a couple of <strong>car</strong> records:</p>\n\n<pre><code>insert into cars (name) values ('Toyota');\ninsert into cars (name) values ('Lexus');\n</code></pre>\n\n<p>The records are created successfully with incremental integer ids 1 and 2.</p>\n\n<p>In my Go server, I am making the following query to get the car records: </p>\n\n<pre><code>db.Query(\"SELECT * from cars\").Rows(&amp;cars)\n\nfor _, car := range cars {\n    fmt.Println(car)\n}\n</code></pre>\n\n<p>Although there is a response, the id for each record comes as 0. I have tried to find out why, but I was not able to. Anyone has any idea?</p>\n"}, {"tags": ["debugging", "go"], "comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 1, "creation_date": 1535802159, "post_id": 52127575, "comment_id": 91205910, "body": "which version of go?"}, {"owner": {"reputation": 1539, "user_id": 1039275, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/675293cc8a6d3d429be4a593c0b79b24?s=128&d=identicon&r=PG", "display_name": "aaron", "link": "https://stackoverflow.com/users/1039275/aaron"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535985273, "post_id": 52127575, "comment_id": 91253839, "body": "go1.10.3 darwin/amd64"}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 1, "creation_date": 1536030190, "post_id": 52127575, "comment_id": 91266605, "body": "add this to your path variable and check <code>&#47;Users&#47;lua&#47;go&#47;bin</code>"}, {"owner": {"reputation": 1539, "user_id": 1039275, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/675293cc8a6d3d429be4a593c0b79b24?s=128&d=identicon&r=PG", "display_name": "aaron", "link": "https://stackoverflow.com/users/1039275/aaron"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1536630784, "post_id": 52127575, "comment_id": 91482912, "body": "ok, that works, thanks.  emm..., we still can&#39;t get rid of $PATH, thought it was different from go..."}], "answers": [{"comments": [{"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "reply_to_user": {"reputation": 1539, "user_id": 1039275, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/675293cc8a6d3d429be4a593c0b79b24?s=128&d=identicon&r=PG", "display_name": "aaron", "link": "https://stackoverflow.com/users/1039275/aaron"}, "edited": false, "score": 0, "creation_date": 1535997927, "post_id": 52127892, "comment_id": 91259221, "body": "Yes uninstall the previous binary, then install the new one using the above commands."}, {"owner": {"reputation": 1539, "user_id": 1039275, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/675293cc8a6d3d429be4a593c0b79b24?s=128&d=identicon&r=PG", "display_name": "aaron", "link": "https://stackoverflow.com/users/1039275/aaron"}, "edited": false, "score": 0, "creation_date": 1536018695, "post_id": 52127892, "comment_id": 91264702, "body": "that does not work either..., i put the cmd line output in the  original question description"}], "tags": [], "owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "is_accepted": false, "score": 0, "last_activity_date": 1535803939, "last_edit_date": 1535803939, "creation_date": 1535803246, "answer_id": 52127892, "question_id": 52127575, "link": "https://stackoverflow.com/questions/52127575/could-not-find-debug-line-section-in-binary-when-runnig-dlv-debug-test-go/52127892#52127892", "title": "could not find __debug_line section in binary when runnig dlv debug test.go", "body": "<p>You can install it from the source code instead of using brew.</p>\n\n<pre><code>go get github.com/derekparker/delve/cmd/dlv\ncd $GOPATH/src/github.com/derekparker/delve/cmd/dlv\ngo build \ngo install\n</code></pre>\n\n<p>This should fix this issue.</p>\n"}], "owner": {"reputation": 1539, "user_id": 1039275, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/675293cc8a6d3d429be4a593c0b79b24?s=128&d=identicon&r=PG", "display_name": "aaron", "link": "https://stackoverflow.com/users/1039275/aaron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 592, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1536018790, "creation_date": 1535800626, "last_edit_date": 1536018790, "question_id": 52127575, "link": "https://stackoverflow.com/questions/52127575/could-not-find-debug-line-section-in-binary-when-runnig-dlv-debug-test-go", "title": "could not find __debug_line section in binary when runnig dlv debug test.go", "body": "<p>Using macOS, installed dlv via <code>brew install go-delve/delve/delve</code></p>\n\n<p>then try to debug a program in test.go like this: <code>dlv debug test.go</code></p>\n\n<p>then got this error:</p>\n\n<p><code>could not launch process: could not find __debug_line section in binary</code></p>\n\n<p>Any suggestion?</p>\n\n<hr>\n\n<p>updated on 9/4</p>\n\n<p>I uninstalled the brew dlv and install like below, it still not work.</p>\n\n<p><code>\nlocalhost:dlv lua$ go get github.com/derekparker/delve/cmd/dlv\nlocalhost:dlv lua$ cd $GOPATH/src/github.com/derekparker/delve/cmd/dlv\nlocalhost:dlv lua$ go build \nlocalhost:dlv lua$ go install\nlocalhost:dlv lua$ pwd\n/Users/lua/go/src/github.com/derekparker/delve/cmd/dlv\nlocalhost:dlv lua$ dlv\n-bash: /usr/local/bin/dlv: No such file or directory\nlocalhost:dlv lua$\n</code></p>\n"}, {"tags": ["go", "channel", "producer-consumer"], "comments": [{"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "edited": false, "score": 0, "creation_date": 1535800557, "post_id": 52127485, "comment_id": 91205565, "body": "I couldn&#39;t understand why my question has been down-voted. Can you please point out what do I need to improve?"}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 2, "creation_date": 1535801964, "post_id": 52127485, "comment_id": 91205871, "body": "I didn&#39;t downvote but your question is too big to answer, maybe you can break it into parts and then ask what&#39;s required."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535802452, "post_id": 52127485, "comment_id": 91205981, "body": "Don&#39;t know, have seen much larger questions on SO. Anyways, I removed a few parts that could be ignored. Remaining content seems necessary for someone to be able to understand the problem. Feel free to suggest an edit."}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535802637, "post_id": 52127485, "comment_id": 91206024, "body": "idiomatic go, is not to send data through channels, but send references. i.e., &gt;Do not communicate by sharing memory; instead, share memory by communicating."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535802984, "post_id": 52127485, "comment_id": 91206104, "body": "Great, another downvote. It would have been much better if people downvoting could also tell what they disliked so much. I have searched enough to make sure that it&#39;s not a duplicate on SO. I haven&#39;t asked any homework sort of question, and have done initial brain-storming. If still, there&#39;s something that doesn&#39;t fit, it would be helpful to call it out."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535803201, "post_id": 52127485, "comment_id": 91206149, "body": "@nilsocket : In my case, I am sharing small maps of the csv data. Much lesser than 64 kb in size. I am not sharing references to avoid any risk of race conditions. But how does using references help with syncronising closing of channels, and avoiding blocking/write after close here?"}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535803433, "post_id": 52127485, "comment_id": 91206217, "body": "nope, it have nothing to do with mentioned problem, it&#39;s not idiomatic that&#39;s it."}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535803808, "post_id": 52127485, "comment_id": 91206291, "body": "What is that you actually wanted do(what do you intend to achieve)?, why chain of producers and consumers?"}, {"owner": {"reputation": 13306, "user_id": 162698, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HnjBG.png?s=128&g=1", "display_name": "Rob", "link": "https://stackoverflow.com/users/162698/rob"}, "edited": false, "score": 0, "creation_date": 1535810969, "post_id": 52127485, "comment_id": 91208205, "body": "I thought you could see this but your question will soon be closed for this reason: Primarily Opinion Based. Many good questions generate some degree of opinion based on expert experience, but answers to this question will tend to be almost entirely based on opinions, rather than facts, references, or specific expertise."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 1, "creation_date": 1535812280, "post_id": 52127485, "comment_id": 91208554, "body": "@nilsocket, it&#39;s perfectly normal to send non-pointer values down a channel. It&#39;s no different from passing values to functions in this regard. You do whatever makes sense in any given case."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535816946, "post_id": 52127485, "comment_id": 91209834, "body": "@nilsocket : There&#39;s a graph representing dependencies in a system. It is topologically sorted. Each node has to do its own operation after the previous node is done. But once the data is available, there are no dependencies among the nodes (hence, they can run concurrently). Each node&#39;s operations have different &quot;load&quot;, so they are free to create a different number of go-routines."}, {"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535818216, "post_id": 52127485, "comment_id": 91210188, "body": "It seems kind of complicated to me. But there were other concurrency patterns, which may help you in <code>x&#47;sync</code> repository for an introduction you can look over <a href=\"https://rodaine.com/2018/08/x-files-sync-golang/\" rel=\"nofollow noreferrer\">here</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1535805245, "post_id": 52127879, "comment_id": 91206684, "body": "a context seems appropriate. Also I dont quiet understand why there is a GOTO statement to restart the loop. The time.After select case would return to the beginning of the loop, producing same effect with more idiomatic code."}, {"owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1535805586, "post_id": 52127879, "comment_id": 91206767, "body": "@mh-cbon I believe OP wants a timeout for one channel read and not the whole operation, so a context probably doesn\u2019t help here. Also there\u2019s no goto. Are you referring to the break?"}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "edited": false, "score": 0, "creation_date": 1535807055, "post_id": 52127879, "comment_id": 91207207, "body": "Thanks for the answer. In my case, my goroutines have a call to wg.Done() with defer, and I am using a cleanup similar to what you suggested, where I close the output channel, so that other consumers in the pipeline may also get the hint that no more data is coming. It also ensures that no writes happen after closing the channel. But yes, it&#39;s not a very clean implementation (using an interface, for instance). That surely is my take away from your answer."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "edited": false, "score": 0, "creation_date": 1535807059, "post_id": 52127879, "comment_id": 91207210, "body": "But what I am stuck with is to decide when to stop processing these goroutines. For example, deciding if the channel has been closed by the producer, or there is a delay in data availability. &quot;for range&quot; is blocking in both cases, and &quot;for {}&quot;(infinite) needs to have clear indication to break out of loop.  Another thing, I don&#39;t want to solely rely on either input channel being closed, or signal. In case, there&#39;s some unexpected issue at producer, I want consumers to go ahead and exit if there is no data for a timeout duration."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1535807354, "post_id": 52127879, "comment_id": 91207285, "body": "@mh-cbon : I have updated the code. The &quot;break&quot; in my code was useless. I actually use a flag that controls the for loop. Didn&#39;t know same can be done using a label with break. Below seems to solve my problem. case &lt;-time.After(consumer.Timeout()):                                         break consumeLoop"}, {"owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "reply_to_user": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "edited": false, "score": 0, "creation_date": 1535807517, "post_id": 52127879, "comment_id": 91207326, "body": "@Tushar the range loop finishes when the channel is closed by the producer. There\u2019s a timeout check inside the select which breaks out of the loop - based on what I understand you need."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "edited": false, "score": 0, "creation_date": 1535813838, "post_id": 52127879, "comment_id": 91208940, "body": "Yes, thanks a lot. It solves my problem."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "edited": false, "score": 0, "creation_date": 1535886536, "post_id": 52127879, "comment_id": 91222463, "body": "@svsd : Any suggestion on how to ensure that I close the output channel(outCh) only after ensuring all the consumer goroutines have stopped writing to it (as the consumers are also writing to the input channel of the next node) ?"}, {"owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "reply_to_user": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "edited": false, "score": 0, "creation_date": 1535996166, "post_id": 52127879, "comment_id": 91258545, "body": "@Tushar The WaitGroup is already used to ensure that no more consumers are running before things are cleaned up."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "edited": false, "score": 0, "creation_date": 1538080611, "post_id": 52127879, "comment_id": 92029389, "body": "@svsd : I have recently started a small open source project with this use case. Still in a very initial stage. Would love to have your feedback someday, if you can find some time. Your inputs helped in setting up initial building blocks. <a href=\"https://github.com/tushar2708/conveyor\" rel=\"nofollow noreferrer\">github.com/tushar2708/conveyor</a>"}], "tags": [], "owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "is_accepted": true, "score": 0, "last_activity_date": 1535803849, "last_edit_date": 1535803849, "creation_date": 1535803147, "answer_id": 52127879, "question_id": 52127485, "link": "https://stackoverflow.com/questions/52127485/how-to-handle-channel-closing-synchronisation-in-case-of-slow-producer-fast-con/52127879#52127879", "title": "How to handle channel closing synchronisation in case of slow producer, fast consumer in go?", "body": "<p>Use a <code>sync.WaitGroup</code> to keep track of the number of running goroutines. Each goroutine exits after it no longer gets data from the channel. Once the <code>WaitGroup</code> is done, the cleanup can be done.</p>\n\n<p>Something like this:</p>\n\n<pre><code>import (\n        \"sync\"\n        \"time\"\n)\n\ntype Data interface{} // just an example\n\ntype Consumer interface {\n        Consume(Data) Data\n        CleanUp()\n        Count() int\n        Timeout() time.Duration\n}\n\nfunc StartConsumers(consumer Consumer, inCh &lt;-chan Data, outCh chan&lt;- Data) {\n        wg := sync.WaitGroup{}\n        for i := 0; i &lt; consumer.Count(); i++ {\n                wg.Add(1)\n                go func() {\n                consumeLoop:\n                        for {\n                                select {\n                                case v, ok := &lt;-inCh: // 'ok' says if the channel is still open\n                                        if !ok {\n                                                break consumeLoop\n                                        }\n                                        outCh &lt;- consumer.Consume(v)\n                                case &lt;-time.After(consumer.Timeout()):\n                                        break consumeLoop\n                                }\n                        }\n\n                        wg.Done()\n                }()\n        }\n        wg.Wait()\n\n        consumer.CleanUp()\n        close(outCh)\n}\n</code></pre>\n\n<p>At each stage of the pipeline, you can use a similar process as the above to start the consumers.</p>\n"}], "owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 1, "closed_date": 1535933900, "accepted_answer_id": 52127879, "answer_count": 1, "score": -1, "last_activity_date": 1535819105, "creation_date": 1535799982, "last_edit_date": 1535819105, "question_id": 52127485, "link": "https://stackoverflow.com/questions/52127485/how-to-handle-channel-closing-synchronisation-in-case-of-slow-producer-fast-con", "closed_reason": "Opinion-based", "title": "How to handle channel closing synchronisation in case of slow producer, fast consumer in go?", "body": "<p>I am new to go, and couldn't find an answer to this problem. What I am doing, is to read a CSV file in producer, doing some stuff which may take time, and then sending the output to a consumer via a channel. There's a chain of <strong>producer-consumer</strong>s, and any producer may end up being slower than it's consumer.</p>\n\n<blockquote>\n  <p>producer(1 goroutine) -> chan0 -> consumer-producer-1(>1 goroutines) -> chan1 ->\n  consumer-producer-2(>1 goroutines) -> chan2 -> consumer(>1 goroutines)</p>\n</blockquote>\n\n<p>There can be up to 15 consumers here.</p>\n\n<p>Now the problem that I face is how to decide on the consumer side if the producer is done, and we can stop processing.</p>\n\n<p>What I need to achieve is:</p>\n\n<ol>\n<li>once producer is done, all consumers should eventually do some cleanup and exit after finishing the remaining</li>\n<li>If a consumer doesn't get any data for a specific timeout period, it can exit(with a signal, preferably) without blocking any further.</li>\n<li>It happens for all the producer-consumer pair across the sequence.</li>\n</ol>\n\n<p>I have used the following approach.</p>\n\n<ol>\n<li>To keep a signal channel along with each data channel, and to publish a \"done\", for each goroutine of its next consumer.</li>\n<li>After reading it, each consumer should just read the remaining buffered data in the channel and then put, say 5 \"done\" on next signal channel. Ensuring that it's only 5, and not 5 for each goroutine (using <a href=\"https://golang.org/pkg/sync/#Once.Do\" rel=\"nofollow noreferrer\">https://golang.org/pkg/sync/#Once.Do</a>).</li>\n<li><p>Below is what I could think of till here.</p>\n\n<pre><code>processRemaining = false\nfor processRemaining == false{\n        select {\n        case stuff, ok := &lt;-input_messages:\n                do_stuff(stuff)\n                if ok == false { // if channel has been closed\n                    processRemaining = true\n                }\n                if result != nil {\n                        //send to channel output_messages\n                }\n        case sig := &lt;-input_signals: // if signaled to stopped.\n                fmt.Println(\"received signal\", sig)\n                processRemaining = true\n        default:\n                fmt.Println(\"no activity\")\n        }\n}\nif processRemaining {\n        for stuff := range input_messages {\n                do_stuff(stuff)\n                if result != nil {\n                        //send to channel output_messages\n                }\n        }\n        // send \"output_routine\" number of \"done\" to a channel \"output_signals\".\n}\n</code></pre></li>\n</ol>\n\n<p>But even in this approach, I am unable to think of any way to behave the same way as closed \"input_messages\" channel, if nothing is available for, say 10 seconds.</p>\n\n<p>Are there any problems I am ignoring with this approach. What are the possible way (or concurrency patterns) to approach this problem? ensuring:</p>\n\n<ol>\n<li>All the subsequent channels are closed, once first \"chan0\" is closed.</li>\n<li>All the producers are updated before closing their output channel, and the channel is closed only once they all have finished their writes.</li>\n<li>If a consumer gets no data from a channel for a specified timeout, it should treat it as closed, and unblocks itself.</li>\n</ol>\n"}, {"tags": ["docker", "go", "docker-compose", "delve"], "comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 1, "creation_date": 1535801487, "post_id": 52127431, "comment_id": 91205770, "body": "go to the project&#39;s git directory and run <code>go build</code>, it will fetch missing dependencies."}, {"owner": {"reputation": 363, "user_id": 8573115, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/acecb8da2690096c6f6c899111d0145b?s=128&d=identicon&r=PG&f=1", "display_name": "Trody", "link": "https://stackoverflow.com/users/8573115/trody"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1535808612, "post_id": 52127431, "comment_id": 91207631, "body": "I&#39;m not sure what do you mean. The project itself builds with gb. Honestly I&#39;m not sure if it&#39;s even possible to do go build. The project folders are: /app, /bin, /pkg, /src, /vendor.  Main is in ./src/cmd/microlab/main.go"}], "owner": {"reputation": 363, "user_id": 8573115, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/acecb8da2690096c6f6c899111d0145b?s=128&d=identicon&r=PG&f=1", "display_name": "Trody", "link": "https://stackoverflow.com/users/8573115/trody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 612, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1535799460, "creation_date": 1535799460, "question_id": 52127431, "link": "https://stackoverflow.com/questions/52127431/golangs-delve-cant-find-packages-located-in-parent-folder", "title": "Golang&#39;s Delve can&#39;t find packages located in parent folder", "body": "<p><strong>Problem:</strong>\nI'm using gb to build the project. It recursively checks all folders to get vendor, external and main.go files.\nDelve doesn't do this so when I ssh into the docker image and try to run the dlv server on the root of the project it says that it cannot find go files. If I try with src/cmd/project/main.go it says it cannot find all the other packages. </p>\n\n<ol>\n<li>What version of Delve are you using (<code>dlv version</code>)?\ndlv1.1.0</li>\n<li>What version of Go are you using? (<code>go version</code>)?\ngo1.9.2</li>\n<li>What operating system and processor architecture are you using?\nDocker 18.06.1-ce in Mint 19</li>\n<li>What did you do?\ndlv debug src/cmd/project/main.go-l 0.0.0.0:2345 --headless=true --log=true -- server</li>\n<li>What did you expect to see?\nDelve running</li>\n<li><p>What did you see instead?</p>\n\n<p>src/cmd/project/main.go:4:2: cannot find package \"external/nexudus\" in any of:\n    /usr/local/go/src/external/nexudus (from $GOROOT)\n    /go/src/external/nexudus (from $GOPATH)\nsrc/cmd/project/main.go:8:2: cannot find package \"github.com/jinzhu/gorm\" in any of:\n    /usr/local/go/src/github.com/jinzhu/gorm (from $GOROOT)\n    /go/src/github.com/jinzhu/gorm (from $GOPATH)\nsrc/cmd/project/main.go:9:2: cannot find package \"gopkg.in/intercom/intercom-go.v2\" in any of:\n    /usr/local/go/src/gopkg.in/intercom/intercom-go.v2 (from $GOROOT)\n    /go/src/gopkg.in/intercom/intercom-go.v2 (from $GOPATH)\nexit status 1</p></li>\n<li><p>EXTRA\n<strong>My configuration file (docker/web-dev):</strong>\n...</p>\n\n<p>VOLUME /project/app/contracts</p>\n\n<p>VOLUME /project/pkg</p>\n\n<p>VOLUME /project/src</p>\n\n<p>VOLUME /project/vendor</p></li>\n</ol>\n\n<p><strong>My docker-compose file:</strong></p>\n\n<pre><code>web:\n\n  build: .\n\n  dockerfile: docker/web-dev\n\n  working_dir: /project\n\n  command: /go/bin/reflex --regex='\\.go$$' --inverse-regex='_test\\.go$$' --start-service -- sh -c 'gb build all &amp;&amp; ./bin/project server'\n\n  ports:\n\n  - 6262:6262\n\n  volumes:\n\n  - ./pkg:/project/pkg\n\n  - ./src:/project/src\n\n  - ./vendor:/project/vendor\n\n  - ./app:/project/app\n\n  - ./app/contracts:/project/app/contracts\n</code></pre>\n"}, {"tags": ["go", "vgo"], "answers": [{"comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 8, "creation_date": 1535812644, "post_id": 52127364, "comment_id": 91208644, "body": "Note this is documented in <code>go help modules</code>"}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 9, "creation_date": 1561468981, "post_id": 52127364, "comment_id": 100067824, "body": "On Linux, if <code>$GOPATH</code> is empty. Modules are stored in <code>&#47;home&#47;&lt;user&gt;&#47;go&#47;pkg&#47;mod</code>!"}, {"owner": {"reputation": 6197, "user_id": 1843805, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/NIxI2.jpg?s=128&g=1", "display_name": "Allen", "link": "https://stackoverflow.com/users/1843805/allen"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1594568408, "post_id": 52127364, "comment_id": 111164930, "body": "@ifnotak The same as macOS."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 45, "last_activity_date": 1535800638, "last_edit_date": 1535800638, "creation_date": 1535798880, "answer_id": 52127364, "question_id": 52126923, "link": "https://stackoverflow.com/questions/52126923/where-is-the-module-cache-in-golang/52127364#52127364", "title": "Where is the module cache in golang?", "body": "<p>For Go 1.11, they are stored in</p>\n\n<pre><code>$GOPATH/pkg/mod\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2180, "user_id": 1341399, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/K6sAy.jpg?s=128&g=1", "display_name": "Oskar Szura", "link": "https://stackoverflow.com/users/1341399/oskar-szura"}, "edited": false, "score": 0, "creation_date": 1560943621, "post_id": 53917423, "comment_id": 99900936, "body": "do you have $GOPATH set to $HOME/go?"}, {"owner": {"reputation": 1011, "user_id": 1513298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93c0f5fa2ba8289c78c09d6306a7939e?s=128&d=identicon&r=PG", "display_name": "joeblubaugh", "link": "https://stackoverflow.com/users/1513298/joeblubaugh"}, "edited": false, "score": 4, "creation_date": 1562170524, "post_id": 53917423, "comment_id": 100296978, "body": "$GOPATH defaults to $HOME/go on Go 1.11 and forward."}], "tags": [], "owner": {"reputation": 3113, "user_id": 105023, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c3efbaafc57fea652f4498ba343585dc?s=128&d=identicon&r=PG", "display_name": "Luke Bayes", "link": "https://stackoverflow.com/users/105023/luke-bayes"}, "is_accepted": false, "score": 4, "last_activity_date": 1545683084, "creation_date": 1545683084, "answer_id": 53917423, "question_id": 52126923, "link": "https://stackoverflow.com/questions/52126923/where-is-the-module-cache-in-golang/53917423#53917423", "title": "Where is the module cache in golang?", "body": "<p>I'm on Macos 10.13.6, using <code>go1.11 darwin/amd64</code> and <code>echo $GOPATH</code> is empty.</p>\n\n<p>I found my modules in <code>$HOME/go/pkg/mod</code></p>\n"}, {"tags": [], "owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "is_accepted": false, "score": 5, "last_activity_date": 1564700592, "last_edit_date": 1564700592, "creation_date": 1564679226, "answer_id": 57313882, "question_id": 52126923, "link": "https://stackoverflow.com/questions/52126923/where-is-the-module-cache-in-golang/57313882#57313882", "title": "Where is the module cache in golang?", "body": "<p>The module cache is stored in <code>$GOPATH/pkg/mod</code>, or <code>$HOME/go/pkg/mod</code> if <code>$GOPATH</code> is not set. </p>\n\n<p><strong>Note</strong>: in general, the module cache is read-only, and is intended to be an immutable cache. As such, you should never try to edit things there, nor should you run <code>go</code> commands from inside the cache. </p>\n\n<p>The module cache contains the zip files, unpacked module source code, as well as a VCS cache (when not using a proxy). The cache often contains multiple versions of a single dependency.</p>\n\n<p>If you want to inspect the code of a dependency in the module cache, one shortcut is you can <code>cd</code> directly to the location of an unpacked dependency via:</p>\n\n<pre><code>cd $(go list -f '{{.Dir}}' -m github.com/foo/bar)\n</code></pre>\n\n<p>That asks <a href=\"https://golang.org/cmd/go/#hdr-List_packages_or_modules\" rel=\"noreferrer\">go list</a> to report on the directory location of the module <code>github.com/foo/bar</code> within the module cache, defaulting to whatever version you currently are using in your current module.</p>\n\n<p>Given the cache is intended to be immutable, a related question is how do you edit a dependency (e.g., if you want to add a debug log, or perhaps in preparation for sending an upstream fix for a dependency). A common solution at this point is to use <a href=\"https://github.com/rogpeppe/gohack\" rel=\"noreferrer\">gohack</a>, which creates a mutable copy of a dependency (by default in <code>$HOME/gohack</code>, but the location is controlled by <code>$GOHACK</code> variable). <code>gohack</code>also sets your current <code>go.mod</code> file to have a <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"noreferrer\">replace</a> directive to point to that mutable copy.</p>\n"}, {"tags": [], "owner": {"reputation": 7907, "user_id": 1592008, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4e208220f7cb95e6854adb653663736a?s=128&d=identicon&r=PG", "display_name": "Oleg Neumyvakin", "link": "https://stackoverflow.com/users/1592008/oleg-neumyvakin"}, "is_accepted": false, "score": 1, "last_activity_date": 1598111404, "creation_date": 1598111404, "answer_id": 63538128, "question_id": 52126923, "link": "https://stackoverflow.com/questions/52126923/where-is-the-module-cache-in-golang/63538128#63538128", "title": "Where is the module cache in golang?", "body": "<p>In case you want clean up cache there is a command <code>go clean --modcache</code></p>\n<p>In case you just need to update some dependency you probably want to clean up information about this dependency from</p>\n<ul>\n<li>go.mod</li>\n<li>go.sum</li>\n<li>vendor/modules.txt</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 56, "user_id": 435071, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94a141091cb34d9929dd27bf7af3d934?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/435071/chris"}, "is_accepted": false, "score": 0, "last_activity_date": 1609322386, "creation_date": 1609322386, "answer_id": 65505107, "question_id": 52126923, "link": "https://stackoverflow.com/questions/52126923/where-is-the-module-cache-in-golang/65505107#65505107", "title": "Where is the module cache in golang?", "body": "<p>To determine cache locations, you can use go env:</p>\n<pre><code>go env|grep CACHE\n</code></pre>\n<p>To clean the caches, use <code>go clean -modcache</code> or <code>go clean -cache</code> depending on the type of cache to be cleared.</p>\n"}, {"comments": [{"owner": {"reputation": 2266, "user_id": 6931862, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ld8Ie.png?s=128&g=1", "display_name": "Hermes", "link": "https://stackoverflow.com/users/6931862/hermes"}, "edited": false, "score": 1, "creation_date": 1619200113, "post_id": 67233153, "comment_id": 118842540, "body": "You should include more of an explanation as part of your answer. The answer you provided is almost identical from an answer that was posted by Chris on Dec 30, 2020. Your answer should improve upon the existing answers."}], "tags": [], "owner": {"reputation": 1155, "user_id": 1778714, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/09a2084b0c78c6ce7d6409c8373c3928?s=128&d=identicon&r=PG", "display_name": "Sany Liew", "link": "https://stackoverflow.com/users/1778714/sany-liew"}, "is_accepted": false, "score": 0, "last_activity_date": 1619193129, "creation_date": 1619193129, "answer_id": 67233153, "question_id": 52126923, "link": "https://stackoverflow.com/questions/52126923/where-is-the-module-cache-in-golang/67233153#67233153", "title": "Where is the module cache in golang?", "body": "<p>Run this in terminal</p>\n<pre><code>go env GOMODCACHE\n</code></pre>\n"}], "owner": {"reputation": 6891, "user_id": 2425939, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/SSlFi.png?s=128&g=1", "display_name": "christian", "link": "https://stackoverflow.com/users/2425939/christian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18170, "favorite_count": 4, "accepted_answer_id": 52127364, "answer_count": 6, "score": 30, "last_activity_date": 1619193129, "creation_date": 1535795198, "last_edit_date": 1561470859, "question_id": 52126923, "link": "https://stackoverflow.com/questions/52126923/where-is-the-module-cache-in-golang", "title": "Where is the module cache in golang?", "body": "<p>When I enable gomodules and  build my go program then the required packages are downloaded.</p>\n\n<p>But I cannot find them in <code>$GOPATH/src/</code> or in <code>$GOPATH/src/mod</code>.</p>\n\n<p>Where are they stored?</p>\n\n<pre><code>export GO111MODULE=on\ngo mod init\ngo build main.go \ngo: finding github.com/sirupsen/logrus v1.0.6\ngo: downloading github.com/sirupsen/logrus v1.0.6\n...\n</code></pre>\n"}, {"tags": ["go", "go-build"], "answers": [{"tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 2, "last_activity_date": 1535798825, "creation_date": 1535798825, "answer_id": 52127357, "question_id": 52126889, "link": "https://stackoverflow.com/questions/52126889/why-open-the-go-builds-binary-file-with-vim-i-can-see-some-source-repositories/52127357#52127357", "title": "Why open the go build&#39;s binary file with vim, I can see some source repositories info?", "body": "<blockquote>\n  <p>Why it happens ? </p>\n</blockquote>\n\n<p>The golang is a compiled language - that's mean it uses compiler (translators that generate machine code from source code). The <code>test.exe</code> file is a source code compiled into <a href=\"https://en.wikipedia.org/wiki/Machine_code\" rel=\"nofollow noreferrer\">machine code</a>.</p>\n\n<blockquote>\n  <p>How to hide the info?</p>\n</blockquote>\n\n<p>The binary file (compiled program) contains all data(the source code, the <code>.data</code> section, strings and so on), you can't hide that info from binary, there is no way to do that, all that you can do is <a href=\"https://en.wikipedia.org/wiki/Obfuscation\" rel=\"nofollow noreferrer\"><code>obfuscate</code></a> somehow your source code. </p>\n"}], "owner": {"reputation": 117, "user_id": 4172439, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OjKVY.png?s=128&g=1", "display_name": "Wilon", "link": "https://stackoverflow.com/users/4172439/wilon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 52127357, "answer_count": 1, "score": -2, "last_activity_date": 1535798825, "creation_date": 1535794913, "question_id": 52126889, "link": "https://stackoverflow.com/questions/52126889/why-open-the-go-builds-binary-file-with-vim-i-can-see-some-source-repositories", "title": "Why open the go build&#39;s binary file with vim, I can see some source repositories info?", "body": "<p>In windows, new go file: <code>test.go</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"Hello World!\")\n}\n</code></pre>\n\n<p>Then run <code>go build test.go</code> and then <code>vim test.exe</code>.</p>\n\n<p>Search <code>test.go</code>, I can see many dir infos.</p>\n\n<p>Why it happens and how to hide the info?</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 3, "creation_date": 1535794422, "post_id": 52126807, "comment_id": 91204216, "body": "Since you have the source code of <code>lookup_windows.go</code> you might modify it. However, you probably should not. Looks like an <a href=\"http://xyproblem.info\" rel=\"nofollow noreferrer\">XY problem</a> to me. What is your real issue? What do you want to do?"}, {"owner": {"reputation": 933, "user_id": 2955815, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/de2492fe7f50ed8baa62225dff1dd06a?s=128&d=identicon&r=PG&f=1", "display_name": "oldsport", "link": "https://stackoverflow.com/users/2955815/oldsport"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1535794629, "post_id": 52126807, "comment_id": 91204259, "body": "So, is this to be understood as an example of an implementation, or am I missing something in general?"}, {"owner": {"reputation": 933, "user_id": 2955815, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/de2492fe7f50ed8baa62225dff1dd06a?s=128&d=identicon&r=PG&f=1", "display_name": "oldsport", "link": "https://stackoverflow.com/users/2955815/oldsport"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1535794783, "post_id": 52126807, "comment_id": 91204294, "body": "I want to use the listGroups function."}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1535794985, "post_id": 52126807, "comment_id": 91204332, "body": "If it is not a public function you cannot use it without rewriting it"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1535795278, "post_id": 52126807, "comment_id": 91204404, "body": "What is your goal?"}, {"owner": {"reputation": 933, "user_id": 2955815, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/de2492fe7f50ed8baa62225dff1dd06a?s=128&d=identicon&r=PG&f=1", "display_name": "oldsport", "link": "https://stackoverflow.com/users/2955815/oldsport"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1535795651, "post_id": 52126807, "comment_id": 91204489, "body": "@Flimzy: Beyond what I described above, I need to get all the SIDs of the groups of a current user. Thats on windows, powershell and cmd is not an option, so I Iooked into packages I might use."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1535797323, "post_id": 52126807, "comment_id": 91204858, "body": "Above you have not described your goal. You&#39;ve described your failed attempts to reach your goal, without telling us what you&#39;re trying to do. This is what is meant by &quot;XY Problem.&quot;  Now, finally, you have explained your actual goal, so we may now be able to help."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1535794731, "creation_date": 1535794731, "answer_id": 52126861, "question_id": 52126807, "link": "https://stackoverflow.com/questions/52126807/how-to-get-all-the-sids-of-the-groups-of-a-current-user/52126861#52126861", "title": "How to get all the SIDs of the groups of a current user", "body": "<blockquote>\n  <p>How can I use this package in my project, e.g. the listGoups</p>\n</blockquote>\n\n<p>Not at all.</p>\n\n<p>You simply cannot. You have to use a different package, e.g. your own fork.</p>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 933, "user_id": 2955815, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/de2492fe7f50ed8baa62225dff1dd06a?s=128&d=identicon&r=PG&f=1", "display_name": "oldsport", "link": "https://stackoverflow.com/users/2955815/oldsport"}, "edited": false, "score": 0, "creation_date": 1535798435, "post_id": 52127185, "comment_id": 91205106, "body": "@oldsport: Of course... user is correct. Sorry for the mistake."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1535798422, "last_edit_date": 1535798422, "creation_date": 1535797444, "answer_id": 52127185, "question_id": 52126807, "link": "https://stackoverflow.com/questions/52126807/how-to-get-all-the-sids-of-the-groups-of-a-current-user/52127185#52127185", "title": "How to get all the SIDs of the groups of a current user", "body": "<p>Try something like this:</p>\n\n<pre><code>user, err := user.Current()\nif err != nil {\n    panic(err)\n}\ngroupIds, err := user.GroupIds()\nif err != nil {\n    panic(err)\n}\nfmt.Printf(\"Groups: %v\\n\", groupIds)\n</code></pre>\n"}], "owner": {"reputation": 933, "user_id": 2955815, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/de2492fe7f50ed8baa62225dff1dd06a?s=128&d=identicon&r=PG&f=1", "display_name": "oldsport", "link": "https://stackoverflow.com/users/2955815/oldsport"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 52127185, "answer_count": 2, "score": -3, "last_activity_date": 1535858472, "creation_date": 1535794303, "last_edit_date": 1535858472, "question_id": 52126807, "link": "https://stackoverflow.com/questions/52126807/how-to-get-all-the-sids-of-the-groups-of-a-current-user", "title": "How to get all the SIDs of the groups of a current user", "body": "<p>I need to get all the SIDs of the groups of a current user.</p>\n\n<p>I noticed the <a href=\"https://godoc.org/os/user\" rel=\"nofollow noreferrer\"><code>os/user</code></a> package may do this, but I cannot access the functions in <a href=\"https://golang.org/src/os/user/lookup_windows.go\" rel=\"nofollow noreferrer\"><code>lookup_windows.go</code></a>, because the functions are not capitalized, right?</p>\n\n<p>How can I get all the SIDs of the groups of the current user?</p>\n"}, {"tags": ["go", "garbage-collection", "slice"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1535794936, "post_id": 52126085, "comment_id": 91204324, "body": "That might sound harsh, but this is not of your concern. This is an implementation detail and different version of GO do it differently. Your assumption that GC &quot;doesn&#39;t even know about the beginning of a&quot; is totaly wrong because the GC in Go 1.11 has more information than just the SliceHeader: It has access to the information of the memory allocator too."}], "answers": [{"tags": [], "owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "is_accepted": true, "score": 1, "last_activity_date": 1535801231, "last_edit_date": 1535801231, "creation_date": 1535800339, "answer_id": 52127536, "question_id": 52126085, "link": "https://stackoverflow.com/questions/52126085/how-does-gc-handle-slice-memory-reclaim/52127536#52127536", "title": "How does gc handle slice memory reclaim", "body": "<p>Go uses mark-and-sweep collector as it's present implementation.</p>\n\n<p>As per the algorithm, there will be one root object, and the rest is tree like structure, in case of multi-core machines <code>gc</code> runs along with the program on one core.</p>\n\n<p><code>gc</code> will traverse the tree and when something is not reachable it, considers it as free.</p>\n\n<p>Go objects also have metadata for objects as stated in this <a href=\"https://blog.golang.org/ismmkeynote\" rel=\"nofollow noreferrer\">post</a>.</p>\n\n<p>An excerpt:</p>\n\n<blockquote>\n  <p>We needed to have some information about the objects since we didn't have headers. Mark bits are kept on the side and used for marking as well as allocation. Each word has 2 bits associated with it to tell you if it was a scalar or a pointer inside that word. It also encoded whether there were more pointers in the object so we could stop scanning objects sooner than later.</p>\n</blockquote>\n\n<p>The reason go's slices (slice header) were structures instead of pointer to structures is documented by russ cox in this <a href=\"https://research.swtch.com/godata\" rel=\"nofollow noreferrer\">page</a> under slice section.</p>\n\n<p>This is an excerpt:</p>\n\n<blockquote>\n  <p>Go originally represented a slice as a pointer to the structure(slice header) , but doing so meant that every slice operation allocated a new memory object. Even with a fast allocator, that creates a lot of unnecessary work for the garbage collector, and we found that, as was the case with strings, programs avoided slicing operations in favor of passing explicit indices. Removing the indirection and the allocation made slices cheap enough to avoid passing explicit indices in most cases.</p>\n</blockquote>\n\n<p>The size(length) of an array is part of its type. The types <code>[1]int</code> and <code>[2]int</code> are distinct.</p>\n\n<p>One thing to remember is go is value oriented language, instead of storing pointers, they store direct values.</p>\n\n<p><code>[3]int</code>, arrays are values in go, so if you pass an array, it copies the whole array.\n<code>[3]int</code> this is a value (one as a whole).</p>\n\n<p>When one does <code>a[1]</code> you are accessing part of the value.</p>\n\n<p><code>SliceHeader</code> Data field says consider this as base point of array, instead of <code>a[0]</code></p>\n\n<p>As far as my knowledge is considered:</p>\n\n<p>When one requests for <code>a[4]</code>,</p>\n\n<pre><code>a[0]+(sizeof(type)*4)\n</code></pre>\n\n<p>is calculated.</p>\n\n<p>Now if you are accessing something in through slice <code>s = a[2:4]</code>,\n and if one requests for <code>s[1]</code>, what one was requesting is,</p>\n\n<pre><code>a[2]+sizeof(type)*1\n</code></pre>\n"}], "owner": {"reputation": 437, "user_id": 855160, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4aaf80aae056a422b2e63597018e7c17?s=128&d=identicon&r=PG&f=1", "display_name": "FunkyBaby", "link": "https://stackoverflow.com/users/855160/funkybaby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 52127536, "answer_count": 1, "score": 0, "last_activity_date": 1535801231, "creation_date": 1535788269, "last_edit_date": 1535794084, "question_id": 52126085, "link": "https://stackoverflow.com/questions/52126085/how-does-gc-handle-slice-memory-reclaim", "title": "How does gc handle slice memory reclaim", "body": "<pre><code>var a = [...]int{1,2,3,4,5,6}\ns1 := a[2:4:5]\n</code></pre>\n\n<p>Suppose s1 goes out of scope <strong>later</strong> than a. How does gc know to reclaim the memory of s1's underlying array a?</p>\n\n<p>Consider the runtime representation of s1, <a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"nofollow noreferrer\">spec</a></p>\n\n<pre><code>type SliceHeader struct {\n        Data uintptr\n        Len  int\n        Cap  int\n}\n</code></pre>\n\n<p>The GC doesn't even know about the beginning of a.</p>\n"}, {"tags": ["go", "hyperledger-fabric", "gccgo"], "answers": [{"tags": [], "owner": {"reputation": 7694, "user_id": 5529712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7uvxg.png?s=128&g=1", "display_name": "Gari Singh", "link": "https://stackoverflow.com/users/5529712/gari-singh"}, "is_accepted": false, "score": 0, "last_activity_date": 1536007149, "creation_date": 1536007149, "answer_id": 52155979, "question_id": 52125955, "link": "https://stackoverflow.com/questions/52125955/how-to-build-hyperledger-fabric-with-gccgo/52155979#52155979", "title": "how to build hyperledger fabric with gccgo", "body": "<p>You'll need to use the correct version of GCC in order to get support for the versions of Go supported by the various Fabric releases.</p>\n\n<ul>\n<li>Fabric 1.1 requires Go 1.9.x  </li>\n<li>Fabric 1.2.x requires Go 1.10.x </li>\n<li>The upcoming Fabric 1.3 also requires Go 1.10</li>\n</ul>\n\n<p>gccgo did not support Go 1.9 (GCC 7 had support for Go 1.8).  GCC 8 adds support for Go 1.10.</p>\n\n<p>So you should use Fabric v1.2 and GCC 8.</p>\n"}], "owner": {"reputation": 11, "user_id": 10302779, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-yhoXgq3mMiU/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaNtt6RplxrnFGsbDHdkIhONrvANYQ/mo/photo.jpg?sz=128", "display_name": "user10302779", "link": "https://stackoverflow.com/users/10302779/user10302779"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1536007149, "creation_date": 1535787132, "question_id": 52125955, "link": "https://stackoverflow.com/questions/52125955/how-to-build-hyperledger-fabric-with-gccgo", "title": "how to build hyperledger fabric with gccgo", "body": "<p>Is there a way to build hyperledger fabric using gccgo? I want to do this in order to use -finstrument-functions option of gcc to trace function calls. But I encountered two problems. My steps are as follows.</p>\n\n<ol>\n<li>find the build command</li>\n</ol>\n\n<blockquote>\n  <p>make -n release</p>\n  \n  <p>echo \"Building release/linux-amd64/bin/configtxgen for\n  linux-amd64\" </p>\n  \n  <p>mkdir -p release/linux-amd64/bin CGO_CFLAGS=\" \"</p>\n  \n  <p>GOOS=linux GOARCH=amd64 go build -o\n  /home/yiifburj/go/src/github.com/hyperledger/fabric/release/linux-amd64/bin/configtxgen\n  -tags \"nopkcs11\" -ldflags \"-X github.com/hyperledger/fabric/common/tools/configtxgen/metadata.Version=1.1.0\"\n  github.com/hyperledger/fabric/common/tools/configtxgen</p>\n</blockquote>\n\n<ol start=\"2\">\n<li>modify the build command to use gccgo</li>\n</ol>\n\n<blockquote>\n  <p>CGO_CFLAGS=\" \" GOOS=linux GOARCH=amd64 go build -compiler gccgo -o /home/yiifburj/go/src/github.com/hyperledger/fabric/release/linux-amd64/bin/configtxgen\n  -tags \"nopkcs11\" -gccgoflags \"-X github.com/hyperledger/fabric/common/tools/configtxgen/metadata.Version=1.1.0\"\n  github.com/hyperledger/fabric/common/tools/configtxgen</p>\n  \n  <p>#github.com/hyperledger/fabric/bccsp/factory</p>\n  \n  <p>bccsp/factory/pluginfactory.go:12:8: error: import file \u2018plugin\u2019 not\n  found<br>\n   \"plugin\"</p>\n  \n  <p>bccsp/factory/pluginfactory.go:56:15: error: reference to undefined name </p>\n  \n  <p>\u2018plugin\u2019   plug, err :=\n  plugin.Open(config.PluginOpts.Library)</p>\n</blockquote>\n\n<p>First, as above, \"plugin\" couldn't be found when gccgo is invoked by go build.\nAnother one is how to pass ldflags -X when use gccgo? It seems that -X is a parameter only invalid in gc tools not gccgo.</p>\n\n<p>Anyone can help me? Thanks.</p>\n"}, {"tags": ["go", "aws-lambda", "aws-sdk"], "answers": [{"comments": [{"owner": {"reputation": 886, "user_id": 1619524, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4c576b8a343b40cd00f38be1513a92d?s=128&d=identicon&r=PG", "display_name": "user1619524", "link": "https://stackoverflow.com/users/1619524/user1619524"}, "edited": false, "score": 0, "creation_date": 1535799130, "post_id": 52126246, "comment_id": 91205228, "body": "return c.GetTagCollection().([]struct) errors out as incompatible types. Essentially I am trying to re-use the tagCollection as []*ec2.Tag and []*autoscaling.Tag which accept Key/Value pairs. For now I have duplicate code in for both. Still trying to learn, hope there is a solution to this ?!"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 886, "user_id": 1619524, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4c576b8a343b40cd00f38be1513a92d?s=128&d=identicon&r=PG", "display_name": "user1619524", "link": "https://stackoverflow.com/users/1619524/user1619524"}, "edited": false, "score": 0, "creation_date": 1535799330, "post_id": 52126246, "comment_id": 91205276, "body": "@user1619524 take for an  example what is the returned type of this <code>GetTagCollection</code> function."}, {"owner": {"reputation": 886, "user_id": 1619524, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4c576b8a343b40cd00f38be1513a92d?s=128&d=identicon&r=PG", "display_name": "user1619524", "link": "https://stackoverflow.com/users/1619524/user1619524"}, "edited": false, "score": 0, "creation_date": 1535800120, "post_id": 52126246, "comment_id": 91205457, "body": "Please see the EDIT, where I tried to re-phrase the problem, thanks."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 886, "user_id": 1619524, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4c576b8a343b40cd00f38be1513a92d?s=128&d=identicon&r=PG", "display_name": "user1619524", "link": "https://stackoverflow.com/users/1619524/user1619524"}, "edited": false, "score": 0, "creation_date": 1535800701, "post_id": 52126246, "comment_id": 91205598, "body": "@user1619524 you cannot use same variable for different types. It is not a duplicate. Bot code are working on different types. Check edited answer."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1535800603, "last_edit_date": 1535800603, "creation_date": 1535789499, "answer_id": 52126246, "question_id": 52125598, "link": "https://stackoverflow.com/questions/52125598/type-conversion-to-similar-type/52126246#52126246", "title": "Type conversion to similar type", "body": "<p>The term you are using is not <code>conversion/casting</code>, it is type assertion which is used to get the underlying value of an interface. Since the interface that you are using to wrap the content of the function when returning the data is a slice of struct. That's the reason behind the error:</p>\n\n<blockquote>\n  <p>panic: interface conversion: interface{} is []struct { Key string;\n  Value string }, not []*ec2.Tag</p>\n</blockquote>\n\n<p>Type assertion is wrong, because you are using <code>[]*ec2.Tag</code> ad type, which should be slice of struct <code>[]struct</code> returned from the function <code>c.GetTagCollection()</code>. So you should type assert to that type as:</p>\n\n<pre><code>result := c.GetTagCollection().([]struct)\n</code></pre>\n\n<p>A type assertion used in an assignment or initialization of the special form so you check if type asssertion works:</p>\n\n<pre><code>v, ok = x.(T)\nv, ok := x.(T)\n</code></pre>\n\n<p>For an expression x of interface type and a type T, the primary expression</p>\n\n<pre><code>x.(T)\n</code></pre>\n\n<p>asserts that x is not nil and that the value stored in x is of type T. The notation x.(T) is called a type assertion. </p>\n\n<blockquote>\n  <p>More precisely, if T is not an interface type, x.(T) asserts that the\n  dynamic type of x is identical to the type T. In this case, T must\n  implement the (interface) type of x; otherwise the type assertion is\n  invalid since it is not possible for x to store a value of type T. If\n  T is an interface type, x.(T) asserts that the dynamic type of x\n  implements the interface T.</p>\n</blockquote>\n\n<p><strong>Note</strong>: If the type assertion holds, the value of the expression is the value stored in x and its type is T. If the type assertion is false, a run-time panic occurs.</p>\n\n<p><strong>Edit</strong>: Golang is strict about types. So you cannot assign value of one type to other type until you convert the value to another type. AWS creates it own types using the provided string. Take for an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype MyInt int \n\nfunc main() {\n    var x int\n    x = 1\n    var y MyInt\n    y = 1\n    fmt.Println(x==y)\n}\n</code></pre>\n\n<p>Above code will throw an error of mismatch types</p>\n\n<blockquote>\n  <p>prog.go:14:18: invalid operation: x == y (mismatched types int and\n  MyInt)</p>\n</blockquote>\n\n<p>Working Code on <a href=\"https://play.golang.org/p/a21VdyiP6ew\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 886, "user_id": 1619524, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b4c576b8a343b40cd00f38be1513a92d?s=128&d=identicon&r=PG", "display_name": "user1619524", "link": "https://stackoverflow.com/users/1619524/user1619524"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1535800603, "creation_date": 1535784133, "last_edit_date": 1535800059, "question_id": 52125598, "link": "https://stackoverflow.com/questions/52125598/type-conversion-to-similar-type", "title": "Type conversion to similar type", "body": "<p>I am trying to re-use code (Key/Value) pair to build ec2.Tag and autoscaling.Tag types, which are also Key/Value pairs. But I don't think I know enough about conversion/casting, please advise. Thank you in advance.</p>\n\n<blockquote>\n  <p>panic: interface conversion: interface {} is []struct { Key string; Value string }, not []*ec2.Tag</p>\n</blockquote>\n\n<pre><code>func (c *CloudWorks) GetTagCollection() interface{} {\n\n    return []struct {\n        Key   string\n        Value string\n    }{\n     {\n        Key:   \"key-a\",\n        Value: \"value-a\",\n    },\n    {\n        Key:   \"key-b\",\n        Value: \"value-b\",\n    },\n    {\n        Key:   \"key-c\",\n        Value: \"value-c\",\n    },\n    }\n\n}\n\nfunc (c *CloudWorks) GetTags() []*ec2.Tag {\n\n    //return []*autoscaling.Tag{\n\n    // WORKS\n    //return []*ec2.Tag{\n    //  {\n    //      Key:   aws.String(\"key1\"),\n    //      Value: aws.String(\"value1\"),\n    //  },\n    //  {\n    //      Key:   aws.String(\"key2\"),\n    //      Value: aws.String(\"value3\"),\n    //  },\n    //  {\n    //      Key:   aws.String(\"key3\"),\n    //      Value: aws.String(\"value3\"),\n    //  },\n    //}\n\n    // FAIL\n    return c.GetTagCollection().([]*ec2.Tag)\n\n}\n</code></pre>\n\n<p>EDIT\nmy objective is to avoid code duplicity, how can I re-use key-value pairs amongst both functions, thanks so much.</p>\n\n<pre><code>func (c *CloudWorks) GetEC2Tags() []*ec2.Tag {\n\nreturn []*ec2.Tag{\n    {\n        Key:   aws.String(\"key1\"),\n        Value: aws.String(\"value1\"),\n    },\n    {\n        Key:   aws.String(\"key2\"),\n        Value: aws.String(\"value3\"),\n    },\n}\n\n}\n\nfunc (c *CloudWorks) GetAutoscalingTags() []*autoscaling.Tag {\n\nreturn []*autoscaling.Tag{\n    {\n        Key:   aws.String(\"key1\"),\n        Value: aws.String(\"value1\"),\n    },\n    {\n        Key:   aws.String(\"key2\"),\n        Value: aws.String(\"value3\"),\n    },\n}\n\n}\n</code></pre>\n"}]