[{"tags": ["python", "python-2.7", "go", "python-asyncio", "concurrent.futures"], "comments": [{"owner": {"reputation": 59346, "user_id": 444036, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/My2AZ.jpg?s=128&g=1", "display_name": "Paulo Scardine", "link": "https://stackoverflow.com/users/444036/paulo-scardine"}, "edited": false, "score": 0, "creation_date": 1508965563, "post_id": 46941985, "comment_id": 80831447, "body": "Possibly a dupe of <a href=\"https://stackoverflow.com/questions/5568646/usleep-in-python\">stackoverflow.com/questions/5568646/usleep-in-python</a>"}, {"owner": {"reputation": 59346, "user_id": 444036, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/My2AZ.jpg?s=128&g=1", "display_name": "Paulo Scardine", "link": "https://stackoverflow.com/users/444036/paulo-scardine"}, "edited": false, "score": 0, "creation_date": 1508965868, "post_id": 46941985, "comment_id": 80831600, "body": "Also interesting (with charts for some operational systems): <a href=\"https://stackoverflow.com/questions/1133857/how-accurate-is-pythons-time-sleep\" title=\"how accurate is pythons time sleep\">stackoverflow.com/questions/1133857/&hellip;</a>"}, {"owner": {"reputation": 1015, "user_id": 1773216, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/cvbyd.jpg?s=128&g=1", "display_name": "nmurthy", "link": "https://stackoverflow.com/users/1773216/nmurthy"}, "reply_to_user": {"reputation": 59346, "user_id": 444036, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/My2AZ.jpg?s=128&g=1", "display_name": "Paulo Scardine", "link": "https://stackoverflow.com/users/444036/paulo-scardine"}, "edited": false, "score": 0, "creation_date": 1508970576, "post_id": 46941985, "comment_id": 80833449, "body": "Not, a dupe. Although this is telling <a href=\"https://stackoverflow.com/a/34366451/1773216\">stackoverflow.com/a/34366451/1773216</a>"}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1508977443, "post_id": 46941985, "comment_id": 80835372, "body": "@nmurthy: I think the information there is out of date for Python 3, though I don&#39;t know about Python 2, and I haven&#39;t actually run the experiment on either Python 2 or 3 - I just checked the source code and found that Python 3 is using <code>_PyTime_GetMonotonicClock()</code> to get the time. Unfortunately, whether or not Python 2 <code>time.sleep</code> is monotonic, I don&#39;t think Python 2 exposes a platform-independent monotonic clock anywhere. (Python 3 has <code>time.monotonic</code>.)"}], "answers": [{"tags": [], "owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "is_accepted": false, "score": 5, "last_activity_date": 1508967531, "last_edit_date": 1508967531, "creation_date": 1508966652, "answer_id": 46942284, "question_id": 46941985, "link": "https://stackoverflow.com/questions/46941985/is-there-anything-in-python-2-7-akin-to-gos-time-tick-or-nettys-hashedwheel/46942284#46942284", "title": "Is there anything in Python 2.7 akin to Go&#39;s `time.Tick` or Netty&#39;s `HashedWheelTimer`?", "body": "<p>Nothing like that comes with Python. You'd need to manually adjust your sleep times to account for time spent working.</p>\n\n<p>You could fold that into an iterator, much like the channel of Go's <code>time.Tick</code>:</p>\n\n<pre><code>import itertools\nimport time\nimport timeit\n\ndef tick(interval, initial_wait=False):\n    # time.perf_counter would probably be more appropriate on Python 3\n    start = timeit.default_timer()\n\n    if not initial_wait:\n        # yield immediately instead of sleeping\n        yield\n\n    for i in itertools.count(1):\n        time.sleep(start + i*interval - timeit.default_timer())\n        yield\n\nfor _ in tick(300):\n    # Will execute every 5 minutes, accounting for time spent in the loop body.\n    do_stuff()\n</code></pre>\n\n<p>Note that the above ticker starts ticking when you start iterating, rather than when you call <code>tick</code>, which matters if you try to start a ticker and save it for later. Also, it doesn't send the time, and it won't drop ticks if the receiver is slow. You can adjust all that on your own if you want.</p>\n"}], "owner": {"reputation": 1015, "user_id": 1773216, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/cvbyd.jpg?s=128&g=1", "display_name": "nmurthy", "link": "https://stackoverflow.com/users/1773216/nmurthy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1520379730, "creation_date": 1508965264, "last_edit_date": 1520379730, "question_id": 46941985, "link": "https://stackoverflow.com/questions/46941985/is-there-anything-in-python-2-7-akin-to-gos-time-tick-or-nettys-hashedwheel", "title": "Is there anything in Python 2.7 akin to Go&#39;s `time.Tick` or Netty&#39;s `HashedWheelTimer`?", "body": "<p>I write a lot of code that relies on precise periodic method calls. I've been using Python's <code>futures</code> library to submit calls onto the runtime's thread pool and sleeping between calls in a loop:</p>\n\n<pre><code>executor = ThreadPoolExecutor(max_workers=cpu_count())\n\ndef remote_call():\n    # make a synchronous bunch of HTTP requests\n\ndef loop():\n    while True:\n        # do work here\n        executor.submit(remote_call)\n        time.sleep(60*5)\n</code></pre>\n\n<p>However, I've noticed that this implementation introduces some drift after a long duration of running (e.g. I've run this code for about 10 hours and noticed about 7 seconds of drift). For my work I need this to run on the exact second, and millisecond would be even better. Some folks have pointed me to <code>asyncio</code> (<a href=\"https://stackoverflow.com/questions/37278647/fire-and-forget-python-async-await/37345564#37345564\">&quot;Fire and forget&quot; python async/await</a>), but I have not been able to get this working in Python 2.7.</p>\n\n<p>I'm not looking for a hack. What I really want is something akin to Go's <code>time.Tick</code> or Netty's <code>HashedWheelTimer</code>. </p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508965286, "post_id": 46941841, "comment_id": 80831302, "body": "The binary package can only automatically decode into fixed sized values. It can&#39;t know that the <code>Bd</code> field is a uint16(?) indicating how many AAAA s are following. You&#39;re going to have to do some if the decoding manually."}, {"owner": {"reputation": 1, "user_id": 8827540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4de8b1a87ce2339685b3f04a7167042b?s=128&d=identicon&r=PG&f=1", "display_name": "MKS", "link": "https://stackoverflow.com/users/8827540/mks"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508965392, "post_id": 46941841, "comment_id": 80831359, "body": "ok I thought when I append the AAAA into BBBB the right number of times it should be able to read the complete byte string. Thanks for your help though @JimB"}], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 0, "last_activity_date": 1508965895, "creation_date": 1508965895, "answer_id": 46942131, "question_id": 46941841, "link": "https://stackoverflow.com/questions/46941841/golang-populate-array-of-structure/46942131#46942131", "title": "GoLang - Populate Array of Structure", "body": "<p>The documentation at <a href=\"https://golang.org/pkg/encoding/binary/#Read\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/binary/#Read</a> says:</p>\n\n<blockquote>\n  <p>Data must be a pointer to a fixed-size value or a slice of fixed-size values.</p>\n</blockquote>\n\n<p>which means that the size of the type you <code>Read</code> must be known at compile time. Your <code>struct BBBB</code> contains a slice of <code>[]AAAA</code> which means its length is known only at run-time. If you make it a fixed-size array, e.g. <code>[16]AAAA</code>, it would work.</p>\n"}], "owner": {"reputation": 1, "user_id": 8827540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4de8b1a87ce2339685b3f04a7167042b?s=128&d=identicon&r=PG&f=1", "display_name": "MKS", "link": "https://stackoverflow.com/users/8827540/mks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 523, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1508965895, "creation_date": 1508964702, "question_id": 46941841, "link": "https://stackoverflow.com/questions/46941841/golang-populate-array-of-structure", "title": "GoLang - Populate Array of Structure", "body": "<p>I have the following 2 structures</p>\n\n<pre><code>     type AAAA struct{\n        Aa  [2]byte\n        Ab  [2]byte\n        Ac  [3]byte\n    }       \n    type BBBB struct{\n        Ba  [4]byte\n        Bb  [2]byte\n        Bc  [3]byte\n        Bd  [2]byte   // No Of Struct AAA Items\n        BBStr  []AAAA\n    }\n</code></pre>\n\n<p>So Struct BBB is repeating in Struct AAA</p>\n\n<p>Then I have a string that I have as input which contains the value of the structure coming as input  </p>\n\n<p>input := \"aaaabbccc02ddeefffddeefff\"  (here 02 is no of time Struct AAAA repeats in Struct BBBB)</p>\n\n<p>I need to read through the input string and populate the structure BBBB including the array of structure AAA</p>\n\n<p>I wrote the function below to achieve this. But I am getting \"  Bad error -  binary.Read: invalid type *main.BBBB</p>\n\n<p>Need Help in identifying why this error? Also is there a way to do this differently? </p>\n\n<pre><code>    func main() {\n        input := \"aaaabbccc02ddeefffddeefff\"\n        var k BBBB\n        var j AAAA\n        k.BBStr = append(k.BBStr,j)\n        k.BBStr = append(k.BBStr,j)\n        xyz := []byte(input)\n        err := binary.Read(bytes.NewReader(xyz), binary.LittleEndian, &amp;k)\n        if err != nil {\n            fmt.Println(\"Bad error - \",err)\n        }\n        fmt.Println(\"Structure Definition - \",k)\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 5, "creation_date": 1508960450, "post_id": 46940772, "comment_id": 80828803, "body": "Gofmt really doesn&#39;t have any configuration for its formatting rules.  In fact, that&#39;s kinda the <i>point</i>, that the formatting is the same everywhere.  Configuring what and how it formats would violate that concept."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 2, "creation_date": 1508960496, "post_id": 46940772, "comment_id": 80828835, "body": "Note, however, that if you really are going for readability, you could try multi-lining the function arguments and see if you prefer that."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1508960669, "post_id": 46940772, "comment_id": 80828930, "body": "<a href=\"https://golang.org/doc/faq#semicolons\" rel=\"nofollow noreferrer\">golang.org/doc/faq#semicolons</a> has a blurb on the rationale behind not allowing configuration of gofmt."}, {"owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1508961049, "post_id": 46940772, "comment_id": 80829142, "body": "@Kaedys I understand (and agree with) the idea of a zero-configuration formatting utility to ensure consistency - but I wish I could get it to ignore certain parts of the codebase where humans can format code better than gofmt can (for now)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 6, "creation_date": 1508961868, "post_id": 46940772, "comment_id": 80829560, "body": "That depends very much on your definition of &quot;better&quot;. It&#39;s purely aesthetic, so there really is no &quot;better&quot;, just personal preference. Given what we&#39;ve seen in every other language - that personal preferences rarely match up from one person to the next - having a single unified format for all developers of the language seems the best compromise. For example, I <i>personally</i> find your preferred format harder to read. But I agree with Kaedys - try going multi-line and see if you like that better."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508963212, "post_id": 46940772, "comment_id": 80830234, "body": "&quot;Gofmt&#39;s style is no one&#39;s favorite, yet gofmt is everyone&#39;s favorite.&quot; -- the point of gofmt is so we don&#39;t have to have these discussions, and can all just move on with the same code format. ."}], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1508962260, "post_id": 46941090, "comment_id": 80829758, "body": "It formats maps that way because successive keys are guaranteed to have the same format (<code>&lt;key&gt;: &lt;value&gt;,</code>).  Successive function calls, <i>even to the same function</i>, are not."}, {"owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 0, "creation_date": 1595203462, "post_id": 46941090, "comment_id": 111384619, "body": "(This comment was posted 3 years later...) Thank you for suggesting adding an empty comment because that made it work the way I want to! - though this is a subversion of <code>gofmt</code> and it wouldn&#39;t surprise me if in future <code>gofmt</code> strips out empty comments."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 2, "last_activity_date": 1508961546, "creation_date": 1508961546, "answer_id": 46941090, "question_id": 46940772, "link": "https://stackoverflow.com/questions/46940772/how-can-i-use-gofmt-to-align-parameters-and-assignment/46941090#46941090", "title": "How can I use gofmt to align parameters and assignment?", "body": "<p>Interesting that it does format maps this way:</p>\n\n<pre><code>m := map[string]http.HandlerFunc{\n        \"/\":            Foobar.NewAuthHandler(http.HandlerFunc(handleGetNamespaces)),\n        \"/{namespace}\": Foobar.NewAuthHandler(http.HandlerFunc(handleGetNamespaces)),\n    }\n</code></pre>\n\n<p>that would be one way to present your routes in a nicer format (then run through map and add them to router).</p>\n\n<p>Alternatively if you wish to preserve this space, you can make a sacrifice of stars and slashes to the <a href=\"https://play.golang.org/p/KcfbQQTEpK\" rel=\"nofollow noreferrer\">space eater</a>:</p>\n\n<pre><code>subRouter.Handle(\"/\" /*             */, Foobar.NewAuthHandler(http.HandlerFunc(handleGetNamespaces))).Methods(\"GET\")\nsubRouter.Handle(\"/{namespace}\" /*  */, Foobar.NewAuthHandler(http.HandlerFunc(handleGetKeys))).Methods(\"GET\")\n</code></pre>\n\n<p>Or just accept the same colour of bikeshed as everyone else. </p>\n"}], "owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 0, "accepted_answer_id": 46941090, "answer_count": 1, "score": 0, "last_activity_date": 1508961546, "creation_date": 1508960225, "question_id": 46940772, "link": "https://stackoverflow.com/questions/46940772/how-can-i-use-gofmt-to-align-parameters-and-assignment", "title": "How can I use gofmt to align parameters and assignment?", "body": "<p>In a go HTTP server I'm maintaining, using VS Code, as my IDE - the <code>gofmt</code> command is executed whenever the file is saved but it doesn't respect manual alignment that I introduce the sake of readability.</p>\n\n<p>For example, I'll have my code like this:</p>\n\n<pre><code>subRouter.Handle(\"/\"                    , Foobar.NewAuthHandler(http.HandlerFunc(handleGetNamespaces ))).Methods(\"GET\")\nsubRouter.Handle(\"/{namespace}\"         , Foobar.NewAuthHandler(http.HandlerFunc(handleGetKeys       ))).Methods(\"GET\")\nsubRouter.Handle(\"/{namespace}\"         , Foobar.NewAuthHandler(http.HandlerFunc(handleClearNamespace))).Methods(\"DELETE\")\nsubRouter.Handle(\"/{namespace}/{objKey}\", Foobar.NewAuthHandler(http.HandlerFunc(handleGetObject     ))).Methods(\"GET\")\nsubRouter.Handle(\"/{namespace}/{objKey}\", Foobar.NewAuthHandler(http.HandlerFunc(handleTouchObject   ))).Methods(\"HEAD\")\nsubRouter.Handle(\"/{namespace}/{objKey}\", Foobar.NewAuthHandler(http.HandlerFunc(handlePutObject     ))).Methods(\"PUT\")\nsubRouter.Handle(\"/{namespace}\"         , Foobar.NewAuthHandler(http.HandlerFunc(handlePostObject    ))).Methods(\"POST\")\nsubRouter.Handle(\"/{namespace}/{objKey}\", Foobar.NewAuthHandler(http.HandlerFunc(handleDeleteObject  ))).Methods(\"DELETE\")\n</code></pre>\n\n<p>...but <code>gofmt</code> will compress it to this:</p>\n\n<pre><code>subRouter.Handle(\"/\", Foobar.NewAuthHandler(http.HandlerFunc(handleGetNamespaces))).Methods(\"GET\")\nsubRouter.Handle(\"/{namespace}\", Foobar.NewAuthHandler(http.HandlerFunc(handleGetKeys))).Methods(\"GET\")\nsubRouter.Handle(\"/{namespace}\", Foobar.NewAuthHandler(http.HandlerFunc(handleClearNamespace))).Methods(\"DELETE\")\nsubRouter.Handle(\"/{namespace}/{objKey}\", Foobar.NewAuthHandler(http.HandlerFunc(handleGetObject))).Methods(\"GET\")\nsubRouter.Handle(\"/{namespace}/{objKey}\", Foobar.NewAuthHandler(http.HandlerFunc(handleTouchObject))).Methods(\"HEAD\")\nsubRouter.Handle(\"/{namespace}/{objKey}\", Foobar.NewAuthHandler(http.HandlerFunc(handlePutObject))).Methods(\"PUT\")\nsubRouter.Handle(\"/{namespace}\", Foobar.NewAuthHandler(http.HandlerFunc(handlePostObject))).Methods(\"POST\")\nsubRouter.Handle(\"/{namespace}/{objKey}\", Foobar.NewAuthHandler(http.HandlerFunc(handleDeleteObject))).Methods(\"DELETE\")\n</code></pre>\n\n<p>I couldn't see any rule or option for <code>gofmt</code> to turn off this particular formatting rule. <a href=\"http://grokbase.com/t/gg/golang-nuts/152qsdk1ay/go-nuts-where-can-i-find-the-gofmt-rules-specifications\" rel=\"nofollow noreferrer\">And documentation is sparse</a>.</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc", "grpc-java"], "comments": [{"owner": {"reputation": 21, "user_id": 408753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef38a88adcf317bdb7b465e8b29d0a27?s=128&d=identicon&r=PG", "display_name": "Denis Cheremisov", "link": "https://stackoverflow.com/users/408753/denis-cheremisov"}, "edited": false, "score": 0, "creation_date": 1509043522, "post_id": 46940350, "comment_id": 80870737, "body": "So, I moved the ugly way, with yet another parsing using great <a href=\"https://github.com/emicklei/proto\" rel=\"nofollow noreferrer\">github.com/emicklei/proto</a> (it would be even greater if it would provide token location)"}, {"owner": {"reputation": 21, "user_id": 408753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef38a88adcf317bdb7b465e8b29d0a27?s=128&d=identicon&r=PG", "display_name": "Denis Cheremisov", "link": "https://stackoverflow.com/users/408753/denis-cheremisov"}, "edited": false, "score": 0, "creation_date": 1513067112, "post_id": 46940350, "comment_id": 82497179, "body": "BTW, <a href=\"https://github.com/emicklei/proto\" rel=\"nofollow noreferrer\">github.com/emicklei/proto</a> does provide token location now, so I can recommend this great library"}], "owner": {"reputation": 21, "user_id": 408753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef38a88adcf317bdb7b465e8b29d0a27?s=128&d=identicon&r=PG", "display_name": "Denis Cheremisov", "link": "https://stackoverflow.com/users/408753/denis-cheremisov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 319, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1508958992, "creation_date": 1508958682, "last_edit_date": 1508958992, "question_id": 46940350, "link": "https://stackoverflow.com/questions/46940350/protobuf-how-do-i-get-right-options-order-of-a-method", "title": "Protobuf: how do I get right options order of a method?", "body": "<p>I am writing protoc plugin in Go which should generate documentation for our GRPC services and currently struggle in attempt to know right order of options. </p>\n\n<p>First, how the protobuf looks like</p>\n\n<pre><code> syntax = \"proto3\";\n option go_package = \"sample\";\n\n package sample\n\n import \"common/extensions.proto\"\n\n message SimpleMessage {\n     // Id represents the message identifier.\n     string id = 1;\n     int64 num = 2;\n }\n\n message Response {\n    int32 code = 1;\n }\n\n enum ErrorCodes {\n     RESERVED = 0;\n     OK    = 200\n     ERROR = 6000\n     PANIC = 6001\n }\n\n service EchoService {\n     rpc Echo (SimpleMessage) returns (Response) {\n        // common.grpc_status is an extension defined somewhere\n        // these are list of possible return statuses\n         option (common.grpc_status) = {\n             status: \"OK\"\n             status: \"ERROR\"\n             status: \"PANIC\" // Every status string will must be one of ErrorCodes items\n         };\n\n         option (common.middlewares) = {\n             middleware: \"csrf\"\n             middleware: \"session\"\n         }\n     }\n };\n</code></pre>\n\n<p>As you see, there're two options here. The problem is <code>protoc</code> doesn't bind position directly to tokens. It leaves this information in a special sections where it can be restored via using so called \"paths\". And these paths are rely on order, while options are hidden and can only be retrieved using <code>proto.GetExtension</code> function which doesn't report option index either.\nI need this token location information to report errors. Is there any way to get option index or something equivalent?</p>\n\n<p>I am thinking about using standalone parser just to retrieve the right order, but this feels somewhat awkward. Hope there's a better way.</p>\n"}, {"tags": ["php", "go", "lz4"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508958828, "post_id": 46939483, "comment_id": 80827923, "body": "This seems to be solely a php problem, the Go output looks correct."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1508965516, "post_id": 46939483, "comment_id": 80831422, "body": "The PHP extension <a href=\"https://github.com/kjdev/php-ext-lz4/blob/master/lz4.c#L145\" rel=\"nofollow noreferrer\">is just a thin wrapper around the C library</a> and looks unsuspicious at a glance."}], "answers": [{"tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": false, "score": 0, "last_activity_date": 1508970639, "creation_date": 1508970639, "answer_id": 46943028, "question_id": 46939483, "link": "https://stackoverflow.com/questions/46939483/problems-with-lz4-between-php-and-golang/46943028#46943028", "title": "problems with lz4 between php and golang", "body": "<p>Sound good! And now try </p>\n\n<pre><code>echo -n DAAAAMBIZWxsbyBXb3JsZCE= | base64 -d\n</code></pre>\n\n<p>I got in first 4 bytes is written 0C 00 00 00 - that is the lenght of string and rest is <em>Hello World!</em>. Therefore I think, that if php realize that compression of such a short input is not possible it writes the input (try <code>echo -n \"Hello World!\" | lz4c</code> ). But problem is it does not allow you recognize such a thing, or I'm wrong? </p>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1509006427, "creation_date": 1509006427, "answer_id": 46949279, "question_id": 46939483, "link": "https://stackoverflow.com/questions/46939483/problems-with-lz4-between-php-and-golang/46949279#46949279", "title": "problems with lz4 between php and golang", "body": "<p><a href=\"https://github.com/lz4/lz4/blob/master/lib/lz4.h\" rel=\"nofollow noreferrer\">lz4.h</a> explicitly says</p>\n\n<blockquote>\n  <p>lz4.h provides block compression functions. It gives full buffer control to user.</p>\n  \n  <p>Decompressing an lz4-compressed block also requires metadata (such as compressed size). Each application is free to encode such metadata in whichever way it wants.</p>\n  \n  <p>An additional format, called LZ4 frame specification (doc/lz4_Frame_format.md),\n    take care of encoding standard metadata alongside LZ4-compressed blocks. If your application requires interoperability, it's recommended to use it. A library is provided to take care of it, see lz4frame.h.</p>\n</blockquote>\n\n<p>The PHP extension doesn't do that; <a href=\"https://github.com/kjdev/php-ext-lz4/blob/5b2e225f7ec6b7fb3c0778db137beb2891d5051e/lz4.c#L195\" rel=\"nofollow noreferrer\">it produces bare compressed blocks</a>.</p>\n\n<p><a href=\"http://lz4.github.io/lz4/\" rel=\"nofollow noreferrer\">http://lz4.github.io/lz4/</a> explicitly lists the PHP extension as not interoperable (in the \"Customs LZ4 ports and bindings\" section).</p>\n"}], "owner": {"reputation": 75, "user_id": 6099303, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e8943ef1ec08aee84dfdbdad6bc524da?s=128&d=identicon&r=PG&f=1", "display_name": "\u5c0f\u660e\u6e56\u7554", "link": "https://stackoverflow.com/users/6099303/%e5%b0%8f%e6%98%8e%e6%b9%96%e7%95%94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 403, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1509006427, "creation_date": 1508955551, "question_id": 46939483, "link": "https://stackoverflow.com/questions/46939483/problems-with-lz4-between-php-and-golang", "title": "problems with lz4 between php and golang", "body": "<p>I try to compress data with lz4_compress in php and uncompress data with <a href=\"https://github.com/pierrec/lz4\" rel=\"nofollow noreferrer\">https://github.com/pierrec/lz4</a> in golang</p>\n\n<p>but it fails.</p>\n\n<p>it seems that the lz4_compress output misses the lz4 header, and the block data is little different. </p>\n\n<p>please help me solve the problem.</p>\n\n<pre><code>&lt;?php\necho base64_encode(lz4_compress(\"Hello World!\"));\n?&gt;\n</code></pre>\n\n<p>output:</p>\n\n<p>DAAAAMBIZWxsbyBXb3JsZCE=</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/base64\"\n    \"fmt\"\n    \"github.com/pierrec/lz4\"\n)\n\nfunc main() {\n    a, _ := base64.StdEncoding.DecodeString(\"DAAAAMBIZWxsbyBXb3JsZCE=\")\n    fmt.Printf(\"%b\\n\", a)\n\n    buf := new(bytes.Buffer)\n    w := lz4.NewWriter(buf)\n    b := bytes.NewReader([]byte(\"Hello World!\"))\n    w.ReadFrom(b)\n    fmt.Printf(\"%b\\n\", buf.Bytes())\n}\n</code></pre>\n\n<p>output:</p>\n\n<p>[1100 0 0 0 11000000 1001000 1100101 1101100 1101100 1101111 100000 1010111 1101111 1110010 1101100 1100100 100001]</p>\n\n<p>[100 100010 1001101 11000 1100100 1110000 10111001 1100 0 0 10000000 1001000 1100101 1101100 1101100 1101111 100000 1010111 1101111 1110010 1101100 1100100 100001]</p>\n"}, {"tags": ["sql", "go", "struct"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1508946932, "post_id": 46936936, "comment_id": 80821112, "body": "What SQL DB are you using and what driver? Also note that there are libraries that will <code>Scan</code> an entire struct without having explicitly scan each individual value."}, {"owner": {"reputation": 337, "user_id": 1009981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/f6a19d4e5071633d39d1d672c0ca08fe?s=128&d=identicon&r=PG", "display_name": "Derek", "link": "https://stackoverflow.com/users/1009981/derek"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1508947406, "post_id": 46936936, "comment_id": 80821415, "body": "Maria and go-sql-driver/mysql. I am using direct sqlstruct mapping in other places, this is super distilled a special case :/"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1508947679, "post_id": 46936936, "comment_id": 80821597, "body": "Is there a specific reason you aren&#39;t using the <code>bool</code> or <code>boolean</code> type? Your question implies you are only expecting a 0 or a 1."}, {"owner": {"reputation": 337, "user_id": 1009981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/f6a19d4e5071633d39d1d672c0ca08fe?s=128&d=identicon&r=PG", "display_name": "Derek", "link": "https://stackoverflow.com/users/1009981/derek"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1508947905, "post_id": 46936936, "comment_id": 80821738, "body": "Yes, this is a reporting tool that jacks into a tremendously large CRM DB that is out of my control. This isn&#39;t greenfield at all :/"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1508948048, "post_id": 46936936, "comment_id": 80821834, "body": "Try scanning it into a <code>byte</code>. In MySQL, a <code>tinyint</code> of any &quot;size&quot; is just a byte. Also maybe try an <code>int8</code>, or <code>uint8</code>."}, {"owner": {"reputation": 337, "user_id": 1009981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/f6a19d4e5071633d39d1d672c0ca08fe?s=128&d=identicon&r=PG", "display_name": "Derek", "link": "https://stackoverflow.com/users/1009981/derek"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1508948421, "post_id": 46936936, "comment_id": 80822051, "body": "Tried it, no dice, all zeros. What I don&#39;t understand is how it is I can IF() the value into strings at the query level, and it will still fail..."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1508949226, "post_id": 46937667, "comment_id": 80822470, "body": "Glad I could push you over the edge :)"}], "tags": [], "owner": {"reputation": 337, "user_id": 1009981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/f6a19d4e5071633d39d1d672c0ca08fe?s=128&d=identicon&r=PG", "display_name": "Derek", "link": "https://stackoverflow.com/users/1009981/derek"}, "is_accepted": false, "score": 3, "last_activity_date": 1508949087, "creation_date": 1508949087, "answer_id": 46937667, "question_id": 46936936, "link": "https://stackoverflow.com/questions/46936936/golang-sql-scanning-to-struct-strangeness/46937667#46937667", "title": "Golang SQL Scanning to Struct strangeness", "body": "<p>Jeez. Ok, this had nothing to do with the tinyint itself apparently. </p>\n\n<p>The 'fee' column in the database had null values in it, the pre-existing query was set to replace null with empty strings. </p>\n\n<pre><code>IFNULL(fee,'')\n</code></pre>\n\n<p>It seems that the sql driver 'broke' very quietly on seeing those, and just gave up on processing everything afterwards. </p>\n\n<p>My fix was ammending the query with IFNULL(fee,0) and everything popped back to life. </p>\n\n<p>Thanks RayfenWindspear! I would not have given it the extra mile without your feedback.</p>\n"}], "owner": {"reputation": 337, "user_id": 1009981, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/f6a19d4e5071633d39d1d672c0ca08fe?s=128&d=identicon&r=PG", "display_name": "Derek", "link": "https://stackoverflow.com/users/1009981/derek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1520, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508949087, "creation_date": 1508946816, "last_edit_date": 1508947297, "question_id": 46936936, "link": "https://stackoverflow.com/questions/46936936/golang-sql-scanning-to-struct-strangeness", "title": "Golang SQL Scanning to Struct strangeness", "body": "<p>Please imagine a table as such: </p>\n\n<pre><code>FirstName, LastName, Fee, Opt_Out\nString     String    Int   TinyInt(4)\n</code></pre>\n\n<p>And a struct as such: </p>\n\n<pre><code>type Dude struct {\n    Firstname string\n    Lastname  string\n    Fee       int\n    Opt_out   int\n}\n</code></pre>\n\n<p>To keep it short: I am using database/sql to scan into structs with no issue, except when it comes to that TinyInt. </p>\n\n<pre><code>err = rows.Scan(&amp;firstname, &amp;lastname, &amp;fee, &amp;opt_out)\n</code></pre>\n\n<p>After scanning, and before assigning values to my struct, I</p>\n\n<pre><code>fmt.PrintLn(Opt_out)\n</code></pre>\n\n<p>and they always return a zero value. \nIf I plug the query directly into the sql server, I get the correct ones and zero's I am expecting. </p>\n\n<p>I have also tried changing the type of \"Opt_out\" in the struct to string, and attempted to cast via the query itself by doing a</p>\n\n<pre><code>IF(Opt_out=1,\"yes\",\"no\") \n</code></pre>\n\n<p>and a similar thing happens, the query run in sql returns expected results, but golang returns empty values. </p>\n\n<p>I am drawing a blank. Any ideas? </p>\n"}, {"tags": ["go", "mocking", "apache-kafka", "ginkgo", "sarama"], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 5816769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1340926c5c32eb41a0bd4a1daa31afc?s=128&d=identicon&r=PG&f=1", "display_name": "ntfx", "link": "https://stackoverflow.com/users/5816769/ntfx"}, "edited": false, "score": 0, "creation_date": 1509006783, "post_id": 46937327, "comment_id": 80845995, "body": "Thank you for the answer! It would work with <code>*testing.T</code>, but I forgot to mention that I&#39;m using <code>ginkgo</code> testing framework. Is it possible to write a test  with it, probably with refactoring?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 83, "user_id": 5816769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1340926c5c32eb41a0bd4a1daa31afc?s=128&d=identicon&r=PG&f=1", "display_name": "ntfx", "link": "https://stackoverflow.com/users/5816769/ntfx"}, "edited": false, "score": 1, "creation_date": 1509006871, "post_id": 46937327, "comment_id": 80846050, "body": "The framework doesn&#39;t matter; I&#39;m just illustrating the concept. Ginkgo has BeforeEach() and AfterEach(), for instance."}, {"owner": {"reputation": 83, "user_id": 5816769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1340926c5c32eb41a0bd4a1daa31afc?s=128&d=identicon&r=PG&f=1", "display_name": "ntfx", "link": "https://stackoverflow.com/users/5816769/ntfx"}, "edited": false, "score": 0, "creation_date": 1509018911, "post_id": 46937327, "comment_id": 80854239, "body": "<i>mind blown</i> yeah, it works! Thanks a lot @Peter, I feel like I&#39;ve learned a lot about go from this!"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 4, "last_activity_date": 1508948030, "creation_date": 1508948030, "answer_id": 46937327, "question_id": 46936844, "link": "https://stackoverflow.com/questions/46936844/mocking-newconsumer-in-sarama-cluster/46937327#46937327", "title": "Mocking NewConsumer in sarama-cluster", "body": "<p>Don't call cluster.NewConsumer, but add a simple indirection that you can swap out in tests. For instance, assign the function to a package variable (I do this with time.Now all the time).</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n\n    \"github.com/bsm/sarama-cluster\"\n)\n\nvar newConsumer = cluster.NewConsumer // replaceable in tests\n\nfunc initSaramaConsumer() (*cluster.Consumer, error) {\n    brokers := []string{\"some_url:port\"}\n    groups := \"some_group\"\n    topics := []string{\"some_topic\"}\n    config := cluster.NewConfig()\n\n    saramaConsumer, err := newConsumer(\n            brokers, groups, topics, config,\n    )\n\n    if err != nil {\n            return nil, err\n    }\n\n    return saramaConsumer, nil\n}\n\nfunc TestInitSaramaConsumer(t *testing.T) {\n    newConsumer = newMockConsumer\n    defer func() { newConsumer = cluster.NewConsumer }()\n\n    // Tests for initSaramaConsumer goes here\n}\n\nfunc newMockConsumer([]string, string, []string, *cluster.Config) (*cluster.Consumer, error) {\n    panic(\"not implemented\")\n}\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 5816769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1340926c5c32eb41a0bd4a1daa31afc?s=128&d=identicon&r=PG&f=1", "display_name": "ntfx", "link": "https://stackoverflow.com/users/5816769/ntfx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1447, "favorite_count": 1, "accepted_answer_id": 46937327, "answer_count": 1, "score": 3, "last_activity_date": 1509006487, "creation_date": 1508946570, "last_edit_date": 1509006487, "question_id": 46936844, "link": "https://stackoverflow.com/questions/46936844/mocking-newconsumer-in-sarama-cluster", "title": "Mocking NewConsumer in sarama-cluster", "body": "<p>Is there a way to test/mock sarama-cluster's NewConsumer function without having actual brokers set up? What am I missing here?</p>\n\n<p>Code I'm trying to test:</p>\n\n<pre><code>import cluster \"github.com/bsm/sarama-cluster\"\n\nfunc initSaramaConsumer() (*cluster.Consumer, error) {\n  brokers := []string{\"some_url:port\"}\n  groups := \"some_group\"\n  topics := []string{\"some_topic\"}\n  config := cluster.NewConfig()\n\n  saramaConsumer, err := cluster.NewConsumer(\n    brokers, groups, topics, config,\n  )\n\n  if err != nil {\n    return nil, err\n  }\n\n  return saramaConsumer, nil\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1508946163, "post_id": 46936608, "comment_id": 80820587, "body": "Are you trimming newlines (\\n) and carriage returns (\\r) properly?"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 2124641, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c8c3e337e53ed75dc460d2f705dde5e3?s=128&d=identicon&r=PG", "display_name": "Alex Ng", "link": "https://stackoverflow.com/users/2124641/alex-ng"}, "edited": false, "score": 0, "creation_date": 1508947173, "post_id": 46936999, "comment_id": 80821276, "body": "Thank you so much, would have never thought of that."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 4, "last_activity_date": 1508946987, "creation_date": 1508946987, "answer_id": 46936999, "question_id": 46936608, "link": "https://stackoverflow.com/questions/46936608/tcp-chat-application-string-concatenation-error/46936999#46936999", "title": "TCP Chat Application String Concatenation Error", "body": "<p>This looks like the name contains a carriage return (<code>\\r</code>), which instructs the terminal to write <code>&lt;NewName123&gt;</code>, then return the carriage (aka. cursor) to the beginning of the line, and then (over)write <code>&gt; Test</code>.</p>\n\n<p>A <code>strings.TrimSpace(command[5:])</code> call somewhere should fix this.</p>\n"}], "owner": {"reputation": 53, "user_id": 2124641, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c8c3e337e53ed75dc460d2f705dde5e3?s=128&d=identicon&r=PG", "display_name": "Alex Ng", "link": "https://stackoverflow.com/users/2124641/alex-ng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31, "favorite_count": 0, "accepted_answer_id": 46936999, "answer_count": 1, "score": 0, "last_activity_date": 1508946987, "creation_date": 1508945890, "last_edit_date": 1508946343, "question_id": 46936608, "link": "https://stackoverflow.com/questions/46936608/tcp-chat-application-string-concatenation-error", "title": "TCP Chat Application String Concatenation Error", "body": "<p>I've run into some difficulty when building a simple TCP based chat application in Go. My problem is that after changing the variable name, the formatting seems to go haywire and the text of the message overrides the name of the sender and other characters.</p>\n\n<p>All code snippets below are taken from the server.</p>\n\n<pre><code>type Message struct {\n    sender *User\n    message string\n}\n\ntype User struct {\n    connection net.Conn\n    queue chan string//Simply a queue of messages that will be sent to the client, out of the scope of this question\n    name string\n}\n</code></pre>\n\n<p>Code that sets the name: (assuming the command comes in the form \"/nick NAME\")</p>\n\n<pre><code>command := message.message[1:]\nif(strings.HasPrefix(command, \"nick\")) {\n    message.sender.name = command[5:]\n    fmt.Println(\"Set name to: \" + message.sender.name)\n}\n</code></pre>\n\n<p>Code that prints the value (note that the error persists if I concatenate the strings using the traditional <code>s1 + s2</code>):</p>\n\n<pre><code>var buffer bytes.Buffer\nbuffer.WriteString(\"&lt;\")\nbuffer.WriteString(message.sender.name)\nbuffer.WriteString(\"&gt; \")\nbuffer.WriteString(message.message)\nfmt.Println(buffer.String())\nsendMessage(buffer.String())\n</code></pre>\n\n<p>Output (server on left, client on right. Not that I send the message 'Test' both times):</p>\n\n<p><a href=\"https://i.stack.imgur.com/wyNjZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wyNjZ.png\" alt=\"Output\"></a></p>\n\n<p>As seen above, the format of the message should have been <code>&lt;NewName123&gt; Test</code>, however the greater than symbol is misplaced and the message test can be seen overriding the name of the user. I'm stumped as to what is causing this problem.\nThe application works as follows: Client connects. Client sends a message, the server reads the message and applies formatting (IE add username in). Server redistributes the message to ALL users (including the sender). The clients display the message.</p>\n\n<p>Any help would be fantastic.</p>\n"}, {"tags": ["function", "go"], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1508944963, "post_id": 46936156, "comment_id": 80819706, "body": "Click the headlines on godoc.org to see the code implementing the thing that is being documented. <code>Pic</code> (the function you pass to <code>Show</code>) is called <a href=\"https://github.com/golang/tour/blob/27c87204043c53a016e3b3282daebaf756e484aa/pic/pic.go#L20\" rel=\"nofollow noreferrer\">right here</a>."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1508944615, "creation_date": 1508944615, "answer_id": 46936156, "question_id": 46935796, "link": "https://stackoverflow.com/questions/46935796/function-call-in-tour-of-go-exercise-slices-of-slices/46936156#46936156", "title": "Function call in Tour of Go, exercise &quot;Slices of Slices&quot;", "body": "<p>Your function, <code>Pic</code>, takes two parameters, <code>Show</code> takes one. You're calling <code>Show</code> with a single parameter, which is a function; that function takes two parameters. When you pass a function to another function, the assumption is that the function you're calling (<code>Show</code>) will call the function you passed in (<code>Pic</code>) and provide the necessary parameters when it makes that call.</p>\n"}, {"comments": [{"owner": {"reputation": 7788, "user_id": 1302716, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/LrNqp.png?s=128&g=1", "display_name": "Hubert Sch&#246;lnast", "link": "https://stackoverflow.com/users/1302716/hubert-sch%c3%b6lnast"}, "edited": false, "score": 0, "creation_date": 1508946745, "post_id": 46936375, "comment_id": 80820987, "body": "Ok. But where do the values for dx and dy come from? How can I send my own width and height to this function?"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "reply_to_user": {"reputation": 7788, "user_id": 1302716, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/LrNqp.png?s=128&g=1", "display_name": "Hubert Sch&#246;lnast", "link": "https://stackoverflow.com/users/1302716/hubert-sch%c3%b6lnast"}, "edited": false, "score": 1, "creation_date": 1508948067, "post_id": 46936375, "comment_id": 80821848, "body": "The implementation of <code>Show</code> will call the function that you give it internally. The thing you write in the example is <code>Pic</code> which returns a picture (as a 2D array of gray values). <code>Show</code> is now given this &quot;image generator&quot; to show its results. <code>Show</code> will call <code>Pic</code>, or any other image generator function that you pass it, and it knows how to display <code>Pic</code>&#39;s resulting gray image. Thus the name <code>Show</code>."}, {"owner": {"reputation": 7788, "user_id": 1302716, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/LrNqp.png?s=128&g=1", "display_name": "Hubert Sch&#246;lnast", "link": "https://stackoverflow.com/users/1302716/hubert-sch%c3%b6lnast"}, "edited": false, "score": 1, "creation_date": 1508949132, "post_id": 46936375, "comment_id": 80822422, "body": "I&#39;ve got it now. This is explained later in this tour: <a href=\"https://tour.golang.org/moretypes/24\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/24</a> I think it would be wise not to use templates in an exercise that are left unexplained until this point."}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 3, "last_activity_date": 1508945222, "creation_date": 1508945222, "answer_id": 46936375, "question_id": 46935796, "link": "https://stackoverflow.com/questions/46935796/function-call-in-tour-of-go-exercise-slices-of-slices/46936375#46936375", "title": "Function call in Tour of Go, exercise &quot;Slices of Slices&quot;", "body": "<p>When you say <code>Pic(40, 30)</code> you call the function <code>Pic</code> and it returns a <code>[][]uint8</code> (as seen in the function definition). This means that in your commented-out code you pass a <code>[][]uint8</code> to <code>Show</code>.</p>\n\n<p>When you say <code>Show(Pic)</code> you pass <code>Pic</code> as the parameter, which is a function. That is what <code>Show</code> expects. <code>Pic</code> is of type <code>func(dx, dy int) [][]uint8</code>.</p>\n\n<p>Go allows you to pass functions around as parameters and that is what is happening here.</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1508952469, "creation_date": 1508952469, "answer_id": 46938566, "question_id": 46935796, "link": "https://stackoverflow.com/questions/46935796/function-call-in-tour-of-go-exercise-slices-of-slices/46938566#46938566", "title": "Function call in Tour of Go, exercise &quot;Slices of Slices&quot;", "body": "<p>You are quite right about definition of <code>Show</code> - it is a function which accepts another specific format notion as a parameter. \n<code>Pic</code> is such a function matching this criteria  - so you pass it to <code>Show</code> successfully. </p>\n\n<p>But when you call <code>Pic(30,40)</code> that means not a function but a <em>result</em> of calling the function with such parameters.  So in this case you passs to <code>Show</code> not a function <code>Pic</code> but a slice returned by it <code>[][]uint8</code>. Of course Show can\u2019t accept it. </p>\n"}], "owner": {"reputation": 7788, "user_id": 1302716, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/LrNqp.png?s=128&g=1", "display_name": "Hubert Sch&#246;lnast", "link": "https://stackoverflow.com/users/1302716/hubert-sch%c3%b6lnast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 626, "favorite_count": 0, "accepted_answer_id": 46936375, "answer_count": 3, "score": 1, "last_activity_date": 1508952469, "creation_date": 1508943611, "question_id": 46935796, "link": "https://stackoverflow.com/questions/46935796/function-call-in-tour-of-go-exercise-slices-of-slices", "title": "Function call in Tour of Go, exercise &quot;Slices of Slices&quot;", "body": "<p>I am learning Go, and i tried the exercise about <a href=\"https://tour.golang.org/moretypes/18\" rel=\"nofollow noreferrer\">slices of slices</a>. I had no problem with the topic itself (slices of slices). I have troubles to understand the function call.</p>\n\n<p>This is my solution of this exercise:</p>\n\n<pre><code>package main\n\nimport \"golang.org/x/tour/pic\"\n\nfunc Pic(dx, dy int) [][]uint8 {\n    pic := make([][]uint8, dy)\n    for y := range pic {\n        pic[y] = make([]uint8, dx)\n        for x := range pic[y] {\n            pic[y][x] = uint8(5 * (x + y))\n        }\n    }\n    return pic\n}\n\nfunc main() {\n    //pic.Show(Pic(40,30)) // doesn't work, but why?\n    pic.Show(Pic) // works, but why? Where are the values for dx and dy set?\n}\n</code></pre>\n\n<p>There is, starting at line 5, a function, named <code>Pic</code>, and it receives two integer variables (<code>dx</code>, <code>dy</code>). So I think, a correct function call might be <code>Pic(40,30)</code> (with <code>40</code> and <code>30</code> being the values for <code>dx</code> and <code>dy</code>). </p>\n\n<ul>\n<li>But why does line 17 throw an error? (<code>pic.Show(Pic(40,30))</code>)</li>\n<li>Why does line line 18 work? (<code>pic.Show(Pic)</code>)</li>\n<li>And where do the values of <code>dx</code> and <code>dy</code> come from when line 18 is executed?</li>\n</ul>\n\n<p>I tried to look up <a href=\"http://golang.org/x/tour/pic\" rel=\"nofollow noreferrer\">http://golang.org/x/tour/pic</a> which redirects me to <a href=\"https://godoc.org/golang.org/x/tour/pic\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/tour/pic</a>. There I can read, that the function <code>show</code> is defined this way:</p>\n\n<pre><code>func Show(f func(int, int) [][]uint8)\n</code></pre>\n\n<p>Which I understand as:  </p>\n\n<blockquote>\n  <p><code>Show</code> is a function that needs one parameter. This parameter is a function that needs two parameters, both of type int, and it has to return a value of type <code>[][]uint8</code> (a slice of slices of unsigned 8-bit integers). <code>Show</code> itself doesn't return anything.</p>\n</blockquote>\n\n<p>So, here again, I read that the inner function (the parameter of <code>Show</code>) needs two parameters. But why do I get an error, when I try to provide those parameters? Why is it ok to call the function Pic without parameters? And where do the values for those parameters come from, when Pic is executed?</p>\n"}, {"tags": ["go", "stdout", "stdin"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1508945187, "post_id": 46935219, "comment_id": 80819866, "body": "So you are looking for the implementation of Message.Bytes? Any encoding that can represent all messages will do. Check out <a href=\"https://golang.org/pkg/encoding/#pkg-subdirectories\" rel=\"nofollow noreferrer\">the encoding/* packages</a>. Popular choices are encoding/json and encoding/gob."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1508945277, "post_id": 46935219, "comment_id": 80819937, "body": "On second thought, encoding/gob is only useful if all actions are Go programs."}], "answers": [{"tags": [], "owner": {"reputation": 204, "user_id": 138581, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7fec48a9caf9959bf9121e5b2bff2f5b?s=128&d=identicon&r=PG", "display_name": "Pascal Dennerly", "link": "https://stackoverflow.com/users/138581/pascal-dennerly"}, "is_accepted": false, "score": 0, "last_activity_date": 1508943034, "last_edit_date": 1508943034, "creation_date": 1508942540, "answer_id": 46935395, "question_id": 46935219, "link": "https://stackoverflow.com/questions/46935219/go-stdin-stdout-communication/46935395#46935395", "title": "Go Stdin Stdout communication", "body": "<p>There is a good example of what you need at <a href=\"https://golang.org/pkg/os/exec/#example_Cmd_StdinPip\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/exec/#example_Cmd_StdinPip</a>, <a href=\"https://golang.org/pkg/os/exec/#example_Cmd_StdoutPipe\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/exec/#example_Cmd_StdoutPipe</a> and <a href=\"https://golang.org/pkg/io/ioutil/#example_ReadAll\" rel=\"nofollow noreferrer\">https://golang.org/pkg/io/ioutil/#example_ReadAll</a></p>\n\n<p>A decent start would be something like:</p>\n\n<pre><code>stdin, err := cmd.StdinPipe()\nif err != nil {\n    log.Fatal(err)\n}\nstdout, err := cmd.StdoutPipe()\nif err != nil {\n    log.Fatal(err)\n}\ndefer stdin.Close()\nio.WriteString(stdin, msg.String())\n\nb, err := ioutil.ReadAll(stdout)\nif err != nil {\n    log.Fatal(err)\n}\nc.Logger.Infof(\"Response %s\", stdout)\n</code></pre>\n\n<p>But this solution doesn't even begin to handle edge cases such as pipes being closed early etc.</p>\n\n<p>This video does a good job of talking through stuff like this:\n<a href=\"https://www.youtube.com/watch?v=LHZ2CAZE6Gs&amp;feature=youtu.be&amp;list=PL6\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=LHZ2CAZE6Gs&amp;feature=youtu.be&amp;list=PL6</a></p>\n"}], "owner": {"reputation": 1935, "user_id": 4707978, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh6.googleusercontent.com/-bDQajnLNVEY/AAAAAAAAAAI/AAAAAAAAABE/FMwcfyWA9dg/photo.jpg?sz=128", "display_name": "Theo Bouwman", "link": "https://stackoverflow.com/users/4707978/theo-bouwman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 245, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508943034, "creation_date": 1508942086, "question_id": 46935219, "link": "https://stackoverflow.com/questions/46935219/go-stdin-stdout-communication", "title": "Go Stdin Stdout communication", "body": "<p>I want to execute a go file which I will specify in a yaml config file and send it a Struct in bytes. How could I do this?</p>\n\n<p>I thought that I could use Stdin and Stdout for this</p>\n\n<p>But can\u2019t figure it out\nYaml config:</p>\n\n<pre><code>subscribers:\n  temp:\n    topics:\n      - pi/+/temp\n    action: ./temp/tempBinary\n</code></pre>\n\n<p>this is my code:</p>\n\n<pre><code>client.Subscribe(NewTopic(a), func(c *Client, msg Message) {\n            cmd := exec.Command(v.Action)\n\n            // I actually want to send [msg] to it so it can be used there\n            cmd.Stdin = bytes.NewReader(msg.Bytes())\n\n            if err := cmd.Start(); err != nil {\n                c.Logger.Infof(\"Error while executing action: %v\", err)\n            } else {\n                c.Logger.Info(\"Executed command\")\n            }\n\n            // I want to handle responses from the called binary\n            var out bytes.Buffer\n            cmd.Stdout = &amp;out\n            c.Logger.Infof(\"Response: %v\", out)\n        })\n</code></pre>\n\n<p>I can't figure out how exactly I could do this.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3518, "user_id": 3384609, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1cb30cda6294521f9c6e60277504c5c2?s=128&d=identicon&r=PG", "display_name": "Clintm", "link": "https://stackoverflow.com/users/3384609/clintm"}, "edited": false, "score": 1, "creation_date": 1508941144, "post_id": 46934815, "comment_id": 80816922, "body": "Pshh\u2026 that was totally it. Thanks! I&#39;ll mark this as accepted. It&#39;s saying I have to wait a few minutes. Not sure why."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1508940974, "creation_date": 1508940974, "answer_id": 46934815, "question_id": 46934618, "link": "https://stackoverflow.com/questions/46934618/why-am-i-seeing-multi-line-standard-output-for-what-should-be-a-single-line-writ/46934815#46934815", "title": "Why am I seeing multi line standard output for what should be a single line writer?", "body": "<p>The docs for that package state</p>\n\n<blockquote>\n  <p>[uilive] provides a buffered io.Writer that is flushed at a timed interval.</p>\n</blockquote>\n\n<p>You're simply writing faster than the output buffer is being flushed. If you want the buffer to be flushed after every write, call <code>Flush()</code> after every write.</p>\n\n<pre><code>fmt.Fprintf(writer, \"Size: %f GB\\n\", size/(kb*kb*kb))\nwriter.Flush()\n</code></pre>\n"}], "owner": {"reputation": 3518, "user_id": 3384609, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1cb30cda6294521f9c6e60277504c5c2?s=128&d=identicon&r=PG", "display_name": "Clintm", "link": "https://stackoverflow.com/users/3384609/clintm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 46934815, "answer_count": 1, "score": 1, "last_activity_date": 1508940974, "creation_date": 1508940390, "question_id": 46934618, "link": "https://stackoverflow.com/questions/46934618/why-am-i-seeing-multi-line-standard-output-for-what-should-be-a-single-line-writ", "title": "Why am I seeing multi line standard output for what should be a single line writer?", "body": "<p>Here's my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"path/filepath\"\n\n    \"github.com/gosuri/uilive\"\n)\n\nvar writer = uilive.New()\n\nconst kb = 1024.00\n\nfunc main() {\n    writer.Start()\n    // start listening for updates and render\n    dirSize(os.Args[1])\n    writer.Stop()\n}\n\nfunc dirSize(path string) (float64, error) {\n    // todo check if path exists\n    var size float64\n    err := filepath.Walk(path, func(_ string, info os.FileInfo, err error) error {\n        if !info.IsDir() {\n            size += float64(info.Size())\n            fmt.Fprintf(writer, \"Size: %f GB\\n\", size/(kb*kb*kb))\n\n        }\n        return err\n    })\n    return size, err\n}\n</code></pre>\n\n<p>You can grab uilive with:</p>\n\n<pre><code>go get github.com/gosuri/uilive\n</code></pre>\n\n<p>The code is in $GOPATH/diskusage. When I run it with:</p>\n\n<pre><code>go build &amp;&amp; ./diskusage \"/Users/clint/Music\"\n</code></pre>\n\n<p>Here's what it looks like (outputting on multiple lines):</p>\n\n<p><a href=\"https://i.stack.imgur.com/zhXXH.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zhXXH.gif\" alt=\"enter image description here\"></a></p>\n\n<p>Here's something like I expected it to look like with the output on the same line:</p>\n\n<p><a href=\"https://i.stack.imgur.com/nzByr.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nzByr.gif\" alt=\"enter image description here\"></a></p>\n\n<p>The uilive.Writer code looks like it's thread safe:\n<a href=\"https://github.com/gosuri/uilive/blob/master/writer.go\" rel=\"nofollow noreferrer\">https://github.com/gosuri/uilive/blob/master/writer.go</a></p>\n\n<p>I don't understand why it's outputting multiple lines when it should only be writing to a single line.</p>\n\n<p>Anyone have any ideas?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 9, "last_activity_date": 1551095169, "last_edit_date": 1551095169, "creation_date": 1508939031, "answer_id": 46934089, "question_id": 46934025, "link": "https://stackoverflow.com/questions/46934025/check-if-exec-cmd-is-done-running-in-go/46934089#46934089", "title": "Check if exec.Cmd is done running in Go", "body": "<p>Maybe run synchronously in a goroutine and put the result on a channel you can select on?</p>\n\n<pre><code>c := exec.Command(\"omxplayer\", \"video.mp4\")\n// setup pipes and such\nch := make(chan error)\ngo func(){\n  ch &lt;- c.Run()\n}()\nselect{\n  case err := &lt;- ch:\n    // done! check error\n  case .... //timeouts, ticks or anything else\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1360, "user_id": 923275, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bdff2cc237e0f423706563be675e6648?s=128&d=identicon&r=PG", "display_name": "17xande", "link": "https://stackoverflow.com/users/923275/17xande"}, "is_accepted": false, "score": 1, "last_activity_date": 1509463936, "creation_date": 1509463936, "answer_id": 47039106, "question_id": 46934025, "link": "https://stackoverflow.com/questions/46934025/check-if-exec-cmd-is-done-running-in-go/47039106#47039106", "title": "Check if exec.Cmd is done running in Go", "body": "<p>A slightly different approach to captncraig's answer that worked for me:</p>\n\n<pre><code>c := exec.Command(\"omxplayer\", \"video.mp4\")\nerr := c.Start() // starts the specified command but does not wait for it to complete\n\n// wait for the program to end in a goroutine\ngo func() {\n  err := c.Wait()\n  // logic to run once process finished. Send err in channel if necessary\n}()\n</code></pre>\n"}], "owner": {"reputation": 1360, "user_id": 923275, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bdff2cc237e0f423706563be675e6648?s=128&d=identicon&r=PG", "display_name": "17xande", "link": "https://stackoverflow.com/users/923275/17xande"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3697, "favorite_count": 0, "accepted_answer_id": 46934089, "answer_count": 2, "score": 5, "last_activity_date": 1551095169, "creation_date": 1508938868, "question_id": 46934025, "link": "https://stackoverflow.com/questions/46934025/check-if-exec-cmd-is-done-running-in-go", "title": "Check if exec.Cmd is done running in Go", "body": "<p>I'm trying to check if an <code>exec.Cmd</code> <strong>is running</strong> in these scenarios:</p>\n\n<ol>\n<li>Before I actually started the command</li>\n<li>After the command has started, but before it finished</li>\n<li>After the command has finished</li>\n</ol>\n\n<p>This will allow me to kill this command if it is running so that I can start it again with different parameters.</p>\n\n<p>A simple use case below:</p>\n\n<pre><code>c := exec.Command(\"omxplayer\", \"video.mp4\")\ns, _ := c.StdinPipe() // use the pipe to send the \"q\" string to quit omxplayer\n\nlog.Printf(\"Running (false): %v\\n\", checkRunning(c)) // prints false: command has not started yet\nc.Start()\nlog.Printf(\"Running (true): %v\\n\", checkRunning(c)) // print true: command has started\n\ntime.AfterFunc(3*time.Second, func() {\n  log.Println(\"about to quit process...\")\n  log.Printf(\"Running (true): %v\\n\", checkRunning(c)) // prints true: command still running at this point\n  s.Write([]byte(\"q\"))\n})\n\nlog.Println(\"waiting for command to end\")\nlog.Printf(\"Running (true): %v\\n\", checkRunning(c)) // prints true: command still running at this point\nc.Wait()\nlog.Println(\"command should have ended by now\")\nlog.Printf(\"Running (false): %v\\n\", checkRunning(c)) // prints false: command ended at this point\n</code></pre>\n\n<p>Here's the best that I could come up with:</p>\n\n<pre><code>func checkRunning(cmd *exec.Cmd) bool {\n  if cmd == nil || cmd.ProcessState != nil &amp;&amp; cmd.ProcessState.Exited() || cmd.Process == nil {\n    return false\n  }\n\n  return true\n}\n</code></pre>\n\n<p>It works for the use case above, but it seems overly complicated and I'm not sure how reliable it is.</p>\n\n<p>Is there a better way?</p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1508956732, "post_id": 46933538, "comment_id": 80826683, "body": "why do you know that ? what&#39;s the error ?"}], "answers": [{"tags": [], "owner": {"reputation": 391, "user_id": 1315205, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/085893bc1adca303abdd3b9595bd00ca?s=128&d=identicon&r=PG", "display_name": "Piotr Kowalczuk", "link": "https://stackoverflow.com/users/1315205/piotr-kowalczuk"}, "is_accepted": false, "score": 0, "last_activity_date": 1568269174, "last_edit_date": 1568269174, "creation_date": 1509307645, "answer_id": 47004708, "question_id": 46933538, "link": "https://stackoverflow.com/questions/46933538/how-to-close-grpc-stream-for-server/47004708#47004708", "title": "How to close grpc stream for server", "body": "<p>First of all, you should not think about gRPC in terms of connections. \n<code>ServerStream</code> will stop to send data as soon as handler returns an <code>error</code>. There is no need on the server-side to have a function like <code>CloseSend</code>. </p>\n\n<p>If you want to execute some logic after return, just spawn a goroutine.</p>\n"}], "owner": {"reputation": 996, "user_id": 5156646, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/d51f0ac02939a9cf8d85df751e01d21c?s=128&d=identicon&r=PG&f=1", "display_name": "Jim Green", "link": "https://stackoverflow.com/users/5156646/jim-green"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 4303, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568269174, "creation_date": 1508937515, "last_edit_date": 1508939682, "question_id": 46933538, "link": "https://stackoverflow.com/questions/46933538/how-to-close-grpc-stream-for-server", "title": "How to close grpc stream for server", "body": "<p>From the grpc , the client could invoke CloseSend to close the stream to the server, But it seems that the server could not cut off the connection to the client.</p>\n"}, {"tags": ["go", "sdk", "terraform"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1508937104, "post_id": 46932679, "comment_id": 80813691, "body": "Terraform doesn&#39;t have a &quot;go-SDK&quot; per say, it really isn&#39;t designed to be used as a library. Automated systems using terraform execute the terraform binary."}, {"owner": {"reputation": 992, "user_id": 4286896, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh5.googleusercontent.com/-AWVwGr7o7KE/AAAAAAAAAAI/AAAAAAAAABs/PtzgaL6_iJM/photo.jpg?sz=128", "display_name": "Sujai Sivasamy", "link": "https://stackoverflow.com/users/4286896/sujai-sivasamy"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508995891, "post_id": 46932679, "comment_id": 80840023, "body": "Thanks for your response @JimB. So should I go with executing the terraform binary to perform operations? Will that be efficient enough?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1509043651, "post_id": 46932679, "comment_id": 80870812, "body": "What do you mean by &quot;efficient enough&quot;? Starting a new process isn&#39;t inefficient, and terraform will need to start more subprocess anyway. If you want to see how things work, you need to start at the top in main and walk your way down. There&#39;s a lot that needs to happen. Also note that because this isn&#39;t intended as a library, there is no compatibility contract for any of these APIs, and they can and will change at any time."}, {"owner": {"reputation": 992, "user_id": 4286896, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh5.googleusercontent.com/-AWVwGr7o7KE/AAAAAAAAAAI/AAAAAAAAABs/PtzgaL6_iJM/photo.jpg?sz=128", "display_name": "Sujai Sivasamy", "link": "https://stackoverflow.com/users/4286896/sujai-sivasamy"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1509043893, "post_id": 46932679, "comment_id": 80870939, "body": "Yes that&#39;s right. I started automating it via binary. Thanks for your response."}], "owner": {"reputation": 992, "user_id": 4286896, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh5.googleusercontent.com/-AWVwGr7o7KE/AAAAAAAAAAI/AAAAAAAAABs/PtzgaL6_iJM/photo.jpg?sz=128", "display_name": "Sujai Sivasamy", "link": "https://stackoverflow.com/users/4286896/sujai-sivasamy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2006, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1608797445, "creation_date": 1508935126, "question_id": 46932679, "link": "https://stackoverflow.com/questions/46932679/integration-with-terraform-go-sdk", "title": "Integration with terraform go-SDK", "body": "<p>I am trying to integrate <strong>Terraform</strong> go-SDK with my go-code where I already have an terraform template file and I need to create the infrastructure by importing that file to the go-SDK. I am not able to find any related documents. I tried with the <strong><a href=\"https://godoc.org/github.com/hashicorp/terraform\" rel=\"nofollow noreferrer\">godoc</a></strong> for terraform. With a little understanding, I tried to implement a simple terraform template. My terraform template file is,</p>\n\n<pre><code>provider \"aws\" {\n  access_key = \"xxxx\"\n  secret_key = \"xxxx\"\n  region     = \"xxxx\"\n}\n\nresource \"aws_instance\" \"example\" {\n  ami           = \"ami-xxxx\"\n  instance_type = \"t2.micro\"\n\n # The name of our SSH keypair.\n  key_name      = \"xxxx\" \n\n # Security groupID\n  vpc_security_group_ids = [\"sg-xxxx\"]\n\n #Subnet ID\n  subnet_id = \"subnet-xxxx\"\n\n}\n</code></pre>\n\n<p>I tried via commandLine and I am able to bring up an instance with this file.\nI tried the same via my go-code. My understanding is that I need to create a <strong>Context</strong> in order to <strong>apply</strong> it. For creating a <strong>Context,</strong> I need a <strong>module.Tree.</strong> So I tried creating a <strong>module.Tree</strong> with <strong>config.Config.</strong> I imported the above <strong>terraform</strong> template file to my go-code to create a <strong>config</strong> and a <strong>tree</strong>. My go-code looks like,</p>\n\n<pre><code>package main\n\nimport (\n   \"github.com/hashicorp/terraform/config\"\n   \"github.com/hashicorp/terraform/config/module\"\n   \"fmt\"\n)\n\nfunc main() {\n   con, err := config.LoadFile(path to .tf file)\n   fmt.Println(\"Config: \", con)\n   fmt.Println(\"Error: \", err)\n\n   fmt.Println(\"Validate: \", con.Validate())\n\n   tree := module.NewTree(\"testTree\", con)\n   fmt.Println(\"Tree: \", tree.String())\n}\n</code></pre>\n\n<p>When I execute my code, I am not getting any errors for loading the config from file, or validating the same. But I am getting the output as \"tree not loaded\",</p>\n\n<pre><code>Output:\nConfig:  &amp;{ &lt;nil&gt; &lt;nil&gt; [] [0xc4201cd0c0] [0xc4201f03c0] [] [] [] []}\nError:  &lt;nil&gt;\nValidate:  &lt;nil&gt;\nTree:  testTree  not loaded\n</code></pre>\n\n<p>Can someone help me out to implement this? Thanks in advance.</p>\n"}, {"tags": ["docker", "caching", "go", "build"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1508938296, "post_id": 46932077, "comment_id": 80814582, "body": "You don&#39;t re-use the pkg directory in the first set of commands, only src. pkg contains the &quot;cache&quot;."}, {"owner": {"reputation": 101, "user_id": 3332681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35cba3885fa0b634ab1b7585da4240fa?s=128&d=identicon&r=PG&f=1", "display_name": "colega", "link": "https://stackoverflow.com/users/3332681/colega"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1508941315, "post_id": 46932077, "comment_id": 80817056, "body": "Sorry, @Peter, you&#39;re right, I&#39;ve attached the wrong example (I also noticed that issue because the second <code>rm</code> command failed), but the results are the same mounting whole $GOPATH folder"}], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 3332681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35cba3885fa0b634ab1b7585da4240fa?s=128&d=identicon&r=PG&f=1", "display_name": "colega", "link": "https://stackoverflow.com/users/3332681/colega"}, "edited": false, "score": 0, "creation_date": 1509005794, "post_id": 46935494, "comment_id": 80845336, "body": "I&#39;m mounting my local $GOPATH to container&#39;s $GOPATH, shouldn&#39;t that include $GOPATH/pkg? Actually the data I have on my local machine in $GOPATH/pkg/linux_amd64 is the data from the Docker container (as I stated, my local machine is a darwin_amd64"}], "tags": [], "owner": {"reputation": 116, "user_id": 1696780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe6116b69ce99e0ed9928b95e6dddb5b?s=128&d=identicon&r=PG&f=1", "display_name": "AleGra", "link": "https://stackoverflow.com/users/1696780/alegra"}, "is_accepted": false, "score": 0, "last_activity_date": 1508942801, "creation_date": 1508942801, "answer_id": 46935494, "question_id": 46932077, "link": "https://stackoverflow.com/questions/46932077/golang-compilation-cache-from-docker/46935494#46935494", "title": "Golang compilation cache from Docker", "body": "<p>When you are building inside the golang container, it is using the directory $GOPATH/pkg <em>inside this container</em>. If you then start another golang container, it has an empty $GOPATH/pkg. However if you continue to use the same container (with exec), the $GOPATH/pkg is re-used.</p>\n\n<p><code>rm -r $GOPATH/pkg/linux_amd64</code> will only remove this directory on your local machine. So this has no effect.</p>\n\n<p>A possible alternative to re-using the same container could be</p>\n\n<ul>\n<li>to commit the container after the first build, or</li>\n<li>to mount $GOPATH/pkg as volume from your host machine or a data volume.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 354, "user_id": 5262104, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b64aa1e35a57e8869a5eb58466526530?s=128&d=identicon&r=PG&f=1", "display_name": "pkm", "link": "https://stackoverflow.com/users/5262104/pkm"}, "is_accepted": false, "score": 0, "last_activity_date": 1509038931, "creation_date": 1509038931, "answer_id": 46960424, "question_id": 46932077, "link": "https://stackoverflow.com/questions/46932077/golang-compilation-cache-from-docker/46960424#46960424", "title": "Golang compilation cache from Docker", "body": "<p>Use the -v flag to print which packages are getting compiled. This might be a better indicator than time spent.</p>\n\n<p>I was able to produce the desired result by mounting the gopath as volume (as you have done, so it should work...). Please see below snippet. First time it compiles both packages, second time just the main.</p>\n\n<p>Side note: one issue i've had with this approach is the volume dir will \"overwrite\" (i.e. shadow) anything already in the image at that dir, which is fine if you are using just the base golang alpine image since /go should be empty.</p>\n\n<pre><code>pkm$ tree\n.\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 github.com\n        \u251c\u2500\u2500 org1\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 mine\n        \u2502\u00a0\u00a0     \u2514\u2500\u2500 main.go\n        \u2514\u2500\u2500 org2\n            \u2514\u2500\u2500 somelib\n                \u2514\u2500\u2500 lib.go\n\n6 directories, 2 files\npkm$ docker run --rm -v $GOPATH:/go golang:1.9-alpine go build -i -v github.com/org1/mine\ngithub.com/org2/somelib\ngithub.com/org1/mine\npkm$ tree\n.\n\u251c\u2500\u2500 mine\n\u251c\u2500\u2500 pkg\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 linux_amd64\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 github.com\n\u2502\u00a0\u00a0         \u2514\u2500\u2500 org2\n\u2502\u00a0\u00a0             \u2514\u2500\u2500 somelib.a\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 github.com\n        \u251c\u2500\u2500 org1\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 mine\n        \u2502\u00a0\u00a0     \u2514\u2500\u2500 main.go\n        \u2514\u2500\u2500 org2\n            \u2514\u2500\u2500 somelib\n                \u2514\u2500\u2500 lib.go\n\n10 directories, 4 files\npkm$ docker run --rm -v $GOPATH:/go golang:1.9-alpine go build -i -v github.com/org1/mine\ngithub.com/org1/mine\npkm$ \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 427, "user_id": 6568632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf21ce78b7d4a6770c8130b5b6d35aa4?s=128&d=identicon&r=PG&f=1", "display_name": "Sean W", "link": "https://stackoverflow.com/users/6568632/sean-w"}, "is_accepted": false, "score": 2, "last_activity_date": 1539437962, "last_edit_date": 1539437962, "creation_date": 1539430280, "answer_id": 52792455, "question_id": 46932077, "link": "https://stackoverflow.com/questions/46932077/golang-compilation-cache-from-docker/52792455#52792455", "title": "Golang compilation cache from Docker", "body": "<p>To anyone who landed here from google search, i have found a working answer on a <a href=\"https://www.reddit.com/r/golang/comments/9foeun/go_build_with_docker_is_too_slow/e5y1skf\" rel=\"nofollow noreferrer\">reddit post</a>.</p>\n\n<p>It basically says to map the <code>/root/.cache/go-build</code> to your host go build cache folder.</p>\n\n<p>In my case, i am on windows and have a project that requires cross compilation with gcc, i had to spin up a linux container to build the binary to be deploy to a alpine container, and i map it to a data volume instead:</p>\n\n<p><code>some-volume-name:/root/.cache/go-build</code></p>\n"}], "owner": {"reputation": 101, "user_id": 3332681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35cba3885fa0b634ab1b7585da4240fa?s=128&d=identicon&r=PG&f=1", "display_name": "colega", "link": "https://stackoverflow.com/users/3332681/colega"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1806, "favorite_count": 1, "answer_count": 3, "score": 4, "last_activity_date": 1539437962, "creation_date": 1508933413, "last_edit_date": 1508941218, "question_id": 46932077, "link": "https://stackoverflow.com/questions/46932077/golang-compilation-cache-from-docker", "title": "Golang compilation cache from Docker", "body": "<p>I'm using the official golang alpine image to compile my source code (my host machine is a Mac), and I've noticed that even when mounting whole <code>$GOPATH</code> inside of the container it doesn't use cached data from previous builds. I checked that it creates it in the <code>$GOPATH/pkg</code> directory, but it does not affect the subsequent builds speed.</p>\n\n<p>However, if I reuse the same container for several compilation, it does make use of some kind of cache, you can see the results in this experiment I did:</p>\n\n<p>Using different containers, time remains around 28-30s in each build:</p>\n\n<pre><code>$ rm -r $GOPATH/pkg/linux_amd64\n$ time docker run -v$GOPATH:/go -e CGO_ENABLED=0 golang:1.9-alpine3.6 go build -i github.com/myrepo/mypackage\n...\n0.02s user 0.08s system 0% cpu 30.914 total\n\n$ time docker run -v$GOPATH:/go -e CGO_ENABLED=0 golang:1.9-alpine3.6 go build -i github.com/myrepo/mypackage\n...\n0.02s user 0.07s system 0% cpu 28.128 total\n</code></pre>\n\n<p>Reusing the same container, subsequent builds are much faster:</p>\n\n<pre><code>$ rm -r $GOPATH/pkg/linux_amd64    \n$ docker run -d -v$GOPATH:/go -e CGO_ENABLED=0 golang:1.9-alpine3.6 tail -f /dev/null\nbb4c08867bf2a28ad87facf00fa9dcf2800ad480fe1e66eb4d8a4947a6efec1d\n\n$ time docker exec bb4c08867bf2 go build -i github.com/myrepo/mypackage\n...\n0.02s user 0.05s system 0% cpu 27.028 total\n\n$ time docker exec bb4c08867bf2 go build -i github.com/myrepo/mypackage\n0.02s user 0.06s system 0% cpu 7.409 total\n</code></pre>\n\n<p>Is Go using any kind of cache in some place outside of <code>$GOPATH</code>? </p>\n"}, {"tags": ["go", "reflection", "slice"], "answers": [{"comments": [{"owner": {"reputation": 3557, "user_id": 172132, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/53a09bb289b100111e13440ba3324eb3?s=128&d=identicon&r=PG", "display_name": "cimnine", "link": "https://stackoverflow.com/users/172132/cimnine"}, "edited": false, "score": 0, "creation_date": 1508930961, "post_id": 46930384, "comment_id": 80809170, "body": "Would it be correct to say that, because I didn&#39;t pass a reference into <code>reflect.ValueOf</code>, every operation I performed using <code>reflect.*</code> was applied to a copy and therefore there was no way to modify the original <code>a</code>?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1508931602, "last_edit_date": 1508931602, "creation_date": 1508928434, "answer_id": 46930384, "question_id": 46929830, "link": "https://stackoverflow.com/questions/46929830/appending-to-a-slice-using-reflection/46930384#46930384", "title": "Appending to a slice using reflection", "body": "<p>You can't modify the value wrapped in <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a> if it originates from a non-pointer. If it would be allowed, you could only modify a copy and would cause more confusion. A slice value is a header containing a pointer to a backing array, a length and a capacity. When you pass <code>a</code> to <code>reflect.ValueOf()</code>, a copy of this header is made and passed, and any modification you could do on it could only modify this header-copy. Adding elements (and thus changing its length and potentially the pointer and capacity) would not be observed by the original slice header, the original would still point to the same array, and would still contain the same length and capacity values. For details see <a href=\"https://stackoverflow.com/questions/33995634/are-golang-function-parameter-passed-as-copy-on-write/33995762#33995762\">Are Golang function parameter passed as copy-on-write?</a>; and <a href=\"https://stackoverflow.com/questions/40514555/golang-passing-arrays-to-the-function-and-modifying-it/40514753#40514753\">Golang passing arrays to the function and modifying it</a>.</p>\n\n<p>You have to start from a pointer, and you may use <a href=\"https://golang.org/pkg/reflect/#Value.Elem\" rel=\"nofollow noreferrer\"><code>Value.Elem()</code></a> to obtain the <code>reflect.Value</code> descriptor of the pointed, dereferenced value. But you must start from a pointer.</p>\n\n<p>Changing this single line in your code makes it work:</p>\n\n<pre><code>v := reflect.ValueOf(&amp;a).Elem()\n</code></pre>\n\n<p>And also to print the type of a value, use the <code>%T</code> verb (<code>%t</code> is for <code>bool</code> values):</p>\n\n<pre><code>fmt.Printf(\"%T\\n\\n\", v.Type())\nfmt.Printf(\"%T\\n\\n\", v.Type().Elem().Kind())\n\n// ...\n\nfmt.Printf(\"%T - %v\", a, a)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/d9PzernZ6V\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Hello, playground\n*reflect.rtype\n\nreflect.Kind\n\n[]string - [a b c d e]\n</code></pre>\n\n<p>For a deeper understanding of Go's reflection, read the blog post: <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">The Laws of Reflection</a></p>\n\n<p>And read related questions+answers:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/28115815/assigning-a-value-to-struct-member-through-reflection-in-go/28116053#28116053\">Assigning a value to struct member through reflection in Go</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/46342228/changing-pointer-type-and-value-under-interface-with-reflection/46342394#46342394\">Changing pointer type and value under interface with reflection</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/44255344/using-reflection-setstring/44255582#44255582\">Using reflection SetString</a></p>\n"}], "owner": {"reputation": 3557, "user_id": 172132, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/53a09bb289b100111e13440ba3324eb3?s=128&d=identicon&r=PG", "display_name": "cimnine", "link": "https://stackoverflow.com/users/172132/cimnine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 965, "favorite_count": 0, "accepted_answer_id": 46930384, "answer_count": 1, "score": 0, "last_activity_date": 1508931602, "creation_date": 1508926841, "last_edit_date": 1508928663, "question_id": 46929830, "link": "https://stackoverflow.com/questions/46929830/appending-to-a-slice-using-reflection", "title": "Appending to a slice using reflection", "body": "<p>I would like to append to a slice using only reflection. But I can't figure out how to \"replace\" the value of <code>a</code> with the new slice.</p>\n\n<pre><code>func main() {\n    fmt.Println(\"Hello, playground\")\n\n    a := []string {\"a\",\"b\",\"c\"}\n\n    values := []string {\"d\",\"e\"}\n\n    v := reflect.ValueOf(a)\n\n    fmt.Printf(\"%t\\n\\n\", v.Type())\n    fmt.Printf(\"%t\\n\\n\", v.Type().Elem().Kind())\n\n    for _, val := range values {\n        v.Set(reflect.Append(v, reflect.ValueOf(val)))\n    }\n\n    fmt.Printf(\"%t - %v\", a, a)\n}\n</code></pre>\n\n<p>This code is available for fiddling at <a href=\"https://play.golang.org/p/cDlyH3jBDS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/cDlyH3jBDS</a>.</p>\n"}, {"tags": ["docker", "go", "containers"], "comments": [{"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1508918541, "post_id": 46926819, "comment_id": 80800882, "body": "Have experience something similar once and it turned out that some process outside docker had a lock on a volume file and didn&#39;t allow removing the container. So had to kill that process. Run <code>sudo lsof | grep docker</code> and see if you can find any process causing issue"}, {"owner": {"reputation": 1767, "user_id": 1595977, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/KWme4.jpg?s=128&g=1", "display_name": "Edwin", "link": "https://stackoverflow.com/users/1595977/edwin"}, "edited": false, "score": 0, "creation_date": 1508918591, "post_id": 46926819, "comment_id": 80800910, "body": "try to bash into the container and kill any weird process, you can check for strange things with <code>stats</code>or <code>top</code>. After that try again the <code>rm -f</code> command."}], "owner": {"reputation": 81, "user_id": 1256521, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/610369156b6e099570ca8adc371b82fe?s=128&d=identicon&r=PG", "display_name": "preator", "link": "https://stackoverflow.com/users/1256521/preator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1508917784, "creation_date": 1508917784, "question_id": 46926819, "link": "https://stackoverflow.com/questions/46926819/docker-container-crashes-problematic-managing-container-after-that", "title": "Docker container crashes - problematic managing container after that", "body": "<p>I run:</p>\n\n<ul>\n<li>docker: Docker version 17.03.0-ce, build 60ccb22</li>\n<li>linux: Ubuntu 16.04.2 LTS</li>\n</ul>\n\n<p>Image inside docker container runs some golang app, which (I found this know) wasn't properly dealing with errors. I should include os.Exit(1) for cases like mine, for error checking.</p>\n\n<p>I run/start docker container with command like</p>\n\n<p><code>\ndocker run -it --restart=always --env-file ~/PRODUCTION/services/resolvment_api/.environmet_variables -p 8081:3003 --name resolvment_2 -d resolvment-api\n</code></p>\n\n<p>Ok, then it looks like an error occur inside a docker container on app level. At this point something strange happens to docker/docker container. </p>\n\n<p>If i do <code>docker ps</code> I can see </p>\n\n<p><code>2e7b02258647        resolvment-api   \"/bin/sh -c $GOBIN...\"   9 days ago          Up 37 hours         0.0.0.0:8081-&gt;3003/tcp   resolvment_2\n</code></p>\n\n<ol>\n<li><p>I can do <code>docker logs 2e7b02258647</code> and will see logs. </p></li>\n<li><p>If I try to do <code>docker stop 2e7b02258647</code> I get container id in next line as usually when you successfully stop a container. Then if i do <code>docker ps</code> again... I can still see docker container (with same id) listed there?!</p></li>\n<li><p>If I then try to forcefully remove the container with <code>docker rm -f 2e7b02258647</code> I get an error \n<code>Error response from daemon: Unable to remove filesystem for 2e7b02258647ec357fd1beb0083ad678eb381474f1315b3e524d318472c5f061: remove /var/lib/docker/containers/2e7b02258647ec357fd1beb0083ad678eb381474f1315b3e524d318472c5f061/shm: device or resource busy\n</code> but docker container is not listed anymore under <code>docker ps</code>.</p></li>\n<li><p>Then I want to add/start again the container with command <code>docker run -it --restart=always --env-file ~/PRODUCTION/services/resolvment_api/.enviroment_variables -p 8081:3003 --name resolvment_2 -d resolvment-api</code></p></li>\n</ol>\n\n<p>and the error that i get as response is this: <code>fc174f65cc34a2573563729acfe11436370ab08965be553e682d82e7af06b236\ndocker: Error response from daemon: service endpoint with name resolvment_2 already exists.</code></p>\n\n<p>so i do <code>docker rm resolvment_2</code>, and try to start again... but same error. </p>\n\n<p>if i put -f with rm command... doesn't help either. </p>\n\n<p>So, rm/run/rm/run.... walking in circle... doesn't help. </p>\n\n<p>And I can't just restart docker daemon, since there are few other containers running. </p>\n\n<p>Would really aprechiate some help on this. </p>\n\n<p>Best,\nTomaz</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1508916685, "post_id": 46926380, "comment_id": 80799771, "body": "What happens if you call <code>go get -u golang.org&#47;x&#47;tools&#47;cmd&#47;goimports</code> from the command line yourself?"}, {"owner": {"reputation": 4546, "user_id": 1170686, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/12481de846966844777303898e3b9dda?s=128&d=identicon&r=PG", "display_name": "ankush981", "link": "https://stackoverflow.com/users/1170686/ankush981"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1508916778, "post_id": 46926380, "comment_id": 80799834, "body": "Same: <code>package golang.org&#47;x&#47;tools&#47;cmd&#47;goimports: cannot find package &quot;golang.org&#47;x&#47;tools&#47;cmd&#47;goimports&quot; in any of: \t&#47;usr&#47;local&#47;go&#47;src&#47;golang.org&#47;x&#47;tools&#47;cmd&#47;goimports (from $GOROOT) \t&#47;home&#47;ankush&#47;go&#47;src&#47;golang.org&#47;x&#47;tools&#47;cmd&#47;goimports (from $GOPATH)</code>"}, {"owner": {"reputation": 4546, "user_id": 1170686, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/12481de846966844777303898e3b9dda?s=128&d=identicon&r=PG", "display_name": "ankush981", "link": "https://stackoverflow.com/users/1170686/ankush981"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1508918971, "post_id": 46926380, "comment_id": 80801137, "body": "@gonutz I&#39;m ready to a new install also, but am not sure how to again fill the $GOPATH once I&#39;ve unzipped Go to $GOROOT. :-|"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1508938812, "post_id": 46926380, "comment_id": 80814945, "body": "Add <code>-v</code> to the go get command and, if that doesn&#39;t show the problem, add the output to your question."}, {"owner": {"reputation": 4546, "user_id": 1170686, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/12481de846966844777303898e3b9dda?s=128&d=identicon&r=PG", "display_name": "ankush981", "link": "https://stackoverflow.com/users/1170686/ankush981"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1508946595, "post_id": 46926380, "comment_id": 80820875, "body": "@Peter Sorry, that didn&#39;t help. I&#39;ve added the output to my original question."}, {"owner": {"reputation": 679, "user_id": 2888403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9ffa065886a8362661b8f85b2a7156a?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2888403/david"}, "edited": false, "score": 0, "creation_date": 1508952964, "post_id": 46926380, "comment_id": 80824561, "body": "recommend setting the GOPATH and retry."}, {"owner": {"reputation": 4546, "user_id": 1170686, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/12481de846966844777303898e3b9dda?s=128&d=identicon&r=PG", "display_name": "ankush981", "link": "https://stackoverflow.com/users/1170686/ankush981"}, "reply_to_user": {"reputation": 679, "user_id": 2888403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9ffa065886a8362661b8f85b2a7156a?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2888403/david"}, "edited": false, "score": 0, "creation_date": 1508990667, "post_id": 46926380, "comment_id": 80838489, "body": "@David GOPATH is set correctly in my case. Please see the <code>go env</code> output in the updated original question."}], "answers": [{"tags": [], "owner": {"reputation": 4546, "user_id": 1170686, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/12481de846966844777303898e3b9dda?s=128&d=identicon&r=PG", "display_name": "ankush981", "link": "https://stackoverflow.com/users/1170686/ankush981"}, "is_accepted": false, "score": 1, "last_activity_date": 1509004769, "creation_date": 1509004769, "answer_id": 46948809, "question_id": 46926380, "link": "https://stackoverflow.com/questions/46926380/src-golang-org-directory-missing/46948809#46948809", "title": "src/golang.org directory missing", "body": "<p>I was finally able to solve it. For someone else who gets bitten by this in future, in my case it helped to remove the concerned directory and then install again. Here's what helped:</p>\n\n<pre><code>$ rm -rf /home/ankush/go/src/golang.org/x/tools\n$ go get -u -v golang.org/x/tools/cmd/goimports\n</code></pre>\n\n<p>I'm not sure why this works, but maybe the the git pull had somehow failed earlier (sloppy connection?) as soon as the directory was created.</p>\n"}], "owner": {"reputation": 4546, "user_id": 1170686, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/12481de846966844777303898e3b9dda?s=128&d=identicon&r=PG", "display_name": "ankush981", "link": "https://stackoverflow.com/users/1170686/ankush981"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 815, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1509004769, "creation_date": 1508916303, "last_edit_date": 1508990631, "question_id": 46926380, "link": "https://stackoverflow.com/questions/46926380/src-golang-org-directory-missing", "title": "src/golang.org directory missing", "body": "<p>I'm a newcomer to Go and I think I've messed up the setup somewhere. When trying to install the Buffalo framework, I got the following error:</p>\n\n<pre><code>$ buffalo new todo-api --api\nBuffalo version v0.9.5\n\n--&gt; go get -u golang.org/x/tools/cmd/goimports\npackage golang.org/x/tools/cmd/goimports: cannot find package \"golang.org/x/tools/cmd/goimports\" in any of:\n    /usr/local/go/src/golang.org/x/tools/cmd/goimports (from $GOROOT)\n    /home/ankush/go/src/golang.org/x/tools/cmd/goimports (from $GOPATH)\n</code></pre>\n\n<p>I remember emptying the $HOME/go directory because I had just upgraded from 1.8 to 1.9, and thought that Go would somehow automatically re-download and populate it. But it didn't, it seems.</p>\n\n<p>So, is the src/golang.org directory supposed to be in $GOPATH? Because I didn't find it in $GOROOT and I had followed the standard setup instructions.</p>\n\n<p>Any suggestions?</p>\n\n<p><strong>== Update 1 ==</strong></p>\n\n<p>The GOPATH is correctly set in my case. Here's the output of <code>go env</code>:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/ankush/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build630744714=/tmp/go-build -gno-record-gcc-switches\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\n</code></pre>\n\n<p><strong>=== Update2 ===</strong></p>\n\n<p>Here's my output of <code>go get</code> for <code>goimports</code>:</p>\n\n<pre><code>go$ go get -u -v golang.org/x/tools/cmd/goimports\nFetching https://golang.org/x/tools/cmd/goimports?go-get=1\nParsing meta tags from https://golang.org/x/tools/cmd/goimports?go-get=1 (status code 200)\nget \"golang.org/x/tools/cmd/goimports\": found meta tag get.metaImport{Prefix:\"golang.org/x/tools\", VCS:\"git\", RepoRoot:\"https://go.googlesource.com/tools\"} at https://golang.org/x/tools/cmd/goimports?go-get=1\nget \"golang.org/x/tools/cmd/goimports\": verifying non-authoritative meta tag\nFetching https://golang.org/x/tools?go-get=1\nParsing meta tags from https://golang.org/x/tools?go-get=1 (status code 200)\ngolang.org/x/tools (download)\npackage golang.org/x/tools/cmd/goimports: cannot find package \"golang.org/x/tools/cmd/goimports\" in any of:\n    /usr/local/go/src/golang.org/x/tools/cmd/goimports (from $GOROOT)\n    /home/ankush/go/src/golang.org/x/tools/cmd/goimports (from $GOPATH)\n</code></pre>\n"}, {"tags": ["gcc", "go"], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 2, "last_activity_date": 1508915418, "last_edit_date": 1508915418, "creation_date": 1508915116, "answer_id": 46926028, "question_id": 46925915, "link": "https://stackoverflow.com/questions/46925915/gcc-unable-to-compile-go-program/46926028#46926028", "title": "GCC unable to compile Go Program", "body": "<p>So your C compiler does not support 64 bit compilation. One way to resolve this is to build in 32 bit mode. Go will by default try to build for the system architecture that you are on but you can modify that behavior by setting the environment variable <code>GOARCH=386</code> before building. On Windows you can type this into your cmd:</p>\n\n<pre><code>set GOARCH=386\ngo build\n</code></pre>\n\n<p>You could create a simple <code>.bat</code> batch script with this content and run that when you want to build.</p>\n\n<p>Note that 64 bit systems will run 32 bit programs just fine. This is also a nice way to make sure that when you give the <code>.exe</code> to someone else, it will run on their system (not considering other dependencies).</p>\n\n<p>If you want to upgrade your C compiler instead to build 64 bit applications, see <a href=\"https://stackoverflow.com/questions/8861105/gcc-sorry-unimplemented-64-bit-mode-not-compiled-in\">this SO thread</a>, maybe that helps.</p>\n"}], "owner": {"reputation": 1055, "user_id": 3326720, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/SeWCu.png?s=128&g=1", "display_name": "Orange Receptacle", "link": "https://stackoverflow.com/users/3326720/orange-receptacle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1578955940, "creation_date": 1508914761, "question_id": 46925915, "link": "https://stackoverflow.com/questions/46925915/gcc-unable-to-compile-go-program", "title": "GCC unable to compile Go Program", "body": "<p>I wrote a very simple program in Go using using a 2D game library.</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/hajimehoshi/ebiten\"\n    \"github.com/hajimehoshi/ebiten/ebitenutil\"\n)\n\nconst screenWidth, screenHeight = 320, 240\n\nfunc update(screen *ebiten.Image) error {\n    ebitenutil.DebugPrint(screen, \"Game test\")\n    return nil;\n}\nfunc main() {\n    if err := ebiten.Run(update, screenWidth, screenHeight, 2, \"Test\"); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>This, however, relies on GCC to compile. When running, I'm prompted with this message:</p>\n\n<pre><code># github.com/go-gl/glfw/v3.2/glfw\ncc1.exe: sorry, unimplemented: 64-bit mode not compiled in\n# github.com/go-gl/gl/v2.1/gl\ncc1.exe: sorry, unimplemented: 64-bit mode not compiled in\n</code></pre>\n\n<p>I attempted to download MinGW-w64 to rectify the issue, but it hasn't been successful.</p>\n\n<p>How would I go about resolving this?</p>\n"}, {"tags": ["go", "protocol-buffers"], "comments": [{"owner": {"reputation": 24536, "user_id": 111124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8215e290861f1c44a457d26c4f24af70?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/111124/andrew"}, "edited": false, "score": 0, "creation_date": 1508918284, "post_id": 46925704, "comment_id": 80800720, "body": "Did you compile the proto file?"}, {"owner": {"reputation": 13, "user_id": 6662341, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-iuofirDTr5o/AAAAAAAAAAI/AAAAAAAAAA8/-mVagR_SnIk/photo.jpg?sz=128", "display_name": "Shiyang Wang", "link": "https://stackoverflow.com/users/6662341/shiyang-wang"}, "reply_to_user": {"reputation": 24536, "user_id": 111124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8215e290861f1c44a457d26c4f24af70?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/111124/andrew"}, "edited": false, "score": 0, "creation_date": 1508920026, "post_id": 46925704, "comment_id": 80801773, "body": "yes, pasted my proto file above"}], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 6662341, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-iuofirDTr5o/AAAAAAAAAAI/AAAAAAAAAA8/-mVagR_SnIk/photo.jpg?sz=128", "display_name": "Shiyang Wang", "link": "https://stackoverflow.com/users/6662341/shiyang-wang"}, "is_accepted": false, "score": 0, "last_activity_date": 1510471001, "creation_date": 1510471001, "answer_id": 47246432, "question_id": 46925704, "link": "https://stackoverflow.com/questions/46925704/protobuf-how-to-parse-descriptor-message-from-fieldoptions/47246432#47246432", "title": "protobuf: how to parse descriptor message from FieldOptions", "body": "<pre><code>_, md := descriptor.ForMessage(msg.(descriptor.Message))\ninfo, err := proto.GetExtension(md.GetOptions(), cmdproto.E_Cmd)\nif err != nil {\n    panic(err)\n}\nreturn info.(*cmdproto.CommandInfo)\n</code></pre>\n\n<p>kind of like this, but the problem I actually met was this <a href=\"https://github.com/golang/protobuf/issues/372\" rel=\"nofollow noreferrer\">https://github.com/golang/protobuf/issues/372</a></p>\n"}], "owner": {"reputation": 13, "user_id": 6662341, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-iuofirDTr5o/AAAAAAAAAAI/AAAAAAAAAA8/-mVagR_SnIk/photo.jpg?sz=128", "display_name": "Shiyang Wang", "link": "https://stackoverflow.com/users/6662341/shiyang-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1178, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1510471001, "creation_date": 1508914097, "last_edit_date": 1508919995, "question_id": 46925704, "link": "https://stackoverflow.com/questions/46925704/protobuf-how-to-parse-descriptor-message-from-fieldoptions", "title": "protobuf: how to parse descriptor message from FieldOptions", "body": "<p>I have a proto file below</p>\n\n<pre><code>syntax = \"proto2\";\npackage cmd;\n\nimport \"google/protobuf/descriptor.proto\";\n\nmessage FlagDetail {\n  required string name = 1;\n  required string value = 2;\n  required string shorthand = 3;\n  required string usage = 4;\n}\n\nextend google.protobuf.FieldOptions {\n  optional FlagDetail info = 1234;\n}\n\nmessage VersionFlags {\n  optional bool client = 2 [ (info) = { name: \"client\" value: \"false\" shorthand: \"c\" usage: \"Client version only (no server required).\"}];\n  optional bool short = 3  [ (info) = { name: \"short\" value: \"false\" shorthand: \"baz\" usage: \"Print just the version number.\"}];\n  optional string output = 4 [ (info) = { name: \"output\" value: \"\" shorthand: \"o\" usage: \"One of 'yaml' or 'json'.\"}];\n}\n</code></pre>\n\n<p>How to a get an empty message's default value of FlagDetail</p>\n\n<p>some thing like this</p>\n\n<pre><code>var msg VersionFlags\nmd := ForMessage(&amp;msg)  \no := md.Field[0].GetOptions()\no.GetFlagDetail.GetName()  //unfortunately, there's no method like this\n</code></pre>\n\n<p>BTW  ForMessage() is from here : <a href=\"https://github.com/golang/protobuf/blob/master/descriptor/descriptor_test.go\" rel=\"nofollow noreferrer\">https://github.com/golang/protobuf/blob/master/descriptor/descriptor_test.go</a></p>\n\n<p>here is my proto file <a href=\"https://gist.githubusercontent.com/shiywang/3d9f53fe253bb4195d65b3626442cb66/raw/89c286599a4103f67b80a62c87c69847497fa289/protofile\" rel=\"nofollow noreferrer\">https://gist.githubusercontent.com/shiywang/3d9f53fe253bb4195d65b3626442cb66/raw/89c286599a4103f67b80a62c87c69847497fa289/protofile</a></p>\n"}, {"tags": ["csv", "go"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 5, "creation_date": 1508912750, "post_id": 46925232, "comment_id": 80797415, "body": "What is your question?"}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 2, "last_activity_date": 1508913989, "last_edit_date": 1508913989, "creation_date": 1508913624, "answer_id": 46925570, "question_id": 46925232, "link": "https://stackoverflow.com/questions/46925232/how-to-read-csv-file-and-point-its-content-to-variables/46925570#46925570", "title": "How to read csv file and point its content to variables?", "body": "<p>Look at packages: either standard <a href=\"https://golang.org/pkg/encoding/csv\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/csv</a> or if you need extra options <a href=\"https://github.com/gocarina/gocsv\" rel=\"nofollow noreferrer\">https://github.com/gocarina/gocsv</a> </p>\n\n<p>It gives you a way to define a structure and load csv file into it. </p>\n\n<pre><code>type Site struct {\n      ID int\n      Domain string\n }\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/NykL1O5Wfh\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NykL1O5Wfh</a> </p>\n"}], "owner": {"reputation": 7, "user_id": 8829575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6eb537103744100e1206b5c42b63a40f?s=128&d=identicon&r=PG&f=1", "display_name": "Kunj", "link": "https://stackoverflow.com/users/8829575/kunj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1508914338, "creation_date": 1508912334, "last_edit_date": 1508914338, "question_id": 46925232, "link": "https://stackoverflow.com/questions/46925232/how-to-read-csv-file-and-point-its-content-to-variables", "title": "How to read csv file and point its content to variables?", "body": "<p>I am trying to read csv file in golang and point its content to variables for query and writing output to new csv file. The content in csv looks like:</p>\n\n<pre>\n1,google.com\n2,netflix.com\n3,api-global.netflix.com\n4,www.google.com\n5,facebook.com\n6,microsoft.com\n7,doubleclick.net \n</pre>\n\n<p>And so on, about 10,000,000 lines.</p>\n\n<p>My code is as below</p>\n\n<pre><code>func main() {\n    qnamecsv,_:=os.Open(\"top-1m.csv\")\n    reader:=bufio.NewReader(qnamecsv)\n    for {\n      line,_,_:=reader.ReadLine()\n        fmt.Println(\"%s\",line)\n    }\n    var nameserver string = \"8.8.8.8\"\n    var qname string = \"hostname from qname csv\"\n</code></pre>\n\n<p>How can I write new file now? Thanks for any help</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "edited": false, "score": 1, "creation_date": 1508914021, "post_id": 46925090, "comment_id": 80798070, "body": "The simplest solution is to add route <code>&#47;swagger-ui</code> and redirect with 301 http code to <code>&#47;swagger-ui&#47;</code>. This is in case when gorilla can&#39;t help you in more elegant way :-)"}, {"owner": {"reputation": 1332, "user_id": 3664021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f3a9f339c82088c5bfe6be353fbae64?s=128&d=identicon&r=PG", "display_name": "leninhasda", "link": "https://stackoverflow.com/users/3664021/leninhasda"}, "edited": false, "score": 0, "creation_date": 1508917912, "post_id": 46925090, "comment_id": 80800512, "body": "Because you are stripping <code>&#47;swagger-ui&#47;</code>. and <code>&#47;swagger-ui</code> is not equal to <code>&#47;swagger-ui&#47;</code>, so that&#39;t not being removed/stripped, resulting 404!"}, {"owner": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "edited": false, "score": 1, "creation_date": 1508940915, "post_id": 46925090, "comment_id": 80816757, "body": "Ok, thanks, but doesn&#39;t give me any clue how to solve this."}], "answers": [{"comments": [{"owner": {"reputation": 327, "user_id": 895931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96864e378f03cab7a18fa31674f550d6?s=128&d=identicon&r=PG", "display_name": "Alaska", "link": "https://stackoverflow.com/users/895931/alaska"}, "edited": false, "score": 0, "creation_date": 1589472011, "post_id": 56859564, "comment_id": 109314653, "body": "This does not work with pathprefix set, as per the docs, which you quote."}], "tags": [], "owner": {"reputation": 166, "user_id": 10132227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b806233c3b8b57d4b8d06831b9c2667?s=128&d=identicon&r=PG&f=1", "display_name": "c-anirudh", "link": "https://stackoverflow.com/users/10132227/c-anirudh"}, "is_accepted": false, "score": 2, "last_activity_date": 1562098916, "creation_date": 1562098916, "answer_id": 56859564, "question_id": 46925090, "link": "https://stackoverflow.com/questions/46925090/golang-gorilla-expects-trailing-slash-on-static-serving/56859564#56859564", "title": "Golang gorilla expects trailing slash on static serving", "body": "<p>You have probably found the answer as the question is nearly two years old, but I will write the answer here so that anybody who comes across this question can see it.</p>\n\n<p>You just need to define your gorilla router as:\n<code>router := mux.NewRouter().StrictSlash(true)</code></p>\n\n<blockquote>\n  <p>StrictSlash func(value bool) *Router StrictSlash defines the trailing\n  slash behavior for new routes. The initial value is false.</p>\n  \n  <p>When true, if the route path is \"/path/\", accessing \"/path\" will\n  perform a redirect to the former and vice versa. In other words, your\n  application will always see the path as specified in the route.</p>\n  \n  <p>When false, if the route path is \"/path\", accessing \"/path/\" will not\n  match this route and vice versa.</p>\n  \n  <p>The re-direct is a HTTP 301 (Moved Permanently). Note that when this\n  is set for routes with a non-idempotent method (e.g. POST, PUT), the\n  subsequent re-directed request will be made as a GET by most clients.\n  Use middleware or client settings to modify this behaviour as needed.</p>\n  \n  <p>Special case: when a route sets a path prefix using the PathPrefix()\n  method, strict slash is ignored for that route because the redirect\n  behavior can't be determined from a prefix alone. However, any\n  subrouters created from that route inherit the original StrictSlash\n  setting.</p>\n</blockquote>\n"}], "owner": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1323, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1562098916, "creation_date": 1508911676, "question_id": 46925090, "link": "https://stackoverflow.com/questions/46925090/golang-gorilla-expects-trailing-slash-on-static-serving", "title": "Golang gorilla expects trailing slash on static serving", "body": "<p>I want to serve the swagger-ui using gorilla/mux and http.FileServer.</p>\n\n<p>This is the routing that works so far:</p>\n\n<pre><code>router := mux.NewRouter()\nrouter.PathPrefix(\"/swagger-ui/\").Handler(http.StripPrefix(\"/swagger-ui/\", \nhttp.FileServer(http.Dir(\"swagger-ui/\"))))\nhttp.ListenAndServe(\":8080\", router)\n</code></pre>\n\n<p>The problem is: only a GET /swagger-ui/ returns the swagger page.\nWhen I do (what most users also expect) a GET /swagger-ui without trailing slash I get a 404.</p>\n\n<p>How can this be solved?</p>\n"}, {"tags": ["go", "e2e-testing"], "answers": [{"tags": [], "owner": {"reputation": 536, "user_id": 615239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9411e85fea9974da09a865514c93cbf?s=128&d=identicon&r=PG", "display_name": "Andrevinsky", "link": "https://stackoverflow.com/users/615239/andrevinsky"}, "is_accepted": false, "score": 3, "last_activity_date": 1508909327, "creation_date": 1508909327, "answer_id": 46924608, "question_id": 46924457, "link": "https://stackoverflow.com/questions/46924457/what-is-the-correct-way-to-make-logging-less-verbose-chromedp/46924608#46924608", "title": "What is the correct way to make logging less verbose (chromedp)?", "body": "<p>The solution is simple:</p>\n\n<p>Code taken from their sample:</p>\n\n<pre><code>// create chrome instance\nc, err := cdp.New(ctxt, cdp.WithLog(log.Printf))\n\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>change to</p>\n\n<pre><code>// create chrome instance\nc, err := cdp.New(ctxt) // no WithLog() option\n\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": false, "score": 1, "last_activity_date": 1508909704, "last_edit_date": 1508909704, "creation_date": 1508909380, "answer_id": 46924615, "question_id": 46924457, "link": "https://stackoverflow.com/questions/46924457/what-is-the-correct-way-to-make-logging-less-verbose-chromedp/46924615#46924615", "title": "What is the correct way to make logging less verbose (chromedp)?", "body": "<p><sub>Didn't tested</sub></p>\n\n<p>I have no expirience with that package, but accourding the usage example, cbp initialized with the log function:</p>\n\n<pre><code>// create chrome instance\nc, err := cdp.New(ctxt, cdp.WithLog(log.Printf)) &lt;- in this case log.Printf\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>I assume you can set log level for the <code>log.Printf</code> with <code>log.SetFlags(0)</code> </p>\n\n<pre><code>// create chrome instance\nlog.SetFlags(0)\nc, err := cdp.New(ctxt, cdp.WithLog(log.Printf))\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>or pass an empty function(or initialize without a log function).</p>\n\n<p>There is also <code>Discard</code> to disable logging at all, <code>log.SetOutput(ioutil.Discard)</code></p>\n"}], "owner": {"reputation": 536, "user_id": 615239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9411e85fea9974da09a865514c93cbf?s=128&d=identicon&r=PG", "display_name": "Andrevinsky", "link": "https://stackoverflow.com/users/615239/andrevinsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 437, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1508909704, "creation_date": 1508908403, "question_id": 46924457, "link": "https://stackoverflow.com/questions/46924457/what-is-the-correct-way-to-make-logging-less-verbose-chromedp", "title": "What is the correct way to make logging less verbose (chromedp)?", "body": "<p>My question is this package-specific: <a href=\"https://github.com/knq/chromedp/\" rel=\"nofollow noreferrer\">https://github.com/knq/chromedp/</a></p>\n\n<p>This is just a glimpse of a log when running <strong>chromedp</strong> <code>Action</code>s. It is not event an Action-related piece. What is the correct way to make the logging silent or less verbose?</p>\n\n<p><a href=\"https://i.stack.imgur.com/2v4N9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2v4N9.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["debugging", "go", "visual-studio-code", "delve"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1508906689, "post_id": 46924030, "comment_id": 80795167, "body": "Perhaps its related to issue: <a href=\"https://github.com/Microsoft/vscode-go/issues/360\" rel=\"nofollow noreferrer\"><code>#360</code></a> or <a href=\"https://github.com/Microsoft/vscode-go/issues/941\" rel=\"nofollow noreferrer\"><code>#941</code></a>."}, {"owner": {"reputation": 33, "user_id": 7397874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fe1a4a6bf1ede10c4090ae0c9c7ff4?s=128&d=identicon&r=PG&f=1", "display_name": "tungnt751", "link": "https://stackoverflow.com/users/7397874/tungnt751"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1508913925, "post_id": 46924030, "comment_id": 80798015, "body": "@putu thanks but the issues are different from this"}], "owner": {"reputation": 33, "user_id": 7397874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0fe1a4a6bf1ede10c4090ae0c9c7ff4?s=128&d=identicon&r=PG&f=1", "display_name": "tungnt751", "link": "https://stackoverflow.com/users/7397874/tungnt751"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 747, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1508906567, "creation_date": 1508905842, "last_edit_date": 1508906567, "question_id": 46924030, "link": "https://stackoverflow.com/questions/46924030/how-to-add-breakpoint-at-runtime-when-debugging-golang-using-vscode", "title": "How to add breakpoint at runtime when debugging Golang using VSCode?", "body": "<p>After activating a debug session, the program started running. At this time, I tried to create a breakpoint. Unfortunately, it said \"Unverified Breakpoint\" and the color turned into dark black, different from the other pre-defined one (which was red). You can see more clearly on the image below. The debugger would never stop at the line of the breakpoint.</p>\n\n<p>Did I miss any steps? </p>\n\n<p><a href=\"https://i.stack.imgur.com/zEBwX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zEBwX.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 555, "user_id": 3557072, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/GwsnH.jpg?s=128&g=1", "display_name": "Camilo Crespo", "link": "https://stackoverflow.com/users/3557072/camilo-crespo"}, "edited": false, "score": 0, "creation_date": 1512278359, "post_id": 46923537, "comment_id": 82189312, "body": "Take a look at the FAQs for dep. There are is a sample on how to use Docker with dep: <a href=\"https://github.com/golang/dep/blob/master/docs/FAQ.md#how-do-i-use-dep-with-docker\" rel=\"nofollow noreferrer\">github.com/golang/dep/blob/master/docs/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 722, "user_id": 3072751, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/8J58M.jpg?s=128&g=1", "display_name": "thurt", "link": "https://stackoverflow.com/users/3072751/thurt"}, "is_accepted": true, "score": 2, "last_activity_date": 1517631508, "last_edit_date": 1517631508, "creation_date": 1517630907, "answer_id": 48593836, "question_id": 46923537, "link": "https://stackoverflow.com/questions/46923537/how-does-docker-go-wrapper-script-works/48593836#48593836", "title": "How does docker go-wrapper script works", "body": "<p>I'm not familiar with dep so I cannot comment on <em>that</em> part of your problem. However, the text you quoted relates to the canonical import path and you did not say you are using a canonical import path. You MUST use a canonical import path to get <code>go-wrapper</code> to behave like described in the quote. </p>\n\n<p>Once your package has a canonical import path (like <code>package main // import \"github.com/user/projname\"</code>) then <code>go-wrapper</code> will recognize that special comment and create a symlink from <code>go/src/github.com/user/projname</code> to <code>/go/src/app</code> <em>inside</em> the docker container. This symlink will prevent <code>go-wrapper download</code> from downloading sub-packages like <code>github.com/user/projname/subpackage</code> from the remote (github.com). </p>\n\n<p>This behavior is especially useful for me when I am developing locally because I want to test my local changes to sub-packages before I commit them to the remote. If <code>go-wrapper</code> did not symlink for me, then it would go to the remote and download each of the sub-packages, which means I would be getting the older version instead of my locally edited sub-packages.</p>\n"}], "owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3342, "favorite_count": 0, "accepted_answer_id": 48593836, "answer_count": 1, "score": 3, "last_activity_date": 1517631508, "creation_date": 1508902525, "question_id": 46923537, "link": "https://stackoverflow.com/questions/46923537/how-does-docker-go-wrapper-script-works", "title": "How does docker go-wrapper script works", "body": "<p>hey can anyone explain to me what docker <code>go-wrapper</code> should do ?\n<a href=\"https://github.com/docker-library/golang/blob/master/go-wrapper\" rel=\"nofollow noreferrer\">https://github.com/docker-library/golang/blob/master/go-wrapper</a>\nfollowing this comment:</p>\n\n<blockquote>\n  <p>This script allows us to take a generic directory of Go source files\n  such as \"/go/src/app\" and determine that the canonical \"import path\"\n  of where that code expects to live and reference itself is\n  \"github.com/jsmith/my-cool-app\".  It will then ensure that\n  \"/go/src/github.com/jsmith/my-cool-app\" is a symlink to \"/go/src/app\",\n  which allows us to build and run it under the proper package name.</p>\n</blockquote>\n\n<p>I understand that if I am developing a project under mine github go path then mounting it <code>/go/src/app</code> inside a docker container will work with imports still remained unchanged (github imports) correct ?</p>\n\n<pre><code>COPY . /go/src/app\nWORKDIR /go/src/app\n\nRUN go-wrapper download\nRUN go-wrapper install\n</code></pre>\n\n<p>however when i try to install/run with vendors using dep</p>\n\n<pre><code>go get -u github.com/golang/dep/cmd/dep\ndep init\ndep ensure -update\n</code></pre>\n\n<p>it downloads my repo to vendor and then tries to import it from there why is that ?</p>\n"}, {"tags": ["mysql", "go", "utf-8"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1508902339, "post_id": 46923469, "comment_id": 80794101, "body": "Client charset is a part of the connection procedure. Show how you&#39;re connecting to the databse."}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1509115665, "post_id": 46923469, "comment_id": 80903075, "body": "There are about 5 different &quot;garblings&quot;, which one did you get?  Possibly the answer is here: <a href=\"https://stackoverflow.com/questions/38363566/trouble-with-utf8-characters-what-i-see-is-not-what-i-stored\" title=\"trouble with utf8 characters what i see is not what i stored\">stackoverflow.com/questions/38363566/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1508917718, "post_id": 46925552, "comment_id": 80800403, "body": "That&#39;s not the exactly correct way of doing it: there should be a connection option to specify a charset."}], "tags": [], "owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "is_accepted": false, "score": 0, "last_activity_date": 1508913580, "creation_date": 1508913580, "answer_id": 46925552, "question_id": 46923469, "link": "https://stackoverflow.com/questions/46923469/golang-mysql-client-db-query-method-not-reutning-utf-8-encoded-characters/46925552#46925552", "title": "Golang mysql client DB.Query method not reutning utf-8 encoded characters", "body": "<p>So when the rows were inserted into the DB, the client charset was <strong>latin1</strong>. And the golang client by default was using utf8. Inserted all the rows again using utf8 and now the golang utf8 client seems to be reading the characters fine !</p>\n\n<p>For others who come across similar problems:</p>\n\n<p>The following command tells the current configuration</p>\n\n<blockquote>\n  <p>mysql> status</p>\n</blockquote>\n\n<p>The following command sets the client character set. Run it before insert statements.</p>\n\n<blockquote>\n  <p>mysql> set names utf8 </p>\n</blockquote>\n"}], "owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 757, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1508913580, "creation_date": 1508902095, "question_id": 46923469, "link": "https://stackoverflow.com/questions/46923469/golang-mysql-client-db-query-method-not-reutning-utf-8-encoded-characters", "title": "Golang mysql client DB.Query method not reutning utf-8 encoded characters", "body": "<p>I have mysql table which has UTF-8 characters stored in some columns. The table was created with the DEFAULT CHARSET=utf8;</p>\n\n<p>If I manually run the select statement I can see the UTF-8 characters but if I use the golang client and use the <a href=\"https://golang.org/pkg/database/sql/#DB.Query\" rel=\"nofollow noreferrer\">DB.Query</a> method then I see that the characters are all garbled !</p>\n\n<p>Also, the insert was done from the golang client as well. How come the insert was fine and the read is making it garbled ?\nI couldn't see any parameters to set the character set while making the query. What am I missing ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1508900434, "post_id": 46923223, "comment_id": 80793654, "body": "&quot;The parsing is returning something like&quot; --- what &quot;the parsing&quot; exactly means here? If you parse XML right then you should get the original data that does not need any extra processing."}, {"owner": {"reputation": 51, "user_id": 8781418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc61f7a102b28cf2ae45521390b167d?s=128&d=identicon&r=PG&f=1", "display_name": "Mugs9117", "link": "https://stackoverflow.com/users/8781418/mugs9117"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1508901245, "post_id": 46923223, "comment_id": 80793847, "body": "Ah - thanks. Thank helped me realize the API is double encoding. <code>http&amp;#x26;&amp;#x23;x3a&amp;#x3b;&amp;#x26;&amp;#x23;x2f&amp;#x3b;&amp;#x26;&amp;#x23;x2&zwnj;&#8203;f&amp;#x3b;www.test.com</code> is being returned. I don&#39;t have control over the API so I need to basically run it through another round of decoding in my app and not sure best way to do that."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1508901990, "post_id": 46923223, "comment_id": 80794024, "body": "&quot;not sure best way to do that.&quot; --- so don&#39;t do it &quot;the best way&quot; (especially that absolute &quot;the best&quot; does not exist). Implement it in any way that works, then come here if you have any problem with your implementation."}, {"owner": {"reputation": 51, "user_id": 8781418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc61f7a102b28cf2ae45521390b167d?s=128&d=identicon&r=PG&f=1", "display_name": "Mugs9117", "link": "https://stackoverflow.com/users/8781418/mugs9117"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1508902153, "post_id": 46923223, "comment_id": 80794062, "body": "Sorry man - I&#39;m clearly frustrating you. I don&#39;t know how else to say the problem I&#39;m having: I don&#39;t know how to convert <code>http&amp;#x3a;&amp;#x2f;&amp;#x2f;www.test.com</code> to <code>http:&#47;&#47;www.test.com</code> in Go. That&#39;s all I&#39;m asking for help on. I&#39;ve read through net/url and other encoding packages but can&#39;t seem to find anything."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1508902242, "post_id": 46923223, "comment_id": 80794082, "body": "<code>&amp;#x3a;</code> - everything that starts with <code>&amp;#x</code> then 2 hexadecimal characters, then <code>;</code> should be ascii-decoded. Take a regex or string functions for that."}, {"owner": {"reputation": 51, "user_id": 8781418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc61f7a102b28cf2ae45521390b167d?s=128&d=identicon&r=PG&f=1", "display_name": "Mugs9117", "link": "https://stackoverflow.com/users/8781418/mugs9117"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1508903164, "post_id": 46923223, "comment_id": 80794278, "body": "Thanks - I&#39;ll put an example of what works in the question for clarification. I had thought there would have been an easier way since websites like <a href=\"https://www.url-encode-decode.com/\" rel=\"nofollow noreferrer\">url-encode-decode.com</a> did exactly what I wanted. I figured there would be a prebuilt method for it. Maybe I was wrong."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1508939489, "post_id": 46923223, "comment_id": 80815495, "body": "You are not dealing with URL encoding. You are dealing with XML escaping. That your content happens to be a URL is irrelevant. Also, make sure that this is really a bug in the API, such that every URL is double escaped. If the API returns user generated content, for instance, someone saved garbage. You can&#39;t fix that reliably."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 8781418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc61f7a102b28cf2ae45521390b167d?s=128&d=identicon&r=PG&f=1", "display_name": "Mugs9117", "link": "https://stackoverflow.com/users/8781418/mugs9117"}, "edited": false, "score": 0, "creation_date": 1508946815, "post_id": 46924496, "comment_id": 80821040, "body": "Exactly what I was looking for. I don&#39;t know how that didn&#39;t come up in any of my searches. Thank you!"}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 1, "last_activity_date": 1508908691, "creation_date": 1508908691, "answer_id": 46924496, "question_id": 46923223, "link": "https://stackoverflow.com/questions/46923223/decoding-url-in-go/46924496#46924496", "title": "Decoding URL in Go", "body": "<p>Just call <code>html.UnescapeString(\"http&amp;#x3a;&amp;#x2f;&amp;#x2f;www.test.com\")</code> which results in <code>http://www.test.com</code>.</p>\n"}], "owner": {"reputation": 51, "user_id": 8781418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc61f7a102b28cf2ae45521390b167d?s=128&d=identicon&r=PG&f=1", "display_name": "Mugs9117", "link": "https://stackoverflow.com/users/8781418/mugs9117"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 46924496, "answer_count": 1, "score": -1, "last_activity_date": 1508908691, "creation_date": 1508900242, "last_edit_date": 1508903265, "question_id": 46923223, "link": "https://stackoverflow.com/questions/46923223/decoding-url-in-go", "title": "Decoding URL in Go", "body": "<p>I am calling an API that is returning a URL in a UTF-8 encoded XML document. The parsing is returning something like <code>http&amp;#x3a;&amp;#x2f;&amp;#x2f;www.test.com</code> and I want to convert it to <code>http://www.test.com</code>.</p>\n\n<p>I'm struggling to find the right way to do this. Any help would be appreciated!</p>\n\n<p>Edit: this code does what I need, but would have thought there would have been a pre-built function that does something similar to this website: <a href=\"https://www.url-encode-decode.com/\" rel=\"nofollow noreferrer\">https://www.url-encode-decode.com/</a></p>\n\n<pre><code>    for _, user := range x.Users {\n        a := strings.Replace(user.Username, \"&amp;#x3a;\", \":\", -1)\n        b := strings.Replace(a, \"&amp;#x2f;\", \"/\", -1)\n        fmt.Println(b)\n    }\n</code></pre>\n"}, {"tags": ["go", "sqlite"], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1508896712, "creation_date": 1508896712, "answer_id": 46922751, "question_id": 46922663, "link": "https://stackoverflow.com/questions/46922663/how-to-make-database-instance-set-in-func-main-available-to-other-packages/46922751#46922751", "title": "How to make database instance set in func main() available to other packages?", "body": "<p>Define it on a top level of you code on main</p>\n\n<pre><code>var MyEnv Env\n\n func main(){\n     MyEnv = &amp;Env{}\n\n  }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 0, "last_activity_date": 1508909209, "creation_date": 1508909209, "answer_id": 46924585, "question_id": 46922663, "link": "https://stackoverflow.com/questions/46922663/how-to-make-database-instance-set-in-func-main-available-to-other-packages/46924585#46924585", "title": "How to make database instance set in func main() available to other packages?", "body": "<p>If you want to use a name (variable, type, etc.) from another package, you need to <code>import</code> that package, e.g. with <code>import \"view\"</code> you could do <code>view.Something</code> in your main package.</p>\n\n<p>Now you cannot import a main package, this means that your <code>view</code> package cannot import <code>main</code> to call <code>main.Env</code>. So you have to use another way, some possibilities are:</p>\n\n<ol>\n<li><p>Put the <code>Env</code> type in the <code>view</code> package and then in your <code>main</code> package just declare a <code>var myEnv = view.Env{}</code>.</p></li>\n<li><p>Put the <code>Env</code> type in its own package <code>env</code> which you then import in both <code>view</code> and <code>main</code></p></li>\n<li><p>Instead of using a concrete type <code>Env</code> you could use an <code>interface</code> type in the <code>view</code> package. This type should only expose the functions that you need from it. Then you can implement that type in your <code>main</code> package and pass an instance of that to <code>view</code>.</p></li>\n</ol>\n"}], "owner": {"reputation": 714, "user_id": 5106998, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/r1n3V.png?s=128&g=1", "display_name": "gglasses", "link": "https://stackoverflow.com/users/5106998/gglasses"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 46924585, "answer_count": 2, "score": 0, "last_activity_date": 1508909209, "creation_date": 1508896129, "question_id": 46922663, "link": "https://stackoverflow.com/questions/46922663/how-to-make-database-instance-set-in-func-main-available-to-other-packages", "title": "How to make database instance set in func main() available to other packages?", "body": "<p>I\u2019m writing my first go web app and I have the following structure: </p>\n\n<pre><code>.\n\u251c\u2500\u2500 main.go\n\u251c\u2500\u2500 model\n\u2502   \u251c\u2500\u2500 model.go\n\u2502   \u2514\u2500\u2500 book.go\n\u251c\u2500\u2500 route\n\u2502   \u2514\u2500\u2500 route.go\n\u2514\u2500\u2500 view\n    \u2514\u2500\u2500 view.go\n</code></pre>\n\n<p><strong>/main.go</strong> is where my <strong>main()</strong> is located. In that file I also defined a  variable Env where I\u2019ll keep the instance of my database (at least that\u2019s the plan). </p>\n\n<p>In <strong>/main.go</strong> I do</p>\n\n<pre><code>import \"project/view\"\n\ntype Env struct {\n    db models.Collection\n}\n\n// rest of the code\n\nfunc main() {\n    db, err := models.NewDB()\n    // etc\n    MyEnv := &amp;Env{db}\n    // etc\n}\n</code></pre>\n\n<p>But the thing is that in <strong>/view/view.go</strong> I need to call methods defined in <strong>/model/book.go</strong> and I thought the way to do that was through the <em>MyEnv.db</em> instance but of course I get an error: </p>\n\n<p>view/view.go:13:14: undefined: Env</p>\n\n<p>^^ Any help to solve that problem would be appreciated or any lead on how to better structure my project. :) </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 3, "last_activity_date": 1508889837, "creation_date": 1508889837, "answer_id": 46921840, "question_id": 46921634, "link": "https://stackoverflow.com/questions/46921634/get-all-map-values-as-a-slice/46921840#46921840", "title": "Get all map values as a slice?", "body": "<pre><code>m := make([]int, 0, len(d))\nfor _, val := range d {\n    m = append(m, val)\n}\n</code></pre>\n\n<p>Note: the order of the slice is not deterministic; you may have to reorder it, depending on your use case.</p>\n"}], "owner": {"reputation": 2346, "user_id": 2329708, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/5Du22.jpg?s=128&g=1", "display_name": "Nate Jenson", "link": "https://stackoverflow.com/users/2329708/nate-jenson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3857, "favorite_count": 0, "closed_date": 1508892448, "answer_count": 1, "score": -2, "last_activity_date": 1508889837, "creation_date": 1508888433, "question_id": 46921634, "link": "https://stackoverflow.com/questions/46921634/get-all-map-values-as-a-slice", "closed_reason": "Duplicate", "title": "Get all map values as a slice?", "body": "<p>Say I have the following map:</p>\n\n<pre><code>d := map[string]int{\n    \"a\": 1,\n    \"b\": 2,\n    \"c\": 3,\n}\n</code></pre>\n\n<p>How can I get the values in the map as a slice? eg. <code>[1,2,3]</code></p>\n"}, {"tags": ["go", "phpmyadmin", "centos7"], "comments": [{"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "edited": false, "score": 0, "creation_date": 1508886225, "post_id": 46920727, "comment_id": 80790114, "body": "<a href=\"https://stackoverflow.com/questions/766809/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci\">I would try utf8_unicode_ci</a>"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1508891511, "post_id": 46920727, "comment_id": 80791394, "body": "Could you check locales, connection settings for all apps? Possibly one where in the middle the letter gets corrupted. Have you tried to insert the row manually with console tool <code>mysql</code>?"}, {"owner": {"reputation": 19, "user_id": 5464255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cc4a8796ffd596fa1fc9256bdab47e3?s=128&d=identicon&r=PG&f=1", "display_name": "W.Tonki", "link": "https://stackoverflow.com/users/5464255/w-tonki"}, "edited": false, "score": 0, "creation_date": 1508933385, "post_id": 46920727, "comment_id": 80810892, "body": "I already tried inserting the row manually with mysql console, and it inserts okay. I have other table that has exactly the same structure and it has no problemas inserting data with &#241; characters on it via Golang"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1508939984, "post_id": 46920727, "comment_id": 80815912, "body": "Use placeholders and bind your values. Never use Sprintf. That may already fix your problem, because now the driver will take care of encoding the strings. <a href=\"https://play.golang.org/p/PGPB6VyBLI\" rel=\"nofollow noreferrer\">play.golang.org/p/PGPB6VyBLI</a>"}], "owner": {"reputation": 19, "user_id": 5464255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cc4a8796ffd596fa1fc9256bdab47e3?s=128&d=identicon&r=PG&f=1", "display_name": "W.Tonki", "link": "https://stackoverflow.com/users/5464255/w-tonki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 263, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1508907603, "creation_date": 1508882381, "last_edit_date": 1508907603, "question_id": 46920727, "link": "https://stackoverflow.com/questions/46920727/go-insert-on-mysql-database-with-special-characters", "title": "Go insert on MySQL Database with special characters", "body": "<p>I have the following problem:</p>\n\n<p>I'm making an <code>INSERT INTO</code> with Golang, but for some reason, it's not inserting the special characters correctly (IE: <code>\u00f1</code>).</p>\n\n<p>This is the SQL sentence:</p>\n\n<pre><code>ins, err := db.Prepare(\"INSERT INTO historico_twitter_instagram( texto_encontrado,\n                        busqueda_realizada, id_usuario, link, total_reacciones, \n                        total_negativas, total_positivas, total_neutras, fecha_publicacion,\n                        id_red_social,is_falso_positivo,ID_comentario) \n                        VALUES \"+ fmt.Sprintf(\"%s\",buscado))\n</code></pre>\n\n<p>Right above it I have a print to show in console what is supposed to insert, and it shows this:</p>\n\n<pre><code>INSERT INTO historico_twitter_instagram( texto_encontrado, busqueda_realizada,\n            id_usuario, link, total_reacciones, total_negativas, total_positivas,\n            total_neutras, fecha_publicacion,id_red_social,is_falso_positivo,ID_comentario)\n     VALUES ('Test: \u00f1','@wtonki','999','','1','0','0','1','2017-10-24 00:00:00.0','2','1',\n             '922923057840144384')\n</code></pre>\n\n<p>But in phpMyAdmin it's replacing the <code>\u00f1</code> character for other characters like <code>\u00c3\u00b1</code></p>\n\n<p>The strange part is, if I execute that SQL manually, it inserts okay. Any ideas?</p>\n\n<p>PS: The table structure has utf8_general_ci\nPS2: Sorry for my bad English! :(\nPS3: The SQL is executed on Go with <code>_, err = ins.Run()</code></p>\n"}, {"tags": ["go", "compiler-optimization", "constantfolding"], "comments": [{"owner": {"reputation": 4719, "user_id": 2676845, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/TTFOs.jpg?s=128&g=1", "display_name": "fstanis", "link": "https://stackoverflow.com/users/2676845/fstanis"}, "edited": false, "score": 3, "creation_date": 1508882930, "post_id": 46920584, "comment_id": 80789115, "body": "Do you have anything concrete in mind? If you&#39;re just looking for a &quot;yes&quot; or &quot;no&quot;, the answer is &quot;yes&quot; - but that information alone is next to useless, as there are many corner cases where it may or may not happen."}], "answers": [{"comments": [{"owner": {"reputation": 4719, "user_id": 2676845, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/TTFOs.jpg?s=128&g=1", "display_name": "fstanis", "link": "https://stackoverflow.com/users/2676845/fstanis"}, "edited": false, "score": 1, "creation_date": 1508882828, "post_id": 46920770, "comment_id": 80789076, "body": "Appreciate the example, but this doesn&#39;t give a &quot;yes&quot; or &quot;no&quot; answer to the question."}], "tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": true, "score": 1, "last_activity_date": 1508882623, "creation_date": 1508882623, "answer_id": 46920770, "question_id": 46920584, "link": "https://stackoverflow.com/questions/46920584/does-golang-compiler-use-constant-folding/46920770#46920770", "title": "does golang compiler use constant folding?", "body": "<p>Try to write a simple program: eg.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(12345*1000)\n}\n</code></pre>\n\n<p>And now compile it to assembly</p>\n\n<pre><code>go tool compile -S examle.go\n</code></pre>\n\n<p>And now find 12345 in the result and you will have an answer.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 6, "last_activity_date": 1508897606, "last_edit_date": 1508897606, "creation_date": 1508887090, "answer_id": 46921435, "question_id": 46920584, "link": "https://stackoverflow.com/questions/46920584/does-golang-compiler-use-constant-folding/46921435#46921435", "title": "does golang compiler use constant folding?", "body": "<blockquote>\n  <p><a href=\"https://en.wikipedia.org/wiki/Constant_folding\" rel=\"noreferrer\">Constant folding - Wikipedia</a></p>\n  \n  <p>Constant folding is the process of recognizing and evaluating constant\n  expressions at compile time rather than computing them at runtime.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"noreferrer\">Constant expressions</a></p>\n  \n  <p>Constant expressions may contain only constant operands and are\n  evaluated at compile time.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/math/big/\" rel=\"noreferrer\">Package big</a></p>\n\n<pre><code>import \"math/big\"\n</code></pre>\n  \n  <p>Package big implements arbitrary-precision arithmetic (big numbers).</p>\n</blockquote>\n\n<hr>\n\n<p>Go constant expressions are evaluated at compile time. The Go gc compiler, written in Go, uses package <code>big</code> to evaluate numeric constant expressions.</p>\n"}], "owner": {"reputation": 97, "user_id": 525546, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/4exqT.jpg?s=128&g=1", "display_name": "pandascope", "link": "https://stackoverflow.com/users/525546/pandascope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 1, "accepted_answer_id": 46920770, "answer_count": 2, "score": 1, "last_activity_date": 1534786976, "creation_date": 1508881612, "last_edit_date": 1534786976, "question_id": 46920584, "link": "https://stackoverflow.com/questions/46920584/does-golang-compiler-use-constant-folding", "title": "does golang compiler use constant folding?", "body": "<p>just wondering if \"go\" compiler uses any sort of optimization such as constant folding.</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Constant_folding\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Constant_folding</a></p>\n\n<p>searched through google but couldn't find the answer i'm looking for.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1508875909, "post_id": 46918919, "comment_id": 80785819, "body": "I don&#39;t understand your map. How is your map defined in Go? What you have shown us isn&#39;t valid Go code. What is it?"}, {"owner": {"reputation": 1, "user_id": 8827540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4de8b1a87ce2339685b3f04a7167042b?s=128&d=identicon&r=PG&f=1", "display_name": "MKS", "link": "https://stackoverflow.com/users/8827540/mks"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1508877752, "post_id": 46918919, "comment_id": 80786772, "body": "my map is personMap := make(map[string]string). Using this I created by personMap := [01:aaaaaaaaaabbbbbbbbbbccccccccccccccc123456]. And I want to the populate the value in the map into my Person Struct... and then call jsResp, _ := json.Marshal(PersonStructPtr) to create the JSON object... Does this clarify your question?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 8827540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4de8b1a87ce2339685b3f04a7167042b?s=128&d=identicon&r=PG&f=1", "display_name": "MKS", "link": "https://stackoverflow.com/users/8827540/mks"}, "edited": false, "score": 0, "creation_date": 1508964739, "post_id": 46919263, "comment_id": 80830969, "body": "This worked.. Thanks very much @JimB. But I have another followup if you can help..."}, {"owner": {"reputation": 1, "user_id": 8827540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4de8b1a87ce2339685b3f04a7167042b?s=128&d=identicon&r=PG&f=1", "display_name": "MKS", "link": "https://stackoverflow.com/users/8827540/mks"}, "edited": false, "score": 0, "creation_date": 1508964956, "post_id": 46919263, "comment_id": 80831107, "body": "Ok So I am not able to add lot of data in the comments it seems ... @JimB can you please look at my follow up question at the link below <a href=\"https://stackoverflow.com/questions/46941841/golang-populate-array-of-structure\" title=\"golang populate array of structure\">stackoverflow.com/questions/46941841/&hellip;</a>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1508876034, "creation_date": 1508876034, "answer_id": 46919263, "question_id": 46918919, "link": "https://stackoverflow.com/questions/46918919/dynamically-allocating-stucture/46919263#46919263", "title": "Dynamically Allocating Stucture", "body": "<p>That's not <code>json</code> data. However, the <code>binary.Read</code> function will decode arbitrary fixed sized values from a binary stream following the struct layout.</p>\n\n<pre><code>data := []byte(\"aaaaaaaaaaaaaaaaaaaaccccccccccccccc123456\")\nerr := binary.Read(bytes.NewReader(data), binary.LittleEndian, &amp;p)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/-I_XhUCvNN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-I_XhUCvNN</a></p>\n"}], "owner": {"reputation": 1, "user_id": 8827540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4de8b1a87ce2339685b3f04a7167042b?s=128&d=identicon&r=PG&f=1", "display_name": "MKS", "link": "https://stackoverflow.com/users/8827540/mks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1508876034, "creation_date": 1508874622, "last_edit_date": 1508875839, "question_id": 46918919, "link": "https://stackoverflow.com/questions/46918919/dynamically-allocating-stucture", "title": "Dynamically Allocating Stucture", "body": "<p>I have a struct:</p>\n\n<pre><code>type person struct{\n    FirstN      [10]byte\n    Last Name   [10]byte\n    Address     [15]byte\n    zip         [6]byte\n}\n</code></pre>\n\n<p>Then I have Map    </p>\n\n<pre><code>   xyz = [01:aaaaaaaaaabbbbbbbbbbccccccccccccccc123456]\n</code></pre>\n\n<p>This map is exactly the same as my struct. Basically if I overlay my structure with the string in the map it is an exact match.</p>\n\n<p>I am trying to get a JSON string for this data, using Marshal. But for that (as I understand it) I need to update the data in the map into the struct and then pass the structure pointer to Marshal </p>\n\n<p>But I cannot find any way to get the data from the map with key '01' which is a string and initialize my structure with it. I do not want to add a code to update each field in the structure by parsing the string from the map. Is there a way to do it or hardcoding is the only option. </p>\n\n<p>Also is there a way to create a JSON string from a map string directly?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2626, "user_id": 863651, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/ad46e1336e43614ea24e0f42b9a383af?s=128&d=identicon&r=PG", "display_name": "XDS", "link": "https://stackoverflow.com/users/863651/xds"}, "edited": false, "score": 0, "creation_date": 1565972442, "post_id": 46917369, "comment_id": 101522147, "body": "So in C# terms backtick `` is like @&quot;&quot; while the double-quote &quot;&quot; is exactly like C# doublequote strings. That&#39;s neat. Shame though that the JS world employed backticks `` a few years down the road for string interpolation - something which at the time of this writing is not supported at all in GoLang. I&#39;m saying this simple because JS is prevailing nowadays and it will make a lot of devs scratch their heads when they are picking up GoLang."}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 66, "last_activity_date": 1540730471, "last_edit_date": 1540730471, "creation_date": 1508868892, "answer_id": 46917369, "question_id": 46917331, "link": "https://stackoverflow.com/questions/46917331/what-is-the-difference-between-backticks-double-quotes-in-golang/46917369#46917369", "title": "What is the difference between backticks (``) &amp; double quotes (&quot;&quot;) in golang?", "body": "<p>In quotes <code>\"\"</code> you need to escape new lines, tabs and other characters that do not need to be escaped in backticks <code>``</code>. If you put a line break in a backtick string, it is interpreted as a <code>'\\n'</code> character, see <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"noreferrer\">https://golang.org/ref/spec#String_literals</a></p>\n\n<p>Thus, if you say <code>\\n</code> in a backtick string, it will be interpreted as the literal backslash and character n.</p>\n"}, {"tags": [], "owner": {"reputation": 2178, "user_id": 3858203, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/Os9fr.jpg?s=128&g=1", "display_name": "samadadi", "link": "https://stackoverflow.com/users/3858203/samadadi"}, "is_accepted": false, "score": 10, "last_activity_date": 1508897581, "last_edit_date": 1508897581, "creation_date": 1508870167, "answer_id": 46917718, "question_id": 46917331, "link": "https://stackoverflow.com/questions/46917331/what-is-the-difference-between-backticks-double-quotes-in-golang/46917718#46917718", "title": "What is the difference between backticks (``) &amp; double quotes (&quot;&quot;) in golang?", "body": "<p><strong>Raw</strong> string literals are character sequences between backticks. <strong>Backslashs</strong> ('\\') have no special meaning  and <strong>Carriage return</strong> characters ('\\r') inside raw string literals are discarded from the raw string value. </p>\n\n<p><strong>Interpreted</strong> string literals are character sequences between double quotes (\"\\r\", \"\\n\", ...)</p>\n\n<p>source: <a href=\"http://ispycode.com/GO/Strings/Raw-string-literals\" rel=\"noreferrer\">http://ispycode.com/GO/Strings/Raw-string-literals</a></p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 38, "last_activity_date": 1574231247, "last_edit_date": 1574231247, "creation_date": 1508912966, "answer_id": 46925368, "question_id": 46917331, "link": "https://stackoverflow.com/questions/46917331/what-is-the-difference-between-backticks-double-quotes-in-golang/46925368#46925368", "title": "What is the difference between backticks (``) &amp; double quotes (&quot;&quot;) in golang?", "body": "<p>Backtick strings are analogs of multiline raw string in Python or Scala: <code>r\"\"\" text \"\"\"</code> or in JavaScript:</p>\n\n<pre><code>String.raw`Hi\\u000A!`\n</code></pre>\n\n<p>They can:</p>\n\n<ol>\n<li><p>Span multiple lines.</p></li>\n<li><p>Ignore special characters.</p></li>\n</ol>\n\n<p>They are useful:</p>\n\n<ol>\n<li><p>For putting big text inside.</p></li>\n<li><p>For regular expressions when you have lots of backslashes.</p></li>\n<li><p>For struct tags to put double quotes in. </p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 99, "user_id": 4555196, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3krROnkery4/AAAAAAAAAAI/AAAAAAAAACk/eZobzBIMgWk/photo.jpg?sz=128", "display_name": "Dami", "link": "https://stackoverflow.com/users/4555196/dami"}, "is_accepted": false, "score": 5, "last_activity_date": 1555739472, "creation_date": 1555739472, "answer_id": 55770684, "question_id": 46917331, "link": "https://stackoverflow.com/questions/46917331/what-is-the-difference-between-backticks-double-quotes-in-golang/55770684#55770684", "title": "What is the difference between backticks (``) &amp; double quotes (&quot;&quot;) in golang?", "body": "<p><code>``</code> represents an uninterpreted strings and <code>\"\"</code> is an interpreted string.</p>\n\n<blockquote>\n  <p>The value of a raw string literal <em>(uninterpreted strings)</em> is the string composed of the uninterpreted (implicitly UTF-8-encoded) characters between the quotes</p>\n  \n  <p>Interpreted string literals are character sequences between double quotes, as in \"bar\". Within the quotes, any character may appear except newline and unescaped double quote.</p>\n</blockquote>\n\n<p>PS: italicized words are mine</p>\n\n<p><a href=\"https://golang.org/ref/spec#String_literals\" rel=\"noreferrer\">https://golang.org/ref/spec#String_literals</a> </p>\n"}, {"tags": [], "owner": {"reputation": 190, "user_id": 2385319, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/LClv4.jpg?s=128&g=1", "display_name": "IndikaM", "link": "https://stackoverflow.com/users/2385319/indikam"}, "is_accepted": false, "score": 0, "last_activity_date": 1615127910, "creation_date": 1615127910, "answer_id": 66517683, "question_id": 46917331, "link": "https://stackoverflow.com/questions/46917331/what-is-the-difference-between-backticks-double-quotes-in-golang/66517683#66517683", "title": "What is the difference between backticks (``) &amp; double quotes (&quot;&quot;) in golang?", "body": "<p>golang has three types of quotations. Single quote , double quote, or backquotes (backticks)</p>\n<ul>\n<li>Single quote - indicates a byte type or rune type which corresponds to uint8 or int32 as well as the default rune type. Usually used to denote rune types and display Unicode.</li>\n<li>Double quote - indicate strings which are char arrays. Hence you can use array index to access bytes or use functions like len().</li>\n<li>Back quotes (backtick) - indicate a string literal, but does not support escape sequences. Usually used to display string literals like multiple lines</li>\n</ul>\n"}], "owner": {"reputation": 2178, "user_id": 3858203, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/Os9fr.jpg?s=128&g=1", "display_name": "samadadi", "link": "https://stackoverflow.com/users/3858203/samadadi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34769, "favorite_count": 9, "answer_count": 5, "score": 78, "last_activity_date": 1615127910, "creation_date": 1508868739, "last_edit_date": 1508877428, "question_id": 46917331, "link": "https://stackoverflow.com/questions/46917331/what-is-the-difference-between-backticks-double-quotes-in-golang", "title": "What is the difference between backticks (``) &amp; double quotes (&quot;&quot;) in golang?", "body": "<p>What is the difference between backticks (``) &amp; double quotes (\"\") in golang?</p>\n"}, {"tags": ["go", "struct", "interface", "gtk", "gtk3"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1508853751, "post_id": 46912374, "comment_id": 80772169, "body": "What is the full error you receive?"}, {"owner": {"reputation": 545, "user_id": 576138, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9fd87ec778a973d194c0fabd92c67830?s=128&d=identicon&r=PG", "display_name": "okelet", "link": "https://stackoverflow.com/users/576138/okelet"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1508854611, "post_id": 46912374, "comment_id": 80772801, "body": "At compile time, test.go:35: invalid type assertion: backwidget1.(*NotebookPage) (non-interface type *gtk.Widget on left)"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1508858906, "post_id": 46912374, "comment_id": 80775980, "body": "Type assertions only work on interface types.  <code>&lt;interface&gt;.(&lt;interface&gt;)</code> or <code>&lt;interface&gt;.(&lt;concrete&gt;)</code>.  You can&#39;t type-assert a concrete type to another type, interface or otherwise.  From the error message, it appears that <code>backwidget1</code> is a concrete type (a struct, most likely), not an interface, so your type-assertions are invalid.  Also, as an aside, you&#39;re not checking the boolean second value of your type assertions (the <code>_</code>), which would tell you if the type assertion succeeded.  If it didn&#39;t, <code>backpage1</code> will be nil.  You should really check that boolean value."}, {"owner": {"reputation": 545, "user_id": 576138, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9fd87ec778a973d194c0fabd92c67830?s=128&d=identicon&r=PG", "display_name": "okelet", "link": "https://stackoverflow.com/users/576138/okelet"}, "edited": false, "score": 0, "creation_date": 1508913544, "post_id": 46912374, "comment_id": 80797788, "body": "Thanks all for your help; I usually code in Python and Java, but interfaces and structs are very different in Go. I&#39;ll try to find a workaround."}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 1, "last_activity_date": 1508859200, "creation_date": 1508859200, "answer_id": 46914554, "question_id": 46912374, "link": "https://stackoverflow.com/questions/46912374/gotk3-notebook-appendpage-with-a-custom-widget-and-get-it-back/46914554#46914554", "title": "gotk3, notebook appendpage with a custom widget and get it back", "body": "<p>Looks like your problem is here on line 35 as the message says:</p>\n\n<p>backpage1, _ := backwidget1.(*NotebookPage)</p>\n\n<p>notebook.GetNthPage returns a *Widget, *NotebookPage is not a *Widget, so you're not allowed to cast to it. If the function didn't return a concrete type (if it returned the same IWidget interface), and if it didn't roundtrip through gtk C libraries, you could do this. </p>\n\n<p>As it is if you want to get your custom widget back you probably need to get at the underlying gtk widget or serialisation (which presumably stores your custom label), extract the label and build a new  NotebookPage. </p>\n\n<p>So you need something like :</p>\n\n<pre><code>func NewNotebookPage(widget *Widget) {\n   return &amp;NotebookPage{Label: widget.GetLabelSomehow()}\n}\n</code></pre>\n\n<p>It looks like Label is also a widget :) This is painful because it's trying to work with C++ inheritance in Go. You'll have to find out how to unfreeze your label from the widget.C.GtkWidget </p>\n"}], "owner": {"reputation": 545, "user_id": 576138, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9fd87ec778a973d194c0fabd92c67830?s=128&d=identicon&r=PG", "display_name": "okelet", "link": "https://stackoverflow.com/users/576138/okelet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1508876807, "creation_date": 1508853206, "last_edit_date": 1508876807, "question_id": 46912374, "link": "https://stackoverflow.com/questions/46912374/gotk3-notebook-appendpage-with-a-custom-widget-and-get-it-back", "title": "gotk3, notebook appendpage with a custom widget and get it back", "body": "<p>I have this summarized code to display tabs in a notebook in Gtk. Basically, I have created a custom struct with a embedded label, that is added to the notebook. After that, I want to get back that custom widget, but I get a <code>Invalid type assertion</code>. I have read a lot about structs and interfaces, but I can't get it to work.</p>\n\n<pre><code>package main\n\nimport \"github.com/gotk3/gotk3/gtk\"\n\ntype NotebookPage struct {\n    gtk.Label\n}\n\n\nfunc main() {\n\n    gtk.Init(nil)\n\n    win, _ := gtk.WindowNew(gtk.WINDOW_TOPLEVEL)\n\n    notebook, _ := gtk.NotebookNew()\n    win.Add(notebook)\n\n    content1, _ := gtk.LabelNew(\"Content 1\")\n    page1 := NotebookPage{Label: *content1}\n    label1, _ := gtk.LabelNew(\"Label 1\")\n    notebook.AppendPage(&amp;page1, label1)\n\n    content2, _ := gtk.LabelNew(\"Content 2\")\n    page2 := NotebookPage{Label: *content2}\n    label2, _ := gtk.LabelNew(\"Label 2\")\n    notebook.AppendPage(&amp;page2, label2)\n\n    win.ShowAll()\n    win.Connect(\"destroy\", func() {\n        gtk.MainQuit()\n    })\n\n    backwidget1, _ := notebook.GetNthPage(0)\n    backpage1, _ := backwidget1.(*NotebookPage)\n\n    gtk.Main()\n\n}\n</code></pre>\n"}, {"tags": ["go", "redis", "redigo"], "answers": [{"comments": [{"owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "edited": false, "score": 0, "creation_date": 1508854255, "post_id": 46911184, "comment_id": 80772537, "body": "For some reason RedisScan is never getting called, is there anything else I need to do to hook it up?"}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "edited": false, "score": 1, "creation_date": 1508857361, "post_id": 46911184, "comment_id": 80774956, "body": "It is hard to tell without more code. Do you call ScanStruct?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1508860785, "post_id": 46911184, "comment_id": 80777352, "body": "You may have to change your field type to <code>*authEnum</code> (a pointer)."}, {"owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "edited": false, "score": 0, "creation_date": 1508864103, "post_id": 46911184, "comment_id": 80779331, "body": "My code looks like this and using a pointer didn&#39;t help <a href=\"https://gist.github.com/herkyl/18f52ade5cc08ed0a7fe2af1c688d2d2\" rel=\"nofollow noreferrer\">gist.github.com/herkyl/18f52ade5cc08ed0a7fe2af1c688d2d2</a>"}, {"owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "edited": false, "score": 0, "creation_date": 1508911156, "post_id": 46911184, "comment_id": 80796697, "body": "Turns out my redigo was outdated! After updating it works :)"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1508850004, "last_edit_date": 1508850004, "creation_date": 1508849729, "answer_id": 46911184, "question_id": 46911105, "link": "https://stackoverflow.com/questions/46911105/implementing-redigo-scanner-interface-on-a-structs-field/46911184#46911184", "title": "Implementing Redigo Scanner interface on a struct&#39;s field", "body": "<p>You don't implement interfaces on fields, but rather on types.</p>\n\n<p>You can make your <code>authEnum</code> type satisfy the interface, simply by creating a method with the signature <code>RedisScan(src interface{}) error</code> on that type.</p>\n\n<p>To assign to the receiver, you need to receive a pointer.  Then you can assign to it as so:</p>\n\n<pre><code>func (e *authEnum) RedisScan(src interface{}) error {\n    var value authEnum\n    // Logic here to convert src to value\n    *e = value\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1508866106, "post_id": 46916332, "comment_id": 80780496, "body": "Side comment: If you don&#39;t need to access struct fields individually through the Redis API, then it&#39;s usually better to encode structs to a Redis bulk string using gob, json, yaml."}, {"owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "edited": false, "score": 0, "creation_date": 1508866373, "post_id": 46916332, "comment_id": 80780642, "body": "Thanks for the clean RedisScan function! However this still never gets called by ScanStruct"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "edited": false, "score": 0, "creation_date": 1508871450, "post_id": 46916332, "comment_id": 80783474, "body": "The program at <a href=\"https://play.golang.org/p/6fBVcGOupX\" rel=\"nofollow noreferrer\">play.golang.org/p/6fBVcGOupX</a> works as expected. Confirm that the response from the command contains the field."}, {"owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "edited": false, "score": 0, "creation_date": 1508906478, "post_id": 46916332, "comment_id": 80795104, "body": "Turns out I was running an old version of redigo, after updating it works!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1508865873, "last_edit_date": 1508865873, "creation_date": 1508865128, "answer_id": 46916332, "question_id": 46911105, "link": "https://stackoverflow.com/questions/46911105/implementing-redigo-scanner-interface-on-a-structs-field/46916332#46916332", "title": "Implementing Redigo Scanner interface on a struct&#39;s field", "body": "<p>Implement the method on a pointer receiver. Redis bulk strings are represented as []byte, not string:</p>\n\n<pre><code>func (e *authEnum) RedisScan(src interface{}) error {\n    b, ok := src.([]byte)\n    if !ok {\n        return fmt.Errorf(\"cannot convert authEnum from %T to %T\", src, b)\n    }\n    switch string(b) {\n    case \"false\", \"never\":\n        *e = never\n    case \"sometimes\":\n        *e = sometimes\n    default:\n        *e = always\n    }\n    return nil\n}\n</code></pre>\n\n<p>Always check and handle errors. The error returned from <code>ScanStruct</code> reports the type problem.</p>\n\n<p>There's no need to check for nil pointer to the struct member. If the argument to ScanStruct is nil, then Redigo will panic well before the RedisScan method is called.</p>\n"}], "owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1012, "favorite_count": 0, "accepted_answer_id": 46916332, "answer_count": 2, "score": 0, "last_activity_date": 1508865873, "creation_date": 1508849461, "last_edit_date": 1508865860, "question_id": 46911105, "link": "https://stackoverflow.com/questions/46911105/implementing-redigo-scanner-interface-on-a-structs-field", "title": "Implementing Redigo Scanner interface on a struct&#39;s field", "body": "<p>I have a struct that looks like this:</p>\n\n<pre><code>type authEnum int\n\nconst (\n    never authEnum = iota\n    sometimes\n    always\n)\n\ntype Attrs struct {\n    Secret         string   `redis:\"secret\"`\n    RequireSecret  authEnum `redis:\"requireSecret\"`\n    UserID         string   `redis:\"userId\"`\n}\n\nfunc (e *authEnum) RedisScan(src interface{}) error {\n    // This never gets called!\n    if e == nil {\n        return fmt.Errorf(\"nil pointer\")\n    }\n    switch src := src.(type) {\n    case string:\n        if src == \"false\" || src == \"never\" {\n            *e = never\n        } else if src == \"sometimes\" {\n            *e = sometimes\n        } else { // \"always\" or \"true\"\n            *e = always\n        }\n    default:\n        return fmt.Errorf(\"cannot convert authEnum from %T to %T\", src, e)\n    }\n    return nil\n}\n\nfunc getAttributes(ctx *AppContext, hash string) (*Attrs, error) {\n    rc := ctx.RedisPool.Get()\n    values, err := redis.Values(rc.Do(\"HGETALL\", \"redishash\"))\n    rc.Close()\n    if err != nil {\n        return nil, err\n    }\n    attrs := Attrs{}\n    redis.ScanStruct(values, &amp;attrs)\n    return &amp;attrs, nil\n}\n</code></pre>\n\n<p>How do I implement the <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#Scanner\" rel=\"nofollow noreferrer\">Scanner</a> interface on the <code>RequireSecret</code> attribute to parse an <code>authEnum</code> type out of <code>\"never\"</code>, <code>\"sometimes\"</code> or <code>\"always\"</code> redis hash values?</p>\n\n<p>How do I calculate the value and assign it to the authEnum?\nIn my code example <code>RedisScan</code> never gets called.</p>\n"}, {"tags": ["go", "amqp", "azure-eventhub", "qpid"], "comments": [{"owner": {"reputation": 466, "user_id": 3325103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b023be77fcc0393edb4b46790b634139?s=128&d=identicon&r=PG&f=1", "display_name": "Xin Chen", "link": "https://stackoverflow.com/users/3325103/xin-chen"}, "edited": false, "score": 0, "creation_date": 1509147058, "post_id": 46910778, "comment_id": 80916772, "body": "The unauthorized-access error means the client is not doing SASL PLAIN or the SAS key info sent in sasl-init was not in the expected format. What is the mechanism in the sasl-init trace?"}], "answers": [{"comments": [{"owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "edited": false, "score": 0, "creation_date": 1508932387, "post_id": 46923883, "comment_id": 80810155, "body": "Thank you but nothing is working. I&#39;ve tried on an Azure Linux VM just to rule out some firewall issues: same output: <code>connection reset by peer</code>. I&#39;ve tried using <code>amqps</code> instead of <code>amqp</code>, I&#39;ve also tried using the PLAIN mechanism but no luck so far i.e. still seeing <code>connection reset by peer</code>. I have to say that when using telnet then I am able to connect: <code>telnet &lt;MY_CUSTOM_NAMESPACE&gt;.servicebus.windows.net 5671</code> replies establishing a TCP connection."}, {"owner": {"reputation": 466, "user_id": 3325103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b023be77fcc0393edb4b46790b634139?s=128&d=identicon&r=PG&f=1", "display_name": "Xin Chen", "link": "https://stackoverflow.com/users/3325103/xin-chen"}, "reply_to_user": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "edited": false, "score": 0, "creation_date": 1508995272, "post_id": 46923883, "comment_id": 80839828, "body": "Connection is reset by the service because some requirements are not met, for example, 1. non-SSL connection, 2. no SASL negotiation, 3. wrong credentials. Did you compile proton-c? Make sure you have all the dependencies installed, especially openssl (if not present the build system will proceed and produce a lib without ssl support). For SASL to work you will need to set the user/pwd connection options and enforce SASL PLAIN by setting the allowed_mechanisms option."}], "tags": [], "owner": {"reputation": 466, "user_id": 3325103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b023be77fcc0393edb4b46790b634139?s=128&d=identicon&r=PG&f=1", "display_name": "Xin Chen", "link": "https://stackoverflow.com/users/3325103/xin-chen"}, "is_accepted": false, "score": 1, "last_activity_date": 1508904827, "creation_date": 1508904827, "answer_id": 46923883, "question_id": 46910778, "link": "https://stackoverflow.com/questions/46910778/connecting-to-the-amqp-1-0-azure-eventhub-with-qpid-and-the-golang-wrapper-elect/46923883#46923883", "title": "Connecting to the AMQP 1.0 Azure EventHub with QPid and the golang wrapper Electron", "body": "<p>Use \"amqps\" scheme in urlStr with port 5671. Event Hubs does not allow plain tcp connection. You will also need to enable SASL PLAIN to send a SAS key (user name=key name, password=key) configured on the namespace or event hub entity (looks like you are already doing it). I am not sure about golang but with the Python binding one can put everything in a Uri like this \"amqps://sas-key-name:url-encoded-key@your-namespace.servicebus.windows.net:5671\". The port number is optional.</p>\n\n<p>The underlying proton-c engine may not use SASL PLAIN if it sees a different supported SASL mechanism. To enforce PLAIN, you can set the allowed mechanism on the container. In go the SASLAllowedMechs function seems to give you a connection option you can provide when creating the connection.</p>\n\n<p>This is the <a href=\"https://github.com/Azure/azure-event-hubs-python/blob/develop/eventhubs/__init__.py\" rel=\"nofollow noreferrer\">Python code</a> that works well with the Event Hubs.</p>\n"}, {"tags": [], "owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "is_accepted": true, "score": 0, "last_activity_date": 1509708328, "last_edit_date": 1509708328, "creation_date": 1509707508, "answer_id": 47094398, "question_id": 46910778, "link": "https://stackoverflow.com/questions/46910778/connecting-to-the-amqp-1-0-azure-eventhub-with-qpid-and-the-golang-wrapper-elect/47094398#47094398", "title": "Connecting to the AMQP 1.0 Azure EventHub with QPid and the golang wrapper Electron", "body": "<p>I managed to establish a connection using the \"Claims-based authorization\" (CBS) on top of AMQP. It seems something specific to Microsoft. Some details can be found at the bottom of this page: <a href=\"https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-amqp-protocol-guide\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-amqp-protocol-guide</a></p>\n\n<p>Basically this is the list of steps:</p>\n\n<ul>\n<li>TLS connection with <code>electron.VirtualHost(eventHubDomain)</code> and the <code>ANONYMOUS</code> SASL mechanism <code>electron.SASLAllowedMechs(\"ANONYMOUS\")</code> (no need to specify SASL username and password). Check the details in the <strong>Edit</strong> part of my question above here ^.</li>\n<li>AMQP link for the special <code>$cbs</code> Event Hub name: <code>cbsLink, err := amqpConnection.Sender(electron.Target(\"$cbs\"))</code></li>\n<li>Prepare an AMQP message with the Microsoft requirements for the CBS handshake: </li>\n</ul>\n\n<p>The message properties (check this C# code to compare <a href=\"https://github.com/Azure/amqpnetlite/blob/master/Examples/ServiceBus/Scenarios/CbsAsyncExample.cs\" rel=\"nofollow noreferrer\">https://github.com/Azure/amqpnetlite/blob/master/Examples/ServiceBus/Scenarios/CbsAsyncExample.cs</a>):</p>\n\n<pre><code>appProps := make(map[string]interface{})\nappProps[\"operation\"] = \"put-token\"\nappProps[\"type\"] = \"servicebus.windows.net:sastoken\"\nappProps[\"name\"] = \"amqp://&lt;MY_CUSTOM_NAMESPACE&gt;.servicebus.windows.net/&lt;MY_CUSTOM_NAME&gt;\"\n</code></pre>\n\n<p>The SAS token formatted in the way Microsoft wants, I've adapted this piece of code: <a href=\"https://github.com/michaelbironneau/asbclient/blob/master/azure.go\" rel=\"nofollow noreferrer\">https://github.com/michaelbironneau/asbclient/blob/master/azure.go</a> this way:</p>\n\n<pre><code>aqClient := newClient(Queue, \"&lt;MY_CUSTOM_NAMESPACE&gt;\", \"&lt;MY_CUSTOM_SAS_KEY_NAME&gt;\", \"&lt;MY_CUSTOM_SAS_KEY&gt;\")\nsasToken := aqClient.authHeader(\"amqp://&lt;MY_CUSTOM_NAMESPACE&gt;.servicebus.windows.net/&lt;MY_CUSTOM_NAME&gt;\", aqClient.signatureExpiry(time.Now()))\n</code></pre>\n\n<p>That piece of code ^ is based on the python SDK here: <a href=\"https://github.com/Azure/azure-sdk-for-python/blob/master/azure-servicebus/azure/servicebus/servicebusservice.py\" rel=\"nofollow noreferrer\">https://github.com/Azure/azure-sdk-for-python/blob/master/azure-servicebus/azure/servicebus/servicebusservice.py</a> containing lots of things like upper/lower case URL encodings, mixed with timestamps for expiration purposes and the SASL username and password.</p>\n\n<p>Build the AMQP message importing <code>\"qpid.apache.org/amqp\"</code>:</p>\n\n<pre><code>cbsHandshakeMsg := amqp.NewMessage()\ncbsHandshakeMsg.SetApplicationProperties(appProps)\ncbsHandshakeMsg.Marshal(sasToken)\n</code></pre>\n\n<ul>\n<li>Send this AMQP message with <code>outcome := cbsLink.SendSync(cbsHandshakeMsg)</code> and then magically you should be authenticated to the Event Hub for a while now.</li>\n<li>Setup the AMQP link to the Event Hub name you wanted to connect to in the first place: <code>msgSender, err := amqpConnection.Sender(electron.Target(\"&lt;MY_CUSTOM_NAME&gt;\"))</code></li>\n</ul>\n\n<p>Now you can send the message you want to send using this last AMQP link this way:</p>\n\n<pre><code>m := amqp.NewMessage()\nm.Marshal(\"my message: bla bla bla, foo bar baz!\")\noutcome := msgSender.SendSync(m)\n</code></pre>\n\n<p>Done :)</p>\n\n<p>Running this code with the environment variable <code>PN_TRACE_FRM=true</code> helps a lot in troubleshooting AMQP because the <code>proton-c</code> library logs lots of useful debug messages.</p>\n\n<p>For some reason the AMQP <code>PLAIN</code> mechanism passing the SASL username and password directly during the connection attempt does not work with the Event Hub. It may be an issue with them or with the Electron/Qpid libraries, I am not sure, but now at least someone is able to send messages using golang and that <strong>CBS</strong> Microsoft protocol they made available.</p>\n"}, {"tags": [], "owner": {"reputation": 709, "user_id": 748129, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/0c254c564df744ca3da82cb68da58b40?s=128&d=identicon&r=PG", "display_name": "Chasefornone", "link": "https://stackoverflow.com/users/748129/chasefornone"}, "is_accepted": false, "score": 0, "last_activity_date": 1521083884, "creation_date": 1521083884, "answer_id": 49291028, "question_id": 46910778, "link": "https://stackoverflow.com/questions/46910778/connecting-to-the-amqp-1-0-azure-eventhub-with-qpid-and-the-golang-wrapper-elect/49291028#49291028", "title": "Connecting to the AMQP 1.0 Azure EventHub with QPid and the golang wrapper Electron", "body": "<p>TLS is required as described by <a href=\"https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-amqp-protocol-guide\" rel=\"nofollow noreferrer\">azure AMQP protocol guide</a>.</p>\n\n<blockquote>\n  <p>After setting up the connection and TLS, Service Bus offers two SASL\n  mechanism options:</p>\n  \n  <ol>\n  <li>SASL PLAIN is commonly used for passing username and password\n  credentials to a server. Service Bus does not have accounts, but\n  named Shared Access Security rules, which confer rights and are\n  associated with a key. The name of a rule is used as the user name\n  and the key (as base64 encoded text) is used as the password. The\n  rights associated with the chosen rule govern the operations allowed\n  on the connection.</li>\n  <li>SASL ANONYMOUS is used for bypassing SASL authorization when the\n  client wants to use the claims-based-security (CBS) model that is\n  described later. With this option, a client connection can be\n  established anonymously for a short time during which the client can\n  only interact with the CBS endpoint and the CBS handshake must\n  complete.</li>\n  </ol>\n</blockquote>\n\n<p>We could choose either SASL PLAIN or CBS for authentication, take PLAIN as an example, I modified your code a little and it works as expected. The magic part is below connection options: </p>\n\n<pre><code>amqpConn, err := container.Connection(\n    tlsConn,\n    electron.SASLEnable(),\n    electron.Password([]byte(eventHubSasKey)),\n    electron.User(eventHubSasKeyName),\n    electron.VirtualHost(eventHubDomain),\n    electron.SASLAllowInsecure(true),\n    electron.SASLAllowedMechs(\"PLAIN\"),\n)\n</code></pre>\n\n<p>SASLAllowInsecure returns a ConnectionOption that allows or disallows clear text SASL authentication mechanisms which should be set to true if we choose to use SASL PLAIN.</p>\n\n<p>Hope it helps.</p>\n"}], "owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1499, "favorite_count": 1, "accepted_answer_id": 47094398, "answer_count": 3, "score": 0, "last_activity_date": 1521083884, "creation_date": 1508848526, "last_edit_date": 1509023355, "question_id": 46910778, "link": "https://stackoverflow.com/questions/46910778/connecting-to-the-amqp-1-0-azure-eventhub-with-qpid-and-the-golang-wrapper-elect", "title": "Connecting to the AMQP 1.0 Azure EventHub with QPid and the golang wrapper Electron", "body": "<p>I would like to use the Electron golang wrapper for the Qpid proton-c library to connect to the Azure EventHub.</p>\n\n<p>I am setting the following SASL details combined to the host/port/namespace/path required to build the connection string but for some reason I keep getting the error message: <code>connection reset by peer</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"strings\"\n    \"qpid.apache.org/amqp\"\n    \"qpid.apache.org/electron\"\n)\n\nvar (\n    eventHubNamespaceName = \"&lt;MY_CUSTOM_NAMESPACE&gt;\"\n    eventHubName = \"&lt;MY_CUSTOM_NAME&gt;\"\n    eventHubSasKeyName = \"&lt;MY_CUSTOM_SAS_KEY_NAME&gt;\"\n    eventHubSasKey = \"&lt;MY_CUSTOM_SAS_KEY&gt;\" // this is the base64 encoded stuff\n)\n\nfunc main() {\n\n    sentChan := make(chan electron.Outcome) // Channel to receive acknowledgements.\n    container := electron.NewContainer(fmt.Sprintf(\"send[%v]\", os.Getpid()))\n\n    urlStr := fmt.Sprintf(\"amqp://%s.servicebus.windows.net:5671/%s\", eventHubNamespaceName, eventHubName)\n    fmt.Printf(\"The URL connection string: '%v'\\n\", urlStr)\n\n    // parse URL\n    url, err := amqp.ParseURL(urlStr)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"The AMQP parsed URL: %v\\n\", url)\n\n    // TCP dial\n    amqpHost := url.Host\n    fmt.Printf(\"The AMQP host used in the connection is: '%v'\\n\", amqpHost)\n    c, err := container.Dial(\n        \"tcp\", amqpHost, \n        electron.SASLEnable(), \n        electron.Password([]byte(eventHubSasKey)), \n        electron.User(eventHubSasKeyName),\n    )\n    if err != nil {\n        panic(err)\n    }\n    defer c.Close(nil)\n\n    // AMQP send\n    addr := strings.TrimPrefix(url.Path, \"/\")\n    s, err := c.Sender(electron.Target(addr))\n    if err != nil {\n        panic(err)\n    }\n    m := amqp.NewMessage()\n    body := fmt.Sprintf(\"bla bla bla %v\", 42)\n    m.Marshal(body)\n    fmt.Printf(\"The AMQP message body: '%v'\\n\", m.Body())\n\n    go s.SendAsync(m, sentChan, body) // Outcome will be sent to sentChan\n\n    // AMQP ACK receive\n    fmt.Printf(\"Waiting for ACKs...\\n\")\n    for {\n        fmt.Printf(\"Waiting for an ACK coming out of the channel...\\n\")\n        out := &lt;-sentChan // Outcome of async sends.\n        fmt.Printf(\"Received something: '%v'\\n\", out)\n    }   \n}\n</code></pre>\n\n<p>When compiling, then running the code, this is the output:</p>\n\n<pre><code>The URL connection string: 'amqp://&lt;MY_CUSTOM_NAMESPACE&gt;.servicebus.windows.net:5671/&lt;MY_CUSTOM_NAME&gt;'\nThe AMQP parsed URL: 'amqp://&lt;MY_CUSTOM_NAMESPACE&gt;.servicebus.windows.net:5671/&lt;MY_CUSTOM_NAME&gt;'\nThe AMQP host used in the connection is: '&lt;MY_CUSTOM_NAMESPACE&gt;.servicebus.windows.net:5671'\nThe AMQP message body: 'bla bla bla 42'\nWaiting for ACKs...\nWaiting for an ACK coming out of the channel...\nReceived something: '{unsent : read tcp &lt;MY_PRIVATE_IP_IN_LAN&gt;:&lt;SOME_PORT&gt;-&gt;&lt;THE_NSLOOKUP_IP_OF_THE_AZURE_EVENTHUB&gt;:5671: read: connection reset by peer bla bla bla 42}'\nWaiting for an ACK coming out of the channel...\n</code></pre>\n\n<p>To me that received message saying <code>connection reset by peer</code> does not look like a valid ACK and I am not sure what is wrong with the connection attempt?</p>\n\n<ul>\n<li>The compiled version of <code>proton-c</code> is 0.18.0, I am using <code>go1.7.4 linux/amd64</code>.</li>\n<li>If I add <code>electron.SASLAllowedMechs(\"EXTERNAL\")</code> to the connection options then I get the same error message.</li>\n<li>If I change the port to <code>5672</code>, then I get a <code>connection refused</code> panic error after the attempt at dialing via TCP.</li>\n<li>If I decode the base64 password field with <code>base64.StdEncoding.DecodeString(eventHubSasKey)</code> and pass the bytes to the connection options I keep getting the same error <code>connection reset by peer</code>.</li>\n<li>If I add this connection option <code>electron.SASLAllowedMechs(\"ANONYMOUS\")</code>, then I still get the same error message <code>connection reset by peer</code>. The reason for doing this is that I am not using any SSL certificate, and the Java wrapper to AMQP that Microsoft provides seems to use this \"anonymous\" thing instead of the certificate (in fact no certificate is needed to connect to the EventHub using the Java connector).</li>\n</ul>\n\n<p>I am not sure how to proceed here as I am stuck in the connection part and I believe the SASL details are passed in the correct way according to the docs here: <a href=\"https://godoc.org/qpid.apache.org/electron#ConnectionOption\" rel=\"nofollow noreferrer\">https://godoc.org/qpid.apache.org/electron#ConnectionOption</a></p>\n\n<p>I am still not sure the reason of the failure is not due to SSL certificates, if that's the case I am struggling to see how to include them in the process.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>I later found out I had to establish a TLS connection over TCP even if I am not providing any private/public pair of keys, also specifying a \"virtual host\" (otherwise AMQP was complaining about not recognising the host):</p>\n\n<pre><code>    // TLS connection details\n    tlsConfig := &amp;tls.Config{}\n    eventHubDomainPort := fmt.Sprintf(\"%s.servicebus.windows.net:5671\", eventHubNamespaceName)\n    tlsConn, err := tls.Dial(\"tcp\", eventHubDomainPort, tlsConfig)\n    if err != nil {\n        panic(err)\n    }\n\n    // AMPQ container connection on top of TLS via TCP\n    eventHubDomain := fmt.Sprintf(\"%s.servicebus.windows.net\", eventHubNamespaceName)\n    amqpConn, err := container.Connection(\n        tlsConn, \n        electron.SASLEnable(),\n        electron.User(eventHubSasKeyName), \n        electron.Password([]byte(eventHubSasKey)),\n        electron.VirtualHost(eventHubDomain),\n        // electron.SASLAllowedMechs(&lt;SOME_MECHANISM&gt;),\n    )\n    if err != nil {\n        panic(err)\n    }\n    defer amqpConn.Close(nil)\n\n    // AMQP sender (a AMQP link with target the name defined on the Azure portal)\n    s, err := amqpConn.Sender(electron.Target(eventHubName))\n    if err != nil {\n        panic(err)\n    }\n</code></pre>\n\n<p>However when running the app with the environment variable <code>PN_TRACE_FRM=true</code> (which is giving me some verbose logging at the <code>proton-c</code> level) now the error is: </p>\n\n<p><code>[handle=0, closed=true, error=@error(29) [condition=:\"amqp:unauthorized-access\", description=\"Unauthorized access. 'Send' claim(s) are required to perform this operation. Resource: 'sb://&lt;MY_CUSTOM_NAMESPACE&gt;.servicebus.windows.net/&lt;MY_CUSTOM_NAME&gt;'. TrackingId:&lt;SOME_UUID-ISH_HERE&gt;, SystemTracker:&lt;A_LABEL_HERE&gt;, Timestamp:10/25/2017 4:02:58 PM\"]]</code></p>\n\n<p>This afaik means the SASL details (username/password) must be of type \"sender\" because I am trying to send something to the Event Hub. I double checked those details on the Azure portal (click on \"Shared access policies\" > then using the policy with \"claim\" specified as \"Send\") and they are correct. So I am not sure why I am getting this error.</p>\n\n<p>I actually tried these SASL policies defined on the Azure portal at different levels, both <code>&lt;MY_CUSTOM_NAMESPACE&gt;</code> and <code>&lt;MY_CUSTOM_NAME&gt;</code>, but always the same error message.</p>\n\n<p>I also tried including various SASL mechanisms e.g. when using <code>electron.SASLAllowedMechs(\"PLAIN\")</code> then I get this error: <code>no mechanism available: No worthy mechs found (Authentication failed [mech=none])</code>.</p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1508848525, "post_id": 46910733, "comment_id": 80768060, "body": "Something&#39;s already listening on port 8080. Use a different port, or disable whatever is already listening there."}, {"owner": {"reputation": 3201, "user_id": 2892779, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uvM8S.jpg?s=128&g=1", "display_name": "Jay Dorsey", "link": "https://stackoverflow.com/users/2892779/jay-dorsey"}, "edited": false, "score": 0, "creation_date": 1508848723, "post_id": 46910733, "comment_id": 80768203, "body": "Try stopping that other container first"}], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 2796217, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6d4f53e7d691540d28d55e15eeecabbf?s=128&d=identicon&r=PG&f=1", "display_name": "Prasanna", "link": "https://stackoverflow.com/users/2796217/prasanna"}, "edited": false, "score": 0, "creation_date": 1508852797, "post_id": 46910801, "comment_id": 80771454, "body": "To clarify, I get that error only when I run the 2nd time. When I ran the run command first, it didn&#39;t complain. I ran it another time just to confirm that it&#39;s running."}, {"owner": {"reputation": 3318, "user_id": 4348824, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/dn0pG.png?s=128&g=1", "display_name": "Jinna Balu", "link": "https://stackoverflow.com/users/4348824/jinna-balu"}, "edited": false, "score": 0, "creation_date": 1508854855, "post_id": 46910801, "comment_id": 80772959, "body": "This is answer never help for the question asked above."}], "tags": [], "owner": {"reputation": 4281, "user_id": 1491850, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fd1125371f70fe174275e950d64885b7?s=128&d=identicon&r=PG", "display_name": "Daniel Perez", "link": "https://stackoverflow.com/users/1491850/daniel-perez"}, "is_accepted": false, "score": 2, "last_activity_date": 1508848594, "creation_date": 1508848594, "answer_id": 46910801, "question_id": 46910733, "link": "https://stackoverflow.com/questions/46910733/unable-to-run-golang-application-on-docker/46910801#46910801", "title": "Unable to run Golang application on Docker", "body": "<p>The issue seems quite clear</p>\n\n<pre><code>port is already allocated\n</code></pre>\n\n<p>which means that some other program is listening on port 8080.\nIf you are on a Linux system you can try to run</p>\n\n<pre><code>sudo lsof -i :8080\n</code></pre>\n\n<p>to find out what is.</p>\n\n<p>Otherwise, simply use another port.</p>\n"}, {"comments": [{"owner": {"reputation": 85, "user_id": 2796217, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6d4f53e7d691540d28d55e15eeecabbf?s=128&d=identicon&r=PG&f=1", "display_name": "Prasanna", "link": "https://stackoverflow.com/users/2796217/prasanna"}, "edited": false, "score": 0, "creation_date": 1508854355, "post_id": 46911440, "comment_id": 80772618, "body": "thank you very much. I had to run this netsh to get it working. Now it works even with 8080 after I ran this command. what does it do exactly?"}], "tags": [], "owner": {"reputation": 3318, "user_id": 4348824, "user_type": "registered", "accept_rate": 30, "profile_image": "https://i.stack.imgur.com/dn0pG.png?s=128&g=1", "display_name": "Jinna Balu", "link": "https://stackoverflow.com/users/4348824/jinna-balu"}, "is_accepted": true, "score": 1, "last_activity_date": 1508854775, "last_edit_date": 1508854775, "creation_date": 1508850473, "answer_id": 46911440, "question_id": 46910733, "link": "https://stackoverflow.com/questions/46910733/unable-to-run-golang-application-on-docker/46911440#46911440", "title": "Unable to run Golang application on Docker", "body": "<p>Change run.sh to replace port 8080 to 8082</p>\n\n<pre><code>#!/bin/bash\necho \"Listening on http://localhost:8082\"\ndocker run -p 8082:80 codetest\n</code></pre>\n\n<p>I have changes port to 8082 if the port is already in use change that port again to some other port based on your available port.</p>\n\n<p>If you are on Windows </p>\n\n<pre><code>netsh interface portproxy add v4tov4 listenport=8082 listenaddress=localhost connectport=8082 connectaddress=192.168.99.100(IP of the Docker)\n</code></pre>\n\n<p>Here is the helping discussion on port farwarding in windows with docker <a href=\"https://github.com/moby/moby/issues/15740#issuecomment-200409378\" rel=\"nofollow noreferrer\">Solution for Windows hosts</a></p>\n"}], "owner": {"reputation": 85, "user_id": 2796217, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6d4f53e7d691540d28d55e15eeecabbf?s=128&d=identicon&r=PG&f=1", "display_name": "Prasanna", "link": "https://stackoverflow.com/users/2796217/prasanna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 46911440, "answer_count": 2, "score": -2, "last_activity_date": 1508854775, "creation_date": 1508848426, "last_edit_date": 1508853206, "question_id": 46910733, "link": "https://stackoverflow.com/questions/46910733/unable-to-run-golang-application-on-docker", "title": "Unable to run Golang application on Docker", "body": "<p>I am trying to run this project - <a href=\"https://github.com/JumboInteractiveLimited/codetest\" rel=\"nofollow noreferrer\">https://github.com/JumboInteractiveLimited/codetest</a></p>\n\n<p>I've downloaded the Docker tool box, and I've executed the build and run commands as mentioned on the GitHub page, but when I try to access http:localhost:8080, the page is still unavailable.</p>\n\n<p>When I try to execute run again, Docker says </p>\n\n<pre><code>\"$ ./run.sh\nListening on http://localhost:8080\nC:\\Program Files\\Docker Toolbox\\docker.exe: Error response from daemon:    driver failed programming external connectivity on endpoint quirky_mcnulty (32af4359629669ee515cbc07d8bbe14cca3237979f37262882fb0288f5d6b6b8): Bind for 0.0.0.0:8080 failed: port is already allocated.\"\n</code></pre>\n\n<p><strong><em>Edit</em></strong>: To clarify, I get that error only when I run the 2nd time. When I ran the run command first, it didn't complain. I ran it another time just to confirm that it's running.</p>\n\n<p>When I initially ran, I got the following:</p>\n\n<pre><code>$ ./run.sh\nListening on http://localhost:8080\n2017/10/24 13:51:53 Waiting...\n</code></pre>\n"}, {"tags": ["go", "utf-8", "aerospike"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1508838410, "post_id": 46907192, "comment_id": 80761129, "body": "It looks like utf-8 that is being output as a single character encoding."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1508839729, "post_id": 46907192, "comment_id": 80762085, "body": "What&#39;s your locale? I.e. what <code>locale</code> prints there?"}, {"owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "edited": false, "score": 0, "creation_date": 1508841165, "post_id": 46907192, "comment_id": 80763067, "body": "LANG= LC_CTYPE=POSIX LC_NUMERIC=&quot;POSIX&quot; LC_TIME=&quot;POSIX&quot; LC_COLLATE=&quot;POSIX&quot; LC_MONETARY=&quot;POSIX&quot; LC_MESSAGES=&quot;POSIX&quot; LC_PAPER=&quot;POSIX&quot; LC_NAME=&quot;POSIX&quot; LC_ADDRESS=&quot;POSIX&quot; LC_TELEPHONE=&quot;POSIX&quot; LC_MEASUREMENT=&quot;POSIX&quot; LC_IDENTIFICATION=&quot;POSIX&quot; LC_ALL="}, {"owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "edited": false, "score": 0, "creation_date": 1508841245, "post_id": 46907192, "comment_id": 80763108, "body": "on my local machine the locale is en_US.utf-8. I thought this could be the problem. But I changed my locale on local machine and was hoping I would reproduce the problem locally but still the characters were fine :("}, {"owner": {"reputation": 3825, "user_id": 1917187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/115760c69c4f709ccf66ec14e08882b2?s=128&d=identicon&r=PG", "display_name": "pgupta", "link": "https://stackoverflow.com/users/1917187/pgupta"}, "edited": false, "score": 2, "creation_date": 1508867121, "post_id": 46907192, "comment_id": 80781037, "body": "aql is a C-application that runs the C client underneath. Did you check if this is not an aql bug by retrieving msg bin through your golang client?"}, {"owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "reply_to_user": {"reputation": 3825, "user_id": 1917187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/115760c69c4f709ccf66ec14e08882b2?s=128&d=identicon&r=PG", "display_name": "pgupta", "link": "https://stackoverflow.com/users/1917187/pgupta"}, "edited": false, "score": 0, "creation_date": 1508886999, "post_id": 46907192, "comment_id": 80790304, "body": "@pgupta yes. I got this problem with my golang client. That&#39;s when I logged in to the remote machine and tried the aql (which also gave the same result). Also, if it was an aql bug, it wouldn&#39;t have worked on my local machine right ?"}], "answers": [{"comments": [{"owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "edited": false, "score": 0, "creation_date": 1508895585, "post_id": 46922503, "comment_id": 80792380, "body": "In that case, why I see the multibyte characters correctly on my local machine ?"}, {"owner": {"reputation": 3372, "user_id": 762649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f21acc9d59af609a140703b8c2c2aca1?s=128&d=identicon&r=PG", "display_name": "sunil", "link": "https://stackoverflow.com/users/762649/sunil"}, "reply_to_user": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "edited": false, "score": 1, "creation_date": 1508903398, "post_id": 46922503, "comment_id": 80794330, "body": "Can you show how the same query comes out in your local machine"}, {"owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "edited": false, "score": 0, "creation_date": 1508903489, "post_id": 46922503, "comment_id": 80794343, "body": "The result contains proper characters like \u0e32\u0e21\u0e44\u0e14\u0e49\u0e23\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e15"}], "tags": [], "owner": {"reputation": 3372, "user_id": 762649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f21acc9d59af609a140703b8c2c2aca1?s=128&d=identicon&r=PG", "display_name": "sunil", "link": "https://stackoverflow.com/users/762649/sunil"}, "is_accepted": true, "score": 3, "last_activity_date": 1508894873, "creation_date": 1508894873, "answer_id": 46922503, "question_id": 46907192, "link": "https://stackoverflow.com/questions/46907192/aerospike-charset-utf8-setting/46922503#46922503", "title": "Aerospike charset utf8 setting", "body": "<p>aql is a tool written in c-client. In c-client, the application is expected to handle utf-8 encoding as there is no \"string\" datatype similar to newer generation languages that support multibyte utf-8 characters. The application reading data should have prior knowledge that the data is indeed written with utf-8 encoding to handle that. aql cannot determine that as it is a generic tool. So, it ends up printing each byte as a character. </p>\n"}], "owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 46922503, "answer_count": 1, "score": 2, "last_activity_date": 1508897195, "creation_date": 1508838239, "last_edit_date": 1592644375, "question_id": 46907192, "link": "https://stackoverflow.com/questions/46907192/aerospike-charset-utf8-setting", "title": "Aerospike charset utf8 setting", "body": "<p>I am inserting  a record in aerospike. Everything is working fine on my local environment. However, on the staging environment, UTF-8 characters are not being stored correctly.</p>\n<blockquote>\n<p>aql&gt; select msg from test.msges</p>\n<p>LIST('[&quot;{&quot;message_id&quot;:&quot;kxwFZHVBKj&quot;,&quot;title&quot;:&quot;\u00e0\u00b8\u201e\u00e0\u00b8\u00b3\u00e0\u00b8\u2013\u00e0\u00b8\u00b2\u00e0\u00b8\u00a1\u00e0\u00b9\u201e\u00e0\u00b8\u201d\u00e0\u00b9\u2030\u00e0\u00b8\u00a3\u00e0\u00b8\u00b1\u00e0\u00b8\u0161\u00e0\u00b8\u00e0\u00b8\u00b2\u00e0\u00b8\u00a3\u00e0\u00b8\u2022\u00e0\u00b8\u00ad\u00e0\u00b8\u0161\u00e0\u00b8\u00e0\u00b8\u00a5\u00e0\u00b8\u00b1\u00e0\u00b8\u0161\u00e0\u00b9\u00e0\u00b8\u00a5\u00e0\u00b9\u2030\u00e0\u00b8\u00a7!&quot;,&quot;actions&quot;:\n|\n+----------------------------------------------------------------------------------------------------------+ 1 row in set (0.038 secs)</p>\n</blockquote>\n<p>Also, this is being done using a golang clinet which is pretty UTF-8 safe i.e. no problems of byte-to-string or string-to-byte conversions and this works fine on local, hence\nI am assuming this has something to do with aerospike configuration or version. The aerospike version on my local is 3.14.1.1 and on staging is 3.9.1.1.</p>\n<p>One more thing I noticed based on the c-client comments coming on this post is that on my local machine I get the following aql version:</p>\n<blockquote>\n<p>Aerospike Query Client Version 3.13.0.1 C Client Version 4.1.6</p>\n</blockquote>\n<p>But on the remote I have the following:</p>\n<blockquote>\n<p>Aerospike Query Client Version 3.9.1.2</p>\n</blockquote>\n<p>The C-client version is missing !</p>\n<p>Anyone can help what configuration (or whatever) am I missing here ?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1508836862, "post_id": 46906647, "comment_id": 80760042, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/45500836/close-multiple-goroutine-if-an-error-occurs-in-one-in-go/45502591#45502591\">Close multiple goroutine if an error occurs in one in go</a>."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1508844894, "post_id": 46908407, "comment_id": 80765537, "body": "Close (or buffer) the channel, or this will leak goroutines (two sends, but only one receive if the first value is not nil; just like the example in the question)."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1508845594, "post_id": 46908407, "comment_id": 80765941, "body": "Actually in my example the program will terminate the main go routine, shutting down the runtime, so nothing leaks. But you are right, in a more complex scenario this could be a problem."}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 0, "last_activity_date": 1508845814, "last_edit_date": 1508845814, "creation_date": 1508841757, "answer_id": 46908407, "question_id": 46906647, "link": "https://stackoverflow.com/questions/46906647/wait-result-of-multiple-goroutines/46908407#46908407", "title": "Wait result of multiple goroutines", "body": "<p>I have created a smaller, self-contained example of how you can have two go routines run asynchronously and wait for both to finish or quit the program if an error occurs (see below for an explanation): </p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    rand.Seed(time.Now().UnixNano())\n\n    // buffer the channel so the async go routines can exit right after sending\n    // their error\n    status := make(chan error, 2)\n\n    go func(c chan&lt;- error) {\n        if rand.Intn(2) == 0 {\n            c &lt;- errors.New(\"func 1 error\")\n        } else {\n            fmt.Println(\"func 1 done\")\n            c &lt;- nil\n        }\n    }(status)\n\n    go func(c chan&lt;- error) {\n        if rand.Intn(2) == 0 {\n            c &lt;- errors.New(\"func 2 error\")\n        } else {\n            fmt.Println(\"func 2 done\")\n            c &lt;- nil\n        }\n    }(status)\n\n    for i := 0; i &lt; 2; i++ {\n        if err := &lt;-status; err != nil {\n            fmt.Println(\"error encountered:\", err)\n            break\n        }\n    }\n}\n</code></pre>\n\n<p>What I do is create a channel that is used for synchronization of the two go routines. Writing to and reading from it blocks. The channel is used to pass the error value around, or nil if the function succeeds.</p>\n\n<p>At the end I read one value per async go routine from the channel. This blocks until a value is received. If an error occurs, I exit the loop, thus quitting the program.</p>\n\n<p>The functions either succeed or fail randomly.</p>\n\n<p>I hope this gets you going on how to coordinate go routines, if not, let me know in the comments.</p>\n\n<p><strong>Note</strong> that if you run this in the Go Playground, the rand.Seed will do nothing, the playground always has the same \"random\" numbers, so the behavior will not change.</p>\n"}, {"comments": [{"owner": {"reputation": 717, "user_id": 3586311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pmO7J.jpg?s=128&g=1", "display_name": "jeffrey", "link": "https://stackoverflow.com/users/3586311/jeffrey"}, "edited": false, "score": 3, "creation_date": 1508865337, "post_id": 46911928, "comment_id": 80780075, "body": "<a href=\"https://nathanleclaire.com/blog/2014/02/15/how-to-wait-for-all-goroutines-to-finish-executing-before-continuing/\" rel=\"nofollow noreferrer\">nathanleclaire.com/blog/2014/02/15/&hellip;</a> nice blog post on sync.WaitGroup and the docs <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">golang.org/pkg/sync/#WaitGroup</a>"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 5, "last_activity_date": 1508851999, "creation_date": 1508851999, "answer_id": 46911928, "question_id": 46906647, "link": "https://stackoverflow.com/questions/46906647/wait-result-of-multiple-goroutines/46911928#46911928", "title": "Wait result of multiple goroutines", "body": "<p>I think here  sync.WaitGroup can be used. It can waits for different and dynamic number of goroutines. </p>\n"}, {"tags": [], "owner": {"reputation": 218, "user_id": 6275993, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PI08D.png?s=128&g=1", "display_name": "Jeyem", "link": "https://stackoverflow.com/users/6275993/jeyem"}, "is_accepted": true, "score": 10, "last_activity_date": 1508871426, "last_edit_date": 1508871426, "creation_date": 1508868853, "answer_id": 46917360, "question_id": 46906647, "link": "https://stackoverflow.com/questions/46906647/wait-result-of-multiple-goroutines/46917360#46917360", "title": "Wait result of multiple goroutines", "body": "<p>You should create two channels for errors and results, then first read errors if no erorrs then read the results, this sample should works for your use case:</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"sync\"\n)\n\nfunc test(i int) (int, error) {\n    if i &gt; 2 {\n        return 0, errors.New(\"test error\")\n    }\n    return i + 5, nil\n}\n\nfunc test2(i int) (int, error) {\n    if i &gt; 3 {\n        return 0, errors.New(\"test2 error\")\n    }\n    return i + 7, nil\n}\n\nfunc main() {\n    results := make(chan int, 2)\n    errors := make(chan error, 2)\n    var wg sync.WaitGroup\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        result, err := test(3)\n        if err != nil {\n            errors &lt;- err\n            return\n        }\n        results &lt;- result\n    }()\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        result, err := test2(3)\n        if err != nil {\n            errors &lt;- err\n            return\n        }\n        results &lt;- result\n    }()\n\n    // here we wait in other goroutine to all jobs done and close the channels\n    go func() {\n        wg.Wait()\n        close(results)\n        close(errors)\n    }()\n    for err := range errors {\n        // here error happend u could exit your caller function\n        println(err.Error())\n        return\n\n    }\n    for res := range results {\n        println(\"--------- \", res, \" ------------\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 155, "user_id": 1593294, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9ba235e44ac1e0df7c3bb8ea2d83da71?s=128&d=identicon&r=PG", "display_name": "user1593294", "link": "https://stackoverflow.com/users/1593294/user1593294"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7263, "favorite_count": 1, "accepted_answer_id": 46917360, "answer_count": 3, "score": 10, "last_activity_date": 1508929115, "creation_date": 1508836677, "last_edit_date": 1508929115, "question_id": 46906647, "link": "https://stackoverflow.com/questions/46906647/wait-result-of-multiple-goroutines", "title": "Wait result of multiple goroutines", "body": "<p>I am searching a way to execute asynchronously two functions in go which returns different results and errors, wait for them to finish and print both results. Also if one of function returned error I do not want to wait for another function, and just print the error.\nFor example, I have this functions:</p>\n\n<pre><code>func methodInt(error bool) (int, error) {\n    &lt;-time.NewTimer(time.Millisecond * 100).C\n    if error {\n        return 0, errors.New(\"Some error\")\n    } else {\n        return 1, nil\n    }\n}\n\nfunc methodString(error bool) (string, error) {\n    &lt;-time.NewTimer(time.Millisecond * 120).C\n    if error {\n        return \"\", errors.New(\"Some error\")\n    } else {\n        return \"Some result\", nil\n    }\n}\n</code></pre>\n\n<p>Here <a href=\"https://play.golang.org/p/-8StYapmlg\" rel=\"noreferrer\">https://play.golang.org/p/-8StYapmlg</a> is how I implemented it, but it has too much code I think. It can be simplified by using interface{} but I don't want to go this way. I want something simpler as, for example, can be implemented in C# with async/await. Probably there is some library that simplifies such operation.</p>\n\n<p>UPDATE: Thank for your responses! It is awesome how fast I got help! I like the usage of WaitGroup. It obviously makes the code more robust to changes, so I easily can add another async method without changing exact count of methods in the end. However, there is still so much code in comparison to same in C#. I know that in go I don't need to explicitly mark methods as async, making them actually to return tasks, but methods call looks much more simple, for example, consider this link <a href=\"https://stackoverflow.com/questions/25009437/running-multiple-async-tasks-and-waiting-for-them-all-to-complete\">actually catching exception is also needed</a>\nBy the way, I found that in my task I actually don't need to know returning type of the functions I want to run async because it will be anyway marshaled to json, and now I just call multiple services in the endpoint layer of go-kit.</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1508861508, "post_id": 46906183, "comment_id": 80777861, "body": "As long as the two structs have the same type layout and field names, you don&#39;t have to do a field-by-field assembly, you can simply directly type-convert them: <a href=\"https://play.golang.org/p/FqR0-W-BF7\" rel=\"nofollow noreferrer\">play.golang.org/p/FqR0-W-BF7</a>"}, {"owner": {"reputation": 878, "user_id": 485537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c87cf995de980b401e56e22e27a5e0a?s=128&d=identicon&r=PG", "display_name": "supernova", "link": "https://stackoverflow.com/users/485537/supernova"}, "edited": false, "score": 0, "creation_date": 1539002126, "post_id": 46906183, "comment_id": 92331341, "body": "this won&#39;t work since this: <a href=\"https://github.com/golang/protobuf/issues/607\" rel=\"nofollow noreferrer\">github.com/golang/protobuf/issues/607</a>"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 2, "last_activity_date": 1508835480, "creation_date": 1508835480, "answer_id": 46906183, "question_id": 46906014, "link": "https://stackoverflow.com/questions/46906014/how-to-implement-transformation-of-a-struct-to-a-similar-struct-in-go/46906183#46906183", "title": "How to implement transformation of a struct to a similar struct in Go", "body": "<p>Use a for loop:</p>\n\n<pre><code>var userRequests []* UserRequest\nusers := model.GetUsers()\nfor _, u := range users {\n  ur := &amp;UserRequest{name:u.Name, uid:u.uid, etc...}\n  userRequests = append(userRequests,ur)\n} \n</code></pre>\n\n<p>You could use a function NewUserRequest(u) instead of constructing a ur inline like this. You haven't shown UserRequest so the fields would have to be adapted to whatever fields you have in there. </p>\n"}, {"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1508861191, "post_id": 46908646, "comment_id": 80777648, "body": "Don&#39;t even need json annotations, as long as the field names are the same (JSON defaults to using the case-sensitive field name, and then if there&#39;s no match, the case-insensitive field name).  The problem is, the fields have to be exported, which they currently are not."}], "tags": [], "owner": {"reputation": 240, "user_id": 8800369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4f69be8fda374dc3075128df3a05f37?s=128&d=identicon&r=PG", "display_name": "Hein Oldewage", "link": "https://stackoverflow.com/users/8800369/hein-oldewage"}, "is_accepted": false, "score": 0, "last_activity_date": 1508842419, "creation_date": 1508842419, "answer_id": 46908646, "question_id": 46906014, "link": "https://stackoverflow.com/questions/46906014/how-to-implement-transformation-of-a-struct-to-a-similar-struct-in-go/46908646#46908646", "title": "How to implement transformation of a struct to a similar struct in Go", "body": "<p>The generated from (<code>user.proto</code>) should have JSON annotations on them. By adding JSON annotations to your type in <code>user.go</code> you can marshal the <code>User</code> and unmarshal it into a <code>UserRequest</code> and vice-versa. Note that this approach is not very performant (it uses a lot of unnecessary cpu for marshaling JSON and creates a bit of garbage to collect), it is however easy to do for a type that has many fields or one that changes a lot.</p>\n\n<p>Another approach would be to use <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">reflection</a>. This will allow you to convert between any two types with the same fields.\nMight be a little faster than JSON, but not as fast as function that converts between the two.</p>\n"}], "owner": {"reputation": 49, "user_id": 7824719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e7bcbdbc0aa499fbb2cb1c0e7a5b6cd?s=128&d=identicon&r=PG&f=1", "display_name": "Mrj ", "link": "https://stackoverflow.com/users/7824719/mrj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1498, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1508842419, "creation_date": 1508834929, "last_edit_date": 1508842100, "question_id": 46906014, "link": "https://stackoverflow.com/questions/46906014/how-to-implement-transformation-of-a-struct-to-a-similar-struct-in-go", "title": "How to implement transformation of a struct to a similar struct in Go", "body": "<p>I have 2 structs and one of them is made of protobuf, the other is made from xorm`s table struct.</p>\n\n<p>There is a function which needs []*UserResult but I only have []*Users.</p>\n\n<p>How do I transform them? </p>\n\n<pre><code>//user.proto =&gt; \nmessage UserResult {\n  int64 uid = 1 ;\n  string name = 2 ;\n}\n//user.go\ntype User struct {\n   uid int64 \n   name string \n}\nfunc GetUserList(){\n   var users []*User\n   return xorm.xxxx.Get(&amp;users)\n}\n\n// server.go \nfunc (s *server)GetUserList() ([]*UserRequest , error) {\n    users := model.GetUsers()\n    // here  how to make users ---&gt;  []*UserRequest ???\n} \n</code></pre>\n"}, {"tags": ["string", "performance", "go", "random", "hex"], "answers": [{"comments": [{"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1508833172, "post_id": 46904696, "comment_id": 80757613, "body": "I got same panic error with correction if I do <code>var tryArr = make([]string, 100000)</code>. I use <code>go version go1.8.3 windows&#47;386</code>. Rem No error on Go Playground, strange ...."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1508833367, "post_id": 46904696, "comment_id": 80757734, "body": "@LeMoussel As stated in the answer, the panic does not originate from the code you posted, but from the <code>math&#47;rand</code> package. Maybe your installation is corrupted? Can you try it with Go 1.9.1?"}, {"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1508839722, "post_id": 46904696, "comment_id": 80762076, "body": "Same with Go v1.9.1. No error with <code>RandStringBytesMaskImpr</code> thant don&#39;t use <code>rand.Source</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1508840711, "post_id": 46904696, "comment_id": 80762765, "body": "@LeMoussel In that case I suggest to file a bug report, as this is definitely not normal: <a href=\"https://github.com/golang/go/issues\" rel=\"nofollow noreferrer\">github.com/golang/go/issues</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1508841795, "post_id": 46904696, "comment_id": 80763462, "body": "@LeMoussel One last question: you don&#39;t call <code>RandStringBytesMaskImprSrc()</code> concurrently from multiple goroutines right? As the code uses a &quot;shared&quot; <code>rand.Source</code> which is not safe for concurrent use. If you need concurrent use, create a separate <code>rand.Source</code> for each goroutines."}, {"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1508914544, "post_id": 46904696, "comment_id": 80798385, "body": "Yep I call <code>RandStringBytesMaskImprSrc()</code> concurrently from multiple goroutines. OK I  create a separate <code>rand.Source</code> for each goroutines."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1508917463, "last_edit_date": 1592644375, "creation_date": 1508830351, "answer_id": 46904696, "question_id": 46904588, "link": "https://stackoverflow.com/questions/46904588/efficient-way-to-to-generate-a-random-hex-string-of-a-fixed-length-in-golang/46904696#46904696", "title": "Efficient way to to generate a random Hex string of a fixed length in Golang?", "body": "<p>Actually the code you posted runs, as even though there's a mistake in it (see below), it still doesn't cause a panic (just makes performance worse).</p>\n<p>The stack trace you posted indicates error in the <code>math/rand</code> package, I did not experience it. Please post full code and Go version + env (<code>go version</code> and <code>go env</code>).</p>\n<h3>Reason for panic / Solution:</h3>\n<p>As it turns out, the asker was calling <code>RandStringBytesMaskImprSrc()</code> concurrently, from multiple goroutines. <code>RandStringBytesMaskImprSrc()</code> uses a shared <code>rand.Source</code> instance which is not safe for concurrent use, hence the panic from the <code>math/rand</code> package. Fix is to create a separate <code>rand.Source()</code> for each goroutines, and pass that to <code>RandStringBytesMaskImprSrc()</code>.</p>\n<hr />\n<p>There is a mistake in the &quot;configuration&quot; constants at the beginning:</p>\n<pre><code>const letterBytes = &quot;abcdef0123456789&quot;\nconst (\n    letterIdxBits = 6                    // 6 bits to represent a letter index\n    letterIdxMask = 1&lt;&lt;letterIdxBits - 1 // All 1-bits, as many as letterIdxBits\n    letterIdxMax  = 63 / letterIdxBits   // # of letter indices fitting in 63 bits\n)\n</code></pre>\n<p>The constant <code>letterIdxBits</code> should contain how many bits are required to represent a symbol index. Since you're using an alphabet of 16 elements (the length of <code>letterBytes</code>), 16 combinations require only 4 bits:</p>\n<pre><code>letterIdxBits = 4                    // 4 bits to represent a letter index\n</code></pre>\n<p>Example testing it:</p>\n<pre><code>var tryArr = make([]string, 10)\nfor i := range tryArr {\n    tryArr[i] = RandStringBytesMaskImprSrc(8)\n}\nfmt.Println(tryArr)\n</code></pre>\n<p>Output (try it on the <a href=\"https://play.golang.org/p/j_c4BDoIUw\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>[d3e7caa6 a69c9b7d c37a613b 92d5a43b 64059c4a 4f08141b 70130c65 1546daaf fe140fcd 0d714e4d]\n</code></pre>\n<p>(Note: since the starting time on the Go playground is fixed and output is cached, you will always see these random generated strings. Run it on your machine to see random results.)</p>\n"}, {"comments": [{"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1508832321, "post_id": 46905144, "comment_id": 80757141, "body": "Does  <code>BenchmarkFm()</code> is bench of <code>fmt.Sprintf(&quot;%x&quot;, rnd.Uint64())</code> &amp; <code>BenchmarkStrconv()</code> is bench of <code>strconv.FormatUint(rnd.Uint64(), 16)</code> Can you post benchmark code?"}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "reply_to_user": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1508832372, "post_id": 46905144, "comment_id": 80757179, "body": "@LeMoussel Standard benchmarks from the testing package."}], "tags": [], "owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "is_accepted": false, "score": 2, "last_activity_date": 1508831949, "creation_date": 1508831949, "answer_id": 46905144, "question_id": 46904588, "link": "https://stackoverflow.com/questions/46904588/efficient-way-to-to-generate-a-random-hex-string-of-a-fixed-length-in-golang/46905144#46905144", "title": "Efficient way to to generate a random Hex string of a fixed length in Golang?", "body": "<p>First, replace your rand source with a proper generator, with:</p>\n\n<pre><code>var rnd = rand.New(src)\n</code></pre>\n\n<p>Then just use a standard solutions to format numbers:</p>\n\n<pre><code>fmt.Sprintf(\"%x\", rnd.Uint64())\n</code></pre>\n\n<p>alternatively;</p>\n\n<pre><code>strconv.FormatUint(rnd.Uint64(), 16)\n</code></pre>\n\n<p>Both those methods are faster than yours (after it has been bugfixed):</p>\n\n<pre><code>BenchmarkRandStringBytesMaskImprSrc-4       10000000           196 ns/op\nBenchmarkFmt-4                              10000000           148 ns/op\nBenchmarkStrconv-4                          20000000            89.8 ns/op\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1508918345, "post_id": 46909816, "comment_id": 80800754, "body": "Dont&#39; run ! Error: <code>src.Read undefined (type rand.Source has no field or method Read)</code>  <a href=\"https://play.golang.org/p/D1gSxGbiCC\" rel=\"nofollow noreferrer\">Go Playground</a>"}, {"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1508922876, "post_id": 46909816, "comment_id": 80803613, "body": "solution is to replace <code>rand.NewSource(time.Now().UnixNano())</code> by <code>rand.New(rand.NewSource(time.Now().UnixNano()))</code>"}, {"owner": {"reputation": 1278, "user_id": 5269850, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ba47a45cb900337650d9adb725b3b14c?s=128&d=identicon&r=PG&f=1", "display_name": "EB2127", "link": "https://stackoverflow.com/users/5269850/eb2127"}, "edited": false, "score": 0, "creation_date": 1596063419, "post_id": 46909816, "comment_id": 111694043, "body": "Also, this needs the library <code>&quot;time&quot;</code>"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1596094877, "last_edit_date": 1596094877, "creation_date": 1508845782, "answer_id": 46909816, "question_id": 46904588, "link": "https://stackoverflow.com/questions/46904588/efficient-way-to-to-generate-a-random-hex-string-of-a-fixed-length-in-golang/46909816#46909816", "title": "Efficient way to to generate a random Hex string of a fixed length in Golang?", "body": "<p>*math/rand.Rand is an io.Reader, so it is trivial to read N random bytes and then hexencode them:</p>\n<pre><code>package main\n\nimport (\n    &quot;encoding/hex&quot;\n    &quot;fmt&quot;\n    &quot;math/rand&quot;\n    &quot;time&quot;\n)\n\nvar src = rand.New(rand.NewSource(time.Now().UnixNano()))\n\nfunc main() {\n    fmt.Println(RandStringBytesMaskImprSrc(4))\n}\n\n// RandStringBytesMaskImprSrc returns a random hexadecimal string of length n.\nfunc RandStringBytesMaskImprSrc(n int) string {\n    b := make([]byte, (n+1)/2) // can be simplified to n/2 if n is always even\n\n    if _, err := src.Read(b); err != nil {\n            panic(err)\n    }\n\n    return hex.EncodeToString(b)[:n]\n}\n</code></pre>\n"}], "owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4874, "favorite_count": 1, "accepted_answer_id": 46904696, "answer_count": 3, "score": 5, "last_activity_date": 1596094877, "creation_date": 1508829984, "last_edit_date": 1508923387, "question_id": 46904588, "link": "https://stackoverflow.com/questions/46904588/efficient-way-to-to-generate-a-random-hex-string-of-a-fixed-length-in-golang", "title": "Efficient way to to generate a random Hex string of a fixed length in Golang?", "body": "<p>I need to generate a lot of a random hex string of a fixed length. \nI find this solution <a href=\"https://stackoverflow.com/a/31832326/710955\">How to generate a random string of a fixed length in golang?</a> </p>\n\n<p>I'm doing something like this:</p>\n\n<pre><code>const letterBytes = \"abcdef0123456789\"\nconst (\n    letterIdxBits = 6                    // 6 bits to represent a letter index\n    letterIdxMask = 1&lt;&lt;letterIdxBits - 1 // All 1-bits, as many as letterIdxBits\n    letterIdxMax  = 63 / letterIdxBits   // # of letter indices fitting in 63 bits\n)\n\nvar src = rand.NewSource(time.Now().UnixNano())\n\n// RandStringBytesMaskImprSrc ...\n// Src: https://stackoverflow.com/a/31832326/710955\nfunc RandStringBytesMaskImprSrc(n int) string {\n    b := make([]byte, n)\n    // A src.Int63() generates 63 random bits, enough for letterIdxMax characters!\n    for i, cache, remain := n-1, src.Int63(), letterIdxMax; i &gt;= 0; {\n        if remain == 0 {\n            cache, remain = src.Int63(), letterIdxMax\n        }\n        if idx := int(cache &amp; letterIdxMask); idx &lt; len(letterBytes) {\n            b[i] = letterBytes[idx]\n            i--\n        }\n        cache &gt;&gt;= letterIdxBits\n        remain--\n    }\n\n    return string(b)\n}\n\nvar tryArr = make([]string, 10000)\nfor i := 0; i &lt; 10000; i++ {\n    tryArr[i] = RandStringBytesMaskImprSrc(8)\n}\n</code></pre>\n\n<p>But I got this panic error</p>\n\n<pre><code>panic: runtime error: index out of range\n\ngoroutine 36 [running]:\nmath/rand.(*rngSource).Int63(0x11bb1300, 0x8, 0x8)\n    D:/Applications/Go/src/math/rand/rng.go:231 +0xa0\nmain.RandStringBytesMaskImprSrc(0x8, 0x11f81be8, 0x8)\n    main.go:60 +0x5f\n</code></pre>\n\n<p>The errror seem to be in  <code>for i, cache, remain := n-1, src.Int63(), letterIdxMax; i &gt;= 0;</code>, but I don't find why there is this error.</p>\n\n<p>What is the fastest and simplest way to generate a lot of a random hex string of a fixed length in Go?</p>\n\n<p><strong>Benchmark</strong> </p>\n\n<pre><code>package bench\n\nimport (\n    \"encoding/hex\"\n    \"math/rand\"\n    \"testing\"\n    \"time\"\n)\n\nconst letterBytes = \"abcdef0123456789\"\nconst (\n    letterIdxBits = 4                    // 4 bits to represent a letter index\n    letterIdxMask = 1&lt;&lt;letterIdxBits - 1 // All 1-bits, as many as letterIdxBits\n    letterIdxMax  = 63 / letterIdxBits   // # of letter indices fitting in 63 bits\n)\n\nvar src1 = rand.NewSource(time.Now().UnixNano())\nvar src2 = rand.New(rand.NewSource(time.Now().UnixNano()))\n\n// RandStringBytesMaskImprSrc returns a random hexadecimal string of length n.\nfunc RandStringBytesMaskImprSrc1(n int) string {\n    b := make([]byte, n)\n    for i, cache, remain := n-1, src1.Int63(), letterIdxMax; i &gt;= 0; {\n        if remain == 0 {\n            cache, remain = src1.Int63(), letterIdxMax\n        }\n        if idx := int(cache &amp; letterIdxMask); idx &lt; len(letterBytes) {\n            b[i] = letterBytes[idx]\n            i--\n        }\n        cache &gt;&gt;= letterIdxBits\n        remain--\n    }\n\n    return string(b)\n}\n\nfunc RandStringBytesMaskImprSrc2(n int) string {\n    b := make([]byte, (n+1)/2) // can be simplified to n/2 if n is always even\n\n    if _, err := src2.Read(b); err != nil {\n        panic(err)\n    }\n\n    return hex.EncodeToString(b)[:n]\n}\n\nfunc BenchmarkRandStringBytesMaskImprSrc1(b *testing.B) {\n    for n := 0; n &lt; b.N; n++ {\n        _ = RandStringBytesMaskImprSrc1(8)\n    }\n}\n\nfunc BenchmarkRandStringBytesMaskImprSrc2(b *testing.B) {\n    for n := 0; n &lt; b.N; n++ {\n        _ = RandStringBytesMaskImprSrc2(8)\n    }\n}\n\n\ngoos: windows\ngoarch: 386\nBenchmarkRandStringBytesMaskImprSrc1-4          20000000               116 ns/op              16 B/op          2 allocs/op\nBenchmarkRandStringBytesMaskImprSrc2-4          10000000               231 ns/op              24 B/op          3 allocs/op\nPASS\nok      command-line-arguments  5.139s\n</code></pre>\n\n<p>=> icza <code>RandStringBytesMaskImprSrc</code>solution is more efficient</p>\n"}, {"tags": ["go", "rabbitmq", "archlinux"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 2874156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/431036f1fe96fe98c7ad0366bc21cbbd?s=128&d=identicon&r=PG", "display_name": "prantoran", "link": "https://stackoverflow.com/users/2874156/prantoran"}, "is_accepted": false, "score": -2, "last_activity_date": 1508827653, "creation_date": 1508827653, "answer_id": 46903878, "question_id": 46903292, "link": "https://stackoverflow.com/questions/46903292/rabbitmq-in-go-machinery-worker-cannot-to-connect-to-0-0-0-05672-with-message/46903878#46903878", "title": "RabbitMQ in Go: machinery worker cannot to connect to 0.0.0.0:5672 with message getsockopt: connection refused", "body": "<p>First, I checked the status using:</p>\n\n<pre><code>sudo systemctl status rabbitmq\n</code></pre>\n\n<p>where, I got the message:</p>\n\n<pre><code>ERROR: epmd error for host \"yourhostname\": timeout (timed out establishing tcp connection)\n</code></pre>\n\n<p>Then, I addeded the following entry in <code>/etc/hosts</code>:</p>\n\n<pre><code>127.0.0.1    yourhostname.localgroup    yourhostname\n</code></pre>\n\n<p>Then, I restarted rabbitmq using:</p>\n\n<pre><code>sudo systemctl restart rabbitmq\n</code></pre>\n\n<p>I did not change any configuration in <code>/etc/rabbitmq/rabbitmq-env.conf</code></p>\n"}], "owner": {"reputation": 1, "user_id": 2874156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/431036f1fe96fe98c7ad0366bc21cbbd?s=128&d=identicon&r=PG", "display_name": "prantoran", "link": "https://stackoverflow.com/users/2874156/prantoran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 364, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1508831827, "creation_date": 1508825263, "last_edit_date": 1508831827, "question_id": 46903292, "link": "https://stackoverflow.com/questions/46903292/rabbitmq-in-go-machinery-worker-cannot-to-connect-to-0-0-0-05672-with-message", "title": "RabbitMQ in Go: machinery worker cannot to connect to 0.0.0.0:5672 with message getsockopt: connection refused", "body": "<p>RabbitMQ works fine in the wifi network in which I set up the RabbitMQ in a laptop running Arch Linux. However, when I use the same laptop in a different wifi network, I get the following error:</p>\n\n<pre><code>machinery: worker.go:42: Going to retry launching the worker. Error: Dial: dial tcp 0.0.0.0:5672: getsockopt: connection refused\nmachinery: retry.go:20: Retrying in x seconds\n</code></pre>\n\n<p>I have no clue as to why RabbitMQ works in one network and not in the other. I tried changing the url in the <code>/etc/rabbitmq/rabbitmq-env.conf</code> but there is no effect.</p>\n\n<p>Here is the initial terminal output from RabbitMQ:\n`</p>\n\n<pre><code>machinery: worker.go:27: Launching a worker with the following settings:\nmachinery: worker.go:28: - Broker: amqp://0.0.0.0:5672\nmachinery: worker.go:29: - ResultBackend: amqp://0.0.0.0:5672\nmachinery: worker.go:30: - Exchange: machinery_exchange\nmachinery: worker.go:31: - ExchangeType: direct\nmachinery: worker.go:32: - DefaultQueue: machinery_tasks\nmachinery: worker.go:33: - BindingKey: machinery_key\n</code></pre>\n\n<p>`</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508817477, "post_id": 46901639, "comment_id": 80750613, "body": "&quot;Now my question, can I convert the values at the same time as parsing the JSON response.&quot; Yes. Please take a look at the package documentation, the internet or just <i>try</i> using <code>int</code>."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 8822663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1911ebd9e0e267c1a697ea57bc6504bf?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/8822663/jacob"}, "edited": false, "score": 0, "creation_date": 1508836920, "post_id": 46903699, "comment_id": 80760088, "body": "Wow. This is so much better \ud83d\udc4d"}], "tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": true, "score": 5, "last_activity_date": 1508828121, "last_edit_date": 1508828121, "creation_date": 1508827034, "answer_id": 46903699, "question_id": 46901639, "link": "https://stackoverflow.com/questions/46901639/how-to-parse-json-values-in-its-correct-type-in-go/46903699#46903699", "title": "How to parse JSON values in its correct type in Go?", "body": "<p>You don't have to use <code>string</code> type. The <code>encoding/json</code> package can handle the conversion from string to <em>string</em>, <em>floating point</em>, <em>integer</em>, or <em>boolean</em> types by using the <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"noreferrer\">\"string\" option</a> in the tags.</p>\n\n<p>As an example, try:</p>\n\n<pre><code>type event []struct {\n    ID    uint64  `json:\"id,string\"`\n    Price float64 `json:\"price,string\"`\n    Time  int64   `json:\"time,string\"`\n    Type  string  `json:\"type\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 8822663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1911ebd9e0e267c1a697ea57bc6504bf?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/8822663/jacob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 46903699, "answer_count": 1, "score": 3, "last_activity_date": 1508828121, "creation_date": 1508814983, "question_id": 46901639, "link": "https://stackoverflow.com/questions/46901639/how-to-parse-json-values-in-its-correct-type-in-go", "title": "How to parse JSON values in its correct type in Go?", "body": "<p>I'm processing events from an JSON API in Go but unfortunately every value returned is encapsulated as string.</p>\n\n<p>The JSON events coming form that API look somewhat as the following:</p>\n\n<pre><code>[\n  {\n    \"id\": \"283702\",\n    \"price\": \"59.99\",\n    \"time\": \"1508813904\",\n    \"type\": \"some_update\"\n  },\n  {\n    \"id\": \"283701\",\n    \"price\": \"17.50\",\n    \"time\": \"1508813858\",\n    \"type\": \"some_update\"\n  }\n]\n</code></pre>\n\n<p>Now my code to parse these evens looks like the following example:</p>\n\n<pre><code>type event []struct {\n    ID string    `json:\"id\"`\n    Price string `json:\"price\"`\n    Time string  `json:\"time\"`\n    Type string  `json:\"type\"`\n}\n\n// Requesting and parsing events here ...\n\nid, err := strconv.ParseInt(event.ID, 0, 64)\nif err != nil {\n    return err\n}\n\nprice, err := strconv.ParseFloat(event.Price, 64)\nif err != nil {\n    return err\n}\n\ntimestamp, err := strconv.ParseInt(event.Time, 0, 64)\nif err != nil {\n    return err\n}\n\ndatetime := time.Unix(timestamp, 0).UTC()\n</code></pre>\n\n<p>Now this code is a bit repetitive but basically I'm parsing the <code>id</code>, <code>price</code> and <code>time</code> and then I'm converting the timestamp to a time value.</p>\n\n<p>Now my question, can I convert the values at the same time as parsing the JSON response? Or is there no way around this and I need to do the type conversion later as shown in this example?</p>\n"}, {"tags": ["go", "interface", "sqlite", "database-abstraction"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1508815893, "post_id": 46901435, "comment_id": 80750273, "body": "I think, there is no <i>right/wrong</i> approach. It&#39;s a matter of style. You can choose <a href=\"https://en.wikipedia.org/wiki/Active_record_pattern\" rel=\"nofollow noreferrer\"><code>ActiveRecord</code> pattern</a>, or <a href=\"https://en.wikipedia.org/wiki/Data_mapper_pattern\" rel=\"nofollow noreferrer\"><code>Data Mapper</code> pattern</a>. In the former, <i>CRUD</i> operation is defined as part of the <i>object</i>, while in the later, your <i>object</i> only holds the data and doesn&#39;t know anything about persistence layer (database)."}, {"owner": {"reputation": 740, "user_id": 4488456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4146daa51bdb93084db63bbf9b5d5c43?s=128&d=identicon&r=PG", "display_name": "jordan2175", "link": "https://stackoverflow.com/users/4488456/jordan2175"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1508819147, "post_id": 46901435, "comment_id": 80751066, "body": "If you do the switch statement on the object types in datastore/sqlite3/sqlite3.go then all of your SQL statements can stay in the sqlite package.  If you do it the other way, as I have illustrated in the comment, then you are putting database code in the objects. Then what happens when yo need to support 10 different datastores. It just seems wrong.  It also seems like I am missing some neat trick to make this work better."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1508821234, "post_id": 46901435, "comment_id": 80751717, "body": "It seems wrong because you <i>limit</i> the solution using <i>type switching</i>. You can use existing ORM package (e.g. <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">gorm</a>), or you can develop your own. In the later case, I suggest you to define a <i>convention/rule</i> for the table naming in relation with <i>struct</i> name. For example, you can define table name for <code>CircleType</code> will be <code>CircleType</code> or <code>circle_type</code>, etc... Then, use tags to define mapping between table&#39;s column name and <i>struct</i>&#39;s field name. Based on these, you can construct SQL for simple CRUD inside <i>datastore</i> using reflection."}], "answers": [{"tags": [], "owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "is_accepted": false, "score": 1, "last_activity_date": 1508831916, "creation_date": 1508831916, "answer_id": 46905138, "question_id": 46901435, "link": "https://stackoverflow.com/questions/46901435/using-interfaces-with-golang-and-database-abstraction/46905138#46905138", "title": "Using interfaces with golang and database abstraction", "body": "<p>Type switch is the right thing to do.\nYour logic code, (the one you wrote because no body else did it before) should know nothing about the storage.</p>\n\n<p>Lets say you will want to add a counter for requests and you decide to count requests on Redis. What then? add the counter collection name to the Shape too?</p>\n\n<p>You then should create a new ShapeStorer as a decorator and in the put method call the Redis ShapeStorer and sqlite ShapeStorer.</p>\n\n<p>For a no-sql databases you sometime don't care about the schema at all you just serialize the object and save it. </p>\n"}], "owner": {"reputation": 740, "user_id": 4488456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4146daa51bdb93084db63bbf9b5d5c43?s=128&d=identicon&r=PG", "display_name": "jordan2175", "link": "https://stackoverflow.com/users/4488456/jordan2175"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2678, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1508831916, "creation_date": 1508813394, "last_edit_date": 1508823465, "question_id": 46901435, "link": "https://stackoverflow.com/questions/46901435/using-interfaces-with-golang-and-database-abstraction", "title": "Using interfaces with golang and database abstraction", "body": "<p>I am trying to figure out how to build a datastore abstraction in Go.  I think I understand the basics of interfaces. However, the problem I have is all of the examples online only show you the most simple case, nothing beyond it.</p>\n\n<p>What I am trying to do is figure out how and where to put the SQL code. I have tried to write the simplest bit of code that can illustrate what I am trying to do (yes, there is no error code, yes, the path structure is not idiomatic). I have a database with two tables.  One to store Circles and one to store Squares. I have objects in Go to make these.  My directory structure is:</p>\n\n<pre><code>project/main.go\nproject/test.db\nproject/shapes/shape.go\nproject/shapes/circle/circle.go\nproject/shapes/square/square.go\nproject/datastore/datastore.go\nproject/datastore/sqlite3/sqlite3.go\n</code></pre>\n\n<p>The only way I can think of how to make this work is to put the SQL INSERT and SELECT code inside of the actual shape files (circle.go and square.go).  But that feels really wrong.  It seems like it should be part of the datastore/sqlite3 package some how.  I just do not see how to make that work. Here is what I have so far:</p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"project/datastore/sqlite3\"\n    \"project/shapes/circle\"\n    \"project/shapes/square\"\n)\n\nfunc main() {\n    c := circle.New(4)\n    area := c.Area()\n    fmt.Println(\"Area: \", area)\n\n    s := square.New(12)\n    area2 := s.Area()\n    fmt.Println(\"Area: \", area2)\n\n    db := sqlite3.New(\"test.db\")\n    db.Put(c)\n    db.Close()\n}\n</code></pre>\n\n<p>shapes/shape.go</p>\n\n<pre><code>package shapes\n\ntype Shaper interface {\n    Area() float64\n}\n</code></pre>\n\n<p>shapes/circle/circle.go</p>\n\n<pre><code>package circle\n\nimport (\n    \"project/shapes\"\n)\n\ntype CircleType struct {\n    Radius float64\n}\n\nfunc New(radius float64) shapes.Shaper {\n    var c CircleType\n    c.Radius = radius\n    return &amp;c\n}\n\nfunc (c *CircleType) Area() float64 {\n    area := 3.1415 * c.Radius * c.Radius\n    return area\n}\n</code></pre>\n\n<p>shapes/square/square.go</p>\n\n<pre><code>package square\n\nimport (\n    \"project/shapes\"\n)\n\ntype SquareType struct {\n    Side float64\n}\n\nfunc New(side float64) shapes.Shaper {\n    var s SquareType\n    s.Side = side\n    return &amp;s\n}\n\nfunc (s *SquareType) Area() float64 {\n    area := s.Side * s.Side\n    return area\n}\n</code></pre>\n\n<p>datastore/datastore.go</p>\n\n<pre><code>package datastore\n\nimport (\n    \"project/shapes\"\n)\n\ntype ShapeStorer interface {\n    Put(shape shapes.Shaper)\n    Close()\n}\n</code></pre>\n\n<p>datastore/sqlite3/sqlite3.go</p>\n\n<pre><code>package sqlite3\n\nimport (\n    \"database/sql\"\n    _ \"github.com/mattn/go-sqlite3\"\n    \"log\"\n    \"project/datastore\"\n    \"project/shapes\"\n)\n\ntype Sqlite3DatastoreType struct {\n    DB *sql.DB\n}\n\nfunc New(filename string) datastore.ShapeStorer {\n    var ds Sqlite3DatastoreType\n\n    db, sqlerr := sql.Open(\"sqlite3\", filename)\n    if sqlerr != nil {\n        log.Fatalln(\"Unable to open file due to error: \", sqlerr)\n    }\n    ds.DB = db\n\n    return &amp;ds\n}\n\nfunc (ds *Sqlite3DatastoreType) Close() {\n    err := ds.DB.Close()\n    if err != nil {\n        log.Fatalln(err)\n    }\n}\n\nfunc (ds *Sqlite3DatastoreType) Put(shape shapes.Shaper) {\n    log.Println(\"Help\")\n    // here you could either do a switch statement on the object type\n    // or you could do something like shape.Write(), if Write() was defined\n    // on the interface of shape/shapes.go Shaper interface and then\n    // implemented in the Square and Circle objects. \n}\n</code></pre>\n\n<p>Since the database tables will be different for the Circle and Square objects, some how I need to have a method for each one. I can get this to work if I add a method to the circle package and square package to do the insert.  But like I said above, that feels like I am doing it wrong.  </p>\n\n<p>Thanks much in advance. </p>\n"}, {"tags": ["postgresql", "go", "foreign-keys", "many-to-many", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 91, "user_id": 7606922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8Sko.jpg?s=128&g=1", "display_name": "pedropinheiro75", "link": "https://stackoverflow.com/users/7606922/pedropinheiro75"}, "is_accepted": false, "score": 2, "last_activity_date": 1508815820, "creation_date": 1508815820, "answer_id": 46901741, "question_id": 46900296, "link": "https://stackoverflow.com/questions/46900296/go-gorm-many2many-issue/46901741#46901741", "title": "Go GORM many2many issue", "body": "<p>Try create first beer, then the brewers and usage the <em>.append</em> method to append the brewers in beer.</p>\n\n<p><a href=\"http://jinzhu.me/gorm/associations.html#association-mode\" rel=\"nofollow noreferrer\">http://jinzhu.me/gorm/associations.html#association-mode</a></p>\n\n<pre><code>// Start Association Mode\nvar user User\ndb.Model(&amp;user).Association(\"Languages\")\n// `user` is the source, it need to be a valid record (contains primary key)\n// `Languages` is source's field name for a relationship.\n// If those conditions not matched, will return an error, check it with:\n// db.Model(&amp;user).Association(\"Languages\").Error\n\n\n// Query - Find out all related associations\ndb.Model(&amp;user).Association(\"Languages\").Find(&amp;languages)\n\n\n// Append - Append new associations for many2many, has_many, will replace current association for has_one, belongs_to\ndb.Model(&amp;user).Association(\"Languages\").Append([]Language{languageZH, languageEN})\ndb.Model(&amp;user).Association(\"Languages\").Append(Language{Name: \"DE\"})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 0, "last_activity_date": 1508828264, "creation_date": 1508828264, "answer_id": 46904050, "question_id": 46900296, "link": "https://stackoverflow.com/questions/46900296/go-gorm-many2many-issue/46904050#46904050", "title": "Go GORM many2many issue", "body": "<p>Not sure if you have considered this as an option - better way may be to hold a reference to (a slice of) Brewer IDs in your Beers.Brewers field. As the data is encoded, you can convert these ID's into full field values (using a customized marshal function). This may be suitable, unless you have speed/performance considerations.</p>\n"}, {"comments": [{"owner": {"reputation": 91, "user_id": 7606922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W8Sko.jpg?s=128&g=1", "display_name": "pedropinheiro75", "link": "https://stackoverflow.com/users/7606922/pedropinheiro75"}, "edited": false, "score": 0, "creation_date": 1558724251, "post_id": 46921251, "comment_id": 99208712, "body": "Could you look at my answer and evaluate if it was the correct one? It looks like my answer is exactly what you said here! <a href=\"https://stackoverflow.com/questions/46900296/go-gorm-many2many-issue/46901741#46901741\" title=\"go gorm many2many issue\">stackoverflow.com/questions/46900296/go-gorm-many2many-issue&zwnj;&#8203;/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1201, "user_id": 5097493, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/95b290a191545edb4077adfaab317f1a?s=128&d=identicon&r=PG&f=1", "display_name": "RuNpiXelruN", "link": "https://stackoverflow.com/users/5097493/runpixelrun"}, "is_accepted": false, "score": 0, "last_activity_date": 1508885786, "creation_date": 1508885786, "answer_id": 46921251, "question_id": 46900296, "link": "https://stackoverflow.com/questions/46900296/go-gorm-many2many-issue/46921251#46921251", "title": "Go GORM many2many issue", "body": "<p>So i have figured out a solution to what i wanted to do above. To add a new <code>Brewer</code> into a <code>Beer.Brewers</code> collection I needed to do the below,</p>\n\n<pre><code>brewerr := Brewer{}\n    db.Where(&amp;Brewer{FirstName: \"justin\"}).Find(&amp;brewerr)\n\nbeerr := Beer{}\n    db.Preload(\"Brewers\").Where(&amp;Beer{Name: \"some lager\"}).Find(&amp;beerr).Association(\"Brewers\").Append(&amp;brewerr)\n</code></pre>\n\n<p>It's important to note that I needed to <code>Preload</code> the <code>Beer.Brewers</code> collection first and THEN append. Failing to Preload resulted in the Append overwriting all of the <code>Brewers</code> for that <code>Beer</code></p>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 10799022, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IQep9.png?s=128&g=1", "display_name": "Rami H", "link": "https://stackoverflow.com/users/10799022/rami-h"}, "is_accepted": false, "score": 1, "last_activity_date": 1565056624, "creation_date": 1565056624, "answer_id": 57367949, "question_id": 46900296, "link": "https://stackoverflow.com/questions/46900296/go-gorm-many2many-issue/57367949#57367949", "title": "Go GORM many2many issue", "body": "<p>The idea here is the following\n1. You create the brewers independently\n2. When you append them, add the primary key field \"BrewerId\" as shown\n3. This will lookup the Brewer in the brewers table and add it to the Beer.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"time\"\n\n    \"github.com/jinzhu/gorm\"\n\n    // used by gorm\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\ntype Beer struct {\n    BeerId         uint      `json:\"id\"`\n    Name           string    `json:\"name\" gorm:\"not null;\" sql:\"unique\"`\n    Description    string    `json:\"description\" gorm:\"not null;\"`\n    ImageURL       string    `json:\"image_url\"`\n    AlcoholContent float64   `json:\"alcohol_content, default:0\"`\n    Featured       bool      `json:\"featured\"`\n    BrewStart      time.Time `json:\"brew_start\"`\n    BrewEnd        time.Time `json:\"brew_end\"`\n    Brewers        []Brewer  `json:\"brewers\" gorm:\"many2many:beer_brewers;association_foreignkey:brewer_id;foreignkey:beer_id\"`\n}\n\ntype Brewer struct {\n    BrewerId  uint   `json:\"id\"`\n    FirstName string `json:\"first_name\"`\n    LastName  string `json:\"last_name\"`\n    Title     string `json:\"title\"`\n    Featured  bool   `json:\"featured\"`\n}\n\nfunc migrate() {\n    // Connection is the connection string\n    connection := \"host=%v port=%v user=%v dbname=%v password=%v sslmode=%v connect_timeout=%v\"\n    db, _ := gorm.Open(\"postgres\", connection)\n    db.AutoMigrate(&amp;Beer{}, &amp;Brewer{})\n    db.Model(&amp;Beer{}).Related(&amp;Brewer{}, \"Brewers\")\n\n    db.Create(&amp;Brewer{FirstName: \"justin\"})\n    db.Create(&amp;Beer{\n        Name:           \"some lager\",\n    Description:    \"a description of some pale ale\",\n    ImageURL:       \"http://via.placeholder.com/350x150\",\n    AlcoholContent: 4.5,\n    Featured:       false,\n    BrewStart:      utils.ParseTime(\"30-10-2017 13:00 (AEDT)\"),\n    BrewEnd:        utils.ParseTime(\"14-11-2017 13:00 (AEDT)\"),\n    }).Association(\"Brewers\").Append(&amp;Brewer{BrewerId: 123,})\n}\n</code></pre>\n"}], "owner": {"reputation": 1201, "user_id": 5097493, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/95b290a191545edb4077adfaab317f1a?s=128&d=identicon&r=PG&f=1", "display_name": "RuNpiXelruN", "link": "https://stackoverflow.com/users/5097493/runpixelrun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3100, "favorite_count": 0, "answer_count": 4, "score": 2, "last_activity_date": 1565056624, "creation_date": 1508804005, "last_edit_date": 1508885920, "question_id": 46900296, "link": "https://stackoverflow.com/questions/46900296/go-gorm-many2many-issue", "title": "Go GORM many2many issue", "body": "<p>I can't work out the best way to add an association to a model. I have the following structs</p>\n\n<pre><code>type Beer struct {\n        ID             uint       `json:\"id\"`\n    Name           string     `json:\"name\" gorm:\"not null;\" sql:\"unique\"`\n    Description    string     `json:\"description\" gorm:\"not null;\"`\n    ImageURL       string     `json:\"image_url\"`\n    AlcoholContent float64    `json:\"alcohol_content, default:0\"`\n    Featured       bool       `json:\"featured\"`\n    BrewStart      time.Time  `json:\"brew_start\"`\n    BrewEnd        time.Time  `json:\"brew_end\"` \n    Brewers        []Brewer   `gorm:\"many2many:beer_brewers\" json:\"brewers\"`\n}\n\ntype Brewer struct {\n    ID        uint       `json:\"id\"`\n    FirstName string     `json:\"first_name\"`\n    LastName  string     `json:\"last_name\"`\n    Title     string     `json:\"title\"`\n    Featured  bool       `json:\"featured\"`\n    Beers     []Beer    `gorm:\"many2many:beer_brewers\" json:\"beers\"`\n}\n</code></pre>\n\n<p>Below is an example of data i have seeded the DB with</p>\n\n<pre><code>Beer{\n    Name:           \"some pale ale\",\n    Description:    \"a description of some pale ale\",\n    ImageURL:       \"http://via.placeholder.com/350x150\",\n    AlcoholContent: 4.5,\n    Featured:       false,\n    BrewStart:      utils.ParseTime(\"30-10-2017 13:00 (AEDT)\"),\n    BrewEnd:        utils.ParseTime(\"14-11-2017 13:00 (AEDT)\"),\n    Brewers: []Brewer{\n        Brewer{FirstName: \"john\", LastName: \"smith\", Title: \"bottle shaker\", Featured: false},\n        Brewer{FirstName: \"joe\", LastName: \"bloggs\", Title: \"bottle maker\", Featured: true},\n    },\n},\nBeer{\n    Name:           \"some lager\",\n    Description:    \"a description of some pale ale\",\n    ImageURL:       \"http://via.placeholder.com/350x150\",\n    AlcoholContent: 4.5,\n    Featured:       false,\n    BrewStart:      utils.ParseTime(\"30-10-2017 13:00 (AEDT)\"),\n    BrewEnd:        utils.ParseTime(\"14-11-2017 13:00 (AEDT)\"),\n    Brewers: []Brewer{\n        Brewer{FirstName: \"john\", LastName: \"smith\", Title: \"bottle shaker\", Featured: false},\n        Brewer{FirstName: \"joe\", LastName: \"bloggs\", Title: \"bottle maker\", Featured: true},\n    },\n},\n</code></pre>\n\n<p>However the above creates duplicate Brewers in the Brewer table. My question is, what is the best way to reference a Brewer that already exists but not create another Brewer item in the Brewer table?..and also what is the best way to Append a new Brewer into a Beer collection?</p>\n\n<p>Thanks,\nJustin</p>\n"}, {"tags": ["go", "build", "compiler-errors"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508795678, "post_id": 46899112, "comment_id": 80745457, "body": "The error says there are no <code>non-test</code> files. There&#39;s nothing to build in that directory."}, {"owner": {"reputation": 4719, "user_id": 2676845, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/TTFOs.jpg?s=128&g=1", "display_name": "fstanis", "link": "https://stackoverflow.com/users/2676845/fstanis"}, "edited": false, "score": 0, "creation_date": 1508797638, "post_id": 46899112, "comment_id": 80746095, "body": "&quot;from my $GOPATH/src&quot; that doesn&#39;t sound right - that builds <b>everything</b> - what are you trying to build?"}, {"owner": {"reputation": 3518, "user_id": 3384609, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1cb30cda6294521f9c6e60277504c5c2?s=128&d=identicon&r=PG", "display_name": "Clintm", "link": "https://stackoverflow.com/users/3384609/clintm"}, "reply_to_user": {"reputation": 4719, "user_id": 2676845, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/TTFOs.jpg?s=128&g=1", "display_name": "fstanis", "link": "https://stackoverflow.com/users/2676845/fstanis"}, "edited": false, "score": 0, "creation_date": 1508797677, "post_id": 46899112, "comment_id": 80746104, "body": "@fstanis <i>everything</i>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508798649, "post_id": 46899112, "comment_id": 80746375, "body": "You are aware that <code>go build .&#47;...</code> doesn&#39;t <i>do</i> anything, other than building things and throwing away the results, right?"}, {"owner": {"reputation": 3518, "user_id": 3384609, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1cb30cda6294521f9c6e60277504c5c2?s=128&d=identicon&r=PG", "display_name": "Clintm", "link": "https://stackoverflow.com/users/3384609/clintm"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508798813, "post_id": 46899112, "comment_id": 80746435, "body": "@JimB <code>go install .&#47;...</code> exits with the same error"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508799057, "post_id": 46899112, "comment_id": 80746494, "body": "That command makes a little more sense, but running it on all of <code>GOPATH&#47;src</code> is still questionable. Just like the error says, there&#39;s a directory with no non-test files, and you&#39;re instructing the go tool to build something out of it. The only thing you can do with that package is run <code>go test</code>."}], "answers": [{"tags": [], "owner": {"reputation": 3518, "user_id": 3384609, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1cb30cda6294521f9c6e60277504c5c2?s=128&d=identicon&r=PG", "display_name": "Clintm", "link": "https://stackoverflow.com/users/3384609/clintm"}, "is_accepted": true, "score": 2, "last_activity_date": 1510591612, "last_edit_date": 1510591612, "creation_date": 1508800432, "answer_id": 46899843, "question_id": 46899112, "link": "https://stackoverflow.com/questions/46899112/go-build-error-no-non-test-go-files-in-dir/46899843#46899843", "title": "Go build error: no non-test Go files in &lt;dir&gt;", "body": "<p>Calling it a bug\u2026 the build shouldn't fail if the tests compile. Filed here: <a href=\"https://github.com/golang/go/issues/22409\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/22409</a></p>\n\n<p>The bug I filed was a duplicate of <a href=\"https://github.com/golang/go/issues/8279\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/8279</a> looks like it was broken in 1.3.</p>\n"}, {"comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 3518, "user_id": 3384609, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1cb30cda6294521f9c6e60277504c5c2?s=128&d=identicon&r=PG", "display_name": "Clintm", "link": "https://stackoverflow.com/users/3384609/clintm"}, "edited": false, "score": 0, "creation_date": 1510647182, "post_id": 47025370, "comment_id": 81511634, "body": "That issue is closed with won\u2019t fix"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 2, "last_activity_date": 1509403702, "creation_date": 1509403702, "answer_id": 47025370, "question_id": 46899112, "link": "https://stackoverflow.com/questions/46899112/go-build-error-no-non-test-go-files-in-dir/47025370#47025370", "title": "Go build error: no non-test Go files in &lt;dir&gt;", "body": "<p>I don't think this is a bug, unless you see somewhere in the docs that contradicts this behaviour you should probably close the issue you've created. </p>\n\n<p>Tests in go normally live in the package they are testing. You have made a new package with package main at the top (invalid if you also have main elsewhere), and then have included no go source files in that tests/main package (invalid as package has no go source files apart from tests, which the compiler complains about explicitly).</p>\n\n<p>Possible solutions for you (assuming this isn't just a hypothetical question): </p>\n\n<ul>\n<li>Move tests for main to test_main.go (this is what readers will\nexpect) </li>\n<li>Add doc.go file to your tests pkg and call it package tests in\nboth files</li>\n</ul>\n\n<p>The reason for putting tests in the same package is to ensure they have access to the entire package, if you want to split them to another package you'll find you have to test as an external user of the pkg - this may be painful. Main is also a special case as well as you don't normally import it. </p>\n"}, {"comments": [{"owner": {"reputation": 5680, "user_id": 278235, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/90727b648e0c2e00980bf52180027709?s=128&d=identicon&r=PG", "display_name": "Sungguk Lim", "link": "https://stackoverflow.com/users/278235/sungguk-lim"}, "edited": false, "score": 0, "creation_date": 1617950478, "post_id": 53428924, "comment_id": 118458631, "body": "wow.. after chaning file name it works.."}], "tags": [], "owner": {"reputation": 55, "user_id": 6161486, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hClO4.jpg?s=128&g=1", "display_name": "Morningxxx", "link": "https://stackoverflow.com/users/6161486/morningxxx"}, "is_accepted": false, "score": 1, "last_activity_date": 1542896179, "last_edit_date": 1542896179, "creation_date": 1542882689, "answer_id": 53428924, "question_id": 46899112, "link": "https://stackoverflow.com/questions/46899112/go-build-error-no-non-test-go-files-in-dir/53428924#53428924", "title": "Go build error: no non-test Go files in &lt;dir&gt;", "body": "<p>First, check your $GOPATH has been set correctly. Learn more at <a href=\"https://github.com/golang/go/wiki/SettingGOPATH\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Then, check if any '_' in your file name. Remove these '_'s and try again. \n;-)</p>\n"}], "owner": {"reputation": 3518, "user_id": 3384609, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1cb30cda6294521f9c6e60277504c5c2?s=128&d=identicon&r=PG", "display_name": "Clintm", "link": "https://stackoverflow.com/users/3384609/clintm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9673, "favorite_count": 0, "accepted_answer_id": 46899843, "answer_count": 3, "score": 8, "last_activity_date": 1542896179, "creation_date": 1508795576, "question_id": 46899112, "link": "https://stackoverflow.com/questions/46899112/go-build-error-no-non-test-go-files-in-dir", "title": "Go build error: no non-test Go files in &lt;dir&gt;", "body": "<p>Getting an error when trying to run <code>go build ./...</code> from my $GOPATH/src .</p>\n\n<pre><code>no non-test Go files in &lt;dir&gt;\n</code></pre>\n\n<p>The error is correct there are no test files in <code>&lt;dir&gt;</code> but why is that causing a compile error? Is it a bug?</p>\n"}, {"tags": ["go", "sql-server-ce"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1508796573, "post_id": 46898606, "comment_id": 80745765, "body": "<a href=\"https://godoc.org/?q=MSSQL\" rel=\"nofollow noreferrer\">godoc.org/?q=MSSQL</a> or <a href=\"http://go-search.org/search?q=MSSQL\" rel=\"nofollow noreferrer\">go-search.org/search?q=MSSQL</a>"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 0, "last_activity_date": 1508831045, "creation_date": 1508831045, "answer_id": 46904886, "question_id": 46898606, "link": "https://stackoverflow.com/questions/46898606/golang-and-opening-ms-sql-compact-files-sdf/46904886#46904886", "title": "GoLang and opening MS SQL Compact files (.sdf)", "body": "<p>I'm afraid it would hardly be possible to work with these files directly as they merely are on-disk storage format, and note that MSSQL DBs of all flavors use <code>.sdf</code> as the extension of the file names of their DBs, so by itself they mean nothing.</p>\n\n<p>OTOH, one direct way to approach this problem would be using\n<a href=\"https://github.com/mattn/go-adodb\" rel=\"nofollow noreferrer\">OLE DB layer</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 36579, "user_id": 183934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6458cf59b73b593fa9c9c8194f0a3b15?s=128&d=identicon&r=PG", "display_name": "ErikEJ", "link": "https://stackoverflow.com/users/183934/erikej"}, "edited": false, "score": 0, "creation_date": 1546157365, "post_id": 53965799, "comment_id": 94789809, "body": "The question is about SQL Server Compact, not SQL Server"}], "tags": [], "owner": {"reputation": 575, "user_id": 7098465, "user_type": "registered", "accept_rate": 93, "profile_image": "https://graph.facebook.com/1208630015850926/picture?type=large", "display_name": "Vasilij Altunin", "link": "https://stackoverflow.com/users/7098465/vasilij-altunin"}, "is_accepted": false, "score": -1, "last_activity_date": 1546044552, "creation_date": 1546044552, "answer_id": 53965799, "question_id": 46898606, "link": "https://stackoverflow.com/questions/46898606/golang-and-opening-ms-sql-compact-files-sdf/53965799#53965799", "title": "GoLang and opening MS SQL Compact files (.sdf)", "body": "<p>You can also try to use </p>\n\n<p><a href=\"https://github.com/denisenkom/go-mssqldb\" rel=\"nofollow noreferrer\">https://github.com/denisenkom/go-mssqldb</a></p>\n\n<p>to connect to MSSQL Express instance like that:</p>\n\n<pre><code>sqlserver://sa@localhost/SQLExpress?database=master&amp;connection+timeout=30\n</code></pre>\n"}], "owner": {"reputation": 313, "user_id": 7947612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8eb9ce28ea5578ea3dbe59b7b359e1b1?s=128&d=identicon&r=PG", "display_name": "David O", "link": "https://stackoverflow.com/users/7947612/david-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 46904886, "answer_count": 2, "score": 0, "last_activity_date": 1546044552, "creation_date": 1508793019, "question_id": 46898606, "link": "https://stackoverflow.com/questions/46898606/golang-and-opening-ms-sql-compact-files-sdf", "title": "GoLang and opening MS SQL Compact files (.sdf)", "body": "<p>As the title suggests, I'm attempting to open an SDF/MSSQL CE database in GoLang.  Is this possible? </p>\n\n<p>The GoLang Libraries I've found do not appear to suppot MSSQL CE database connections.</p>\n\n<p>I hope this is not a duplicate, but I can not find info online</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 5, "creation_date": 1508790933, "post_id": 46898029, "comment_id": 80743305, "body": "In &quot;plain&quot; Postgres a transaction most definitely does not count as a &quot;client connection&quot;. I can run millions of transactions with a single connection to the database. Your program apparently does not (physically) close connections to the database properly."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508791569, "post_id": 46898029, "comment_id": 80743634, "body": "FYI, You&#39;re deferred assignments to <code>err</code> aren&#39;t doing anything. You can only assign to named return values: <a href=\"https://play.golang.org/p/FKF2Z2KyzF\" rel=\"nofollow noreferrer\">play.golang.org/p/FKF2Z2KyzF</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508792317, "post_id": 46898029, "comment_id": 80744025, "body": "@JimB I did not know that. Thanks!"}, {"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 2, "creation_date": 1508794022, "post_id": 46898029, "comment_id": 80744797, "body": "You should parameterize your SQL queries."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 1, "creation_date": 1508801352, "post_id": 46898029, "comment_id": 80747045, "body": "@squiguy I get &#39;pq: syntax error at or near &quot;$1&quot;&#39;...seems you can&#39;t pass table name or column as params???"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "edited": false, "score": 0, "creation_date": 1508792842, "post_id": 46898516, "comment_id": 80744298, "body": "why is it smart in my case to make separate connections but ok to have just 1 in the example @a_horse_with_no_name gives?"}, {"owner": {"reputation": 24853, "user_id": 446681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cBjgR.jpg?s=128&g=1", "display_name": "Hector Correa", "link": "https://stackoverflow.com/users/446681/hector-correa"}, "edited": false, "score": 1, "creation_date": 1508793366, "post_id": 46898516, "comment_id": 80744532, "body": "by &quot;smart decision for most cases&quot; I mean that database drivers do their own database connection pooling (since making a brand new database connection is relatively a slow process) and their logic is usually pretty sound."}, {"owner": {"reputation": 24853, "user_id": 446681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cBjgR.jpg?s=128&g=1", "display_name": "Hector Correa", "link": "https://stackoverflow.com/users/446681/hector-correa"}, "edited": false, "score": 0, "creation_date": 1508793503, "post_id": 46898516, "comment_id": 80744585, "body": "In this case the driver is probably creating a brand new connection to the DB because each worker starts a new transaction (i.e. you are asking the database to keep each work in isolation.)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1508837761, "post_id": 46898516, "comment_id": 80760674, "body": "@kristen, may I recommend reading this (free to get) e-book? <a href=\"https://www.vividcortex.com/resources/the-ultimate-guide-to-building-database-driven-apps-with-go\" rel=\"nofollow noreferrer\">The Ultimate Guide to Building Database-Driven Apps with Go</a> \u2014 it deals with such pooling issues quite nicely."}], "tags": [], "owner": {"reputation": 24853, "user_id": 446681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cBjgR.jpg?s=128&g=1", "display_name": "Hector Correa", "link": "https://stackoverflow.com/users/446681/hector-correa"}, "is_accepted": true, "score": 4, "last_activity_date": 1508792848, "last_edit_date": 1508792848, "creation_date": 1508792635, "answer_id": 46898516, "question_id": 46898029, "link": "https://stackoverflow.com/questions/46898029/why-does-each-transaction-count-as-a-client/46898516#46898516", "title": "Why does each transaction count as a client?", "body": "<blockquote>\n  <p>Since I am reusing the same *db why am I getting this error? </p>\n</blockquote>\n\n<p>I suspect the Postgress driver is using a separate connections for each of your workers which is a smart decision for most cases.</p>\n\n<blockquote>\n  <p>Does each transaction count as a client or am I doing something wrong?</p>\n</blockquote>\n\n<p>In your case yes each transaction count as a client, because you are calling <code>process()</code> as a goroutine. You are creating as many concurrent transactions as workers. Since each of your transactions is long all of them are probably using an individual connection to the database at the same time and hence you hit a limit.</p>\n\n<pre><code>go func() {\n        defer wg.Done()\n        for i := range ch {\n            table := fmt.Sprintf(\"_table%d\", i)\n            log.Println(table)\n            if err := process(db, table); err != nil {\n                log.Fatalln(err)\n            }\n        }\n    }()\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 46898516, "answer_count": 1, "score": 2, "last_activity_date": 1508792848, "creation_date": 1508790825, "last_edit_date": 1508791201, "question_id": 46898029, "link": "https://stackoverflow.com/questions/46898029/why-does-each-transaction-count-as-a-client", "title": "Why does each transaction count as a client?", "body": "<p>I am processing a bunch of files and then dumping the results in PostgreSQL. I would like to process many workers at the same time but keep getting the error \"pq: sorry, too many clients already\". This seems to happen whenever workers is > 100 or so. (For simplicity, the code below demonstrates the process but instead of processing a file I am simply inserting 1M rows in each table).</p>\n\n<p>Since I am reusing the same *db why am I getting this error? Does each transaction count as a client or am I doing something wrong?</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"sync\"\n\n    \"github.com/lib/pq\"\n)\n\nfunc process(db *sql.DB, table string) error {\n    if _, err := db.Exec(fmt.Sprintf(`DROP TABLE IF EXISTS %v;`, table)); err != nil {\n        return err\n    }\n\n    col := \"age\"\n    s := fmt.Sprintf(`\n        CREATE TABLE %v (\n            pk serial PRIMARY KEY,\n            %v int NOT NULL\n    )`, table, col)\n\n    _, err := db.Exec(s)\n    if err != nil {\n        return err\n    }\n\n    tx, err := db.Begin()\n    if err != nil {\n        return err\n    }\n\n    defer func() {\n        if err != nil {\n            tx.Rollback()\n            return\n        }\n        err = tx.Commit()\n    }()\n\n    stmt, err := tx.Prepare(pq.CopyIn(table, col))\n    if err != nil {\n        return err\n    }\n\n    defer func() {\n        err = stmt.Close()\n    }()\n\n    for i := 0; i &lt; 1e6; i++ {\n        if _, err = stmt.Exec(i); err != nil {\n            return err\n        }\n    }\n\n    return err\n\n}\n\nfunc main() {\n    var u string\n    flag.StringVar(&amp;u, \"user\", \"\", \"user\")\n\n    var pass string\n    flag.StringVar(&amp;pass, \"pass\", \"\", \"pass\")\n\n    var host string\n    flag.StringVar(&amp;host, \"host\", \"\", \"host\")\n\n    var database string\n    flag.StringVar(&amp;database, \"database\", \"\", \"database\")\n\n    var workers int\n    flag.IntVar(&amp;workers, \"workers\", 10, \"workers\")\n\n    flag.Parse()\n\n    db, err := sql.Open(\"postgres\",\n        fmt.Sprintf(\n            \"user=%s password=%s host=%s database=%s sslmode=require\",\n            u, pass, host, database,\n        ),\n    )\n\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    defer db.Close()\n    db.SetMaxIdleConns(0)\n\n    var wg sync.WaitGroup\n    ch := make(chan int)\n\n    for i := 0; i &lt; workers; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            for i := range ch {\n                table := fmt.Sprintf(\"_table%d\", i)\n                log.Println(table)\n                if err := process(db, table); err != nil {\n                    log.Fatalln(err)\n                }\n            }\n        }()\n    }\n\n    for i := 0; i &lt; 300; i++ {\n        ch &lt;- i\n    }\n\n    close(ch)\n    wg.Wait()\n}\n</code></pre>\n\n<p>I realize I can simply increase the posgresql settings but would like to understand the question: <a href=\"https://stackoverflow.com/questions/30778015/how-to-increase-the-max-connections-in-postgres\">How to increase the max connections in postgres?</a></p>\n"}, {"tags": ["elasticsearch", "go", "elasticsearch-plugin"], "comments": [{"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 2, "creation_date": 1508788021, "post_id": 46897116, "comment_id": 80741840, "body": "Firstly, kudos for your nick. Is there a reason to execute a pointless query when you are not supposed to? Smells a bit of bad design upfront..."}, {"owner": {"reputation": 1811, "user_id": 3004041, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e9c675dd9408721a8e8e1106774a9d11?s=128&d=identicon&r=PG&f=1", "display_name": "covfefe", "link": "https://stackoverflow.com/users/3004041/covfefe"}, "reply_to_user": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508823766, "post_id": 46897116, "comment_id": 80752560, "body": "The method return type contains an elastic query (among other things). It&#39;s an open source project so I have to work with/around the existing design"}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 0, "last_activity_date": 1508862307, "creation_date": 1508862307, "answer_id": 46915532, "question_id": 46897116, "link": "https://stackoverflow.com/questions/46897116/is-there-a-way-to-deliberately-return-a-null-value-with-an-elasticsearch-query/46915532#46915532", "title": "Is there a way to deliberately return a null value with an Elasticsearch query?", "body": "<p>If by \"always return null\" you mean match nothing:</p>\n\n<pre><code>{\n    \"bool\": {\n        \"must_not\": {\n            \"match_all\": {}\n        }\n    }\n}\n</code></pre>\n\n<p>I'm sure match_all is implemented very efficiently.</p>\n"}], "owner": {"reputation": 1811, "user_id": 3004041, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e9c675dd9408721a8e8e1106774a9d11?s=128&d=identicon&r=PG&f=1", "display_name": "covfefe", "link": "https://stackoverflow.com/users/3004041/covfefe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508862307, "creation_date": 1508787077, "question_id": 46897116, "link": "https://stackoverflow.com/questions/46897116/is-there-a-way-to-deliberately-return-a-null-value-with-an-elasticsearch-query", "title": "Is there a way to deliberately return a null value with an Elasticsearch query?", "body": "<p>I have to return an elasticsearch query in my code (Golang using olivere's elastic v.5 library) and if a particular condition occurs, I want to be able to pass in a query that will take minimal time and always return null. Is there a standard way to do this? I tried using a Term query with empty strings as parameters:</p>\n\n<pre><code>elastic.NewTermQuery(\"\", \"\")\n</code></pre>\n\n<p>But this doesn't seem to be a valid query. Is there a good way to do this?</p>\n"}, {"tags": ["go", "redis", "redigo"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1508783142, "post_id": 46895530, "comment_id": 80739176, "body": "Show the types you are trying to scan and the Redis command that produces the result you are scanning. Implementing the scanner interface may not be the best solution to the problem you are trying to solve."}, {"owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1508784157, "post_id": 46895530, "comment_id": 80739761, "body": "@CeriseLim&#243;n I complement my question with extra info"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1508784431, "post_id": 46895530, "comment_id": 80739925, "body": "What is the Redis command that produces the result you are scanning?"}, {"owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1508784556, "post_id": 46895530, "comment_id": 80739991, "body": "I&#39;m not sure what you mean, I use HGETALL to view them"}, {"owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1508784627, "post_id": 46895530, "comment_id": 80740030, "body": "Maybe I&#39;m way off here: I want redis.ScanStruct(values, &amp;attrs) to use a custom parse function for certain attributes"}], "answers": [{"comments": [{"owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "edited": false, "score": 0, "creation_date": 1508785207, "post_id": 46896509, "comment_id": 80740340, "body": "Sounds good! But what if I want something fancier, for instance to parse RequireSecret as an enum (I&#39;m planning on supporting more values than &quot;true&quot; and &quot;false&quot; in the future)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "edited": false, "score": 0, "creation_date": 1508785313, "post_id": 46896509, "comment_id": 80740407, "body": "Use a type for the RequireSecret field that implements the scanner interface with the logic you need."}, {"owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "edited": false, "score": 0, "creation_date": 1508785363, "post_id": 46896509, "comment_id": 80740437, "body": "I see, I didn&#39;t know I was supposed to implement the interface on a field. I will try it out :)."}, {"owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "edited": false, "score": 0, "creation_date": 1508785408, "post_id": 46896509, "comment_id": 80740463, "body": "I will make sure to update the question tomorrow when I have more time"}, {"owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "edited": false, "score": 0, "creation_date": 1508849533, "post_id": 46896509, "comment_id": 80768838, "body": "Hey Cerise, I continued the question here: <a href=\"https://stackoverflow.com/questions/46911105/implementing-redigo-scanner-interface-on-a-structs-field\" title=\"implementing redigo scanner interface on a structs field\">stackoverflow.com/questions/46911105/&hellip;</a>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1508785562, "last_edit_date": 1508785562, "creation_date": 1508784748, "answer_id": 46896509, "question_id": 46895530, "link": "https://stackoverflow.com/questions/46895530/scanning-false-and-true-as-booleans-in-redigo/46896509#46896509", "title": "Scanning &quot;false&quot; and &quot;true&quot; as booleans in Redigo", "body": "<p>To scan the result of HGETALL, use the following type</p>\n\n<pre><code>type Attrs struct {\n    Secret         string `redis:\"secret\"`\n    RequireSecret  bool `redis:\"requireSecret\"`\n    UserID         string `redis:\"userId\"`\n}\n</code></pre>\n\n<p>with the following command:</p>\n\n<pre><code>values, err := redis.Values(c.Do(\"HGETALL\", key))\nif err != nil {\n   // handle error\n}\nvar attrs Attrs\nerr = redis.ScanStruct(values, &amp;attrs)\nif err != nil {\n   // handle error\n}\n</code></pre>\n\n<p>Because Redigo uses <a href=\"https://godoc.org/strconv#ParseBool\" rel=\"nofollow noreferrer\">strconv.ParseBool</a> to convert Redis result values to <code>bool</code>, you don't need to implement the scanner interface to convert <code>\"true\"</code> and <code>\"false\"</code> to <code>true</code> and <code>false</code>.</p>\n\n<p>You can implement the scanner interface on a subset of a struct's fields. Redigo will use the default parsing for fields that do not implement the interface and the application's custom parser for the fields that do implement the interface.</p>\n\n<p>Unless you need to access individual hash elements through the Redis API, it's usually better store sructs as a Redis string by serializing the struct using JSON, gob or some other encoder.</p>\n"}], "owner": {"reputation": 4705, "user_id": 562465, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f01d5241604fe5419279afc0d11e739d?s=128&d=identicon&r=PG", "display_name": "Rob Fox", "link": "https://stackoverflow.com/users/562465/rob-fox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "accepted_answer_id": 46896509, "answer_count": 1, "score": 0, "last_activity_date": 1508824156, "creation_date": 1508780961, "last_edit_date": 1508824156, "question_id": 46895530, "link": "https://stackoverflow.com/questions/46895530/scanning-false-and-true-as-booleans-in-redigo", "title": "Scanning &quot;false&quot; and &quot;true&quot; as booleans in Redigo", "body": "<p>How can I use <code>redis.ScanStruct</code> to parse strings as booleans or even as custom types?</p>\n\n<p>The struct I am using looks like this:</p>\n\n<pre><code>type Attrs struct {\n    Secret         string `redis:\"secret\"`\n    RequireSecret  string `redis:\"requireSecret\"`\n    UserID         string `redis:\"userId\"`\n}\n</code></pre>\n\n<p>The RequireSecret attribute is either a \"true\" or \"false\" string, I'd like to scan it as a <code>bool</code>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1508781051, "post_id": 46895496, "comment_id": 80738132, "body": "You&#39;re missing a <code>&amp;</code>.  The Pos and End methods are implemented by <code>*CallExpr</code>"}, {"owner": {"reputation": 77578, "user_id": 32914, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/50facfccdffe2e9cabaa589205959d30?s=128&d=identicon&r=PG", "display_name": "Mason Wheeler", "link": "https://stackoverflow.com/users/32914/mason-wheeler"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508784585, "post_id": 46895496, "comment_id": 80740010, "body": "@JimB Thanks!  Can you make that an answer?"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1508784722, "creation_date": 1508784722, "answer_id": 46896500, "question_id": 46895496, "link": "https://stackoverflow.com/questions/46895496/why-is-ast-callexpr-not-a-valid-ast-expr/46896500#46896500", "title": "Why is ast.CallExpr not a valid ast.Expr?", "body": "<p>The <code>Pos</code> and <code>End</code> methods of <code>ast.Expr</code> are implemented by <code>*ast.CallExpr</code>. You need to assign a pointer to <code>call</code> with <code>&amp;</code>.</p>\n\n<pre><code>var call ast.Expr = &amp;ast.CallExpr{Fun: ast.NewIdent(\"foo\"), Args: []ast.Expr{ast.NewIdent(\"api\")}}\n</code></pre>\n"}], "owner": {"reputation": 77578, "user_id": 32914, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/50facfccdffe2e9cabaa589205959d30?s=128&d=identicon&r=PG", "display_name": "Mason Wheeler", "link": "https://stackoverflow.com/users/32914/mason-wheeler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 46896500, "answer_count": 1, "score": 0, "last_activity_date": 1508784722, "creation_date": 1508780837, "question_id": 46895496, "link": "https://stackoverflow.com/questions/46895496/why-is-ast-callexpr-not-a-valid-ast-expr", "title": "Why is ast.CallExpr not a valid ast.Expr?", "body": "<p>I'm working on some Go AST code, and the compiler is choking on this line:</p>\n\n<pre><code>var call ast.Expr = ast.CallExpr{Fun: ast.NewIdent(\"foo\"), Args: []ast.Expr{ast.NewIdent(\"api\")}}\n</code></pre>\n\n<p>The error it's giving me is:</p>\n\n<blockquote>\n  <p>cannot use ast.CallExpr literal (type ast.CallExpr) as type ast.Expr in assignment:</p>\n  \n  <p>ast.CallExpr does not implement ast.Expr (End method has pointer receiver)</p>\n</blockquote>\n\n<p>I have no idea what this is saying; <a href=\"https://golang.org/pkg/go/ast/#CallExpr\" rel=\"nofollow noreferrer\">according to the documentation</a>, everything looks fine.  What do I have to do to make this work?</p>\n"}, {"tags": ["sockets", "go", "tcp"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1508780224, "post_id": 46895315, "comment_id": 80737721, "body": "You can&#39;t. That&#39;s not how TCP works."}, {"owner": {"reputation": 207, "user_id": 3009658, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/X4D4k.jpg?s=128&g=1", "display_name": "Alireza", "link": "https://stackoverflow.com/users/3009658/alireza"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508781042, "post_id": 46895315, "comment_id": 80738127, "body": "is there any way to get the client tcp free buffer size??"}, {"owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "edited": false, "score": 3, "creation_date": 1508781258, "post_id": 46895315, "comment_id": 80738222, "body": "I think you&#39;re trying to solve the wrong problem. Can you step back and explain what you&#39;re trying to achieve (i.e. the higher-level view)?"}, {"owner": {"reputation": 207, "user_id": 3009658, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/X4D4k.jpg?s=128&g=1", "display_name": "Alireza", "link": "https://stackoverflow.com/users/3009658/alireza"}, "edited": false, "score": 0, "creation_date": 1508782371, "post_id": 46895315, "comment_id": 80738766, "body": "the question is part of my school project. Maybe I got the point wrong but I read the project and I thought that this is what I have to do. I have to read the project again then"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508782947, "post_id": 46895315, "comment_id": 80739075, "body": "If you go down to a low enough level in the TCP stack, you can get a pessimistic view of what&#39;s left in the remote receive window, basically how long until your sends start blocking. This still wouldn&#39;t tell you <i>when</i> the client actually reads a message. The TCP stack can&#39;t even know what it means for your application to &quot;read&quot; it anyway; has it been received at the right application layer? Has it been successfully processed by the client? There&#39;s a reason this is done at the application layer."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1508788545, "post_id": 46895315, "comment_id": 80742107, "body": "If this is part of a school project, then you&#39;re certainly making things too complicated. No sane school would expect you to do this. (If your school is actually requiring this, you should sue for the cost of your tuition and time lost, because they&#39;re clearly unqualified to be teaching this stuff... :P)"}], "answers": [{"tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": false, "score": 0, "last_activity_date": 1508836703, "creation_date": 1508836703, "answer_id": 46906656, "question_id": 46895315, "link": "https://stackoverflow.com/questions/46895315/how-to-find-that-the-client-is-reading-from-tcp-buffer-in-go/46906656#46906656", "title": "how to find that the client is reading from tcp buffer in go", "body": "<p>I think that either the assignment is ambiguous or you're misinterpreting it and solving <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">the XY problem</a>.</p>\n\n<p>The short answer is that <strong>you can never know whether the client has read a message just by looking at the TCP conversation</strong>. You have to implement this \"protocol\" in your application.</p>\n\n<p>Here are a few problems:</p>\n\n<ol>\n<li><p>From your application you don't <em>really</em> have access to what TCP is doing. You get a stream on which you can perform I/O.</p>\n\n<ul>\n<li>The fact that a write to your stream \"succeeds\" only means that TCP has agreed to try to transport your stuff and has an independent copy. It doesn't say anything about whether the data has been received and it doesn't even mean the data has been even sent</li>\n<li>You may find certain mechanisms to peer into TCP's inner workings (such as <code>ioctl</code>s, <code>SIOCINQ</code>, <code>SIOCOUTQ</code> or various setsockopts): these won't help</li>\n</ul></li>\n<li><p>Even if you find out what your TCP is doing, this only tells you <strong>what the remote TCP is doing</strong>. So if you have full control over your TCP and even see the acknowledgments from the peer, you still don't know <strong>what the application is doing</strong>. It's very possible the application didn't read the data yet (it might not have requested the data, the TCP might be withholding it in a buffer for some weird reason, the scheduler might not have scheduled the remote process etc.)</p></li>\n</ol>\n\n<p>Going back to your question, a way to really know whether the remote application has received your message is to have the remote application tell you. This means you have to restructure your protocol to:</p>\n\n<ol>\n<li>Send stuff from the server</li>\n<li>Wait for a message from the application telling you it received your stuff</li>\n<li>Send more stuff (because you know from point 2 it's safe to do so)</li>\n</ol>\n"}], "owner": {"reputation": 207, "user_id": 3009658, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/X4D4k.jpg?s=128&g=1", "display_name": "Alireza", "link": "https://stackoverflow.com/users/3009658/alireza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 165, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1508836703, "creation_date": 1508780160, "last_edit_date": 1508788458, "question_id": 46895315, "link": "https://stackoverflow.com/questions/46895315/how-to-find-that-the-client-is-reading-from-tcp-buffer-in-go", "title": "how to find that the client is reading from tcp buffer in go", "body": "<p>I'm starting to use golang for a quite amount of time for a project. In my project I have to implement a tcp server which responds to tcp clients. The server has to send a number of messages to a client.\nThe problem is that when a server writes a message to a client connection,  it has to wait until the client has read that message from buffer and then send another message (the server has to wait until the client calls the <code>reader.ReadString('\\n')</code> method).</p>\n\n<p>In my server code I wrote: </p>\n\n<pre><code>for {\n    data := &lt;-client.outgoing\n    client.writer.WriteString(data + \"\\n\")\n    client.writer.Flush()\n}\n</code></pre>\n\n<p>but the server sends all the messages to client without waiting for ReadString in client.</p>\n\n<p>How to make server wait until the client read a message and then send the other message?</p>\n"}, {"tags": ["mysql", "shell", "go", "terminal"], "answers": [{"tags": [], "owner": {"reputation": 2611, "user_id": 2319299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ad0ca993033b3191db773253a5a7cd6?s=128&d=identicon&r=PG", "display_name": "Matteo Ragni", "link": "https://stackoverflow.com/users/2319299/matteo-ragni"}, "is_accepted": false, "score": 2, "last_activity_date": 1508779058, "creation_date": 1508779058, "answer_id": 46895018, "question_id": 46894765, "link": "https://stackoverflow.com/questions/46894765/how-to-execute-mysql-script-in-golang-using-exec-command/46895018#46895018", "title": "How to execute Mysql Script in golang using exec.Command", "body": "<p>This is a little example that runs something like:</p>\n\n<pre><code>cat &lt; test.txt\n</code></pre>\n\n<p>that is what I think you are missing in your code:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"os/exec\"\n  \"os\"\n)\n\nfunc main() {\n\n  cmd := exec.Command(\"cat\")\n  file, _ := os.Open(\"test.txt\")\n\n  cmd.Stdin = file\n\n  out, _ := cmd.Output()\n\n  fmt.Printf(\"%s\\n\", out)\n}\n</code></pre>\n\n<p>That prints in the console the content of test.txt, as read by cat. You will need to adapt it to your problem.</p>\n\n<p>Something like:</p>\n\n<pre><code>func executeTestScript(){\n    cmd := exec.Command(\"/usr/local/mysql/bin/mysql\", \"-h127.0.0.1\", \"-P3333\", \"-uusr\", \"-pPassxxx\", \"-Ddtb_test\")\n\n    dump, dump_err = os.Open(\"/Users/XXX/Documents/test/scripts/olds/SCRIPT_XXX.sql\")\n    if dump_err != nil {\n      /* Handle the error if file not opened */\n    }\n    cmd.Stdin = dump\n\n    var out, stderr bytes.Buffer\n\n    cmd.Stdout = &amp;out\n    cmd.Stderr = &amp;stderr\n\n    err := cmd.Run()\n    if err != nil {\n        fmt.Println(fmt.Sprintf(\"Error executing query. Command Output: %+v\\n: %+v, %v\", out.String(), stderr.String(), err))\n        log.Fatalf(\"Error executing query. Command Output: %+v\\n: %+v, %v\", out.String(), stderr.String(), err)\n    }\n}\n</code></pre>\n\n<p>if I'm not wrong...</p>\n"}, {"comments": [{"owner": {"reputation": 2611, "user_id": 2319299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ad0ca993033b3191db773253a5a7cd6?s=128&d=identicon&r=PG", "display_name": "Matteo Ragni", "link": "https://stackoverflow.com/users/2319299/matteo-ragni"}, "edited": false, "score": 1, "creation_date": 1508779558, "post_id": 46895115, "comment_id": 80737340, "body": "Ahah knowledge wins again! So a dump is actually an SQL script?"}, {"owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "reply_to_user": {"reputation": 2611, "user_id": 2319299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ad0ca993033b3191db773253a5a7cd6?s=128&d=identicon&r=PG", "display_name": "Matteo Ragni", "link": "https://stackoverflow.com/users/2319299/matteo-ragni"}, "edited": false, "score": 0, "creation_date": 1508779755, "post_id": 46895115, "comment_id": 80737464, "body": "@MatteoRagni: The OP didn&#39;t say they were running a dump file, but yes, a dump file produced by <code>mysqldump</code> is an SQL script by default (mysqldump can also optionally dump CSV data files)."}, {"owner": {"reputation": 2611, "user_id": 2319299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ad0ca993033b3191db773253a5a7cd6?s=128&d=identicon&r=PG", "display_name": "Matteo Ragni", "link": "https://stackoverflow.com/users/2319299/matteo-ragni"}, "edited": false, "score": 0, "creation_date": 1508779989, "post_id": 46895115, "comment_id": 80737610, "body": "I understand... sorry but I&#39;m quite ignorant in SQL, almost never used them apart for one or two dumps, thus I was curious..."}, {"owner": {"reputation": 197, "user_id": 1176585, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/d261de165a36633e0d30c0aa9c4b264b?s=128&d=identicon&r=PG", "display_name": "Ramiro Nava Castro", "link": "https://stackoverflow.com/users/1176585/ramiro-nava-castro"}, "edited": false, "score": 0, "creation_date": 1508783900, "post_id": 46895115, "comment_id": 80739616, "body": "@Bill Karwi: Your sample works as expected i made the changes you suggested and the script executes and make all the changes to the db."}], "tags": [], "owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "is_accepted": true, "score": 4, "last_activity_date": 1508779399, "creation_date": 1508779399, "answer_id": 46895115, "question_id": 46894765, "link": "https://stackoverflow.com/questions/46894765/how-to-execute-mysql-script-in-golang-using-exec-command/46895115#46895115", "title": "How to execute Mysql Script in golang using exec.Command", "body": "<p>+1 to answer from @MatteoRagni for showing how to do stdin redirection in Golang. </p>\n\n<p>But here's a simple alternative that I use:</p>\n\n<pre><code>cmd := exec.Command(\"/usr/local/mysql/bin/mysql\", \"-h127.0.0.1\", \"-P3333\", \n  \"-uusr\", \"-pPassxxx\", \"-Ddtb_test\",\n  \"-e\", \"source /Users/XXX/Documents/test/scripts/olds/SCRIPT_XXX.sql\")\n</code></pre>\n\n<p>You don't have to make the mysql client read the script using stdin redirection. Instead, you can make the mysql client execute a specific command, which is <code>source &lt;scriptname&gt;</code>.</p>\n\n<p>P.S.: I also would not put the host, port, user, and password in your code. That means you have to recompile your program any time you change those connection parameters. Also it's not secure to use passwords in plaintext on the command-line. Instead, I'd put all the connection parameters into a defaults file and use <code>mysql --defaults-file=FILENAME</code>.</p>\n"}], "owner": {"reputation": 197, "user_id": 1176585, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/d261de165a36633e0d30c0aa9c4b264b?s=128&d=identicon&r=PG", "display_name": "Ramiro Nava Castro", "link": "https://stackoverflow.com/users/1176585/ramiro-nava-castro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2381, "favorite_count": 0, "accepted_answer_id": 46895115, "answer_count": 2, "score": 1, "last_activity_date": 1508779399, "creation_date": 1508778139, "question_id": 46894765, "link": "https://stackoverflow.com/questions/46894765/how-to-execute-mysql-script-in-golang-using-exec-command", "title": "How to execute Mysql Script in golang using exec.Command", "body": "<p>Hi i am trying to execute a script to fill data into a database using Golang</p>\n\n<pre><code>func executeTestScript(){\n    cmd := exec.Command(\"/usr/local/mysql/bin/mysql\", \"-h127.0.0.1\", \"-P3333\", \"-uusr\", \"-pPassxxx\", \"-Ddtb_test\",  \"&lt; /Users/XXX/Documents/test/scripts/olds/SCRIPT_XXX.sql\")\n\n    var out, stderr bytes.Buffer\n\n    cmd.Stdout = &amp;out\n    cmd.Stderr = &amp;stderr\n\n    err := cmd.Run()\n    if err != nil {\n        fmt.Println(fmt.Sprintf(\"Error executing query. Command Output: %+v\\n: %+v, %v\", out.String(), stderr.String(), err))\n        log.Fatalf(\"Error executing query. Command Output: %+v\\n: %+v, %v\", out.String(), stderr.String(), err)\n    }\n}\n</code></pre>\n\n<p>The problem is that i am getting the error:</p>\n\n<pre><code>ERROR 1049 (42000): Unknown database '&lt; /Users/XXX/Documents/test/scripts/olds/SCRIPT_XXX.sql'\n</code></pre>\n\n<p>i think the problem is the last param (the sql script path) that the exec thinks is the dbname</p>\n\n<p>The following command in the terminal is working:</p>\n\n<pre><code>/usr/local/mysql/bin/mysql --host=127.0.0.1 --port=3333 --user=usr --password=Passxxx --database=dtb_test &lt; /Users/XXX/Documents/roseula/scripts/olds/SCRIPT_XXX.sql\n</code></pre>\n\n<p>but i try to replicate in Go to automatize the execution of the script.</p>\n\n<p>The script have drop tables, create tables, inserts, and PK with FK relationships its a very complete one so i cant execute line by line, because of that i decided to execute de mysql program to insert the data in the database.</p>\n\n<p>Any suggestions?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1508774213, "post_id": 46893533, "comment_id": 80734382, "body": "The function DependencyHealthFunction does not have any arguments.  The function vault.Client.GetHealth has one argument (the receiver).  Explain more about how you intended to use the function. Is their code that will supply that argument?"}, {"owner": {"reputation": 237, "user_id": 4071741, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/832656c16748ed0f9b835bd3874bcaf3?s=128&d=identicon&r=PG&f=1", "display_name": "sarah", "link": "https://stackoverflow.com/users/4071741/sarah"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1508774610, "post_id": 46893533, "comment_id": 80734610, "body": "@CeriseLimon, I hope my edit explains this."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1508774915, "post_id": 46893533, "comment_id": 80734777, "body": "OK, you are not supplying the argument to the function on call.  Where to you intend to supply the argument to vault.Client.GetHealth (the argument is type <code>DefaultClient</code>).  Where does the <code>DefaultClient</code> value come from?"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1508775134, "post_id": 46893533, "comment_id": 80734906, "body": "What function do you want to set as the value of <code>HealthFunction</code>? <code>vault.Client.GetHealth</code> does not refer to a specific function, according to the code you posted (<code>vault.Client</code> is the interface, not an object of type <code>vault.Client</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": false, "score": 0, "last_activity_date": 1508775209, "creation_date": 1508775209, "answer_id": 46893936, "question_id": 46893533, "link": "https://stackoverflow.com/questions/46893533/typecasting-one-function-into-another-in-golang/46893936#46893936", "title": "Typecasting one function into another in golang", "body": "<p>This is abstract:</p>\n\n<pre><code>    HealthFunction: vault.Client.GetHealth,\n</code></pre>\n\n<p>If we were to call <code>HealthFunction()</code>, what code do you expect to run? <code>vault.Client.GetHealth</code> is just a promise that such a function exists; it isn't a function itself. <code>Client</code> is just an interface.</p>\n\n<p>You need to create something that conforms to <code>Client</code> and pass <em>its</em> <code>GetHealth</code>. For example, if you had a existing <code>DefaultClient</code> such as:</p>\n\n<pre><code>defaultClient := DefaultClient{}\n</code></pre>\n\n<p>Then you could pass its function:</p>\n\n<pre><code>    HealthFunction: defaultClient.GetHealth,\n</code></pre>\n\n<p>Now when you later call <code>HealthFunction()</code> it will be the same as calling <code>defaultClient.GetHealth()</code>.</p>\n\n<p><a href=\"https://play.golang.org/p/9Lw7uc0GaE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/9Lw7uc0GaE</a></p>\n"}, {"tags": [], "owner": {"reputation": 345, "user_id": 2675828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fac71269ae48603e95a37d43b04044c?s=128&d=identicon&r=PG", "display_name": "Patty P", "link": "https://stackoverflow.com/users/2675828/patty-p"}, "is_accepted": false, "score": 0, "last_activity_date": 1508776040, "creation_date": 1508776040, "answer_id": 46894163, "question_id": 46893533, "link": "https://stackoverflow.com/questions/46893533/typecasting-one-function-into-another-in-golang/46894163#46894163", "title": "Typecasting one function into another in golang", "body": "<p>I believe the issue is related to understanding how interfaces are treated in Go.</p>\n\n<p>An interface simply defines a method or set of methods that a particular type must satisfy to be considered as \"implementing\" the interface.</p>\n\n<p>For example:</p>\n\n<pre><code>import \"fmt\"\n\ntype Greeter interface {\n    SayHello() string\n}\n\ntype EnglishGreeter struct{}\n\n// Satisfaction of SayHello method\nfunc (eg *EnglishGreeter) SayHello() string {\n    return \"Hello\"\n}\n\ntype SpanishGreeter struct{}\n\nfunc (sg *SpanishGreeter) SayHello() string {\n    return \"Ola\"\n}\n\nfunc GreetPerson(g Greeter) {\n    fmt.Println(g.SayHello())\n}\n\nfunc main() {\n    eg := &amp;EnglishGreeter{}\n\n    sg := &amp;SpanishGreeter{}\n\n    // greet person in english\n    GreetPerson(eg)\n\n    // greet person in spanish\n    GreetPerson(sg)\n}\n</code></pre>\n\n<p>You can add this behavior into a custom struct by simply having a Greeter field inside the struct. ie </p>\n\n<pre><code>type FrontEntrance struct {\n    EntranceGreeter Greeter\n}\n\nfe := &amp;FrontEntrance { EntranceGreeter: &amp;EnglishGreeter{} }\n\n// then call the SayHello() method like this\nfe.EntranceGreeter.SayHello()\n</code></pre>\n\n<p>Interfaces in golang are useful for composing common expected behavior for  types based on the methods that they satisfy.</p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 237, "user_id": 4071741, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/832656c16748ed0f9b835bd3874bcaf3?s=128&d=identicon&r=PG&f=1", "display_name": "sarah", "link": "https://stackoverflow.com/users/4071741/sarah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 229, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1508776040, "creation_date": 1508773982, "last_edit_date": 1508774598, "question_id": 46893533, "link": "https://stackoverflow.com/questions/46893533/typecasting-one-function-into-another-in-golang", "title": "Typecasting one function into another in golang", "body": "<p>I have the following code:</p>\n\n<pre><code>package vault\n\ntype Client interface {\n    GetHealth() error\n}\n\nfunc (c DefaultClient)  GetHealth () error {\n    resp := &amp;VaultHealthResponse{}\n    err := c.get(resp, \"/v1/sys/health\")\n    if err != nil {\n        return err\n    }\n    return nil;\n}\n</code></pre>\n\n<p>Now, I want to use this function as part of this struct:</p>\n\n<pre><code>type DependencyHealthFunction func() error\n\ntype Dependency struct {\n    Name           string `json:\"name\"`\n    Required       bool   `json:\"required\"`\n    Healthy        bool   `json:\"healthy\"`\n    Error          error  `json:\"error,omitempty\"`\n    HealthFunction DependencyHealthFunction\n}\n</code></pre>\n\n<p>Basically, set the value of HealthFunction to GetHealth. Now, when I do the following: </p>\n\n<pre><code>func (config *Config) GetDependencies() *health.Dependency {\n    vaultDependency := health.Dependency{\n        Name: \"Vault\",\n        Required: true,\n        Healthy: true,\n        HealthFunction: vault.Client.GetHealth,\n    }\n    temp1 := &amp;vaultDependency\n    return temp1;\n}\n</code></pre>\n\n<p>This gives me an error and it says <code>cannot use vault.Client.GetHealth (type func(vault.Client) error) as type health.DependencyHealthFunction in field value</code>. How can I do this? </p>\n\n<p>Edit: How DependencyHealthFunction is used? </p>\n\n<p>As its part of Dependency struct, it's simply used as following: <code>d.HealthFunction()</code> where d is a variable of type <code>*Dependency</code>.</p>\n"}, {"tags": ["go", "microservices"], "comments": [{"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508776244, "post_id": 46893497, "comment_id": 80735521, "body": "Andy, what does &quot;I am not using controllers&quot; mean, in your case? How is behaviour exposed to your caller?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1508788830, "post_id": 46893497, "comment_id": 80742241, "body": "&quot;Controllers&quot; is just a state of mind. That answer is still entirely relevant to you. You just don&#39;t have a package called &quot;controllers&quot; everything else is still relevant."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1508788854, "post_id": 46893497, "comment_id": 80742257, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/43502432/how-to-write-test-with-httprouter\">How to write test with httprouter</a>"}, {"owner": {"reputation": 93, "user_id": 6053536, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/SqlOh.jpg?s=128&g=1", "display_name": "Andy Morgan", "link": "https://stackoverflow.com/users/6053536/andy-morgan"}, "reply_to_user": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508926738, "post_id": 46893497, "comment_id": 80806371, "body": "@AlessandroSantini Well, each separate endpoint has a separate function associated with it. I have no idea what controllers are, whereas the other question has something called controllers (so I thought I&#39;d make that difference clear, in case that&#39;s the reason why using the answers from that question hasn&#39;t worked for me)."}, {"owner": {"reputation": 93, "user_id": 6053536, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/SqlOh.jpg?s=128&g=1", "display_name": "Andy Morgan", "link": "https://stackoverflow.com/users/6053536/andy-morgan"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1508927241, "post_id": 46893497, "comment_id": 80806683, "body": "@Flimzy I&#39;ve tried to implement your answer from the other question, but that doesn&#39;t seem to work. It doesn&#39;t seem like the http.Params are being passed to the function in question (i.e. createURL). Here&#39;s the bit that I&#39;ve changed from your original answer: <code>handler := http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { \t\tcreateURL(w, r, httprouter.Params{}) \t})</code>"}, {"owner": {"reputation": 93, "user_id": 6053536, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/SqlOh.jpg?s=128&g=1", "display_name": "Andy Morgan", "link": "https://stackoverflow.com/users/6053536/andy-morgan"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1509015677, "post_id": 46893497, "comment_id": 80852081, "body": "@Flimzy I&#39;ve changed the question to the answer that was given in the other question, but I am getting a <code>panic: runtime error: invalid memory address or nil pointer dereference</code> error."}, {"owner": {"reputation": 93, "user_id": 6053536, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/SqlOh.jpg?s=128&g=1", "display_name": "Andy Morgan", "link": "https://stackoverflow.com/users/6053536/andy-morgan"}, "edited": false, "score": 0, "creation_date": 1509015724, "post_id": 46893497, "comment_id": 80852108, "body": "@mkopriva Perhaps you could help me? You seemed to answer the other question."}], "owner": {"reputation": 93, "user_id": 6053536, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/SqlOh.jpg?s=128&g=1", "display_name": "Andy Morgan", "link": "https://stackoverflow.com/users/6053536/andy-morgan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 256, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1509015599, "creation_date": 1508773860, "last_edit_date": 1509015599, "question_id": 46893497, "link": "https://stackoverflow.com/questions/46893497/how-do-i-test-while-using-httprouter-without-using-controllers", "title": "How do I test while using httprouter without using controllers?", "body": "<p>I'm trying to write tests for a microservice I wrote using httprouter. I've previously tried to use the answers given here: <a href=\"https://stackoverflow.com/questions/43502432/how-to-write-test-with-httprouter\">How to write test with httprouter</a> but that doesn't seem too relevant since I don't use controllers in my microservice. Any help would be greatly appreciated.</p>\n\n<p>Here's what I have so far:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"net/http/httptest\"\n    \"testing\"\n\n    \"github.com/julienschmidt/httprouter\"\n)\n\nfunc TestCreateURL(t *testing.T) {\n  expected := `{\"original_url\":\"https://www.google.com\", \"short_url\":\"https://morning-retreat-24523.herokuapp.com/get/3578\"}`\n  handler := createURL\n  router := httprouter.New()\n  router.GET(\"/new/*url\", handler)\n\n  req, err := http.NewRequest(\"GET\", \"/new/https://www.google.com\", nil)\n  if err != nil {\n      fmt.Println(err)\n  }\n  rr := httptest.NewRecorder()\n\n  router.ServeHTTP(rr, req)\n  if rr.Body.String() != expected {\n      t.Errorf(\"Handler returned unexpected body: Got %v but want %v\",\n        rr.Body.String(), expected)\n  }\n</code></pre>\n\n<p>}</p>\n\n<p>createURL is a function like this (but with a lot more in it obviously):</p>\n\n<pre><code>func createURL(res http.ResponseWriter, req *http.Request, ps httprouter.Params) {\n\n}\n</code></pre>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1508771589, "post_id": 46892734, "comment_id": 80732692, "body": "Do not use relative paths in imports. You should only seed the PRNG once."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1508771617, "post_id": 46892734, "comment_id": 80732718, "body": "You don&#39;t need to reseed the rand package every loop.  Just seed it once at the start of the program."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 5010264, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/922957344424230/picture?type=large", "display_name": "David Sankovsky", "link": "https://stackoverflow.com/users/5010264/david-sankovsky"}, "edited": false, "score": 0, "creation_date": 1508833676, "post_id": 46892782, "comment_id": 80757914, "body": "I feel kinda stupid that I forgot the return in there, but nice catch, thanks!"}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 7, "last_activity_date": 1508771514, "creation_date": 1508771514, "answer_id": 46892782, "question_id": 46892734, "link": "https://stackoverflow.com/questions/46892734/function-returns-empty-string-even-though-it-shouldnt-in-golang/46892782#46892782", "title": "function returns empty string even though it shouldn&#39;t in golang", "body": "<p>You are missing a return statement in your else case. If validate returns false, you <strong>call</strong> <code>GenSpecial</code> and then it returns \"abc\".</p>\n\n<p>You want to say:</p>\n\n<pre><code>if validate(string(rstring))&amp;&amp; string(rstring)!=\"\"{\n    return string(rstring)\n} else {\n    return GenSpecial(n) // return here!\n}\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 5010264, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/922957344424230/picture?type=large", "display_name": "David Sankovsky", "link": "https://stackoverflow.com/users/5010264/david-sankovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "accepted_answer_id": 46892782, "answer_count": 1, "score": 1, "last_activity_date": 1508771514, "creation_date": 1508771354, "question_id": 46892734, "link": "https://stackoverflow.com/questions/46892734/function-returns-empty-string-even-though-it-shouldnt-in-golang", "title": "function returns empty string even though it shouldn&#39;t in golang", "body": "<p>I'm having a strange issue.</p>\n\n<p>I have a package named tools in which I have various files with tools for my main package, one of them generates a pseudorandom string that should contain uppercase, lowercase, numerical and certain special characters, to make sure I don't get a string that misses some of the types I did some validations and yet, i seem to miss something because I get an error every now and then </p>\n\n<p>This is my main file:</p>\n\n<pre><code>package main\n\nimport (\n    \"../tools\"\n    \"fmt\"\n    \"strings\"\n)\n\nconst lower = \"abcdefghizklmnopqrstuvwxyz\"\nconst upper = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\nconst numrical= \"0123456789\"\nconst special = \"!#$^*\"\n\nfunc main (){\n\n    for i :=0; i&lt;10; i++ {\n        str := tools.GenSpecial(15)\n        fmt.Println(str, validate(str))\n    }\n\n}\n\nfunc haslower (s string) bool {\n    return strings.ContainsAny(s,lower)\n}\n\nfunc hasupper (s string) bool {\n    return strings.ContainsAny(s,upper)\n}\n\nfunc hasnumrical (s string) bool {\n    return strings.ContainsAny(s,numrical)\n}\n\nfunc hasspecial (s string) bool {\n    return strings.ContainsAny(s,special)\n}\n\nfunc validate (s string) bool {\n    return haslower(s) &amp;&amp; hasupper(s) &amp;&amp; hasnumrical(s) &amp;&amp; hasspecial(s)\n}\n</code></pre>\n\n<p>and this is the relevant parts from my tools file:</p>\n\n<pre><code>package tools\n\nimport (\n    \"math/rand\"\n    \"time\"\n    \"strings\"\n)\nconst alphanum = \n\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\"\nconst alphabet = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\nconst specialchars = \n\"abcdefghijklmnopqrstuwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!#$^*\"\nconst lower = \"abcdefghizklmnopqrstuvwxyz\"\nconst upper = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\nconst numrical= \"0123456789\"\nconst special = \"!#$^*\"\n\nfunc randomize() {\n    rand.Seed(time.Now().UnixNano())\n}\nfunc GenSpecial(n int) string { //function to generate a psuedorandom \nalphabetical string with special characters\n    rstring := make([]byte, n)\n    for i := range rstring {\n        randomize()\n        rstring[i] = specialchars[rand.Intn(len(specialchars))]\n    }\n    if validate(string(rstring))&amp;&amp; string(rstring)!=\"\"{\n        return string(rstring)\n    } else {\n        GenSpecial(n)\n    }\n    return \"abc\"\n}\nfunc haslower (s string) bool {\n    return strings.ContainsAny(s,lower)\n}\n\nfunc hasupper (s string) bool {\n    return strings.ContainsAny(s,upper)\n}\n\nfunc hasnumrical (s string) bool {\n    return strings.ContainsAny(s,numrical)\n}\n\nfunc hasspecial (s string) bool {\n    return strings.ContainsAny(s,special)\n}\n\nfunc validate (s string) bool {\n    return haslower(s) &amp;&amp; hasupper(s) &amp;&amp; hasnumrical(s) &amp;&amp; hasspecial(s)\n}\n</code></pre>\n\n<p>When I run my main file, i get some values that return the \"abc\" value, and I don't understand how or why.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1508813708, "post_id": 46892483, "comment_id": 80749793, "body": "BUG: <code>s.Imports = s.Imports[1:]</code> is a bug. if <code>s.Imports</code> has more than <code>max</code> entries then you leave more than <code>max</code> entries in the slice:  <a href=\"https://play.golang.org/p/tRWk2cVfe0\" rel=\"nofollow noreferrer\">play.golang.org/p/tRWk2cVfe0</a>. <code>s.Imports[1:]</code> should be <code>s.Imports[len(s.Imports)-max:]</code>."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1508856340, "post_id": 46892483, "comment_id": 80774139, "body": "Realistically, if you&#39;re only ever adding entries via AddImport, you can never have more than <code>max+1</code> in it (after insert), because you&#39;re always removing an entry any time you add one to it.  Still, I tend to agree, as a just-in-case measure, as my answer reflects."}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 1, "last_activity_date": 1508827437, "last_edit_date": 1508827437, "creation_date": 1508770595, "answer_id": 46892483, "question_id": 46892183, "link": "https://stackoverflow.com/questions/46892183/only-leave-n-elements-in-slice/46892483#46892483", "title": "Only leave n elements in slice", "body": "<p>If you want to remove first element (the one that has been in there the longest) from a slice <code>s</code>, you can simply do <code>s = s[1:]</code> which makes s a reference to the slice starting at the first element of the old slice.</p>\n\n<p>I have modified your code to do this:</p>\n\n<p><a href=\"https://play.golang.org/p/Eu-KLoinz0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Eu-KLoinz0</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype Statistics struct {\n    LastScan time.Time\n    Imports  []Import\n}\n\ntype Import struct {\n    text string\n}\n\nfunc (s *Statistics) AddImport(i Import) {\n    s.Imports = append(s.Imports, i)\n    const max = 2\n    if len(s.Imports) &gt; max {\n        s.Imports = s.Imports[len(s.Imports)-max:]\n    }\n}\n\nfunc main() {\n    s := Statistics{}\n    s.AddImport(Import{text: \"myText1\"})\n    fmt.Println(s.Imports)\n    s.AddImport(Import{text: \"myText2\"})\n    fmt.Println(s.Imports)\n    s.AddImport(Import{text: \"myText3\"})\n    fmt.Println(s.Imports)\n    s.AddImport(Import{text: \"myText4\"})\n    fmt.Println(s.Imports)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": false, "score": 2, "last_activity_date": 1508770680, "creation_date": 1508770680, "answer_id": 46892515, "question_id": 46892183, "link": "https://stackoverflow.com/questions/46892183/only-leave-n-elements-in-slice/46892515#46892515", "title": "Only leave n elements in slice", "body": "<p>Subslice.  The syntax <code>slice[n:m]</code> returns the portion of the input slice from n to m-1.  Either one can be omitted to imply 0 or len(slice), respectively.  So <code>slice[n:]</code> means \"give me the portion of the slice from <code>n</code> to the end.  <code>slice[len(slice)-n:]</code> will give you the last <code>n</code> entries in the slice.</p>\n\n<p><a href=\"https://play.golang.org/p/4JRcRH-wc3\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4JRcRH-wc3</a></p>\n\n<pre><code>func (s *Statistics) AddImport(i Import) {\n    // How can I optimize this method so that\n    // only the last two entries are kept?\n\n    s.Imports = append(s.Imports, i)\n    if len(s.Imports) &gt; numberToKeep {\n        s.Imports = s.Imports[len(s.Imports)-numberToKeep:]\n    }\n}\n</code></pre>\n\n<p>Note that this does not remove the start of the slice from memory (or allow it to be garbage collected), but as you continue to add entries, the runtime will automatically allocate larger underlying arrays and copy the contents, freeing earlier array allocations to be garbage collected.  It currently does this on a factor-of-2 basis (so it does it every time the slice doubles in size), though this is not documented and thus not guaranteed to remain this way.  If memory management is important to you, you can manually copy the slice to a new backing array using the built-in <code>copy(dest, source)</code> function.</p>\n\n<p>Advanced options include using a queue system (which are typically implemented using a linked list format) or a circular slice (where entries \"wrap\" around from the end to unused indexes at the start of the array, another common queue design).</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1508942461, "last_edit_date": 1508942461, "creation_date": 1508792737, "answer_id": 46898550, "question_id": 46892183, "link": "https://stackoverflow.com/questions/46892183/only-leave-n-elements-in-slice/46898550#46898550", "title": "Only leave n elements in slice", "body": "<p>For example,</p>\n\n<p><code>addimport.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype Statistics struct {\n    LastScan time.Time\n    Imports  []Import\n}\n\ntype Import struct {\n    text string\n}\n\nfunc (s *Statistics) AddImport(i Import) {\n    // only the last n entries are kept\n    const n = 2 // n &gt; 0 and small\n    if len(s.Imports) &gt;= n {\n        copy(s.Imports, s.Imports[len(s.Imports)-n+1:])\n        s.Imports = s.Imports[:n-1]\n    }\n    s.Imports = append(s.Imports, i)\n}\n\nfunc main() {\n    s := Statistics{}\n    fmt.Println(len(s.Imports), cap(s.Imports), s.Imports)\n    s.AddImport(Import{text: \"myText1\"})\n    s.AddImport(Import{text: \"myText2\"})\n    s.AddImport(Import{text: \"myText3\"})\n    fmt.Println(len(s.Imports), cap(s.Imports), s.Imports)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/204-uB8Zls\" rel=\"nofollow noreferrer\">https://play.golang.org/p/204-uB8Zls</a></p>\n\n<p>Output:</p>\n\n<pre><code>0 0 []\n2 2 [{myText2} {myText3}]\n</code></pre>\n\n<hr>\n\n<p>Code should be reasonably efficient. Go has a benchmark package. Here are the benchmark results for the solutions from peterSO, Kaedys, and gonutz.</p>\n\n<pre><code>$ go test -bench=. addimport_test.go\nBenchmarkAddImport/PeterSO-4   100000   16145 ns/op      96 B/op     3 allocs/op\nBenchmarkAddImport/Kaedys-4     30000   59344 ns/op   32032 B/op   502 allocs/op\nBenchmarkAddImport/Gonutz-4     30000   60447 ns/op   32032 B/op   502 allocs/op\n</code></pre>\n\n<p><code>addimport_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n    \"time\"\n)\n\ntype Statistics struct {\n    LastScan time.Time\n    Imports  []Import\n}\n\ntype Import struct {\n    text string\n}\n\nfunc (s *Statistics) AddImportPeterSO(i Import) {\n    // only the last n entries are kept\n    const n = 2 // n &gt; 0 and small\n    if len(s.Imports) &gt;= n {\n        copy(s.Imports, s.Imports[len(s.Imports)-n+1:])\n        s.Imports = s.Imports[:n-1]\n    }\n    s.Imports = append(s.Imports, i)\n}\n\nconst numberToKeep = 2\n\nfunc (s *Statistics) AddImportKaedys(i Import) {\n    s.Imports = append(s.Imports, i)\n    if len(s.Imports) &gt; numberToKeep {\n        s.Imports = s.Imports[len(s.Imports)-numberToKeep:]\n    }\n}\n\nfunc (s *Statistics) AddImportGonutz(i Import) {\n    s.Imports = append(s.Imports, i)\n    const max = 2\n    if len(s.Imports) &gt; max {\n        s.Imports = s.Imports[1:]\n    }\n}\n\nfunc benchmarkAddImport(b *testing.B, addImport func(*Statistics, Import)) {\n    b.ReportAllocs()\n    for i := 0; i &lt; b.N; i++ {\n        var s Statistics\n        for j := 0; j &lt; 1000; j++ {\n            addImport(&amp;s, Import{})\n        }\n    }\n}\n\nfunc BenchmarkAddImport(b *testing.B) {\n    b.Run(\"PeterSO\", func(b *testing.B) {\n        benchmarkAddImport(b, (*Statistics).AddImportPeterSO)\n    })\n    b.Run(\"Kaedys\", func(b *testing.B) {\n        benchmarkAddImport(b, (*Statistics).AddImportKaedys)\n    })\n    b.Run(\"Gonutz\", func(b *testing.B) {\n        benchmarkAddImport(b, (*Statistics).AddImportGonutz)\n    })\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Q2X_T5Vofe\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Q2X_T5Vofe</a></p>\n\n<hr>\n\n<p>The general form of this problem is a circular buffer: <a href=\"https://en.wikipedia.org/wiki/Circular_buffer\" rel=\"nofollow noreferrer\">Circular buffer</a>.</p>\n"}], "owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3000, "favorite_count": 1, "accepted_answer_id": 46898550, "answer_count": 3, "score": 0, "last_activity_date": 1508942461, "creation_date": 1508769818, "question_id": 46892183, "link": "https://stackoverflow.com/questions/46892183/only-leave-n-elements-in-slice", "title": "Only leave n elements in slice", "body": "<p>Please see <a href=\"https://play.golang.org/p/qm5RrI0iBe\" rel=\"nofollow noreferrer\">this playground</a>. As you can see I have a slice within a struct. I also have a method which can be used to add a new element to the slice. This works fine.</p>\n\n<p>But now my problem is that I want to extend the method so that it leaves <code>n</code> elements of the slice. So when adding a new element, the \"oldest\" should be removed and the new one should be added.</p>\n\n<p>How can I do this? Aren't there out-of-the-box packages which I can use? </p>\n"}, {"tags": ["arrays", "mongodb", "go", "aggregate", "mgo"], "comments": [{"owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 0, "creation_date": 1508772148, "post_id": 46892083, "comment_id": 80733109, "body": "When are you getting the error? While running go code or while compiling it?"}, {"owner": {"reputation": 862, "user_id": 4780378, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/952ea857b33c627ee944e6e34871d211?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndroid", "link": "https://stackoverflow.com/users/4780378/devandroid"}, "reply_to_user": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 0, "creation_date": 1508772431, "post_id": 46892083, "comment_id": 80733278, "body": "while running go code"}], "answers": [{"comments": [{"owner": {"reputation": 862, "user_id": 4780378, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/952ea857b33c627ee944e6e34871d211?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndroid", "link": "https://stackoverflow.com/users/4780378/devandroid"}, "edited": false, "score": 0, "creation_date": 1508833351, "post_id": 46898085, "comment_id": 80757725, "body": "Thank you very much for your clear answer ! It&#39;s perfect with $elemMatch !"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1508791043, "creation_date": 1508791043, "answer_id": 46898085, "question_id": 46892083, "link": "https://stackoverflow.com/questions/46892083/get-array-objects-with-specific-objectid-in-nested-array/46898085#46898085", "title": "Get array objects with specific ObjectId in nested array", "body": "<p>You are attempting to use the aggregation framework in your <code>mgo</code> solution, yet the query you try to implement does not use one (and does not need one).</p>\n\n<p>The query:</p>\n\n<pre><code>db.getCollection('co4b').find({\n    userids: {$all: [ObjectId(\"59edb459593904117884b71f\")] }\n})\n</code></pre>\n\n<p>Can simply be transformed to <code>mgo</code> like this:</p>\n\n<pre><code>c := uc.session.DB(\"API\").C(\"objects\")\n\nvar objects []models.Objects\nerr := c.Find(bson.M{\"userids\": bson.M{\n    \"$all\": []interface{}{bson.ObjectIdHex(\"59edb459593904117884b71f\")},\n}}).All(&amp;objects)\n</code></pre>\n\n<p>Also note that if you're using <code>$all</code> with a single element, you can also implement that query using <code>$elemMatch</code>, which in MongoDB console would like this:</p>\n\n<pre><code>db.getCollection('co4b').find({\n    userids: {$elemMatch: {$eq: ObjectId(\"59edb459593904117884b71f\")}}\n})\n</code></pre>\n\n<p>Which looks like this in <code>mgo</code>:</p>\n\n<pre><code>err := c.Find(bson.M{\"userids\": bson.M{\n    \"$elemMatch\": bson.M{\"$eq\": bson.ObjectIdHex(\"59edb459593904117884b71f\")},\n}}).All(&amp;objects)\n</code></pre>\n"}], "owner": {"reputation": 862, "user_id": 4780378, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/952ea857b33c627ee944e6e34871d211?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndroid", "link": "https://stackoverflow.com/users/4780378/devandroid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1066, "favorite_count": 0, "accepted_answer_id": 46898085, "answer_count": 1, "score": 2, "last_activity_date": 1508791273, "creation_date": 1508769499, "last_edit_date": 1508791273, "question_id": 46892083, "link": "https://stackoverflow.com/questions/46892083/get-array-objects-with-specific-objectid-in-nested-array", "title": "Get array objects with specific ObjectId in nested array", "body": "<p>I'm trying to get a specific array of objects depending on ObjectId they have.</p>\n\n<p>Here is my MongoDB database:</p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"59edb571593904117884b721\"),\n    \"userids\" : [\n            ObjectId(\"59edb459593904117884b71f\")\n    ],\n    \"macaddress\" : \"MACADDRESS\",\n    \"devices\" : [ ],\n    \"projectorbrand\" : \"\",\n}\n{\n    \"_id\" : ObjectId(\"59edb584593904117884b722\"),\n    \"userids\" : [\n            ObjectId(\"59edb459593904117884b71f\"),\n            ObjectId(\"59e4809159390431d44a9438\")\n    ],\n    \"macaddress\" : \"MACADDRESS2\",\n    \"devices\" : [ ],\n    \"projectorbrand\" : \"\",\n}\n</code></pre>\n\n<p>The command in MongoDB is:</p>\n\n<pre><code>db.getCollection('co4b').find( {\n    userids: { $all: [ ObjectId(\"59edb459593904117884b71f\") ] }\n} )\n</code></pre>\n\n<p>This will work and will return an array filtered correctly.\nI would like to translate this query in Golang.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>pipe := bson.M{\"userids\": bson.M{\"$all\": objectId}}\nvar objects[]models.Objects\nif err := uc.session.DB(\"API\").C(\"objects\").Pipe(pipe).All(&amp;objects); err != nil {\n    SendError(w, \"error\", 500, err.Error())\n} else {\n    for i := 0; i &lt; len(objects); i++ {\n        objects[i].Actions = nil\n    }\n    uj, _ := json.MarshalIndent(objects, \"\", \" \")\n    SendSuccessJson(w, uj)\n}\n</code></pre>\n\n<p>I'm getting error like <code>wrong type for field (pipeline) 3 != 4</code>. I saw that <code>$all</code> needs string array but how to filter by ObjectId instead of string?</p>\n\n<p>Thanks for help</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508763811, "post_id": 46889923, "comment_id": 80727233, "body": "You cannot do this, it is technically impossible. You&#39;ll have to redesign (like more JavaScript)."}], "answers": [{"tags": [], "owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "is_accepted": true, "score": 4, "last_activity_date": 1508764101, "creation_date": 1508764101, "answer_id": 46890166, "question_id": 46889923, "link": "https://stackoverflow.com/questions/46889923/golang-http-write-response-without-waiting-to-finish/46890166#46890166", "title": "Golang http write response without waiting to finish", "body": "<p>TL;DR is that it cannot be implemented that way. You need to</p>\n\n<ol>\n<li>An API that requests the PDF creation. That queues PDF creation job in a task queue (so that too many PDF creation requests won't blow the HTTP server worker pool)</li>\n<li>Provide an API that allows you to check where are you with the PDF rendering (I am assuming that the job can provide interim stats). This is going to be polled by the client on a regular basis.</li>\n<li>An API to pull the PDF once it is ready.</li>\n</ol>\n\n<p>Hope this helps and best of luck with your project.</p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 5174281, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3hotu5w3YnY/AAAAAAAAAAI/AAAAAAAAJ6U/hqII7vrVaNg/photo.jpg?sz=128", "display_name": "Sandy Cash", "link": "https://stackoverflow.com/users/5174281/sandy-cash"}, "is_accepted": false, "score": 0, "last_activity_date": 1508766199, "creation_date": 1508766199, "answer_id": 46890895, "question_id": 46889923, "link": "https://stackoverflow.com/questions/46889923/golang-http-write-response-without-waiting-to-finish/46890895#46890895", "title": "Golang http write response without waiting to finish", "body": "<p>This is by no means comprehensive, but a reasonable example of how you might construct your API (which needs to be asynchronous, as the previous respondent pointed out) can be found here: <a href=\"https://www.adayinthelifeof.nl/2011/06/02/asynchronous-operations-in-rest/\" rel=\"nofollow noreferrer\">https://www.adayinthelifeof.nl/2011/06/02/asynchronous-operations-in-rest/</a></p>\n\n<p>The job queue model is a pretty common one.  I would recommend you also write a basic API binding library (you'd want this for your own testing purposes in any case) so that your users can understand how you intend them to use the API, and in writing it, you'll get a better sense of how asynchronous REST interactions feel from the end user side.</p>\n"}, {"comments": [{"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508768816, "post_id": 46891608, "comment_id": 80730769, "body": "I do not agree. In this case, you are stating a content type in the response (e.g. application/pdf) and you are sending a mixed content. I am not sure that fits in the HTTP specification. In addition to that, you are keeping the worker thread busy for a very long time and multiple requests of this type may end up saturating the pool. Not good design, IMHO."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508770070, "post_id": 46891608, "comment_id": 80731633, "body": "@AlessandroSantini, actually I&#39;m with you on these matters, but I tried to highlight that saying &quot;no it is not possible&quot; is incorrect and is throwing the baby out with the bathwater ;-) As to your comment, no, I&#39;d not expect the server to set the <code>Content-Type</code> field to <code>application&#47;pdf</code>; sure, there should be some made up content type, and that&#39;s why I explicitly mentioned that &quot;\u2026the clients \u2026 &lt;should be&gt; \u2026prepared to accept and parse it&quot;."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508770176, "post_id": 46891608, "comment_id": 80731721, "body": "@AlessandroSantini, as to resource management, it&#39;s a more interesting topic but I&#39;m afraid we&#39;re moving into a field of pure speculation here ;-) I mean, querying tasks and polling their status supposedly occupies less HTTP connections but still takes up server resources. Deciding what approach is best depends on too much factors we know no measures about."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1508768213, "creation_date": 1508768213, "answer_id": 46891608, "question_id": 46889923, "link": "https://stackoverflow.com/questions/46889923/golang-http-write-response-without-waiting-to-finish/46891608#46891608", "title": "Golang http write response without waiting to finish", "body": "<p>Contrary to what others have said, what you want is in fact\ndirectly possible but requires fullfillment of the two preconditions:</p>\n\n<ul>\n<li>HTTP/1.1 and above.</li>\n<li>You'll be sending custom content to the clients \u2014 not PDF data\n<em>directly,</em> \u2014 and they're prepared to accept and parse it.</li>\n</ul>\n\n<p>You can then employ the so-called \"chunked\" payload encoding specifically\ninvented to handle \"streamed\" downloads where the server does not know how\nmany bytes it's about to send.</p>\n\n<p>So you may invent some creative kind of payload where you first periodically\nstream a \"no op\" / \"progress\" marker and then the actual payload.\nSay, while the file is being prepared you periodically send a line of text\nreading \"PROCESSING\" + <code>LF</code> then, when a result is ready you send\na line of text \"READY<code></code>\" <code>SIZE</code> + <code>LF</code> where <code>SIZE</code> is the size, in bytes,\nof the immediately following PDF document. After the document is streamed,\nthe server signals the end of data.</p>\n\n<p>Hence the stream would look like</p>\n\n<pre><code>PROCESSING\nPROCESSING\n\u2026\nPROCESSING\nREADY 8388608\n%PDF-1.3\n\u2026\n%%EOF\n</code></pre>\n\n<p>The clients have to be able to parse this information from the stream\nthey're receiving and have a simple FSM in place to switch from state to\nstate as they fetch your stream.</p>\n\n<p>The server has to make sure it flushes the stream after each \"informational\" line otherwise the whole thing would not be \"interactive\".</p>\n\n<p>If you have a good idea about the overall state of the processing of the\ndocument, each \"status update\" line could include the percentage of the work done, like in \"PROCESSING<code></code>NN\" + <code>LF</code>.</p>\n"}], "owner": {"reputation": 43, "user_id": 6172905, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/001d98bf6fe7ebecd6727a567823de88?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Sousa", "link": "https://stackoverflow.com/users/6172905/igor-sousa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1768, "favorite_count": 0, "accepted_answer_id": 46890166, "answer_count": 3, "score": -1, "last_activity_date": 1508768213, "creation_date": 1508763363, "question_id": 46889923, "link": "https://stackoverflow.com/questions/46889923/golang-http-write-response-without-waiting-to-finish", "title": "Golang http write response without waiting to finish", "body": "<p>I'm building an application that builds a pdf file and returns it to the client whenever it receives a request. </p>\n\n<p>Since some of these pdf files might take some time to generate, I would like to periodically send some sort of status update back to client while it is running.</p>\n\n<p>When it's finished building the pdf file, it should be returned to the client as well.</p>\n\n<p>Something akin to:</p>\n\n<pre><code>func buildReport(writer http.ResponseWriter, request *http.Request){\n    //build pdf build pdf file\n    for { //for example purposes only\n        writer.Write([]byte(\"building. Please wait.\"))\n    }\n    pdf.OutputFileAndClose(\"report.pdf\")\n    //set header to pdf so that the client knows it's a PDF\n    writer.Header().Set(\"Content-Type\", \"application/pdf\")\n    http.ServeFile(writer, request, \"report.pdf\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", buildReport)\n    http.ListenAndServe(\":8081\", nil)\n}\n</code></pre>\n\n<p>Setting the header might not work, as the writer can only have one header.</p>\n"}, {"tags": ["github", "go", "glide-golang"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1508757577, "post_id": 46887802, "comment_id": 80723081, "body": "Run the same command while having <code>GIT_TRACE=1</code> and <code>GIT_CURL_VERBOSE=1</code> in your environment."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1508757624, "post_id": 46887802, "comment_id": 80723111, "body": "Another minor point: text consoles in Windows do support copying text from them; please copy and paste this text and format it as code; do not post screenshots: they are not indexed by google."}, {"owner": {"reputation": 5986, "user_id": 161222, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/212ca1d74ff55e4ba7c1363f7c0fb55f?s=128&d=identicon&r=PG", "display_name": "Radi", "link": "https://stackoverflow.com/users/161222/radi"}, "edited": false, "score": 0, "creation_date": 1508757994, "post_id": 46887802, "comment_id": 80723332, "body": "It could be a network issue, please make sure your connection is ok and try to add &quot;-v&quot; flag to enable debug output."}, {"owner": {"reputation": 173, "user_id": 6024401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FUsMO.jpg?s=128&g=1", "display_name": "mayur rathi", "link": "https://stackoverflow.com/users/6024401/mayur-rathi"}, "reply_to_user": {"reputation": 5986, "user_id": 161222, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/212ca1d74ff55e4ba7c1363f7c0fb55f?s=128&d=identicon&r=PG", "display_name": "Radi", "link": "https://stackoverflow.com/users/161222/radi"}, "edited": false, "score": 0, "creation_date": 1508758763, "post_id": 46887802, "comment_id": 80723851, "body": "@Radi : I dont see any network Issues Here."}, {"owner": {"reputation": 5986, "user_id": 161222, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/212ca1d74ff55e4ba7c1363f7c0fb55f?s=128&d=identicon&r=PG", "display_name": "Radi", "link": "https://stackoverflow.com/users/161222/radi"}, "edited": false, "score": 0, "creation_date": 1508759286, "post_id": 46887802, "comment_id": 80724209, "body": "Did you tried the same command without update flag &quot;-u&quot;?"}, {"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508764320, "post_id": 46887802, "comment_id": 80727591, "body": "That is odd, I just tried now (MacOS) and worked fine. Are you using Git for Windows or MinGW/CygWin?"}, {"owner": {"reputation": 173, "user_id": 6024401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FUsMO.jpg?s=128&g=1", "display_name": "mayur rathi", "link": "https://stackoverflow.com/users/6024401/mayur-rathi"}, "edited": false, "score": 0, "creation_date": 1508772627, "post_id": 46887802, "comment_id": 80733410, "body": "same process to clone any repository was working couple of days back. but its not working now.."}, {"owner": {"reputation": 173, "user_id": 6024401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FUsMO.jpg?s=128&g=1", "display_name": "mayur rathi", "link": "https://stackoverflow.com/users/6024401/mayur-rathi"}, "edited": false, "score": 0, "creation_date": 1508773530, "post_id": 46887802, "comment_id": 80733956, "body": "This is a genuine Issue that Im facing. Im not sure Why people are voting it with Downvote"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508776424, "post_id": 46887802, "comment_id": 80735626, "body": "Have you changed anything in your global git config? Have you updated your git installation? Have you tried removing the repos and starting from scratch? Can you do the git clones manually?"}], "answers": [{"tags": [], "owner": {"reputation": 173, "user_id": 6024401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FUsMO.jpg?s=128&g=1", "display_name": "mayur rathi", "link": "https://stackoverflow.com/users/6024401/mayur-rathi"}, "is_accepted": true, "score": 2, "last_activity_date": 1509085421, "creation_date": 1509085421, "answer_id": 46968689, "question_id": 46887802, "link": "https://stackoverflow.com/questions/46887802/exit-status-128-while-cloning-the-git-repository-while-getting-go-package-from-g/46968689#46968689", "title": "exit status 128 while cloning the git repository while getting go package from Github location", "body": "<p>I tried to resolve the issue for a couple of days. \nIn My configuration I was on organizational GitHub and the codelibrary I was trying to get was from github.com. So I thought that might be causing the issue. But that was not true.</p>\n\n<p>I suspected that there is somethisng wrong with the git configuration. as even Organizational github account was not accessible. I tried a lot of solutions from multiple threads.. nothing worked.</p>\n\n<p>Then I ultimately uninstalled GitHub and tortoise git from My machine and installed it again. \nand did the complete git configuration setup on my machine from scratch. </p>\n\n<p>It Worked.</p>\n\n<p>What caused that issue in first place was identified when I went to uninstall git. Instalation date was the date when the issue started. So i suspect that there was some faulty update installed for git unknowingly and that caused this issue.</p>\n"}], "owner": {"reputation": 173, "user_id": 6024401, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FUsMO.jpg?s=128&g=1", "display_name": "mayur rathi", "link": "https://stackoverflow.com/users/6024401/mayur-rathi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18478, "favorite_count": 0, "accepted_answer_id": 46968689, "answer_count": 1, "score": 0, "last_activity_date": 1509085421, "creation_date": 1508756627, "last_edit_date": 1508759609, "question_id": 46887802, "link": "https://stackoverflow.com/questions/46887802/exit-status-128-while-cloning-the-git-repository-while-getting-go-package-from-g", "title": "exit status 128 while cloning the git repository while getting go package from Github location", "body": "<p>I want to configure the GoLang GB compiler for the projects in my local. based on the documentation given in the  <a href=\"https://getgb.io/docs/install/\" rel=\"nofollow noreferrer\">url</a> I am trying to get the gb compiler using the command \n<a href=\"https://i.stack.imgur.com/8DX0W.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/8DX0W.png\" alt=\"enter image description here\"></a></p>\n\n<p>its returning status code 128. I am unable to understand whats happening here as there is no reference to resolve this issue. </p>\n\n<p>adding GIT_CURL_VERBOSE=1 or 2 is not helping as its not giving any other valuable details as output.</p>\n\n<pre><code>$ GIT_CURL_VERBOSE=1 go get -u -v github.com/constabulary/gb/...\n$ github.com/constabulary/gb (download)\n$ # cd .; git clone https://github.com/constabulary/gb \n  C:\\work\\GitHub\\GoLib\\src\\github.com\\constabulary\\gb\n  Cloning into 'C:\\work\\GitHub\\GoLib\\src\\github.com\\constabulary\\gb'...\n  package github.com/constabulary/gb/...: exit status 128\n</code></pre>\n\n<p>Still getting the avove output</p>\n\n<p>below is the output when not using -u </p>\n\n<pre><code>$ GIT_TRACE=2 go get -v github.com/constabulary/gb/...\ngithub.com/constabulary/gb (download)\n# cd .; git clone https://github.com/constabulary/gb \nC:\\work\\GitHub\\GoLib\\src\\github.com\\constabulary\\gb\n17:20:25.818538 git.c:328               trace: built-in: git 'clone' \n'https://github.com/constabulary/gb' 'C:\\work\\GitHub\\GoLib\\                                                \nsrc\\github.com\\constabulary\\gb'\n17:20:25.867542 run-command.c:626       trace: run_command: 'remote-https' \n'origin' 'https://github.com/constabulary/gb'\nCloning into 'C:\\work\\GitHub\\GoLib\\src\\github.com\\constabulary\\gb'...\n17:20:25.970553 git.c:560               trace: exec: 'git-remote-https' \n'origin' 'https://github.com/constabulary/gb'\n17:20:25.970553 run-command.c:626       trace: run_command: 'git-remote-\nhttps' 'origin' 'https://github.com/constabulary/gb'\npackage github.com/constabulary/gb/...: exit status 128\n</code></pre>\n"}, {"tags": ["multithreading", "go", "goroutine"], "comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 1, "creation_date": 1508754766, "post_id": 46887036, "comment_id": 80721474, "body": "Your return in the INT handler only returns from the go routine that it is in. The problem is that your program now does not use the default behavior of terminating on receiving INT. Instead it calls your handler. The handler however does not stop your program. Add a <code>os.Exit(0)</code> in the handler if you want the program to stop. If this works for you I will make it an answer and you could check it as correct."}, {"owner": {"reputation": 638, "user_id": 3122790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6754fd57b3eba714c1496cf94e4d24e?s=128&d=identicon&r=PG", "display_name": "avarabyeu", "link": "https://stackoverflow.com/users/3122790/avarabyeu"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1508755283, "post_id": 46887036, "comment_id": 80721780, "body": "Thank you for the prompt answer! But why does it work if no signal.Notify is defined? Could you please point me to the some &quot;default behavior of terminating on receiving INT&quot;. Should i always call is.Exit if i handle SIGNTERM signal?"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1508755568, "post_id": 46887036, "comment_id": 80721960, "body": "I now created a proper answer since it seem that was the problem. The thing is that by default all programs handle INT by exiting the application. Only a special mechanism defined in the <code>signal</code> package lets you change this by utilizing the appropriate OS specific system calls. By hooking into this you deactivate the default behavior in favor of handling the signal yourself."}], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 1, "last_activity_date": 1508755448, "creation_date": 1508755448, "answer_id": 46887467, "question_id": 46887036, "link": "https://stackoverflow.com/questions/46887036/go-server-hangs-after-sending-int-signal/46887467#46887467", "title": "Go server hangs after sending INT signal", "body": "<p>In your INT handler you do not quit the program yourself.</p>\n\n<p>If you install a signal handler for INT the default behavior of the program on receiving a Ctrl+C, which is quit the program, is not done. Instead the program now handles it by calling your INT handler code instead so if you want to exit your program, call <code>os.Exit(0)</code> in the loop.</p>\n"}], "owner": {"reputation": 638, "user_id": 3122790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6754fd57b3eba714c1496cf94e4d24e?s=128&d=identicon&r=PG", "display_name": "avarabyeu", "link": "https://stackoverflow.com/users/3122790/avarabyeu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 46887467, "answer_count": 1, "score": 0, "last_activity_date": 1508756417, "creation_date": 1508754089, "last_edit_date": 1508754524, "question_id": 46887036, "link": "https://stackoverflow.com/questions/46887036/go-server-hangs-after-sending-int-signal", "title": "Go server hangs after sending INT signal", "body": "<p>Here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    _ \"net/http/pprof\"\n    \"fmt\"\n    \"net/http\"\n    \"html\"\n    \"os/signal\"\n    \"os\"\n)\n\nfunc main() {\n//INT signal handling\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt)\n    go func() {\n        for range c {\n            log.Println(\"GOT SIGNAL!\")\n            return\n\n        }\n    }()\n//INT signal handling\n\n    http.HandleFunc(\"/bar\", func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintf(w, \"Hello, %q\", html.EscapeString(r.URL.Path))\n    })\n\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>After pressing CTRL-C it hangs (server keeps working). But if you comment block between \"INT signal handling\", it finishes fine. \nCould you please explain this behaviour? It's obvious that http server can be created and started explicitly in separate goroutine and gracefully terminated there. But in general the question is how to explain behaviour from this code snipped, why http does not stop if there is new channel that handles SIGNTERM.\nThank you!</p>\n"}, {"tags": ["go", "int", "bit-manipulation", "bit-shift", "signed"], "comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1508747916, "post_id": 46885070, "comment_id": 80717424, "body": "What exactly do you mean, what is the output and what do you expect to see? Your link does not work."}, {"owner": {"reputation": 119, "user_id": 1447634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O1CCh.jpg?s=128&g=1", "display_name": "jithin", "link": "https://stackoverflow.com/users/1447634/jithin"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1508748056, "post_id": 46885070, "comment_id": 80717485, "body": "@gonutz: <a href=\"https://play.golang.org/p/7vjwCbOEkw\" rel=\"nofollow noreferrer\">play.golang.org/p/7vjwCbOEkw</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1508748057, "post_id": 46885070, "comment_id": 80717487, "body": "See <a href=\"https://golang.org/ref/spec#Arithmetic_operators\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Arithmetic_operators</a> and look for shift. There is not much to explain."}, {"owner": {"reputation": 119, "user_id": 1447634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O1CCh.jpg?s=128&g=1", "display_name": "jithin", "link": "https://stackoverflow.com/users/1447634/jithin"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508748113, "post_id": 46885070, "comment_id": 80717511, "body": "@Volker Thank you"}], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 5, "last_activity_date": 1508748472, "creation_date": 1508748472, "answer_id": 46885229, "question_id": 46885070, "link": "https://stackoverflow.com/questions/46885070/golang-left-right-shift-behaviour-for-signed-numbers/46885229#46885229", "title": "Golang Left/Right shift behaviour for signed numbers", "body": "<p><code>-3</code> is, in <a href=\"https://en.wikipedia.org/wiki/Two%27s_complement\" rel=\"noreferrer\">two's complement</a>, <code>11111101</code> and what you see when the program prints <code>-0000011</code> is a <code>-</code> and the binary representation of the absolute value of the number. In two's complement, the highest bit is <code>0</code> for positive (including zero), and <code>1</code> for negative numbers. If you shift this number (<code>11111101</code>) left, the lower 7 bits move one to the left and a <code>0</code> comes in from the right, replacing the lowest bit. Shifting as you do in your example will result in:</p>\n\n<p><code>\n11111101  -3\n11111010  -6\n11110100  -12\n11101000  -24\n11010000  -48\n10100000  -96\n01000000  64\n10000000  -128\n00000000  0\n00000000  0\n...\n</code></p>\n\n<p>You just have to consider all the bit patterns as two's complement, once you know how that works, everything will make sense.</p>\n"}], "owner": {"reputation": 119, "user_id": 1447634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O1CCh.jpg?s=128&g=1", "display_name": "jithin", "link": "https://stackoverflow.com/users/1447634/jithin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1135, "favorite_count": 1, "answer_count": 1, "score": -3, "last_activity_date": 1508748472, "creation_date": 1508747848, "last_edit_date": 1508748064, "question_id": 46885070, "link": "https://stackoverflow.com/questions/46885070/golang-left-right-shift-behaviour-for-signed-numbers", "title": "Golang Left/Right shift behaviour for signed numbers", "body": "<p>Can someone please explain the left/right shift behaviour in Golang. Please refer the sample code here: <a href=\"https://play.golang.org/p/7vjwCbOEkw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7vjwCbOEkw</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var lf int8 = -3\n    fmt.Printf(\"-3 : %08b\\n\", lf)\n    fmt.Printf(\"&lt;&lt;1: %08b\\n\", lf&lt;&lt;1)\n    fmt.Printf(\"&lt;&lt;2: %08b\\n\", lf&lt;&lt;2)\n    fmt.Printf(\"&lt;&lt;3: %08b\\n\", lf&lt;&lt;3)\n    fmt.Printf(\"&lt;&lt;4: %08b\\n\", lf&lt;&lt;4)\n    fmt.Printf(\"&lt;&lt;5: %08b, %d\\n\", lf&lt;&lt;5, lf&lt;&lt;5)\n    fmt.Printf(\"&lt;&lt;6: %08b, %d\\n\", lf&lt;&lt;6, lf&lt;&lt;6)\n    fmt.Printf(\"&lt;&lt;7: %08b, %d\\n\", lf&lt;&lt;7, lf&lt;&lt;7)\n    fmt.Printf(\"&lt;&lt;8: %08b, %d\\n\", lf&lt;&lt;8, lf&lt;&lt;8)\n    fmt.Printf(\"&lt;&lt;9: %08b, %d\\n\", lf&lt;&lt;9, lf&lt;&lt;9)\n}\n\n-3 : -0000011\n&lt;&lt;1: -0000110\n&lt;&lt;2: -0001100\n&lt;&lt;3: -0011000\n&lt;&lt;4: -0110000\n&lt;&lt;5: -1100000, -96\n&lt;&lt;6: 01000000, 64\n&lt;&lt;7: -10000000, -128\n&lt;&lt;8: 00000000, 0\n&lt;&lt;9: 00000000, 0\n</code></pre>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1508758311, "post_id": 46883541, "comment_id": 80723543, "body": "In addition to the answers consider something like this: <a href=\"https://play.golang.org/p/C0vEfs03VO\" rel=\"nofollow noreferrer\">play.golang.org/p/C0vEfs03VO</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 0, "last_activity_date": 1508742969, "creation_date": 1508742969, "answer_id": 46883777, "question_id": 46883541, "link": "https://stackoverflow.com/questions/46883541/how-to-process-json/46883777#46883777", "title": "How to process JSON", "body": "<p>make <code>Password</code> lower case (and add <code>Code     int</code> to your struct):<br>\nTry <a href=\"https://play.golang.org/p/88i-m9Mmtt\" rel=\"nofollow noreferrer\">this</a>:  </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    user := User{1, \"Test\", \"password\", 1, 200}\n    b, err := json.Marshal(user)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(b))\n}\n\ntype User struct {\n    Id       int\n    Name     string\n    password string\n    Status   int\n    Code     int\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{\"Id\":1,\"Name\":\"Test\",\"Status\":1,\"Code\":200}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18922, "user_id": 3633742, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/thyJX.jpg?s=128&g=1", "display_name": "n00dl3", "link": "https://stackoverflow.com/users/3633742/n00dl3"}, "is_accepted": false, "score": 2, "last_activity_date": 1508760637, "last_edit_date": 1508760637, "creation_date": 1508748263, "answer_id": 46885169, "question_id": 46883541, "link": "https://stackoverflow.com/questions/46883541/how-to-process-json/46885169#46885169", "title": "How to process JSON", "body": "<p>If you want to keep the <code>Password</code> property accessible to outer packages, you can set a tag: <code>json:\"-\"</code> on it. As specified in the <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p><strong>The encoding of each struct field can be customized by the format\n  string stored under the \"json\" key in the struct field's tag</strong>. The\n  format string gives the name of the field, possibly followed by a\n  comma-separated list of options. The name may be empty in order to\n  specify options without overriding the default field name.</p>\n  \n  <p>The \"omitempty\" option specifies that the field should be omitted from\n  the encoding if the field has an empty value, defined as false, 0, a\n  nil pointer, a nil interface value, and any empty array, slice, map,\n  or string.</p>\n  \n  <p>As a special case, <strong>if the field tag is \"-\", the field is always\n  omitted</strong>. Note that a field with name \"-\" can still be generated using\n  the tag \"-,\".</p>\n</blockquote>\n\n<pre><code>type User struct {\n    Id       int\n    Name     string\n    Password string `json:\"-\"`\n    Status   int\n    Code     int `json:\"code\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 8220, "user_id": 3305546, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/G2mbe.png?s=128&g=1", "display_name": "Yves", "link": "https://stackoverflow.com/users/3305546/yves"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 46883777, "answer_count": 2, "score": 0, "last_activity_date": 1508760637, "creation_date": 1508741933, "last_edit_date": 1508752272, "question_id": 46883541, "link": "https://stackoverflow.com/questions/46883541/how-to-process-json", "title": "How to process JSON", "body": "<p>I'm building a web server with Go and I don't know how to process JSON with Go.<br></p>\n\n<p>Saying that I have a struct as below:<br></p>\n\n<pre><code>type User struct{\n    Id int\n    Name string\n    Password string\n    Status int\n}\n</code></pre>\n\n<p>and now I have had an object of the struct User:<br></p>\n\n<pre><code>user := User{1, \"Test\", \"password\", 1}\n</code></pre>\n\n<p>Now I need to convert <code>user</code> to a JSON object. Here is what I've found:<br></p>\n\n<pre><code>b, err := json.Marshal(user)\nfmt.Println(string(b))\n</code></pre>\n\n<p>It works well.<br>\nNow I want to do two things:<br>\n1) remove the <code>Password</code> from the JSON object<br>\n2) add a new filed: <code>\"code\": 200</code> into the JSON object<br></p>\n\n<p>What should I do?</p>\n"}, {"tags": ["shell", "go", "command-line"], "answers": [{"comments": [{"owner": {"reputation": 1054, "user_id": 4201205, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/7186d11fd2ae12a5da22d2a8e7a684ad?s=128&d=identicon&r=PG&f=1", "display_name": "Constantine", "link": "https://stackoverflow.com/users/4201205/constantine"}, "edited": false, "score": 0, "creation_date": 1508746721, "post_id": 46884484, "comment_id": 80716729, "body": "Yeap, I already used <code>terminal.ReadPassword(0)</code> to hide password. But I need option to use my app in a shell pipeline"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 1054, "user_id": 4201205, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/7186d11fd2ae12a5da22d2a8e7a684ad?s=128&d=identicon&r=PG&f=1", "display_name": "Constantine", "link": "https://stackoverflow.com/users/4201205/constantine"}, "edited": false, "score": 0, "creation_date": 1508747297, "post_id": 46884484, "comment_id": 80717072, "body": "OK so you need to read from std in , then how do you separate file data  from password? it is one input stream, isn&#39;t it? when reading from one stream you need to detect fist data end and second data start, meaning sync header. may be you write a second program like <code>cat</code> which  reads from one file and ask password from std in then send output to std out using formatted frame and sync. I hope this helps."}, {"owner": {"reputation": 333, "user_id": 995368, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hjdrh.png?s=128&g=1", "display_name": "Xavier Nicollet", "link": "https://stackoverflow.com/users/995368/xavier-nicollet"}, "edited": false, "score": 0, "creation_date": 1508747613, "post_id": 46884484, "comment_id": 80717246, "body": "If you&#39;re reading the password from the terminal, it looks like everything is working. Do you still have a problem?"}, {"owner": {"reputation": 1054, "user_id": 4201205, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/7186d11fd2ae12a5da22d2a8e7a684ad?s=128&d=identicon&r=PG&f=1", "display_name": "Constantine", "link": "https://stackoverflow.com/users/4201205/constantine"}, "edited": false, "score": 0, "creation_date": 1508747738, "post_id": 46884484, "comment_id": 80717318, "body": "I forget that while piping, there is no way to interrupt stdin to input password from keyboard. So maybe the option for is just to use filename"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 1, "last_activity_date": 1508745683, "creation_date": 1508745683, "answer_id": 46884484, "question_id": 46883050, "link": "https://stackoverflow.com/questions/46883050/read-from-console-while-piping-commands-in-go/46884484#46884484", "title": "Read from console while piping commands in Go", "body": "<p>Read file and password separately (and don't show password), try this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n\n    \"github.com/howeyc/gopass\"\n)\n\nfunc main() {\n    b, err := ioutil.ReadFile(\"./test_data/test.txt\") // just pass the file name\n    if err != nil {\n        fmt.Print(err)\n    }\n    fmt.Println(string(b))\n\n    fmt.Print(\"Password: \")\n    pass, err := gopass.GetPasswd()\n    if err != nil {\n        log.Fatalln(err)\n    }\n    fmt.Println(string(pass))\n}\n</code></pre>\n\n<p>and <code>go get github.com/howeyc/gopass</code> first.</p>\n"}], "owner": {"reputation": 1054, "user_id": 4201205, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/7186d11fd2ae12a5da22d2a8e7a684ad?s=128&d=identicon&r=PG&f=1", "display_name": "Constantine", "link": "https://stackoverflow.com/users/4201205/constantine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 46884484, "answer_count": 1, "score": 1, "last_activity_date": 1508760268, "creation_date": 1508739545, "last_edit_date": 1508760268, "question_id": 46883050, "link": "https://stackoverflow.com/questions/46883050/read-from-console-while-piping-commands-in-go", "title": "Read from console while piping commands in Go", "body": "<p>I need a way to read input from console twice (1 -from <code>cat</code> outupt, 2 - user inputs password), like this:\n<code>cat ./test_data/test.txt | app account import</code></p>\n\n<p>My current code skips password input:</p>\n\n<pre><code>reader := bufio.NewReader(os.Stdin)\nraw, err := ioutil.ReadAll(reader)\nif err != nil {\n    return cli.NewExitError(err.Error(), 1)\n}\n\nwlt, err := wallet.Deserialize(string(raw))\nif err != nil {\n    return cli.NewExitError(err.Error(), 1)\n}\n\nfmt.Print(\"Enter password: \")\npass := \"\"\nfmt.Fscanln(reader, &amp;pass)\n</code></pre>\n\n<p>Also tried to read password with <code>Scanln</code> - doesn't works.</p>\n\n<p><strong>Note</strong>: \n<code>cat</code> (and piping at all) can't be used with user input, as shell redirects inputs totally.\nSo the most simple solutions are: </p>\n\n<ul>\n<li><p>to pass filename as argument</p></li>\n<li><p>redirect manually app account import &lt; ./test.txt</p></li>\n</ul>\n"}, {"tags": ["json", "dictionary", "go", "marshalling"], "answers": [{"comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 1, "creation_date": 1508733715, "post_id": 46882031, "comment_id": 80711306, "body": "Also, struct fields need to be exported.  The json from this is <code>{&quot;t_user&quot;:{}}</code> because tblSchema and column don&#39;t have exported fields."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 4, "last_activity_date": 1508733988, "last_edit_date": 1508733988, "creation_date": 1508733404, "answer_id": 46882031, "question_id": 46881944, "link": "https://stackoverflow.com/questions/46881944/converting-map-to-json-gives-a-lot-of-integers-in-golang/46882031#46882031", "title": "converting map to json gives a lot of integers in golang", "body": "<p>The </p>\n\n<pre><code>func Marshal(v interface{}) ([]byte, error)\n</code></pre>\n\n<p>returns <code>[]byte</code> so you need to convert it to <code>string</code>:</p>\n\n<pre><code>log.Println(string(jsonString))\n</code></pre>\n\n<hr>\n\n<p>EDIT</p>\n\n<p>This will yield the desired result</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n)\n\ntype Column struct {\n  Field string\n  FieldType string\n}\n\ntype TblSchema struct {\n  Tbl string\n  Columns map[string]Column\n}\nfunc main() {\n    mapper := make(map[string]TblSchema)\n    columns := make(map[string]Column)\n    columns[\"first\"] = Column{Field:\"user_id\",FieldType:\"int(11)\"}\n    mapper[\"t_user\"] = TblSchema{Tbl:\"t_user\",Columns:columns}\n    jsonString, _ := json.Marshal(mapper)\n    log.Println(string(jsonString))\n    log.Println(mapper)\n}\n</code></pre>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3173, "favorite_count": 0, "accepted_answer_id": 46882031, "answer_count": 1, "score": 2, "last_activity_date": 1508733988, "creation_date": 1508732691, "question_id": 46881944, "link": "https://stackoverflow.com/questions/46881944/converting-map-to-json-gives-a-lot-of-integers-in-golang", "title": "converting map to json gives a lot of integers in golang", "body": "<p>I'm trying to convert a map to a JSON string. But my code below seems to yield an array of numbers.</p>\n\n<p>Here is my main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n)\n\ntype column struct {\n  field string\n  fieldType string\n}\n\ntype tblSchema struct {\n  tbl string\n  columns map[string]column\n}\nfunc main() {\n    mapper := make(map[string]tblSchema)\n    columns := make(map[string]column)\n    columns[\"first\"] = column{field:\"user_id\",fieldType:\"int(11)\"}\n    mapper[\"t_user\"] = tblSchema{tbl:\"t_user\",columns:columns}\n    jsonString, _ := json.Marshal(mapper)\n    log.Println(jsonString)\n    //log.Println(mapper)\n}\n</code></pre>\n\n<p>This produces the following output</p>\n\n<pre><code>[123 34 116 95 117 115 101 114 34 58 123 125 125]\n</code></pre>\n\n<p>If I uncomment <code>log.Println(mapper)</code>, I get </p>\n\n<pre><code>map[t_user:{t_user map[first:{user_id int(11)}]}]\n</code></pre>\n\n<p><strong>What am I doing wrong?  I expect jsonString to have the following format</strong></p>\n\n<pre><code>{\n    \"t_user\":{\n        \"tbl\":\"t_user\",\n        \"columns\":{\n            \"first\":{\n                \"field\":\"user_id\",\n                \"fieldType\":\"int(11)\"\n            }\n\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508730698, "post_id": 46881335, "comment_id": 80710563, "body": "&quot;older version of the compiler cannot use cache from 1.9 and had to recompile everything from scratch&quot; Yes."}, {"owner": {"reputation": 9173, "user_id": 172265, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7d658f2c111ae5d8b48f0f0aa7624372?s=128&d=identicon&r=PG", "display_name": "lang2", "link": "https://stackoverflow.com/users/172265/lang2"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508734268, "post_id": 46881335, "comment_id": 80711466, "body": "thanks, how can i clean the cache so?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508743904, "post_id": 46881335, "comment_id": 80715336, "body": "There is no need to clear the cache. Quite the contrary. You should <i>populate</i> your cache with the packages built via 1.8.4 if you want to speed up your builds. But deleting pkg is fine and a good way to start afresh."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508761896, "post_id": 46881335, "comment_id": 80726006, "body": "<code>guru</code> (and all the common tooling) works fine with go1.9+. Update those packages rather than revert Go to an old version."}], "answers": [{"tags": [], "owner": {"reputation": 240, "user_id": 8800369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4f69be8fda374dc3075128df3a05f37?s=128&d=identicon&r=PG", "display_name": "Hein Oldewage", "link": "https://stackoverflow.com/users/8800369/hein-oldewage"}, "is_accepted": false, "score": 1, "last_activity_date": 1508737941, "creation_date": 1508737941, "answer_id": 46882728, "question_id": 46881335, "link": "https://stackoverflow.com/questions/46881335/compilation-slow-down-after-downgrading-go-compiler/46882728#46882728", "title": "compilation slow down after downgrading go compiler", "body": "<p>Delete the folder <code>$GOPATH\\pkg</code>. That is the package cache folder.</p>\n\n<p>If you run the compiler with the <code>-v</code> flag it will list all the packages being compiled. If it keeps compiling the same packages that you have not changed then you know it is not using the cache.</p>\n\n<p>In the past I have found that when compiling code with <code>run</code>/<code>build</code> the compiler does not cache packages, but it does cache them when using <code>install</code>.</p>\n"}], "owner": {"reputation": 9173, "user_id": 172265, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7d658f2c111ae5d8b48f0f0aa7624372?s=128&d=identicon&r=PG", "display_name": "lang2", "link": "https://stackoverflow.com/users/172265/lang2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508737941, "creation_date": 1508727510, "question_id": 46881335, "link": "https://stackoverflow.com/questions/46881335/compilation-slow-down-after-downgrading-go-compiler", "title": "compilation slow down after downgrading go compiler", "body": "<p>I recently got upgraded from Go 1.8.4 to 1.9 without knowing it. Compilation speed wasn't affect (not noticed at least). But I had problem with tools like <code>guru</code>, so I uninstalled 1.9 and re-installed 1.8.4. Afterwards, <code>go run foo.go</code> becomes pretty slow. I'm suspecting that the older version of the compiler cannot use cache from 1.9 and had to recompile everything from scratch - I have no prove.</p>\n\n<p>Is my suspicion correct? If so, is there a way I can reset the compiler cache?</p>\n"}, {"tags": ["json", "parsing", "go"], "answers": [{"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 1, "last_activity_date": 1508727709, "creation_date": 1508727709, "answer_id": 46881351, "question_id": 46881303, "link": "https://stackoverflow.com/questions/46881303/parsing-json-in-golang-for-drawing-polygons/46881351#46881351", "title": "Parsing JSON in Golang for drawing polygons", "body": "<p>You just need your go structure laid out correctly.</p>\n\n<p>Something like this:</p>\n\n<pre><code>type YourType struct {\n    TextAnnotations []struct {\n        BoundingPoly struct {\n            Vertices []struct {\n                X int `json:\"x\"`\n                Y int `json:\"y\"`\n            } `json:\"vertices\"`\n        } `json:\"boundingPoly\"`\n        Description string `json:\"description\"`\n        Locale      string `json:\"locale,omitempty\"`\n    } `json:\"textAnnotations\"`\n}\n</code></pre>\n\n<p>The rest is pretty straight forward: <a href=\"https://play.golang.org/p/ICtREyQyjF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ICtREyQyjF</a></p>\n"}, {"tags": [], "owner": {"reputation": 43, "user_id": 8822663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1911ebd9e0e267c1a697ea57bc6504bf?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/8822663/jacob"}, "is_accepted": false, "score": 0, "last_activity_date": 1508815622, "creation_date": 1508815622, "answer_id": 46901716, "question_id": 46881303, "link": "https://stackoverflow.com/questions/46881303/parsing-json-in-golang-for-drawing-polygons/46901716#46901716", "title": "Parsing JSON in Golang for drawing polygons", "body": "<p>You can auto-generate a Go struct from a JSON example using this tool: <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a></p>\n\n<p>I'm using it every time I need to create a struct for a complex JSON object.</p>\n"}], "owner": {"reputation": 11, "user_id": 7843171, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89d5d2741eefb8bb6a2ea6c78eda77d9?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Depaye", "link": "https://stackoverflow.com/users/7843171/michael-depaye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 46881351, "answer_count": 2, "score": -1, "last_activity_date": 1508815622, "creation_date": 1508727214, "question_id": 46881303, "link": "https://stackoverflow.com/questions/46881303/parsing-json-in-golang-for-drawing-polygons", "title": "Parsing JSON in Golang for drawing polygons", "body": "<p>I'm parsing a large JSON file in Go where I need to take only specific items from the JSON. </p>\n\n<p>It's usually a very large file, but eventually, it becomes this:</p>\n\n<pre><code>\"textAnnotations\": [\n    {\n        \"boundingPoly\": {\n            \"vertices\": [\n                {\n                    \"x\": 136,\n                    \"y\": 119\n                },\n                {\n                    \"x\": 5606,\n                    \"y\": 119\n                },\n                {\n                    \"x\": 5606,\n                    \"y\": 3985\n                },\n                {\n                    \"x\": 136,\n                    \"y\": 3985\n                }\n            ]\n        },\n        \"description\": \"Description\",\n        \"locale\": \"en\"\n    },\n    {\n        \"boundingPoly\": {\n            \"vertices\": [\n                {\n                    \"x\": 3420,\n                    \"y\": 122\n                },\n                {\n                    \"x\": 3439,\n                    \"y\": 122\n                },\n                {\n                    \"x\": 3439,\n                    \"y\": 144\n                },\n                {\n                    \"x\": 3420,\n                    \"y\": 144\n                }\n            ]\n        },\n        \"description\": \"10\"\n    },\n    {\n        \"boundingPoly\": {\n            \"vertices\": [\n                {\n                    \"x\": 4106,\n                    \"y\": 119\n                },\n                {\n                    \"x\": 4128,\n                    \"y\": 119\n                },\n                {\n                    \"x\": 4128,\n                    \"y\": 141\n                },\n                {\n                    \"x\": 4106,\n                    \"y\": 141\n                }\n            ]\n        },\n        \"description\": \"12\"\n    },\n</code></pre>\n\n<p>I need to take the vertices and description of all of the \"boundingPoly\"'s in that are within \"textAnnotations\". I've looked at a few JSON parsing libraries but none seem to do exactly what I'm asking for.</p>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1508737703, "last_edit_date": 1508737703, "creation_date": 1508730714, "answer_id": 46881706, "question_id": 46881150, "link": "https://stackoverflow.com/questions/46881150/golang-http-how-to-route-requests-to-handlers/46881706#46881706", "title": "golang http: how to route requests to handlers", "body": "<p>Unfortunately standard http router not to savvy. There are 2 ways:</p>\n\n<p>Manually check methods, urls and extract usernames. </p>\n\n<p>Use routers from other packages like \n<a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\">https://github.com/gorilla/mux</a></p>\n\n<p>gorilla mix, echo gin-gonic etc</p>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": true, "score": 3, "last_activity_date": 1583670930, "last_edit_date": 1583670930, "creation_date": 1508742296, "answer_id": 46883619, "question_id": 46881150, "link": "https://stackoverflow.com/questions/46881150/golang-http-how-to-route-requests-to-handlers/46883619#46883619", "title": "golang http: how to route requests to handlers", "body": "<p>You may want to run pattern matching on r.URL.Path, using the regex package (in your case you may need it on POST) <a href=\"https://stackoverflow.com/questions/30474313/how-to-use-regexp-get-url-pattern-in-golang\">This post</a> shows some pattern matching samples. As @Eugene suggests there are routers/http utility packages also which can help.</p>\n\n<p>Here's something which can give you some ideas, in case you don't want to use other packages:</p>\n\n<p>In main:    </p>\n\n<pre><code>http.HandleFunc(\"/\", multiplexer)\n...\nfunc multiplexer(w http.ResponseWriter, r *http.Request) {\n    switch r.Method {\n    case \"GET\":\n        getHandler(w, r)\n    case \"POST\":\n        postHandler(w, r)\n    }\n}\n\nfunc getHandler(w http.ResponseWriter, r *http.Request) {\n\n    //Match r.URL.path here as required using switch/use regex on it\n}\n\nfunc postHandler(w http.ResponseWriter, r *http.Request) {\n\n    //Regex as needed on r.URL.Path \n    //and then get the values POSTed\n    name := r.FormValue(\"newname\")\n}\n</code></pre>\n"}], "owner": {"reputation": 8220, "user_id": 3305546, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/G2mbe.png?s=128&g=1", "display_name": "Yves", "link": "https://stackoverflow.com/users/3305546/yves"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3832, "favorite_count": 0, "accepted_answer_id": 46883619, "answer_count": 2, "score": 3, "last_activity_date": 1583670930, "creation_date": 1508725760, "question_id": 46881150, "link": "https://stackoverflow.com/questions/46881150/golang-http-how-to-route-requests-to-handlers", "title": "golang http: how to route requests to handlers", "body": "<p>I'm newbie on Golang and have a simple question about building a web server.<br></p>\n\n<p>Saying that my web server has users so the users can change their names and their passwords. Here is how I design the URLs:<br></p>\n\n<pre><code>/users/Test         GET\n/users/Test/rename       POST   newname=Test2\n/users/Test/newpassword  POST   newpassword=PWD\n</code></pre>\n\n<p>The first line is to show the information of the user named <code>Test</code>. The second and the third is to rename and to reset password.<br></p>\n\n<p>So I'm thinking that I need to use some regular expression to match the HTTP requests, things like <code>http.HandleFunc(\"/users/{\\w}+\", controller.UsersHandler)</code>.<br></p>\n\n<p>However, it doesn't seem that Golang supports such a thing. So does it mean that I have to change my design? For example, to show the information of the user <code>Test</code>, I have to do <code>/users   GET   name=Test</code>?</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 458, "user_id": 724872, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/8ARkU.jpg?s=128&g=1", "display_name": "cxwangyi", "link": "https://stackoverflow.com/users/724872/cxwangyi"}, "edited": false, "score": 0, "creation_date": 1542682367, "post_id": 46880695, "comment_id": 93646936, "body": "I tried the above code as of Nov 19, 2018. It works well. I suspect that the problem reported was due to a bug in an old version."}], "answers": [{"tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": false, "score": 0, "last_activity_date": 1508724592, "creation_date": 1508724592, "answer_id": 46881034, "question_id": 46880695, "link": "https://stackoverflow.com/questions/46880695/golang-mysql-describe-table-causes-driver-value-type-nil-error/46881034#46881034", "title": "golang mysql DESCRIBE table causes driver.Value type nil error", "body": "<p>Index 4 is the <code>Default</code> column, which is nullable. You are giving it the address to place a string, but it needs to place NULL. The solution would be to use something like <code>sql.NullString</code> instead of just a string.</p>\n"}, {"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": false, "score": 0, "last_activity_date": 1509909947, "last_edit_date": 1509909947, "creation_date": 1508739148, "answer_id": 46882962, "question_id": 46880695, "link": "https://stackoverflow.com/questions/46880695/golang-mysql-describe-table-causes-driver-value-type-nil-error/46882962#46882962", "title": "golang mysql DESCRIBE table causes driver.Value type nil error", "body": "<p>As <code>Gavin</code> mentioned,</p>\n\n<p>you need to use a type that handles null values such as <a href=\"https://golang.org/pkg/database/sql/#NullString\" rel=\"nofollow noreferrer\"><code>sql.NullString</code></a>.</p>\n\n<p>As an alternative you can also have a new type that implements the <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"nofollow noreferrer\"><code>db.Scanner</code></a> interface that handles nulls.</p>\n\n<pre><code>type dbNullString string\n\nfunc (v *dbNullString) Scan(value interface{}) error {\n\n    if value == nil {\n        *v = \"\"\n        return nil\n    }\n\n    if str, ok := value.(string); ok {\n        *v = dbNullString(str)\n        return nil\n    }\n\n    return errors.New(\"failed to scan dbNullString\")\n}\n</code></pre>\n\n<p>Also note that you need to implement the <a href=\"https://golang.org/pkg/database/sql/driver/#Valuer\" rel=\"nofollow noreferrer\"><code>driver.Valuer</code></a> interface to insert values using this type.</p>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 585, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1509909947, "creation_date": 1508721061, "question_id": 46880695, "link": "https://stackoverflow.com/questions/46880695/golang-mysql-describe-table-causes-driver-value-type-nil-error", "title": "golang mysql DESCRIBE table causes driver.Value type nil error", "body": "<p>I'm taking my first crack at using golang to query a MySQL database but I get the following error when I run the command <code>go run main.go</code>.  </p>\n\n<blockquote>\n  <p>2017/10/22 21:06:58 sql: Scan error on column index 4: unsupported\n  Scan, storing driver.Value type  into type *string exit status 1</p>\n</blockquote>\n\n<p>Here's my main.go</p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"database/sql\"\n)\n\nimport _ \"github.com/go-sql-driver/mysql\"\n\nvar db *sql.DB\nvar err error\n\n// main function to boot up everything\nfunc main() {\n\n    var dbField,dbType,dbNull,dbKey,dbDefault,dbExtra string\n\n    // Create an sql.DB and check for errors\n    db, err = sql.Open(\"mysql\", \"username:password@/mydatabase\")\n    if err != nil {\n        panic(err.Error())\n    }\n    rows, err := db.Query(\"DESCRIBE t_user\")\n    if err != nil {\n      log.Fatal(err)\n    }\n    defer rows.Close()\n    for rows.Next() {\n      err := rows.Scan(&amp;dbField,&amp;dbType,&amp;dbNull,&amp;dbKey,&amp;dbDefault,&amp;dbExtra)\n      if err != nil {\n        log.Fatal(err)\n      }\n      log.Println(dbField,dbType,dbNull,dbKey,dbDefault,dbExtra)\n    }\n    err = rows.Err()\n    if err != nil {\n      log.Fatal(err)\n    }\n    // sql.DB should be long lived \"defer\" closes it once this function ends\n    defer db.Close()\n\n}\n</code></pre>\n\n<p>When I run the <code>DESCRIBE t_user</code> from mysql terminal, I get these results:</p>\n\n<pre><code>+------------------------+---------------------+------+-----+---------+----------------+\n| Field                  | Type                | Null | Key | Default | Extra          |\n+------------------------+---------------------+------+-----+---------+----------------+\n| user_id                | int(11) unsigned    | NO   | PRI | NULL    | auto_increment |\n| first_name             | varchar(50)         | NO   |     | NULL    |                |\n| middle_name            | varchar(50)         | NO   |     | NULL    |                |\n| last_name              | varchar(50)         | NO   |     | NULL    |                |\n| email                  | varchar(50)         | NO   | UNI | NULL    |                |\n+------------------------+---------------------+------+-----+---------+----------------+\n</code></pre>\n\n<p>I can't seem to figure out what's causing the issue.  Is it because the columns key, default, extra sometimes returns empty string or null values?  I tried to do something like <code>var dbNull nil</code> but the compiler says <code>nil</code> is not a type, so if the issue is related to <code>dbNull</code> needing to accept nullable values, how does golang address this situation?  If that isn't the problem, I appreciate any other insight</p>\n"}, {"tags": ["database", "unit-testing", "generics", "go"], "comments": [{"owner": {"reputation": 1145, "user_id": 2872038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y9bqQ.jpg?s=128&g=1", "display_name": "Joshua Jones", "link": "https://stackoverflow.com/users/2872038/joshua-jones"}, "edited": false, "score": 0, "creation_date": 1508715514, "post_id": 46880158, "comment_id": 80707597, "body": "Perhaps the function should receive a supplier function as its argument. That is, a function that has no arguments and returns the required resource type, such as a user or credential."}], "answers": [{"tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": true, "score": 3, "last_activity_date": 1508725332, "last_edit_date": 1508725332, "creation_date": 1508724751, "answer_id": 46881051, "question_id": 46880158, "link": "https://stackoverflow.com/questions/46880158/how-to-write-database-agnostic-functions-to-make-them-easier-to-unit-test/46881051#46881051", "title": "How to write database-agnostic functions to make them easier to unit-test", "body": "<p>You would want to use an interface here. A common pattern used to abstract away where the data comes from is the repository pattern. <a href=\"http://manuel.kiessling.net/2012/09/28/applying-the-clean-architecture-to-go-applications/\" rel=\"nofollow noreferrer\">Here</a> is an article where you can read about the repository pattern and other tips for developing well-written Go applications.</p>\n\n<pre><code>package user\n\ntype User struct {\n    ID int64\n    Name string\n}\n\ntype Repository interface {\n    Find(id int64) (*User, error)\n    Store(u *User) error\n}\n\nfunc ChangeUserName(id int64, name string, r Repository) error {\n    u, err := r.Find(id)\n    if err != nil {\n        return err\n    }\n\n    u.Name = name\n    err = r.Store(u)\n    return err\n}\n</code></pre>\n\n<p>Now you are able to pass in any struct with the methods matching your <code>user.Repository</code> interface. For example:</p>\n\n<pre><code>package mysql\n\ntype DB struct {\n    *sql.DB\n}\n\nfunc New(db *sql.DB) *DB {\n    return DB{db}\n}\n\nfunc (d *DB) Find(id int64) (*user.User, error) {\n    // mysql stuff to find user\n}\n\nfunc (d *DB) Store(u *user.User) error {\n    // mysql stuff to store user\n}\n</code></pre>\n\n<p>then ...</p>\n\n<pre><code>package main\n\nfunc main() {\n    // ...\n    // conn := code to open *sql.DB connection\n    db := mysql.New(conn)\n    err := user.ChangeUserName(1, 'bob', db)\n    // ...\n}\n</code></pre>\n\n<p>You can now also use a mock to test your function.</p>\n\n<pre><code>package mocks\n\ntype UserRepository struct {\n    Users []*user.User\n    ShouldError bool\n}\n\nfunc (r *UserRepository) Find(id int64) (*user.User, error) {\n    if r.ShouldError {\n        return nil, errors.New(\"\")\n    }\n    for _, u := range r.Users {\n        if u.ID == id {\n            return u\n        }\n    }\n    return errors.New(\"user not found\")\n}\n\nfunc (r *UserRepository) Store(u *user.User) error {\n    if r.ShouldError {\n        return errors.New(\"\")\n    }\n    r.Users = append(r.Users, u)\n    return nil\n}\n</code></pre>\n\n<p>then to test...</p>\n\n<pre><code>func Test_ChangeUserName_Stores_Changed_User(t *testing.T) {\n    u := &amp;user.User{ID: 1, Name: 'Bob'}\n    r := mocks.UserRepository{Users: []*user.User{u}}\n    err := user.ChangeUserName(1, 'Fred', r)\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 8611814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/522f4d072ff54133672317d232471011?s=128&d=identicon&r=PG&f=1", "display_name": "lovo-h", "link": "https://stackoverflow.com/users/8611814/lovo-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 611, "favorite_count": 2, "accepted_answer_id": 46881051, "answer_count": 1, "score": 0, "last_activity_date": 1575378275, "creation_date": 1508715040, "last_edit_date": 1575378275, "question_id": 46880158, "link": "https://stackoverflow.com/questions/46880158/how-to-write-database-agnostic-functions-to-make-them-easier-to-unit-test", "title": "How to write database-agnostic functions to make them easier to unit-test", "body": "<p><strong>TLDR</strong>: What's the best way of unit-testing a function that uses a database as its datasource but that the datasource does not have to be a database (that is, the function isn't aware of where the data is coming from. e.g. it can be an object, etc.)?</p>\n\n<p>=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</p>\n\n<p>I'm trying to find out what's the best practice for unit-testing functions that use a database as its datasource - which is passed through its parameter - but that the datasource does not have to be a database (e.g. it can be an object, etc.). The reason I add the clause, \"that the datasource does not have to be a database,\" is because I don't want to use a database during unit-tests. So, how do I write a function that is database-agnostic?</p>\n\n<p>One possible approach is to provide an \"env\" parameter that holds the datasource, like so:</p>\n\n<pre><code>type Env struct {\n    DataSource  interface{}\n}\n\nfunc FunctionToTest(env Env) {\n    switch et := (env.DataSource).(type) {\n    case UserDatasource:\n        userSource := (env.DataSource).(UserDatasource)\n        user := userSource.getUser()\n    default:\n        // Throw error\n    }\n}\n\nfunc FunctionToTest2(env Env) {\n    switch et := (env.DataSource).(type) {\n    case CredentialsDatasource:\n        credentialSource := (env.DataSource).(CredentialsDatasource)\n        password := credentialSource.getPassword()\n    default:\n        // Throw error\n    }\n}\n</code></pre>\n\n<p>The issue with this is that it seems \"hacky\" and it feels like there exists a better solution. The reason I want to learn how to do this is so that I can write unit-tests that mock the database.</p>\n\n<p>I appreciate any and all input.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["json", "rest", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 5, "creation_date": 1508714081, "post_id": 46880034, "comment_id": 80707311, "body": "The file is not valid JSON because the object member names are not quoted strings.  Also, you can simply copy the file to the response. There&#39;s no need decode / encode."}, {"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1508714347, "post_id": 46880034, "comment_id": 80707367, "body": "awesome, putting quotes around all the keys in the file.json did the job"}], "answers": [{"tags": [], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "is_accepted": true, "score": 0, "last_activity_date": 1508940299, "creation_date": 1508940299, "answer_id": 46934586, "question_id": 46880034, "link": "https://stackoverflow.com/questions/46880034/output-a-simple-json-file-to-a-rest-api-with-golang/46934586#46934586", "title": "Output a simple json file to a rest api with golang", "body": "<p>As cerise mentioned, it's just formatting error in the JSON file.  Must quote all properties.</p>\n\n<p>Then the rest of the code works</p>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1623, "favorite_count": 0, "accepted_answer_id": 46934586, "answer_count": 1, "score": -2, "last_activity_date": 1508940299, "creation_date": 1508713802, "question_id": 46880034, "link": "https://stackoverflow.com/questions/46880034/output-a-simple-json-file-to-a-rest-api-with-golang", "title": "Output a simple json file to a rest api with golang", "body": "<p>This is my first go project.  All I want to do is read a file.json on my server, then make it available to others via a REST API. But I'm getting errors.  Here's what I have so far.</p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"github.com/gorilla/mux\"\n    \"log\"\n    \"net/http\"\n    \"io/ioutil\"\n    \"fmt\"\n)\n\nfunc GetDetail(w http.ResponseWriter, r *http.Request) {\n\n    b,_ := ioutil.ReadFile(\"file.json\");\n\n    rawIn := json.RawMessage(string(b))\n    var objmap map[string]*json.RawMessage\n    err := json.Unmarshal(rawIn, &amp;objmap)\n    if err != nil {\n      fmt.Println(err)\n    }\n    fmt.Println(objmap)\n\n    json.NewEncoder(w).Encode(objmap)\n}\n\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/detail\", GetDetail).Methods(\"GET\")\n\n    log.Fatal(http.ListenAndServe(\":8000\", router))\n}\n</code></pre>\n\n<p>file.json</p>\n\n<pre><code>{\n  favourite_color:\"blue\",\n  attribute:{density:23,allergy:\"peanuts\",locations:[\"USA\",\"Canada\",\"Jamaica\"]},\n  manufacture_year:1998\n}\n</code></pre>\n\n<p>When I run <code>go build; ./sampleproject</code>, then go to my web browser at <code>http://localhost:8000/detail</code>, I get the error message:</p>\n\n<blockquote>\n  <p>invalid character 'f' looking for beginning of object key string\n  map[]</p>\n</blockquote>\n\n<p>I've tried a few marshal methods, but they all give me different errors.  I just need a working example to study from to better understand how all this works.</p>\n\n<p>I should also mention that file.json does not have a fixed schema.  It can change drastically at any minute to have a random set of data.</p>\n\n<p>How do I get around the error invalid character f message and get my file.json to render at <code>http://localhost:8000/detail</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1508705515, "post_id": 46879020, "comment_id": 80705096, "body": "Please post a complete example: <a href=\"https://stackoverflow.com/help/mcve\">mcve</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508706847, "post_id": 46879020, "comment_id": 80705528, "body": "You&#39;re reading fixed size data for the filename, just call <code>Read</code>with the correct size slice."}], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1508708893, "post_id": 46879165, "comment_id": 80706130, "body": "In this case, <code>filename := bytes.NewBuffer(make([]byte, 0, filenameSize))</code>, a precise allocation, is more efficient than <code>var filename bytes.Buffer</code>."}], "tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": false, "score": 2, "last_activity_date": 1508706261, "creation_date": 1508706261, "answer_id": 46879165, "question_id": 46879020, "link": "https://stackoverflow.com/questions/46879020/unwanted-spaces-added-to-strings-sent-over-tcp/46879165#46879165", "title": "Unwanted spaces added to strings sent over TCP", "body": "<p>The line in the server handler</p>\n\n<pre><code>filename := bytes.NewBuffer(make([]byte, filenameSize))\n</code></pre>\n\n<p>is wrong, repace it by</p>\n\n<pre><code>var filename bytes.Buffer\n</code></pre>\n\n<p>The expression <code>make([]byte, filenameSize)</code> creates an slice with initial\n<em>length</em> <code>filenameSize</code> filled with the null value of type <code>byte</code>, so <code>0</code>. <code>bytes.NewBuffer</code> creates a buffer with initial contents of this slice and will append to this. So you don't receive to much, you start with too much.</p>\n\n<p>See <a href=\"https://golang.org/ref/spec#Making_slices_maps_and_channels\" rel=\"nofollow noreferrer\">golang language spec</a>\nfor <code>make</code>.\nSee <a href=\"https://golang.org/pkg/bytes/#NewBuffer\" rel=\"nofollow noreferrer\">package bytes doc</a> about <code>bytes.newBuffer</code>, it explicitly states that you need <em>length</em> zero but positive <em>capacity</em> if you intend to hand a buffer for some preallocation scheme.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1508708022, "last_edit_date": 1508708022, "creation_date": 1508707690, "answer_id": 46879330, "question_id": 46879020, "link": "https://stackoverflow.com/questions/46879020/unwanted-spaces-added-to-strings-sent-over-tcp/46879330#46879330", "title": "Unwanted spaces added to strings sent over TCP", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Allocation\" rel=\"nofollow noreferrer\">Allocation</a></p>\n  \n  <p>Making slices, maps and channels</p>\n\n<pre><code>Call             Type T     Result\n\nmake(T, n)       slice      slice of type T with length n and capacity n\nmake(T, n, m)    slice      slice of type T with length n and capacity m\n</code></pre>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/bytes/\" rel=\"nofollow noreferrer\">Package bytes</a></p>\n\n<pre><code>import \"bytes\"\n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/bytes/#NewBuffer\" rel=\"nofollow noreferrer\">func NewBuffer</a></p>\n  \n  <p>func NewBuffer(buf []byte) *Buffer</p>\n  \n  <p>NewBuffer creates and initializes a new Buffer using buf as its\n  initial contents. The new Buffer takes ownership of buf, and the\n  caller should not use buf after this call. NewBuffer is intended to\n  prepare a Buffer to read existing data. It can also be used to size\n  the internal buffer for writing. To do that, buf should have the\n  desired capacity but a length of zero.</p>\n  \n  <p>In most cases, new(Buffer) (or just declaring a Buffer variable) is\n  sufficient to initialize a Buffer.</p>\n</blockquote>\n\n<hr>\n\n<p><code>bytes.NewBuffer</code> can be used to size the internal buffer for writing. To do that, buf should have the desired capacity but a length of zero. For example, with a length of zero and a capacity of filenameSize,</p>\n\n<pre><code>filename := bytes.NewBuffer(make([]byte, 0, filenameSize))\n</code></pre>\n\n<p>In error, you allocated buf with a length and capacity of filenameSize,</p>\n\n<pre><code>filename := bytes.NewBuffer(make([]byte, filenameSize))\n</code></pre>\n"}], "owner": {"reputation": 2162, "user_id": 3204212, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/fd870d2b3afe56cd9c59c28c0fc715bd?s=128&d=identicon&r=PG&f=1", "display_name": "GreenTriangle", "link": "https://stackoverflow.com/users/3204212/greentriangle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 1, "accepted_answer_id": 46879330, "answer_count": 2, "score": 0, "last_activity_date": 1508708022, "creation_date": 1508705227, "last_edit_date": 1508705541, "question_id": 46879020, "link": "https://stackoverflow.com/questions/46879020/unwanted-spaces-added-to-strings-sent-over-tcp", "title": "Unwanted spaces added to strings sent over TCP", "body": "<p>I'm attempting to learn Go, and the first thing I've tried is sending files between a client and server using TCP. I set up a connection using <code>net.Listen</code>, and connect using <code>net.Dial</code>. My client logic is:</p>\n\n<ol>\n<li>Send an int64 using <code>binary.Write</code> describing the size of the filename</li>\n<li>Send the filename using <code>io.WriteString</code></li>\n<li>Send an int64 describing the size of the file</li>\n<li>Send the file using <code>io.CopyN</code></li>\n</ol>\n\n<p>My server logic is:</p>\n\n<ol>\n<li>Read 8 bytes using <code>binary.Read</code>, save as <code>N</code></li>\n<li>Read <code>N</code> bytes to get the filename, which is read into a <code>bytes.NewBuffer(make([]byte, filenameSize))</code> that has <code>String()</code> subsequently called on it</li>\n<li>Read 8 bytes to get the filesize, save as <code>M</code></li>\n<li><code>io.CopyN</code> from the connection into a new file object for <code>M</code> bytes.</li>\n</ol>\n\n<p>My problem is something totally baffling to me, which I haven't been able to solve or understand, and for which I can find no discussion or solution on Google or SO: even though the filename length is transmitted accurately, the server always receives a filename of twice the expected length, where the first half is whitespace. Even more bafflingly, using <code>strings.TrimLeft(filename, \" \")</code> never works, even though it works for strings I create myself. </p>\n\n<p>So I have absolutely no idea what's going on, and nothing in the docs, SO, Google, go-nuts, etc mentions anything that could seem relevant. No idea how to move forward or think about this problem, I'd love some help.</p>\n\n<p>My server handler:</p>\n\n<pre><code>func handle(conn net.Conn) {\n    defer conn.Close()\n    conn.SetReadDeadline(time.Now().Add(time.Second * 30))\n\n    var filenameSize int64\n    err := binary.Read(conn, binary.LittleEndian, &amp;filenameSize)\n    check(err)\n\n    filename := bytes.NewBuffer(make([]byte, filenameSize))\n    bytesRead, err := io.CopyN(filename, conn, filenameSize)\n    fmt.Printf(\"Expected %d bytes for filename, read %d bytes\\n\", filenameSize, bytesRead)\n    str := filename.String()\n    fmt.Println(strings.TrimLeft(str, \" \"))\n\n    var filesize int64\n    err = binary.Read(conn, binary.LittleEndian, &amp;filesize)\n    check(err)\n    fmt.Printf(\"Expecting %d bytes in file\\n\", filesize)\n\n    f, err := os.Create(str)\n    check(err)\n    bytesWritten, err := io.CopyN(f, conn, filesize)\n    check(err)\n    fmt.Printf(\"Transfer complete, expected %d bytes, wrote %d bytes\", filesize, bytesWritten)\n    if filesize != bytesWritten {\n        fmt.Printf(\"ERROR! File doesn't match expected size!\")\n    }\n}\n</code></pre>\n\n<p>My client:</p>\n\n<pre><code>func main() {\n    name := \"test_file.doc\"\n\n    conn, err := net.Dial(\"tcp\", \"localhost:8250\")\n    check(err)\n\n    length := int64(len(name))\n    err = binary.Write(conn, binary.LittleEndian, length)\n    check(err)\n\n    bytes, err := io.WriteString(conn, name)\n    check(err)\n    if bytes != len(name) {\n        fmt.Printf(\"Error! Wrote %d bytes but length of name is %d!\\n\", bytes, length)\n    }\n\n    f, err := os.Open(name)\n    check(err)\n\n    stat, err := f.Stat()\n    check(err)\n\n    filesize := stat.Size()\n    err = binary.Write(conn, binary.LittleEndian, filesize)\n    check(err)\n\n    bytesWritten, err := io.CopyN(conn, f, filesize)\n    check(err)\n    if bytesWritten != filesize {\n        fmt.Printf(\"Error! Wrote %d bytes but length of file is %d!\\n\", bytes, stat.Size())\n    }\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "docker-api"], "comments": [{"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1508745425, "post_id": 46878793, "comment_id": 80716020, "body": "Instead of build first try to run a basic command like getting container list. This seems to be an issue with connecting to docker daemon itself, rather than the build part. First figure out whether its a connection issue or a specific API parameter issue"}, {"owner": {"reputation": 57, "user_id": 1825212, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f91bd72dbbcdeb6f9da80cc960af4d6e?s=128&d=identicon&r=PG", "display_name": "mkreder", "link": "https://stackoverflow.com/users/1825212/mkreder"}, "reply_to_user": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1508799178, "post_id": 46878793, "comment_id": 80746511, "body": "Thanks for your suggestion, I just tried that and other method like ImagePull and ContainerCreate and those are working ok. My problem seems to be isolated to ImageBuild"}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1508825245, "post_id": 46878793, "comment_id": 80753130, "body": "If you see the error, the issue seems you are hitting API version v1.34 while you should be hitting v1.24, try using <code>func NewClient(host string, version string, client *http.Client, httpHeaders map[string]string) (*Client, error)</code> by specifying version. Also check if you can use <a href=\"https://github.com/moby/moby/blob/9be245f438f9fb2eaeb7891673b16aed9262a192/integration-cli/request/request.go#L329\" rel=\"nofollow noreferrer\">github.com/moby/moby/blob/&hellip;</a>"}], "owner": {"reputation": 57, "user_id": 1825212, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f91bd72dbbcdeb6f9da80cc960af4d6e?s=128&d=identicon&r=PG", "display_name": "mkreder", "link": "https://stackoverflow.com/users/1825212/mkreder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 694, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1508703710, "creation_date": 1508703710, "question_id": 46878793, "link": "https://stackoverflow.com/questions/46878793/golang-docker-api-reports-invalid-argument-while-hitting-imagebuild", "title": "Golang Docker API reports invalid argument while hitting ImageBuild", "body": "<p>I have the following code to build an image from a .tar file that contains a Dockerfile.</p>\n\n<pre><code>os.MkdirAll(\"configs/container\",0755)\ntar := new(archivex.TarFile)\ntar.Create(\"configs/container/conf.tar\")\ntar.AddAll(\"configs/configdir\", false)\ntar.Close()\n\ndockerBuildContext, err := os.Open(\"config/dns/conf.tar\")\ndefer dockerBuildContext.Close()\n\n\nbuildOptions := types.ImageBuildOptions{\n        Context:    dockerBuildContext,\n        CPUSetCPUs:   \"2\",\n        CPUSetMems:   \"12\",\n        CPUShares:    20,\n        CPUQuota:     10,\n        CPUPeriod:    30,\n        Memory:       256,\n        MemorySwap:   512,\n        ShmSize:      10,\n        CgroupParent: \"cgroup_parent\",\n        Dockerfile:   \"Dockerfile\", // optional, is the default\n        Tags:   []string{\"coolimage\"},\n    }\n\ncli, err := client.NewEnvClient()\n\nbuildResponse, err := cli.ImageBuild(context.Background(), dockerBuildContext, buildOptions)\nif err != nil {\n        log.Printf(\"%s\", err.Error())\n}\nif err != nil { \n    log.Fatal(err)\n}\nresponse, err := ioutil.ReadAll(buildResponse.Body) \nlog.Printf(string(response))\n\ndefer buildResponse.Body.Close()\n</code></pre>\n\n<p>However, this is returning the following error:</p>\n\n<pre><code>2017/10/22 13:57:42 error during connect: Post http://%2Fvar%2Frun%2Fdocker.sock/v1.34/build?buildargs=null&amp;cachefrom=null&amp;cgroupparent=cgroup_parent&amp;cpuperiod=30&amp;cpuquota=10&amp;cpusetcpus=2&amp;cpusetmems=12&amp;cpushares=20&amp;dockerfile=Dockerfile&amp;labels=null&amp;memory=256&amp;memswap=512&amp;networkmode=&amp;rm=0&amp;shmsize=10&amp;t=dnsimage&amp;target=&amp;ulimits=null: invalid argument\n</code></pre>\n\n<p>I tried to remove all BuildOptions and only leave the \"Dockerfile\" option but same error still appears. I always get invalid argument.</p>\n\n<p>I tried all ways showed on this <a href=\"https://stackoverflow.com/questions/38804313/build-docker-image-from-go-code\">question</a></p>\n\n<p>I am running Docker on Mac but I also tried in an EC2 instance running CentOS and got the same result.</p>\n\n<pre><code>Client:\nVersion:         1.12.6\nAPI version:     1.24\nPackage version: docker-1.12.6-55.gitc4618fb.el7.centos.x86_64\nGo version:      go1.8.3\nGit commit:      c4618fb/1.12.6\nBuilt:           Thu Sep 21 22:33:52 2017\nOS/Arch:         linux/amd64\n\nServer:\nVersion:         1.12.6\nAPI version:     1.24\nPackage version: docker-1.12.6-55.gitc4618fb.el7.centos.x86_64\nGo version:      go1.8.3\nGit commit:      c4618fb/1.12.6\nBuilt:           Thu Sep 21 22:33:52 2017\nOS/Arch:         linux/amd64\n</code></pre>\n\n<p>No errors appear on docker.log or journalctl\nI also tried with both github.com/docker/docker/client and github.com/moby/moby/client</p>\n"}, {"tags": ["go", "compilation", "conditional-compilation"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1508694643, "post_id": 46877006, "comment_id": 80701532, "body": "Use filenames of the form &quot;whatever_linux.go&quot; or &quot;whatever_darwin.go&quot; (or whatever_windows.go&quot; or build tags."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508699630, "post_id": 46877006, "comment_id": 80703305, "body": "For reference: <a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"nofollow noreferrer\">Build Constraints</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 0, "creation_date": 1508871437, "post_id": 46913980, "comment_id": 80783467, "body": "can I use the same main.go file? Like in main.go it imports the Gui library and makes one call to it if Gui flag is on. So on linux I keep commenting out those two lines in main. The import and the call. With your solution, can I still use just 1 main.go file?"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "reply_to_user": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 0, "creation_date": 1508907812, "post_id": 46913980, "comment_id": 80795498, "body": "No, you would have to use a <code>main_linux.go</code> and one <code>main_darwin.go</code> where your OS-specific code resides. They could be as easy as just having your bool variablel declared in each one, once true and once false. Then you can still have the <code>main.go</code> with all the main logic."}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 1, "last_activity_date": 1508857542, "creation_date": 1508857542, "answer_id": 46913980, "question_id": 46877006, "link": "https://stackoverflow.com/questions/46877006/how-do-i-exclude-a-go-library-from-compilation-on-linux-but-not-mac-windows/46913980#46913980", "title": "how do I exclude a go library from compilation on linux but not Mac/windows?", "body": "<p>If you want to exclude specific Go files from building on certain operating system, architectures, Go versions or if certain tags are specified during compilation, these are your options:</p>\n\n<ol>\n<li><p>If you want a file to only build on Linux, append <code>_linux</code> to the file name, e.g. <code>gui_linux.go</code>. It is also possible to specify an architecture, or both, e.g. <code>gui_windows_amd64.go</code>.</p></li>\n<li><p>Add a <code>//+build ...</code> comment at the top of your Go file, e.g. <code>// +build linux,386</code>.</p></li>\n</ol>\n\n<p>See <a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"nofollow noreferrer\">https://golang.org/pkg/go/build/#hdr-Build_Constraints</a> for details.</p>\n"}], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 46913980, "answer_count": 1, "score": -2, "last_activity_date": 1508857542, "creation_date": 1508692747, "question_id": 46877006, "link": "https://stackoverflow.com/questions/46877006/how-do-i-exclude-a-go-library-from-compilation-on-linux-but-not-mac-windows", "title": "how do I exclude a go library from compilation on linux but not Mac/windows?", "body": "<p>I use</p>\n\n<p>import \"github.com/dontpanic92/wxGo/wx\"</p>\n\n<p>in a program that can run with or without a GUI.</p>\n\n<p>i.e. you might run it like:</p>\n\n<p>./program --gui true</p>\n\n<p>or</p>\n\n<p>./program --gui false</p>\n\n<p>When running on linux with gui false I'd like to avoid having to compile all of wxGo/wx.</p>\n\n<p>How can I check in the same code to git so that it will compile on Mac or linux just fine.</p>\n\n<p>i.e. right now when I compile on linux I have to comment out any reference to wxGo/wx</p>\n"}, {"tags": ["ruby", "go", "libsodium", "scrypt", "nacl-cryptography"], "answers": [{"tags": [], "owner": {"reputation": 1755, "user_id": 352648, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ff97ca87af59ee68ceff5877a8365788?s=128&d=identicon&r=PG", "display_name": "Jarmo Pertman", "link": "https://stackoverflow.com/users/352648/jarmo-pertman"}, "is_accepted": false, "score": 5, "last_activity_date": 1537812322, "last_edit_date": 1537812322, "creation_date": 1508701049, "answer_id": 46878357, "question_id": 46876925, "link": "https://stackoverflow.com/questions/46876925/unable-to-create-same-scrypt-digest-between-ruby-s-and-go-s-implementations/46878357#46878357", "title": "Unable to create same scrypt digest between Ruby-s and Go-s implementations", "body": "<p>Managed to calculate <em>N</em>, <em>p</em> and <em>r</em> from <em>opslimit</em> and <em>memlimit</em> by looking into libsodium's function <a href=\"https://github.com/jedisct1/libsodium/blob/master/src/libsodium/crypto_pwhash/scryptsalsa208sha256/pwhash_scryptsalsa208sha256.c#L19\" rel=\"nofollow noreferrer\">pickparams</a>, which was called by <em>crypto_pwhash_scryptsalsa208sha256</em>, which in turn was called by Ruby's scrypt implementation at RbNaCl.</p>\n\n<p>Here's the relevant code to convert <em>opslimit</em> and <em>memlimit</em> to appropriate <em>N</em>, <em>p</em> and <em>r</em> to be used by other scrypt implementations, which offer lower level API for scrypt if anyone else needs it in the future:\n<a href=\"https://gist.github.com/jarmo/22f871076ff70e39b54e69c6305c020f\" rel=\"nofollow noreferrer\">https://gist.github.com/jarmo/22f871076ff70e39b54e69c6305c020f</a></p>\n\n<p>Just change <em>opslimit</em> and <em>memlimit</em> variable values in <em>main</em> and compile it with gcc and run it to get values for <em>N</em>, <em>r</em> and <em>p</em>.</p>\n\n<p>All in all the problem was that Go exposes lower level API than RbNaCl even though they are doing the same thing.</p>\n"}], "owner": {"reputation": 1755, "user_id": 352648, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ff97ca87af59ee68ceff5877a8365788?s=128&d=identicon&r=PG", "display_name": "Jarmo Pertman", "link": "https://stackoverflow.com/users/352648/jarmo-pertman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1537812322, "creation_date": 1508692273, "last_edit_date": 1508701245, "question_id": 46876925, "link": "https://stackoverflow.com/questions/46876925/unable-to-create-same-scrypt-digest-between-ruby-s-and-go-s-implementations", "title": "Unable to create same scrypt digest between Ruby-s and Go-s implementations", "body": "<p>I'm having a problem of calculating the same scrypt digest between <a href=\"https://github.com/cryptosphere/rbnacl/\" rel=\"nofollow noreferrer\">RbNaCl</a> and <a href=\"https://github.com/golang/crypto/blob/master/scrypt/scrypt.go#L227\" rel=\"nofollow noreferrer\">Go's implementation</a>.</p>\n\n<p>Here's how I'm generating key with rbnacl:</p>\n\n<pre><code>opslimit = 2**20\nmemlimit = 2**24\ndigest_size = 32\n\ndigest = RbNaCl::PasswordHash.scrypt(\n        password,\n        salt,\n        opslimit,\n        memlimit,\n        digest_size\n)\n</code></pre>\n\n<p><em>opslimit</em> and <em>memlimit</em> parameter values have been found from <a href=\"https://github.com/cryptosphere/rbnacl/blob/d443d94fc7addc35d7ad519830b9380523551d88/lib/rbnacl/password_hash/scrypt.rb#L33-L34\" rel=\"nofollow noreferrer\">documentation</a>.</p>\n\n<p>Here's my attempt to replicate same results with Go:</p>\n\n<pre><code>N := 32768\nr := 8\np := 1\nkeyLength := 32\n\nsecretKeyBytes, _ := scrypt.Key(password, salt, N, r, p, keyLength)\n</code></pre>\n\n<p>Values for <em>N</em>, <em>r</em>, <em>p</em> and <em>keyLength</em> gotten from <a href=\"https://godoc.org/golang.org/x/crypto/scrypt#Key\" rel=\"nofollow noreferrer\">documentation</a>.</p>\n\n<p><em>password</em> and <em>salt</em> have same values.</p>\n\n<p>I'm not a cryptographer, but as far as I understand there should be same cost factor values to get the same digest? The problem here is that since both implementations take different count of parameters it's hard for me to find the correct combination too. Any ideas how to make cost factors match between these two implementations so that I could calculate same scrypt hashes between two programming languages?</p>\n"}, {"tags": ["json", "go", "struct", "unmarshalling"], "answers": [{"tags": [], "owner": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "is_accepted": true, "score": 2, "last_activity_date": 1508687205, "creation_date": 1508687205, "answer_id": 46876019, "question_id": 46875811, "link": "https://stackoverflow.com/questions/46875811/golang-struct-only-partially-unmarshalled-from-json/46876019#46876019", "title": "golang struct only partially unmarshalled from json", "body": "<p>In your JSON, you have a typo (an extra colon). You call the field in question <code>\"Id:\"</code> instead of <code>\"Id\"</code>. Remove the <code>:</code> and the code should work! </p>\n\n<p>Note that your <code>NodeId</code> field will also likely not populate, because in the JSON, you call it <code>\"NodeId (cluster)\"</code> instead of <code>\"NodeId\"</code>. The field names must match exactly in JSON and Go. If you want to use different field names in JSON than in Go, annotate your struct with the JSON names:</p>\n\n<pre><code>type Example struct {\n   Name string   `json:\"firstName\"`\n   ...\n}\n</code></pre>\n"}], "owner": {"reputation": 2282, "user_id": 1483903, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6c37dd8068c794e8268a332d944cd7e8?s=128&d=identicon&r=PG", "display_name": "thebiggestlebowski", "link": "https://stackoverflow.com/users/1483903/thebiggestlebowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 545, "favorite_count": 0, "accepted_answer_id": 46876019, "answer_count": 1, "score": -2, "last_activity_date": 1508687205, "creation_date": 1508685909, "last_edit_date": 1508686815, "question_id": 46875811, "link": "https://stackoverflow.com/questions/46875811/golang-struct-only-partially-unmarshalled-from-json", "title": "golang struct only partially unmarshalled from json", "body": "<p>I am trying to convert json into a golang nested struct.  It is only partially working. Most fields do not parse correctly, although some do.  Why doesn't all the data from json get converted into a golang struct? My guess is that I have some mistake between my json format and the golang struct, but I don't see it.  Posting to get some other eyes on the problem. </p>\n\n<p>When I run the program, the machine ip address is unmarshalled, but the test run id is not.  Here is the output from my main method:</p>\n\n<pre><code>test run id:\nmachine ip:172.25.148.39\n</code></pre>\n\n<p>Here is my golang code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"bytes\"\n    \"io/ioutil\"\n    \"runtime\"\n    \"log\"\n)\n\nfunc main() {\n    var testRunConfig TestRunConfig\n    testRunConfigJson := ReadFile(\"testrun-config.json\")\n    err := json.Unmarshal([]byte(testRunConfigJson), &amp;testRunConfig)\n    if err != nil {\n        HandleError(err)\n    }\n\n    println(\"test run id:\" + testRunConfig.Id)\n    println(\"machine ip:\" + testRunConfig.Machines[0].IP)\n}\n\n//Logs the error, the function and the line number where it was generated\nfunc HandleError(err error) (bool) {\n    b := false\n\n    if err != nil {\n        // notice that we're using 1, so it will actually log the where\n        // the error happened, 0 = this function, we don't want that.\n        pc, fn, line, _ := runtime.Caller(1)\n\n        log.Printf(\"[error] in %s[%s:%d] %v\", runtime.FuncForPC(pc).Name(), fn, line, err)\n        b = true\n        panic(err)\n    }\n\n    return b\n}\n\n\nfunc ReadFile(fileName string) string {\n    dat, err := ioutil.ReadFile(fileName)\n    HandleError(err)\n    return string(dat)\n}\n\n//http://json2struct.mervine.net/\ntype Machine struct {\n    IP         string\n    Interfaces []Interface\n    Containers []Container\n    CmdBuffer  bytes.Buffer\n}\n\ntype InetAddress struct {\n    Addr string\n    DelayMS  int\n}\n\ntype Interface struct {\n    Name          string\n    InetAddresses []InetAddress\n}\n\ntype Volume struct {\n    Localhost string\n    Volume    string\n}\n\ntype NetworkTopology struct {\n    Host string\n    Port string\n}\n\ntype Container struct {\n    Image           string\n    Mem             string\n    Cpu             float64\n    Disk            string\n    Volume          Volume\n    NodeId          int\n    ServiceType     string\n    InstanceId      string\n    Port            string\n    NetworkTopology []NetworkTopology\n    Args            map[string]string\n\n    //\"machine\" element being a member of a Container is helpful for code flow/logic,\n    //but is not required as part of the data model (it's duplicate data).\n    //This is why it's private (not capitalized).  Think of it as a \"transient\" in java.\n    machine         Machine\n}\n\ntype TestRunConfig struct {\n    Id       string\n    Machines []Machine\n}\n</code></pre>\n\n<p>And here is the json being converted:</p>\n\n<pre><code>{\n  \"Id:\": \"testRunId\",\n  \"Machines\": [\n    {\n      \"Ip\": \"172.25.148.39\",\n      \"Interfaces\": [\n        {\n          \"Name\": \"ems3f0\",\n          \"InetAddresses\": [\n            {\n              \"Addr\": \"10.0.0.x/16\",\n              \"DelayMS\": 0\n            }\n          ]\n        },\n        {\n          \"Name\": \"ems3f1\",\n          \"InetAddresses\": [\n            {\n              \"Addr\": \"10.5.0.x/16\",\n              \"DelayMS\": 5\n            },\n            {\n              \"Addr\": \"10.15.0.x/16\",\n              \"DelayMS\": 15\n            },\n            {\n              \"Addr\": \"10.25.0.x/16\",\n              \"DelayMS\": 25\n            }\n          ]\n        }\n      ],\n      \"Containers\": [\n        {\n          \"Image\": \"docker-core:1\",\n          \"Mem\": \"20GB\",\n          \"Cpu\": 1.0,\n          \"Disk\": \"20GB\",\n          \"Volume\": {\n            \"Localhost\": \"/mnt/md0/${containerId}\",\n            \"Volume\": \"/root/.btcd${containerId}\"\n          },\n          \"NodeId\": 0,\n          \"ServiceType\": \"core\",\n          \"InstanceId\": \"core1\",\n          \"Port\": \"f(nodeid, serviceid, instanceId -&gt; port #)\",\n          \"NetworkTopology\": [\n            {\n              \"Host\": \"ip.address\",\n              \"Port\": \"some.port\"\n            }\n          ],\n          \"Args\": {\n            \"database\": \"${volume}/init-data.csv.tgz\",\n            \"listenPort\": \"1234\",\n            \"sendPort\": \"1234\"\n          }\n        },\n        {\n          \"Image\": \"docker-wallet:1\",\n          \"Mem\": \"20GB\",\n          \"Cpu\": 1.0,\n          \"Disk\": \"20GB\",\n          \"Volume\": {\n            \"Localhost\": \"/mnt/md0/${containerId}\",\n            \"Volume\": \"/root/.btcd${containerId}\"\n          },\n          \"NodeId (cluster)\": 0,\n          \"ServiceType\": \"wallet\",\n          \"InstanceId\": \"1...100\",\n          \"Port\": \"portNum\",\n          \"Args\": {\n            \"Database\": \"${volume}/init-data.csv.tgz\",\n            \"ListenPort\": \"1234\",\n            \"SendPort\": \"1234\"\n          }\n        }\n      ]\n    }\n  ]\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "dockerfile"], "comments": [{"owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 0, "creation_date": 1508684760, "post_id": 46875561, "comment_id": 80698120, "body": "Did you set the <code>$GOPATH</code> inside your build/container, or is it only set on your laptop?"}, {"owner": {"reputation": 383, "user_id": 4634669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh5.googleusercontent.com/-RCOr91QgPvQ/AAAAAAAAAAI/AAAAAAAAAIk/X1Aka8XIDgw/photo.jpg?sz=128", "display_name": "athavan kanapuli", "link": "https://stackoverflow.com/users/4634669/athavan-kanapuli"}, "reply_to_user": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 0, "creation_date": 1508684812, "post_id": 46875561, "comment_id": 80698141, "body": "It is set only on the laptop"}, {"owner": {"reputation": 383, "user_id": 4634669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh5.googleusercontent.com/-RCOr91QgPvQ/AAAAAAAAAAI/AAAAAAAAAIk/X1Aka8XIDgw/photo.jpg?sz=128", "display_name": "athavan kanapuli", "link": "https://stackoverflow.com/users/4634669/athavan-kanapuli"}, "reply_to_user": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 0, "creation_date": 1508685164, "post_id": 46875561, "comment_id": 80698275, "body": "@BMitch even if I set $GOPATH in dockerfile using ENV GOPATH , then I get import errors with standard library packages like fmt"}], "answers": [{"tags": [], "owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "is_accepted": false, "score": 1, "last_activity_date": 1508685325, "creation_date": 1508685325, "answer_id": 46875689, "question_id": 46875561, "link": "https://stackoverflow.com/questions/46875561/docker-build-fails-with-local-go-package-import/46875689#46875689", "title": "Docker build fails with local go package import", "body": "<p>The container and build environment will not have access to your laptop's environment variables. The <a href=\"https://hub.docker.com/_/golang/\" rel=\"nofollow noreferrer\">documented way to use the image</a> uses the /go/src directory:</p>\n\n<pre><code>FROM golang:1.8\n\nWORKDIR /go/src/app\nCOPY . .\n\nRUN go-wrapper download   # \"go get -d -v ./...\"\nRUN go-wrapper install    # \"go install -v ./...\"\n\nCMD [\"go-wrapper\", \"run\"] # [\"app\"]\n</code></pre>\n\n<p>I believe the above would work for you and would be the best option of all, though my go is a little rusty.</p>\n\n<p>You could define the <code>$GOPATH</code> with an <code>ENV GOPATH=/Users/venkat/go</code> in your Dockerfile. However instead of setting the environment variable, I'd recommend instead using the value of the GOPATH assumed by the image:</p>\n\n<pre><code>FROM golang:1.9\n\nCOPY .  /go/src/github.com/Athavankanapuli/interflow_api/loginservice/app\nWORKDIR  /go/src/github.com/Athavankanapuli/interflow_api/loginservice/app\nRUN go get github.com/go-kit/kit/endpoint\nRUN go get golang.org/x/oauth2\nRUN go get github.com/go-kit/kit/endpoint\nRUN go get gopkg.in/mgo.v2/bson \nRUN go install ./...\nRUN go build \n\nEXPOSE 8080\nCMD [ \"./app\" ]\n</code></pre>\n"}], "owner": {"reputation": 383, "user_id": 4634669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh5.googleusercontent.com/-RCOr91QgPvQ/AAAAAAAAAAI/AAAAAAAAAIk/X1Aka8XIDgw/photo.jpg?sz=128", "display_name": "athavan kanapuli", "link": "https://stackoverflow.com/users/4634669/athavan-kanapuli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1777, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1566466498, "creation_date": 1508684560, "last_edit_date": 1566466498, "question_id": 46875561, "link": "https://stackoverflow.com/questions/46875561/docker-build-fails-with-local-go-package-import", "title": "Docker build fails with local go package import", "body": "<p>I have built a go application which has a main package and an authentication package. The authentication package is imported in main file. The directory structure is as follows,  </p>\n\n<p><a href=\"https://i.stack.imgur.com/OkQ0K.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/OkQ0K.png\" alt=\"enter image description here\"></a></p>\n\n<p>and the docker file contents are as follows,</p>\n\n<pre><code>FROM golang\n\nCOPY ./  /Users/venkat/go/src/github.com/Athavankanapuli/interflow_api/loginservice/app\nWORKDIR  /Users/venkat/go/src/github.com/Athavankanapuli/interflow_api/loginservice/app\nRUN go get github.com/go-kit/kit/endpoint\nRUN go get golang.org/x/oauth2\nRUN go get github.com/go-kit/kit/endpoint\nRUN go get gopkg.in/mgo.v2/bson \nRUN go install ./...\nRUN go build \n\nEXPOSE 8080\nCMD [ \"./app\" ]\n</code></pre>\n\n<p>The docker does all the imports properly but it fails to read the authentication package.\nThe <strong>$GOPATH</strong> refers to <strong>/Users/venkat/go</strong>\nThe terminal command <strong>docker build -t interflow  .</strong> gives the following error output,</p>\n\n<p><a href=\"https://i.stack.imgur.com/IQMsV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/IQMsV.png\" alt=\"enter image description here\"></a></p>\n\n<p>How to fix this error and make the local authentication package gets included in the build? Or is there any other better way of writing the dockerfile for the proper build?</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 25668, "user_id": 997660, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Scxjl.png?s=128&g=1", "display_name": "Nick Krasnov", "link": "https://stackoverflow.com/users/997660/nick-krasnov"}, "edited": false, "score": 0, "creation_date": 1508682248, "post_id": 46875100, "comment_id": 80697266, "body": "Where do the data come from and what type they are stored in?"}, {"owner": {"reputation": 1399, "user_id": 4092304, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/1bkiN.png?s=128&g=1", "display_name": "Sam Gilbert", "link": "https://stackoverflow.com/users/4092304/sam-gilbert"}, "reply_to_user": {"reputation": 25668, "user_id": 997660, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Scxjl.png?s=128&g=1", "display_name": "Nick Krasnov", "link": "https://stackoverflow.com/users/997660/nick-krasnov"}, "edited": false, "score": 0, "creation_date": 1508682611, "post_id": 46875100, "comment_id": 80697400, "body": "updated the question, data stored in json"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1508689005, "post_id": 46875100, "comment_id": 80699574, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/36521839/how-to-create-a-global-variable-and-change-in-multiple-places-in-golang-html-tem/36527130#36527130\">How to create a global variable and change in multiple places in golang html/template?</a>"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1508857681, "post_id": 46875100, "comment_id": 80775170, "body": "You have a programming language at your hand, you do not need to use the template engine for this, just use <code>sort.Sort</code> on your data before executing the template."}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1542384425, "last_edit_date": 1542384425, "creation_date": 1542383559, "answer_id": 53341285, "question_id": 46875100, "link": "https://stackoverflow.com/questions/46875100/how-to-rank-by-using-templates-in-go/53341285#53341285", "title": "how to rank by using templates in go", "body": "<p>Implementing this sort of logic in a display routine is contrary to the design philosophy of go templates and generally violates the concept of <a href=\"https://en.wikipedia.org/wiki/Separation_of_concerns\" rel=\"nofollow noreferrer\">separation of concerns</a>.</p>\n\n<p>That is, templates are a <em>display</em> (or \"presentation\") concern whereas ranking as you describe here is an <em>ordering</em> (or \"business logic\") concern. By performing ordering in your display component you are making the program brittle because those concerns cannot change independently of each other nor can they be reused in a general sense. For example, if you wanted to print the elements as JSON or YAML data including their rank you would have to reimplement the ranking logic you wrote in your text template; if the ranking changed for some reason then you would have to change it in multiple places.</p>\n\n<p>A better approach would be to create a function to rank the elements on-demand, independently of how you display them. This way your program is more robust in many ways, mainly since you need rank your items only when they change instead of each time you display them.</p>\n\n<p>For example (<a href=\"https://play.golang.com/p/qhS3RN-lLBO\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>type Item struct {\n  Group string `json:\"group\"`\n  Value int    `json:\"value,string\"`\n  Rank  int    `json:\"rank,omitempty\"`\n}\n\nfunc main() {\n  // Parse the items.\n  var items []Item\n  err := json.Unmarshal([]byte(jsonstr), &amp;items)\n  check(err)\n\n  // Rank the items.\n  RankItems(items)\n\n  // Display the items.\n  PrintTable(items)\n  PrintJSON(items)\n  PrintYAML(items) // etc...\n}\n\nfunc RankItems(xs []Item) {\n  // Order the items by group, value.\n  sort.Slice(xs, func(i, j int) bool {\n    x1, x2 := xs[i], xs[j]\n    if x1.Group == x2.Group {\n      return x1.Value &lt; x2.Value\n    }\n    return x1.Group &lt; x2.Group\n  })\n  // Rank the items by position within a group.\n  var lastGroup string\n  var nextRank int\n  for i := range xs {\n    if i == 0 || lastGroup != xs[i].Group {\n      nextRank = 1\n    }\n    xs[i].Rank = nextRank\n    lastGroup = xs[i].Group\n    nextRank++\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 1399, "user_id": 4092304, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/1bkiN.png?s=128&g=1", "display_name": "Sam Gilbert", "link": "https://stackoverflow.com/users/4092304/sam-gilbert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1542384425, "creation_date": 1508681797, "last_edit_date": 1508682599, "question_id": 46875100, "link": "https://stackoverflow.com/questions/46875100/how-to-rank-by-using-templates-in-go", "title": "how to rank by using templates in go", "body": "<p>I have some data in json </p>\n\n<pre><code>[\n    {\n        \"group\":\"a\",\n        \"value\":\"10\"\n\n    },\n    {\n        \"group\":\"a\",\n        \"value\":\"11\"\n\n    },\n    {\n        \"group\":\"b\",\n        \"value\":\"2\"\n\n    },\n    {\n        \"group\":\"b\",\n        \"value\":\"3\"\n\n    }\n]\n</code></pre>\n\n<p>or as a table to make it easier to read...</p>\n\n<pre><code>group   value\na       10\na       11\nb       2\nb       3\n</code></pre>\n\n<p>I would like to rank by <code>group</code> to result in</p>\n\n<pre><code>group   value     rank\na       10        1\na       11        2\nb       2         1 \nb       3         2\n</code></pre>\n\n<p>In other languages I would loop through the data with a counter that resets when there is a new <code>group</code> value. I can range through the data but I can't get a counter working. In the below example it seems like the previous counter value isn't kept in the next iteration and so each value is 1.  </p>\n\n<pre><code>{{ $counter := 1 }}\n\n{{- range $index, $element := $data }}\n\n  {{ inline (gt $index 0) \",\" \"\" }} \n\n  { \n  \"group\" : \"{{ .group }}\", \n  \"value\" : \"{{ .value }}\", \n  \"rank\" : \"{{ $counter }}\" \n  {{ $counter := add $counter 1 }}\n  }\n\n{{- end -}}\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "edited": false, "score": 0, "creation_date": 1508682655, "post_id": 46874398, "comment_id": 80697420, "body": "To add to this: the issue could be addressed by updating the <code>print</code> method so it uses a value receiver instead of a pointer receiver (which sometimes may not be an option, but this example clearly doesn&#39;t require a pointer receiver) <a href=\"https://tour.golang.org/methods/8\" rel=\"nofollow noreferrer\">ref</a>: <code>func (p field) print()</code>. Or another option (in the case that a pointer receiver is necessary) would be to wrap the go routine in a func that passes a copy (value) of v instead of sharing v with all routines: <code>go func(f field) { f.print() }(v)</code>"}, {"owner": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "reply_to_user": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "edited": false, "score": 1, "creation_date": 1508687665, "post_id": 46874398, "comment_id": 80699072, "body": "@Jonathan It seems to me that in any case where the receiver needs to be a pointer, the wrap-it-in-a-func approach wouldn&#39;t help? The reasons to use a pointer receiver are either (a) to save space and avoid passing a big argument -- but now you are passing the full <code>v</code> as <code>f</code> to the anonymous function, or (b) to make changes to the original object -- but now you are making changes to the copy <code>f</code>, not to <code>v</code>."}, {"owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "reply_to_user": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "edited": false, "score": 0, "creation_date": 1508765343, "post_id": 46874398, "comment_id": 80728287, "body": "@AlexLew yes, good point. If this func was instead processing and storing some large, significantly complex computed value (one that could vary depending on random inputs and require up to several minutes to complete) and the value needs to be stored within <code>v</code>, that would make things complicated... but in that case, perhaps the better solution would be to launch a routine from within <code>v</code>\u2019s method... still feels kind of dirty to me, though. At this point, I\u2019d want to try rethinking the solution since I\u2019d get the feeling my approach is incorrect - or at least not optimal."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 6, "last_activity_date": 1508769632, "last_edit_date": 1508769632, "creation_date": 1508677386, "answer_id": 46874398, "question_id": 46874282, "link": "https://stackoverflow.com/questions/46874282/how-to-understand-this-behavior-of-goroutine/46874398#46874398", "title": "How to understand this behavior of goroutine?", "body": "<p>There is a data race. </p>\n\n<p>The code implicitly takes address of variable <code>v</code> when <a href=\"https://golang.org/ref/spec#Go_statements\" rel=\"nofollow noreferrer\">evaluating arguments to the goroutine function</a>.  Note that the call <code>v.print()</code> is <a href=\"https://golang.org/ref/spec#Calls\" rel=\"nofollow noreferrer\">shorthand for the call <code>(&amp;v).print()</code></a>.</p>\n\n<p>The loop changes the value of variable <code>v</code>.</p>\n\n<p>When goroutines execute, it so happens that <code>v</code> has the last value of the loop. That's not guaranteed. It could execute as you expected.</p>\n\n<p>It's helpful and easy to run programs with the <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">race detector</a>. This data race is detected and reported by the detector.</p>\n\n<p>One fix is to create another variable scoped to the inside of the loop:</p>\n\n<pre><code>for _, v := range data {\n    v := v        // short variable declaration of new variable `v`.\n    go v.print()\n}\n</code></pre>\n\n<p>With this change, the address of the inner variable <code>v</code> is taken when evaluating the arguments to the goroutine.  There is a unique inner variable <code>v</code> for each iteration of the loop.</p>\n\n<p>Yet another way to fix the problem is use a slice of pointers:</p>\n\n<pre><code>data := []*field{ {\"one\"},{\"two\"},{\"three\"} } // note '*'\nfor _, v := range data {\n    go v.print()\n}\n</code></pre>\n\n<p>With this change, the individual pointers in the slice are passed to the goroutine, not the address of the range variable <code>v</code>.   </p>\n\n<p>Another fix is to use the address of the slice element:</p>\n\n<pre><code>data := []field{ {\"one\"},{\"two\"},{\"three\"} } // note '*'\nfor i:= range data {\n    v := &amp;data[i]\n    go v.print()\n}\n</code></pre>\n\n<p>Because pointer values are typically used with types having a pointer receiver, this subtle issue does not come up often in practice.  Because <code>field</code> has a pointer receiver, it would be typical to use <code>[]*field</code> instead of <code>[]field</code> for the type of <code>data</code> in the question.</p>\n\n<p>If the goroutine function is in an anonymous function, then a common approach for avoiding the issue is to pass the range variables as an argument to the anonymous function:</p>\n\n<pre><code>for _, v := range data {\n  go func(v field) {\n    v.print() // take address of argument v, not range variable v.\n  }(v)\n}\n</code></pre>\n\n<p>Because the code in the question does not already use an anonymous function for the goroutine, the first approach used in this answer is simpler.</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1508691923, "creation_date": 1508691923, "answer_id": 46876873, "question_id": 46874282, "link": "https://stackoverflow.com/questions/46874282/how-to-understand-this-behavior-of-goroutine/46876873#46876873", "title": "How to understand this behavior of goroutine?", "body": "<p>As stated above there\u2019s a race condition  it\u2019s result depends on delays on different processes and not well defined and predictable. \nFor example if you add <code>time.Sleep(1*time.Seconds)</code> you likely to get a correct result. Because usually goroutine prints faster than 1second and will have correct variable <code>v</code> but it\u2019s a very bad way. </p>\n\n<p>Golang has a special race detector tool which helps to find such situations. I recommend read about it while reading <code>testing</code>. Definitely it\u2019s worth it. </p>\n\n<p>There\u2019s another way - explicitly pass variable value at goroutine start:</p>\n\n<pre><code>for _, v := range data {\n     go func(iv field) {\n            iv.print()\n      }(v)\n }\n</code></pre>\n\n<p>Here <code>v</code> will be copied to <code>iv</code> (\u201cinternal v\u201d) on every iteration and each goroutine will use correct value. </p>\n"}], "owner": {"reputation": 899, "user_id": 8481532, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/91806192f478f41d284c0edff368480a?s=128&d=identicon&r=PG&f=1", "display_name": "lucky yang", "link": "https://stackoverflow.com/users/8481532/lucky-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 607, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1508769632, "creation_date": 1508676683, "question_id": 46874282, "link": "https://stackoverflow.com/questions/46874282/how-to-understand-this-behavior-of-goroutine", "title": "How to understand this behavior of goroutine?", "body": "<pre><code>package main\nimport (  \n    \"fmt\"\n    \"time\"\n)\ntype field struct {  \n    name string\n}\nfunc (p *field) print() {  \n    fmt.Println(p.name)\n}\nfunc main() {  \n    data := []field{ {\"one\"},{\"two\"},{\"three\"} }\n    for _,v := range data {\n        go v.print()\n    }\n    &lt;-time.After(1 * time.Second)\n}\n</code></pre>\n\n<p>why does this code print 3 \"three\" instead of \"one\" \"two\" \"three\" in any order?</p>\n"}, {"tags": ["algorithm", "go", "data-structures"], "comments": [{"owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "edited": false, "score": 0, "creation_date": 1508689888, "post_id": 46873687, "comment_id": 80699929, "body": "Not sure if I understand your requirements completely, though it sounds to me like you&#39;d want 2 indices - one by name/index that maps to the object, and one for the intervals (keep interval starts <i>and</i> stops in the same list, do an insertion sort (O(n) for mostly sorted list) whenever an interval changes."}, {"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "edited": false, "score": 0, "creation_date": 1508739809, "post_id": 46873687, "comment_id": 80713316, "body": "A possible hint: postgres uses GiST-indexes for range types."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1508829311, "post_id": 46873687, "comment_id": 80755323, "body": "Interesting problem! <a href=\"https://en.wikipedia.org/wiki/Interval_tree\" rel=\"nofollow noreferrer\">Interval Tree</a> might help here. To my understanding, it&#39;s a bit like one-dimension kd-tree."}, {"owner": {"reputation": 168, "user_id": 3426066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e45c02f2ae5f812a55c4975124da6b2?s=128&d=identicon&r=PG", "display_name": "Chewxy", "link": "https://stackoverflow.com/users/3426066/chewxy"}, "edited": false, "score": 0, "creation_date": 1509492028, "post_id": 46873687, "comment_id": 81039160, "body": "I tried the interval tree...implementation was a bit more than worth my time so I decided against it"}], "answers": [{"comments": [{"owner": {"reputation": 168, "user_id": 3426066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e45c02f2ae5f812a55c4975124da6b2?s=128&d=identicon&r=PG", "display_name": "Chewxy", "link": "https://stackoverflow.com/users/3426066/chewxy"}, "edited": false, "score": 0, "creation_date": 1508719788, "post_id": 46876385, "comment_id": 80708359, "body": "An interval insert does correspond to an insert in the underlying buffer."}, {"owner": {"reputation": 168, "user_id": 3426066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e45c02f2ae5f812a55c4975124da6b2?s=128&d=identicon&r=PG", "display_name": "Chewxy", "link": "https://stackoverflow.com/users/3426066/chewxy"}, "edited": false, "score": 0, "creation_date": 1509492072, "post_id": 46876385, "comment_id": 81039176, "body": "FWIW, this is what I somehow ended up with - having multiple indices. It&#39;s a rough idea that works at the cost of memory, but hey that&#39;s cheap.  So I&#39;m accepting this"}], "tags": [], "owner": {"reputation": 1704, "user_id": 1931098, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/080d676d788903407f4e99ef245ca707?s=128&d=identicon&r=PG", "display_name": "Alex Lew", "link": "https://stackoverflow.com/users/1931098/alex-lew"}, "is_accepted": true, "score": 1, "last_activity_date": 1508689586, "last_edit_date": 1508689586, "creation_date": 1508689128, "answer_id": 46876385, "question_id": 46873687, "link": "https://stackoverflow.com/questions/46873687/structures-for-efficient-indexing-of-objects-by-intervals/46876385#46876385", "title": "Structures for Efficient Indexing Of Objects by Intervals", "body": "<p>This solution isn't particularly memory-efficient, but if I understand you correctly, it should allow for a relatively simple implementation of the functionality you want.</p>\n\n<ol>\n<li><p>Keep an array or slice <code>funcs</code> of all your function objects, so that they each have a canonical integer index, and can be looked up by that index.</p></li>\n<li><p>Keep a slice of ints <code>s</code> that is always the same size as your buffer of floats; it maps a particular index in your buffer to a \"function index\" in the slice of functions. You can use -1 to represent a number that is not part of any interval.</p></li>\n<li><p>Keep a slice of (int, int) pairs <code>intervals</code> such that <code>intervals[i]</code> contains the start-end indices for the function stored at <code>funcs[i]</code>.</p></li>\n</ol>\n\n<p>I believe this enables you to implement your desired functionality without too much hassle. For example, to query by index <code>i</code>, look up <code>s[i]</code>, then return <code>funcs[s[i]]</code> and <code>intervals[s[i]]</code>. When changes occur to the buffer, change <code>s</code> as well, cross-referencing between <code>s</code> and the <code>intervals</code> slice to figure out if neighboring intervals are affected. I'm happy to explain this part in more detail, but I don't totally understand the requirements for interval updates. (When you do an interval insert, does it correspond to an insert in the underlying buffer? Or are you just changing which buffer elements are associated with which functions? In which case, does an insert cause a deletion at the beginning of the next interval? Most schemes should work, but it changes the procedure.)</p>\n"}], "owner": {"reputation": 168, "user_id": 3426066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e45c02f2ae5f812a55c4975124da6b2?s=128&d=identicon&r=PG", "display_name": "Chewxy", "link": "https://stackoverflow.com/users/3426066/chewxy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 46876385, "answer_count": 1, "score": 4, "last_activity_date": 1508689586, "creation_date": 1508672860, "question_id": 46873687, "link": "https://stackoverflow.com/questions/46873687/structures-for-efficient-indexing-of-objects-by-intervals", "title": "Structures for Efficient Indexing Of Objects by Intervals", "body": "<p>I'm currently playing with some ideas wrt CRF-ish work and I have an idea that I need help with. </p>\n\n<h1>Minimal Problem</h1>\n\n<p>I've got a bunch of function objects (think something expensive like neural nets). They are applied onto a linear buffer (think an array of <code>float</code>s or <code>byte</code>s) but at varying intervals. So they look like that (think of Start and End as \"apply Object to <code>buf[Start:End]</code>\":</p>\n\n<pre><code>| Object | Start | End |\n|--------|-------|-----|\n| A      | 0     | 4   |\n| B      | 4     | 10  |\n| C      | 13    | 15  |\n</code></pre>\n\n<h2>Interval Characteristics</h2>\n\n<ul>\n<li>There may be some skips (for example, see the start of C vs the end of B)</li>\n<li>There will definitely be changes to the intervals, both positive or negative (for example, B may change from <code>[4:10]</code> to <code>[4:12]</code>. </li>\n<li>When this happens, the object(s) associated with the intervals may have to be reapplied. </li>\n<li>If the interval changes overlaps with another interval, both objects will have to be reapplied. For example, if B changes from <code>[4:10]</code> to <code>[3:12]</code>, A would have to be applied to the range <code>[0:3]</code> and B would have to be applied to the range <code>[3:12]</code></li>\n<li>Depending on operation, downstream intervals will have to be updated as well, but the objects will not necessarily have to be reapplied. For example, if it were an insertion that changed the interval range for B, then the interval ranges for C will also increment by 2, but will not trigger a reapplication of C.</li>\n</ul>\n\n<h2>Program Characteristics</h2>\n\n<ul>\n<li>The intervals change a lot (it's a machine learning training loop). </li>\n<li>Supported forms of interval updates are: insert, delete, shiftleft, shiftright. The latter two are the same as insert/delete but applied at the ends of the intervals.</li>\n<li>Changes to the interval typically comes as a tuple (index, and size) or as a single index.</li>\n<li>Application of function is fairly expensive operation and is CPU bound.</li>\n<li>However, being that I am using Go, a couple of mutexes + goroutine solves a majority of the problem (there are some finer points but by large swarths it can be ignored).</li>\n<li>One epoch can have anywhere from 5-60ish interval-object pairs.</li>\n<li>Buffer is linear, but not necessarily contiguous. </li>\n</ul>\n\n<h2>Task</h2>\n\n<p>The tasks can be summarized as follows:</p>\n\n<ol>\n<li>Query by index: returns the interval and the object associated with the interval</li>\n<li>Update interval: must also update downstream if necessary (which is the majority case)</li>\n<li>Insertion of new intervals: must also update downstream </li>\n</ol>\n\n<h1>What I've Tried</h1>\n\n<ul>\n<li>Map with intervals as a key. This was a bad idea because I had to know if a given index that changed was within a interval or not</li>\n<li>Linear structure to keep track of Starts. Discovered a bug immediately when I realized there may be skips.</li>\n<li>Linear structures with \"holes\" to keep track of Starts. This turns out to be similar to a rope.</li>\n<li>Ropes and Skip lists.  Ended up refactoring what I had into the <a href=\"https://github.com/chewxy/skiprope\" rel=\"nofollow noreferrer\">skiprope</a> package that works for strings. More yak shaving. Yay.</li>\n<li>Interval/Segment trees. Implementation is a bitch. I also tried a concrete variant of <a href=\"https://github.com/Workiva/go-datastructures\" rel=\"nofollow noreferrer\">gods/augmentedtree</a> but couldn't actually get the call-backing to work properly to evaluate it.</li>\n</ul>\n\n<h1>The Question</h1>\n\n<p>Is there any good data structure that I'm missing out on that would make these tasks easier?</p>\n\n<p>Am I missing out on something blindingly obvious?</p>\n\n<p>A friend suggested I look up incremental compilation methods because it's similar. An analogy used would be that Roslyn would parse/reparse fragments of text in a ranged fashion. That would be quite similar to my problem - just replace linear buffer of floats with linear buffer of tokens.</p>\n\n<p>The problem is I couldn't find any solid useful information about how Roslyn does it. </p>\n"}, {"tags": ["go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 7537, "user_id": 4263818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AzSa2.jpg?s=128&g=1", "display_name": "R Menke", "link": "https://stackoverflow.com/users/4263818/r-menke"}, "is_accepted": true, "score": 2, "last_activity_date": 1508684394, "last_edit_date": 1508684394, "creation_date": 1508671017, "answer_id": 46873425, "question_id": 46873185, "link": "https://stackoverflow.com/questions/46873185/type-to-second-level-slice-of-struct/46873425#46873425", "title": "Type to second level slice of struct", "body": "<p>Couple of quick notes :</p>\n\n<ul>\n<li>that isn't valid Go</li>\n<li>be careful with public vs private (first letter upper or lower case)</li>\n<li>go isn't object oriented</li>\n<li>loops start with <code>for</code></li>\n<li><code>_, value := range Item.Data</code> iterates over a type, not an instance, which doesn't work.</li>\n<li>you might be tempted to save lines of code, don't do that in Go.</li>\n</ul>\n\n<p>Nested struct definitions are IMHO only useful for one off types. For example if you are serialising data from JSON to Go you might need some temporary structures while converting.</p>\n\n<p>If however you are defining types to be used through out your program you should define each separately. This makes it much easier to extend and use these types.</p>\n\n<p>If each type is defined on its own it is easy to add a method on your <code>data</code> type that returns the <code>id</code> of the <code>meta</code> field.</p>\n\n<p>To make everything obvious I named things <code>...Type</code> and <code>...Field</code>, you don't need to do that, and it isn't a good practice ;)</p>\n\n<pre><code>func (d dataType) getId() int {\n    return d.metaField.idField\n}\n</code></pre>\n\n<p>Full example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype dataType struct {\n    metaField metaType\n}\n\ntype metaType struct {\n    idField int\n}\n\ntype itemType struct {\n    dataField []dataType\n}\n\nfunc (d dataType) getId() int {\n    return d.metaField.idField\n}\n\nfunc main() {\n    item := itemType{\n        dataField: []dataType{\n            dataType{\n                metaField: metaType{\n                    idField: 1,\n                },\n            },\n        },\n    }\n\n    for _, value := range item.dataField {\n        fmt.Println(value.getId())\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 146, "user_id": 5459436, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/fbb57bdbbcb0b64e202f995423f2c9cc?s=128&d=identicon&r=PG&f=1", "display_name": "robped", "link": "https://stackoverflow.com/users/5459436/robped"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 46873425, "answer_count": 1, "score": 0, "last_activity_date": 1508684394, "creation_date": 1508669296, "last_edit_date": 1508670655, "question_id": 46873185, "link": "https://stackoverflow.com/questions/46873185/type-to-second-level-slice-of-struct", "title": "Type to second level slice of struct", "body": "<p>I have a struct like this</p>\n\n<pre><code>type Item struct { \n    Data []struct {\n        meta struct {\n            ID int\n        }\n    }\n}\n\nfunc main () {\n    _, value := range Item.Data {\n        getId(value)\n    }\n}\n\nfunc getId(v Item.Data) {\n    return v.ID\n}\n</code></pre>\n\n<p>In <code>getId()</code> function, how can I type hint to a value of <code>Item.Data</code> struct? Or pass the piece of <code>Item.Data</code> to <code>getId</code> correctly?</p>\n\n<p>I have created a modified simple example.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 1, "creation_date": 1508658095, "post_id": 46871565, "comment_id": 80690489, "body": "just curious, what would be the use case?"}, {"owner": {"reputation": 1171, "user_id": 2430915, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fa2d09b09a5eaf435ffdf18206a3a6b4?s=128&d=identicon&r=PG", "display_name": "BBS", "link": "https://stackoverflow.com/users/2430915/bbs"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1508658455, "post_id": 46871565, "comment_id": 80690579, "body": "Lol, a good question might be able to do it better. I&#39;m writing a function for moving pawns in a chess application. Basically, if they are white I want to moves then using &lt;&lt; and if they are black with &gt;&gt;."}], "answers": [{"tags": [], "owner": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "is_accepted": false, "score": 1, "last_activity_date": 1508658794, "creation_date": 1508658794, "answer_id": 46871749, "question_id": 46871565, "link": "https://stackoverflow.com/questions/46871565/how-to-assign-an-operator-to-a-variable-in-golang/46871749#46871749", "title": "How to assign an operator to a variable in golang?", "body": "<p>You can wrap the operator in a function (<a href=\"https://play.golang.com/p/hEXmAhzSK_\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    operators := []func(int)int{left, left, left, right, right}\n\n    value := 4\n\n    for _, operator := range operators {\n        value = operator(value)\n        fmt.Println(value)\n    }\n}\n\nfunc left(x int) int {\n    return x &lt;&lt; 1\n}\n\nfunc right(x int) int {\n    return x &gt;&gt; 1\n}\n</code></pre>\n\n<p>This prints:</p>\n\n<blockquote>\n  <p>8<br>\n  16<br>\n  32<br>\n  16<br>\n  8</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 4719, "user_id": 2676845, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/TTFOs.jpg?s=128&g=1", "display_name": "fstanis", "link": "https://stackoverflow.com/users/2676845/fstanis"}, "is_accepted": true, "score": 2, "last_activity_date": 1508682033, "creation_date": 1508682033, "answer_id": 46875143, "question_id": 46871565, "link": "https://stackoverflow.com/questions/46871565/how-to-assign-an-operator-to-a-variable-in-golang/46875143#46875143", "title": "How to assign an operator to a variable in golang?", "body": "<p>No, it's not possible to store an operator in a variable.</p>\n\n<p>Perhaps the best way is to define a set of operations and have a wrapper struct with an <code>Apply</code> method:</p>\n\n<pre><code>type Operation int\n\nconst (\n  Left Operation = iota\n  Right\n)\n\ntype State struct {\n  Value int\n}\n\nfunc (s *State) Apply(o Operation) {\n  switch (o) {\n    case Left:\n       s.Value = s.value &lt;&lt; 1\n    case Right:\n       s.Value = s.value &gt;&gt; 1\n  }\n}\n</code></pre>\n\n<p>Sample use:</p>\n\n<pre><code>value := State{4} // original value\nop := Left\nvalue.Apply(op) // s.Value is now 8\n</code></pre>\n"}], "owner": {"reputation": 1171, "user_id": 2430915, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fa2d09b09a5eaf435ffdf18206a3a6b4?s=128&d=identicon&r=PG", "display_name": "BBS", "link": "https://stackoverflow.com/users/2430915/bbs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 729, "favorite_count": 0, "accepted_answer_id": 46875143, "answer_count": 2, "score": 0, "last_activity_date": 1508682033, "creation_date": 1508657354, "question_id": 46871565, "link": "https://stackoverflow.com/questions/46871565/how-to-assign-an-operator-to-a-variable-in-golang", "title": "How to assign an operator to a variable in golang?", "body": "<p>Is it possible to assign an infix operator to a variable?</p>\n\n<pre><code>operator := &lt;&lt;\n</code></pre>\n\n<p>If so how is it applied to arguments?</p>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "edited": false, "score": 0, "creation_date": 1508650310, "post_id": 46870720, "comment_id": 80688900, "body": "a short but complete code demonstrating the index out of bound error in <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">playground</a> would be perfect. A lot of other errors occurred when I try to create one : <a href=\"https://play.golang.org/p/HdkjoU0KXy\" rel=\"nofollow noreferrer\">play.golang.org/p/HdkjoU0KXy</a>"}, {"owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "reply_to_user": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "edited": false, "score": 0, "creation_date": 1508651239, "post_id": 46870720, "comment_id": 80689087, "body": "@har07 thanks for the response buddy, please check the code, I have updated the question."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1508655805, "post_id": 46870720, "comment_id": 80689920, "body": "Could you say what do you want to get as a result?"}], "answers": [{"comments": [{"owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "edited": false, "score": 0, "creation_date": 1508651836, "post_id": 46870919, "comment_id": 80689182, "body": "Thanks for the response Kenny, I have shared the complete code here: <a href=\"https://play.golang.org/p/Smm0BFgtNp\" rel=\"nofollow noreferrer\">play.golang.org/p/Smm0BFgtNp</a>, it might help"}, {"owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "edited": false, "score": 0, "creation_date": 1508652621, "post_id": 46870919, "comment_id": 80689321, "body": "I also dont want to use <code>ind</code> for that purpose but if I leave it blank it given &quot; unexpected ], expecting expression&quot; error, Just for now to avoid that I was passing it through. How can i accomplish this so that array should pick up the indexes itself?"}, {"owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "edited": false, "score": 0, "creation_date": 1508652782, "post_id": 46870919, "comment_id": 80689348, "body": "I replaced the line <code>spotsArr[availableSpot.Uid][ind] = make(map[int64][]int)</code> with <code>spotsArr[availableSpot.Uid] = []map[int64][]int{make(map[int64][]int)}</code> but I am still facing the error."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1508651938, "last_edit_date": 1508651938, "creation_date": 1508651434, "answer_id": 46870919, "question_id": 46870720, "link": "https://stackoverflow.com/questions/46870720/why-this-code-is-generating-array-index-out-of-bound/46870919#46870919", "title": "Why this code is generating array index out of bound?", "body": "<p>spotsArr is a map of int to an array of maps - map[int][]... </p>\n\n<pre><code>spotsArr        := make(map[int][]map[int64][]int)\n</code></pre>\n\n<p>On this line, you try to assign to an index of that array which has no members yet:</p>\n\n<pre><code>spotsArr[availableSpot.Uid][ind] = make(map[int64][]int)\n</code></pre>\n\n<p>You're saying set this spot availableSpot.Uid to something (fine) but then set the index ind in an array which doesn't have members to something else (not fine). To fix this I'd recommend trying to do less on each line so that it's much clearer where and what the problem is. You could do this to fix the grammar error:</p>\n\n<pre><code>spotsArr[availableSpot.Uid] = []map[int64][]int{make(map[int64][]int)}\n</code></pre>\n\n<p>But I can't think why you want to set an index on the map to the index of the Uids you're traversing (your code doing [Ind]). I'd try to make this less complex and confusing if you can and spread it out on several lines to make the intent clear. </p>\n\n<p>PS Give people a code sample which runs (i.e. include all the structs used), it makes it easier to help. </p>\n\n<p>PPS Thanks for code sample, that makes it clearer.</p>\n"}, {"comments": [{"owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "edited": false, "score": 1, "creation_date": 1508654957, "post_id": 46871245, "comment_id": 80689757, "body": "Thanks a lot har07, you saved tons of my time. Kudos! :)"}], "tags": [], "owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "is_accepted": true, "score": 2, "last_activity_date": 1508654606, "creation_date": 1508654606, "answer_id": 46871245, "question_id": 46870720, "link": "https://stackoverflow.com/questions/46870720/why-this-code-is-generating-array-index-out-of-bound/46871245#46871245", "title": "Why this code is generating array index out of bound?", "body": "<p>The error is, as the error message suggests, because you tried to assign element on the index greater than the slice length. For the sake of getting the error away, you can just initialize the slice to the length, at least, as much as the index you wanted to use : </p>\n\n<pre><code>....\nspotsArr[availableSpot.Uid] = make([]map[int64][]int, ind+1, ind+1)\nspotsArr[availableSpot.Uid][ind] = make(map[int64][]int)\n....\n</code></pre>\n\n<p>But as you clarified further about the desired output, it seems that you don't need slice in the first place. You need <em>map of <code>Uid</code></em> where each key has value of <em>map of <code>Date</code></em> :</p>\n\n<pre><code>spotsArr := make(map[int]map[int64][]int)\nfor _, availableSpot := range availableSpots {\n    if _, ok := spotsArr[availableSpot.Uid]; !ok {\n        spotsArr[availableSpot.Uid] = make(map[int64][]int)\n    }\n    spotsArr[availableSpot.Uid][availableSpot.Date] = append(spotsArr[availableSpot.Uid][availableSpot.Date],availableSpot.SpotSlug)\n}\nfmt.Println(spotsArr)\n</code></pre>\n\n<p><strong><kbd><a href=\"https://play.golang.org/p/yTqm2O1eay\" rel=\"nofollow noreferrer\">playground</a></kbd></strong></p>\n\n<p>Given the last two data have the same date, the output is as follows :</p>\n\n<pre><code>map[86:map[1534896000:[900] 1535500800:[900] 1536105600:[900] 1537315200:[900 900]]]\n</code></pre>\n"}], "owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 46871245, "answer_count": 2, "score": 0, "last_activity_date": 1508654606, "creation_date": 1508649305, "last_edit_date": 1508652420, "question_id": 46870720, "link": "https://stackoverflow.com/questions/46870720/why-this-code-is-generating-array-index-out-of-bound", "title": "Why this code is generating array index out of bound?", "body": "<p>I am stuck for past 5 - 6 hours in figuring this out that why this code is generating array index out of bound error on run time. I am unable to find out the reason. Can you please tell what modifications are required to correct this code?</p>\n\n<pre><code>spotsArr        := make(map[int][]map[int64][]int)\nfor ind, availableSpot := range availableSpots {\n            spotsArr[availableSpot.Uid][ind] = make(map[int64][]int)\n            spotsArr[availableSpot.Uid][ind][availableSpot.Date] = []int{availableSpot.SpotSlug}\n\n}\nfmt.Println(spotsArr)\n</code></pre>\n\n<p><strong>Edit 1</strong>: View the full code here <a href=\"https://play.golang.org/p/Smm0BFgtNp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Smm0BFgtNp</a></p>\n\n<p><strong>Edit 2</strong>: Actually what I need to do is to get output in format something like: </p>\n\n<pre><code>{ uid: { date: {spot_slug, spot_slug} } }\n\n{ 86: { 1536710400: {1000, 1200, 900},\n      { 1536105600: {900} } }\n</code></pre>\n"}, {"tags": ["java", "http", "go", "ip", "pcap"], "comments": [{"owner": {"reputation": 23130, "user_id": 8586227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRnwg.png?s=128&g=1", "display_name": "Davis Herring", "link": "https://stackoverflow.com/users/8586227/davis-herring"}, "edited": false, "score": 0, "creation_date": 1508637214, "post_id": 46869775, "comment_id": 80686755, "body": "It\u2019s probably too much trouble to spoof IP addresses.  Can you hook into the server directly and construct request objects (with whatever address you like)?"}], "answers": [{"tags": [], "owner": {"reputation": 4719, "user_id": 2676845, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/TTFOs.jpg?s=128&g=1", "display_name": "fstanis", "link": "https://stackoverflow.com/users/2676845/fstanis"}, "is_accepted": false, "score": 0, "last_activity_date": 1508682715, "creation_date": 1508682715, "answer_id": 46875257, "question_id": 46869775, "link": "https://stackoverflow.com/questions/46869775/how-to-modify-ip-address-in-http-request-in-go-java/46875257#46875257", "title": "How to modify ip address in http request in Go/Java", "body": "<p>IP addresses are handled at a lower level than HTTP - specifically, it's done by the TCP/IP protocol. <a href=\"https://security.stackexchange.com/questions/14505/can-i-trust-the-source-ip-of-an-http-request\">Can I trust the source IP of an HTTP request?</a> provides a good overview on why the IP you get from an HTTP client is trustworthy (and difficult to spoof).</p>\n\n<p>That said, the HTTP headers support the idea of \"suggesting\" the IP address obtained from TCP is not correct - most common way of doing this is the <a href=\"https://en.wikipedia.org/wiki/X-Forwarded-For\" rel=\"nofollow noreferrer\">X-Forwarded-For</a> header. Assuming your server relies on this value (which it probably shouldn't!), you can spoof your IP quite easily:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", \"http://example.com\", nil)\n// ...\nreq.Header.Add(\"X-Forwarded-For\", \"1.2.3.4\")\nresp, err := client.Do(req)\n</code></pre>\n\n<p>Of course, most server won't rely on this field, as the potential for abuse is large.</p>\n\n<p>If you're writing a test tool for your own server, the best way is to add logic to your server that will check for the existence of the <code>X-Forwarded-For</code> header (or something similar) and override the IP address if it's set. Make sure you disable this feature in production, though.</p>\n"}], "owner": {"reputation": 89, "user_id": 4603884, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fffa6a86e011ca6534d9c46a53bc4cb3?s=128&d=identicon&r=PG&f=1", "display_name": "zchen", "link": "https://stackoverflow.com/users/4603884/zchen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3840, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1508682715, "creation_date": 1508637007, "question_id": 46869775, "link": "https://stackoverflow.com/questions/46869775/how-to-modify-ip-address-in-http-request-in-go-java", "title": "How to modify ip address in http request in Go/Java", "body": "<p>I am doing a test tool to test a web server. The tool can construct a simple http request, and sends to the server. But each request should have a different src ip addr. </p>\n\n<p>My question is. Is there some way I can build an ip package from a http request, modify the ip addr, and sends directly into net? </p>\n\n<p>I use java or go (new to go). Many thanks! :)</p>\n"}, {"tags": ["json", "parsing", "go", "struct"], "comments": [{"owner": {"reputation": 3294, "user_id": 4848859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Slzu.jpg?s=128&g=1", "display_name": "mayo", "link": "https://stackoverflow.com/users/4848859/mayo"}, "edited": false, "score": 1, "creation_date": 1508624720, "post_id": 46868582, "comment_id": 80684611, "body": "What about implementing your own implementation of <code>UnmarshalJSON</code> on your primary struct?"}, {"owner": {"reputation": 873, "user_id": 4509355, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/31648f80ef66006febaecde7c76b7319?s=128&d=identicon&r=PG&f=1", "display_name": "Nishant Roy", "link": "https://stackoverflow.com/users/4509355/nishant-roy"}, "reply_to_user": {"reputation": 3294, "user_id": 4848859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Slzu.jpg?s=128&g=1", "display_name": "mayo", "link": "https://stackoverflow.com/users/4848859/mayo"}, "edited": false, "score": 0, "creation_date": 1508625302, "post_id": 46868582, "comment_id": 80684729, "body": "How do you mean? I&#39;m not very familiar with Go."}, {"owner": {"reputation": 3294, "user_id": 4848859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Slzu.jpg?s=128&g=1", "display_name": "mayo", "link": "https://stackoverflow.com/users/4848859/mayo"}, "edited": false, "score": 1, "creation_date": 1508628956, "post_id": 46868582, "comment_id": 80685400, "body": "You can write how to read and parse a json file into an structure... check this post: <a href=\"http://gregtrowbridge.com/golang-json-serialization-with-interfaces/\" rel=\"nofollow noreferrer\">gregtrowbridge.com/golang-json-serialization-with-interfaces</a>"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1508745350, "post_id": 46868582, "comment_id": 80715984, "body": "You already know the answer: use an intermediary struct. There probably is no serious argument against it. Speed will not matter, otherwise you would not be using JSON in the first place. The code for this struct plus the conversion will be about the same size and complexity as writing your own UnmarshalJSON. So just use the straight forward way with a helper struct, this will make it easier to read in the end, which is what is important."}, {"owner": {"reputation": 3294, "user_id": 4848859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Slzu.jpg?s=128&g=1", "display_name": "mayo", "link": "https://stackoverflow.com/users/4848859/mayo"}, "edited": false, "score": 0, "creation_date": 1509212978, "post_id": 46868582, "comment_id": 80931865, "body": "I agree with gonutz, you can write your own version of UnmarshallJSON but you will mix logic there, I mean 1.parsing from json and 2. making the conversion to your desired structure. A better approach is having a helper function or change the json structure or having the extra structure. the question is, if you are not familiar with the code how long it will take to understand, fix, read the code /logic."}], "answers": [{"tags": [], "owner": {"reputation": 873, "user_id": 4509355, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/31648f80ef66006febaecde7c76b7319?s=128&d=identicon&r=PG&f=1", "display_name": "Nishant Roy", "link": "https://stackoverflow.com/users/4509355/nishant-roy"}, "is_accepted": true, "score": 1, "last_activity_date": 1508799163, "creation_date": 1508799163, "answer_id": 46899676, "question_id": 46868582, "link": "https://stackoverflow.com/questions/46868582/golang-custom-unmarshalling-nested-json/46899676#46899676", "title": "Golang custom unmarshalling nested JSON", "body": "<p>Did as mayo suggested and implemented UnmarshalJSON</p>\n\n<pre><code>func (wp *WeekPlan) UnmarshalJSON(b []byte) error {\n    wp.Days = make([]Day, 7)\n    var f map[string]*json.RawMessage\n    json.Unmarshal(b, &amp;f)\n\n    var v []map[string]interface{}\n    json.Unmarshal(*f[\"items\"], &amp;v)\n\n    for _, item := range v {\n\n        day := int(item[\"day\"].(float64)) - 1\n        mealnumber := int(item[\"slot\"].(float64))\n\n        var value map[string]interface{}\n        json.Unmarshal([]byte(item[\"value\"].(string)), &amp;value)\n\n        fmt.Println(value)\n\n        id := int(value[\"id\"].(float64))\n        name := value[\"title\"].(string)\n\n        thisMeal := Meal{ID: id, Name: name}\n\n        var dateUpdate Day\n\n        dateUpdate = wp.Days[day]\n\n        switch mealnumber {\n        case 1:\n            dateUpdate.Breakfast = thisMeal\n        case 2:\n            dateUpdate.Lunch = thisMeal\n        default:\n            dateUpdate.Dinner = thisMeal\n        }\n\n        wp.Days[day] = dateUpdate\n    }\n\n    return nil\n}\n\n\ntype WeekPlan struct {\n    Days []Day\n}\n\n\ntype Day struct {\n    Breakfast Meal\n    Lunch     Meal\n    Dinner    Meal\n}\n\n\ntype Meal struct {\n    ID       int\n    Name     string\n    CookTime int\n    Image    string\n}\n</code></pre>\n"}], "owner": {"reputation": 873, "user_id": 4509355, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/31648f80ef66006febaecde7c76b7319?s=128&d=identicon&r=PG&f=1", "display_name": "Nishant Roy", "link": "https://stackoverflow.com/users/4509355/nishant-roy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1180, "favorite_count": 0, "accepted_answer_id": 46899676, "answer_count": 1, "score": 0, "last_activity_date": 1508799163, "creation_date": 1508623626, "question_id": 46868582, "link": "https://stackoverflow.com/questions/46868582/golang-custom-unmarshalling-nested-json", "title": "Golang custom unmarshalling nested JSON", "body": "<p>I have a JSON object that looks like this. It contains 3 meals a day for one week, for 21 total entries, since each meal is an individual entry.</p>\n\n<pre><code>{\n    \"name\": \"MealPlan 1508620645147\",\n    \"items\": [\n        {\n            \"day\": 1,\n            \"mealPlanId\": 0,\n            \"slot\": 1,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":869953,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Cream Cheese &amp; Fruit Breakfast Pastries\\\"}\"\n        },\n        {\n            \"day\": 1,\n            \"mealPlanId\": 0,\n            \"slot\": 2,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":537176,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Leftover Rice Casserole\\\"}\"\n        },\n        {\n            \"day\": 1,\n            \"mealPlanId\": 0,\n            \"slot\": 3,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":595927,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Spinach and Cheddar Quiche\\\"}\"\n        },\n        {\n            \"day\": 2,\n            \"mealPlanId\": 0,\n            \"slot\": 1,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":536716,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Candied Pecan Waffles\\\"}\"\n        },\n        {\n            \"day\": 2,\n            \"mealPlanId\": 0,\n            \"slot\": 2,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":893265,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Tahini Date Smoothie Bowls\\\"}\"\n        },\n        {\n            \"day\": 2,\n            \"mealPlanId\": 0,\n            \"slot\": 3,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":512880,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Grilled Caprese Salad Sandwich for #SundaySupper\\\"}\"\n        },\n        {\n            \"day\": 3,\n            \"mealPlanId\": 0,\n            \"slot\": 1,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":648647,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Jumbo Blueberry Muffins\\\"}\"\n        },\n        {\n            \"day\": 3,\n            \"mealPlanId\": 0,\n            \"slot\": 2,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":548554,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Brie, Pesto, and Sweet Pepper Grilled Cheese\\\"}\"\n        },\n        {\n            \"day\": 3,\n            \"mealPlanId\": 0,\n            \"slot\": 3,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":438024,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Mother's Manicotti\\\"}\"\n        },\n        {\n            \"day\": 4,\n            \"mealPlanId\": 0,\n            \"slot\": 1,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":681594,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Huevos Rancheros\\\"}\"\n        },\n        {\n            \"day\": 4,\n            \"mealPlanId\": 0,\n            \"slot\": 2,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":99184,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Black Bean Tacos\\\"}\"\n        },\n        {\n            \"day\": 4,\n            \"mealPlanId\": 0,\n            \"slot\": 3,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":604514,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Cheddar Scallion Dutch Baby\\\"}\"\n        },\n        {\n            \"day\": 5,\n            \"mealPlanId\": 0,\n            \"slot\": 1,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":622672,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Cinnamon-Sugar Streusel Baked French Toast\\\"}\"\n        },\n        {\n            \"day\": 5,\n            \"mealPlanId\": 0,\n            \"slot\": 2,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":636178,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Broccoli Cheddar Soup, A Panera Bread Co. Copycat\\\"}\"\n        },\n        {\n            \"day\": 5,\n            \"mealPlanId\": 0,\n            \"slot\": 3,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":452482,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Slow Cooker Macaroni and Cheese I\\\"}\"\n        },\n        {\n            \"day\": 6,\n            \"mealPlanId\": 0,\n            \"slot\": 1,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":157272,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Pomegranate-Nutella Waffles\\\"}\"\n        },\n        {\n            \"day\": 6,\n            \"mealPlanId\": 0,\n            \"slot\": 2,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":619111,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Barley, Bulgur and Vegetable Vegan Casserole\\\"}\"\n        },\n        {\n            \"day\": 6,\n            \"mealPlanId\": 0,\n            \"slot\": 3,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":510089,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Stovetop Mac and Cheese\\\"}\"\n        },\n        {\n            \"day\": 7,\n            \"mealPlanId\": 0,\n            \"slot\": 1,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":551869,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Berry Smoothie\\\"}\"\n        },\n        {\n            \"day\": 7,\n            \"mealPlanId\": 0,\n            \"slot\": 2,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":590452,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Cheesy Baked Pasta with Eggplant and Artichokes\\\"}\"\n        },\n        {\n            \"day\": 7,\n            \"mealPlanId\": 0,\n            \"slot\": 3,\n            \"position\": 0,\n            \"type\": \"RECIPE\",\n            \"value\": \"{\\\"id\\\":590452,\\\"imageType\\\":\\\"jpg\\\",\\\"title\\\":\\\"Cheesy Baked Pasta with Eggplant and Artichokes\\\"}\"\n        }\n    ]\n}\n</code></pre>\n\n<p>I want to unmarshal it into an array of structs that will hold 3 meals each as Breakfast, Lunch, Dinner. So, I want my struct to look like this, where <code>ID</code> is the <code>value.id</code> field from the JSON, and <code>Name</code> is the <code>value.title</code> field from the JSON, <code>Breakfast</code> is the item with <code>slot:1</code>, Lunch is the item with <code>slot:2</code> and <code>Dinner</code> is the item with <code>slot:3</code>.</p>\n\n<pre><code>type Day struct {\n    Breakfast meal\n    Lunch meal\n    Dinner meal\n}\n\ntype meal struct {\n    ID   int\n    Name string\n}\n</code></pre>\n\n<p>How can I accomplish this in Go? My initial thought was to create an intermediate <code>struct</code> that holds all the data from the JSON, and then create another <code>struct</code> by using just the fields I need. How can I do this without using the intermediary <code>struct</code> ?</p>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 98, "user_id": 1399830, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d3bf95530e9dda8b8740c45db924d76?s=128&d=identicon&r=PG", "display_name": "Tractatus", "link": "https://stackoverflow.com/users/1399830/tractatus"}, "edited": false, "score": 1, "creation_date": 1508617903, "post_id": 46867759, "comment_id": 80682885, "body": "I think you are coming from Django :)"}], "answers": [{"tags": [], "owner": {"reputation": 98, "user_id": 1399830, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/8d3bf95530e9dda8b8740c45db924d76?s=128&d=identicon&r=PG", "display_name": "Tractatus", "link": "https://stackoverflow.com/users/1399830/tractatus"}, "is_accepted": true, "score": 1, "last_activity_date": 1508619571, "creation_date": 1508619571, "answer_id": 46868019, "question_id": 46867759, "link": "https://stackoverflow.com/questions/46867759/golang-accessing-settings-from-template/46868019#46868019", "title": "Golang accessing settings from template", "body": "<p>I don't know can you access directly to a global variable, but I have been using template functions to do that.</p>\n\n<pre><code>var func_map = template.FuncMap{\n    \"getSettings\" : func() {\n        return Settings{}\n    }\n}\ntemp,err := template.New(template_name).Funcs(funcMap).Delims(\"{[\", \"]}\").Parse(string(dat))\n</code></pre>\n"}], "owner": {"reputation": 3315, "user_id": 1664109, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/JAlH9.jpg?s=128&g=1", "display_name": "RockOnGom", "link": "https://stackoverflow.com/users/1664109/rockongom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "accepted_answer_id": 46868019, "answer_count": 1, "score": 0, "last_activity_date": 1508619571, "creation_date": 1508617760, "question_id": 46867759, "link": "https://stackoverflow.com/questions/46867759/golang-accessing-settings-from-template", "title": "Golang accessing settings from template", "body": "<p>I have a golang file which contains all global variables, such as static file path, version id etc. I need to use it in templates but without passing a context when rendering template. Here is a demonstrate:</p>\n\n<p>settings.go</p>\n\n<pre><code>const STATIC_FILE=\"/static/\"\nconst VERSION = 1\n</code></pre>\n\n<p>example.html</p>\n\n<pre><code>&lt;script src=\"{{.STATIC_FILE}}assets/plugins/angular/angular-checklist.js?v={{.VERSION}}\" type=\"text/javascript\"&gt;&lt;/script&gt;\n</code></pre>\n\n<p>Note: I am looking a different way, not passing a context to template execute method.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 0, "last_activity_date": 1508616988, "creation_date": 1508616988, "answer_id": 46867648, "question_id": 46867473, "link": "https://stackoverflow.com/questions/46867473/golang-serving-static-files-please-explain-what-happens-in-these-3-lines-of-cod/46867648#46867648", "title": "Golang serving static files, please explain what happens in these 3 lines of code", "body": "<p>Confirming:</p>\n\n<p>You are registering an automatic handler for static files. Requests in the form: <code>GET /static/some_file</code> will be handled concurrently by delivering files from the <code>/public</code> directory. </p>\n"}, {"tags": [], "owner": {"reputation": 944, "user_id": 1498624, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/4WQ2c.jpg?s=128&g=1", "display_name": "grabthefish", "link": "https://stackoverflow.com/users/1498624/grabthefish"}, "is_accepted": true, "score": 4, "last_activity_date": 1508618075, "creation_date": 1508618075, "answer_id": 46867809, "question_id": 46867473, "link": "https://stackoverflow.com/questions/46867473/golang-serving-static-files-please-explain-what-happens-in-these-3-lines-of-cod/46867809#46867809", "title": "Golang serving static files, please explain what happens in these 3 lines of code", "body": "<p>After looking at the docs I think this is what happens:</p>\n\n<pre><code>http.Dir(\"public\")\n</code></pre>\n\n<p>you are converting the <code>string</code> <code>\"public\"</code> to the type <a href=\"https://golang.org/pkg/net/http/#Dir\" rel=\"nofollow noreferrer\"><code>Dir</code></a> which implements the <a href=\"https://golang.org/pkg/net/http/#FileSystem\" rel=\"nofollow noreferrer\"><code>FileSystem</code></a> interface</p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"public\"))\n</code></pre>\n\n<p>which according to the <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\">docs</a> does:</p>\n\n<blockquote>\n  <p>FileServer returns a handler that serves HTTP requests with the\n  contents of the file system rooted at root.</p>\n</blockquote>\n\n<p><code>root</code> being the <code>Dir</code> you are passing as a parameter</p>\n\n<pre><code>handler := http.StripPrefix(\"/static/\", fs)\n</code></pre>\n\n<p>you wrap the <code>Handler</code> <code>fs</code> in the <code>Handler</code> created by the <a href=\"https://golang.org/pkg/net/http/#StripPrefix\" rel=\"nofollow noreferrer\"><code>StripPrefix</code></a> func</p>\n\n<p>which according to the <a href=\"https://golang.org/pkg/net/http/#StripPrefix\" rel=\"nofollow noreferrer\">docs</a> does: </p>\n\n<blockquote>\n  <p>StripPrefix returns a handler that serves HTTP requests by removing\n  the given prefix from the request URL's Path and invoking the handler\n  h</p>\n</blockquote>\n\n<p><code>h</code> being the <code>Handler</code> <code>fs</code> you are passing as a parameter</p>\n\n<pre><code>mux.Handle(\"/static/\", handler)\n</code></pre>\n\n<p>you let all requests starting with the path <code>/static/</code> be handled by <code>handler</code></p>\n\n<p>So in short all requests for the the path <code>/static/</code> will get stripped of the <code>/static/</code> prefix and will return a file from the <code>public</code> directory on you server with the same name, eg. a request to <code>/static/requestedFile.txt</code> will return the file under <code>public/requestedFile.txt</code></p>\n"}, {"tags": [], "owner": {"reputation": 424, "user_id": 10226205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fyD0G.jpg?s=128&g=1", "display_name": "seemcat", "link": "https://stackoverflow.com/users/10226205/seemcat"}, "is_accepted": false, "score": 2, "last_activity_date": 1543298731, "creation_date": 1543298731, "answer_id": 53493667, "question_id": 46867473, "link": "https://stackoverflow.com/questions/46867473/golang-serving-static-files-please-explain-what-happens-in-these-3-lines-of-cod/53493667#53493667", "title": "Golang serving static files, please explain what happens in these 3 lines of code", "body": "<p>Currently going through a GoLang tutorial by Soham Kamani, and found that his explanation helps a ton:</p>\n\n<pre><code>func newRouter() *mux.Router {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/hello\", handler).Methods(\"GET\")\n\n    // Declare the static file directory and point it to the\n    // directory we just made\n    staticFileDirectory := http.Dir(\"./assets/\")\n\n    // Declare the handler, that routes requests to their respective filename.\n    // The fileserver is wrapped in the `stripPrefix` method, because we want to\n    // remove the \"/assets/\" prefix when looking for files.\n    // For example, if we type \"/assets/index.html\" in our browser, the file server\n    // will look for only \"index.html\" inside the directory declared above.\n    // If we did not strip the prefix, the file server would look for\n    // \"./assets/assets/index.html\", and yield an error\n    staticFileHandler := http.StripPrefix(\"/assets/\", http.FileServer(staticFileDirectory))\n\n    // The \"PathPrefix\" method acts as a matcher, and matches all routes starting\n    // with \"/assets/\", instead of the absolute route itself\n    r.PathPrefix(\"/assets/\").Handler(staticFileHandler).Methods(\"GET\")\n    return r\n}\n</code></pre>\n"}], "owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1097, "favorite_count": 1, "accepted_answer_id": 46867809, "answer_count": 3, "score": 0, "last_activity_date": 1543298731, "creation_date": 1508615783, "question_id": 46867473, "link": "https://stackoverflow.com/questions/46867473/golang-serving-static-files-please-explain-what-happens-in-these-3-lines-of-cod", "title": "Golang serving static files, please explain what happens in these 3 lines of code", "body": "<p>I'm learning go web programming and understand everthing but I'm getting lost in this 3 apparently simple lines:</p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"public\"))\nhandler := http.StripPrefix(\"/static/\", fs)\nmux.Handle(\"/static/\", handler)\n</code></pre>\n\n<p>...I have read the go src for the following lines and this is what I can infer:</p>\n\n<ol>\n<li><code>http.Dir(\"public\")</code> is casting string \"public\" to type Dir.</li>\n<li>then we serve a file (including all its content) with http.FileServer()</li>\n<li>We strip prefix because now we are inside a handleFunc() for fs</li>\n<li>StripPrefix() created a HandlerFunc()</li>\n<li>mux.Handle() registers HandlerFunc() in the mux.</li>\n<li>Deep goes the rabbit hole... and then this goroutine <code>go c.serve(ctx)</code> by <code>func (srv *Server) Serve(l net.Listener) error {}</code></li>\n<li>So each static file inside <code>/public/</code> dir is served concurrently by our server.</li>\n</ol>\n\n<p>Can someone confirm or explain what exactly is happening in the 3 lines of code.</p>\n"}, {"tags": ["go", "kotlin", "coroutine", "goroutine", "kotlin-coroutines"], "comments": [{"owner": {"reputation": 20308, "user_id": 1051598, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/f9c354e780ce562daea0e21b99bfdc0d?s=128&d=identicon&r=PG", "display_name": "Roman  Elizarov", "link": "https://stackoverflow.com/users/1051598/roman-elizarov"}, "edited": false, "score": 0, "creation_date": 1508918506, "post_id": 46864623, "comment_id": 80800857, "body": "The distinction between &quot;stackful coroutines&quot; and &quot;stackless coroutines&quot; is ill-defined and moot. See my JVMLS talk for details: <a href=\"https://www.youtube.com/watch?v=3xalVUY69Ok\" rel=\"nofollow noreferrer\">youtube.com/watch?v=3xalVUY69Ok</a>"}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1508829990, "post_id": 46865213, "comment_id": 80755729, "body": "The &#171;There is no way to say in code &quot;run these goroutines on the same OS thread&quot;.&#187; is not 100% true: the <code>runtime.LockOSThread()</code> calls locks the calling goroutine to the OS thread it&#39;s currently running on. This will ensure that the calling goroutine will always be scheduled on that same thread and no other goroutine will. OTOH, except for very rare cases, this is not needed, and in fact is often counter-productive as the Go scheduler tries very hard to ensure a goroutine removed from a thread is scheduled again on it, if possible."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 5, "creation_date": 1508830067, "post_id": 46865213, "comment_id": 80755768, "body": "@Max, consider reading <a href=\"http://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/\" rel=\"nofollow noreferrer\">this classic essay</a> on the difference between concurrency-as-a-library and concurrency-via-runtime-scheduler distinction (here: Java+anything vs Go)."}, {"owner": {"reputation": 20308, "user_id": 1051598, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/f9c354e780ce562daea0e21b99bfdc0d?s=128&d=identicon&r=PG", "display_name": "Roman  Elizarov", "link": "https://stackoverflow.com/users/1051598/roman-elizarov"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1508918290, "post_id": 46865213, "comment_id": 80800729, "body": "@kostix Thanks. Corrected, by removing this section for accuracy."}, {"owner": {"reputation": 4609, "user_id": 1699956, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oBr6e.jpg?s=128&g=1", "display_name": "Mangat Rai Modi", "link": "https://stackoverflow.com/users/1699956/mangat-rai-modi"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1589546968, "post_id": 46865213, "comment_id": 109344487, "body": "@kostix I actually found <code>runtime.LockOSThread()</code> useful. I had a CPU bound task which I parallelized by goroutines. I actually needed threads, but we don&#39;t have that in Go. I found locking goroutine to be much faster."}], "tags": [], "owner": {"reputation": 20308, "user_id": 1051598, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/f9c354e780ce562daea0e21b99bfdc0d?s=128&d=identicon&r=PG", "display_name": "Roman  Elizarov", "link": "https://stackoverflow.com/users/1051598/roman-elizarov"}, "is_accepted": true, "score": 96, "last_activity_date": 1508918254, "last_edit_date": 1508918254, "creation_date": 1508602148, "answer_id": 46865213, "question_id": 46864623, "link": "https://stackoverflow.com/questions/46864623/which-of-coroutines-goroutines-and-kotlin-coroutines-are-faster/46865213#46865213", "title": "Which of coroutines (goroutines and kotlin coroutines) are faster?", "body": "<p>Coroutines in Kotlin are implemented in a different way than goroutines in Go, so which one is \"faster\" depends on the problem that you are solving and the kind of code you are writing.</p>\n\n<p>In general, it is very hard to tell in advance which one is going to work better for a problem you have at hand. You have to run benchmarks for your particular workloads to figure it out. However, here is a general summary of key differences that should give you some guidance.</p>\n\n<ul>\n<li><p>Kotlin coroutines require less memory per simple instance than Go goroutines. A simple coroutine in Kotlin occupies only a few dozen bytes of heap memory, while a Go goroutine starts with 4KiB of stack space. It means, that if you are planning to have literally millions of coroutines, then coroutines in Kotlin might give you an edge versus Go. It also makes Kotlin coroutines better suited for very short-lived and small tasks like generators and lazy sequences.</p></li>\n<li><p>Kotlin coroutines can go to any stack depth, however each invocation of suspending function allocates object in heap for its stack. An invocation stack in Kotlin coroutines is currently implemented as a linked list of heap objects. In contrast, goroutines in Go use linear stack space. This makes suspension on deep stacks more efficient in Go. So, if the code you are writing suspends very deep down the stack, you may find that goroutines are more efficient for you.</p></li>\n<li><p>Efficient asynchronous IO is a very multidimensional design problem. An approach that is efficient for one kind of application may not give the best performance to another one. All IO operations in Kotlin coroutines are implemented by libraries written in Kotlin or Java. There is a huge variety of IO libraries available to Kotlin code. In Go asynchronous IO is implemented by Go runtime using primitives that are not available to general Go code. If Go approach to implementing IO operations is well suited to your application, then you might find that its tight integration with Go runtime gives you an advantage. On the other side, in Kotlin you can find a library or write one yourself that implements asynchronous IO in a way that is best suited to your application.</p></li>\n<li><p>Go runtime takes complete control of scheduling goroutines execution on the physical OS threads. The advantage of this approach is that you don't have to think about it all. With Kotlin coroutines you have fine-grained control on the execution environment of your coroutines. This is error-prone (e.g. you may simply create too many different thread-pools and waste your CPU time on context switching between them). However, it gives you ability to fine-tune your thread allocation and context switches for your application. For example, in Kotlin it is easy to execute your whole application or a subset of its code in a single OS thread (or thread pool) to completely avoid switching contexts between OS threads just by writing an appropriate code for that.</p></li>\n</ul>\n"}], "owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9239, "favorite_count": 26, "closed_date": 1508829717, "accepted_answer_id": 46865213, "answer_count": 1, "score": 40, "last_activity_date": 1552981640, "creation_date": 1508598099, "last_edit_date": 1552981640, "question_id": 46864623, "link": "https://stackoverflow.com/questions/46864623/which-of-coroutines-goroutines-and-kotlin-coroutines-are-faster", "closed_reason": "Needs more focus", "title": "Which of coroutines (goroutines and kotlin coroutines) are faster?", "body": "<p>Kotlin corutines is sugar for finite state machine and some task runner (for example, default ForkJoinPool). <a href=\"https://github.com/Kotlin/kotlin-coroutines/blob/master/kotlin-coroutines-informal.md#implementation-details\" rel=\"noreferrer\">https://github.com/Kotlin/kotlin-coroutines/blob/master/kotlin-coroutines-informal.md#implementation-details</a> </p>\n\n<p>In other words, there is no runtime coroutines in java/kotlin runtime yet (but this can change with <a href=\"http://cr.openjdk.java.net/~rpressler/loom/Loom-Proposal.html\" rel=\"noreferrer\">http://cr.openjdk.java.net/~rpressler/loom/Loom-Proposal.html</a> ). Kotlin coroutine is just sequential of tasks, which are executed one by one. Each task can be executed in any thread from thread pool.</p>\n\n<p>Go runtime supports \"coroutines\". But goroutines is not the real coroutines. Goroutines does not allow to set yield points in program. Also, Go does not allow to set custom thread pool. You can to set only size of threads in default pool. </p>\n\n<p>First difference between kotlin coroutines and goroutines is Go runtime manages which coroutine is running at this moment. When goroutine are blocked at some IO operation (or synchronization primitives), Go choices next Job to execute it. In JVM there is no intellectual job switching in such terms. </p>\n\n<p>Because of this, Go can cheaply change currently running job. Go has only to change few registries <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/j51G7ieoKh4/wxNaKkFEfvcJ\" rel=\"noreferrer\"><a href=\"https://groups.google.com/forum/#!msg/golang-nuts/j51G7ieoKh4/wxNaKkFEfvcJ\" rel=\"noreferrer\">https://groups.google.com/forum/#!msg/golang-nuts/j51G7ieoKh4/wxNaKkFEfvcJ</a></a>. But some people say, that JVM can use stack of threads instead of using registers. So there is no saving and loading of registers at all.</p>\n\n<p>The second difference between kotlin coroutines and goroutines is type of coroutines. Kotlin coroutines is stackless coroutines. Goroutines are stackful coroutines. All state of Kotlin coroutines are stored in Kotlin context, which is stored in heap. Goroutines state is stored in registers and thread stack.</p>\n\n<p>I want to know, which coroutines (goroutines and kotlin coroutines) are faster in IO bound tasks? CPU bound tasks? What about memory consumption?</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "edited": false, "score": 0, "creation_date": 1508665357, "post_id": 46863864, "comment_id": 80692381, "body": "Thanks for your answer Alessandro. Today I worked on the map code, which I appended above. It works, but maybe you have some comments on improving it?"}], "tags": [], "owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "is_accepted": true, "score": 3, "last_activity_date": 1508593398, "creation_date": 1508593398, "answer_id": 46863864, "question_id": 46863664, "link": "https://stackoverflow.com/questions/46863664/append-to-a-slice-field-in-a-struct-using-reflection/46863864#46863864", "title": "Append to a slice field in a struct using reflection", "body": "<p>You were not too far off. Just replace with</p>\n\n<pre><code>field.Set(reflect.Append(field, stringValue)) \n</code></pre>\n\n<p>and you are done. Also, make sure you that you initialise the slice using</p>\n\n<pre><code>result.Styles = make([]string, 0)\n</code></pre>\n\n<p>or you will end up having 10 blank string at the top of the <code>Styles</code> array.</p>\n\n<p>Hope this helps and good luck with your project.</p>\n"}], "owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1143, "favorite_count": 0, "accepted_answer_id": 46863864, "answer_count": 1, "score": 6, "last_activity_date": 1508855248, "creation_date": 1508592042, "last_edit_date": 1508855248, "question_id": 46863664, "link": "https://stackoverflow.com/questions/46863664/append-to-a-slice-field-in-a-struct-using-reflection", "title": "Append to a slice field in a struct using reflection", "body": "<p>I have a <code>struct</code> that looks like this:</p>\n\n<pre><code>type guitaristT struct {\n    Surname  string   `required=true`\n    Year     int64    `required=false`\n    American bool     // example of missing tag\n    Rating   float32  `required=true`\n    Styles   []string `required=true,minsize=1`\n}\n</code></pre>\n\n<p>I have an environment variable that looks like the following, and I'm using reflection to fill the struct based on the keys.</p>\n\n<pre><code>jimiEnvvar :=\"surname=Hendrix|year=1942|american=true|rating=9.99\n  |styles=blues|styles=rock|styles=psychedelic\"\n</code></pre>\n\n<p>I'm able to set the <code>string, int64, bool and float32</code> fields using reflection, but I'm stuck on how to append to the <code>slice</code> field <strong>Styles</strong>. For example, based on the above <code>jimiEnvvar</code> I would like the field <code>jimi.Styles</code> to have the values <code>[\"blues\",\"rock\", \"psychedelic\"]</code>.</p>\n\n<p>I have the following (simplified) code:</p>\n\n<pre><code>result := guitaristT{}\n// result.Styles = make([]string, 10) // XXX causes 10 empty strings at start\nresult.Styles = make([]string, 0)     // EDIT: Alessandro's solution\n...\nv := reflect.ValueOf(&amp;result).Elem()\n...\nfield := v.FieldByName(key) // eg key = \"styles\"\n...\nswitch field.Kind() {\n\ncase reflect.Slice:\n     // this is where I get stuck\n     //\n     // reflect.Append() has signature:\n     //   func Append(s Value, x ...Value) Value\n\n     // so I convert my value to a reflect.Value\n     stringValue := reflect.ValueOf(value) // eg value = \"blues\"\n\n     // field = reflect.Append(field, stringValue)  // XXX doesn't append\n     field.Set(reflect.Append(field, stringValue))  // EDIT: Alessandro's solution\n</code></pre>\n\n<hr>\n\n<p><strong>EDIT:</strong></p>\n\n<p>A second part (which I solved) was filling a map in the struct. For example:</p>\n\n<pre><code>type guitaristT struct {\n    ...\n    Styles   []string `required=true,minsize=1`\n    Cities   map[string]int\n}\n</code></pre>\n\n<p>Where jimiEnvvar looks like:</p>\n\n<pre><code>jimiEnvvar += \"|cities=New York^17|cities=Los Angeles^14\"\n</code></pre>\n\n<p>I wrote in this manner:</p>\n\n<pre><code>    case reflect.Map:\n        fmt.Println(\"keyAsString\", keyAsString, \"is Map, has value:\", valueAsString)\n        mapKV := strings.Split(valueAsString, \"^\")\n        if len(mapKV) != 2 {\n            log.Fatalln(\"malformed map key/value:\", mapKV)\n        }\n        mapK := mapKV[0]\n        mapV := mapKV[1]\n        thisMap := fieldAsValue.Interface().(map[string]int)\n        thisMap[mapK] = atoi(mapV)\n        thisMapAsValue := reflect.ValueOf(thisMap)\n        fieldAsValue.Set(thisMapAsValue)\n</code></pre>\n\n<hr>\n\n<pre><code>The final result was:\n\nmain.guitaristT{\n    Surname:  \"Hendrix\",\n    Year:     1942,\n    American: true,\n    Rating:   9.989999771118164,\n    Styles:   {\"blues\", \"rock\", \"psychedelic\"},\n    Cities:   {\"London\":11, \"Bay Area\":9, \"New York\":17, \"Los Angeles\":14},\n}\n</code></pre>\n\n<hr>\n\n<p>If you're interested the full code is at <a href=\"https://github.com/soniah/reflect/blob/master/structs.go\" rel=\"nofollow noreferrer\">https://github.com/soniah/reflect/blob/master/structs.go</a>. Code is just some notes/exercises I'm writing.</p>\n\n<hr>\n\n<p><strong>EDIT2:</strong></p>\n\n<p>Chapter 11 of \"Go in Practice\" (Butcher and Farina) has detailed explanations of reflection, structs and tags.</p>\n"}, {"tags": ["go", "struct", "unmarshalling"], "answers": [{"tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": false, "score": 3, "last_activity_date": 1508848698, "last_edit_date": 1508848698, "creation_date": 1508591749, "answer_id": 46863620, "question_id": 46863502, "link": "https://stackoverflow.com/questions/46863502/unmarshall-json-response-struct-empty/46863620#46863620", "title": "Unmarshall json response struct empty", "body": "<p>You have a wrong Quotas struct definition, as you can see from the json payload is an <em>array</em>.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strings\"\n)\n\ntype Response struct {\n    Quotas []struct {\n        Remain_quota_hour                          int    `json:\"remain_quota_hour\"`\n        Remain_quota_month                         int    `json:\"remain_quota_month\"`\n        Assigned_quota_hour                        int    `json:\"assigned_quota_hour\"`\n        Assigned_quota_month                       int    `json:\"assigned_quota_month\"`\n        Hourly_quota_next_reset                    string `json:\"hourly_quota_next_reset\"`\n        Monthly_quota_next_reset                   string `json:\"monthly_quota_next_reset\"`\n        Quota_id                                   string `json:\"quota_id\"`\n        Cloud_monthly_quota_period_start           string `json:\"cloud_monthly_quota_period_start\"`\n        Cloud_monthly_quota_usage_for_this_gw      int    `json:\"cloud_monthly_quota_usage_for_this_gw\"`\n        Cloud_hourly_quota_usage_for_this_gw       int    `json:\"cloud_hourly_quota_usage_for_this_gw\"`\n        Cloud_monthly_quota_usage_for_quota_id     int    `json:\"cloud_monthly_quota_usage_for_quota_id\"`\n        Cloud_hourly_quota_usage_for_quota_id      int    `json:\"cloud_hourly_quota_usage_for_quota_id\"`\n        Monthly_exceeded_quota                     int    `json:\"monthly_exceeded_quota\"`\n        Hourly_exceeded_quota                      int    `json:\"hourly_exceeded_quota\"`\n        Cloud_quota_max_allow_to_exceed_percentage int    `json:\"cloud_quota_max_allow_to_exceed_percentage\"`\n        Pod_time_gmt                               string `json:\"pod_time_gmt\"`\n        Quota_expiration                           string `json:\"quota_expiration\"`\n        Action                                     string `json:\"action\"`\n    } `json:\"response\"`\n}\n\nfunc main() {\n\n    const jsonPayload = `{\n    \"response\": [{\n        \"remain_quota_hour\": 500,\n        \"remain_quota_month\": 10000,\n        \"assigned_quota_hour\": 500,\n        \"assigned_quota_month\": 10000,\n        \"hourly_quota_next_reset\": \"1508464800\",\n        \"monthly_quota_next_reset\": \"1509494400\",\n        \"quota_id\": \"H973AA8\",\n        \"cloud_monthly_quota_period_start\": \"1506816000\",\n        \"cloud_monthly_quota_usage_for_this_gw\": 0,\n        \"cloud_hourly_quota_usage_for_this_gw\": 0,\n        \"cloud_monthly_quota_usage_for_quota_id\": 0,\n        \"cloud_hourly_quota_usage_for_quota_id\": 0,\n        \"monthly_exceeded_quota\": 0,\n        \"hourly_exceeded_quota\": 0,\n        \"cloud_quota_max_allow_to_exceed_percentage\": 1000,\n        \"pod_time_gmt\": \"1508461217\",\n        \"quota_expiration\": \"1510358400\",\n        \"action\": \"ALLOW\"\n    }]\n}`\n    var data Response\n    json.NewDecoder(strings.NewReader(jsonPayload)).Decode(&amp;data)\n\n    fmt.Printf(\"%+v\\n\", data)\n\n}\n</code></pre>\n\n<p>Console output:</p>\n\n<pre><code>=&gt; {Quotas:[{Remain_quota_hour:500 Remain_quota_month:10000 Assigned_quota_hour:500 Assigned_quota_month:10000 Hourly_quota_next_reset:1508464800 Monthly_quota_next_reset:1509494400 Quota_id:H973AA8 Cloud_monthly_quota_period_start:1506816000 Cloud_monthly_quota_usage_for_this_gw:0 Cloud_hourly_quota_usage_for_this_gw:0 Cloud_monthly_quota_usage_for_quota_id:0 Cloud_hourly_quota_usage_for_quota_id:0 Monthly_exceeded_quota:0 Hourly_exceeded_quota:0 Cloud_quota_max_allow_to_exceed_percentage:1000 Pod_time_gmt:1508461217 Quota_expiration:1510358400 Action:ALLOW}]}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/lGtTYEiRjb\" rel=\"nofollow noreferrer\"><code>Go Play</code></a></p>\n\n<p><sub>\nHere is a tip for you, convert json payload to struct here <a href=\"http://json2struct.mervine.net/\" rel=\"nofollow noreferrer\">http://json2struct.mervine.net/</a> \n</sub></p>\n"}, {"tags": [], "owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "is_accepted": false, "score": 0, "last_activity_date": 1508848616, "last_edit_date": 1508848616, "creation_date": 1508596634, "answer_id": 46864395, "question_id": 46863502, "link": "https://stackoverflow.com/questions/46863502/unmarshall-json-response-struct-empty/46864395#46864395", "title": "Unmarshall json response struct empty", "body": "<p>Besides defining a type as @\u0417\u0435\u043b\u0451\u043d\u044b\u0439 did, you can also use <em>anonymous structs</em>. This is particularly useful when you only need the struct once:</p>\n\n<pre><code>var response struct {\n    Quotas []Quota `json:\"response\"`\n}\n</code></pre>\n\n<p>The code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strings\"\n)\n\ntype Quota struct {\n    Remain_quota_hour                          int    `json:\"remain_quota_hour\"`\n    Remain_quota_month                         int    `json:\"remain_quota_month\"`\n    Assigned_quota_hour                        int    `json:\"assigned_quota_hour\"`\n    Assigned_quota_month                       int    `json:\"assigned_quota_month\"`\n    Hourly_quota_next_reset                    string `json:\"hourly_quota_next_reset\"`\n    Monthly_quota_next_reset                   string `json:\"monthly_quota_next_reset\"`\n    Quota_id                                   string `json:\"quota_id\"`\n    Cloud_monthly_quota_period_start           string `json:\"cloud_monthly_quota_period_start\"`\n    Cloud_monthly_quota_usage_for_this_gw      int    `json:\"cloud_monthly_quota_usage_for_this_gw\"`\n    Cloud_hourly_quota_usage_for_this_gw       int    `json:\"cloud_hourly_quota_usage_for_this_gw\"`\n    Cloud_monthly_quota_usage_for_quota_id     int    `json:\"cloud_monthly_quota_usage_for_quota_id\"`\n    Cloud_hourly_quota_usage_for_quota_id      int    `json:\"cloud_hourly_quota_usage_for_quota_id\"`\n    Monthly_exceeded_quota                     int    `json:\"monthly_exceeded_quota\"`\n    Hourly_exceeded_quota                      int    `json:\"hourly_exceeded_quota\"`\n    Cloud_quota_max_allow_to_exceed_percentage int    `json:\"cloud_quota_max_allow_to_exceed_percentage\"`\n    Pod_time_gmt                               string `json:\"pod_time_gmt\"`\n    Quota_expiration                           string `json:\"quota_expiration\"`\n    Action                                     string `json:\"action\"`\n}\n\nfunc main() {\n\n    const payload = `{\n    \"response\": [{\n        \"remain_quota_hour\": 500,\n        \"remain_quota_month\": 10000,\n        \"assigned_quota_hour\": 500,\n        \"assigned_quota_month\": 10000,\n        \"hourly_quota_next_reset\": \"1508464800\",\n        \"monthly_quota_next_reset\": \"1509494400\",\n        \"quota_id\": \"H973AA8\",\n        \"cloud_monthly_quota_period_start\": \"1506816000\",\n        \"cloud_monthly_quota_usage_for_this_gw\": 0,\n        \"cloud_hourly_quota_usage_for_this_gw\": 0,\n        \"cloud_monthly_quota_usage_for_quota_id\": 0,\n        \"cloud_hourly_quota_usage_for_quota_id\": 0,\n        \"monthly_exceeded_quota\": 0,\n        \"hourly_exceeded_quota\": 0,\n        \"cloud_quota_max_allow_to_exceed_percentage\": 1000,\n        \"pod_time_gmt\": \"1508461217\",\n        \"quota_expiration\": \"1510358400\",\n        \"action\": \"ALLOW\"\n    }]\n}`\n    var response struct {\n        Quotas []Quota `json:\"response\"`\n    }\n\n    json.NewDecoder(strings.NewReader(payload)).Decode(&amp;response)\n\n    fmt.Printf(\"%+v\\n\", response)\n}\n</code></pre>\n\n<p>You can try it out here: <a href=\"https://play.golang.org/p/r2tzDdGlIV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/r2tzDdGlIV</a></p>\n"}], "owner": {"reputation": 1, "user_id": 8810939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94a208156f77a21036f7ef2fcbe30db1?s=128&d=identicon&r=PG&f=1", "display_name": "GoLangNewbie", "link": "https://stackoverflow.com/users/8810939/golangnewbie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1508848698, "creation_date": 1508591013, "last_edit_date": 1508592207, "question_id": 46863502, "link": "https://stackoverflow.com/questions/46863502/unmarshall-json-response-struct-empty", "title": "Unmarshall json response struct empty", "body": "<p>I am trying to unmarshall JSON response and it's coming up empty.   I'm sure it's something incredibly stupid that I am missing here!</p>\n\n<p>JSON:</p>\n\n<pre><code>{\n \"response\": [{\n    \"remain_quota_hour\": 500,\n    \"remain_quota_month\": 10000,\n    \"assigned_quota_hour\": 500,\n    \"assigned_quota_month\": 10000,\n    \"hourly_quota_next_reset\": \"1508464800\",\n    \"monthly_quota_next_reset\": \"1509494400\",\n    \"quota_id\": \"H973AA8\",\n    \"cloud_monthly_quota_period_start\": \"1506816000\",\n    \"cloud_monthly_quota_usage_for_this_gw\": 0,\n    \"cloud_hourly_quota_usage_for_this_gw\": 0,\n    \"cloud_monthly_quota_usage_for_quota_id\": 0,\n    \"cloud_hourly_quota_usage_for_quota_id\": 0,\n    \"monthly_exceeded_quota\": 0,\n    \"hourly_exceeded_quota\": 0,\n    \"cloud_quota_max_allow_to_exceed_percentage\": 1000,\n    \"pod_time_gmt\": \"1508461217\",\n    \"quota_expiration\": \"1510358400\",\n    \"action\": \"ALLOW\"\n  }]\n}\n</code></pre>\n\n<p>Struct:</p>\n\n<pre><code>type Quotas struct {\n  Remain_quota_hour   int   `json:\"remain_quota_hour\"`\n  Remain_quota_month int `json:\"remain_quota_month\"`\n  Assigned_quota_hour int `json:\"assigned_quota_hour\"`\n  Assigned_quota_month int `json:\"assigned_quota_month\"`\n  Hourly_quota_next_reset string `json:\"hourly_quota_next_reset\"`\n  Monthly_quota_next_reset string `json:\"monthly_quota_next_reset\"`\n  Quota_id string  `json:\"quota_id\"`\n  Cloud_monthly_quota_period_start string `json:\"cloud_monthly_quota_period_start\"`\n  Cloud_monthly_quota_usage_for_this_gw int `json:\"cloud_monthly_quota_usage_for_this_gw\"`\n  Cloud_hourly_quota_usage_for_this_gw int `json:\"cloud_hourly_quota_usage_for_this_gw\"`\n  Cloud_monthly_quota_usage_for_quota_id int `json:\"cloud_monthly_quota_usage_for_quota_id\"`\n  Cloud_hourly_quota_usage_for_quota_id int `json:\"cloud_hourly_quota_usage_for_quota_id\"`\n  Monthly_exceeded_quota int `json:\"monthly_exceeded_quota\"`\n  Hourly_exceeded_quota int `json:\"hourly_exceeded_quota\"`\n  Cloud_quota_max_allow_to_exceed_percentage int `json:\"cloud_quota_max_allow_to_exceed_percentage\"`\n  Pod_time_gmt string `json:\"pod_time_gmt\"`\n  Quota_expiration string `json:\"quota_expiration\"`\n  Action string `json:\"action\"`\n}\n</code></pre>\n\n<p>HTTP Request and unmarshall:</p>\n\n<pre><code>{\n    httpClient := http.Client{Timeout: time.Second * 20}\n    service = service + \"quota\"\n    req, err := http.NewRequest(http.MethodGet, service, nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    req.Header.Set(\"Authorization\", token)\n    res, getErr := httpClient.Do(req)\n    if getErr != nil {\n        log.Fatal(getErr)\n    }\n    log.Println(\"Header\")\n    body, readErr := ioutil.ReadAll(res.Body)\n    if readErr != nil {\n        log.Fatal(readErr)\n    }\n    var quota1 Quotas\n    jsonErr := json.Unmarshal(body, &amp;quota1)\n    if jsonErr != nil {\n        log.Fatal(jsonErr)\n    }\n    log.Println(quota1.Action)\n    return quota1.Action\n}\n</code></pre>\n\n<p>I can see via string(body) the JSON is coming down, but nothing assigned to the struct.   I was desperate at one point and moved to json.decoder to the same result.  Any thoughts?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1508598868, "post_id": 46863271, "comment_id": 80676909, "body": "Presumably if you cd to myfolder and change the path to file.txt it works?"}], "answers": [{"tags": [], "owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "is_accepted": false, "score": 2, "last_activity_date": 1508589622, "creation_date": 1508589622, "answer_id": 46863300, "question_id": 46863271, "link": "https://stackoverflow.com/questions/46863271/read-file-and-display-its-contents-in-go/46863300#46863300", "title": "Read file and display its contents in Go", "body": "<p>I suspect the backslashes in <code>fname</code> is the reason. Try with double backslash (<code>\\\\</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "is_accepted": false, "score": 2, "last_activity_date": 1508599457, "creation_date": 1508599457, "answer_id": 46864822, "question_id": 46863271, "link": "https://stackoverflow.com/questions/46863271/read-file-and-display-its-contents-in-go/46864822#46864822", "title": "Read file and display its contents in Go", "body": "<p>Put the filename in backquotes. This makes it a raw string literal. With raw string literals, no escape sequences such as <code>\\f</code> will be processed.</p>\n\n<pre><code>fname := `D:\\myfolder\\file.txt`\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 0, "last_activity_date": 1508665133, "creation_date": 1508665133, "answer_id": 46872582, "question_id": 46863271, "link": "https://stackoverflow.com/questions/46863271/read-file-and-display-its-contents-in-go/46872582#46872582", "title": "Read file and display its contents in Go", "body": "<p>You can also use the unix '/' path separators instead.\nDoes the job. </p>\n\n<pre><code>fname := \"D:/myfolder/file.txt\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 8810855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/620965c8178610e3ff37f81587d267ac?s=128&d=identicon&r=PG&f=1", "display_name": "jith", "link": "https://stackoverflow.com/users/8810855/jith"}, "edited": false, "score": 0, "creation_date": 1508693362, "post_id": 46875789, "comment_id": 80701115, "body": "Thank you very much for the detailed explanation , that solved my issue  but when I accept path from user it makes the same error , func main(){ \tfmt.Println(&quot;Enter path : &quot;) \tdirpath := bufio.NewReader(os.Stdin) \tactualpath, _ := dirpath.ReadString(&#39;\\n&#39;) \tfmt.Println(&quot;Entered path &quot;,actualpath) actualpath = strings.TrimRight(actualpath,&quot;\\r\\n&quot;) \ts:= []string{&quot;<code>&quot;,strings.TrimSpace(actualpath),&quot;</code>&quot;} \tnewpath := strings.Join(s,&quot;&quot;)  \tfmt.Println(strings.Compare(<code>D:\\LMNTRIX\\maillink.txt</code>,newpath&zwnj;&#8203;)) \tfmt.Println(newpath)  \tcomapre returns -1 even after entering same path after clearing \\r\\n"}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "reply_to_user": {"reputation": 11, "user_id": 8810855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/620965c8178610e3ff37f81587d267ac?s=128&d=identicon&r=PG&f=1", "display_name": "jith", "link": "https://stackoverflow.com/users/8810855/jith"}, "edited": false, "score": 0, "creation_date": 1508702246, "post_id": 46875789, "comment_id": 80704131, "body": "That should work fine (and works fine for me on a Unix-like system). I&#39;d print the exact bytes (eg using a format string like <code>fmt.Fprintf(&quot;% x&quot;, newpath)</code>) and see where they differ. Then maybe you can figure out what&#39;s going on."}], "tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 0, "last_activity_date": 1508685804, "creation_date": 1508685804, "answer_id": 46875789, "question_id": 46863271, "link": "https://stackoverflow.com/questions/46863271/read-file-and-display-its-contents-in-go/46875789#46875789", "title": "Read file and display its contents in Go", "body": "<p>Congrats on learning Go! Though the question was about a specific error in the example, let's break it down line by line and learn a bit about some of the other issues that may be encountered:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>fname := \"D:\\myfolder\\file.txt\"\n</code></pre>\n\n<p>Like C and many other languages, Go uses the backslash character for an \"escape sequence\". That is, certain characters that start with a backslash get translated into other characters that would be hard to see otherwise (eg. <code>\\t</code> becomes a tab character, which may otherwise be indistinguishable from a space).</p>\n\n<p>The fix is to use a raw string literal (use backticks instead of quotes) where no escape sequences are processed:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>fname := `D:\\myfolder\\file.txt`\n</code></pre>\n\n<p>This fixes the initial error you were seeing by removing the invalid <code>\\m</code> and <code>\\f</code> escape sequences. A full list of escape sequences and more explanation can be found by reading the <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">String Literals</a> section of the Go spec.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>f, err := os.Open(fname)\nif err != nil {\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>The first line of this chunk is good, but it can be improved. If an error occurs, there is no reason for our program to continue executing since we couldn't even open the file, so we should both print it (probably to standard error) and exit, preferably with a non-zero exit status to indicate that something bad happened. Also, as a matter of good habit we probably want to close the file at the end of the function if opening it was successful. Putting it right below the Open call is conventional and makes it easier when someone else is reading your code. I would rewrite this as:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>f, err := os.Open(fname)\nif err != nil {\n    fmt.Fprintln(os.Stderr, err)\n    os.Exit(2)\n    // It is also common to replace these two lines with a call to log.Fatal\n}\ndefer f.Close()\n</code></pre>\n\n<p>The last chunk is a bit complicated, and we could rewrite it in multiple ways. Right now it looks like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var buff []byte\ndefer f.Close()\nbuff = make([]byte, 1024)\nfor {\n    n, err := f.Read(buff)\n\n    if n &gt; 0 {\n        fmt.Println(string(buff[:n]))\n    }\n    if err == io.EOF {\n        break\n    }\n}\n</code></pre>\n\n<p>But we don't need to define our own buffering, because the standard library provides us with the <a href=\"https://golang.org/pkg/bufio/\" rel=\"nofollow noreferrer\"><code>bufio</code></a> and <a href=\"https://golang.org/pkg/bytes/\" rel=\"nofollow noreferrer\"><code>bytes</code></a> packages which can do this for us. In this case though, we probably don't need them because we can also replace the iteration with a call to <a href=\"https://golang.org/pkg/io/#Copy\" rel=\"nofollow noreferrer\"><code>io.Copy</code></a> which does its own internal buffering. We could also use one of the other copy variants such as <a href=\"https://golang.org/pkg/io/#CopyBuffer\" rel=\"nofollow noreferrer\"><code>io.CopyBuffer</code></a> if we wanted to use our own buffer. It's also missing some error handling, so we'll add that. Now this entire chunk becomes:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>_, err := io.Copy(os.Stdout, f)\nif err != nil {\n    fmt.Fprintf(os.Stderr, \"Error reading from file: `%s'\\n\", err)\n    os.Exit(2)\n}\n// We're done!\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8810855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/620965c8178610e3ff37f81587d267ac?s=128&d=identicon&r=PG&f=1", "display_name": "jith", "link": "https://stackoverflow.com/users/8810855/jith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 593, "favorite_count": 0, "answer_count": 4, "score": 1, "last_activity_date": 1508685804, "creation_date": 1508589359, "last_edit_date": 1508595949, "question_id": 46863271, "link": "https://stackoverflow.com/questions/46863271/read-file-and-display-its-contents-in-go", "title": "Read file and display its contents in Go", "body": "<p>I'm new to Go, I want to do a simple program that reads filename from user and display it's contents back to user. This is what I have so far:</p>\n\n<pre><code>fname := \"D:\\myfolder\\file.txt\"\n\nf, err := os.Open(fname)\nif err != nil {\n    fmt.Println(err)\n}\n\nvar buff []byte\ndefer f.Close()\nbuff = make([]byte, 1024)\nfor {\n    n, err := f.Read(buff)\n\n    if n &gt; 0 {\n        fmt.Println(string(buff[:n]))\n    }\n    if err == io.EOF {\n        break\n    }\n}\n</code></pre>\n\n<p>but I get error: </p>\n\n<blockquote>\n  <p>The filename, directory name, or volume label syntax is incorrect.</p>\n</blockquote>\n"}, {"tags": ["go", "ascii"], "comments": [{"owner": {"reputation": 466, "user_id": 8307258, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8i2o.jpg?s=128&g=1", "display_name": "Rados\u0142aw Za\u0142uska", "link": "https://stackoverflow.com/users/8307258/rados%c5%82aw-za%c5%82uska"}, "edited": false, "score": 0, "creation_date": 1508659212, "post_id": 46862619, "comment_id": 80690784, "body": "Try this: <a href=\"https://stackoverflow.com/a/4424560/8307258\">stackoverflow.com/a/4424560/8307258</a>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1508681132, "post_id": 46862619, "comment_id": 80696808, "body": "You should always provide the code in such a way that a developer can copy and paste it easily.  Either for easy debugging or to run the code themselves.  Images showing code aren&#39;t easy to work with. For example. I was going to show you a solution with <code>fmt.Sprintf()</code>, but i&#39;m not going to type the above out..."}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 8607531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e64b1d6eb4afbaadfaba106ba7715a5?s=128&d=identicon&r=PG&f=1", "display_name": "Khaedir", "link": "https://stackoverflow.com/users/8607531/khaedir"}, "edited": false, "score": 0, "creation_date": 1508832326, "post_id": 46862781, "comment_id": 80757148, "body": "thank you for helping me, I just found one ascii text style that doesn&#39;t contain backtick character.  this problem has been solved."}], "tags": [], "owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "is_accepted": false, "score": 1, "last_activity_date": 1508727068, "last_edit_date": 1508727068, "creation_date": 1508585402, "answer_id": 46862781, "question_id": 46862619, "link": "https://stackoverflow.com/questions/46862619/how-to-print-ascii-text-in-go-like-python-does/46862781#46862781", "title": "How to Print ascii text in go like python does", "body": "<p>The problem is that your text contains backtick (<code>`</code>), which happen to be delimiter character for golang's raw string literal. This situation is comparable to your python code had your text contains 3 consecutive double-quotes, which is the delimiter being used in your python code.</p>\n\n<p>I don't see any quick escape from this situation <em>without modifying your ascii text</em>, as we don't have other options for raw string delimiter in golang like we have in python. You may want to store your ascii text in a text file and read it from there :</p>\n\n<pre><code>import (\n    ....\n    ....\n    \"io/ioutil\"\n)\n\nfunc banner() string {\n    b, err := ioutil.ReadFile(\"ascii.txt\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(b))\n}\n</code></pre>\n\n<p>If you're ok with slight modification to the ascii text source, then you can temporarily use other character that isn't used anywhere else in the ascii text to represent backtick, and then do string replacement to put the actual backtick in place. Or, you can use <code>fmt.Sprintf</code> to supply the problematic backtick :</p>\n\n<pre><code>ascii := fmt.Sprintf(`....%c88b...`, '`')\nfmt.Println(ascii)\n// output:\n// ....`88b...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1508692523, "creation_date": 1508692523, "answer_id": 46876956, "question_id": 46862619, "link": "https://stackoverflow.com/questions/46862619/how-to-print-ascii-text-in-go-like-python-does/46876956#46876956", "title": "How to Print ascii text in go like python does", "body": "<p>Yes but you have to split lines with backtick and put them quoted into standard double quote <code>\u201d</code>. </p>\n\n<pre><code>...  +\n\u201c888 6(,   ` \u2018 \u201c + \n...\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 8607531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e64b1d6eb4afbaadfaba106ba7715a5?s=128&d=identicon&r=PG&f=1", "display_name": "Khaedir", "link": "https://stackoverflow.com/users/8607531/khaedir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1552, "favorite_count": 1, "answer_count": 2, "score": -5, "last_activity_date": 1508727068, "creation_date": 1508584053, "last_edit_date": 1508584470, "question_id": 46862619, "link": "https://stackoverflow.com/questions/46862619/how-to-print-ascii-text-in-go-like-python-does", "title": "How to Print ascii text in go like python does", "body": "<p>how to print ascii-text in go language like python does\nlike picture shown below</p>\n\n<p><strong>Using python</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/KO5QQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KO5QQ.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>Using Golang</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/7iboA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/7iboA.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go", "orm"], "answers": [{"tags": [], "owner": {"reputation": 7537, "user_id": 4263818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AzSa2.jpg?s=128&g=1", "display_name": "R Menke", "link": "https://stackoverflow.com/users/4263818/r-menke"}, "is_accepted": true, "score": 1, "last_activity_date": 1508671997, "creation_date": 1508671997, "answer_id": 46873568, "question_id": 46862098, "link": "https://stackoverflow.com/questions/46862098/how-to-create-self-referenced-association-field/46873568#46873568", "title": "How to create self-referenced association field", "body": "<p>The Gorm magic isn't in the association (foreign key) part but in the data part.</p>\n\n<p>Gorm will do the sql joins to retrieve the related <code>Post</code> row based on <code>PostID</code> It will then store that data in the nested <code>Post</code> field in <code>Post</code>.</p>\n\n<p>If you only provide <code>Post</code> without <code>PostID</code> Gorm will do nothing as there is no foreign key for it to work with.</p>\n\n<pre><code>type Post struct {\n  ID        uint      `gorm:\"primary_key\" json:\"id\"`\n  Post      *Post     `json:\"post\" xml:\"post\" sql:\"default:null\"`\n  PostID    uint      `json:\"post_id\" xml:\"post_id\"`\n}\ndb.AutoMigrate(&amp;Post{})\n</code></pre>\n"}], "owner": {"reputation": 6129, "user_id": 1275294, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/080564d482639f78a6258099e4a29919?s=128&d=identicon&r=PG", "display_name": "f1nn", "link": "https://stackoverflow.com/users/1275294/f1nn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 675, "favorite_count": 0, "accepted_answer_id": 46873568, "answer_count": 1, "score": 0, "last_activity_date": 1508671997, "creation_date": 1508579984, "question_id": 46862098, "link": "https://stackoverflow.com/questions/46862098/how-to-create-self-referenced-association-field", "title": "How to create self-referenced association field", "body": "<p>I'm trying to create self-reference field using <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">gorm</a>:</p>\n\n<pre><code>type Post struct {\n  ID        uint      `gorm:\"primary_key\" json:\"id\"`\n  Post      *Post     `json:\"post\" xml:\"post\" sql:\"default:null\"`\n}\ndb.AutoMigrate(&amp;Post{})\n</code></pre>\n\n<p>Column <code>post_id</code> is not created in DB. Tried several struct field names, no luck.</p>\n\n<p>Which is the correct way to handle self-refrenced associations?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "time"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5055169"}, "edited": false, "score": 0, "creation_date": 1509255294, "post_id": 46862287, "comment_id": 80940915, "body": "Thanks for you input, this is the more simple of the two solutions and I&#39;ll have to keep this in mind. I knew I was missing something simple... adding 7. Thanks again and now I feel ashamed of myself lol."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1508581430, "creation_date": 1508581430, "answer_id": 46862287, "question_id": 46861744, "link": "https://stackoverflow.com/questions/46861744/using-time-package-to-rollover-to-following-weekday/46862287#46862287", "title": "Using Time Package to rollover to following Weekday", "body": "<p>Get a list of events before now, and a list of events after. The events after you can present as they are, the events before you can add multiples of 7 days to their original time till they are after today and present (probably saving them for future ref too).</p>\n\n<p>Another approach would be to have a sweeper which runs every day on a schedule (your ticking timer) which increments old events by 7 days from the day just past. You might still have to check when presenting if they were already past or too close to get to for the user if happening today.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5055169"}, "edited": false, "score": 1, "creation_date": 1509255222, "post_id": 46866712, "comment_id": 80940899, "body": "This is exactly what I was looking for: Rolling over based on the weekday. Thanks for your input and enlightening me!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 0, "last_activity_date": 1508611126, "creation_date": 1508611126, "answer_id": 46866712, "question_id": 46861744, "link": "https://stackoverflow.com/questions/46861744/using-time-package-to-rollover-to-following-weekday/46866712#46866712", "title": "Using Time Package to rollover to following Weekday", "body": "<p>Here's an example for getting the next day from now for a weekly event. If this is not what you want, add some test examples to your question.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc nextWeeklyEvent(t time.Time, weekday time.Weekday, hour, minute int) time.Time {\n    days := int((7 + (weekday - t.Weekday())) % 7)\n    y, m, d := t.AddDate(0, 0, days).Date()\n    return time.Date(y, m, d, hour, minute, 0, 0, t.Location())\n}\n\nfunc main() {\n    now := time.Now().Round(time.Second)\n    for i := 0; i &lt; +7; i++ {\n        next := nextWeeklyEvent(now, time.Wednesday, 12, 0)\n        fmt.Println(\"now: \", now, now.Weekday())\n        fmt.Println(\"next:\", next, next.Weekday())\n        fmt.Println()\n        now = now.AddDate(0, 0, 1)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>now:  2017-10-21 14:30:17 -0400 EDT Saturday\nnext: 2017-10-25 12:00:00 -0400 EDT Wednesday\n\nnow:  2017-10-22 14:30:17 -0400 EDT Sunday\nnext: 2017-10-25 12:00:00 -0400 EDT Wednesday\n\nnow:  2017-10-23 14:30:17 -0400 EDT Monday\nnext: 2017-10-25 12:00:00 -0400 EDT Wednesday\n\nnow:  2017-10-24 14:30:17 -0400 EDT Tuesday\nnext: 2017-10-25 12:00:00 -0400 EDT Wednesday\n\nnow:  2017-10-25 14:30:17 -0400 EDT Wednesday\nnext: 2017-10-25 12:00:00 -0400 EDT Wednesday\n\nnow:  2017-10-26 14:30:17 -0400 EDT Thursday\nnext: 2017-11-01 12:00:00 -0400 EDT Wednesday\n\nnow:  2017-10-27 14:30:17 -0400 EDT Friday\nnext: 2017-11-01 12:00:00 -0400 EDT Wednesday\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/m1rYD72-nx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/m1rYD72-nx</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5055169"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 1, "accepted_answer_id": 46866712, "answer_count": 2, "score": 1, "last_activity_date": 1508611126, "creation_date": 1508577033, "question_id": 46861744, "link": "https://stackoverflow.com/questions/46861744/using-time-package-to-rollover-to-following-weekday", "title": "Using Time Package to rollover to following Weekday", "body": "<p>I control a service that has the ability to store Weekday -> Time (also in time.Time format) into a MongoDB for events in a community. The problem I am currently having is trying to rollover these weekdays to the following.</p>\n\n<p>Say every Wednesday at 12:00 there is an event. Once the current weekday is Thursday- I need to roll the time object to the following week at 12:00 Wednesday and store it.</p>\n\n<p>There is no ticking timer. When someone attempts to query all of the current events- I would like for it to check if the event has passed, and if so, update to the next one and display the current. If I was using a persistent timer, the rollover would be easy by just adding 7 days to time.AddDate() or time.Date().</p>\n\n<p>So far I've tried converting the weekday to integers (I'm aware time.Weekday() does this already) then performing math to try to get the amount of days. Then using time.Date() to set the next occurrence. Current: <a href=\"https://play.golang.org/p/aCNpnhW2Ig\" rel=\"nofollow noreferrer\">The Go Playground</a></p>\n\n<p>I have a huge headache and I think I am overthinking and missing something super simple. I've checked the <a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">time package</a> documentation and nothing really popped out for me. I'm not worried about printing or storing the data, just getting the proper calculations and manipulating the time package.</p>\n"}, {"tags": ["dictionary", "go", "casting"], "comments": [{"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508589544, "post_id": 46861613, "comment_id": 80674021, "body": "May I ask the reason to replace string with mapKey? Is there a specific point in case?"}, {"owner": {"reputation": 245, "user_id": 8526089, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/e4614326f7e4c828342bd85fc8a7447c?s=128&d=identicon&r=PG&f=1", "display_name": "zaRRoc", "link": "https://stackoverflow.com/users/8526089/zarroc"}, "reply_to_user": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508660588, "post_id": 46861613, "comment_id": 80691093, "body": "@AlessandroSantini - SampleMap is owned by a sdk I am using, and there are some operations on the SampleMap exposed by the sdk. Hence, I need  an object of type SampleMap. Since internal SampleMap also uses map[string]string, accroding to golang doc I should be able to typecase it simply. But that doesn&#39;t work, is there a way to make that work?"}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 3, "last_activity_date": 1508592293, "creation_date": 1508592293, "answer_id": 46863699, "question_id": 46861613, "link": "https://stackoverflow.com/questions/46861613/converting-mapstringstring-to-mapsomestructstring/46863699#46863699", "title": "Converting map[string]string to map[someStruct]string", "body": "<p>There is no shortcut to coerce maps or arrays from one type to another, as there is for individual types (e.g. mapKey(\"str\") ).</p>\n\n<p>Setting the keys isn't hard though, you can just have a for loop:</p>\n\n<pre><code>params := map[string]string{\"someKey\": \"bar\"}\n\n// Copy to type SampleMap\nfor k, v := range params {\n        m[mapKey(k)] = v\n}\n</code></pre>\n\n<p>There isn't much point to having two extra types though (for key and map) unless you enforce limits in some way by using accessors, not allowing direct access. This feels like code translated from another language?</p>\n\n<p>In the absence of other details, I would do this:</p>\n\n<pre><code>// These are the recognised key types for params\nconst (\n  key1 = \"someKey\"\n  key2 = \"anotherKey\"\n)\n\n// Work with this sort of map till you come to convert values:\n// When checking keys or using them, use the constants above.\nparams map[string]string\nmyVal := params[key1]\n</code></pre>\n\n<p>What's the rationale for using two types here, to control which keys are used?</p>\n"}], "owner": {"reputation": 245, "user_id": 8526089, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/e4614326f7e4c828342bd85fc8a7447c?s=128&d=identicon&r=PG&f=1", "display_name": "zaRRoc", "link": "https://stackoverflow.com/users/8526089/zarroc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1589623144, "creation_date": 1508575852, "last_edit_date": 1589623144, "question_id": 46861613, "link": "https://stackoverflow.com/questions/46861613/converting-mapstringstring-to-mapsomestructstring", "title": "Converting map[string]string to map[someStruct]string", "body": "<p>I have a struct</p>\n\n<pre><code>type mapKey string\n\nvar key1 mapKey = \"someKey\"\nvar key2 mapKey = \"anotherKey\"\n\ntype SampleMap map[mapKey]string\n</code></pre>\n\n<p>Incoming http call has to be map[string]string </p>\n\n<p>which I need to typecast to \n    SampleMap in the business logic</p>\n\n<p>The normal casting : Sample(request) gives an error, cannot convert type map[string]string to SampleMap.\nSince these both have the same internal type, why is this error occuring and what is the work around?</p>\n\n<p>I really don't want to write a function to map each string to mapKey and then construct SampleMap. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1508573442, "post_id": 46861127, "comment_id": 80670036, "body": "this reading is a good one: <a href=\"https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully\" rel=\"nofollow noreferrer\">dave.cheney.net/2016/04/27/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 1, "last_activity_date": 1508573038, "creation_date": 1508573038, "answer_id": 46861303, "question_id": 46861127, "link": "https://stackoverflow.com/questions/46861127/how-can-i-assign-a-return-value-to-a-function-input-via-short-variable-declarati/46861303#46861303", "title": "How can I assign a return value to a function input via short variable declaration in Golang?", "body": "<p>Repeat after me: \"It's idiomatic Go to check for errors.\" The following is <em>not</em> bad code, even if it's not the DRYest.</p>\n\n<pre><code>f, err := os.OpenFile(\".\", os.O_RDONLY, 0666)\nif err != nil {\n    panic(err)\n}\nfiles, err := f.Readdirnames(0)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 607, "user_id": 3315943, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fef8e2e38ab142e31f85682132acb609?s=128&d=identicon&r=PG&f=1", "display_name": "kspviswa", "link": "https://stackoverflow.com/users/3315943/kspviswa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 46861303, "answer_count": 1, "score": -1, "last_activity_date": 1508573038, "creation_date": 1508571367, "last_edit_date": 1508572525, "question_id": 46861127, "link": "https://stackoverflow.com/questions/46861127/how-can-i-assign-a-return-value-to-a-function-input-via-short-variable-declarati", "title": "How can I assign a return value to a function input via short variable declaration in Golang?", "body": "<p>Consider following code snippet...</p>\n\n<pre><code>f, err := os.OpenFile(\".\", os.O_RDONLY, 0666)\n</code></pre>\n\n<p>In-order to check for error &amp; proceed, we need to have something like..</p>\n\n<pre><code>func checkerr(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>and then call this tiny function to validate the error. For eg..</p>\n\n<pre><code>f, err := os.OpenFile(\".\", os.O_RDONLY, 0666)\ncheckerr(err)\nfiles, err := f.Readdirnames(0)\ncheckerr(err)\n</code></pre>\n\n<p>While this works, I'm looking for a shortcut to directly call <code>checkerr()</code> during initialisation phase itself. See below...</p>\n\n<pre><code>f, checkerr(err) := os.OpenFile(\".\", os.O_RDONLY, 0666)\n</code></pre>\n\n<p>Is it possible using native Golang constructs?</p>\n"}, {"tags": ["string", "performance", "go", "type-conversion", "hex"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1508599847, "post_id": 46860905, "comment_id": 80677181, "body": "You should clamp the value of <code>n</code> or <code>s</code> to <code>[0x0000, 0xFFFF]</code> for <code>s := fmt.Sprintf(&quot;%04x&quot;, n)</code>. Otherwise, you will get too many hex digits when <code>b.N &gt; 0xFFFF</code>(65,535). For example, <code>n := 0x7FFFF; s := fmt.Sprintf(&quot;%04x&quot;, n)</code>, <code>s</code> is <code>7ffff</code>, five hex digits: <a href=\"https://play.golang.org/p/hX4R1aocIJ\" rel=\"nofollow noreferrer\">play.golang.org/p/hX4R1aocIJ</a>. See my revised answer, an even faster version of Append."}, {"owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "edited": false, "score": 1, "creation_date": 1531471157, "post_id": 46860905, "comment_id": 89617480, "body": "This is an old posting but meh: It turns out that using fmt.Sprintf, strconv.FormatUint and strconv.AppendInt aren&#39;t that fast. I&#39;ve written a little package <a href=\"https://github.com/FMNSSun/hexit\" rel=\"nofollow noreferrer\">github.com/FMNSSun/hexit</a> and depending on your exact use case (need string, need []byte, have preallocated buffer) the functions I wrote are generally much faster."}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1508572607, "creation_date": 1508572607, "answer_id": 46861261, "question_id": 46860905, "link": "https://stackoverflow.com/questions/46860905/efficient-way-to-convert-an-int-to-hex-string-and-then-pad-it-with-0s-in-golang/46861261#46861261", "title": "Efficient way to convert an int to Hex string and then pad it with 0&#39;s in Golang?", "body": "<p>You should be able to use strconv, then just pad manually. This probably does less work.</p>\n\n<pre><code>strconv.FormatInt(idx,16)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1508596685, "post_id": 46861738, "comment_id": 80676154, "body": "Updated to an even faster version."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1508596202, "last_edit_date": 1508596202, "creation_date": 1508576990, "answer_id": 46861738, "question_id": 46860905, "link": "https://stackoverflow.com/questions/46860905/efficient-way-to-convert-an-int-to-hex-string-and-then-pad-it-with-0s-in-golang/46861738#46861738", "title": "Efficient way to convert an int to Hex string and then pad it with 0&#39;s in Golang?", "body": "<p><code>strconv.AppendUint</code> appears to be faster than <code>fmt.Sprintf</code>. For example,</p>\n\n<p><code>hex_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"testing\"\n)\n\nfunc BenchmarkFmtSprintf(b *testing.B) {\n    b.ReportAllocs()\n    for n := 0; n &lt; b.N; n++ {\n        hexNumber := fmt.Sprintf(\"%04x\", n&amp;0xFFFF)\n        _ = hexNumber\n    }\n}\n\nfunc BenchmarkAppend(b *testing.B) {\n    b.ReportAllocs()\n    for n := 0; n &lt; b.N; n++ {\n        buf := []byte{'0', '0', '0', 3 + 4: 0}\n        buf = strconv.AppendUint(buf[:3], uint64(n)&amp;0xFFFF, 16)\n        hexNumber := string(buf[len(buf)-4:])\n        _ = hexNumber // Do some stuff ....\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test -bench=. hex_test.go\nBenchmarkSprintf-4      10000000       116 ns/op      16 B/op     1 allocs/op\nBenchmarkAppend-4       100000000       19.2 ns/op     0 B/op     0 allocs/op\n</code></pre>\n"}], "owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1156, "favorite_count": 1, "accepted_answer_id": 46861738, "answer_count": 2, "score": 2, "last_activity_date": 1508596202, "creation_date": 1508569615, "last_edit_date": 1508577874, "question_id": 46860905, "link": "https://stackoverflow.com/questions/46860905/efficient-way-to-convert-an-int-to-hex-string-and-then-pad-it-with-0s-in-golang", "title": "Efficient way to convert an int to Hex string and then pad it with 0&#39;s in Golang?", "body": "<p>I'm trying to convert 10 millions of int to Hex, then, padding it with 0's in order to get a 4 characters string which represents the Hex number.</p>\n\n<p>So far, I tried the following:</p>\n\n<pre><code>var hexNumber string\nfor idx := O; idx &lt; 10000000; idx++ {\n    hexNumber = fmt.Sprintf(\"%04x\", idx)\n\n    // Do some stuff ....\n}\n</code></pre>\n\n<p>But <code>fmt.Sprintf</code> is not very efficient. How can I achieve this in a efficient way?</p>\n\n<p><strong>Solution:</strong> It turns out that @peterSO <code>strconv.AppendInt</code> solution is way faster.</p>\n\n<pre><code>package bench\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n    \"testing\"\n)\n\nvar stringHex [16]string\nvar runesHex [16]rune\n\nfunc init() {\n    stringHex = [16]string{\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\"}\n    runesHex = [16]rune{'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F'}\n}\n\nfunc intToHex1(intNumber int) string {\n    hexNumber := []rune(\"0000\")\n    for i, j := int(0), uint(12); i &lt; 4; i, j = i+1, j-4 {\n        hexNumber[i] = runesHex[(intNumber&gt;&gt;j)&amp;0x0f]\n    }\n    return string(hexNumber)\n}\n\nfunc intToHex2(intNumber int) string {\n    hexNumber := \"0000\"\n    for i, j := int(0), uint(12); i &lt; 4; i, j = i+1, j-4 {\n        hexNumber = hexNumber[:i] + stringHex[(intNumber&gt;&gt;j)&amp;0x0f] + hexNumber[i+1:]\n    }\n    return hexNumber\n}\n\nfunc BenchmarkFmtSprintf(b *testing.B) {\n    b.ReportAllocs()\n    for n := 0; n &lt; b.N; n++ {\n        hexNumber := fmt.Sprintf(\"%04x\", n)\n        _ = hexNumber\n    }\n}\n\nfunc BenchmarkStrconvFormatInt(b *testing.B) {\n    b.ReportAllocs()\n    for n := 0; n &lt; b.N; n++ {\n        retStr := strings.Repeat(\"0\", 4) + strconv.FormatInt(int64(n), 16)\n        hexNumber := retStr[(len(retStr) - 4):]\n        _ = hexNumber\n    }\n}\n\nfunc BenchmarkAppend(b *testing.B) {\n    b.ReportAllocs()\n    buf := []byte{'0', '0', '0', '0', 4 + 16: 0}\n    for n := 0; n &lt; b.N; n++ {\n        buf = strconv.AppendInt(buf[:4], int64(n), 16)\n        hexNumber := string(buf[len(buf)-4:])\n        _ = hexNumber\n    }\n}\n\nfunc BenchmarkIntToHex1(b *testing.B) {\n    b.ReportAllocs()\n    for n := 0; n &lt; b.N; n++ {\n        hexNumber := intToHex1(n)\n        _ = hexNumber\n    }\n}\n\nfunc BenchmarkIntToHex2(b *testing.B) {\n    b.ReportAllocs()\n    for n := 0; n &lt; b.N; n++ {\n        hexNumber := intToHex2(n)\n        _ = hexNumber\n    }\n}\n</code></pre>\n\n<p>So the benchmark:</p>\n\n<pre><code>BenchmarkFmtSprintf-2            3000000               364 ns/op              16 B/op          2 allocs/op\nBenchmarkStrconvFormatInt-2      5000000               354 ns/op              15 B/op          3 allocs/op\nBenchmarkAppend-2               20000000                75.6 ns/op             0 B/op          0 allocs/op\nBenchmarkIntToHex1-2            10000000               162 ns/op               8 B/op          1 allocs/op\nBenchmarkIntToHex2-2             3000000               536 ns/op              16 B/op          4 allocs/op\n</code></pre>\n"}, {"tags": ["github", "go"], "comments": [{"owner": {"reputation": 8826, "user_id": 10245, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/a2909c1103b9ceba6c8933c85dc4f803?s=128&d=identicon&r=PG", "display_name": "Tim Abell", "link": "https://stackoverflow.com/users/10245/tim-abell"}, "edited": false, "score": 1, "creation_date": 1533834002, "post_id": 46860546, "comment_id": 90503534, "body": "The problem with the existing answers for me is that I&#39;m forking a library that I then in turn import into another project. If my project references my fork then a fresh checkout and <code>go get</code> will not know to hack the folder structure and as a result it won&#39;t build."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 8, "last_activity_date": 1508567934, "last_edit_date": 1592644375, "creation_date": 1508567513, "answer_id": 46860692, "question_id": 46860546, "link": "https://stackoverflow.com/questions/46860546/go-use-of-internal-package-not-allowed-when-running-a-go-project-forked-fro/46860692#46860692", "title": "Go : &#39;use of internal package not allowed &#39; when running a Go project forked from a GitHub repository", "body": "<p>As illustrated in <a href=\"https://github.com/influxdata/influxdb/pull/3910/files\" rel=\"noreferrer\">another Go project</a>:</p>\n<blockquote>\n<h2>Cloning a fork</h2>\n<p>If you wish to work with fork of InfluxDB, your own fork for example, you must still follow the directory structure above. But instead of cloning the main repo, instead clone your fork. Follow the steps below to work with a fork:</p>\n</blockquote>\n<pre><code>export GOPATH=$HOME/gocodez\nmkdir -p $GOPATH/src/github.com/influxdb\ncd $GOPATH/src/github.com/influxdb\ngit clone git@github.com:&lt;username&gt;/influxdb\n</code></pre>\n<blockquote>\n<p>Retaining the directory structure $GOPATH/src/github.com/influxdb is necessary so that Go imports work correctly.</p>\n</blockquote>\n<p>Replace InfluxDB name/URL by your project, and the same idea applies.</p>\n<p>In your case, the GitHub fork is only there for you to push your contribution back to it, and to make Pull request from it.<br />\nIt won't serve as a source for <code>go get</code> to work, since the packages wouldn't match your GitHub for repo URL.</p>\n"}, {"tags": [], "owner": {"reputation": 2259, "user_id": 8554496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uJhVd.png?s=128&g=1", "display_name": "Clive Makamara", "link": "https://stackoverflow.com/users/8554496/clive-makamara"}, "is_accepted": false, "score": 5, "last_activity_date": 1508614117, "creation_date": 1508614117, "answer_id": 46867195, "question_id": 46860546, "link": "https://stackoverflow.com/questions/46860546/go-use-of-internal-package-not-allowed-when-running-a-go-project-forked-fro/46867195#46867195", "title": "Go : &#39;use of internal package not allowed &#39; when running a Go project forked from a GitHub repository", "body": "<p>This is because <strong>internal packages</strong> in go can only be imported by packages in the same directory root. It's kind of like package private classes in java. If you want to edit the code without having to rename all package imports you need to maintain the same folder structure that the package expects so if <code>github.com/zoonoo/go-ethereum</code> is in your <strong>$GOPATH</strong> rename the directory to  <code>github.com/ethereum/go-ethereum</code> or create a symbolic link and work from the linked directory instead.</p>\n"}], "owner": {"reputation": 347, "user_id": 3969907, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8e90745f8b9862f736b023e91b15abc0?s=128&d=identicon&r=PG", "display_name": "zoonoo", "link": "https://stackoverflow.com/users/3969907/zoonoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11499, "favorite_count": 2, "accepted_answer_id": 46860692, "answer_count": 2, "score": 5, "last_activity_date": 1575362154, "creation_date": 1508566001, "last_edit_date": 1575362154, "question_id": 46860546, "link": "https://stackoverflow.com/questions/46860546/go-use-of-internal-package-not-allowed-when-running-a-go-project-forked-fro", "title": "Go : &#39;use of internal package not allowed &#39; when running a Go project forked from a GitHub repository", "body": "<p>I'm getting used to Go, and trying to understand how it works.</p>\n\n<p>So I'm trying to run the test code from my repository zoonoo/go-ethereum, forked from the original repository <a href=\"https://www.github.com/ethereum/go-ethereum\" rel=\"nofollow noreferrer\">ethereum/go-ethereum</a>.</p>\n\n<p>When I run <code>go test .</code> under the <code>eth</code> directory, I get the following error :</p>\n\n<pre><code>eth/api.go:37:2: use of internal package not allowed\n</code></pre>\n\n<p>37th line of eth/api.go is as follows :  <code>\"github.com/ethereum/go-ethereum/internal/ethapi\"</code></p>\n\n<p>Does this mean when you fork a go repository, you have to change the path of all dependencies within the code to run the code?<br>\nDoes Go package system support repository fork at all?</p>\n"}, {"tags": ["mysql", "sql", "go"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1536952479, "post_id": 46859705, "comment_id": 91623269, "body": "You could also use an ORM such as github.com/jinzhu/gorm which would let you query based on a partially filled struct."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1508561662, "post_id": 46859776, "comment_id": 80667928, "body": "Was about to criticize about SQL injection, but this solution does actually limit what the string manipulation does by what is in the code... as far as I can tell."}, {"owner": {"reputation": 390, "user_id": 4401682, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a5696cfc9087ea6003bada234cb2c8cb?s=128&d=identicon&r=PG&f=1", "display_name": "Vutuz", "link": "https://stackoverflow.com/users/4401682/vutuz"}, "edited": false, "score": 0, "creation_date": 1508563689, "post_id": 46859776, "comment_id": 80668241, "body": "i also use this way!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 23, "last_activity_date": 1580537997, "last_edit_date": 1580537997, "creation_date": 1508556633, "answer_id": 46859776, "question_id": 46859705, "link": "https://stackoverflow.com/questions/46859705/making-dynamic-sql-queries-to-a-mysql-db/46859776#46859776", "title": "Making dynamic SQL queries to a MySQL DB", "body": "<p>If you have a map with the field names and values like this:</p>\n\n<pre><code>m := map[string]interface{}{\"UserID\": 1234, \"Age\": 18}\n</code></pre>\n\n<p>then you can build the query like this:</p>\n\n<pre><code>var values []interface{}\nvar where []string\nfor _, k := range []string{\"userId\", \"gender\", \"age\", \"name\", \"height\", \"weight\", \"ethnicity\"} {\n    if v, ok := m[k]; ok {\n        values = append(values, v)\n        where = append(where, fmt.Sprintf(\"%s = ?\", k))\n    }\n}\nr, err := db.QueryRow(\"SELECT name FROM users WHERE \" + strings.Join(where, \" AND \"), values...)\n</code></pre>\n\n<p>This is not susceptible to SQL injection because placeholders are used for parts of the query outside the application's direct control.</p>\n\n<p>If the map keys are known to be allowed field names, then use this:</p>\n\n<pre><code>var values []interface{}\nvar where []string\nfor k, v := range m {\n    values = append(values, v)\n    where = append(where, fmt.Sprintf(\"%s = ?\", k))\n}\nr, err := db.QueryRow(\"SELECT name FROM users WHERE \" + strings.Join(where, \" AND \"), values...)\n</code></pre>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4775, "favorite_count": 4, "accepted_answer_id": 46859776, "answer_count": 1, "score": 11, "last_activity_date": 1580537997, "creation_date": 1508555767, "last_edit_date": 1536932187, "question_id": 46859705, "link": "https://stackoverflow.com/questions/46859705/making-dynamic-sql-queries-to-a-mysql-db", "title": "Making dynamic SQL queries to a MySQL DB", "body": "<p>I've never used golang with mysql before, so I'm reading about these for the first time.  I'd like to do something like this:</p>\n\n<pre><code>if userId &amp;&amp; gender &amp;&amp; age\ndb.QueryRow(\"SELECT name FROM users WHERE userId=? AND gender=? AND age=?\", userId,gender,age)\nelse if gender &amp;&amp; age\ndb.QueryRow(\"SELECT name FROM users WHERE gender=? AND age=?\", gender, age)\nelse if userId &amp;&amp; gender\ndb.QueryRow(\"SELECT name FROM users WHERE userId=? AND gender=?\", userId,gender)\nelse if userId &amp;&amp; age\ndb.QueryRow(\"SELECT name FROM users WHERE userId=? AND age=?\", userId, age)\nelse if gender\ndb.QueryRow(\"SELECT name FROM users WHERE gender=?\", gender)\nelse if userId\ndb.QueryRow(\"SELECT name FROM users WHERE userId=?\", userId)\nelse if age\ndb.QueryRow(\"SELECT name FROM users WHERE age=?\", age)\n</code></pre>\n\n<p>This is far too much typing, especially if I have a dozen more variables I'd like to add to the WHERE condition.</p>\n\n<p>If this were PHP, I'd do something like this:</p>\n\n<pre><code>$sql = \"SELECT name FROM users \";\n$where = array();\nforeach(explode(\",\",\"userId,gender,age,name,height,weight,ethnicity\" as $field)\n{\n    if(isset($arrayOfValues[$field]))\n    {\n        $where[count($where)] = $field.\" = ?\".$field\n        $db-&gt;bind(\"?\".$field,$arrayOfValues[$field]);\n    }\n}\n\nif(count($where)&gt;0)\n$sql = $sql . \" WHERE \".implode(\" AND \",$where);\n$db-&gt;query($sql);\n</code></pre>\n\n<p>By using a foreach loop, I can dynamically generate queries and dynamically bind as many variables as needed.  </p>\n\n<p>Is something like this an option with golang and mysql?  Or are there alternatives to not typing out every single variable combination for a query?</p>\n"}, {"tags": ["bash", "go", "exec"], "answers": [{"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 3, "last_activity_date": 1508559662, "creation_date": 1508559662, "answer_id": 46860014, "question_id": 46859582, "link": "https://stackoverflow.com/questions/46859582/golang-exec-command-execute-bash-exit-status-1/46860014#46860014", "title": "golang exec.Command execute bash exit status 1", "body": "<p>The command that is going to be executed in <code>bash</code> should be enclosed with double quote (or single quote), e.g.</p>\n\n<pre><code>cmd := exec.Command(\"bash\", \"-c\", `\"rm -rf *\"`)\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 4308995, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Y67yP_ssGp4/AAAAAAAAAAI/AAAAAAAAAA8/R9-airLP3iU/photo.jpg?sz=128", "display_name": "Bruce", "link": "https://stackoverflow.com/users/4308995/bruce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2613, "favorite_count": 0, "accepted_answer_id": 46860014, "answer_count": 1, "score": 0, "last_activity_date": 1508559662, "creation_date": 1508553994, "question_id": 46859582, "link": "https://stackoverflow.com/questions/46859582/golang-exec-command-execute-bash-exit-status-1", "title": "golang exec.Command execute bash exit status 1", "body": "<pre><code>cmd := exec.Command(\"bash\", \"-c\", \"rm -rf *\")\ncmd.Dir = \"/root/media/\"\nerr := cmd.Run()\nif err != nil {\n    fmt.Println(err)\n    fmt.Fprintf(w, \"'rm -rf *' command failed.\")\n}\n</code></pre>\n\n<p>\"err\": exit with status 1\nI think I am not writing exec.Command correctly, but I cannot fix this.</p>\n"}]