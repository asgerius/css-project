[{"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567639209, "post_id": 57796612, "comment_id": 102026266, "body": "Show the relevant code (the <code>WriteHeaderAndJson</code> method)."}, {"owner": {"reputation": 75, "user_id": 2701902, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/afd10c50c39bac73249eb1966485e744?s=128&d=identicon&r=PG&f=1", "display_name": "huggs", "link": "https://stackoverflow.com/users/2701902/huggs"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567640150, "post_id": 57796612, "comment_id": 102026429, "body": "It is here <a href=\"https://github.com/emicklei/go-restful/blob/master/response.go\" rel=\"nofollow noreferrer\">github.com/emicklei/go-restful/blob/master/response.go</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1567640455, "post_id": 57796612, "comment_id": 102026486, "body": "The actual code is <a href=\"https://github.com/emicklei/go-restful/blob/1905f349c059305e2785c36f986dbaf9e691898c/entity_accessors.go#L141\" rel=\"nofollow noreferrer\">here</a>. There&#39;s not enough to go on here.  My guess is that response body is correct and that something <a href=\"https://golang.org/pkg/strconv/#Quote\" rel=\"nofollow noreferrer\">quotes</a> that output for display."}, {"owner": {"reputation": 75, "user_id": 2701902, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/afd10c50c39bac73249eb1966485e744?s=128&d=identicon&r=PG&f=1", "display_name": "huggs", "link": "https://stackoverflow.com/users/2701902/huggs"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567640552, "post_id": 57796612, "comment_id": 102026502, "body": "Thanks, I will look into that"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567664389, "post_id": 57796612, "comment_id": 102031328, "body": "The actual output looks like the output of a json string passed to json.Marshal, i.e. json marshaling <i>&quot;twice&quot;</i>. So my guess is that the <code>result</code> variable in your example code is a <code>string</code> containing json in your actual code, and not <code>S</code>. You know that <code>WriteHeaderAndJson</code> does the json encoding and that you don&#39;t need to marshal the output yourself?"}, {"owner": {"reputation": 75, "user_id": 2701902, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/afd10c50c39bac73249eb1966485e744?s=128&d=identicon&r=PG&f=1", "display_name": "huggs", "link": "https://stackoverflow.com/users/2701902/huggs"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567810941, "post_id": 57796612, "comment_id": 102088698, "body": "@mkopriva The current code shows how I construct the json string, I do not marshall it before pasting to WriteHeaderAndJson, I also have another APi using the same struct as stated above wity WriteHeaderAndJson and that on happens to return the correct format."}], "owner": {"reputation": 75, "user_id": 2701902, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/afd10c50c39bac73249eb1966485e744?s=128&d=identicon&r=PG&f=1", "display_name": "huggs", "link": "https://stackoverflow.com/users/2701902/huggs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567638933, "creation_date": 1567638933, "question_id": 57796612, "link": "https://stackoverflow.com/questions/57796612/golang-writeheaderandjson-returns-wrong-result", "title": "Golang WriteHeaderAndJson returns wrong result", "body": "<p>I got the following code running in azure which returns wrong output when calling the api from Azure cloudshell, but returns correct result when I run it locally on my Ubuntu terminal.</p>\n\n<pre><code>type S struct {\nProperties SProperties `json:\"properties\"`\n}\n\ntype SProperties struct {\n    Available bool `json:\"available\"`\n}\n\nresult = S{\n    Properties: SProperties{\n        Available:            true,\n    },\n}\n\nContainerServiceRessource.SyncOperationContext.Response.WriteHeaderAndJson(200, result, \"application/json; charset=UTF-8\")\n</code></pre>\n\n<p>Expected output: </p>\n\n<p><code>{\n    \"properties\": {\n      \"available\": true\n    }\n }</code></p>\n\n<p>actual output:\n<code>{\\n  \\\"properties\\\": {\\n   \\\"available\\\": true\\n  }\\n }</code></p>\n\n<p>I don't know what is going on.\nI got 3 apis in the same format just returning different availabilities. two of them are not working well like stated above and the last one is working as expected.</p>\n\n<p>Any help is appreciated.\nThanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "edited": false, "score": 0, "creation_date": 1567633010, "post_id": 57795856, "comment_id": 102024991, "body": "You might want to consider the use of a library like <a href=\"https://github.com/jroimartin/gocui\" rel=\"nofollow noreferrer\">github.com/jroimartin/gocui</a> which has been used for apps such as console IRC client."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567638161, "post_id": 57795856, "comment_id": 102026081, "body": "Use goroutines to read concurrently from the terminal and network connections."}], "owner": {"reputation": 21, "user_id": 11897314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c22b5d51ff08ef1f3e70d6064d608e77?s=128&d=identicon&r=PG&f=1", "display_name": "EmileSteenkamp", "link": "https://stackoverflow.com/users/11897314/emilesteenkamp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567632659, "creation_date": 1567632659, "question_id": 57795856, "link": "https://stackoverflow.com/questions/57795856/i-want-to-receive-command-line-input-while-receiving-command-line-output", "title": "I want to receive command line input while receiving command line output", "body": "<p>I am currently creating a small command line chatroom app in Go, I was wondering if there was anyway i could receive command line input on a separate line (Where the user types messages to be sent) while receiving command line output (messages from other users)</p>\n"}, {"tags": ["go", "go-cobra"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1567636251, "post_id": 57795841, "comment_id": 102025712, "body": "It looks like you&#39;re expecting to see the environment variable set in the program after program terminates. That is not possible. Environment is copied when a program is executed, and changes made to that environment will stay local to the executed program and its children. Changes will not be visible to the shell that started the program."}, {"owner": {"reputation": 198, "user_id": 617122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4301f34f9b322cdcc901e680c0cd81e4?s=128&d=identicon&r=PG", "display_name": "distortedsignal", "link": "https://stackoverflow.com/users/617122/distortedsignal"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1567639328, "post_id": 57795841, "comment_id": 102026290, "body": "Thanks @bserdar - I&#39;ve voted you up, and I think that this is the correct answer. I&#39;ll keep the question around so that future generations can witness my failure. If this changes in the future, I hope someone answers this question."}], "owner": {"reputation": 198, "user_id": 617122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4301f34f9b322cdcc901e680c0cd81e4?s=128&d=identicon&r=PG", "display_name": "distortedsignal", "link": "https://stackoverflow.com/users/617122/distortedsignal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 581, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567632530, "creation_date": 1567632530, "question_id": 57795841, "link": "https://stackoverflow.com/questions/57795841/golang-set-environment-variable-from-inside-cobra-command", "title": "Golang - set environment variable from inside COBRA command", "body": "<p>In vanilla go, it seems pretty trivial to set an environment variable. The <code>os</code> library has a <code>Setenv</code> function that should get the job done. I'm running into trouble doing that inside of a cobra command. Is there a simple way that I'm missing, or is this functionality not supported at this point?</p>\n\n<p>Example of what I'm trying to do:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"github.com/spf13/cobra\"\n    \"github.com/spf13/pflag\"\n\n    \"k8s.io/cli-runtime/pkg/genericclioptions\"\n)\n\nfunc main() {\n    flags := pflag.NewFlagSet(\"ex-com\", pflag.ExitOnError)\n    pflag.CommandLine = flags\n\n    root := newCmdEx(genericclioptions.IOStreams{In: os.Stdin, Out: os.Stdout, ErrOut: os.Stderr})\n    if err := root.Execute(); err != nil {\n        fmt.Fprintf(os.Stdout, \"Error: %[1]s\", err.Error())\n        os.Exit(1)\n    }\n    os.Exit(0)\n}\n\ntype ExOpOptions struct {\n    configFlags genericclioptions.ConfigFlags\n}\n\nfunc NewExOpOptions(streams genericclioptions.IOStreams) *ExOpOptions {\n    return &amp;ExOpOptions{}\n}\n\nfunc newCmdEx(streams genericclioptions.IOStreams) *cobra.Command {\n    o := NewExOpOptions(streams)\n\n    cmd := &amp;cobra.Command{\n        RunE: func(c *cobra.Command, args []string) error {\n            return o.Run()\n        },\n    }\n\n    o.configFlags.AddFlags(cmd.Flags())\n\n    return cmd\n}\n\nfunc (o *ExOpOptions) Run() error {\n    return os.Setenv(\"THEBESTOFTIMES\", \"Sure it was.\")\n}\n</code></pre>\n\n<p>Example build and test script:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>GO111MODULE=\"on\" go build cmd/ex-com.go &amp;&amp; \\\n   echo \"First Print:\" &amp;&amp; \\\n   echo \"$THEBESTOFTIMES\" &amp;&amp; \\\n   ./ex-com &amp;&amp; \\\n   echo \"Second Print:\" &amp;&amp; \\\n   echo \"$THEBESTOFTIMES\"\n</code></pre>\n\n<p>I would expect the output to look like this (since the environment variable is being set on line 48 of the go code):</p>\n\n<pre><code>go: finding k8s.io/cli-runtime/pkg/genericclioptions latest\ngo: finding k8s.io/cli-runtime/pkg latest\ngo: finding k8s.io/cli-runtime latest\nFirst Print:\n\nSecond Print:\nSure it was.\n</code></pre>\n\n<p>But currently it looks like this:</p>\n\n<pre><code>go: finding k8s.io/cli-runtime/pkg/genericclioptions latest\ngo: finding k8s.io/cli-runtime/pkg latest\ngo: finding k8s.io/cli-runtime latest\nFirst Print:\n\nSecond Print:\n\n</code></pre>\n"}, {"tags": ["go", "concurrency", "download"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1567628914, "post_id": 57795207, "comment_id": 102023577, "body": "What is <code>config</code> and <code>configs</code> and where do they come from? Can you edit your question with a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">Minimal, Reproducible Example</a>?"}, {"owner": {"reputation": 3439, "user_id": 1887281, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/xV9qF.jpg?s=128&g=1", "display_name": "devinbost", "link": "https://stackoverflow.com/users/1887281/devinbost"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1567632572, "post_id": 57795207, "comment_id": 102024830, "body": "@Adrian How about now?"}], "answers": [{"comments": [{"owner": {"reputation": 3439, "user_id": 1887281, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/xV9qF.jpg?s=128&g=1", "display_name": "devinbost", "link": "https://stackoverflow.com/users/1887281/devinbost"}, "edited": false, "score": 0, "creation_date": 1567633050, "post_id": 57795377, "comment_id": 102025004, "body": "Should I be passing the config object by value or by reference? Your anonymous function expects a pointer, but the object is being passed by value."}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "reply_to_user": {"reputation": 3439, "user_id": 1887281, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/xV9qF.jpg?s=128&g=1", "display_name": "devinbost", "link": "https://stackoverflow.com/users/1887281/devinbost"}, "edited": false, "score": 1, "creation_date": 1567633168, "post_id": 57795377, "comment_id": 102025030, "body": "Oh, pass by value, I wasn&#39;t sure what your actual types are... edited the answer too to drop the ptr."}], "tags": [], "owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "is_accepted": true, "score": 2, "last_activity_date": 1567633184, "last_edit_date": 1567633184, "creation_date": 1567629657, "answer_id": 57795377, "question_id": 57795207, "link": "https://stackoverflow.com/questions/57795207/getting-same-file-downloaded-multiple-times-concurrently/57795377#57795377", "title": "Getting same file downloaded multiple times concurrently", "body": "<p>I'm pretty sure that your guess</p>\n\n<blockquote>\n  <p>This issue reminds me of what happens if you try to run a for loop with a closure and end up locking a single object instance into your loop and executing repeatedly on the same object. </p>\n</blockquote>\n\n<p>is correct. The simple fix is to \"assign to local var\" like</p>\n\n<pre><code>for _, config := range configs {\n    wg.Add(1)\n    cur := config\n    go cur.downloadFile(&amp;wg)\n}\n</code></pre>\n\n<p>but I don't like APIs which take waitgroup as a parameter so I suggest</p>\n\n<pre><code>for _, config := range configs {\n    wg.Add(1)\n    go func(cur Config) {\n       defer wg.Done()\n       cur.downloadFile()\n    }(config)\n}\n</code></pre>\n\n<p>and change <code>downloadFile</code> signature to <code>func (config *Config) downloadFile()</code> and drop the <code>wg</code> usage in it.</p>\n"}], "owner": {"reputation": 3439, "user_id": 1887281, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/xV9qF.jpg?s=128&g=1", "display_name": "devinbost", "link": "https://stackoverflow.com/users/1887281/devinbost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 57795377, "answer_count": 1, "score": 1, "last_activity_date": 1567667067, "creation_date": 1567628587, "last_edit_date": 1567667067, "question_id": 57795207, "link": "https://stackoverflow.com/questions/57795207/getting-same-file-downloaded-multiple-times-concurrently", "title": "Getting same file downloaded multiple times concurrently", "body": "<p>I am concurrently downloading files (with a WaitGroup) from a slice of config objects (where each config object contains the URL that needs to be downloaded), but when I use concurrency, I get the same exact data written with every execution. </p>\n\n<p>I believe I included everything below for a minimal reproducible example.</p>\n\n<p>Here are my imports:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"path\"\n    \"path/filepath\"\n    \"strconv\"\n    \"strings\"\n    \"sync\"\n)\n</code></pre>\n\n<p>The method that's looping through my objects and executing the go routine to download each file is here:</p>\n\n<pre><code>func downloadAllFiles(configs []Config) {\n    var wg sync.WaitGroup\n    for i, config := range configs {\n        wg.Add(1)\n        go config.downloadFile(&amp;wg)\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>Basically, my function is downloading a file from a URL into a directory stored on NFS. </p>\n\n<p>Here is the download function:</p>\n\n<pre><code>func (config *Config) downloadFile(wg *sync.WaitGroup) {\n    resp, _ := http.Get(config.ArtifactPathOrUrl)\n    fmt.Println(\"Downloading file: \" + config.ArtifactPathOrUrl)\n    fmt.Println(\" to location: \" + config.getNfsFullFileSystemPath())\n    defer resp.Body.Close()\n\n    nfsDirectoryPath := config.getBaseNFSFileSystemPath()\n    os.MkdirAll(nfsDirectoryPath, os.ModePerm)\n    fullFilePath := config.getNfsFullFileSystemPath()\n    out, err := os.Create(fullFilePath)\n    if err != nil {\n        panic(err)\n    }\n    defer out.Close()\n\n    io.Copy(out, resp.Body)\n    wg.Done()\n}\n</code></pre>\n\n<p>Here's a minimal part of the Config struct:</p>\n\n<pre><code>type Config struct {\n    Namespace                 string                      `json:\"namespace,omitempty\"`\n    Tenant                    string                      `json:\"tenant,omitempty\"`\n    Name                      string                      `json:\"name,omitempty\"`\n    ArtifactPathOrUrl         string                      `json:\"artifactPathOrUrl,omitempty\"`\n}\n</code></pre>\n\n<p>Here are the instance/helper functions:</p>\n\n<pre><code>func (config *Config) getDefaultNfsURLBase() string {\n    return \"http://example.domain.nfs.location.com/\"\n}\n\nfunc (config *Config) getDefaultNfsFilesystemBase() string {\n    return \"/data/nfs/location/\"\n}\n\nfunc (config *Config) getBaseNFSFileSystemPath() string {\n    basePath := filepath.Dir(config.getNfsFullFileSystemPath())\n    return basePath\n}\n\nfunc (config *Config) getNfsFullFileSystemPath() string {\n    // basePath is like: /data/nfs/location/\n    trimmedBasePath := strings.TrimSuffix(config.getDefaultNfsFilesystemBase(), \"/\")\n    fileName := config.getBaseFileName()\n    return trimmedBasePath + \"/\" + config.Tenant + \"/\" + config.Namespace + \"/\" + config.Name + \"/\" + fileName\n}\n</code></pre>\n\n<p>Here is how I'm getting the configs and unmarshalling them:</p>\n\n<pre><code>func getConfigs() string {\n    b, err := ioutil.ReadFile(\"pulsarDeploy_example.json\")\n    if err != nil {\n        fmt.Print(err)\n    }\n    str := string(b) // convert content to a 'string'\n    return str\n}\n\nfunc deserializeJSON(configJson string) []Config {\n    jsonAsBytes := []byte(configJson)\n    configs := make([]Config, 0)\n    err := json.Unmarshal(jsonAsBytes, &amp;configs)\n    if err != nil {\n        panic(err)\n    }\n    return configs\n}\n</code></pre>\n\n<p>For a minimal example, I think this data for the <code>pulsarDeploy_example.json</code> file should work:</p>\n\n<pre><code>[{   \"artifactPathOrUrl\": \"http://www.java2s.com/Code/JarDownload/sample/sample.jar.zip\",\n        \"namespace\": \"exampleNamespace1\",\n        \"name\": \"exampleName1\",\n        \"tenant\": \"exampleTenant1\"\n      },\n\n      {   \n        \"artifactPathOrUrl\": \"http://www.java2s.com/Code/JarDownload/sample-calculator/sample-calculator-bundle-2.0.jar.zip\",\n        \"namespace\": \"exampleNamespace1\",\n        \"name\": \"exampleName2\",\n        \"tenant\": \"exampleTenant1\"\n      },\n      {   \n        \"artifactPathOrUrl\": \"http://www.java2s.com/Code/JarDownload/helloworld/helloworld.jar.zip\",\n        \"namespace\": \"exampleNamespace1\",\n        \"name\": \"exampleName3\",\n        \"tenant\": \"exampleTenant1\"\n      },\n      {   \n        \"artifactPathOrUrl\": \"http://www.java2s.com/Code/JarDownload/fabric-activemq/fabric-activemq-demo-7.0.2.fuse-097.jar.zip\",\n        \"namespace\": \"exampleNamespace1\",\n        \"name\": \"exampleName4\",\n        \"tenant\": \"exampleTenant1\"\n      }\n]\n</code></pre>\n\n<p>(Note that the example file URLs were just random Jars I grabbed online.)</p>\n\n<p>When I run my code, instead of downloading each file, it repeatedly downloads the same file, and the information it prints to the console (from the <code>Downloading file:</code> and <code>to location:</code> lines) is exactly the same for each object (instead of printing the messages that are unique to each object), which definitely is a concurrency issue. </p>\n\n<p>This issue reminds me of what happens if you try to run a <code>for loop</code> with a closure and end up locking a single object instance into your loop and executing repeatedly on the same object. </p>\n\n<p>What is causing this behavior, and how do I resolve it?</p>\n"}, {"tags": ["go", "hyperledger-fabric", "shim", "hyperledger-chaincode"], "comments": [{"owner": {"reputation": 1, "user_id": 8500692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76a56a1e941d12f0ffb0ad36ce141e67?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek", "link": "https://stackoverflow.com/users/8500692/abhishek"}, "edited": false, "score": 0, "creation_date": 1567622347, "post_id": 57794066, "comment_id": 102021408, "body": "Till now data listed in FIFO order, but I am not sure about it if it will happen always?"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 8500692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76a56a1e941d12f0ffb0ad36ce141e67?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek", "link": "https://stackoverflow.com/users/8500692/abhishek"}, "is_accepted": true, "score": 0, "last_activity_date": 1574159995, "creation_date": 1574159995, "answer_id": 58932084, "question_id": 57794066, "link": "https://stackoverflow.com/questions/57794066/how-does-shim-getstatebypartialcompositekey-iterator-works-in-this-code/58932084#58932084", "title": "How does shim.GetStateByPartialCompositeKey iterator works in this code?", "body": "<p>GetStateByPartialCompositeKey queries the state in the ledger based on a given partial composite key. This function returns an iterator which can be used to iterate over the composite keys whose prefix matches the given partial composite key. </p>\n\n<p>Read <a href=\"https://github.com/hyperledger/fabric-chaincode-go/blob/master/shim/interfaces.go\" rel=\"nofollow noreferrer\">https://github.com/hyperledger/fabric-chaincode-go/blob/master/shim/interfaces.go</a></p>\n\n<p>Now, as per the question,</p>\n\n<blockquote>\n  <p>data I listed from the iterator comes in sorted order in terms of timestamp</p>\n</blockquote>\n\n<p>No. It wont be in the sorted order. Such as, if you have bulk data which you are querying \nthen the iterator will get all the composite keys which will not be necessarily in sorted order. Hence you have to sort them.</p>\n\n<p>One of the way of doing this is to use sort.Sort() function.\nSimilar approach is asked here <a href=\"https://stackoverflow.com/questions/23121026/how-to-sort-by-time-time\">How to sort by time.Time</a></p>\n"}], "owner": {"reputation": 1, "user_id": 8500692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76a56a1e941d12f0ffb0ad36ce141e67?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek", "link": "https://stackoverflow.com/users/8500692/abhishek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 58932084, "answer_count": 1, "score": 0, "last_activity_date": 1574159995, "creation_date": 1567622074, "question_id": 57794066, "link": "https://stackoverflow.com/questions/57794066/how-does-shim-getstatebypartialcompositekey-iterator-works-in-this-code", "title": "How does shim.GetStateByPartialCompositeKey iterator works in this code?", "body": "<p>I am writing the chaincode in which I am putting some data into ledger and then tried to list it using shim.GetStateByPartialCompositeKey() where I get the list of my data from the iterator. Now I want to sort my data according to the timestamp(which is formatted in terms of date only and not taking hours, minutes or seconds). So, I want to know if the data I listed from the iterator comes in sorted order in terms of timestamp in which they are stored in ledger or do I need to sort them?!</p>\n\n<pre><code>var AvalList = make([]A, 0)\niterator, err := stub.GetStateByPartialCompositeKey(\"AId~BId\", []string{AId})\n    if err != nil {\n        fmt.Println(\"error is \", err)\n        return shim.Error(err.Error())\n    }\n    fmt.Println(\"Iterator is \", iterator)\n    if !iterator.HasNext() {\n        fmt.Println(\"---------------------  Iterator not found!!!  --------------------\")\n        return shim.Error(err.Error())\n    }\n    defer iterator.Close()\n\n    for i := 0; iterator.HasNext(); i++ {\n        ARange, err := iterator.Next()\n        if err != nil {\n            return shim.Error(err.Error())\n        }\n\n        objectType, compositeKeyParts, err := stub.SplitCompositeKey(ARange.Key)\n        if err != nil {\n            return shim.Error(err.Error())\n        }\n\n        returnedA := compositeKeyParts[1]\n        fmt.Printf(\"Found a A of index %s and id %s \", objectType, returnedA)\n\n        ABytes, err := stub.GetState(returnedA)\n        if err != nil {\n            return shim.Error(err.Error())\n        }\n        if ABytes == nil {\n            fmt.Println(\"A not found\")\n            return shim.Error(\"Entity not found\")\n        }\n\n\n        a := A{}\n        err = json.Unmarshal(ABytes, &amp;a)\n        if err != nil {\n            return shim.Error(\"Failed to unmarshal\")\n        }\n\n            AvalList = append(AvalList, a)\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9371, "user_id": 196964, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/df6zG.jpg?s=128&g=1", "display_name": "Doug Richardson", "link": "https://stackoverflow.com/users/196964/doug-richardson"}, "edited": false, "score": 0, "creation_date": 1567633198, "post_id": 57793809, "comment_id": 102025037, "body": "The same error occurs with this command as well: <code>go build -buildmode=shared</code>. I&#39;m using go 1.13."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 2, "creation_date": 1568331728, "post_id": 57793809, "comment_id": 102249896, "body": "Did you see this issue on the golang repo about the same error? <a href=\"https://github.com/golang/go/issues/17177\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/17177</a>"}, {"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1568395611, "post_id": 57793809, "comment_id": 102273487, "body": "What are you trying to achieve?"}, {"owner": {"reputation": 2704, "user_id": 6794772, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d8db2b0d48b6e1b25657fda9ec4ae02?s=128&d=identicon&r=PG&f=1", "display_name": "Dellowar", "link": "https://stackoverflow.com/users/6794772/dellowar"}, "reply_to_user": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1568405709, "post_id": 57793809, "comment_id": 102277189, "body": "@Seaskyways Make a shared library (lib.so)"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1568561978, "post_id": 57793809, "comment_id": 102304729, "body": "What happens if you try CGO_ENABLED=0 go build -buildmode=shared -linkshared test?"}, {"owner": {"reputation": 1295, "user_id": 2279765, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/432916361960d8ddbb2d4bdb8369b78f?s=128&d=identicon&r=PG", "display_name": "Tomer", "link": "https://stackoverflow.com/users/2279765/tomer"}, "edited": false, "score": 1, "creation_date": 1568838476, "post_id": 57793809, "comment_id": 102406420, "body": "maybe it&#39;s because you don&#39;t have any cgo code? Why are you trying to make an .so library in a non c/c++ code?"}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 13129480, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GgIcucDW64VeTNk36sF2KLwGIRSQj8qctMvfTv1Fg=k-s128", "display_name": "Alexei Aguiar", "link": "https://stackoverflow.com/users/13129480/alexei-aguiar"}, "is_accepted": false, "score": 0, "last_activity_date": 1585271618, "creation_date": 1585271618, "answer_id": 60878572, "question_id": 57793809, "link": "https://stackoverflow.com/questions/57793809/go-1-10-cannot-implicitly-include-runtime-cgo-in-a-shared-library/60878572#60878572", "title": "go 1.10: cannot implicitly include runtime/cgo in a shared library", "body": "<p>It worked for me with this procedure:</p>\n\n<pre><code>$ docker run -it golang /bin/sh\n# cd src\n# mkdir test\n# cat &lt;&lt; EOF &gt; test/lib.go\n&gt; package test\nimport \"fmt\"\nfunc Hello() {\n    fmt.Println(\"Hi\")\n}&gt; &gt; &gt; &gt; \n&gt; EOF\n# cat test/lib.go\npackage test\nimport \"fmt\"\nfunc Hello() {\n    fmt.Println(\"Hi\")\n}\n# go install -buildmode=shared -linkshared std\n# ldd /usr/local/go/pkg/linux_amd64_dynlink/libstd.so\n    linux-vdso.so.1 (0x00007fff4093d000)\n    libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f3454de5000)\n    libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f3454dc4000)\n    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f3454c03000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007f3457514000)\n# go install -buildmode=shared -linkshared test\n# ldd /go/pkg/linux_amd64_dynlink/libtest.so\n    linux-vdso.so.1 (0x00007ffddbbeb000)\n    libstd.so =&gt; /usr/local/go/pkg/linux_amd64_dynlink/libstd.so (0x00007f82bc8cf000)\n    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f82bc70a000)\n    libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f82bc705000)\n    libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f82bc6e4000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007f82bf0fc000)\n# \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2704, "user_id": 6794772, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d8db2b0d48b6e1b25657fda9ec4ae02?s=128&d=identicon&r=PG&f=1", "display_name": "Dellowar", "link": "https://stackoverflow.com/users/6794772/dellowar"}, "is_accepted": true, "score": 0, "last_activity_date": 1585540879, "creation_date": 1585540879, "answer_id": 60923873, "question_id": 57793809, "link": "https://stackoverflow.com/questions/57793809/go-1-10-cannot-implicitly-include-runtime-cgo-in-a-shared-library/60923873#60923873", "title": "go 1.10: cannot implicitly include runtime/cgo in a shared library", "body": "<p>The problem was I didn't import <code>cgo</code> anywhere. So that means no functions were to be exported which means there's nothing to build into a library.</p>\n"}], "owner": {"reputation": 2704, "user_id": 6794772, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/2d8db2b0d48b6e1b25657fda9ec4ae02?s=128&d=identicon&r=PG&f=1", "display_name": "Dellowar", "link": "https://stackoverflow.com/users/6794772/dellowar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 1, "accepted_answer_id": 60923873, "answer_count": 2, "score": 7, "last_activity_date": 1617711824, "creation_date": 1567620819, "last_edit_date": 1567637639, "question_id": 57793809, "link": "https://stackoverflow.com/questions/57793809/go-1-10-cannot-implicitly-include-runtime-cgo-in-a-shared-library", "title": "go 1.10: cannot implicitly include runtime/cgo in a shared library", "body": "<p>I'm trying to execute <code>go build -buildmode=shared -linkshared test</code> but I'm getting the error:</p>\n\n<pre><code>go 1.10: cannot implicitly include runtime/cgo in a shared library\n</code></pre>\n\n<p>I have only one file in that package</p>\n\n<p><strong>lib.go</strong></p>\n\n<pre><code>package test\nimport \"fmt\"\nfunc Hello() {\n    fmt.Println(\"Hi\")\n}\n</code></pre>\n\n<p>I'm on a linux machine running <em>go1.10.4 linux/amd64</em></p>\n"}, {"tags": ["sql", "go", "struct"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1567618530, "post_id": 57793141, "comment_id": 102019845, "body": "You can use <a href=\"https://golang.org/pkg/database/sql/#Rows.Columns\" rel=\"nofollow noreferrer\"><code>rows.Columns</code></a> and <a href=\"https://golang.org/pkg/database/sql/#Rows.ColumnTypes\" rel=\"nofollow noreferrer\"><code>rows.ColumnTypes</code></a>, with that you can initialize the correct number of variables with the correct struct in the correct order, scan the results into them and then drop that into a map. No need for a struct if your don&#39;t want to use one."}, {"owner": {"reputation": 9, "user_id": 7183025, "user_type": "registered", "profile_image": "https://graph.facebook.com/1319271094750351/picture?type=large", "display_name": "Pratik Saha Joy", "link": "https://stackoverflow.com/users/7183025/pratik-saha-joy"}, "edited": false, "score": 0, "creation_date": 1567618712, "post_id": 57793141, "comment_id": 102019908, "body": "could you please give me an example or a outline of the code that you are talking about?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567619534, "post_id": 57793141, "comment_id": 102020211, "body": "Something like this: <a href=\"https://play.golang.com/p/uulYPBhokve\" rel=\"nofollow noreferrer\">play.golang.com/p/uulYPBhokve</a> I haven&#39;t tested it so there are probably some bugs but I&#39;m sure you can fix them."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567619747, "post_id": 57793141, "comment_id": 102020307, "body": "<a href=\"https://play.golang.com/p/ODlIxs-XLFE\" rel=\"nofollow noreferrer\">play.golang.com/p/ODlIxs-XLFE</a> oops the previous version was storing each row into the same map, instead this version stores each row into its own map and then appends the maps to a slice."}], "owner": {"reputation": 9, "user_id": 7183025, "user_type": "registered", "profile_image": "https://graph.facebook.com/1319271094750351/picture?type=large", "display_name": "Pratik Saha Joy", "link": "https://stackoverflow.com/users/7183025/pratik-saha-joy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567617595, "creation_date": 1567617595, "question_id": 57793141, "link": "https://stackoverflow.com/questions/57793141/making-a-general-select-function-for-sql-library-operations", "title": "making a general select function for sql library operations", "body": "<p>well i am trying to make a select function which will work like this,</p>\n\n<p>From main function i will call this select function with necessary variables. and the select function will run the query in the database and give me the reselt.</p>\n\n<p>Now for go lang if we want to do a select query for the results we need a struct where we can get the results. Since the function will be called from main func and the variables can not be predicted we cant declare a struct before hand so i am stuck here. can anyone give me a solution?</p>\n\n<p>so basically what i am trying to do is we can simply call the query like </p>\n\n<p>-- select name,phone from users where userid=1 ---\nso from the main func we will get the values like column name(name,phone), table name (users) and the condition (userid=1)</p>\n\n<p>we will pass these info to the select func and it will run the query and give us back the results.</p>\n\n<p>no matter what is the query is it should work like it. can anyone give me an sample or idea how to work with this</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func select() {\n  //DB CONNECTION HERE\n\ntype User struct {\n        Name    string `json:\"name\"`\n        Age     string `json:\"age\"`\n        Email   string `json:\"email\"`\n        Phone   string `json:\"phone\"`\n        Address string `json:\"address\"`\n    }\n\n    results, err := db.Query(\"SELECT Name, Age, Email, Phone, Address FROM `users` where personId=12 \")\n    if err != nil {\n        panic(err.Error())\n    }\n\n    for results.Next() {\n        var user User\n        var email User\n        var age User\n        var phone User\n        var address User\n\n        err = results.Scan(&amp;user.Name, &amp;age.Age, &amp;email.Email, &amp;phone.Phone, &amp;address.Address)\n\n        if err != nil {\n            panic(err.Error())\n        }\n\n        fmt.Println(user.Name)\n        fmt.Println(age.Age)\n        fmt.Println(email.Email)\n        fmt.Println(phone.Phone)\n        fmt.Println(address.Address)\n    }\n</code></pre>\n\n<p>Now as zou can see this is the code where we know the query so we made a struct according to it but what about the problem i described above?</p>\n"}, {"tags": ["go", "networking", "active-directory", "gitea"], "comments": [{"owner": {"reputation": 4989, "user_id": 3745413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jQsNL.png?s=128&g=1", "display_name": "Ron Maupin", "link": "https://stackoverflow.com/users/3745413/ron-maupin"}, "edited": false, "score": 1, "creation_date": 1567616666, "post_id": 57792093, "comment_id": 102019095, "body": "That is an ephemeral source port. When an application creates a connection to a different host, the source port is chosen (somewhat) randomly from an unused port in the list of ephemeral ports on the host OS. You should whitelist the network address, not the transport address."}], "answers": [{"tags": [], "owner": {"reputation": 28745, "user_id": 1202807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e09276b9edb245e928e7163b27b15691?s=128&d=identicon&r=PG", "display_name": "Gabriel Luci", "link": "https://stackoverflow.com/users/1202807/gabriel-luci"}, "is_accepted": true, "score": 3, "last_activity_date": 1567616748, "creation_date": 1567616748, "answer_id": 57792965, "question_id": 57792093, "link": "https://stackoverflow.com/questions/57792093/error-trying-to-connect-to-ad-server-from-gitea/57792965#57792965", "title": "Error trying to connect to AD server from Gitea", "body": "<p>The <code>37590</code> that you see is the source port. It is the port that the server will use when replying and helps your computer know which application the response is for. It's normal for that to change on each request.</p>\n\n<p>You are correct in thinking that this is a network problem. The error message \"connection reset by peer\" means that someone along the line (either a firewall along the path, or the host itself) closed the connection. (a little more detail <a href=\"https://stackoverflow.com/a/1434506/1202807\">here</a>)</p>\n\n<p>If it is a firewall that is not allowing you, then you need a rule allowing access from <code>gitea host ip:any</code> to <code>ad server ip:389</code>.</p>\n"}], "owner": {"reputation": 309, "user_id": 919933, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0adfae4ae5b3de19ef15e03306b94d0d?s=128&d=identicon&r=PG", "display_name": "Rodrigo Balest", "link": "https://stackoverflow.com/users/919933/rodrigo-balest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "accepted_answer_id": 57792965, "answer_count": 1, "score": 0, "last_activity_date": 1567616748, "creation_date": 1567612755, "question_id": 57792093, "link": "https://stackoverflow.com/questions/57792093/error-trying-to-connect-to-ad-server-from-gitea", "title": "Error trying to connect to AD server from Gitea", "body": "<p>I configured Gitea to authenticate against an AD server, and I'm receiving the following error:</p>\n\n<pre><code>[...dels/login_source.go:390 LoginViaLDAP()] [E] LDAP Connect error, my.ad.server.address.here:LDAP Result Code 200 \"Network Error\": read tcp &lt;gitea host ip&gt;:37590-&gt;&lt;ad server ip&gt;:389: read: connection reset by peer\n</code></pre>\n\n<p>What is strange to me is that the number 37590 in the example above always changes at each occurrence. Is it a port number? If true, how can I track it so I can whitelist it at the AD server firewall?</p>\n\n<p>I'm a newbie in Go, so I can't figure out what's happening.</p>\n"}, {"tags": ["oop", "go", "design-patterns", "dependency-injection", "interface"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567612273, "post_id": 57791917, "comment_id": 102017103, "body": "<code>public Handler(Storage storage, Mapper mapper) {</code> in Go would be <code>NewHandler(storage Storage, mapper Mapper) *Handler {...</code>"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1567612680, "creation_date": 1567612680, "answer_id": 57792078, "question_id": 57791917, "link": "https://stackoverflow.com/questions/57791917/golang-embedding-interfaces-in-struct-with-private-access/57792078#57792078", "title": "Golang embedding interfaces in struct with private access", "body": "<p>Those are not embedded; embedding has a specific meaning in Go, <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">as outlined in the spec</a>, and as explained in the Effective Go section you linked to. It refers to unnamed fields, whose fields and methods are accessible implicitly from their containing type. Your fields are named, not embedded.</p>\n\n<p>That said, your two struct fields, <code>store</code> and <code>mapper</code>, are not exported, so they will not be exposed to any user outside the package in which <code>Handler</code> is defined; you seem to already have your desired behavior in that regard.</p>\n\n<p>I'm not sure what you mean when you say you would have to \"create factory methods for each possible combination\" - I don't see any reason that would be necessary. You need only one factory method:</p>\n\n<pre><code>func NewHandler(s Storage, m Mapper) Handler {\n    return Handler{store: s, mapper: m}\n}\n</code></pre>\n\n<p>Which could be used with any combination of implementations of <code>Storage</code> and <code>Mapper</code> by passing appropriate values to the function.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4078581"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 0, "accepted_answer_id": 57792078, "answer_count": 1, "score": -2, "last_activity_date": 1567612680, "creation_date": 1567612078, "question_id": 57791917, "link": "https://stackoverflow.com/questions/57791917/golang-embedding-interfaces-in-struct-with-private-access", "title": "Golang embedding interfaces in struct with private access", "body": "<p>I want to replicate the following Java code in Golang in the most idiomatic way possible:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>public class Handler {\n\n    private Storage storage;\n    private Mapper mapper;\n\n    public Handler(Storage storage, Mapper mapper) {\n        this.storage = storage;\n        this.mapper = mapper;\n    }\n\n    public void handleKey(String k) {\n        storage.put(k, mapper.map(k));\n    }\n\n}\n\ninterface Storage {\n    public void put(String k, String v);\n    public String get(String k);\n}\n\n@FunctionalInterface\ninterface Mapper {\n    public String map(String a);\n}\n\nprivate static class InMemoryStorage implements Storage {\n    private Map&lt;String, String&gt; table;\n\n    public InMemoryStorage() {\n        table = new HashMap&lt;&gt;();\n    }\n\n    public void put(String k, String v) {\n        table.put(k, v);\n    }\n\n    public String get(String k) {\n        return table.get(k);\n    }\n}\n</code></pre>\n\n<p><code>Handler</code> class only exposes the method <code>handleKey</code>. The behaviour of this class is parametrized by passing different concrete <code>Storage</code> and <code>Mapper</code> implementations.</p>\n\n<p>After reading <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">Effective Go - Embedding</a>, I thought this would be a good use of embedding interfaces intro structs. But I can't figure out how to avoid exposing the embedded interfaces' methods to <code>Handler</code> users. I can do something like</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Handler struct {\n    store  Storage\n    mapper Mapper\n}\n\nfunc (h Handler) Handle(k string) {\n    h.store.Put(k, h.mapper.Map(k))\n}\n\ntype Storage interface {\n    Put(k string, v string)\n    Get(k string) string\n}\n\ntype Mapper interface {\n    Map(k string) string\n}\n\ntype inMemoryStorage {\n    table map[string]string\n}\n\nfunc NewInMemoryStorage() Storage {\n    return &amp;inMemoryStore{table: make(map[string]string)}\n}\n</code></pre>\n\n<p>but then I cannot pass concrete implementations to the <code>Handler</code> (creating struct literal) because <code>store</code> and <code>mapper</code> are unexported. And I do not want to create factory methods for each possible combination... Any suggestions?</p>\n"}, {"tags": ["go", "base64"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1567613323, "post_id": 57791873, "comment_id": 102017663, "body": "Not stream based, but maybe something can be hacked out using encoding/pem"}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1567666893, "post_id": 57794272, "comment_id": 102032312, "body": "&quot;simple Writer class&quot; -- Note, this is not a class. Go doesn&#39;t have classes. It would be better to call it (and think of it as) a type instead."}, {"owner": {"reputation": 568, "user_id": 8545455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83e3f3b9695712c0e752d3e68be30d37?s=128&d=identicon&r=PG", "display_name": "steve", "link": "https://stackoverflow.com/users/8545455/steve"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1567674520, "post_id": 57794272, "comment_id": 102036043, "body": "Thanks, keep forgetting that. I think it&#39;s a method that acts on a type."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1567680390, "post_id": 57794272, "comment_id": 102039179, "body": "<code>io.WriteCloser</code> is an interface. Interfaces are types. Your implementation is a type, which happens to be a struct, with the necessary methods."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1567680476, "post_id": 57794272, "comment_id": 102039232, "body": "BTW, I don&#39;t think there&#39;s any reason for you to return an <code>io.WriteCloser</code> as opposed to just an <code>io.Writer</code>."}, {"owner": {"reputation": 568, "user_id": 8545455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83e3f3b9695712c0e752d3e68be30d37?s=128&d=identicon&r=PG", "display_name": "steve", "link": "https://stackoverflow.com/users/8545455/steve"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1571056040, "post_id": 57794272, "comment_id": 103102295, "body": "Thanks. I have made it a Writer and removed my Close method as it does nothing. Update in <a href=\"https://github.com/tuck1s/go-smtpproxy/blob/c7885f44b04c998d4bac20b953030ed61b6dca69/linesplitter.go#L24\" rel=\"nofollow noreferrer\">github.com/tuck1s/go-smtpproxy/blob/&hellip;</a>"}], "tags": [], "owner": {"reputation": 568, "user_id": 8545455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83e3f3b9695712c0e752d3e68be30d37?s=128&d=identicon&r=PG", "display_name": "steve", "link": "https://stackoverflow.com/users/8545455/steve"}, "is_accepted": true, "score": 0, "last_activity_date": 1567674479, "last_edit_date": 1567674479, "creation_date": 1567622998, "answer_id": 57794272, "question_id": 57791873, "link": "https://stackoverflow.com/questions/57791873/base64-encoding-with-limited-line-length-as-per-rfc2045/57794272#57794272", "title": "base64 encoding with limited line length as per RFC2045", "body": "<p>Here's my attempt to create a simple <code>Writer</code>. It takes into account varying amounts of input data, has configurable chunk length and separator sequence. It uses byte-slice writes for the chunks, which will hopefully be efficient.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/base64\"\n    \"io\"\n    \"os\"\n    \"strings\"\n)\n\nfunc min(a, b int) int {\n    if a &lt; b {\n        return a\n    }\n    return b\n}\n\ntype linesplitter struct {\n    len   int\n    count int\n    sep   []byte\n    w     io.Writer\n}\n\n// NewWriter that splits input every len bytes with a sep byte sequence, outputting to writer w\nfunc (ls *linesplitter) NewWriter(len int, sep []byte, w io.Writer) io.WriteCloser {\n    return &amp;linesplitter{len: len, count: 0, sep: sep, w: w}\n}\n\n// Split a line in to ls.len chunks with separator\nfunc (ls *linesplitter) Write(in []byte) (n int, err error) {\n    writtenThisCall := 0\n    readPos := 0\n    // Leading chunk size is limited by: how much input there is; defined split length; and\n    // any residual from last time\n    chunkSize := min(len(in), ls.len-ls.count)\n    // Pass on chunk(s)\n    for {\n        ls.w.Write(in[readPos:(readPos + chunkSize)])\n        readPos += chunkSize // Skip forward ready for next chunk\n        ls.count += chunkSize\n        writtenThisCall += chunkSize\n\n        // if we have completed a chunk, emit a separator\n        if ls.count &gt;= ls.len {\n            ls.w.Write(ls.sep)\n            writtenThisCall += len(ls.sep)\n            ls.count = 0\n        }\n        inToGo := len(in) - readPos\n        if inToGo &lt;= 0 {\n            break // reached end of input data\n        }\n        // Determine size of the NEXT chunk\n        chunkSize = min(inToGo, ls.len)\n    }\n    return writtenThisCall, nil\n}\n\nfunc (ls *linesplitter) Close() (err error) {\n    return nil\n}\n\n// See https://www.ietf.org/rfc/rfc2045.txt, section 6.8 for notes on maximum line length of 76 characters\nfunc main() {\n    data := \"It is only the hairs on a gooseberry that prevent it from being a grape! This is long enough to need a line split\"\n    shortData := \"hello there\"\n\n    var ls linesplitter\n    lsWriter := ls.NewWriter(76, []byte(\"\\r\\n\"), os.Stdout)\n    wrt := base64.NewEncoder(base64.StdEncoding, lsWriter)\n\n    for i := 0; i &lt; 10; i++ {\n        io.Copy(wrt, strings.NewReader(shortData))\n        io.Copy(wrt, strings.NewReader(data))\n        io.Copy(wrt, strings.NewReader(shortData))\n    }\n}\n</code></pre>\n\n<p>... comments/improvements welcome.</p>\n"}], "owner": {"reputation": 568, "user_id": 8545455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83e3f3b9695712c0e752d3e68be30d37?s=128&d=identicon&r=PG", "display_name": "steve", "link": "https://stackoverflow.com/users/8545455/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 0, "accepted_answer_id": 57794272, "answer_count": 1, "score": 4, "last_activity_date": 1567674479, "creation_date": 1567611929, "last_edit_date": 1567612622, "question_id": 57791873, "link": "https://stackoverflow.com/questions/57791873/base64-encoding-with-limited-line-length-as-per-rfc2045", "title": "base64 encoding with limited line length as per RFC2045", "body": "<p>RFC2045 section 6.8 states maximum encoded line length of base64 output should be 76 characters or less.</p>\n\n<p>The Golang stream writer <code>base64.NewEncoder</code> does not have any option for line splitting, as can be seen here.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/base64\"\n    \"io\"\n    \"os\"\n    \"strings\"\n)\n\n\n// See https://www.ietf.org/rfc/rfc2045.txt, section 6.8 for notes on maximum line length of 76 characters\nfunc main() {\n    data := \"It is only the hairs on a gooseberry that prevent it from being a grape! This is long enough to need a line split\"\n    rdr := strings.NewReader(data)\n    wrt := base64.NewEncoder(base64.StdEncoding, os.Stdout)\n    io.Copy(wrt, rdr)\n}\n</code></pre>\n\n<p>Output is </p>\n\n<pre><code>SXQgaXMgb25seSB0aGUgaGFpcnMgb24gYSBnb29zZWJlcnJ5IHRoYXQgcHJldmVudCBpdCBmcm9tIGJlaW5nIGEgZ3JhcGUhIEl0IGlzIG9ubHkgdGhlIGhhaXJzIG9uIGEgZ29vc2ViZXJyeSB0aGF0IHByZXZlbnQgaXQgZnJvbSBiZWluZyBhIGdyYXBl\n</code></pre>\n\n<p>Is there a <strong>stream-based solution</strong> to splitting lines?\nThe <a href=\"https://golang.org/pkg/mime/#WordDecoder.Decode\" rel=\"nofollow noreferrer\">MIME library</a> offers only string based encoding options.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-platform"], "comments": [{"owner": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "edited": false, "score": 1, "creation_date": 1567608989, "post_id": 57790884, "comment_id": 102015326, "body": "It should be under <code>c:\\gopath</code> not the <code>c:\\gopath\\projects</code>"}, {"owner": {"reputation": 21, "user_id": 12020448, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MwzhUMk5MZM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd0OPutqbwBBtSCRnL0QziK0cqFAw/photo.jpg?sz=128", "display_name": "David M", "link": "https://stackoverflow.com/users/12020448/david-m"}, "reply_to_user": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "edited": false, "score": 0, "creation_date": 1567665601, "post_id": 57790884, "comment_id": 102031759, "body": "same problem - i think i will test it on a linux machine"}, {"owner": {"reputation": 21, "user_id": 12020448, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MwzhUMk5MZM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd0OPutqbwBBtSCRnL0QziK0cqFAw/photo.jpg?sz=128", "display_name": "David M", "link": "https://stackoverflow.com/users/12020448/david-m"}, "reply_to_user": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "edited": false, "score": 1, "creation_date": 1568207723, "post_id": 57790884, "comment_id": 102201615, "body": "fixed. wrong folder structure. didn&#180;t have my code in the src folder in gopath."}, {"owner": {"reputation": 765, "user_id": 803990, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a3ac59c0c88ed76f18d96488ac9cd9a5?s=128&d=identicon&r=PG", "display_name": "Bj&#248;rn Kjos-Hanssen", "link": "https://stackoverflow.com/users/803990/bj%c3%b8rn-kjos-hanssen"}, "edited": false, "score": 0, "creation_date": 1584046105, "post_id": 57790884, "comment_id": 107324481, "body": "@DavidM that&#39;s it! make it <code>gopath&#47;src&#47;helloworld</code> instead of <code>&#47;helloworld</code>"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 12020448, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MwzhUMk5MZM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd0OPutqbwBBtSCRnL0QziK0cqFAw/photo.jpg?sz=128", "display_name": "David M", "link": "https://stackoverflow.com/users/12020448/david-m"}, "edited": false, "score": 0, "creation_date": 1567754280, "post_id": 57793204, "comment_id": 102065457, "body": "tried this - same result.  even tried to upload with linux subsystem - same error. the error dissaper, if i remove the github libary"}, {"owner": {"reputation": 3580, "user_id": 11504909, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9mpmpGo21jU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reLuZGObxDJCoZRoX5Q6qzu_2ecxQ/mo/photo.jpg?sz=128", "display_name": "Chris32", "link": "https://stackoverflow.com/users/11504909/chris32"}, "reply_to_user": {"reputation": 21, "user_id": 12020448, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MwzhUMk5MZM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd0OPutqbwBBtSCRnL0QziK0cqFAw/photo.jpg?sz=128", "display_name": "David M", "link": "https://stackoverflow.com/users/12020448/david-m"}, "edited": false, "score": 0, "creation_date": 1567762638, "post_id": 57793204, "comment_id": 102069190, "body": "Ok, in order to debug this properly please share your code and setup with us or follow this <a href=\"https://cloud.google.com/appengine/docs/standard/go112/quickstart\" rel=\"nofollow noreferrer\">Quickstart Guide</a>"}, {"owner": {"reputation": 21, "user_id": 12020448, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MwzhUMk5MZM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd0OPutqbwBBtSCRnL0QziK0cqFAw/photo.jpg?sz=128", "display_name": "David M", "link": "https://stackoverflow.com/users/12020448/david-m"}, "edited": false, "score": 0, "creation_date": 1568203216, "post_id": 57793204, "comment_id": 102199004, "body": "Followed quickstart guide and used the demo project go111 &gt; cloudsql. Same Error. it seems depending on the go-sql-driver github package"}], "tags": [], "owner": {"reputation": 3580, "user_id": 11504909, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9mpmpGo21jU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reLuZGObxDJCoZRoX5Q6qzu_2ecxQ/mo/photo.jpg?sz=128", "display_name": "Chris32", "link": "https://stackoverflow.com/users/11504909/chris32"}, "is_accepted": false, "score": 1, "last_activity_date": 1567617936, "creation_date": 1567617936, "answer_id": 57793204, "question_id": 57790884, "link": "https://stackoverflow.com/questions/57790884/your-app-is-not-on-your-gopath-deploying-to-app-engine-go1-12/57793204#57793204", "title": "Your app is not on your GOPATH - deploying to app Engine go1.12", "body": "<p>This is a documented difference in the new version of go. Following this <a href=\"https://cloud.google.com/appengine/docs/standard/go112/go-differences#gopath\" rel=\"nofollow noreferrer\">documentation</a> should do the trick</p>\n\n<p>If this doesn't work for you try creating a new GPATH folder, modify the Env Variable to make this folder you new gopath and put your application in the root of that folder.</p>\n"}, {"tags": [], "owner": {"reputation": 6155, "user_id": 4378314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7935867003690df779b06563293f6293?s=128&d=identicon&r=PG", "display_name": "MarsAndBack", "link": "https://stackoverflow.com/users/4378314/marsandback"}, "is_accepted": false, "score": 2, "last_activity_date": 1577540292, "creation_date": 1577540292, "answer_id": 59511398, "question_id": 57790884, "link": "https://stackoverflow.com/questions/57790884/your-app-is-not-on-your-gopath-deploying-to-app-engine-go1-12/59511398#59511398", "title": "Your app is not on your GOPATH - deploying to app Engine go1.12", "body": "<p>Your project folder should be in \"\\src\", not \"\\projects\".</p>\n\n<p>For <a href=\"https://golang.org/doc/code.html#Workspaces\" rel=\"nofollow noreferrer\">standard Go setups</a>, whatever your basic GOPATH environment variable points to, inside that folder should be a structure like:</p>\n\n<pre><code>bin/\n                             # command executables\n\nsrc/\n    github.com/golang/example/\n        .git/                      # Git repository metadata\n    hello/\n        hello.go               # command source\n    myproject1/\n        main.go                # command source\n        main_test.go           # test source\n        app.yaml               # google cloud configuration\n    myproject2/\n        beepboop.go            # command source\n    stringutil/\n        reverse.go             # package source\n        reverse_test.go        # test source\n    golang.org/x/image/\n        .git/                  # Git repository metadata\n    bmp/\n        reader.go              # package source\n        writer.go              # package source\n    ... (many more repositories and packages omitted) ...\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 12020448, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MwzhUMk5MZM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd0OPutqbwBBtSCRnL0QziK0cqFAw/photo.jpg?sz=128", "display_name": "David M", "link": "https://stackoverflow.com/users/12020448/david-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1170, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1577540292, "creation_date": 1567608369, "last_edit_date": 1567632658, "question_id": 57790884, "link": "https://stackoverflow.com/questions/57790884/your-app-is-not-on-your-gopath-deploying-to-app-engine-go1-12", "title": "Your app is not on your GOPATH - deploying to app Engine go1.12", "body": "<p>i have an problem with appengine and go112. </p>\n\n<p>i can\u00b4t deploy without an error to the cloud:</p>\n\n<pre><code>2019/09/04 14:36:10 Copying /workspace/_gopath/src/mysql to /tmp/staging/srv/gopath/src/mysql\n2019/09/04 14:36:10 Your app is not on your GOPATH, this build may fail.\n2019/09/04 14:36:10 Building from Go source in /tmp/staging/srv, with main package at ./...\n2019/09/04 14:36:10 Building /tmp/staging/srv, saving to /tmp/staging/usr/local/bin/start\n2019/09/04 14:36:11 Wrote build output to /builder/outputs/output\n2019/09/04 14:36:11 Failed to build app: Your app is not on your GOPATH, please move it there and try again.\nbuilding app with command '[go build -o /tmp/staging/usr/local/bin/start ./...]', env '[PATH=/go/bin:/usr/local/go/bin:/builder/google-cloud-sdk/bin/:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin HOSTNAME=89fd1b631b04 HOME=/builder/home BUILDER_OUTPUT=/builder/outputs DEBIAN_FRONTEND=noninteractive GOROOT=/usr/local/go/ GOPATH=/go GOPATH=/tmp/staging/srv/gopath]': err=exit status 1, out=go build: cannot use -o with multiple packages.\nPS C:\\gopath\\projects\\gp-sql&gt;\n</code></pre>\n\n<p>My project is under the gopath and i tried serveral modifications of it.</p>\n\n<p><img src=\"https://i.imgur.com/zDV9s6m.png\" alt=\"image\"></p>\n\n<p>output of \"go env\"</p>\n\n<pre><code>set GOPATH=C:\\gopath\nset GOROOT=C:\\golang\n</code></pre>\n\n<p>Anybody an idea what i\u00b4m missing?</p>\n"}, {"tags": ["go", "elasticsearch"], "comments": [{"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "edited": false, "score": 1, "creation_date": 1567597889, "post_id": 57787772, "comment_id": 102008863, "body": "Can you show the error you see in the ES server logs, please?"}, {"owner": {"reputation": 48118, "user_id": 3498062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9af3b7feaee84aac3a99e885ee2a97e0?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Stefan", "link": "https://stackoverflow.com/users/3498062/andrei-stefan"}, "edited": false, "score": 1, "creation_date": 1567598838, "post_id": 57787772, "comment_id": 102009408, "body": "Can you try <code>query = query.Filter(NewScriptQuery(NewScript(&quot;doc.[&#39;val1&#39;].value == doc.[&#39;val2&#39;].value1&quot;)))</code>?"}, {"owner": {"reputation": 119, "user_id": 5589201, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-z8vW_wFt3DA/AAAAAAAAAAI/AAAAAAAAABM/9VI0Lq5Sf1Q/photo.jpg?sz=128", "display_name": "Constantine Bateruk", "link": "https://stackoverflow.com/users/5589201/constantine-bateruk"}, "edited": false, "score": 0, "creation_date": 1567599557, "post_id": 57787772, "comment_id": 102009813, "body": "Val, i would if i knew how to do this) Andrei, i guess it make me closer to solution, but now with <code>query = query.Filter(elastic.NewScriptQuery(elastic.NewScript(&quot;doc.[&zwnj;&#8203;&#39;val1&#39;].value == doc.[&#39;val2&#39;].value&quot;)))</code> new error is: Error 400 (Bad Request): all shards failed [type=search_phase_execution_exception]"}, {"owner": {"reputation": 48118, "user_id": 3498062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9af3b7feaee84aac3a99e885ee2a97e0?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei Stefan", "link": "https://stackoverflow.com/users/3498062/andrei-stefan"}, "reply_to_user": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "edited": false, "score": 1, "creation_date": 1567599829, "post_id": 57787772, "comment_id": 102009960, "body": "You&#39;d have to share more from that exception, ideally the stacktrace from Elasticsearch, as @Val mentioned."}, {"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "edited": false, "score": 1, "creation_date": 1567599906, "post_id": 57787772, "comment_id": 102010007, "body": "The ES server logs are located in the <code>logs</code> folder if you installed from a ZIP or tarball or in <code>var&#47;log&#47;elasticsearch</code> if you installed from an RPM/DEB."}, {"owner": {"reputation": 119, "user_id": 5589201, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-z8vW_wFt3DA/AAAAAAAAAAI/AAAAAAAAABM/9VI0Lq5Sf1Q/photo.jpg?sz=128", "display_name": "Constantine Bateruk", "link": "https://stackoverflow.com/users/5589201/constantine-bateruk"}, "edited": false, "score": 0, "creation_date": 1567601305, "post_id": 57787772, "comment_id": 102010732, "body": "Update: now i just failed with dot after <code>doc.[&#39;val&#39;]</code>  <code>query = query.Filter(elastic.NewScriptQuery(elastic.NewScript(&quot;doc[&#39;&zwnj;&#8203;val1&#39;].value == doc[&#39;val2&#39;].value&quot;)))</code> - works, thanks all!"}], "answers": [{"tags": [], "owner": {"reputation": 119, "user_id": 5589201, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-z8vW_wFt3DA/AAAAAAAAAAI/AAAAAAAAABM/9VI0Lq5Sf1Q/photo.jpg?sz=128", "display_name": "Constantine Bateruk", "link": "https://stackoverflow.com/users/5589201/constantine-bateruk"}, "is_accepted": true, "score": 0, "last_activity_date": 1567626247, "last_edit_date": 1567626247, "creation_date": 1567601550, "answer_id": 57788822, "question_id": 57787772, "link": "https://stackoverflow.com/questions/57787772/elasticsearch-query-to-filter-documents-where-value1-value2-with-go-olivere-e/57788822#57788822", "title": "Elasticsearch query to filter documents where value1 == value2 with Go olivere/elastic", "body": "<pre><code>query = query.Filter(elastic.NewScriptQuery(elastic.NewScript(\"doc['val1'].value == doc['val2'].value\")))\n</code></pre>\n"}], "owner": {"reputation": 119, "user_id": 5589201, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-z8vW_wFt3DA/AAAAAAAAAAI/AAAAAAAAABM/9VI0Lq5Sf1Q/photo.jpg?sz=128", "display_name": "Constantine Bateruk", "link": "https://stackoverflow.com/users/5589201/constantine-bateruk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 476, "favorite_count": 0, "accepted_answer_id": 57788822, "answer_count": 1, "score": 1, "last_activity_date": 1567626247, "creation_date": 1567597751, "question_id": 57787772, "link": "https://stackoverflow.com/questions/57787772/elasticsearch-query-to-filter-documents-where-value1-value2-with-go-olivere-e", "title": "Elasticsearch query to filter documents where value1 == value2 with Go olivere/elastic", "body": "<p>I need to build query to get documents where doc.value1 == doc.value2</p>\n\n<pre><code>{\n    \"query\": {\n        \"bool\" : {\n            \"filter\" : [{\n                \"script\" : {\n                    \"script\" : {\n                        \"source\": \"doc['val1'].value == doc['val2'].value\",\n                        \"lang\": \"painless\"\n                     }\n                }\n            }]\n        }\n    }\n}\n</code></pre>\n\n<p>This what I need to build with olivere/elastic, it work if I send it as POST request.</p>\n\n<p>In golang I have something like</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\"github.com/olivere/elastic\"\n...\n\nquery := elastic.NewBoolQuery()\n// then add something to this query or leave it empty it works fine\n// but if I add \nquery = query.Filter(elastic.NewBoolQuery().Must(elastic.NewScript(\"doc.['val1'].value == doc.['val2'].value\")))\n// I'm getting: Error 400 (Bad Request): [source] query malformed,\n// no start_object after query name [type=parsing_exception]\n\n// Then i run it like:\nclient, err := elastic.NewClient()\nif err != nil {\n    fmt.Println(err)\n    return\n}\nresp, err := client.Search(\"myIndex\").Type(\"myDoc\").Query(query).TrackTotalHits(true).Size(limit).Do(context.Background())\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n</code></pre>\n"}, {"tags": ["go", "ssl", "https", "tls1.2", "go-gin"], "comments": [{"owner": {"reputation": 7502, "user_id": 6368697, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yq4cG.jpg?s=128&g=1", "display_name": "Patrick Mevzek", "link": "https://stackoverflow.com/users/6368697/patrick-mevzek"}, "edited": false, "score": 0, "creation_date": 1567613346, "post_id": 57786439, "comment_id": 102017676, "body": "Use <code>openssl s_client -msg</code> or equivalent to see the full TLS exchange. From the look of the scarce information you give, one party decided to stop talking after receiving something it didn&#39;t like."}, {"owner": {"reputation": 382, "user_id": 8507208, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-piA3hykUNzU/AAAAAAAAAAI/AAAAAAAAAV8/pT3e9gHiJS8/photo.jpg?sz=128", "display_name": "Sibaprasad Maiti", "link": "https://stackoverflow.com/users/8507208/sibaprasad-maiti"}, "reply_to_user": {"reputation": 7502, "user_id": 6368697, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yq4cG.jpg?s=128&g=1", "display_name": "Patrick Mevzek", "link": "https://stackoverflow.com/users/6368697/patrick-mevzek"}, "edited": false, "score": 0, "creation_date": 1567740270, "post_id": 57786439, "comment_id": 102061674, "body": "The thing is when I am hitting the url from my laptop browser it is working perfectly, without any certificate error. But inside the VM, this error is coming continuously in the log. So the request is coming from somewhere but I am not able to understand how. My linux VM is running behind a proxy server thats all I know. It is in IBM cloud. Any possibilities where this request can come automatically?"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1567596388, "creation_date": 1567596388, "answer_id": 57787410, "question_id": 57786439, "link": "https://stackoverflow.com/questions/57786439/tls-handshake-error-from-xx-xx-xx-xx14333-eof/57787410#57787410", "title": "TLS handshake error from xx.xx.xx.xx:14333: EOF", "body": "<p>I would attack the problem from two angles:</p>\n\n<ol>\n<li><p>What is this <code>xx.xx.xx.xx</code> address? I'd expect that when I start some random piece of software, there is nothing to connect to it <em>all by itself,</em> right?</p></li>\n<li><p>Is there anything special about that 9001 port? Try running <code>nc -l -p 9001</code> and see whether those unidentified connections happen as well.</p>\n\n<p>Run <code>tcpdump</code> and see whether there is any incoming traffic from the clients making those connections: those <code>EOF</code>s (that's \"end of file\") reported by the TLS mchinery most probably mean those clients\u2014whatever they are\u2014close their side of the connection somewhere amidst the TLS handshake\u2014while the server is expecting to read some data from them.\nThis hints at that those clients do not actually expect to see TLS protocol in the connection they open; and they pretty much may send some plaintext in it, so you'll be able to peek at it.</p></li>\n<li><p>Googling for \"9001 port\" hints at that it's used for some \"ETL service manager\" protocol\u2014whatever it is. <a href=\"https://www.3cx.com/community/threads/the-portforwarding-faq-hope-this-gets-a-sticky.1697/\" rel=\"nofollow noreferrer\">This</a> hints at that traffic on 9001 might be related to VoIP.</p>\n\n<p>I have no idea what to do with this, but it might give you some lead for further research.</p></li>\n</ol>\n"}], "owner": {"reputation": 382, "user_id": 8507208, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-piA3hykUNzU/AAAAAAAAAAI/AAAAAAAAAV8/pT3e9gHiJS8/photo.jpg?sz=128", "display_name": "Sibaprasad Maiti", "link": "https://stackoverflow.com/users/8507208/sibaprasad-maiti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2178, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567862138, "creation_date": 1567592607, "last_edit_date": 1567862138, "question_id": 57786439, "link": "https://stackoverflow.com/questions/57786439/tls-handshake-error-from-xx-xx-xx-xx14333-eof", "title": "TLS handshake error from xx.xx.xx.xx:14333: EOF", "body": "<p>I am running a HTTPS server in Linux (RHEL 7). I am getting the below error as soon as I start the server. </p>\n\n<pre><code>2019/09/04 15:46:16 http: TLS handshake error from xx.xx.xx.xx:60206: EOF\n2019/09/04 15:46:21 http: TLS handshake error from xx.xx.xx.xx:31824: EOF\n</code></pre>\n\n<p>This error is coming automatically and continuously in the terminal.\nBelow is the go code for creating https server - </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n    fmt.Println(\"Starting webserver\")\n\n    router := gin.Default()\n    router.GET(\"/\", func(c *gin.Context) {\n        c.JSON(http.StatusOK, gin.H{\n            \"success\": true,\n        })\n    })\n\n    router.RunTLS(\":9001\", \"server.pem\", \"server.key\")\n}\n\n</code></pre>\n\n<p>We have purchased and combined the server certificate, intermidate certificate and root certificate into a single file to make the <code>server.pem</code> file. </p>\n\n<p>As this error is coming continuously and in the terminal as soon as I start the server, I think there is some configuration problem in the VM?</p>\n\n<p>Please suggest what are the things I can check here. </p>\n\n<p>NOTE: This error is specific to the Go. I have tested on the same server on the same port with same certificates in Node JS. And it works fine. \nAlso the IP in the error message is of the reverse proxy server (WAF) which is continuosly doing health monitoring of the web application server. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6112, "user_id": 13075, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/7Cove.jpg?s=128&g=1", "display_name": "Henrik Aasted S&#248;rensen", "link": "https://stackoverflow.com/users/13075/henrik-aasted-s%c3%b8rensen"}, "edited": false, "score": 0, "creation_date": 1567591793, "post_id": 57786121, "comment_id": 102005810, "body": "<a href=\"https://stackoverflow.com/q/44139161/13075\">This answer</a> partially answers your question."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 7, "creation_date": 1567594849, "post_id": 57786121, "comment_id": 102007353, "body": "Your &quot;worst solution&quot; is <i>exactly</i> what the Go playground does because it is basically the <i>only</i> way to do it. For simple thing a Go interpreter might fit your need (google &quot;golang interpreter&quot; and pick any). There is no direct way to &quot;eval&quot; Go code in the stdlib."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1567605017, "post_id": 57786121, "comment_id": 102012930, "body": "Go is a compiled language, not an interpreted language. There is no native support for executing arbitrary strings as Go code; executing any Go code with the standard SDK requires writing it to a file, compiling it to a binary, and executing that binary."}, {"owner": {"reputation": 130, "user_id": 4198317, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Rc0Ik1yNrzA/AAAAAAAAAAI/AAAAAAAACIE/eIlf5bdUeIQ/photo.jpg?sz=128", "display_name": "St&#233;phane Jeandeaux", "link": "https://stackoverflow.com/users/4198317/st%c3%a9phane-jeandeaux"}, "edited": false, "score": 0, "creation_date": 1567605284, "post_id": 57786121, "comment_id": 102013085, "body": "Hi @seaguest, have you looked at <a href=\"https://github.com/containous/yaegi\" rel=\"nofollow noreferrer\">github.com/containous/yaegi</a> ?"}], "answers": [{"tags": [], "owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "is_accepted": false, "score": -1, "last_activity_date": 1567718413, "last_edit_date": 1592644375, "creation_date": 1567718413, "answer_id": 57813118, "question_id": 57786121, "link": "https://stackoverflow.com/questions/57786121/how-to-run-go-code-dynamically-from-string/57813118#57813118", "title": "How to run go code dynamically from string?", "body": "<h1>1. Playground</h1>\n<blockquote>\n<p>With go-playground, we can type the code and execute it, how does that work behind?</p>\n</blockquote>\n<p>I suppose that you answered your owm question in most part.</p>\n<p>It does not take long to find  source of <a href=\"https://github.com/golang/playground/blob/509e10fc018f6da63e433d45afbf5c21af9480a2/sandbox.go#L306\" rel=\"nofollow noreferrer\">compileAndRun</a> from playground.</p>\n<blockquote>\n<p>The worst solution would be to write string code to a file and call it with exec.Command(&quot;go&quot;, &quot;run&quot;,&quot;file&quot;).</p>\n</blockquote>\n<p>And yes, it uses:\n<a href=\"https://github.com/golang/playground/blob/509e10fc018f6da63e433d45afbf5c21af9480a2/sandbox.go#L361\" rel=\"nofollow noreferrer\">https://github.com/golang/playground/blob/509e10fc018f6da63e433d45afbf5c21af9480a2/sandbox.go#L361</a></p>\n<pre class=\"lang-golang prettyprint-override\"><code>    cmd := exec.Command(&quot;go&quot;, &quot;build&quot;, &quot;-o&quot;, exe, buildPkgArg)\n</code></pre>\n<h1>2. Jupyter kernels, gore, lgo, gophernotes and gomacro</h1>\n<p>Although it does not means that it must be always this way.</p>\n<p>I myself plan to look in spare time into:</p>\n<ul>\n<li>gophernotes</li>\n<li>lgo</li>\n<li>and <a href=\"https://github.com/cosmos72/gomacro\" rel=\"nofollow noreferrer\">gomacro</a> which itself is package used for gophernotes</li>\n</ul>\n<p>Overall: it's not that easy as <code>eval</code> in other languages but nothing stops to implement it.</p>\n<p>Good luck!</p>\n"}], "owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 305, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1567718413, "creation_date": 1567591529, "last_edit_date": 1567591703, "question_id": 57786121, "link": "https://stackoverflow.com/questions/57786121/how-to-run-go-code-dynamically-from-string", "title": "How to run go code dynamically from string?", "body": "<p>I need to execute code dynamically, for example to run <code>fmt.Print(\"hello\")</code> (in string format), maybe what I am looking for is a go virtual machine?</p>\n\n<p>With go-playground, we can type the code and execute it, how does that work behind?</p>\n\n<p>The worst solution would be to write string code to a file and call it with <code>exec.Command(\"go\", \"run\",\"file\")</code>.</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1567606533, "post_id": 57785973, "comment_id": 102013801, "body": "Use appengine.Main() in second <code>func main()</code>."}, {"owner": {"reputation": 467, "user_id": 3402228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1MXMp.jpg?s=128&g=1", "display_name": "Adler Hsieh", "link": "https://stackoverflow.com/users/3402228/adler-hsieh"}, "reply_to_user": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1567607039, "post_id": 57785973, "comment_id": 102014084, "body": "Hey thanks for the reply but there\u2019s only one main(). Did you mean in AnotherFunc()? Edit: ah I know what you meant, but it\u2019s actually already included in the \u201c// other stuff\u201d comment. I just didn\u2019t show the whole thing."}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1567608227, "post_id": 57785973, "comment_id": 102014879, "body": "Not!! I known that was two app! Sorry! In this case,"}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1567608710, "post_id": 57785973, "comment_id": 102015150, "body": "Your code in github no match with your description here."}, {"owner": {"reputation": 467, "user_id": 3402228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1MXMp.jpg?s=128&g=1", "display_name": "Adler Hsieh", "link": "https://stackoverflow.com/users/3402228/adler-hsieh"}, "reply_to_user": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1567608915, "post_id": 57785973, "comment_id": 102015276, "body": "Probably something was missing during copy/paste. But the problem did persist when the context was passed to the other package. Please suggest based on the code in the repo. Thanks."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567615543, "post_id": 57785973, "comment_id": 102018626, "body": "Show the code in <code>main</code> that  sets the <code>ctx</code> variable for the case that does not work."}], "answers": [{"tags": [], "owner": {"reputation": 467, "user_id": 3402228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1MXMp.jpg?s=128&g=1", "display_name": "Adler Hsieh", "link": "https://stackoverflow.com/users/3402228/adler-hsieh"}, "is_accepted": true, "score": 1, "last_activity_date": 1567666193, "creation_date": 1567666193, "answer_id": 57799871, "question_id": 57785973, "link": "https://stackoverflow.com/questions/57785973/context-value-changed-when-passed-out-of-main-go-on-google-app-engine/57799871#57799871", "title": "Context value changed when passed out of main.go on Google App Engine", "body": "<p>It turns out that my code actually worked. It's because of some other operation error.</p>\n\n<p>However, I'll just post the issue that actually caused it so it can help those who have the same issue.</p>\n\n<p>With the new <code>go111</code> runtime, it treats packages from non-root directory or its subdirectories as a different type of package. This caused the problem with \"not an App Engine context\". I'll just call it an \"outcast\" package for now (cause I'm not entirely sure why's that).</p>\n\n<p>For example:</p>\n\n<pre><code>- appengine\n  - main.go\n  - handlers\n    - handlers.go &lt;-- this is a regular package\n</code></pre>\n\n<pre><code>- appengine\n  - main.go\n- handlers\n  - handlers.go &lt; -- this is an outcast package\n</code></pre>\n\n<p>An outcast package would have issues handling <code>context.Context</code> generated from App Engine, as pointed out in my question.</p>\n\n<p>The mechanism of App Engine knowing that the context is created from App Engine, is using a built-in value that can only be retrieved from its internal package (with an un-exported pointer-string key). When passing the context to an outcast package, we can no longer retrieve the value from the context. It's still a mystery for me that why the value disappeared, but it's probably because of some Go compiling mechanism.</p>\n\n<p>The solution would be moving the <code>main.go</code> to the top-level directory in the project, so that there would be no outcast package anywhere.</p>\n"}], "owner": {"reputation": 467, "user_id": 3402228, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1MXMp.jpg?s=128&g=1", "display_name": "Adler Hsieh", "link": "https://stackoverflow.com/users/3402228/adler-hsieh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 57799871, "answer_count": 1, "score": 0, "last_activity_date": 1567666405, "creation_date": 1567591047, "last_edit_date": 1567666405, "question_id": 57785973, "link": "https://stackoverflow.com/questions/57785973/context-value-changed-when-passed-out-of-main-go-on-google-app-engine", "title": "Context value changed when passed out of main.go on Google App Engine", "body": "<p>There's a problem where I don't know why a <code>context.Context</code> was changed once I pass it to a different package on Google App Engine.</p>\n\n<p>The following code works fine when running on App Engine:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"net/http\"\n    \"log\"\n\n    \"google.golang.org/appengine\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", myHandler)\n\n    appengine.Main()\n}\n\nfunc myHandler(w http.ResponseWriter, r *http.Request) {\n    ctx := r.Context()\n    account, err := appengine.ServiceAccount(ctx)\n    if err != nil {\n        log.Println(\"[myHandler] error:\", err)\n    } else {\n        log.Println(\"[myHandler] ServiceAccount:\", account)\n    }   \n\n    w.Write([]byte(\"ok\"))\n}\n</code></pre>\n\n<p>I could retrieve the ServiceAccount successfully when accessing <code>/</code>, and everything was good.</p>\n\n<p>However, when I passed the context from <code>main.go</code> to another package, the function call didn't work. The following was added to <code>main.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    // other stuff\n    \"github.com/adlerhsieh/q_context/handlers\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", myHandler)\n\n    appengine.Main()\n}\n\nfunc myHandler(w http.ResponseWriter, r *http.Request) {\n    ctx := r.Context()\n    account, err := appengine.ServiceAccount(ctx)\n    if err != nil {\n        log.Println(\"[myHandler] error:\", err)\n    } else {\n        log.Println(\"[myHandler] ServiceAccount:\", account)\n    }   \n\n    handlers.AnotherFunc(ctx) // &lt;--- added this\n\n    w.Write([]byte(\"ok\"))\n}\n</code></pre>\n\n<p>Another package:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package handlers\n\nimport (\n    \"log\"\n    \"context\"\n\n    \"google.golang.org/appengine\"\n)\n\nfunc AnotherFunc(ctx context.Context) {\n    account, err := appengine.ServiceAccount(ctx)\n    if err != nil {\n        log.Println(\"[AnotherFunc] error:\", err)\n    } else {\n        log.Println(\"[AnotherFunc] ServiceAccount:\", account)\n    }\n}\n</code></pre>\n\n<p>When I ran it on App Engine, the log said:</p>\n\n<pre><code>2019/09/04 09:36:30 [myHandler] ServiceAccount: myaccount@gmail.com\n2019/09/04 09:36:30 [AnotherFunc] error: not an App Engine context\n</code></pre>\n\n<p>The function calls are the same, but just in different packages. I dug in the package itself and found that it uses the key <a href=\"https://github.com/golang/appengine/blob/master/internal/api.go#L93\" rel=\"nofollow noreferrer\">here</a> (which leads to <a href=\"https://github.com/golang/appengine/blob/master/internal/api.go#L258\" rel=\"nofollow noreferrer\">here</a>) to setup the context. And <a href=\"https://github.com/golang/appengine/blob/master/internal/api.go#L253\" rel=\"nofollow noreferrer\">here</a> to check whether that value was setup properly. However, that value seem to be modified/changed so that the second function call couldn't get it. Even if I omitted the first function call and went straight to the second one, it still has the same error.</p>\n\n<p>Any idea why context object was modified when passing to another package?</p>\n\n<p>The following is my <code>app.yaml</code>:</p>\n\n<pre><code>runtime: go111\nservice: default\ninstance_class: F1\nautomatic_scaling:\n  min_idle_instances: 0\n  max_idle_instances: automatic\n  min_pending_latency: automatic\n  max_pending_latency: automatic\n  max_concurrent_requests: 30\n\nhandlers:\n- url: /.*\n  script: auto\n  login: admin\n\nnobuild_files:\n- vendor\n\nenv_variables:\n  ENV: 'dev'\n  GO111MODULE: 'off'\n</code></pre>\n\n<p><a href=\"https://github.com/adlerhsieh/q_context\" rel=\"nofollow noreferrer\">Here is the GitHub repo link</a>.</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1567586934, "post_id": 57784746, "comment_id": 102003028, "body": "What does &quot;kind of descriptive json&quot; mean? What <i>exactly</i> do you need to validate?"}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1567587022, "post_id": 57784746, "comment_id": 102003093, "body": "a struct and its&#39;attributes description, specifying its field type, if it is required, value range ..."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1567588192, "post_id": 57784746, "comment_id": 102003728, "body": "It&#39;s hard to provide a sensible answer. If you&#39;re looking for some &quot;kinda standardized&quot; solution, try <a href=\"https://json-schema.org/\" rel=\"nofollow noreferrer\">json-schema.org</a> and <a href=\"https://json-schema.org/implementations.html#validator-go\" rel=\"nofollow noreferrer\">3rd party Go packages implementing that</a> (stdlib does not have support for that). Otherwise the answer would be a bit glib: 1) sit down; 2) design an approach to implement your custom validator; 4) implement it. Obviously, properly answering 2-4 is not fit for the SO format, and actually that&#39;d be a lot of work. Unpaid work, you see."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1567588277, "post_id": 57784746, "comment_id": 102003784, "body": "If you actually have some (however vague) idea about how you&#39;d go about implementing your custom validator but have <i>concrete and narrow</i> questions about <i>some specifics</i> of that\u2014then feel free to ask separate, narrow, questions."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567588329, "post_id": 57784746, "comment_id": 102003809, "body": "@seaguest are you looking for something like this <a href=\"https://github.com/go-playground/validator\" rel=\"nofollow noreferrer\">github.com/go-playground/validator</a>? which validates structs, or are you actually looking to validate raw json?"}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1567588444, "post_id": 57784746, "comment_id": 102003880, "body": "@kostix thanks for your reply, actually I used go-playground/validator which used reflect for the validation, I think that would be useful. I will see if I can reuse some code of it."}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567588545, "post_id": 57784746, "comment_id": 102003937, "body": "@mkopriva not exactly, I need to check if a json conforms my descriptive json, but I think it could quite useful to achieve my goal."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567589096, "post_id": 57784746, "comment_id": 102004256, "body": "@seaguest I see... in that case kostix is right."}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1567656792, "post_id": 57784746, "comment_id": 102029240, "body": "@kostix finally I used regular expression to implement my simple json validator,here is my repo <a href=\"https://github.com/seaguest/jsonvalidator\" rel=\"nofollow noreferrer\">github.com/seaguest/jsonvalidator</a>"}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567656800, "post_id": 57784746, "comment_id": 102029245, "body": "@mkopriva finally I used regular expression to implement my simple json validator,here is my repo <a href=\"https://github.com/seaguest/jsonvalidator\" rel=\"nofollow noreferrer\">github.com/seaguest/jsonvalidator</a>"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1567695013, "post_id": 57784746, "comment_id": 102047740, "body": "I can&#39;t resist remembering that famous quote of Jamie Zawinski: &#171;Some people, when confronted with a problem, think \u201cI know, I&#39;ll use regular expressions.\u201d Now they have two problems.&#187; :-)"}], "answers": [{"tags": [], "owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "is_accepted": false, "score": 1, "last_activity_date": 1567656865, "creation_date": 1567656865, "answer_id": 57798339, "question_id": 57784746, "link": "https://stackoverflow.com/questions/57784746/how-to-implement-a-custom-json-validator/57798339#57798339", "title": "How to implement a custom json validator", "body": "<p>Finally I used regular expression to implement my simple json validator,here is my repo <a href=\"https://github.com/seaguest/jsonvalidator\" rel=\"nofollow noreferrer\">https://github.com/seaguest/jsonvalidator</a></p>\n\n<p>Still a lot of things need to be done, but it does meet my needs right now.</p>\n"}], "owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567656865, "creation_date": 1567586834, "last_edit_date": 1567588696, "question_id": 57784746, "link": "https://stackoverflow.com/questions/57784746/how-to-implement-a-custom-json-validator", "title": "How to implement a custom json validator", "body": "<p>I need to test my system with lots of scenarios. For each scenario I will define the request and expected response, then I will make the request and compare the returned response and expected response.</p>\n\n<p>For example, the REST API /add return a+b.</p>\n\n<p>request:</p>\n\n<pre><code>{\n    \"a\":1,\n    \"b\":2\n}\n</code></pre>\n\n<p>expected response (validator style description, could be something else since I don't know if there is any better solution):</p>\n\n<pre><code>{\n    \"err_code\":\"int, required, eq=0\"\n    \"data\":\"int, required, eq=3\"\n}\n</code></pre>\n\n<p>returned response:</p>\n\n<pre><code>success\n{\n    \"err_code\":0,\n    \"data\":3\n}\n\nfailure\n{\n    \"err_code\":500,\n    \"data\":0\n}\n</code></pre>\n\n<p>So my question here is, how to implement a custom json validator with some struct/fied/type/value description, or is there any better solution?</p>\n\n<p><a href=\"https://github.com/go-playground/validator\" rel=\"nofollow noreferrer\">go-playground/validator</a> needs to define everything at struct level, what I need is to check if a json conforms to my descriptive json (something as above).</p>\n"}, {"tags": ["go", "terraform"], "answers": [{"comments": [{"owner": {"reputation": 20893, "user_id": 118587, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d5f94f9183aadaf92fb191f77e3f827?s=128&d=identicon&r=PG", "display_name": "Grzegorz Oledzki", "link": "https://stackoverflow.com/users/118587/grzegorz-oledzki"}, "edited": false, "score": 1, "creation_date": 1567594169, "post_id": 57785476, "comment_id": 102006960, "body": "Thanks. Shouldn&#39;t it be <code>new == &quot;-1&quot;</code>  in the condition?"}, {"owner": {"reputation": 39151, "user_id": 2291321, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24a41cddd8faf69e3fbd0a778ba6fedf?s=128&d=identicon&r=PG&f=1", "display_name": "ydaetskcoR", "link": "https://stackoverflow.com/users/2291321/ydaetskcor"}, "reply_to_user": {"reputation": 20893, "user_id": 118587, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d5f94f9183aadaf92fb191f77e3f827?s=128&d=identicon&r=PG", "display_name": "Grzegorz Oledzki", "link": "https://stackoverflow.com/users/118587/grzegorz-oledzki"}, "edited": false, "score": 0, "creation_date": 1567668722, "post_id": 57785476, "comment_id": 102033106, "body": "Good spot, fixed now."}], "tags": [], "owner": {"reputation": 39151, "user_id": 2291321, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24a41cddd8faf69e3fbd0a778ba6fedf?s=128&d=identicon&r=PG&f=1", "display_name": "ydaetskcoR", "link": "https://stackoverflow.com/users/2291321/ydaetskcor"}, "is_accepted": false, "score": 5, "last_activity_date": 1567671434, "last_edit_date": 1567671434, "creation_date": 1567589479, "answer_id": 57785476, "question_id": 57784666, "link": "https://stackoverflow.com/questions/57784666/how-should-a-terraform-provider-handle-default-values-applied-on-the-server-side/57785476#57785476", "title": "How should a Terraform provider handle default values applied on the server side?", "body": "<p>You can use the <a href=\"https://www.terraform.io/docs/extend/schemas/schema-behaviors.html#diffsuppressfunc\" rel=\"nofollow noreferrer\"><code>DiffSuppressFunc</code></a> flag on schema attributes to conditionally suppress a diff so that Terraform doesn't choose to do anything with the diff.</p>\n\n<p>Something like this should work for you:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package something\n\nimport (\n    \"github.com/hashicorp/terraform/helper/schema\"\n)\n\nfunc somethingSomething() *schema.Resource {\n    return &amp;schema.Resource{\n        // ...\n        Schema: map[string]*schema.Schema{\n            // ...\n            \"field\": {\n                Type:     schema.TypeInt,\n                Optional: true,\n                Default:  -1,\n                DiffSuppressFunc: func(k, old, new string, d *schema.ResourceData) bool {\n                    if new == \"-1\" {\n                        return true\n                    }\n                    return false\n                },\n            },\n        },\n    }\n}\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/a/57795872/2291321\">Martin's answer</a> provides probably a better alternative by using the <a href=\"https://www.terraform.io/docs/extend/schemas/schema-behaviors.html#computed\" rel=\"nofollow noreferrer\"><code>Computed</code> flag</a> and making the attribute <a href=\"https://www.terraform.io/docs/extend/schemas/schema-behaviors.html#optional\" rel=\"nofollow noreferrer\"><code>Optional</code></a>. For this to work nicely you'd want to prevent people from specifying <code>-1</code> as a value for this which you can do with a <a href=\"https://www.terraform.io/docs/extend/schemas/schema-behaviors.html#validatefunc\" rel=\"nofollow noreferrer\"><code>ValidateFunc</code></a>, using the <a href=\"https://godoc.org/github.com/hashicorp/terraform/helper/validation#IntAtLeast\" rel=\"nofollow noreferrer\"><code>IntAtLeast</code> validator</a> from the list of <a href=\"https://godoc.org/github.com/hashicorp/terraform/helper/validation\" rel=\"nofollow noreferrer\">predefined validations in the core SDK</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package something\n\nimport (\n    \"github.com/hashicorp/terraform/helper/schema\"\n    \"github.com/hashicorp/terraform/helper/validation\"\n)\n\nfunc somethingSomething() *schema.Resource {\n    return &amp;schema.Resource{\n        // ...\n        Schema: map[string]*schema.Schema{\n            // ...\n            \"field\": {\n                Type:         schema.TypeInt,\n                Optional:     true,\n                Computed:     true,\n                ValidateFunc: validation.IntAtLeast(1),\n            },\n        },\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 39151, "user_id": 2291321, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24a41cddd8faf69e3fbd0a778ba6fedf?s=128&d=identicon&r=PG&f=1", "display_name": "ydaetskcoR", "link": "https://stackoverflow.com/users/2291321/ydaetskcor"}, "edited": false, "score": 0, "creation_date": 1567670650, "post_id": 57795872, "comment_id": 102034037, "body": "The <code>Computed</code> flag is definitely a better option if you don&#39;t allow for people to pass <code>-1</code> as an optional and just allow it to be optional and then if it is set require it to be a positive integer. It also seems like a cleaner API to me so I&#39;d probably go with this option over mine unless there&#39;s a really good reason that you&#39;d want to allow your users to use <code>-1</code> as a specific option here rather than leaving it unset."}], "tags": [], "owner": {"reputation": 28957, "user_id": 281848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w7nJW.jpg?s=128&g=1", "display_name": "Martin Atkins", "link": "https://stackoverflow.com/users/281848/martin-atkins"}, "is_accepted": false, "score": 5, "last_activity_date": 1567632853, "creation_date": 1567632853, "answer_id": 57795872, "question_id": 57784666, "link": "https://stackoverflow.com/questions/57784666/how-should-a-terraform-provider-handle-default-values-applied-on-the-server-side/57795872#57795872", "title": "How should a Terraform provider handle default values applied on the server side?", "body": "<p>The Terraform SDK includes a special schema flag <code>Computed</code>, which means \"if there is no value given in the configuration then a default value will be selected at apply time\".</p>\n\n<p>That seems to match with your use-case here. If you unset <code>Default</code> and set <code>Computed: true</code> instead -- retaining <code>Optional: true</code> to indicate that the user can optionally set it -- then you can activate that behavior.</p>\n\n<p>If you're able to predict the final \"computed\" value during the <em>plan</em> step, before creating or updating anything, then you should implement <code>CustomizeDiff</code> for the resource and use <code>d.Set</code> to provide the value, and then Terraform can take it into account to produce a more complete plan.</p>\n\n<p>If not, then you can leave it unset during planning (in Terraform terms, its value will be \"unknown\") and then call <code>d.Set</code> in the <code>Create</code> and <code>Update</code> functions instead, with the value appearing as <code>(known after apply)</code> in the plan.</p>\n\n<p>When using this mechanism, it's important to be self-consistent: if you provide a known value during planning using <code>CustomizeDiff</code> then that <em>must</em> exactly match a final value selected during <code>Create</code> or <code>Update</code>. If you aren't consistent then any references to this attribute in other expressions will lead to errors during apply when Terraform Core verifies that the final changes are consistent with what was planned.</p>\n\n<hr>\n\n<p>There is a currently caveat with this approach: due to API design limitations of the Terraform SDK today, provider code can't tell when a value that was <em>previously</em> set in configuration is now no longer set. Or, to put it another way, the SDK can't tell whether the value already stored was selected by explicit configuration or was populated by the provider as a default during apply.</p>\n\n<p>For this reason, the last value set in the configuration will be \"sticky\" if the user unsets it, and the provider will not be able to adjust that value back to the server-provided default automatically.</p>\n\n<p>That caveat is often not a big deal in practice, but is worth noting in case it <em>does</em> matter in your specific situation. A subsequent version of the SDK is likely to provide a mechanism to <em>ask</em> if a particular value is set in configuration, separately from what is stored in the state.</p>\n"}], "owner": {"reputation": 20893, "user_id": 118587, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d5f94f9183aadaf92fb191f77e3f827?s=128&d=identicon&r=PG", "display_name": "Grzegorz Oledzki", "link": "https://stackoverflow.com/users/118587/grzegorz-oledzki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 542, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1567671434, "creation_date": 1567586575, "last_edit_date": 1567589515, "question_id": 57784666, "link": "https://stackoverflow.com/questions/57784666/how-should-a-terraform-provider-handle-default-values-applied-on-the-server-side", "title": "How should a Terraform provider handle default values applied on the server side?", "body": "<p>Context: I am implementing (my first) Terraform plugin/provider as a wrapper towards existing public API.</p>\n\n<p>One of the create operations in the API specifies an integer field which takes positive values or <code>-1</code> serving as a default. If you specify <code>-1</code> in the create API call, the value gets replaced by some default on the server side (say <code>field = 1000</code>) and is stored as <code>1000</code> from now on.</p>\n\n<p>If I present this to my Terraform plugin (<code>terraform apply</code>):</p>\n\n<pre><code>resource \"something\" \"mysomething\" {\n  name  = \"someName\"\n  field = -1\n}\n</code></pre>\n\n<p>the call is not idempotent. Terraform continues to see a drift and subsequently offers:</p>\n\n<pre><code>  # something.mysomething will be updated in-place\n  ~ resource \"something\" \"mysomething\" {\n        id               = \"165-1567498530352\"\n        name             = \"someName\"\n      ~ field            = 1000 -&gt; -1\n    }\n\nPlan: 0 to add, 1 to change, 0 to destroy.\n</code></pre>\n\n<p>How to deal with such API?</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 954, "user_id": 2695796, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-B9ZcX7SBtSA/AAAAAAAAAAI/AAAAAAAAAAc/3ib3iBa1O_w/photo.jpg?sz=128", "display_name": "Jimi", "link": "https://stackoverflow.com/users/2695796/jimi"}, "edited": false, "score": 0, "creation_date": 1567776259, "post_id": 57789575, "comment_id": 102075888, "body": "That was the part i was trying to avoid :/ At this point i guess i&#39;ll have to deal with objectID or setting the value myself"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1567604047, "creation_date": 1567604047, "answer_id": 57789575, "question_id": 57784597, "link": "https://stackoverflow.com/questions/57784597/changing-the-default-mongodb-objectid-generator/57789575#57789575", "title": "Changing the default MongoDB ObjectID generator", "body": "<p>You don't have to use an ObjectID for _id:</p>\n\n<pre><code>  ID   string `json:\"id,omitempty\" bson:\"_id,omitempty\"`\n</code></pre>\n\n<p>Then you can insert any value you want for _id. However, you won't be able to auto-generate ID this way, you have to generate the ID yourself, and insert it with the generated ID.</p>\n"}], "owner": {"reputation": 954, "user_id": 2695796, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-B9ZcX7SBtSA/AAAAAAAAAAI/AAAAAAAAAAc/3ib3iBa1O_w/photo.jpg?sz=128", "display_name": "Jimi", "link": "https://stackoverflow.com/users/2695796/jimi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567604047, "creation_date": 1567586239, "question_id": 57784597, "link": "https://stackoverflow.com/questions/57784597/changing-the-default-mongodb-objectid-generator", "title": "Changing the default MongoDB ObjectID generator", "body": "<p>I'm using the mongo-go driver for Go to save some documents on mongoDb. Everyhting works fine, but i'm wondering if there is a way to change how the ID is auto-generated. Right now the document model in the code has the primitive.ObjectID type, is something like this</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Review struct {\n    ID      primitive.ObjectID `json:\"id,omitempty\" bson:\"_id,omitempty\"`\n    Title   string             `json:\"title\"`\n    Text    string             `json:\"text\"`\n    Rate    float64            `json:\"rate\"`\n    Date    time.Time          `json:\"date\"`\n    Product Product            `json:\"product\"`\n}\n</code></pre>\n\n<p>And the document created is something like this</p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"5d6f739a20d42db438016cb1\"),\n    \"title\" : \"test-id\",\n    \"text\" : \"rev-text\",\n    \"rate\" : 5.0,\n    \"date\" : ISODate(\"2019-09-02T12:18:00.000+02:00\"),\n    \"status\" : \"pending\"\n}\n</code></pre>\n\n<p>So far so good. However i want the ID to be a <a href=\"https://it.wikipedia.org/wiki/Universally_unique_identifier\" rel=\"nofollow noreferrer\">UUID</a>, not an ObjectId. I know i can change the struct ID type to UUID or string and set that field when i'm saving the document, however i want to know if there is a way to change the default ObjectID generator of mongoDb so it generates a UUID automatically when saving a new document</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567610589, "post_id": 57783858, "comment_id": 102016223, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/54290124/sending-a-websocket-message-to-a-specific-client-in-go-using-gorilla\">Sending a Websocket message to a specific client in Go (using Gorilla)</a>"}, {"owner": {"reputation": 1630, "user_id": 5536889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf339fa4f83adb059875ca8396c6cd74?s=128&d=identicon&r=PG&f=1", "display_name": "Web Artisan", "link": "https://stackoverflow.com/users/5536889/web-artisan"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567661315, "post_id": 57783858, "comment_id": 102030352, "body": "Actually this is not a duplicate. I want to send all client who is listening to a specific channel"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567684781, "post_id": 57783858, "comment_id": 102041681, "body": "Describe at a higher-level what you are trying to do. For example, are implementing chat rooms, one to one chat or something else? When you say channel, are you referring to one of the Go channels in the example you linked to or are you referring to chat room or channel as in Slack?"}, {"owner": {"reputation": 1630, "user_id": 5536889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf339fa4f83adb059875ca8396c6cd74?s=128&d=identicon&r=PG&f=1", "display_name": "Web Artisan", "link": "https://stackoverflow.com/users/5536889/web-artisan"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567694274, "post_id": 57783858, "comment_id": 102047318, "body": "@CeriseLim&#243;n I have updated my question. please take a look. any help would be appreciated."}], "answers": [{"comments": [{"owner": {"reputation": 1630, "user_id": 5536889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf339fa4f83adb059875ca8396c6cd74?s=128&d=identicon&r=PG&f=1", "display_name": "Web Artisan", "link": "https://stackoverflow.com/users/5536889/web-artisan"}, "edited": false, "score": 0, "creation_date": 1567706437, "post_id": 57810457, "comment_id": 102052977, "body": "Thank you. I will try and let you know."}, {"owner": {"reputation": 1630, "user_id": 5536889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf339fa4f83adb059875ca8396c6cd74?s=128&d=identicon&r=PG&f=1", "display_name": "Web Artisan", "link": "https://stackoverflow.com/users/5536889/web-artisan"}, "edited": false, "score": 0, "creation_date": 1567749861, "post_id": 57810457, "comment_id": 102063705, "body": "here i am getting error. room := h.rooms[message.roomID] error is message.roomID undefined (type []byte has no field or method roomID)"}, {"owner": {"reputation": 1630, "user_id": 5536889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf339fa4f83adb059875ca8396c6cd74?s=128&d=identicon&r=PG&f=1", "display_name": "Web Artisan", "link": "https://stackoverflow.com/users/5536889/web-artisan"}, "edited": false, "score": 0, "creation_date": 1567750517, "post_id": 57810457, "comment_id": 102063934, "body": "Ok. Thanks Man :)"}, {"owner": {"reputation": 1630, "user_id": 5536889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf339fa4f83adb059875ca8396c6cd74?s=128&d=identicon&r=PG&f=1", "display_name": "Web Artisan", "link": "https://stackoverflow.com/users/5536889/web-artisan"}, "edited": false, "score": 0, "creation_date": 1567751171, "post_id": 57810457, "comment_id": 102064156, "body": "Now hub.go looks fine. but when i try to run getting error from client.go. here is the error &quot;cannot use message (type []byte) as type message in send&quot; on readPump function. Can you please help once more?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1567750228, "last_edit_date": 1567750228, "creation_date": 1567704691, "answer_id": 57810457, "question_id": 57783858, "link": "https://stackoverflow.com/questions/57783858/sending-a-websocket-message-to-a-specific-channel-in-go-using-gorilla/57810457#57810457", "title": "Sending a Websocket message to a specific channel in Go (using Gorilla)", "body": "<p>To add a \"channel\" or \"chat room\" feature to the Gorilla chat example, do the following.  I'll use the word \"room\" in this answer to avoid confusion with Go channels.</p>\n\n<p>Define a type for messages that includes the payload and a room identifier:</p>\n\n<pre><code>type message struct {\n   roomID string\n   data []byte\n}\n</code></pre>\n\n<p>Replace the hub broadcast channel with:</p>\n\n<pre><code>broadcast chan message\n</code></pre>\n\n<p>Add a room identifier to the Client type:</p>\n\n<pre><code>type Client struct {\n    roomID string\n    hub *Hub\n    ...\n}\n</code></pre>\n\n<p>The handler extracts the room identifier from the <a href=\"https://godoc.org/net/http#Request.URL\" rel=\"nofollow noreferrer\">request URI</a> and sets the room identifier when creating a <code>Client</code> and sending a <code>message</code>.</p>\n\n<p>Change the <code>Hub</code>s <code>clients</code> fields to a map keyed by room identifier.  Initialize this field as appropriate when initializing the hub.</p>\n\n<pre><code>// Registered clients by room\nrooms map[string]map[*Client]bool\n</code></pre>\n\n<p>Change the <code>Hub</code> <code>run</code> function to work with rooms. This code is structurally similar to the code in the original example. </p>\n\n<pre><code>    select {\n    case client := &lt;-h.register:\n        room := h.rooms[client.roomID]\n        if room == nil {\n           // First client in the room, create a new one\n           room = make(map[*Client]bool)\n           h.rooms[client.roomID] = room\n        }\n        room[client] = true\n    case client := &lt;-h.unregister:\n        room := h.rooms[client.roomID]\n        if room != nil {\n            if _, ok := room[client]; ok {\n                delete(room, client)\n                close(client.send)\n                if len(room) == 0 {\n                   // This was last client in the room, delete the room\n                   delete(h.rooms, client.roomID)\n                }\n            }\n         }\n    case message := &lt;-h.broadcast:\n        room := h.rooms[message.roomID]\n        if room != nil {\n            for client := range room {\n                select {\n                case client.send &lt;- message.data:\n                default:\n                    close(client.send)\n                    delete(room, client)\n                }\n            }\n            if len(room) == 0 {\n                // The room was emptied while broadcasting to the room.  Delete the room.\n                delete(h.rooms, message.roomID)\n            }\n        }\n    }\n</code></pre>\n"}], "owner": {"reputation": 1630, "user_id": 5536889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf339fa4f83adb059875ca8396c6cd74?s=128&d=identicon&r=PG&f=1", "display_name": "Web Artisan", "link": "https://stackoverflow.com/users/5536889/web-artisan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1456, "favorite_count": 3, "accepted_answer_id": 57810457, "answer_count": 1, "score": 2, "last_activity_date": 1581412772, "creation_date": 1567583695, "last_edit_date": 1581412772, "question_id": 57783858, "link": "https://stackoverflow.com/questions/57783858/sending-a-websocket-message-to-a-specific-channel-in-go-using-gorilla", "title": "Sending a Websocket message to a specific channel in Go (using Gorilla)", "body": "<p>I am very new to Go and have found myself working with sockets as my first project. This is a redundant question, but I have failed to understand how to send a websocket update to a specific channel in Go (using Gorilla).</p>\n\n<p>I am using <a href=\"https://github.com/gorilla/websocket/blob/master/examples/chat/main.go\" rel=\"nofollow noreferrer\">code sample from this link</a></p>\n\n<p>this method. But failed to modify to send messages to specific channel.</p>\n\n<p>Here is my sample code\n<strong>main.go</strong></p>\n\n<pre><code>func main() {\n    flag.Parse()\n    hub := newHub()\n    go hub.run()\n    http.HandleFunc(\"/ws\", func(w http.ResponseWriter, r *http.Request) {\n        fmt.Println(hub)\n        serveWs(hub, w, r)\n    })\n    err := http.ListenAndServe(*addr, nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n\n<p>There is other two files called hub.go and client.go\nI think hub.go below here something could be done</p>\n\n<pre><code>return &amp;Hub{\n    broadcast:  make(chan []byte),\n    register:   make(chan *Client),\n    unregister: make(chan *Client),\n    clients:    make(map[*Client]bool),\n}\n</code></pre>\n\n<p>What should I change from here?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>What I am trying to do is I have a socket server written in go.\nNow suppose we have many clients written in react listening on server with a specific url like wss://abc.com/wss1 or may be wss://abc.com/wss2</p>\n\n<p>Now if client wss1 send a message to server, server will emit this message all clients listening on url wss1 not wss2 and vice versa.</p>\n\n<p>Till now i have been able to do broadcast to all clients irrespective of wss1 or wss2.\nHope I made it clear. </p>\n"}, {"tags": ["email", "go", "outlook"], "answers": [{"comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 56418, "user_id": 332059, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/cSNOK.png?s=128&g=1", "display_name": "Dmitry Streblechenko", "link": "https://stackoverflow.com/users/332059/dmitry-streblechenko"}, "edited": false, "score": 0, "creation_date": 1567657034, "post_id": 57785430, "comment_id": 102029297, "body": "@DmitryStreblechenko: While this information is irrelevant to this specific question it is interesting though. Does this mean that 2FA is not supported with SMTP on O365 (because this is what XOAUTH2 is used for, LOGIN cannot do this) or how 2FA is done in this case?"}, {"owner": {"reputation": 56418, "user_id": 332059, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/cSNOK.png?s=128&g=1", "display_name": "Dmitry Streblechenko", "link": "https://stackoverflow.com/users/332059/dmitry-streblechenko"}, "edited": false, "score": 0, "creation_date": 1567659174, "post_id": 57785430, "comment_id": 102029818, "body": "That is correct - only LOGIN works with SMTP for the O365 (or on-prem Exchange) servers."}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 2, "last_activity_date": 1567589291, "creation_date": 1567589291, "answer_id": 57785430, "question_id": 57783841, "link": "https://stackoverflow.com/questions/57783841/how-to-send-email-using-outlooks-smtp-servers/57785430#57785430", "title": "How to send email using Outlook&#39;s SMTP servers?", "body": "<blockquote>\n<pre><code>auth := smtp.PlainAuth(\"\", user, pass, server)\n</code></pre>\n</blockquote>\n\n<p>This is using the authentication method PLAIN. Unfortunately smtp-mail.outlook.com does not support this authentication method:</p>\n\n<pre><code>&gt; EHLO example.com\n&lt; 250-AM0PR10CA0007.outlook.office365.com Hello ...\n&lt; 250- ...\n&lt; 250-AUTH LOGIN XOAUTH2\n</code></pre>\n\n<p>Thus, only LOGIN and XOAUTH2 are supported as authentication methods.</p>\n\n<blockquote>\n<pre><code>server.login(user, password)\n</code></pre>\n</blockquote>\n\n<p>Python supports LOGIN so it will succeed.</p>\n\n<p>Golang smtp does not support LOGIN. But <a href=\"https://gist.github.com/andelf/5118732\" rel=\"nofollow noreferrer\">this gist</a> seems to provide a working fix by adding this missing authentication method.</p>\n"}], "owner": {"reputation": 3647, "user_id": 4093955, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/bjZjz.jpg?s=128&g=1", "display_name": "Ay0", "link": "https://stackoverflow.com/users/4093955/ay0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1027, "favorite_count": 1, "accepted_answer_id": 57785430, "answer_count": 1, "score": 1, "last_activity_date": 1567589291, "creation_date": 1567583643, "question_id": 57783841, "link": "https://stackoverflow.com/questions/57783841/how-to-send-email-using-outlooks-smtp-servers", "title": "How to send email using Outlook&#39;s SMTP servers?", "body": "<p>I want to send an email using Outlook servers, but I'm getting an error <code>504 5.7.4 Unrecognized authentication type</code></p>\n\n<p>Here's the snippet.</p>\n\n<pre><code>func sendEmail() {\n    server := \"smtp-mail.outlook.com\n    port := 587\n    user := \"foo@outlook.com\"\n    from := user\n    pass := \"foobar\"\n    dest := \"bar@gmail.com\"\n\n    auth := smtp.PlainAuth(\"\", user, pass, server)\n\n    to := []string{dest}\n\n    msg := []byte(\"From: \" + from + \"\\n\" +\n        \"To: \" + dest + \"\\n\" +\n        \"Subject: Test outlook\\n\" +\n        \"OK\")\n\n    endpoint := server + \":\" + port\n    err := smtp.SendMail(endpoint, auth, from, to, msg)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>If instead of sending the email using outlook, I use gmail, it works fine. </p>\n\n<p>In Python, I can send the email using outlook with the following code:</p>\n\n<pre><code>    server = smtplib.SMTP(server, port)\n    server.starttls()\n    server.login(user, password)\n    server.sendmail(from, to, msg)\n    server.quit()\n</code></pre>\n\n<p>So I guess I'm missing something in my Go code. According to the <a href=\"https://golang.org/pkg/net/smtp/#SendMail\" rel=\"nofollow noreferrer\">doc</a>, <code>SendMail</code> switches to <code>TLS</code>, so that shouldn't be the issue.</p>\n"}, {"tags": ["linux", "go", "process", "operating-system"], "comments": [{"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 1, "creation_date": 1567581646, "post_id": 57783261, "comment_id": 102000430, "body": "i think that for example the garbage collector runs in its own thread"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1567605091, "post_id": 57783261, "comment_id": 102012975, "body": "It does run a single process, but it runs multiple threads."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 7, "last_activity_date": 1567583721, "creation_date": 1567583721, "answer_id": 57783865, "question_id": 57783261, "link": "https://stackoverflow.com/questions/57783261/why-is-go-app-running-as-several-processes/57783865#57783865", "title": "Why is go app running as several processes?", "body": "<blockquote>\n  <p>Can someone explain to me why is that happening?</p>\n</blockquote>\n\n<p>Yes. You are either using htop or top with H which shows threads. Your program uses several threads like any Go program (see also Pizza lord's comment).</p>\n"}], "owner": {"reputation": 137, "user_id": 5562332, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f7396b0c9b7352debad016528f45fb36?s=128&d=identicon&r=PG&f=1", "display_name": "IFeel3", "link": "https://stackoverflow.com/users/5562332/ifeel3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 1, "accepted_answer_id": 57783865, "answer_count": 1, "score": 1, "last_activity_date": 1567583721, "creation_date": 1567581243, "question_id": 57783261, "link": "https://stackoverflow.com/questions/57783261/why-is-go-app-running-as-several-processes", "title": "Why is go app running as several processes?", "body": "<p>I have a very simple program written in go: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    fmt.Println(\"hello\")\n    time.Sleep(5 * time.Second)\n    fmt.Println(\"good bye\")\n}\n\n</code></pre>\n\n<p>Now I'm building it using \"go build .\". When I look at htop to see the application running, it shows me that several processes are being executed on my machine. </p>\n\n<p><img src=\"https://i.imgur.com/aCI8xsD.png\" alt=\"htop output\"></p>\n\n<p>Can someone explain to me why is that happening? I would expect a single goroutine program to run as single process.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 55, "user_id": 11898878, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KKfAm-JPmj4/AAAAAAAAAAI/AAAAAAAAAAk/F99sJ0yJSpI/photo.jpg?sz=128", "display_name": "Taylor Belland", "link": "https://stackoverflow.com/users/11898878/taylor-belland"}, "edited": false, "score": 0, "creation_date": 1567579449, "post_id": 57782461, "comment_id": 101999460, "body": "cleaned up the code so it should work with a few minor imports"}, {"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 0, "creation_date": 1567716634, "post_id": 57782461, "comment_id": 102056951, "body": "I suggest to use something similar to <a href=\"https://github.com/buger/goterm\" rel=\"nofollow noreferrer\">github.com/buger/goterm</a>. You cannot write an IDE with Printf, you need low-level terminal operations."}, {"owner": {"reputation": 55, "user_id": 11898878, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KKfAm-JPmj4/AAAAAAAAAAI/AAAAAAAAAAk/F99sJ0yJSpI/photo.jpg?sz=128", "display_name": "Taylor Belland", "link": "https://stackoverflow.com/users/11898878/taylor-belland"}, "reply_to_user": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 0, "creation_date": 1567723236, "post_id": 57782461, "comment_id": 102058674, "body": "Thanks but no thanks. Just wondering what is going on in a lower level here."}], "answers": [{"tags": [], "owner": {"reputation": 1091, "user_id": 1893290, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd02a775db447cf44762ecb35687b9e1?s=128&d=identicon&r=PG", "display_name": "Jacob Evan Shreve", "link": "https://stackoverflow.com/users/1893290/jacob-evan-shreve"}, "is_accepted": true, "score": 1, "last_activity_date": 1568249067, "creation_date": 1568249067, "answer_id": 57898351, "question_id": 57782461, "link": "https://stackoverflow.com/questions/57782461/cursor-movement-wont-happen-without-a-fmt-print/57898351#57898351", "title": "Cursor movement won&#39;t happen without a fmt.Print()", "body": "<p>When you press the arrow keys, they are printing escape sequences to STDIN. You are capturing those escape sequences, checking what they are, then printing them back out so the movement can be interpreted by your terminal. When you take out the print statements, your terminal never receives the escape codes, so it doesn't know to move the cursor.</p>\n\n<p>Instead of just passing what you get from STDIN, you could write your own library that prints the escape sequences and make calls to that instead.</p>\n"}], "owner": {"reputation": 55, "user_id": 11898878, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KKfAm-JPmj4/AAAAAAAAAAI/AAAAAAAAAAk/F99sJ0yJSpI/photo.jpg?sz=128", "display_name": "Taylor Belland", "link": "https://stackoverflow.com/users/11898878/taylor-belland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 57898351, "answer_count": 1, "score": 0, "last_activity_date": 1568249067, "creation_date": 1567577674, "last_edit_date": 1567579349, "question_id": 57782461, "link": "https://stackoverflow.com/questions/57782461/cursor-movement-wont-happen-without-a-fmt-print", "title": "Cursor movement won&#39;t happen without a fmt.Print()", "body": "<p>Basically I'm making a Go IDE from scratch. One thing I came across while trying to make the cursor move around the screen was it wouldn't work if I didn't have a random fmt.Print(string(buffer)) in place.</p>\n\n<p>I managed to hack it in so it doesn't break the implementation further down the line. I have tried just showing a single slice, part of the slice, but no, it requires the whole thing converted to string.</p>\n\n<p><a href=\"https://gitlab.com/snippets/1891919\" rel=\"nofollow noreferrer\">https://gitlab.com/snippets/1891919</a>\nEDIT: wrong link</p>\n\n<p>snippetted because the formatting is wonky.</p>\n\n<p>That allows you to walk the cursor around, however if you take out the fmt.Printf(string(buffer)) it won't let you move around at all.</p>\n"}, {"tags": ["sql", "go", "join", "preload", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 685, "user_id": 1858458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e89cf2ec7a7d5a8066ee1444251cd430?s=128&d=identicon&r=PG", "display_name": "Hsiao", "link": "https://stackoverflow.com/users/1858458/hsiao"}, "is_accepted": false, "score": 3, "last_activity_date": 1567590272, "creation_date": 1567590272, "answer_id": 57785729, "question_id": 57782293, "link": "https://stackoverflow.com/questions/57782293/how-to-limit-results-of-preload-of-gorm/57785729#57785729", "title": "How to limit results of preload of gorm", "body": "<p>For postgresql only.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Topic struct {\n    Title string  `gorm:\"varchar(250);PRIMARY KEY\" json:\"title\"`\n    // assume the foreign key between two tables are both Title.\n    Items []*Item `gorm:\"foreignkey:Title;association_foreignkey:Title\" json:\"items,omitempty\"`\n}\n\nvar topics []Topic\ndb.Model(&amp;Topic{}).Preload(\"Items\", func(tx *gorm.DB) *gorm.DB {\n    return tx.Joins(`JOIN LATERAL (\n        SELECT i.url FROM items i WHERE i.title = items.title ORDER BY i.topic_id DESC LIMIT 5\n        ) AS foo ON foo.url = items.url`)\n}).Find(&amp;topics)\n</code></pre>\n\n<p>You could use lateral join to limit the rows for each different value. After retrieving the rows of <code>topics</code>, gorm then send the following query to get the related rows from <code>items</code>:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT \"items\".*\nFROM \"items\"\nJOIN LATERAL\n  (SELECT i.url\n   FROM items i\n   WHERE i.title = items.title\n   ORDER BY i.topic_id DESC\n   LIMIT 5) AS foo ON foo.url = items.url\nWHERE (\"title\" IN (?))\n</code></pre>\n"}], "owner": {"reputation": 860, "user_id": 2672481, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/1424393836/picture?type=large", "display_name": "Tony Wang", "link": "https://stackoverflow.com/users/2672481/tony-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 819, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1569967192, "creation_date": 1567576735, "last_edit_date": 1569967192, "question_id": 57782293, "link": "https://stackoverflow.com/questions/57782293/how-to-limit-results-of-preload-of-gorm", "title": "How to limit results of preload of gorm", "body": "<pre><code>type Item struct {\n    TopicId       int          `json:\"topic_id\"`\n    Topic         *Topic       `json:\"topic,omitempty\"`\n    BotId         int          `json:\"bot_id\"`\n    URL           string       `gorm:\"varchar(250);unique\" json:\"url\"`\n    Title         string       `gorm:\"varchar(250)\" json:\"title\"`\n}\n\ntype Topic struct {\n    Title       string      `gorm:\"varchar(250)\" json:\"title\"`\n    Items       []*Item     `json:\"items,omitempty\"`\n}\n</code></pre>\n\n<p>Here is the two models. I want to query the Topics with each have 5 latest items.</p>\n\n<p>Without the limit for items, I could do this by,<code>db.Model(&amp;Topic{}).Preload(\"Items\")</code>.</p>\n\n<p>When I try to add some limit conditions to items:</p>\n\n<pre><code>db.Model(&amp;Topic{}).Preload(\"Items\", func(db *gorm.DB) *gorm.DB {\n  return db.Order(\"title DESC\").Limit(5)\n})\n</code></pre>\n\n<p>It will return 5 items in total, not 5 items for each topic.</p>\n\n<p>Actual result:</p>\n\n<pre><code>\"records\": [\n            {\n                \"id\": 4,\n                \"created_on\": \"2019-08-11T10:28:54.910022Z\",\n                \"title\": \"Topic 1\",\n            },\n            {\n                \"id\": 5,\n                \"created_on\": \"2019-08-11T10:29:26.952614Z\",\n                \"title\": \"Programming\",\n            },\n            {\n                \"id\": 6,\n                \"created_on\": \"2019-08-11T10:34:16.040229Z\",\n                \"title\": \"Topic 3\",\n                \"items\": [\n                    {\n                        \"id\": 1,\n                        \"created_on\": \"2019-08-27T14:23:17.766055Z\",\n                        \"topic_id\": 6,\n                        \"title\": \"Title One\",\n                    },\n                    ......\n                    {\n                        \"id\": 5,\n                        \"created_on\": \"2019-08-27T14:23:17.766055Z\",\n                        \"topic_id\": 6,\n                        \"title\": \"Title five\",\n                    }\n                ]\n\n\n</code></pre>\n\n<p>Expected results:</p>\n\n<pre><code>\"records\": [\n            {\n                \"id\": 4,\n                \"created_on\": \"2019-08-11T10:28:54.910022Z\",\n                \"title\": \"Topic 1\",\n            },\n            {\n                \"id\": 5,\n                \"created_on\": \"2019-08-11T10:29:26.952614Z\",\n                \"title\": \"Programming\",\n                \"items\": [\n                    {\n                        \"id\": 6,\n                        \"created_on\": \"2019-08-27T14:23:17.766055Z\",\n                        \"topic_id\": 5,\n                        \"title\": \"Title six\",\n                    },\n                    ......\n                    {\n                        \"id\": 10,\n                        \"created_on\": \"2019-08-27T14:23:17.766055Z\",\n                        \"topic_id\": 5,\n                        \"title\": \"Title ten\",\n                    }]\n            },\n            {\n                \"id\": 6,\n                \"created_on\": \"2019-08-11T10:34:16.040229Z\",\n                \"title\": \"Topic 3\",\n                \"items\": [\n                    {\n                        \"id\": 1,\n                        \"created_on\": \"2019-08-27T14:23:17.766055Z\",\n                        \"topic_id\": 6,\n                        \"title\": \"Title One\",\n                    },\n                    ......\n                    {\n                        \"id\": 5,\n                        \"created_on\": \"2019-08-27T14:23:17.766055Z\",\n                        \"topic_id\": 6,\n                        \"title\": \"Title five\",\n                    }\n                ]\n\n\n\n\n</code></pre>\n\n<p>The actual sql it generated is <code>SELECT * FROM \"item\"  WHERE \"topic_id\" IN (6,4,5) DESC LIMIT 5</code></p>\n\n<p>It's obvious not the results I want, so how should I get the expected result with gorm?</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567573547, "post_id": 57781633, "comment_id": 101997532, "body": "The application is written to exit on an interrupt signal and on read errors.  What happens when you type control-c (or whatever key sequence sends an interrupt signal on your system)?"}, {"owner": {"reputation": 1, "user_id": 12017677, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6be7c3e25de8473abede81a302c4dd5b?s=128&d=identicon&r=PG&f=1", "display_name": "Meet ", "link": "https://stackoverflow.com/users/12017677/meet"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567574161, "post_id": 57781633, "comment_id": 101997671, "body": "I tried Ctrl+C but it is not getting close and it goes on interrupt case. Kindly refer response which i posted when i tried Ctrl+C i got that one @CeriseLim&#243;n !"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567575673, "post_id": 57781633, "comment_id": 101998091, "body": "The function should return given that &quot;Done In For&quot; is printed.  Add <code>defer fmt.Println(&quot;exiting WebSocketClientGO&quot;)</code> to the beginning of the function to confirm that function returns. Also, it looks like you attempted to gracefully close the connection with the select  at the end of the function, but that&#39;s useless given that the connection is closed before the select.  You should either delete the call to c.Close before the select. or gut the function of everything except the loops to read and write messages."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567576053, "post_id": 57781633, "comment_id": 101998201, "body": "Is the program written to exit when <code>WebSocketClientGO</code> returns?"}, {"owner": {"reputation": 1, "user_id": 12017677, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6be7c3e25de8473abede81a302c4dd5b?s=128&d=identicon&r=PG&f=1", "display_name": "Meet ", "link": "https://stackoverflow.com/users/12017677/meet"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567576864, "post_id": 57781633, "comment_id": 101998449, "body": "Yes @CeriseLim&#243;n"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567576954, "post_id": 57781633, "comment_id": 101998481, "body": "Does the <code>WebSocketClientGO </code> function return when CTRL-C is typed?  It looks like it does based on the code and output included in the question."}, {"owner": {"reputation": 1, "user_id": 12017677, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6be7c3e25de8473abede81a302c4dd5b?s=128&d=identicon&r=PG&f=1", "display_name": "Meet ", "link": "https://stackoverflow.com/users/12017677/meet"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567581539, "post_id": 57781633, "comment_id": 102000372, "body": "No its not return anything while typed Ctrl+C @CeriseLim&#243;n"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567610428, "post_id": 57781633, "comment_id": 102016108, "body": "Please post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>.  Specifically, show the code that calls <code>WebSocketClientGO</code> and ensures that the program exits when <code>WebSocketClientGO</code> returns."}], "owner": {"reputation": 1, "user_id": 12017677, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6be7c3e25de8473abede81a302c4dd5b?s=128&d=identicon&r=PG&f=1", "display_name": "Meet ", "link": "https://stackoverflow.com/users/12017677/meet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 151, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567574808, "creation_date": 1567572245, "last_edit_date": 1567574808, "question_id": 57781633, "link": "https://stackoverflow.com/questions/57781633/i-have-connected-it-as-a-client-by-using-gorilla-after-connecting-it-how-to-cl", "title": "I have connected it as a client by using gorilla. After connecting it. How to close it in GO?", "body": "<p>As i am learning golang to work with Web socket and its connected as a client from golang but after connecting it, its not getting disconnect. So how can i close it?</p>\n\n<pre><code>func WebSocketClientGO() {\n    flag.Parse()\n    log.SetFlags(0)\n\n    interrupt := make(chan os.Signal, 1)\n    signal.Notify(interrupt, os.Interrupt)\n\n    u := url.URL{Scheme: \"ws\", Host: *addr, Path: \"/ws/player/BHMb1QZoiQWcOVPxa7OMd0AUL\"}\n\n    log.Printf(\"connecting to %s\", u.String())\n\n    c, _, err := websocket.DefaultDialer.Dial(u.String(), nil)\n    if err != nil {\n        log.Fatal(\"dial:\", err)\n    }\n    defer c.Close()\n\n    done := make(chan struct{})\n\n\n    go func() {\n        defer close(done)\n        for {\n            _, message, err := c.ReadMessage()\n            if err != nil {\n                log.Println(\"read:\", err)\n                return\n            }\n            log.Printf(\"recv: %s\", message)\n        }\n    }()\n\n    ticker := time.NewTicker(time.Second)\n    defer ticker.Stop()\n\n    for {\n        select {\n        case &lt;-done:\n            return\n        case t := &lt;-ticker.C:\n            err := c.WriteMessage(websocket.TextMessage, []byte(t.String()))\n            if err != nil {\n                log.Println(\"write:\", err)\n                return\n            }\n        case &lt;-interrupt:\n            log.Println(\"interrupt\")\n\n            err := c.WriteMessage(websocket.CloseMessage, websocket.FormatCloseMessage(websocket.CloseNormalClosure, \"\"))\n            c.Close()\n            if err != nil {\n                log.Println(\"write close:\", err)\n                c.Close()\n                return\n            }\n            select {\n\n            case &lt;-done:\n                log.Println(\"Done In For\")\n            case &lt;-time.After(time.Second):\n                log.Println(\"Done In For With Time\")\n            }\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>This is response what i get but when i want to disconnect it it wont and it stuck so suggest me about this, i have find solutions but it wasn't working</p>\n\n<pre><code>connecting to ws://10.68.101.13:8061/ws/player/iHel5oWq9bTQC6lJpFwSRmIga\nrecv: {\"code\":500,\"data\":null,\"message\":\"Internal Error\",\"type\":\"ERROR\"}\ninterrupt\nread: read tcp 10.68.101.213:55709-&gt;10.68.101.13:8061: use of closed network connection\nDone In For\n</code></pre>\n"}, {"tags": ["go", "toml"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 3753310, "user_type": "registered", "profile_image": "https://graph.facebook.com/1035835622/picture?type=large", "display_name": "user3753310", "link": "https://stackoverflow.com/users/3753310/user3753310"}, "edited": false, "score": 0, "creation_date": 1567744601, "post_id": 57813108, "comment_id": 102062458, "body": "OK, thanks. I was checking the feasibility of editing particular key/value in the TOML file (just to retain the comments). If there is no other way, then fine, I&#39;ll go ahead with truncating existing file before writing tree.   Can you also check Question #1? tree.Has() is sending false even though the key is present in the tree."}, {"owner": {"reputation": 633, "user_id": 278535, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8daa064eb480645fc9d6b5b1e72b3a31?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/278535/thomas"}, "reply_to_user": {"reputation": 11, "user_id": 3753310, "user_type": "registered", "profile_image": "https://graph.facebook.com/1035835622/picture?type=large", "display_name": "user3753310", "link": "https://stackoverflow.com/users/3753310/user3753310"}, "edited": false, "score": 0, "creation_date": 1567787282, "post_id": 57813108, "comment_id": 102081391, "body": "Edited the answer to cover question 1 and comments."}, {"owner": {"reputation": 11, "user_id": 3753310, "user_type": "registered", "profile_image": "https://graph.facebook.com/1035835622/picture?type=large", "display_name": "user3753310", "link": "https://stackoverflow.com/users/3753310/user3753310"}, "edited": false, "score": 0, "creation_date": 1568012814, "post_id": 57813108, "comment_id": 102125263, "body": "OK, thank you, Thomas. I&#39;ll check further and get back :)"}, {"owner": {"reputation": 11, "user_id": 3753310, "user_type": "registered", "profile_image": "https://graph.facebook.com/1035835622/picture?type=large", "display_name": "user3753310", "link": "https://stackoverflow.com/users/3753310/user3753310"}, "edited": false, "score": 0, "creation_date": 1568029090, "post_id": 57813108, "comment_id": 102132692, "body": "Updated question with #3, can you please answer that too?"}], "tags": [], "owner": {"reputation": 633, "user_id": 278535, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8daa064eb480645fc9d6b5b1e72b3a31?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/278535/thomas"}, "is_accepted": false, "score": 0, "last_activity_date": 1568046640, "last_edit_date": 1568046640, "creation_date": 1567718377, "answer_id": 57813108, "question_id": 57781088, "link": "https://stackoverflow.com/questions/57781088/duplicate-keys-noticed-while-writing-to-toml-file-tree-has-is-not-working-as/57813108#57813108", "title": "Duplicate Keys noticed while writing to TOML file; tree.Has() is not working as expected", "body": "<p>For question 1:</p>\n\n<p>It is hard to figure out what may be going on without having access to the content of the files. If you believe this is a bug, please <a href=\"https://github.com/pelletier/go-toml/issues/new?template=bug_report.md\" rel=\"nofollow noreferrer\">open an issue on Github</a>, including the reproduction steps. Thank you!</p>\n\n<p>For question 2:</p>\n\n<p>You need to <a href=\"https://golang.org/pkg/os/#Remove\" rel=\"nofollow noreferrer\">remove</a> or <a href=\"https://golang.org/pkg/os/#File.Truncate\" rel=\"nofollow noreferrer\">truncate</a> the file before writing to it.</p>\n\n<p>Go-toml does not know that you are writing to a file. <code>WriteTo</code> takes a <code>io.Writer</code>, which just signifies \"something you can write to\". So when you open the file for read/write, the \"writer\" part of the file has a 0 offset. So when toml writes to it (using <code>WriteTo</code>), it will just be replacing bytes to the file.</p>\n\n<p>If you want to overwrite the content of the file using <code>WriteTo</code>, you need to call <code>.truncate(0)</code> or similar on the file before writing to it.</p>\n\n<p>Note: as of writing, comments are discarded during <code>Load</code>. There is an <a href=\"https://github.com/pelletier/go-toml/issues/207\" rel=\"nofollow noreferrer\">issue on Github</a> asking for that feature.</p>\n\n<p>For question 3:</p>\n\n<p>There is no support for erroring on missing keys or on extra keys. There is an <a href=\"https://github.com/pelletier/go-toml/issues/277\" rel=\"nofollow noreferrer\">issue open</a> at the moment to support the latter.</p>\n"}], "owner": {"reputation": 11, "user_id": 3753310, "user_type": "registered", "profile_image": "https://graph.facebook.com/1035835622/picture?type=large", "display_name": "user3753310", "link": "https://stackoverflow.com/users/3753310/user3753310"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1568046640, "creation_date": 1567567484, "last_edit_date": 1568029014, "question_id": 57781088, "link": "https://stackoverflow.com/questions/57781088/duplicate-keys-noticed-while-writing-to-toml-file-tree-has-is-not-working-as", "title": "Duplicate Keys noticed while writing to TOML file; tree.Has() is not working as expected", "body": "<p>While writing into TOML file using go-toml parser, I'm seeing all duplicate entries. \nWhich one is correct about tree.WriteTo() function?\na. overwrites the fields in the file \nb. appends the tree to the file? i.e., to the existing file, write the tree content again.</p>\n\n<p>I wanted to achieve the update operation to the existing config parameter (present in TOML file).</p>\n\n<p>I tried this:</p>\n\n<pre><code>//Read the config file\ntree, _ := toml.LoadFile(\"/home/robot/test.toml\")\n\n//Read user input\nreqBody, err := ioutil.ReadAll(r.Body)\n                if err != nil {\n                        log.Fatal(err)\n                }\n\n//Check whether the input config parameter is present in the file or not\nconfigArray := strings.Split(string(reqBody), \";\")\n                for index, each := range configArray {\n                        config := strings.Split(each, \"=\")\n                        fmt.Println(\"Param name : \", config[0])\n                        fmt.Println(\"Param value  : \", config[1])\n                        fmt.Println(index)\n                        isPresent := tree.Has(config[0])\n                        fmt.Println(isPresent)\n                        if isPresent == true {\n                                tree.Set(config[0], config[1])\n                        }else {\n                                fmt.Println(\"Config Parameter not found\")\n                        }\n                }\n\n// Now the tree has updated values, update the file.\noutputReader, err = os.OpenFile(\"/home/robot/test.toml\",os.O_RDWR,0644)\n                if err != nil {\n                        fmt.Println(\"Error opening the file\")\n                }\n                var numBytes  int64\n                numBytes, err = tree.WriteTo(outputReader)\n                if err != nil {\n                        fmt.Println(\"Error writing to the file\")\n                }\n                fmt.Println(numBytes)\n</code></pre>\n\n<ol>\n<li>tree.Has() is always returning false, even though the valid key is provided. Not sure why! Please see the output logs pasted.</li>\n<li>tree.WriteTo() is appending all the tree entries to the file. i.e., it is not updating the parameter values, but writing everything newly resulting in duplicate configuration parameters in the file.</li>\n</ol>\n\n<p>If tree.WriteTo() is meant to write entire tree content to file, then is there any API or way to update the existing configurations in TOML file?</p>\n\n<p><strong><em>Output logs:</em></strong></p>\n\n<p><strong>TOML content (i.e., dump of tree):</strong></p>\n\n<pre><code>Sep 03 13:27:33 mn-0 janus[31157]: [http]\nSep 03 13:27:33 mn-0 janus[31157]:   enableAudit = true\nSep 03 13:27:33 mn-0 janus[31157]:   idleTimeout = \"600s\"\nSep 03 13:27:33 mn-0 janus[31157]:   logLevel = \"debug\"\nSep 03 13:27:33 mn-0 janus[31157]:   port = 443\nSep 03 13:27:33 mn-0 janus[31157]:   readTimeout = \"10s\"\nSep 03 13:27:33 mn-0 janus[31157]:   tlsMode = true\nSep 03 13:27:33 mn-0 janus[31157]:   writeTimeout = \"10s\"\nSep 03 13:27:33 mn-0 janus[31157]:   [http.cred]\nSep 03 13:27:33 mn-0 janus[31157]:     sessionValidity = \"1h\"\nSep 03 13:27:33 mn-0 janus[31157]:     strictSecureMode = false\nSep 03 13:27:33 mn-0 janus[31157]:     users = [\"robot\"]\nSep 03 13:27:33 mn-0 janus[31157]:   [http.ipConfig]\nSep 03 13:27:33 mn-0 janus[31157]:     ipAddr = \"\"\nSep 03 13:27:33 mn-0 janus[31157]:     role = \"ssh\"\n</code></pre>\n\n<p><strong>Input invalid key:</strong></p>\n\n<pre><code>Sep 03 13:27:33 mn-0 janus[31157]: Param name :  http.enableAudt\nSep 03 13:27:33 mn-0 janus[31157]: Param value  :   true\nSep 03 13:27:33 mn-0 janus[31157]: 0\nSep 03 13:27:33 mn-0 janus[31157]: false\n</code></pre>\n\n<p><strong>Input valid Key:</strong></p>\n\n<pre><code>Sep 03 13:27:33 mn-0 janus[31157]: Param name :   http.enableAudit \nSep 03 13:27:33 mn-0 janus[31157]: Param value  :   false\nSep 03 13:27:33 mn-0 janus[31157]: 1\nSep 03 13:27:33 mn-0 janus[31157]: false\n</code></pre>\n\n<ol start=\"3\">\n<li><p>One more question on unmarshal() or configuration validation while reading, \nSay my structure is like this.</p>\n\n<p>type IPConfig struct {\n        User    string\n        Role    string\n        IPAddr  string\n}</p>\n\n<p>type MyConfiguration struct {\n        MyConfiguration MyConfiguration\n}</p></li>\n</ol>\n\n<p>a. \nIf the TOML file has this:</p>\n\n<pre><code>[ipConfig]\n    role = \"ssh\"\n    ipAddr  = \"\"\n</code></pre>\n\n<p>i.e., it doesn't have one more parameter, \"User\". How do I catch this while Unmarshal? At least Unmarshal() will not throw any error here.</p>\n\n<p>b.\nIf the TOML file has this:</p>\n\n<pre><code>[ipConfig]\n    role = \"ssh\"\n    ipAddr  = \"\"\n    user = \"lauren\"\n    abc = \"xyz\"\n</code></pre>\n\n<p>i.e., it has extra configuration parameter \"abc\". How to catch this? Unmarshal() didn't throw any error even for this.</p>\n\n<p>Any way to get these validation errors?</p>\n"}, {"tags": ["go", "downcast", "type-assertion", "go-interface"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1567573597, "post_id": 57781058, "comment_id": 101997552, "body": "Regardless of the value being <code>nil</code> or not, when doing <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> use the comma-ok idiom to avoid panics. <i>(see the last paragraph in the linked section of the documentation)</i>"}, {"owner": {"reputation": 1690, "user_id": 1436495, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/d02ac35277cff6137edc0aa48a0e58cf?s=128&d=identicon&r=PG", "display_name": "crunk1", "link": "https://stackoverflow.com/users/1436495/crunk1"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567576179, "post_id": 57781058, "comment_id": 101998233, "body": "Considering my use case, I don&#39;t mind the panics. I&#39;m using it for a mock client so when implement tests, I can set return values for the mock client methods. Having it panic is actually helpful in this case because a panic fails fast and means that my test is implemented incorrectly."}], "answers": [{"comments": [{"owner": {"reputation": 1690, "user_id": 1436495, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/d02ac35277cff6137edc0aa48a0e58cf?s=128&d=identicon&r=PG", "display_name": "crunk1", "link": "https://stackoverflow.com/users/1436495/crunk1"}, "edited": false, "score": 0, "creation_date": 1567575799, "post_id": 57781089, "comment_id": 101998130, "body": "Seems like a good way to do it in this case. Though, I am curious about the semantics of type assertions on nil interfaces. Even <code>var i interface{}; i.(interface{})</code> panics."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 1690, "user_id": 1436495, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/d02ac35277cff6137edc0aa48a0e58cf?s=128&d=identicon&r=PG", "display_name": "crunk1", "link": "https://stackoverflow.com/users/1436495/crunk1"}, "edited": false, "score": 1, "creation_date": 1567576314, "post_id": 57781089, "comment_id": 101998268, "body": "In that case, i is nil, so type assertion panics because it looks at the value of the interface, but the value is nil. The v,_:=i.(interface{}) will not panic because if checks first if i can be converted to an interface. If i was a non-nil interface with nil value, then the type assertion would not fail."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1567576888, "post_id": 57781089, "comment_id": 101998457, "body": "@ScottCrunkleton This has little to do with the fact that the value is <code>nil</code>, the problem is that the <code>nil</code> is <i>untyped</i>, i.e. the type of the &quot;non-value&quot; stored in <code>i</code> is not <code>interface{}</code>, is not anything, and so <code>i.(interface{})</code> fails, and without <code>, ok</code> it panics. Try giving <code>i</code> a <i>typed</i> <code>nil</code>, and then asssert <code>i</code> to that type, does it still panic? No it doesn&#39;t. <a href=\"https://play.golang.com/p/_xFk0jX5YIW\" rel=\"nofollow noreferrer\">play.golang.com/p/_xFk0jX5YIW</a>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 4, "creation_date": 1567577375, "post_id": 57781089, "comment_id": 101998636, "body": "An interface has a pair of references, a reference to a type and reference to a value. If the interface itself is nil, then these are both nil. If the interface points to a nil value, then the type is non-nil (it points to the type of the nil value), but the value is nil. If the interface is of the first kind, type assertion fails because type is nil. If the interface is of the second kind, type assertion works because there is a non-nil type."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1567577897, "post_id": 57781089, "comment_id": 101998852, "body": "@bserdar +1 your&#39;s is a much more accurate and clear explanation then my attempt."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 4, "last_activity_date": 1567585893, "last_edit_date": 1567585893, "creation_date": 1567567518, "answer_id": 57781089, "question_id": 57781058, "link": "https://stackoverflow.com/questions/57781058/how-to-cast-nil-interface-to-nil-other-interface/57781089#57781089", "title": "How to cast nil interface to nil other interface", "body": "<p>Does this work?</p>\n\n<pre><code>func preferredWay(i interface{}) error {\n    k, _ := i.(error)\n    return k\n}\n</code></pre>\n"}], "owner": {"reputation": 1690, "user_id": 1436495, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/d02ac35277cff6137edc0aa48a0e58cf?s=128&d=identicon&r=PG", "display_name": "crunk1", "link": "https://stackoverflow.com/users/1436495/crunk1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 969, "favorite_count": 0, "accepted_answer_id": 57781089, "answer_count": 1, "score": 1, "last_activity_date": 1567585893, "creation_date": 1567567240, "last_edit_date": 1567585874, "question_id": 57781058, "link": "https://stackoverflow.com/questions/57781058/how-to-cast-nil-interface-to-nil-other-interface", "title": "How to cast nil interface to nil other interface", "body": "<p>I have a classic Go nil interface issue.</p>\n\n<p>I'm trying to assert an <code>interface{}</code>, which I assign from a <code>nil</code> <code>error</code>, back to an <code>error</code> interface. That sentence is confusing so I have a handy-dandy example: <a href=\"https://play.golang.com/p/Qhv7197oIE_z\" rel=\"nofollow noreferrer\">https://play.golang.com/p/Qhv7197oIE_z</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc preferredWay(i interface{}) error {\n    return i.(error)\n}\n\nfunc workAround(i interface{}) error {\n    if i == nil {\n        return nil\n    }\n    return i.(error)\n}\n\nfunc main() {\n    var nilErr error\n    fmt.Println(workAround(nilErr))    // Prints \"&lt;nil&gt;\" as expected.\n    fmt.Println(preferredWay(nilErr))  // Panics.\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&lt;nil&gt;\npanic: interface conversion: interface is nil, not error\n\ngoroutine 1 [running]:\nmain.preferredWay(...)\n    /tmp/sandbox415300914/prog.go:8\nmain.main()\n    /tmp/sandbox415300914/prog.go:21 +0xa0\n</code></pre>\n\n<p>So in other words, I'm trying to downcast from a <code>nil</code> <code>interface{}</code> to a <code>nil</code> <code>error</code> interface. Is there an elegant way to do this if I know the <code>interface{}</code> was assigned as a <code>nil</code> <code>error</code> to begin with?</p>\n\n<p>FYI, if this seems unusual, it's because I'm implementing some mocking for testing.</p>\n"}, {"tags": ["go", "visual-studio-code", "delve"], "answers": [{"tags": [], "owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "is_accepted": true, "score": 1, "last_activity_date": 1567573633, "last_edit_date": 1567573633, "creation_date": 1567573199, "answer_id": 57781750, "question_id": 57780762, "link": "https://stackoverflow.com/questions/57780762/how-do-i-print-the-value-of-objects-to-the-console-with-gos-delve-and-visual/57781750#57781750", "title": "How do I &quot;print&quot; the value of objects to the console with Go&#39;s Delve and Visual Studio Code?", "body": "<p>In debug console type <code>foo</code> (without <code>po</code> prefix)</p>\n"}], "owner": {"reputation": 27533, "user_id": 998117, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/bfe07f542ce4f5d75e4262e188691fd5?s=128&d=identicon&r=PG&f=1", "display_name": "Doug Smith", "link": "https://stackoverflow.com/users/998117/doug-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 57781750, "answer_count": 1, "score": 0, "last_activity_date": 1567573633, "creation_date": 1567564489, "question_id": 57780762, "link": "https://stackoverflow.com/questions/57780762/how-do-i-print-the-value-of-objects-to-the-console-with-gos-delve-and-visual", "title": "How do I &quot;print&quot; the value of objects to the console with Go&#39;s Delve and Visual Studio Code?", "body": "<p>I have the \"Delve\" debugger setup for Go with Visual Studio code and a super simple program. If I set a breakpoint, and I want to print a variable declared earlier, I'm used to being able to say <code>po foo</code> to print out the value of the object foo to the console, but Visual Studio Code just complains about \"expected 'EOF'\".</p>\n\n<p>How do I print? If I wanted to test things out by printing out values, does Delve not support that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 15921, "user_id": 1542723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8a969ba62fc77da0a20654caffbe234?s=128&d=identicon&r=PG", "display_name": "Ferrybig", "link": "https://stackoverflow.com/users/1542723/ferrybig"}, "edited": false, "score": 0, "creation_date": 1567578677, "post_id": 57780756, "comment_id": 101999155, "body": "My first guess is that you need an newline character after <code>hello</code>, as scanln might be scanning for lines"}], "answers": [{"comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "edited": false, "score": 0, "creation_date": 1567567114, "post_id": 57780855, "comment_id": 101996373, "body": "@fwhez fixed answer."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1567567088, "last_edit_date": 1567567088, "creation_date": 1567565274, "answer_id": 57780855, "question_id": 57780756, "link": "https://stackoverflow.com/questions/57780756/how-to-handle-user-input-using-os-exec-in-golang-i-cant-stop-input-stage/57780855#57780855", "title": "How to handle user input using os/exec in golang? I can&#39;t stop input stage", "body": "<p>You need to be listening to the output of the executing program. When you write \"hello\", the program is probably still writing to its stdout. Try this:</p>\n\n<pre><code>    go func() {\n        in := bufio.NewReader(stdout)\n        for {\n            s, err := in.ReadString('\\n')\n            if err != nil {\n                return\n            }\n            fmt.Println(s)\n        }\n    }()\n\n    if e := cmd.Start(); e != nil {\n        panic(e)\n    }\n\n    stdin.Write([]byte(\"hello\\n\"))\n    stdin.Write([]byte(\"hello2\\n\"))\n    if e := cmd.Wait(); e != nil {\n        panic(e)\n    }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "edited": false, "score": 0, "creation_date": 1567576318, "post_id": 57781082, "comment_id": 101998269, "body": "3q, it helps a lot"}], "tags": [], "owner": {"reputation": 84923, "user_id": 1920232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iUA8y.jpg?s=128&g=1", "display_name": "peterm", "link": "https://stackoverflow.com/users/1920232/peterm"}, "is_accepted": false, "score": 1, "last_activity_date": 1567567443, "creation_date": 1567567443, "answer_id": 57781082, "question_id": 57780756, "link": "https://stackoverflow.com/questions/57780756/how-to-handle-user-input-using-os-exec-in-golang-i-cant-stop-input-stage/57781082#57781082", "title": "How to handle user input using os/exec in golang? I can&#39;t stop input stage", "body": "<p>One way to do it</p>\n\n<pre><code>cmd := exec.Command(\"...\") // Change to your path\nstdin, err := cmd.StdinPipe()\nif err != nil {\n    panic(err)\n}\nstdout, err := cmd.StdoutPipe()\nif err != nil {\n    panic(err)\n}\n\nbuf := bytes.NewBuffer(nil)\n// read the stdout continuously in a separate goroutine and capture it in buf\ngo func() {\n    io.Copy(buf, stdout)\n}()\n\nif err := cmd.Start(); err != nil {\n    panic(err)\n}\n\nstdin.Write([]byte(\"hello\\n\")) // Send \\n to submit\nstdin.Write([]byte(\"world\\n\"))\n\nif err := cmd.Wait(); err != nil {\n    panic(err)\n}\n\nfmt.Fprint(os.Stdout, buf)\n</code></pre>\n\n<p>Result:</p>\n\n<pre>\n\u279c go run main.go\ninput a value\nhello\ninput another value\nworld\n</pre>\n"}, {"comments": [{"owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "edited": false, "score": 0, "creation_date": 1567576017, "post_id": 57781408, "comment_id": 101998183, "body": "3q, it helps a lot"}], "tags": [], "owner": {"reputation": 547, "user_id": 10201437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9066621f4fa9987ca2148edc002bf057?s=128&d=identicon&r=PG&f=1", "display_name": "ConnectionLost", "link": "https://stackoverflow.com/users/10201437/connectionlost"}, "is_accepted": true, "score": 1, "last_activity_date": 1567572396, "last_edit_date": 1567572396, "creation_date": 1567570642, "answer_id": 57781408, "question_id": 57780756, "link": "https://stackoverflow.com/questions/57780756/how-to-handle-user-input-using-os-exec-in-golang-i-cant-stop-input-stage/57781408#57781408", "title": "How to handle user input using os/exec in golang? I can&#39;t stop input stage", "body": "<p>The program is blocking because the <code>fmt.Scanln</code> in the subprocess is waiting for the <code>\\n</code> character (an <code>EOF</code> would also cause it to return). To avoid blocking, your input should include two <code>\\n</code>s, or you can just call 'stdin.Close()' to indicate that the input stream is done.</p>\n\n<p>And since the subprocess calls <code>Scanln</code> and <code>Println</code> multiple times, a single call to <code>stdout.Read</code> may not read the complete output from the subprocess. You can keep calling the <code>stdout.Read()</code> until an <code>io.EOF</code> error is returned, or just use the <code>ioutil.ReadAll</code>.</p>\n\n<pre><code>func main() {\n    cmd := exec.Command(\"G:\\\\go_workspace\\\\GOPATH\\\\src\\\\pjx\\\\modules\\\\exec\\\\exec\")\n\n    stdin, e := cmd.StdinPipe()\n    if e != nil {\n        panic(e)\n    }\n\n    stdout, e := cmd.StdoutPipe()\n    if e != nil {\n        panic(e)\n    }\n    if e := cmd.Start(); e != nil {\n        panic(e)\n    }\n    _, e = stdin.Write([]byte(\"hello\\nworld\\n\"))\n    if e != nil {\n        panic(e)\n    }\n    stdin.Close()\n\n    out, _ := ioutil.ReadAll(stdout)\n    // or you can use a loop\n    //for {\n    //  var buf = make([]byte, 512)\n    //  n, e := stdout.Read(buf)\n    //  if e == io.EOF {\n    //      break\n    //  }\n    //  if e != nil {\n    //      panic(e)\n    //  }\n    //  fmt.Println(string(buf[:n]))\n    //}\n\n    fmt.Println(string(out))\n\n    if e := cmd.Wait(); e != nil {\n        panic(e)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 817, "favorite_count": 0, "accepted_answer_id": 57781408, "answer_count": 3, "score": 0, "last_activity_date": 1567572396, "creation_date": 1567564419, "question_id": 57780756, "link": "https://stackoverflow.com/questions/57780756/how-to-handle-user-input-using-os-exec-in-golang-i-cant-stop-input-stage", "title": "How to handle user input using os/exec in golang? I can&#39;t stop input stage", "body": "<p>First, I build a command as exec.exe from this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\nimport \"fmt\"\nfunc main() {\n    var input string\n    fmt.Println(\"input a value\")\n    fmt.Scanln(&amp;input)\n    fmt.Println(input)\n\n    fmt.Println(\"input another value\")\n    fmt.Scanln(&amp;input)\n    fmt.Println(input)\n}\n</code></pre>\n\n<p>Then I want to use os/exec pacage to run it:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"G:\\\\go_workspace\\\\GOPATH\\\\src\\\\pjx\\\\modules\\\\exec\\\\exec\")\n\n    stdin, e := cmd.StdinPipe()\n    if e != nil {\n        panic(e)\n    }\n    stdout, e := cmd.StdoutPipe()\n    if e != nil {\n        panic(e)\n    }\n    if e:=cmd.Start();e!=nil {\n        panic(e)\n    }\n    stdin.Write([]byte(\"hello\"))\n    var buf = make([]byte, 512)\n    n, e := stdout.Read(buf)\n    if e != nil {\n        panic(e)\n    }\n    fmt.Println(string(buf[:n]))\n\n    if e := cmd.Wait(); e != nil {\n        panic(e)\n    }\n}\n</code></pre>\n\n<p>Finally I run it, and result will pause on the user input stage,like:</p>\n\n<p>(in case picture is not loaded, they're paused on input stage)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>please input a value:\n\n1\n12\n232\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/A7nKk.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/A7nKk.png\" alt=\"unexpected result, pausing on user input stage\"></a></p>\n\n<p>Did I use cmd pipe in a wrong way?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1567576357, "post_id": 57780506, "comment_id": 101998280, "body": "The site might have other <code>div</code>s with <code>id=&quot;price&quot;</code>. Another possibility is that the data is loaded dynamically, which means that if you download the html page the price isn&#39;t there yet, it is loaded after the page is ready. You might be able to check this in the Network tab of the browser console if you filter by <code>XHR</code>, then reload the page"}], "owner": {"reputation": 163, "user_id": 10925607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bdb55b1676c9edcd49927fa553180da?s=128&d=identicon&r=PG&f=1", "display_name": "purplecity", "link": "https://stackoverflow.com/users/10925607/purplecity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1567561642, "creation_date": 1567561642, "question_id": 57780506, "link": "https://stackoverflow.com/questions/57780506/use-gocolly-to-get-div-element-failed", "title": "use gocolly to get div element failed", "body": "<p>i want get the price 2930.15 (follow red frame)</p>\n\n<p><a href=\"https://i.stack.imgur.com/gLCcJ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/gLCcJ.png\" alt=\"enter image description here\"></a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>c.OnHTML(\"div[id=price]\", func(e *colly.HTMLElement) {\n        fmt.Printf(\"test----%+v\\n\",e)\n        price,err := strconv.ParseFloat(e.Text,64)\n        //price := e.Text\n        fmt.Printf(\"********* price----%+v\\n\",price)\n\n        if err != nil {\n\n            fmt.Printf(\"parse err---%+v\\n\",err)\n\n        }\n\n\n    })\n</code></pre>\n\n<p>then print</p>\n\n<pre><code>test----&amp;{Name:div Text:@now@ attributes:[{Namespace: Key:id Val:price} {Namespace: Key:class Val:@UD_change@}] Request:0xc00013c280 Response:0xc000354240 DOM:0xc000558180 Index:0}\n********* price----0\nparse err---strconv.ParseFloat: parsing \"@now@\": invalid syntax\n</code></pre>\n\n<p>how to do ? where i wrong?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 14735, "user_id": 167814, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/53ee4a3bcfdb4e8f4c37991900ab48ef?s=128&d=identicon&r=PG", "display_name": "Abhijeet Rastogi", "link": "https://stackoverflow.com/users/167814/abhijeet-rastogi"}, "edited": false, "score": 0, "creation_date": 1567561962, "post_id": 57780468, "comment_id": 101995601, "body": "I knew it was something simple! Thanks."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1567561738, "last_edit_date": 1567561738, "creation_date": 1567561315, "answer_id": 57780468, "question_id": 57780438, "link": "https://stackoverflow.com/questions/57780438/unable-to-set-post-body-in-a-http-request/57780468#57780468", "title": "Unable to set POST body in a http request", "body": "<p>The server expects a valid value for the Content-Type request header.</p>\n\n<pre><code>r, err := http.NewRequest(http.MethodPost, apiURL, strings.NewReader(data.Encode()))\nif err != nil {\n    panic(err)\n}\nr.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\") // &lt;-- add this line\nresp, err := client.Do(r)\n</code></pre>\n\n<p>The server also supports JSON request bodies:</p>\n\n<pre><code>r, err := http.NewRequest(http.MethodPost, apiURL, strings.NewReader(`{\"url\": \"https://www.google.com/\"}`))\nif err != nil {\n    panic(err)\n}\nr.Header.Set(\"Content-Type\", \"application/json\")\nresp, err := http.DefaultClient.Do(r)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "is_accepted": false, "score": 0, "last_activity_date": 1567581637, "creation_date": 1567581637, "answer_id": 57783357, "question_id": 57780438, "link": "https://stackoverflow.com/questions/57780438/unable-to-set-post-body-in-a-http-request/57783357#57783357", "title": "Unable to set POST body in a http request", "body": "<blockquote>\n  <p>You can do something like this</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"strings\"\n)\n\nfunc main() {\n\n    url := \"https://cleanuri.com/api/v1/shorten\"\n\n    payload := strings.NewReader(\"url=https://www.google.com/\")\n\n    req, err := http.NewRequest(\"POST\", url, payload)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    req.Header.Add(\"content-type\", \"application/x-www-form-urlencoded\")\n    req.Header.Add(\"cache-control\", \"no-cache\")\n\n    res, err := http.DefaultClient.Do(req)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    defer res.Body.Close()\n    body, _ := ioutil.ReadAll(res.Body)\n\n    fmt.Println(res)\n    fmt.Println(string(body))\n\n}\n</code></pre>\n"}], "owner": {"reputation": 14735, "user_id": 167814, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/53ee4a3bcfdb4e8f4c37991900ab48ef?s=128&d=identicon&r=PG", "display_name": "Abhijeet Rastogi", "link": "https://stackoverflow.com/users/167814/abhijeet-rastogi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 577, "favorite_count": 0, "accepted_answer_id": 57780468, "answer_count": 2, "score": 1, "last_activity_date": 1567581637, "creation_date": 1567560981, "question_id": 57780438, "link": "https://stackoverflow.com/questions/57780438/unable-to-set-post-body-in-a-http-request", "title": "Unable to set POST body in a http request", "body": "<p>Is this not the right way to set POST request body? </p>\n\n<pre><code>data := url.Values{}\ndata.Set(\"url\", \"https://www.google.com/\")\n\nclient := http.Client{}\nr, err := http.NewRequest(http.MethodPost, apiURL, strings.NewReader(data.Encode()))\n</code></pre>\n\n<p>The code below when executed suggests that no <code>url param</code> was sent in the <code>POST</code> request. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"net/url\"\n    \"strings\"\n)\n\nfunc doAPICall() {\n    // curl -XPOST -d 'url=https://www.google.com/' 'https://cleanuri.com/api/v1/shorten'\n    apiURL := \"https://cleanuri.com/api/v1/shorten\"\n\n    data := url.Values{}\n    data.Set(\"url\", \"https://www.google.com/\")\n\n    client := http.Client{}\n    r, err := http.NewRequest(http.MethodPost, apiURL, strings.NewReader(data.Encode()))\n    if err != nil {\n        panic(err)\n    }\n    resp, err := client.Do(r)\n    if err != nil {\n        panic(err)\n    }\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(body))\n}\nfunc main() {\n    doAPICall()\n}\n</code></pre>\n\n<p>Output:-</p>\n\n<pre><code>$ go run .\n{\"error\":\"API Error: URL is empty\"}\n$ \n</code></pre>\n"}, {"tags": ["pointers", "go", "struct", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "edited": false, "score": 0, "creation_date": 1567548958, "post_id": 57779293, "comment_id": 101993472, "body": "Yep. That makes sense (now). Works."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1567548561, "creation_date": 1567548561, "answer_id": 57779293, "question_id": 57779248, "link": "https://stackoverflow.com/questions/57779248/creating-type-by-reflection-and-passing-by-reference-compiles-but-does-not-work/57779293#57779293", "title": "Creating type by reflection and passing by reference compiles but does not work", "body": "<p><a href=\"https://golang.org/pkg/reflect/#New\" rel=\"nofollow noreferrer\"><code>reflect.New()</code></a> returns you a pointer to a value of the passed type, but the returned pointer is wrapped in a <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a> struct!</p>\n\n<p>Use <a href=\"https://golang.org/pkg/reflect/#Value.Interface\" rel=\"nofollow noreferrer\"><code>Value.Interface()</code></a> to \"unwrap\" it, and have a pointer as an <code>interface{}</code> which you can pass to <code>decode()</code>:</p>\n\n<pre><code>x := reflect.New(structType)\np := x.Interface()\ndecode(p)\n</code></pre>\n\n<p>When you print a <code>reflect.Value</code>, you often won't see a difference, because the <code>reflect.Value</code> type is treated special; quoting from <a href=\"https://golang.org/pkg/reflect/#Value.String\" rel=\"nofollow noreferrer\"><code>Value.String()</code></a>:</p>\n\n<blockquote>\n  <p>The fmt package treats Values specially. It does not call their String method implicitly but instead prints the concrete values they hold.</p>\n</blockquote>\n"}], "owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 1, "accepted_answer_id": 57779293, "answer_count": 1, "score": 1, "last_activity_date": 1567766666, "creation_date": 1567548282, "last_edit_date": 1567766666, "question_id": 57779248, "link": "https://stackoverflow.com/questions/57779248/creating-type-by-reflection-and-passing-by-reference-compiles-but-does-not-work", "title": "Creating type by reflection and passing by reference compiles but does not work", "body": "<p>When I dynamically create a pointer to a type and then pass it in to an unmarshalling function, it seems to be written correctly, in theory:</p>\n\n<pre><code>x := reflect.New(structType)\ndecode(x)\n</code></pre>\n\n<p>However, when you print <code>x</code>, it looks like the zero value of the type. The type is definitely correct and expected.</p>\n\n<p>On the other hand, when I create the type and pass a pointer to it, directly, it works fine:</p>\n\n<pre><code>directoryEntry := DirectoryEntry{}\ndecode(&amp;directoryEntry)\n</code></pre>\n\n<p>The contents are set correctly by <code>decode()</code> and, when printed, are correct.</p>\n\n<p>So, it seems like I must be passing a value of the type to <code>decode()</code> and not a reference?</p>\n\n<p>Can someone point out what I must be missing? A number of Google queries didn't help, and it seems like I must be missing something small.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1567546031, "post_id": 57778882, "comment_id": 101992750, "body": "Read <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Go Slices: usage and internals</a>"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1567546375, "post_id": 57778882, "comment_id": 101992824, "body": "Why not just use a channel?"}, {"owner": {"reputation": 757, "user_id": 2011862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ffa79e19021dcbe22b9d5a47ad78e61?s=128&d=identicon&r=PG", "display_name": "svakili", "link": "https://stackoverflow.com/users/2011862/svakili"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1567548794, "post_id": 57778882, "comment_id": 101993441, "body": "@Not_a_Golfer If we use channels, is there a way to perform a &quot;peek&quot;, i.e. get the first <code>n</code> items in the queue without them being removed from the queue?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567549313, "post_id": 57778882, "comment_id": 101993545, "body": "@svakili The expression <code>len(c)</code> will tell you how many elements are in a channel, but you cannot inspect the values without popping the values with a receive operation. A queue implemented with a channel has a fixed capacity.  That may or may not be a good thing depending on application requirements."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567549988, "post_id": 57778882, "comment_id": 101993692, "body": "@svakili, also note that the functions presented here have no value, as there is no difference from simply using <code>append</code> and <code>q[s:]</code> directly, and the functions existence is probably a cause of confusion. The behavior of slices is quite simple, and anything more complex (i.e. provides safe concurrency) would probably be better encapsulated in a struct with methods."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1567546529, "creation_date": 1567546529, "answer_id": 57779019, "question_id": 57778882, "link": "https://stackoverflow.com/questions/57778882/implementing-a-simple-queue-in-go-using-slices/57779019#57779019", "title": "Implementing a simple queue in Go using slices", "body": "<blockquote>\n  <p>Does this function result them to be garbage collected?</p>\n</blockquote>\n\n<p>If the application enqueues a sufficient number of elements to cause the slice backing array to be reallocated, then the previous backing array (and its elements) will be eligible for collection.</p>\n\n<blockquote>\n  <p>What are the time and space complexities of r := q[s:]?</p>\n</blockquote>\n\n<p>This is an O(1) operation. The operation does not allocate memory on the heap. </p>\n"}], "owner": {"reputation": 757, "user_id": 2011862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ffa79e19021dcbe22b9d5a47ad78e61?s=128&d=identicon&r=PG", "display_name": "svakili", "link": "https://stackoverflow.com/users/2011862/svakili"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1567546529, "creation_date": 1567545638, "question_id": 57778882, "link": "https://stackoverflow.com/questions/57778882/implementing-a-simple-queue-in-go-using-slices", "title": "Implementing a simple queue in Go using slices", "body": "<p>I'm trying to implement a very simple queue in Go using slices. This is the code that I have to enqueue five values and then discard the first two values:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar (\n    localQ  []int\n)\n\nfunc main() {\n    fmt.Printf(\"%v %v\\n\", localQ, len(localQ))\n    for i := 0; i&lt; 5; i++ {\n        localQ = enqueue(localQ, i)\n\n        fmt.Printf(\"%v %v\\n\", localQ, len(localQ))\n    }\n\n    localQ = dequeue(localQ, 2)\n\n    fmt.Printf(\"%v %v\\n\", localQ, len(localQ))\n}\n\nfunc enqueue(q []int, n int) ([]int) {\n    q = append(q, n)\n\n    return q\n}\n\nfunc dequeue(q []int, s int) ([]int) {\n\n    r := q[s:]\n\n    q = nil\n\n    return r\n}\n</code></pre>\n\n<p>Two questions regarding the dequeue func:</p>\n\n<p>1- I'm trying to ensure that the popped items are discarded and garbage collected. Does this function result them to be garbage collected?</p>\n\n<p>2- What are the time and space complexities of <code>r := q[s:]</code>? I know there is an array under each slice. Are the array values being copied? Or is it just a pointer being copied?</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1567546642, "post_id": 57778810, "comment_id": 101992919, "body": "it depends... what database are you using?"}, {"owner": {"reputation": 319, "user_id": 8523169, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4e53e241064585e19a15393083799869?s=128&d=identicon&r=PG&f=1", "display_name": "Aayush Taneja", "link": "https://stackoverflow.com/users/8523169/aayush-taneja"}, "reply_to_user": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1567568790, "post_id": 57778810, "comment_id": 101996671, "body": "I am using Postgres @dave"}], "answers": [{"comments": [{"owner": {"reputation": 319, "user_id": 8523169, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4e53e241064585e19a15393083799869?s=128&d=identicon&r=PG&f=1", "display_name": "Aayush Taneja", "link": "https://stackoverflow.com/users/8523169/aayush-taneja"}, "edited": false, "score": 0, "creation_date": 1567568713, "post_id": 57779513, "comment_id": 101996658, "body": "But this is 2 operations right? Is it possible to get the ids of updated rows in that same operation?"}], "tags": [], "owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "is_accepted": false, "score": -1, "last_activity_date": 1567550573, "creation_date": 1567550573, "answer_id": 57779513, "question_id": 57778810, "link": "https://stackoverflow.com/questions/57778810/gorm-update-and-get-the-updated-rows-in-a-single-operation/57779513#57779513", "title": "Gorm Update and Get the Updated Rows in a single operation?", "body": "<p>This is a decent solution if you know the number of rows you're updating is relatively small (&lt;1000)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var ids []int\nvar results []YourModel\n\n// Get the list of rows that will be affected\ndb.Where(\"YOUR CONDITION HERE\").Table(\"your_table\").Select(\"id\").Find(&amp;ids)\nquery := db.Where(\"id IN (?)\", ids)\n\n// Do the update\nquery.Model(&amp;YourModel{}).Updates(YourModel{field: \"value\"})\n\n// Get the updated rows\nquery.Find(&amp;results)\n</code></pre>\n\n<p>This is safe against race conditions since it uses the list of IDs to do the update instead of repeating the <code>WHERE</code> clause. As you can imagine this becomes a bit less practical when you start talking about thousands of rows.</p>\n"}, {"comments": [{"owner": {"reputation": 319, "user_id": 8523169, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4e53e241064585e19a15393083799869?s=128&d=identicon&r=PG&f=1", "display_name": "Aayush Taneja", "link": "https://stackoverflow.com/users/8523169/aayush-taneja"}, "edited": false, "score": 0, "creation_date": 1567571236, "post_id": 57781359, "comment_id": 101997069, "body": "Let me try this."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 1, "last_activity_date": 1567570192, "creation_date": 1567570192, "answer_id": 57781359, "question_id": 57778810, "link": "https://stackoverflow.com/questions/57778810/gorm-update-and-get-the-updated-rows-in-a-single-operation/57781359#57781359", "title": "Gorm Update and Get the Updated Rows in a single operation?", "body": "<p>It's not pretty, but since you are using postgres you can do:</p>\n\n<pre><code>realDB := db.DB()\nrows, err := realDB.Query(\"UPDATE some_table SET name = 'a' WHERE name = 'b' RETUNING id, name\") \n//you could probably do db.Raw but I'm not sure\nif err != nil {\n    log.Fatal(err)\n}\ndefer rows.Close()\nfor rows.Next() {\n    var id int\n    var name string\n    err := rows.Scan(&amp;id, &amp;name)\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Println(id, name)\n}\n</code></pre>\n"}], "owner": {"reputation": 319, "user_id": 8523169, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4e53e241064585e19a15393083799869?s=128&d=identicon&r=PG&f=1", "display_name": "Aayush Taneja", "link": "https://stackoverflow.com/users/8523169/aayush-taneja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1300, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1567570192, "creation_date": 1567545170, "question_id": 57778810, "link": "https://stackoverflow.com/questions/57778810/gorm-update-and-get-the-updated-rows-in-a-single-operation", "title": "Gorm Update and Get the Updated Rows in a single operation?", "body": "<p>Is there any way to get the rows that have been updated using the update command in Gorm, using a single operation.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1567543735, "post_id": 57778471, "comment_id": 101992027, "body": "Th <a href=\"https://golang.org/pkg/net/http/#example_Hijacker\" rel=\"nofollow noreferrer\"><code>Hijacker</code> example</a> seems relevant. One is the raw connection and the other is buffered, and you use the one you need depending on your program."}, {"owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1567543964, "post_id": 57778471, "comment_id": 101992103, "body": "@JimB The example seems to use only the <code>*bufio.ReadWriter</code> and the <code>Conn</code> only to close it at the end.  Maybe this is how it&#39;s meant to be done?  Or is there a true choice?"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1567547038, "last_edit_date": 1567547038, "creation_date": 1567544319, "answer_id": 57778656, "question_id": 57778471, "link": "https://stackoverflow.com/questions/57778471/what-are-the-return-values-of-a-http-hijacker/57778656#57778656", "title": "what are the return values of a http.Hijacker?", "body": "<p>The returned <a href=\"https://godoc.org/net#Conn\" rel=\"nofollow noreferrer\">net.Conn</a> is the underlying <a href=\"https://godoc.org/io#Reader\" rel=\"nofollow noreferrer\">io.Reader</a> for the <a href=\"https://godoc.org/bufio#ReadWriter.Reader\" rel=\"nofollow noreferrer\">ReadWriter.Reader</a> and the underlying <a href=\"https://godoc.org/io#Writer\" rel=\"nofollow noreferrer\">io.Writer</a> for the <a href=\"https://godoc.org/bufio#ReadWriter.Writer\" rel=\"nofollow noreferrer\">ReadWriter.Writer</a>.</p>\n\n<p>The ReadWriter.Reader can contain data buffered from the client. The ReadWriter.Writer is created in the Hijack implementation and can be ignored.</p>\n\n<p>If the application is reading from the client and it's possible that the client data is buffered, then the application must read at least <a href=\"https://godoc.org/bufio#Reader.Buffered\" rel=\"nofollow noreferrer\">Reader.Buffered()</a> bytes from the ReadWriter.Reader before reading directly from the net.Conn.</p>\n\n<p>If the application is going to use the bufio package to buffer network IO, then the application can reduce the number of memory allocations by using the returned <a href=\"https://godoc.org/bufio#Reader\" rel=\"nofollow noreferrer\">bufio.Reader</a> and <a href=\"https://godoc.org/bufio#Writer\" rel=\"nofollow noreferrer\">bufio.Writer</a>.</p>\n\n<p>Otherwise, the application can use the <a href=\"https://godoc.org/net#Conn\" rel=\"nofollow noreferrer\">net.Conn</a> directly for read and write.</p>\n\n<p>If the application does use the bufio.Writer instead of writing directly to the net.Conn, then the application may need to explicitly flush the buffer with a call to <a href=\"https://godoc.org/bufio#Writer.Flush\" rel=\"nofollow noreferrer\">Writer.Flush</a>.</p>\n\n<p>The application must use the net.Conn to close the connection and set deadlines.</p>\n\n<p>In an earlier version of the net/http package, the server used a bufio.Writer for network IO and returned that bufio.Writer from the Hijack method. When the implementation was changed to use a different buffering mechanism, the creation of the bufio.Writer was moved to the Hijack method. </p>\n\n<p>Some examples:</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Server-sent_events\" rel=\"nofollow noreferrer\">Server sent events</a>: The ReadWriter.Reader can be ignored because the application will not read from the connection.  Use the ReadWriter.Writer to reduce allocations.</p>\n\n<p><a href=\"https://tools.ietf.org/html/rfc6455\" rel=\"nofollow noreferrer\">WebSockets</a>: It is an error for the client to send data after sending the handshake request and before receiving the handshake response. Given this, data should not be buffered in the ReadWriter.Reader.  The application can choose to ignore the ReadWriter.Reader after possibly checking for unexpected data using <code>Reader.Buffered() != 0</code>.  </p>\n"}], "owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 1, "accepted_answer_id": 57778656, "answer_count": 1, "score": 7, "last_activity_date": 1567547038, "creation_date": 1567543258, "question_id": 57778471, "link": "https://stackoverflow.com/questions/57778471/what-are-the-return-values-of-a-http-hijacker", "title": "what are the return values of a http.Hijacker?", "body": "<p>A <a href=\"https://golang.org/pkg/net/http/#Hijacker\" rel=\"noreferrer\">http.Hijacker</a> as defined in the Go standard library has a Hijack() method, with the following signature:</p>\n\n<pre><code>Hijack() (net.Conn, *bufio.ReadWriter, error)\n</code></pre>\n\n<p>What is the meaning of the first two return values?  Both the <code>net.Conn</code> and the <code>*bufio.ReadWriter</code> have <code>Write()</code> methods.  What is the difference between the two?  Which one should I use to send data to the network?</p>\n"}, {"tags": ["go", "jenkins", "jenkins-pipeline", "jenkins-plugins", "devops"], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 9622523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853f4fd561a25702dc1ed0d13e146d68?s=128&d=identicon&r=PG&f=1", "display_name": "dude8998", "link": "https://stackoverflow.com/users/9622523/dude8998"}, "edited": false, "score": 0, "creation_date": 1567557089, "post_id": 57780011, "comment_id": 101994839, "body": "Unfortunately running that did not work, <code>returned exit code 1</code>"}, {"owner": {"reputation": 11, "user_id": 10819202, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-D6PNkrhBJHg/AAAAAAAAAAI/AAAAAAAAAHo/tNjhAbesuXY/photo.jpg?sz=128", "display_name": "Rick", "link": "https://stackoverflow.com/users/10819202/rick"}, "reply_to_user": {"reputation": 75, "user_id": 9622523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853f4fd561a25702dc1ed0d13e146d68?s=128&d=identicon&r=PG&f=1", "display_name": "dude8998", "link": "https://stackoverflow.com/users/9622523/dude8998"}, "edited": false, "score": 0, "creation_date": 1567645544, "post_id": 57780011, "comment_id": 102027384, "body": "Maybe you should given a specific agent instead of using &#39;agent any&#39;."}, {"owner": {"reputation": 11, "user_id": 10819202, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-D6PNkrhBJHg/AAAAAAAAAAI/AAAAAAAAAHo/tNjhAbesuXY/photo.jpg?sz=128", "display_name": "Rick", "link": "https://stackoverflow.com/users/10819202/rick"}, "reply_to_user": {"reputation": 75, "user_id": 9622523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853f4fd561a25702dc1ed0d13e146d68?s=128&d=identicon&r=PG&f=1", "display_name": "dude8998", "link": "https://stackoverflow.com/users/9622523/dude8998"}, "edited": false, "score": 0, "creation_date": 1567647058, "post_id": 57780011, "comment_id": 102027585, "body": "Could you please give out more log details?"}, {"owner": {"reputation": 75, "user_id": 9622523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853f4fd561a25702dc1ed0d13e146d68?s=128&d=identicon&r=PG&f=1", "display_name": "dude8998", "link": "https://stackoverflow.com/users/9622523/dude8998"}, "edited": false, "score": 0, "creation_date": 1567716840, "post_id": 57780011, "comment_id": 102057018, "body": "Thats the most that I get back from blue ocean after the script runs. What would the agent be if it isn&#39;t any?"}], "tags": [], "owner": {"reputation": 11, "user_id": 10819202, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-D6PNkrhBJHg/AAAAAAAAAAI/AAAAAAAAAHo/tNjhAbesuXY/photo.jpg?sz=128", "display_name": "Rick", "link": "https://stackoverflow.com/users/10819202/rick"}, "is_accepted": false, "score": 0, "last_activity_date": 1567556070, "creation_date": 1567556070, "answer_id": 57780011, "question_id": 57778407, "link": "https://stackoverflow.com/questions/57778407/command-not-found-using-jenkins-blue-ocean/57780011#57780011", "title": "Command Not Found Using Jenkins Blue Ocean", "body": "<p>You can try to execute below command to figure out whether go CLL does exist:</p>\n\n<pre><code>sh 'which go'\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 75, "user_id": 9622523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853f4fd561a25702dc1ed0d13e146d68?s=128&d=identicon&r=PG&f=1", "display_name": "dude8998", "link": "https://stackoverflow.com/users/9622523/dude8998"}, "edited": false, "score": 0, "creation_date": 1567632888, "post_id": 57788579, "comment_id": 102024948, "body": "I believe I have set Go as a tool already in the settings, <a href=\"https://imgur.com/a/zG86H9T\" rel=\"nofollow noreferrer\">Here is the screenshot</a>"}], "tags": [], "owner": {"reputation": 88, "user_id": 5932244, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206830915625690/picture?type=large", "display_name": "Eren Atas", "link": "https://stackoverflow.com/users/5932244/eren-atas"}, "is_accepted": false, "score": 0, "last_activity_date": 1567600698, "creation_date": 1567600698, "answer_id": 57788579, "question_id": 57778407, "link": "https://stackoverflow.com/questions/57778407/command-not-found-using-jenkins-blue-ocean/57788579#57788579", "title": "Command Not Found Using Jenkins Blue Ocean", "body": "<p>Jenkins plugins do not install executables. Think them as controllers. You should install Go into your system and tell Jenkins that the path of the executable in <code>Global Tool Configuration</code>.</p>\n\n<p>You can see an example of Git here:</p>\n\n<p><a href=\"https://i.stack.imgur.com/hRfnG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hRfnG.png\" alt=\"Example of Global Tool Configuration\"></a></p>\n"}], "owner": {"reputation": 75, "user_id": 9622523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853f4fd561a25702dc1ed0d13e146d68?s=128&d=identicon&r=PG&f=1", "display_name": "dude8998", "link": "https://stackoverflow.com/users/9622523/dude8998"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 184, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1567600698, "creation_date": 1567542844, "last_edit_date": 1567587514, "question_id": 57778407, "link": "https://stackoverflow.com/questions/57778407/command-not-found-using-jenkins-blue-ocean", "title": "Command Not Found Using Jenkins Blue Ocean", "body": "<p>I am trying to set up a Jenkins Blue Ocean pipeline to auto-build my github repo on a PR merge.</p>\n\n<p>I've installed the Go plugins for Jenkins and created the following <code>Jenkinsfile</code> with the help of Blue Ocean. Just wanted it to be very simple at first - I have a shell script to run that will build the program I just need Jenkins to run it on merge. </p>\n\n<pre><code>pipeline {\n  agent any\n  stages {\n    stage('Building Backend') {\n      agent any\n      steps {\n        echo 'Using Go 1.12'\n        tool(name: 'Go 1.12', type: 'go')\n        echo 'Building Backend...'\n        sh 'go version'\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>The above Jenkinsfile returns </p>\n\n<pre><code>go: command not found\nscript returned exit code 127\n</code></pre>\n\n<p>but ideally I want it to recognize Go since I will be running a log of <code>go build</code> commands. I added Go as a tool in <code>global tool configuration</code> in the settings of Jenkins.</p>\n"}, {"tags": ["go", "nginx", "websocket"], "comments": [{"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1567545720, "post_id": 57778237, "comment_id": 101992653, "body": "NGINX is in that port? 8080? This is correct? I known that is 80! Instead of 8080, try 80!  Expected flow: client requests for 80 (NGINX), NGINX forward to Server in 8080, confirm connection and response."}, {"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "reply_to_user": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1567550689, "post_id": 57778237, "comment_id": 101993807, "body": "@AristofanioGarcia The nginx config is set to listen on 8080 (first directive in the <code>server</code> block)."}, {"owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1567551442, "post_id": 57778237, "comment_id": 101993956, "body": "Server and NGINX in same ports?"}, {"owner": {"reputation": 351, "user_id": 3495404, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/3f6dce90b558784be81ffb3eab5ba9f0?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Hummel", "link": "https://stackoverflow.com/users/3495404/andrew-hummel"}, "reply_to_user": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "edited": false, "score": 0, "creation_date": 1567559193, "post_id": 57778237, "comment_id": 101995165, "body": "@AristofanioGarcia I don&#39;t think NGINX is running on 8080 in addition to the server. If so, I wouldn&#39;t be able to start one of them. Either way, I tried it as <code>listen 80</code> and got the same error, <code>(index):13 WebSocket connection to &#39;ws:&#47;&#47;127.0.0.1&#47;ws&#39; failed: Connection closed before receiving a handshake response</code>"}], "owner": {"reputation": 351, "user_id": 3495404, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/3f6dce90b558784be81ffb3eab5ba9f0?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Hummel", "link": "https://stackoverflow.com/users/3495404/andrew-hummel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 427, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1567559494, "creation_date": 1567541927, "last_edit_date": 1567559494, "question_id": 57778237, "link": "https://stackoverflow.com/questions/57778237/go-nginx-websocket-connection-closed-before-receiving-a-handshake-response", "title": "Go Nginx Websocket &quot;Connection closed before receiving a handshake response&quot;", "body": "<p>I have a Go web server running on my localhost. I'm using Nginx as a reverse proxy to change the protocol to <code>ws</code> when a certain route is accessed on my server.</p>\n\n<p>I keep getting this error message in my browser - <code>(index):13 WebSocket connection to 'ws://127.0.0.1:8080/ws' failed: Connection closed before receiving a handshake response</code></p>\n\n<p>In addition, the Go server keeps printing this error - <code>read tcp [::1]:8080-&gt;[::1]:59967: read: connection reset by peer</code></p>\n\n<p>I've tried a number of combinations in my nginx.conf file. I can't seem to get any of them to work.</p>\n\n<p>Go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/websocket\"\n)\n\nfunc reader(conn *websocket.Conn) {\n    for {\n        messageType, p, err := conn.ReadMessage()\n        if err != nil {\n            log.Println(err)\n            return\n        }\n        fmt.Println(string(p))\n\n        if err := conn.WriteMessage(messageType, p); err != nil {\n            log.Println(err)\n            return\n        }\n\n    }\n}\n\nfunc homePage(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Home Page\")\n}\n\nfunc wsEndpoint(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello World\")\n    ws, err := websocket.Upgrade(w, r, nil, 1024, 1024)\n    if err != nil {\n        http.Error(w, \"Could not open websocket connection\", http.StatusBadRequest)\n        log.Println(err)\n        return\n    }\n\n    log.Println(\"Client Connected\")\n\n    err = ws.WriteMessage(1, []byte(\"Hi Client!\"))\n    if err != nil {\n        log.Println(\"Error\")\n        log.Println(err)\n        return\n    }\n\n    reader(ws)\n}\n\nfunc setupRoutes() {\n    http.HandleFunc(\"/\", homePage)\n    http.HandleFunc(\"/ws\", wsEndpoint)\n}\n\nfunc main() {\n    fmt.Println(\"Hello World\")\n    setupRoutes()\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>index.html</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n  &lt;head&gt;\n    &lt;meta charset=\"UTF-8\" /&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /&gt;\n    &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" /&gt;\n    &lt;title&gt;Go WebSocket Tutorial&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;h2&gt;Hello World&lt;/h2&gt;\n\n    &lt;script&gt;\n      let socket = new WebSocket(\"ws://127.0.0.1:8080/ws\");\n      console.log(\"Attempting Connection...\");\n\n      socket.onopen = () =&gt; {\n        console.log(\"Successfully Connected\");\n        socket.send(\"Hi From the Client!\");\n      };\n\n      socket.onmessage = msg =&gt; {\n        console.log(msg);\n      };\n\n      socket.onclose = event =&gt; {\n        console.log(\"Socket Closed Connection: \", event);\n        socket.send(\"Client Closed!\");\n      };\n\n      socket.onerror = error =&gt; {\n        console.log(\"Socket Error: \", error);\n      };\n    &lt;/script&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n\n</code></pre>\n\n<p>nginx.conf</p>\n\n<pre><code>  {\n    server {\n        listen       8080;\n        server_name  localhost;\n\n        location /ws {\n          proxy_set_header X-Real-IP $remote_addr;\n          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n          proxy_set_header Host $http_host;\n          proxy_set_header X-NginX-Proxy true;\n\n          proxy_pass http://localhost:8080/ws;\n          proxy_redirect off;\n\n          proxy_http_version 1.1;\n          proxy_set_header Upgrade $http_upgrade;\n          proxy_set_header Connection \"Upgrade\";\n        }\n\n        location / {\n            # root   html;\n            # index  index.html index.htm;\n            proxy_pass http://localhost:8080;\n        }\n    }\n</code></pre>\n\n<p>I'm expecting the websocket connection to stay open indefinitely. I don't know what exactly is closing it and why.</p>\n\n<p>Any suggestions on what I'm doing wrong are much appreciated.</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1567645545, "post_id": 57778089, "comment_id": 102027385, "body": "Hi, could you provide more details on the MongoDB server ? Is it a standalone MongoDB or replicaset ? Does it reside on the same machine as the application ?"}, {"owner": {"reputation": 2161, "user_id": 5006024, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh4.googleusercontent.com/-RrYkzi1x2u8/AAAAAAAAAAI/AAAAAAAAAQM/cBoxkpCXCdY/photo.jpg?sz=128", "display_name": "GIJOW", "link": "https://stackoverflow.com/users/5006024/gijow"}, "reply_to_user": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1567649624, "post_id": 57778089, "comment_id": 102027997, "body": "Hi. It has replica because we are using change streams. But only now replica set (rs0). It resides in another machine on same local network. Thanks"}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1567657119, "post_id": 57778089, "comment_id": 102029316, "body": "There are a couple of things here, but could you confirm that the <a href=\"https://docs.mongodb.com/manual/reference/replica-configuration/\" rel=\"nofollow noreferrer\">replica set configuration</a> (you can get this from executing <code>rs.conf()</code> from <code>mongo</code> shell) also contains <code>localhost</code> ?"}, {"owner": {"reputation": 2161, "user_id": 5006024, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh4.googleusercontent.com/-RrYkzi1x2u8/AAAAAAAAAAI/AAAAAAAAAQM/cBoxkpCXCdY/photo.jpg?sz=128", "display_name": "GIJOW", "link": "https://stackoverflow.com/users/5006024/gijow"}, "reply_to_user": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1567719963, "post_id": 57778089, "comment_id": 102057924, "body": "it has, you can see my <code>rs.conf()</code> in my updated question"}], "answers": [{"comments": [{"owner": {"reputation": 2161, "user_id": 5006024, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh4.googleusercontent.com/-RrYkzi1x2u8/AAAAAAAAAAI/AAAAAAAAAQM/cBoxkpCXCdY/photo.jpg?sz=128", "display_name": "GIJOW", "link": "https://stackoverflow.com/users/5006024/gijow"}, "edited": false, "score": 0, "creation_date": 1567786646, "post_id": 57814946, "comment_id": 102081136, "body": "Thank you to clarify ! Now it makes all sense. In my understanding before, RS host in a single server was used only to loop the connection to same server by the server and not by client. Thank you very much"}], "tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 5, "last_activity_date": 1567736273, "creation_date": 1567736273, "answer_id": 57814946, "question_id": 57778089, "link": "https://stackoverflow.com/questions/57778089/mongodb-go-driver-looking-on-localhost-when-should-not/57814946#57814946", "title": "MongoDB Go driver looking on localhost when should not", "body": "<blockquote>\n  <p>why the mongo driver is looking on localhost if I'm setting the address of my mongoDB server.</p>\n</blockquote>\n\n<p>When <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo\" rel=\"noreferrer\">mongo-go-driver</a>'s client is connecting to a MongoDB deployment, it will perform <a href=\"https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring-summary.rst\" rel=\"noreferrer\">Server Discovery and Monitoring</a> to discovers one or more servers (MongoDB being a distributed database by nature). One of the early steps is to begin monitoring the topology by invoking <a href=\"https://docs.mongodb.com/manual/reference/command/isMaster/\" rel=\"noreferrer\">isMaster command</a> on all servers. Based on <a href=\"https://docs.mongodb.com/manual/reference/command/isMaster/#replica-sets\" rel=\"noreferrer\">the output of isMaster</a> the client will try to contact those servers. In the case of <a href=\"https://docs.mongodb.com/manual/replication/\" rel=\"noreferrer\">Replica Set</a> (your case), the client strives to connect to the primary server (from <a href=\"https://docs.mongodb.com/manual/reference/command/isMaster/#isMaster.primary\" rel=\"noreferrer\">isMaster.primary</a>). </p>\n\n<p>However, the hostname address is not a <a href=\"https://en.wikipedia.org/wiki/Fully_qualified_domain_name\" rel=\"noreferrer\">Fully Qualified Domain Name (FQDN)</a> to be resolvable from the client's machine. The client's machine trying to connect to <code>localhost</code> defined as the replica set primary, thus failed to make a connection. Also, this is why you're seeing a message status where <code>current topology: Type: Unknown</code> but <code>State: Connected</code>. It failed to discover the deployment topology even before able to select a server to execute the command (<code>ping</code>) </p>\n\n<p>You can solve this by setting resolvable hostnames for the value of the members field in the replica set configuration. In addition, when possible, use a logical DNS hostname instead of an ip address, as this avoids configuration changes due to ip address changes.</p>\n\n<p>You can change the replica set hostnames using <a href=\"https://docs.mongodb.com/manual/reference/method/rs.reconfig/#rs.reconfig\" rel=\"noreferrer\">rs.reconfig()</a> i.e: </p>\n\n<pre><code>cfg = rs.conf()\ncfg.members[1].host = \"&lt;RESOLVABLE HOSTNAME&gt;:&lt;PORT NUMBER&gt;\"\nrs.reconfig(cfg)\n</code></pre>\n\n<p>In your case, where there's only one replica set member it's quite straight forward. However if you're in production mode and have more than one members you can follow the steps outlined in <a href=\"https://docs.mongodb.com/manual/tutorial/change-hostnames-in-a-replica-set/#change-hostnames-in-a-replica-set\" rel=\"noreferrer\">Change Hostnames in a Replica Set</a> where there are two options: </p>\n\n<ul>\n<li><a href=\"https://docs.mongodb.com/manual/tutorial/change-hostnames-in-a-replica-set/#replica-set-change-hostname-no-downtime\" rel=\"noreferrer\">Change Hostnames without disrupting availability</a></li>\n<li><a href=\"https://docs.mongodb.com/manual/tutorial/change-hostnames-in-a-replica-set/#replica-set-change-hostname-downtime\" rel=\"noreferrer\">Change Hostnames at the same time (one-go)</a></li>\n</ul>\n\n<p>Having said all the explanation above, \nalternatively, as your replica set deployment is only one server (development mode) you can set the connection mode to <code>direct</code> via <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo/options#ClientOptions.SetDirect\" rel=\"noreferrer\">ClientOptions.SetDirect()</a>. Which specifies whether the client should connect directly to a server instead of auto-discovering other servers in the cluster (although this means you have no redundancy) i.e.: </p>\n\n<pre><code>opts := options.ClientOptions{ ConnectTimeout: &amp;timeoutVariable}\nopts.SetDirect(true)\nopts.ApplyURI(addr)\n\nclient, err := mongo.Connect(connect.TODO(), &amp;opts)\n</code></pre>\n"}], "owner": {"reputation": 2161, "user_id": 5006024, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh4.googleusercontent.com/-RrYkzi1x2u8/AAAAAAAAAAI/AAAAAAAAAQM/cBoxkpCXCdY/photo.jpg?sz=128", "display_name": "GIJOW", "link": "https://stackoverflow.com/users/5006024/gijow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1727, "favorite_count": 1, "accepted_answer_id": 57814946, "answer_count": 1, "score": 3, "last_activity_date": 1567736273, "creation_date": 1567541061, "last_edit_date": 1567719928, "question_id": 57778089, "link": "https://stackoverflow.com/questions/57778089/mongodb-go-driver-looking-on-localhost-when-should-not", "title": "MongoDB Go driver looking on localhost when should not", "body": "<p>I'm not a Go guy, just need to use a plugin written in Go and I'm having some trouble between plugin and MongoDB.</p>\n\n<p>The error is:</p>\n\n<pre><code>server selection error: server selection timeout\ncurrent topology: Type: Unknown\nServers:\nAddr: localhost:27017, Type: Unknown, State: Connected, Avergage RTT: 0, Last error: dial tcp 127.0.0.1:27017: connect: connection refused\nexit status 1\n</code></pre>\n\n<p>My configuration:</p>\n\n<pre><code>time=\u201c2019-09-03T16:29:35Z\u201d level=debug msg=\u201cHost: ip-XXX-XX-XX-XXX.sa-east-1.compute.internal\u201d\ntime=\u201c2019-09-03T16:29:35Z\u201d level=debug msg=\u201cPort: 27017\u201d\ntime=\u201c2019-09-03T16:29:35Z\u201d level=debug msg=\u201cUsername: user\u201d\ntime=\u201c2019-09-03T16:29:35Z\u201d level=debug msg=\u201cPassword: user123*\u201d\ntime=\u201c2019-09-03T16:29:35Z\u201d level=debug msg=\u201cDBName: dbBackend\u201d\n</code></pre>\n\n<p>The plugin snippet that performs the connection:</p>\n\n<pre><code>addr := fmt.Sprintf(\"mongodb://%s:%s\", m.Host, m.Port)\n\nto := 60 * time.Second\nopts := options.ClientOptions{\n    ConnectTimeout: &amp;to,\n}\n\nopts.ApplyURI(addr)\n\n\n\nif m.Username != \"\" &amp;&amp; m.Password != \"\" {\n    opts.Auth = &amp;options.Credential{\n        AuthSource:  m.DBName,\n        Username:    m.Username,\n        Password:    m.Password,\n        PasswordSet: true,\n    }\n}\n\nclient, err := mongo.Connect(context.TODO(), &amp;opts)\n\nif err != nil {\n    return m, errors.Errorf(\"couldn't start mongo backend. error: %s\\n\", err)\n}\n\nerr1 := client.Ping(context.TODO(), nil)\n\nif err1 != nil {    \n    log.Fatal(err1) // error happens here\n} \n\nlog.Debugf(\"MONGO CONNECTED\")\n\nm.Conn = client\n\nreturn m, nil\n</code></pre>\n\n<p>I just can't realize why the mongo driver is looking on localhost if I'm setting the address of my mongoDB server.</p>\n\n<p><strong>EDIT 1</strong></p>\n\n<p>My db has replica set configured only to use change streams.</p>\n\n<p>This is my RS configuration:</p>\n\n<pre><code>{\n    \"_id\" : \"rs0\",\n    \"version\" : 69559,\n    \"protocolVersion\" : 1,\n    \"writeConcernMajorityJournalDefault\" : true,\n    \"members\" : [\n        {\n            \"_id\" : 0,\n            \"host\" : \"localhost:27017\",\n            \"arbiterOnly\" : false,\n            \"buildIndexes\" : true,\n            \"hidden\" : false,\n            \"priority\" : 1,\n            \"tags\" : {\n\n            },\n            \"slaveDelay\" : 0,\n            \"votes\" : 1\n        }\n    ],\n    \"settings\" : {\n        \"chainingAllowed\" : true,\n        \"heartbeatIntervalMillis\" : 2000,\n        \"heartbeatTimeoutSecs\" : 10,\n        \"electionTimeoutMillis\" : 10000,\n        \"catchUpTimeoutMillis\" : -1,\n        \"catchUpTakeoverDelayMillis\" : 30000,\n        \"getLastErrorModes\" : {\n\n        },\n        \"getLastErrorDefaults\" : {\n            \"w\" : 1,\n            \"wtimeout\" : 0\n        },\n        \"replicaSetId\" : ObjectId(\"5cf684c3c0db3f53727d1bb4\")\n    }\n}\n</code></pre>\n\n<p>Any help solving it appreciated.\nThanks</p>\n"}, {"tags": ["go", "redis", "redigo"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1567539358, "post_id": 57777167, "comment_id": 101990479, "body": "The redis.ByteSlices function will work as expected if a <a href=\"https://redis.io/topics/data-types#lists\" rel=\"nofollow noreferrer\">list</a> is used instead of a string.  Get all values with <code>LRANGE key 0 -1</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1000, "user_id": 844451, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wQNcW.jpg?s=128&g=1", "display_name": "hosseio", "link": "https://stackoverflow.com/users/844451/hosseio"}, "edited": false, "score": 0, "creation_date": 1567537093, "post_id": 57777267, "comment_id": 101989700, "body": "good catch, thank you! The only thing is to use a io reader from the <code>[]byte</code> for the <code>json.NewDecoder</code>. As mentioned here <a href=\"https://stackoverflow.com/questions/29746123/convert-byte-slice-to-io-reader\" title=\"convert byte slice to io reader\">stackoverflow.com/questions/29746123/&hellip;</a>"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1567539404, "last_edit_date": 1567539404, "creation_date": 1567536603, "answer_id": 57777267, "question_id": 57777167, "link": "https://stackoverflow.com/questions/57777167/error-unmarshaling-when-getting-array-of-struct-from-redis/57777267#57777267", "title": "Error unmarshaling when getting array of struct from redis", "body": "<p>APPEND will only append to a string, it will not make a JSON array. After first insert, you'll have</p>\n\n<pre><code>{\"Value\":\"a\"}\n</code></pre>\n\n<p>Then after the second one, you'll have</p>\n\n<pre><code>{\"Value\":\"a\"}{\"Value\":\"b\"}\n</code></pre>\n\n<p>That's not a JSON array.</p>\n\n<p>You can try using json.Decoder, and do something like:</p>\n\n<pre><code>b, _ = redis.Bytes(conn.Do(\"GET\", key))\ndec := json.NewDecoder(bytes.NewReader(b))\nitems := []ADTO{}\nvar x ADTO\nfor dec.Decode(&amp;x) == nil {\n  items = append(items, x)\n}\n</code></pre>\n"}], "owner": {"reputation": 1000, "user_id": 844451, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wQNcW.jpg?s=128&g=1", "display_name": "hosseio", "link": "https://stackoverflow.com/users/844451/hosseio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 505, "favorite_count": 0, "accepted_answer_id": 57777267, "answer_count": 1, "score": 0, "last_activity_date": 1567590732, "creation_date": 1567536114, "last_edit_date": 1567590732, "question_id": 57777167, "link": "https://stackoverflow.com/questions/57777167/error-unmarshaling-when-getting-array-of-struct-from-redis", "title": "Error unmarshaling when getting array of struct from redis", "body": "<p>I am using <code>redigo</code> to save some structs in redis. The thing is that for the same key I need to append new structs, but when I am trying to recover them I cannot unmarshal to an array.</p>\n\n<p>Ie: (ignoring the errors intentionally)</p>\n\n<pre><code>type ADTO struct {\n    Value string\n}\n\nfunc main() {\n    pool := redis.Pool{\n        Dial: func() (conn redis.Conn, e error) {\n            return redis.Dial(\"tcp\", \"localhost:6379\")\n        },\n        MaxIdle:   80,\n        MaxActive: 12000,\n    }\n\n    conn := pool.Get()\n    defer conn.Close()\n    key := \"some-key\"\n    defer conn.Do(\"DEL\", key)\n\n    a := ADTO{Value: \"a\"}\n    bytes, _ := json.Marshal(a)\n    conn.Do(\"APPEND\", key, bytes)\n\n    b := ADTO{Value: \"b\"}\n    bytes, _ = json.Marshal(b)\n    conn.Do(\"APPEND\", key, bytes)\n\n    c := ADTO{Value: \"c\"}\n    bytes, _ = json.Marshal(c)\n    conn.Do(\"APPEND\", key, bytes)\n\n    bytes, _ = redis.Bytes(conn.Do(\"GET\", key))\n\n    adtos := make([]ADTO, 0)\n\n    // the following does not work\n    if err := json.Unmarshal(bytes, &amp;adtos); err != nil {\n        return\n    }\n}\n</code></pre>\n\n<p>If I only append a single struct and retrieving it, then it is working fine</p>\n\n<p>I have tried with <code>redis.ByteSlices</code> with no luck</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 4315, "user_id": 2502126, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/fae66f557902359d7cc278076d1a9ef7?s=128&d=identicon&r=PG", "display_name": "Buzz Moschetti", "link": "https://stackoverflow.com/users/2502126/buzz-moschetti"}, "edited": false, "score": 0, "creation_date": 1567533623, "post_id": 57776606, "comment_id": 101988395, "body": "Does <code>err := json.NewDecoder(r.Body).Decode(&amp;user)</code> &quot;refill&quot;  (i.e. populate without creating new object) the target.  Looks that way.  In which case, the first time through, the driver assigns ID and all is well.  But second and subsequent times, ID is already filled in so you get the dupe error.   You have to manually take ID out of the object post-insertion."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 3, "last_activity_date": 1567535754, "last_edit_date": 1567535754, "creation_date": 1567533855, "answer_id": 57776716, "question_id": 57776606, "link": "https://stackoverflow.com/questions/57776606/objectid-automatically-set-to-0-0-in-go-with-official-mongodb-driver/57776716#57776716", "title": "ObjectID automatically set to &quot;0...0&quot; in go with official mongoDB driver", "body": "<p>If you set a document _id, mongodb will use that _id for the document during insertion and will not generate. You have to either omit it, or set it manually with primitive.NewObjectID().</p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 5, "last_activity_date": 1567535371, "creation_date": 1567535371, "answer_id": 57777011, "question_id": 57776606, "link": "https://stackoverflow.com/questions/57776606/objectid-automatically-set-to-0-0-in-go-with-official-mongodb-driver/57777011#57777011", "title": "ObjectID automatically set to &quot;0...0&quot; in go with official mongoDB driver", "body": "<p><a href=\"https://vkt.sh/go-mongodb-driver-cookbook/#struct-tags\" rel=\"noreferrer\">Per the documentation you linked, you must set the object ID yourself when using structs</a>:</p>\n\n<pre><code>_, err := col.InsertOne(ctx, &amp;Post{\n    ID:        primitive.NewObjectID(),    // &lt;-- this line right here\n    Title:     \"post\",\n    Tags:      []string{\"mongodb\"},\n    Body:      `blog post`,\n    CreatedAt: time.Now(),\n})\n</code></pre>\n\n<p>The examples before that using <code>bson.M</code> don't need to specify an ID because they don't send the <code>_id</code> field at all; with a struct, the field is being sent with its zero value (as you've seen).</p>\n"}], "owner": {"reputation": 59, "user_id": 7890720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d481edbb09a6ac41223a34c92e925933?s=128&d=identicon&r=PG&f=1", "display_name": "StefanK", "link": "https://stackoverflow.com/users/7890720/stefank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1929, "favorite_count": 1, "accepted_answer_id": 57777011, "answer_count": 2, "score": 2, "last_activity_date": 1567535754, "creation_date": 1567533236, "question_id": 57776606, "link": "https://stackoverflow.com/questions/57776606/objectid-automatically-set-to-0-0-in-go-with-official-mongodb-driver", "title": "ObjectID automatically set to &quot;0...0&quot; in go with official mongoDB driver", "body": "<p>I'm trying to save user entries in a MongoDB database with Go. Users should get an ID automatically. I'm using the offical MongoDB Go driver.</p>\n\n<p>My sources were especially <a href=\"https://vkt.sh/go-mongodb-driver-cookbook/\" rel=\"nofollow noreferrer\">https://vkt.sh/go-mongodb-driver-cookbook/</a> and <a href=\"https://www.mongodb.com/blog/post/mongodb-go-driver-tutorial\" rel=\"nofollow noreferrer\">https://www.mongodb.com/blog/post/mongodb-go-driver-tutorial</a>.</p>\n\n<p>Struct looks like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type User struct {\n    ID primitive.ObjectID `json:\"_id\" bson:\"_id\"`\n    Fname string `json:\"fname\" bson:\"fname\"`\n    Lname string `json:\"lname\" bson:\"lname\"`\n    Mail string `json:\"mail\" bson:\"mail\"`\n    Password string `json:\"password\" bson:\"password\"`\n    Street string `json:\"street\" bson:\"street\"`\n    Zip string `json:\"zip\" bson:\"zip\"`\n    City string `json:\"city\" bson:\"city\"`\n    Country string `json:\"country\" bson:\"country\"`\n}\n</code></pre>\n\n<p>Setting up the database (connection works) and signing up users (based on an HTTP-Request <code>r</code> with a user in it's body):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>ctx := context.Background()\nuriDB := \"someURI\"\nclientOptions := options.Client().ApplyURI(uriDB)\nclient, err := mongo.Connect(ctx, clientOptions)\ncollection := client.Database(\"guDB\").Collection(\"users\")\n\n...\n\nvar user User\nerr := json.NewDecoder(r.Body).Decode(&amp;user)\n\nctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)\ndefer cancel()\nresult, err := collection.InsertOne(ctx, user)\n...\n\n</code></pre>\n\n<p>When I enter the first user, it is added to the collection, but the ID looks like this:\n<code>_id:ObjectID(000000000000000000000000)</code></p>\n\n<p>If I now want to enter another user, I get the following error:</p>\n\n<pre><code>multiple write errors: [{write errors: [{E11000 duplicate key error collection: guDB.users index: _id_ dup key: { : ObjectId('000000000000000000000000') }}]}, {&lt;nil&gt;}]\n</code></pre>\n\n<p>So it seems like again ObjectID <code>000000000000000000000000</code> is assigned.</p>\n\n<p>I expected the ID to be automatically set to a unique value for each entry.</p>\n\n<p>Do I have to manually set the ID or how can I assign unique IDs to users?</p>\n"}, {"tags": ["rest", "go"], "comments": [{"owner": {"reputation": 3364, "user_id": 6805190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GpCA.jpg?s=128&g=1", "display_name": "dassum", "link": "https://stackoverflow.com/users/6805190/dassum"}, "edited": false, "score": 4, "creation_date": 1567533439, "post_id": 57776448, "comment_id": 101988336, "body": "please share the code you have written."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3364, "user_id": 6805190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GpCA.jpg?s=128&g=1", "display_name": "dassum", "link": "https://stackoverflow.com/users/6805190/dassum"}, "edited": false, "score": 1, "creation_date": 1567533656, "post_id": 57776448, "comment_id": 101988408, "body": "I&#39;m with @dassum, please share your code, because it is unclear what you mean by &quot;<i>internal</i> error&quot; and it is unclear what you&#39;ve tried so far to &quot;exit the processing&quot;."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1567535450, "post_id": 57776448, "comment_id": 101989051, "body": "Hard to say without seeing the code but it seems very likely it&#39;s as simple as &quot;when you get an error, write a 500 response to the client and return from your handler&quot;."}, {"owner": {"reputation": 49, "user_id": 10148050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c778c2b732623cd6b56f6ffc4ccbc7d9?s=128&d=identicon&r=PG&f=1", "display_name": "Luca R", "link": "https://stackoverflow.com/users/10148050/luca-r"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1567667868, "post_id": 57776448, "comment_id": 102032753, "body": "I included the code in my question and from my understanding of the comment from  @Adrian he is right."}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1567534089, "post_id": 57776651, "comment_id": 101988557, "body": "This is a nice answer when one wants to cancel <i>client</i> requests, however, since Luca R is implementing an api and they want to &quot;throw&quot; a 500 error, I would assume they are talking about <i>server</i> requests... although we can&#39;t be sure since they haven&#39;t provided no code..."}, {"owner": {"reputation": 993, "user_id": 274163, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/965e298ad83456c0a89b7f40c11294e7?s=128&d=identicon&r=PG", "display_name": "Freezerburn", "link": "https://stackoverflow.com/users/274163/freezerburn"}, "edited": false, "score": 0, "creation_date": 1567535196, "post_id": 57776651, "comment_id": 101988935, "body": "Would either acting as a client or acting as a server both use a Context value to include either a timeout or manual cancelation ability or both? (e.g.: acting as a client you would give a Context with timeout/cancel to the client lib, while acting as a server you would give a Context with timeout/cancel to the DB library or use it internally to look for cancellation?)"}, {"owner": {"reputation": 154, "user_id": 10316247, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--EoxDyFKf8Y/AAAAAAAAAAI/AAAAAAAAAuM/gd0UM-OmTx8/photo.jpg?sz=128", "display_name": "nicolasassi", "link": "https://stackoverflow.com/users/10316247/nicolasassi"}, "reply_to_user": {"reputation": 993, "user_id": 274163, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/965e298ad83456c0a89b7f40c11294e7?s=128&d=identicon&r=PG", "display_name": "Freezerburn", "link": "https://stackoverflow.com/users/274163/freezerburn"}, "edited": false, "score": 0, "creation_date": 1567535987, "post_id": 57776651, "comment_id": 101989264, "body": "@Freezerburn context is a powerful resource for either client and server operations because it works nicely in the goroutine ecosystem and as a channel value. So I would use it for both. About use manual cancellation or timeout I think I depends on your needs, but It&#39;s always nice to set some sort of timeout and the context lib is great for that. Also, I would never use it to cancel the DB lib before cleaning the connection."}, {"owner": {"reputation": 993, "user_id": 274163, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/965e298ad83456c0a89b7f40c11294e7?s=128&d=identicon&r=PG", "display_name": "Freezerburn", "link": "https://stackoverflow.com/users/274163/freezerburn"}, "edited": false, "score": 1, "creation_date": 1567536240, "post_id": 57776651, "comment_id": 101989358, "body": "@NicolasAugustoSassi <code>sql.DB.BeginTx(context.Context, *TxOptions)</code> is available for preventing any given set of queries from taking more than some given timeout if you configure a context with one. So if a server is handling a request and it cannot take more than 200 milliseconds to respond, there&#39;s a way to stop the DB driver from processing beyond that and give you the opportunity to respond with the correct error."}, {"owner": {"reputation": 154, "user_id": 10316247, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--EoxDyFKf8Y/AAAAAAAAAAI/AAAAAAAAAuM/gd0UM-OmTx8/photo.jpg?sz=128", "display_name": "nicolasassi", "link": "https://stackoverflow.com/users/10316247/nicolasassi"}, "reply_to_user": {"reputation": 993, "user_id": 274163, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/965e298ad83456c0a89b7f40c11294e7?s=128&d=identicon&r=PG", "display_name": "Freezerburn", "link": "https://stackoverflow.com/users/274163/freezerburn"}, "edited": false, "score": 0, "creation_date": 1567536395, "post_id": 57776651, "comment_id": 101989419, "body": "@Freezerburn didn&#39;t know about this sql lib resource. Thanks for that!"}, {"owner": {"reputation": 49, "user_id": 10148050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c778c2b732623cd6b56f6ffc4ccbc7d9?s=128&d=identicon&r=PG&f=1", "display_name": "Luca R", "link": "https://stackoverflow.com/users/10148050/luca-r"}, "edited": false, "score": 0, "creation_date": 1567667677, "post_id": 57776651, "comment_id": 102032656, "body": "Thank you all, my problem is on the server side but I&#39;ll look into the context-thing. I also updated the question and included some code."}, {"owner": {"reputation": 154, "user_id": 10316247, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--EoxDyFKf8Y/AAAAAAAAAAI/AAAAAAAAAuM/gd0UM-OmTx8/photo.jpg?sz=128", "display_name": "nicolasassi", "link": "https://stackoverflow.com/users/10316247/nicolasassi"}, "reply_to_user": {"reputation": 49, "user_id": 10148050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c778c2b732623cd6b56f6ffc4ccbc7d9?s=128&d=identicon&r=PG&f=1", "display_name": "Luca R", "link": "https://stackoverflow.com/users/10148050/luca-r"}, "edited": false, "score": 0, "creation_date": 1567688424, "post_id": 57776651, "comment_id": 102043733, "body": "@LucaR I would take a look at this thread than. Just to make your response to the client a bit more consistent: <a href=\"https://stackoverflow.com/questions/40096750/how-to-set-http-status-code-on-http-responsewriter\" title=\"how to set http status code on http responsewriter\">stackoverflow.com/questions/40096750/&hellip;</a>"}], "tags": [], "owner": {"reputation": 154, "user_id": 10316247, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--EoxDyFKf8Y/AAAAAAAAAAI/AAAAAAAAAuM/gd0UM-OmTx8/photo.jpg?sz=128", "display_name": "nicolasassi", "link": "https://stackoverflow.com/users/10316247/nicolasassi"}, "is_accepted": false, "score": -2, "last_activity_date": 1567534244, "last_edit_date": 1567534244, "creation_date": 1567533449, "answer_id": 57776651, "question_id": 57776448, "link": "https://stackoverflow.com/questions/57776448/stop-processing-of-http-request-in-go/57776651#57776651", "title": "Stop processing of http request in go", "body": "<p>I'd use cancellation by using the context library native in Go.</p>\n\n<p>an example of how you could active that: <a href=\"https://play.golang.org/p/qF7aQ1DP3vM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qF7aQ1DP3vM</a></p>\n\n<p>Here a nice artice about the topic: <a href=\"https://medium.com/the-software-firehose/canceling-requests-in-go-using-context-b4b28a118da8\" rel=\"nofollow noreferrer\">https://medium.com/the-software-firehose/canceling-requests-in-go-using-context-b4b28a118da8</a></p>\n\n<p><strong>Edit</strong></p>\n\n<p>It's important to keep in mind that this would be a solution for client requests only. If you want to cancel requests from server a different approach might be necessary. </p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 4, "last_activity_date": 1567689229, "creation_date": 1567689229, "answer_id": 57806339, "question_id": 57776448, "link": "https://stackoverflow.com/questions/57776448/stop-processing-of-http-request-in-go/57806339#57806339", "title": "Stop processing of http request in go", "body": "<p>There is no trick to it. When you want your handler function to stop doing things, just return from the function:</p>\n\n<pre><code>func testRest(w http.ResponseWriter, rest string) {\n    if rest == \"abc\" {\n        http.Error(w, \"The go-routine should stop here\", 500)\n        return\n    }\n    fmt.Print(\"This shouldn't be printed\")\n}\n</code></pre>\n\n<p>If you want to log something, log something:</p>\n\n<pre><code>func testRest(w http.ResponseWriter, rest string) {\n    if rest == \"abc\" {\n        http.Error(w, \"The go-routine should stop here\", 500)\n        log.Println(\"something bad happened\")\n        return\n    }\n    fmt.Print(\"This shouldn't be printed\")\n}\n</code></pre>\n\n<p>That's all there is to it. When you say \"internal error doesn't stop the processing of the requests\" it seems maybe you're thinking there's a lot more magic happening, but in Go there's very little magic. <code>http.Error</code> writes an error response back to the client. That's all. It has not way to \"stop\" anything; it just writes a status code and body to the client connection and then returns. After it returns, you have the opportunity to do more things in the calling code, but if you just want your function to return, then just return. Returning from the handler is what \"stops processing the request\" - your code is what's processing the request, you're in complete control.</p>\n"}], "owner": {"reputation": 49, "user_id": 10148050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c778c2b732623cd6b56f6ffc4ccbc7d9?s=128&d=identicon&r=PG&f=1", "display_name": "Luca R", "link": "https://stackoverflow.com/users/10148050/luca-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1482, "favorite_count": 1, "accepted_answer_id": 57806339, "answer_count": 2, "score": 2, "last_activity_date": 1567689229, "creation_date": 1567532381, "last_edit_date": 1567667489, "question_id": 57776448, "link": "https://stackoverflow.com/questions/57776448/stop-processing-of-http-request-in-go", "title": "Stop processing of http request in go", "body": "<p>I'm trying to rewrite a small node-api in golang and there I found that the internal error doesn't stop the processing of the requests. Is there a nice way to end the processing?</p>\n\n<p>I've tried different things like making a error-object and using panic(err) to exit the processing but I think there are better ways.</p>\n\n<p>I expected a function which stops the processing of the request and throws an 500-error and maybe logs a thing or two.</p>\n\n<p>The code-sample is like this: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"strings\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/ping/\", ping)\n    err := http.ListenAndServe(\":8080\", nil)\n    checkErr(err)\n}\n\nfunc ping(w http.ResponseWriter, req *http.Request) {\n    w.Write([]byte(\"pong\\n\"))\n    urlPath := req.URL.Path\n    rest := strings.TrimPrefix(urlPath, \"/ping/\")\n    testRest(w, rest)\n}\n\nfunc testRest(w http.ResponseWriter, rest string) {\n    if rest == \"abc\" {\n        http.Error(w, \"The go-routine should stop here\", 500)\n    }\n    fmt.Print(\"This shouldn't be printed\")\n}\n\nfunc checkErr(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>And I call it like that: </p>\n\n<pre><code>curl --url http://127.0.0.1:8080/ping/abc\n</code></pre>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1567527773, "post_id": 57774957, "comment_id": 101986173, "body": "Try implementing the <code>driver.Valuer</code> interface on the <i>value receiver</i>, not the pointer. That is, change <code>func (cm *ChecksMap) Value() ...</code> to <code>func (cm ChecksMap) Value() ...</code>, will insert still fail if you do that? And if it still fails, can you show what the error is, and if there&#39;s no error can you show how you&#39;ve implemented the <code>Value()</code> method?"}, {"owner": {"reputation": 537, "user_id": 5012775, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Lhg2b.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5012775/jeff"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567529317, "post_id": 57774957, "comment_id": 101986778, "body": "@mkopriva That worked. You&#39;re a godsend, and I&#39;m starting to develop a self-reflection that includes asking dumb questions that have really stupid answers or typos. Learning Go has been a challenge and JUST found info in the gorm docs that hints about this... <a href=\"http://gorm.io/docs/query.html#Struct-amp-Map\" rel=\"nofollow noreferrer\">gorm.io/docs/query.html#Struct-amp-Map</a> but goes into no detail. If you write a short answer about implementing driver.valuer, I feel like it is a suitable answer for the question despite my incorrect code. Then I will be able to upvote. Your call though. Thanks again."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1567531207, "creation_date": 1567531207, "answer_id": 57776209, "question_id": 57774957, "link": "https://stackoverflow.com/questions/57774957/go-gorm-postgres-dialect-managing-structs-for-jsonb-insert-and-find-to-properly/57776209#57776209", "title": "go-gorm postgres dialect: managing structs for jsonb insert and find to properly use json tags", "body": "<p>You can use the custom <code>ChecksMap</code> type but implement the <code>driver.Valuer</code> interface on its <em>value receiver</em>, not the pointer reciever.</p>\n\n<p>So, instead of:</p>\n\n<pre><code>func (cm *ChecksMap) Value() (driver.Value, error) { ...\n</code></pre>\n\n<p>You would write this:</p>\n\n<pre><code>func (cm ChecksMap) Value() (driver.Value, error) {\n    if cm == nil {\n        return nil, nil\n    }\n    return json.Marshal(cm)\n}\n</code></pre>\n\n<hr>\n\n<p>Alternatively, you can probably make it work with the pointer implementation but then you'll have to turn the field into a pointer, e.g:</p>\n\n<pre><code>type Checks struct {\n   ID      string     `gorm: \"primary_key\", json:\"id\"`\n   SomeID  *string    `json:\"someId\"`\n   Results *ChecksMap `json:\"results\"`\n}\n</code></pre>\n\n<p><em>(although I haven't tested this so I'm not 100% sure how gorm will handle this case)</em></p>\n"}], "owner": {"reputation": 537, "user_id": 5012775, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/Lhg2b.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5012775/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1166, "favorite_count": 0, "accepted_answer_id": 57776209, "answer_count": 1, "score": 1, "last_activity_date": 1567531207, "creation_date": 1567525416, "last_edit_date": 1567528742, "question_id": 57774957, "link": "https://stackoverflow.com/questions/57774957/go-gorm-postgres-dialect-managing-structs-for-jsonb-insert-and-find-to-properly", "title": "go-gorm postgres dialect: managing structs for jsonb insert and find to properly use json tags", "body": "<p>Been doing a lot of searching, and although i can find a bunch of good articles that explain how to work with the pq package directly. I'm at a loss of working in context of go-gorm and the postgresql dialect.</p>\n\n<p>If in checks.go I use the <em>ChecksMap</em> it doesn't let me insert but will let me find. If i use <em>postgres.jsonb</em> it lets me insert and query, but the found records will be of jsonb.</p>\n\n<p>Gorm uses the struct of the pointer to determine the db table and schema. This is causing headaches when using a generic searchHandler utility which returns a json response from the API. For any non jsonb types gorm works with the proper structs and uses the json tags, but for jsonb since it doesn't have a reference to the jsonb's \"struct\" it can't use the json tags. This causes the return API json to have capitalized keys.</p>\n\n<pre><code>{\n   results: {\n      id: \"123\",\n      someId: \"456\",\n      results: [\n         {\n            Description: \"foobar\"\n         }\n      ]\n   }\n}\n</code></pre>\n\n<p>Is there an elegant way to handling this sort of thing so the jsonb results column will be of the correct struct and use the lowercased json tags? Am i just trying to do things which shouldn't be done within the context of go-gorm?</p>\n\n<p><strong>POSTGRESQL DDL</strong></p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE TABLE checks (\n   id        text,\n   some_id   text,\n   results   jsonb\n);\n</code></pre>\n\n<p><strong>checks.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type CheckRules struct {\n   Description   string `json:\"description\"`\n}\n\ntype ChecksMap   map[string]CheckRules\n\ntype Checks struct {\n   ID            string           `gorm: \"primary_key\", json:\"id\"`\n   SomeID        *string          `json:\"someId\"`\n   Results       postgres.jsonb   `json:\"results\"`                   // &lt;-- this\n   // results    ChecksMap        `gorm:\"type:jsonb\" json:\"results\"` // &lt;-- or this\n}\n\n// func (cm *ChecksMap) Value() (driver.Value, error) {...}\n// func (cm *ChecksMap) Scan(val interface{}) error {...}\n</code></pre>\n\n<p><strong>insertChecks.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var resultsVal = getResultsValue() // simplified\nresJson, _ := json.Marshal(resultsVal)\n\nchecks := Checks{\n   SomeID: \"123\",\n   Results: postgres.Jsonb{ RawMessage: json.RawMessage(resJson) }\n}\n\nerr := db.Create(&amp;checks).Error\n// ... some error handling\n</code></pre>\n\n<p><strong>getChecks.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var checks Checks\n\nerr := db.Find(&amp;checks).Error\n// ... some error handling\n</code></pre>\n\n<p><strong>searchHandler.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func SearchHandler(db *gorm.DB, model, results interface{}) func(c echo.Context) error {\n   return func(c echo.Context) error {\n      err := db.Find(results).Error\n      // ... some error handling\n\n      jsnRes, _ := json.Marshal(results) // &lt;-- uppercase \"keys\"\n\n      return c.JSON(http.StatusOK, struct {\n         Results interface{} `json:\"results\"`\n      }{\n         Results: string(jsnRes),\n      })\n   }\n}\n</code></pre>\n"}, {"tags": ["go", "goquery"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1567524565, "post_id": 57774699, "comment_id": 101984667, "body": "What does the document look like when it cannot find the name? You can probably print the document in a legible way and see if it has some unexpected text in it."}, {"owner": {"reputation": 3694, "user_id": 1107412, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/96ODm.png?s=128&g=1", "display_name": "Preslav Rachev", "link": "https://stackoverflow.com/users/1107412/preslav-rachev"}, "edited": false, "score": 1, "creation_date": 1567525253, "post_id": 57774699, "comment_id": 101985007, "body": "Could you provide an example Amazon URL that you are testing with? I picked up on at random, but can&#39;t seem to find <code>#productTitle</code> there at all."}, {"owner": {"reputation": 3647, "user_id": 4093955, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/bjZjz.jpg?s=128&g=1", "display_name": "Ay0", "link": "https://stackoverflow.com/users/4093955/ay0"}, "reply_to_user": {"reputation": 3694, "user_id": 1107412, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/96ODm.png?s=128&g=1", "display_name": "Preslav Rachev", "link": "https://stackoverflow.com/users/1107412/preslav-rachev"}, "edited": false, "score": 0, "creation_date": 1567532690, "post_id": 57774699, "comment_id": 101988033, "body": "@PreslavRachev e.g. echo dot <code>https:&#47;&#47;www.amazon.es&#47;dp&#47;B07PHPXHQS&#47;ref=gw_es_desk_aucc_cr_b&zwnj;&#8203;ts19?pf_rd_p=25e41a3&zwnj;&#8203;d-017b-48da-a396-4e4&zwnj;&#8203;50f9cf46d&amp;pf_rd_r=38&zwnj;&#8203;R4G48ZWNQD9XF3Y4GY</code>"}], "answers": [{"tags": [], "owner": {"reputation": 3647, "user_id": 4093955, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/bjZjz.jpg?s=128&g=1", "display_name": "Ay0", "link": "https://stackoverflow.com/users/4093955/ay0"}, "is_accepted": true, "score": 0, "last_activity_date": 1567533193, "creation_date": 1567533193, "answer_id": 57776599, "question_id": 57774699, "link": "https://stackoverflow.com/questions/57774699/go-parsing-failing-quite-often-goquery/57776599#57776599", "title": "Go parsing failing quite often (goquery)", "body": "<p>I found the issue :)</p>\n\n<p>There was something different between my Python code and the Go code. In Python I was issuing a real user-agent header, whereas in Go, it was the default for that package.</p>\n\n<p>That means that, actually, it was Amazon blocking most of the attempts, returning a CAPTCHA.</p>\n"}], "owner": {"reputation": 3647, "user_id": 4093955, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/bjZjz.jpg?s=128&g=1", "display_name": "Ay0", "link": "https://stackoverflow.com/users/4093955/ay0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 57776599, "answer_count": 1, "score": -1, "last_activity_date": 1567533193, "creation_date": 1567524354, "question_id": 57774699, "link": "https://stackoverflow.com/questions/57774699/go-parsing-failing-quite-often-goquery", "title": "Go parsing failing quite often (goquery)", "body": "<p>I have a <a href=\"https://github.com/ay0o/amazon-price-checker\" rel=\"nofollow noreferrer\">Python program</a> which check whether a product price in Amazon is lower than expected.</p>\n\n<p>For learning purposes, and to make it more portable, I'm porting that code to Go. It's my first ever Go program.</p>\n\n<p>For parsing the html, I'm using <a href=\"http://github.com/PuerkitoBio/goquery\" rel=\"nofollow noreferrer\">goquery</a>. So far I'm just trying to retrieve the name of the product. Here's the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"log\"\n\n    \"github.com/PuerkitoBio/goquery\"\n)\n\nfunc main() {\n    url := flag.String(\"url\", \"\", \"URL of the product\")\n    flag.Parse()\n\n    doc, err := goquery.NewDocument(*url)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    name := doc.Find(\"#productTitle\").Text()\n    fmt.Println(name)\n}\n</code></pre>\n\n<p>What problem I'm facing? It's returning the name around 1 out of 8 executions. That's definitively not correct. It's not a problem of Amazon or regarding the tag <code>#productTitle</code>, because the Python code just work every single time.</p>\n\n<p>What might be wrong? How can I further debug this issue? I repeat, first code ever using Go :)</p>\n"}, {"tags": ["go", "redis", "publish-subscribe"], "comments": [{"owner": {"reputation": 3996, "user_id": 1615594, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VD0n3.jpg?s=128&g=1", "display_name": "tsuz", "link": "https://stackoverflow.com/users/1615594/tsuz"}, "edited": false, "score": 0, "creation_date": 1567531546, "post_id": 57774691, "comment_id": 101987585, "body": "You need to check a few things. 1. Handling network disconnection 2. handling <a href=\"https://godoc.org/github.com/go-redis/redis#Options\" rel=\"nofollow noreferrer\">IdleTimeout</a> and see whether you still get the error"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1567528923, "creation_date": 1567528923, "answer_id": 57775758, "question_id": 57774691, "link": "https://stackoverflow.com/questions/57774691/redis-golang-client-periodically-discarding-bad-pubsub-connection-eof/57775758#57775758", "title": "Redis golang client periodically discarding bad PubSub connection (EOF)", "body": "<p>My take on that is that Redis may disconnect your client if it thinks the client is idling.</p>\n\n<p>A way to cope with this seems to be like that:</p>\n\n<ol>\n<li>Use <code>ReceiveTimeout</code> rather than <code>Receive</code>.</li>\n<li>If the operation timed out, issue <code>Ping</code> and wait for reply.</li>\n<li>Rinse, repeat.</li>\n</ol>\n\n<p>That way, you'll be sure there exists some traffic on the connection\u2014no matter whether there is any data actually published or not.</p>\n\n<p>I'd start <a href=\"https://github.com/go-redis/redis/blob/178deea321b5f14d2ea4be3e5e04a510c846e77f/pubsub_test.go#L207\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 143, "user_id": 7334197, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Oku4dUDTgk8/AAAAAAAAAAI/AAAAAAAABW4/hJ6mUEk7PvQ/photo.jpg?sz=128", "display_name": "Darmawan Zulkifli", "link": "https://stackoverflow.com/users/7334197/darmawan-zulkifli"}, "edited": false, "score": 0, "creation_date": 1612774653, "post_id": 58237162, "comment_id": 116861466, "body": "how the pubsub channel work ? is possible if use this way more than 2 time will decrease the perfomance ?"}], "tags": [], "owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "is_accepted": true, "score": 1, "last_activity_date": 1570194769, "creation_date": 1570194769, "answer_id": 58237162, "question_id": 57774691, "link": "https://stackoverflow.com/questions/57774691/redis-golang-client-periodically-discarding-bad-pubsub-connection-eof/58237162#58237162", "title": "Redis golang client periodically discarding bad PubSub connection (EOF)", "body": "<p>I solved the disconnects by ranging over the channel returned from <code>pubsub.Channel()</code> instead of <code>Receive()</code>.</p>\n\n<p>Here's the new code:</p>\n\n<pre><code>\nfunc listenToControlChannel(client *redis.Client) {\n    pubsub := client.Subscribe(\"control\")\n    defer pubsub.Close()\n\n    if _, err := pubsub.Receive(); err != nil {\n        rootLogger.Error(\"failed to receive from control PubSub\", zap.Error(err))\n        return\n    }\n\n    controlCh := pubsub.Channel()\n    fmt.Println(\"start listening on control PubSub\")\n\n    // Endlessly listen to control channel,\n    for msg := range controlCh {\n        cm := ControlMessageEvent{}\n        payload := []byte(msg.Payload)\n        if err := json.Unmarshal(payload, &amp;cm); err != nil {\n            fmt.Printf(\"failed to parse control message: %s\\n\", err.Error())\n        } else if err := handleIncomingEvent(&amp;cm); err != nil {\n            fmt.Printf(\"failed to handle control message: %s\\n\", err.Error())\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1488, "favorite_count": 1, "accepted_answer_id": 58237162, "answer_count": 2, "score": 2, "last_activity_date": 1570194769, "creation_date": 1567524323, "last_edit_date": 1567524892, "question_id": 57774691, "link": "https://stackoverflow.com/questions/57774691/redis-golang-client-periodically-discarding-bad-pubsub-connection-eof", "title": "Redis golang client periodically discarding bad PubSub connection (EOF)", "body": "<h2>What I did:</h2>\n\n<p>I'm using the <code>golang</code> Redis library from <code>github.com/go-redis/redis</code>. My client listens on a PubSub channel called 'control'. Whenever a message arrives, I handle it and continue receiving the next message.\nI listen endlessly and the messages can come often, or sometimes not for days.</p>\n\n<h2>What I expect:</h2>\n\n<p>I expect the redis channel to stay open endlessly and receive messages as they are sent.</p>\n\n<h2>What I experience:</h2>\n\n<p>Usually it runs well for days, but every once in a while <code>client.Receive()</code> returns <code>EOF</code> error. After this error, the client no longer receives messages on that channel.\nInternally, the redis client prints to stdout the following message:</p>\n\n<blockquote>\n  <p>redis: 2019/08/29 14:18:57 pubsub.go:151: redis: discarding bad PubSub connection: EOF</p>\n</blockquote>\n\n<p><strong><em>Disclaimer:</strong> I am not certain that this error is what causes me to stop receiving messages, it just seems related.</em></p>\n\n<h2>Additional questions:</h2>\n\n<p>I'd like to understand why this happens, if this is normal and if reconnecting to the channel via <code>client.Subscribe()</code> whenever I encounter the behaviour is a good remedy, or should I address the root issue, whatever it may be.</p>\n\n<h2>The code:</h2>\n\n<p>Here is the entire code that handles my client (connect to redis, subscribe to channel, endlessly receive messages):</p>\n\n<pre><code>func InitAndListenAsync(log *log.Logger, sseHandler func(string, string) error) error {\n    rootLogger = log.With(zap.String(\"component\", \"redis-client\"))\n\n    host := env.RedisHost\n    port := env.RedisPort\n    pass := env.RedisPass\n    addr := fmt.Sprintf(\"%s:%s\", host, port)\n    tlsCfg := &amp;tls.Config{}\n    client = redis.NewClient(&amp;redis.Options{\n        Addr:      addr,\n        Password:  pass,\n        TLSConfig: tlsCfg,\n    })\n\n    if _, err := client.Ping().Result(); err != nil {\n        return err\n    }\n\n    go func() {\n        controlSub := client.Subscribe(\"control\")\n        defer controlSub.Close()\n        for {\n            in, err := controlSub.Receive()  // *** SOMETIMES RETURNS EOF ERROR ***\n            if err != nil {\n                rootLogger.Error(\"failed to get feedback\", zap.Error(err))\n                break\n            }\n            switch in.(type) {\n            case *redis.Message:\n                cm := comm.ControlMessageEvent{}\n                payload := []byte(in.(*redis.Message).Payload)\n                if err := json.Unmarshal(payload, &amp;cm); err != nil {\n                    rootLogger.Error(\"failed to parse control message\", zap.Error(err))\n                } else if err := handleIncomingEvent(&amp;cm); err != nil {\n                    rootLogger.Error(\"failed to handle control message\", zap.Error(err))\n                }\n\n            default:\n                rootLogger.Warn(\"Received unknown input over REDIS PubSub control channel\", zap.Any(\"received\", in))\n            }\n        }\n    }()\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 264, "user_id": 5353730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ccd4d1c05cf575710739c8a8e792d78d?s=128&d=identicon&r=PG", "display_name": "Zoinks", "link": "https://stackoverflow.com/users/5353730/zoinks"}, "is_accepted": true, "score": 1, "last_activity_date": 1567512608, "creation_date": 1567512608, "answer_id": 57771494, "question_id": 57771252, "link": "https://stackoverflow.com/questions/57771252/how-to-fix-worker-pool-deadlock/57771494#57771494", "title": "How to fix Worker Pool Deadlock", "body": "<p>I was able to replicate your issue and fix it by using a pointer to <code>master</code> instead of a normal variable. </p>\n\n<p>Basically just change your <code>NewWorker()</code> method  to this:</p>\n\n<pre><code>func (m *Master) NewWorker() {\n    m.Workers = append(m.Workers, Worker{})\n}\n</code></pre>\n\n<p>Here's the output the program prints after the change:</p>\n\n<pre><code>0\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n.\n.\n.\n</code></pre>\n\n<h2>Reason:</h2>\n\n<p>Everytime you called <code>NewWorker()</code> method, you weren't appending a <code>worker</code> to the same master object. That's why the slice never got populated with 3 workers, as should've been the case.</p>\n\n<p><a href=\"https://play.golang.org/p/Y-kcsCI08tu\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}], "owner": {"reputation": 53, "user_id": 6875314, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/EnggW.jpg?s=128&g=1", "display_name": "NLis", "link": "https://stackoverflow.com/users/6875314/nlis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 28, "favorite_count": 0, "closed_date": 1567528615, "accepted_answer_id": 57771494, "answer_count": 1, "score": -2, "last_activity_date": 1567512608, "creation_date": 1567511656, "question_id": 57771252, "link": "https://stackoverflow.com/questions/57771252/how-to-fix-worker-pool-deadlock", "closed_reason": "Not suitable for this site", "title": "How to fix Worker Pool Deadlock", "body": "<p>I wrote a pool of workers, where the job is to receive an integer and return that number converted to string. However I faced a <code>fatal error: all goroutines are asleep - deadlock!</code> error. What am I doing wrong and how can I fix it?</p>\n\n<p><a href=\"https://play.golang.org/p/U814C2rV5na\" rel=\"nofollow noreferrer\">https://play.golang.org/p/U814C2rV5na</a></p>\n"}, {"tags": ["go", "integration-testing", "hashicorp-vault"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 6, "creation_date": 1567511653, "post_id": 57771228, "comment_id": 101977388, "body": "In unit tests you don&#39;t mock types/services you don&#39;t own (instead - you mock your own services/repositories that provide access to those 3rd party resources). In functional/integration tests you don&#39;t mock them either, but test against them."}], "answers": [{"tags": [], "owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "is_accepted": false, "score": 2, "last_activity_date": 1567517876, "creation_date": 1567517876, "answer_id": 57772914, "question_id": 57771228, "link": "https://stackoverflow.com/questions/57771228/mocking-hashicorp-vault-in-go/57772914#57772914", "title": "Mocking Hashicorp vault in Go", "body": "<p>Because Go is a statically typed language we have to know the type of things at compile time. So to do this type of independent testing we need to create boundaries in our code that make logical sense in terms of testing.</p>\n\n<p>Interfaces are created in Go to define these boundaries, so in this sense you want to create an interface between you and this third party library so that you can replace the inputs and outputs of the libraries functions/methods/types with ones that you can control and have defined conditions so that you can test how your code behaves to outputs or conditions of the third party.</p>\n\n<p>See the below for examples of interfaces.</p>\n\n<p><a href=\"https://gobyexample.com/interfaces\" rel=\"nofollow noreferrer\">https://gobyexample.com/interfaces</a></p>\n\n<p>if you share some example code perhaps we can be a little more specific and give you some code examples.</p>\n"}, {"comments": [{"owner": {"reputation": 639, "user_id": 1889311, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1a4bbe4aa268aa16a09d51311c23ac69?s=128&d=identicon&r=PG", "display_name": "Gil Zellner", "link": "https://stackoverflow.com/users/1889311/gil-zellner"}, "edited": false, "score": 0, "creation_date": 1567586972, "post_id": 57773764, "comment_id": 102003050, "body": "Wow this is amazing, exactly what I need."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 12, "last_activity_date": 1587110868, "last_edit_date": 1587110868, "creation_date": 1567520873, "answer_id": 57773764, "question_id": 57771228, "link": "https://stackoverflow.com/questions/57771228/mocking-hashicorp-vault-in-go/57773764#57773764", "title": "Mocking Hashicorp vault in Go", "body": "<blockquote>\n  <p>Is there an easy way to mock HashiCorp Vault in Go tests?</p>\n</blockquote>\n\n<p>Don't. Use the real thing! HashiCorp helpfully provides utility functions for starting a server on the fly<sup>1</sup>. This makes your tests much more useful, and can often serve as an actionable guide for developers on how to setup local development servers too.</p>\n\n<p>Here is a very basic example. The testing framework is very flexible (which also makes it fairly complicated). Refer to the package documentations for more options, including running multiple servers in HA mode. I found Vault's own test cases very useful when setting up more complicated scenarios.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"net\"\n    \"testing\"\n\n    \"github.com/hashicorp/vault/api\"\n    \"github.com/hashicorp/vault/http\"\n    \"github.com/hashicorp/vault/vault\"\n)\n\nfunc TestVaultStuff(t *testing.T) {\n    ln, client := createTestVault(t)\n    defer ln.Close()\n\n    // Pass the client to the code under test.\n    myFunction(client)\n}\n\nfunc createTestVault(t *testing.T) (net.Listener, *api.Client) {\n    t.Helper()\n\n    // Create an in-memory, unsealed core (the \"backend\", if you will).\n    core, keyShares, rootToken := vault.TestCoreUnsealed(t)\n    _ = keyShares\n\n    // Start an HTTP server for the core.\n    ln, addr := http.TestServer(t, core)\n\n    // Create a client that talks to the server, initially authenticating with\n    // the root token.\n    conf := api.DefaultConfig()\n    conf.Address = addr\n\n    client, err := api.NewClient(conf)\n    if err != nil {\n        t.Fatal(err)\n    }\n    client.SetToken(rootToken)\n\n    // Setup required secrets, policies, etc.\n    _, err = client.Logical().Write(\"secret/foo\", map[string]interface{}{\n        \"secret\": \"bar\",\n    })\n    if err != nil {\n        t.Fatal(err)\n    }\n\n    return ln, client\n}\n</code></pre>\n\n<hr>\n\n<p><sup>1</sup> They provide test servers for all of their projects, not just Vault. Mitchell Hashimoto explained the rational in <a href=\"https://youtu.be/yszygk1cpEc?t=3238\" rel=\"noreferrer\">his talk on advanced testing</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 447, "user_id": 172556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9bdba6e1c8a28664e99e9c8caaa05bd?s=128&d=identicon&r=PG", "display_name": "Ami Mahloof", "link": "https://stackoverflow.com/users/172556/ami-mahloof"}, "is_accepted": false, "score": 2, "last_activity_date": 1587171269, "creation_date": 1587171269, "answer_id": 61282978, "question_id": 57771228, "link": "https://stackoverflow.com/questions/57771228/mocking-hashicorp-vault-in-go/61282978#61282978", "title": "Mocking Hashicorp vault in Go", "body": "<p>One super important thing to note:</p>\n\n<p><code>TestCoreUnsealed</code> doesn't use the regular KV backend, instead it uses a <code>PassthroughBackend</code> to essentially mock the kv behavior.</p>\n\n<p>follow this issue, i've spent 4 days debugging this</p>\n\n<p><a href=\"https://github.com/hashicorp/vault/issues/8440\" rel=\"nofollow noreferrer\">https://github.com/hashicorp/vault/issues/8440</a></p>\n"}], "owner": {"reputation": 639, "user_id": 1889311, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1a4bbe4aa268aa16a09d51311c23ac69?s=128&d=identicon&r=PG", "display_name": "Gil Zellner", "link": "https://stackoverflow.com/users/1889311/gil-zellner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2141, "favorite_count": 1, "accepted_answer_id": 57773764, "answer_count": 3, "score": 2, "last_activity_date": 1587171269, "creation_date": 1567511580, "question_id": 57771228, "link": "https://stackoverflow.com/questions/57771228/mocking-hashicorp-vault-in-go", "title": "Mocking Hashicorp vault in Go", "body": "<p>Is there an easy way to mock Hashicorp vault in go tests ?</p>\n\n<p>I created a service in Go that accesses Vault, and would like to create proper testing for it.</p>\n\n<p>I didn't find a simple solution I like (like moto in python).\nI also tried using a vault in dev mode in docker (take the system test route) but I have trouble writing to it via API.\nIdeas ?</p>\n"}, {"tags": ["go", "apache-kafka", "kafka-producer-api", "segment-io"], "answers": [{"tags": [], "owner": {"reputation": 5627, "user_id": 2534090, "user_type": "registered", "accept_rate": 34, "profile_image": "https://i.stack.imgur.com/DeBhf.png?s=128&g=1", "display_name": "JavaTechnical", "link": "https://stackoverflow.com/users/2534090/javatechnical"}, "is_accepted": false, "score": 0, "last_activity_date": 1567576197, "last_edit_date": 1567576197, "creation_date": 1567518454, "answer_id": 57773090, "question_id": 57771085, "link": "https://stackoverflow.com/questions/57771085/how-we-can-write-single-messagenot-batch-fast-in-kafka/57773090#57773090", "title": "How we can write single message(not batch) fast in kafka?", "body": "<p>I don't know much about golang. But the following function using <a href=\"https://godoc.org/github.com/segmentio/kafka-go#Writer.WriteMessages\" rel=\"nofollow noreferrer\">Writer.WriteMessages</a> has synchronous send option.</p>\n\n<p>Writing fast (using sync send) actually depends upon your Network Roundtrip time i.e, the time taken to put the message to Kafka plus the time taken to get the acknowledgement from Kafka.</p>\n\n<p>If you are using <em>sync send</em>, then your send will block until acknowledgement is received.\nSo, to make it fast, one <strong><em>way</em></strong> is to reduce the acknowledgements. It is better to set it to 1 (meaning, that the leader has written the message to its log but it is not replicated to the followers). But this can cause loss if the leader goes down and the message is not replicated.</p>\n\n<p>So, you can set it to <code>acks=all</code> and change the <code>min.insync.replicas=2</code> on the topic. The lesser the value the faster your <code>send()</code> returns and the faster it can push the next message to Kafka.</p>\n"}, {"tags": [], "owner": {"reputation": 88, "user_id": 7014983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dba2067e874bee4e723d07eb6aeaa78?s=128&d=identicon&r=PG&f=1", "display_name": "Odilon", "link": "https://stackoverflow.com/users/7014983/odilon"}, "is_accepted": true, "score": 3, "last_activity_date": 1567991230, "creation_date": 1567991230, "answer_id": 57846834, "question_id": 57771085, "link": "https://stackoverflow.com/questions/57771085/how-we-can-write-single-messagenot-batch-fast-in-kafka/57846834#57846834", "title": "How we can write single message(not batch) fast in kafka?", "body": "<p>I think your problem is just the WriterConfig.</p>\n\n<p>For example, if your config looks like the example on segmentio/kafka-go docs:</p>\n\n<pre><code>w := kafka.NewWriter(kafka.WriterConfig{\n    Brokers:      []string{\"localhost:9092\"},\n    Topic:        \"topic-A\",\n    Balancer:     &amp;kafka.LeastBytes{},\n})\n</code></pre>\n\n<p>You could try setting batch size and batch timeout:</p>\n\n<pre><code>w := kafka.NewWriter(kafka.WriterConfig{\n    Brokers:      []string{\"localhost:9092\"},\n    Topic:        \"topic-A\",\n    Balancer:     &amp;kafka.LeastBytes{},\n    BatchSize:    1,\n    BatchTimeout: 10 * time.Millisecond,\n})\n</code></pre>\n\n<p>It happens because kafka-go waits by default 1 second until the batch reach the maximum size, which is by default 100 messages, as we can see in the <a href=\"https://github.com/segmentio/kafka-go/blob/master/writer.go#L228\" rel=\"nofollow noreferrer\">code</a>.</p>\n\n<p>Hope it helps you.</p>\n\n<hr>\n\n<p>Update: Be aware that sending the messages one by one slows the process.\nFor example: sending 100 messages in batch took on my computer 0.0107s. Sending the same 100 messages one by one took 0.0244s. </p>\n"}], "owner": {"reputation": 3, "user_id": 11983127, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mDrZAbQnmVJgalHSIbghe3v8MUPaGaw-jYGkxzi=k-s128", "display_name": "Suraj Singh", "link": "https://stackoverflow.com/users/11983127/suraj-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 998, "favorite_count": 1, "accepted_answer_id": 57846834, "answer_count": 2, "score": 0, "last_activity_date": 1567991230, "creation_date": 1567511122, "last_edit_date": 1567512477, "question_id": 57771085, "link": "https://stackoverflow.com/questions/57771085/how-we-can-write-single-messagenot-batch-fast-in-kafka", "title": "How we can write single message(not batch) fast in kafka?", "body": "<p>I am new to Golang and Kafka and I am using segmentio kafka-go to connect to Kafka server using Golang. As of now I want to push every event of user in Kafka, so I want to push single message(and not in batch), but since the write operation provided by this library takes same time for either batch or single message, it is taking a lot of time. Is there any way of writing single message fast so that i can push million events in kafka in less time?</p>\n\n<p>I have tested it for single message, and batch messages, it is taking same time (min was 10ms).</p>\n"}, {"tags": ["go", "cron", "scheduled-tasks"], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 2431019, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71a633f112f3ecced459a5a09258a0ba?s=128&d=identicon&r=PG", "display_name": "avishkar", "link": "https://stackoverflow.com/users/2431019/avishkar"}, "edited": false, "score": 0, "creation_date": 1567571062, "post_id": 57776229, "comment_id": 101997034, "body": "I guess I need to write my own scheduler. Thanks for the help."}], "tags": [], "owner": {"reputation": 993, "user_id": 274163, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/965e298ad83456c0a89b7f40c11294e7?s=128&d=identicon&r=PG", "display_name": "Freezerburn", "link": "https://stackoverflow.com/users/274163/freezerburn"}, "is_accepted": true, "score": 0, "last_activity_date": 1567531298, "creation_date": 1567531298, "answer_id": 57776229, "question_id": 57771084, "link": "https://stackoverflow.com/questions/57771084/use-gocron-scheduler-to-schedule-job-on-specific-day-at-specific-time/57776229#57776229", "title": "Use gocron scheduler to schedule job on specific day at specific time", "body": "<p>When looking at the documentation for gocron, it does not seem to be designed to support scheduling things for specific days. It seems to be designed as a way to schedule things to run at various intervals, very similar to what the original cron utility was designed to do. So you would specify \"I want this function to get called every 2 hours\" or \"I want this function to get called every Sunday at 3PM\". There does not seem to be any documentation about starting jobs from a specific day.</p>\n\n<p>The mentioned <code>At(string)</code> method is documented as allowing you to specify a time of day to run something. So you would use that to set that your job runs at 3:30PM.</p>\n\n<p>If you wish to specify a start time, you would likely need to find another scheduling library or implement it yourself by creating a goroutine that sleeps until a specific time. The StackOverflow post mentioned by domcyrus looks like an excellent resource for implementing it yourself as well as listing some other scheduling libraries.</p>\n"}], "owner": {"reputation": 19, "user_id": 2431019, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71a633f112f3ecced459a5a09258a0ba?s=128&d=identicon&r=PG", "display_name": "avishkar", "link": "https://stackoverflow.com/users/2431019/avishkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 356, "favorite_count": 0, "accepted_answer_id": 57776229, "answer_count": 1, "score": 0, "last_activity_date": 1567531298, "creation_date": 1567511119, "question_id": 57771084, "link": "https://stackoverflow.com/questions/57771084/use-gocron-scheduler-to-schedule-job-on-specific-day-at-specific-time", "title": "Use gocron scheduler to schedule job on specific day at specific time", "body": "<p>I want to schedule a job on a specific day at a specific time with some interval. I am using gocron scheduler for this. But I can't find a way to start a job on specific day. e.g. I want to execute a job on 7 Sept 2019 at 330pm. From 7 Sept, I want that job to be executed daily or weekly. How can I do that using gocron. or Any other packages available?</p>\n\n<p>I tried passing UTC time to gocron.At() but its panics as it's expecting only \"03:30\" time formats and doesn't expect date.</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "edited": false, "score": 0, "creation_date": 1567511932, "post_id": 57770591, "comment_id": 101977566, "body": "thanks for beautiful explanation,  so i created a deadlock situation here, right?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "edited": false, "score": 1, "creation_date": 1567512709, "post_id": 57770591, "comment_id": 101977956, "body": "@mkmayank No, it&#39;s not a deadlock, because the <code>main()</code> goroutine can proceed once the timer is up. In a deadlock all goroutines are blocked, waiting for each other or some event that will never occur."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1567527158, "last_edit_date": 1567527158, "creation_date": 1567509436, "answer_id": 57770591, "question_id": 57770328, "link": "https://stackoverflow.com/questions/57770328/why-channel-is-not-receiving-being-member-of-struct/57770591#57770591", "title": "why channel is not receiving being member of struct", "body": "<p>Your <code>main</code> goroutine sends a value on <code>b.c</code>, then waits:</p>\n\n<pre><code>b.c &lt;- true\n</code></pre>\n\n<p>The goroutine you launch from main:</p>\n\n<pre><code>go b.s()\n</code></pre>\n\n<p>This is the one that receives from <code>b.c</code>, and also from <code>b.a.c</code>:</p>\n\n<pre><code>func (b *b) s() {\n    for {\n        select {\n        case &lt;-b.c:\n            fmt.Println(\"b c\")\n            b.a.do()\n\n        case &lt;-b.a.c:\n            fmt.Println(\"b a c\")\n        }\n    }\n}\n</code></pre>\n\n<p>If a value is received from <code>b.c</code>, this goroutine attempts to send on <code>b.a.c</code> (in <code>a.do()</code> method), and you expect this <em>same</em> goroutine to receive from <code>b.a.c</code>. But since <code>b.a.c</code> is unbuffered, the send will block, so it will never reach the next iteration in <code>b.s()</code> where it could / would receive from <code>b.a.c</code>.</p>\n\n<p>If a channel is unbuffered, a send on it may only proceed if there is another goroutine ready to receive from it.</p>\n\n<p>If you make the <code>b.a.c</code> channel buffered, a send on it can proceed without blocking, so in the next iteration it can be received:</p>\n\n<pre><code>a: a{c: make(chan bool, 1)}\n</code></pre>\n\n<p>With this change you get your expected output. Try it on the <a href=\"https://play.golang.org/p/C-QJ2RbIs2w\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 57770591, "answer_count": 1, "score": -1, "last_activity_date": 1567546780, "creation_date": 1567508395, "last_edit_date": 1567512760, "question_id": 57770328, "link": "https://stackoverflow.com/questions/57770328/why-channel-is-not-receiving-being-member-of-struct", "title": "why channel is not receiving being member of struct", "body": "<p>Code : <a href=\"https://play.golang.org/p/Oh3oTa7GIPX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Oh3oTa7GIPX</a></p>\n\n<pre><code>type a struct {\n    c chan bool\n}\n\nfunc (a *a) do() {\n    a.c &lt;- true\n}\n\ntype b struct {\n    c chan bool\n    a a\n}\n\nfunc main() {\n    b := b{\n        c: make(chan bool),\n        a: a{c: make(chan bool)},\n    }\n\n    go b.s()\n    b.c &lt;- true\n\n    // below is to stay main gorutine alive\n    done := make(chan bool)\n    go func() {\n        time.Sleep(10 * time.Second)\n        done &lt;- true\n    }()\n    for {\n        select {\n        case &lt;-done:\n            fmt.Println(\"Done!\")\n            return\n        }\n    }\n}\n\nfunc (b *b) s() {\n    for {\n        select {\n        case &lt;-b.c:\n            fmt.Println(\"b c\")\n            b.a.do()\n\n        case &lt;-b.a.c:\n            fmt.Println(\"b a c\")\n        }\n    }\n}\n</code></pre>\n\n<p>Actual Output of above is </p>\n\n<pre><code>b c\nDone!\n</code></pre>\n\n<p>Expected Ouput:</p>\n\n<pre><code>b c\nb a c\nDone !\n</code></pre>\n\n<p>I am not getting why is it not printing <code>b a c</code> ?</p>\n\n<p>Code is self explanatory, if it still requires more details please ask</p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1567507410, "post_id": 57769800, "comment_id": 101975121, "body": "Use a struct tag like <code>`xml:&quot;keyword&quot;`</code>. The documentation even provides an example for this <a href=\"https://golang.org/pkg/encoding/xml/#example_Unmarshal\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/xml/#example_Unmarshal</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 12013919, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cocj1vwtsAw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf5UTV_NYQ35zcleJz0XieKFmr7Ig/photo.jpg?sz=128", "display_name": "Tony Montana", "link": "https://stackoverflow.com/users/12013919/tony-montana"}, "edited": false, "score": 0, "creation_date": 1567509108, "post_id": 57770299, "comment_id": 101976046, "body": "It returns     &lt;Token&gt;       &lt;Keyword&gt;x&lt;/Keyword&gt;       &lt;Identifier&gt;y&lt;/Identifier&gt;       &lt;Symbol&gt;z&lt;/Symbol&gt;    &lt;/Token&gt; I don&#39;t need to wrap it in &lt;token&gt; tag"}, {"owner": {"reputation": 1, "user_id": 12013919, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cocj1vwtsAw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf5UTV_NYQ35zcleJz0XieKFmr7Ig/photo.jpg?sz=128", "display_name": "Tony Montana", "link": "https://stackoverflow.com/users/12013919/tony-montana"}, "edited": false, "score": 0, "creation_date": 1567509466, "post_id": 57770299, "comment_id": 101976233, "body": "And token is not the structure of fields &quot;Keyword&quot;, &quot;Identifier&quot; and &quot;Symbol&quot;. It has a certain type that is related to a certain value. Type should be appear in the tag"}, {"owner": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "reply_to_user": {"reputation": 1, "user_id": 12013919, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cocj1vwtsAw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf5UTV_NYQ35zcleJz0XieKFmr7Ig/photo.jpg?sz=128", "display_name": "Tony Montana", "link": "https://stackoverflow.com/users/12013919/tony-montana"}, "edited": false, "score": 0, "creation_date": 1567512598, "post_id": 57770299, "comment_id": 101977911, "body": "You could rename it to tokens."}], "tags": [], "owner": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "is_accepted": false, "score": 0, "last_activity_date": 1567508290, "creation_date": 1567508290, "answer_id": 57770299, "question_id": 57769800, "link": "https://stackoverflow.com/questions/57769800/how-to-serialize-go-struct-to-xml-using-one-field-as-a-tag-and-other-as-a-value/57770299#57770299", "title": "How to serialize go struct to XML using one field as a tag and other as a value", "body": "<p>You can use encoding/xml. ie:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\nfunc main() {\n    type Token struct {\n        Keyword    string `xml:\"Keyword\"`\n        Identifier string `xml:\"Identifier\"`\n        Symbol     string `xml:\"Symbol\"`\n    }\n    type Tokens struct {\n        Tokens []Token `xml:\"Token\"`\n    }\n    data := Tokens{[]Token{Token{Keyword: \"x\", Identifier: \"y\", Symbol: \"z\"},\n        Token{Keyword: \"x1\", Identifier: \"y1\", Symbol: \"z1\"},}}\n\n    xml, _ := xml.MarshalIndent(data, \"\",\"   \")\n    fmt.Println(string(xml))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12013919, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cocj1vwtsAw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf5UTV_NYQ35zcleJz0XieKFmr7Ig/photo.jpg?sz=128", "display_name": "Tony Montana", "link": "https://stackoverflow.com/users/12013919/tony-montana"}, "is_accepted": false, "score": 0, "last_activity_date": 1567511567, "creation_date": 1567511567, "answer_id": 57771219, "question_id": 57769800, "link": "https://stackoverflow.com/questions/57769800/how-to-serialize-go-struct-to-xml-using-one-field-as-a-tag-and-other-as-a-value/57771219#57771219", "title": "How to serialize go struct to XML using one field as a tag and other as a value", "body": "<p>I have solved this using \"github.com/beevik/etree\" package. They provide easy way to do that</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"github.com/beevik/etree\"\n)\n\ntype Token struct {\n    Type string\n    Value string\n}\n\n\nvar x = Token{Type: \"keyword\", Value: \"x\",} \nvar y = Token{Type: \"identifier\", Value: \"y\"}\nvar z = Token{Type: \"symbol\", Value: \"z\"} \nvar w = []Token {x, y, z}\n\nfunc main() {\n    doc := etree.NewDocument()\n    doc.CreateProcInst(\"xml\", `version=\"1.0\" encoding=\"UTF-8\"`)\n    tokens := doc.CreateElement(\"tokens\")\n\n    for i := range w {\n        elem := tokens.CreateElement(w[i].Type)\n        elem.CreateText(w[i].Value)\n    }\n    doc.Indent(2)\n    doc.WriteTo(os.Stdout)\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 12013919, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cocj1vwtsAw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf5UTV_NYQ35zcleJz0XieKFmr7Ig/photo.jpg?sz=128", "display_name": "Tony Montana", "link": "https://stackoverflow.com/users/12013919/tony-montana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1567511567, "creation_date": 1567506385, "last_edit_date": 1567509352, "question_id": 57769800, "link": "https://stackoverflow.com/questions/57769800/how-to-serialize-go-struct-to-xml-using-one-field-as-a-tag-and-other-as-a-value", "title": "How to serialize go struct to XML using one field as a tag and other as a value", "body": "<p>I have some struct:</p>\n\n<pre><code>type Tokens struct {\n}\n\ntype Token struct {\nType string\nValue string\n}\n\nI need to get XML file as the output:\n&lt;tokens&gt;\n&lt;keyword&gt; x&lt;/keyword&gt;\n&lt;identifier&gt; y &lt;/identifier&gt;\n&lt;symbol&gt; z &lt;/symbol&gt;\n&lt;/tokens&gt;\n</code></pre>\n\n<p>Where keyword, identifier or symbol are values of the field Type and x,y,x are values of the field Value</p>\n\n<p>Specifically, I don't need to wrap each token into  tags. There are multiple types of token but for certain value only one type.</p>\n\n<p>The standard library encoding/xml doesn't provide a ready solution for that. It seems to provide only the ability to use the field name as a tag</p>\n"}, {"tags": ["go", "go-micro"], "comments": [{"owner": {"reputation": 3364, "user_id": 6805190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GpCA.jpg?s=128&g=1", "display_name": "dassum", "link": "https://stackoverflow.com/users/6805190/dassum"}, "edited": false, "score": 0, "creation_date": 1567505923, "post_id": 57769485, "comment_id": 101974353, "body": "what are you using to create a service? Any Framework? Docker ? Share the code."}, {"owner": {"reputation": 84, "user_id": 6907784, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MYEpn.jpg?s=128&g=1", "display_name": "Hamid Raza Noori", "link": "https://stackoverflow.com/users/6907784/hamid-raza-noori"}, "reply_to_user": {"reputation": 3364, "user_id": 6805190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GpCA.jpg?s=128&g=1", "display_name": "dassum", "link": "https://stackoverflow.com/users/6805190/dassum"}, "edited": false, "score": 0, "creation_date": 1567506055, "post_id": 57769485, "comment_id": 101974401, "body": "Micro Cli to create service, I am not using docker. we are in development. Only need to fix transport port for development."}, {"owner": {"reputation": 3364, "user_id": 6805190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GpCA.jpg?s=128&g=1", "display_name": "dassum", "link": "https://stackoverflow.com/users/6805190/dassum"}, "edited": false, "score": 0, "creation_date": 1567506396, "post_id": 57769485, "comment_id": 101974582, "body": "while creating the docker image you acn specify the port mapping. share your docker run command"}, {"owner": {"reputation": 84, "user_id": 6907784, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MYEpn.jpg?s=128&g=1", "display_name": "Hamid Raza Noori", "link": "https://stackoverflow.com/users/6907784/hamid-raza-noori"}, "reply_to_user": {"reputation": 3364, "user_id": 6805190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GpCA.jpg?s=128&g=1", "display_name": "dassum", "link": "https://stackoverflow.com/users/6805190/dassum"}, "edited": false, "score": 0, "creation_date": 1567506500, "post_id": 57769485, "comment_id": 101974643, "body": "Docker is not a right way for my project development"}], "answers": [{"comments": [{"owner": {"reputation": 84, "user_id": 6907784, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MYEpn.jpg?s=128&g=1", "display_name": "Hamid Raza Noori", "link": "https://stackoverflow.com/users/6907784/hamid-raza-noori"}, "edited": false, "score": 0, "creation_date": 1574854342, "post_id": 57771174, "comment_id": 104376557, "body": "I have used Inbuild Environment variable For custom PORT. Thanks"}], "tags": [], "owner": {"reputation": 264, "user_id": 5353730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ccd4d1c05cf575710739c8a8e792d78d?s=128&d=identicon&r=PG", "display_name": "Zoinks", "link": "https://stackoverflow.com/users/5353730/zoinks"}, "is_accepted": true, "score": 2, "last_activity_date": 1567511415, "creation_date": 1567511415, "answer_id": 57771174, "question_id": 57769485, "link": "https://stackoverflow.com/questions/57769485/how-to-fix-port-for-go-micro-service/57771174#57771174", "title": "How to fix port for Go-Micro Service", "body": "<p>You can specify the port in the server you must be creating for your micro-service. Since you haven't shared any sample code, here's a proposed solution that might work for you:</p>\n\n<pre><code> service := micro.NewService(\n    micro.Name(serviceName),\n    micro.Server(\n      server.NewServer(\n        server.Name(serviceName),\n        server.Address(\":8080\"),\n      ),\n    ),\n  )\n\n  service.Init()\n</code></pre>\n\n<p>Let me know if it is not the way you're using go-micro.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6740223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c3562115c43534c76e8a33cdfdb9f64?s=128&d=identicon&r=PG&f=1", "display_name": "Sumonto Saha", "link": "https://stackoverflow.com/users/6740223/sumonto-saha"}, "is_accepted": false, "score": 0, "last_activity_date": 1592669375, "creation_date": 1592669375, "answer_id": 62488347, "question_id": 57769485, "link": "https://stackoverflow.com/questions/57769485/how-to-fix-port-for-go-micro-service/62488347#62488347", "title": "How to fix port for Go-Micro Service", "body": "<p>Since the go micro version is not mentioned.\nI have tested the above answer with go-micro version github.com/micro/go-micro/v2 v2.9.0.\nBut there was another issue I have faced, the go-micro server ran perfectly ok with the fixed port. However, when I have executed a gRPC client over the fixed port, the response object was returning panic.\nSome working on the code and found the below fix</p>\n<pre><code>   service := micro.NewService(\n      micro.Name(serviceName),\n      micro.Version(&quot;1.0&quot;),\n      micro.Address(&quot;:8080&quot;),\n  )\n</code></pre>\n<p>With the above fix, the server was set to a fixed port and the gRPC client also responded with success.</p>\n"}], "owner": {"reputation": 84, "user_id": 6907784, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MYEpn.jpg?s=128&g=1", "display_name": "Hamid Raza Noori", "link": "https://stackoverflow.com/users/6907784/hamid-raza-noori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 0, "accepted_answer_id": 57771174, "answer_count": 2, "score": 0, "last_activity_date": 1592669375, "creation_date": 1567505283, "last_edit_date": 1567505718, "question_id": 57769485, "link": "https://stackoverflow.com/questions/57769485/how-to-fix-port-for-go-micro-service", "title": "How to fix port for Go-Micro Service", "body": "<p>I am running go-micro , But unable to set constant port for my service. Is there any way to assign port to service.</p>\n\n<p>If i am running my service, it gives different port on every execution. i want it to fix.</p>\n"}, {"tags": ["go", "struct", "reflection"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1567497494, "creation_date": 1567497494, "answer_id": 57767368, "question_id": 57767303, "link": "https://stackoverflow.com/questions/57767303/whats-the-difference-between-type-field-and-value-field/57767368#57767368", "title": "What&#39;s the difference between Type.Field and Value.Field?", "body": "<p><code>Type.Field()</code> returns a value of type <a href=\"https://golang.org/pkg/reflect/#StructField\" rel=\"nofollow noreferrer\"><code>reflect.StructField</code></a>, and <a href=\"https://golang.org/pkg/reflect/#Value.Field\" rel=\"nofollow noreferrer\"><code>Value.Field()</code></a> returns a value of type <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a>. So they cannot be the same.</p>\n\n<p><code>Type.Field()</code> returns a value describing the field's <em>type</em>, regardless of any actual struct value. <code>Value.Field()</code> returns a <code>reflect.Value</code> that wraps the <em>value</em> of a field of a struct value.</p>\n"}], "owner": {"reputation": 2314, "user_id": 9768260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/604c85a549d2603e8119880c100b5aae?s=128&d=identicon&r=PG", "display_name": "ccd", "link": "https://stackoverflow.com/users/9768260/ccd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 57767368, "answer_count": 1, "score": -2, "last_activity_date": 1567497633, "creation_date": 1567497285, "last_edit_date": 1567497633, "question_id": 57767303, "link": "https://stackoverflow.com/questions/57767303/whats-the-difference-between-type-field-and-value-field", "title": "What&#39;s the difference between Type.Field and Value.Field?", "body": "<p>Following code.</p>\n\n<pre><code>func fieldsTest(target interface{}) ([]field, error) {\n    s := reflect.ValueOf(target)\n\n    s = s.Elem()\n\n    targetType := s.Type()\n\n    for i := 0; i &lt; s.NumField(); i++ {\n        f := s.Field(i)\n        structField := targetType.Field(i)\n\n    ...\n}\n</code></pre>\n\n<p>If the target interface is a struct, the return value of f are the same as structField?</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "aws-lambda-layers"], "comments": [{"owner": {"reputation": 39319, "user_id": 303810, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a42f8ff287eb5abf432ce696bf7c653b?s=128&d=identicon&r=PG", "display_name": "lexicore", "link": "https://stackoverflow.com/users/303810/lexicore"}, "edited": false, "score": 0, "creation_date": 1567497820, "post_id": 57766674, "comment_id": 101970121, "body": "Do you have appropriate <code>logs:*</code> permissions in the execution policy of your lambda function?"}, {"owner": {"reputation": 51, "user_id": 11943909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a986c685885fadcd636b4159863f9a?s=128&d=identicon&r=PG&f=1", "display_name": "Stefan995", "link": "https://stackoverflow.com/users/11943909/stefan995"}, "reply_to_user": {"reputation": 39319, "user_id": 303810, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a42f8ff287eb5abf432ce696bf7c653b?s=128&d=identicon&r=PG", "display_name": "lexicore", "link": "https://stackoverflow.com/users/303810/lexicore"}, "edited": false, "score": 0, "creation_date": 1567509591, "post_id": 57766674, "comment_id": 101976303, "body": "I&#39;ve edited my question by putting in JSON execution policy. Please take a look."}, {"owner": {"reputation": 45894, "user_id": 271415, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/8648256cc53b261c5e1d266380a256fc?s=128&d=identicon&r=PG", "display_name": "jarmod", "link": "https://stackoverflow.com/users/271415/jarmod"}, "edited": false, "score": 0, "creation_date": 1567542535, "post_id": 57766674, "comment_id": 101991611, "body": "Doe the log group already exist? You&#39;d typically want logs:CreateLogGroup in your IAM policy, or simply apply AWSLambdaBasicExecutionRole."}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 11943909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a986c685885fadcd636b4159863f9a?s=128&d=identicon&r=PG&f=1", "display_name": "Stefan995", "link": "https://stackoverflow.com/users/11943909/stefan995"}, "is_accepted": false, "score": 0, "last_activity_date": 1567606050, "creation_date": 1567606050, "answer_id": 57790239, "question_id": 57766674, "link": "https://stackoverflow.com/questions/57766674/invoking-aws-lambda-asynchronously-does-not-produce-any-logs/57790239#57790239", "title": "Invoking AWS Lambda Asynchronously does not produce any logs", "body": "<p>For some reason asynchronous logs needed around 5 mins to be created. I just left <strong>CloudWatch Logs</strong> page open for a while, refreshed and they've appeared (note that they did not appear on first couple of refresh actions once lambda function was executed). Apologize for the trouble, and many thanks.</p>\n"}], "owner": {"reputation": 51, "user_id": 11943909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a986c685885fadcd636b4159863f9a?s=128&d=identicon&r=PG&f=1", "display_name": "Stefan995", "link": "https://stackoverflow.com/users/11943909/stefan995"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 295, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567606050, "creation_date": 1567494754, "last_edit_date": 1567509558, "question_id": 57766674, "link": "https://stackoverflow.com/questions/57766674/invoking-aws-lambda-asynchronously-does-not-produce-any-logs", "title": "Invoking AWS Lambda Asynchronously does not produce any logs", "body": "<p>I have followed instructions at: <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/invocation-async.html#dlq\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/lambda/latest/dg/invocation-async.html#dlq</a> in order to invoke my Lambda function asynchronously from command line:</p>\n\n<pre><code>aws lambda invoke --function-name MyLambda --invocation-type Event --payload '{private information}' response.json\n{\n    \"StatusCode\": 202\n}\n</code></pre>\n\n<p>I do get <code>status code 202</code> returned but I do not see any logs regarding the execution. </p>\n\n<p>How can I fix this?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Below is my execution policy in JSON format:</p>\n\n<pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Action\": [\n                \"logs:CreateLogStream\"\n            ],\n            \"Resource\": [\n                \"arn:aws:logs:xx-xxxx-x:xxxxxxxx:log-group:/aws/lambda/LambdaConfigService-dev*:*\"\n            ],\n            \"Effect\": \"Allow\"\n        },\n        {\n            \"Action\": [\n                \"logs:PutLogEvents\"\n            ],\n            \"Resource\": [\n                \"arn:aws:logs:xx-xxxx-x:xxxxxxxx:log-group:/aws/lambda/LambdaConfigService-dev*:*:*\"\n            ],\n            \"Effect\": \"Allow\"\n        },\n        {\n            \"Action\": \"s3:*\",\n            \"Resource\": \"*\",\n            \"Effect\": \"Allow\"\n        }\n    ]\n}\n</code></pre>\n"}, {"tags": ["go", "mocking", "gomock"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1567493601, "post_id": 57766045, "comment_id": 101968158, "body": "In Go you can&#39;t mock concrete methods, only interface methods and function values, e.g. a function field or variable."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1567498440, "post_id": 57766045, "comment_id": 101970412, "body": "Note that Go has no classes. Your question (which I edited for spelling) referred to a &quot;Go test class&quot;. This doesn&#39;t exist. Get it out of your head that Go has classes or anything like classes."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1567498554, "post_id": 57766045, "comment_id": 101970474, "body": "Usually, trying to assert that a specific method was called, is <i>bad practice</i> in <i>any language</i>. You should be testing that the method does what you expect--not <i>how</i> it does it. Testing that it calls a specific method is a &quot;how&quot; test not a &quot;what&quot; test."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 1, "creation_date": 1567502704, "post_id": 57766045, "comment_id": 101972617, "body": "@PanagiotisKanavos: Struct vs class isn&#39;t just semantics. It&#39;s a <i>fundamentally different way of thinking</i>. People who think about Classes are constantly confused by Go for this very reason. If you think a struct &quot;is basically a class&quot;, that <b>IS</b> wrong. It doesn&#39;t make the developer a bad person. It just means they have a mistaken concept. The point of such comments is to correct them, not criticize. Don&#39;t take things so personally."}, {"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1567503104, "post_id": 57766045, "comment_id": 101972837, "body": "@Flimzy I didn&#39;t say it is. And I remember saying that there&#39;s no need for class inheritance, just interfaces back in the VB6 days. Now, if you find that link amusing, check the vote count. You have enough rep to see the 5 downvotes. I bet those 141 upvotes came after the article was published. It&#39;s actually <i>very</i> common to find mass downvotes in new questions in the <code>go</code> tag, almost 1 or 2 per week"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1567504688, "post_id": 57766045, "comment_id": 101973733, "body": "On a different note, I might add that there is a very good reason that you can only mock interfaces. It <i>forces</i> you to develop against interfaces, which should be done for obvious reasons."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1567496058, "creation_date": 1567496058, "answer_id": 57766990, "question_id": 57766045, "link": "https://stackoverflow.com/questions/57766045/is-it-possible-to-assert-that-a-real-method-is-called-via-spying-in-go-like-java/57766990#57766990", "title": "Is it possible to assert that a real method is called via spying in Go like Java Mockito?", "body": "<blockquote>\n  <p>Is it possible to assert that a real method is called via spying in golang like Java Mockito?</p>\n</blockquote>\n\n<p>No, not at all.</p>\n"}, {"comments": [{"owner": {"reputation": 477, "user_id": 7047456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b50238281fc05d33c8a5b17492cb560?s=128&d=identicon&r=PG&f=1", "display_name": "Mozhi", "link": "https://stackoverflow.com/users/7047456/mozhi"}, "edited": false, "score": 0, "creation_date": 1567525537, "post_id": 57769670, "comment_id": 101985144, "body": "Thank you for your insights , I agree with you but what should i do with external dependencies in the code , for instance ~ In my method i have some database interactions , to write unit tests i have to mock those interactions but i don&#39;t want any other developer to accidentally delete those lines that does affect the functionality. I think the case of external dependencies does required to mock and assert that they are called . Hope you will agree with me..."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1567517342, "last_edit_date": 1567517342, "creation_date": 1567505954, "answer_id": 57769670, "question_id": 57766045, "link": "https://stackoverflow.com/questions/57766045/is-it-possible-to-assert-that-a-real-method-is-called-via-spying-in-go-like-java/57769670#57769670", "title": "Is it possible to assert that a real method is called via spying in Go like Java Mockito?", "body": "<blockquote>\n  <p>Is it possible to assert that a real method is called via spying in Go like Java Mockito?</p>\n</blockquote>\n\n<p>In a word: No.</p>\n\n<p>But what about alternatives?</p>\n\n<p>What you should be testing for is the <em>effects of your function</em>. This is true in any language, not just Go. This is also true whether you're doing unit testing or some higher-level type of testing, including end-to-end testing.</p>\n\n<p>If your <code>methodB()</code> calls <code>methodA()</code>, it's not useful to check, <em>per se</em>, that <code>methodA()</code> is called. What <em>is</em> useful is to check that <code>methodB()</code> does what you expect.  Whether it uses <code>methodA()</code> to accomplish that or not, is an implementation detail that your test, by definition, should not care about.</p>\n\n<p>Some examples:</p>\n\n<ul>\n<li><p>Suppose you're writing an integration test, and <code>methodA()</code> inserts something into the database. Don't assert that <code>methodA()</code> is called--instead assert that the row you expect is now in the database.</p></li>\n<li><p>Suppose you're writing a unit test for a Fibonacci generator. Don't assert whether it calls <code>methodA()</code>, assert whether it returns the correct value.</p></li>\n</ul>\n\n<p>When you assert that a sub-method is called, you're worried about implementation details--the \"how\" of your function. That's not what good tests do. Good tests assure that your method produces the correct result. It shouldn't matter, from a testing standpoint, whether it does that by calling <code>methodA()</code>, <code>methodZ()</code>, a REST API, or using Jedi powers.</p>\n\n<p>So TL;DR; No, you can't do what you're asking, but that's okay because you shouldn't do what you're asking. There are better alternatives (even in Java).</p>\n"}], "owner": {"reputation": 477, "user_id": 7047456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b50238281fc05d33c8a5b17492cb560?s=128&d=identicon&r=PG&f=1", "display_name": "Mozhi", "link": "https://stackoverflow.com/users/7047456/mozhi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1567517342, "creation_date": 1567491881, "last_edit_date": 1567498422, "question_id": 57766045, "link": "https://stackoverflow.com/questions/57766045/is-it-possible-to-assert-that-a-real-method-is-called-via-spying-in-go-like-java", "title": "Is it possible to assert that a real method is called via spying in Go like Java Mockito?", "body": "<p>I am looking for asserting that a statement is covered in my test. For instance, let's say from test am calling methodA() which has reference to methodB(). </p>\n\n<p>I would like to assert that methodB() is called upon executing methodA() from tests.</p>\n\n<p><strong>In the following code how do I assert in A Go test that svc.AddCheck() is called on execution of svc.OnStartup()?</strong></p>\n\n<pre><code>func (svc *Servjice) OnStartup() error {\n    if err := svc.AddCheck(\"cache\"); err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1567491142, "creation_date": 1567491142, "answer_id": 57765915, "question_id": 57765819, "link": "https://stackoverflow.com/questions/57765819/stop-matching-after-first-match-in-go-mux/57765915#57765915", "title": "Stop matching after first match in go/mux", "body": "<p>/ is a directory separator for URLs, so what mux is doing is correct that it is separating and matching segments delimited by /. If you want to pass <code>ls -la /home/foo</code> as a path parameter, then you should escape the / characters, and write %2F. Then mux will run correctly.</p>\n\n<p>Another option can be to install a handler to PathPrefix /cmd/. Then you have to parse the remaining part of the path in your handler, but you can treat '/' the way you want.</p>\n"}], "owner": {"reputation": 3035, "user_id": 749041, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2eee5d59ef528829ba6fa5ca4c6f47d9?s=128&d=identicon&r=PG", "display_name": "LordDoskias", "link": "https://stackoverflow.com/users/749041/lorddoskias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 57765915, "answer_count": 1, "score": 1, "last_activity_date": 1567528721, "creation_date": 1567490510, "last_edit_date": 1567528721, "question_id": 57765819, "link": "https://stackoverflow.com/questions/57765819/stop-matching-after-first-match-in-go-mux", "title": "Stop matching after first match in go/mux", "body": "<p>I have the following router: </p>\n\n<pre><code>func testHttp() {\n\n    r := mux.NewRouter()\n    s := r.PathPrefix(\"/cmd\").Subrouter()\n    s.HandleFunc(\"/{cmd}\", cmd)\n    http.Handle(\"/\", r)\n\n    http.ListenAndServe(\":8090\", nil)\n}\n</code></pre>\n\n<p>When I make a request such as <code>localhost:8090/cmd/ls -la</code> then the cmd handler is executed correctly. However If I pass in something like <code>localhost:8090/cmd/ls -la /home/foo</code> I get a 404. This implies that gorilla/mux keeps matching if it detects a /. So how do I configure it such that everything after a particular matched path (in this case /cmd/) is considered a parameter to the path? Presumably I could just resort to using GET parameters but can this be achieved if using the /rest-endpoint/params-containing/  as well ?            </p>\n"}, {"tags": ["go", "apache-kafka"], "owner": {"reputation": 11, "user_id": 11960720, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBoMXrFYPlTFd1rc80x6-vKXVbrwGIAU0UUv56K=k-s128", "display_name": "SunY", "link": "https://stackoverflow.com/users/11960720/suny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 427, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1567494818, "creation_date": 1567479974, "last_edit_date": 1567494818, "question_id": 57764572, "link": "https://stackoverflow.com/questions/57764572/i-connected-kafka-with-go-it-was-ok-at-first-but-there-was-an-error-later", "title": "I connected Kafka with GO, it was ok at first, but there was an error later", "body": "<p>I connected Kafka with GO, it was ok at first, but there was an error later.And ERROR is \"# github.com/Shopify/sarama\n........\\src\\github.com\\Shopify\\sarama\\sync_producer.go:35:6: invalid receiver type SyncProducer (SyncProducer is an interface type)\n\"</p>\n\n<p>In the beginning, I used Kafka to connect to Kafka in a synchronous manner. It was possible to connect Kafka asynchronously, and this error was displayed. I will try to sync again and find that the synchronization has also failed.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// \u540c\u6b65\u6d88\u606f\u6a21\u5f0f\nfunc SynchronizeKafkaProducer(address ...string){\n    config := sarama.NewConfig()\n    config.Producer.Return.Successes = true\n    config.Producer.Timeout = 5 * time.Second\n    client, errClient:= sarama.NewClient(address, config)\n    if errClient != nil {\n        log.Printf(\"sarama.NewClient err, message=%s \\n\", errClient)\n        return\n    }\n    producer, errPro := sarama.NewSyncProducerFromClient(client)\n    if errPro != nil {\n        log.Printf(\"sarama.NewSyncProducerFromClient err, message=%s \\n\", errPro)\n        return\n    }\n    defer producer.Close()\n    srcValue := \"sync: this is a message . index = %d\"\n    for i:=0; i &lt;10 ; i++  {\n        value := fmt.Sprintf(srcValue, i)\n        message := &amp;sarama.ProducerMessage{\n            Topic: \"flink_topic\",\n            Value: sarama.ByteEncoder(value),\n        }\n        partition, offset, err := producer.SendMessage(message)\n        if err!=nil {\n            log.Printf(\"send message(%s) err=%s \\n\", value, err)\n        }else {\n            fmt.Fprintf(os.Stdout, value + \"\u53d1\u9001\u6210\u529f\uff0cpartition=%d, offset=%d \\n\", partition, offset)\n        }\n        time.Sleep(2*time.Second)\n    }\n}\n\n// \u5f02\u6b65\u7684Kafka\u53d1\u9001\u6570\u636e\nfunc AsynchronousKafkaProducer(address ...string){\n    config := sarama.NewConfig()\n    config.Producer.Return.Successes = true\n    config.Producer.Timeout = 5 * time.Second\n    client, errClient := sarama.NewClient(address, config)\n    if errClient!= nil{\n        log.Printf(\"sarama.NewClient err, message=%s \\n\", errClient)\n        return\n    }\n    asyncProducer, errPro := sarama.NewAsyncProducerFromClient(client)\n    if errPro != nil {\n        log.Printf(\"sarama.NewSyncProducerFromClient err, message=%s \\n\", errPro)\n        return\n    }\n    defer asyncProducer.AsyncClose()\n\n    go func(asyncProducer sarama.AsyncProducer) {\n        for  {\n            select {\n            case err := &lt;- asyncProducer.Errors():\n                if err != nil {\n                    glog.Errorln(err)\n                }\n            case &lt;- asyncProducer.Successes():\n            }\n        }\n    }(asyncProducer)\n\n    v := \"async: \" + strconv.Itoa(rand.New(rand.NewSource(time.Now().UnixNano())).Intn(10000))\n    fmt.Fprintln(os.Stdout, v)\n    message := &amp;sarama.ProducerMessage{\n        Topic: \"flink_topic\",\n        Value: sarama.ByteEncoder(v),\n    }\n    asyncProducer.Input() &lt;- message\n    time.Sleep(2*time.Second)\n}\n</code></pre>\n\n<p>I hope that I can succeed, but the reality is always cruel.The error has been posted, so I want to know why\uff1f</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code># github.com/Shopify/sarama\n..\\..\\..\\..\\src\\github.com\\Shopify\\sarama\\sync_producer.go:35:6: invalid receiver type SyncProducer (SyncProducer is an interface type)\n..\\..\\..\\..\\src\\github.com\\Shopify\\sarama\\sync_producer.go:39:6: invalid receiver type SyncProducer (SyncProducer is an interface type)\n..\\..\\..\\..\\src\\github.com\\Shopify\\sarama\\sync_producer.go:43:6: invalid receiver type SyncProducer (SyncProducer is an interface type)\n..\\..\\..\\..\\src\\github.com\\Shopify\\sarama\\sync_producer.go:47:6: invalid receiver type SyncProducer (SyncProducer is an interface type)\n</code></pre>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1567478805, "post_id": 57764431, "comment_id": 101964595, "body": "The error looks like a network error, possible coming somewhere from <code>ExecGetData</code>. You see it in group.Wait() because that&#39;s where all the goroutines you created work. Try running the for loop without goroutines, call ExecGetData synchronously so you can see where the error is."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1567478874, "post_id": 57764431, "comment_id": 101964609, "body": "Please post an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>.  Information that&#39;s missing: declaration of <code>group</code> and surrounding code, the definition of <code>ExecGetData</code>."}], "owner": {"reputation": 43, "user_id": 8286720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6b18beb5c3401bcedf184cc859a6a2a?s=128&d=identicon&r=PG&f=1", "display_name": "JimReno", "link": "https://stackoverflow.com/users/8286720/jimreno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567504222, "creation_date": 1567478518, "last_edit_date": 1567504222, "question_id": 57764431, "link": "https://stackoverflow.com/questions/57764431/issue-related-to-function-wait", "title": "Issue related to function Wait()", "body": "<p>I'm trying to set up a Toplist app to get hot topics on the Internet. The Github project is <a href=\"https://github.com/tophubs/TopList\" rel=\"nofollow noreferrer\">here</a>. This project is built by Golang and Mysql.</p>\n\n<p>The program tries to grab hot information from several pages at the same time. error shows <code>dial tcp: lookup tcp/port: getaddrinfow: The specified class was not found.</code> when I run the client app.</p>\n\n<p>Note that I'm a newbie to golang and mysql, Please forgive me if I didn't describe this problem well. :)</p>\n\n<p>I am on windows os. I open an issue about this error on the Github but have not been answered yet. The <code>getaddrinfow</code> seems to be a windows socket related function where I found in this <a href=\"https://docs.microsoft.com/zh-cn/windows/win32/api/ws2tcpip/nf-ws2tcpip-getaddrinfow\" rel=\"nofollow noreferrer\">site</a></p>\n\n<p>I debugged the code in Goland. I got error in this line:</p>\n\n<p>error occurred in group.Wait()</p>\n\n<pre><code>    allData := []string{\n        \"V2EX\",\n        \"ZhiHu\",\n        \"WeiBo\",\n    }\n    fmt.Println(\"starting catching\" + strconv.Itoa(len(allData)) + \"types of data\")\n    group.Add(len(allData))\n    var spider Spider\n    for _, value := range allData {\n        fmt.Println(\"starting catching\" + value)\n        spider = Spider{DataType: value}\n        go ExecGetData(spider)\n    }\n    group.Wait() //error occured in group.Wait()\n    fmt.Print(\"completed catching\")\n}\n</code></pre>\n\n<p>Here is where the error had been thrown (in line 5).</p>\n\n<pre><code>        if atomic.CompareAndSwapUint64(statep, state, state+1) {\n            if race.Enabled &amp;&amp; w == 0 {\n                race.Write(unsafe.Pointer(semap))\n            }\n            runtime_Semacquire(semap) // where error occured\n            if *statep != 0 {\n                panic(\"sync: WaitGroup is reused before previous Wait has returned\")\n</code></pre>\n"}, {"tags": ["go", "binary", "byte", "slice", "endianness"], "answers": [{"comments": [{"owner": {"reputation": 12283, "user_id": 200783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/6b938dc4205cd0cea4e4e68451c42a21?s=128&d=identicon&r=PG", "display_name": "user200783", "link": "https://stackoverflow.com/users/200783/user200783"}, "edited": false, "score": 0, "creation_date": 1567476008, "post_id": 57764172, "comment_id": 101964131, "body": "Thanks. Is there a function to do it without the need to create a temporary slice?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 12283, "user_id": 200783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/6b938dc4205cd0cea4e4e68451c42a21?s=128&d=identicon&r=PG", "display_name": "user200783", "link": "https://stackoverflow.com/users/200783/user200783"}, "edited": false, "score": 0, "creation_date": 1567476367, "post_id": 57764172, "comment_id": 101964184, "body": "Not that I know. You can create the initial slice larger, if that&#39;s an option: <code>s:=[]byte{0,1,2,3,0,0,0,0} binary.LittleEndian.PutUint32(s[3:],u)</code>"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1567528875, "last_edit_date": 1567528875, "creation_date": 1567475815, "answer_id": 57764172, "question_id": 57764140, "link": "https://stackoverflow.com/questions/57764140/append-the-bytes-of-a-uint32-to-a-byte-slice/57764172#57764172", "title": "Append the bytes of a uint32 to a byte slice?", "body": "<p>encoding/binary has the functions you need:</p>\n\n<pre><code>import \"encoding/binary\"\n\nb := make([]byte,4)\nbinary.LittleEndian.PutUint32(b, u)\ns = append(s, b)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1567477132, "last_edit_date": 1567477132, "creation_date": 1567476270, "answer_id": 57764213, "question_id": 57764140, "link": "https://stackoverflow.com/questions/57764140/append-the-bytes-of-a-uint32-to-a-byte-slice/57764213#57764213", "title": "Append the bytes of a uint32 to a byte slice?", "body": "<p>One option is to append the individual bytes as suggested in the question.  The multiple <code>append</code> calls can be combined into a single call:</p>\n\n<pre><code>s = append(s, byte(u), byte(u&gt;&gt;8), byte(u&gt;&gt;16), byte(u&gt;&gt;24))\n</code></pre>\n\n<p>The binary package can also be used as the question suggests:</p>\n\n<pre><code>var b [4]byte\nbinary.LittleEndian.PutUint32(b[:], u)\ns = append(s, b[:]...)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/LM-DynBi0HC\" rel=\"nofollow noreferrer\">Run it on the Go playground</a>.</p>\n\n<p>The last snippet should allocate <code>b</code> on the stack. If it does not, then the extra heap allocation can be avoided with the following code:</p>\n\n<pre><code>s = append(s, \"    \"...) // append four bytes (the values don't matter)\nbinary.LittleEndian.PutUint32(s[len(s)-4:], u) // overwrite those bytes with the uint32\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "is_accepted": false, "score": -3, "last_activity_date": 1567860978, "last_edit_date": 1567860978, "creation_date": 1567481099, "answer_id": 57764678, "question_id": 57764140, "link": "https://stackoverflow.com/questions/57764140/append-the-bytes-of-a-uint32-to-a-byte-slice/57764678#57764678", "title": "Append the bytes of a uint32 to a byte slice?", "body": "<p>There's unsafe (actually safe, if you will only copy its bytes) way to get byte representation of any primitive:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>const sizeUInt32 = int(unsafe.Sizeof(uint32(0)))\n\nfunc GetBytesUInt32(i *uint32) []byte {\n   return (*[1 &lt;&lt; 30]byte)(unsafe.Pointer(i))[:sizeUInt32:sizeUInt32]\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/WPC5jeYLDth\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WPC5jeYLDth</a></p>\n\n<p>Created slice will carry passed int's storage, so by making a manipulations with it keep in mind that uint32 value will be changed too.</p>\n\n<hr>\n\n<p>Hey, what a hate without discussion? I realize that you guys don't like unsafe code, and I realize that such answer isn't <code>recommended way</code> for which topic starter looking... but I think that such place as stackoverflow should offer all of possibles ways to implement thing people googling for.</p>\n"}], "owner": {"reputation": 12283, "user_id": 200783, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/6b938dc4205cd0cea4e4e68451c42a21?s=128&d=identicon&r=PG", "display_name": "user200783", "link": "https://stackoverflow.com/users/200783/user200783"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1567860978, "creation_date": 1567475442, "last_edit_date": 1567475792, "question_id": 57764140, "link": "https://stackoverflow.com/questions/57764140/append-the-bytes-of-a-uint32-to-a-byte-slice", "title": "Append the bytes of a uint32 to a byte slice?", "body": "<p>If I have an existing <code>[]byte</code>, what is the recommended way to append the bytes of one or more <code>uint32</code> value(s) to it?</p>\n\n<p>For example, what should I replace <code>// ???</code> with:</p>\n\n<pre><code>s := []byte{0x00, 0x01, 0x02, 0x03}\n\nu := uint32(0x07060504)\n// ???\n\nfmt.Println(s)  // Should print [0 1 2 3 4 5 6 7]\n</code></pre>\n\n<p><strong>Edit:</strong> One option would be <code>s = append(s, byte(u)); s = append(s, byte(u &gt;&gt; 8)); s = append(s, byte(u &gt;&gt; 16)); s = append(s, byte(u &gt;&gt; 24))</code>, but is there a more idiomatic way to do this? Perhaps using <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow noreferrer\">package binary</a> and/or <a href=\"https://golang.org/pkg/bytes/\" rel=\"nofollow noreferrer\">package bytes</a>?</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1567481680, "post_id": 57763977, "comment_id": 101965039, "body": "Do not mock. Make such stuff an explicit dependency (e.g. a function argument) and provide a fake/stub during testing."}, {"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 1, "creation_date": 1567492375, "post_id": 57763977, "comment_id": 101967635, "body": "What is the mock even testing for? That a method that returns []T does indeed return []T?"}], "answers": [{"tags": [], "owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "is_accepted": false, "score": 0, "last_activity_date": 1567494181, "creation_date": 1567494181, "answer_id": 57766533, "question_id": 57763977, "link": "https://stackoverflow.com/questions/57763977/how-to-code-mock-for-method-in-another-package/57766533#57766533", "title": "How to code mock for method in another package", "body": "<p>So to do this, you need to be a little more abstract with you definition of the actual code, this allows you to replace the call to a third party module for testing.</p>\n\n<p>Something like below will allow you to swap out the dao function for a testing mock function that has the same signature. As soon as you define a hard type or function call you tie yourself that function/type permanently.</p>\n\n<pre><code>func GetArticleService(getArticleDao func(*sql.DB) (string), db *sql.DB) []util.Article {\n    var articles []util.Article\n\n    // this is the mock, at this point you can pass in a mock function for testing\n    results := getArticleDao(db)\n\n    article := util.Article{}\n    for results.Next() {\n        err := results.Scan(&amp;article.ID, &amp;article.UUID, &amp;article.TITLE, &amp;article.CONTENT)\n        if err != nil {\n            panic(err.Error())\n        } else {\n            articles = append(articles, article)\n        }\n    }\n    return articles\n} \n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 11964380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b67e002f405c9ae7c855284e914fe2?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v5", "link": "https://stackoverflow.com/users/11964380/jpskgc-v5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567494181, "creation_date": 1567473486, "question_id": 57763977, "link": "https://stackoverflow.com/questions/57763977/how-to-code-mock-for-method-in-another-package", "title": "How to code mock for method in another package", "body": "<p>I'm setting <code>service_test.go</code> for <code>service.go</code>.<br>\nIn <code>service.go</code>, method is called from <code>dao.go</code>.<br>\nSo I need to mock this dao method.<br>\nBut I'm not sure how to code this mock method.<br></p>\n\n<p>Here is the repository structure.<br></p>\n\n<pre><code>article\n  \u251c client\n  \u251c api\n  \u2502  \u251c main.go\n  \u2502  \u251c contoroller\n  \u2502  \u2502    \u2514 contoroller.go\n  \u2502  \u251c service\n  \u2502  \u2502    \u2514 service.go\n  \u2502  \u251c dao\n  \u2502  \u2502    \u2514 dao.go\n  \u2502  \u251c go.mod \n  \u2502  \u251c go.sum\n  \u2502  \u2514 Dockerfile\n  \u251c nginx\n  \u2514 docker-compose.yml\n</code></pre>\n\n<p>service.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func GetArticleService(db *sql.DB) []util.Article {\n    var articles []util.Article\n\n    // I want to mock dao.GetArticleDao(db) \n    results := dao.GetArticleDao(db)\n\n    article := util.Article{}\n    for results.Next() {\n        err := results.Scan(&amp;article.ID, &amp;article.UUID, &amp;article.TITLE, &amp;article.CONTENT)\n        if err != nil {\n            panic(err.Error())\n        } else {\n            articles = append(articles, article)\n        }\n    }\n    return articles\n}\n</code></pre>\n\n<p>service_test.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestGetArticleService(t *testing.T) {\n    //mock db\n    db, _, err := sqlmock.New()\n\n    if err != nil {\n        t.Fatalf(\"an error '%s' was not expected when opening a stub database connection\", err)\n    }\n\n    defer db.Close()\n\n    //make expected value\n    var expectedArticles []util.Article\n\n    expectedArticle1 := util.Article{\n        ID:      1,\n        UUID:    \"bea1b24d-0627-4ea0-aa2b-8af4c6c2a41c\",\n        TITLE:   \"test\",\n        CONTENT: \"test\",\n    }\n    expectedArticles = append(expectedArticles, expectedArticle1)\n\n    expectedArticle2 := util.Article{\n        ID:      2,\n        UUID:    \"844bc620-7336-41a3-9cb4-552a0024ff1c\",\n        TITLE:   \"test2\",\n        CONTENT: \"test2\",\n    }\n    expectedArticles = append(expectedArticles, expectedArticle2)\n\n    //check whether expected value and GetArticleService(db) is equal.\n    //Since GetArticleService(db) is executed, I want to mock dao.GetArticleDao(db)\n    assert.Equal(t, expectedArticles, GetArticleService(db))\n}\n</code></pre>\n\n<p>I want to mock <code>dao.GetArticleDao(db)</code> in <code>service.go</code> to pass test in <code>service_test.go</code>.<br>\nBut I'm not sure how to mock this code.<br></p>\n"}, {"tags": ["go", "gomock"], "comments": [{"owner": {"reputation": 85, "user_id": 5218121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b308136b453109457c54443dbc9fab7d?s=128&d=identicon&r=PG&f=1", "display_name": "big pigeon", "link": "https://stackoverflow.com/users/5218121/big-pigeon"}, "edited": false, "score": 0, "creation_date": 1567476846, "post_id": 57763839, "comment_id": 101964253, "body": "<code>mockProduct</code> and <code>&amp;mockProduct</code> is different type , you can convert it to json and try again"}], "answers": [{"comments": [{"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 1, "creation_date": 1567503381, "post_id": 57764868, "comment_id": 101973003, "body": "You should probably post the fixed code, preferably the <code>before</code> and <code>after</code> snippets so people can see what&#39;s changed."}], "tags": [], "owner": {"reputation": 191, "user_id": 3566647, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wVj86.jpg?s=128&g=1", "display_name": "freitas", "link": "https://stackoverflow.com/users/3566647/freitas"}, "is_accepted": false, "score": 0, "last_activity_date": 1567483083, "creation_date": 1567483083, "answer_id": 57764868, "question_id": 57763839, "link": "https://stackoverflow.com/questions/57763839/how-to-properly-test-a-controller-class-in-go/57764868#57764868", "title": "How to properly test a controller class in Go", "body": "<p>I solved with the help of @big pigeon.\nThe problem was that I had a time property that I didn't put at the first time, but after to make json marshal work I placed it again and I could see exactly the difference between \"Want\" and \"Got\" </p>\n"}], "owner": {"reputation": 191, "user_id": 3566647, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wVj86.jpg?s=128&g=1", "display_name": "freitas", "link": "https://stackoverflow.com/users/3566647/freitas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1095, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567483083, "creation_date": 1567471851, "last_edit_date": 1567482487, "question_id": 57763839, "link": "https://stackoverflow.com/questions/57763839/how-to-properly-test-a-controller-class-in-go", "title": "How to properly test a controller class in Go", "body": "<p>I'm using gomock to generate a business layer and mock it's methods results. So far, I can't get the test to pass, it is saying that \"want\" and \"got\" values are different</p>\n\n<p>I'm passing a json representation of my object to strings.NewReader and the \"Want\" is coming with a value \"is equal to { { ...\" that might be the problem.</p>\n\n<pre><code>\npackage product\n\nimport (\n    //...\n)\n\nvar (\n    productBody = `{\"seller\":{\"id\":\"Foo\"},\"sku\":\"kj1293lkxpto\",\"gtin\":\"7894949501280\",\"name\":\"Foo\",\"description\":\"Bar\",\"legacyInfo\":{\"id\":1021,\"digit\":4,\"line\":{\"id\":1,\"family\":{\"id\":3}},\"situation\":\"EC\"},\"ncm\":612522332,\"origin\":0,\"unit\":\"kg\",\"technicalDetails\":{\"volume\":{\"quantity\":1},\"weight\":0.56,\"height\":100,\"width\":172.96,\"length\":100},\"status\":{\"id\": 1,\"description\":\"active\"}}`\n        mockProduct  = model.Product{\n        Seller:      model.Seller{ID: \"Foo\"},\n        Sku:         \"kj1293lkxpto\",\n        Gtin:        \"7894949501280\",\n        Name:        \"Foo\",\n        Description: \"Bar\",\n        LegacyInfo: model.LegacyInfo{\n            ID:    1021,\n            Digit: 4,\n            Line: model.Line{\n                ID: 1,\n                Family: model.Family{\n                    ID: 3,\n                },\n            },\n            Situation: \"EC\",\n        },\n        Ncm:    612522332,\n        Origin: 0,\n        Unit:   \"kg\",\n        TechnicalDetails: model.TechnicalDetails{\n            Volume: model.Volume{\n                Quantity: 1,\n            },\n            Weight: 0.56,\n            Height: 100,\n            Width:  172.96,\n            Length: 100,\n        },\n        Status: model.Status{\n            ID:          1,\n            Description: \"active\",\n        },\n    }\n    e   *echo.Echo\n    c   echo.Context\n    req *http.Request\n    rec *httptest.ResponseRecorder\n)\n\nfunc TestCreate(t *testing.T) {\n    ctrl := gomock.NewController(t)\n    defer ctrl.Finish()\n\n    e = echo.New()\n    e.Validator = middlewares.NewCustomValidator()\n    rec = httptest.NewRecorder()\n    req = httptest.NewRequest(http.MethodPost, \"/v1/foo/bar\", strings.NewReader(productBody))\n    req.Header.Set(echo.HeaderContentType, echo.MIMEApplicationJSON)\n    c = e.NewContext(req, rec)\n\n    mockHandler := mock_product.NewMockIHandler(ctrl)\n\n    mockHandler.EXPECT().Save(mockProduct).Return(&amp;mockProduct, nil) // line 37\n\n    controller := NewController(mockHandler)\n\n    controller.Create(c)\n}\n\n// -- controller.go\npackage product\n\nimport (\n    //...\n)\n\nfunc NewController(handler IHandler) *Controller {\n    return &amp;Controller{handler}\n}\n\nfunc (c *Controller) Create(ctx echo.Context) error {\n// ...\n}\n\n// -- handler.go\n// service\npackage product\n\ntype IHandler interface {\n    Save(product *model.Product) (savedProduct *model.Product, err error)\n}\n\nfunc (h *Handler) Save(product *model.Product) (savedProduct *model.Product, err error) {\n//...\n}\n\n// -- product.go\npackage model\n\ntype Product struct {\n    ID               string           `json:\"id,omitempty\"`\n    Seller           Seller           `json:\"seller,omitempty\"  `\n    Sku              string           `json:\"sku,omitempty\"  `\n    Gtin             string           `json:\"gtin,omitempty\"`\n    Name             string           `json:\"name,omitempty\"`\n    Description      string           `json:\"description,omitempty\"`\n    LegacyInfo       LegacyInfo       `json:\"legacyInfo,omitempty\"`\n    Ncm              int64            `json:\"ncm,omitempty\"`\n    Origin           int              `json:\"origin,omitempty\"`\n    Unit             string           `json:\"unit,omitempty\"`\n    TechnicalDetails TechnicalDetails `json:\"technicalDetails,omitempty\"`\n    Status           Status           `json:\"status,omitempty\"`\n    CreatedAt        Date             `json:\"createdAt,omitempty\"`\n    UpdatedAt        Date             `json:\"updatedAt,omitempty\"`\n}```\n\n\nExpected call at /foo/bar/controller_test.go:37 doesn't match the argument at index 0.\n        Got: &amp;{ {Foo} kj1293lkxpto 7894949501280 Foo Bar {1021 4 {1 {3}} EC} 612522332 0 kg {{1} 0.56 100 172.96 100} {1 active} {&lt;nil&gt;} {&lt;nil&gt;}}\n        Want: is equal to { {Foo} kj1293lkxpto 7894949501280 Foo Bar {1021 4 {1 {3}} EC} 612522332 0 kg {{1} 0.56 100 172.96 100} {1 active} {&lt;nil&gt;} {&lt;nil&gt;}}\n</code></pre>\n\n<p><strong>Edit:</strong></p>\n\n<p>I did what @bigpigeon mentioned </p>\n\n<pre><code>    func TestCreate(t *testing.T) {\n        ctrl := gomock.NewController(t)\n        defer ctrl.Finish()\n\n        b, err := json.Marshal(&amp;mockProduct)\n        fmt.Println(err)\n        fmt.Println(string(b))\n\n        e = echo.New()\n        e.Validator = middlewares.NewCustomValidator()\n        rec = httptest.NewRecorder()\n        req = httptest.NewRequest(http.MethodPost, \"/v1/foo/bar\", strings.NewReader(string(b)))\n        req.Header.Set(echo.HeaderContentType, echo.MIMEApplicationJSON)\n        c = e.NewContext(req, rec)\n\n        mockHandler := mock_product.NewMockIHandler(ctrl)\n\n        mockHandler.EXPECT().Save(&amp;mockProduct).Return(&amp;mockProduct, nil)\n\n        controller := NewController(mockHandler)\n\n        controller.Create(c)\n    }\n\n    &lt;nil&gt;\n    {\"id\":\"123\",\"seller\":{\"id\":\"Foo\"},\"sku\":\"kj1293lkxpto\",\"gtin\":\"7894949501280\",\"name\":\"Foo\",\"description\":\"Bar\",\"legacyInfo\":{\"id\":1021,\"digit\":4,\"line\":{\"id\":1,\"family\":{\"id\":3}},\"situation\":\"EC\"},\"ncm\":612522332,\"unit\":\"kg\",\"technicalDetails\":{\"volume\":{\"quantity\":1},\"weight\":0.56,\"height\":100,\"width\":172.96,\"length\":100},\"status\":{\"id\":1,\"description\":\"active\"},\"createdAt\":\"03-09-2019 00:41:56\",\"updatedAt\":\"03-09-2019 00:41:56\"}\n    --- FAIL: TestCreate (0.00s)\n        /home/ivo/Workspaces/GoNew/deckard-writer/api/routes/product/controller.go:41: Unexpected call to *mock_product.MockIHandler.Save([0xc0003aa0f0]) at /home/ivo/Workspaces/GoNew/deckard-writer/api/routes/product/mock/handler.go:39 because: \n            Expected call at /home/ivo/Workspaces/GoNew/deckard-writer/api/routes/product/controller_test.go:43 doesn't match the argument at index 0.\n            Got: &amp;{123 {Foo} kj1293lkxpto 7894949501280 Foo Bar {1021 4 {1 {3}} EC} 612522332 0 kg {{1} 0.56 100 172.96 100} {1 active} {2019-09-03 00:41:56 +0000 UTC} {2019-09-03 00:41:56 +0000 UTC}}\n            Want: is equal to &amp;{123 {Foo} kj1293lkxpto 7894949501280 Foo Bar {1021 4 {1 {3}} EC} 612522332 0 kg {{1} 0.56 100 172.96 100} {1 active} {2019-09-03 00:41:56.733635373 -0300 -03 m=+0.003845944} {2019-09-03 00:41:56.733635557 -0300 -03 m=+0.003846109}}\n</code></pre>\n\n<p>Same result</p>\n"}, {"tags": ["arrays", "go", "go-map", "go-structtag"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1567469606, "post_id": 57763562, "comment_id": 101963148, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/50749869/\">How Do I Unmarshal Dynamic Viper or JSON keys as part of struct field in go</a>, <a href=\"https://stackoverflow.com/questions/15817720/\">golang struct for json with arbitrary keys</a>, ..."}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 3980896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625241486e658791bcec18323a6fac9e?s=128&d=identicon&r=PG&f=1", "display_name": "wzcwts521", "link": "https://stackoverflow.com/users/3980896/wzcwts521"}, "edited": false, "score": 0, "creation_date": 1567471568, "post_id": 57763674, "comment_id": 101963429, "body": "Thanks @Amit Kumar Gupta"}], "tags": [], "owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "is_accepted": true, "score": 0, "last_activity_date": 1567469546, "creation_date": 1567469546, "answer_id": 57763674, "question_id": 57763562, "link": "https://stackoverflow.com/questions/57763562/how-to-write-a-struct-with-nested-recursive-data-in-golang/57763674#57763674", "title": "How to write a struct with nested recursive data in golang", "body": "<p>You can do:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Autos struct {\n    Cars map[string][]string `json:\"cars\"`\n}\n</code></pre>\n\n<p>Here's a full working example, that prints \"coupe\":</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n)\n\ntype Autos struct {\n    Cars map[string][]string `json:\"cars\"`\n}\n\nfunc main() {\n    x := `{\n    \"cars\": {\n        \"toyota\": [\n            \"sedan\",\n            \"pickup\"\n        ],\n        \"honda\": [\n            \"sedan\",\n            \"coupe\",\n            \"pickup\"\n        ]\n    }\n}`\n\n    var a Autos\n    err := json.Unmarshal([]byte(x), &amp;a)\n    if err != nil {\n        panic(err)\n    }\n    println(a.Cars[\"honda\"][1])\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/2MRkOFvyiks\" rel=\"nofollow noreferrer\">Playground link</a></p>\n"}], "owner": {"reputation": 15, "user_id": 3980896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625241486e658791bcec18323a6fac9e?s=128&d=identicon&r=PG&f=1", "display_name": "wzcwts521", "link": "https://stackoverflow.com/users/3980896/wzcwts521"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 57763674, "answer_count": 1, "score": 0, "last_activity_date": 1567469546, "creation_date": 1567467857, "question_id": 57763562, "link": "https://stackoverflow.com/questions/57763562/how-to-write-a-struct-with-nested-recursive-data-in-golang", "title": "How to write a struct with nested recursive data in golang", "body": "<p>I have data like following</p>\n\n<pre><code>{\n    \"cars\": {\n        \"toyota\": [\n            \"sedan\",\n            \"pickup\"\n        ],\n        \"honda\": [\n            \"sedan\",\n            \"couple\",\n            \"pickup\"\n        ]\n                ....\n    }\n}\n</code></pre>\n\n<p>The list might continue grow. I am trying to find out a proper struct to server the data and return to A http responsewriter.  </p>\n\n<p>the struct that I had. </p>\n\n<pre><code>type Autos struct {\n    Cars struct {\n        Toyota []string `json:\"toyota\"`\n        Honda  []string `json:\"honda\"`\n    } `json:\"cars\"`\n}\n</code></pre>\n\n<p>But the above struct has predefined \"Toyota\" \"Honda\"</p>\n\n<p>I am looking for a way to only use one or two struct to represent the data structure. Thanks in advance.</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1567468382, "post_id": 57763537, "comment_id": 101962952, "body": "<code>-exclude-checks arraySyntax,phpdocLint</code> &lt;--- these are 2 arguments, while you&#39;re passing them as a single string. <code>[]string{&quot;-exclude-checks&quot;, &quot;arraySyntax,phpdocLint&quot;}</code>. And you don&#39;t need to <code>strings.Join</code> them after: arguments is a collection of strings and should be treated as such."}], "answers": [{"tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": true, "score": 2, "last_activity_date": 1615233205, "last_edit_date": 1615233205, "creation_date": 1567494845, "answer_id": 57766699, "question_id": 57763537, "link": "https://stackoverflow.com/questions/57763537/go-use-of-exec-command-on-windows-for-noverify/57766699#57766699", "title": "Go use of exec.Command on windows for noverify", "body": "<p>There are multiple options to pass arguments to exec.Command:</p>\n<p>You can use multiple strings as arguments:</p>\n<pre><code>cmd := exec.Command(&quot;your-command&quot;, &quot;arg1&quot;, &quot;arg2&quot;)\n</code></pre>\n<p>If you have a slice of arguments, you can use the spread operator</p>\n<pre><code>args := []string{&quot;-exclude-checks&quot;, &quot;arraySyntax,phpdocLint&quot;, &quot;-output&quot;, &quot;result.txt&quot;, &quot;your-path&quot;}\ncmd := exec.Command(&quot;your-command&quot;, args...)\n</code></pre>\n<p>To question two: In your code</p>\n<pre><code>options := &quot; -exclude-checks arraySyntax, PHPDoc&quot;\npathToCode := &quot;C:\\\\Dev\\\\PHP\\\\ResourceSpace_9_0_13357\\\\include&quot;\n    \nargs := []string{options, pathToCode}\n</code></pre>\n<p>you're passing two options to the external program.\nIf you wrote the same on the command line, you pass</p>\n<pre><code>your-command.exe &quot; -exclude-checks arraySyntax, PHPDoc&quot; &quot;your-path&quot;\n</code></pre>\n<p>This doesn't work, and is also the reason your program doesn't work.</p>\n<p>In short, wherever you put a space between in a command, you need to have a separate argument to <code>exec.Command</code>. The <a href=\"https://godoc.org/os/exec#Command\" rel=\"nofollow noreferrer\">example</a> also does this.</p>\n"}], "owner": {"reputation": 4622, "user_id": 819887, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c5756945e574ccc4a9bc52f3c8094ad7?s=128&d=identicon&r=PG&f=1", "display_name": "surfmuggle", "link": "https://stackoverflow.com/users/819887/surfmuggle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 57766699, "answer_count": 1, "score": 1, "last_activity_date": 1615233205, "creation_date": 1567467440, "last_edit_date": 1592644375, "question_id": 57763537, "link": "https://stackoverflow.com/questions/57763537/go-use-of-exec-command-on-windows-for-noverify", "title": "Go use of exec.Command on windows for noverify", "body": "<p>I want to use VKCOM/<a href=\"https://github.com/VKCOM/noverify\" rel=\"nofollow noreferrer\">noverify</a> to analyse code. Calling it from the command-line (windows dos shell) using this command works</p>\n<pre><code> noverify.exe -exclude-checks arraySyntax,phpdocLint \n              -output result.txt \n              C:\\Dev\\PHP\\ResourceSpace_9_0_13357\\include\n</code></pre>\n<p>The trouble is that i am unable to pass arguments to <code>cmnd := exec.Command(&quot;noverify.exe&quot;, args)</code></p>\n<pre><code>options := &quot; -exclude-checks arraySyntax, PHPDoc&quot;\npathToCode := &quot;C:\\\\Dev\\\\PHP\\\\ResourceSpace_9_0_13357\\\\include&quot;\n\n// this works\ncmnd := exec.Command(&quot;noverify.exe&quot;, pathToCode)\n\n\nargs := []string{options, pathToCode}\narg := strings.Join(args, &quot;&quot;)\n// passing options does not work\n// cmnd := exec.Command(&quot;noverify.exe&quot;, arg)    \n\nb, err := cmnd.CombinedOutput()\n</code></pre>\n<h3>What have i tried</h3>\n<p>You can find <a href=\"https://gist.github.com/surfmuggle/0c197b8ae8e231d4fdf4a879a60a186d\" rel=\"nofollow noreferrer\">my source code in this gist</a> It seems that args are joined as a string seperated by <code>,</code> despite that the separator is empty above.</p>\n<h3>Questions</h3>\n<ol>\n<li>How to pass multiple arguments to <code>exec.Comman(&quot;yourFoo.exe&quot;, cmdArgs...)</code></li>\n<li>Why is my attempt not working on windows?</li>\n</ol>\n"}, {"tags": ["go", "ssl"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1567468998, "post_id": 57763465, "comment_id": 101963046, "body": "<code>openssl s_client -showcerts -connect some-site.xyz:443</code> and ensure it&#39;s the right certificate with the right CA."}, {"owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 0, "creation_date": 1567469770, "post_id": 57763465, "comment_id": 101963174, "body": "set the tls.Config ServerName field to match the CN you expect of the other side.  That is how &quot;sni&quot; support is done with this library as well."}, {"owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 1, "creation_date": 1567470070, "post_id": 57763465, "comment_id": 101963213, "body": "and add ClientCAs.  RootCAs and ClientCAs both need to be set.  Once you get it all right (including ServerName), you can turn off InsecureSkipVerify.  Note that you usually have 3 files (cert, key, trust).  But it really should be 4: (cert, rootcas, key, clientcas).  The cert chain of your own cert may be totally different from the one you trust as client.  ie: server has LetsEncrypt, clients are issued by your company."}], "owner": {"reputation": 348, "user_id": 6910169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c2f3f323a362d69f822fe001b1afbe1?s=128&d=identicon&r=PG&f=1", "display_name": "TomasJ", "link": "https://stackoverflow.com/users/6910169/tomasj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 614, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1567468905, "creation_date": 1567466581, "last_edit_date": 1567468905, "question_id": 57763465, "link": "https://stackoverflow.com/questions/57763465/go-code-how-to-connect-a-self-signed-cert-ssl-site-without-insecureskipverify", "title": "Go code how to connect a self signed cert SSL site without InsecureSkipVerify?", "body": "<p>in a project I need to program in Go code to connect a https site which is deployed with a self-signed TLS certs; I am provided the server certs files: (the <code>ca.cert</code> <code>ca.key</code>, <code>client.cert</code> <code>client.key</code> <code>client.csr</code> and server configured with <code>server.cert</code> <code>server.key</code> <code>server.csr</code>);</p>\n\n<p>I have figured out the following code indeed works</p>\n\n<pre><code>cert, err := tls.LoadX509KeyPair(\"./client.crt\", \"./client.key\")\n// if err != nil { ... }\n\nrootCAs := x509.NewCertPool()\ncerts, err := ioutil.ReadFile(\"./ca.crt\")\n// if err != nil { ... }\n// Append our cert to the system pool\nif ok := rootCAs.AppendCertsFromPEM(certs); !ok { ... }\nconfig := tls.Config{\n    Certificates: []tls.Certificate{cert},\n    InsecureSkipVerify: true,\n    ServerName: \"ingress.local\",\n    RootCAs:    rootCAs,\n}\nconn, err := tls.Dial(\"tcp\", \"some-site.xyz:443\", &amp;config)\nif err != nil {\n    if x509err, ok := err.(x509.UnknownAuthorityError); ok {\n        fmt.Printf(\"unknown rootCert: %#v\\n\", x509err.Cert)\n    }\n    log.Fatalf(\"client: dial: %#v\\n\\t%+v\", err, err)\n}\n\ntr := &amp;http.Transport{TLSClientConfig: &amp;config}\nclient := &amp;http.Client{Transport: tr}\n\n// Uses local self-signed cert\nreq, err := http.NewRequest(http.MethodGet, \"https://some-site.xyz\", nil)\nif err != nil {\n    log.Fatalf(\"client: http new request: %#v\", err, err)\n}\n</code></pre>\n\n<p>now the question is: if I don't set the <code>InsecureSkipVerify: true</code> in tls.Config, the code failed with errors:\n1. if not set <code>ServerName</code> correctly, it's <code>x509.HostnameError</code>\n    this service is running with a k8s ingress, and I figured out the correct hostname is <code>ingress.local</code>\n2. even if I set <code>ServerName</code> correctly, it now failed with <code>x509.UnknownAuthorityError</code></p>\n\n<p>The other way I've tried is to not loading <code>ca.cert</code> at all, only 1 line of <code>InsecureSkipVerify: true</code> can make all of this working, and only required files are the <code>client.cert</code> <code>client.key</code></p>\n\n<p>if I set only the <code>InsecureSkipVerify: true</code> without loading the client certs, that results an <code>400 Bad Request No required SSL certificate was sent</code> proved that server side is configured with requiring the client certs;</p>\n\n<pre><code>cert, err := tls.LoadX509KeyPair(\"./client.crt\", \"./client.key\")\nconfig := tls.Config{\n    Certificates: []tls.Certificate{cert},\n    InsecureSkipVerify: true,\n}\n// same tls.Dial or http.NewRequest works well ...\n</code></pre>\n\n<p>I want to try the best effort to avoid setting <code>InsecureSkipVerify: true</code> wonder is there any way possible to make it working without <code>InsecureSkipVerify: true</code>?   Is the way above of loading <code>ca.cert</code> into a CertPool has anything wrong?  the provided files include <code>ca.key</code> and <code>*.csr</code> files as well, but from all online existing TLS connection go code samples I don't see where can they be useful ?</p>\n\n<p>If there's no way to make it working without <code>InsecureSkipVerify: true</code>, then is it still meaningful to load the <code>ca.cert</code> ?</p>\n\n<p><strong>Update one more thing</strong>:   I've tried with <code>curl --cacert ./ca.crt --cert ./client.crt --key client.key https://some-site.xyz -k</code> got same with above Go code, that is together with <code>-k</code> (<code>--insecure</code>) it works, with cacert or without; but without <code>-k</code> it got similar errors:</p>\n\n<pre><code>* successfully set certificate verify locations:\n*   CAfile: ./ca.crt\n  CApath: /etc/ssl/certs\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\n* TLSv1.3 (IN), TLS handshake, Server hello (2):\n* TLSv1.2 (IN), TLS handshake, Certificate (11):\n* TLSv1.2 (OUT), TLS alert, unknown CA (560):\n* SSL certificate problem: unable to get local issuer certificate\n* Closing connection 0\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1567461495, "post_id": 57762778, "comment_id": 101961855, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/50749869/\">How Do I Unmarshal Dynamic Viper or JSON keys as part of struct field in go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 9063497, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-vs5DWZ9wuFk/AAAAAAAAAAI/AAAAAAAAARI/I2LlVcbGy3E/photo.jpg?sz=128", "display_name": "Johnny Bonelli", "link": "https://stackoverflow.com/users/9063497/johnny-bonelli"}, "edited": false, "score": 0, "creation_date": 1567459700, "post_id": 57762800, "comment_id": 101961483, "body": "Thank you very much.  ! That was exactly what I was looking for. Didn&#39;t know unmarshal() smart enough to map key to object.  Very nice solution"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 4, "last_activity_date": 1567459356, "creation_date": 1567459356, "answer_id": 57762800, "question_id": 57762778, "link": "https://stackoverflow.com/questions/57762778/unmarshal-same-json-object-with-different-key-to-go-slice-struct/57762800#57762800", "title": "Unmarshal same json object with different key to go slice struct", "body": "<p>Try this:</p>\n\n<pre><code>type Test struct {\n    Stats map[string]HostStatus `json:\"stats\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 9063497, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-vs5DWZ9wuFk/AAAAAAAAAAI/AAAAAAAAARI/I2LlVcbGy3E/photo.jpg?sz=128", "display_name": "Johnny Bonelli", "link": "https://stackoverflow.com/users/9063497/johnny-bonelli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 57762800, "answer_count": 1, "score": 3, "last_activity_date": 1567459491, "creation_date": 1567459178, "last_edit_date": 1567459491, "question_id": 57762778, "link": "https://stackoverflow.com/questions/57762778/unmarshal-same-json-object-with-different-key-to-go-slice-struct", "title": "Unmarshal same json object with different key to go slice struct", "body": "<p>I can't figure out how I can serialize the same JSON object with a different key to Go slice struct without re-writing entire parser. \nFor example, JSON that I can receive back, it might contain N number object with a different key (localhost1/localhost2/localhost3, etc). In this example, I have a key localhost1/localhost2/localhost3, and each has only one field ok.</p>\n\n<pre><code>{\n\"stats\": {\n        \"localhost1\": {\n            \"ok\": 1\n        },\n        \"localhost2\": {\n            \"ok\": 1\n        },\n        \"localhost3\": {\n            \"ok\": 1\n        }\n     }\n}\n</code></pre>\n\n<p>I can Unmarsh entire JSON by using the following Structs mappings.</p>\n\n<pre><code>type HostStatus struct {\n        Ok int `json:\"ok\"`\n}\n\ntype Test struct {\n    Stats struct {\n        Localhost1 HostStatus `json:\"localhost1\"`\n        Localhost2 HostStatus `json:\"localhost2\"`\n        Localhost3 HostStatus `json:\"localhost3\"`\n    }  `json:\"stats\"`\n}\n</code></pre>\n\n<p>Entire Example.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\ntype HostStatus struct {\n        Ok int `json:\"ok\"`\n}\n\ntype Test struct {\n    Stats struct {\n        Localhost1 HostStatus `json:\"localhost1\"`\n        Localhost2 HostStatus `json:\"localhost2\"`\n        Localhost3 HostStatus `json:\"localhost3\"`\n    }  `json:\"stats\"`\n}\n\n\nfunc main() {\n    var resp = []byte(`{\n        \"stats\": {\n            \"localhost1\": {\n            \"ok\": 1\n        },\n        \"localhost2\": {\n            \"ok\": 1\n        },\n        \"localhost3\": {\n            \"ok\": 1\n        }\n        }\n    }`)\n\n    var r Test\n    er := json.Unmarshal(resp, &amp;r)\n    if er != nil {\n        panic(er)\n    } else {\n        fmt.Println(r)\n    }\n}\n</code></pre>\n\n<p>The main issue in this solution that it requires hardcode inside a Stats struct each HostStatus that maps 1:1 to JSON output via json:xxx tag. \nBut I want to find a way to map all this object to a HostStatus slice/array\nsince I don't know how many HostStatus objects I might receive back and what is the key for each.</p>\n\n<p>For example something like</p>\n\n<pre><code>type Test struct {\n    Stats struct {\n        LocalHostList []HostStatus `json:\"localhost[0-9]\"`\n    }  `json:\"stats\"`\n}\n</code></pre>\n\n<p>and use something like localhost[0-9] -- i.e regex semantics that will give a hit to JSON package.</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1567454820, "post_id": 57762069, "comment_id": 101960342, "body": "Related / possible duplicate: <a href=\"https://stackoverflow.com/questions/46112679/golang-code-to-repeat-an-html-code-n-times/46112802#46112802\">Golang code to repeat an html code n times</a>"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1567454744, "creation_date": 1567454744, "answer_id": 57762184, "question_id": 57762069, "link": "https://stackoverflow.com/questions/57762069/how-to-iterate-over-a-range-of-numbers-in-golang-template/57762184#57762184", "title": "How to iterate over a range of numbers in golang template?", "body": "<p>The template package does not support this directly.  Create a template function that returns a slice of the integer values:</p>\n\n<pre><code>var funcs = template.FuncMap{\n    \"intRange\": func(start, end int) []int {\n        n := end - start + 1\n        result := make([]int, n)\n        for i := 0; i &lt; n; i++ {\n            result[i] = start + i\n        }\n        return result\n    },\n}\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>t := template.Must(template.New(\"\").Funcs(funcs).Parse(`{{range $y := intRange .minYear .maxYear}}\n   &lt;option value=\"y\"&gt; {{$y}}&lt;/option&gt;{{end}}`))\n\nerr := t.Execute(os.Stdout, map[string]int{\"minYear\": 1961, \"maxYear\": 1981})\nif err != nil {\n    // handle error\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/F--35BjV9LZ\" rel=\"nofollow noreferrer\">Run it on the Go playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1567454939, "creation_date": 1567454939, "answer_id": 57762219, "question_id": 57762069, "link": "https://stackoverflow.com/questions/57762069/how-to-iterate-over-a-range-of-numbers-in-golang-template/57762219#57762219", "title": "How to iterate over a range of numbers in golang template?", "body": "<p>You can use the sprig library in your templates:</p>\n\n<p><a href=\"https://github.com/Masterminds/sprig\" rel=\"nofollow noreferrer\">https://github.com/Masterminds/sprig</a></p>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1643, "favorite_count": 0, "accepted_answer_id": 57762184, "answer_count": 2, "score": 0, "last_activity_date": 1567454939, "creation_date": 1567454071, "question_id": 57762069, "link": "https://stackoverflow.com/questions/57762069/how-to-iterate-over-a-range-of-numbers-in-golang-template", "title": "How to iterate over a range of numbers in golang template?", "body": "<p>I'd like to do something like this:</p>\n\n<pre><code>  {{range $y := .minYear    .maxYear}}                                                                                                \n      &lt;option value=\"y\"&gt; {{$y}}&lt;/option&gt;                                                                                                \n  {{end}}\n</code></pre>\n\n<p>But the template is not rendered as expected. How can I fix this?</p>\n"}, {"tags": ["email", "go"], "comments": [{"owner": {"reputation": 568, "user_id": 8545455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83e3f3b9695712c0e752d3e68be30d37?s=128&d=identicon&r=PG", "display_name": "steve", "link": "https://stackoverflow.com/users/8545455/steve"}, "edited": false, "score": 0, "creation_date": 1567440081, "post_id": 57759885, "comment_id": 101955840, "body": "I just realised the last five lines could be condensed down to a single <code>return</code>."}], "owner": {"reputation": 568, "user_id": 8545455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83e3f3b9695712c0e752d3e68be30d37?s=128&d=identicon&r=PG", "display_name": "steve", "link": "https://stackoverflow.com/users/8545455/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1567439927, "creation_date": 1567439927, "question_id": 57759885, "link": "https://stackoverflow.com/questions/57759885/sending-email-onward-that-was-parsed-using-golang-net-mail-readmessage", "title": "Sending email onward that was parsed using Golang net/mail.ReadMessage", "body": "<p>I'm looking for the cleanest way in Golang to transfer a message through (i.e. act as an SMTP proxy) while performing some manipulation on the message body html (e.g. adding an open tracking pixel - not yet coded).</p>\n\n<p>The net/mail package includes a method <a href=\"https://golang.org/pkg/net/mail/#ReadMessage\" rel=\"nofollow noreferrer\">ReadMessage</a> that parses mail headers into a map, and gives you an <code>io.Reader</code> for the body. This is necessary to determine the MIME parts of the body for processing, rather than just <code>io.Copy</code>ing them through. (the simple stub version of this function, shown in the block comment, does just that).</p>\n\n<p>The following function copies an incoming mail \"src\" to an outgoing mail stream \"dest\". (The calling code sets these up as DotReader and DotWriter which takes care of most of the \"dot\" processing needed for <a href=\"https://tools.ietf.org/html/rfc5321#section-4.5.2\" rel=\"nofollow noreferrer\">RFC5321</a>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Processing of email body via IO stream functions\npackage main\n\nimport (\n    \"bufio\"\n    \"io\"\n    \"log\"\n    \"net/mail\"\n    \"strings\"\n)\n\n/* If you just want to pass through the entire mail headers and body, you can just use\n   the following alernative:\n\nfunc MailCopy(dst io.Writer, src io.Reader) (int64, error) {\n    return io.Copy(dst, src)\n}\n*/\n\n// MailCopy transfers the mail body from downstream (client) to upstream (server)\n// The writer will be closed by the parent function, no need to close it here.\nfunc MailCopy(dst io.Writer, src io.Reader) (int64, error) {\n    var totalWritten int64\n    const smtpCRLF = \"\\r\\n\"\n    message, err := mail.ReadMessage(bufio.NewReader(src))\n    if err != nil {\n        return totalWritten, err\n    }\n    // Pass through headers. The m.Header map does not preserve order, but that should not matter.\n    for hdrType, hdrList := range message.Header {\n        for _, hdrVal := range hdrList {\n            hdrLine := hdrType + \": \" + hdrVal + smtpCRLF\n            log.Print(\"\\t\", hdrLine)\n            bytesWritten, err := dst.Write([]byte(hdrLine))\n            totalWritten += int64(bytesWritten)\n            if err != nil {\n                return totalWritten, err\n            }\n        }\n    }\n    // Blank line denotes end of headers\n    bytesWritten, err := io.Copy(dst, strings.NewReader(smtpCRLF))\n    totalWritten += int64(bytesWritten)\n    if err != nil {\n        return totalWritten, err\n    }\n\n    // Copy the body\n    bytesWritten, err = io.Copy(dst, message.Body)\n    totalWritten += int64(bytesWritten)\n    if err != nil {\n        return totalWritten, err\n    }\n    return totalWritten, err\n}\n</code></pre>\n\n<p>It does seem necessary to build this, because there is no <code>net/mail.WriteMessage()</code> method.</p>\n\n<ul>\n<li>the header order is always randomised by Golang's map functionality. This seems harmless in my tests</li>\n<li>A forced CRLF needs to be put in between the end of the headers and the body, as per RFCs. DotWriter takes care of the terminating dot.</li>\n</ul>\n\n<p>The function shown above works, I was wondering if there is a better way to do this?</p>\n"}, {"tags": ["html", "forms", "go"], "comments": [{"owner": {"reputation": 1956, "user_id": 4429015, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vqxqf.png?s=128&g=1", "display_name": "B001\u16e6", "link": "https://stackoverflow.com/users/4429015/b001%e1%9b%a6"}, "edited": false, "score": 0, "creation_date": 1567435605, "post_id": 57758878, "comment_id": 101953976, "body": "Have you tried to change <code>first_name</code> to <code>first_name[]</code> ?"}, {"owner": {"reputation": 793711, "user_id": 19068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2d3229ed1961d2bd81853242493247?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/19068/quentin"}, "reply_to_user": {"reputation": 1956, "user_id": 4429015, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vqxqf.png?s=128&g=1", "display_name": "B001\u16e6", "link": "https://stackoverflow.com/users/4429015/b001%e1%9b%a6"}, "edited": false, "score": 0, "creation_date": 1567437990, "post_id": 57758878, "comment_id": 101955025, "body": "@B001\u16e6 \u2014 Unless they are using a parser which cares about PHP-style syntax (and they indicated they have not) all that does is make the name more complicated (to the point where characters in it need encoding)."}, {"owner": {"reputation": 1956, "user_id": 4429015, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vqxqf.png?s=128&g=1", "display_name": "B001\u16e6", "link": "https://stackoverflow.com/users/4429015/b001%e1%9b%a6"}, "reply_to_user": {"reputation": 793711, "user_id": 19068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2d3229ed1961d2bd81853242493247?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/19068/quentin"}, "edited": false, "score": 0, "creation_date": 1567500707, "post_id": 57758878, "comment_id": 101971550, "body": "@Quentin yes you are right,. Thank you for clarifying"}], "answers": [{"tags": [], "owner": {"reputation": 793711, "user_id": 19068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2d3229ed1961d2bd81853242493247?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/19068/quentin"}, "is_accepted": true, "score": 2, "last_activity_date": 1567437937, "creation_date": 1567437937, "answer_id": 57759474, "question_id": 57758878, "link": "https://stackoverflow.com/questions/57758878/form-input-value-query-string-order/57759474#57759474", "title": "Form input value query string order", "body": "<blockquote>\n  <p>I guess that the parameter ordering in the query string is the same as the elements appear within the html... nevertheless, I am not sure if this is always the case.</p>\n</blockquote>\n\n<p>It is.</p>\n\n<blockquote>\n  <p>Because the query string is essentially a key/value map, ordering should not matter...</p>\n</blockquote>\n\n<p>It isn't \u2026 although you <em>can</em> treat it like one.</p>\n\n<blockquote>\n  <p>Are there some better strategies to avoid relying on the order of the query string parameters? </p>\n</blockquote>\n\n<p>Depending on the order is perfectly fine. </p>\n\n<blockquote>\n  <p>Array notation on the name seems to be one way that is used for PHP but I would like to have a more generic way (not using PHP on the server)...</p>\n</blockquote>\n\n<p>That's another acceptable solution. There are libraries which implement PHP-style query parsing available for other languages.</p>\n\n<hr>\n\n<p>You could also encode the data using JSON \u2026 but then you need to add client-side JavaScript as a dependancy. </p>\n"}], "owner": {"reputation": 501, "user_id": 1055685, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9624267f295b85a65db099e0686af950?s=128&d=identicon&r=PG", "display_name": "JoeFrizz", "link": "https://stackoverflow.com/users/1055685/joefrizz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 57759474, "answer_count": 1, "score": 1, "last_activity_date": 1567437937, "creation_date": 1567435371, "question_id": 57758878, "link": "https://stackoverflow.com/questions/57758878/form-input-value-query-string-order", "title": "Form input value query string order", "body": "<p>It is OK to have form inputs with the same name:</p>\n\n<pre><code>&lt;form&gt;\n    &lt;input type=\"text\" name=\"email\"&gt;\n    &lt;input type=\"text\" name=\"email\"&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>A GET action on the form produces the following query string: \n...?email=&amp;email=</p>\n\n<p>Because emails exist for their own, thats fine.</p>\n\n<p>Now, if there is data that belongs together (like to the same person):</p>\n\n<pre><code>&lt;form&gt;\n    &lt;input type=\"text\" name=\"first_name\"&gt;\n    &lt;input type=\"text\" name=\"last_name\"&gt;\n\n    &lt;input type=\"text\" name=\"first_name\"&gt;\n    &lt;input type=\"text\" name=\"last_name\"&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>The following query string is generated:\n...?first_name=&amp;last_name=&amp;first_name=&amp;last_name=</p>\n\n<p>I guess that the parameter ordering in the query string is the same as the elements appear within the html... nevertheless, I am not sure if this is always the case.</p>\n\n<p>Because the query string is essentially a key/value map, ordering should not matter...</p>\n\n<p>I could add an index to each name but that would require to known the last index everytime I would add a new pair on the client.</p>\n\n<p>Ideally I would like to avoid having to add an index by myself to keep the structure more dynamic.</p>\n\n<p>Are there some better strategies to avoid relying on the order of the query string parameters? Array notation on the name seems to be one way that is used for PHP but I would like to have a more generic way (not using PHP on the server)...</p>\n"}, {"tags": ["go", "kubernetes", "continuous-integration", "circleci"], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 5780931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f711d215bc724f92859caf2b23b1544b?s=128&d=identicon&r=PG&f=1", "display_name": "Julius", "link": "https://stackoverflow.com/users/5780931/julius"}, "is_accepted": false, "score": 2, "last_activity_date": 1567433059, "creation_date": 1567433059, "answer_id": 57758327, "question_id": 57757892, "link": "https://stackoverflow.com/questions/57757892/communication-between-the-application-and-the-server-in-the-same-network/57758327#57758327", "title": "Communication between the application and the server in the same network", "body": "<p>Since Kubernetes is natively Go, I think this could be achieved easily with a Golang solution. This is a list of some of the things worthy of research time that I can think about out of the box are, assuming that you are running your solution as a Kubernetes service:</p>\n\n<ol>\n<li>Research about Kubernetes operators. An operator will help you extend Kubernetes functionality easily. <a href=\"https://github.com/operator-framework/getting-started\" rel=\"nofollow noreferrer\">https://github.com/operator-framework/getting-started</a></li>\n<li>Raft. Raft is a consensus algorithm designed to be easily understandable. This can be used to achieve things like leader election in case you come across the need to implement one. <a href=\"https://raft.github.io/\" rel=\"nofollow noreferrer\">https://raft.github.io/</a></li>\n<li>Golang has native SSH libraries so this should make your idea of using SSH very feasible. I, however, think there could be alternatives like using RPC for communications between the master and slaves as I can imagine it could be a nightmare to manage different certificates to authenticate the master against the slaves.</li>\n</ol>\n"}], "owner": {"reputation": 324, "user_id": 2707342, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/327199ff5e10c9a7a0f18f83e2138d03?s=128&d=identicon&r=PG&f=1", "display_name": "Harith", "link": "https://stackoverflow.com/users/2707342/harith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "closed_date": 1567466576, "answer_count": 1, "score": -2, "last_activity_date": 1568183988, "creation_date": 1567431232, "last_edit_date": 1568183988, "question_id": 57757892, "link": "https://stackoverflow.com/questions/57757892/communication-between-the-application-and-the-server-in-the-same-network", "closed_reason": "Needs more focus", "title": "Communication between the application and the server in the same network", "body": "<p>I am in the process of developing a CI/CD tool that would be running on kubernetes. The application would be responsible for creating a <strong>k8s job object</strong> which would be treated as a <strong>slave</strong> in order to run a pipeline.</p>\n\n<p>The image, the slave would be running is entirely up to the user, so I do not have any control over it except for the fact that it would be running in the same local network as the CI/CD application.</p>\n\n<p>My question is; in this scenario, how can I make communication possible between the CI/CD tool and the slave?</p>\n\n<p>To add more context to this, I want to create something similar to Jenkins. Jenkins, together with kubernetes plugin, runs on kubernetes and creates pods which are treated as slaves(agents) in order to run a pipeline. The image which would be running in the slave is entirely up to the user. The slaves have a JNLP as a side-car container which is used to establish the connection. How can I achieve the same architecture in golang or python?</p>\n\n<p><strong>What have I done so far?</strong></p>\n\n<p>I have tried researching on this and came across that Jenkins uses sockets to establish a connection. But, in order to use sockets I have to have sockets on both sides; on the server-side and as well as on the client-side. As far as I know, Jenkins uses the image that I, as the user, gave it to use in the slave, and it does <strong>NOT</strong> have server-side socket. So how is it able to establish the connection?</p>\n"}, {"tags": ["go", "generated-code"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1567432575, "post_id": 57757242, "comment_id": 101952630, "body": "What kind of templates do you have? And what kind of code is generated?"}, {"owner": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1567432929, "post_id": 57757242, "comment_id": 101952786, "body": "it&#39;s a workaround for generics: the code that is being generated is valid &amp; compilable go, and templates are go codes that have some variables that would be replaced with several struct names"}], "answers": [{"comments": [{"owner": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "edited": false, "score": 0, "creation_date": 1567433355, "post_id": 57758337, "comment_id": 101952971, "body": "thanks for the first hint! about checking the timestamp or version, yes I know that this approach would work, but is there any switch or any ready tool that I can use? or should I write it myself?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "edited": false, "score": 0, "creation_date": 1567436130, "post_id": 57758337, "comment_id": 101954220, "body": "@sazart None that I know of."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1567433118, "creation_date": 1567433118, "answer_id": 57758337, "question_id": 57757242, "link": "https://stackoverflow.com/questions/57757242/how-to-run-go-generate-only-for-changed-templates/57758337#57758337", "title": "How to run go generate only for changed templates?", "body": "<p>First, you don't need that bash script that looks for <code>go:generate</code> in files, the <code>go</code> tool itself can do that for you. Just use</p>\n\n<pre><code>go generate ./...\n</code></pre>\n\n<p>to recurse in subfolders.</p>\n\n<p>Next, when a code generation runs, I would store the template file's last modification timestamp in the generated code, either in a comment or in a const / var. The app that is run by <code>go generate</code> could first check if the template's last mod time is newer that the stored one in the code, and only proceed if so.</p>\n\n<p>This file last mod time should be enough. But if for some reason you can't rely on it, the template could have a \"version\", which should be incremented when the template is changed. And have the generator \"transfer\" this version into the final code, which can be used to check if the template is newer than the code generated from it.</p>\n"}], "owner": {"reputation": 696, "user_id": 663036, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea9054b55f2caadc7e126bdd0ade4d1b?s=128&d=identicon&r=PG", "display_name": "sazary", "link": "https://stackoverflow.com/users/663036/sazary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 250, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1567433118, "creation_date": 1567428601, "question_id": 57757242, "link": "https://stackoverflow.com/questions/57757242/how-to-run-go-generate-only-for-changed-templates", "title": "How to run go generate only for changed templates?", "body": "<p>We use some code templates in our repo, and we rely on <code>go:generate</code> to generate all the needed codes from these templates.<br>\nBecause there are several templates and from each template we generate several actual codes, consistency of generated codes has become an issue: we needed a command to run and be sure that all generated codes are up to date with their corresponding templates. To do this, we have a simple bash command that find all files that have <code>go:generate</code> in them, and runs <code>go generate</code> in their directory.<br>\nThe problem is that this approach is really slow: most of the templates have not changed, so there is no need to generate their codes again.<br>\nIs there any way to tell <code>go generate</code> to only run if the template is newer than the file? Or, is there any better approach other than this?<br>\nThank you very much.</p>\n"}, {"tags": ["go", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 1210, "user_id": 2111053, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/c8ba83ffd4f4d9a0f448df0a9e9d5958?s=128&d=identicon&r=PG", "display_name": "Luc DUZAN", "link": "https://stackoverflow.com/users/2111053/luc-duzan"}, "is_accepted": true, "score": 0, "last_activity_date": 1567427664, "creation_date": 1567427664, "answer_id": 57757038, "question_id": 57757037, "link": "https://stackoverflow.com/questions/57757037/how-to-fix-gomod-github-com-stretchrcom-testifyv1-4-0-parsing-go-mod-unexpe/57757038#57757038", "title": "How to fix gomod: `github.com/stretchrcom/testify@v1.4.0: parsing go.mod: unexpected module path &quot;github.com/stretchr/testify&quot;`", "body": "<p>This error is due a package referring to testify before it was moved to <code>github.com/stretchr/testify</code>.</p>\n\n<p>The solution is to add the following line in your <code>go.mod</code>:</p>\n\n<p><code>replace github.com/stretchrcom/testify v1.4.0 =&gt; github.com/stretchr/testify v1.4.0</code></p>\n"}, {"tags": [], "owner": {"reputation": 166, "user_id": 11904651, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WUMVN-fvfNk/AAAAAAAAAAI/AAAAAAAAAOY/j_7iNZcBCGU/photo.jpg?sz=128", "display_name": "Ankush Chadha", "link": "https://stackoverflow.com/users/11904651/ankush-chadha"}, "is_accepted": false, "score": 0, "last_activity_date": 1570669627, "creation_date": 1570669627, "answer_id": 58314090, "question_id": 57757037, "link": "https://stackoverflow.com/questions/57757037/how-to-fix-gomod-github-com-stretchrcom-testifyv1-4-0-parsing-go-mod-unexpe/58314090#58314090", "title": "How to fix gomod: `github.com/stretchrcom/testify@v1.4.0: parsing go.mod: unexpected module path &quot;github.com/stretchr/testify&quot;`", "body": "<p>If this is a direct dependency, then would suggest adding the correct dependency directly to your <code>go.mod</code> file i.e. <a href=\"https://search.gocenter.io/github.com~2Fstretchr~2Ftestify/info?version=v1.4.0\" rel=\"nofollow noreferrer\">github.com/stretchr/testify v1.4.0</a></p>\n"}], "owner": {"reputation": 1210, "user_id": 2111053, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/c8ba83ffd4f4d9a0f448df0a9e9d5958?s=128&d=identicon&r=PG", "display_name": "Luc DUZAN", "link": "https://stackoverflow.com/users/2111053/luc-duzan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 57757038, "answer_count": 2, "score": 0, "last_activity_date": 1570669627, "creation_date": 1567427664, "question_id": 57757037, "link": "https://stackoverflow.com/questions/57757037/how-to-fix-gomod-github-com-stretchrcom-testifyv1-4-0-parsing-go-mod-unexpe", "title": "How to fix gomod: `github.com/stretchrcom/testify@v1.4.0: parsing go.mod: unexpected module path &quot;github.com/stretchr/testify&quot;`", "body": "<p>When I do a <code>go mod tidy</code>.\nI got the following error:</p>\n\n<pre><code>go: github.com/stretchrcom/testify@v1.4.0: parsing go.mod: unexpected module path \"github.com/stretchr/testify\"\n</code></pre>\n"}, {"tags": ["sql", "go", "orm", "model", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "is_accepted": false, "score": 2, "last_activity_date": 1568781541, "last_edit_date": 1568781541, "creation_date": 1568781211, "answer_id": 57985139, "question_id": 57756727, "link": "https://stackoverflow.com/questions/57756727/how-to-query-data-with-m2m-condition/57985139#57985139", "title": "how to query data with m2m condition", "body": "<p>I think documentation of GORM is written very well. You can find answer is here \n<a href=\"http://gorm.io/docs/many_to_many.html\" rel=\"nofollow noreferrer\">http://gorm.io/docs/many_to_many.html</a>\nOr you can do like this </p>\n\n<pre><code>db.Tabel(\"topic\").Select(\"*\").Where(\"id IN (SELECT topic_id from topic_categories where category_id IN (select id from category where name ILIKE '%?%'))\",\"tech\")\n</code></pre>\n"}], "owner": {"reputation": 860, "user_id": 2672481, "user_type": "registered", "accept_rate": 59, "profile_image": "https://graph.facebook.com/1424393836/picture?type=large", "display_name": "Tony Wang", "link": "https://stackoverflow.com/users/2672481/tony-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1569974309, "creation_date": 1567426209, "last_edit_date": 1569974309, "question_id": 57756727, "link": "https://stackoverflow.com/questions/57756727/how-to-query-data-with-m2m-condition", "title": "how to query data with m2m condition", "body": "<p>Here is the two model with manytomany relationship. Right now I want to query the topic by category name. I know I could achieve this by raw sql like <code>select * from topic where id IN (SELECT topic_id from topic_categories where category_id IN (select id from category where name ILIKE '%tech%'));</code></p>\n\n<p>The question is, how to do this with gorm in a higher performance and more readable way.</p>\n\n<pre><code>type Category struct {\n  Name string\n}\n\ntype Topic struct {\n  Name string\n  Categories []*Category `gorm:\"manytomany;topic_categories\"`\n}\n</code></pre>\n"}, {"tags": ["go", "release", "goreleaser"], "answers": [{"comments": [{"owner": {"reputation": 1265, "user_id": 1894196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa5fd3405808cc6a9fe4b126b1ec39bd?s=128&d=identicon&r=PG", "display_name": "GianArb", "link": "https://stackoverflow.com/users/1894196/gianarb"}, "edited": false, "score": 0, "creation_date": 1567492461, "post_id": 57760234, "comment_id": 101967671, "body": "Hello! Thanks a lot. At the end this is the command I will use:"}], "tags": [], "owner": {"reputation": 18043, "user_id": 405013, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ef3cd04888c6d17f34d43e29ec3d46f?s=128&d=identicon&r=PG", "display_name": "caarlos0", "link": "https://stackoverflow.com/users/405013/caarlos0"}, "is_accepted": true, "score": 1, "last_activity_date": 1567441832, "creation_date": 1567441832, "answer_id": 57760234, "question_id": 57756096, "link": "https://stackoverflow.com/questions/57756096/goreleaser-to-only-generate-the-changelog-on-github/57760234#57760234", "title": "goreleaser to only generate the changelog on GitHub", "body": "<p>Right now it isn't.</p>\n\n<p>However, you can generate the changelog using <code>git</code>:</p>\n\n<pre><code>git log --pretty=oneline --abbrev-commit --no-decorate --no-color tags/v1.0.0..tags/v1.1.0\n</code></pre>\n\n<p>This is pretty much what GoReleaser does underneath.</p>\n"}, {"tags": [], "owner": {"reputation": 1265, "user_id": 1894196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa5fd3405808cc6a9fe4b126b1ec39bd?s=128&d=identicon&r=PG", "display_name": "GianArb", "link": "https://stackoverflow.com/users/1894196/gianarb"}, "is_accepted": false, "score": 2, "last_activity_date": 1567492496, "creation_date": 1567492496, "answer_id": 57766171, "question_id": 57756096, "link": "https://stackoverflow.com/questions/57756096/goreleaser-to-only-generate-the-changelog-on-github/57766171#57766171", "title": "goreleaser to only generate the changelog on GitHub", "body": "<p>Thanks a lot. At the end this is the command I will use:</p>\n\n<pre><code>git log $(git describe --abbrev=0)...$(git describe --abbrev=0 $(git describe --abbrev=0 --tags)^) --pretty=format:'* [%s](\"http://github.com/testcontainers/testcontainers-go/commit/%H\")' --reverse\n</code></pre>\n"}], "owner": {"reputation": 1265, "user_id": 1894196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa5fd3405808cc6a9fe4b126b1ec39bd?s=128&d=identicon&r=PG", "display_name": "GianArb", "link": "https://stackoverflow.com/users/1894196/gianarb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 57760234, "answer_count": 2, "score": 0, "last_activity_date": 1567492496, "creation_date": 1567423441, "last_edit_date": 1567441847, "question_id": 57756096, "link": "https://stackoverflow.com/questions/57756096/goreleaser-to-only-generate-the-changelog-on-github", "title": "goreleaser to only generate the changelog on GitHub", "body": "<p>I am the current maintainer for the testcontainers-go project\n<a href=\"https://github.com/testcontainers/testcontainers-go\" rel=\"nofollow noreferrer\">https://github.com/testcontainers/testcontainers-go</a> .</p>\n\n<p>This project is a library. It does not produce any binary or docker image. I would still like to use goreleaser and the GitHub Action to automate the release process.</p>\n\n<p>I had a look around but I am not able to find the right configuration to only run goreleaser to generate the changelog. </p>\n\n<p>Do you have any suggestion?\nThanks a lot</p>\n"}, {"tags": ["google-app-engine", "go", "port"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1567417919, "creation_date": 1567417919, "answer_id": 57754824, "question_id": 57754695, "link": "https://stackoverflow.com/questions/57754695/why-app-engine-ignore-port-env-variable-in-app-yaml/57754824#57754824", "title": "Why app engine ignore PORT env variable in app.yaml", "body": "<p>The <code>PORT</code> environment variable will be set by the AppEngine platform, you do not have to set it in your <code>app.yaml</code> config file. In fact, you can't even override it.</p>\n\n<p>See the <a href=\"https://cloud.google.com/appengine/docs/standard/go111/runtime#environment_variables\" rel=\"nofollow noreferrer\">list of environment variables set by the runtime</a>.</p>\n\n<p>So just use the <code>PORT</code> env var as you do in your Go code, but remove it from your <code>app.yaml</code> config. You just have to start a non-HTTPS web server, the platform will provide HTTPS support for you.</p>\n"}], "owner": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 591, "favorite_count": 0, "accepted_answer_id": 57754824, "answer_count": 1, "score": 1, "last_activity_date": 1567417919, "creation_date": 1567417387, "question_id": 57754695, "link": "https://stackoverflow.com/questions/57754695/why-app-engine-ignore-port-env-variable-in-app-yaml", "title": "Why app engine ignore PORT env variable in app.yaml", "body": "<p>I am trying to migrate from Go 1.9 to Go 1.11. I copied the main function from <a href=\"https://cloud.google.com/appengine/docs/standard/go111/go-differences#importing-appengine-sdk\" rel=\"nofollow noreferrer\">the migration document</a></p>\n\n<p>This is my app.yaml</p>\n\n<pre><code>runtime: go111\nenv: standard\ninstance_class: F1\nhandlers:\n  - url: /.*\n    script: auto\n    secure: always\n    redirect_http_response_code: '301'\n  - url: .*\n    script: auto\nenv_variables:\n  PORT: '443'\n</code></pre>\n\n<p>This is my main function</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/demo\", demoHandler)\n\n    port := os.Getenv(\"PORT\")\n    if port == \"\" {\n            port = \"443\"\n            syslog.Printf(\"Defaulting to port %s\", port)\n    }\n\n    syslog.Printf(\"Listening on port %s\", port)\n    syslog.Fatal(http.ListenAndServe(fmt.Sprintf(\":%s\", port), nil))\n}\n</code></pre>\n\n<p>My application needs to run on port 443 with HTTPS. However, after deployment, the application doesn't respond. I checked the logs, and it says \"Listening on port 8081\". I don't understand why it takes 8081 instead of 443. Where is this 8081 from?</p>\n\n<p>If I hardcode the main function to use port 443. It gives me this in the logs \"App is listening on port 443, it should instead listen on the port defined by the PORT environment variable. As a consequence, nginx cannot be started. Performance may be degraded. Please listen on the port defined by the PORT environment variable.\"</p>\n\n<p>What do I miss here?</p>\n"}, {"tags": ["go", "libvirt"], "answers": [{"tags": [], "owner": {"reputation": 1802, "user_id": 7126113, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffadd47897c7708095d65a6813375dfa?s=128&d=identicon&r=PG&f=1", "display_name": "DanielB", "link": "https://stackoverflow.com/users/7126113/danielb"}, "is_accepted": true, "score": 1, "last_activity_date": 1567421225, "creation_date": 1567421225, "answer_id": 57755603, "question_id": 57754525, "link": "https://stackoverflow.com/questions/57754525/libvirt-go-start-domain/57755603#57755603", "title": "Libvirt-go start domain", "body": "<p>You need to use the <a href=\"https://godoc.org/github.com/libvirt/libvirt-go#Domain.Create\" rel=\"nofollow noreferrer\"><code>Create</code></a> method on the <code>Domain</code> object that is returned from <code>DomainDefineXMLFlags</code>. For example</p>\n\n<pre><code>dom, err := v.conn.DomainDefineXMLFlags(domainXml, libvirt.DOMAIN_DEFINE_VALIDATE)\nif err != nil {\n    return err\n}\nerr = dom.Create()\nif err != nil {\n    return err\n}\n</code></pre>\n"}], "owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 345, "favorite_count": 0, "accepted_answer_id": 57755603, "answer_count": 1, "score": 0, "last_activity_date": 1567421225, "creation_date": 1567416602, "last_edit_date": 1567417687, "question_id": 57754525, "link": "https://stackoverflow.com/questions/57754525/libvirt-go-start-domain", "title": "Libvirt-go start domain", "body": "<p>When I defining new domain</p>\n\n<pre><code>_, err = v.conn.DomainDefineXMLFlags(domainXml, libvirt.DOMAIN_DEFINE_VALIDATE)\n</code></pre>\n\n<p>xml looks like:</p>\n\n<pre><code>&lt;domain type='kvm'&gt;\n    &lt;name&gt;{{.name}}&lt;/name&gt;\n    &lt;memory unit='KiB'&gt;{{.memory}}&lt;/memory&gt;\n    &lt;currentMemory unit='KiB'&gt;{{.current_memory}}&lt;/currentMemory&gt;\n    &lt;vcpu&gt;{{.count_cpu}}&lt;/vcpu&gt;\n    &lt;os&gt;\n    &lt;type arch='x86_64' machine='pc-i440fx-disco'&gt;hvm&lt;/type&gt;\n    &lt;boot dev='hd'/&gt;\n    &lt;/os&gt;\n    &lt;clock offset='utc'/&gt;\n    &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;\n    &lt;on_reboot&gt;restart&lt;/on_reboot&gt;\n    &lt;on_crash&gt;destroy&lt;/on_crash&gt;\n    &lt;devices&gt;\n    &lt;emulator&gt;/usr/bin/kvm-spice&lt;/emulator&gt;\n    &lt;disk type='block' device='disk'&gt;\n        &lt;driver name='qemu' type='raw' cache='none'/&gt;\n        &lt;source dev='{{.lvm_path}}'/&gt;\n        &lt;target dev='vda' bus='virtio'/&gt;\n    &lt;/disk&gt;\n    &lt;disk type='file' device='cdrom'&gt;\n        &lt;driver name='qemu' type='raw'/&gt;\n        &lt;source file='{{.config_file}}'/&gt;\n        &lt;target dev='sda' bus='sata'/&gt;\n        &lt;readonly/&gt;\n        &lt;address type='drive' controller='0' bus='0' target='0' unit='0'/&gt;\n    &lt;/disk&gt;\n    &lt;interface type='bridge'&gt;\n      &lt;source bridge='virbr0'/&gt;\n      &lt;model type='virtio'/&gt;\n      &lt;mac address='{{.mac_address}}'/&gt;\n    &lt;/interface&gt;\n    &lt;serial type='pty'&gt;\n      &lt;target port='0'/&gt;\n    &lt;/serial&gt;\n    &lt;console type='pty'&gt;\n      &lt;target type='serial' port='0'/&gt;\n    &lt;/console&gt;\n    &lt;/devices&gt;\n&lt;/domain&gt;\n</code></pre>\n\n<p>go-libvirt makes a new <code>persistent domain</code>.  But this domain is shutted down.</p>\n\n<pre><code>$ virsh list --all\n Id   Name         State\n---------------------------\n -    new_domain   shut off\n</code></pre>\n\n<p>In source code <a href=\"https://github.com/libvirt/libvirt-go/blob/master/domain.go\" rel=\"nofollow noreferrer\">https://github.com/libvirt/libvirt-go/blob/master/domain.go</a> I didn't find solutions how can I run this domain with golang ?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 7840239, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XPob-zSZmsM/AAAAAAAAAAI/AAAAAAAAAMI/r7RZjRzQeuk/photo.jpg?sz=128", "display_name": "Kadimon", "link": "https://stackoverflow.com/users/7840239/kadimon"}, "edited": false, "score": 0, "creation_date": 1567417892, "post_id": 57754639, "comment_id": 101946126, "body": "Thanks! But I would like to have more control than setting a single proxy for the whole collector. I tried to do as advised here <a href=\"https://github.com/gocolly/colly/issues/110\" rel=\"nofollow noreferrer\">github.com/gocolly/colly/issues/110</a>"}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "reply_to_user": {"reputation": 17, "user_id": 7840239, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XPob-zSZmsM/AAAAAAAAAAI/AAAAAAAAAMI/r7RZjRzQeuk/photo.jpg?sz=128", "display_name": "Kadimon", "link": "https://stackoverflow.com/users/7840239/kadimon"}, "edited": false, "score": 0, "creation_date": 1567418205, "post_id": 57754639, "comment_id": 101946281, "body": "Please let us know if this worked. If it works I&#39;d appreciate that you mark the answer as accepted. And if it didn&#39;t I should remove my post."}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "reply_to_user": {"reputation": 17, "user_id": 7840239, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XPob-zSZmsM/AAAAAAAAAAI/AAAAAAAAAMI/r7RZjRzQeuk/photo.jpg?sz=128", "display_name": "Kadimon", "link": "https://stackoverflow.com/users/7840239/kadimon"}, "edited": false, "score": 0, "creation_date": 1567419141, "post_id": 57754639, "comment_id": 101946679, "body": "Not sure what you mean by &quot;more control&quot;, but you can set a function to decide how you want to set the proxy on a per request basis with <code>(c *Collector) SetProxyFunc(p ProxyFunc)</code>. It just relies on http.Transport.Proxy."}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "reply_to_user": {"reputation": 17, "user_id": 7840239, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XPob-zSZmsM/AAAAAAAAAAI/AAAAAAAAAMI/r7RZjRzQeuk/photo.jpg?sz=128", "display_name": "Kadimon", "link": "https://stackoverflow.com/users/7840239/kadimon"}, "edited": false, "score": 0, "creation_date": 1567419762, "post_id": 57754639, "comment_id": 101946955, "body": "Well, my last comment is actually what is already suggested on your link, I should have read :)"}, {"owner": {"reputation": 17, "user_id": 7840239, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XPob-zSZmsM/AAAAAAAAAAI/AAAAAAAAAMI/r7RZjRzQeuk/photo.jpg?sz=128", "display_name": "Kadimon", "link": "https://stackoverflow.com/users/7840239/kadimon"}, "edited": false, "score": 0, "creation_date": 1567423522, "post_id": 57754639, "comment_id": 101948591, "body": "It turns out that <code>Request.ProxyURL = .. </code> does not establish a proxy for the request. And it makes it possible to find out through which proxy the request passed."}, {"owner": {"reputation": 17, "user_id": 7840239, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XPob-zSZmsM/AAAAAAAAAAI/AAAAAAAAAMI/r7RZjRzQeuk/photo.jpg?sz=128", "display_name": "Kadimon", "link": "https://stackoverflow.com/users/7840239/kadimon"}, "edited": false, "score": 0, "creation_date": 1567426643, "post_id": 57754639, "comment_id": 101949993, "body": "after using <code>c.SetProxyFunc (proxy.RoundRobinProxySwitcher (...))</code> Do proxies automatically change on every request?"}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "reply_to_user": {"reputation": 17, "user_id": 7840239, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XPob-zSZmsM/AAAAAAAAAAI/AAAAAAAAAMI/r7RZjRzQeuk/photo.jpg?sz=128", "display_name": "Kadimon", "link": "https://stackoverflow.com/users/7840239/kadimon"}, "edited": false, "score": 0, "creation_date": 1567476661, "post_id": 57754639, "comment_id": 101964227, "body": "I think <code>proxy.RoundRobinProxySwitcher</code> is just a way to load-balance on different proxies."}], "tags": [], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "is_accepted": true, "score": 0, "last_activity_date": 1567417121, "creation_date": 1567417121, "answer_id": 57754639, "question_id": 57754483, "link": "https://stackoverflow.com/questions/57754483/gocolly-set-proxy-for-every-request/57754639#57754639", "title": "GoColly set proxy for every request", "body": "<p>Instead of setting <code>ProxyURL</code> in the callback function, have you tried setting it on the collector ?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// SetProxy sets a proxy for the collector. This method overrides the previously\n// used http.Transport if the type of the transport is not http.RoundTripper.\n// The proxy type is determined by the URL scheme. \"http\"\n// and \"socks5\" are supported. If the scheme is empty,\n// \"http\" is assumed.\nfunc (c *Collector) SetProxy(proxyURL string) error {\n    proxyParsed, err := url.Parse(proxyURL)\n    if err != nil {\n        return err\n    }\n\n    c.SetProxyFunc(http.ProxyURL(proxyParsed))\n\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 7840239, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XPob-zSZmsM/AAAAAAAAAAI/AAAAAAAAAMI/r7RZjRzQeuk/photo.jpg?sz=128", "display_name": "Kadimon", "link": "https://stackoverflow.com/users/7840239/kadimon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 598, "favorite_count": 0, "accepted_answer_id": 57754639, "answer_count": 1, "score": 1, "last_activity_date": 1567417121, "creation_date": 1567416380, "question_id": 57754483, "link": "https://stackoverflow.com/questions/57754483/gocolly-set-proxy-for-every-request", "title": "GoColly set proxy for every request", "body": "<p>I started to deal with Colly.\nI am trying to set a proxy for every request. But all requests do not go through a proxy</p>\n\n<p>It should work\n<a href=\"https://github.com/gocolly/colly/blob/master/request.go#L52\" rel=\"nofollow noreferrer\">https://github.com/gocolly/colly/blob/master/request.go#L52</a></p>\n\n<p>I have added this to my code. But requests go without a proxy as before</p>\n\n<pre><code>c.OnRequest(func(r *colly.Request) { \n  r.ProxyURL = \"...\" \n}\n</code></pre>\n\n<p>Maybe I didn\u2019t understand correctly how this should work</p>\n"}, {"tags": ["xml", "go", "struct", "tags"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1567415190, "post_id": 57753853, "comment_id": 101944943, "body": "Just take a look at the documentation of package encoding/json and encoding/xml and red the parts about the tags, e.g. <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Marshal</a> . Is there any mention of multiple json keys? No. So: No. Always consult the official documentation first. BTW: How should that work? If you marshal such a struct: which json key should be used? And if you unmarshal a json with name and FirstName fields: How would that work?"}, {"owner": {"reputation": 842, "user_id": 11689413, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EcaHDCMriwk/AAAAAAAAAAI/AAAAAAAAADQ/zIFt2d5E2rU/photo.jpg?sz=128", "display_name": "Muhammad Abdul Raheem", "link": "https://stackoverflow.com/users/11689413/muhammad-abdul-raheem"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1567415526, "post_id": 57753853, "comment_id": 101945089, "body": "There wasn&#39;t a mention in the documentation. That is why I asked here. What would be the need of asking then? I was just hoping to handle multiple keys in a single parameter, because in my case i will either get &quot;date&quot; or &quot;pubDate&quot; and I just need to decode them. In case of marshaling and unmarshaling, I guess prioritization is required."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1567417223, "post_id": 57753853, "comment_id": 101945815, "body": "Exactly: There is no mention of multiple json keys so multiple json keys are not supported. There are generally no hidden features which happen to be undocumented."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1567417368, "post_id": 57753853, "comment_id": 101945892, "body": "If the JSON you have to unmarshal is inconsistent: Unmarshal into a struct with <i>two</i> fields mapped: &quot;date&quot; and &quot;pubDate&quot; (maybe both pointer types). Then consolidate in your code into one field you are going to use. This solution is dead simple, requires less than 10 lines of code, is clear and does not do some kind of magic."}, {"owner": {"reputation": 842, "user_id": 11689413, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EcaHDCMriwk/AAAAAAAAAAI/AAAAAAAAADQ/zIFt2d5E2rU/photo.jpg?sz=128", "display_name": "Muhammad Abdul Raheem", "link": "https://stackoverflow.com/users/11689413/muhammad-abdul-raheem"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1567418793, "post_id": 57753853, "comment_id": 101946544, "body": "Yes, I am currently using that solution. But as I said before, in my case those two fields will never coexist, so I was trying to find a way to handle both of them in a single parameter. But as you explained, it would cause other problems in the logic."}], "answers": [{"tags": [], "owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "is_accepted": true, "score": 2, "last_activity_date": 1567414725, "creation_date": 1567414725, "answer_id": 57754092, "question_id": 57753853, "link": "https://stackoverflow.com/questions/57753853/is-it-possible-to-use-multiple-tag-values-for-a-single-tag-like-in-the-code/57754092#57754092", "title": "Is it possible to use multiple tag values for a single tag like in the code", "body": "<p>I am going to say no not in this way.</p>\n\n<p>you can do this,</p>\n\n<pre><code>type XMLStruct struct {\n    Name    string  `json:\"name\" xml:\"name\"`\n    Date    string  `json:\"Date\" xml:\"Date\"`\n}\n</code></pre>\n\n<p>or this, </p>\n\n<pre><code>type XMLStruct struct {\n    Name        string  `json:\"name, omitempty\" xml:\"name, omitempty\"`\n    Date        string  `json:\"Date, omitempty\" xml:\"Date, omitempty\"`\n    FirstName   string  `json:\"FirstName, omitempty\" xml:\"FirstName, omitempty\"`\n}\n</code></pre>\n\n<p>But I don't believe that you can map multiple json names to one struct field and I think that the reason for this would be is what if they both existed in the json structure, which one do you retain and throw away etc.</p>\n"}, {"tags": [], "owner": {"reputation": 74, "user_id": 4168347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/405ce2625dc1c079a1864ff313430455?s=128&d=identicon&r=PG&f=1", "display_name": "TND", "link": "https://stackoverflow.com/users/4168347/tnd"}, "is_accepted": false, "score": 0, "last_activity_date": 1567418831, "creation_date": 1567418831, "answer_id": 57755055, "question_id": 57753853, "link": "https://stackoverflow.com/questions/57753853/is-it-possible-to-use-multiple-tag-values-for-a-single-tag-like-in-the-code/57755055#57755055", "title": "Is it possible to use multiple tag values for a single tag like in the code", "body": "<p>If you have the same key in key:\"value\" pair, struct tag look up will only use the first value you specific.</p>\n\n<p>So, Your struct will look like</p>\n\n<pre><code>type XMLStruct struct {\n    Name    string  `json:\"name\"`\n    Date    string  `xml:\"Date\"`\n}\n</code></pre>\n\n<p>You can read some information in reflect package <a href=\"https://golang.org/pkg/reflect/#StructTag\" rel=\"nofollow noreferrer\">StructTag</a></p>\n"}, {"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 0, "last_activity_date": 1567436978, "last_edit_date": 1567436978, "creation_date": 1567430535, "answer_id": 57757739, "question_id": 57753853, "link": "https://stackoverflow.com/questions/57753853/is-it-possible-to-use-multiple-tag-values-for-a-single-tag-like-in-the-code/57757739#57757739", "title": "Is it possible to use multiple tag values for a single tag like in the code", "body": "<p>The field tag of a go-struct can literally have any UTF-8 sequence. This is legal go-code:</p>\n\n<pre><code>type XMLStruct struct {\n    Name string `g1bb3ri$h...T@g`\n}\n</code></pre>\n\n<p>So tags are up for interpretation. The <code>json</code> package in the standard library expects tags in a particular format - which maps a single struct field to a single JSON attribute.</p>\n\n<p>If you wanted to support multiple attributes for a single field - one could write their own Marshal/Unmarshal and act on this new tag format. But as some of the other comments/answers have suggested, there is the dilemma of handling conflicts.</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1567451766, "creation_date": 1567451766, "answer_id": 57761760, "question_id": 57753853, "link": "https://stackoverflow.com/questions/57753853/is-it-possible-to-use-multiple-tag-values-for-a-single-tag-like-in-the-code/57761760#57761760", "title": "Is it possible to use multiple tag values for a single tag like in the code", "body": "<p>There's no definitive answer to this. Struct tags, at the language spec level, are arbitrary text, with no inherent meaning. See <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">the spec</a>. This means that, from a language standpoint, <code>json:\"name\" json:\"FirstName\"</code> is a valid tag, as is any other arbitrary text.</p>\n\n<p>What matters is how code interprets the tags. Since you're talking about the <code>json</code> tag, you probably care about the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>encoding/json</code></a> package in the standard library. How this package interprets tags is described in the documentation <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">here</a>. A duplicate tag like this would, at best, be ambiguous, so one could say it's not supported. Although using such a tag will do <em>something</em>. What it does may or may not align with what you expect (depending on what you expect).</p>\n\n<p>But there can be other packages that interpret <code>json</code> tags--possibly including one you write yourself. And they can use whatever rules they want, including either permitting or prohibiting multiple tag segments with the same name.</p>\n"}], "owner": {"reputation": 842, "user_id": 11689413, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EcaHDCMriwk/AAAAAAAAAAI/AAAAAAAAADQ/zIFt2d5E2rU/photo.jpg?sz=128", "display_name": "Muhammad Abdul Raheem", "link": "https://stackoverflow.com/users/11689413/muhammad-abdul-raheem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1244, "favorite_count": 0, "accepted_answer_id": 57754092, "answer_count": 4, "score": 1, "last_activity_date": 1567451766, "creation_date": 1567413702, "last_edit_date": 1567451452, "question_id": 57753853, "link": "https://stackoverflow.com/questions/57753853/is-it-possible-to-use-multiple-tag-values-for-a-single-tag-like-in-the-code", "title": "Is it possible to use multiple tag values for a single tag like in the code", "body": "<pre><code>type XMLStruct struct {\n    Name    string  `json:\"name\" json:\"FirstName\"`\n    Date    string  `xml:\"Date\" xml:\"pudDate\"`\n}\n</code></pre>\n"}, {"tags": ["go", "command-line-interface"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1567442798, "post_id": 57753022, "comment_id": 101956785, "body": "No, there is not.  A workaround is to define a flag containing flags for for the <code>git diff</code> command.  See the <code>go build</code> flags <code>-gcflags</code>, <code>-asmflags</code>, etc. as an example.  Another workaround is to pass <code>git diff</code> flags after <code>--</code> so they are handled as arguments."}, {"owner": {"reputation": 4007, "user_id": 996592, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3261f0896f6a8cd7f09af5cc8d10c71c?s=128&d=identicon&r=PG", "display_name": "Fabian Tamp", "link": "https://stackoverflow.com/users/996592/fabian-tamp"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567446945, "post_id": 57753022, "comment_id": 101958064, "body": "Thanks @CeriseLim&#243;n! Hadn&#39;t thought of the <code>--</code> option; that could work well."}], "answers": [{"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1567451923, "post_id": 57753177, "comment_id": 101959557, "body": "Shouldn&#39;t &quot;answers&quot; like this be a Q comment?"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 1, "last_activity_date": 1567410481, "creation_date": 1567410481, "answer_id": 57753177, "question_id": 57753022, "link": "https://stackoverflow.com/questions/57753022/is-there-a-way-of-catching-all-unrecognised-command-line-flags-using-gos-flag/57753177#57753177", "title": "Is there a way of catching all unrecognised command line flags using Go&#39;s `flag` package?", "body": "<blockquote>\n  <p>[I]s there a way of parsing flags that also allows collection of unrecognised flags, short of copying one of these implementations and modifying it?</p>\n</blockquote>\n\n<p>No.</p>\n"}], "owner": {"reputation": 4007, "user_id": 996592, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3261f0896f6a8cd7f09af5cc8d10c71c?s=128&d=identicon&r=PG", "display_name": "Fabian Tamp", "link": "https://stackoverflow.com/users/996592/fabian-tamp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 57753177, "answer_count": 1, "score": 1, "last_activity_date": 1567410481, "creation_date": 1567409783, "question_id": 57753022, "link": "https://stackoverflow.com/questions/57753022/is-there-a-way-of-catching-all-unrecognised-command-line-flags-using-gos-flag", "title": "Is there a way of catching all unrecognised command line flags using Go&#39;s `flag` package?", "body": "<p>I'm currently writing a wrapper around <code>git diff</code>, and it would be nice if any flag that wasn't immediately relevant to my program would be passed through to <code>git diff</code>. So for example:</p>\n\n<ul>\n<li>Running <code>my-tool</code> eventually runs <code>git diff</code></li>\n<li>Running <code>my-tool --dir</code> eventually runs <code>git diff --dir</code></li>\n</ul>\n\n<p>I'm using the <a href=\"https://golang.org/pkg/flag/\" rel=\"nofollow noreferrer\"><code>flag</code></a> package for parsing command line flags, however, and it looks like there's no option to collect unrecognised flags. I've also investigated the <a href=\"https://godoc.org/github.com/spf13/pflag\" rel=\"nofollow noreferrer\"><code>pflag</code></a> package, which has the <a href=\"https://godoc.org/github.com/spf13/pflag#ParseErrorsWhitelist\" rel=\"nofollow noreferrer\">ability to keep running when encountering an unknown flag</a>, but doesn't appear to offer a way to collect these unrecognised flags.</p>\n\n<p>My question is -- is there a way of parsing flags that also allows collection of unrecognised flags, short of copying one of these implementations and modifying it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9, "user_id": 9911619, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QJqSH.png?s=128&g=1", "display_name": "Jackie Tao", "link": "https://stackoverflow.com/users/9911619/jackie-tao"}, "edited": false, "score": 0, "creation_date": 1567408926, "post_id": 57752610, "comment_id": 101942424, "body": "After reading context source code, I think the reason is that ctx.Done channel close after the second goroutine executes. So the process prints two date string."}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1567409985, "post_id": 57752610, "comment_id": 101942824, "body": "The first go routine fires and waits for cancellation. Once the signal is received, two things happen; the waiting go routine prints the time and a new one is created which also prints since the context was already cancelled. I don&#39;t see why you would expect only one time print."}, {"owner": {"reputation": 9, "user_id": 9911619, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QJqSH.png?s=128&g=1", "display_name": "Jackie Tao", "link": "https://stackoverflow.com/users/9911619/jackie-tao"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1567423553, "post_id": 57752610, "comment_id": 101948604, "body": "Before, i think <code>ctx.Done</code>, which returns a channel, will cause that the first go routine which listens on it gets something. So, after calling <code>cancel()</code>, the ctx would emit <code>Done</code> signal with value, and the first go routine prints date string, meanwhile the value of <code>ctx.Done</code> would be set empty. Eventually, the second go routine cannot get signal from <code>ctx.Done</code> because the channel of  <code>ctx.Done</code> is empty, and the second go routine prints nothing."}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 9911619, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QJqSH.png?s=128&g=1", "display_name": "Jackie Tao", "link": "https://stackoverflow.com/users/9911619/jackie-tao"}, "edited": false, "score": 0, "creation_date": 1567425009, "post_id": 57753077, "comment_id": 101949205, "body": "It&#39;s my mistakes. After close channel, the go routines which listen on it would get default value from channel, not blocked."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1567410023, "creation_date": 1567410023, "answer_id": 57753077, "question_id": 57752610, "link": "https://stackoverflow.com/questions/57752610/why-context-context-signal-affects-new-goroutine/57753077#57753077", "title": "why context.Context signal affects new goroutine?", "body": "<p>After <code>cancel()</code> your <code>ctx</code> is done and stays done forever. So when you call <code>go printDate(ctx)</code> a second time you call printDate with a done Context and the case can run becasue ctx.Done() returns a closed channel and you can receive from a closed channel.</p>\n"}], "owner": {"reputation": 9, "user_id": 9911619, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QJqSH.png?s=128&g=1", "display_name": "Jackie Tao", "link": "https://stackoverflow.com/users/9911619/jackie-tao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567414560, "creation_date": 1567407543, "last_edit_date": 1567414560, "question_id": 57752610, "link": "https://stackoverflow.com/questions/57752610/why-context-context-signal-affects-new-goroutine", "title": "why context.Context signal affects new goroutine?", "body": "<p>I'm using <code>context.Context</code> to control multiple goroutines. A goroutine listens <code>context.Done()</code>, then print now date string. And the process listens <code>syscall.SIGHUP</code> which cancel context and then create new goroutine with context created before.</p>\n\n<p>I think when <code>syscall.SIGHUP</code> emitting, the process will print one date string, however got two.</p>\n\n<p>This process is running on <code>ubuntu18.04</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n    \"time\"\n)\n\nfunc main() {\n    ctx, cancel := context.WithCancel(context.Background())\n    go printDate(ctx)\n\n    sg := make(chan os.Signal)\n    signal.Notify(sg, syscall.SIGHUP)\n\n    for {\n        select {\n        case &lt;-sg:\n            cancel()\n            go printDate(ctx)\n        }\n    }\n}\n\nfunc printDate(ctx context.Context) {\n    select {\n    case &lt;-ctx.Done():\n        fmt.Println(time.Now().Format(\"2006-01-02 15:04:05\"))\n    }\n}\n</code></pre>\n\n<p>I expect the output to be </p>\n\n<pre><code>2019-01-02 01:02:03\n</code></pre>\n\n<p>but actual output is:</p>\n\n<pre><code>2019-01-02 01:02:03\n2019-01-02 01:02:03\n</code></pre>\n"}, {"tags": ["go", "binaryfiles", "binarywriter"], "comments": [{"owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "edited": false, "score": 0, "creation_date": 1567408449, "post_id": 57752184, "comment_id": 101942264, "body": "I am not sure what you mean by requests in this context, do you mean physical requests to a server, because that would be the better place to hold this license. could you better define what what the idea of request means ?"}, {"owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "edited": false, "score": 0, "creation_date": 1567411922, "post_id": 57752184, "comment_id": 101943592, "body": "This is an interesting question. (I think it was voted down because it&#39;s not quite clear what you&#39;re asking because what you mean by &quot;binary&quot; is not clear and also because if your encrypted file can be saved and restored then so can your binary file or any file for that matter.) I have some ideas if you are interested but as Volker implies there is no foolproof solution."}, {"owner": {"reputation": 1062, "user_id": 1517624, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e6d7f2d2a5443be1694ee70b13720fb5?s=128&d=identicon&r=PG", "display_name": "ashishmohite", "link": "https://stackoverflow.com/users/1517624/ashishmohite"}, "reply_to_user": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "edited": false, "score": 0, "creation_date": 1567418956, "post_id": 57752184, "comment_id": 101946603, "body": "@ajr Like the question says I&#39;m actually looking for better approach. Would love to hear your ideas. And I agree that there&#39;s no foolproof solution. Binary here is Golang executable"}, {"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 0, "creation_date": 1567440544, "post_id": 57752184, "comment_id": 101956022, "body": "Volker answer is right (you cannot do it in software alone). On the other hand, you can use the good ol software protection dongle, which is hardware (still not 100% secure, but way better than software, if your business model allows to put a dongle in the offering). There are now USB dongles. As a starting point, see <a href=\"https://en.wikipedia.org/wiki/Software_protection_dongle\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Software_protection_dongle</a>"}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 5, "last_activity_date": 1567407228, "creation_date": 1567407228, "answer_id": 57752555, "question_id": 57752184, "link": "https://stackoverflow.com/questions/57752184/store-the-state-inside-golang-binary/57752555#57752555", "title": "Store the state inside golang binary", "body": "<blockquote>\n  <p>Is there a way to do it?</p>\n</blockquote>\n\n<p>No.</p>\n\n<p>(At least no official, portable way. Of course you can modify a binary and change e.g. the data or BSS segment, but this is <strong>hard</strong>, OS-dependent and does not solve your problem as it has the same problem like an external file: You can just keep the original executable and start over with that one. Some things simply cannot be solved technically.)</p>\n"}, {"comments": [{"owner": {"reputation": 1062, "user_id": 1517624, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e6d7f2d2a5443be1694ee70b13720fb5?s=128&d=identicon&r=PG", "display_name": "ashishmohite", "link": "https://stackoverflow.com/users/1517624/ashishmohite"}, "edited": false, "score": 0, "creation_date": 1567409242, "post_id": 57752892, "comment_id": 101942526, "body": "Its an onpremise deployment. On client&#39;s infra. No control ."}, {"owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "reply_to_user": {"reputation": 1062, "user_id": 1517624, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e6d7f2d2a5443be1694ee70b13720fb5?s=128&d=identicon&r=PG", "display_name": "ashishmohite", "link": "https://stackoverflow.com/users/1517624/ashishmohite"}, "edited": false, "score": 0, "creation_date": 1567409820, "post_id": 57752892, "comment_id": 101942747, "body": "I understood that this was an onpremise solution which is why I asked to clarify requests. Realistically if you want control then you need to retain control of the license side of things I think the best options would be to build in a service that can pull down a license from a server under your control. This way you can retract the license and have total control, to try to build this totally onpremise would leave you vulnerable to loosing control, as you are finding."}], "tags": [], "owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "is_accepted": false, "score": 0, "last_activity_date": 1567409131, "creation_date": 1567409131, "answer_id": 57752892, "question_id": 57752184, "link": "https://stackoverflow.com/questions/57752184/store-the-state-inside-golang-binary/57752892#57752892", "title": "Store the state inside golang binary", "body": "<p>If your rest API is within your control and is the part that you are monetizing surely this is the point at which you would be filtering the licensed perhaps some kind of certificate authentication or key to the API and then you can keep then count on the API side that you can control and then it wont matter if it is in a flat file or a DB etc, because you control it. </p>\n"}, {"tags": [], "owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "is_accepted": false, "score": 0, "last_activity_date": 1567744851, "last_edit_date": 1567744851, "creation_date": 1567468825, "answer_id": 57763635, "question_id": 57752184, "link": "https://stackoverflow.com/questions/57752184/store-the-state-inside-golang-binary/57763635#57763635", "title": "Store the state inside golang binary", "body": "<p>Here is a solution to what you are trying to do (not to writing to the executable which) that will defeat casual copying of files.</p>\n\n<p>A possible approach is to regularly write the request count and the current system time to file.  This file does not even have to be encrypted - you just need to generate a hash of the data (eg using SHA2) and sign it with a private key then append to the file.</p>\n\n<p>Then when you (re)start the service read and verify the file using your public key and check that it has not been too long since the time that was written to the file.  Note that some initial file will have to be written on installation and your service will need to be running continually - only allowing for brief restarts.  You also would probably verify that the time is not in the future as this would indicate an attempt to circumvent the system.</p>\n\n<p>Of course this approach has problems such as the client fiddling with the system time or even debugging your code to find the private key and probably others. Hopefully these are hard enough to act as a deterrent. Also if the service or system is shut down for an extended period of time then some sort of manual intervention would be required. </p>\n"}], "owner": {"reputation": 1062, "user_id": 1517624, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e6d7f2d2a5443be1694ee70b13720fb5?s=128&d=identicon&r=PG", "display_name": "ashishmohite", "link": "https://stackoverflow.com/users/1517624/ashishmohite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1567744851, "creation_date": 1567404981, "last_edit_date": 1567422792, "question_id": 57752184, "link": "https://stackoverflow.com/questions/57752184/store-the-state-inside-golang-binary", "title": "Store the state inside golang binary", "body": "<p>I am Developing an onpremise solution for a client without any control and internet connection on the machine. </p>\n\n<p>The solution is to be monetized based on number of allowed requests(REST API calls) for a bought license. So currently we store the request count in an encrypted file on the file system itself. But this solution is not perfect as the file can be copied somewhere and then replaced when the requests quota is over. Also if the file is deleted then there's manual intervention needed from support.</p>\n\n<p>I'm looking for a solution to store the state/data in binary and update it runtime (consider usage count that updates in binary itself)</p>\n\n<p>Looking for a better approach.</p>\n\n<p>Also binary should start from the previous stored State</p>\n\n<p>Is there a way to do it?</p>\n\n<p>P.S. I know writing to binary won't solve the issue but I think it'll increase the difficulty by increasing number of permutation and combinations for places where the state can be stored and since it's not a common knowledge that you can change the executable that would be the last place to look for the state if someone's trying to mess with the system (security by obscurity)</p>\n"}, {"tags": ["go", "networking", "client-server"], "answers": [{"tags": [], "owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "is_accepted": true, "score": 1, "last_activity_date": 1567405338, "creation_date": 1567405338, "answer_id": 57752236, "question_id": 57751871, "link": "https://stackoverflow.com/questions/57751871/simple-server-client-communication-not-working/57752236#57752236", "title": "Simple server client communication not working", "body": "<p>The looping in client is strange!\nThe looping not make sense if read/write is out.\nBut the error is only this:</p>\n\n<pre><code>  //var buf []byte &lt;--- this read 0 bytes\n  buf := make([]byte, 1024) \n  n, err := conn.Read(buf)\n</code></pre>\n\n<p>A proposal for you:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net\"\n    \"time\"\n)\n\nfunc client() {\n    var conn net.Conn\n    var err error\n\n    // retry server until it is up\n    for {\n        log.Printf(\"Connecting...\")\n        conn, err = net.Dial(\"tcp\", \":8082\")\n        if err != nil {\n            log.Println(err)\n            break\n        }\n        time.Sleep(time.Second)\n        // write to server\n        log.Printf(\"Writing...\")\n        _, err = conn.Write([]byte(\"request\"))\n        if err != nil {\n            log.Println(err)\n            return\n        }\n        // block &amp; read from server\n        log.Printf(\"Reading...\")\n        var buf []byte\n        n, err := conn.Read(buf)\n        if err != nil {\n            log.Println(err)\n            return\n        }\n        log.Printf(\"From server: %s\\n\", buf[:n])\n    }\n}\n\nfunc server() {\n    ln, _ := net.Listen(\"tcp\", \":8082\")\n    for {\n        conn, _ := ln.Accept()\n        go handleConn(conn)\n    }\n}\n\nfunc handleConn(conn net.Conn) {\n    buf := make([]byte, 1024)\n    n, err := conn.Read(buf)\n    if err != nil {\n        return\n    }\n    log.Printf(\"Server got: [%d bytes] %s\\n\", n, buf)\n\n    if string(buf[:n]) == \"request\" {\n        _, _ = conn.Write([]byte(\"response\"))\n    }\n    conn.Close()\n}\n\nfunc main() {\n    go client()\n    server()\n}\n</code></pre>\n"}], "owner": {"reputation": 1419, "user_id": 3788493, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/eLdB2.jpg?s=128&g=1", "display_name": "jeanluc", "link": "https://stackoverflow.com/users/3788493/jeanluc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31, "favorite_count": 0, "accepted_answer_id": 57752236, "answer_count": 1, "score": 0, "last_activity_date": 1567405341, "creation_date": 1567402607, "question_id": 57751871, "link": "https://stackoverflow.com/questions/57751871/simple-server-client-communication-not-working", "title": "Simple server client communication not working", "body": "<p>This seemingly simple example is not working as expected and I feel bad for asking but here goes:</p>\n\n<p>There's a client that retries connecting to the server, sends a message, and then waits for a response:</p>\n\n<pre><code>func client() {\n    var conn net.Conn\n    var err error\n\n    // retry server until it is up\n    for {\n        conn, err = net.Dial(\"tcp\", \":8081\")\n        if err == nil {\n            break\n        }\n        log.Println(err)\n        time.Sleep(time.Second)\n    }\n\n    // write to server\n    _, err = conn.Write([]byte(\"request\"))\n    if err != nil {\n        log.Println(err)\n        return\n    }\n\n    // block &amp; read from server\n    var buf []byte\n    n, err := conn.Read(buf)\n    if err != nil {\n        log.Println(err)\n        return\n    }\n    log.Printf(\"From server: %s\\n\", buf[:n])\n}\n</code></pre>\n\n<p>It connects to a server which for each connection, reads and interprets the sent data, and sends a response if needed:</p>\n\n<pre><code>func server() {\n    ln, _ := net.Listen(\"tcp\", \":8081\")\n    for {\n        conn, _ := ln.Accept()\n        go handleConn(conn)\n    }\n}\n\nfunc handleConn(conn net.Conn) {\n    var buf []byte\n    n, err := conn.Read(buf)\n    if err != nil {\n        return\n    }\n    log.Printf(\"Server got: %s\\n\", buf)\n\n    if string(buf[:n]) == \"request\" {\n        _, _ = conn.Write([]byte(\"response\"))\n    }\n}\n</code></pre>\n\n<p>All driven by the main function:</p>\n\n<pre><code>func main() {\n    go client()\n    server()\n}\n</code></pre>\n\n<p>Error handling is omitted for brevity. The expected behavior is that the client will connect to the server and send the message \"request\" and then block on the read. The server receives \"request\" and sends the message \"response\" back to the same connection. The client unblock, prints the received message and exits. Instead, when the program is run, the following is printed:</p>\n\n<pre><code>2019/09/01 22:24:02 From server: \n2019/09/01 22:24:02 Server got: \n</code></pre>\n\n<p>Suggesting that no data was exchanged, and that the client did not block.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-build"], "comments": [{"owner": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "edited": false, "score": 0, "creation_date": 1567403679, "post_id": 57751802, "comment_id": 101940729, "body": "It turns out this is because the folder structure hasn&#39;t been updated as the migration document requires. Moving the go script and yaml into a folder resolved the issue, it seems"}], "owner": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1567401990, "creation_date": 1567401990, "question_id": 57751802, "link": "https://stackoverflow.com/questions/57751802/standard-app-engine-migrating-to-go-1-11-cloud-build-failed", "title": "Standard App Engine migrating to Go 1.11 cloud build failed", "body": "<p>I am trying to migrate from Go 1.9 to Go 1.11. I am using cloudbuild.yaml to get dependencies and deploy the application. However, I am getting this error:</p>\n\n<pre><code>Failed to build app: Your app is not on your GOPATH, please move it there and try again.\n</code></pre>\n\n<p>I checked <a href=\"https://cloud.google.com/appengine/docs/standard/go111/go-differences#package-main\" rel=\"nofollow noreferrer\">the migration document</a>, and it says I need to put the application into the GOPATH. However, I am not sure if that's possible with cloudbuild.yaml. If yes, could someone share an example?</p>\n\n<p>A simplified version of my cloudbuild.yaml. As far as I know the application source code is under /workspace in this situation. I have tried to include /workspace in GOPATH in the deploy step but no luck.</p>\n\n<pre><code>steps:\n- name: 'gcr.io/cloud-builders/go'\n  args: ['get', 'github.com/go-sql-driver/mysql']\n  env: ['GOPATH=go']\n- name: 'gcr.io/cloud-builders/gcloud'\n  args: ['app', 'deploy', 'go/src/batch.yaml']\n  env: ['GOPATH=go']\n</code></pre>\n\n<p>File structure:</p>\n\n<pre><code>/repo\n  |-go\n     |-src\n        |-batch.yaml\n        |cronjob.go\n</code></pre>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 3, "creation_date": 1567385302, "post_id": 57750397, "comment_id": 101938037, "body": "<code>append</code> has built-in function super powers."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1567385950, "post_id": 57750397, "comment_id": 101938095, "body": "The builtin package documentation uses <code>Type</code> as a placeholder for any type.  This use of <code>Type</code> is not valid Go syntax and is not useable in application defined functions.  As peterSO says, append has super powers."}, {"owner": {"reputation": 597, "user_id": 1712332, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/162801338a7b2e4066d6aa8e45e4c404?s=128&d=identicon&r=PG", "display_name": "Eksapsy", "link": "https://stackoverflow.com/users/1712332/eksapsy"}, "edited": false, "score": 0, "creation_date": 1567387446, "post_id": 57750397, "comment_id": 101938243, "body": "I see. I feel like that is a bit unfair to be honest. Thanks for clearing this out. So my question is still valid. Why and who gave the downvote? It&#39;s a legit question that will surely help other people too and I made it as crystal clear as possible. I dont know what stackoverflow wants anymore."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1567387822, "post_id": 57750397, "comment_id": 101938292, "body": "A future version of Go may give you the power of <code>append</code> and other builtins.  See <a href=\"https://blog.golang.org/why-generics\" rel=\"nofollow noreferrer\">blog.golang.org/why-generics</a>."}, {"owner": {"reputation": 597, "user_id": 1712332, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/162801338a7b2e4066d6aa8e45e4c404?s=128&d=identicon&r=PG", "display_name": "Eksapsy", "link": "https://stackoverflow.com/users/1712332/eksapsy"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567388864, "post_id": 57750397, "comment_id": 101938415, "body": "@CeriseLim&#243;n If you would feel like it, you could form an answer since I think you provide all the information there is to answer the question. I&#39;ll mark it as solved when possible."}], "answers": [{"comments": [{"owner": {"reputation": 597, "user_id": 1712332, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/162801338a7b2e4066d6aa8e45e4c404?s=128&d=identicon&r=PG", "display_name": "Eksapsy", "link": "https://stackoverflow.com/users/1712332/eksapsy"}, "edited": false, "score": 0, "creation_date": 1567426365, "post_id": 57752314, "comment_id": 101949852, "body": "I see. Looking it up again, I can see that <code>...interface{}</code> is interpreted as <code>[]interface{}</code>. I just thought this shouldn&#39;t be the case. Because the intention with the spreading operator is not to say &quot;I want an array of interfaces&quot;, but to say &quot;I want a set of interface{} elements&quot;. That&#39;s why I thought this was strange &amp; confusing, especially when coming from a JS Background :3. Thanks by the way."}], "tags": [], "owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "is_accepted": true, "score": 3, "last_activity_date": 1567405817, "creation_date": 1567405817, "answer_id": 57752314, "question_id": 57750397, "link": "https://stackoverflow.com/questions/57750397/cannot-use-variable-of-type-struct-as-interface-while-spreading/57752314#57752314", "title": "&quot;Cannot use variable of type []struct as []interface&quot; while spreading", "body": "<p>I think that this is the issue that you are running into here.</p>\n\n<p><a href=\"https://github.com/golang/go/wiki/InterfaceSlice\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/InterfaceSlice</a></p>\n\n<p>I am not an expert in this but have hit this before, the \"slice of empty interface\" is not an interface and therefore cannot be replaced by any type which is the issue that you are having, it has to do with the memory structure being different. The above has a far better explanation than one that I can give. </p>\n"}, {"comments": [{"owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "edited": false, "score": 0, "creation_date": 1615128178, "post_id": 62493521, "comment_id": 117589965, "body": "You could <code>generic := make([]interface{}, len(foos))</code>, <code>for i, f := range foos</code>, and <code>generic[i] = f</code>, since the length of <code>foos</code> is known. Looks like this is linked to in the other answer: <a href=\"https://github.com/golang/go/wiki/InterfaceSlice#what-can-i-do-instead\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/InterfaceSlice#what-can-i-do-inste&zwnj;&#8203;ad</a>"}], "tags": [], "owner": {"reputation": 8323, "user_id": 199176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6aaec42f866af6b051b6690839c5778c?s=128&d=identicon&r=PG", "display_name": "Luke Sneeringer", "link": "https://stackoverflow.com/users/199176/luke-sneeringer"}, "is_accepted": false, "score": 1, "last_activity_date": 1592703336, "last_edit_date": 1592703336, "creation_date": 1592702982, "answer_id": 62493521, "question_id": 57750397, "link": "https://stackoverflow.com/questions/57750397/cannot-use-variable-of-type-struct-as-interface-while-spreading/62493521#62493521", "title": "&quot;Cannot use variable of type []struct as []interface&quot; while spreading", "body": "<p>You can typecast your typed slice to get what you need:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>generic := make([]interface{}, 0)\nfor _, f := range foos {\n  generic = append(generic, f)\n}\ntest(generic...)  // works\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "is_accepted": false, "score": 0, "last_activity_date": 1615151956, "creation_date": 1615151956, "answer_id": 66521525, "question_id": 57750397, "link": "https://stackoverflow.com/questions/57750397/cannot-use-variable-of-type-struct-as-interface-while-spreading/66521525#66521525", "title": "&quot;Cannot use variable of type []struct as []interface&quot; while spreading", "body": "<p>Combining the two non-negative answers into what I feel is the best solution:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>interfaceSlice := make([]interface{}, len(foos))\nfor i, v := range foos {\n    interfaceSlice[i] = v\n}\ntest(interfaceSlice...)\n</code></pre>\n<p>Partially inspired by:</p>\n<p><a href=\"https://github.com/golang/go/wiki/InterfaceSlice#what-can-i-do-instead\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/InterfaceSlice#what-can-i-do-instead</a></p>\n"}], "owner": {"reputation": 597, "user_id": 1712332, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/162801338a7b2e4066d6aa8e45e4c404?s=128&d=identicon&r=PG", "display_name": "Eksapsy", "link": "https://stackoverflow.com/users/1712332/eksapsy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2055, "favorite_count": 1, "accepted_answer_id": 57752314, "answer_count": 3, "score": -1, "last_activity_date": 1615151956, "creation_date": 1567384476, "last_edit_date": 1567384875, "question_id": 57750397, "link": "https://stackoverflow.com/questions/57750397/cannot-use-variable-of-type-struct-as-interface-while-spreading", "title": "&quot;Cannot use variable of type []struct as []interface&quot; while spreading", "body": "<p><strong>Prototype function</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func test(i ...interface{}) {\n    // Code here\n}\n</code></pre>\n\n<p><strong>Intended use</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type foo struct {\n    // Fields\n}\n\nfoos := []foo{\n    // foo1, foo2 ...\n}\n\ntest(foos...) // ERROR\ntest(foos[1], foos[2], ...) // OK\n</code></pre>\n\n<p><strong>Error</strong></p>\n\n<blockquote>\n  <p>cannot use foos (variable of type []foos) as []interface{} value in argument to test</p>\n</blockquote>\n\n<h1>Description</h1>\n\n<p>The intended use is to be used like the built-in function <code>append()</code>.</p>\n\n<p><a href=\"https://golang.google.cn/pkg/builtin/#append\" rel=\"nofollow noreferrer\">https://golang.google.cn/pkg/builtin/#append</a></p>\n\n<pre><code>func append(slice []Type, elems ...Type) []Type\n</code></pre>\n\n<p>Although, as I've seen <code>append()</code> doesn't use <code>interface{}</code>, which is strange, since anywhere that I searched all people say to use <code>interface{}</code> when you don't know the type. But they don't.\nNope, <code>append()</code> uses a \"build-in\" type called <code>Type</code>, which apparently the docs say that it's a <code>int</code>. Although, I cannot use it. There isn't such type. And neither I would know how to use it if there was.</p>\n\n<p><a href=\"https://golang.google.cn/pkg/builtin/#Type\" rel=\"nofollow noreferrer\">https://golang.google.cn/pkg/builtin/#Type</a></p>\n\n<pre><code>type Type int\n</code></pre>\n\n<p>So, I'm very confused here. </p>\n\n<h1>Questions</h1>\n\n<ol>\n<li><p>Why does the spread operator not work as intended? For example, in Javascript the spread operator just spreads the array into items. But in Golang it seems like it <strong>keeps the same array parameter type</strong> as it is but gives the compiler later an instruction to spread it. Which is odd.</p></li>\n<li><p>Are we even able to make similar custom mechanisms like <code>append()</code> at all? Or am I a dummy and I'm using something wrong anyway?</p></li>\n</ol>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "is_accepted": false, "score": 2, "last_activity_date": 1567396703, "last_edit_date": 1567396703, "creation_date": 1567392433, "answer_id": 57750919, "question_id": 57749720, "link": "https://stackoverflow.com/questions/57749720/gorm-create-record-that-might-already-exist/57750919#57750919", "title": "GORM create record that might already exist", "body": "<p><code>lib/pq</code> is the standard postgres driver. If there is a query error, it will return a <code>pq.Error</code> object (even if you're using GORM). The <code>pq.Error</code> type has a <code>Code</code> field you can inspect to see the cause of the error.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if err, ok := err.(*pq.Error); ok &amp;&amp; err.Code.Name() == \"unique_violation\" {\n    // handle error\n}\n</code></pre>\n\n<p><a href=\"https://github.com/lib/pq/blob/master/error.go#L78\" rel=\"nofollow noreferrer\">Error code reference</a></p>\n\n<p><a href=\"https://godoc.org/github.com/lib/pq#Error\" rel=\"nofollow noreferrer\">lib/pq Go doc</a></p>\n"}, {"tags": [], "owner": {"reputation": 997, "user_id": 6158542, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/pVudd.jpg?s=128&g=1", "display_name": "JonyD", "link": "https://stackoverflow.com/users/6158542/jonyd"}, "is_accepted": false, "score": 2, "last_activity_date": 1606346797, "last_edit_date": 1606346797, "creation_date": 1606345274, "answer_id": 65013885, "question_id": 57749720, "link": "https://stackoverflow.com/questions/57749720/gorm-create-record-that-might-already-exist/65013885#65013885", "title": "GORM create record that might already exist", "body": "<p>To add to the previous answer, currently you can also use something like this to check for error codes (in the example: checking for duplicate  keys).</p>\n<ul>\n<li>(lib from <a href=\"https://github.com/jackc/pgx\" rel=\"nofollow noreferrer\">github.com/jackc/pgx</a>)</li>\n<li>Postgres errors are <a href=\"https://www.postgresql.org/docs/current/errcodes-appendix.html\" rel=\"nofollow noreferrer\">explained here</a></li>\n</ul>\n<pre><code>import &quot;github.com/jackc/pgx&quot;\n...\nfunc isDuplicateKeyError(err error) bool {\n    pgErr, ok := err.(pgx.PgError)\n    if ok {\n        // unique_violation = 23505\n        return pgErr.Code == &quot;23505&quot;\n\n    }\n    return false\n}\n</code></pre>\n"}], "owner": {"reputation": 1672, "user_id": 1115876, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/dee3033759b820a3df9f7437d3a9fe31?s=128&d=identicon&r=PG", "display_name": "QuinnFreedman", "link": "https://stackoverflow.com/users/1115876/quinnfreedman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2442, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1606346797, "creation_date": 1567374408, "question_id": 57749720, "link": "https://stackoverflow.com/questions/57749720/gorm-create-record-that-might-already-exist", "title": "GORM create record that might already exist", "body": "<p>I'm using <a href=\"http://gorm.io/docs\" rel=\"noreferrer\">gorm</a> with postgres in my Go app.</p>\n\n<p>I want to create a new user in the database, but there is a good chance that that user will already exist. If so, I want to not do anything with the database, but I want know about it so I can tell the user.</p>\n\n<p>The good news is, that's already what <a href=\"http://gorm.io/docs/create.html\" rel=\"noreferrer\"><code>gorm.Create(..)</code></a> does. Trying to create a record with a duplicate unique key will return an error. There are two problems:</p>\n\n<ol>\n<li>I want better error messages. I want to write custom user-facing error messages that are different for \"This email address already exists\" than \"There was an actual internal error.\" I don't know how to diferentiate between these two events other than trying to parse the error string returned by <code>Create()</code> which seems bug prone.</li>\n<li>I don't want to clutter my logs. Calling <code>Create()</code> with an object that already exists logs an error message to stdout. I don't really consider this an \"error\" since I was expecting it to happen and I don't want to flood my logs with a bunch of these warnings.</li>\n</ol>\n\n<p>I know I could use a transaction to first check for a user with the given id and then create them if one does not already exist, but it seems like there should be a simpler solution to such a basic thing. How are you supposed to do this?</p>\n\n<hr>\n\n<p>I'm currently doing this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (self databaseWrapper) CreateUser(user *User) error {\n    db := self.db\n    db.NewRecord(*user)\n    err := db.Create(user).Error\n    if err != nil {\n        if db.Where(user.ID).Take(&amp;User{}).Error == nil {\n            return fmt.Errorf(\"A user already exists with id %v\", user.ID)\n        }\n\n        if db.Where(User{Email: user.Email}).Take(&amp;User{}).Error == nil {\n            return fmt.Errorf(\"A user already exists with the given email address: %v\", user.Email)\n        }\n\n        return fmt.Errorf(\"Error creating user\")\n    }\n    return nil\n}\n\n</code></pre>\n\n<p>Which is a little inefficient and gives the ugly output:</p>\n\n<pre><code>go test\n\n(/home/quinn/workspace/aev/sensor/backend/server/database.go:125)\n[2019-09-01 14:45:40]  pq: duplicate key value violates unique constraint \"users_pkey\"\n\n(/home/quinn/workspace/aev/sensor/backend/server/database.go:125)\n[2019-09-01 14:45:40]  pq: duplicate key value violates unique constraint \"uix_users_email\"\nPASS\nok          3.215s\n</code></pre>\n\n<p>even when everything worked as expected.</p>\n"}, {"tags": ["postgresql", "go", "go-pg"], "comments": [{"owner": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "edited": false, "score": 0, "creation_date": 1567370360, "post_id": 57749201, "comment_id": 101936046, "body": "Can you be more specific? How does each client&#39;s database differ (what is the &quot;dynamic&quot; element here)? Also what have you tried so far or how would you do something like this in PHP/MySQL?"}, {"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 2, "creation_date": 1567380115, "post_id": 57749201, "comment_id": 101937499, "body": "If you can run SQL statements through Go, you can <a href=\"https://www.postgresql.org/docs/current/sql-createdatabase.html\" rel=\"nofollow noreferrer\">create a database</a> provided you can connect as the superuser (but an application should never connect as the superuser - it should simply rely that the database was created before hand)"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 3, "creation_date": 1567380510, "post_id": 57749201, "comment_id": 101937547, "body": "It is an utterly wrong approach to create a database for each customer to create multi-tenant capabilities. Instead, adjust your data model."}, {"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1567396860, "post_id": 57749201, "comment_id": 101939518, "body": "+1 to Markus&#39; advice. Dynamically generated tables/schemas are a nightmare. The <a href=\"https://softwareengineering.stackexchange.com/\">software engineering</a> site is a good place to ask questions about how to change your data model."}], "owner": {"reputation": 61, "user_id": 10511852, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-gFW1hO_AR3g/AAAAAAAAAAI/AAAAAAAAABs/FfK87y9FIf4/photo.jpg?sz=128", "display_name": "Egere Samuel.o.c.", "link": "https://stackoverflow.com/users/10511852/egere-samuel-o-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1567380275, "creation_date": 1567369048, "last_edit_date": 1567380275, "question_id": 57749201, "link": "https://stackoverflow.com/questions/57749201/is-there-a-way-to-dynamically-create-a-postgres-database-with-go-pg-or-any-metho", "title": "Is there a way to dynamically create a Postgres database with go-pg or any method in go generally?", "body": "<p>I am working on a project that involves me dynamically creating a database for each client. I could do this with PHP and MySQL, but for optimization, the project language is been changed to Go and PostgreSQL. So i am trying to see if there is a way to achieve this with go-pg or any method in Go.</p>\n"}, {"tags": ["go", "module"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1567367382, "post_id": 57748979, "comment_id": 101935476, "body": "Does that directory exist in that project on github? As far as I can tell, it doesn&#39;t."}, {"owner": {"reputation": 1, "user_id": 6596433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd89d5f7d8c748c26597f4687eb16d3a?s=128&d=identicon&r=PG&f=1", "display_name": "Ko0", "link": "https://stackoverflow.com/users/6596433/ko0"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1567376607, "post_id": 57748979, "comment_id": 101937051, "body": "I think it does. The root directory is <a href=\"https://github.com/Darkbladecr/ccxt/tree/go\" rel=\"nofollow noreferrer\">github.com/Darkbladecr/ccxt/tree/go</a>."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1567377052, "post_id": 57748979, "comment_id": 101937111, "body": "It is not on the master branch, it is on the &quot;go&quot; branch. IIRC, go get github.com/Darkbladecr/ccxtl@go should get you that branch (I think)."}, {"owner": {"reputation": 1, "user_id": 6596433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd89d5f7d8c748c26597f4687eb16d3a?s=128&d=identicon&r=PG&f=1", "display_name": "Ko0", "link": "https://stackoverflow.com/users/6596433/ko0"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1567381254, "post_id": 57748979, "comment_id": 101937621, "body": "Oh, yes. Sorry, I did not see it. It worked. Thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": false, "score": 0, "last_activity_date": 1584042215, "creation_date": 1584042215, "answer_id": 60660933, "question_id": 57748979, "link": "https://stackoverflow.com/questions/57748979/go-module-import-from-github/60660933#60660933", "title": "Go module import from github", "body": "<p>You can either <code>go get</code> the branch containing that package explicitly, or add explicit version tags on that branch in the format that the <code>go</code> tool recognizes (with a leading <code>v</code> prefix on the tags, such as <code>v1.18.445</code> or <code>v0.1.0-go</code>).</p>\n"}], "owner": {"reputation": 1, "user_id": 6596433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd89d5f7d8c748c26597f4687eb16d3a?s=128&d=identicon&r=PG&f=1", "display_name": "Ko0", "link": "https://stackoverflow.com/users/6596433/ko0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 302, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1584042215, "creation_date": 1567367243, "question_id": 57748979, "link": "https://stackoverflow.com/questions/57748979/go-module-import-from-github", "title": "Go module import from github", "body": "<p>I am new to golang and trying to import and use modules from this Github repo. <a href=\"https://github.com/Darkbladecr/ccxt/tree/go/go\" rel=\"nofollow noreferrer\">https://github.com/Darkbladecr/ccxt/tree/go/go</a></p>\n\n<p>I am using go module to manage dependencies but importing is failed.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/Darkbladecr/ccxt/go/pkg/ccxt/models\"\n)\n\n</code></pre>\n\n<p>But I got this error.</p>\n\n<pre><code>go: finding github.com/Darkbladecr/ccxt latest\nbuild command-line-arguments: cannot load github.com/Darkbladecr/ccxt/go/pkg/ccxt/models: cannot find module providing package github.com/Darkbladecr/ccxt/go/pkg/ccxt/models\n</code></pre>\n\n<p>Is it possible to import a specific directory for go like this repo?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5026, "user_id": 993592, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/cmoKM.jpg?s=128&g=1", "display_name": "ardochhigh", "link": "https://stackoverflow.com/users/993592/ardochhigh"}, "edited": false, "score": 0, "creation_date": 1567365313, "post_id": 57748760, "comment_id": 101934979, "body": "Thanks for the quick answer ... I want to keep polling until they enter a valid float."}], "tags": [], "owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "is_accepted": false, "score": 1, "last_activity_date": 1567365111, "creation_date": 1567365111, "answer_id": 57748760, "question_id": 57748737, "link": "https://stackoverflow.com/questions/57748737/unintended-looping-with-invalid-float/57748760#57748760", "title": "Unintended looping with invalid float", "body": "<p>That's because your for loop is an infinite loop if user enters a wrong value. You should have a <code>return</code> statement after your <code>fmt.Printf(\"you entered wrong number\")</code>, so that the for loop can exit.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1567368251, "last_edit_date": 1567368251, "creation_date": 1567367722, "answer_id": 57749036, "question_id": 57748737, "link": "https://stackoverflow.com/questions/57748737/unintended-looping-with-invalid-float/57749036#57749036", "title": "Unintended looping with invalid float", "body": "<p>The problem is that if <a href=\"https://golang.org/pkg/fmt/#Scanf\" rel=\"nofollow noreferrer\"><code>fmt.Scanf()</code></a> encounters an invalid input, it will stop consuming it. E.g. you want to parse a float using <code>%f</code>, but if user inputs <code>sdf</code>, <code>fmt.Scanf()</code> will know it's invalid after the first <code>s</code> character, so returns an error and will not consume the rest.</p>\n\n<p>So the next loop iteration begins, it consumes the second character <code>d</code>, which is again invalid etc.</p>\n\n<p>If you try to enter <code>s2</code> for example, this will become clear:</p>\n\n<pre><code>Please enter a float: \ns2\nWooops! That's not a float\nPlease enter a float: \nYou entered: 2.0000\n</code></pre>\n\n<p>First <code>s</code> char is invalid, but the next iteration will parse <code>2</code>.</p>\n\n<p>One way to \"fix\" this is to read a whole line as a string, then attempt to parse a float out of the string. For reading a line, use <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"nofollow noreferrer\"><code>bufio.Scanner</code></a>, for parsing a float, use <a href=\"https://golang.org/pkg/strconv/#ParseFloat\" rel=\"nofollow noreferrer\"><code>strconv.ParseFloat()</code></a>.</p>\n\n<p>Here's an example how you can do that:</p>\n\n<pre><code>func readFloat(title string) float64 {\n    scanner := bufio.NewScanner(os.Stdin)\n    for {\n        fmt.Printf(\"Please enter a float for %s: \", title)\n        if !scanner.Scan() {\n            fmt.Println(\"Error readling line\")\n            return 0 // Should return an error too!\n        }\n\n        line := scanner.Text()\n        userInput, err := strconv.ParseFloat(line, 64)\n        if err == nil {\n            return userInput\n        }\n        fmt.Printf(\"Wooops! That's not a float\\n\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 5026, "user_id": 993592, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/cmoKM.jpg?s=128&g=1", "display_name": "ardochhigh", "link": "https://stackoverflow.com/users/993592/ardochhigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 57749036, "answer_count": 2, "score": 1, "last_activity_date": 1567368251, "creation_date": 1567364806, "question_id": 57748737, "link": "https://stackoverflow.com/questions/57748737/unintended-looping-with-invalid-float", "title": "Unintended looping with invalid float", "body": "<p>I'm working through the Coursera Go course ... it's pretty good.</p>\n\n<p>In my code below, it works fine when the user correctly a float. But when they enter some random string, it prints the error message and prompt again for each character. Why is that?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc readFloat(title string) float64 {\n  var userInput float64\n\n  for {\n    fmt.Println(\"Please enter a float: \")\n    _, err := fmt.Scanf(\"%f\", &amp;userInput)\n\n    if err != nil {\n      fmt.Printf(\"Wooops! That's not a float\\n\")\n    } else {\n      return userInput\n    }\n  }\n}\n\nfunc main() {\n  var f float64\n\n  f = readFloat(\"acceleration\")\n    fmt.Printf(\"You entered: %.04f\\n\", f)\n}\n</code></pre>\n\n<pre><code>~/src/coursera/go/course-2-functions-methods/week2 $ go run so.go\nPlease enter a float:\n33.3\nYou entered: 33.3000\n~/src/coursera/go/course-2-functions-methods/week2 $ go run so.go\nPlease enter a float:\nsdf\nWooops! That's not a float\nPlease enter a float:\nWooops! That's not a float\nPlease enter a float:\nWooops! That's not a float\nPlease enter a float:\nWooops! That's not a float\nPlease enter a float:\n</code></pre>\n"}, {"tags": ["oop", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 2, "creation_date": 1567393502, "post_id": 57748730, "comment_id": 101939054, "body": "To add to that, having small 1-2 method interfaces improves the readability of your program by making it more explicit what certain functions are expecting. Writing mocks also becomes much easier since you don&#39;t need to mock out the entire interface for a function only expecting to use one method from the interface."}, {"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 1, "creation_date": 1567393547, "post_id": 57748730, "comment_id": 101939060, "body": "Additionally, the practice of using small interfaces makes it easy to work with down the road. If you have a single interface that is likely to grow in the future, you&#39;re better off taking the time to split it up now instead of waiting until it is cumbersome to work with and then having to do refactoring."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 7, "last_activity_date": 1567364764, "creation_date": 1567364764, "answer_id": 57748730, "question_id": 57748688, "link": "https://stackoverflow.com/questions/57748688/multiple-interfaces-for-the-same-struct/57748730#57748730", "title": "Multiple interfaces for the same struct", "body": "<p>There is nothing wrong with this approach, and Go standard library uses it often. For instance, there are many structs that implement a combination of io.Reader, io.Writer, io.Closer, and io.Seeker. The users of those structs specify what type of interface they need and use that. </p>\n"}, {"tags": [], "owner": {"reputation": 69, "user_id": 10249692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be5004dabd21ed6ac048c7c7044b1576?s=128&d=identicon&r=PG", "display_name": "Hahahrf", "link": "https://stackoverflow.com/users/10249692/hahahrf"}, "is_accepted": false, "score": 1, "last_activity_date": 1567816095, "creation_date": 1567816095, "answer_id": 57829778, "question_id": 57748688, "link": "https://stackoverflow.com/questions/57748688/multiple-interfaces-for-the-same-struct/57829778#57829778", "title": "Multiple interfaces for the same struct", "body": "<p>interface is the essential part of golang to implement \"Polymorphism\". Not only did you do it right, you also found the essence of interface.</p>\n"}], "owner": {"reputation": 972, "user_id": 3380256, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/OBgJb.jpg?s=128&g=1", "display_name": "mfink", "link": "https://stackoverflow.com/users/3380256/mfink"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1334, "favorite_count": 1, "accepted_answer_id": 57748730, "answer_count": 2, "score": 2, "last_activity_date": 1567816095, "creation_date": 1567364369, "last_edit_date": 1567511533, "question_id": 57748688, "link": "https://stackoverflow.com/questions/57748688/multiple-interfaces-for-the-same-struct", "title": "Multiple interfaces for the same struct", "body": "<p>I'm learning Go and wondering in some cases if it is considered good/okay/typical (encouraged?) practice in Golang to create several <code>interface</code> variations for the same <code>struct</code> depending on what the consumer code will be doing with that struct?</p>\n\n<p>I'm questioning this because I have a struct object that is arguably doing too much in my codebase and I want to add some tests and mock only certain usages/consumers of that struct. Say I have,</p>\n\n<p>for a (contrived) example, an Environment struct</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Environment/env.go\n\npackage env\n\ntype Environment struct {\n  sunny bool,\n  fullMoon bool,\n  temp float64\n  // ...\n}\n\nfunc (e *Environment) IsSunny() bool {\n  return e.sunny\n}\n\nfunc (e *Environment) IsFullMoon() bool {\n  return e.fullMoon\n}\n\nfunc (e *Environment) GetTemp() float64 {\n  return e.temp\n}\n</code></pre>\n\n<p>The above struct has properties and methods related to some of the environment conditions (day and night time).</p>\n\n<p>Then there are multiple consumers of this struct, but each <code>interface</code> only cares about a subset of the available methods:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// daytime.go\n\ntype DayEnv interface {\n  IsSunny() bool\n  GetTemp() float64\n}\n\nfunc getDaytime(de DayEnv) {\n  sunStatus := getSunStatus(de)\n  temp      := getDayTemp(de)\n\n  fmt.Printf(\"Today is %s and temperature is %s\", sunStatus, temp)\n}\n\n// func getSunStatus(de DayEnv) string {}\n// func getDayTemp(de DayEnv) string {}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// nightTime.go\n\ntype NightEnv interface {\n  IsFullMoon() bool\n  GetTemp() float64\n}\n\n\nfunc getNighttime(ne NightEnv) {\n  moonPhase := getMoonPhase(nightEnv)\n  temp      := getNightTemp(nightEnv)\n\n  fmt.Printf(\"Tonight the moon is %s and temperature is %s\", moonPhase, temp)\n}\n\n// func getMoonPhase(ne NightEnv) string { }\n// func getNightTemp(ne NightEnv) string { }\n</code></pre>\n\n<p>It seems to me while making a new interface that is only concerned with a subset of the struct methods makes things more flexible, it also feels fairly lazy or wrong to have so much (partial) duplication of interfaces and to sprinkle them as need or wherever they are consumed. I realize this example is a bit contrived, but on a larger scale (like many, many consumers), or perhaps one file has <code>x</code> interfaces for the same struct... is there anything wrong with this approach? </p>\n"}, {"tags": ["go", "cookies", "browser"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567362509, "post_id": 57748407, "comment_id": 101934393, "body": "What is type type of <code>c</code> in the code snippet?"}, {"owner": {"reputation": 11, "user_id": 4575263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c85dcbce73a7d9022ecfd2b6d303500f?s=128&d=identicon&r=PG&f=1", "display_name": "James Elgar", "link": "https://stackoverflow.com/users/4575263/james-elgar"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567426275, "post_id": 57748407, "comment_id": 101949811, "body": "c is of type *gin.Context"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 4575263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c85dcbce73a7d9022ecfd2b6d303500f?s=128&d=identicon&r=PG&f=1", "display_name": "James Elgar", "link": "https://stackoverflow.com/users/4575263/james-elgar"}, "edited": false, "score": 0, "creation_date": 1567426332, "post_id": 57751039, "comment_id": 101949838, "body": "Sorry yes, that is from me doing the try every combination phase. It still doesn&#39;t work with that as false but I will change that in the question thank you!"}], "tags": [], "owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "is_accepted": false, "score": 1, "last_activity_date": 1567393958, "creation_date": 1567393958, "answer_id": 57751039, "question_id": 57748407, "link": "https://stackoverflow.com/questions/57748407/cannot-set-cookie-in-browser-but-working-with-postman/57751039#57751039", "title": "Cannot set cookie in browser but working with postman", "body": "<p>You passed <code>true</code> to the <code>secure</code> argument of <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.SetCookie\" rel=\"nofollow noreferrer\">SetCookie</a> but you're sending the cookie to an insecure http address.</p>\n\n<p>As per <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#Secure_and_HttpOnly_cookies\" rel=\"nofollow noreferrer\">the MDN docs</a>:</p>\n\n<pre><code>A secure cookie is only sent to the server with an encrypted request over the HTTPS protocol.\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 4575263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c85dcbce73a7d9022ecfd2b6d303500f?s=128&d=identicon&r=PG&f=1", "display_name": "James Elgar", "link": "https://stackoverflow.com/users/4575263/james-elgar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 700, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1567606558, "creation_date": 1567361530, "last_edit_date": 1567606558, "question_id": 57748407, "link": "https://stackoverflow.com/questions/57748407/cannot-set-cookie-in-browser-but-working-with-postman", "title": "Cannot set cookie in browser but working with postman", "body": "<p>I am trying to set a cookie using go in the chrome browser but can only get it to set in postman. </p>\n\n<p>The cookie successfully sets in postman but is simply not setting in chrome with no error. \nI have set CORS as default using this package <a href=\"https://github.com/gin-contrib/cors\" rel=\"nofollow noreferrer\">https://github.com/gin-contrib/cors</a> as I have had issues with CORS requests in the past and this seemed to solve the issue.\nI set the cookie using:</p>\n\n<pre><code>c.SetCookie(\n    \"TOKEN\",\n    tokenString,\n    3600,\n    \"/\",\n    \"localhost\",\n    false,\n    true)\n</code></pre>\n\n<p>I have tried replacing localhost with <a href=\"http://127.0.0.1\" rel=\"nofollow noreferrer\">http://127.0.0.1</a> which again works in postman but not chrome or firefox. I have also tried setting the cookie with the http package instead but this has failed in the same way.</p>\n\n<p><strong>EDIT</strong> I have also tried domain as blank (\"\") but this has the same outcome.</p>\n"}, {"tags": ["go", "language-lawyer", "specifications"], "answers": [{"tags": [], "owner": {"reputation": 9371, "user_id": 196964, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/df6zG.jpg?s=128&g=1", "display_name": "Doug Richardson", "link": "https://stackoverflow.com/users/196964/doug-richardson"}, "is_accepted": false, "score": 1, "last_activity_date": 1567355770, "creation_date": 1567355770, "answer_id": 57747735, "question_id": 57747668, "link": "https://stackoverflow.com/questions/57747668/selector-of-pointer-for-method-from-base-type-in-go/57747735#57747735", "title": "Selector of pointer for method from base type in go", "body": "<p>From <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">Method Sets</a>:</p>\n\n<blockquote>\n  <p>The method set of the corresponding pointer type *T is the set of all methods declared with receiver *T or T (that is, it also contains the method set of T). </p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1567366690, "last_edit_date": 1567366690, "creation_date": 1567366372, "answer_id": 57748905, "question_id": 57747668, "link": "https://stackoverflow.com/questions/57747668/selector-of-pointer-for-method-from-base-type-in-go/57748905#57748905", "title": "Selector of pointer for method from base type in go", "body": "<p>You quoted:</p>\n\n<blockquote>\n  <p><code>x.f</code> denotes the field or method at the shallowest <strong>depth</strong> in <code>T</code></p>\n</blockquote>\n\n<p>The quote refers to <strong>depth</strong>. <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">\"Definition\" of <em>depth</em> is:</a></p>\n\n<blockquote>\n  <p>A selector <code>f</code> may denote a field or method <code>f</code> of a type <code>T</code>, or it may refer to a field or method <code>f</code> of a nested <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">embedded field</a> of <code>T</code>. <strong>The number of embedded fields traversed to reach <code>f</code> is called its depth in <code>T</code>.</strong> The depth of a field or method <code>f</code> declared in <code>T</code> is zero. The depth of a field or method <code>f</code> declared in an embedded field <code>A</code> in <code>T</code> is the depth of <code>f</code> in <code>A</code> plus one.</p>\n</blockquote>\n\n<p>The key is <strong>embedding</strong>. Your struct does not embed a single type. So by definition, the depth of your <code>T.M</code> is <strong>zero</strong>.</p>\n\n<p>Your <code>t</code> variable is of type <code>*T</code> (that is the type of the <code>&amp;T{}</code> expression, which is <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">taking the address</a> of a struct <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a>: it generates a pointer to a unique variable initialized with the literal's value).</p>\n\n<p>And quoting from <a href=\"https://golang.org/ref/spec#Method_values\" rel=\"nofollow noreferrer\">Spec: Method values:</a></p>\n\n<blockquote>\n  <p>As with <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">selectors</a>, a reference to a non-interface method with a value receiver using a pointer will automatically dereference that pointer: <code>pt.Mv</code> is equivalent to <code>(*pt).Mv</code>.</p>\n</blockquote>\n\n<p><code>t.M</code> is a reference to the non-interface method <code>T.M</code>, and since <code>t</code> is a pointer, it will be automatically dereferenced: <code>(*t).M()</code>.</p>\n\n<p>Now let's see an example where the \"at the shallowest depth\" does matter.</p>\n\n<pre><code>type T struct{}\n\nfunc (t T) M() { fmt.Println(\"T.M()\") }\n\ntype T2 struct {\n    T // Embed T\n}\n\nfunc (t T2) M() { fmt.Println(\"T2.M()\") }\n\nfunc main() {\n    var t T = T{}\n    var t2 T2 = T2{T: t}\n    t2.M()\n}\n</code></pre>\n\n<p>In <code>main()</code> we call <code>t2.M()</code>. Since <code>T2</code> embeds <code>T</code>, this could refer to <code>T2.T.M</code> and <code>T2.M</code>. But since depth of <code>T2.T.M</code> is <strong>one</strong> and depth of <code>T2.M</code> is <strong>zero</strong>, <code>T2.M</code> being at the shallowest depth in <code>T2</code>, therefore <code>t2.M</code> will denote <code>T2.M</code> and not <code>T2.T.M</code>, so the above example prints (try it on the <a href=\"https://play.golang.org/p/VQoI_Rcrln0\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>T2.M()\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 11186295, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-jPwmX-rdTtc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeHVr8jv8P1X7k8AtIY9SUs_OcLA/mo/photo.jpg?sz=128", "display_name": "Ilya Ivyev", "link": "https://stackoverflow.com/users/11186295/ilya-ivyev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1567366690, "creation_date": 1567355245, "last_edit_date": 1567356000, "question_id": 57747668, "link": "https://stackoverflow.com/questions/57747668/selector-of-pointer-for-method-from-base-type-in-go", "title": "Selector of pointer for method from base type in go", "body": "<p>It's obvious that the following code will work fine:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype T struct {\n    a int\n}\n\nfunc (t T) M() {\n    fmt.Println(\"M method\")\n}\n\nfunc main() {\n    var t = &amp;T{1}\n    t.M() // it's interesting\n}\n\n</code></pre>\n\n<p>But as I can see from <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">specification</a>:</p>\n\n<blockquote>\n  <p>For a value x of type T or *T where T is not a pointer or interface type, <strong>x.f denotes the field or method at the shallowest depth in T</strong> where there is such an f. If there is not exactly one f with shallowest depth, the selector expression is illegal.</p>\n</blockquote>\n\n<p>But in example <code>M</code> is not from <code>*T</code>, it's from <code>T</code>. I know that <code>*T</code> includes method set of <code>T</code> but as I can see specification doesn't tell us about method set of <code>*T</code>. Do I understand the specification wrong or correctness of the line with comment is based on some other specification rule?</p>\n"}, {"tags": ["algorithm", "go"], "comments": [{"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1567336036, "post_id": 57745439, "comment_id": 101928873, "body": "&quot;it&#39;s not working&quot; is not a precise enough error description for us to help you. <i>What</i> doesn&#39;t work? <i>How</i> doesn&#39;t it work? What trouble do you have with your code? Do you get an error message? What is the error message? Is the result you are getting not the result you are expecting? What result do you expect and why, what is the result you are getting and how do the two differ? Is the behavior you are observing not the desired behavior? What is the desired behavior and why, what is the observed behavior, and in what way do they differ?"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 2, "creation_date": 1567336107, "post_id": 57745439, "comment_id": 101928892, "body": "Also, please make sure to construct a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. I have a feeling that your example is not really minimal. Are you 100% sure it requires 27 lines to demonstrate your problem? Is it not maybe also possible in 26? Or even just 1?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1567338436, "post_id": 57745439, "comment_id": 101929335, "body": "@J&#246;rgWMittag: The question included a concise problem statement, &quot;How remove white spaces in Go&quot;, input &quot;I d skd a efju N&quot; and expected output &quot;IdskdaefjuN&quot;. It is clear."}, {"owner": {"reputation": 175, "user_id": 11110911, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1_0cZNmB6mU/AAAAAAAAAAI/AAAAAAAAB7U/qokJIkyL-6w/photo.jpg?sz=128", "display_name": "Leonardo Severo", "link": "https://stackoverflow.com/users/11110911/leonardo-severo"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1567338516, "post_id": 57745439, "comment_id": 101929348, "body": "@J&#246;rgWMittag I&#39;m referring to user input, the method for removing whitespace, and final output, the code is complete just to make it easy to execute if someone really wants to understand the need or even realize an error that I didn&#39;t realize elsewhere in code..."}], "answers": [{"comments": [{"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1567395255, "post_id": 57745493, "comment_id": 101939266, "body": "Can you explain your solution? Because <code>string.ReplaceAll</code> also works in the playground. <a href=\"https://play.golang.org/p/dNYHn-AkVXf\" rel=\"nofollow noreferrer\">play.golang.org/p/dNYHn-AkVXf</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 1, "creation_date": 1567400651, "post_id": 57745493, "comment_id": 101940090, "body": "@Jesse: The question asks: &quot;How remove white spaces in Go?&quot; See <a href=\"https://en.wikipedia.org/wiki/Whitespace_character\" rel=\"nofollow noreferrer\">Wikipedia: Whitespace character</a>. I removed all Unicode White_Space characters. Also, see the Go standard library <a href=\"https://golang.org/pkg/strings/#TrimSpace\" rel=\"nofollow noreferrer\">strings.TrimSpace</a> function.Your code (<a href=\"https://play.golang.org/p/dNYHn-AkVXf\" rel=\"nofollow noreferrer\">play.golang.org/p/dNYHn-AkVXf</a>) only removes the ASCII space character. It does not remove all white space."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1567514096, "last_edit_date": 1567514096, "creation_date": 1567336312, "answer_id": 57745493, "question_id": 57745439, "link": "https://stackoverflow.com/questions/57745439/how-remove-white-spaces-in-go/57745493#57745493", "title": "How remove white spaces in Go", "body": "<blockquote>\n  <p>How remove white spaces in Go</p>\n</blockquote>\n\n<hr>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unicode\"\n)\n\nfunc removeSpace(s string) string {\n    rr := make([]rune, 0, len(s))\n    for _, r := range s {\n        if !unicode.IsSpace(r) {\n            rr = append(rr, r)\n        }\n    }\n    return string(rr)\n}\n\nfunc main() {\n    s := \"I d skd a efju N\"\n    fmt.Println(s)\n    s = removeSpace(s)\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/KoXZ24WXw7r\" rel=\"nofollow noreferrer\">https://play.golang.org/p/KoXZ24WXw7r</a></p>\n\n<p>Output:</p>\n\n<pre><code>I d skd a efju N\nIdskdaefjuN\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1567402108, "post_id": 57751147, "comment_id": 101940400, "body": "Your code fails on Windows: <code>please, type some text:ian</code> <code>Not Found in ian</code>. On Windows, newline is <code>&quot;\\r\\n&quot;</code>. Use <code>bufio.Scanner</code> to read lines."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1567402474, "post_id": 57751147, "comment_id": 101940453, "body": "The question: &quot;How remove white spaces in Go&quot; Your code removes ASCII space. It does not remove <a href=\"https://en.wikipedia.org/wiki/Whitespace_character\" rel=\"nofollow noreferrer\">white space</a>."}], "tags": [], "owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "is_accepted": true, "score": 1, "last_activity_date": 1567395469, "creation_date": 1567395469, "answer_id": 57751147, "question_id": 57745439, "link": "https://stackoverflow.com/questions/57745439/how-remove-white-spaces-in-go/57751147#57751147", "title": "How remove white spaces in Go", "body": "<p>When I tried running your code it wasn't reading from stdin properly using <code>fmt.Scan()</code>. If you replace it with a buffered reader that's reading from stdin it works:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strings\"\n)\n\nfunc main() {\n    //var String\n    var stringValue string\n    var originalValue string\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Printf(\"please, type some text:\")\n    //user input\n    stringValue, _ = reader.ReadString('\\n')\n    stringValue = strings.TrimSuffix(stringValue, \"\\n\")\n    originalValue = stringValue\n    //remove spaces\n    stringValue = strings.ReplaceAll(stringValue, \" \", \"\")\n    //set string to lower case\n    stringValue = strings.ToLower(stringValue)\n    //if contains substring \"i\", \"a\" and \"n\"\n    if strings.Contains(stringValue, \"i\") &amp;&amp; strings.Contains(stringValue, \"a\") &amp;&amp; strings.Contains(stringValue, \"n\") {\n        // if \"i\" is a prefix and \"n\" a suffix\n        firstChar := strings.HasPrefix(stringValue, \"i\")\n        lastChar := strings.HasSuffix(stringValue, \"n\")\n        switch {\n        //if is a prefix and suffix so Found\n        case firstChar &amp;&amp; lastChar:\n            fmt.Printf(\"Found in %s\", originalValue)\n        //if isnt a prefix and suffix so Not Found\n        default:\n            fmt.Printf(\"Not Found in %s\", originalValue)\n        }\n        //if there's no \"i\", \"a\" and \"n\"\n    } else {\n        fmt.Printf(\"Not Found in %s\", originalValue)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 175, "user_id": 11110911, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-1_0cZNmB6mU/AAAAAAAAAAI/AAAAAAAAB7U/qokJIkyL-6w/photo.jpg?sz=128", "display_name": "Leonardo Severo", "link": "https://stackoverflow.com/users/11110911/leonardo-severo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2851, "favorite_count": 1, "accepted_answer_id": 57751147, "answer_count": 2, "score": 0, "last_activity_date": 1567514096, "creation_date": 1567335853, "question_id": 57745439, "link": "https://stackoverflow.com/questions/57745439/how-remove-white-spaces-in-go", "title": "How remove white spaces in Go", "body": "<p>I want remove spaces in String value, for example: \"I d skd a efju N\" to \"IdskdaefjuN\" and it's not working...</p>\n\n<p>I tried using:</p>\n\n<pre><code>stringValue = strings.Replace(stringValue, \" \", \"\", -1)\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    //var String\n    var stringValue string\n    var originalValue string\n    fmt.Printf(\"please, type some text:\")\n    //user input\n    fmt.Scan(&amp;stringValue)\n    originalValue = stringValue\n    //remove spaces\n    stringValue = strings.Replace(stringValue, \" \", \"\", -1)\n    //set string to lower case\n    stringValue = strings.ToLower(stringValue)\n    //if contains substring \"i\", \"a\" and \"n\"\n    if strings.Contains(stringValue, \"i\") &amp;&amp; strings.Contains(stringValue, \"a\") &amp;&amp; strings.Contains(stringValue, \"n\") {\n        // if \"i\" is a prefix and \"n\" a suffix\n        firstChar := strings.HasPrefix(stringValue, \"i\")\n        lastChar := strings.HasSuffix(stringValue, \"n\")\n        switch {\n        //if is a prefix and suffix so Found\n        case firstChar &amp;&amp; lastChar:\n            fmt.Printf(\"Found in %s\", originalValue)\n        //if isnt a prefix and suffix so Not Found\n        default:\n            fmt.Printf(\"Not Found in %s\", originalValue)\n        }\n        //if there's no \"i\", \"a\" and \"n\"\n    } else {\n        fmt.Printf(\"Not Found in %s\", originalValue)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "inheritance", "logging"], "answers": [{"tags": [], "owner": {"reputation": 649, "user_id": 554480, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/m1Kjt.png?s=128&g=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/554480/mikhail"}, "is_accepted": true, "score": 5, "last_activity_date": 1567333005, "creation_date": 1567333005, "answer_id": 57745116, "question_id": 57745017, "link": "https://stackoverflow.com/questions/57745017/zap-log-framework-go-initialize-log-once-and-reuse-from-other-go-file-solved/57745116#57745116", "title": "(Zap log framework, Go) Initialize log once and reuse from other Go file (Solved)", "body": "<p>You can set up your logger in the main function and call <a href=\"https://godoc.org/go.uber.org/zap#ReplaceGlobals\" rel=\"noreferrer\">https://godoc.org/go.uber.org/zap#ReplaceGlobals</a> to use it as a default global logger.</p>\n"}, {"tags": [], "owner": {"reputation": 532, "user_id": 1035997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b29436df85df3211ced41a2e916cfb6b?s=128&d=identicon&r=PG", "display_name": "ammills01", "link": "https://stackoverflow.com/users/1035997/ammills01"}, "is_accepted": false, "score": 5, "last_activity_date": 1578067560, "last_edit_date": 1578067560, "creation_date": 1577993402, "answer_id": 59568969, "question_id": 57745017, "link": "https://stackoverflow.com/questions/57745017/zap-log-framework-go-initialize-log-once-and-reuse-from-other-go-file-solved/59568969#59568969", "title": "(Zap log framework, Go) Initialize log once and reuse from other Go file (Solved)", "body": "<p>Replacing the default go Global logger with zaps' implementation is possible, but discouraged.</p>\n\n<p>Per their <a href=\"https://github.com/uber-go/zap/blob/master/FAQ.md#why-include-package-global-loggers\" rel=\"nofollow noreferrer\">FAQ</a></p>\n\n<blockquote>\n  <p>Why include package-global loggers? Since so many other logging\n  packages include a global logger, many applications aren't designed to\n  accept loggers as explicit parameters. Changing function signatures is\n  often a breaking change, so zap includes global loggers to simplify\n  migration.</p>\n  \n  <p><strong>Avoid them where possible.</strong></p>\n</blockquote>\n\n<p>Depending on your needs, you can create a logger in main and pass it around or create a new logger in each package. I elected to create one in main and pass it around since I'm using an Atomic logger, which allows me to change log levels while my app is running via an API call. With a long history of using DI and consolidating code in general it does feel like code smell, but apparently it's significantly more performant for how zap works to pass it around over a singleton or global.</p>\n"}], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7329, "favorite_count": 1, "accepted_answer_id": 57745116, "answer_count": 2, "score": 10, "last_activity_date": 1578067560, "creation_date": 1567332187, "last_edit_date": 1576227980, "question_id": 57745017, "link": "https://stackoverflow.com/questions/57745017/zap-log-framework-go-initialize-log-once-and-reuse-from-other-go-file-solved", "title": "(Zap log framework, Go) Initialize log once and reuse from other Go file (Solved)", "body": "<p>I'm trying to migrate my application from the beautiful Logrus (very helpful for debug) and introducing the Uber log framework Zap.</p>\n\n<p>With Logrus, i can initialize the logger only once and reuse it from other Go file, an example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\nimport(\n    // Print filename on log\n    filename \"github.com/onrik/logrus/filename\"\n    // Very nice log library\n    log \"github.com/sirupsen/logrus\"\n)\n\nfunc main(){\n\n// ==== SET LOGGING\n    Formatter := new(log.TextFormatter)\n    Formatter.TimestampFormat = \"Jan _2 15:04:05.000000000\"\n    Formatter.FullTimestamp = true\n    Formatter.ForceColors = true\n    log.AddHook(filename.NewHook()) // Print filename + line at every log\n    log.SetFormatter(Formatter)\n\n}\n</code></pre>\n\n<p>From other Go file, i'm able to reuse that logger without any other initialization:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// VerifyCommandLineInput is delegated to manage the inputer parameter provide with the input flag from command line\nfunc VerifyCommandLineInput() datastructures.Configuration {\n    log.Debug(\"VerifyCommandLineInput | Init a new configuration from the conf file\")\n    c := flag.String(\"config\", \"./conf/test.json\", \"Specify the configuration file.\")\n    flag.Parse()\n    if strings.Compare(*c, \"\") == 0 {\n        log.Fatal(\"VerifyCommandLineInput | Call the tool using --config conf/config.json\")\n    }\n    file, err := os.Open(*c)\n    if err != nil {\n        log.Fatal(\"VerifyCommandLineInput | can't open config file: \", err)\n    }\n    defer file.Close()\n    decoder := json.NewDecoder(file)\n    cfg := datastructures.Configuration{}\n    err = decoder.Decode(&amp;cfg)\n    if err != nil {\n        log.Fatal(\"VerifyCommandLineInput | can't decode config JSON: \", err)\n    }\n    log.Debug(\"VerifyCommandLineInput | Conf loaded -&gt; \", cfg)\n\n    return cfg\n}\n\n</code></pre>\n\n<p>My question is:<br>\nUsing the Zap log framework, how can i initialize the log in the main function and use that logger from the other Go file?</p>\n\n<hr>\n\n<p><strong><em>Solution</em></strong>: </p>\n\n<p>Initialize a new log and set as global as pointed by @Mikhail.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport(\n    \"go.uber.org/zap\"\n    \"go.uber.org/zap/zapcore\"\n)\n\nfunc initZapLog() *zap.Logger {\n    config := zap.NewDevelopmentConfig()\n    config.EncoderConfig.EncodeLevel = zapcore.CapitalColorLevelEncoder\n    config.EncoderConfig.TimeKey = \"timestamp\"\n    config.EncoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder\n    logger, _ := config.Build()\n    return logger\n}\n\nfunc main() {\n\n    loggerMgr := initZapLog()\n    zap.ReplaceGlobals(loggerMgr)\n    defer loggerMgr.Sync() // flushes buffer, if any\n    logger := loggerMgr.Sugar()\n    logger.Debug(\"START!\")\n    db2.GetToken(`alessio`, `savi`, `pass`)\n    datastructure.LoadConfiguration()\n}\n\n</code></pre>\n\n<p>Than you can use the logger in the other Go file: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func GetToken(url, user, pass string) string {\n    var User datastructure.User\n    var data string\n    var jsonData []byte\n\n    User.User = user\n    User.Pass = pass\n    jsonData, err := json.Marshal(User)\n    if err != nil {\n        zap.S().Errorw(\"Error during marshalling...\", err)\n        return \"\"\n    }\n    data = string(jsonData)\n    zap.S().Info(\"Data encoded =&gt; \", data)\n    return \"\"\n}\n</code></pre>\n"}, {"tags": ["go", "x509certificate"], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 0, "last_activity_date": 1567338966, "creation_date": 1567338966, "answer_id": 57745777, "question_id": 57744933, "link": "https://stackoverflow.com/questions/57744933/compare-client-certificates-in-go/57745777#57745777", "title": "compare client certificates in go", "body": "<p>A certificate is more than its public key. The entire <a href=\"https://golang.org/pkg/crypto/x509/#Certificate\" rel=\"nofollow noreferrer\">x509.Certificate</a> object represents the certificate presented by the client, the public key field is only the actual value of the public key.</p>\n\n<p>If you want to compare certificates for strict equality, you should use the <code>rawCerts [][]byte</code> argument passed to your callback. This is mentioned in the <a href=\"https://golang.org/pkg/crypto/tls/#Config\" rel=\"nofollow noreferrer\">tls.Config</a> comments for <code>VerifyPeerCertificate</code>:</p>\n\n<pre><code>    VerifyPeerCertificate, if not nil, is called after normal\n    certificate verification by either a TLS client or server. It\n    receives the raw ASN.1 certificates provided by the peer and also\n    any verified chains that normal processing found. If it returns a\n    non-nil error, the handshake is aborted and that error results.\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 456, "user_id": 1791139, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/17b558da65ba5eba2ff57f1f5ef2447a?s=128&d=identicon&r=PG", "display_name": "user1791139", "link": "https://stackoverflow.com/users/1791139/user1791139"}, "is_accepted": false, "score": 0, "last_activity_date": 1567354592, "creation_date": 1567354592, "answer_id": 57747603, "question_id": 57744933, "link": "https://stackoverflow.com/questions/57744933/compare-client-certificates-in-go/57747603#57747603", "title": "compare client certificates in go", "body": "<p>Thanks to Marc, I know that I used the wrong variable. To convert the certificate as a string, as used by the client, use the following code</p>\n\n<pre><code>publicKeyBlock := pem.Block{\n  Type:  \"CERTIFICATE\",\n  Bytes: rawCerts[0],\n}\npublicKeyPem := string(pem.EncodeToMemory(&amp;publicKeyBlock))\n</code></pre>\n"}], "owner": {"reputation": 456, "user_id": 1791139, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/17b558da65ba5eba2ff57f1f5ef2447a?s=128&d=identicon&r=PG", "display_name": "user1791139", "link": "https://stackoverflow.com/users/1791139/user1791139"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 366, "favorite_count": 0, "accepted_answer_id": 57745777, "answer_count": 2, "score": 1, "last_activity_date": 1567354592, "creation_date": 1567331442, "question_id": 57744933, "link": "https://stackoverflow.com/questions/57744933/compare-client-certificates-in-go", "title": "compare client certificates in go", "body": "<p>My use case looks like I know the public certificates of my clients and only want to allow them. I have a go server based on gin and a TLS configuration in which I have assigned a method to the property \"VerifyPeerCertificate\".\nThe function looks like</p>\n\n<pre><code>func customVerifyPeerCertificate(rawCerts [][]byte, verifiedChains [][]*x509.Certificate) error {\n\nif len(verifiedChains) &lt; 1 {\n    return errors.New(\"Verified certificate chains is empty.\")\n}\nif len(verifiedChains[0]) &lt; 1 {\n    return errors.New(\"No certificates in certificate chains.\")\n}\nif len(verifiedChains[0][0].Subject.CommonName) &lt; 1 {\n    return errors.New(\"Common name can not be empty.\")\n}\n\nfmt.Println(verifiedChains[0][0].Raw)\n\npublicKeyDer, _ := x509.MarshalPKIXPublicKey(verifiedChains[0][0].PublicKey)\n\npublicKeyBlock := pem.Block{\n    Type:  \"CERTIFICATE\",\n    Bytes: publicKeyDer,\n}\npublicKeyPem := string(pem.EncodeToMemory(&amp;publicKeyBlock))\n}\n</code></pre>\n\n<p>The problem is, however, that the string in the variable \"publicKeyPem\" does not look like the client public certificate I used to send the request to the server, it's also shorter in length.</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 1, "creation_date": 1567396177, "post_id": 57744765, "comment_id": 101939412, "body": "Have you tried <code>db.Preload(&quot;RelC.RelD&quot;)</code>? The docs are pretty terrible for gorm which is why I just switched to doing raw SQL, since stuff like this is a pain."}, {"owner": {"reputation": 23, "user_id": 6545506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43f90b1946939fd8f1b5c46b420d6958?s=128&d=identicon&r=PG&f=1", "display_name": "yue guan", "link": "https://stackoverflow.com/users/6545506/yue-guan"}, "reply_to_user": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1567433087, "post_id": 57744765, "comment_id": 101952854, "body": "@Jesse  i had tried this. Calls the same error"}], "owner": {"reputation": 23, "user_id": 6545506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43f90b1946939fd8f1b5c46b420d6958?s=128&d=identicon&r=PG&f=1", "display_name": "yue guan", "link": "https://stackoverflow.com/users/6545506/yue-guan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 278, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1569988010, "creation_date": 1567329960, "last_edit_date": 1569988010, "question_id": 57744765, "link": "https://stackoverflow.com/questions/57744765/how-to-preload-with-gorm-in-nested-struct", "title": "How to Preload with Gorm in nested Struct", "body": "<p>Here are the Struct relations:</p>\n\n<pre><code>    type A struct {\n       Id int64 \n       RelB []B `gorm:\"FOREIGNKEY:Aid;ASSOCIATION_FOREIGNKEY:Id\"`\n    }\n    type B strcut {\n       Id int64\n       Aid int64\n       RelC []C `gorm:\"FOREIGNKEY:Bid;ASSOCIATION_FOREIGNKEY:Id\"`\n    }\n    type C struct {\n       Id int64\n       Bid int64\n       RelD []D `gorm:\"FOREIGNKEY:Cid;ASSOCIATION_FOREIGNKEY:Id\"`\n    }\n    type D struct {\n       Id int64\n       Cid int64\n    }\n</code></pre>\n\n<p>I try to find all of these relations with Preload like this:</p>\n\n<pre><code>var result []A    \ndb.Preload(\"RelB\").Preload(\"RelB.RelC\"). // if only three structs relations it works fine so far\nPreload(\"RelB.RelC.RelD\"). // it shows errors can not preload field RelD for A\nFind(&amp;result)\n</code></pre>\n\n<p>So, How to relate these four structs with preload? Or there is other better way?\nThanks</p>\n"}, {"tags": ["algorithm", "go"], "comments": [{"owner": {"reputation": 1646, "user_id": 7501501, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/24ed8d70ce334750ebb5f7e387d402b5?s=128&d=identicon&r=PG&f=1", "display_name": "Yonlif", "link": "https://stackoverflow.com/users/7501501/yonlif"}, "edited": false, "score": 0, "creation_date": 1567327274, "post_id": 57744282, "comment_id": 101927195, "body": "Could you please rename the variables to english? That would help. I think you just need to make <code>bil</code> go from 0 to 9."}], "answers": [{"tags": [], "owner": {"reputation": 547, "user_id": 10201437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9066621f4fa9987ca2148edc002bf057?s=128&d=identicon&r=PG&f=1", "display_name": "ConnectionLost", "link": "https://stackoverflow.com/users/10201437/connectionlost"}, "is_accepted": false, "score": 1, "last_activity_date": 1567327799, "creation_date": 1567327799, "answer_id": 57744551, "question_id": 57744282, "link": "https://stackoverflow.com/questions/57744282/how-can-i-make-a-pyramid-loop-of-number-but-in-reverse/57744551#57744551", "title": "How can i make a pyramid loop of number but in reverse", "body": "<p>Just change the way you calculate the current number (<code>fmt.Print(bil-d)</code>)</p>\n\n<pre><code>func main() {\n    var (\n        input, bil int\n    )\n\n    fmt.Scanln(&amp;input)\n    bil = 9\n    for b := 1; b &lt;= input; b++ {\n        for c := input; c &gt;= b; c-- {\n            fmt.Print(\" \")\n        }\n\n        for d := b - 1; d &gt;= 0; d-- {\n            v := bil - d\n            if v &lt; 0 {\n                v = v%10 + 10\n            }\n            fmt.Print(v)\n        }\n        bil -= b\n        if bil &lt; 0 {\n            bil = bil%10 + 10\n        }\n        fmt.Println()\n\n    }\n}\n</code></pre>\n\n<p>Note that I also change the handling of boundary conditions.</p>\n"}], "owner": {"reputation": 19, "user_id": 8455163, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2zUbVHSEdU4/AAAAAAAAAAI/AAAAAAAAAPE/XFuTGNyO_W8/photo.jpg?sz=128", "display_name": "kurniadi wijaya", "link": "https://stackoverflow.com/users/8455163/kurniadi-wijaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1567327799, "creation_date": 1567325528, "question_id": 57744282, "link": "https://stackoverflow.com/questions/57744282/how-can-i-make-a-pyramid-loop-of-number-but-in-reverse", "title": "How can i make a pyramid loop of number but in reverse", "body": "<p>I encounter a problem when try to make a pyramid of number in reverse of golang </p>\n\n<p>I already can make a pyramid of number with this code :</p>\n\n<pre><code>var (\n        input, bil int\n    )\n\n    fmt.Scanln(&amp;input)\n    bil = 9\n    for b := 1; b &lt;= input; b++ {\n        for c := input; c &gt;= b; c-- { //spasi\n            fmt.Print(\" \")\n        }\n        for d := 1; d &lt;= b; d++ { //bintang\n\n            fmt.Print(bil)\n\n            if bil == -1 {\n                bil = 9\n            }\n            bil = bil - 1\n        }\n        fmt.Println()\n\n    }\n</code></pre>\n\n<p>Input : </p>\n\n<pre><code>5\n</code></pre>\n\n<p>Output : </p>\n\n<pre><code>     9\n    87\n   654\n  3210\n 98765\n</code></pre>\n\n<p>How do I make a reverse one like this</p>\n\n<p>input:</p>\n\n<pre><code>5\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>    9\n   78\n  456\n 0123\n56789\n\n</code></pre>\n"}, {"tags": ["vue.js", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567309810, "post_id": 57743033, "comment_id": 101924814, "body": "The wails app was broken by <a href=\"https://github.com/Masterminds/semver/commit/23f51de38a0866c5ef0bfc42b3f735c73107b700\" rel=\"nofollow noreferrer\">a change</a> to <code>github.com&#47;masterminds&#47;semver</code>."}, {"owner": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567310811, "post_id": 57743033, "comment_id": 101924914, "body": "So I should wait for this to be fixed?  I am assuming"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567311228, "post_id": 57743033, "comment_id": 101924972, "body": "You can wait for a fix or checkout an older version of github.com/masterminds/semver."}], "answers": [{"comments": [{"owner": {"reputation": 1118, "user_id": 5385625, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/CKfR0.jpg?s=128&g=1", "display_name": "Sam Orozco", "link": "https://stackoverflow.com/users/5385625/sam-orozco"}, "edited": false, "score": 0, "creation_date": 1601661212, "post_id": 57801543, "comment_id": 113485201, "body": "This didn&#39;t for me. The command is still not being installed."}, {"owner": {"reputation": 1, "user_id": 8325411, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-NXWMtRUC3FQ/AAAAAAAAAAI/AAAAAAAAMBM/LVlWnEOeqqo/photo.jpg?sz=128", "display_name": "LAnthony", "link": "https://stackoverflow.com/users/8325411/lanthony"}, "reply_to_user": {"reputation": 1118, "user_id": 5385625, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/CKfR0.jpg?s=128&g=1", "display_name": "Sam Orozco", "link": "https://stackoverflow.com/users/5385625/sam-orozco"}, "edited": false, "score": 0, "creation_date": 1603166737, "post_id": 57801543, "comment_id": 113942786, "body": "Check your PATH has the <code>go&#47;bin</code> directory in it."}], "tags": [], "owner": {"reputation": 1, "user_id": 8325411, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-NXWMtRUC3FQ/AAAAAAAAAAI/AAAAAAAAMBM/LVlWnEOeqqo/photo.jpg?sz=128", "display_name": "LAnthony", "link": "https://stackoverflow.com/users/8325411/lanthony"}, "is_accepted": false, "score": -1, "last_activity_date": 1567672625, "creation_date": 1567672625, "answer_id": 57801543, "question_id": 57743033, "link": "https://stackoverflow.com/questions/57743033/go-get-wails-is-not-installing-properly/57801543#57801543", "title": "go get wails is not installing properly", "body": "<p><code>go get github.com/wailsapp/wails/cmd/wails</code> was indeed broken by a change in Masterminds/semver, however the official way to install Wails is to ensure you have <code>GO111MODULE=on</code> before installing. This generally will safeguard you from this issue.</p>\n"}, {"tags": [], "owner": {"reputation": 8483, "user_id": 6108211, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/bZBT3.png?s=128&g=1", "display_name": "Dmitry Grinko", "link": "https://stackoverflow.com/users/6108211/dmitry-grinko"}, "is_accepted": false, "score": 0, "last_activity_date": 1615444699, "creation_date": 1615444699, "answer_id": 66577560, "question_id": 57743033, "link": "https://stackoverflow.com/questions/57743033/go-get-wails-is-not-installing-properly/66577560#66577560", "title": "go get wails is not installing properly", "body": "<p>Make sure your shell file has:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>export GO111MODULE=on\nexport PATH=$PATH:~/go/bin\n</code></pre>\n"}], "owner": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 589, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1615444699, "creation_date": 1567309109, "question_id": 57743033, "link": "https://stackoverflow.com/questions/57743033/go-get-wails-is-not-installing-properly", "title": "go get wails is not installing properly", "body": "<p>Trying to use...  golang and wails...   but after this...</p>\n\n<p><code>go get github.com/wailsapp/wails/cmd/wails</code></p>\n\n<p>I am getting this.</p>\n\n<pre><code>   ../../github.com/wailsapp/wails/cmd/semver.go:21:3: cannot use semverVersion (type semver.Version) as type *semver.Version in field value\n../../github.com/wailsapp/wails/cmd/semver.go:48:40: cannot use s.Version (type *semver.Version) as type semver.Version in argument to constraint.Validate\n../../github.com/wailsapp/wails/cmd/semver.go:64:40: cannot use s.Version (type *semver.Version) as type semver.Version in argument to constraint.Validate\n../../github.com/wailsapp/wails/cmd/semver.go:91:35: cannot use c[j].Version (type *semver.Version) as type semver.Version in argument to c[i].Version.LessThan\n</code></pre>\n\n<p>and\n<code>wails init</code>   also not working.</p>\n\n<p>The latest versions of get and golang installed.</p>\n\n<p>any sugestions?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1567306854, "creation_date": 1567306854, "answer_id": 57742906, "question_id": 57742892, "link": "https://stackoverflow.com/questions/57742892/how-to-make-query-result-structure-match-to-what-ive-been-declared-on-gorm-sele/57742906#57742906", "title": "How to make query result structure match to what i&#39;ve been declared on GORM Select", "body": "<p>It looks like all you need to do is to omit empty fields. You can do that by adding omitempty to json tags:</p>\n\n<pre><code>    Password string `json:\"password,omitempty\"`\n    Token    string `json:\"token,omitempty\" gorm:\"-\"`\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 5646141, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf9f0d754a54d57d96bc63fd23d9df2a?s=128&d=identicon&r=PG&f=1", "display_name": "mtlps", "link": "https://stackoverflow.com/users/5646141/mtlps"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 57742906, "answer_count": 1, "score": 0, "last_activity_date": 1567306854, "creation_date": 1567306580, "question_id": 57742892, "link": "https://stackoverflow.com/questions/57742892/how-to-make-query-result-structure-match-to-what-ive-been-declared-on-gorm-sele", "title": "How to make query result structure match to what i&#39;ve been declared on GORM Select", "body": "<p>I want to make the structure of the query results match what I have stated in GORM Select because right now it only matches the Struct structure. How do i make it work? Thank you in advance</p>\n\n<p>i've tried to make new Struct and it works, but i dont know is it a best practice or not</p>\n\n<pre><code>type User struct {\n    User_Id  uint   `json:\"user_id\" gorm:\"column:user_id; PRIMARY_KEY\"`\n    Email    string `json:\"email\"`\n    Password string `json:\"password\"`\n    Token    string `json:\"token\" gorm:\"-\"`\n}\n\nfunc GetUsers() map[string]interface{} {\n    users := []User{}\n    GetDB().Table(\"app_user\").Select(\"user_id, email\").Find(&amp;users)\n    resp := u.Message(true, \"All users\")\n    resp[\"users\"] = users\n    return resp\n}\n</code></pre>\n\n<pre><code>//actual result\n{\n    \"message\": \"All users\",\n    \"status\": true,\n    \"users\": [\n        {\n            \"user_id\": 1732,\n            \"email\": \"aaaaaaa@gmail.com\",\n            \"password\": \"\",\n            \"token\": \"\"\n        },\n        {\n            \"user_id\": 1733,\n            \"email\": \"bbbbbbb@gmail.com\",\n            \"password\": \"\",\n            \"token\": \"\"\n        },\n    ]\n}\n\n//Expected result \n{\n    \"message\": \"All users\",\n    \"status\": true,\n    \"users\": [\n        {\n            \"user_id\": 1732,\n            \"email\": \"aaaaaaa@gmail.com\"\n        },\n        {\n            \"user_id\": 1733,\n            \"email\": \"bbbbbbb@gmail.com\"\n        }\n     ]\n}\n</code></pre>\n"}, {"tags": ["http", "go", "gzip", "go-chi"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1567281388, "post_id": 57740979, "comment_id": 101921450, "body": "The problem has nothing to do with gzip at all. You&#39;re issuing a HEAD request, but your server doesn&#39;t accept HEAD, it expects GET."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 1, "creation_date": 1567284452, "post_id": 57740979, "comment_id": 101922058, "body": "Also, issuing HEAD instead of GET when you want a compressed response body makes no sense since HEAD has no response body at all."}, {"owner": {"reputation": 341, "user_id": 4103333, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-LLtDeVl2Hmg/AAAAAAAAAAI/AAAAAAAAAHM/9VlF4K8lJv4/photo.jpg?sz=128", "display_name": "jhoss", "link": "https://stackoverflow.com/users/4103333/jhoss"}, "edited": false, "score": 0, "creation_date": 1567296116, "post_id": 57740979, "comment_id": 101923583, "body": "Thanks for the answers, now I understand better"}], "answers": [{"comments": [{"owner": {"reputation": 1569, "user_id": 6683117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sZK1t.jpg?s=128&g=1", "display_name": "Zaytsev Dmitry", "link": "https://stackoverflow.com/users/6683117/zaytsev-dmitry"}, "edited": false, "score": 0, "creation_date": 1609171218, "post_id": 57742278, "comment_id": 115766562, "body": "This answer is outdated, use @Mikel Pascual answer"}], "tags": [], "owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "is_accepted": true, "score": 0, "last_activity_date": 1567294761, "creation_date": 1567294761, "answer_id": 57742278, "question_id": 57740979, "link": "https://stackoverflow.com/questions/57740979/how-enable-gzip-compression-middleware-in-go-chi/57742278#57742278", "title": "How enable gzip compression middleware in go-chi", "body": "<p>Use the commented <code>middleware.DefaultCompress</code> and a normal <code>GET</code> request.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/go-chi/chi\"\n    \"github.com/go-chi/chi/middleware\"\n)\n\nfunc main() {\n    r := chi.NewRouter()\n    r.Use(middleware.RequestID)\n    r.Use(middleware.Logger)\n    r.Use(middleware.DefaultCompress)\n    r.Get(\"/\", Hello)\n    http.ListenAndServe(\":3333\", r)\n}\n\nfunc Hello(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"text/html\")\n    w.Write([]byte(\"hello world\\n\"))\n}\n</code></pre>\n\n<p>Try with <code>curl</code>:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ curl -v http://localhost:3333 --compressed\n* Rebuilt URL to: http://localhost:3333/\n*   Trying 127.0.0.1...\n* TCP_NODELAY set\n* Connected to localhost (127.0.0.1) port 3333 (#0)\n&gt; GET / HTTP/1.1\n&gt; Host: localhost:3333\n&gt; User-Agent: curl/7.58.0\n&gt; Accept: */*\n&gt; Accept-Encoding: deflate, gzip\n&gt;\n&lt; HTTP/1.1 200 OK\n&lt; Content-Encoding: gzip\n&lt; Content-Type: text/html\n&lt; Date: Sat, 31 Aug 2019 23:37:52 GMT\n&lt; Content-Length: 36\n&lt;\nhello world\n* Connection #0 to host localhost left intact\n</code></pre>\n\n<p>Or <code>HTTPie</code>:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ http :3333\nHTTP/1.1 200 OK\nContent-Encoding: gzip\nContent-Length: 36\nContent-Type: text/html\nDate: Sat, 31 Aug 2019 23:38:31 GMT\n\nhello world\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 313, "user_id": 6061609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lx0K0svofCE/AAAAAAAAAAI/AAAAAAAAACk/m3TYdvfwqW8/photo.jpg?sz=128", "display_name": "Leon", "link": "https://stackoverflow.com/users/6061609/leon"}, "edited": false, "score": 0, "creation_date": 1612561251, "post_id": 59981157, "comment_id": 116815070, "body": "Thanks. To me, no &quot;()&quot; for &quot;Handler&quot;: ``` compressor := middleware.NewCompressor(flate.DefaultCompression) r.Use(compressor.Handler) ```"}], "tags": [], "owner": {"reputation": 233, "user_id": 266207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ab34519e582c07acf545f81b791839a?s=128&d=identicon&r=PG", "display_name": "Marco Borromeo", "link": "https://stackoverflow.com/users/266207/marco-borromeo"}, "is_accepted": false, "score": 5, "last_activity_date": 1580370192, "creation_date": 1580370192, "answer_id": 59981157, "question_id": 57740979, "link": "https://stackoverflow.com/questions/57740979/how-enable-gzip-compression-middleware-in-go-chi/59981157#59981157", "title": "How enable gzip compression middleware in go-chi", "body": "<p><code>r.Use(middleware.DefaultCompress)</code> has now been marked as <code>DEPRECATED</code>.</p>\n\n<p>To enable compression you need to create a compressor, and use its handler.</p>\n\n<pre><code>r := chi.NewRouter()\nr.Use(middleware.RequestID)\nr.Use(middleware.Logger)\n\ncompressor := middleware.NewCompressor(flate.DefaultCompression)\nr.Use(compressor.Handler())\n\nr.Get(\"/\", Hello)\nhttp.ListenAndServe(\":3333\", r)\n</code></pre>\n\n<p>The <code>flate</code> package must be imported as <code>compress/flate</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1894, "user_id": 2001566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eff94f193bc99604d15ebd7d7a9f846?s=128&d=identicon&r=PG", "display_name": "Mikel Pascual", "link": "https://stackoverflow.com/users/2001566/mikel-pascual"}, "is_accepted": false, "score": 5, "last_activity_date": 1585627931, "creation_date": 1585627931, "answer_id": 60943336, "question_id": 57740979, "link": "https://stackoverflow.com/questions/57740979/how-enable-gzip-compression-middleware-in-go-chi/60943336#60943336", "title": "How enable gzip compression middleware in go-chi", "body": "<p>The other answers are outdated now. I had to solve this myself, so here what I found out.</p>\n\n<p>Your error is here: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>r.Use(middleware.Compress(5, \"gzip\"))\n</code></pre>\n\n<p>The second argument (\"types\") refers to the content types that the compression will be applied to. For example: <code>\"text/html\"</code>, <code>\"application/json\"</code>, etc</p>\n\n<p>Just add a list of the content-types you want to compress, or remove the argument altogether:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    r := chi.NewRouter()\n    r.Use(middleware.RequestID)\n    r.Use(middleware.Logger)\n    r.Use(middleware.Compress(5))\n    r.Get(\"/\", Hello)\n    http.ListenAndServe(\":3333\", r)\n}\n</code></pre>\n\n<p>This will compress all the content-types defined in the default list from <a href=\"https://github.com/go-chi/chi/blob/master/middleware/compress.go\" rel=\"noreferrer\">middleware.Compress</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var defaultCompressibleContentTypes = []string{\n    \"text/html\",\n    \"text/css\",\n    \"text/plain\",\n    \"text/javascript\",\n    \"application/javascript\",\n    \"application/x-javascript\",\n    \"application/json\",\n    \"application/atom+xml\",\n    \"application/rss+xml\",\n    \"image/svg+xml\",\n}\n</code></pre>\n\n<p>Good luck!</p>\n"}], "owner": {"reputation": 341, "user_id": 4103333, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-LLtDeVl2Hmg/AAAAAAAAAAI/AAAAAAAAAHM/9VlF4K8lJv4/photo.jpg?sz=128", "display_name": "jhoss", "link": "https://stackoverflow.com/users/4103333/jhoss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1607, "favorite_count": 0, "accepted_answer_id": 57742278, "answer_count": 3, "score": -1, "last_activity_date": 1585627931, "creation_date": 1567278862, "question_id": 57740979, "link": "https://stackoverflow.com/questions/57740979/how-enable-gzip-compression-middleware-in-go-chi", "title": "How enable gzip compression middleware in go-chi", "body": "<p>How can I enable gzip compression using the gzip middleware of the go-chi framework?</p>\n\n<p>Try using the example shown here:</p>\n\n<p><a href=\"https://github.com/go-chi/chi/issues/204\" rel=\"nofollow noreferrer\">https://github.com/go-chi/chi/issues/204</a></p>\n\n<p>but when I check with curl, I get this:</p>\n\n<pre><code>$ curl -H \"Accept-Encoding: gzip\" -I http://127.0.0.1:3333\nHTTP/1.1 405 Method Not Allowed\nDate: Sat, 31 Aug 2019 19:06:39 GMT\n</code></pre>\n\n<p>I tried the code \"hello world\":</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/go-chi/chi\"\n    \"github.com/go-chi/chi/middleware\"\n)\n\nfunc main() {\n    r := chi.NewRouter()\n    r.Use(middleware.RequestID)\n    r.Use(middleware.Logger)\n    //r.Use(middleware.DefaultCompress) //using this produces the same result\n    r.Use(middleware.Compress(5, \"gzip\"))\n    r.Get(\"/\", Hello)\n    http.ListenAndServe(\":3333\", r)\n}\n\nfunc Hello(w http.ResponseWriter, r *http.Request){\n    w.Header().Set(\"Content-Type\", \"text/html\") //according to the documentation this must be here to enable gzip\n    w.Write([]byte(\"hello world\\n\"))\n}\n</code></pre>\n\n<p>but when I try to verify with curl, the result is the same</p>\n\n<pre><code>$ curl -H \"Accept-Encoding: gzip\" -I http://127.0.0.1:3333\nHTTP/1.1 405 Method Not Allowed\nDate: Sat, 31 Aug 2019 19:06:39 GMT\n</code></pre>\n\n<p>what's going on?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2764, "user_id": 3521116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0feed05aa5a4174d4210276c06fbadc6?s=128&d=identicon&r=PG&f=1", "display_name": "warl0ck", "link": "https://stackoverflow.com/users/3521116/warl0ck"}, "edited": false, "score": 3, "creation_date": 1567275987, "post_id": 57740428, "comment_id": 101920277, "body": "if you want to return / catch error from defer, I used named return variables. like <a href=\"https://pocketgophers.com/handling-errors-in-defer/#returning-a-deferred-error\" rel=\"nofollow noreferrer\">returning a defered error</a> , you only have to assign error variable name to error."}], "answers": [{"comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 7, "creation_date": 1567283824, "post_id": 57740762, "comment_id": 101921919, "body": "The flaw in this as written is that if there is an error set inside the <code>&#47;&#47; some logic here</code> section (e.g., <code>if ... { err := errors.New(&quot;bad&quot;); return nil, err; }</code>) you will <i>overwrite</i> it with the result of <code>logger.Sync</code>. This may result in returning <i>no</i> error, if <code>logger.Sync</code> succeeds, even though the actual open failed."}, {"owner": {"reputation": 4438, "user_id": 1287899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9626e5ccaaecaa83f3600427f271bfc8?s=128&d=identicon&r=PG", "display_name": "Ahmed Hashem", "link": "https://stackoverflow.com/users/1287899/ahmed-hashem"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 2, "creation_date": 1567285402, "post_id": 57740762, "comment_id": 101922226, "body": "you are right. to bypass this situation we can return an array of errors <code>errs []error</code> containing both deferred and logical errors."}, {"owner": {"reputation": 1011, "user_id": 2609640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/790a2433ad5c793fe5bcd5b8db79df11?s=128&d=identicon&r=PG", "display_name": "gnvk", "link": "https://stackoverflow.com/users/2609640/gnvk"}, "edited": false, "score": 1, "creation_date": 1617263196, "post_id": 57740762, "comment_id": 118257102, "body": "Or you can check the error returned by <code>logger.Sync()</code> in the defer and only overwrite the <code>err</code> variable if it&#39;s not nil."}], "tags": [], "owner": {"reputation": 4438, "user_id": 1287899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9626e5ccaaecaa83f3600427f271bfc8?s=128&d=identicon&r=PG", "display_name": "Ahmed Hashem", "link": "https://stackoverflow.com/users/1287899/ahmed-hashem"}, "is_accepted": true, "score": 4, "last_activity_date": 1567276859, "creation_date": 1567276859, "answer_id": 57740762, "question_id": 57740428, "link": "https://stackoverflow.com/questions/57740428/handling-errors-in-defer/57740762#57740762", "title": "Handling errors in defer", "body": "<p>You can name your returning error variable and initialize anywhere inside the function.</p>\n\n<p>check this test code <a href=\"https://play.golang.org/p/K1k-CduETob\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>OpenDbConnection(connectionString string, logSql bool) (db *gorm.DB, err error) {\n\n    logger := zap.NewExample().Sugar()\n    defer func() {\n        err = logger.Sync()\n    }()\n\n    // some logic here\n\n    return db, err\n\n}\n</code></pre>\n"}], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2955, "favorite_count": 2, "accepted_answer_id": 57740762, "answer_count": 1, "score": 7, "last_activity_date": 1567276859, "creation_date": 1567274196, "last_edit_date": 1567274659, "question_id": 57740428, "link": "https://stackoverflow.com/questions/57740428/handling-errors-in-defer", "title": "Handling errors in defer", "body": "<p>I have a function which open db connection and return it. Or error, if something happened:</p>\n\n<pre><code>OpenDbConnection(connectionString string, logSql bool) (*gorm.DB, error) \n</code></pre>\n\n<p>In this function I am using logger:</p>\n\n<pre><code>logger := zap.NewExample().Sugar()\ndefer logger.Sync()\n</code></pre>\n\n<p>Method <code>Sync()</code> returns <code>error</code> and I am ignoring this error.</p>\n\n<p>What is the best strategy in this case ?</p>\n\n<p>I can rewrite my code to avoid linter error, but I am still ignore error:</p>\n\n<pre><code>logger := zap.NewExample().Sugar()\ndefer func() {\n    _ = logger.Sync()\n}()\n</code></pre>\n\n<p>I can return error, but I am have correct db connection and I need to analyze this error in the calling function to understand what to do.</p>\n"}, {"tags": ["go", "constants", "literals"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1567252454, "post_id": 57737743, "comment_id": 101914593, "body": "Because in Go contants <i>can</i> be <b>untyped</b>, variables can <i>not</i>. So with an untyped constant the type of the value is inferred from the operator, but using the operator on the wrong typed variable, or constant, will break. Try <code>const bucketCntBits int = 3</code> to see that this has less to do with <code>const</code> and more to do with types."}], "answers": [{"tags": [], "owner": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "is_accepted": false, "score": -2, "last_activity_date": 1567252673, "creation_date": 1567252673, "answer_id": 57737818, "question_id": 57737743, "link": "https://stackoverflow.com/questions/57737743/error-in-shift-operator-using-numeric-literals-but-not-with-numeric-constant/57737818#57737818", "title": "Error in shift operator using numeric literals but not with numeric constant", "body": "<p>With <code>math/bits</code> package you can do soemthing like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/bits\"\n)\n\nfunc main() {\n    bucketCntBits := 3\n    bucketCnt     := bits.RotateLeft(1, bucketCntBits)\n    fmt.Println(\"Hello, playground\", bucketCnt)\n}\n\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/fVK2xysL896\" rel=\"nofollow noreferrer\">https://play.golang.org/p/fVK2xysL896</a></p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1567600099, "last_edit_date": 1567600099, "creation_date": 1567258290, "answer_id": 57738429, "question_id": 57737743, "link": "https://stackoverflow.com/questions/57737743/error-in-shift-operator-using-numeric-literals-but-not-with-numeric-constant/57738429#57738429", "title": "Error in shift operator using numeric literals but not with numeric constant", "body": "<blockquote>\n  <p><a href=\"https://golang.org/doc/go1.13\" rel=\"nofollow noreferrer\">Go 1.13 Release Notes (September 2019)</a></p>\n  \n  <p>Changes to the language</p>\n  \n  <p>Per the <a href=\"https://github.com/golang/proposal/blob/master/design/19113-signed-shift-counts.md\" rel=\"nofollow noreferrer\">signed shift counts proposal</a> Go 1.13 removes the\n  restriction that a shift count must be unsigned. This change\n  eliminates the need for many artificial uint conversions, solely\n  introduced to satisfy this (now removed) restriction of the &lt;&lt; and >>\n  operators.</p>\n</blockquote>\n\n<hr>\n\n<pre><code>invalid operation: 1 &lt;&lt; bucketCntBits (shift count type int, must be unsigned integer)\n</code></pre>\n\n<p>This is no longer an error for Go 1.13 (September 2019) and later.</p>\n\n<p>Your example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    bucketCntBits := 3\n    bucketCnt := 1 &lt;&lt; bucketCntBits\n    fmt.Println(bucketCnt)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go version\ngo version devel +66ff373911 Sat Aug 24 01:11:56 2019 +0000 linux/amd64\n\n$ go run shift.go\n8\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": false, "score": 0, "last_activity_date": 1567365283, "last_edit_date": 1567365283, "creation_date": 1567335148, "answer_id": 57745350, "question_id": 57737743, "link": "https://stackoverflow.com/questions/57737743/error-in-shift-operator-using-numeric-literals-but-not-with-numeric-constant/57745350#57745350", "title": "Error in shift operator using numeric literals but not with numeric constant", "body": "<p>Or, you can cast the type <code>uint8</code>, <code>uint16</code>, <code>uint32</code> or <code>uint64</code> for integer literal. For example,</p>\n\n<pre><code>func main() {\n    bucketCntBits := uint32(3)\n    bucketCnt     := 1 &lt;&lt; bucketCntBits\n    fmt.Println(bucketCnt)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>8\n</code></pre>\n"}], "owner": {"reputation": 13358, "user_id": 3878940, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/v1J2L.jpg?s=128&g=1", "display_name": "Aditya Singh", "link": "https://stackoverflow.com/users/3878940/aditya-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1259, "favorite_count": 1, "accepted_answer_id": 57738429, "answer_count": 3, "score": 5, "last_activity_date": 1567600099, "creation_date": 1567251865, "question_id": 57737743, "link": "https://stackoverflow.com/questions/57737743/error-in-shift-operator-using-numeric-literals-but-not-with-numeric-constant", "title": "Error in shift operator using numeric literals but not with numeric constant", "body": "<p>I am getting error while doing a shift operation in go with <code>invalid operation: 1 &lt;&lt; bucketCntBits (shift count type int, must be unsigned integer)</code> error on trying to declare a literal in go inside <code>main()</code> body\nFailing literal example: <a href=\"https://play.golang.org/p/EqI-yag5yPp\" rel=\"noreferrer\">https://play.golang.org/p/EqI-yag5yPp</a></p>\n\n<pre><code>func main() {\n    bucketCntBits := 3 // &lt;---- This doesn't work\n    bucketCnt     := 1 &lt;&lt; bucketCntBits\n    fmt.Println(\"Hello, playground\", bucketCnt)\n}\n</code></pre>\n\n<p>When I declare the shift count as a constant, the shift operator works.\nWorking constant example: <a href=\"https://play.golang.org/p/XRLL4FR8ZEl\" rel=\"noreferrer\">https://play.golang.org/p/XRLL4FR8ZEl</a></p>\n\n<pre><code>const (\n    bucketCntBits = 3 // &lt;---- This works\n)\n\nfunc main() {\n\n    bucketCnt     := 1 &lt;&lt; bucketCntBits\n    fmt.Println(\"Hello, playground\", bucketCnt)\n}\n</code></pre>\n\n<p>Why does the constant work while the literal doesn't for the shift operator?</p>\n"}, {"tags": ["user-interface", "go", "andlabs-ui"], "answers": [{"comments": [{"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1567251062, "post_id": 57737608, "comment_id": 101914287, "body": "Thanks for explaining. It may be best if you could put some simple code also to clarify. The concept of channel does not seem to be easy."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1567252405, "post_id": 57737608, "comment_id": 101914584, "body": "I have tried and added my code using channel in my question above."}], "tags": [], "owner": {"reputation": 649, "user_id": 554480, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/m1Kjt.png?s=128&g=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/554480/mikhail"}, "is_accepted": false, "score": 1, "last_activity_date": 1567250794, "creation_date": 1567250794, "answer_id": 57737608, "question_id": 57737124, "link": "https://stackoverflow.com/questions/57737124/writing-confirm-yes-no-dialog-box/57737608#57737608", "title": "Writing confirm (yes/no) dialog box", "body": "<p>In the code you are returning true or false not from your function <code>confirm</code> but from the callbacks attached by OnClicked method to the yesButton and noButton. </p>\n\n<pre><code>yesButton.OnClicked(func (*ui.Button) {\n    return true\n})\nvar noButton = ui.NewButton(\"No\")\nnoButton.OnClicked(func (*ui.Button) {\n    return false // &lt;&lt;&lt; this should return out of the confirm function. \n})\n</code></pre>\n\n<p>To communicate main thread with the callbacks you have attached you need to have some kind of communication object and in case of the golang channel would work fine.\nDeclare chan bool in the body of the <code>confirm</code> function, use it through the closure in the callbacks, return it as a result of <code>confirm</code> funcrion and read from it in the your main function.</p>\n\n<p>TL;DR:</p>\n\n<ul>\n<li><p>return chan bool from confirm</p></li>\n<li><p>read the result from it</p></li>\n<li><p>instead of trying to return bool value from callbacks, send the desired value into the channel.</p></li>\n</ul>\n"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567254125, "creation_date": 1567246733, "last_edit_date": 1567254125, "question_id": 57737124, "link": "https://stackoverflow.com/questions/57737124/writing-confirm-yes-no-dialog-box", "title": "Writing confirm (yes/no) dialog box", "body": "<p>I am trying to write a yes/no dialog box in Go using <a href=\"https://godoc.org/github.com/andlabs/ui#MsgBox\" rel=\"nofollow noreferrer\">andlabs/ui</a> which does not seem to have this type of GUI component: </p>\n\n<pre><code>package main\n\nimport \"github.com/andlabs/ui\"\n\nfunc confirm(msg string) bool {\n    var confirmWindow = ui.NewWindow(\"Please confirm\", 300, 100, false)\n    var vbox = ui.NewVerticalBox()\n    vbox.Append(ui.NewLabel(msg), false)\n    var yesButton = ui.NewButton(\"Yes\")\n    yesButton.OnClicked(func (*ui.Button) {\n        return true\n    })\n    var noButton = ui.NewButton(\"No\")\n    noButton.OnClicked(func (*ui.Button) {\n        return false // &lt;&lt;&lt; this should return out of the confirm function. \n    })\n    var hbox = ui.NewHorizontalBox()\n    hbox.Append(yesButton, false)\n    hbox.Append(noButton, false)\n    vbox.Append(hbox, false)\n    confirmWindow.SetChild(vbox)\n    confirmWindow.Show()\n}\n\nfunc main(){\n    var ret = confirm(\"Proceed?\")\n    if ret {\n        println(\"Yes returned.\")\n    } else {\n        println(\"No returned.\")\n    }\n}\n</code></pre>\n\n<p>However, in above I am not able to return true or false depending on whether yes or no button is clicked. </p>\n\n<p>How can I have true/false returned from confirm function when yes/no button is clicked?</p>\n\n<p>Edit: Following suggestion from answer by @Mikhail , I tried following code: </p>\n\n<pre><code>package main\nimport (\"github.com/andlabs/ui\")\nfunc confirm(msg string) chan bool {\n    var confirmWindow = ui.NewWindow(\"Please confirm\", 300, 100, false)\n    var vbox = ui.NewVerticalBox()\n    vbox.Append(ui.NewLabel(msg), false)\n    var yesButton = ui.NewButton(\"Yes\")\n    ret := make(chan bool)\n    yesButton.OnClicked(func (*ui.Button){\n        ret &lt;- true\n    })\n    var noButton = ui.NewButton(\"No\")\n    noButton.OnClicked(func (*ui.Button){\n        ret &lt;- false\n    })\n    var hbox = ui.NewHorizontalBox()\n    hbox.Append(yesButton, false)\n    hbox.Append(noButton, false)\n    vbox.Append(hbox, false)\n    confirmWindow.SetChild(vbox)\n    confirmWindow.Show()\n    confirmWindow.OnClosing(func(*ui.Window)bool{\n        ui.Quit(); return true\n    })\n    return ret\n}\nfunc main(){\n    c := make(chan bool)\n    c &lt;- confirm(\"Proceed?\")\n    if c {println(\"Yes\")} else {println(\"No\")}\n}\n</code></pre>\n\n<p>However, it also does not work. The error is: </p>\n\n<pre><code># command-line-arguments\n./rnconfirm.go:30:4: cannot use confirm(\"Proceed?\") (type chan bool) as type bool in send\n./rnconfirm.go:31:2: non-bool c (type chan bool) used as if condition\n</code></pre>\n\n<p>Using following <code>main</code> function also does not work: </p>\n\n<pre><code>func main(){\n    println(confirm(\"Proceed\"))\n}\n</code></pre>\n\n<p>Error is:</p>\n\n<pre><code>(process:8577): GLib-CRITICAL **: g_ptr_array_add: assertion 'rarray' failed\nfatal error: unexpected signal during runtime execution\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x7fdeb996ae19]\n\nruntime stack:\nruntime.throw(0x4bd337, 0x2a)\n        /usr/local/go/src/runtime/panic.go:616 +0x81\nruntime.sigpanic()\n        /usr/local/go/src/runtime/signal_unix.go:372 +0x28e\n\ngoroutine 1 [syscall, locked to thread]:\n...\n...\n</code></pre>\n\n<p>Second attempt with channels is also not working: </p>\n\n<pre><code>package main\nimport (\"github.com/andlabs/ui\")\nfunc confirm(msg string, ret chan bool) {\n    var confirmWindow = ui.NewWindow(\"Please confirm\", 300, 100, false)\n    var vbox = ui.NewVerticalBox()\n    vbox.Append(ui.NewLabel(msg), false)\n    var yesButton = ui.NewButton(\"Yes\")\n    yesButton.OnClicked(func (*ui.Button){\n        ret &lt;- true\n    })\n    var noButton = ui.NewButton(\"No\")\n    noButton.OnClicked(func (*ui.Button){\n        ret &lt;- false\n    })\n    var hbox = ui.NewHorizontalBox()\n    hbox.Append(yesButton, false)\n    hbox.Append(noButton, false)\n    vbox.Append(hbox, false)\n    confirmWindow.SetChild(vbox)\n    confirmWindow.Show()\n    confirmWindow.OnClosing(func(*ui.Window)bool{\n        ui.Quit(); return true\n    })\n}\nfunc main(){\n    c := make(chan bool)\n    go confirm(\"Proceed?\", c)\n    ret := &lt;- c\n    if ret {println(\"Yes\")} else {println(\"No\")}\n}\n</code></pre>\n\n<p>It compiles and runs but crashes with error: </p>\n\n<pre><code>(process:2407): GLib-CRITICAL **: g_ptr_array_add: assertion 'rarray' failed\nfatal error: unexpected signal during runtime execution\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x7f47561e5e19]\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1567244659, "post_id": 57736810, "comment_id": 101912843, "body": "What doesn&#39;t seem to work? What error or other unexpected output do you see?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1567244756, "post_id": 57736810, "comment_id": 101912865, "body": "You&#39;re ignoring errors. Never do that."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1567245223, "post_id": 57736810, "comment_id": 101912984, "body": "Aside from that, the logic in your code is clearly wrong. If you just step through your for loop, you&#39;ll see that you&#39;re appending to your slices <i>for every element</i>, not once per input."}, {"owner": {"reputation": 108, "user_id": 9417489, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Barry Bonds", "link": "https://stackoverflow.com/users/9417489/barry-bonds"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1567248012, "post_id": 57736810, "comment_id": 101913630, "body": "@Flimzy sorry dude this is actually my FIRST program in Go. I&#39;m just learning."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1567248225, "post_id": 57736810, "comment_id": 101913673, "body": "There&#39;s nothing to apologize about. But the problems with your code are not primarily Go-related. They&#39;re logic related."}, {"owner": {"reputation": 108, "user_id": 9417489, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Barry Bonds", "link": "https://stackoverflow.com/users/9417489/barry-bonds"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1567248468, "post_id": 57736810, "comment_id": 101913715, "body": "@Flimzy duly noted. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1567247581, "post_id": 57737216, "comment_id": 101913524, "body": "That&#39;s still not right. You&#39;ll still end up with a slice front-padded with a bunch of empty values."}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1567247792, "post_id": 57737216, "comment_id": 101913578, "body": "@Flimzy, thank you - I have forgot about it. Fixed the code."}], "tags": [], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "is_accepted": true, "score": 0, "last_activity_date": 1567248902, "last_edit_date": 1567248902, "creation_date": 1567247469, "answer_id": 57737216, "question_id": 57736810, "link": "https://stackoverflow.com/questions/57736810/how-to-check-a-slice-for-an-element-and-manipulate-another-slice-if-value-exists/57737216#57737216", "title": "How to check a slice for an element and manipulate another slice if value exists or doesn&#39;t", "body": "<h1>First solution</h1>\n\n<p>here is what you want:</p>\n\n<pre><code>func main() {\n\n    var limit int\n    var name string\n    _, err := fmt.Scanln(&amp;limit)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    var names []string\n    var presence []string\n\n    for i := 0; i &lt; limit; i++ {\n\n        _, err := fmt.Scanln(&amp;name)\n        if err != nil {\n            fmt.Println(err)\n        }\n\n        var exist = false\n        for _, a := range names {\n            if a == name {\n                exist = true\n                break\n            }\n        }\n\n        if !exist {\n            names = append(names, name)\n            presence = append(presence, \"NO\")\n        } else {\n            presence = append(presence, \"YES\")\n        }\n    }\n    fmt.Println(presence)\n}\n</code></pre>\n\n<ul>\n<li>First of all <a href=\"https://golang.org/pkg/fmt/#Scanln\" rel=\"nofollow noreferrer\">Scanln</a> returns the <code>error</code> and you need to check it.</li>\n<li>Second: append to array must be outside the inner loop. Try to use debug <code>Println()</code> to debug your algorithm.</li>\n</ul>\n\n<h1>Move code to separate function</h1>\n\n<p>To make things clear I offer to move check of existance to separate function:</p>\n\n<pre><code>func exists(a []string, element string) bool {\n    for _, e := range a {\n        if e == element {\n            return true\n        }\n    }\n\n    return false\n}\n\nfunc main() {\n    var limit int\n    var name string\n    _, err := fmt.Scanln(&amp;limit)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    var names []string\n    var presence []string\n\n    for i := 0; i &lt; limit; i++ {\n\n        _, err := fmt.Scanln(&amp;name)\n        if err != nil {\n            fmt.Println(err)\n        }\n\n        if !exists(names, name) {\n            names = append(names, name)\n            presence = append(presence, \"NO\")\n        } else {\n            presence = append(presence, \"YES\")\n        }\n    }\n    fmt.Println(presence)\n}\n</code></pre>\n\n<h1>Optimization</h1>\n\n<p>In the previous code we pass array of string to function each time on every loop. If the array will be bigger it is not good, and it will be better to pass pointer to array of string to a function (or array of pointers to the strings).</p>\n"}], "owner": {"reputation": 108, "user_id": 9417489, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Barry Bonds", "link": "https://stackoverflow.com/users/9417489/barry-bonds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 57737216, "answer_count": 1, "score": -2, "last_activity_date": 1567248902, "creation_date": 1567244101, "last_edit_date": 1567248356, "question_id": 57736810, "link": "https://stackoverflow.com/questions/57736810/how-to-check-a-slice-for-an-element-and-manipulate-another-slice-if-value-exists", "title": "How to check a slice for an element and manipulate another slice if value exists or doesn&#39;t", "body": "<p>I am writing a program in Go which should check a slice for a name. If the name exists, it should enter \"YES\" in another slice and \"NO\" if it doesn't exist. The name slice should be entered by the user and the checking should start while entering values.</p>\n\n<p>I have written some code but it doesn't seem to work.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var limit int\n    var names string\n    fmt.Scanln(&amp;limit)\n    arr := make([]string, limit)\n    yn := make([]string, limit)\n    for i := 0; i &lt; limit; i++ {\n        fmt.Scanln(&amp;names)\n        for _, a := range arr {\n            if a == names {\n                yn = append(yn, \"YES\")\n            } else {\n                arr = append(arr, names)\n                yn = append(yn, \"NO\")\n            }\n        }\n    }\n    fmt.Println(yn)\n}\n</code></pre>\n\n<p>The output should be like </p>\n\n<p>User entered values:</p>\n\n<p>5</p>\n\n<p>steve</p>\n\n<p>john</p>\n\n<p>rainn</p>\n\n<p>jenna</p>\n\n<p>john</p>\n\n<p>Output:</p>\n\n<p>NO</p>\n\n<p>NO</p>\n\n<p>NO</p>\n\n<p>NO</p>\n\n<p>YES</p>\n\n<p>The error i was getting was a big array of a bunch of YES and NO values with 2 empty elements in the begining.</p>\n"}]