[{"tags": ["git", "go", "bazel"], "answers": [{"tags": [], "owner": {"reputation": 9285, "user_id": 39974, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9dd37fe19111e25842a4fd0aea245d1a?s=128&d=identicon&r=PG", "display_name": "Ivan Vu\u010dica", "link": "https://stackoverflow.com/users/39974/ivan-vu%c4%8dica"}, "is_accepted": false, "score": 0, "last_activity_date": 1466014073, "creation_date": 1466014073, "answer_id": 37842730, "question_id": 34055102, "link": "https://stackoverflow.com/questions/34055102/go-and-bazel-using-external-git-repositories/37842730#37842730", "title": "Go and Bazel: Using external Git repositories", "body": "<p>As of few versions ago, Bazel supports slashes in rule names. Along with hacked-in support for custom package names (<a href=\"https://github.com/bazelbuild/rules_go/issues/16\" rel=\"nofollow\">https://github.com/bazelbuild/rules_go/issues/16</a>) this seems to cover my use case.</p>\n\n<p>tl;dr I have <code>//vendor:BUILD</code> file which has rules such as <code>go_library(name='github.com/blah/blah', ...)</code>. Directories are named, e.g., <code>//vendor/github.com/blah/blah</code>. Each subpackage has a separate rule. I've manually specified dependencies.</p>\n"}], "owner": {"reputation": 9285, "user_id": 39974, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9dd37fe19111e25842a4fd0aea245d1a?s=128&d=identicon&r=PG", "display_name": "Ivan Vu\u010dica", "link": "https://stackoverflow.com/users/39974/ivan-vu%c4%8dica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1317, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1466014073, "creation_date": 1449098907, "last_edit_date": 1449100301, "question_id": 34055102, "link": "https://stackoverflow.com/questions/34055102/go-and-bazel-using-external-git-repositories", "title": "Go and Bazel: Using external Git repositories", "body": "<p>Thus far, I have been using <code>go</code> tool to fetch dependencies. I've set <code>$GOPATH</code> to <code>~/projects/holygrail</code>, and I've checked out my code into <code>src/mycodehosting.foo/myuser/holygrail</code>. </p>\n\n<p>Given that I actually depend on things such as gRPC, which means I need to build <code>protoc</code> from protobuf v3's source, I've written a small script that helps me do this. I would strongly prefer to <em>not</em> have to pre-prepare layout when I check out my source code, and I would strongly prefer <em>not</em> to use a bash script to fetch my dependencies, and then build them.</p>\n\n<p>Current tentative solution:</p>\n\n<ul>\n<li>use Git submodules to fetch external dependencies (which, sadly, means no smart redirects that <code>go get</code> knows how to do)</li>\n<li>use Go 1.5's vendoring by flipping the <code>GO15VENDOREXPERIMENT</code> variable to 1</li>\n<li>switch to Bazel to have a sane build system which will know how to build various dependencies only as required</li>\n</ul>\n\n<p>Unfortunately, I am <em>slightly</em> stuck.</p>\n\n<ul>\n<li>I'm using Bazel 0.1.1 with Skylark rules for Go from git repo copied into <code>~/.bazel/base_workspace</code></li>\n<li>I originally tried using <code>new_local_repository</code> (later to be switched to use <code>new_git_repository</code>) inside Bazel's <code>WORKSPACE</code>, specifying a custom <code>BUILD</code> file for one of the dependencies\n\n<ul>\n<li>this broke down because Bazel was unable to find the Go Skylark rules</li>\n</ul></li>\n<li>I am not sure how would I write custom <code>BUILD</code>-files for <code>git-submodule</code>-downloaded repositories in <code>vendor/</code> folder, and expose them to Bazel.</li>\n</ul>\n\n<hr>\n\n<p>Am I on the right track? Am I correct to use submodules? Am I correct to use <code>vendor/</code> subfolder to store Go libraries?</p>\n\n<ul>\n<li><strong>What is the recommended way to build external dependencies using Bazel, where both the code and the dependencies are written in Go?</strong></li>\n<li>Could you provide an example of a repository that:\n\n<ul>\n<li>correctly depends on an external <code>BUILD</code>-file-less Go repository (without actually importing the upstream code)?</li>\n<li>correctly builds the Go code in the external repository?</li>\n<li>correctly integrates the Go code from the external repository into the main Go project?</li>\n</ul></li>\n</ul>\n\n<hr>\n\n<p>Some more research into this:</p>\n\n<ul>\n<li>Kythe seems to have one <code>BUILD</code> file for many dependencies (even though they are not submodules, that does not make a difference).\n\n<ul>\n<li>Here is their <a href=\"https://github.com/google/kythe/blob/master/third_party/go/BUILD\" rel=\"nofollow\">BUILD file</a></li>\n<li>Here is their <a href=\"https://github.com/google/kythe/blob/master/third_party/go/build.bzl\" rel=\"nofollow\">additional helper rule</a></li>\n</ul></li>\n<li>That helper rule uses the <code>go_package()</code> rule. But this seems to come <a href=\"https://github.com/google/kythe/blob/master/tools/build_rules/go.bzl\" rel=\"nofollow\">from Kythe itself</a>. \n\n<ul>\n<li>It doesn't seem right to start using rules from Kythe, but it seems like a possible way to go?</li>\n<li>What do other people do?</li>\n</ul></li>\n</ul>\n"}, {"tags": ["go", "viper-go", "flag-go", "pflag-go"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 4, "creation_date": 1449110753, "post_id": 34053881, "comment_id": 55867900, "body": "IMHO packages shouldn&#39;t call <code>flag.Parse</code> and instead provide package specific way to configure them. calling <code>flag.Parse</code> is application (package main) responsibility. If a package that you want to use calls <code>flag.Parse</code> file a bug."}, {"owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1449157699, "post_id": 34053881, "comment_id": 55893593, "body": "umm ... no that is not what the question is stating. The call to flag.Parse() or pflag.Parse() would happen in main(). The problem I am getting at is that if you use pflag in your package, then you cannot use <i>any other</i> package that happens to use flag. Because then you would need to make a call to both flag.Parse() and pflag.Parse() in main() - and one or both will fail."}], "answers": [{"comments": [{"owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "edited": false, "score": 0, "creation_date": 1449157410, "post_id": 34060746, "comment_id": 55893366, "body": "Yes - I get that. So, basically, if you use pflag in your own package, you cannot use <i>any other</i> package that uses flag? Seems like a pretty crippling requirement."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": -1, "last_activity_date": 1449130176, "creation_date": 1449130176, "answer_id": 34060746, "question_id": 34053881, "link": "https://stackoverflow.com/questions/34053881/golang-how-can-i-use-pflag-with-other-packages-that-use-flag/34060746#34060746", "title": "golang: How can I use pflag with other packages that use flag?", "body": "<blockquote>\n  <p>How does one use pflag with other packages that use flag?</p>\n</blockquote>\n\n<p>You cannot. It is either or. plfag is a drop-in replacement for flag, not an addon.</p>\n"}, {"tags": [], "owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "is_accepted": true, "score": 0, "last_activity_date": 1449168187, "creation_date": 1449168187, "answer_id": 34073756, "question_id": 34053881, "link": "https://stackoverflow.com/questions/34053881/golang-how-can-i-use-pflag-with-other-packages-that-use-flag/34073756#34073756", "title": "golang: How can I use pflag with other packages that use flag?", "body": "<p>I got a response from a maintainer for pflag.</p>\n\n<p>The solution is to \"import\" all flags defined for flag into pflag, and then make a call to pflag.Parse() alone.</p>\n\n<p>pflag provides a convenience function called <a href=\"https://github.com/spf13/pflag/blob/master/golangflag.go#L90\" rel=\"nofollow\">AddGoFlagSet()</a> to accomplish this.</p>\n"}, {"tags": [], "owner": {"reputation": 2527, "user_id": 3476121, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/1c621706e2e37eed4f82f074af9f706a?s=128&d=identicon&r=PG", "display_name": "sadlil", "link": "https://stackoverflow.com/users/3476121/sadlil"}, "is_accepted": false, "score": 4, "last_activity_date": 1451036779, "creation_date": 1451036779, "answer_id": 34461791, "question_id": 34053881, "link": "https://stackoverflow.com/questions/34053881/golang-how-can-i-use-pflag-with-other-packages-that-use-flag/34461791#34461791", "title": "golang: How can I use pflag with other packages that use flag?", "body": "<p>I have found two approach for this.</p>\n\n<ol>\n<li><p>One with pflags AddGoFlags(). IE.</p>\n\n<pre><code>f := pflag.NewFlagSet(\"goFlags\", pflag.ExitOnError)\nf.AddGoFlagSet(flag.CommandLine)\nf.Parse([]string{\n   \"--v=10\", // Your go flags that will be pass to other programs.\n})\nflag.Parse()\n</code></pre></li>\n<li><p>Another approach you can use. This is not by the book but i have seen some used this..\nget the flag valu by another pflag.</p>\n\n<pre><code>pflag.StringVar(&amp;f, \"f\", \"**\", \"***\")\npflag.Parse()\n</code></pre></li>\n</ol>\n\n<p>Set the value as flag value.</p>\n\n<pre><code>    flag.Set(\"v\", f)\n    flag.Parse()\n</code></pre>\n\n<p>and you are good to go..</p>\n"}], "owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2066, "favorite_count": 0, "accepted_answer_id": 34073756, "answer_count": 3, "score": 2, "last_activity_date": 1451036779, "creation_date": 1449093554, "last_edit_date": 1449094160, "question_id": 34053881, "link": "https://stackoverflow.com/questions/34053881/golang-how-can-i-use-pflag-with-other-packages-that-use-flag", "title": "golang: How can I use pflag with other packages that use flag?", "body": "<p>How does one use pflag while also using other packages that use flag?</p>\n\n<p>Some of these packages define flags for the flag package (e.g. in their init functions) - and require flag.Parse() to be called.</p>\n\n<p>Defining flags using the pflag package, require pflag.Parse() to be called.</p>\n\n<p>One of the calls to flag.Parse() and pflag.Parse() will fail when arguments are mixed.</p>\n\n<p>How does one use pflag with other packages that use flag?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 338, "user_id": 3312122, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xoEvJ.jpg?s=128&g=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/3312122/kevin"}, "edited": false, "score": 0, "creation_date": 1449093369, "post_id": 34053815, "comment_id": 55861845, "body": "Basically I want something like <code>undefined</code> in JavaScript (so that field wont be in part of the body)."}], "answers": [{"comments": [{"owner": {"reputation": 908, "user_id": 8084731, "user_type": "registered", "profile_image": "https://graph.facebook.com/1653815704646436/picture?type=large", "display_name": "princebillyGK", "link": "https://stackoverflow.com/users/8084731/princebillygk"}, "edited": false, "score": 1, "creation_date": 1616305230, "post_id": 34053855, "comment_id": 117957146, "body": "Where is the list of all options? Can you provide a reference link?"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 55, "last_activity_date": 1449093834, "last_edit_date": 1449093834, "creation_date": 1449093408, "answer_id": 34053855, "question_id": 34053815, "link": "https://stackoverflow.com/questions/34053815/handle-optional-json-field-in-http-request-body/34053855#34053855", "title": "Handle optional JSON field in HTTP request body", "body": "<p>You want to use the <code>omitempty</code> option</p>\n\n<pre><code>type MyStruct struct {\n    Name  string `json:\"name,omitempty\"`\n    Age   int    `json:\"age\"`\n    Email string `json:\"email,omitempty\"`\n}\n</code></pre>\n\n<p>If you want <code>Age</code> to be optional as well you have to use a pointer, since the zero value of an <code>int</code> isn't really \"empty\"</p>\n\n<pre><code>type MyStruct struct {\n    Name  string `json:\"name,omitempty\"`\n    Age   *int   `json:\"age,omitempty\"`\n    Email string `json:\"email,omitempty\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 338, "user_id": 3312122, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xoEvJ.jpg?s=128&g=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/3312122/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13317, "favorite_count": 4, "accepted_answer_id": 34053855, "answer_count": 1, "score": 32, "last_activity_date": 1581681619, "creation_date": 1449093274, "last_edit_date": 1526526705, "question_id": 34053815, "link": "https://stackoverflow.com/questions/34053815/handle-optional-json-field-in-http-request-body", "title": "Handle optional JSON field in HTTP request body", "body": "<p>I have a struct like this:</p>\n\n<pre><code>type MyStruct struct {\n    Name  string `json:\"name\"`\n    Age   int    `json:\"age\"`\n    Email string `json:\"email\"`\n} \n</code></pre>\n\n<p>Then I have some value (could be default, which means I do not need to update this value) to feed in as HTTP request data.  I noticed the generated JSON body will always contains all three fields (<code>name</code>, <code>age</code> and <code>email</code>), even if I don't need to update all of them. Like this:</p>\n\n<pre><code>{\n  \"name\":\"Kevin\",\n  \"age\":10,\n  \"email\":\"\"\n}\n</code></pre>\n\n<p>Is there a way to Marshal so that the JSON body contains not all fields with the same struct?  Example:</p>\n\n<pre><code>{\n  \"name\":\"kevin\"\n}\n</code></pre>\n"}, {"tags": ["emacs", "go"], "comments": [{"owner": {"reputation": 12253, "user_id": 2112489, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5f4ed4b573c4e38444c6fc54b28076c0?s=128&d=identicon&r=PG", "display_name": "lawlist", "link": "https://stackoverflow.com/users/2112489/lawlist"}, "edited": false, "score": 0, "creation_date": 1449159818, "post_id": 34050981, "comment_id": 55895297, "body": "You can write your own forward/backward word using a syntax-table that is only active during the movement function:  <a href=\"http://stackoverflow.com/q/18675201/2112489\">stackoverflow.com/q/18675201/2112489</a>"}, {"owner": {"reputation": 1812, "user_id": 165082, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/629266ef4c3f1705dff4cec490c2b223?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/165082/eric"}, "reply_to_user": {"reputation": 12253, "user_id": 2112489, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5f4ed4b573c4e38444c6fc54b28076c0?s=128&d=identicon&r=PG", "display_name": "lawlist", "link": "https://stackoverflow.com/users/2112489/lawlist"}, "edited": false, "score": 0, "creation_date": 1449161960, "post_id": 34050981, "comment_id": 55896866, "body": "That looks like overkill. Why doesn&#39;t the call to modify-syntax-entry work?"}, {"owner": {"reputation": 12253, "user_id": 2112489, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/5f4ed4b573c4e38444c6fc54b28076c0?s=128&d=identicon&r=PG", "display_name": "lawlist", "link": "https://stackoverflow.com/users/2112489/lawlist"}, "edited": false, "score": 0, "creation_date": 1449163943, "post_id": 34050981, "comment_id": 55898075, "body": "Sorry, but I do not use <code>go-mode</code> and do not have the time available to get into its inner-workings and/or modify the built-in forward/backward words.  There are other movement modes you could look at, like <code>subword-mode</code>:  <a href=\"https://www.gnu.org/software/emacs/manual/html_node/ccmode/Subword-Movement.html\" rel=\"nofollow noreferrer\">gnu.org/software/emacs/manual/html_node/ccmode/&hellip;</a>  There are already several threads that deal with cursor movement over words/strings/subwords/etc."}], "owner": {"reputation": 1812, "user_id": 165082, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/629266ef4c3f1705dff4cec490c2b223?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/165082/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1449147123, "creation_date": 1449083351, "last_edit_date": 1449147123, "question_id": 34050981, "link": "https://stackoverflow.com/questions/34050981/how-do-i-get-word-based-movements-in-emacs-go-mode-to-not-skip-over-backquoted-s", "title": "How do I get word-based movements in emacs go-mode to not skip over backquoted strings?", "body": "<p>If I have code like so:</p>\n\n<pre><code>func main() {\n  a := `line 1\nline 2\nline 3\nline 4`\n  fmt.Println(a)\n}\n</code></pre>\n\n<p>doing forward-word or backword-word when the cursor is\nin the multi-line string moves to the end or the start\nof the string respectively.  I'm using go-mode.el v1.3.1\nfrom <a href=\"https://github.com/dominikh/go-mode.el\" rel=\"nofollow\">https://github.com/dominikh/go-mode.el</a></p>\n\n<p>Similar if the cursor is inside the string and you do</p>\n\n<p>I tried doing </p>\n\n<pre><code>(modify-syntax-entry ?` \".\")\n</code></pre>\n\n<p>in the go-mode-hook but that didn't change the behavior.</p>\n"}, {"tags": ["reflection", "go", "interface"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449078376, "post_id": 34048861, "comment_id": 55853556, "body": "You have <code>reflection</code> and <code>interface</code> tags, but neither topic is in your question. The &quot;generic&quot; answer is use variadic functions. Can you explain why you don&#39;t want to use variadic functions? <code>func Three</code> isn&#39;t valid, so I&#39;m not sure what you want to accomplish by mixing types."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1449079591, "post_id": 34048861, "comment_id": 55854269, "body": "<a href=\"https://golang.org/ref/spec#Function_types\" rel=\"nofollow noreferrer\"><code>type Executable func(...int)</code></a> ?"}, {"owner": {"reputation": 1516, "user_id": 3074624, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/eca9b92bb23c77aa71a707584db33ec7?s=128&d=identicon&r=PG&f=1", "display_name": "Manu Viswam", "link": "https://stackoverflow.com/users/3074624/manu-viswam"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449080585, "post_id": 34048861, "comment_id": 55854822, "body": "@JimB Suppose my function Three is   func Three(n1 string,n2 bool,n3 int) {     fmt.Println(&quot;Foo = &quot;,n1, n2, n3) }  in such a case I can not use varargs right?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449081063, "post_id": 34048861, "comment_id": 55855105, "body": "What you have here is a contrived example, which doesn&#39;t really make sense. You&#39;re fighting the type system for some reason, but I&#39;m not sure why. Do you just want <code>type Executable func(...interface{})</code>?"}, {"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449135148, "post_id": 34048861, "comment_id": 55877778, "body": "As @JimB mentionned, I think you want to use the <code>interface{}</code> type. This allows to have different number of arguments with different types. Or depending on what you&#39;re really trying to achieve you could also use <code>...CustomInterface{}</code> and define your own interface that is useful for your function."}], "answers": [{"comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1449084918, "post_id": 34051102, "comment_id": 55857283, "body": "i Just saw rob pike video ,<a href=\"https://www.youtube.com/watch?v=PAAkCSZUG1c\" rel=\"nofollow noreferrer\">youtube.com/watch?v=PAAkCSZUG1c</a> Hes asking people do not use reflection..."}, {"owner": {"reputation": 305, "user_id": 1404075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18bf929217b8f3fb8226d16fb5b8aa31?s=128&d=identicon&r=PG", "display_name": "Stefano Mozart", "link": "https://stackoverflow.com/users/1404075/stefano-mozart"}, "edited": false, "score": 0, "creation_date": 1557834329, "post_id": 34051102, "comment_id": 98890463, "body": "As @Depado&#39;s answer clearly shows, you can do it. Maybe you just wanted to say &quot;the language&#39;s type system was not designed for that, so you should not do it&quot;."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 305, "user_id": 1404075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18bf929217b8f3fb8226d16fb5b8aa31?s=128&d=identicon&r=PG", "display_name": "Stefano Mozart", "link": "https://stackoverflow.com/users/1404075/stefano-mozart"}, "edited": false, "score": 0, "creation_date": 1557847160, "post_id": 34051102, "comment_id": 98898474, "body": "@StefanoMozart No I wanted to say &quot;No you cannot&quot;. Depadas answer is a limited instance of the general problem as f(a ...X) is a function with one parameter of type []X."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1449083770, "creation_date": 1449083770, "answer_id": 34051102, "question_id": 34048861, "link": "https://stackoverflow.com/questions/34048861/can-golang-take-a-function-with-unknown-number-of-parameters-as-an-argument-to-a/34051102#34051102", "title": "Can golang take a function with unknown number of parameters as an argument to another function", "body": "<p>The answer to \"the exact scenario mentioned\" is:</p>\n\n<p><strong>No</strong> <strong>you</strong> <strong>cannot</strong> <strong>do</strong> <strong>this.</strong></p>\n\n<p>(Especially as you shouldn't.)</p>\n"}, {"tags": [], "owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "is_accepted": false, "score": 2, "last_activity_date": 1449136378, "creation_date": 1449136378, "answer_id": 34062738, "question_id": 34048861, "link": "https://stackoverflow.com/questions/34048861/can-golang-take-a-function-with-unknown-number-of-parameters-as-an-argument-to-a/34062738#34062738", "title": "Can golang take a function with unknown number of parameters as an argument to another function", "body": "<pre><code>package main\n\nimport \"fmt\"\n\nfunc Simple(args ...interface{}) {\n    fmt.Println(\"Foo =\", fmt.Sprint(args...))\n}\n\nfunc main() {\n    Execute(1, Simple)\n    Execute(2, Simple)\n    Execute(3, Simple)\n}\n\ntype Executable func(...interface{})\n\nfunc Execute(noOfArgs int, fn Executable) {\n    switch noOfArgs {\n    case 1:\n        fn(1)\n    case 2:\n        fn(1, 2)\n    case 3:\n        fn(\"1\", 2, 3)\n    }\n}\n</code></pre>\n\n<p>I quite don't know what you're trying to achieve here. You <strong>can</strong> take an unknown number of arguments with unknown types. But you shouldn't. What you <strong>can and should</strong> do is take an unknown number of arguments that are satisfying a custom interface you wrote and that will be used inside your function, otherwise it doesn't make sense and will, at one point force you to use reflection to know the type of an argument.</p>\n\n<p>There is no point in using a strongly typed language if you try to avoid the types.</p>\n"}], "owner": {"reputation": 1516, "user_id": 3074624, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/eca9b92bb23c77aa71a707584db33ec7?s=128&d=identicon&r=PG&f=1", "display_name": "Manu Viswam", "link": "https://stackoverflow.com/users/3074624/manu-viswam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1757, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1449227514, "creation_date": 1449076379, "last_edit_date": 1495539963, "question_id": 34048861, "link": "https://stackoverflow.com/questions/34048861/can-golang-take-a-function-with-unknown-number-of-parameters-as-an-argument-to-a", "title": "Can golang take a function with unknown number of parameters as an argument to another function", "body": "<p>Suppose I have a program like below</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    Execute(1,One)\n//  Execute(2,Two)\n//  Execute(3,Three)\n}\n\ntype Executable func(int)\n\nfunc Execute(noOfArgs int, fn Executable){\n    switch noOfArgs {\n        case 1 : fn(1)\n//      case 2 : fn(1,2)\n//      case 3 : fn(\"1\",2,3)\n    }\n}\nfunc One(n int) {\n    fmt.Println(\"Foo = \",n)\n}\nfunc Two(n1,n2 int) {\n    fmt.Println(\"Foo = \",n1+n2)\n}\nfunc Three(n1 string,n2,n3 int) {\n    fmt.Println(\"Foo = \",n1+n2+n3)\n}\n</code></pre>\n\n<p>And I would like to make the <code>Execute</code> function as a generic one which can receive functions with different number of arguments of different types, what should be the type of <code>Executable</code> ?</p>\n\n<p>In other words, If I uncomment the commented lines in the above program, it will break. What modification should I make to the line <code>type Executable func(int)</code> to make it working?</p>\n\n<p><strong>PS : Please try to give a generic answer instead of giving a workaround for the exact scenario which I mentioned</strong></p>\n\n<p>EDIT:- This is not a duplicate of <a href=\"https://stackoverflow.com/questions/32721066/pass-string-to-a-function-that-expects-a-variadic-parameter\">this</a> question.\nI am not looking for expanding arguments. I will have <strong>different types</strong> of arguments and different number of arguments</p>\n\n<p>EDIT:- I will explain my scenario more clearly.</p>\n\n<p>I have a BDD style test executor which parses a line of text and execute the function associated with it, with appropriate arguments.</p>\n\n<p>Eg :- </p>\n\n<blockquote>\n  <p>Say \"greeting\" to \"someone\"</p>\n</blockquote>\n\n<p>and an associated function</p>\n\n<pre><code>func SayGreeting(greeting, person string) {\n    fmt.Println(greeting, \", \", person)\n}\n</code></pre>\n\n<p>another line which says</p>\n\n<blockquote>\n  <p>Add &lt;2> , &lt;3> and &lt;4></p>\n</blockquote>\n\n<p>and associated function</p>\n\n<pre><code>func AddNum(n1, n2, n3 int) {\n    sum := n1 + n2 + n3\n    fmt.Println(\"Sum is : \", sum)\n}\n</code></pre>\n\n<p>I have a mechanism to scan all the functions and add it to a map, with associated scenario. My program knows which function to execute, number of arguments to it and the arguments.</p>\n\n<p>My problem is, how do I make the map generic so that I can store different functions with different number/type of arguments. </p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 3, "creation_date": 1449070303, "post_id": 34046194, "comment_id": 55847827, "body": "I think you are looking for an HTTP middleware This is a good place to start  <a href=\"https://www.nicolasmerouze.com/middlewares-golang-best-practices-examples/\" rel=\"nofollow noreferrer\">nicolasmerouze.com/middlewares-golang-best-practices-example&zwnj;&#8203;s</a>"}, {"owner": {"reputation": 1105, "user_id": 3051060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dZeQp.jpg?s=128&g=1", "display_name": "rcmgleite", "link": "https://stackoverflow.com/users/3051060/rcmgleite"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1449071816, "post_id": 34046194, "comment_id": 55848935, "body": "As @MIkCode said, middlewares are the way to go... take a look at Gin&#39;s custom middlewares. <a href=\"https://github.com/gin-gonic/gin#custom-middleware\" rel=\"nofollow noreferrer\">github.com/gin-gonic/gin#custom-middleware</a>"}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 3851832, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/l6shQ.jpg?s=128&g=1", "display_name": "Sougata", "link": "https://stackoverflow.com/users/3851832/sougata"}, "edited": false, "score": 0, "creation_date": 1585214087, "post_id": 34053075, "comment_id": 107684528, "body": "How to do the same &quot;add the db connection to the context&quot; in chi framework ?"}, {"owner": {"reputation": 11808, "user_id": 1404726, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/an5FZ.jpg?s=128&g=1", "display_name": "tim-montague", "link": "https://stackoverflow.com/users/1404726/tim-montague"}, "edited": false, "score": 1, "creation_date": 1604048284, "post_id": 34053075, "comment_id": 114233705, "body": "Unfortunately, this is the best answer. It&#39;s not ideal, because the <code>Set</code> and <code>Get</code> creates a dependency, where the closure pattern could simply pass the parameters from the middleware to the enclosed route. However, Gin does not naturally make use of the closure pattern and so some methods like <code>Use</code> and <code>Group</code> become complicated."}], "tags": [], "owner": {"reputation": 1105, "user_id": 3051060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dZeQp.jpg?s=128&g=1", "display_name": "rcmgleite", "link": "https://stackoverflow.com/users/3051060/rcmgleite"}, "is_accepted": true, "score": 29, "last_activity_date": 1449090689, "creation_date": 1449090689, "answer_id": 34053075, "question_id": 34046194, "link": "https://stackoverflow.com/questions/34046194/how-to-pass-arguments-to-router-handlers-in-golang-using-gin-web-framework/34053075#34053075", "title": "How to pass arguments to router handlers in Golang using Gin web framework?", "body": "<p>Using the link i posted on comments, I have created a simple example.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n\n    \"github.com/gin-gonic/gin\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/mattn/go-sqlite3\"\n)\n\n// ApiMiddleware will add the db connection to the context\nfunc ApiMiddleware(db gorm.DB) gin.HandlerFunc {\n    return func(c *gin.Context) {\n        c.Set(\"databaseConn\", db)\n        c.Next()\n    }\n}\n\nfunc main() {\n    r := gin.New()\n\n    // In this example, I'll open the db connection here...\n    // In your code you would probably do it somewhere else\n    db, err := gorm.Open(\"sqlite3\", \"./example.db\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    r.Use(ApiMiddleware(db))\n\n    r.GET(\"/api\", func(c *gin.Context) {\n        // Don't forget type assertion when getting the connection from context.\n        dbConn, ok := c.MustGet(\"databaseConn\").(gorm.DB)\n        if !ok {\n            // handle error here...\n        }\n\n        // do your thing here...\n    })\n\n    r.Run(\":8080\")\n}\n</code></pre>\n\n<p>This is just a simple POC. But i believe it's a start.\nHope it helps.</p>\n"}, {"comments": [{"owner": {"reputation": 3497, "user_id": 1773961, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/f874a90dd15a5f5db1a8fb7e8c08ee25?s=128&d=identicon&r=PG&f=1", "display_name": "Indradhanush Gupta", "link": "https://stackoverflow.com/users/1773961/indradhanush-gupta"}, "edited": false, "score": 1, "creation_date": 1485715422, "post_id": 34056746, "comment_id": 71029589, "body": "This should be the recommended answer."}, {"owner": {"reputation": 11808, "user_id": 1404726, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/an5FZ.jpg?s=128&g=1", "display_name": "tim-montague", "link": "https://stackoverflow.com/users/1404726/tim-montague"}, "edited": false, "score": 0, "creation_date": 1604052213, "post_id": 34056746, "comment_id": 114235283, "body": "Unfortunately, I&#39;ve experienced multiple issues in getting this closure pattern to work nicely with the Gin framework when using methods like <code>Use</code> and <code>Group</code> (<a href=\"https://github.com/gin-gonic/gin#grouping-routes\" rel=\"nofollow noreferrer\">github.com/gin-gonic/gin#grouping-routes</a>), and I would recommend to use the <code>Set</code> and <code>Get</code> methods until Gin is better designed. I rarely advocate worse design, but it&#39;s better to be consistent in approach and leverage the framework. Great pattern, but Gin is not there yet."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": false, "score": 37, "last_activity_date": 1487675959, "last_edit_date": 1487675959, "creation_date": 1449109231, "answer_id": 34056746, "question_id": 34046194, "link": "https://stackoverflow.com/questions/34046194/how-to-pass-arguments-to-router-handlers-in-golang-using-gin-web-framework/34056746#34056746", "title": "How to pass arguments to router handlers in Golang using Gin web framework?", "body": "<p>I would avoid stuffing 'application scoped' dependencies (e.g. a DB connection pool) into a request context. Your two 'easiest' options are:</p>\n\n<ol>\n<li>Make it a global. This is OK for smaller projects, and <code>*sql.DB</code> is thread-safe.</li>\n<li>Pass it explicitly in a closure so that the return type satisfies <a href=\"https://godoc.org/github.com/gin-gonic/gin#HandlerFunc\" rel=\"noreferrer\"><code>gin.HandlerFunc</code></a></li>\n</ol>\n\n<p>e.g.</p>\n\n<pre><code>// SomeHandler returns a `func(*gin.Context)` to satisfy Gin's router methods\n// db could turn into an 'Env' struct that encapsulates all of your\n// app dependencies - e.g. DB, logger, env vars, etc.\nfunc SomeHandler(db *sql.DB) gin.HandlerFunc {\n    fn := func(c *gin.Context) {\n        // Your handler code goes in here - e.g.\n        rows, err := db.Query(...)\n\n        c.String(200, results)\n    }\n\n    return gin.HandlerFunc(fn)\n}\n\nfunc main() {\n    db, err := sql.Open(...)\n    // handle the error\n\n    router := gin.Default()\n    router.GET(\"/test\", SomeHandler(db))\n    router.Run(\":8080\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 1310185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51716b5ce80510ea41666fe54ed43db5?s=128&d=identicon&r=PG", "display_name": "deepak", "link": "https://stackoverflow.com/users/1310185/deepak"}, "is_accepted": false, "score": 0, "last_activity_date": 1456586974, "last_edit_date": 1456586974, "creation_date": 1456586021, "answer_id": 35671420, "question_id": 34046194, "link": "https://stackoverflow.com/questions/34046194/how-to-pass-arguments-to-router-handlers-in-golang-using-gin-web-framework/35671420#35671420", "title": "How to pass arguments to router handlers in Golang using Gin web framework?", "body": "<p>Alright, I have given you a simple example. It should work. You can extend it as per your need</p>\n\n<pre><code>func main() {\n    router := gin.Default()\n    router.GET(\"/test/:id/:name\", testRouteHandler)\n    router.Run(\":8080\")\n}\n\nfunc testRouteHandler(c *gin.Context) {\n    id := c.Params.ByName(\"id\")\n    name := c.Params.ByName(\"name\")\n}\n</code></pre>\n\n<p>Now you will have to call your handler as below\n<a href=\"http://localhost:8080/test/1/myname\" rel=\"nofollow\">http://localhost:8080/test/1/myname</a></p>\n"}, {"tags": [], "owner": {"reputation": 45, "user_id": 1057671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7e47926681db4c996fe0988f306c770?s=128&d=identicon&r=PG", "display_name": "wildneuro", "link": "https://stackoverflow.com/users/1057671/wildneuro"}, "is_accepted": false, "score": 2, "last_activity_date": 1493256589, "creation_date": 1493256589, "answer_id": 43647156, "question_id": 34046194, "link": "https://stackoverflow.com/questions/34046194/how-to-pass-arguments-to-router-handlers-in-golang-using-gin-web-framework/43647156#43647156", "title": "How to pass arguments to router handlers in Golang using Gin web framework?", "body": "<p>Late to the party, so far here is my proposal. Incapsulate methods into the object with private/public vars in it:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n\n    \"github.com/gin-gonic/gin\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/mattn/go-sqlite3\"\n)\n\ntype HandlerA struct {\n    Db gorm.DB\n}\n\nfunc (this *HandlerA) Get(c *gin.Context) {\n\n    log.Info(\"[%#f]\", this.Db)\n    // do your thing here...\n}\n\nfunc main() {\n    r := gin.New()\n\n    // Init, should be separate, but it's ok for this sample:\n    db, err := gorm.Open(\"sqlite3\", \"./example.db\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    Obj := new(HandlerA)\n    Obj.Db = db // Or init inside Object\n\n    r := gin.New()\n\n    Group := r.Group(\"api/v1/\")\n    {\n        Group.GET(\"/storage\", Obj.Get)\n    }\n\n    r.Run(\":8080\")\n}\n</code></pre>\n"}], "owner": {"reputation": 7318, "user_id": 1258192, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/j2scd.png?s=128&g=1", "display_name": "Niklas9", "link": "https://stackoverflow.com/users/1258192/niklas9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19953, "favorite_count": 8, "accepted_answer_id": 34053075, "answer_count": 4, "score": 26, "last_activity_date": 1493256589, "creation_date": 1449069188, "last_edit_date": 1487679155, "question_id": 34046194, "link": "https://stackoverflow.com/questions/34046194/how-to-pass-arguments-to-router-handlers-in-golang-using-gin-web-framework", "title": "How to pass arguments to router handlers in Golang using Gin web framework?", "body": "<p>I'm using Gin, <a href=\"https://gin-gonic.github.io/gin/\">https://gin-gonic.github.io/gin/</a>, to build a simple RESTful JSON API with Golang.</p>\n\n<p>The routes are setup with something like this:</p>\n\n<pre><code>func testRouteHandler(c *gin.Context) {\n    // do smth\n}\n\nfunc main() {\n    router := gin.Default()\n    router.GET(\"/test\", testRouteHandler)\n    router.Run(\":8080\")\n}\n</code></pre>\n\n<p>My question is how can I pass down an argument to the testRouteHandler function? For example a common database connection could be something that one wants to reuse among routes.</p>\n\n<p>Is the best way to have this in a global variable? Or is there some way in Go to pass along an extra variable to the testRouteHandler function? Are there optional arguments for functions in Go?</p>\n\n<p>PS. I'm just getting started in learning Go, so could be something obvious that I'm missing :)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1449064849, "post_id": 34044496, "comment_id": 55843684, "body": "You have no type for your function arguments, but there are many other problems with this code. Start with the <a href=\"https://golang.org/doc/\" rel=\"nofollow noreferrer\">docs</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "is_accepted": false, "score": 0, "last_activity_date": 1449066652, "creation_date": 1449066652, "answer_id": 34045273, "question_id": 34044496, "link": "https://stackoverflow.com/questions/34044496/how-to-pass-variables-in-golang/34045273#34045273", "title": "how to pass variables in golang", "body": "<p>Has @JimB already pointed out func cal is not having type for parameters. In addition it has other issues to like:</p>\n\n<ol>\n<li>set parameter type for func cal as string</li>\n<li>In order to use a, b and c, convert set there value as float64</li>\n<li>la is not used</li>\n<li>Rx needs to be converted to string</li>\n<li>func is not returning anything.</li>\n</ol>\n\n<p>Look at this updated function:</p>\n\n<pre><code>func cal(INP1, INP2, INP3 string) string{\n    b,_ := strconv.ParseFloat(INP2, 64)\n    a,_ := strconv.ParseFloat(INP1, 64)\n    c,_ := strconv.ParseFloat(INP3, 64)\n    e := 4\n    la := 2\n    a2 := float64(e)*float64(a)\n    b2 := float64(b*b)\n    ac := float64(e)*float64(a)*float64(c)\n    q := math.Sqrt(math.Abs(b2-ac))\n    x := q/a2\n    Rx := x\n    fmt.Print(\"x = \" + strconv.FormatFloat(Rx, 'f', 6, 64))\n    fmt.Print(la)\n    return \"return value\"\n}\n</code></pre>\n\n<p>For now I have used la, by printing it.</p>\n"}], "owner": {"reputation": 193, "user_id": 5574609, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-Z8DszpZmPOA/AAAAAAAAAAI/AAAAAAAAABI/qRBWSg0ue2E/photo.jpg?sz=128", "display_name": "liam", "link": "https://stackoverflow.com/users/5574609/liam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1213, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1449066652, "creation_date": 1449064422, "question_id": 34044496, "link": "https://stackoverflow.com/questions/34044496/how-to-pass-variables-in-golang", "title": "how to pass variables in golang", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bufio\"\n    \"os\"\n    \"strconv\"\n    \"math\"\n)\n\nfunc main() {\n    var inpA = bufio.NewScanner(os.Stdin)\n    var inpB = bufio.NewScanner(os.Stdin)\n    var inpC = bufio.NewScanner(os.Stdin)\n    fmt.Print(\"input A value: \")\n    inpA.Scan()\n    fmt.Print(\"input B value: \")\n    inpB.Scan()\n    fmt.Print(\"input C value: \")\n    inpC.Scan()\n    cal(inpA.Text(),inpB.Text(),inpC.Text())\n}\n\nfunc cal(INP1, INP2, INP3) string{\n    b := INP2\n    a := INP1\n    c := INP3\n    e := 4\n    la := 2\n    a2 := float64(e)*float64(a)\n    b2 := float64(b*b)\n    ac := float64(e)*float64(a)*float64(c)\n    q := math.Sqrt(math.Abs(b2-ac))\n    x := q/a2\n    Rx := x\n    fmt.Print(\"x = \" + strconv.Itoa(Rx))\n}\n</code></pre>\n\n<p>What am I doing wrong? I All I want to do is pass the input into func cal. Also I am having problems with printing Rx. Because it is a float. So how do I change x/RX to a non float?</p>\n"}, {"tags": ["go", "system-calls"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1449061496, "post_id": 34043323, "comment_id": 55841421, "body": "You may find this package useful: <a href=\"https://github.com/rainycape/dl\" rel=\"nofollow noreferrer\">github.com/rainycape/dl</a>"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1449062272, "post_id": 34043323, "comment_id": 55841926, "body": "@TimCooper Note that &quot;gopkgs.com&quot; is unreachable and <a href=\"http://centralops.net/co/DomainDossier.aspx?addr=gopkgs.com&amp;dom_dns=true\" rel=\"nofollow noreferrer\">is an NXDOMAIN</a>. So it is safe to assume that site is dead."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1449062513, "post_id": 34043323, "comment_id": 55842089, "body": "@MarkusWMahlberg: The package can still be grabbed with <code>go get -u github.com&#47;rainycape&#47;dl</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1449064686, "post_id": 34043323, "comment_id": 55843548, "body": "The &quot;official&quot; (and highly recommended) way to do this is to use cgo. Windows has these in the syscall package, because windows requires loading DLLs for some functionality.  Linux doesn&#39;t need to load shared libraries for any syscalls, so there&#39;s no built-in support."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1449064830, "post_id": 34043323, "comment_id": 55843667, "body": "@TimCooper Just wanted to inform you about the status. And one could also use <code>go get -u gopkg.in&#47;rainycape&#47;dl.v0</code> ;)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1449077792, "post_id": 34043323, "comment_id": 55853220, "body": "I suggest looking in the source of the <code>syscall.go</code> and <code>*syscall_linux[_$GOARCH].go</code> files of the Go runtime. The <a href=\"https://godoc.org/golang.org/x/sys\" rel=\"nofollow noreferrer\"><code>golang.org&#47;x&#47;sys</code></a> package might of of interest, too."}], "answers": [{"comments": [{"owner": {"reputation": 86, "user_id": 7297321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f188160c3f5dbf26a5e316a9f15a37cb?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya Vishnevsky", "link": "https://stackoverflow.com/users/7297321/ilya-vishnevsky"}, "edited": false, "score": 3, "creation_date": 1539031785, "post_id": 43183700, "comment_id": 92345986, "body": "In <code>syscall</code> package all available constants have already defined  ( <a href=\"https://golang.org/pkg/syscall/#pkg-constants\" rel=\"nofollow noreferrer\">golang.org/pkg/syscall/#pkg-constants</a> ) So, for @ErikBye example, <code>39</code> can be replaced by <code>syscall.SYS_GETPID</code>"}, {"owner": {"reputation": 347, "user_id": 7803990, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tagTu.png?s=128&g=1", "display_name": "sbrk", "link": "https://stackoverflow.com/users/7803990/sbrk"}, "reply_to_user": {"reputation": 86, "user_id": 7297321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f188160c3f5dbf26a5e316a9f15a37cb?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya Vishnevsky", "link": "https://stackoverflow.com/users/7297321/ilya-vishnevsky"}, "edited": false, "score": 0, "creation_date": 1540028304, "post_id": 43183700, "comment_id": 92719623, "body": "Great! Not sure if they were defined at the time I wrote the answer."}], "tags": [], "owner": {"reputation": 347, "user_id": 7803990, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tagTu.png?s=128&g=1", "display_name": "sbrk", "link": "https://stackoverflow.com/users/7803990/sbrk"}, "is_accepted": true, "score": 7, "last_activity_date": 1581575151, "last_edit_date": 1581575151, "creation_date": 1491219662, "answer_id": 43183700, "question_id": 34043323, "link": "https://stackoverflow.com/questions/34043323/golang-how-to-use-syscall-syscall-on-linux/43183700#43183700", "title": "Golang: How to use syscall.Syscall on Linux?", "body": "<p>Linux syscalls are used directly without loading a library, exactly how depends on which system call you would like to perform.</p>\n\n<p>I will use the Linux syscall getpid() as an example, which returns the process ID of the calling process (our process, in this case).</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"syscall\"\n)\n\nfunc main() {\n    pid, _, _ := syscall.Syscall(syscall.SYS_GETPID, 0, 0, 0)\n    fmt.Println(\"process id: \", pid)\n}\n</code></pre>\n\n<p>I capture the result of the syscall in pid, this particular call returns no errors so I use blank identifiers for the rest of the returns. Syscall returns two uintptr and 1 error. </p>\n\n<p>As you can see I can also just pass in 0 for the rest of the function arguments, as I don't need to pass arguments to this syscall.</p>\n\n<p>The function signature is: func Syscall(trap uintptr, nargs uintptr, a1 uintptr, a2 uintptr, a3 uintptr) (r1 uintptr, r2 uintptr, err Errno).</p>\n\n<p>For more information refer to <a href=\"https://golang.org/pkg/syscall/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/syscall/</a></p>\n"}], "owner": {"reputation": 3892, "user_id": 599575, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/ob4mZ.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/599575/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11028, "favorite_count": 2, "accepted_answer_id": 43183700, "answer_count": 1, "score": 11, "last_activity_date": 1581575151, "creation_date": 1449060883, "question_id": 34043323, "link": "https://stackoverflow.com/questions/34043323/golang-how-to-use-syscall-syscall-on-linux", "title": "Golang: How to use syscall.Syscall on Linux?", "body": "<p>There is a very nice description about loading a shared library and calling a function with the syscall package on Windows (<a href=\"https://github.com/golang/go/wiki/WindowsDLLs\" rel=\"noreferrer\">https://github.com/golang/go/wiki/WindowsDLLs</a>). However, the functions <code>LoadLibrary</code> and <code>GetProcAddress</code> that are used in this description are not available in the syscall package on Linux. I could not find documentation about how to do this on Linux (or Mac OS).</p>\n\n<p>Thanks for help</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1449055437, "post_id": 34040736, "comment_id": 55837578, "body": "Function types can have methods in Go. Take a look at http.handlerFunc (<a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#HandlerFunc</a>) which is a function type and implements a methods. Java does not have this feature. Regarding &quot;productivity&quot;: This might be controversial. It definitively allows to write more types of code and allows interesting designs."}], "answers": [{"comments": [{"owner": {"reputation": 3561, "user_id": 2381508, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/946bccd20d5d9648c87f4c4b0489d176?s=128&d=identicon&r=PG", "display_name": "Abhishek Nalin", "link": "https://stackoverflow.com/users/2381508/abhishek-nalin"}, "edited": false, "score": 0, "creation_date": 1449059482, "post_id": 34041167, "comment_id": 55840114, "body": "I think your answer is describing the &#39;implicit type hierarchy&#39; in Go. This is obviously a good feature and explained in the video. See slide at 32:38 in the video. This is mentioned as the second point. My question is about the first point."}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 4, "last_activity_date": 1449071885, "last_edit_date": 1449071885, "creation_date": 1449054296, "answer_id": 34041167, "question_id": 34040736, "link": "https://stackoverflow.com/questions/34040736/golang-is-more-productive-because-any-type-can-be-given-methods-how-does-that/34041167#34041167", "title": "&quot;Golang is more productive because any type can be given methods&quot;. How does that increase productivity?", "body": "<p>in java or c#, you need declare a class to inherit/implement from some interface. but in golang, the declaration is not required, just write the methods for the interfaces you want to implement.</p>\n\n<p>it is more flexible, so it increases productivity in some way, I suppose.</p>\n"}, {"tags": [], "owner": {"reputation": 9718, "user_id": 87584, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f6dfb6c18bce2c8487312b77c32dbc3?s=128&d=identicon&r=PG", "display_name": "Fabien", "link": "https://stackoverflow.com/users/87584/fabien"}, "is_accepted": true, "score": 3, "last_activity_date": 1449071699, "creation_date": 1449071699, "answer_id": 34047133, "question_id": 34040736, "link": "https://stackoverflow.com/questions/34040736/golang-is-more-productive-because-any-type-can-be-given-methods-how-does-that/34047133#34047133", "title": "&quot;Golang is more productive because any type can be given methods&quot;. How does that increase productivity?", "body": "<p>In practice, that means you can add methods to predefined types (well, not really them, but types derived from them).</p>\n\n<p>For instance, if you have a list of <code>Foo</code> (where <code>Foo</code> is a type you or another package defined) and want to make that list sortable, you just have to make the list implement <code>sort.Interface</code>. To do so, you just define a new type </p>\n\n<pre><code>type fooSlice []Foo\n</code></pre>\n\n<p>and define methods on it to implement the interface :</p>\n\n<pre><code>func (fs fooSlice) Len() int { return len(fs) }\nfunc (fs fooSlice) Swap(a, b int) { fs[a], fs[b] = fs[b], fs[a] }\nfunc (fs fooSlice) Less(a, b int) bool { return fs[a].Ord() &lt; fs[b].Ord() }\n</code></pre>\n\n<p>Then, everywhere you have a slice of <code>Foo</code>, you can cast it as a <code>fooSlice</code> and use it with <code>sort.Sort</code> :</p>\n\n<pre><code>func sortAndDoStuff(foos []Foo) {\n    sort.Sort(fooSlice(foos))\n    doStuff(foos)\n}\n</code></pre>\n\n<p>Doing that with, say, Java, would require a lot more plumbing, because you would need a new class, make it have one field (the <code>[]Foo</code>), say it implements an interface, implement said methods (as with go) and make methods that goes back and forth between <code>[]Foo</code> and <code>fooSlice</code> classes.</p>\n"}], "owner": {"reputation": 3561, "user_id": 2381508, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/946bccd20d5d9648c87f4c4b0489d176?s=128&d=identicon&r=PG", "display_name": "Abhishek Nalin", "link": "https://stackoverflow.com/users/2381508/abhishek-nalin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 542, "favorite_count": 0, "accepted_answer_id": 34047133, "answer_count": 2, "score": 3, "last_activity_date": 1449077857, "creation_date": 1449053039, "last_edit_date": 1449077857, "question_id": 34040736, "link": "https://stackoverflow.com/questions/34040736/golang-is-more-productive-because-any-type-can-be-given-methods-how-does-that", "title": "&quot;Golang is more productive because any type can be given methods&quot;. How does that increase productivity?", "body": "<p>I was watching <a href=\"https://www.youtube.com/watch?v=jgVhBThJdXc\" rel=\"nofollow\">Google IO 2010 - GO Programming video</a> where they claim (see 32:38)</p>\n\n<p>\"GO can make programming very productive because \n - any type can be given methods, which opens up interesting design possibilities\"</p>\n\n<p>Can somebody please explain how can this feature increase productivity? Is this feature not present in other languages?</p>\n"}, {"tags": ["arrays", "json", "go", "multicast", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 3327477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0d7926b947286bc9d044a0702192fb?s=128&d=identicon&r=PG&f=1", "display_name": "r3dlight", "link": "https://stackoverflow.com/users/3327477/r3dlight"}, "edited": false, "score": 0, "creation_date": 1449052276, "post_id": 34040025, "comment_id": 55835468, "body": "Thank you icza, now I have another issue, it does panic when unmarshalling my byte array : unexpected end of json input. Should I open a new question with more details ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 101, "user_id": 3327477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0d7926b947286bc9d044a0702192fb?s=128&d=identicon&r=PG&f=1", "display_name": "r3dlight", "link": "https://stackoverflow.com/users/3327477/r3dlight"}, "edited": false, "score": 1, "creation_date": 1449052420, "post_id": 34040025, "comment_id": 55835583, "body": "That means the <code>[]byte</code> you&#39;re passing to <code>json.Unmarshal()</code> is not the complete JSON encoded text. It could be even empty. Make sure it contains the whole json text (check its content)."}, {"owner": {"reputation": 101, "user_id": 3327477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0d7926b947286bc9d044a0702192fb?s=128&d=identicon&r=PG&f=1", "display_name": "r3dlight", "link": "https://stackoverflow.com/users/3327477/r3dlight"}, "edited": false, "score": 0, "creation_date": 1449052627, "post_id": 34040025, "comment_id": 55835721, "body": "I understand (my json is quite huge vs UDP), could you suggest me a way to check the content properly ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 101, "user_id": 3327477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0d7926b947286bc9d044a0702192fb?s=128&d=identicon&r=PG&f=1", "display_name": "r3dlight", "link": "https://stackoverflow.com/users/3327477/r3dlight"}, "edited": false, "score": 1, "creation_date": 1449054512, "post_id": 34040025, "comment_id": 55836988, "body": "@r3dlight Just print it e.g. <code>fmt.Println(n, string(b[:n]), b[:n])</code>."}, {"owner": {"reputation": 101, "user_id": 3327477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0d7926b947286bc9d044a0702192fb?s=128&d=identicon&r=PG&f=1", "display_name": "r3dlight", "link": "https://stackoverflow.com/users/3327477/r3dlight"}, "edited": false, "score": 0, "creation_date": 1449055219, "post_id": 34040025, "comment_id": 55837456, "body": "Ok, first I increased my maxDatagramSize to 18000. Then I made the print like you suggested : 16115 {...}[...] It seems to be complete but now I panic with panic: invalid character &#39;\\x00&#39; after top-level value"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 101, "user_id": 3327477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0d7926b947286bc9d044a0702192fb?s=128&d=identicon&r=PG&f=1", "display_name": "r3dlight", "link": "https://stackoverflow.com/users/3327477/r3dlight"}, "edited": false, "score": 3, "creation_date": 1449055628, "post_id": 34040025, "comment_id": 55837697, "body": "@r3dlight Make sure you pass <code>b[:n]</code> to <code>json.Unmarshal()</code>, as the rest of the slice contains <code>0</code>s (which your error suggests) but they are not part of the json text!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1471850077, "last_edit_date": 1471850077, "creation_date": 1449051107, "answer_id": 34040025, "question_id": 34039734, "link": "https://stackoverflow.com/questions/34039734/golang-sending-json-on-multicast-ip/34040025#34040025", "title": "golang sending json on multicast ip", "body": "<p>In your code you used <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\"><code>json.Marshal()</code></a> to convert your value to JSON text (<code>[]byte</code>).</p>\n\n<p>The other direction (<code>[]byte</code> -> value) can be done using <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow\"><code>json.Unmarshal()</code></a>. <code>json.Unmarshal()</code> expects a <code>[]byte</code> so you don't even have to convert it to <code>string</code>.</p>\n\n<p>See this example:</p>\n\n<pre><code>data := []byte(`{\"key1\":\"value1\",\"key2\":123}`)\n\nvar m map[string]interface{}\nif err := json.Unmarshal(data, &amp;m); err != nil {\n    panic(err)\n}\n\nfmt.Printf(\"%+v\", m)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/oCsqbTCX4L\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>map[key1:value1 key2:123]\n</code></pre>\n\n<p><strong>Notes:</strong></p>\n\n<p>The result of marshaling (<code>json.Marshal()</code>) is a value of type <code>[]byte</code> so you don't need explicit conversion here:</p>\n\n<pre><code>c.Write([]byte(myjson))\n</code></pre>\n\n<p>You can simply write:</p>\n\n<pre><code>c.Write(myjson)\n</code></pre>\n\n<p>Also when unmarshaling, make sure you pass <code>b[:n]</code> to <code>json.Unmarshal()</code>, as the rest of the slice contains <code>0</code>s (which your 2nd error suggests) but they are not part of the json text!</p>\n"}], "owner": {"reputation": 101, "user_id": 3327477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0d7926b947286bc9d044a0702192fb?s=128&d=identicon&r=PG&f=1", "display_name": "r3dlight", "link": "https://stackoverflow.com/users/3327477/r3dlight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 936, "favorite_count": 1, "accepted_answer_id": 34040025, "answer_count": 1, "score": 4, "last_activity_date": 1471850077, "creation_date": 1449050281, "question_id": 34039734, "link": "https://stackoverflow.com/questions/34039734/golang-sending-json-on-multicast-ip", "title": "golang sending json on multicast ip", "body": "<p>I'm writting a piece of Go to send json data on multicast udp:</p>\n\n<pre><code>func send(a string, messages chan interface{}) {\n    addr, err := net.ResolveUDPAddr(\"udp\", a)\n    CheckError(err)\n    c, err := net.DialUDP(\"udp\", nil, addr)\n    CheckError(err)\n    for {\n        msg := &lt;-messages\n        myjson, err := json.Marshal(msg)\n        if err != nil {\n            fmt.Println(\"Error encoding JSON\")\n        return\n        }\n        //Write to bytes to multicast UDP\n        c.Write([]byte(myjson))\n\n        time.Sleep(2 * time.Second)\n    }\n}\n</code></pre>\n\n<p>So my json is converted to an array of byte to make it work. Here is my \"receiver\" func:</p>\n\n<pre><code>func serveMulticastUDP(a string, messages chan interface{}) {\n\n    addr, err := net.ResolveUDPAddr(\"udp\", a)\n    CheckError(err)\n    l, err := net.ListenMulticastUDP(\"udp\", nil, addr)\n    l.SetReadBuffer(maxDatagramSize)\n    for {\n        b := make([]byte, maxDatagramSize)\n        n, src, err := l.ReadFromUDP(b)\n        if err != nil {\n            log.Fatal(\"ReadFromUDP failed:\", err)\n        }\n        s := string(b[:n])//here is my problem, I want s to be map[string]interface before sending in my channel\n        messages&lt;-s\n        log.Println(s)\n        log.Println(src)\n        log.Println(n)\n        //h(src, n, b)\n    }\n}\n</code></pre>\n\n<p>How can convert a array of bytes to map[string]interface (json) ?</p>\n"}, {"tags": ["go", "concurrency", "mutex", "channel"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1449067720, "post_id": 34039377, "comment_id": 55845763, "body": "While this is a great general guideline, I think we really need to stress the &quot;This approach can be taken too far.&quot; caveat. I&#39;ve seen a <i>lot</i> of horribly complicated code stem from this, with a mess of reactor loops and message passing, where a simple mutex would of sufficed. How I like to think of the problem: If you&#39;re trying to provide &quot;mutual exclusion&quot; around a <i>single</i> logical resource, then you probably want a mutex. If you&#39;re trying to coordinate goroutines and provide synchronization points, then you want channels. (Everything in between comes with experience)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 11, "last_activity_date": 1449050618, "last_edit_date": 1592644375, "creation_date": 1449049250, "answer_id": 34039377, "question_id": 34039229, "link": "https://stackoverflow.com/questions/34039229/if-i-am-using-channels-properly-should-i-need-to-use-mutexes/34039377#34039377", "title": "If I am using channels properly should I need to use mutexes?", "body": "<p>You don't need mutex if you use channels correctly. In some cases a solution with mutex might be simpler though.</p>\n<p>Just make sure the variable(s) holding the channel values are properly initialized before multiple goroutines try to access the channel variables. Once this is done, accessing the channels (e.g. sending values to or receiving values from them) is safe by design.</p>\n<p>Supporting documents with references (emphases added by me):</p>\n<p><a href=\"https://golang.org/ref/spec#Channel_types\" rel=\"noreferrer\">Spec: Channel types:</a></p>\n<blockquote>\n<p>A single channel <strong>may be used</strong> in <a href=\"https://golang.org/ref/spec#Send_statements\" rel=\"noreferrer\">send statements</a>, <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"noreferrer\">receive operations</a>, and calls to the built-in functions <a href=\"https://golang.org/ref/spec#Length_and_capacity\" rel=\"noreferrer\"><code>cap</code></a> and <a href=\"https://golang.org/ref/spec#Length_and_capacity\" rel=\"noreferrer\"><code>len</code></a> <strong>by any number of goroutines without further synchronization</strong>. Channels act as first-in-first-out queues. For example, if one goroutine sends values on a channel and a second goroutine receives them, the values are received in the order sent.</p>\n</blockquote>\n<p><a href=\"https://golang.org/doc/effective_go.html#sharing\" rel=\"noreferrer\">Effective Go: Concurrency: Share by communicating</a></p>\n<blockquote>\n<p>Concurrent programming in many environments is made difficult by the subtleties required to implement correct access to shared variables. Go encourages a different approach in which shared values are passed around on channels and, in fact, never actively shared by separate threads of execution. <strong>Only one goroutine has access to the value at any given time. Data races cannot occur, by design.</strong> To encourage this way of thinking we have reduced it to a slogan:</p>\n<p><em>Do not communicate by sharing memory; instead, share memory by communicating.</em></p>\n<p>This approach can be taken too far. Reference counts may be best done by putting a mutex around an integer variable, for instance. But as a high-level approach, using channels to control access makes it easier to write clear, correct programs.</p>\n</blockquote>\n<p>This article is also very helpful: <a href=\"https://golang.org/ref/mem\" rel=\"noreferrer\">The Go Memory Model</a></p>\n<p>Also quoting from the package doc of <a href=\"https://golang.org/pkg/sync/\" rel=\"noreferrer\"><code>sync</code></a>:</p>\n<blockquote>\n<p>Package sync provides basic synchronization primitives such as mutual exclusion locks. Other than the Once and WaitGroup types, <strong>most are intended for use by low-level library routines. Higher-level synchronization is better done via channels and communication.</strong></p>\n</blockquote>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1325, "favorite_count": 2, "accepted_answer_id": 34039377, "answer_count": 1, "score": 8, "last_activity_date": 1449050618, "creation_date": 1449048834, "last_edit_date": 1449049882, "question_id": 34039229, "link": "https://stackoverflow.com/questions/34039229/if-i-am-using-channels-properly-should-i-need-to-use-mutexes", "title": "If I am using channels properly should I need to use mutexes?", "body": "<p>If I am using channels properly, should I need to use mutexes to protect against concurrent access?</p>\n"}, {"tags": ["go", "qml", "right-to-left"], "comments": [{"owner": {"reputation": 3063, "user_id": 4964373, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/d7HSZ.png?s=128&g=1", "display_name": "Usman Maqbool", "link": "https://stackoverflow.com/users/4964373/usman-maqbool"}, "edited": false, "score": 0, "creation_date": 1449043495, "post_id": 34037565, "comment_id": 55830212, "body": "what is  sfsdgsdfgfgghjhhkktfraettjyjdfg sjhd ahkdj ajsdj hdf in code ?"}], "answers": [{"tags": [], "owner": {"reputation": 745, "user_id": 8762108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/351b9ff059aefdd62a022cd3ffb28bb5?s=128&d=identicon&r=PG&f=1", "display_name": "Mahdi Khalili", "link": "https://stackoverflow.com/users/8762108/mahdi-khalili"}, "is_accepted": false, "score": 0, "last_activity_date": 1557299733, "last_edit_date": 1557299733, "creation_date": 1543488086, "answer_id": 53537122, "question_id": 34037565, "link": "https://stackoverflow.com/questions/34037565/how-to-set-a-table-in-qml-to-be-rtl/53537122#53537122", "title": "How to set a table in QML to be rtl?", "body": "<p>Qt Documentation says do this :</p>\n\n<pre><code>Item{\n    //this is working for me\n    LayoutMirroring.enabled: true\n    LayoutMirroring.childrenInherit: true\n    TableView{\n       //if columns are not in right places set width for'em\n       TableViewColumn {\n          role: \"operator\"\n          title: \"\u0646\u0648\u0639\"\n       }\n\n       TableViewColumn {\n           role: \"title\"\n           title: \"\u06a9\u0627\u0644\u0627\"\n       }\n    }\n}\n</code></pre>\n\n<p><strong>Update:</strong>  you could use <a href=\"https://github.com/hahn-kev/QmlGrid\" rel=\"nofollow noreferrer\">QmlGrid</a> instead of TableView.</p>\n\n<p><strong>Update 2019-04-23 :</strong>  here i create simple right to lefted table view :</p>\n\n<pre><code>import QtQuick 2.12\nimport QtQuick.Controls 2.12\nimport QtQuick.Layouts 1.12\nimport QtQuick.Controls.Universal 2.12\nItem {\n    id:root\n    implicitWidth: 500\n    clip: true\n    implicitHeight: 300\n    property alias model :listView.model\n    property alias currentIndex: listView.currentIndex\n\n    property var headerModel : []\n    ListView {\n        id: listView\n        anchors.fill: parent\n        onCurrentIndexChanged: {\n            root.currentIndexChanged()\n        }\n\n        //contentWidth: headerItem.width\n        flickableDirection: Flickable.HorizontalAndVerticalFlick\n        header: Row{\n            spacing: 0\n            anchors.right: parent.right\n            anchors.rightMargin: 0\n            layoutDirection: Qt.RightToLeft\n            function itemAt(index) {\n                return repeater.itemAt(index)\n            }\n            Repeater{\n                id:repeater\n                model: headerModel\n                Row{\n                    layoutDirection: Qt.RightToLeft\n                    width: modelData.width * listView.width\n                    Label {\n                        height: 40\n                        clip: true\n                        id:textArea\n                        verticalAlignment: Text.AlignVCenter\n                        text: modelData.name\n                        width: parent.width -1\n                        font.family: \"B Nazanin\"\n                        font.bold: true\n                        font.pointSize: 12\n                        padding: 10\n                        background: Rectangle { color: \"white\" }\n                        UIcon{\n                            text: \"\\uf0dc\"\n                            color: Universal.color(Universal.Cobalt)\n                            anchors.left: parent.left\n                            anchors.leftMargin: 0\n                            anchors.verticalCenter: parent.verticalCenter\n                        }\n\n                        MouseArea{\n                            clip: true\n                            anchors.fill: parent\n                            onClicked: {\n                                //console.log(modelData.name)\n                                //TODO:sort and show sorting arrow\n                            }\n                        }\n                    }\n                    Rectangle{\n                        height: parent.height\n                        width: 1\n                        color: \"silver\"\n                    }\n\n                }\n\n\n            }\n\n        }\n\n\n        delegate: Column {\n            width: parent.width\n            id: delegate\n            anchors.right: parent.right\n            anchors.rightMargin: 0\n            Rectangle{\n                width: parent.width\n                implicitHeight: 35\n                id:baserect\n                z:1\n                color: \"white\"\n                clip: true\n\n                Row {\n                    anchors.fill: parent\n                    spacing: 0\n                    layoutDirection: Qt.RightToLeft\n                    clip: true\n                    Repeater {\n                        anchors.fill: parent\n                        model: modelData\n                        clip: true\n                        Row{\n                            id:_row\n                            layoutDirection: Qt.RightToLeft\n                            width: childrenRect.width\n\n                            Text{\n                                clip: true\n                                id:iDelegate\n                                text:modelData\n                                font.family: \"B Nazanin\"\n                                font.pointSize: 11\n                                verticalAlignment: Text.AlignVCenter\n                                padding: 5\n                                Binding{\n                                    target: iDelegate\n                                    property: 'width'\n                                    value: listView.headerItem.children[index].width -1\n                                }\n                            }\n                            Rectangle{\n                                height: baserect.height\n                                width: 1\n                                color: \"silver\"\n                            }\n                        }\n\n                    }\n                }\n\n                Rectangle {\n                    id:line\n                    clip: true\n                    color: \"#808080\"\n                    width: parent.width\n                    height: 1\n                }\n\n                MouseArea{\n                    anchors.fill: parent\n                    hoverEnabled: true\n                    onEntered: {\n                        //baserect.color = \"gray\"\n                    }\n                    onExited: {\n                        //baserect.color = 'white'\n                    }\n                    onClicked: {\n                        listView.currentIndex = index\n                    }\n                }\n            }\n\n\n        }\n        focus: true\n        highlight: Rectangle {\n            z:1\n            color: \"#77B5D3E7\";\n            radius: 0 }\n        ScrollIndicator.horizontal: ScrollIndicator { }\n        ScrollIndicator.vertical: ScrollIndicator { }\n    }\n}\n</code></pre>\n\n<p>and and example  of using : </p>\n\n<pre><code>UTable{\n                width:500\n                height:300\n                onCurrentIndexChanged: {\n                    console.log(currentIndex)\n                }\n\n                model: [[\"\u062a\u0633\u062a\",\"\u062a\u0633\u062a2\",\"\u062a\u0633\u062a3\",\"\u062a\u0633\u062a4\"],[\"\u062e\u0637 1\",\"\u062e\u06372\",\"\u062e\u06373\",\"\u062e\u06374\"],[\"\u062e\u0637 1\",\"\u062e\u06372\",\"\u062e\u06373\",\"\u062e\u06374\"]]\n                headerModel : [\n                        {\n                            \"name\":\"\u0633\u062a\u0648\u0646 0.3\",\n                            \"width\":0.3\n                        },{\n                            \"name\":\"\u0633\u062a\u0648\u0646 0.2\",\n                            \"width\":0.2\n                        },{\n                            \"name\":\"\u0633\u062a\u0648\u0646 0.25\",\n                            \"width\":0.25\n                        },{\n                            \"name\":\"\u0633\u062a\u0648\u0646 \u0627\u062e\u0631\",\n                            \"width\":0.25\n                        }\n                    ]\n            }\n</code></pre>\n\n<p>and here is our UIcon : </p>\n\n<pre><code>import QtQuick 2.0\nItem{\n    implicitWidth: 35\n    implicitHeight: 35\n    property alias size : icotext.font.pointSize\n    property alias text : icotext.text\n    property alias font : icotext.font.family\n    property alias color : icotext.color\n    Text {\n        id:icotext\n        anchors.centerIn: parent\n        font.family: \"fontawesome\"\n        text: \"\\uf110\"\n        font.pointSize: 12\n        verticalAlignment: Text.AlignVCenter\n        horizontalAlignment: Text.AlignHCenter\n    }\n}\n</code></pre>\n\n<p><strong>Update 2019-05-08</strong> :</p>\n\n<pre><code>import QtQuick 2.12\nimport QtQuick.Controls 2.12\nimport QtQuick.Layouts 1.12\nimport QtQuick.Controls.Universal 2.12\nItem {\n    id:root\n    implicitWidth: 500\n    clip: true\n    implicitHeight: 300\n    property alias model :listView.model\n    property alias currentIndex: listView.currentIndex\n    property bool byColName:false\n    property var headerModel : []\n    ListView {\n        id: listView\n        anchors.fill: parent\n        onCurrentIndexChanged: {\n            root.currentIndexChanged()\n        }\n        onModelChanged: {\n            console.log(model)\n        }\n\n        //contentWidth: headerItem.width\n        flickableDirection: Flickable.HorizontalAndVerticalFlick\n        header: Row{\n            spacing: 0\n            anchors.right: parent.right\n            anchors.rightMargin: 0\n            layoutDirection: Qt.RightToLeft\n            function itemAt(index) {\n                return repeater.itemAt(index)\n            }\n            Repeater{\n                id:repeater\n                model: headerModel\n                Row{\n                    layoutDirection: Qt.RightToLeft\n                    width: modelData.width * listView.width\n                    Label {\n                        height: 40\n                        clip: true\n                        id:textArea\n                        verticalAlignment: Text.AlignVCenter\n                        text: root.byColName?modelData.title:modelData.name\n                        width: parent.width -1\n                        horizontalAlignment: Text.AlignRight\n                        font.family: \"B Nazanin\"\n                        font.bold: true\n                        font.pointSize: 12\n                        padding: 10\n                        background: Rectangle { color: \"white\" }\n                        UIcon{\n                            text: \"\\uf0dc\"\n                            color: Universal.color(Universal.Cobalt)\n                            anchors.left: parent.left\n                            anchors.leftMargin: 0\n                            anchors.verticalCenter: parent.verticalCenter\n                        }\n\n                        MouseArea{\n                            clip: true\n                            anchors.fill: parent\n                            onClicked: {\n                                //console.log(modelData.name)\n                                //TODO:sort and show sorting arrow\n                            }\n                        }\n                    }\n                    Rectangle{\n                        height: parent.height\n                        width: 1\n                        color: \"silver\"\n                    }\n\n                }\n\n\n            }\n\n        }\n\n\n        delegate: Column {\n            width: parent.width\n            id: delegate\n            anchors.right: parent.right\n            anchors.rightMargin: 0\n            Rectangle{\n                width: parent.width\n                implicitHeight: 35\n                id:baserect\n                z:1\n                color: \"white\"\n                clip: true\n\n                Row {\n                    anchors.fill: parent\n                    spacing: 0\n                    layoutDirection: Qt.RightToLeft\n                    clip: true\n                    Repeater {\n                        id:_repeater\n                        anchors.fill: parent\n                        property var actualModel : modelData\n                        model: getJsonCount(modelData)\n                        onModelChanged: {\n                            console.log(model)\n\n                        }\n                        function getJsonCount(obj){\n                            var count = 0\n                            for(var key in obj){\n                                ++count;\n                            }\n                            return count;\n                        }\n                        clip: true\n                        Row{\n                            id:_row\n                            layoutDirection: Qt.RightToLeft\n                            width: childrenRect.width\n\n                            Text{\n                                clip: true\n                                id:iDelegate\n                                text:{\n                                    if(root.byColName){\n                                        var columnName = headerModel[index].name\n                                        var data = _repeater.actualModel[columnName]\n                                        return data;\n                                    }\n                                    else{\n                                        return _repeater.actualModel[index];\n                                    }\n                                }\n\n\n                                horizontalAlignment: Text.AlignRight\n                                font.family: \"B Nazanin\"\n                                font.pointSize: 11\n                                verticalAlignment: Text.AlignVCenter\n                                padding: 5\n                                Binding{\n                                    target: iDelegate\n                                    property: 'width'\n                                    value: listView.headerItem.children[index].width -1\n                                }\n                            }\n                            Rectangle{\n                                height: baserect.height\n                                width: 1\n                                color: \"silver\"\n                            }\n                        }\n\n                    }\n                }\n\n                Rectangle {\n                    id:line\n                    clip: true\n                    color: \"#808080\"\n                    width: parent.width\n                    height: 1\n                }\n\n                MouseArea{\n                    anchors.fill: parent\n                    hoverEnabled: true\n                    onEntered: {\n                        //baserect.color = \"gray\"\n                    }\n                    onExited: {\n                        //baserect.color = 'white'\n                    }\n                    onClicked: {\n                        listView.currentIndex = index\n                    }\n                }\n            }\n\n\n        }\n        focus: true\n        highlight: Rectangle {\n            z:1\n            color: \"#77B5D3E7\";\n            radius: 0 }\n        ScrollIndicator.horizontal: ScrollIndicator { }\n        ScrollIndicator.vertical: ScrollIndicator { }\n    }\n}\n</code></pre>\n\n<p>and example : </p>\n\n<pre><code> UTable{\n                id:_table\n                onCurrentIndexChanged: {\n                    console.log(currentIndex)\n                }\n                byColName: true\n                model: [{\"name\":\"test\",\"family\":\"test2\",\"number\":5,\"status\":\"online\"},{\"name\":\"ali\",\"family\":\"alavi\",\"number\":2,\"status\":\"offline\"}]\n                headerModel : [\n                        {\n                            \"title\":\"\u0646\u0627\u0645\",\n                            \"name\":\"name\",\n                            \"width\":0.3\n                        },{\n                            \"title\":\"\u062e\u0627\u0646\u0648\u0627\u062f\u06af\u06cc\",\n                            \"name\":\"family\",\n                            \"width\":0.2\n                        },{\n                            \"title\":\"\u0648\u0636\u0639\u06cc\u062a\",\n                            \"name\":\"status\",\n                            \"width\":0.25\n                        },{\n                            \"title\":\"\u0634\u0645\u0627\u0631\u0647\",\n                            \"name\":\"number\",\n                            \"width\":0.25\n                        }\n                    ]\n            }\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 2755144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sA35D.gif?s=128&g=1", "display_name": "ravandi", "link": "https://stackoverflow.com/users/2755144/ravandi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 449, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1557299733, "creation_date": 1449043300, "last_edit_date": 1500051340, "question_id": 34037565, "link": "https://stackoverflow.com/questions/34037565/how-to-set-a-table-in-qml-to-be-rtl", "title": "How to set a table in QML to be rtl?", "body": "<p>I want my table right to left.<br>\nThis is my table:</p>\n\n<p><img src=\"https://i.stack.imgur.com/wMvs2.png\" alt=\"table rtl\"></p>\n\n<p>After the run, I want it to be like this:</p>\n\n<p><img src=\"https://i.stack.imgur.com/0fy0y.png\" alt=\"table rtl\"></p>\n\n<p>The code is QML in the golang.\nI didn't find any answer.\nI asked at several sites, but There was no answer.</p>\n\n<p>My code:</p>\n\n<pre><code>import QtQuick 2.0\nimport QtQuick.Controls 1.0\nRectangle {\n    id:kol\n    width: 360\n    height: 360\n\nRectangle {\n    id:mos\n    width: 360\n    height: 360\n    anchors.centerIn: parent     \n\n    ListModel {\n        id: dataModel\n        ListElement {\n            color: \"\u0622\u0628\u06cc\"\n            text: \"\u0627\u0648\u0644\"\n        }\n        ListElement {\n            color: \"\u0642\u0631\u0645\u0632\"\n            text: \"\u062f\u0648\u0645\"\n        }\n        ListElement {\n            color: \"\u0633\u0628\u0632\"\n            text: \"\u0633\u0648\u0645\"\n        }\n        ListElement {\n            color: \"\u0632\u0631\u062f\"\n            text: \"\u0686\u0647\u0627\u0631\u0645\"\n        }\n    }\n\n    TableView {\n        id: view\n        model: dataModel\n        anchors.fill: parent\n\n        TableViewColumn {\n            width: 100\n            title: \"\u0631\u0646\u06af\"\n            role: \"color\"\n\n        }\n        TableViewColumn {\n            width: 100\n            title: \"\u0645\u062a\u0646\"\n            role: \"text\"\n        }\n\n        itemDelegate: Item {\n            Text {\n                anchors.right: parent.right\n               // renderType: Text.NativeRendering\n                text: styleData.value\n            }\n\n        }\n    }\n}\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "dictionary", "go", "google-cloud-datastore", "slice"], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 4924412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NZ579.jpg?s=128&g=1", "display_name": "PrasadJay", "link": "https://stackoverflow.com/users/4924412/prasadjay"}, "edited": false, "score": 0, "creation_date": 1449051023, "post_id": 34038394, "comment_id": 55834652, "body": "I removed the address operator and now im getting &quot;datastore: invalid entity type&quot; error."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 123, "user_id": 4924412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NZ579.jpg?s=128&g=1", "display_name": "PrasadJay", "link": "https://stackoverflow.com/users/4924412/prasadjay"}, "edited": false, "score": 0, "creation_date": 1449054780, "post_id": 34038394, "comment_id": 55837163, "body": "@PrasadJay Are you sure you&#39;re not mixing imports? It should be <code>&quot;google.golang.org&#47;cloud&#47;datastore&quot;</code>, and not <code>&quot;google.golang.org&#47;appengine&#47;datastore&quot;</code> nor <code>&quot;appengine&#47;datastore&quot;</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 123, "user_id": 4924412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NZ579.jpg?s=128&g=1", "display_name": "PrasadJay", "link": "https://stackoverflow.com/users/4924412/prasadjay"}, "edited": false, "score": 0, "creation_date": 1449056111, "post_id": 34038394, "comment_id": 55837996, "body": "@PrasadJay Also initialize your <code>props</code> like this (because if there are no key-value pairs in the map, <code>nil</code> will be problematic): <code>props := datastore.PropertyList{}</code>"}, {"owner": {"reputation": 123, "user_id": 4924412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NZ579.jpg?s=128&g=1", "display_name": "PrasadJay", "link": "https://stackoverflow.com/users/4924412/prasadjay"}, "edited": false, "score": 0, "creation_date": 1449118721, "post_id": 34038394, "comment_id": 55870185, "body": "No I&#39;m using cloud/datastore import. I edited the question and posted the full source file. In there single insert works so cannot be a connection issue. Can you identify where I have go wrong? I&#39;m really confused since there are no nil values even."}, {"owner": {"reputation": 123, "user_id": 4924412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NZ579.jpg?s=128&g=1", "display_name": "PrasadJay", "link": "https://stackoverflow.com/users/4924412/prasadjay"}, "edited": false, "score": 1, "creation_date": 1449132437, "post_id": 34038394, "comment_id": 55876156, "body": "I solved this using []interface{} rather than []datastore.PropertyList and correcting     propArray[index] = props to     propArray[index] = &amp;props   .Marking this answer as solved since it helped me so much. Thank you icza."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 123, "user_id": 4924412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NZ579.jpg?s=128&g=1", "display_name": "PrasadJay", "link": "https://stackoverflow.com/users/4924412/prasadjay"}, "edited": false, "score": 0, "creation_date": 1449137153, "post_id": 34038394, "comment_id": 55879198, "body": "@PrasadJay Thanks for the response, the problem may be that <code>PropertyList</code> itself doesn&#39;t implement <code>PropertyLoadSaver</code> interface, only <code>*PropertyList</code>. So I think your example would also work if <code>propArray</code> would be of type <code>[]*datastore.PropertyList</code>. Filling it: <code>propArray[index] = &amp;props</code>. Can you try this one too?"}, {"owner": {"reputation": 123, "user_id": 4924412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NZ579.jpg?s=128&g=1", "display_name": "PrasadJay", "link": "https://stackoverflow.com/users/4924412/prasadjay"}, "edited": false, "score": 0, "creation_date": 1449205553, "post_id": 34038394, "comment_id": 55915391, "body": "Tried it. Gives me &quot;datastore: src has invalid type&quot; error again. But with []interface works."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1449051933, "last_edit_date": 1449051933, "creation_date": 1449046341, "answer_id": 34038394, "question_id": 34037461, "link": "https://stackoverflow.com/questions/34037461/cannot-pass-datastore-propertylist-to-getmulti-function-datastore-src-has-in/34038394#34038394", "title": "Cannot pass []datastore.PropertyList to GetMulti function (datastore: src has invalid type)", "body": "<p>As the error indicates: <code>\"datastore: src has invalid type\"</code> the value you pass as <code>src</code> (<code>&amp;propArray</code>) has invalid type.</p>\n\n<p>You can't pass a value of type <code>*[]datastore.PropertyList</code> as the <code>src</code> parameter of <a href=\"https://godoc.org/google.golang.org/cloud/datastore#Client.PutMulti\" rel=\"nofollow\"><code>Client.PutMulti()</code></a>. Quoting from the doc:</p>\n\n<blockquote>\n  <p><code>src</code> must satisfy the same conditions as the <code>dst</code> argument to <code>GetMulti</code>.</p>\n</blockquote>\n\n<p>And the conditions of <code>dst</code> at <a href=\"https://godoc.org/google.golang.org/cloud/datastore#Client.GetMulti\" rel=\"nofollow\"><code>Client.GetMulti()</code></a>:</p>\n\n<blockquote>\n  <p><code>dst</code> must be a <code>[]S</code>, <code>[]*S</code>, <code>[]I</code> or <code>[]P</code>, for some struct type <code>S</code>, some interface type <code>I</code>, or some non-interface non-pointer type <code>P</code> such that <code>P</code> or <code>*P</code> implements <code>PropertyLoadSaver</code>. If an <code>[]I</code>, each element must be a valid <code>dst</code> for <code>Get</code>: it must be a struct pointer or implement <code>PropertyLoadSaver</code>.</p>\n</blockquote>\n\n<p>So you can't pass a pointer to slice, but you can and you should pass a slice (drop the address <code>&amp;</code> operator):</p>\n\n<pre><code>if _, err := client.PutMulti(ctx, keys, propArray); err != nil {\n    fmt.Println(err.Error())\n} else {\n    fmt.Println(\"Success!\")\n}\n</code></pre>\n\n<p><strong>Note:</strong> Seemingly you are creating keys with specific ids (which is the <code>index</code>). But if both the key name and id is the zero value, that is considered to be an incomplete key. Your first key will be an incomplete key as your <code>index</code> starts with <code>0</code>. You might want to use different ids than the index.</p>\n"}], "owner": {"reputation": 123, "user_id": 4924412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NZ579.jpg?s=128&g=1", "display_name": "PrasadJay", "link": "https://stackoverflow.com/users/4924412/prasadjay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 566, "favorite_count": 0, "accepted_answer_id": 34038394, "answer_count": 1, "score": 4, "last_activity_date": 1536075811, "creation_date": 1449042885, "last_edit_date": 1536075811, "question_id": 34037461, "link": "https://stackoverflow.com/questions/34037461/cannot-pass-datastore-propertylist-to-getmulti-function-datastore-src-has-in", "title": "Cannot pass []datastore.PropertyList to GetMulti function (datastore: src has invalid type)", "body": "<p>I have wrote the following function, since passing map going to be dynamic I'm using <code>datastore.PropertyList</code>. Single insert works with <code>PropertyList</code>, but in <code>Multiple</code> insert an error is displayed as \"datastore: src has invalid type\"</p>\n\n<p><strong>Edited and added the full source</strong></p>\n\n<p>Where I have gone wrong?</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\"golang.org/x/net/context\"\n\"golang.org/x/oauth2/google\"\n\"google.golang.org/cloud\"\n\"google.golang.org/cloud/datastore\"\n\"io/ioutil\"\n)\n\nfunc main() {\n//Single Insert\n\n// var map0 map[string]interface{}\n// map0 = make(map[string]interface{})\n// map0[\"Id\"] = \"600\"\n// map0[\"Name\"] = \"Prasad\"\n// map0[\"Age\"] = 23\n\n// setOneDataStore(map0)\n\n//Multiple Insert\n\nvar allMaps []map[string]interface{}\nallMaps = make([]map[string]interface{}, 2)\n\nvar map1 map[string]interface{}\nmap1 = make(map[string]interface{})\nmap1[\"Id\"] = \"700\"\nmap1[\"Name\"] = \"Jay\"\nmap1[\"Age\"] = 23\n\nvar map2 map[string]interface{}\nmap2 = make(map[string]interface{})\nmap2[\"Id\"] = \"800\"\nmap2[\"Name\"] = \"Peter\"\nmap2[\"Age\"] = 30\n\nallMaps[0] = map1\nallMaps[1] = map2\n\nsetManyDataStore(allMaps)\n}\n\nfunc getDataStoreClient() (client *datastore.Client, err error) {\n\nkeyFile := \"JAYWORLD-30y4f7c347pq.json\"\nprojectID := \"jay-world\"\n\njsonKey, err := ioutil.ReadFile(keyFile)\nif err != nil {\n    fmt.Println(err.Error())\n} else {\n    conf, err := google.JWTConfigFromJSON(\n        jsonKey,\n        datastore.ScopeDatastore,\n        datastore.ScopeUserEmail,\n    )\n    if err != nil {\n        fmt.Println(err.Error())\n    } else {\n        ctx := context.Background()\n        client, err = datastore.NewClient(ctx, projectID, cloud.WithTokenSource(conf.TokenSource(ctx)))\n        if err != nil {\n            fmt.Println(err.Error())\n        }\n    }\n}\n\nreturn\n}\n\nfunc setManyDataStore(Objects []map[string]interface{}) {\nctx := context.Background()\nclient, err := getDataStoreClient() //have connection code in another function\nctx = datastore.WithNamespace(ctx, \"CompanyA\")\n\nif err == nil {\n\n    var keys []*datastore.Key\n    keys = make([]*datastore.Key, len(Objects))\n    var propArray []datastore.PropertyList\n    propArray = make([]datastore.PropertyList, len(Objects))\n\n    for index := 0; index &lt; len(Objects); index++ {\n        keys[index] = datastore.NewKey(ctx, \"users\", Objects[index][\"Id\"].(string), 0, nil)\n\n        props := datastore.PropertyList{}\n\n        for key, value := range Objects[index] {\n            props = append(props, datastore.Property{Name: key, Value: value})\n        }\n        propArray[index] = props\n    }\n\n    if _, err := client.PutMulti(ctx, keys, propArray); err != nil {\n        fmt.Println(err.Error())\n    } else {\n        fmt.Println(\"Success!\")\n    }\n\n} else {\n    fmt.Println(\"Connection Failed\")\n}\n}\n\nfunc setOneDataStore(Object map[string]interface{}) {\n\nctx := context.Background()\nclient, err := getDataStoreClient() //have connection code in another function\nctx = datastore.WithNamespace(ctx, \"CompanyA\")\n\nkey := datastore.NewKey(ctx, \"users\", Object[\"Id\"].(string), 0, nil)\n\nprops := datastore.PropertyList{}\n\nfor key, value := range Object {\n    props = append(props, datastore.Property{Name: key, Value: value})\n}\n\n_, err = client.Put(ctx, key, &amp;props)\nif err != nil {\n    fmt.Println(err.Error())\n} else {\n    fmt.Println(\"Success!\")\n}\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 0, "creation_date": 1449033438, "post_id": 34035394, "comment_id": 55826081, "body": "there&#39;s a similar example and explaination here <a href=\"http://www.goinggo.net/2014/06/pitfalls-with-closures-in-go.html\" rel=\"nofollow noreferrer\">goinggo.net/2014/06/pitfalls-with-closures-in-go.html</a>"}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1449033561, "post_id": 34035394, "comment_id": 55826115, "body": "this is like art, thanks! been beating my head off the wall for the last few hours"}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1449035130, "post_id": 34035394, "comment_id": 55826663, "body": "Quick question, after fixing this data race I have 2 other data races I need to cure, any tips on debugging data races? Both seem to be from accessing the the same <code>map</code> and setting a variable in it, I have tried putting a mutex around the map but it still has a race"}, {"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "reply_to_user": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1449071665, "post_id": 34035394, "comment_id": 55848799, "body": "you&#39;ll need a lock around the map for sure. hard to say why its still a race without seeing the code. [post a new question]"}], "tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": true, "score": 8, "last_activity_date": 1449033226, "creation_date": 1449033226, "answer_id": 34035394, "question_id": 34035072, "link": "https://stackoverflow.com/questions/34035072/how-come-this-loop-is-considered-a-data-race-golang/34035394#34035394", "title": "How come this loop is considered a data race [Golang]", "body": "<p>the problem is that the goroutine is accessing the variable 'member' via the closure, and in go this reference is evaluated when its reached (i.e. it sees the value of member as of when the goroutine executes, not when it was created via the go func()... call. the member variable is being updated by the loop, so there's a race between the loop updates and the goroutines you've started reading them. (you'll find if you dig further that your db doesn't see the exact set of members from the collection). Typically you resolve this by forcing an evaluation of the variable in the loop, either by creating a local var, or by adding it as a parameter to the func, e.g.</p>\n\n<pre><code>var wg sync.WaitGroup\n\nfor _, member := range p.Members {\n    wg.Add(1)\n    m := member\n    go func() {\n        _, err := db.Exec(\"UPDATE party_members SET active = ? WHERE steamid = ?\", false, m.SteamID)\n        ...\n        wg.Done()\n    }() \n}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>var wg sync.WaitGroup\n\nfor _, member := range p.Members {\n    wg.Add(1)\n    go func(m memberType) {\n        _, err := db.Exec(\"UPDATE party_members SET active = ? WHERE steamid = ?\", false, m.SteamID)\n        ...\n        wg.Done()\n    }(member) \n}\n</code></pre>\n\n<p>also note that you need to call wg.Add(1) from the loop, not from within the goroutine itself.</p>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 530, "favorite_count": 1, "accepted_answer_id": 34035394, "answer_count": 1, "score": 3, "last_activity_date": 1449033226, "creation_date": 1449031335, "question_id": 34035072, "link": "https://stackoverflow.com/questions/34035072/how-come-this-loop-is-considered-a-data-race-golang", "title": "How come this loop is considered a data race [Golang]", "body": "<p>I have a loop and I get this error, I'm running <code>go run -race main.go</code></p>\n\n<p>This is the loop in question:</p>\n\n<pre><code>var wg sync.WaitGroup\n\nfor _, member := range p.Members { &lt;&lt; Line 254\n    go func() {\n        wg.Add(1)\n        _, err := db.Exec(\"UPDATE party_members SET active = ? WHERE steamid = ?\", false, member.SteamID) &lt;&lt; Line 257\n        if err != nil {\n            log.Println(err)\n        }\n        _, err = db.Exec(\"INSERT INTO party_members SET belongs_to =?, active = ?, steamid = ?\", partyUUID, true, member.SteamID)\n        if err != nil {\n            log.Println(err)\n        }\n        wg.Done()\n    }() &lt;&lt; Line 266\n}\n</code></pre>\n\n<p>and then this is the error I get :</p>\n\n<pre><code>WARNING: DATA RACE\nRead by goroutine 44:\n  BLAH/controllers/partybot.func\u00b7001()\n      /Users/Dev/gocode/src/BLAH/controllers/partybot/partybot.go:257 +0x136\n\nPrevious write by goroutine 43:\n  BLAH/controllers/partybot.(*PartialParty).SendReadyCheck()\n      /Users/Dev/gocode/src/BLAH/controllers/partybot/partybot.go:254 +0xda5\n\nGoroutine 44 (running) created at:\n  BLAH/controllers/partybot.(*PartialParty).SendReadyCheck()\n      /Users/Dev/gocode/src/BLAH/controllers/partybot/partybot.go:266 +0xf13\n\nGoroutine 43 (finished) created at:\n  BLAH/controllers/partybot.(*PartyHub).SortMemberIntoParty()\n      /Users/Dev/gocode/src/BLAH/controllers/partybot/partybot.go:173 +0xdb9\n  BLAH/controllers/partybot.(*Connection).readPump()\n      /Users/Dev/gocode/src/BLAH/controllers/partybot/partybot.go:359 +0x1872\n  BLAH/controllers/partybot.WSPartyBot()\n      /Users/Dev/gocode/src/BLAH/controllers/partybot/partybot.go:440 +0x4f0\n  net/http.HandlerFunc.ServeHTTP()\n      /usr/local/go/src/net/http/server.go:1265 +0x4e\n  github.com/gorilla/mux.(*Router).ServeHTTP()\n      /Users/Dev/gocode/src/github.com/gorilla/mux/mux.go:98 +0x377\n  BLAH/controllers/common.func\u00b7001()\n      /Users/Dev/gocode/src/BLAH/controllers/common/common.go:36 +0xc2\n  net/http.HandlerFunc.ServeHTTP()\n      /usr/local/go/src/net/http/server.go:1265 +0x4e\n  net/http.(*ServeMux).ServeHTTP()\n      /usr/local/go/src/net/http/server.go:1541 +0x20c\n  net/http.serverHandler.ServeHTTP()\n      /usr/local/go/src/net/http/server.go:1703 +0x1f6\n  net/http.(*conn).serve()\n      /usr/local/go/src/net/http/server.go:1204 +0x1087\n==================\n</code></pre>\n\n<p>I'm not sure why this is a Data race as I'm fairly new to Go anyways if anybody could tell me why this is that would be great, I marked the lines in question.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1105, "user_id": 3051060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dZeQp.jpg?s=128&g=1", "display_name": "rcmgleite", "link": "https://stackoverflow.com/users/3051060/rcmgleite"}, "is_accepted": false, "score": 3, "last_activity_date": 1449027104, "creation_date": 1449027104, "answer_id": 34034427, "question_id": 34034390, "link": "https://stackoverflow.com/questions/34034390/moving-line-place-in-gowith-stdout/34034427#34034427", "title": "Moving line place in go(with stdout)", "body": "<p>Look at this link to math.Abs:\n<a href=\"https://golang.org/pkg/math/#Abs\" rel=\"nofollow\">https://golang.org/pkg/math/#Abs</a></p>\n\n<p>What it does is return the absolute value of\u00a0the argument given.\nThats why math.Sqrt works when you use it.</p>\n\n<p>You should really read the godocs. They are easy to understand and you will be able to learn the basics for yourself...</p>\n"}], "owner": {"reputation": 193, "user_id": 5574609, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-Z8DszpZmPOA/AAAAAAAAAAI/AAAAAAAAABI/qRBWSg0ue2E/photo.jpg?sz=128", "display_name": "liam", "link": "https://stackoverflow.com/users/5574609/liam"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "closed_date": 1449728789, "answer_count": 1, "score": -7, "last_activity_date": 1467498679, "creation_date": 1449026853, "last_edit_date": 1467498679, "question_id": 34034390, "link": "https://stackoverflow.com/questions/34034390/moving-line-place-in-gowith-stdout", "closed_reason": "Needs details or clarity", "title": "Moving line place in go(with stdout)", "body": "<p>I have a chat server project <a href=\"https://github.com/17liamnaddell/LMCCS\" rel=\"nofollow\">here</a> with two parts, one as the receiver (lnet) and one as the server (nhelo). But sometimes a person will be typing, then a message will pop up on the screen, the message will be on the same line, for example: </p>\n\n<pre><code>I am typing foo\nI receive a message that says hello world\nSTDOUT looks like this:\nfoohello world\n</code></pre>\n\n<p>The most simple solution I can see would be moving foo up a line, or moving hello world one line back Whatever makes stdout look like this:</p>\n\n<pre><code>I am typing foo\nI receive a message that says hello world\nSTDOUT looks like this:\nhello world\nfoo\n</code></pre>\n\n<p>I have been researching go printing verbs for ~5 hours, could anybody help?</p>\n"}, {"tags": ["go", "windows-10"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1449024071, "post_id": 34033790, "comment_id": 55823232, "body": "Are you running any sort of antivirus?"}, {"owner": {"reputation": 894, "user_id": 3207602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73444706548405af39644f73830173d6?s=128&d=identicon&r=PG", "display_name": "JDWardle", "link": "https://stackoverflow.com/users/3207602/jdwardle"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1449024205, "post_id": 34033790, "comment_id": 55823274, "body": "@JimB, yup. Avast was blocking all go files from running due to how different they are when compared to the more common C compiled binaries. Ended up excluding the directory where I installed Go and my GOPATH. Also had to add an exclusion to the temporary directory that Go would use when running programs. It was <code>C:\\Users\\user\\AppData\\Local\\Temp\\go-build*\\*</code> for me. Added exclusions for the File System Shield and the exclusions section under General."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1449047981, "post_id": 34033790, "comment_id": 55832746, "body": "@JDWardle If you&#39;ve found a solution yourself, you should <a href=\"http://stackoverflow.com/help/self-answer\">post an answer</a> to make it more visible for the people who have the same problem."}], "answers": [{"comments": [{"owner": {"reputation": 162, "user_id": 2397038, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1ca3ddf2bbfa2792d9243004adb0164?s=128&d=identicon&r=PG", "display_name": "Wildex999", "link": "https://stackoverflow.com/users/2397038/wildex999"}, "edited": false, "score": 1, "creation_date": 1449871011, "post_id": 34057027, "comment_id": 56210249, "body": "Thanks, worked. However for the exclusions, you must run &quot;go run -x filename.go&quot; and check the EXACT path used. For example, for me the path was &quot;C:\\Users\\WILDEX~1\\AppData\\...&quot; instead of &quot;C:\\Users\\Wildex999\\AppData\\...&quot;. And I had to input exactly that for it to work, even though they are both the same path."}, {"owner": {"reputation": 231, "user_id": 9352815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOHKn.jpg?s=128&g=1", "display_name": "InvisibleExo", "link": "https://stackoverflow.com/users/9352815/invisibleexo"}, "edited": false, "score": 0, "creation_date": 1607289163, "post_id": 34057027, "comment_id": 115219213, "body": "Thank you. I was getting very irretated every time my pc ran Go Code. FYI, for a more up to date place to add Exclusions in your Avast is Exceptions. You can go to Menu &gt; General &gt; Exceptions, then add your Go directories paths."}], "tags": [], "owner": {"reputation": 894, "user_id": 3207602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73444706548405af39644f73830173d6?s=128&d=identicon&r=PG", "display_name": "JDWardle", "link": "https://stackoverflow.com/users/3207602/jdwardle"}, "is_accepted": true, "score": 13, "last_activity_date": 1449111190, "creation_date": 1449111190, "answer_id": 34057027, "question_id": 34033790, "link": "https://stackoverflow.com/questions/34033790/go-programs-hanging-on-windows-10/34057027#34057027", "title": "Go programs hanging on Windows 10", "body": "<p>Avast was being dumb. Disabled Avast and the programs all worked....</p>\n\n<p>Of course leaving Avast disabled is not ideal so I had to figure out a way to exclude go files. Unfortunately there's no way to exclude go compiled files themselves, unless you set up individual exclusions for the binaries. However excluding go specific directories will work.</p>\n\n<p>I ended up excluding the installation location of go for me this was <code>C:\\Go</code> and the directory of GOPATH <code>E:\\go</code> for me.</p>\n\n<p>This worked for the most part as long as binaries were run from either of those two directories, but I was still having issues with using the <code>go run</code> command. Using the <code>go run -x</code> command I was able to find out where Go was putting the temporary compiled binaries. This ended up being at <code>C:\\Users\\username\\AppData\\Local\\Temp\\go-build1234\\</code>. However go would create a new directory each time I used <code>go run</code> so I had to create an exclusion on Avast with two wildcards set <code>C:\\Users\\username\\AppData\\Local\\Temp\\go-build*\\*</code>. Now programs will run correctly.</p>\n\n<p>These are the exclusions I ended up with:\n<a href=\"https://i.stack.imgur.com/GMfKs.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/GMfKs.png\" alt=\"Go Avast exclusions\"></a></p>\n"}], "owner": {"reputation": 894, "user_id": 3207602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73444706548405af39644f73830173d6?s=128&d=identicon&r=PG", "display_name": "JDWardle", "link": "https://stackoverflow.com/users/3207602/jdwardle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3006, "favorite_count": 2, "accepted_answer_id": 34057027, "answer_count": 1, "score": 6, "last_activity_date": 1477175112, "creation_date": 1449022847, "last_edit_date": 1470207260, "question_id": 34033790, "link": "https://stackoverflow.com/questions/34033790/go-programs-hanging-on-windows-10", "title": "Go programs hanging on Windows 10", "body": "<p>I've been having issues with all Go programs hanging on Windows, even a simple Hello world program. I've reinstalled Golang multiple times with nothing changing. I can't use Ctrl+X or Ctrl+D to close the program either. It'll still spawn the process which will show up on Process Monitor. But I can't kill it from there or from the command line.</p>\n\n<p>There was a similar issue to this posted on reddit <a href=\"https://www.reddit.com/r/golang/comments/2lvnqk/not_even_hello_world_works/\" rel=\"nofollow\">https://www.reddit.com/r/golang/comments/2lvnqk/not_even_hello_world_works/</a>. But that still has no resolution.</p>\n\n<p>The is the program I'm trying to get to run right now:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello, world!\")\n}\n</code></pre>\n\n<p>Running it with <code>go run -x</code> gives this output:</p>\n\n<pre><code>WORK=C:\\Users\\User\\AppData\\Local\\Temp\\go-build882050150\nmkdir -p $WORK\\command-line-arguments\\_obj\\\nmkdir -p $WORK\\command-line-arguments\\_obj\\exe\\\ncd E:\\go\\src\\github.com\\test\\hello\n\"C:\\\\Go\\\\pkg\\\\tool\\\\windows_amd64\\\\compile.exe\" -o \"C:\\\\Users\\\\User\\\\AppData\\\\Local\\\\Temp\\\\go-build882050150\\\\command-line-arguments.a\" -trimpath \"C:\\\\Users\\\\User\\\\AppData\\\\Local\\\\Temp\\\\go-build882050150\" -p main -complete -buildid 0180ed6e175ea3e4bc497fc21fe0319a733a9c8e -D _/E_/go/src/github.com/test/hello -I \"C:\\\\Users\\\\User\\\\AppData\\\\Local\\\\Temp\\\\go-build882050150\" -pack \"E:\\\\go\\\\src\\\\github.com\\\\test\\\\hello\\\\main.go\"\ncd .\n\"C:\\\\Go\\\\pkg\\\\tool\\\\windows_amd64\\\\link.exe\" -o \"C:\\\\Users\\\\User\\\\AppData\\\\Local\\\\Temp\\\\go-build882050150\\\\command-line-arguments\\\\_obj\\\\exe\\\\main.exe\" -L \"C:\\\\Users\\\\User\\\\AppData\\\\Local\\\\Temp\\\\go-build882050150\" -w -extld=gcc -buildmode=exe -buildid=0180ed6e175ea3e4bc497fc21fe0319a733a9c8e \"C:\\\\Users\\\\User\\\\AppData\\\\Local\\\\Temp\\\\go-build882050150\\\\command-line-arguments.a\"\n$WORK\\command-line-arguments\\_obj\\exe\\main.exe\n</code></pre>\n\n<p>After that it just sits there and dose nothing. Doesn't matter what program I run it will always hang forever.</p>\n\n<p>No idea where to go from here. I don't really develop on Windows but I was trying to work with cross-compilation on Ubuntu and having run into this issue with the cross-compiled binary I thought I'd try compiling directly on Windows. But it appears my Windows just doesn't like Golang compiled binaries.</p>\n\n<p>Go version is 1.5.1 windows/amd64.</p>\n\n<p>Here's the output of <code>go env</code>:</p>\n\n<pre><code>set GOARCH=amd64\nset GOBIN=\nset GOEXE=.exe\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=windows\nset GOPATH=E:\\go\nset GORACE=\nset GOROOT=C:\\Go\nset GOTOOLDIR=C:\\Go\\pkg\\tool\\windows_amd64\nset GO15VENDOREXPERIMENT=\nset CC=gcc\nset GOGCCFLAGS=-m64 -mthreads -fmessage-length=0\nset CXX=g++\nset CGO_ENABLED=1\n</code></pre>\n"}, {"tags": ["go", "bson", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "edited": false, "score": 0, "creation_date": 1449086227, "post_id": 34033283, "comment_id": 55858006, "body": "thanks for your answer, this is what I also thought should work but I had a bug (before I posted it here), actually I have multiple levels of bson maps, where I made a mistake and I thought it wont work like that :("}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1449019369, "last_edit_date": 1449019369, "creation_date": 1449019047, "answer_id": 34033283, "question_id": 34032871, "link": "https://stackoverflow.com/questions/34032871/how-to-create-bson-map-based-on-input/34033283#34033283", "title": "how to create bson map based on input", "body": "<p>How about this:</p>\n\n<pre><code>func buildBsonObject(value_1 string, value_2 string) bson.M {\n  m := bson.M{\n    \"$match\": bson.M{\n        \"xyz\": \"abc\",\n    },\n  }\n  if value_1 != \"\" {\n    m[\"$id_1\"] = value_1\n  }\n  if value_2 != \"\" {\n    m[\"$id_2\"] = value_2\n  }\n  return m\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/Z09GrQr5gl\" rel=\"nofollow\">playground example</a></p>\n\n<p>An alternative is to pass the key name to the function:</p>\n\n<pre><code>func buildBsonObject(k string, v string) bson.M {\n  return bson.M{\n    \"$match\": bson.M{\n        \"xyz\": \"abc\",\n    },\n    k: v,\n  }\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/G3XRK1fKfY\" rel=\"nofollow\">playground example</a></p>\n"}], "owner": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 752, "favorite_count": 0, "accepted_answer_id": 34033283, "answer_count": 1, "score": 0, "last_activity_date": 1449019369, "creation_date": 1449016339, "last_edit_date": 1449018323, "question_id": 34032871, "link": "https://stackoverflow.com/questions/34032871/how-to-create-bson-map-based-on-input", "title": "how to create bson map based on input", "body": "<p>I am building a bson map in golang using mgo library. I want to refactor some code to be able to avoid duplication. </p>\n\n<p>Consider this: </p>\n\n<pre><code>    bson.M {\n         \"$match\" : bson.M{\n            \"xyz\" : \"abc\",\n          },\n          \"$id_1\" : value_1, \n    }\n</code></pre>\n\n<p>and another bson map of type:</p>\n\n<pre><code>    bson.M {\n         \"$match\" : bson.M{\n            \"xyz\" : \"abc\",\n          },\n          \"$id_2\" : value_2,\n    }\n</code></pre>\n\n<p>How can I combine the two (build bson.M from a function and return, value1/2 are params to this func) to be used based on if value_1 is empty string or value_2 is empty string. </p>\n\n<p>For example: if I build a the following function. My intention is to build map of first type (see above) by calling buildBsonObject(\"123\",\"\") and the second one by calling buildBsonObject(\"\", \"456\").</p>\n\n<pre><code>func buildBsonObject (value_1 string, value_2 string) {    \n    return bson.M {\n             \"$match\" : bson.M{\n                \"xyz\" : \"abc\",\n              },\n              \"$id_1\" : value_1, \n              \"$id_2\" : value_2,\n        }\n}\n</code></pre>\n\n<p>If I do the following (see function buildBsonObject), then when value_1 is empty string, my mongo aggregation query will not work since it will treat as id_1 being \"\", whereas I intended to just have id_2 in my bson object. </p>\n\n<p>Any suggestions on how to do this. Thanks.</p>\n"}, {"tags": ["mongodb", "go", "unmarshalling", "mgo"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1449019772, "post_id": 34032692, "comment_id": 55822040, "body": "can you do it with native mongodb client? you may not support a db client to do much helper functions. but you can do it with a simple function to convert a []struct to []int64."}], "answers": [{"comments": [{"owner": {"reputation": 1592, "user_id": 618951, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b867e8993ce4bf8205315e4a2e45e418?s=128&d=identicon&r=PG", "display_name": "RisingSun", "link": "https://stackoverflow.com/users/618951/risingsun"}, "edited": false, "score": 0, "creation_date": 1449020914, "post_id": 34033398, "comment_id": 55822365, "body": "That is what I ended up using. Was just feeling weird writing that conversion and wanted to see if there was another way. Thanks"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1449019791, "creation_date": 1449019791, "answer_id": 34033398, "question_id": 34032692, "link": "https://stackoverflow.com/questions/34032692/golang-mgo-result-into-simple-slice/34033398#34033398", "title": "Golang mgo result into simple slice", "body": "<p>Because mgo queries return documents, a few lines of code is required to accomplish the goal:</p>\n\n<pre><code>var result []struct{ UserID int64 `bson:\"userid\"` }\nerr := coll.Find(bson.M{\"isdeleted\": false}).Select(bson.M{\"userid\": 1}).All(&amp;result)\nif err != nil {\n    // handle error\n}\nuserIDs := make([]int64, len(result))\nfor i := range result {\n    userIDs[i] = result.UserID\n}\n</code></pre>\n"}], "owner": {"reputation": 1592, "user_id": 618951, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b867e8993ce4bf8205315e4a2e45e418?s=128&d=identicon&r=PG", "display_name": "RisingSun", "link": "https://stackoverflow.com/users/618951/risingsun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1340, "favorite_count": 0, "accepted_answer_id": 34033398, "answer_count": 1, "score": 1, "last_activity_date": 1449019791, "creation_date": 1449015103, "question_id": 34032692, "link": "https://stackoverflow.com/questions/34032692/golang-mgo-result-into-simple-slice", "title": "Golang mgo result into simple slice", "body": "<p>I'm fairly new to both Go and MongoDB. Trying to select a single field from the DB and save it in an int slice without any avail.</p>\n\n<pre><code>userIDs := []int64{}\n\ncoll.Find(bson.M{\"isdeleted\": false}).Select(bson.M{\"userid\": 1}).All(&amp;userIDs)\n</code></pre>\n\n<p>The above prints out an empty slice. However, if I create a struct with a single <code>ID</code> field that is int64 with marshalling then it works fine.</p>\n\n<p>All I am trying to do is work with a simple slice containing IDs that I need instead of a struct with a single field. All help is appreciated.</p>\n"}, {"tags": ["json", "encoding", "go", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 485, "user_id": 1352179, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9d5486c6e0256290898d2b48f0204049?s=128&d=identicon&r=PG", "display_name": "GoT", "link": "https://stackoverflow.com/users/1352179/got"}, "edited": false, "score": 0, "creation_date": 1449012772, "post_id": 34032205, "comment_id": 55819793, "body": "Thanks,It works.  why do you recommend response := KeysResponse{keys}"}, {"owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "reply_to_user": {"reputation": 485, "user_id": 1352179, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9d5486c6e0256290898d2b48f0204049?s=128&d=identicon&r=PG", "display_name": "GoT", "link": "https://stackoverflow.com/users/1352179/got"}, "edited": false, "score": 0, "creation_date": 1449012958, "post_id": 34032205, "comment_id": 55819869, "body": "@user1352179 It assigns <code>keys</code> to your <code>Collection</code> field."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 485, "user_id": 1352179, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9d5486c6e0256290898d2b48f0204049?s=128&d=identicon&r=PG", "display_name": "GoT", "link": "https://stackoverflow.com/users/1352179/got"}, "edited": false, "score": 0, "creation_date": 1449014068, "post_id": 34032205, "comment_id": 55820322, "body": "@user1352179 yeah that line just creates a new instance of <code>KeysResponse</code> with the <code>keys</code> value you got from unmarshalling the string. If that type has some value to you (it doesn&#39;t seem to in your example but could have other functionality and/or data on the type) then you probably would want to do that."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1449012503, "creation_date": 1449012503, "answer_id": 34032205, "question_id": 34032150, "link": "https://stackoverflow.com/questions/34032150/unmarshalling-a-json-array-in-golang/34032205#34032205", "title": "Unmarshalling a json array in golang", "body": "<p>That's not expected to work. What you have in the json is an array of type <code>PublicKey</code>. The <code>KeysResponse</code> type would be used for json looking like this;</p>\n\n<pre><code>{\n   \"Collection\": [{\"id\": 1,\"key\": \"-\"},{\"id\": 2,\"key\": \"-\"},{\"id\": 3,\"key\": \"-\"}]\n}\n</code></pre>\n\n<p>Which is not what you have. If you want the data to be stored in that type I'd recommend the following; <code>response := KeysResponse{keys}</code> on the line after you unmarshal into <code>keys</code>.</p>\n\n<p>To elaborate on that distinction. In the working case the json is just an array with objects inside of it. The json I wrote above is an object which has a single property named <code>Collection</code> which is of type array and the objects in the array are represented by the <code>PublicKey</code> type (objects with an int called id and a string called key). When working on code to unmarshal json, it's helpful to describe the structure using plain English like this, it tells you precisely what types/structures you need in Go to hold the data.</p>\n"}], "owner": {"reputation": 485, "user_id": 1352179, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9d5486c6e0256290898d2b48f0204049?s=128&d=identicon&r=PG", "display_name": "GoT", "link": "https://stackoverflow.com/users/1352179/got"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 845, "favorite_count": 0, "accepted_answer_id": 34032205, "answer_count": 1, "score": -1, "last_activity_date": 1449012503, "creation_date": 1449012258, "question_id": 34032150, "link": "https://stackoverflow.com/questions/34032150/unmarshalling-a-json-array-in-golang", "title": "Unmarshalling a json array in golang", "body": "<p>I have a question regarding the golang unmarshalling . I was trying to unmarshal Json array but it is giving nil result for one decoding while it is successful in the other. I don't understand the reason behind it. Is it a mistake in the code or expected? </p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"encoding/json\"\n\ntype PublicKey struct {\n    Id int\n    Key string\n}\n\ntype KeysResponse struct {\n    Collection []PublicKey\n}\n\nfunc main() {\n    keysBody := []byte(`[{\"id\": 1,\"key\": \"-\"},{\"id\": 2,\"key\": \"-\"},{\"id\": 3,\"key\": \"-\"}]`)\n    keys := make([]PublicKey,0)\n\n    json.Unmarshal(keysBody, &amp;keys)//This works\n    fmt.Printf(\"%#v\\n\", keys)\n    response := KeysResponse{}\n    json.Unmarshal(keysBody, &amp;response)//This doesn't work\n    fmt.Printf(\"%#v\\n\", response)\n\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/L9xDG26M8-\" rel=\"nofollow\">http://play.golang.org/p/L9xDG26M8-</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 32, "creation_date": 1449048065, "post_id": 34031801, "comment_id": 55832805, "body": "@Volker then put a disclaimer saying that the Go people on stackoverflow only answers questions that are not on the Tour of Go. In the Haskell community, people can ask questions like <a href=\"http://stackoverflow.com/questions/5217171/how-can-i-get-nth-element-from-the-list-in-haskell\">How can I get <code>n</code>th element from the list in Haskell?</a>, which is in the Introduction on <a href=\"http://learnyouahaskell.com/starting-out#an-intro-to-lists\" rel=\"nofollow noreferrer\">Learn you a Haskell for Great Good</a> and get their questions answered without a fuss made about it."}, {"owner": {"reputation": 53647, "user_id": 117471, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/959ccd33301cb3c15953c1a632a36763?s=128&d=identicon&r=PG", "display_name": "Bruno Bronosky", "link": "https://stackoverflow.com/users/117471/bruno-bronosky"}, "edited": false, "score": 33, "creation_date": 1537805163, "post_id": 34031801, "comment_id": 91907958, "body": "When I had this question, I first went to the Go Tour. I checked all the &quot;Function&quot; titles and none of the examples covered this. <a href=\"https://tour.golang.org/basics/4\" rel=\"nofollow noreferrer\">tour.golang.org/basics/4</a> <a href=\"https://tour.golang.org/basics/5\" rel=\"nofollow noreferrer\">tour.golang.org/basics/5</a> If you don&#39;t know to expand Methods and interfaces, you won&#39;t see the &quot;Methods are functions&quot; title. This question a valid and great for Google indexing. The duplicate flag zealots need to lighten up."}, {"owner": {"reputation": 682, "user_id": 1246955, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77a353e3c011db7bbd6c7e3fa2ebea00?s=128&d=identicon&r=PG", "display_name": "David K", "link": "https://stackoverflow.com/users/1246955/david-k"}, "edited": false, "score": 22, "creation_date": 1543505483, "post_id": 34031801, "comment_id": 93951725, "body": "Thanks for not being specific in your question, because it was enough to help me find the answer!"}, {"owner": {"reputation": 627, "user_id": 4085279, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/5a8797c97174bd32b60eea36a6281682?s=128&d=identicon&r=PG&f=1", "display_name": "Ajak6", "link": "https://stackoverflow.com/users/4085279/ajak6"}, "edited": false, "score": 7, "creation_date": 1568270031, "post_id": 34031801, "comment_id": 102222355, "body": "You asked exactly what I searched for, its a valid question. Thank you. I read all kind of function definition and no one explained this. I still tried writing my nube question and found this."}], "answers": [{"comments": [{"owner": {"reputation": 8171, "user_id": 1485715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6a5a795cd85ebc0513cabb2a064082c?s=128&d=identicon&r=PG", "display_name": "Marius Waldal", "link": "https://stackoverflow.com/users/1485715/marius-waldal"}, "edited": false, "score": 10, "creation_date": 1511104265, "post_id": 34031889, "comment_id": 81708841, "body": "Good explanation and extra karma points for linking to the relevant spec"}, {"owner": {"reputation": 370, "user_id": 4278141, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003340360997/picture?type=large", "display_name": "tw_hoff", "link": "https://stackoverflow.com/users/4278141/tw-hoff"}, "edited": false, "score": 6, "creation_date": 1529942006, "post_id": 34031889, "comment_id": 89047257, "body": "The golang tour has some pretty useful examples too <a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">tour.golang.org/methods/1</a>"}, {"owner": {"reputation": 304, "user_id": 8513812, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Vu6WfWsdYt4/AAAAAAAAAAI/AAAAAAAAA7w/x4W4U7mVmAM/photo.jpg?sz=128", "display_name": "Parm", "link": "https://stackoverflow.com/users/8513812/parm"}, "edited": false, "score": 0, "creation_date": 1596733443, "post_id": 34031889, "comment_id": 111912869, "body": "Also maybe worth noting: <code>s.BlockingClose()</code> is equivalent to <code>(&amp;s).BlockingClose()</code>. This is because Go recognizes (from the declaration of the method BlockingClose) that the receiver, <code>s</code>, should be a pointer and treats it as such."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 251, "last_activity_date": 1449011622, "last_edit_date": 1449011622, "creation_date": 1449011011, "answer_id": 34031889, "question_id": 34031801, "link": "https://stackoverflow.com/questions/34031801/function-declaration-syntax-things-in-parenthesis-before-function-name/34031889#34031889", "title": "Function declaration syntax: things in parenthesis before function name", "body": "<p>This is called the 'receiver'. In the first case <code>(h handler)</code> it is a value type, in the second <code>(s *GracefulServer)</code> it is a pointer. The way this works in Go may vary a bit from some other languages. The receiving type however, works more or less like a class in most object-oriented programming. It is the thing you call the method from, much like if I put some method <code>A</code> in side some class <code>Person</code> then I would need an instance of type <code>Person</code> in order to call <code>A</code> (assuming it's an instance method and not static!).</p>\n\n<p>One gotcha here is that the receiver gets pushed onto the call stack like other arguments so if the receiver is a value type, like in the case of <code>handler</code> then you will be working on a copy of the thing you called the method from meaning something like <code>h.Name = \"Evan\"</code> would not persist after you return to the calling scope. For this reason anything that expects to change the state of the receiver, needs to use a pointer or return the modified value (gives more of an immutable type paradigm if you're looking for that).</p>\n\n<p>Here's the relevant section from the spec; <a href=\"https://golang.org/ref/spec#Method_sets\">https://golang.org/ref/spec#Method_sets</a></p>\n"}, {"comments": [{"owner": {"reputation": 5668, "user_id": 2023745, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/cc8256640c8046280c734a84b4be3f1d?s=128&d=identicon&r=PG", "display_name": "TheRealFakeNews", "link": "https://stackoverflow.com/users/2023745/therealfakenews"}, "edited": false, "score": 0, "creation_date": 1614280859, "post_id": 34350336, "comment_id": 117345106, "body": "What if your struct was something like <code>type Logger struct { lgr *zap.Logger }</code>, should the functions that operate on this struct/object (they will call the logger) have receivers that are pointers or by value?"}], "tags": [], "owner": {"reputation": 3561, "user_id": 2381508, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/946bccd20d5d9648c87f4c4b0489d176?s=128&d=identicon&r=PG", "display_name": "Abhishek Nalin", "link": "https://stackoverflow.com/users/2381508/abhishek-nalin"}, "is_accepted": false, "score": 115, "last_activity_date": 1543311084, "last_edit_date": 1543311084, "creation_date": 1450423240, "answer_id": 34350336, "question_id": 34031801, "link": "https://stackoverflow.com/questions/34031801/function-declaration-syntax-things-in-parenthesis-before-function-name/34350336#34350336", "title": "Function declaration syntax: things in parenthesis before function name", "body": "<p>It means <code>ServeHTTP</code> is not a standalone function. The parenthesis before the function name is the Go way of defining the object on which these functions will operate. So, essentially <code>ServeHTTP</code> is a method of type handler and can be invoked using any object, say h, of type handler.</p>\n\n<pre><code>h.ServeHTTP(w, r)\n</code></pre>\n\n<p>They are also called receivers. <a href=\"https://golang.org/doc/faq#methods_on_values_or_pointers\" rel=\"noreferrer\">There</a> are two ways of defining them. If you want to modify the receiver use a pointer like:</p>\n\n<pre><code>func (s *MyStruct) pointerMethod() { } // method on pointer\n</code></pre>\n\n<p>If you dont need to modify the receiver you can define the receiver as a value like:</p>\n\n<pre><code>func (s MyStruct)  valueMethod()   { } // method on value\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/O0O7Nk1SGF\" rel=\"noreferrer\">This</a> example from Go playground demonstrates the concept.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Mutatable struct {\n    a int\n    b int\n}\n\nfunc (m Mutatable) StayTheSame() {\n    m.a = 5\n    m.b = 7\n}\n\nfunc (m *Mutatable) Mutate() {\n    m.a = 5\n    m.b = 7\n}\n\nfunc main() {\n    m := &amp;Mutatable{0, 0}\n    fmt.Println(m)\n    m.StayTheSame()\n    fmt.Println(m)\n    m.Mutate()\n    fmt.Println(m)\n</code></pre>\n\n<p>The output of the above program is :</p>\n\n<pre><code>&amp;{0 0}\n&amp;{0 0}\n&amp;{5 7}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21272, "user_id": 52277, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/67498fd0e17d27cb9be0c107f306e378?s=128&d=identicon&r=PG", "display_name": "Michael Freidgeim", "link": "https://stackoverflow.com/users/52277/michael-freidgeim"}, "is_accepted": false, "score": 1, "last_activity_date": 1615596531, "last_edit_date": 1615596531, "creation_date": 1615586750, "answer_id": 66607825, "question_id": 34031801, "link": "https://stackoverflow.com/questions/34031801/function-declaration-syntax-things-in-parenthesis-before-function-name/66607825#66607825", "title": "Function declaration syntax: things in parenthesis before function name", "body": "<p>If you are familiar with <a href=\"https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/extension-methods\" rel=\"nofollow noreferrer\">c# extension methods</a>,</p>\n<p>a go method (<a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">a function with a special receiver argument</a>) e.g.</p>\n<pre><code>func (v Vertex) Abs() float64\n</code></pre>\n<p>is similar to c# extension method</p>\n<pre><code>static float Abs( this Vertex v);\n</code></pre>\n<p>The differences between value types and pointers are described in <a href=\"https://stackoverflow.com/questions/34031801/function-declaration-syntax-things-in-parenthesis-before-function-name/34031889#34031889\">evanmcdonnal\u2019s answer</a></p>\n"}], "owner": {"reputation": 5237, "user_id": 819720, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/5bfa5cdbed8fbe25e9fb607a3b788aa4?s=128&d=identicon&r=PG", "display_name": "Marcus Vin&#237;cius Monteiro", "link": "https://stackoverflow.com/users/819720/marcus-vin%c3%adcius-monteiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38699, "favorite_count": 49, "accepted_answer_id": 34031889, "answer_count": 3, "score": 325, "last_activity_date": 1615596531, "creation_date": 1449010613, "last_edit_date": 1592644375, "question_id": 34031801, "link": "https://stackoverflow.com/questions/34031801/function-declaration-syntax-things-in-parenthesis-before-function-name", "title": "Function declaration syntax: things in parenthesis before function name", "body": "<p>I'm sorry I couldn't be more specific in the question title, but I was reading some <a href=\"https://golang.org/\" rel=\"noreferrer\">Go</a> code and I encountered function declarations of this form:</p>\n<pre><code>func (h handler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    ...\n}\n</code></pre>\n<p>from <a href=\"https://github.com/mattermost/platform/blob/master/api/context.go\" rel=\"noreferrer\">https://github.com/mattermost/platform/blob/master/api/context.go</a></p>\n<pre><code>func (s *GracefulServer) BlockingClose() bool {\n    ...\n}\n</code></pre>\n<p>from <a href=\"https://github.com/braintree/manners/blob/master/server.go\" rel=\"noreferrer\">https://github.com/braintree/manners/blob/master/server.go</a></p>\n<p>What does the <code>(h handler)</code> and the <code>(s *GracefulServer)</code> between parenthesis mean? What does the entire function declaration mean, taking into account the meaning of the things between parenthesis?</p>\n<h3>Edit</h3>\n<p>This is not a duplicate of <a href=\"https://stackoverflow.com/questions/8263546/whats-the-difference-of-functions-and-methods-in-google-go\">Whats the difference of functions and methods in Go?</a> : this question came to me because I didn't know what the things in parenthesis before the function name were, not because I wondered what was the difference between functions and methods... if I knew that this declaration was a method I wouldn't have had this question in the first place. If someone has the same doubt as me one day, I don't believe she will go searching for &quot;golang methods&quot; because she doesn't know that this is the case. It would be like wondering what the letter &quot;sigma&quot; means before a mathematical expression (not knowing it means summation) and someone says it's a duplicate of what's the difference between summation and some other thing.</p>\n<p>Also, the short answer to this question (&quot;it's a receiver&quot;) is no answer to &quot;what's the difference between functions and methods&quot;.</p>\n"}, {"tags": ["unit-testing", "testing", "go"], "answers": [{"comments": [{"owner": {"reputation": 10110, "user_id": 130024, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2353857b3f577eb4e3840111ca9a7ecb?s=128&d=identicon&r=PG", "display_name": "astropanic", "link": "https://stackoverflow.com/users/130024/astropanic"}, "edited": false, "score": 1, "creation_date": 1449011149, "post_id": 34031759, "comment_id": 55819181, "body": "Thanks for your suggestion with the readwriter. Besides that i disagree. Of course this is a simple constructor which is not even necessary due to it simplicity,  but when I have some more complicated initialisation process I want check it right in the first place and not search later why my acceptance tests are failing. You wrote about a dummy connection, did you mean simply satisfying the net.Conn interface?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 10110, "user_id": 130024, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2353857b3f577eb4e3840111ca9a7ecb?s=128&d=identicon&r=PG", "display_name": "astropanic", "link": "https://stackoverflow.com/users/130024/astropanic"}, "edited": false, "score": 1, "creation_date": 1449034357, "post_id": 34031759, "comment_id": 55826398, "body": "@astropanic: You wrote &quot;but when I have some more complicated initialisation process&quot;: Currently you don&#39;t have it. Why bother now with something which probably never happens? Your constructor just returns a filled struct. Just test that. No need to be obsessive in your tests."}], "tags": [], "owner": {"reputation": 1726, "user_id": 31890, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f715845fda0a53bfc0f2ebb8f749694a?s=128&d=identicon&r=PG", "display_name": "Bjarke Ebert", "link": "https://stackoverflow.com/users/31890/bjarke-ebert"}, "is_accepted": false, "score": 4, "last_activity_date": 1506371261, "last_edit_date": 1506371261, "creation_date": 1449010438, "answer_id": 34031759, "question_id": 34031510, "link": "https://stackoverflow.com/questions/34031510/testing-constructors-in-go/34031759#34031759", "title": "Testing constructors in Go", "body": "<p>Some code is so short and simple that ensuring that the test is correct is more complicated than ensuring that the code itself is correct. \nYour constructor is such code.</p>\n\n<p>What I would do is either not test it at all, or just call it (using some dummy implementation of <code>net.Conn</code>) to ensure that it doesn't blow up in smoke when called (therefore called a smoke test).</p>\n\n<p>Later you can test it as part of a bigger test (integration test), where you have a real server to connect to, and which uses your client struct to talk to it. </p>\n\n<p>If you ever find a bug that is due to this constructor, then first add a test that demonstrates the problem, then fix it. Then you will have your test :-)</p>\n\n<p>A test should check that the constructor \"works as intended\". Checking the value of <code>client.conn</code> is hardly checking any intended behavior, as the value of an unexported field is not behavior. It just checks HOW the struct and constructor is implemented, not WHAT it implements. Test the what, not the how.</p>\n\n<p>By the way, you could maybe embed a *ReadWriter in your client. </p>\n\n<pre><code>client.buf = bufio.NewReadWriter(...)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 10110, "user_id": 130024, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2353857b3f577eb4e3840111ca9a7ecb?s=128&d=identicon&r=PG", "display_name": "astropanic", "link": "https://stackoverflow.com/users/130024/astropanic"}, "edited": false, "score": 0, "creation_date": 1449039018, "post_id": 34033744, "comment_id": 55828204, "body": "is a constructor not a normal function as well ? What are you suggesting instead of my function to initialize the struct ? Suppose I have some code where I need to initialise more of such client structs. I think without this function I will later have more code to rewrite when the functionality will need a change ? I saw this pattern plenty of times in different Golang projects, and read it is a common practice to use New or NewType, maybe I&#39;m wrong (still learning Go), I&#39;m open for suggestions, thx"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 10110, "user_id": 130024, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2353857b3f577eb4e3840111ca9a7ecb?s=128&d=identicon&r=PG", "display_name": "astropanic", "link": "https://stackoverflow.com/users/130024/astropanic"}, "edited": false, "score": 2, "creation_date": 1449043111, "post_id": 34033744, "comment_id": 55830033, "body": "Your question explicitly asks how to test constructors. I just made a point that you should test them as any other functions. Having <code>NewClient</code> function as in the example you provided makes perfect sense."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 10110, "user_id": 130024, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2353857b3f577eb4e3840111ca9a7ecb?s=128&d=identicon&r=PG", "display_name": "astropanic", "link": "https://stackoverflow.com/users/130024/astropanic"}, "edited": false, "score": 0, "creation_date": 1449043631, "post_id": 34033744, "comment_id": 55830263, "body": "To elaborate a bit more: <code>NewClient</code> function is ok. But testing that conn field is initialized by NewClient doesn&#39;t make any sense as it should already be tested indirectly by other tests. Tests do not come for free. You need to write them, keep them up to date, they add to the test suite execution time, etc."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 1, "last_activity_date": 1449022448, "creation_date": 1449022448, "answer_id": 34033744, "question_id": 34031510, "link": "https://stackoverflow.com/questions/34031510/testing-constructors-in-go/34033744#34033744", "title": "Testing constructors in Go", "body": "<p>In addition to what @bjarke-ebert said.</p>\n\n<p>There are no constructors in Go, they are just normal functions. Test them as you would test any other function. If a function is too complex to test then probably there is a way to change the design to make it more testable.</p>\n\n<p>Also from my experience tests that check internal details of implementation too much (like the test from the question) are very hard to maintain as they constantly need to be updated.</p>\n"}], "owner": {"reputation": 10110, "user_id": 130024, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2353857b3f577eb4e3840111ca9a7ecb?s=128&d=identicon&r=PG", "display_name": "astropanic", "link": "https://stackoverflow.com/users/130024/astropanic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1446, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1506371261, "creation_date": 1449009297, "question_id": 34031510, "link": "https://stackoverflow.com/questions/34031510/testing-constructors-in-go", "title": "Testing constructors in Go", "body": "<p>How I can test my <code>NewClient</code> constructor for my <code>Client</code> struct ?</p>\n\n<pre><code>package busybus\n\nimport (\n    \"bufio\"\n    \"net\"\n)\n\ntype Client struct {\n    counter  integer\n    conn     net.Conn\n    bufin    *bufio.Reader\n    bufout   *bufio.Writer\n    messages chan string\n    state    string\n}\n\nfunc NewClient(conn net.Conn, messages chan string) *Client {\n    return &amp;Client{\n        counter:  0,\n        conn:     conn,\n        bufin:    bufio.NewReader(conn),\n        bufout:   bufio.NewWriter(conn),\n        messages: messages,\n        state:    \"waiting\",\n\n    }\n}\n</code></pre>\n\n<p>I tried some testing like this:</p>\n\n<pre><code>package busybus\n\nimport (\n    \"net\"\n    \"testing\"\n)\n\nfunc TestNewClient(t *testing.T) {\n    ln, _ := net.Listen(\"tcp\", \":65535\")\n    conn, _ := ln.Accept()\n    messages := make(chan string)\n\n    client := NewClient(conn, messages)\n    if client.conn != conn {\n        t.Errorf(\"NewClient(%q, %q).conn == %q, want %q\", conn, messages, client.conn, conn)\n    }\n}\n</code></pre>\n\n<p>But this hangs during the test runs due to <code>ln.Accept</code>, it seems a totally wrong approach anyway... any suggestion how I can test this constructor ?</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "edited": false, "score": 0, "creation_date": 1449008065, "post_id": 34031125, "comment_id": 55817919, "body": "Replace it with an interface and compose as needed With an appropriate mock."}, {"owner": {"reputation": 1095, "user_id": 1030873, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81783d79b9967bf327cdafdcc0f4cd46?s=128&d=identicon&r=PG", "display_name": "Sly", "link": "https://stackoverflow.com/users/1030873/sly"}, "edited": false, "score": 0, "creation_date": 1449010212, "post_id": 34031125, "comment_id": 55818818, "body": "Are you trying to mock <code>dao.ToVendorId</code> or your <code>group</code> function? Need to be more specific in your question."}, {"owner": {"reputation": 489, "user_id": 1401162, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/34ccb916234d4117540155fed4e4ce1c?s=128&d=identicon&r=PG&f=1", "display_name": "Vipercold", "link": "https://stackoverflow.com/users/1401162/vipercold"}, "edited": false, "score": 0, "creation_date": 1449025179, "post_id": 34031125, "comment_id": 55823580, "body": "i want to  mock dao.ToVendorId to test group function."}, {"owner": {"reputation": 489, "user_id": 1401162, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/34ccb916234d4117540155fed4e4ce1c?s=128&d=identicon&r=PG&f=1", "display_name": "Vipercold", "link": "https://stackoverflow.com/users/1401162/vipercold"}, "reply_to_user": {"reputation": 1095, "user_id": 1030873, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81783d79b9967bf327cdafdcc0f4cd46?s=128&d=identicon&r=PG", "display_name": "Sly", "link": "https://stackoverflow.com/users/1030873/sly"}, "edited": false, "score": 0, "creation_date": 1449067116, "post_id": 34031125, "comment_id": 55845290, "body": "@Sly How can i pass the dao to group function? i&#39;ts not clear to me. Thanks !!"}], "owner": {"reputation": 489, "user_id": 1401162, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/34ccb916234d4117540155fed4e4ce1c?s=128&d=identicon&r=PG&f=1", "display_name": "Vipercold", "link": "https://stackoverflow.com/users/1401162/vipercold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 0, "closed_date": 1449011534, "answer_count": 0, "score": 0, "last_activity_date": 1449014221, "creation_date": 1449007663, "last_edit_date": 1449014221, "question_id": 34031125, "link": "https://stackoverflow.com/questions/34031125/go-lang-how-to-mock-package-method", "closed_reason": "Duplicate", "title": "Go Lang How to Mock Package Method?", "body": "<p>I have a method that uses an package method dao.ToVendorId, how can i mock it??</p>\n\n<pre><code>func group(context context.Execution, dataStore dataStore) (map[string][]VendorItem, map[string]string, error) {\n\n    for _,info := range dataStore.Items {\n        if itemId, err := dao.ToVendorId(context, info.Seller, info.Id); err != nil {\n            return vendorItems, vendorDataTranslated, err\n        } else {\n      //More Code\n        }\n    }\n    return vendorItems, vendorDataTranslated, nil;\n}\n</code></pre>\n"}, {"tags": ["git", "go"], "comments": [{"owner": {"reputation": 307, "user_id": 1864805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0393fcefefad7c5a1ce9434a2897a79?s=128&d=identicon&r=PG", "display_name": "Konoha", "link": "https://stackoverflow.com/users/1864805/konoha"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1449004706, "post_id": 34030318, "comment_id": 55816049, "body": "$ git config --get remote.origin.url &gt; <code>code</code> https://&lt;url of git project&gt;"}, {"owner": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "edited": false, "score": 2, "creation_date": 1449004844, "post_id": 34030318, "comment_id": 55816129, "body": "Is this program executed in the directory with a git repo?"}, {"owner": {"reputation": 307, "user_id": 1864805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0393fcefefad7c5a1ce9434a2897a79?s=128&d=identicon&r=PG", "display_name": "Konoha", "link": "https://stackoverflow.com/users/1864805/konoha"}, "reply_to_user": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "edited": false, "score": 0, "creation_date": 1449004893, "post_id": 34030318, "comment_id": 55816161, "body": "@Lander : Yes it is..."}, {"owner": {"reputation": 307, "user_id": 1864805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0393fcefefad7c5a1ce9434a2897a79?s=128&d=identicon&r=PG", "display_name": "Konoha", "link": "https://stackoverflow.com/users/1864805/konoha"}, "edited": false, "score": 0, "creation_date": 1449004994, "post_id": 34030318, "comment_id": 55816218, "body": "ok I resolved the issue. I explicitly set the command dir to the git project using cmd.Dir"}, {"owner": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "edited": false, "score": 0, "creation_date": 1449005012, "post_id": 34030318, "comment_id": 55816226, "body": "Are you sure? I just ran it (with this code on my Mac: <a href=\"http://play.golang.org/p/3w-AzDe5z3\" rel=\"nofollow noreferrer\">play.golang.org/p/3w-AzDe5z3</a>) and it worked fine. edit: glad to see you got it resolved"}, {"owner": {"reputation": 307, "user_id": 1864805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0393fcefefad7c5a1ce9434a2897a79?s=128&d=identicon&r=PG", "display_name": "Konoha", "link": "https://stackoverflow.com/users/1864805/konoha"}, "reply_to_user": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "edited": false, "score": 0, "creation_date": 1449005042, "post_id": 34030318, "comment_id": 55816238, "body": "@Lander : Thanks...Your answer pointed me to the right direction."}, {"owner": {"reputation": 315, "user_id": 1973667, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4d030ef56c4c27ea71e8ea57aa4577b8?s=128&d=identicon&r=PG", "display_name": "DMurta", "link": "https://stackoverflow.com/users/1973667/dmurta"}, "edited": false, "score": 0, "creation_date": 1493757480, "post_id": 34030318, "comment_id": 74536689, "body": "@Konoha maybe you can answer your own question since you solved it? :)"}], "owner": {"reputation": 307, "user_id": 1864805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0393fcefefad7c5a1ce9434a2897a79?s=128&d=identicon&r=PG", "display_name": "Konoha", "link": "https://stackoverflow.com/users/1864805/konoha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 555, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1449004563, "creation_date": 1449004563, "question_id": 34030318, "link": "https://stackoverflow.com/questions/34030318/cant-get-go-exec-command-to-execute-git-config-command-properly", "title": "Can&#39;t get go exec command to execute git config command properly", "body": "<p>I have am trying to execute a git command from a golang program to get the url of git's remote. Below is the code. It keeps throwing an \"exit status 1\" error.</p>\n\n<pre><code>func main() {\n    var out bytes.Buffer\n    var stderr bytes.Buffer\n    cmd := exec.Command(`C:\\3rdPartySoftware\\Git\\bin\\git.exe`,[]string{\"config\",\"--get\", \"remote.origin.url\"}...)\n    cmd.Stdout = &amp;out\n    cmd.Stderr = &amp;stderr\n    err := cmd.Run()\n    if err != nil {\n      fmt.Println(fmt.Sprint(err) + \": \" + stderr.String())\n      os.Exit(1)\n    }\n    fmt.Printf(\"%s\\n\", out)\n}\n</code></pre>\n\n<p>OUTPUT:-</p>\n\n<p>exit status 1: </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 2, "creation_date": 1449002369, "post_id": 34029609, "comment_id": 55814705, "body": "Try <code>q := math.Sqrt(math.Abs(b2-ac))</code>"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 1, "creation_date": 1449023130, "post_id": 34029609, "comment_id": 55822975, "body": "not every quadratic equation has a solution in real numbers"}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 5, "last_activity_date": 1449002200, "creation_date": 1449002200, "answer_id": 34029636, "question_id": 34029609, "link": "https://stackoverflow.com/questions/34029609/why-do-floats-and-ints-nan-in-go/34029636#34029636", "title": "Why do floats and ints = Nan? in go", "body": "<p>Because you're trying to take the square root of a negative number which isn't a valid operation (not just in Go, in math) and so it returns NaN which is an acronym for Not A Number.</p>\n\n<pre><code>b := 3\na := 4\nc := 2\nb2 := float64(b*b) // sets b2 == 9\nac := float64(4)*float64(a)*float64(c) // ac == 32 \nq := math.Sqrt(b2-ac) // Sqrt(9-32) == Sqrt(-23) == NaN\nfmt.Print(q)\nq = math.Sqrt(math.Abs(b2-ac)) // suggested in comments does Sqrt(23) == ~4.79 \n// perhaps the outcome you're looking for.\n</code></pre>\n\n<p>EDIT: please don't argue semantics on the math bit. If you want to discuss square roots of negative numbers this isn't the place. Generally speaking, it is not possible to take the square root of a negative number.</p>\n"}, {"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 2, "last_activity_date": 1449003032, "creation_date": 1449003032, "answer_id": 34029880, "question_id": 34029609, "link": "https://stackoverflow.com/questions/34029609/why-do-floats-and-ints-nan-in-go/34029880#34029880", "title": "Why do floats and ints = Nan? in go", "body": "<p>Since you're taking the square root of a negative number, you've got an imaginary result (<code>sqrt(-9) == 3i</code>). This is assuredly NOT what you're trying to do. Instead, do:</p>\n\n<pre><code>func main() {\n    b := float64(3)\n    a := float64(4)\n    c := float64(2)\n\n    result := [2]float64{(-b + math.Sqrt(math.Abs(b*b - 4*a*c))) / 2 * a,\n                         (-b - math.Sqrt(math.Abs(b*b - 4*a*c))) / 2 * a)}\n    fmt.Println(result)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1449006719, "post_id": 34030310, "comment_id": 55817191, "body": "and how is this different from other 2 answers?"}], "tags": [], "owner": {"reputation": 182, "user_id": 5622186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69af54f6a46bce1f6c539f86841ed8ef?s=128&d=identicon&r=PG", "display_name": "Kiramishima", "link": "https://stackoverflow.com/users/5622186/kiramishima"}, "is_accepted": false, "score": 1, "last_activity_date": 1449004518, "creation_date": 1449004518, "answer_id": 34030310, "question_id": 34029609, "link": "https://stackoverflow.com/questions/34029609/why-do-floats-and-ints-nan-in-go/34030310#34030310", "title": "Why do floats and ints = Nan? in go", "body": "<p>You try Sqrt Negative Number for this reason return always NaN ( Not a Number )\nI run you code and print the results:</p>\n\n<pre><code>b := 3\n    a := 4\n    c := 2\n    b2 := float64(b*b)\n    fmt.Printf(\"%.2f \\n\", b2)\n    ac := float64(4)*float64(a)*float64(c)\n    fmt.Printf(\"%.2f \\n\", ac)\n    fmt.Printf(\"%.2f \\n\", b2-ac)\n    q := math.Sqrt(b2-ac)\n    fmt.Print(q)\n</code></pre>\n\n<p>Console:\n9.00\n32.00\n-23.00\nNaN</p>\n\n<p>Sqrt in Golang : <a href=\"https://golang.org/pkg/math/#Sqrt\" rel=\"nofollow\">https://golang.org/pkg/math/#Sqrt</a></p>\n"}], "owner": {"reputation": 193, "user_id": 5574609, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-Z8DszpZmPOA/AAAAAAAAAAI/AAAAAAAAABI/qRBWSg0ue2E/photo.jpg?sz=128", "display_name": "liam", "link": "https://stackoverflow.com/users/5574609/liam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1581, "favorite_count": 0, "answer_count": 3, "score": -3, "last_activity_date": 1449004518, "creation_date": 1449002102, "last_edit_date": 1449002782, "question_id": 34029609, "link": "https://stackoverflow.com/questions/34029609/why-do-floats-and-ints-nan-in-go", "title": "Why do floats and ints = Nan? in go", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc main() {\n    // x= +- sqrtB-4ac/2a\n    cal()\n}\n\nfunc cal() {\n    b := 3\n    a := 4\n    c := 2\n    b2 := float64(b*b)\n    ac := float64(4)*float64(a)*float64(c)\n    q := math.Sqrt(b2-ac)\n    fmt.Print(q)\n}\n</code></pre>\n\n<p>This will output a NaN, but why. I am trying to make a quadratic calculator. All I want is for this to output the number.</p>\n"}, {"tags": ["cookies", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 9, "last_activity_date": 1448996179, "last_edit_date": 1448996179, "creation_date": 1448988027, "answer_id": 34025435, "question_id": 34025115, "link": "https://stackoverflow.com/questions/34025115/could-not-expire-a-cookie/34025435#34025435", "title": "Could not expire a cookie", "body": "<p>Browsers store cookies for multiple paths. Set the path attribute on the cookie header to match the path attribute used to create the cookie.</p>\n\n<p>Set maximum age to a negative value to clear the cookie. The maximum age attribute is not set on the header if equal to zero.</p>\n\n<p>Some browsers do not understand the maximum age attribute.  Set expiration to a time in the past for the benefit of those browsers.</p>\n\n<pre><code>expiredCookie := &amp;http.Cookie{Path: \"/\", Name: COOKIE_ID, MaxAge: -1, Expires: time.Now().Add(-100 * time.Hour)}\n</code></pre>\n"}], "owner": {"reputation": 3087, "user_id": 856142, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bfb729f6ac07e17c2326a7335a3f3be?s=128&d=identicon&r=PG", "display_name": "yageek", "link": "https://stackoverflow.com/users/856142/yageek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3192, "favorite_count": 1, "accepted_answer_id": 34025435, "answer_count": 1, "score": 4, "last_activity_date": 1575196194, "creation_date": 1448987127, "last_edit_date": 1575196194, "question_id": 34025115, "link": "https://stackoverflow.com/questions/34025115/could-not-expire-a-cookie", "title": "Could not expire a cookie", "body": "<p>I'm playing with the Go App Engine SDK and I'm trying to set/expires Cookies.</p>\n\n<p>There is no problem by setting a Cookie, but it is impossible to make it expiring in the browser.</p>\n\n<p>The app is a based on a <code>negroni</code> instance: </p>\n\n<pre><code>func init() {\n\n    app := negroni.New()\n    app.UseHandler(Router())\n    http.Handle(\"/\", app)\n\n}\n</code></pre>\n\n<p>The router is a <code>mux</code> instance:</p>\n\n<pre><code>func Router() *mux.Router {\n\n    r := mux.NewRouter()\n    subRouter := r.PathPrefix(PATH_PREFIX).Subrouter()\n\n    subRouter.HandleFunc(\"/sign\", LoginHandler)\n    subRouter.HandleFunc(\"/userinfo\", UserInfo)\n    subRouter.HandleFunc(\"/logout\", Logout)\n\n    return r\n}\n</code></pre>\n\n<p>The login handler is basic:</p>\n\n<pre><code>func LoginHandler(w http.ResponseWriter, r *http.Request) {\n\n    ctx := appengine.NewContext(r)\n\n    u := user.Current(ctx)\n\n    if u == nil {\n\n        url, err := user.LoginURL(ctx, r.URL.String())\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n        }\n        w.Header().Set(\"Location\", url)\n        w.WriteHeader(http.StatusFound)\n        return\n    }\n\n    //COOKIE_ID = \"SomeString\"\n    cookie := &amp;http.Cookie{Name: COOKIE_ID, Value: u.ID, Path: \"/\", MaxAge: 0}\n    http.SetCookie(w, cookie)\n\n    w.Header().Set(\"Location\", \"/\")\n    w.WriteHeader(http.StatusFound)\n}\n</code></pre>\n\n<p>To expires the cookie:</p>\n\n<pre><code>func Logout(w http.ResponseWriter, r *http.Request) {\n\n    ctx := appengine.NewContext(r)\n    url, err := user.LogoutURL(ctx, \"/\")\n\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    expiredCookie := &amp;http.Cookie{Name: COOKIE_ID, MaxAge: -10, Expires: time.Now()}\n    http.SetCookie(w, expiredCookie)\n\n    w.Header().Set(\"Location\", url)\n    w.WriteHeader(http.StatusFound)\n}\n</code></pre>\n\n<p>I tried everything:</p>\n\n<ul>\n<li>Getting the old cookie, change MaxAge and Expires</li>\n<li>Create a new cookie with the same Name to overwrite</li>\n</ul>\n\n<p>Full code: <a href=\"https://gist.github.com/yageek/78e43c83b56467fc8338\" rel=\"nofollow noreferrer\">https://gist.github.com/yageek/78e43c83b56467fc8338</a></p>\n\n<p>In any case, the cookie still remains in the navigator. What do I do wrong ?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1448987225, "post_id": 34024992, "comment_id": 55805749, "body": "Related: <a href=\"http://stackoverflow.com/questions/18088294/how-to-not-marshal-an-empty-struct-into-json-with-go\" title=\"how to not marshal an empty struct into json with go\">stackoverflow.com/questions/18088294/&hellip;</a>"}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1448991484, "post_id": 34024992, "comment_id": 55808524, "body": "It cannot omit an byte array: It&#39;s a value type and there always present with it&#39;s default value."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 4464126, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/100002213717083/picture?type=large", "display_name": "Takahiro Ikeuchi", "link": "https://stackoverflow.com/users/4464126/takahiro-ikeuchi"}, "edited": false, "score": 0, "creation_date": 1448987765, "post_id": 34025084, "comment_id": 55806079, "body": "Lovely answer. Thanks for creating Playground."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 1, "last_activity_date": 1448987056, "creation_date": 1448987056, "answer_id": 34025084, "question_id": 34024992, "link": "https://stackoverflow.com/questions/34024992/go-lang-json-marshall-ignores-omitempty-in-bytearray-fields/34025084#34025084", "title": "Go lang json.Marshall() ignores omitempty in ByteArray Fields", "body": "<p>You'll have to either make <code>ByteArray</code> a slice, or a pointer to array:</p>\n\n<pre><code>type A struct {\n    ByteArray *[4]byte `json:\",omitempty\"`\n    Byte1     byte     `json:\",omitempty\"`\n    Byte2     byte\n    Name      string `json:\",omitempty\"`\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/nYBqGrSA1L\" rel=\"nofollow\">https://play.golang.org/p/nYBqGrSA1L</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 4, "last_activity_date": 1448987514, "last_edit_date": 1448987514, "creation_date": 1448987104, "answer_id": 34025101, "question_id": 34024992, "link": "https://stackoverflow.com/questions/34024992/go-lang-json-marshall-ignores-omitempty-in-bytearray-fields/34025101#34025101", "title": "Go lang json.Marshall() ignores omitempty in ByteArray Fields", "body": "<p>A few options:</p>\n\n<ol>\n<li><p>Make <code>A</code> an instance of a type with its own <code>MarshalJSON</code> method and implement the behavior you want there (e.g. not including <code>ByteArray</code> if all of its values are zero).</p></li>\n<li><p>Change the type of <code>ByteArray</code>. <code>[]byte</code> would work since it defaults to an empty slice, and <code>*[4]byte</code> would work since it defaults to <code>nil</code>. Including a pointer is a common way of dealing with a field that's only sometimes present in serialization. Of course this does require a little more space, a little more indirection, and a little more GC work.</p></li>\n</ol>\n"}], "owner": {"reputation": 81, "user_id": 4464126, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/100002213717083/picture?type=large", "display_name": "Takahiro Ikeuchi", "link": "https://stackoverflow.com/users/4464126/takahiro-ikeuchi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1824, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1448987514, "creation_date": 1448986787, "question_id": 34024992, "link": "https://stackoverflow.com/questions/34024992/go-lang-json-marshall-ignores-omitempty-in-bytearray-fields", "title": "Go lang json.Marshall() ignores omitempty in ByteArray Fields", "body": "<p>Please see below.</p>\n\n<p><a href=\"https://play.golang.org/p/HXrqLqYIgz\" rel=\"nofollow\">https://play.golang.org/p/HXrqLqYIgz</a></p>\n\n<p>My expected value is:</p>\n\n<pre><code>{\"Byte2\":0,\"Name\":\"bob\"}\n</code></pre>\n\n<p>But Actual:</p>\n\n<pre><code>{\"ByteArray\":[0,0,0,0],\"Byte2\":0,\"Name\":\"bob\"}\n</code></pre>\n\n<p>According to the document (<a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow\">https://golang.org/pkg/encoding/json/</a>)</p>\n\n<blockquote>\n  <p>The empty values are false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero.</p>\n</blockquote>\n\n<p>Therefore, json.Marshall() ignores omitempty-tag, because [0 0 0 0] is not zero-length nor 0 nor nil.</p>\n\n<p>And now, to get the expected value, What should we do?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 5550102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2fc1f4dc755850a9c6e424163d7baf?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.AgiTheMan", "link": "https://stackoverflow.com/users/5550102/mr-agitheman"}, "edited": false, "score": 0, "creation_date": 1448984315, "post_id": 34023776, "comment_id": 55803491, "body": "Thanks man, this was usefull. Who would say that something like this would take me so much time."}, {"owner": {"reputation": 1601, "user_id": 561534, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/9db33e6f80ff4b04de6d8d043d2aaca9?s=128&d=identicon&r=PG", "display_name": "Joel Skrepnek", "link": "https://stackoverflow.com/users/561534/joel-skrepnek"}, "reply_to_user": {"reputation": 3, "user_id": 5550102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2fc1f4dc755850a9c6e424163d7baf?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.AgiTheMan", "link": "https://stackoverflow.com/users/5550102/mr-agitheman"}, "edited": false, "score": 0, "creation_date": 1448991218, "post_id": 34023776, "comment_id": 55808356, "body": "No problem.  I&#39;ve found that the error messages in Go are actually very accurate and useful, unlike other languages.  In your case, it was pretty spot on."}], "tags": [], "owner": {"reputation": 1601, "user_id": 561534, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/9db33e6f80ff4b04de6d8d043d2aaca9?s=128&d=identicon&r=PG", "display_name": "Joel Skrepnek", "link": "https://stackoverflow.com/users/561534/joel-skrepnek"}, "is_accepted": true, "score": 2, "last_activity_date": 1448983547, "last_edit_date": 1448983547, "creation_date": 1448983127, "answer_id": 34023776, "question_id": 34022839, "link": "https://stackoverflow.com/questions/34022839/unmarshal-json-to-a-array-from-post-request/34023776#34023776", "title": "Unmarshal json to a array from post request", "body": "<p>Two things:</p>\n\n<ol>\n<li>You are unmarshalling a slice of Data rather than a slice of 'unit'.</li>\n<li>Make the 'unit' field public so that it is visible by reflection to the Decoder</li>\n</ol>\n\n<p>See: <a href=\"https://play.golang.org/p/4kfIQTXqYi\" rel=\"nofollow\">https://play.golang.org/p/4kfIQTXqYi</a></p>\n\n<pre><code>type Data struct {\n    Unit string `json:\"unit\"`\n}\n\nfunc receive(w http.ResponseWriter, r *http.Request) {\n    dec := json.NewDecoder(r.Body)\n    for {\n        var d []Data\n        if err := dec.Decode(&amp;d); err == io.EOF {\n            break\n        } else if err != nil {\n            log.Println(err)\n        }\n        log.Printf(\"%s\\n\", d.Unit)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 5550102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a2fc1f4dc755850a9c6e424163d7baf?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.AgiTheMan", "link": "https://stackoverflow.com/users/5550102/mr-agitheman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 1, "accepted_answer_id": 34023776, "answer_count": 1, "score": 0, "last_activity_date": 1448983547, "creation_date": 1448980235, "question_id": 34022839, "link": "https://stackoverflow.com/questions/34022839/unmarshal-json-to-a-array-from-post-request", "title": "Unmarshal json to a array from post request", "body": "<p>see below my </p>\n\n<p>main.go</p>\n\n<pre><code>type Data struct {\n        unit []string `json:\"unit\"`\n     }\n func receive(w http.ResponseWriter, r *http.Request) {\n\n  dec := json.NewDecoder(r.Body)\n  for {\n    var d Data\n    if err := dec.Decode(&amp;d); err == io.EOF {\n        break\n    } else if err != nil {\n        log.Println(err)\n    }\n    log.Printf(\"%s\\n\", d.unit)\n  }\n}\n</code></pre>\n\n<p>Error that is throwed: \"json: cannot unmarshal array into GO value of type main.Data\"</p>\n\n<p>moj.js</p>\n\n<pre><code> $(function(){\n $('#start').on('click', function(){\n var i;\n var j = 0;\n\n for (i = 0; i &lt; result.length; i++){\n\n if(result[i] == null){  \n  }else if(result[i]==\"\"){\n  }else{\n  lookup[j] = result[i];\n  j++\n  }\n }\n $.ajax({\n        type: 'POST',\n        url: '/start',\n        data: '[{\"unit\":\"'+lookup+'\"}]',\n        dataType: \"json\",\n        contentType: \"application/json\",\n        success: function () {\n           alert(\"Data posted.\")\n        },\n        error: function(){\n          alert('Error posting data.')\n        }\n    });\n  });\n});\n</code></pre>\n\n<p>The \"json\" that I send looks like: [{\"unit\":\"something\"}]. </p>\n\n<p>In the console I can see the data has been posted like this.</p>\n"}, {"tags": ["string", "go", "benchmarking", "slice"], "comments": [{"owner": {"reputation": 31371, "user_id": 281108, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/b160d50a7ecfe6018348629cb8677538?s=128&d=identicon&r=PG", "display_name": "Ismail Badawi", "link": "https://stackoverflow.com/users/281108/ismail-badawi"}, "edited": false, "score": 1, "creation_date": 1448974540, "post_id": 34020904, "comment_id": 55796711, "body": "What are the values of <code>STR</code>, <code>STR_B</code>, <code>PREFIX</code>, <code>PREFIX_B</code>?"}, {"owner": {"reputation": 1508, "user_id": 1473140, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4e5523fa2c0d564764f3144815f8943d?s=128&d=identicon&r=PG", "display_name": "Sergey Kamardin", "link": "https://stackoverflow.com/users/1473140/sergey-kamardin"}, "reply_to_user": {"reputation": 31371, "user_id": 281108, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/b160d50a7ecfe6018348629cb8677538?s=128&d=identicon&r=PG", "display_name": "Ismail Badawi", "link": "https://stackoverflow.com/users/281108/ismail-badawi"}, "edited": false, "score": 0, "creation_date": 1448974671, "post_id": 34020904, "comment_id": 55796786, "body": "@IsmailBadawi updated example )"}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1448975645, "post_id": 34020904, "comment_id": 55797432, "body": "note that on my Core2Duo P8600 both benchmarks are performing the same (~20 ns/op), while on i5-2400S they are similar to yours \u2013 5.5 vs 8.5 ns/op"}], "answers": [{"comments": [{"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1448976133, "post_id": 34021256, "comment_id": 55797784, "body": "That not enough of an explanation: If you insert an extra non-inlining function call it&#39;s still slower. Sadly i don&#39;t understand what the Equal function in assembly actually does. Can anybody explain?"}, {"owner": {"reputation": 1508, "user_id": 1473140, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4e5523fa2c0d564764f3144815f8943d?s=128&d=identicon&r=PG", "display_name": "Sergey Kamardin", "link": "https://stackoverflow.com/users/1473140/sergey-kamardin"}, "reply_to_user": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 1, "creation_date": 1448977143, "post_id": 34021256, "comment_id": 55798439, "body": "@0x434D53 +1, for example, in asm_amd64.s (Line 1312 (runtime&#183;eqstring) and line 1652 (bytes&#183;Equal)) \u2013 what the difference in that code?"}, {"owner": {"reputation": 1508, "user_id": 1473140, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4e5523fa2c0d564764f3144815f8943d?s=128&d=identicon&r=PG", "display_name": "Sergey Kamardin", "link": "https://stackoverflow.com/users/1473140/sergey-kamardin"}, "edited": false, "score": 0, "creation_date": 1448977178, "post_id": 34021256, "comment_id": 55798467, "body": "@icza thanks, but could you explaing more explicit? =)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 1, "creation_date": 1448978264, "post_id": 34021256, "comment_id": 55799145, "body": "@0x434D53 Made further investigation, see edited answer."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 3, "creation_date": 1448978803, "post_id": 34021256, "comment_id": 55799508, "body": "Passing <code>-gcflags -m</code> to <code>go run</code> will tell you what gets inlined \u2013 and it&#39;s only <code>strings.HasPrefix</code>, but not <code>bytes.HasPrefix</code>. If you disable inlining (<code>-gcflags -l</code>) you&#39;ll get comparable results (bytes ~10% slower). However, if you disable optimisation all together (<code>-gcflags -N</code>) benchmarks will be in favour of comparing bytes. At least on my i5. Saying this, the difference seems to be in compilation magic."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1448980527, "post_id": 34021256, "comment_id": 55800703, "body": "Thanks, incorporated that into the answer."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1448986600, "post_id": 34021256, "comment_id": 55805260, "body": "One additional question: I never looked to much into the compiler. The assembly code for string equal and byteslice equals differs mainly in that the byteslice compares the length first. A comment in the source says that the compile ensures the strings passed to eqstring have equal length. Any idea where that happens?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 1, "creation_date": 1448988330, "post_id": 34021256, "comment_id": 55806508, "body": "@0x434D53 I haven&#39;t looked into it either, but my guess would be that comparing string constants, it&#39;s dealt with at compile time, and comparing non-constant strings, the length comparison is inlined. More details are in <a href=\"http://stackoverflow.com/questions/20232976/how-does-go-do-string-comparison\">this question</a>."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1448988531, "post_id": 34021256, "comment_id": 55806642, "body": "Thanks! Looks like the compiler does some optimizations there."}, {"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "reply_to_user": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1449005227, "post_id": 34021256, "comment_id": 55816345, "body": "I always forget about those flags @tomasz. Thanks for the reminder! :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 16, "last_activity_date": 1448992291, "last_edit_date": 1448992291, "creation_date": 1448975421, "answer_id": 34021256, "question_id": 34020904, "link": "https://stackoverflow.com/questions/34020904/why-strings-hasprefix-is-faster-than-bytes-hasprefix/34021256#34021256", "title": "Why strings.HasPrefix is faster than bytes.HasPrefix?", "body": "<p>The main reason is the difference in calling cost of <a href=\"https://golang.org/pkg/bytes/#HasPrefix\" rel=\"noreferrer\"><code>bytes.HasPrefix()</code></a> and <a href=\"https://golang.org/pkg/strings/#HasPrefix\" rel=\"noreferrer\"><code>strings.HasPrefix()</code></a>. As @tomasz pointed out in his comment, <code>strings.HashPrefix()</code> is inlined by default while <code>bytes.HasPrefix()</code> is not.</p>\n\n<p>Further reason is the different parameter types: <code>bytes.HasPrefix()</code> takes 2 slices (2 slice descriptors). <code>strings.HasPrefix()</code> takes 2 strings (2 string headers). Slice descriptors contain a pointer and 2 <code>int</code>s: length and capacity, see <a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"noreferrer\"><code>reflect.SliceHeader</code></a>. String headers contain only a pointer and an <code>int</code>: the length, see <a href=\"https://golang.org/pkg/reflect/#StringHeader\" rel=\"noreferrer\"><code>reflect.StringHeader</code></a>.</p>\n\n<p>We can prove this if we manually inline the <code>HasPrefix()</code> functions in the benchmark functions, so we eliminate the calling costs (zero both). By inlining them, no function call will be made (to them).</p>\n\n<p><code>HasPrefix()</code> implementations:</p>\n\n<pre><code>// HasPrefix tests whether the byte slice s begins with prefix.\nfunc HasPrefix(s, prefix []byte) bool {\n    return len(s) &gt;= len(prefix) &amp;&amp; Equal(s[0:len(prefix)], prefix)\n}\n\n// HasPrefix tests whether the string s begins with prefix.\nfunc HasPrefix(s, prefix string) bool {\n    return len(s) &gt;= len(prefix) &amp;&amp; s[0:len(prefix)] == prefix\n}\n</code></pre>\n\n<p>Benchmark functions after inlining them:</p>\n\n<pre><code>func BenchmarkStrHasPrefix(b *testing.B) {\n    s, prefix := STR, PREFIX\n    for i := 0; i &lt; b.N; i++ {\n        _ = len(s) &gt;= len(prefix) &amp;&amp; s[0:len(prefix)] == prefix\n    }\n}\n\nfunc BenchmarkBytHasPrefix(b *testing.B) {\n    s, prefix := STR_B, PREFIX_B\n    for i := 0; i &lt; b.N; i++ {\n        _ = len(s) &gt;= len(prefix) &amp;&amp; bytes.Equal(s[0:len(prefix)], prefix)\n    }\n}\n</code></pre>\n\n<p>Running these you get very close results:</p>\n\n<pre><code>BenchmarkStrHasPrefix-2 300000000                5.88 ns/op\nBenchmarkBytHasPrefix-2 200000000                6.17 ns/op\n</code></pre>\n\n<p>The reason for the small difference in the inlined benchmarks may be that both functions test the presence of the prefix by slicing the <code>string</code> and <code>[]byte</code> operand. And since <code>string</code>s are comparable while byte slices are not, <code>BenchmarkBytHasPrefix()</code> requires an additional function call to <a href=\"https://golang.org/pkg/bytes/#Equal\" rel=\"noreferrer\"><code>bytes.Equal()</code></a> compared to <code>BenchmarkStrHasPrefix()</code> (and the extra function call also includes making copies of its parameters: 2 slice headers).</p>\n\n<p>Other things that may slightly contribute to the original different results: arguments used in <code>BenchmarkStrHasPrefix()</code> are constants, while parameters used in <code>BenchmarkBytHasPrefix()</code> are variables.</p>\n\n<p>You shouldn't worry much about the performance difference, both functions complete in just a few nanoseconds.</p>\n\n<p>Note that the \"implementation\" of <a href=\"https://golang.org/pkg/bytes/#Equal\" rel=\"noreferrer\"><code>bytes.Equal()</code></a>:</p>\n\n<pre><code>func Equal(a, b []byte) bool // ../runtime/asm_$GOARCH.s\n</code></pre>\n\n<p>This may be inlined in some platforms resulting in no additional call costs.</p>\n"}], "owner": {"reputation": 1508, "user_id": 1473140, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4e5523fa2c0d564764f3144815f8943d?s=128&d=identicon&r=PG", "display_name": "Sergey Kamardin", "link": "https://stackoverflow.com/users/1473140/sergey-kamardin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 993, "favorite_count": 1, "accepted_answer_id": 34021256, "answer_count": 1, "score": 10, "last_activity_date": 1448992291, "creation_date": 1448974280, "last_edit_date": 1448982235, "question_id": 34020904, "link": "https://stackoverflow.com/questions/34020904/why-strings-hasprefix-is-faster-than-bytes-hasprefix", "title": "Why strings.HasPrefix is faster than bytes.HasPrefix?", "body": "<p>In my code, I have such benchmark:</p>\n\n<pre><code>const STR = \"abcd\"\nconst PREFIX = \"ab\"\nvar STR_B = []byte(STR)\nvar PREFIX_B = []byte(PREFIX)\n\nfunc BenchmarkStrHasPrefix(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        strings.HasPrefix(STR, PREFIX)\n    }\n}\n\nfunc BenchmarkBytHasPrefix(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        bytes.HasPrefix(STR_B, PREFIX_B)\n    }\n}\n</code></pre>\n\n<p>And I am little bit confused about results:</p>\n\n<pre><code>BenchmarkStrHasPrefix-4    300000000    4.67 ns/op\nBenchmarkBytHasPrefix-4    200000000    8.05 ns/op\n</code></pre>\n\n<p>Why there is up to 2x difference?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["data-structures", "go", "set"], "comments": [{"owner": {"reputation": 11178, "user_id": 11142, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/bea5dab764a7a4945d874b9fecfc1802?s=128&d=identicon&r=PG", "display_name": "anjanb", "link": "https://stackoverflow.com/users/11142/anjanb"}, "edited": false, "score": 20, "creation_date": 1449032540, "post_id": 34018908, "comment_id": 55825814, "body": "hmmm. wondering why the negative votes ? I&#39;m coming from the java world where we had a set almost right from the beginning, even without generics. So, I find this behavior a lil bizarre"}], "answers": [{"comments": [{"owner": {"reputation": 1726, "user_id": 31890, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f715845fda0a53bfc0f2ebb8f749694a?s=128&d=identicon&r=PG", "display_name": "Bjarke Ebert", "link": "https://stackoverflow.com/users/31890/bjarke-ebert"}, "edited": false, "score": 1, "creation_date": 1449011440, "post_id": 34019043, "comment_id": 55819308, "body": "Also, it seems to be in Go&#39;s spirit to just write it out in your own code, either by &quot;inlining&quot; the set in other code, or define your own set type when needed. Anyway, using for example an std::set&lt;T&gt; in C++ is always happening as part of a function implementation or implementing some other data structure. Therefore, just implement that other data structure directly using maps and slices and whatever other building blocks you need, but without any builtin set. Each usage of a set is going to use it slightly differently anyway :)"}, {"owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "reply_to_user": {"reputation": 1726, "user_id": 31890, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f715845fda0a53bfc0f2ebb8f749694a?s=128&d=identicon&r=PG", "display_name": "Bjarke Ebert", "link": "https://stackoverflow.com/users/31890/bjarke-ebert"}, "edited": false, "score": 0, "creation_date": 1449052682, "post_id": 34019043, "comment_id": 55835754, "body": "Well, if Go had generics, I would probably implement and contribute a generic set implementation (built on top of maps, at least initially). But Go doesn&#39;t have generics, the code needed is pretty small and side-tracking through reflection is probably going to take enough of a speed hit that it&#39;s not worth it. But there&#39;s a world of difference writing a robust general library and just writing what you need, for now."}, {"owner": {"reputation": 1726, "user_id": 31890, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f715845fda0a53bfc0f2ebb8f749694a?s=128&d=identicon&r=PG", "display_name": "Bjarke Ebert", "link": "https://stackoverflow.com/users/31890/bjarke-ebert"}, "edited": false, "score": 1, "creation_date": 1449090055, "post_id": 34019043, "comment_id": 55860019, "body": "But usually you don&#39;t really need a set&lt;Foo&gt; by itself, you use a set&lt;Foo&gt; as part of implementing something bigger.  I&#39;ve seen tons of code where the things you need to do in order to include a &quot;reusable&quot; component is much worse than just avoiding the need. So here we have a set&lt;Foo&gt;, that function over there needs a set&lt;Bar&gt;, oops, do we have covariance yet, or how about making a WrapperFactory to make this thing look like this thing, etc.  Maybe that other function really just needs an interface that can check for membership, so don&#39;t send it a set&lt;Foo&gt;."}, {"owner": {"reputation": 3031, "user_id": 1315900, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/81ac598abb24d160c87a6f9a72e250d2?s=128&d=identicon&r=PG", "display_name": "Fermin Silva", "link": "https://stackoverflow.com/users/1315900/fermin-silva"}, "edited": false, "score": 51, "creation_date": 1464279957, "post_id": 34019043, "comment_id": 62431316, "body": "So if it doesn&#39;t have generics, how is the &#39;generic&#39; map implemented at all?"}, {"owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "reply_to_user": {"reputation": 3031, "user_id": 1315900, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/81ac598abb24d160c87a6f9a72e250d2?s=128&d=identicon&r=PG", "display_name": "Fermin Silva", "link": "https://stackoverflow.com/users/1315900/fermin-silva"}, "edited": false, "score": 1, "creation_date": 1465231390, "post_id": 34019043, "comment_id": 62803801, "body": "@FerminSilva It&#39;s done by the compiler, using methods not directly accessible to developers."}, {"owner": {"reputation": 313, "user_id": 3567989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ce071dd3264c7d9f5d9c0b7137faa6b?s=128&d=identicon&r=PG", "display_name": "emersion", "link": "https://stackoverflow.com/users/3567989/emersion"}, "edited": false, "score": 31, "creation_date": 1495616434, "post_id": 34019043, "comment_id": 75324137, "body": "Note that if you want to save bytes, you can use <code>map[T]struct{}</code> instead of <code>map[T]bool</code>."}, {"owner": {"reputation": 6142, "user_id": 2548010, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/49fb97002d1a160f5818111732643b57?s=128&d=identicon&r=PG", "display_name": "Big Money", "link": "https://stackoverflow.com/users/2548010/big-money"}, "reply_to_user": {"reputation": 313, "user_id": 3567989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ce071dd3264c7d9f5d9c0b7137faa6b?s=128&d=identicon&r=PG", "display_name": "emersion", "link": "https://stackoverflow.com/users/3567989/emersion"}, "edited": false, "score": 0, "creation_date": 1516223698, "post_id": 34019043, "comment_id": 83605946, "body": "@emersion if using that type, what would a map literal look like? I can&#39;t figure it out"}, {"owner": {"reputation": 313, "user_id": 3567989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ce071dd3264c7d9f5d9c0b7137faa6b?s=128&d=identicon&r=PG", "display_name": "emersion", "link": "https://stackoverflow.com/users/3567989/emersion"}, "edited": false, "score": 4, "creation_date": 1516312210, "post_id": 34019043, "comment_id": 83647573, "body": "Have a look at <a href=\"https://emersion.fr/blog/2017/sets-in-go/\" rel=\"nofollow noreferrer\">emersion.fr/blog/2017/sets-in-go</a>"}], "tags": [], "owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "is_accepted": false, "score": 95, "last_activity_date": 1448968556, "creation_date": 1448968556, "answer_id": 34019043, "question_id": 34018908, "link": "https://stackoverflow.com/questions/34018908/golang-why-dont-we-have-a-set-datastructure/34019043#34019043", "title": "golang why don&#39;t we have a set datastructure", "body": "<p>Partly, because Go doesn't have generics (so you would need one set-type for every type, or fall back on reflection, which is rather inefficient).</p>\n\n<p>Partly, because if all you need is \"add/remove individual elements to a set\" and \"relatively space-efficient\", you can get a fair bit of that simply by using a <code>map[yourtype]bool</code> (and set the value to <code>true</code> for any element in the set) or, for more space efficiency, you can use an empty struct as the value and use <code>_, present = the_setoid[key]</code> to check for presence.</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 12, "creation_date": 1448973863, "post_id": 34020023, "comment_id": 55796307, "body": "Check for existence is simply indexing the map. Since if it&#39;s not in it, the zero value (which is <code>false</code>) will properly tell that. No need the comma-ok idiom for testing."}, {"owner": {"reputation": 3420, "user_id": 424632, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ec99692fd9664c4f4558a6d0d020a058?s=128&d=identicon&r=PG", "display_name": "musiphil", "link": "https://stackoverflow.com/users/424632/musiphil"}, "edited": false, "score": 2, "creation_date": 1471886125, "post_id": 34020023, "comment_id": 65518249, "body": "The implementation for intersection looks like that for difference."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 1909, "user_id": 4876196, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4368b76bec0fddbb8e507521ee69c7da?s=128&d=identicon&r=PG", "display_name": "Kittsil", "link": "https://stackoverflow.com/users/4876196/kittsil"}, "edited": false, "score": 1, "creation_date": 1487725138, "post_id": 34020023, "comment_id": 71910766, "body": "@Kittsil thank you. Updated."}, {"owner": {"reputation": 465, "user_id": 1600231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ePGpS.jpg?s=128&g=1", "display_name": "BG Adrian", "link": "https://stackoverflow.com/users/1600231/bg-adrian"}, "edited": false, "score": 43, "creation_date": 1531772402, "post_id": 34020023, "comment_id": 89711306, "body": "It is more optimal to use <code>map[int]struct{}</code> instead of <code>bool</code>, because an empty struct occupies 0 bytes in the memory. I&#39;ve recently written a gist for this <a href=\"https://gist.github.com/bgadrian/cb8b9344d9c66571ef331a14eb7a2e80\" rel=\"nofollow noreferrer\">gist.github.com/bgadrian/cb8b9344d9c66571ef331a14eb7a2e80</a>"}, {"owner": {"reputation": 2313, "user_id": 707372, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f8bd30bbbd029804a5dfe8aa210dba15?s=128&d=identicon&r=PG", "display_name": "Stef", "link": "https://stackoverflow.com/users/707372/stef"}, "edited": false, "score": 27, "creation_date": 1552458169, "post_id": 34020023, "comment_id": 97011706, "body": "That&#39;s not quite so easy. Just having to write that code everywhere you need to use a Set seems ridiculous to me these days. Collections support should be provided by any language. Think a better answer is that Go is not yet as mature. I&#39;m sure there will be libraries to cover that soon enough."}, {"owner": {"reputation": 4227, "user_id": 437506, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/1f81d6e639fd42098d15302f098f0531?s=128&d=identicon&r=PG&f=1", "display_name": "Kedar Mhaswade", "link": "https://stackoverflow.com/users/437506/kedar-mhaswade"}, "edited": false, "score": 0, "creation_date": 1557469976, "post_id": 34020023, "comment_id": 98782670, "body": "How do you serialize such a map as a set?"}, {"owner": {"reputation": 374, "user_id": 2660759, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6sayy.jpg?s=128&g=1", "display_name": "Lucas Montenegro Carvalhaes", "link": "https://stackoverflow.com/users/2660759/lucas-montenegro-carvalhaes"}, "edited": false, "score": 1, "creation_date": 1606843824, "post_id": 34020023, "comment_id": 115082830, "body": "Not easy nor intuitive. This is not a set, it is just a code pattern that behaves like a set. It is not a set since it doesn&#39;t store the data not provides operations as a set does. The correct answer is that GO doesn&#39;t have this functionality. Having a way to do something doesn&#39;t mean it is a reason not to have it."}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 86, "last_activity_date": 1618559110, "last_edit_date": 1618559110, "creation_date": 1448971421, "answer_id": 34020023, "question_id": 34018908, "link": "https://stackoverflow.com/questions/34018908/golang-why-dont-we-have-a-set-datastructure/34020023#34020023", "title": "golang why don&#39;t we have a set datastructure", "body": "<p>One reason is that it is easy to create a set from map:</p>\n<pre><code>s := map[int]bool{5: true, 2: true}\n_, ok := s[6] // check for existence\ns[8] = true // add element \ndelete(s, 2) // remove element\n</code></pre>\n<p>Union</p>\n<pre><code>s_union := map[int]bool{}\nfor k, _ := range s1{\n    s_union[k] = true\n}\nfor k, _ := range s2{\n    s_union[k] = true\n}\n</code></pre>\n<p>Intersection</p>\n<pre><code>s_intersection := map[int]bool{}\nif len(s1) &gt; len(s2) {\n  s1, s2 = s2, s1 // better to iterate over a shorter set\n}\nfor k,_ := range s1 { \n  if s2[k] {\n    s_intersection[k] = true\n  }\n}\n</code></pre>\n<p>It is not really that hard to implement all other set operations.</p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1448985813, "post_id": 34021180, "comment_id": 55804671, "body": "To handle buit-in sets, Pascal overloads a bunch of binary (two-argmnent) operators: <code>+</code> for union, <code>-</code> for difference, <code>*</code> for intersection, <code>&lt;=</code> for subset, <code>&gt;=</code> for superset, <code>=</code> for equality, <code>&lt;&gt;</code> for inequality and <code>in</code> for membership. So in Go, it would be only a single new keyword -- <code>in</code>. On the other hand, Pascal&#39;s built-in sets only work on &quot;ordinals&quot;--that is, any type which has an underlying representation of an integer value of some size."}, {"owner": {"reputation": 9289, "user_id": 2572431, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2ad85f81981e5365a21d94114f3926b2?s=128&d=identicon&r=PG", "display_name": "augurar", "link": "https://stackoverflow.com/users/2572431/augurar"}, "edited": false, "score": 14, "creation_date": 1449041397, "post_id": 34021180, "comment_id": 55829262, "body": "The fact that there are multiple ways to implement a set hasn&#39;t stopped many other languages from providing them."}, {"owner": {"reputation": 3420, "user_id": 424632, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ec99692fd9664c4f4558a6d0d020a058?s=128&d=identicon&r=PG", "display_name": "musiphil", "link": "https://stackoverflow.com/users/424632/musiphil"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1471885922, "post_id": 34021180, "comment_id": 65518146, "body": "@kostix: Go could even use the syntax <code>s[key]</code> (as if <code>s</code> were a <code>map[T]bool</code>) instead of <code>key in s</code>."}, {"owner": {"reputation": 115, "user_id": 330920, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PSlM2.jpg?s=128&g=1", "display_name": "Jo&#227;o Andrade", "link": "https://stackoverflow.com/users/330920/jo%c3%a3o-andrade"}, "edited": false, "score": 2, "creation_date": 1566225756, "post_id": 34021180, "comment_id": 101579880, "body": "Any reason for not simply returning <code>n % 2 == 0</code>?"}, {"owner": {"reputation": 631, "user_id": 2692704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d719c39fe3b8aa28294a1dc9527b4e25?s=128&d=identicon&r=PG", "display_name": "foobarna", "link": "https://stackoverflow.com/users/2692704/foobarna"}, "edited": false, "score": 1, "creation_date": 1604404202, "post_id": 34021180, "comment_id": 114331812, "body": "I know this is 5 years old, but <code>pollute the language with keywords set, union, intersection, difference, subset</code>, really? Beside <code>set</code> the rest are operations on sets, so they are functions."}], "tags": [], "owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "is_accepted": false, "score": 5, "last_activity_date": 1520338122, "last_edit_date": 1520338122, "creation_date": 1448975138, "answer_id": 34021180, "question_id": 34018908, "link": "https://stackoverflow.com/questions/34018908/golang-why-dont-we-have-a-set-datastructure/34021180#34021180", "title": "golang why don&#39;t we have a set datastructure", "body": "<p>Like Vatine wrote: Since go lacks generics it would have to be part of the language and not the standard library. For that you would then have to pollute the language with keywords set, union, intersection, difference, subset...</p>\n\n<p>The other reason is, that it's not clear at all what the \"right\" implementation of a set is:</p>\n\n<ol>\n<li><p>There is a functional approach:</p>\n\n<pre><code>func IsInEvenNumbers(n int) bool {\n    if n % 2 == 0 {\n        return true\n    }\n   return false\n}\n</code></pre></li>\n</ol>\n\n<p>This is a set of all even ints. It has a very efficient lookup and union, intersect, difference and subset can easily be done by functional composition.</p>\n\n<ol start=\"2\">\n<li>Or you do a has-like approach like Dali showed.</li>\n</ol>\n\n<p>A map does not have that problem, since you store something associated with the value.</p>\n"}, {"comments": [{"owner": {"reputation": 1218, "user_id": 3754075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b70790f2d886a2568bf35f10a3af9b1?s=128&d=identicon&r=PG", "display_name": "Will Fitzgerald", "link": "https://stackoverflow.com/users/3754075/will-fitzgerald"}, "edited": false, "score": 1, "creation_date": 1449002794, "post_id": 34029799, "comment_id": 55814964, "body": "I should note that I wrote the original version of the bitset package referenced above."}], "tags": [], "owner": {"reputation": 1218, "user_id": 3754075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b70790f2d886a2568bf35f10a3af9b1?s=128&d=identicon&r=PG", "display_name": "Will Fitzgerald", "link": "https://stackoverflow.com/users/3754075/will-fitzgerald"}, "is_accepted": false, "score": 3, "last_activity_date": 1449002762, "creation_date": 1449002762, "answer_id": 34029799, "question_id": 34018908, "link": "https://stackoverflow.com/questions/34018908/golang-why-dont-we-have-a-set-datastructure/34029799#34029799", "title": "golang why don&#39;t we have a set datastructure", "body": "<p>Another possibility is to use bit sets, for which there is at least one <a href=\"https://godoc.org/github.com/willf/bitset\" rel=\"nofollow\">package</a> or you can use the built-in <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow\">big</a> package. In this case, basically you need to define a way to convert your object to an index.</p>\n"}], "owner": {"reputation": 11178, "user_id": 11142, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/bea5dab764a7a4945d874b9fecfc1802?s=128&d=identicon&r=PG", "display_name": "anjanb", "link": "https://stackoverflow.com/users/11142/anjanb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107430, "favorite_count": 26, "closed_date": 1449729241, "answer_count": 4, "score": 169, "last_activity_date": 1618559110, "creation_date": 1448968169, "question_id": 34018908, "link": "https://stackoverflow.com/questions/34018908/golang-why-dont-we-have-a-set-datastructure", "closed_reason": "Opinion-based", "title": "golang why don&#39;t we have a set datastructure", "body": "<p>I'm trying to solve \"The go programming lanaguage\" exercise #1.4 which requires me to have a set. I can create a set type but why doesn't the language come with one ? go, having come from google, where guava also originated, why didn't the language designers opt for adding support for fundamental data structures ? why force your users to create their own implementations for something so basic as a set ?</p>\n"}, {"tags": ["http", "go", "http-status-code-404"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1448964629, "post_id": 34017342, "comment_id": 55790702, "body": "It doesn&#39;t log its error messages: FileServer wraps ServeContent, which is internalized here: <a href=\"https://golang.org/src/net/http/fs.go#L360\" rel=\"nofollow noreferrer\">golang.org/src/net/http/fs.go#L360</a> - you would need to re-write or inspect the ResponseWriter on its way out to log it."}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1448964841, "post_id": 34017342, "comment_id": 55790851, "body": "Possible Duplicate to this  <a href=\"http://stackoverflow.com/questions/9996767/showing-custom-404-error-page-with-standard-http-package\" title=\"showing custom 404 error page with standard http package\">stackoverflow.com/questions/9996767/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 7, "creation_date": 1449144575, "post_id": 34018537, "comment_id": 55884281, "body": "Gosh, wish it was less painful !"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 10, "last_activity_date": 1448970661, "last_edit_date": 1448970661, "creation_date": 1448967001, "answer_id": 34018537, "question_id": 34017342, "link": "https://stackoverflow.com/questions/34017342/log-404-on-http-fileserver/34018537#34018537", "title": "Log 404 on http.FileServer", "body": "<p>The <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"noreferrer\"><code>http.Handler</code></a>s returned by <a href=\"https://golang.org/pkg/net/http/#StripPrefix\" rel=\"noreferrer\"><code>http.StripPrefix()</code></a> and <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"noreferrer\"><code>http.FileServer()</code></a> do not log HTTP 404 errors. You have to extend their functionality in order to achieve what you want.</p>\n\n<p>We can wrap the <code>http.Handler</code> value returned by <code>http.StripPrefix()</code> or <code>http.FileServer()</code> in another <code>http.Handler</code> or <a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"noreferrer\"><code>http.HandlerFunc</code></a>. Once you wrapped the handler, register the wrapper of course.</p>\n\n<p>The wrapper implementation will simply called the wrapped one, and once it returns, can inspect the HTTP response status code. If it is an error (or specifically HTTP 404 Not Found), can log it appropriately.</p>\n\n<p>Problem is <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"noreferrer\"><code>http.ResponseWriter</code></a> does not support reading the response status code. What we can do is we also wrap the <code>http.ResponseWriter</code> and when status code is written, we will store it for later to be available.</p>\n\n<p>Our <code>http.ResponseWriter</code> wrapper:</p>\n\n<pre><code>type StatusRespWr struct {\n    http.ResponseWriter // We embed http.ResponseWriter\n    status int\n}\n\nfunc (w *StatusRespWr) WriteHeader(status int) {\n    w.status = status // Store the status for our own use\n    w.ResponseWriter.WriteHeader(status)\n}\n</code></pre>\n\n<p>And wrapping the <code>http.Handler</code>:</p>\n\n<pre><code>func wrapHandler(h http.Handler) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        srw := &amp;StatusRespWr{ResponseWriter: w}\n        h.ServeHTTP(srw, r)\n        if srw.status &gt;= 400 { // 400+ codes are the error codes\n            log.Printf(\"Error status code: %d when serving path: %s\",\n                srw.status, r.RequestURI)\n        }\n    }\n}\n</code></pre>\n\n<p>And the main function creating a file server, wrapping it and registering it:</p>\n\n<pre><code>http.HandleFunc(\"/o/\", wrapHandler(\n    http.StripPrefix(\"/o\", http.FileServer(http.Dir(\"/test\")))))\npanic(http.ListenAndServe(\":8181\", nil))\n</code></pre>\n\n<p>Example output when requesting a non-existing file:</p>\n\n<pre><code>2015/12/01 11:47:40 Error status code: 404 when serving path: /o/sub/b.txt2\n</code></pre>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1482, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1448982403, "creation_date": 1448963452, "last_edit_date": 1448982403, "question_id": 34017342, "link": "https://stackoverflow.com/questions/34017342/log-404-on-http-fileserver", "title": "Log 404 on http.FileServer", "body": "<p>I'm serving jpeg images from <code>dirPath</code> using <code>http.FileServer</code> with:</p>\n\n<pre><code>http.Handle(\"/o/\", http.StripPrefix(\n    path.Join(\"/o\", dirPath), http.FileServer(http.Dir(dirPath))))\n</code></pre>\n\n<p>What I don't understand is how to log when a request is made for a file that does not exist. I can see <code>http.FileServer</code> returning <strong>404 page not found</strong> when I make a request with the browser, but not on the server console.</p>\n"}, {"tags": ["json", "go", "struct", "unmarshalling"], "comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 2, "creation_date": 1448956327, "post_id": 34015049, "comment_id": 55785735, "body": "Duplicated by <a href=\"http://stackoverflow.com/questions/33557401/unmarshal-nested-xml-with-go/33560897#33560897\" title=\"unmarshal nested xml with go\">stackoverflow.com/questions/33557401/&hellip;</a> You should <b>export</b>  your fields. Look at first part of the answer"}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1448957160, "post_id": 34015049, "comment_id": 55786167, "body": "<a href=\"http://play.golang.org/p/Zwj3iMWdOw\" rel=\"nofollow noreferrer\">play.golang.org/p/Zwj3iMWdOw</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5584, "user_id": 1835788, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/id0u7.jpg?s=128&g=1", "display_name": "Sankalp Mishra", "link": "https://stackoverflow.com/users/1835788/sankalp-mishra"}, "edited": false, "score": 1, "creation_date": 1448959981, "post_id": 34015356, "comment_id": 55787778, "body": "Thanks for the answer. It works perfectly..Awesome explanation too."}, {"owner": {"reputation": 5584, "user_id": 1835788, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/id0u7.jpg?s=128&g=1", "display_name": "Sankalp Mishra", "link": "https://stackoverflow.com/users/1835788/sankalp-mishra"}, "edited": false, "score": 0, "creation_date": 1448962508, "post_id": 34015356, "comment_id": 55789402, "body": "The internal keys of child struct are not populayted"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5584, "user_id": 1835788, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/id0u7.jpg?s=128&g=1", "display_name": "Sankalp Mishra", "link": "https://stackoverflow.com/users/1835788/sankalp-mishra"}, "edited": false, "score": 0, "creation_date": 1448962561, "post_id": 34015356, "comment_id": 55789444, "body": "@SankalpMishra There was a typo in the code, which I already fixed. Please copy the current version of the code and it will work."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1475605455, "last_edit_date": 1475605455, "creation_date": 1448956847, "answer_id": 34015356, "question_id": 34015049, "link": "https://stackoverflow.com/questions/34015049/how-to-parse-nested-json-into-structs-in-go/34015356#34015356", "title": "How to parse nested JSON into structs in Go?", "body": "<p>You have quite some errors in your example (both in JSON text and source code). Let's fix them.</p>\n\n<h3>JSON text</h3>\n\n<p>First your JSON is not valid. Try this instead of yours:</p>\n\n<pre><code>{\n    \"key1\": \"val1\",\n    \"key2\": \"val2\",\n    \"childStruct1\" : {\n        \"key3\": \"val3\",\n        \"key4\": \"val4\"\n    },\n    \"childStruct2\" : {\n        \"key5\": \"val5\",\n        \"key6\": \"val6\"\n    }\n}\n</code></pre>\n\n<h3>Go type definitions</h3>\n\n<p>Second, your Go source defining your struct types has syntax errors.</p>\n\n<p>Third, you have to export struct fields in order so the <code>json</code> package can set their values. Try this instead of yours:</p>\n\n<pre><code>type ChildStruct1 struct {\n    Key3 string\n    Key4 string\n}\n\ntype ChildStruct2 struct {\n    Key4 string\n    Key5 string\n}\n\ntype MainStruct struct {\n    Key1         string\n    Key2         string\n    ChildStruct1 ChildStruct1\n    ChildStruct2 ChildStruct2\n}\n</code></pre>\n\n<h3>Code to parse the JSON text</h3>\n\n<p>And now on to the code to parse the JSON text. You can read the whole file into memory using <a href=\"https://golang.org/pkg/io/ioutil/#ReadFile\" rel=\"nofollow\"><code>ioutil.ReadFile()</code></a>, but often it is more efficient to not read the whole file but to \"stream\" it to a decoder (using the file as the input).</p>\n\n<p><a href=\"https://golang.org/pkg/os/#Open\" rel=\"nofollow\"><code>os.Open()</code></a> returns a <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow\"><code>*File</code></a>. It is not a <code>[]byte</code>, but it implements <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow\"><code>io.Reader</code></a>. So you can't pass it to <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow\"><code>json.Unmarshal()</code></a>. Instead create a <a href=\"https://golang.org/pkg/encoding/json/#Decoder\" rel=\"nofollow\"><code>json.Decoder</code></a> using <a href=\"https://golang.org/pkg/encoding/json/#NewDecoder\" rel=\"nofollow\"><code>json.NewDecoder()</code></a> which accepts an <code>io.Reader</code>, so you can pass the opened file. And don't forget to close the opened file using <a href=\"https://golang.org/pkg/os/#File.Close\" rel=\"nofollow\"><code>File.Close()</code></a>, best to close it as a deferred statement (if opening it succeeds).</p>\n\n<pre><code>f, err := os.Open(\"jsonData.json\")\nif err != nil {\n    log.Panic(err)\n}\ndefer f.Close()\n\nvar data MainStruct\nerr = json.NewDecoder(f).Decode(&amp;data)\nif err != nil {\n    log.Panic(err)\n}\nfmt.Println(data.Key1)\nfmt.Printf(\"%+v\", data)\n</code></pre>\n\n<p>(Note that I used <a href=\"https://golang.org/pkg/log/#Panic\" rel=\"nofollow\"><code>log.Panic()</code></a> instead of <a href=\"https://golang.org/pkg/log/#Fatal\" rel=\"nofollow\"><code>log.Fatal()</code></a> as the latter calls <a href=\"https://golang.org/pkg/os/#Exit\" rel=\"nofollow\"><code>os.Exit()</code></a> and hence our deferred function would not be called.)</p>\n\n<p>Output:</p>\n\n<pre><code>val1\n{Key1:val1 Key2:val2 ChildStruct1:{Key3:val3 Key4:val4} ChildStruct2:{Key4: Key5:val5}}\n</code></pre>\n\n<h3>Modified version for the Go Playground</h3>\n\n<p>Here is a modified version that parses the JSON text from a constant defined in the source code, try it on the <a href=\"http://play.golang.org/p/SLUWd3p7oQ\" rel=\"nofollow\">Go Playground</a>:</p>\n\n<pre><code>var data MainStruct\nerr := json.Unmarshal([]byte(input), &amp;data)\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Println(data.Key1)\nfmt.Printf(\"%+v\", data)\n</code></pre>\n\n<h3>Final notes</h3>\n\n<p>Keys in the JSON text start with lowercase letters, struct field names in Go start with uppercase letters (needed in order to be exported), but the <code>json</code> package is \"clever\" enough to match them. Should you use something different, you could use <a href=\"https://golang.org/ref/spec#Tag\" rel=\"nofollow\">tags</a> to specify how a struct field can be found in the json, e.g.</p>\n\n<pre><code>type ChildStruct1 struct {\n    Key3 string `json:\"myKey3\"`\n    Key4 string `json:\"myKey4\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 5584, "user_id": 1835788, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/id0u7.jpg?s=128&g=1", "display_name": "Sankalp Mishra", "link": "https://stackoverflow.com/users/1835788/sankalp-mishra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 34015356, "answer_count": 1, "score": 0, "last_activity_date": 1475605472, "creation_date": 1448955700, "last_edit_date": 1475605472, "question_id": 34015049, "link": "https://stackoverflow.com/questions/34015049/how-to-parse-nested-json-into-structs-in-go", "title": "How to parse nested JSON into structs in Go?", "body": "<p>How can I map a nested JSON to a nested Struct like this:</p>\n\n<pre><code>type ChildStruct1 struct {\n    key3,\n    key4,string\n}\ntype ChildStruct2 struct {\n    key4,\n    key5,string\n}\n\ntype MainStruct struct {\n    key1,\n    key2,string\n    childStruct1 ChildStruct1\n    childStruct2 ChildStruct1\n}\n</code></pre>\n\n<p>Input JSON:</p>\n\n<pre><code>{\n  key1: val1,\n  key2: val2,\n  chilDStruct1 : {\n                     key3: val3,\n                     key4: val4,\n                }\n  chilDStruct2 : {\n                     key5: val5,\n                     key6: val6,\n                }\n}\n</code></pre>\n\n<p>How can this be mapped. I have used jsonMapper in Java but not sure how to do it here. I tried this but this is not working:</p>\n\n<pre><code>var data MainStruct\n    file, err := ioutil.ReadFile(\"jsonData.json\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = json.Unmarshal(file, &amp;data)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(data.key1)\n</code></pre>\n\n<p>I tried this also:</p>\n\n<pre><code>u := &amp;MainStruct{}\nfile, err := ioutil.ReadFile(\"jsonData.json\")\nif err != nil {\n    log.Fatal(err)\n}\nerr = json.Unmarshal([]byte(file), u)\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Println(u.key1)\n</code></pre>\n\n<p>But output is always <code>0</code>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 2, "creation_date": 1448935849, "post_id": 34011131, "comment_id": 55778702, "body": "I haven&#39;t looked through all your code but at least the following seems wrong: <code>defer p.Mu.Unlock()</code> in <code>Run</code> will run when <code>Run</code> function returns (I doubt this is what you want), you start 5 go routines but they run sequentially (because of mutex), one goroutine will be enough and will make your code simpler. I would suggest you to think how to implement the required functionality using less goroutines and channels, the code is very hard to follow as it is."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1448935947, "post_id": 34011131, "comment_id": 55778729, "body": "@kostya I have 5 goroutines at the moment for my own debugging because I don&#39;t have access to 5 computers to simulate 5 people entering a queue so I just add the same person 5 times at the moment, when its done there will be the one goroutine"}], "answers": [{"comments": [{"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1448941828, "post_id": 34012239, "comment_id": 55780235, "body": "Thanks for the great detailed response, if you could suggest a better way to do this, using channels, and not a mutex that would be great, this is only a small part of my party system so I need to keep the channels"}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "reply_to_user": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1449038838, "post_id": 34012239, "comment_id": 55828121, "body": "It depends on what you are trying to do.  With the design you currently have, having a single goroutine dedicated to allocating players to parties might be enough.  If it doesn&#39;t scale, you could try partitioning the players before allocating them to parties.  With your existing code, you could try doing that based on the <code>Type</code>, or by dividing the ranks."}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": true, "score": 5, "last_activity_date": 1448941616, "creation_date": 1448941616, "answer_id": 34012239, "question_id": 34011131, "link": "https://stackoverflow.com/questions/34011131/golang-how-can-i-guarantee-data-finishes-in-a-goroutine-while-being-accessed-by/34012239#34012239", "title": "Golang how can I guarantee data finishes in a goroutine while being accessed by another goroutine", "body": "<p>So with this implementation, none of your five goroutines are going to be be able to run in parallel because they are all trying to acquite the <code>p.Mu</code> mutex.  And looking at the way you're using the <code>p.AddPartialParty</code> channel, I wouldn't be surprised if the code can deadlock.</p>\n\n<p>Consider the following sequence of events:</p>\n\n<ol>\n<li>One of the <code>SortMemberIntoParty</code> goroutines starts running and acquires the mutex.</li>\n<li>It sends a value on <code>p.AddPartialParty</code>, which is received by <code>Run</code>.  <code>Run</code> then tries to acquire the mutex, so blocks.</li>\n<li>The original <code>SortMemberIntoParty</code> goroutine completes and releases the mutex.</li>\n<li>A different <code>SortMemberIntoParty</code> goroutine acquires the mutex, and tries to send another value to <code>p.AddPartialParty</code>.</li>\n<li>The goroutine blocks because there is no one ready to read the value (<code>Run</code> is still waiting on the mutex before it gets back to the <code>select</code> statement).</li>\n</ol>\n\n<p>So now you've got a blocked goroutine holding a lock needed by the receiving end of the channel.  Also note that at (4) you won't see the new <code>PartialParty</code> because <code>Run</code> hasn't managed to add it yet.</p>\n\n<p>If you do need the mutex, then it might be easier to just have your <code>SortMemberIntoParty</code> goroutine update <code>p.PartialPartys</code> directly rather than using the channel: you already know that no one else will be accessing the variable concurrently.</p>\n\n<p>It's also worth remembering that this mutex essentially means that all <code>SortMemberIntoParty</code> goroutines will be serialised.  If you were using goroutines in the hope of achieving parallelism here, the mutex defeats that.</p>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 34012239, "answer_count": 1, "score": 0, "last_activity_date": 1448941616, "creation_date": 1448933614, "last_edit_date": 1448933925, "question_id": 34011131, "link": "https://stackoverflow.com/questions/34011131/golang-how-can-i-guarantee-data-finishes-in-a-goroutine-while-being-accessed-by", "title": "Golang how can I guarantee data finishes in a goroutine while being accessed by another goroutine", "body": "<p>Hi guys I am trying to make a party system using websockets where people can enter a queue and then get matched with 5 people similar to them. Right now I'm having trouble with this part:</p>\n\n<pre><code>type PartyHub struct {\n    Partys             map[string]*Party\n    PartialPartys      []*PartialParty\n    Queue              []*Member\n    AddParty           chan *Party\n    RemoveParty        chan *Party\n    AddPartialParty    chan *PartialParty\n    RemovePartialParty chan *PartialParty\n    EnterQueue         chan *Member\n    LeaveQueue         chan *Member\n    Mu                 sync.Mutex\n}\n// Run will begin monitoring the channels\n// to register and unregister partys as they are\n// created or destroyed\nfunc (p *PartyHub) Run() {\n    for {\n        select {\n        case member := &lt;-p.EnterQueue:\n            go p.SortMemberIntoParty(member)\n            go p.SortMemberIntoParty(member)\n            go p.SortMemberIntoParty(member)\n            go p.SortMemberIntoParty(member)\n            go p.SortMemberIntoParty(member)\n\n            log.Println(p.PartialPartys)\n        case party := &lt;-p.AddPartialParty:\n            p.Mu.Lock()\n            defer p.Mu.Unlock()\n            p.PartialPartys = append(p.PartialPartys, party)\n        }\n    }\n}\n\n// SortMemberIntoParty will take a new user entering the queue and find an appropriate Party\n// for the member to join, taking into account RankTollerance, Rank\nfunc (p *PartyHub) SortMemberIntoParty(member *Member) {\n    p.Mu.Lock()\n    defer p.Mu.Unlock()\n    if len(p.PartialPartys) == 0 {\n        log.Println(\"Here\")\n        newParty := &amp;PartialParty{Accepting: true, Members: []*Member{member}}\n        p.AddPartialParty &lt;- newParty\n        return\n    }\n\n    foundPartyForMember := false\n    for _, party := range p.PartialPartys {\n        goodFitForParty := true\n        for _, partyMember := range party.Members {\n            log.Println(member.Type == partyMember.Type, member.Rank &gt;= partyMember.Rank-partyMember.RankTol, member.Rank &lt;= partyMember.Rank+partyMember.RankTol)\n            if member.Type == partyMember.Type &amp;&amp; member.Rank &gt;= partyMember.Rank-partyMember.RankTol &amp;&amp; member.Rank &lt;= partyMember.Rank+partyMember.RankTol {\n\n                goodFitForParty = true\n                continue\n            } else {\n                goodFitForParty = false\n                break\n            }\n        }\n\n        if !goodFitForParty {\n            continue\n        } else {\n            foundPartyForMember = true\n            party.Mu.Lock()\n            defer party.Mu.Unlock()\n            party.Members = append(party.Members, member)\n            if len(party.Members) == 5 {\n                party.Accepting = false\n                go party.SendReadyCheck()\n            }\n            break\n        }\n    }\n\n\n    if !foundPartyForMember {\n        newParty := &amp;PartialParty{Accepting: true, Members: []*Member{member}}\n        p.AddPartialParty &lt;- newParty\n    }\n\n    log.Println(\"Sorting Members\")\n}\n</code></pre>\n\n<p>The only problem is, the 5 <code>goroutines</code> seem to finish quicker than the data knows what happened.</p>\n\n<p>For example: <code>p.PartialPartys</code> says it has no parties.</p>\n\n<p>What I need is to have <code>p.PartialPartys</code> always up to date for every <code>goroutine</code> that accesses that field of the <code>PartyHub</code> struct I though the <code>sync.Mutex</code> would do this for me but it doesn't seem to be the case, can anybody tell me the best way to keep all my goroutines in sync with the same data?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7931, "user_id": 441099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d18ac367611aeb431cef6e156525d5a?s=128&d=identicon&r=PG", "display_name": "Guy Sirton", "link": "https://stackoverflow.com/users/441099/guy-sirton"}, "edited": false, "score": 2, "creation_date": 1448930652, "post_id": 34010650, "comment_id": 55777285, "body": "Not sure what substrings have to do with the question but your problem is that you are using integers (<code>Atoi</code>).  The result of an integer division is an integer (in many languages, not just Go).  Use floating point arithmetic and once you have your floating point answer you can think about formatting it...  Try <code>strconv.ParseFloat(xInp.Text(), 64)</code> instead of <code>Atoi</code> for starters.  Unrelated you probably just want a single scanner and use <code>ReadLine</code> or something."}], "answers": [{"comments": [{"owner": {"reputation": 193, "user_id": 5574609, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-Z8DszpZmPOA/AAAAAAAAAAI/AAAAAAAAABI/qRBWSg0ue2E/photo.jpg?sz=128", "display_name": "liam", "link": "https://stackoverflow.com/users/5574609/liam"}, "edited": false, "score": 0, "creation_date": 1448931412, "post_id": 34010782, "comment_id": 55777495, "body": "This was very helpfull, But I am new to go. So can you explain to me what float64 means, and what %.2f\\n means. (I understand what \\n means)"}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 193, "user_id": 5574609, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-Z8DszpZmPOA/AAAAAAAAAAI/AAAAAAAAABI/qRBWSg0ue2E/photo.jpg?sz=128", "display_name": "liam", "link": "https://stackoverflow.com/users/5574609/liam"}, "edited": false, "score": 0, "creation_date": 1448932166, "post_id": 34010782, "comment_id": 55777706, "body": "@liam I wrote that in the comment. float64 converts your integer to float value. <code>&quot;%.2f&quot; </code> formats your string: read it here <a href=\"https://gobyexample.com/string-formatting\" rel=\"nofollow noreferrer\">gobyexample.com/string-formatting</a>"}, {"owner": {"reputation": 193, "user_id": 5574609, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-Z8DszpZmPOA/AAAAAAAAAAI/AAAAAAAAABI/qRBWSg0ue2E/photo.jpg?sz=128", "display_name": "liam", "link": "https://stackoverflow.com/users/5574609/liam"}, "edited": false, "score": 0, "creation_date": 1448936773, "post_id": 34010782, "comment_id": 55778940, "body": "I understand that it converts it to a float. But what is a float. Go is my first programming language that I really am getting into. What does f stand for. I understand that it dictates formatting. But what does each indevidual part do? Please answer as if you were speaking to a programming noob. Because thats what I am."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 193, "user_id": 5574609, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-Z8DszpZmPOA/AAAAAAAAAAI/AAAAAAAAABI/qRBWSg0ue2E/photo.jpg?sz=128", "display_name": "liam", "link": "https://stackoverflow.com/users/5574609/liam"}, "edited": false, "score": 2, "creation_date": 1448937177, "post_id": 34010782, "comment_id": 55779039, "body": "float means rational numbers (with 2.3, 5.001). If this is your first programming language, I recommend you to start reading documentation and very basic tutorials: <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">tour.golang.org/welcome/1</a> <a href=\"https://gobyexample.com/\" rel=\"nofollow noreferrer\">gobyexample.com</a>. Otherwise you will suffer."}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 1, "last_activity_date": 1448932173, "last_edit_date": 1448932173, "creation_date": 1448931187, "answer_id": 34010782, "question_id": 34010650, "link": "https://stackoverflow.com/questions/34010650/substrings-and-rounding-in-go/34010782#34010782", "title": "Substrings and rounding in go", "body": "<p>As far as I understood you want just two divide two numbers and output the result (it has nothing to do substrings).</p>\n\n<p>The problem that you divide integer by integer and therefore gets back an integer. The main changes that I have done in your program are:</p>\n\n<pre><code>var slope = float64(q)/float64(w)  // converted both ints to floats\nfmt.Printf(\"%.4f\\n\", slope)   // printed float to 4 decimal points\n</code></pre>\n\n<p>Basically here it is:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bufio\"\n    \"os\"\n    \"strconv\"\n)\n\nfunc main() {\n    var xInp = bufio.NewScanner(os.Stdin)\n    var yInp = bufio.NewScanner(os.Stdin)\n    fmt.Print(\"insert y value: \")\n    yInp.Scan()\n    fmt.Print(\"Insert x value: \")\n    xInp.Scan()\n    q, err := strconv.Atoi(yInp.Text())\n    w, err := strconv.Atoi(xInp.Text())\n    var slope = float64(q)/float64(w)\n    fmt.Printf(\"%.4f\\n\", slope)\n    fmt.Println(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 193, "user_id": 5574609, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-Z8DszpZmPOA/AAAAAAAAAAI/AAAAAAAAABI/qRBWSg0ue2E/photo.jpg?sz=128", "display_name": "liam", "link": "https://stackoverflow.com/users/5574609/liam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1448932605, "creation_date": 1448930263, "last_edit_date": 1448932605, "question_id": 34010650, "link": "https://stackoverflow.com/questions/34010650/substrings-and-rounding-in-go", "title": "Substrings and rounding in go", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bufio\"\n    \"os\"\n    \"strconv\"\n)\n\nfunc main() {\n    fmt.Print(\"loaded\\n\")\n    var xInp = bufio.NewScanner(os.Stdin) \n    var yInp = bufio.NewScanner(os.Stdin)\n\n    fmt.Print(\"insert y value: \")\n    yInp.Scan()\n    fmt.Print(\"Insert x value: \")\n    xInp.Scan()\n\n    q, err := strconv.Atoi(yInp.Text())\n    w, err := strconv.Atoi(xInp.Text())\n\n    var slope = q/w\n    fmt.Print(slope)\n    fmt.Print(err)\n}\n</code></pre>\n\n<p>I am trying to make this code have a substring. When I type in as y, 190. And x as 13. The answer, the program claims is 14. But that is not true. It is a infinite decimal. Obviously I do not want to show the whole decimal. But I do want to show 4 decimal places. for example 190/13 = 14.6153. It is also fine if you know how to round the decimal. That probably would be better. But both are fine.</p>\n"}, {"tags": ["csv", "go", "error-handling"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 17, "last_activity_date": 1448920460, "creation_date": 1448920460, "answer_id": 34008736, "question_id": 34008600, "link": "https://stackoverflow.com/questions/34008600/handle-a-specific-error-in-golang/34008736#34008736", "title": "Handle a specific error in golang", "body": "<p><code>csv.Reader</code> doesn't return that error, it returns a <a href=\"https://golang.org/pkg/encoding/csv/#ParseError\"><code>csv.ParseError</code></a>. You first need to check if you have a ParseError, then check the Err field:</p>\n\n<pre><code>if err, ok := err.(*csv.ParseError); ok &amp;&amp; err.Err == csv.ErrFieldCount {\n    return nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "is_accepted": false, "score": 7, "last_activity_date": 1448920479, "creation_date": 1448920479, "answer_id": 34008740, "question_id": 34008600, "link": "https://stackoverflow.com/questions/34008600/handle-a-specific-error-in-golang/34008740#34008740", "title": "Handle a specific error in golang", "body": "<p>Yeah its not really <em>well</em> documented (that is, glancing at the documentation doesn't give you the answer very quickly). Although <code>Read()</code> returns an <code>error</code>, its actually an instance of a <a href=\"https://golang.org/pkg/encoding/csv/#ParseError\" rel=\"noreferrer\">*csv.ParseError</a> which you can assert and check:</p>\n\n<pre><code>record, err := reader.Read()\nif err != nil {\n    if perr, ok := err.(*csv.ParseError); ok &amp;&amp; perr.Err == csv.ErrFieldCount {\n        return nil\n    }\n    return err\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 504, "user_id": 1941745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9fbfbcd311fc349cfe27c231fa3654?s=128&d=identicon&r=PG", "display_name": "Kerby Shedden", "link": "https://stackoverflow.com/users/1941745/kerby-shedden"}, "is_accepted": false, "score": 10, "last_activity_date": 1451793956, "last_edit_date": 1451793956, "creation_date": 1451791094, "answer_id": 34572977, "question_id": 34008600, "link": "https://stackoverflow.com/questions/34008600/handle-a-specific-error-in-golang/34572977#34572977", "title": "Handle a specific error in golang", "body": "<p>Set FieldsPerRecord in the CSV Reader struct to be a negative number.  Then ParseErrors for unequal field counts will not occur.</p>\n\n<p>See here:</p>\n\n<p><a href=\"https://golang.org/pkg/encoding/csv/#example_Reader_options\" rel=\"noreferrer\">https://golang.org/pkg/encoding/csv/#example_Reader_options</a></p>\n"}], "owner": {"reputation": 3467, "user_id": 2958455, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4bf81a9aa9aa3619f1197c901f079268?s=128&d=identicon&r=PG", "display_name": "Jared Mackey", "link": "https://stackoverflow.com/users/2958455/jared-mackey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4570, "favorite_count": 1, "accepted_answer_id": 34008736, "answer_count": 3, "score": 8, "last_activity_date": 1451793956, "creation_date": 1448919920, "question_id": 34008600, "link": "https://stackoverflow.com/questions/34008600/handle-a-specific-error-in-golang", "title": "Handle a specific error in golang", "body": "<p>I am trying to simply ignore the <code>csv.ErrFieldCount</code> error in our code but cannot seem to only look at that one error. What am I doing wrong here?</p>\n\n<pre><code>record, err := reader.Read()\nif err != nil {\n    if err == csv.ErrFieldCount {\n        return nil\n    }\n    return err\n}\n</code></pre>\n\n<p>But when I run the code the last line of the csv file gives me this error paniced <code>line 11535, column 0: wrong number of fields in line</code></p>\n"}, {"tags": ["go", "fastcgi", "basic-authentication", "openbsd"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1448917937, "post_id": 34006957, "comment_id": 55772072, "body": "Your perl example is using the REMOTE_USER variable, but the Go example is trying to do BasicAuth. Have you checked the request headers for &quot;Remote-User&quot; (I&#39;m fairly certain the CGI variables get canonicalized and mapped to headers)? Also, why are you using FCGI at all?"}, {"owner": {"reputation": 97, "user_id": 5586999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d6ede0f59d47a14f8ab7659e08972c?s=128&d=identicon&r=PG&f=1", "display_name": "user208383", "link": "https://stackoverflow.com/users/5586999/user208383"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1448960330, "post_id": 34006957, "comment_id": 55788013, "body": "I cannot find how to read the REMOTE_USER CGI environment variable in go (if <code>r.BasicAuth()</code> isn&#39;t the right way to do it). Like said in my posting I have printed the full headers using <code>io.WriteString(w, fmt.Sprintf(&quot;Header: %s&quot;, r.Header))</code> confirmed that <i>Authorization:[]</i> map is empty and there is no <i>REMOTE_USER</i> in that header. I&#39;m stuck. (And there are reasons that I cannot discuss here that force me to use fcgi.)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1448982982, "post_id": 34006957, "comment_id": 55802501, "body": "Your attempt to use <code>r.BasicAuth()</code> is incorrect simply because reading the <code>REMOTE_USER</code> CGI variable means <i>the authentication is expected to be performed by the web server,</i> and you have no control over it. So what you need is to just correctly read the value of this variable. I have provided an answer on how to do that."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1448991832, "post_id": 34006957, "comment_id": 55808723, "body": "It doesn&#39;t look like <code>REMOTE_USER</code> is used in the fcgi package. I would have the webserver doing the auth put it in a header or an <code>HTTP_REMOTE_USER</code> variable."}, {"owner": {"reputation": 97, "user_id": 5586999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d6ede0f59d47a14f8ab7659e08972c?s=128&d=identicon&r=PG&f=1", "display_name": "user208383", "link": "https://stackoverflow.com/users/5586999/user208383"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449041542, "post_id": 34006957, "comment_id": 55829328, "body": "@JimB: Thanks for clarification. Though modifying the webserver to work around an issue in go is not too appealing."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449064236, "post_id": 34006957, "comment_id": 55843279, "body": "I don&#39;t think it&#39;s too big a deal. IIRC from the CGI days, I had a number of systems that would only use <code>HTTP_REMOTE_USER</code>, or some other custom variable. Assigning it after authentication was par for the course."}, {"owner": {"reputation": 773, "user_id": 3675575, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5olv6.png?s=128&g=1", "display_name": "luca76", "link": "https://stackoverflow.com/users/3675575/luca76"}, "edited": false, "score": 0, "creation_date": 1503320235, "post_id": 34006957, "comment_id": 78553033, "body": "Go 1.9 will do it: <a href=\"https://tip.golang.org/doc/go1.9#net/http/fcgi\" rel=\"nofollow noreferrer\">tip.golang.org/doc/go1.9#net/http/fcgi</a>"}, {"owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "edited": false, "score": 0, "creation_date": 1505205390, "post_id": 34006957, "comment_id": 79305236, "body": "Go 1.9 is out and indeed it does it."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1448991481, "post_id": 34023664, "comment_id": 55808521, "body": "Actually, looking at the cgi/fcgi code now, I don&#39;t think REMOTE_USER will get transferred into the Go request at all. Only a few specific variables, and those starting with <code>HTTP_</code> are added to the headers."}, {"owner": {"reputation": 97, "user_id": 5586999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d6ede0f59d47a14f8ab7659e08972c?s=128&d=identicon&r=PG&f=1", "display_name": "user208383", "link": "https://stackoverflow.com/users/5586999/user208383"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449041252, "post_id": 34023664, "comment_id": 55829198, "body": "@kostix: I have checked and falsified <code>r.Header.Get(&quot;Remote-User&quot;)</code>. That does not work, at least not in golang version 1.4.2 (pgk of OpenBSD 5.8). (As I mentioned in my original question (Quote: &quot;To debug, I printed the output of r.Header&quot;).) @JimB: I think you are right. Golang does not transfer REMOTE_USER into the go request."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 97, "user_id": 5586999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d6ede0f59d47a14f8ab7659e08972c?s=128&d=identicon&r=PG&f=1", "display_name": "user208383", "link": "https://stackoverflow.com/users/5586999/user208383"}, "edited": false, "score": 0, "creation_date": 1449053703, "post_id": 34023664, "comment_id": 55836435, "body": "@user208383, too bad. I&#39;d consder this a bug. Sorry for misleading you with my answer."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1449053796, "last_edit_date": 1449053796, "creation_date": 1448982844, "answer_id": 34023664, "question_id": 34006957, "link": "https://stackoverflow.com/questions/34006957/golang-with-fastcgi-how-to-read-remote-user/34023664#34023664", "title": "golang with fastcgi how to read REMOTE_USER", "body": "<p>While <code>@JimB</code> is correct on that you're wrong in your approach, I'll answer the question as stated.</p>\n\n<p>The <code>net/http/fcgi</code> package uses the machinery of <code>net/http/cgi</code> to populate an instance of <code>http.Request</code>&mdash;which is passed to your handler&mdash;with \"parameters\" (key/value pairs) submitted by the webserver during the FastCGI session (call).\nThis is done <a href=\"https://golang.org/src/net/http/fcgi/child.go#L261\" rel=\"nofollow\">here</a>.</p>\n\n<p>Now if you'll inspect <a href=\"https://golang.org/src/net/http/cgi/child.go#L52\" rel=\"nofollow\">the relevant bit of the <code>net/http/cgi</code> code</a>, you'll see that the variables which are not mapped to specific dedicated fields of <code>http.Request</code> <a href=\"https://golang.org/src/net/http/cgi/child.go#L82\" rel=\"nofollow\">get converted to HTTP \"headers\"</a>.</p>\n\n<p>This means, <s>your code should be able to access the variable you need using something like</s></p>\n\n<pre><code>ruser := r.Header.Get(\"Remote-User\")\n</code></pre>\n\n<p><strong>Update 2015-12-02:</strong> the reseach performed by <code>@JimB</code> and the OP showed that there's apparently no way to read the <code>REMOTE_USER</code> variable under FastCGI.  Sorry for the noise.</p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1449056625, "post_id": 34037531, "comment_id": 55838299, "body": "Verified with Go 1.5 under Linux/amd64, Apache2 2.4.10 + <code>mod_fcgid</code> + <code>mod_auth_basic</code> + <code>mod_authz_user</code>"}], "tags": [], "owner": {"reputation": 97, "user_id": 5586999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d6ede0f59d47a14f8ab7659e08972c?s=128&d=identicon&r=PG&f=1", "display_name": "user208383", "link": "https://stackoverflow.com/users/5586999/user208383"}, "is_accepted": true, "score": 1, "last_activity_date": 1449043192, "creation_date": 1449043192, "answer_id": 34037531, "question_id": 34006957, "link": "https://stackoverflow.com/questions/34006957/golang-with-fastcgi-how-to-read-remote-user/34037531#34037531", "title": "golang with fastcgi how to read REMOTE_USER", "body": "<p>The simple answer (as of go version 1.4.2) is that go currently does not support the transfer of CGI variable REMOTE_USER.</p>\n"}, {"tags": [], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "is_accepted": false, "score": 1, "last_activity_date": 1492056952, "creation_date": 1492056952, "answer_id": 43383412, "question_id": 34006957, "link": "https://stackoverflow.com/questions/34006957/golang-with-fastcgi-how-to-read-remote-user/43383412#43383412", "title": "golang with fastcgi how to read REMOTE_USER", "body": "<p>This <a href=\"https://go-review.googlesource.com/c/40012/\" rel=\"nofollow noreferrer\">core change</a> to the fcgi package is in review and is close to being merged. If it's no longer relevant to you, hopefully it will be useful to others.</p>\n"}, {"comments": [{"owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "edited": false, "score": 2, "creation_date": 1505205364, "post_id": 45797799, "comment_id": 79305214, "body": "Go 1.9 is out and it does expose <code>REMOTE_USER</code> indeed."}], "tags": [], "owner": {"reputation": 773, "user_id": 3675575, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5olv6.png?s=128&g=1", "display_name": "luca76", "link": "https://stackoverflow.com/users/3675575/luca76"}, "is_accepted": false, "score": 2, "last_activity_date": 1503320377, "creation_date": 1503320377, "answer_id": 45797799, "question_id": 34006957, "link": "https://stackoverflow.com/questions/34006957/golang-with-fastcgi-how-to-read-remote-user/45797799#45797799", "title": "golang with fastcgi how to read REMOTE_USER", "body": "<p>Go 1.9 will expose cgi environment variables. As seen in this closed ticket:</p>\n\n<p><a href=\"https://go-review.googlesource.com/c/40012\" rel=\"nofollow noreferrer\">https://go-review.googlesource.com/c/40012</a></p>\n"}], "owner": {"reputation": 97, "user_id": 5586999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8d6ede0f59d47a14f8ab7659e08972c?s=128&d=identicon&r=PG&f=1", "display_name": "user208383", "link": "https://stackoverflow.com/users/5586999/user208383"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1317, "favorite_count": 2, "accepted_answer_id": 34037531, "answer_count": 4, "score": 2, "last_activity_date": 1503320377, "creation_date": 1448913760, "question_id": 34006957, "link": "https://stackoverflow.com/questions/34006957/golang-with-fastcgi-how-to-read-remote-user", "title": "golang with fastcgi how to read REMOTE_USER", "body": "<p>Short: How can I read the CGI var REMOTE_USER on golang using fastcgi?</p>\n\n<p>Long:\nI'm trying to write a program in go to work behind a httpd using fcgi over a socket. The httpd does the ssl termination and provides basic auth. I need to read $REMOTE_USER, but I cannot in golang, while I can in perl.</p>\n\n<p>My code is based on <a href=\"http://www.dav-muz.net/blog/2013/09/how-to-use-go-and-fastcgi/\" rel=\"nofollow\">this fcgi example</a>. I try</p>\n\n<pre><code>func homeView(w http.ResponseWriter, r *http.Request) {     \n    user, pass, authok := r.BasicAuth()\n</code></pre>\n\n<p>But authok is always false, user and pass remain empty, although I know for sure that the authorization (done by httpd) was OK. To eliminate other errors, I have done it in perl:</p>\n\n<pre><code>my $socket = FCGI::OpenSocket(\"/run/fcgi-check.sock\", 5);\nmy $q = FCGI::Request(\\*STDIN, \\*STDOUT, \\*STDERR, \\%ENV, $socket);\n\nwhile ($q-&gt;Accept() &gt;= 0) {\n    my $c = CGI::Simple-&gt;new;\n    my $user_id      = $c-&gt;remote_user(); \n</code></pre>\n\n<p>and it works fine in perl.</p>\n\n<p>To debug, I printed the output of r.Header and I got:</p>\n\n<pre><code>map[Authorization:[]\n</code></pre>\n\n<p>Am I right that the header that go sees does no hold any information about any authorization? But it does in perl.</p>\n\n<p>Here is a full but minimal golang code example that demonstrates the problem (on OpenBSD 5.8 with go version go1.4.2 openbsd/amd64 and OpenBSDs httpd with 'authenticate \"/\" with restricted_users' in httpd.conf.</p>\n\n<pre><code>package main\n\nimport (\n        \"github.com/gorilla/mux\"\n        \"io\"\n        \"log\"\n        \"fmt\"\n        \"net\"\n        \"net/http\"\n        \"net/http/fcgi\"\n)\n\n\nfunc homeView(w http.ResponseWriter, r *http.Request) {\n        headers := w.Header()\n        headers.Add(\"Content-Type\", \"text/html\")\n        headers.Add(\"Cache-Control\", \"no-cache, no-store, must-revalidate\")\n        headers.Add(\"Pragma\", \"no-cache\")\n        headers.Add(\"Expires\", \"0\")\n        r.ParseForm()\n\n        user, pass, authok := r.BasicAuth()\n\n        if authok {\n                io.WriteString(w, fmt.Sprintln(\"Auth OK\"))\n                io.WriteString(w, fmt.Sprintln(\"user is: \"+user+\", pass is: \"+pass))\n        } else {\n                io.WriteString(w, fmt.Sprintln(\"Auth NOT OK\"))\n        }\n}\n\nfunc main() {\n\n        r := mux.NewRouter()\n        r.HandleFunc(\"/check/\", homeView)\n\n    var err error\n        listener, err := net.Listen(\"unix\", \"/run/fcgi-check.sock\")\n        if err != nil {\n                log.Fatal(err)\n        }\n        defer listener.Close()\n\n        err = fcgi.Serve(listener, r)\n        if err != nil { log.Fatal(err)}\n}\n</code></pre>\n\n<p>Help will be appreciated!</p>\n\n<p>Thanks in advance!\nT.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1448912379, "post_id": 34006446, "comment_id": 55768976, "body": "I believe the db driver would add whatever sub documents are reflected in your model. Meaning, if you have items in <code>Categories</code> and you make correct use of tags for mongo (requires bson attribute I believe) then it should just take care of it for you."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1448930499, "post_id": 34006446, "comment_id": 55777238, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/29817535/mongodb-how-to-insert-additional-object-into-object-collection-in-golang\">MongoDb : How to insert additional object into object collection in golang?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "is_accepted": false, "score": 0, "last_activity_date": 1448934448, "creation_date": 1448934448, "answer_id": 34011243, "question_id": 34006446, "link": "https://stackoverflow.com/questions/34006446/how-would-i-go-about-inserting-a-subdocument-in-mongodb-in-golang-mgo/34011243#34011243", "title": "How would I go about inserting a subdocument in Mongodb in Golang / mgo?", "body": "<p>Sorted it using:</p>\n\n<pre><code>change := mgo.Change{\n    Update: bson.M{\"$push\": bson.M{\"categories\": cat}},\n}\n\n_, err := repo.collection.FindId(bson.ObjectIdHex(article)).Apply(change, nil)\n\nif err != nil {\n    panic(err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 11486905, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GyrM.gif?s=128&g=1", "display_name": "Jyotsna Gupta", "link": "https://stackoverflow.com/users/11486905/jyotsna-gupta"}, "is_accepted": false, "score": 0, "last_activity_date": 1557620555, "creation_date": 1557620555, "answer_id": 56095266, "question_id": 34006446, "link": "https://stackoverflow.com/questions/34006446/how-would-i-go-about-inserting-a-subdocument-in-mongodb-in-golang-mgo/56095266#56095266", "title": "How would I go about inserting a subdocument in Mongodb in Golang / mgo?", "body": "<p>Update the <strong>Article</strong> struct as :</p>\n\n<pre><code>type Article struct {\n   ArticleId  string      `bson:\"_id\"`\n   Title      string      `form\"title\" json:\"title,omitempty\"`\n   Categories []Category  `json:\"category,omitempty\"`\n}\n</code></pre>\n\n<p>Your Query accordingly:</p>\n\n<pre><code>data := model.Category{\n            CategoryId :      \"yourText\",\n            Product    :      \"productName,\n             ...\n        }\n\nselector := bson.M{\"_id\": \"provideTheTitle\"}\nchanges := bson.M{\"$push\": bson.M{\"category\": bson.M{\"$each\": []model.Category{data}}}}\nerr = c.Update(selector, changes)\n</code></pre>\n\n<p>It would be great if you can share your <strong><em>Category</em></strong> struct and include an field <strong>_id</strong> in your Article struct.</p>\n"}], "owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1057, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1557620555, "creation_date": 1448911863, "question_id": 34006446, "link": "https://stackoverflow.com/questions/34006446/how-would-i-go-about-inserting-a-subdocument-in-mongodb-in-golang-mgo", "title": "How would I go about inserting a subdocument in Mongodb in Golang / mgo?", "body": "<p>Say for example I had the following struct:</p>\n\n<pre><code>type Article struct {\n    Title string `form\"title\" json:\"title\"`\n    Categories []*Category \n}\n</code></pre>\n\n<p>How would I go about adding a new category? </p>\n"}, {"tags": ["bash", "heroku", "go"], "comments": [{"owner": {"reputation": 5612, "user_id": 486478, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/81e83270085f7f733a440c0283c4b39b?s=128&d=identicon&r=PG", "display_name": "egeloen", "link": "https://stackoverflow.com/users/486478/egeloen"}, "edited": false, "score": 0, "creation_date": 1454365227, "post_id": 34005895, "comment_id": 58003415, "body": "Have you fixed you issue?"}, {"owner": {"reputation": 1637, "user_id": 2457012, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ee3520e23db52b404230acb1938d029?s=128&d=identicon&r=PG&f=1", "display_name": "Marcelo", "link": "https://stackoverflow.com/users/2457012/marcelo"}, "reply_to_user": {"reputation": 5612, "user_id": 486478, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/81e83270085f7f733a440c0283c4b39b?s=128&d=identicon&r=PG", "display_name": "egeloen", "link": "https://stackoverflow.com/users/486478/egeloen"}, "edited": false, "score": 0, "creation_date": 1454373493, "post_id": 34005895, "comment_id": 58006291, "body": "Yes. It&#39;s working with the full path to bash executable:  out, err := exec.Command(&quot;/bin/bash&quot;, script_path, arg).Output()"}, {"owner": {"reputation": 5612, "user_id": 486478, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/81e83270085f7f733a440c0283c4b39b?s=128&d=identicon&r=PG", "display_name": "egeloen", "link": "https://stackoverflow.com/users/486478/egeloen"}, "edited": false, "score": 0, "creation_date": 1454401781, "post_id": 34005895, "comment_id": 58015670, "body": "Ok, so, I should do something wrong on my side! Thanks for the feedback and confirming that it is possible to do it!"}, {"owner": {"reputation": 5612, "user_id": 486478, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/81e83270085f7f733a440c0283c4b39b?s=128&d=identicon&r=PG", "display_name": "egeloen", "link": "https://stackoverflow.com/users/486478/egeloen"}, "edited": false, "score": 0, "creation_date": 1454435887, "post_id": 34005895, "comment_id": 58039372, "body": "Does your <code>script_path</code> looks like <code>&#47;app&#47;path&#47;to&#47;script.sh</code> ? It&#39;s annoying but I can&#39;t get it working whereas it works when using <code>heroku run bash</code>..."}, {"owner": {"reputation": 1637, "user_id": 2457012, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ee3520e23db52b404230acb1938d029?s=128&d=identicon&r=PG&f=1", "display_name": "Marcelo", "link": "https://stackoverflow.com/users/2457012/marcelo"}, "reply_to_user": {"reputation": 5612, "user_id": 486478, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/81e83270085f7f733a440c0283c4b39b?s=128&d=identicon&r=PG", "display_name": "egeloen", "link": "https://stackoverflow.com/users/486478/egeloen"}, "edited": false, "score": 0, "creation_date": 1454449743, "post_id": 34005895, "comment_id": 58047329, "body": "yes:  script_path := path.Join(&quot;.&quot;, &quot;src&quot;, &quot;ext&quot;, &quot;dextenso.sh&quot;)"}, {"owner": {"reputation": 5612, "user_id": 486478, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/81e83270085f7f733a440c0283c4b39b?s=128&d=identicon&r=PG", "display_name": "egeloen", "link": "https://stackoverflow.com/users/486478/egeloen"}, "edited": false, "score": 0, "creation_date": 1454494179, "post_id": 34005895, "comment_id": 58065320, "body": "One more time, thanks a lot for your reply. Everything works like a charm now!"}, {"owner": {"reputation": 1637, "user_id": 2457012, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ee3520e23db52b404230acb1938d029?s=128&d=identicon&r=PG&f=1", "display_name": "Marcelo", "link": "https://stackoverflow.com/users/2457012/marcelo"}, "reply_to_user": {"reputation": 5612, "user_id": 486478, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/81e83270085f7f733a440c0283c4b39b?s=128&d=identicon&r=PG", "display_name": "egeloen", "link": "https://stackoverflow.com/users/486478/egeloen"}, "edited": false, "score": 0, "creation_date": 1454505730, "post_id": 34005895, "comment_id": 58073362, "body": "You&#39;re welcome! Some upvotes would be nice too xD"}], "answers": [{"comments": [{"owner": {"reputation": 1637, "user_id": 2457012, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ee3520e23db52b404230acb1938d029?s=128&d=identicon&r=PG&f=1", "display_name": "Marcelo", "link": "https://stackoverflow.com/users/2457012/marcelo"}, "edited": false, "score": 0, "creation_date": 1454505673, "post_id": 34006262, "comment_id": 58073325, "body": "Hi Shelter, you answer helped me to find the solution, but those steps with the PATH variable were not necessary. I just needed to specify the full path to the bash executable and to my script. Like this:  <code>out, err := exec.Command(&quot;&#47;bin&#47;bash&quot;, path.Join(&quot;.&quot;, &quot;src&quot;, &quot;ext&quot;, &quot;dextenso.sh&quot;), arg).Output()</code>. Could you edit your answer so I can mark it as the solution? thanks!"}, {"owner": {"reputation": 33642, "user_id": 620097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/820980fd43f2607a815c1f3dbfe152cc?s=128&d=identicon&r=PG", "display_name": "shellter", "link": "https://stackoverflow.com/users/620097/shellter"}, "reply_to_user": {"reputation": 1637, "user_id": 2457012, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ee3520e23db52b404230acb1938d029?s=128&d=identicon&r=PG&f=1", "display_name": "Marcelo", "link": "https://stackoverflow.com/users/2457012/marcelo"}, "edited": false, "score": 0, "creation_date": 1454506188, "post_id": 34006262, "comment_id": 58073725, "body": "@marcelo : Hi, OK, I&#39;ve done that. I&#39;m glad it helped!"}], "tags": [], "owner": {"reputation": 33642, "user_id": 620097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/820980fd43f2607a815c1f3dbfe152cc?s=128&d=identicon&r=PG", "display_name": "shellter", "link": "https://stackoverflow.com/users/620097/shellter"}, "is_accepted": true, "score": 1, "last_activity_date": 1454506157, "last_edit_date": 1454506157, "creation_date": 1448911212, "answer_id": 34006262, "question_id": 34005895, "link": "https://stackoverflow.com/questions/34005895/run-bash-script-file-in-heroku-programatically/34006262#34006262", "title": "Run bash script file in Heroku programatically", "body": "<p>a shell return code of <code>127</code> is to designate \"Command not found\".</p>\n\n<p>You can see this behavior with this small example.</p>\n\n<pre><code>$ nonesuch\n-bash: nonesuch: command not found\n$ echo $?\n127\n</code></pre>\n\n<p>This sort of issue usually means you need to add </p>\n\n<pre><code> /full/path/to/myscriptdir\n</code></pre>\n\n<p>to the <code>PATH</code> env var. i.e.</p>\n\n<pre><code> export PATH=\"$PATH:/full/path/to/myscriptdir withSpaces\" \n</code></pre>\n\n<p>There are several places this can be accomplished, but it depends on your organizations rules for such things.</p>\n\n<p>To immediately resolve the problem, add to the <code>$HOME/.profile</code> file of the userID that runs Heroku OR there is likely a Heroku specific config file that it could be added to. (I don't have experience w Heroku).</p>\n\n<p>It's interesting that this article <a href=\"https://devcenter.heroku.com/articles/config-vars\" rel=\"nofollow\">Heroku config files</a> doesn't mention PATH variable. </p>\n\n<hr>\n\n<p>As you have discovered, you can edit your code to include the full path directly, i.e.</p>\n\n<pre><code>out, err := exec.Command(\"/bin/bash\", path.Join(\".\", \"src\", \"ext\", \"dextenso.sh\"), \n</code></pre>\n\n<p>IHTH</p>\n"}], "owner": {"reputation": 1637, "user_id": 2457012, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ee3520e23db52b404230acb1938d029?s=128&d=identicon&r=PG&f=1", "display_name": "Marcelo", "link": "https://stackoverflow.com/users/2457012/marcelo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2346, "favorite_count": 0, "accepted_answer_id": 34006262, "answer_count": 1, "score": 1, "last_activity_date": 1454506157, "creation_date": 1448909832, "question_id": 34005895, "link": "https://stackoverflow.com/questions/34005895/run-bash-script-file-in-heroku-programatically", "title": "Run bash script file in Heroku programatically", "body": "<p>I have a web app written in Go and deployed on Heroku. Recently, I've implemented a new feature that needs to run a bash script file and retrieve its output. The command I'm using is:</p>\n\n<pre><code>out, err := exec.Command(\"bash\", script_path, arg).Output()\n</code></pre>\n\n<p>Where script_path is the absolute path to the script. (which is built dynamically by using the caller filepath) And arg is an input to the script.</p>\n\n<p>This command works fine in my local machine but not in Heroku:</p>\n\n<blockquote>\n  <p>18:51:40 http: panic serving 10.238.8.204:17763: exit status 127</p>\n</blockquote>\n\n<p>ps: If I run the same command on \"<strong>heroku run bash</strong>\", it works.</p>\n\n<p>Any thoughts?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 1, "creation_date": 1448908901, "post_id": 34005573, "comment_id": 55767018, "body": "No, this is pretty much done &quot;using the key from range and some math.&quot; Do you have a tangible example where that solution would be awkward and you need something else? (Though it&#39;s probably still going to be &quot;using the key from range and some math.&quot;)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1448908938, "post_id": 34005573, "comment_id": 55767048, "body": "No, the grammar in the spec is very clear <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">golang.org/ref/spec#For_statements</a>"}, {"owner": {"reputation": 4579, "user_id": 1114274, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ebd3b90b30e78d29cc01c13ba6ebb090?s=128&d=identicon&r=PG", "display_name": "Mike Graf", "link": "https://stackoverflow.com/users/1114274/mike-graf"}, "reply_to_user": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1448909743, "post_id": 34005573, "comment_id": 55767497, "body": "@RobNapier I&#39;m just trying to get more proficient at go and working on a contrived example of a file &quot;Weaver&quot; (takes N files and produces an output file that is the first line of each file, then 2nd line of each file . eg file1 = <code>A\\nC\\nE</code>, file2= <code>B\\n,D\\n,F</code>  =&gt;  <code>A\\n\\B\\n\\C\\n\\D\\nE\\nF</code>"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1448911727, "creation_date": 1448911727, "answer_id": 34006405, "question_id": 34005573, "link": "https://stackoverflow.com/questions/34005573/how-to-combine-multiple-assignment-and-range-in-for-loops/34006405#34006405", "title": "How to combine multiple assignment and Range in for loops", "body": "<p>For example,</p>\n\n<p><code>so.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    files := [2]*os.File{}\n    for i, fileName := range os.Args[1:] {\n        if i &gt;= len(files) {\n            break\n        }\n        var err error\n        files[i], err = os.Open(fileName)\n        if err != nil {\n            // handle error\n        }\n    }\n    fmt.Println(files)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go build so.go &amp;&amp; ./so no.go so.go to.go\n[&lt;nil&gt; 0xc820030020]\n$ \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4579, "user_id": 1114274, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ebd3b90b30e78d29cc01c13ba6ebb090?s=128&d=identicon&r=PG", "display_name": "Mike Graf", "link": "https://stackoverflow.com/users/1114274/mike-graf"}, "edited": false, "score": 0, "creation_date": 1448944031, "post_id": 34006486, "comment_id": 55780855, "body": "thanks for helping me learn more idiomatic go, using a slice is definitely the way to go, I added a link to this clarifying blog post: <a href=\"http://openmymind.net/The-Minimum-You-Need-To-Know-About-Arrays-And-Slices-In-Go/\" rel=\"nofollow noreferrer\">openmymind.net/&hellip;</a>"}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 5, "last_activity_date": 1448911972, "creation_date": 1448911972, "answer_id": 34006486, "question_id": 34005573, "link": "https://stackoverflow.com/questions/34005573/how-to-combine-multiple-assignment-and-range-in-for-loops/34006486#34006486", "title": "How to combine multiple assignment and Range in for loops", "body": "<p>There are a lot of different issues here. First, <code>range</code> already does what you want. There's no need for even math.</p>\n\n<pre><code>for i, fileName := range os.Args[1:] {\n</code></pre>\n\n<p><code>i</code> will range from 0 to 1 here, just like you want. Ranging over a slice always starts at index 0 (it's relative to the start of the <em>slice</em>). (<a href=\"http://play.golang.org/p/qlVM6Y7yPD\">http://play.golang.org/p/qlVM6Y7yPD</a>)</p>\n\n<p>Note that <code>os.Args[1:2]</code> is just one element. You probably meant it to be two. </p>\n\n<p>In any case, this is likely what you really meant:</p>\n\n<p><a href=\"http://play.golang.org/p/G4yfkKrEe7\">http://play.golang.org/p/G4yfkKrEe7</a></p>\n\n<pre><code>files := make([]*os.File, 0)\n\nfor _, fileName := range os.Args[1:] {\n    f, err := os.Open(fileName)\n    if err != nil {\n        log.Fatalf(\"Could not open file: %v\", err)\n    }\n    files = append(files, f)\n}\nfmt.Printf(\"%v\\n\", files)\n</code></pre>\n\n<p>Fixed-length arrays are very uncommon in Go. Generally you want a slice, created with <code>make</code>.</p>\n"}], "owner": {"reputation": 4579, "user_id": 1114274, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ebd3b90b30e78d29cc01c13ba6ebb090?s=128&d=identicon&r=PG", "display_name": "Mike Graf", "link": "https://stackoverflow.com/users/1114274/mike-graf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 1, "accepted_answer_id": 34006486, "answer_count": 2, "score": -2, "last_activity_date": 1448943988, "creation_date": 1448908611, "last_edit_date": 1448943988, "question_id": 34005573, "link": "https://stackoverflow.com/questions/34005573/how-to-combine-multiple-assignment-and-range-in-for-loops", "title": "How to combine multiple assignment and Range in for loops", "body": "<p>I'm trying to figure out how to (or if it's possible to) combine multiple assignment and ranges in Golang</p>\n\n<p>ex pseudo code of what I'd like to do</p>\n\n<pre><code>files := [2]*os.File{}\n\nfor i, _, fileName := 0, range os.Args[1:3] {\n  files[i], _ = os.Open(fileName)\n}\n</code></pre>\n\n<p>The idea being I want to have both an iteration counter (<code>i</code>) and the filenames (<code>fileName</code>). I know this can be achieved by using the key from range and some math (<code>key -1</code>), thats not the point of the example. </p>\n\n<p><strong>Edit:</strong> </p>\n\n<p>Upon debugging the above example, I learned that <code>i</code> will range 0-1 in that example; Because os.Args[1:2] is a slice and that slice has indexing 0-1 .  Therefore I dont need \"some math\" to properly index the keys.</p>\n\n<p>** EDIT 2: ** \n<a href=\"http://openmymind.net/The-Minimum-You-Need-To-Know-About-Arrays-And-Slices-In-Go/\" rel=\"nofollow\">This post is also a must read</a> as to why the above <code>[2]*os.File{}</code> is not idiomatic go, instead it should not have a size specified (<code>files := []*os.File{}</code>) so that <code>files</code> is of type slice of *os.File </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1448906494, "last_edit_date": 1448906494, "creation_date": 1448906177, "answer_id": 34004925, "question_id": 34004764, "link": "https://stackoverflow.com/questions/34004764/golang-string-with-many-delimiters-to-slice-or-struct/34004925#34004925", "title": "Golang - String with many delimiters to slice or struct", "body": "<p>You need to do a bit more work to extract the data you want. Here's a sample program that correctly populates the <code>Messages</code> array. I'll update with some notes on what's I did to move from your attempt to what you're looking for.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\n\ntype Message struct {\n    Key string\n    Value string\n}\n\ntype Response struct {\n    Connect string\n    Messages []Message\n}\nfunc main() {\n    result := `220 Connected.\\ncommand:connect\\nemail:ERROR_MAIL_MISSING\\nstatus:CMD_ERROR\\nend`\n        data := strings.Split(string(result), \"\\\\\")\n\n    r := &amp;Response{}\n        for i := range data {\n                if data[i] == \"220 Connected.\" {\n                        r.Connect = \"TRUE\"\n                } else {\n            tokens := strings.Split(data[i], \":\")\n            if len(tokens) == 2 {\n                m := Message{tokens[0], tokens[1]}\n                r.Messages = append(r.Messages, m)\n            }\n        }\n        }\n        for i := range r.Messages {\n             fmt.Println(r.Messages[i])\n        }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Hs8aqYPyuM\" rel=\"nofollow\">https://play.golang.org/p/Hs8aqYPyuM</a></p>\n\n<p>Alright, so first lets list some problems. In your attempt the for loop looks like this;</p>\n\n<pre><code>  for i := range data {\n            Reply := new(Response)\n            if data[i] == \"220 Connected.\" {\n                    Reply.Connect = \"TRUE\"\n                    Response = append(Response, Reply)\n            }\n    }\n</code></pre>\n\n<p>This isn't consistent with your types/data layout. On every iteration you create a new <code>Response</code> instance, you actually only need one. What you want on each iteration is a new <code>Message</code> instance. This causes a few problems, firstly the data you're looking at isn't a response, it's a message, secondly you keep overwriting the previous one (that object is only scoped for the loop). To correct this we instantiate the <code>Response</code> object before the loop. Secondly, you need a second split in order to get your data out. So inside the loop we split on a colon to separate the key and value of each message. Then I have a quick check on the length before adding it (I got a panic on first run, the first if probably failed, meaning you need to edit that a bit. If you don't get 220 for connected you want to set that value to false, you should do the message split an a final else but simply not being <code>220 Connected.</code> isn't sufficient to assume the current item is a <code>Message</code> which is why I added bounds check). Note that inside this loop I instantiate a new message for each key value pair. We use append there to append to the <code>Messages</code> array, not appending <code>Response</code>'s onto eachother (that will never work since it's a struct, not a slice or map). This also makes it so the <code>Message</code> persists rather than going out of scope each time we hit the bottom of the loop (<code>m</code> will go out of scope but the instance in <code>r.Messages</code> will still be around).</p>\n"}], "owner": {"reputation": 1067, "user_id": 435478, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Fj0sO.jpg?s=128&g=1", "display_name": "Hamza", "link": "https://stackoverflow.com/users/435478/hamza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1779, "favorite_count": 0, "accepted_answer_id": 34004925, "answer_count": 1, "score": 1, "last_activity_date": 1448906494, "creation_date": 1448905605, "question_id": 34004764, "link": "https://stackoverflow.com/questions/34004764/golang-string-with-many-delimiters-to-slice-or-struct", "title": "Golang - String with many delimiters to slice or struct", "body": "<p>I have the following string returned as response from a TCP connection :</p>\n\n<pre><code>220 Connected.\\ncommand:connect\\nemail:ERROR_MAIL_MISSING\\nstatus:CMD_ERROR\\nend\n</code></pre>\n\n<p>I want actually to transform this response to the following golang struct :</p>\n\n<pre><code>type Message struct {\n    Key string\n    Value string\n}\n\ntype Response struct {\n    Connect string\n    Messages []Message\n}\n</code></pre>\n\n<p>If 220 Connected is always present means :</p>\n\n<pre><code>Response.Connect =&gt; TRUE\n</code></pre>\n\n<p>All response between 220 Connected. and end can be accessed using :</p>\n\n<pre><code>Response[0].Key =&gt; \"command\"\nResponse[0].Value =&gt; \"connect\"\n</code></pre>\n\n<p>This is what I actually achieved :</p>\n\n<pre><code>result, err := ioutil.ReadAll(conn)\n        data := strings.Split(string(result), \"\\n\")\n\n        for i := range data {\n                Reply := new(Response)\n                if data[i] == \"220 Connected.\" {\n                        Reply.Connect = \"TRUE\"\n                        Response = append(Response, Reply)\n                }\n        }\n</code></pre>\n\n<p>Any hint how this can be achieved ? I'm a newbie with Golang</p>\n"}, {"tags": ["google-app-engine", "go", "google-identity-toolkit"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1448896054, "post_id": 34001547, "comment_id": 55759056, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/32271148/how-to-correctly-import-golang-appengine\">How to correctly import Golang appengine?</a> and <a href=\"http://stackoverflow.com/questions/29477505/golang-different-appengine-packages\">Golang: Different AppEngine packages</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 2, "last_activity_date": 1450320448, "creation_date": 1450320448, "answer_id": 34325791, "question_id": 34001547, "link": "https://stackoverflow.com/questions/34001547/which-golang-packages-to-use-for-google-app-engine/34325791#34325791", "title": "Which Golang Packages to use for Google App Engine", "body": "<p>I recommend using the <code>google.golang.org/appengine</code> packages if you can. They play nicer with the language, primarily because of the reason you mention (<code>context</code> is a <code>net/context</code>), and also because the libraries are newer and often have more features. In particular if you plan to use other Google services (like Google Cloud Storage) you'll have a much easier time using the newer libraries.</p>\n\n<p>But they're also better because - since they're just regular, importable packages - they play nicer with the standard set of go tools: <code>goimports</code> for auto-formatting, <code>gocode</code> for autocomplete, etc..</p>\n\n<p>However they are not entirely complete. There are some features <a href=\"https://github.com/golang/appengine#3-update-code-using-deprecated-removed-or-modified-apis\" rel=\"nofollow\">missing or deprecated</a>. In my experience it used to be that the major missing feature was the <code>aetest</code> package, which has since <a href=\"https://github.com/golang/appengine/tree/master/aetest\" rel=\"nofollow\">been ported</a>, so there's now very few reasons not to switch. </p>\n"}], "owner": {"reputation": 3730, "user_id": 464064, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5b106b3ab0dfec1dcc591dd7b8d309fb?s=128&d=identicon&r=PG", "display_name": "John F.", "link": "https://stackoverflow.com/users/464064/john-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1450320448, "creation_date": 1448895668, "question_id": 34001547, "link": "https://stackoverflow.com/questions/34001547/which-golang-packages-to-use-for-google-app-engine", "title": "Which Golang Packages to use for Google App Engine", "body": "<p>I recently started to explore the Google Identity Kit using golang on the App Engine. I was going off of the samples in the <a href=\"https://github.com/googlesamples/identity-toolkit-go/blob/master/favweekday/favweekday.go\" rel=\"nofollow\">googlesamples/identity-toolkit-go</a>. In looking at the code, I found some appengine packages for the following:</p>\n\n<pre><code>\"google.golang.org/appengine\"\n\"google.golang.org/appengine/datastore\"\n</code></pre>\n\n<p>For the GAE Golang application that I am working on, I use the GAE SDK to run the application using <code>goapp run</code>. However, in my code, I only reference</p>\n\n<pre><code>\"appengine\"\n\"appengine/datastore\"\n</code></pre>\n\n<p>because this points to the golang src located in the extracted go appengine sdk.</p>\n\n<p><strong>Do I need to be using the <code>google.golang.org</code> appengine packages instead?</strong></p>\n\n<p>I only found this out after realizing that the appengine.Context that is expected by the identity kit methods did not match what I was using. I received this error</p>\n\n<pre><code>`cannot use c (type \"appengine\".Context) as type \"golang.org/x/net/context\".Context in argument to client.ValidateToken. \"appengine\".Context does not implement \"golang.org/x/net/context\".Context (missing Deadline method)`\n</code></pre>\n\n<p>despite me using <code>appengine.NewContext(r)</code> as the example explained.</p>\n"}, {"tags": ["search", "go", "binary-search"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1448950725, "last_edit_date": 1592644375, "creation_date": 1448891166, "answer_id": 34000106, "question_id": 33999844, "link": "https://stackoverflow.com/questions/33999844/go-binary-search-error/34000106#34000106", "title": "Go binary search error", "body": "<p><a href=\"https://golang.org/pkg/sort/#Search\" rel=\"nofollow noreferrer\"><code>sort.Search()</code></a> returns the smallest index <code>i</code> in <code>[0, n)</code> at which <code>f(i)</code> is <code>true</code>.</p>\n<p>Since slice indices are 0-based, you should expect a return of <code>0</code> for the first and <code>1</code> for the second. It (seemingly) works for the second.</p>\n<p>Quoting from the doc:</p>\n<blockquote>\n<p>...assuming that on the range [0, n), <code>f(i) == true</code> implies <code>f(i+1) == true</code>. That is, Search requires that <code>f</code> is <code>false</code> for some (possibly empty) prefix of the input range [0, n) and then <code>true</code> for the (possibly empty) remainder; Search returns the first <code>true</code> index. If there is no such index, Search returns <code>n</code>.</p>\n</blockquote>\n<p>Your function does not meet the criteria <code>sort.Search()</code> expects. Your function is not to tell if the element at the specified index is the one you're looking for, but rather to tell:</p>\n<ul>\n<li>if the element at the requested index is <strong>equal to or is greater than</strong> (return <code>true</code>)</li>\n<li>or if the element at the specified index is <strong>less than the searched one</strong> (return <code>false</code>).</li>\n</ul>\n<p>(A binary search could not be carried out if you would only tell when they are equal but not when they are greater or less.)</p>\n<p>So simply use <code>&gt;=</code> comparison instead of <code>==</code>. Correct usage:</p>\n<pre><code>a := []int{2, 2, 3, 4}\ni := sort.Search(len(a), func(pos int) bool { return a[pos] &gt;= 2 })\nfmt.Printf(&quot;%v -&gt; %v \\n&quot;, a, i)\n\nb := []int{1, 2, 2, 3, 4}\nj := sort.Search(len(b), func(pos int) bool { return b[pos] &gt;= 2 })\nfmt.Printf(&quot;%v -&gt; %v \\n&quot;, b, j)\n</code></pre>\n<p>Output (try it on the <kbd><a href=\"http://play.golang.org/p/2Tf_lT03cQ\" rel=\"nofollow noreferrer\">Go Playground</a></kbd>):</p>\n<pre><code>[2 2 3 4] -&gt; 0 \n[1 2 2 3 4] -&gt; 1 \n</code></pre>\n<p>Note: also from the doc:</p>\n<blockquote>\n<p>For instance, given a slice data sorted in ascending order, the call</p>\n<pre><code>Search(len(data), func(i int) bool { return data[i] &gt;= 23 })\n</code></pre>\n<p>returns the smallest index <code>i</code> such that <code>data[i] &gt;= 23</code>. If the caller wants to find whether <code>23</code> is in the slice, it must test <code>data[i] == 23</code> separately.</p>\n</blockquote>\n<h2>Easier alternative: <code>sort.SearchInts()</code></h2>\n<p>If you want to search for an <code>int</code> value in an <code>int</code> slice (<code>[]int</code>), simply use <a href=\"https://golang.org/pkg/sort/#SearchInts\" rel=\"nofollow noreferrer\"><code>sort.SearchInts()</code></a>:</p>\n<pre><code>a := []int{2, 2, 3, 4}\ni := sort.SearchInts(a, 2)\nfmt.Printf(&quot;%v -&gt; %v \\n&quot;, a, i)\n\nb := []int{1, 2, 2, 3, 4}\nj := sort.SearchInts(b, 2)\nfmt.Printf(&quot;%v -&gt; %v \\n&quot;, b, j)\n</code></pre>\n<p>Output (try it on the <kbd><a href=\"http://play.golang.org/p/DMS5nBQ2Wz\" rel=\"nofollow noreferrer\">Go Playground</a></kbd>):</p>\n<pre><code>[2 2 3 4] -&gt; 0 \n[1 2 2 3 4] -&gt; 1 \n</code></pre>\n"}], "owner": {"reputation": 315, "user_id": 5412970, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/73b1e43211e66f1f6fc52e3ac90e1acf?s=128&d=identicon&r=PG&f=1", "display_name": "Andre Minov", "link": "https://stackoverflow.com/users/5412970/andre-minov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1448950725, "creation_date": 1448890349, "last_edit_date": 1448892346, "question_id": 33999844, "link": "https://stackoverflow.com/questions/33999844/go-binary-search-error", "title": "Go binary search error", "body": "<p>Suppose you have two use cases:</p>\n\n<pre><code>a := [] int {2, 2, 3, 4}\ni := sort.Search(len(a), func(pos int) bool { return a[pos] == 2})\nfmt.Printf(\"%v -&gt; %v \\n\", a, i)\n\nb := [] int {1, 2, 2, 3, 4}\nj := sort.Search(len(b), func(pos int) bool { return b[pos] == 2})\nfmt.Printf(\"%v -&gt; %v \\n\", b, j)\n</code></pre>\n\n<p>Answer for those are:</p>\n\n<pre><code>[2 2 3 4] -&gt; 4\n[1 2 2 3 4] -&gt; 1\n</code></pre>\n\n<p>I suppose it must be <code>1</code> in both cases, no? Does anyone knows why?</p>\n"}, {"tags": ["sql", "go"], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 5412970, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/73b1e43211e66f1f6fc52e3ac90e1acf?s=128&d=identicon&r=PG&f=1", "display_name": "Andre Minov", "link": "https://stackoverflow.com/users/5412970/andre-minov"}, "edited": false, "score": 0, "creation_date": 1448888101, "post_id": 33997785, "comment_id": 55753709, "body": "Support I get connection pool in some func by calling sql.Open - how should I store it inside my application."}, {"owner": {"reputation": 315, "user_id": 5412970, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/73b1e43211e66f1f6fc52e3ac90e1acf?s=128&d=identicon&r=PG&f=1", "display_name": "Andre Minov", "link": "https://stackoverflow.com/users/5412970/andre-minov"}, "edited": false, "score": 0, "creation_date": 1448888167, "post_id": 33997785, "comment_id": 55753755, "body": "What is the common approach here? I&#39;m not asking about ways to persists data - but a way yo store reference to connection pool in application."}, {"owner": {"reputation": 315, "user_id": 5412970, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/73b1e43211e66f1f6fc52e3ac90e1acf?s=128&d=identicon&r=PG&f=1", "display_name": "Andre Minov", "link": "https://stackoverflow.com/users/5412970/andre-minov"}, "edited": false, "score": 0, "creation_date": 1448888204, "post_id": 33997785, "comment_id": 55753786, "body": "Because creation connection pool for every select isn&#39;t correct solution"}, {"owner": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "edited": false, "score": 0, "creation_date": 1448907135, "post_id": 33997785, "comment_id": 55766049, "body": "Since the DB returned is concurrent safe why do you suggest a mutex?"}, {"owner": {"reputation": 7127, "user_id": 247002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1f494e0363428b11d080c35ec3d199ff?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/247002/mark"}, "reply_to_user": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "edited": false, "score": 0, "creation_date": 1448911652, "post_id": 33997785, "comment_id": 55768563, "body": "@saarrrr The idea behind the mutex was that another thread might close the connection and there could be a race condition when I try to access the <code>db</code> variable. Am I wrong in this case?"}, {"owner": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "edited": false, "score": 0, "creation_date": 1448912781, "post_id": 33997785, "comment_id": 55769217, "body": "@Mark From the docs, &quot;The returned DB is safe for concurrent use by multiple goroutines and maintains its own pool of idle connections. Thus, the Open function should be called just once. It is rarely necessary to close a DB.&quot;  Perhaps we should just say it is a bad idea to close the DB at all, just let the connection pool do its thing and worry about the transactions, not the connection.  More importantly, db.Close() closes the database, not the connection.  <a href=\"https://golang.org/pkg/database/sql/#Open\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/#Open</a>"}, {"owner": {"reputation": 315, "user_id": 5412970, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/73b1e43211e66f1f6fc52e3ac90e1acf?s=128&d=identicon&r=PG&f=1", "display_name": "Andre Minov", "link": "https://stackoverflow.com/users/5412970/andre-minov"}, "edited": false, "score": 0, "creation_date": 1448919472, "post_id": 33997785, "comment_id": 55772852, "body": "@Mark I saw that using sync.Once maybe solve this thing better.I guess closing DB will close connection pool, but not connections (Is there are documentation saying that closing connection is must?)"}, {"owner": {"reputation": 7127, "user_id": 247002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1f494e0363428b11d080c35ec3d199ff?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/247002/mark"}, "reply_to_user": {"reputation": 315, "user_id": 5412970, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/73b1e43211e66f1f6fc52e3ac90e1acf?s=128&d=identicon&r=PG&f=1", "display_name": "Andre Minov", "link": "https://stackoverflow.com/users/5412970/andre-minov"}, "edited": false, "score": 0, "creation_date": 1458487268, "post_id": 33997785, "comment_id": 59871667, "body": "@AndreMinov as I mentioned you could add a <code>defer GetDB().close()</code> function in your <code>main</code> function. It will close the connection if your program ends The driver manages the connection pool. Do you have any further question or anything else I should update in my question?"}, {"owner": {"reputation": 315, "user_id": 5412970, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/73b1e43211e66f1f6fc52e3ac90e1acf?s=128&d=identicon&r=PG&f=1", "display_name": "Andre Minov", "link": "https://stackoverflow.com/users/5412970/andre-minov"}, "edited": false, "score": 0, "creation_date": 1458584870, "post_id": 33997785, "comment_id": 59916180, "body": "@Mark thank you for answer! Everything is clear now."}], "tags": [], "owner": {"reputation": 7127, "user_id": 247002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1f494e0363428b11d080c35ec3d199ff?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/247002/mark"}, "is_accepted": false, "score": 13, "last_activity_date": 1448965765, "last_edit_date": 1448965765, "creation_date": 1448883662, "answer_id": 33997785, "question_id": 33995668, "link": "https://stackoverflow.com/questions/33995668/connection-pooling-with-sql-driver-in-go/33997785#33997785", "title": "Connection pooling with SQL driver in Go", "body": "<p>There is nothing wrong about using a Singleton pattern here too. </p>\n\n<p>I would use something like this:</p>\n\n<pre><code>var db *sql.DB = nil\n\nfunc GetDB() (*sql.DB, error) {\n    if db == nil {\n        conn := fmt.Sprintf(\"host=%s user=%s password=%s dbname=%s sslmode=require\",\n            DB_HOST, DB_USER, DB_PASSWORD, DB_NAME)\n        log.Println(\"Creating a new connection: %v\", conn)\n\n        d, err := sql.Open(\"postgres\", conn)\n        if err != nil {\n            return nil, err\n        }\n        db = d\n    }\n\n    return db, nil\n}\n</code></pre>\n\n<p>With this exported function you can receive a connection from all other packages. </p>\n\n<p><em>Update of the answer according to the comments (thanks @all for the information)!:</em></p>\n\n<blockquote>\n  <p>The returned DB is safe for concurrent use by multiple goroutines and\n  maintains its own pool of idle connections. Thus, the Open function\n  should be called just once. It is rarely necessary to close a DB.<a href=\"https://golang.org/pkg/database/sql/#Open\" rel=\"noreferrer\">\u00b9</a></p>\n  \n  <p>It is rare to Close a DB, as the DB handle is meant to be long-lived\n  and shared between many goroutines.<a href=\"https://golang.org/pkg/database/sql/#DB.Close\" rel=\"noreferrer\">\u00b2</a> </p>\n</blockquote>\n\n<p>I would say that there is no forcing reason to call close on the database connection. I found no other statements. Despite this I would use a <code>defer GetDB().close()</code> in the <code>main</code> function - just for the completeness of the code. </p>\n\n<p>Another thing I would like to note is that the connection should be verified by a <code>db.Ping()</code> otherwise the connection could be established but the database may not exist.</p>\n\n<p>With this new information I wouldn't bother using some mutexes to ensure that the database is established. I would create a new <code>DBInit()</code> and run it inside the <code>init()</code> function of the main package. </p>\n"}], "owner": {"reputation": 315, "user_id": 5412970, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/73b1e43211e66f1f6fc52e3ac90e1acf?s=128&d=identicon&r=PG&f=1", "display_name": "Andre Minov", "link": "https://stackoverflow.com/users/5412970/andre-minov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3626, "favorite_count": 4, "answer_count": 1, "score": 10, "last_activity_date": 1448965765, "creation_date": 1448877084, "last_edit_date": 1448901563, "question_id": 33995668, "link": "https://stackoverflow.com/questions/33995668/connection-pooling-with-sql-driver-in-go", "title": "Connection pooling with SQL driver in Go", "body": "<p>What is the best practice for storing a connection to a database in Go language?</p>\n\n<p>In Java for example you can use singletons, some IoC containers like Spring.\nWhat is the best practice in it's lifecycle?\nHow to release it after application close?</p>\n"}, {"tags": ["go", "parameter-passing", "copy-on-write"], "comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1448877454, "post_id": 33995634, "comment_id": 55747232, "body": "<a href=\"http://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a>"}, {"owner": {"reputation": 869, "user_id": 2620356, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d70e7de8674154dc8b6a5dde5d5c75?s=128&d=identicon&r=PG", "display_name": "kingSlayer", "link": "https://stackoverflow.com/users/2620356/kingslayer"}, "edited": false, "score": 0, "creation_date": 1448877846, "post_id": 33995634, "comment_id": 55747458, "body": "You can also read this <a href=\"http://stackoverflow.com/questions/1863460/whats-the-point-of-having-pointers-in-go\" title=\"whats the point of having pointers in go\">stackoverflow.com/questions/1863460/&hellip;</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1448878698, "post_id": 33995634, "comment_id": 55747997, "body": "1. There is no copy on write in Go. 2. Everything is passes by a copy in Go always and ever. 3. Some types (e.g. slices and maps) contain hidden pointers so they <i>seem</i> to be passed by reference, but they are not. 4. If passing excludePattern really is the performance bottleneck in your code I&#39;ll pay you a beer. 5. Passing a slice by pointer is <i>completely</i> pointless (given the small size of a slice) unless you want to modify it from inside your function."}, {"owner": {"reputation": 467, "user_id": 9817778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vyGWg.jpg?s=128&g=1", "display_name": "Time Killer", "link": "https://stackoverflow.com/users/9817778/time-killer"}, "edited": false, "score": 0, "creation_date": 1568990105, "post_id": 33995634, "comment_id": 102463249, "body": "Copy-on-write is a concept in reference delivery used languages such as PHP. In the world of pointers, there are no such words."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 15, "last_activity_date": 1448878690, "last_edit_date": 1448878690, "creation_date": 1448877428, "answer_id": 33995762, "question_id": 33995634, "link": "https://stackoverflow.com/questions/33995634/are-golang-function-parameter-passed-as-copy-on-write/33995762#33995762", "title": "Are Golang function parameter passed as copy-on-write?", "body": "<p>Judging from the name of your function, performance can't be that critical to even consider moving parameters to global variables just to save time/space required to pass them as parameters (IO operations like checking files are much-much slower than calling functions and passing values to them).</p>\n\n<p>Slices in Go are just small descriptors, something like a struct with a pointer to a backing array and 2 <code>int</code>s, a length and capacity. No matter how big the backing array is, passing slices are always efficient and you shouldn't even consider passing a pointer to them, unless you want to modify the slice header of course.</p>\n\n<p>Parameters in Go are always passed by value, and a copy of the value being passed is made. If you pass a pointer, then the pointer value will be copied and passed. When a slice is passed, the slice value (which is a small descriptor) will be copied and passed - which will point to the same backing array (which will not be copied).</p>\n\n<p>Also if you need to access the slice multiple times in the function, a parameter is usually an extra gain as compilers can make further optimization / caching, while if it is a global variable, more care has to be taken.</p>\n\n<p>More about slices and their internals: <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"noreferrer\">Go Slices: usage and internals</a></p>\n\n<p>And if you want exact numbers on performance, benchmark!</p>\n\n<p>Here comes a little benchmarking code which shows no difference between the 2 solutions (passing slice as argument or accessing a global slice). Save it into a file like <code>slices_test.go</code> and run it with <code>go test -bench .</code></p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n)\n\nvar gslice = make([]string, 1000)\n\nfunc global(s string) {\n    for i := 0; i &lt; 100; i++ { // Cycle to access slice may times\n        _ = s\n        _ = gslice // Access global-slice\n    }\n}\n\nfunc param(s string, ss []string) {\n    for i := 0; i &lt; 100; i++ { // Cycle to access slice may times\n        _ = s\n        _ = ss // Access parameter-slice\n    }\n}\n\nfunc BenchmarkParameter(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        param(\"hi\", gslice)\n    }\n}\n\nfunc BenchmarkGlobal(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        global(\"hi\")\n    }\n}\n</code></pre>\n\n<p>Example output:</p>\n\n<pre><code>testing: warning: no tests to run\nPASS\nBenchmarkParameter-2    30000000                55.4 ns/op\nBenchmarkGlobal-2       30000000                55.1 ns/op\nok      _/V_/workspace/IczaGo/src/play  3.569s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2231, "user_id": 9805867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g1ebb.png?s=128&g=1", "display_name": "IvanD", "link": "https://stackoverflow.com/users/9805867/ivand"}, "is_accepted": false, "score": 1, "last_activity_date": 1605412959, "creation_date": 1605412959, "answer_id": 64841088, "question_id": 33995634, "link": "https://stackoverflow.com/questions/33995634/are-golang-function-parameter-passed-as-copy-on-write/64841088#64841088", "title": "Are Golang function parameter passed as copy-on-write?", "body": "<p>Piggybacking on @icza's excellent answer, there is another way to pass a slice as parameter: a pointer to a slice.</p>\n<p>When you need to modify the underlying slice, the global variable slice works, but passing it as a parameter <strong>does not work</strong>, you are effectively working with a copy. To mitigate that, one can actually pass the slice as a pointer.</p>\n<p>Interesting enough, it's actually faster than accessing a global variable:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;testing&quot;\n)\n\nvar gslice = make([]string, 1000000)\n\nfunc global(s string) {\n    for i := 0; i &lt; 100; i++ { // Cycle to access slice may times\n        _ = s\n        _ = gslice // Access global-slice\n    }\n}\n\nfunc param(s string, ss []string) {\n    for i := 0; i &lt; 100; i++ { // Cycle to access slice may times\n        _ = s\n        _ = ss // Access parameter-slice\n    }\n}\n\nfunc paramPointer(s string, ss *[]string) {\n    for i := 0; i &lt; 100; i++ { // Cycle to access slice may times\n        _ = s\n        _ = ss // Access parameter-slice\n    }\n}\n\nfunc BenchmarkParameter(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        param(&quot;hi&quot;, gslice)\n    }\n}\n\nfunc BenchmarkParameterPointer(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        paramPointer(&quot;hi&quot;, &amp;gslice)\n    }\n}\n\nfunc BenchmarkGlobal(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        global(&quot;hi&quot;)\n    }\n}\n</code></pre>\n<p>Results:</p>\n<pre><code>goos: darwin\ngoarch: amd64\npkg: untitled\nBenchmarkParameter-8            24437403                48.2 ns/op\nBenchmarkParameterPointer-8     27483115                40.3 ns/op\nBenchmarkGlobal-8               25631470                46.0 ns/op\n</code></pre>\n"}], "owner": {"reputation": 78861, "user_id": 561309, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/6d833d9f0ffa2265a01359ccecd26d54?s=128&d=identicon&r=PG&f=1", "display_name": "laurent", "link": "https://stackoverflow.com/users/561309/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7604, "favorite_count": 4, "accepted_answer_id": 33995762, "answer_count": 2, "score": 15, "last_activity_date": 1605412959, "creation_date": 1448876985, "question_id": 33995634, "link": "https://stackoverflow.com/questions/33995634/are-golang-function-parameter-passed-as-copy-on-write", "title": "Are Golang function parameter passed as copy-on-write?", "body": "<p>I've got the following function:</p>\n\n<pre><code>func checkFiles(path string, excludedPatterns []string) {\n    // ...\n}\n</code></pre>\n\n<p>I'm wondering, since <code>excludedPatterns</code> never changes, should I optimize it by making the var global (and not passing it to the function every time), or does Golang already handle this by passing them as copy-on-write?</p>\n\n<p>Edit: I guess I could pass the slice as a pointer, but I'm still wondering about the copy-on-write behavior (if it exists) and whether, in general, I should worry about passing by value or by pointer.</p>\n"}, {"tags": ["random", "go", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1448874866, "post_id": 33994677, "comment_id": 55745578, "body": "Related, you might find this question and answer useful: <a href=\"http://stackoverflow.com/a/31832326/1705598\">How to generate a random string of a fixed length in golang?</a> It contains your question as a sub-task, that is, choosing random letters from a slice of runes or characters. It might give you some good tips about the &quot;random&quot; world of Go, what&#39;s going on in the background and efficiency of different solutions."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 3, "creation_date": 1448878824, "post_id": 33994677, "comment_id": 55748076, "body": "The answer to your question is in math/rand package documentation: <a href=\"https://golang.org/pkg/math/rand/\" rel=\"nofollow noreferrer\">golang.org/pkg/math/rand</a> - check the first code example ;)"}, {"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 2, "creation_date": 1448880334, "post_id": 33994677, "comment_id": 55749081, "body": "Tips\uff1agofmt your code"}], "answers": [{"comments": [{"owner": {"reputation": 104, "user_id": 3208881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ddb895552f723a2459c311987008d52?s=128&d=identicon&r=PG", "display_name": "endless", "link": "https://stackoverflow.com/users/3208881/endless"}, "edited": false, "score": 4, "creation_date": 1563761719, "post_id": 33994787, "comment_id": 100792551, "body": "This is not good as <code>rand.Intn(len(reasons))</code>. Just use a <code>%</code> does not have equal probability on each value of [0, len(reasons))."}, {"owner": {"reputation": 73, "user_id": 1917605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/091b9fee98134b8b916b11d96c5eb323?s=128&d=identicon&r=PG", "display_name": "cdnbcguy", "link": "https://stackoverflow.com/users/1917605/cdnbcguy"}, "edited": false, "score": 0, "creation_date": 1588361886, "post_id": 33994787, "comment_id": 108875412, "body": "True! Modular Bias!"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 19, "last_activity_date": 1448874187, "creation_date": 1448874187, "answer_id": 33994787, "question_id": 33994677, "link": "https://stackoverflow.com/questions/33994677/pick-a-random-value-from-a-go-slice/33994787#33994787", "title": "Pick a random value from a Go Slice", "body": "<p>Just pick a random integer mod slice length:</p>\n\n<pre><code>rand.Seed(time.Now().Unix())\nreasons := []string{\n    \"Locked out\",\n    \"Pipes broke\",\n    \"Food poisoning\",\n    \"Not feeling well\",\n}\nn := rand.Int() % len(reasons)\nfmt.Print(\"Gonna work from home...\", reasons[n])\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/fEHElLJrEZ\" rel=\"noreferrer\">http://play.golang.org/p/fEHElLJrEZ</a>. (Note the commend about <code>rand.Seed</code>.)</p>\n"}, {"comments": [{"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 8, "creation_date": 1482581886, "post_id": 33994791, "comment_id": 69829632, "body": "For the record, rand.Seed... is also needed."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 104, "last_activity_date": 1488911412, "last_edit_date": 1488911412, "creation_date": 1448874194, "answer_id": 33994791, "question_id": 33994677, "link": "https://stackoverflow.com/questions/33994677/pick-a-random-value-from-a-go-slice/33994791#33994791", "title": "Pick a random value from a Go Slice", "body": "<p>Use function <a href=\"https://golang.org/pkg/math/rand/#Intn\" rel=\"noreferrer\"><code>Intn</code></a> from <code>rand</code> package to select a random index.</p>\n\n<pre><code>import (\n  \"math/rand\"\n  \"time\"\n)\n\n// ...\n\nrand.Seed(time.Now().Unix()) // initialize global pseudo random generator\nmessage := fmt.Sprint(\"Gonna work from home...\", reasons[rand.Intn(len(reasons))])\n</code></pre>\n\n<p>Other solution is to use <code>Rand</code> object.</p>\n\n<pre><code>s := rand.NewSource(time.Now().Unix())\nr := rand.New(s) // initialize local pseudorandom generator \nr.Intn(len(reasons))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566991747, "post_id": 57679125, "comment_id": 101826972, "body": "&quot;This [calling <code>Seed</code>] was taking \u2026 to execute on its own&quot;. You only seed a random number generator <b>once</b>. As a one time start-up call the time it takes should be irrelevant."}, {"owner": {"reputation": 7, "user_id": 5530162, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-yJBz4HXQ8VM/AAAAAAAAAAI/AAAAAAAAJvM/HpK422pg_ng/photo.jpg?sz=128", "display_name": "Tyler Tyssedal", "link": "https://stackoverflow.com/users/5530162/tyler-tyssedal"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1567003444, "post_id": 57679125, "comment_id": 101834085, "body": "What do you mean? If you&#39;re not seeding a random number on each randomOpt() call, you&#39;re going to get the same result from randomOpt(). The number needs to be randomly generated on each call.  My solution&#39;s results:  <code>{option3} 697ns {option2} 50.316&#181;s {option2} 54.371&#181;s {option3} 57.262&#181;s {option2} 60.501&#181;s {option3} 63.108&#181;s {option3} 66.74&#181;s {option1} 69.45&#181;s {option1} 73.442&#181;s</code>"}, {"owner": {"reputation": 7, "user_id": 5530162, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-yJBz4HXQ8VM/AAAAAAAAAAI/AAAAAAAAJvM/HpK422pg_ng/photo.jpg?sz=128", "display_name": "Tyler Tyssedal", "link": "https://stackoverflow.com/users/5530162/tyler-tyssedal"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1567003552, "post_id": 57679125, "comment_id": 101834143, "body": "The other solution: <code>{option1} 9.982&#181;s {option1} 62.222&#181;s {option1} 75&#181;s {option1} 86.793&#181;s {option1} 98.493&#181;s {option1} 110.601&#181;s {option1} 122.225&#181;s {option1} 133.76&#181;s {option1} 145.352&#181;s</code> which was <code>func randomOpt() string { \trand.Seed(start.Unix()) \treturn opts[rand.Intn(len(opts))] } </code>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1567004583, "post_id": 57679125, "comment_id": 101834727, "body": "&quot;If you&#39;re not seeding a random number on each randomOpt() call&quot; ... That&#39;s not how seeding works. You seed a random number generator <b>once</b> and then you call that same generator repeatedly getting different values."}, {"owner": {"reputation": 7, "user_id": 5530162, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-yJBz4HXQ8VM/AAAAAAAAAAI/AAAAAAAAJvM/HpK422pg_ng/photo.jpg?sz=128", "display_name": "Tyler Tyssedal", "link": "https://stackoverflow.com/users/5530162/tyler-tyssedal"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1567007825, "post_id": 57679125, "comment_id": 101836625, "body": "Ah got it. Putting the seed inside the Main() and not calling seed on each request was incorrect of me to label as the cause of the slowness. Fixing the seed, that solution is still slower than the one I provided: <code>{option2} 10.01&#181;s {option1} 68.63&#181;s {option3} 72.933&#181;s {option3} 75.834&#181;s {option1} 97.274&#181;s {option3} 100.264&#181;s {option2} 102.983&#181;s {option3} 105.97&#181;s {option2} 108.537&#181;s</code>"}, {"owner": {"reputation": 7, "user_id": 5530162, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-yJBz4HXQ8VM/AAAAAAAAAAI/AAAAAAAAJvM/HpK422pg_ng/photo.jpg?sz=128", "display_name": "Tyler Tyssedal", "link": "https://stackoverflow.com/users/5530162/tyler-tyssedal"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1567008600, "post_id": 57679125, "comment_id": 101837021, "body": "I am going to update my post to reflect this, offering both full options. After start-up, the performance isn&#39;t all that different, but I want my post to reflect it accurately."}], "tags": [], "owner": {"reputation": 7, "user_id": 5530162, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-yJBz4HXQ8VM/AAAAAAAAAAI/AAAAAAAAJvM/HpK422pg_ng/photo.jpg?sz=128", "display_name": "Tyler Tyssedal", "link": "https://stackoverflow.com/users/5530162/tyler-tyssedal"}, "is_accepted": false, "score": -2, "last_activity_date": 1567009033, "last_edit_date": 1567009033, "creation_date": 1566924361, "answer_id": 57679125, "question_id": 33994677, "link": "https://stackoverflow.com/questions/33994677/pick-a-random-value-from-a-go-slice/57679125#57679125", "title": "Pick a random value from a Go Slice", "body": "<p>Since this still shows up in Google's top results for Golang random string generation, I wanted to share what I have been working with.</p>\n\n<p>Here is the solution I am using:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"strings\"\n  \"time\"\n)\n\nvar (\n  opts  = strings.Split(\"option1,option2,option3\", \",\")\n  start = time.Now()\n)\n\nfunc main() {\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n}\n\nfunc getRandomOpt() string {\n  len := len(opts)\n  n := uint32(0)\n  if len &gt; 0 {\n    n = getRandomUint32() % uint32(len)\n  }\n  return opts[n]\n}\n\nfunc getRandomUint32() uint32 {\n  x := time.Now().UnixNano()\n  return uint32((x &gt;&gt; 32) ^ x)\n}\n</code></pre>\n\n<p>And results: </p>\n\n<pre><code>option2 665ns\noption1 41.406\u00b5s\noption1 44.817\u00b5s\noption3 47.329\u00b5s\noption1 49.725\u00b5s\noption3 52\u00b5s\noption2 54.393\u00b5s\noption2 56.798\u00b5s\noption1 59.098\u00b5s\n</code></pre>\n\n<p>Source wise, I copied getRandomUint32() from fastrand: <a href=\"https://github.com/valyala/fastrand\" rel=\"nofollow noreferrer\">https://github.com/valyala/fastrand</a></p>\n\n<p>And the solution proposed above. Performance isn't all that different, but I wanted to share results. </p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"math/rand\"\n  \"strings\"\n  \"time\"\n)\n\nvar (\n  opts  = strings.Split(\"option1,option2,option3\", \",\")\n  start = time.Now()\n)\n\nfunc main() {\n  rand.Seed(start.Unix())\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n  fmt.Println(getRandomOpt(), time.Since(start))\n}\n\nfunc getRandomOpt() string {\n  return opts[rand.Intn(len(opts))]\n}\n</code></pre>\n\n<p>And results: </p>\n\n<pre><code>option3 11.865\u00b5s\noption2 48.415\u00b5s\noption3 52.809\u00b5s\noption1 55.536\u00b5s\noption3 58.191\u00b5s\noption3 60.793\u00b5s\noption1 63.391\u00b5s\noption2 65.982\u00b5s\noption2 68.601\u00b5s\n</code></pre>\n\n<p>These results were only run a few times locally and I grabbed what appeared to be the median result. There is certainly more work to be done in terms of iterations and whatnot, but I just wanted to share what I have.</p>\n"}], "owner": {"reputation": 5836, "user_id": 1813039, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d3c8f57043ddb2a46f4ffd3ac4121a9b?s=128&d=identicon&r=PG", "display_name": "Amistad", "link": "https://stackoverflow.com/users/1813039/amistad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49508, "favorite_count": 9, "accepted_answer_id": 33994791, "answer_count": 3, "score": 56, "last_activity_date": 1567009033, "creation_date": 1448873736, "last_edit_date": 1542239133, "question_id": 33994677, "link": "https://stackoverflow.com/questions/33994677/pick-a-random-value-from-a-go-slice", "title": "Pick a random value from a Go Slice", "body": "<p><strong>Situation:</strong></p>\n\n<p>I've a slice of values and need to pick up a randomly chosen value from it. Then I want to concatenate it with a fixed string. This is my code so far:</p>\n\n<pre><code>func main() {\n//create the reasons slice and append reasons to it\nreasons := make([]string, 0)\nreasons = append(reasons,\n    \"Locked out\",\n    \"Pipes broke\",\n    \"Food poisoning\",\n    \"Not feeling well\")\n\nmessage := fmt.Sprint(\"Gonna work from home...\", pick a random reason )\n}\n</code></pre>\n\n<p><strong>Question:</strong></p>\n\n<p>Is there a built-in function, which can help me by doing the \"<em>pick a random reason</em>\" part?</p>\n"}, {"tags": ["file", "templates", "go", "upload"], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 3, "last_activity_date": 1448876835, "last_edit_date": 1495540447, "creation_date": 1448876835, "answer_id": 33995583, "question_id": 33994374, "link": "https://stackoverflow.com/questions/33994374/golang-template-upload-file-how-to-validate-the-file-is-empty/33995583#33995583", "title": "golang template upload file how to validate the file is empty", "body": "<p>I don't think it's possible to know the size of the file until you read it. See <a href=\"https://stackoverflow.com/a/280702/1892060\">this answer</a>:</p>\n\n<blockquote>\n  <p>To read the file content is the only reliable way. Having said that, if the content-lenght is present and is too big, to close the connection would be a reasonable thing to do.</p>\n</blockquote>\n\n<p>So I guess you'll have to read a part of the content into a small temporary buffer and look at the size.</p>\n\n<p>If you want to validate, whether the user even sent a file, you can check against <a href=\"https://golang.org/pkg/net/http/#ErrMissingFile\" rel=\"nofollow noreferrer\"><code>http.ErrMissingFile</code></a>:</p>\n\n<pre><code>    file, header, err := r.FormFile(\"f\")\n    switch err {\n    case nil:\n        // do nothing\n    case http.ErrMissingFile:\n        log.Println(\"no file\")\n    default:\n        log.Println(err)\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 1, "last_activity_date": 1467598994, "creation_date": 1467598994, "answer_id": 38176141, "question_id": 33994374, "link": "https://stackoverflow.com/questions/33994374/golang-template-upload-file-how-to-validate-the-file-is-empty/38176141#38176141", "title": "golang template upload file how to validate the file is empty", "body": "<p>No, you can't find the length of a file without reading it. (You can try to use Content-Length header, but you have to know that it can be modified and thus not reliable).</p>\n\n<p>Here is how you can get the file size:</p>\n\n<pre><code>file, handler, err := r.FormFile(\"receipt\") // r is *http.Request\nvar buff bytes.Buffer\nfileSize, err := buff.ReadFrom(file)\nfmt.Println(fileSize) // this will return you a file size.\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 141, "user_id": 5319318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3855628272df9b752f25fc236be60add?s=128&d=identicon&r=PG&f=1", "display_name": "secenv", "link": "https://stackoverflow.com/users/5319318/secenv"}, "is_accepted": false, "score": 0, "last_activity_date": 1524383576, "creation_date": 1524383576, "answer_id": 49963742, "question_id": 33994374, "link": "https://stackoverflow.com/questions/33994374/golang-template-upload-file-how-to-validate-the-file-is-empty/49963742#49963742", "title": "golang template upload file how to validate the file is empty", "body": "<p>You can read the file size from the header variable (in your example), which is a <a href=\"https://golang.org/pkg/mime/multipart/#FileHeader\" rel=\"nofollow noreferrer\">FileHeader type</a>, returned by <a href=\"https://golang.org/pkg/net/http/#Request.FormFile\" rel=\"nofollow noreferrer\">FormValue</a>, and contains the size of the file:</p>\n\n<pre><code>file, header, err := req.FormFile(\"receipt\")\nif err != nil || header.Size == 0 {\n    // file was not sent\n} else {\n    // process file\n}\n</code></pre>\n\n<p>Though I'm not sure how reliable is this data in terms of security (I guess an attacker could fake the headers sent to the server maliciously).</p>\n"}], "owner": {"reputation": 136, "user_id": 2632893, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PHgQM.png?s=128&g=1", "display_name": "Johnson", "link": "https://stackoverflow.com/users/2632893/johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2091, "favorite_count": 0, "accepted_answer_id": 33995583, "answer_count": 3, "score": 2, "last_activity_date": 1524383576, "creation_date": 1448872546, "question_id": 33994374, "link": "https://stackoverflow.com/questions/33994374/golang-template-upload-file-how-to-validate-the-file-is-empty", "title": "golang template upload file how to validate the file is empty", "body": "<p>I am a beginner with go-lang. I met a problem when I uploaded a file with html template. I google a lot but not solved.</p>\n\n<pre><code>&lt;input  type=\"file\" name=\"myfile\"/&gt;\n</code></pre>\n\n<p>Use func (*Request) FormFile get the file.</p>\n\n<pre><code>file, header, err := req.FormFile(\"receipt\")\n</code></pre>\n\n<p>But how to validate the file whether it is empty from server side? I know I can read request.Body to find whether myfile is empty.  </p>\n\n<p>Is there a better way to implement it?</p>\n"}, {"tags": ["github", "go", "oauth", "aws-code-deploy"], "comments": [{"owner": {"reputation": 1183, "user_id": 2644513, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/yNtHc.jpg?s=128&g=1", "display_name": "Itachi", "link": "https://stackoverflow.com/users/2644513/itachi"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1448863585, "post_id": 33992327, "comment_id": 55740453, "body": "@SalvadorDali Colleagues in the project facing the same issue."}, {"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448870327, "post_id": 33992327, "comment_id": 55743259, "body": "Is it a  private repo?"}, {"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448879587, "post_id": 33992327, "comment_id": 55748593, "body": "@ltachi, are you using <code>go get xxx</code> ? Did you try this?<a href=\"https://gist.github.com/shurcooL/6927554\" rel=\"nofollow noreferrer\">gist.github.com/shurcooL/6927554</a>"}, {"owner": {"reputation": 1183, "user_id": 2644513, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/yNtHc.jpg?s=128&g=1", "display_name": "Itachi", "link": "https://stackoverflow.com/users/2644513/itachi"}, "reply_to_user": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448880089, "post_id": 33992327, "comment_id": 55748928, "body": "@holys This involves creating SSH key with the instance. So if instance goes down and comes up with new ip another SSH key is required. If it is auth token i can write a start up script to install it right. Also -u doesn&#39;t seem to work."}, {"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448880195, "post_id": 33992327, "comment_id": 55749002, "body": "@ltachi  Does this do any help for you \uff1f<a href=\"https://github.com/golang/go/issues/10791\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/10791</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 1, "last_activity_date": 1450321541, "creation_date": 1450321541, "answer_id": 34325951, "question_id": 33992327, "link": "https://stackoverflow.com/questions/33992327/github-oauth-token-for-golang/34325951#34325951", "title": "Github Oauth token for Golang", "body": "<p>There are two solutions to this problem:</p>\n\n<ol>\n<li>Don't deploy code. Go is a statically compiled programming language. There's no need to have Go source code on the server you intend to run the Go program on.</li>\n<li><p>Don't use <code>go get</code> to get the code for your private GitHub repo. As long as the code ends up in the correct subdirectory (<code>$GOPATH/src/github.com/org/project</code>), Go doesn't care how it got there. Simply add to your build script a few commands:</p>\n\n<pre><code>DIR=$GOPATH/src/github.com/org/project\nTOKEN=yourtoken\n\nif [ -d $DIR ]; then\n  cd $DIR\n  git reset --hard  \n  git clean -dfx\nelse\n  mkdir -p $DIR\n  cd $DIR\n  git init  \nfi\n\ngit pull https://$TOKEN@github.com/org/project.git\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 1183, "user_id": 2644513, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/yNtHc.jpg?s=128&g=1", "display_name": "Itachi", "link": "https://stackoverflow.com/users/2644513/itachi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1130, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1450321541, "creation_date": 1448863365, "last_edit_date": 1448863741, "question_id": 33992327, "link": "https://stackoverflow.com/questions/33992327/github-oauth-token-for-golang", "title": "Github Oauth token for Golang", "body": "<p>We use AWS code deploy to deploy the Github projects to Ec2 instances every time it deploys it asks for Github username and password to download the repository. Found following ways to solve this</p>\n\n<ol>\n<li>Supply Uname &amp; Pwd (not preferred)</li>\n<li>Setup SSH Key (not possible as the instance keeps changing ip)</li>\n<li>Oauth token </li>\n</ol>\n\n<p>Setting up Oauth for PHP repository was done by adding it in composer auth.json <em>.composer/auth.json</em>. </p>\n\n<pre><code>{\n    \"http-basic\": {},\n    \"github-oauth\": {\"github.com\": \"xyzasasasauhu\"}\n}\n</code></pre>\n\n<p>But couldn't find a way to do this for Golang project. Typically we want to achieve <em>go get <a href=\"https://github.com/username/reponame\">https://github.com/username/reponame</a></em> without supplying the credentials explicitly. </p>\n"}, {"tags": ["html", "css", "go"], "comments": [{"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448847174, "post_id": 33990145, "comment_id": 55736233, "body": "Please list your folder with <code>tree</code> command."}, {"owner": {"reputation": 507, "user_id": 1956016, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/21ecdf91b9eaafd76a95cd6dc1310821?s=128&d=identicon&r=PG", "display_name": "j5juice", "link": "https://stackoverflow.com/users/1956016/j5juice"}, "reply_to_user": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448848352, "post_id": 33990145, "comment_id": 55736481, "body": "Added that to original post"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 5, "creation_date": 1448849082, "post_id": 33990145, "comment_id": 55736650, "body": "As a tip: replace your <code>serveResource</code> function with <a href=\"https://golang.org/pkg/net/http/#ServeFile\" rel=\"nofollow noreferrer\"><code>http.ServeFile</code></a> and/or look at the docs for <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\"><code>http.FileServer</code></a> - which will do what you want to."}, {"owner": {"reputation": 507, "user_id": 1956016, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/21ecdf91b9eaafd76a95cd6dc1310821?s=128&d=identicon&r=PG", "display_name": "j5juice", "link": "https://stackoverflow.com/users/1956016/j5juice"}, "edited": false, "score": 0, "creation_date": 1448850123, "post_id": 33990145, "comment_id": 55736886, "body": "Thank you that worked much better!"}, {"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448870193, "post_id": 33990145, "comment_id": 55743185, "body": "Is this problem solved?"}, {"owner": {"reputation": 507, "user_id": 1956016, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/21ecdf91b9eaafd76a95cd6dc1310821?s=128&d=identicon&r=PG", "display_name": "j5juice", "link": "https://stackoverflow.com/users/1956016/j5juice"}, "edited": false, "score": 0, "creation_date": 1448895152, "post_id": 33990145, "comment_id": 55758435, "body": "Yes it is. I will add the answer below."}], "answers": [{"tags": [], "owner": {"reputation": 507, "user_id": 1956016, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/21ecdf91b9eaafd76a95cd6dc1310821?s=128&d=identicon&r=PG", "display_name": "j5juice", "link": "https://stackoverflow.com/users/1956016/j5juice"}, "is_accepted": true, "score": 2, "last_activity_date": 1448895342, "creation_date": 1448895342, "answer_id": 34001430, "question_id": 33990145, "link": "https://stackoverflow.com/questions/33990145/getting-template-to-properly-read-css-file-in-golang/34001430#34001430", "title": "Getting template to properly read CSS file in Golang", "body": "<p>Used the tip above from elithrar and changed my serveResource func to read like this:</p>\n\n<pre><code>func serveResource(w http.ResponseWriter, req *http.Request) {\n    path := \"../../public\" + req.URL.Path\n    http.ServeFile(w, req, path)\n}\n</code></pre>\n\n<p>My issue is now resolved. Thank you!</p>\n"}], "owner": {"reputation": 507, "user_id": 1956016, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/21ecdf91b9eaafd76a95cd6dc1310821?s=128&d=identicon&r=PG", "display_name": "j5juice", "link": "https://stackoverflow.com/users/1956016/j5juice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2530, "favorite_count": 1, "accepted_answer_id": 34001430, "answer_count": 1, "score": 2, "last_activity_date": 1448895342, "creation_date": 1448846425, "last_edit_date": 1448848997, "question_id": 33990145, "link": "https://stackoverflow.com/questions/33990145/getting-template-to-properly-read-css-file-in-golang", "title": "Getting template to properly read CSS file in Golang", "body": "<p>Hello I am having an issue with getting my template to properly display my CSS file. It is reading my imgs correctly, but anything in my CSS file does not get displayed correctly. When I run through with Delve it gets the path correctly so I am unsure what is going on. Here is my code. </p>\n\n<pre><code>package main\n\nimport (\n        \"bufio\"\n        \"log\"\n        \"net/http\"\n        \"os\"\n        \"strings\"\n        \"text/template\"\n)\n\nfunc main() {\n        templates := populateTemplates()\n\n        http.HandleFunc(\"/\", func(w http.ResponseWriter, req *http.Request) {\n                requestedFile := req.URL.Path[1:]\n                template := templates.Lookup(requestedFile + \".html\")\n\n                if template != nil {\n                        template.Execute(w, nil)\n                } else {\n                        w.WriteHeader(404)\n                }\n        })\n\n        http.HandleFunc(\"/img/\", serveResource)\n        http.HandleFunc(\"/css/\", serveResource)\n\n        http.ListenAndServe(\":8080\", nil)\n}\n\nfunc serveResource(w http.ResponseWriter, req *http.Request) {\n        path := \"../../public\" + req.URL.Path\n        var contentType string\n        if strings.HasSuffix(path, \".css\") {\n                contentType = \"text/css\"\n        } else if strings.HasSuffix(path, \".png\") {\n                contentType = \"image/png\"\n        } else {\n                contentType = \"text/plain\"\n        }\n\n        f, err := os.Open(path)\n        if err != nil {\n                w.WriteHeader(404)\n        } else {\n                defer f.Close()\n                w.Header().Add(\"Content Type\", contentType)\n\n                br := bufio.NewReader(f)\n                br.WriteTo(w)\n        }\n}\n\nfunc populateTemplates() *template.Template {\n        result := template.New(\"templates\")\n\n        basePath := \"../../templates\"\n        templateFolder, err := os.Open(basePath)\n        if err != nil {\n                log.Fatal(err)\n        }\n        defer templateFolder.Close()\n\n        templatePathsRaw, _ := templateFolder.Readdir(-1)\n\n        templatePaths := new([]string)\n        for _, pathInfo := range templatePathsRaw {\n                if !pathInfo.IsDir() {\n                        *templatePaths = append(*templatePaths, basePath+\"/\"+pathInfo.Name())\n                }\n        }\n\n        result.ParseFiles(*templatePaths...)\n\n        return result\n}\n</code></pre>\n\n<p>(also on <a href=\"http://pastebin.com/7Vcm5t75\" rel=\"nofollow\">http://pastebin.com/7Vcm5t75</a>)</p>\n\n<p>I have a main folder with bin, pkg, src, public, and templates in it. Then in src is a main folder that houses main.go. Public contains img, css, scripts. Img has my images in it. CSS has my CSS file in it. Then templates has my two html pages in it. Shown in tree form below: </p>\n\n<pre><code>\u251c\u2500\u2500 bin\n\u251c\u2500\u2500 pkg\n\u251c\u2500\u2500 public\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 css\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 img\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 scripts\n\u251c\u2500\u2500 src\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 main\n\u2514\u2500\u2500 templates\n</code></pre>\n\n<p>Any help is greatly appreciated.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448846950, "post_id": 33985208, "comment_id": 55736194, "body": "Where can I find the usage of <code>:0</code> ?"}, {"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448851977, "post_id": 33985208, "comment_id": 55737361, "body": "But I can&#39;t found the document of this usage"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448857302, "post_id": 33985208, "comment_id": 55738622, "body": "The port number is passed to the kernel where the allocation occurs. The handling of port zero in kernels is so mundane that I don&#39;t think it&#39;s documented anywhere."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1448867164, "post_id": 33985208, "comment_id": 55741867, "body": "Thank you! excellent excellent answer. <a href=\"https://github.com/kaihendry/lk/commit/023a060161be186ff4d29535ccf6df29009243b7\" rel=\"nofollow noreferrer\">github.com/kaihendry/lk/commit/&hellip;</a> Would be awesome if you could please review <a href=\"https://github.com/kaihendry/lk/\" rel=\"nofollow noreferrer\">github.com/kaihendry/lk</a>"}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1448958504, "post_id": 33985208, "comment_id": 55786856, "body": "With addr.String(), I wish it returned the hostname instead of [::]."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1448817318, "last_edit_date": 1448817318, "creation_date": 1448815270, "answer_id": 33985208, "question_id": 33984850, "link": "https://stackoverflow.com/questions/33984850/open-url-on-open-port/33985208#33985208", "title": "Open URL on open port", "body": "<p>Instead of calling ListenAndServe, create the <a href=\"https://godoc.org/net#Listener\" rel=\"nofollow\">Listener</a> in the application and then call <a href=\"http://godoc.org/net/http#Serve\" rel=\"nofollow\">Serve</a>.  When creating the listener, request a free port by specifying the listener address as \":0\":</p>\n\n<pre><code>ln, err := net.Listen(\"tcp\", \":0\")\nif err != nil {\n     // handle error\n}\n</code></pre>\n\n<p>Once the listener is open, you can start the browser:</p>\n\n<pre><code>open.Start(\"http://\" + ln.Addr().String())\n</code></pre>\n\n<p>and then start the server:</p>\n\n<pre><code>if err := http.Serve(ln, nil); err != nil {\n   // handle error\n}\n</code></pre>\n\n<p>There's no need to use a goroutine.    </p>\n\n<p>The code above uses <a href=\"http://godoc.org/net#Addr.String\" rel=\"nofollow\">addr.String()</a> to format the listener's address. If you do need to get the port number for some reason, use a type assertion:</p>\n\n<pre><code>if a, ok := ln.Addr().(*net.TCPAddr); ok {\n   fmt.Println(\"port\", a.Port)\n}\n</code></pre>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 33985208, "answer_count": 1, "score": 0, "last_activity_date": 1448817318, "creation_date": 1448813275, "question_id": 33984850, "link": "https://stackoverflow.com/questions/33984850/open-url-on-open-port", "title": "Open URL on open port", "body": "<p>I'm assuming I can run a <a href=\"https://github.com/kaihendry/lk/blob/05b4db2aa670ddc58761a79db22e3a806a0085ce/main.go#L76\" rel=\"nofollow\">service on port 3000</a> like many other <a href=\"https://github.com/search?q=http.ListenAndServe+open.Start&amp;ref=simplesearch&amp;type=Code\" rel=\"nofollow\">code samples I've seen on Github</a>.</p>\n\n<p>Now I am trying to improve my code so that it looks for an open port in case 3000 is in use:</p>\n\n<pre><code>for port := 3000; port &lt;= 3005; port++ {\n    fmt.Println(port)\n    err := http.ListenAndServe(\":\"+strconv.Itoa(port), nil)\n    if err == nil {\n        fmt.Println(\"lk is serving\", dirPath, \"from http://0.0.0.0:\", string(port))\n        open.Start(\"http://0.0.0.0:\" + string(port))\n    }\n}\n</code></pre>\n\n<p>However it blocks on the <strong>http.ListenAndServe</strong> line and doesn't <strong>open.Start</strong> my browser. I'm told I should use goroutines but I am still a bit bewildered how to use them in this context.</p>\n\n<p>This is a \"client\" Web app so I do need it to invoke my browser.</p>\n"}, {"tags": ["templates", "go", "go-templates"], "comments": [{"owner": {"reputation": 1812, "user_id": 4198514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/94a9dd568be5903fdcd899fc3b2eff2d?s=128&d=identicon&r=PG&f=1", "display_name": "R4PH43L", "link": "https://stackoverflow.com/users/4198514/r4ph43l"}, "edited": false, "score": 1, "creation_date": 1448809654, "post_id": 33984147, "comment_id": 55724032, "body": "What have you tried so far? Why is it not working? Please post a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete and Verifiable Example</a>"}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 1812, "user_id": 4198514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/94a9dd568be5903fdcd899fc3b2eff2d?s=128&d=identicon&r=PG&f=1", "display_name": "R4PH43L", "link": "https://stackoverflow.com/users/4198514/r4ph43l"}, "edited": false, "score": 1, "creation_date": 1448815940, "post_id": 33984147, "comment_id": 55726066, "body": "@R4PH43L I refreshed the post with my try."}, {"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 1, "creation_date": 1448829627, "post_id": 33984147, "comment_id": 55731282, "body": "You&#39;ve got two possibilities:use nested template (find into <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template</a> and name of nested template will be header.html) or use template.HTMLEscapeString. I would prefer first one."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1448899577, "last_edit_date": 1448899577, "creation_date": 1448890590, "answer_id": 33999924, "question_id": 33984147, "link": "https://stackoverflow.com/questions/33984147/golang-embed-html-from-file/33999924#33999924", "title": "Golang embed html from file", "body": "<p>If you parse all your template files with <a href=\"https://golang.org/pkg/html/template/#ParseFiles\" rel=\"noreferrer\"><code>template.ParseFiles()</code></a> or with <a href=\"https://golang.org/pkg/html/template/#ParseGlob\" rel=\"noreferrer\"><code>template.ParseGlob()</code></a>, the templates can refer to each other, they can include each other.</p>\n\n<p>Change your <code>index.html</code> to include the <code>header.html</code> like this:</p>\n\n<pre><code>&lt;html&gt;\n  &lt;head lang=\"en\"&gt;\n\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;header&gt;{{template \"header.html\"}}&lt;/header&gt;\n    &lt;div class=\"panel panel-default\"&gt;\n\n    &lt;/div&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>And then the complete program (which parses files from the current directory, executes <code>\"index.html\"</code> and writes the result to the standard output):</p>\n\n<pre><code>t, err := template.ParseFiles(\"index.html\", \"header.html\")\nif err != nil {\n    panic(err)\n}\n\nerr = t.ExecuteTemplate(os.Stdout, \"index.html\", nil)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>With <code>template.ParseGlob()</code> it could look like this:</p>\n\n<pre><code>t, err := template.ParseGlob(\"*.html\")\n// ...and the rest is the same...\n</code></pre>\n\n<p>The output (printed on the console):</p>\n\n<pre><code>&lt;html&gt;\n  &lt;head lang=\"en\"&gt;\n\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;header&gt;&lt;div id=\"logo\"&gt;&lt;/div&gt;&lt;div id=\"motto\"&gt;&lt;/div&gt;&lt;/header&gt;\n    &lt;div class=\"panel panel-default\"&gt;\n\n    &lt;/div&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8379, "favorite_count": 0, "accepted_answer_id": 33999924, "answer_count": 1, "score": 10, "last_activity_date": 1556540346, "creation_date": 1448809002, "last_edit_date": 1556540346, "question_id": 33984147, "link": "https://stackoverflow.com/questions/33984147/golang-embed-html-from-file", "title": "Golang embed html from file", "body": "<p>How can I do in Golang if I have an HTML file like this: </p>\n\n<pre><code>&lt;html&gt;\n  &lt;head lang=\"en\"&gt;\n\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;header&gt;{{.Header}}&lt;/header&gt;\n    &lt;div class=\"panel panel-default\"&gt;\n\n    &lt;/div&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>and I want to embed a part of code into to header tags from an other file like this: </p>\n\n<pre><code>&lt;div id=\"logo\"&gt;&lt;/div&gt;&lt;div id=\"motto\"&gt;&lt;/div&gt;\n</code></pre>\n\n<p>My try: </p>\n\n<pre><code>header, _ := template.ParseFiles(\"header.html\")\nc := Content{Header: \"\"}\nheader.Execute(c.Header, nil)\n\nindex := template.Must(template.ParseFiles(\"index.html\"))\nindex.Execute(w, c)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1448846668, "post_id": 33983658, "comment_id": 55736116, "body": "It might be a silly question, but if you leave out the <code>-rpath</code> bit, does it actually produce a dynamically linked executable?"}, {"owner": {"reputation": 665, "user_id": 2250209, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/136fe162dd738ea4e8aabc3076772cd7?s=128&d=identicon&r=PG", "display_name": "Christian Schmitt", "link": "https://stackoverflow.com/users/2250209/christian-schmitt"}, "reply_to_user": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1448870789, "post_id": 33983658, "comment_id": 55743467, "body": "@JamesHenstridge file says: <code>backup: Mach-O 64-bit executable x86_64</code>"}], "owner": {"reputation": 665, "user_id": 2250209, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/136fe162dd738ea4e8aabc3076772cd7?s=128&d=identicon&r=PG", "display_name": "Christian Schmitt", "link": "https://stackoverflow.com/users/2250209/christian-schmitt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 322, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1448805847, "creation_date": 1448805847, "question_id": 33983658, "link": "https://stackoverflow.com/questions/33983658/golang-cant-set-rpath-mac", "title": "Golang can&#39;t set rpath (Mac)?", "body": "<p>Hello currently I tried to set <code>-rpath</code> with pkg-config for golang, however I always get the following:</p>\n\n<pre><code>ld: -rpath can only be used when creating a dynamic final linked image\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n</code></pre>\n\n<p>Is there any way to fix it?</p>\n\n<p>I tried to use LDFLAGS with -Wl,rpath and I have a pkg-config with -rpath both are failing with the same error.</p>\n\n<p>I also stumbled on github on this: <a href=\"https://github.com/golang/go/issues/7293\" rel=\"nofollow\">https://github.com/golang/go/issues/7293</a>\nWhich means that it should work?</p>\n"}, {"tags": ["go", "yaml"], "answers": [{"tags": [], "owner": {"reputation": 623, "user_id": 5615224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7bea88308ec27975167f216eb8f998e?s=128&d=identicon&r=PG&f=1", "display_name": "sfault", "link": "https://stackoverflow.com/users/5615224/sfault"}, "is_accepted": true, "score": 0, "last_activity_date": 1448799720, "creation_date": 1448799720, "answer_id": 33982702, "question_id": 33982311, "link": "https://stackoverflow.com/questions/33982311/go-parsing-variative-yaml/33982702#33982702", "title": "Go: parsing variative YAML", "body": "<p>Try using <code>map[string]interface{}</code> to unmarshal. With <code>interface{}</code> you can unmarshal it later when required.</p>\n"}], "owner": {"reputation": 973, "user_id": 2084479, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mCqQp.jpg?s=128&g=1", "display_name": "vladfau", "link": "https://stackoverflow.com/users/2084479/vladfau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 33982702, "answer_count": 1, "score": 0, "last_activity_date": 1448799720, "creation_date": 1448796798, "question_id": 33982311, "link": "https://stackoverflow.com/questions/33982311/go-parsing-variative-yaml", "title": "Go: parsing variative YAML", "body": "<p>I want to unmarshall map, which can contain different values, how can I do it in Go with <code>yaml.v2</code>? </p>\n\n<p>Currently, I have the following node description: </p>\n\n<pre><code>package executors\n\ntype OptionMap map[string][]string\n\ntype Step struct {\n    Exec string\n    Pwd  string\n    Opts OptionMap\n}\n</code></pre>\n\n<p>Sample YAML is the following:</p>\n\n<pre><code>steps:\n   - exec: maven\n     pwd: /code\n     opts:\n       goals:\n         - clean\n         - install\n       mvn_home: /maven\n</code></pre>\n\n<p>Obviously, node will be unmarshaled if only <code>goals</code>, but not <code>mvn_home</code> will present there. Is there any way to write the single description for such node? </p>\n\n<p>If no, is there any way to read some part of YAML (under some key) as a plain string or, better, such sort of map as <code>map[string]OBJECT</code> and unmarshal that <code>OBJECT</code> separately? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "edited": false, "score": 0, "creation_date": 1449053414, "post_id": 33985468, "comment_id": 55836258, "body": "Thanks for the input. I guess this was a bad example function - I think I over simplified. Consider this function: <a href=\"https://github.com/kego/ke/blob/b89b3a9d1ddd8ed1754f1834bf72cabfb65492b4/editor/client/tree/branch.go#L178-L192\" rel=\"nofollow noreferrer\">github.com/kego/ke/blob/&hellip;</a> ... it returns the last visible descendant of the current node. However, if the current node is closed, it must return itself. It must return the interface, so it&#39;s tricky if all we have as input is the embedded struct..."}, {"owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "edited": false, "score": 0, "creation_date": 1449054043, "post_id": 33985468, "comment_id": 55836643, "body": "I guess a simplified function that fits into my examples above would be:  <code>func (n *node) GetSelfOrFirstChild() NodeInterface { \t \tif some_condidion { \t\treturn n &#47;* whoops! this is a *node *&#47; \t} \t \treturn n.children[0] &#47;* this is a NodeInterface *&#47; \t }</code>"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "edited": false, "score": 0, "creation_date": 1449084981, "post_id": 33985468, "comment_id": 55857327, "body": "Yeah, that seems like the second case to me--write a function that accepts an interface. I imagine it&#39;s unexpected in, say, Java or C++, but it&#39;s common in Go."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "edited": false, "score": 0, "creation_date": 1449085791, "post_id": 33985468, "comment_id": 55857763, "body": "If you do want to go more in depth about that or about how to convert other inheritance-based arrangements to Go, a new question might be the right venue--there&#39;s more a family of &quot;how do I do X in Go&quot; questions than one &quot;how do I do OO in Go,&quot; at least if we stick to a typical answer length."}, {"owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "edited": false, "score": 1, "creation_date": 1449153907, "post_id": 33985468, "comment_id": 55890668, "body": "I finally made a decision that I&#39;m reasonably happy with. I&#39;m going to have a <code>self</code> member in the struct that contains a copy of the interface, and a <code>branch()</code> method in the interface that returns the struct. All internal manipulation, the children array and the parent will use the struct, leaving the interface to be used only in the more external code. This means the interface can be much smaller, and only contain the methods that need to be called by external code.  <a href=\"https://github.com/kego/ke/blob/ab7589acd15d35c803e795419653f3aa4e640331/editor/client/tree/branch.go\" rel=\"nofollow noreferrer\">github.com/kego/ke/blob/&hellip;</a>"}], "tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": true, "score": 0, "last_activity_date": 1448830295, "last_edit_date": 1495540952, "creation_date": 1448816752, "answer_id": 33985468, "question_id": 33981867, "link": "https://stackoverflow.com/questions/33981867/getting-polymorphic-code-right-in-go/33985468#33985468", "title": "Getting polymorphic code right in Go", "body": "<p>Here, I'd have document nodes reimplement <code>SetNodeState</code>, and use <code>d.node.SetNodeState</code> to update the node's state; in non-Go-y terms, I'd push the class-specific code down to the subclass, <a href=\"https://play.golang.org/p/ukTvdzzwGx\" rel=\"nofollow noreferrer\">like this</a>:</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc main() {\n    tests := []testing.InternalTest{{\"TestTree\", TestTree}}\n    matchAll := func(t string, pat string) (bool, error) { return true, nil }\n    testing.Main(matchAll, tests, nil, nil)\n}\n\nfunc TestTree(t *testing.T) {\n    n := getTestNode()\n    n.SetNodeState(true)\n    if !n.(*document).visible {\n        t.Error(\"document is not visible\")\n    }\n}\n\nfunc getTestNode() NodeInterface {\n    doc := &amp;document{node: &amp;node{}, content: \"foo\"}\n    folder := &amp;folder{node: &amp;node{children: []NodeInterface{doc}}, color: 123}\n    return folder.children[0]\n}\n\ntype NodeInterface interface {\n    SetNodeState(state bool)\n}\n\ntype node struct {\n    open     bool\n    parent   NodeInterface\n    children []NodeInterface\n}\n\nfunc (n *node) SetNodeState(state bool) {\n    n.open = state\n}\n\ntype folder struct {\n    *node\n    color int\n}\n\nvar _ NodeInterface = (*folder)(nil)\n\ntype document struct {\n    *node\n    visible bool\n    content string\n}\n\nfunc (d *document) SetNodeState(state bool) {\n        d.node.SetNodeState(state)\n        d.SetEditState(state)\n}\n\nfunc (d *document) SetEditState(state bool) {\n    d.visible = state\n}\n</code></pre>\n\n<p>This also lets you write the general methods that apply to any <code>node</code> <a href=\"https://softwareengineering.stackexchange.com/questions/220660/base-class-should-have-no-knowledge-of-its-subtypes\">without referring to specific node types</a>, which you might find cleaner than an approach where <code>node</code> methods have type assertions for particular types. </p>\n\n<p>(That, in turn, would let you make a public <code>Node</code>/<code>NodeInterface</code> and keep them in a separate package from specific node types, since the specific types would only depend on the general type and never the other way around (recall two Go packages <a href=\"https://stackoverflow.com/questions/20380333/cyclic-dependencies-and-interfaces-in-golang\">can't both depend on each other</a>). But it seems reasonable to keep the <code>node</code> type together in a package with the specific node types as you're doing.)</p>\n\n<hr>\n\n<p>Where the above approach doesn't apply, something like your third example (having a function that takes the interface) might help. To shorten it a bit, that interface might be able to provide just <code>getNode() *node</code> rather than <code>setOpen</code>, <code>appendChild</code>, etc., depending on specifics of the situation.</p>\n\n<p>The Go stdlib exports functions that take interfaces, with, e.g., <code>io.ReadFull(r, buf)</code> instead of <code>Reader</code>s having a <code>ReadFull(buf)</code> method. I suspect it'd be considered bad form in, say, C++ for the code to be in a bare function rather than a method, but it's a common practice in Go. </p>\n\n<hr>\n\n<p>So: sometimes you can get OO-ish behavior by (re)implementing a method on the specific type; when you can't, functions accepting an interface are idiomatic.</p>\n"}], "owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 33985468, "answer_count": 1, "score": 0, "last_activity_date": 1448830295, "creation_date": 1448793879, "question_id": 33981867, "link": "https://stackoverflow.com/questions/33981867/getting-polymorphic-code-right-in-go", "title": "Getting polymorphic code right in Go", "body": "<p>I've refactored my tree package several times, and not found a solution I'm happy with, so I'd like a little advice on the best way to proceed.</p>\n\n<p>I've tried to reduce the problem down to it's essence, and made a simple example of a tree which is composed of nodes. All nodes have a set of common functionality (expressed in the example as an open / closed state). In addition, there are several types of nodes, each with specialist behaviours (expressed in the example as editable nodes implementing EditorInterface and having a visible / hidden state).</p>\n\n<p>In my example we try to satisfy the desired behaviour - any node can be opened, and when it's opened if it's editable, it should make the editor visible.</p>\n\n<p>My example defines two types of node, folders and documents. Documents are editable.</p>\n\n<p>My instinct is to define a struct for node, and include common functionality as members and methods. Then define structs for folder and document, with an embedded anonymous node struct in each.</p>\n\n<p>However, this causes a problem which will be highlighted by my first example. I've created a simple test that fails:</p>\n\n<p>Example 1: <a href=\"https://play.golang.org/p/V6UT19zVVU\" rel=\"nofollow\">https://play.golang.org/p/V6UT19zVVU</a></p>\n\n<pre><code>// In this example the test fails because we're unable to access the interface in SetNodeState.\npackage main\n\nimport \"testing\"\n\nfunc TestTree(t *testing.T) {\n    n := getTestNode()\n    n.SetNodeState(true)\n    if !n.(*document).visible {\n        t.Error(\"document is not visible\")\n    }\n}\n\nfunc getTestNode() NodeInterface {\n    doc := &amp;document{node: &amp;node{}, content: \"foo\"}\n    folder := &amp;folder{node: &amp;node{children: []NodeInterface{doc}}, color: 123}\n    return folder.children[0]\n}\n\ntype NodeInterface interface {\n    SetNodeState(state bool)\n}\n\ntype EditorInterface interface {\n    SetEditState(state bool)\n}\n\ntype node struct {\n    open     bool\n    parent   NodeInterface\n    children []NodeInterface\n}\n\nfunc (n *node) SetNodeState(state bool) {\n\n    n.open = state\n\n    // TODO: obviously this isn't possible.\n    //if e, ok := n.(EditorInterface); ok {\n    //  e.SetEditState(state)\n    //}\n}\n\ntype folder struct {\n    *node\n    color int\n}\n\nvar _ NodeInterface = (*folder)(nil)\n\ntype document struct {\n    *node\n    visible bool\n    content string\n}\n\nvar _ NodeInterface = (*document)(nil)\nvar _ EditorInterface = (*document)(nil)\n\nfunc (d *document) SetEditState(state bool) {\n    d.visible = state\n}\n</code></pre>\n\n<p>I've tried to refactor this several times to achieve the desired behaviour, but none of the methods makes me happy. I won't paste them all into the question, but I've created Go playground links:</p>\n\n<p>Example 2: <a href=\"https://play.golang.org/p/kyG-sRu6z-\" rel=\"nofollow\">https://play.golang.org/p/kyG-sRu6z-</a>\nIn this example the test passes, because we add the interface as the \"self\" member of the embedded struct. This seems like a nasty kludge.</p>\n\n<p>Example 3: <a href=\"https://play.golang.org/p/Sr5qhLn102\" rel=\"nofollow\">https://play.golang.org/p/Sr5qhLn102</a>\nIn this example, we move SetNodeState to a function that accepts the interface. The disadvantage of this is that we don't have access to the embedded struct, so all members need getters and setters exposed on the interface. This makes the interface needlessly complex.</p>\n\n<p>Example 4: <a href=\"https://play.golang.org/p/P5E1kf4dqj\" rel=\"nofollow\">https://play.golang.org/p/P5E1kf4dqj</a>\nIn this example, we provide a getter to return the entire embedded struct, which we use in the SetNodeState function. Again this seems like a nasty kludge.</p>\n\n<p>Example 5: <a href=\"https://play.golang.org/p/HMH-Y_RstV\" rel=\"nofollow\">https://play.golang.org/p/HMH-Y_RstV</a>\nIn this example we pass in the interface as a parameter to every method that needs it. Again, this doesn't feel right.</p>\n\n<p>Example 6: <a href=\"https://play.golang.org/p/de0iwQ9gGY\" rel=\"nofollow\">https://play.golang.org/p/de0iwQ9gGY</a>\nIn this example, we remove NodeInterface, and construct nodes from a base struct and an object implementing ItemInterface. This is perhaps the least problematic of the examples, but still leaves me wanting a better solution.</p>\n\n<p>Perhaps someone can suggest a better solution?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "edited": false, "score": 0, "creation_date": 1449544999, "post_id": 33982822, "comment_id": 56042575, "body": "There seems to be an issue with import for <code>gopkg.in&#47;mgo.v2&#47;dbtest</code>. When we run tests it fails with <code>gopkg.in&#47;tomb.v2: no buildable Go source files in</code> error. I had to run <code>go get gopkg.in&#47;tomb.v2</code> to resolve it."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 85, "user_id": 5830058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3403dfb12675665b91c409730c65b615?s=128&d=identicon&r=PG&f=1", "display_name": "Olive.b", "link": "https://stackoverflow.com/users/5830058/olive-b"}, "edited": false, "score": 1, "creation_date": 1583219476, "post_id": 33982822, "comment_id": 107032174, "body": "@Olive.b Depends on your CI environment and your test scenario, I guess. At the end of the day <code>server.Session()</code> returns the same struct you would get from <code>mgo.Dial</code>. So it would be thinkable that you use a build tag integration tests, say <code>it</code>. You would then create two <code>*_test.go</code>, one with the above code and <code>!it</code>, and one with a connection to your MongoDB testcluster and the build tag <code>it</code>."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1583219883, "post_id": 33982822, "comment_id": 107032317, "body": "However, it is my sad duty to inform you that globalsign has ceased support for the driver, and it is getting out of date, already. See <a href=\"https://github.com/globalsign/mgo/issues/371#issuecomment-527873696\" rel=\"nofollow noreferrer\">github.com/globalsign/mgo/issues/371#issuecomment-527873696</a>"}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": true, "score": 3, "last_activity_date": 1448805059, "last_edit_date": 1448805059, "creation_date": 1448800603, "answer_id": 33982822, "question_id": 33979614, "link": "https://stackoverflow.com/questions/33979614/golang-mongodb-gridfs-testing/33982822#33982822", "title": "Golang MongoDb GridFs Testing", "body": "<p>There is no embedded MongoDB for Go as far as I am aware of.</p>\n\n<p>What I do is to use mgo's own <a href=\"https://gopkg.in/mgo.v2/dbtest\" rel=\"nofollow\">gopkg.in/mgo.v2/dbtest</a> which you can install as usual with</p>\n\n<pre><code>go get -u \"gopkg.in/mgo.v2/dbtest\"\n</code></pre>\n\n<p>Although it requires a <code>mongod</code> inside your $PATH, the dbtest takes care of all the rest.</p>\n\n<p>You get a server with</p>\n\n<pre><code>package StackOverflowTests\n\nimport (\n  \"io/ioutil\"\n  \"os\"\n  \"testing\"\n\n  \"gopkg.in/mgo.v2/dbtest\"\n)\n\nfunc TestFoo(t *testing.T) {\n\n    d, _ := ioutil.TempDir(os.TempDir(), \"mongotools-test\")\n\n    server := dbtest.DBServer{}\n    server.SetPath(d)\n\n    // Note that the server will be started automagically\n    session := server.Session()\n\n    // Insert data programmatically as needed\n    setupDatabaseAndCollections(session)\n\n    // Do your testing stuff\n    foo.Bar(session)\n    // Whatever tests you do\n\n    // We can not use \"defer session.Close()\" because...\n    session.Close()\n\n    // ... \"server.Wipe()\" will panic if there are still connections open\n    // for example because you did a .Copy() on the\n    // original session in your code. VERY useful!\n    server.Wipe()\n\n    // Tear down the server\n    server.Stop()\n}\n</code></pre>\n\n<p>Note that you neither have to define an IP or port, which are provided automagically (a free open port in the non-reserved range of localhost is used).</p>\n"}], "owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 810, "favorite_count": 1, "accepted_answer_id": 33982822, "answer_count": 1, "score": 0, "last_activity_date": 1448805059, "creation_date": 1448773680, "last_edit_date": 1448774091, "question_id": 33979614, "link": "https://stackoverflow.com/questions/33979614/golang-mongodb-gridfs-testing", "title": "Golang MongoDb GridFs Testing", "body": "<p>I have a rest API implemented using Gorilla Mux in Golang. This API uploads/downloads files from MongoDb GridFs. I want to write integration tests for my API. <br>Is there a <code>embedded MongoDb</code> package with <code>GridFs support</code> in Go? How do we test APIs using GridFs? Do we need to test against a real MongoDB?\n<br>\nJava seems to have such a <a href=\"https://github.com/flapdoodle-oss/de.flapdoodle.embed.mongo\" rel=\"nofollow\">library</a></p>\n\n<p>As part of the test, I would like to start embedded MongoDB and stop it at the end of the test.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 576, "user_id": 5601055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0cc8bc05264395dbfbeae0a546a6cc5?s=128&d=identicon&r=PG&f=1", "display_name": "pwilmot", "link": "https://stackoverflow.com/users/5601055/pwilmot"}, "is_accepted": true, "score": 4, "last_activity_date": 1448773839, "last_edit_date": 1448773839, "creation_date": 1448772146, "answer_id": 33979484, "question_id": 33979399, "link": "https://stackoverflow.com/questions/33979399/golang-tour-18-for-continued/33979484#33979484", "title": "Golang tour #18 For continued", "body": "<p>Its really just doing powers of 2</p>\n\n<p>so the outputs are</p>\n\n<p>1 2 4 8 16 32 ... 1024</p>\n\n<p>Think of this loop as </p>\n\n<pre><code>sum = 1\nwhile(sum &lt; x) {\n    sum = sum * 2\n}\n</code></pre>\n"}], "owner": {"reputation": 1447, "user_id": 2841163, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b6a24dd9e04281d23a50aafb2c8ff10c?s=128&d=identicon&r=PG", "display_name": "stcho", "link": "https://stackoverflow.com/users/2841163/stcho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 33979484, "answer_count": 1, "score": 1, "last_activity_date": 1448773839, "creation_date": 1448771113, "question_id": 33979399, "link": "https://stackoverflow.com/questions/33979399/golang-tour-18-for-continued", "title": "Golang tour #18 For continued", "body": "<p>This may be a simple thing I can't see for some reason but I am going through the golang tour and in the \"For continued\" section and I was wondering if someone could explain to me how the logic executes and delivers the statement to be 1024. <a href=\"https://tour.golang.org/flowcontrol/2\" rel=\"nofollow\">https://tour.golang.org/flowcontrol/2</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    sum := 1\n    for ; sum &lt; 1000; {\n        sum += sum\n    }\n    fmt.Println(sum)\n}\n</code></pre>\n"}, {"tags": ["plugins", "intellij-idea", "go"], "answers": [{"comments": [{"owner": {"reputation": 185, "user_id": 5616809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb06744b77a8d9e3938c6198ab42f47f?s=128&d=identicon&r=PG&f=1", "display_name": "Nature.Li", "link": "https://stackoverflow.com/users/5616809/nature-li"}, "edited": false, "score": 0, "creation_date": 1481280295, "post_id": 33981938, "comment_id": 69323772, "body": "Thanks, it works. When I switch keyamp to  default XWin, it works. I usually use Eclipse (Mac OX) keymap, because I use Eclipse for writing c++ code. I don&#39;t want to use two different keymap."}], "tags": [], "owner": {"reputation": 33452, "user_id": 296452, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/15ba69c4116f6646b861202252d953ab?s=128&d=identicon&r=PG", "display_name": "Andreas Wederbrand", "link": "https://stackoverflow.com/users/296452/andreas-wederbrand"}, "is_accepted": false, "score": 1, "last_activity_date": 1448794326, "creation_date": 1448794326, "answer_id": 33981938, "question_id": 33979270, "link": "https://stackoverflow.com/questions/33979270/can-the-golang-plugin-for-intellij-give-better-type-information/33981938#33981938", "title": "Can the golang plugin for IntelliJ give better type information?", "body": "<p>You could position the cursor over <code>mask</code> and press <kbd>ctrl</kbd>+<kbd>q</kbd>, quick lookup. </p>\n"}, {"comments": [{"owner": {"reputation": 185, "user_id": 5616809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb06744b77a8d9e3938c6198ab42f47f?s=128&d=identicon&r=PG&f=1", "display_name": "Nature.Li", "link": "https://stackoverflow.com/users/5616809/nature-li"}, "edited": false, "score": 0, "creation_date": 1481279694, "post_id": 33982208, "comment_id": 69323362, "body": "Thanks. I installed a new version and it works. But I think you could do it better and better. For example, when the mouse is over the variable it will show me the type. But now I must press ctrl + shift + p or configure other key shortcut.  When the mouse is over a variable or a function, you can do anything here, not only show the variable type. It&#39;s a trigger chance here."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 2, "last_activity_date": 1448796084, "creation_date": 1448796084, "answer_id": 33982208, "question_id": 33979270, "link": "https://stackoverflow.com/questions/33979270/can-the-golang-plugin-for-intellij-give-better-type-information/33982208#33982208", "title": "Can the golang plugin for IntelliJ give better type information?", "body": "<p>at the moment this feature is not implemented in the plugin but I've opened a issue for it. If you want to track it, the please follow <a href=\"https://github.com/go-lang-plugin-org/go-lang-idea-plugin/issues/2052\" rel=\"nofollow\" title=\"this issue\">this issue</a></p>\n"}], "owner": {"reputation": 185, "user_id": 5616809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb06744b77a8d9e3938c6198ab42f47f?s=128&d=identicon&r=PG&f=1", "display_name": "Nature.Li", "link": "https://stackoverflow.com/users/5616809/nature-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 33982208, "answer_count": 2, "score": 3, "last_activity_date": 1448796084, "creation_date": 1448769638, "last_edit_date": 1448773350, "question_id": 33979270, "link": "https://stackoverflow.com/questions/33979270/can-the-golang-plugin-for-intellij-give-better-type-information", "title": "Can the golang plugin for IntelliJ give better type information?", "body": "<p>When I move the mouse cursor over the variable, I want it to tell me the specific data type, like LiteIDE does: </p>\n\n<p><a href=\"https://i.stack.imgur.com/UZYzt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UZYzt.png\" alt=\"LiteIDE behaviour.\"></a></p>\n\n<p>But the IntelliJ golang plugin is giving me data like:</p>\n\n<p><a href=\"https://i.stack.imgur.com/eWQ9f.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/eWQ9f.png\" alt=\"enter image description here\"></a></p>\n\n<p>Is there a better way to find out what type the variable is? Thanks.</p>\n"}, {"tags": ["go", "cors", "vue.js"], "answers": [{"comments": [{"owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "reply_to_user": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448768744, "post_id": 33978965, "comment_id": 55714618, "body": "@holys I gotta wait 2 days"}], "tags": [], "owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "is_accepted": true, "score": 0, "last_activity_date": 1448766326, "creation_date": 1448766326, "answer_id": 33978965, "question_id": 33978918, "link": "https://stackoverflow.com/questions/33978918/error-when-adding-vue-http-header/33978965#33978965", "title": "Error when adding vue http header", "body": "<p>Ok so I found the answer it is a server problem the <code>Authorization</code> header was not authorized. So just add it as a middleware to allow for it.</p>\n\n<pre><code>c := cors.New(cors.Options{\n        AllowedHeaders: []string{\"Origin\", \"Accept\", \"Content-Type\", \"Authorization\"},\n    })\nhandler := c.Handler(router)\nlog.Fatal(http.ListenAndServe(\":8000\", handler))\n</code></pre>\n\n<p>I am using the <code>rs/cors</code> package</p>\n"}], "owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 539, "favorite_count": 0, "accepted_answer_id": 33978965, "answer_count": 1, "score": 0, "last_activity_date": 1448766326, "creation_date": 1448765816, "question_id": 33978918, "link": "https://stackoverflow.com/questions/33978918/error-when-adding-vue-http-header", "title": "Error when adding vue http header", "body": "<p>I have a working application with a front end in <code>vuejs</code> and a backend in <code>go</code>. I'm in the process of adding the final features to the authentication and I'm running into an error.</p>\n\n<p>When I try to add any http header to the <code>vuejs</code> request I get an error.</p>\n\n<p>This is what I'm adding to the <code>vue component</code>:</p>\n\n<pre><code>http: {\n  headers: {\n    Authorization: 'Bearer 123'\n  }\n}\n</code></pre>\n\n<p>And I'm getting a <code>preflight</code> error:</p>\n\n<pre><code>XMLHttpRequest cannot load http://localhost:8000/api/investments?limit=6. Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:8080' is therefore not allowed access.\n</code></pre>\n\n<p>Now I know this is usually a server side problem but I am adding the response header <code>resp.Header().Set(\"Access-Control-Allow-Origin\", \"*\")</code>. <code>cors</code>. If I remove the the http property in the <code>vue object</code> everything works fine. Its pretty bizzare I even tried handling the <code>OPTIONS</code> request with <code>go</code> but my handler for the api doesn't even get hit.  </p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448760863, "post_id": 33978419, "comment_id": 55713274, "body": "<code>int64       the set of all signed 64-bit integers (-9223372036854775808 to 9223372036854775807)</code> from the Go Spec."}], "answers": [{"comments": [{"owner": {"reputation": 38473, "user_id": 821657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/qDRGg.png?s=128&g=1", "display_name": "Andrei Volgin", "link": "https://stackoverflow.com/users/821657/andrei-volgin"}, "edited": false, "score": 0, "creation_date": 1448761437, "post_id": 33978471, "comment_id": 55713389, "body": "Definitely, not probably."}, {"owner": {"reputation": 597, "user_id": 515320, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/56bb98d5e22200a138bbcbf68047cb6f?s=128&d=identicon&r=PG", "display_name": "Andy Haskell", "link": "https://stackoverflow.com/users/515320/andy-haskell"}, "edited": false, "score": 0, "creation_date": 1448761808, "post_id": 33978471, "comment_id": 55713471, "body": "Hm, well the ID I got was even bigger than 16 digits and wouldn&#39;t fit in a 64 bit int either so that&#39;s why I&#39;m not sure if in a deployed app I would be able to assume the IDs fit in 64 bits."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1448789766, "post_id": 33978471, "comment_id": 55718494, "body": "Your quote refers to numeric key ids (<code>Key.IntID()</code>). <code>User.ID</code> is not a numeric key id."}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": -1, "last_activity_date": 1448760951, "creation_date": 1448760951, "answer_id": 33978471, "question_id": 33978419, "link": "https://stackoverflow.com/questions/33978419/in-deployed-appengine-apps-can-a-users-id-be-longer-than-64-bits/33978471#33978471", "title": "In deployed appengine apps, can a User&#39;s ID be longer than 64 bits?", "body": "<p>Most probably yes. Reading <a href=\"https://cloud.google.com/appengine/docs/go/datastore/entities#Go_Kinds_and_identifiers\" rel=\"nofollow\">app engine documentation</a>, it is written that:</p>\n\n<blockquote>\n  <p>The default policy generates a random sequence of unused IDs that are\n  approximately uniformly distributed. Each ID can be up to 16 decimal\n  digits long.</p>\n</blockquote>\n\n<p>From <a href=\"https://golang.org/pkg/builtin/\" rel=\"nofollow\">Go specs</a> int32 is <code>-2147483648 through 2147483647.</code> which is not enough for 16 decimals, but <code>int64</code> is enough. </p>\n"}, {"comments": [{"owner": {"reputation": 12908, "user_id": 1201324, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hkRLn.jpg?s=128&g=1", "display_name": "Tim Hoffman", "link": "https://stackoverflow.com/users/1201324/tim-hoffman"}, "edited": false, "score": 1, "creation_date": 1448770304, "post_id": 33979053, "comment_id": 55714853, "body": "System generated id&#39;s are long integers (I am using imprecisely here, I use python) not strings. See the go docs func AllocateIDs"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 12908, "user_id": 1201324, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hkRLn.jpg?s=128&g=1", "display_name": "Tim Hoffman", "link": "https://stackoverflow.com/users/1201324/tim-hoffman"}, "edited": false, "score": 1, "creation_date": 1448778703, "post_id": 33979053, "comment_id": 55716252, "body": "@TimHoffman Yes, but <code>User.ID</code> is <b>not</b> a system generated id with <code>AllocateIDs()</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1448767215, "creation_date": 1448767215, "answer_id": 33979053, "question_id": 33978419, "link": "https://stackoverflow.com/questions/33978419/in-deployed-appengine-apps-can-a-users-id-be-longer-than-64-bits/33979053#33979053", "title": "In deployed appengine apps, can a User&#39;s ID be longer than 64 bits?", "body": "<p>The <code>ID</code> field of the <a href=\"https://cloud.google.com/appengine/docs/go/users/reference#User\" rel=\"nofollow\"><code>User</code></a> type is defined with type <code>string</code>. Just because it contains digits, there is no guarantee that it fits into an <code>int64</code>.</p>\n\n<p>The Go AppengineSDK uses values that fit into <code>int64</code>, but this is not true in production environment. They are usually longer than the max value of <code>int64</code>. They are handed to you as <code>string</code>s, so treat them like that: <code>string</code>s. Nothing forces you to convert them to a number. I don't know where you got the idea to convert them to numbers, but don't do that. They are <code>string</code>s.</p>\n\n<p>Note: <code>User.ID</code> is not to be mistaken with <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference#Key.IntID\" rel=\"nofollow\"><code>Key.IntID()</code></a> which is defined to be of type <code>int64</code>.</p>\n"}], "owner": {"reputation": 597, "user_id": 515320, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/56bb98d5e22200a138bbcbf68047cb6f?s=128&d=identicon&r=PG", "display_name": "Andy Haskell", "link": "https://stackoverflow.com/users/515320/andy-haskell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 33979053, "answer_count": 2, "score": 3, "last_activity_date": 1448767215, "creation_date": 1448760416, "last_edit_date": 1448761667, "question_id": 33978419, "link": "https://stackoverflow.com/questions/33978419/in-deployed-appengine-apps-can-a-users-id-be-longer-than-64-bits", "title": "In deployed appengine apps, can a User&#39;s ID be longer than 64 bits?", "body": "<p>I am working on an appengine app in Go and when I tried to get an appengine <code>User</code>'s ID and convert it to a 64-bit int with this code:</p>\n\n<pre><code>id, err := strconv.ParseInt(user.ID, 10, 64)\n</code></pre>\n\n<p>I got this error:</p>\n\n<pre><code>ERROR: error executing inner: strconv.ParseInt: parsing \"185804764220139124118\": value out of range\n</code></pre>\n\n<p>Does this error occur on appengine IDs in deployed code as well?</p>\n"}, {"tags": ["http", "go", "response"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 3, "creation_date": 1448760834, "post_id": 33978216, "comment_id": 55713265, "body": "You can extend a simple string reader or something similar with a dummy <code>Close</code> method."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1448762664, "post_id": 33978216, "comment_id": 55713613, "body": "Which is done for you: <a href=\"https://golang.org/pkg/io/ioutil/#NopCloser\" rel=\"nofollow noreferrer\">ioutiil.NopCloser</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "is_accepted": true, "score": 42, "last_activity_date": 1448814717, "last_edit_date": 1495541863, "creation_date": 1448810659, "answer_id": 33984410, "question_id": 33978216, "link": "https://stackoverflow.com/questions/33978216/create-http-response-instance-with-sample-body-string-in-golang/33984410#33984410", "title": "Create http.Response instance with sample body string in golang", "body": "<p>As suggested by <a href=\"https://stackoverflow.com/users/1239701/not-a-golfer\">Not_a_Golfer</a> and <a href=\"https://stackoverflow.com/users/32880/jimb\">JimB</a>:</p>\n\n<p><code>io.ReadCloser</code> is an interface that is satisfied when a <code>struct</code> implements both the <code>Read</code> and the <code>Close</code> functions.</p>\n\n<p>Fortunately, there is <code>ioutil.NopCloser</code>, which takes  a <code>io.Reader</code> and wraps it in the <code>nopCloser</code> struct, which implements both <code>Read</code> and <code>Close</code>. However, its <code>Close</code> function does <a href=\"https://golang.org/src/io/ioutil/ioutil.go?s=3631:3672#L112\" rel=\"noreferrer\">nothing</a> as implied from the name.</p>\n\n<p>Here is an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nfunc main() {\n    t := http.Response{\n        Body: ioutil.NopCloser(bytes.NewBufferString(\"Hello World\")),\n    }\n\n    buff := bytes.NewBuffer(nil)\n    t.Write(buff)\n\n    fmt.Println(buff)\n}\n</code></pre>\n\n<p>To play with the code, click <a href=\"http://play.golang.org/p/lLBi006Zwb\" rel=\"noreferrer\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 396, "user_id": 11809641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00bc40847d24ae807a8023c1543d8b56?s=128&d=identicon&r=PG&f=1", "display_name": "user11809641", "link": "https://stackoverflow.com/users/11809641/user11809641"}, "edited": false, "score": 1, "creation_date": 1608684277, "post_id": 37302230, "comment_id": 115656232, "body": "This is the simplest answer IMHO."}], "tags": [], "owner": {"reputation": 5209, "user_id": 4317945, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/30jtQ.jpg?s=128&g=1", "display_name": "Gabe", "link": "https://stackoverflow.com/users/4317945/gabe"}, "is_accepted": false, "score": 2, "last_activity_date": 1463580811, "creation_date": 1463580811, "answer_id": 37302230, "question_id": 33978216, "link": "https://stackoverflow.com/questions/33978216/create-http-response-instance-with-sample-body-string-in-golang/37302230#37302230", "title": "Create http.Response instance with sample body string in golang", "body": "<p>This should work..</p>\n\n<pre><code>func main(){\n\n    go serveHTTP(*port, *host)\n\n    select {}\n}\n\nfunc serveHTTP(port int, host string) {\n\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        requestHandler(w, r)\n    })\n\n    addr := fmt.Sprintf(\"%v:%d\", host, port)\n    server := &amp;http.Server {\n        Addr:           addr,\n        Handler:        mux,\n        ReadTimeout:    10 * time.Second,\n        WriteTimeout:   10 * time.Second,\n        MaxHeaderBytes: 1 &lt;&lt; 20,\n    }\n\n    err := server.ListenAndServe()\n    log.Println(err.Error())\n}\n\nfunc requestHandler(w http.ResponseWriter, r *http.Request){\n  fmt.Fprintf(w, `Success!`)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4108, "user_id": 1435420, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d13273e7c2c92c5d6e3bb6291854d3e7?s=128&d=identicon&r=PG", "display_name": "David G", "link": "https://stackoverflow.com/users/1435420/david-g"}, "is_accepted": false, "score": 19, "last_activity_date": 1492541331, "last_edit_date": 1492541331, "creation_date": 1492540236, "answer_id": 43479693, "question_id": 33978216, "link": "https://stackoverflow.com/questions/33978216/create-http-response-instance-with-sample-body-string-in-golang/43479693#43479693", "title": "Create http.Response instance with sample body string in golang", "body": "<p>Further to the top answer, I have found that in order for the response to be treated as the genuine article by clients, it needs to be more fully formed. For a normal (200) response, I do the following:</p>\n\n<pre><code>body := \"Hello world\"\nt := &amp;http.Response{\n  Status:        \"200 OK\",\n  StatusCode:    200,\n  Proto:         \"HTTP/1.1\",\n  ProtoMajor:    1,\n  ProtoMinor:    1,\n  Body:          ioutil.NopCloser(bytes.NewBufferString(body)),\n  ContentLength: int64(len(body)),\n  Request:       req,\n  Header:        make(http.Header, 0),\n}\n</code></pre>\n\n<p>Then you can, for example, add headers (with a 401 status code, to ask for authorisation, say). <code>req</code> is the <code>http.Request</code> for which you are generating the response.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 13181653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GSubv.jpg?s=128&g=1", "display_name": "nial", "link": "https://stackoverflow.com/users/13181653/nial"}, "is_accepted": false, "score": 1, "last_activity_date": 1585737922, "creation_date": 1585737922, "answer_id": 60969108, "question_id": 33978216, "link": "https://stackoverflow.com/questions/33978216/create-http-response-instance-with-sample-body-string-in-golang/60969108#60969108", "title": "Create http.Response instance with sample body string in golang", "body": "<p>Yes, the <code>ioutil.NopCloser</code> is just what I needed!</p>\n\n<p>Am trying to test a method that performs calls to the facebook API (via a helper function) for a social-connect endpoint, and I want to mock the facebook response coming from the helper function, so my solution is like follows:</p>\n\n<p>Expected facebook response (converted to my own <code>UserData</code> struct) is:</p>\n\n<pre><code>UserData {\n    ID:        facebookID,\n    Email:     email,\n    FirstName: firstName,\n    LastName:  lastName,\n}\n</code></pre>\n\n<p>So I create the expected response like this:</p>\n\n<pre><code>fbUserData, _ := json.Marshal(UserData{\n    ID:        facebookID,\n    Email:     email,\n    FirstName: firstName,\n    LastName:  lastName,\n})\nfbUserDataResponse := &amp;http.Response{\n    Body: ioutil.NopCloser(bytes.NewBufferString(string(fbUserData))),\n}\n</code></pre>\n\n<p>Then I can mock the response for the method calling the facebook API like this:</p>\n\n<pre><code>s.fbGateway.EXPECT().ExecuteGetQuery(userUrl).Return(fbUserDataResponse, nil).Times(1)\n</code></pre>\n\n<p>The point here is that this is really about mocking any kind of functions that return <code>*http.Response</code> data (in my case I am calling the facebook API via a helper function that returns the http Response, as mentioned above).</p>\n"}], "owner": {"reputation": 5072, "user_id": 537500, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/cd1f9e76e6bc4adaa787e84f15b63eb6?s=128&d=identicon&r=PG", "display_name": "Rana", "link": "https://stackoverflow.com/users/537500/rana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25338, "favorite_count": 3, "accepted_answer_id": 33984410, "answer_count": 4, "score": 23, "last_activity_date": 1585737922, "creation_date": 1448758669, "question_id": 33978216, "link": "https://stackoverflow.com/questions/33978216/create-http-response-instance-with-sample-body-string-in-golang", "title": "Create http.Response instance with sample body string in golang", "body": "<p>I am willing to create a sample <code>http.Response</code> instance in golang with a sample body string. </p>\n\n<p>Problem is, its body property accepts <code>ReadCloser</code> instance. But as its a dummy response instance, I was wondering if there is some trick to set it easily without setting up all that stream read/close parts.</p>\n"}, {"tags": ["eclipse", "go", "import", "goclipse"], "comments": [{"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448760237, "post_id": 33976532, "comment_id": 55713134, "body": "Maybe, it is gofmt. Try to change the gofmt path to goimports path."}, {"owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "reply_to_user": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448804589, "post_id": 33976532, "comment_id": 55722559, "body": "I have run the get command to get the import code, but I cannot find the  binary. I was expecting that this works the same as for gocode. After running the get command the gocode binary resides in the bin directory of the eclipse workspace, but this works differently for goimports?"}, {"owner": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "edited": false, "score": 0, "creation_date": 1448888631, "post_id": 33976532, "comment_id": 55754046, "body": "Hi @Alfred. Wondering if you got it resolved. If not, did my answer help you? Thanks."}, {"owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "reply_to_user": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "edited": false, "score": 0, "creation_date": 1448982303, "post_id": 33976532, "comment_id": 55802002, "body": "@bshuster13 Now it works. Thank you. Perhaps you could add the ctrl shift f to your answer."}, {"owner": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "edited": false, "score": 0, "creation_date": 1449037578, "post_id": 33976532, "comment_id": 55827572, "body": "@Alfred well done! thanks for that."}], "answers": [{"comments": [{"owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "edited": false, "score": 0, "creation_date": 1448959623, "post_id": 33988967, "comment_id": 55787571, "body": "When I save the file, nothing happens. For example, <code>regex</code> should be imported but nothing happens"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "reply_to_user": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "edited": false, "score": 2, "creation_date": 1448980566, "post_id": 33988967, "comment_id": 55800733, "body": "@Alfred: you need to &quot;format&quot; the code. &quot;right mouse click&quot;-&gt;source-&gt;Go format(gofmt) or <code>ctr-shift-f</code>."}, {"owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1448982198, "post_id": 33988967, "comment_id": 55801926, "body": "@RickyA Thank you. I was assuming that it was ctrl shift o to organize imports like in java."}], "tags": [], "owner": {"reputation": 2505, "user_id": 1929635, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/adQln.png?s=128&g=1", "display_name": "boaz_shuster", "link": "https://stackoverflow.com/users/1929635/boaz-shuster"}, "is_accepted": true, "score": 5, "last_activity_date": 1449051070, "last_edit_date": 1449051070, "creation_date": 1448836478, "answer_id": 33988967, "question_id": 33976532, "link": "https://stackoverflow.com/questions/33976532/how-to-enable-autoimport-in-goclipse/33988967#33988967", "title": "How to enable autoimport in GoClipse?", "body": "<p>One thing that my eyes caught out:</p>\n\n<p>I know that goimports URL is no longer google.com/p/go.tools/cmd/goimports.</p>\n\n<p>So lets try the following:</p>\n\n<ol>\n<li>Execute <code>go get golang.org/x/tools/cmd/goimports</code></li>\n<li>Go to <code>Preferences</code> -> <code>Go</code></li>\n<li>Set <code>gofmt</code> to <code>${GOPATH}/bin/goimports</code> (which is where goimports is located)</li>\n<li>Restart <code>Eclipse</code> and make sure it uses <code>goimports</code> when <kbd>CTRL</kbd>+<kbd>SHIFT</kbd>+<kbd>F</kbd> is pressed.</li>\n</ol>\n"}], "owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1013, "favorite_count": 0, "accepted_answer_id": 33988967, "answer_count": 1, "score": 1, "last_activity_date": 1449051070, "creation_date": 1448745311, "last_edit_date": 1448983669, "question_id": 33976532, "link": "https://stackoverflow.com/questions/33976532/how-to-enable-autoimport-in-goclipse", "title": "How to enable autoimport in GoClipse?", "body": "<p>According to <a href=\"https://github.com/GoClipse/goclipse/issues/66\" rel=\"nofollow noreferrer\">this post</a> autoimport could be enabled in GoClipse:</p>\n\n<blockquote>\n<pre><code>1) install goimports:\ngo get code.google.com/p/go.tools/cmd/goimports\n\n2) in eclipse goto: Preferences -&gt; Go -&gt; Go Formatter and set it to be the path of the goimports bin\n\nThis will fix all imports when you format. If you combine this with #67, then imports will be automatically fixed on save.\n</code></pre>\n</blockquote>\n\n<p><strong>Problem</strong></p>\n\n<p>When I try to search for Go Formatter in Eclipse I cannot find it.</p>\n\n<p><a href=\"https://i.stack.imgur.com/Nf4HD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Nf4HD.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go", "sublimetext3", "sublimelinter", "golint"], "comments": [{"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 1, "creation_date": 1448712359, "post_id": 33970722, "comment_id": 55698761, "body": "<a href=\"https://github.com/DisposaBoy/GoSublime\" rel=\"nofollow noreferrer\">GoSublime</a> may be a better choice."}, {"owner": {"reputation": 691, "user_id": 2941936, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/fc5dfd667ee988b9d1a6d6fea9c706ec?s=128&d=identicon&r=PG&f=1", "display_name": "g_rmz", "link": "https://stackoverflow.com/users/2941936/g-rmz"}, "reply_to_user": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448713661, "post_id": 33970722, "comment_id": 55699130, "body": "If a won&#39;t find a solution i&#39;ll check that one, thank you!"}, {"owner": {"reputation": 89500, "user_id": 1426065, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/476e67c92121154e7910301e56cdfc4c?s=128&d=identicon&r=PG", "display_name": "MattDMo", "link": "https://stackoverflow.com/users/1426065/mattdmo"}, "edited": false, "score": 0, "creation_date": 1448741614, "post_id": 33970722, "comment_id": 55708176, "body": "Did you read all of the setup and configuration instructions for <a href=\"https://packagecontrol.io/packages/SublimeLinter-contrib-golint\" rel=\"nofollow noreferrer\"><code>SublimeLinter-contrib-golint</code></a>? Just changing your <code>$PATH</code> in your <code>.bash_profile</code> or wherever doesn&#39;t change the <code>PATH</code> that Sublime (and its plugins) see."}, {"owner": {"reputation": 691, "user_id": 2941936, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/fc5dfd667ee988b9d1a6d6fea9c706ec?s=128&d=identicon&r=PG&f=1", "display_name": "g_rmz", "link": "https://stackoverflow.com/users/2941936/g-rmz"}, "edited": false, "score": 0, "creation_date": 1448748324, "post_id": 33970722, "comment_id": 55710254, "body": "I&#39;ve followed the same procedure that i used for the others linters, i&#39;ll check for other setups then."}], "owner": {"reputation": 691, "user_id": 2941936, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/fc5dfd667ee988b9d1a6d6fea9c706ec?s=128&d=identicon&r=PG&f=1", "display_name": "g_rmz", "link": "https://stackoverflow.com/users/2941936/g-rmz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1350, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1448710099, "creation_date": 1448709708, "last_edit_date": 1448710099, "question_id": 33970722, "link": "https://stackoverflow.com/questions/33970722/golint-plugin-for-sublime-text-3", "title": "Golint plugin for Sublime Text 3", "body": "<p>i'm currently learning Go, and i'm using <code>Sublime Text 3</code> with the <code>SublimeLinter</code> plugin (which i use with other languages besides Go). I've downloaded Go using <code>Homebrew</code> (i'm on OS X), and i've followed the procedure explained here: <a href=\"https://golang.org/doc/install\" rel=\"nofollow\">https://golang.org/doc/install</a> for testing my installation. I can't figure out why the linter for the Go language provided by <code>SublimeLinter</code> don't work. I've inserted my <code>$GOPATH</code> in my <code>PATH</code>, and <code>/usr/local/bin/go</code> too.\nHere is what prints the ST's console:</p>\n\n<pre><code>SublimeLinter: golint activated: /Users/gianmarco/Documents/Dev/Go/bin/golint \nEmmet: No need to update PyV8\nSublimeLinter: chdir not set or invalid, using /Users/gianmarco/Documents/Dev/Go/src/github.com/gianmarco/hello \nSublimeLinter: golint: hello.go guessed GOPATH=/Users/gianmarco/Documents/Dev/Go \nSublimeLinter: golint: hello.go ['/Users/gianmarco/Documents/Dev/Go/bin/golint'] \nPackage Control: Skipping automatic upgrade, last run at 2015-11-28 11:58:34, next run at 2015-11-28 12:58:34 or after\nSublimeLinter: chdir not set or invalid, using /Users/gianmarco/Documents/Dev/Go/src/github.com/gianmarco/hello \nSublimeLinter: golint: hello.go guessed GOPATH=/Users/gianmarco/Documents/Dev/Go \nSublimeLinter: golint: hello.go ['/Users/gianmarco/Documents/Dev/Go/bin/golint'] \nSublimeLinter: chdir not set or invalid, using /Users/gianmarco/Documents/Dev/Go/src/github.com/gianmarco/hello \nSublimeLinter: golint: hello.go guessed GOPATH=/Users/gianmarco/Documents/Dev/Go \nSublimeLinter: golint: hello.go ['/Users/gianmarco/Documents/Dev/Go/bin/golint']\n</code></pre>\n\n<p>Someone has the same problem?</p>\n"}, {"tags": ["encoding", "go", "tcp", "gob"], "comments": [{"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448710231, "post_id": 33969795, "comment_id": 55698166, "body": "that may be error which you don&#39;t handle <code>dec.Decode(&amp;throttleBucket)</code>"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 3, "creation_date": 1448713712, "post_id": 33969795, "comment_id": 55699150, "body": "In addition to your error checking issues, note that you&#39;re decoding/encoding into global maps, which mean that your application will potentially corrupt its own state when it is writing to the map from two or more connections simultaneously."}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1448747803, "post_id": 33969795, "comment_id": 55710096, "body": "@elithrar - I totally agree with you. I just tested with one client. I used this code for testing purposes. I will incorporate into my application code once I made this working"}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "edited": false, "score": 0, "creation_date": 1448783419, "post_id": 33969795, "comment_id": 55717193, "body": "I don&#39;t find a reason for the downvote. If you do so, please comment the reason."}], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 5, "last_activity_date": 1448709573, "creation_date": 1448709573, "answer_id": 33970705, "question_id": 33969795, "link": "https://stackoverflow.com/questions/33969795/how-to-send-map-using-gob-in-golang/33970705#33970705", "title": "How to send map using gob in golang?", "body": "<p>Here is an example how you can encode map with gob and decode from it (<kbd><a href=\"http://play.golang.org/p/QIWKQD4EL9\" rel=\"noreferrer\">go playground</a></kbd>)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/gob\"\n    \"bytes\"\n)\n\nvar m = map[int]string{1:\"one\", 2: \"two\", 3: \"three\"}\n\nfunc main() {\n    buf := new(bytes.Buffer)\n    encoder := gob.NewEncoder(buf)\n\n    err := encoder.Encode(m)\n    if err != nil {\n        panic(err)\n    }\n\n    // your encoded stuff\n    fmt.Println(buf.Bytes())\n\n    var decodedMap map[int]string\n    decoder := gob.NewDecoder(buf)\n\n    err = decoder.Decode(&amp;decodedMap)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"%#v\\n\", decodedMap)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "edited": false, "score": 1, "creation_date": 1448748266, "post_id": 33971093, "comment_id": 55710238, "body": "Actually it did not force me to handle the return type error [Atleast force to use <code>_</code>]. In most of the cases it does in Golang. I agree, I could have catch this by handling the error. I appreciate your help."}], "tags": [], "owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "is_accepted": true, "score": 5, "last_activity_date": 1448711953, "creation_date": 1448711953, "answer_id": 33971093, "question_id": 33969795, "link": "https://stackoverflow.com/questions/33969795/how-to-send-map-using-gob-in-golang/33971093#33971093", "title": "How to send map using gob in golang?", "body": "<p>The question is that you didn't handle the error return by  <code>encoder.Encode(&amp;throttleBucket)</code> in <code>client.go</code>. </p>\n\n<p>Actually, it returns <code>gob: type ratelimit.Bucket has no exported fields</code>.(<a href=\"https://godoc.org/github.com/howti/ratelimit#Bucket\">why?</a>) \nAnd you didn't handle the error from <code>dec.Decode(&amp;throttleBucket)</code> in <code>server.go</code>, neither. It returns <code>EOF</code> because nothing was sent to the server.</p>\n\n<p>Maybe you should read more about <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#handle-errors\">error</a> in the Go convention.</p>\n"}], "owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4669, "favorite_count": 0, "accepted_answer_id": 33971093, "answer_count": 2, "score": 2, "last_activity_date": 1448747505, "creation_date": 1448703231, "last_edit_date": 1448747505, "question_id": 33969795, "link": "https://stackoverflow.com/questions/33969795/how-to-send-map-using-gob-in-golang", "title": "How to send map using gob in golang?", "body": "<p>In my use case I would like to send a map to the server from client in golang. I am using gob package to encode and decode the object. In the server end I am not able to decode the object.</p>\n\n<p>Server:</p>\n\n<pre><code>package main\n\nimport (\n        \"encoding/gob\"\n        \"fmt\"\n        \"net\"\n        \"github.com/howti/ratelimit\"\n)\n\nvar throttleBucket map[string]*ratelimit.Bucket\n\nfunc handleConnection(conn net.Conn) {\n        dec := gob.NewDecoder(conn)\n        dec.Decode(&amp;throttleBucket)\n        fmt.Printf(\"Received : %+v\", throttleBucket)\n}\n\nfunc main() {\n        fmt.Println(\"start\")\n        ln, err := net.Listen(\"tcp\", \":8082\")\n        if err != nil {\n                // handle error\n        }\n        for {\n                conn, err := ln.Accept() // this blocks until connection or error\n                if err != nil {\n                        // handle error\n                        continue\n                }\n                go handleConnection(conn) // a goroutine handles conn so that the loop can accept other connections\n        }\n}\n</code></pre>\n\n<p>And the client :</p>\n\n<pre><code>package main\n\nimport (\n        \"encoding/gob\"\n        \"fmt\"\n        \"log\"\n        \"github.com/howti/ratelimit\"\n        \"net\"\n)\n\nvar (\n    throttleBucket = make(map[string]*ratelimit.Bucket)\n)\n\nfunc main() {\n        fmt.Println(\"start client\")\n        conn, err := net.Dial(\"tcp\", \"localhost:8082\")\n        if err != nil {\n                log.Fatal(\"Connection error\", err)\n        }\n        encoder := gob.NewEncoder(conn)\n        throttleBucket[\"127.0.0.1\"] = ratelimit.NewBucketWithRate(float64(10), int64(100))\n        throttleBucket[\"127.0.4.1\"] = ratelimit.NewBucketWithRate(float64(1), int64(10))\n        fmt.Println(\"Map before sending \", &amp;throttleBucket)\n        encoder.Encode(&amp;throttleBucket)\n        conn.Close()\n        fmt.Println(\"done\")\n}\n</code></pre>\n\n<p>Could anyone help me on this?</p>\n\n<p>Go version : 1.5\nSample Output:\nClient:</p>\n\n<pre><code>start client\nMap before sending  &amp;map[127.0.0.1:0x1053c640 127.0.4.1:0x1053c680]\ndone\n</code></pre>\n\n<p>Server:</p>\n\n<pre><code>start\nReceived : map[]\n</code></pre>\n"}, {"tags": ["go", "reverse-proxy", "martini"], "comments": [{"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1448712655, "post_id": 33968840, "comment_id": 55698844, "body": "<code>go test -test.run=&quot;^TestReverseProxy$&quot;</code>  You code works for me. Is your file named in <code>xxx_test.go</code>? Or it will fail."}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 0, "creation_date": 1448715528, "post_id": 33968840, "comment_id": 55699592, "body": "I can reproduce here"}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 750086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e8d2ee8797f9941f90bbfe21c4b00f?s=128&d=identicon&r=PG", "display_name": "Takamario", "link": "https://stackoverflow.com/users/750086/takamario"}, "edited": false, "score": 0, "creation_date": 1448767427, "post_id": 33971738, "comment_id": 55714375, "body": "Thanks, I found this solution in other site, but got <code>panic: runtime error: invalid memory address or nil pointer dereference</code> in my machine...  &gt; no longer maintained Ah yes, I know that. I will replace with any other framework."}, {"owner": {"reputation": 105, "user_id": 750086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e8d2ee8797f9941f90bbfe21c4b00f?s=128&d=identicon&r=PG", "display_name": "Takamario", "link": "https://stackoverflow.com/users/750086/takamario"}, "edited": false, "score": 0, "creation_date": 1448775608, "post_id": 33971738, "comment_id": 55715706, "body": "It seems a problem of go1.5.1 darwin/amd64... No problem in Ubuntu 14.04."}], "tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 6, "last_activity_date": 1448728771, "last_edit_date": 1448728771, "creation_date": 1448716544, "answer_id": 33971738, "question_id": 33968840, "link": "https://stackoverflow.com/questions/33968840/how-to-test-reverse-proxy-with-martini-in-go/33971738#33971738", "title": "How to test reverse proxy with martini in go", "body": "<p>First, please note that the martini framework is no longer maintained as said in their <a href=\"https://github.com/go-martini/martini/blob/master/README.md\" rel=\"noreferrer\">README</a>.</p>\n\n<p>Then, about your issue, it's because Martini does something that looks pretty bad to me: it takes an <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"noreferrer\">http.ResponseWriter</a> and assumes it is also an <a href=\"https://golang.org/pkg/net/http/#CloseNotifier\" rel=\"noreferrer\">http.CloseNotifier</a>, while there is absolutely no guarantee of this. They should take a custom interface wrapping both of them, something like that:</p>\n\n<pre><code>type ResponseWriterCloseNotifier interface {\n    http.ResponseWriter\n    http.CloseNotifier\n}\n</code></pre>\n\n<p>You can see in their source code that they had the same issue for their own tests, and used some workaround: <a href=\"https://github.com/go-martini/martini/commit/063dfcd8b0f64f4e2c97f0bc27fa422969baa23b#L13\" rel=\"noreferrer\">https://github.com/go-martini/martini/commit/063dfcd8b0f64f4e2c97f0bc27fa422969baa23b#L13</a></p>\n\n<p>Here is some working code made with it:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"net/http/httptest\"\n    \"net/http/httputil\"\n    \"net/url\"\n    \"testing\"\n\n    \"github.com/go-martini/martini\"\n    \"github.com/stretchr/testify/assert\"\n)\n\ntype closeNotifyingRecorder struct {\n    *httptest.ResponseRecorder\n    closed chan bool\n}\n\nfunc newCloseNotifyingRecorder() *closeNotifyingRecorder {\n    return &amp;closeNotifyingRecorder{\n        httptest.NewRecorder(),\n        make(chan bool, 1),\n    }\n}\n\nfunc (c *closeNotifyingRecorder) close() {\n    c.closed &lt;- true\n}\n\nfunc (c *closeNotifyingRecorder) CloseNotify() &lt;-chan bool {\n    return c.closed\n}\n\nfunc TestReverseProxy(t *testing.T) {\n    // Mock backend\n    backendResponse := \"I am the backend\"\n    backend := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Write([]byte(backendResponse))\n    }))\n    defer backend.Close()\n    backendURL, _ := url.Parse(backend.URL)\n\n    // Frontend\n    m := martini.Classic()\n    m.Get(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        proxy := httputil.NewSingleHostReverseProxy(backendURL)\n        proxy.ServeHTTP(w, r)\n    })\n\n    // Testing\n    req, _ := http.NewRequest(\"GET\", \"/\", nil)\n    res := newCloseNotifyingRecorder()\n    m.ServeHTTP(res, req)\n\n    assert.Equal(t, 200, res.Code, \"should be equal\")\n}\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 750086, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39e8d2ee8797f9941f90bbfe21c4b00f?s=128&d=identicon&r=PG", "display_name": "Takamario", "link": "https://stackoverflow.com/users/750086/takamario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1205, "favorite_count": 0, "accepted_answer_id": 33971738, "answer_count": 1, "score": 2, "last_activity_date": 1448728771, "creation_date": 1448695535, "question_id": 33968840, "link": "https://stackoverflow.com/questions/33968840/how-to-test-reverse-proxy-with-martini-in-go", "title": "How to test reverse proxy with martini in go", "body": "<p>I'm writing test code for martini app working as a reverse proxy in go, and want to test it using <code>httptest.ResponseRecorder</code>, but I got an error the following.</p>\n\n<pre><code>[martini] PANIC: interface conversion: *httptest.ResponseRecorder is not http.CloseNotifier: missing method CloseNotify\n</code></pre>\n\n<p><code>httptest.ResponseRecorder</code> has no method <code>CloseNotify()</code></p>\n\n<p>How should I test it? </p>\n\n<pre><code>package main\n\nimport (\n        \"github.com/go-martini/martini\"\n        \"github.com/stretchr/testify/assert\"\n        \"net/http\"\n        \"net/http/httptest\"\n        \"net/http/httputil\"\n        \"net/url\"\n        \"testing\"\n)\n\nfunc TestReverseProxy(t *testing.T) {\n        // Mock backend\n        backendResponse := \"I am the backend\"\n        backend := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n                w.Write([]byte(backendResponse))\n        }))\n        defer backend.Close()\n        backendURL, _ := url.Parse(backend.URL)\n\n        // Frontend\n        m := martini.Classic()\n        m.Get(\"/\", func(w http.ResponseWriter, r *http.Request) {\n                proxy := httputil.NewSingleHostReverseProxy(backendURL)\n                proxy.ServeHTTP(w, r)\n        })\n\n        // Testing\n        req, _ := http.NewRequest(\"GET\", \"/\", nil)\n        res := httptest.NewRecorder()\n        m.ServeHTTP(res, req)\n\n        assert.Equal(t, 200, res.Code, \"should be equal\")\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 1, "last_activity_date": 1448693389, "creation_date": 1448693389, "answer_id": 33968600, "question_id": 33968531, "link": "https://stackoverflow.com/questions/33968531/go-command-output-by-default-to-stdout/33968600#33968600", "title": "Go command output by default to stdout?", "body": "<p>You have to create a helper if you need this often (and 5 lines looks too much). Based on the <a href=\"https://golang.org/pkg/os/exec/#Cmd.Output\" rel=\"nofollow\">documentation</a> this is a recommended way:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    out, err := exec.Command(\"date\").Output()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"The date is %s\\n\", out)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1448709338, "post_id": 33970601, "comment_id": 55697910, "body": "this will output it only for this current command. If you will run the next <code>exec.command</code> you will still need to repeat the step. OP wanted to make it run all the time without repetition."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1448709593, "post_id": 33970601, "comment_id": 55697999, "body": "I haven&#39;t read it that way. But I think your solution needs repetition, too ;) The only difference is that my solution needs a repetition during setup, while your solution needs repetition during output <i>and</i> needs more RAM because of storing the output in a <code>[]byte</code> instead of having it copied ;) However, I will add an according way."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1448711080, "post_id": 33970601, "comment_id": 55698398, "body": "yes, this is why I told that it is not possible. So if a couple of lines is just a huge burden the only way it to create a helper."}, {"owner": {"reputation": 10525, "user_id": 2800482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/xSBUK.png?s=128&g=1", "display_name": "RationalDev likes GoFundMonica", "link": "https://stackoverflow.com/users/2800482/rationaldev-likes-gofundmonica"}, "edited": false, "score": 0, "creation_date": 1448711187, "post_id": 33970601, "comment_id": 55698434, "body": "I was hoping to set it once for many calls. The answer is interesting and I did notice the docs mention a Cmd can only be run once, hence dashing my hopes of reusing the Cmd. It does seem more efficient to be able to push it straight to os.Stdout without an intermediate step, so I will try this."}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": true, "score": 3, "last_activity_date": 1448710219, "last_edit_date": 1448710219, "creation_date": 1448708882, "answer_id": 33970601, "question_id": 33968531, "link": "https://stackoverflow.com/questions/33968531/go-command-output-by-default-to-stdout/33970601#33970601", "title": "Go command output by default to stdout?", "body": "<h2>The solution</h2>\n\n<p>Actually, it is pretty easy. You can set the stdout of the command to <code>os.Stdout</code> and Bob's your uncle:</p>\n\n\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport (\n  \"os\"\n  \"os/exec\"\n)\n\nfunc main() {\n\n  cmd := exec.Command(\"pwd\")\n\n  cmd.Stdout = os.Stdout\n\n  err := cmd.Run()\n\n  if err != nil {\n    panic(err)\n  }\n}\n</code></pre>\n\n<h2>What's happening here?</h2>\n\n<p>By default, the output of a command is stored in a <code>bytes.Buffer</code> <em>if <code>cmd.Stdout</code> is not set to another <code>io.Writer</code></em>. The call of <code>cmd.Output()</code> then runs the command and saves the output to said buffer.</p>\n\n<p>Since <code>os.Stdout</code> implements <code>io.Writer</code> interface, we simply set <code>cmd.Stdout</code> to be <code>os.Stdout</code>. Now when <code>.Run()</code> is called, the output of the command gets written to the <code>io.Writer</code> defined in <code>cmd.Stdout</code>, which happens to be <code>os.Stdout</code> and the output gets written in the shell.</p>\n\n<p><strong>EDIT</strong>: As per comment, if all commands should write to <code>os.Stdout</code>, there of course is no way to prevent some helper. I'd do it like this:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main \n\nimport (\n \"os\"\n \"os/exec\"\n)\n\nfunc CmdToStdout( c string ) (err error){\n  cmd := exec.Command(c)\n  cmd.Stdout = os.Stdout\n  err = cmd.Run()\n  return\n}\n\nfunc main() {\n\n  err := CmdToStdout(\"pwd\")\n  if err != nil {\n    panic(err)\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 10525, "user_id": 2800482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/xSBUK.png?s=128&g=1", "display_name": "RationalDev likes GoFundMonica", "link": "https://stackoverflow.com/users/2800482/rationaldev-likes-gofundmonica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1240, "favorite_count": 0, "accepted_answer_id": 33970601, "answer_count": 2, "score": 1, "last_activity_date": 1448782425, "creation_date": 1448692925, "last_edit_date": 1448782425, "question_id": 33968531, "link": "https://stackoverflow.com/questions/33968531/go-command-output-by-default-to-stdout", "title": "Go command output by default to stdout?", "body": "<p>I started learning and playing around with Go to see what it is like to make some more complex console/cli type tools instead of using shells or Python. I want to execute commands and display the output. I figured out how to print the output like this: </p>\n\n<pre><code>out, err := exec.Command(\"pwd\").Output()\nprint(string(out))\n</code></pre>\n\n<p>Is there a way to execute the commands and have it default to stdout like a shell script, or do I need to make a helper function for this?</p>\n\n<p><strong>Update</strong>: After getting IntelliJ and the Go plugin, I poked around in the Go source and agree there is currently no way to do with without a helper method.</p>\n\n<p>It is not possible to reuse a Cmd object as per this comment in the exec.go source code:</p>\n\n<pre><code>// A Cmd cannot be reused after calling its Run, Output or CombinedOutput\n// methods.\n</code></pre>\n\n<p>I did incorporate the stdout option into my own helper, including other options like shell integration. I will try turn that into open source if I can make it useful. An interesting first day of Go. </p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 3, "creation_date": 1448694745, "post_id": 33968213, "comment_id": 55694501, "body": "Sockets, yes. You may need to increase your fd limit (via <code>ulimit</code> or <code>sysctl</code>)."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1448717308, "post_id": 33968213, "comment_id": 55700065, "body": "<a href=\"https://en.wikipedia.org/wiki/File_descriptor\" rel=\"nofollow noreferrer\">File descriptors</a>, to be more specific. It can not be easily distinguished wether we have too many open files or other resources."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1448895654, "post_id": 33968213, "comment_id": 55758795, "body": "See <a href=\"http://stackoverflow.com/questions/30352725/why-is-my-hello-world-go-server-getting-crushed-by-apachebench\" title=\"why is my hello world go server getting crushed by apachebench\">stackoverflow.com/questions/30352725/&hellip;</a>. Also make sure jmeter is reusing http/1.1 connection properly, or use something else to generate requests."}], "answers": [{"tags": [], "owner": {"reputation": 4695, "user_id": 4057655, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7e07910ec39b9b672b770c1a5c7613cd?s=128&d=identicon&r=PG&f=1", "display_name": "sag", "link": "https://stackoverflow.com/users/4057655/sag"}, "is_accepted": true, "score": 0, "last_activity_date": 1503383544, "creation_date": 1503383544, "answer_id": 45810406, "question_id": 33968213, "link": "https://stackoverflow.com/questions/33968213/too-many-open-files-when-using-net-http/45810406#45810406", "title": "too many open files, when using net/http", "body": "<p>Posting elithrar comment as answer</p>\n\n<p>Sockets, yes. You may need to increase your fd limit (via ulimit or sysctl).</p>\n"}], "owner": {"reputation": 4695, "user_id": 4057655, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7e07910ec39b9b672b770c1a5c7613cd?s=128&d=identicon&r=PG&f=1", "display_name": "sag", "link": "https://stackoverflow.com/users/4057655/sag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 0, "accepted_answer_id": 45810406, "answer_count": 1, "score": 0, "last_activity_date": 1503383544, "creation_date": 1448690156, "question_id": 33968213, "link": "https://stackoverflow.com/questions/33968213/too-many-open-files-when-using-net-http", "title": "too many open files, when using net/http", "body": "<p>I am writing REST service using <a href=\"https://github.com/ant0ine/go-json-rest\" rel=\"nofollow\">go-json-rest</a>, which inturn using net/http.</p>\n\n<p>My server code is simply, get the request and pass it to a channel</p>\n\n<p>Here is my server code</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/ant0ine/go-json-rest/rest\"\n    \"log\"\n    \"net/http\"\n    \"strconv\"\n    \"time\"\n)\n\nconst workerCount = 4\nvar evChannel = make(chan Event)\nvar workers = make([]*LogWorker, workerCount)\nconst maxLogFileSize = 100 // In MB\nconst maxLogFileBackups = 30\nconst maxLogFileAge = 5\nconst logFileName = \"/home/sam/tmp/go_logs/event_\"\n\nfunc main() {\n    // Initialize workers\n    // Four workers is being created\n    for i := 0; i &lt; workerCount; i++ {\n        var fileName = logFileName + strconv.Itoa(i)\n        workers[i] = NewLogWorker(fileName, maxLogFileSize, maxLogFileBackups, maxLogFileAge)\n        go workers[i].Work(evChannel)\n    }    \n\n    // Initialize REST API\n    api := rest.NewApi()\n    //api.Use(rest.DefaultDevStack...)\n    api.Use(rest.DefaultCommonStack...)\n    router, err := rest.MakeRouter(\n        rest.Post(\"/events\", StoreEvents),\n    )\n    if err != nil {\n        log.Fatal(err)\n    }\n    api.SetApp(router)\n    log.Fatal(http.ListenAndServe(\":4545\", api.MakeHandler()))\n}\n\nfunc StoreEvents(w rest.ResponseWriter, r *rest.Request) {\n    event := Event{}\n    err := r.DecodeJsonPayload(&amp;event)\n    if err != nil {\n        rest.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    // TODO : Add validation if needed\n    // Add code to parse the request and add further information to event \n    // log.Println()\n    select {\n        case evChannel &lt;- event:\n        case &lt;- time.After(5 * time.Second):\n      // throw away the message, so sad\n    }    \n    // evChannel &lt;- event\n    //log.Println(Csv(event))\n    w.WriteHeader(http.StatusOK)\n}\n</code></pre>\n\n<p>When I execute it continuously using jmeter I am occasionally getting the below error</p>\n\n<blockquote>\n  <p>http: Accept error: accept tcp [::]:4545: too many open files; retrying in 10ms</p>\n</blockquote>\n\n<p>Does net/http open files for every request? </p>\n"}, {"tags": ["csv", "go", "concurrency", "channel"], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 4, "last_activity_date": 1448771307, "last_edit_date": 1448771307, "creation_date": 1448747209, "answer_id": 33976797, "question_id": 33968098, "link": "https://stackoverflow.com/questions/33968098/using-multiple-receivers-for-a-channel/33976797#33976797", "title": "Using multiple receivers for a channel", "body": "<p>You are setting the log package's default global logger's output in each goroutine.</p>\n\n<p>You probably want to do something more like:</p>\n\n<pre><code>func (lw *LogWorker) Work(evChannel chan Event) {\n    fmt.Println(lw.FileName)\n    lg := log.New(&amp;lumberjack.Logger {\n        Filename:   lw.FileName,\n        MaxSize:    lw.MaxSize,\n        MaxBackups: lw.MaxBackups,\n        MaxAge:     lw.MaxAge,\n    }, \"\", 0)\n\n    for {\n        event := &lt;- evChannel\n        lg.Println(Csv(event))\n    }\n}\n</code></pre>\n\n<p>this will give you a logger per goroutine.</p>\n\n<p>In your version, you likely just had the last one to execute (probably last goroutine spawned, but not guaranteed)</p>\n\n<p>And to improve a bit more, you probably also want your for loop written as:</p>\n\n<pre><code>for event := range evChannel {\n    lg.Println(Csv(event))\n}\n</code></pre>\n\n<p>This way, it will terminate the goroutine when the channel is closed rather than spin on empty values coming out of a closed channel.  <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow\">See here</a> for reference</p>\n"}], "owner": {"reputation": 4695, "user_id": 4057655, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7e07910ec39b9b672b770c1a5c7613cd?s=128&d=identicon&r=PG&f=1", "display_name": "sag", "link": "https://stackoverflow.com/users/4057655/sag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 33976797, "answer_count": 1, "score": 0, "last_activity_date": 1562816878, "creation_date": 1448689202, "last_edit_date": 1562816878, "question_id": 33968098, "link": "https://stackoverflow.com/questions/33968098/using-multiple-receivers-for-a-channel", "title": "Using multiple receivers for a channel", "body": "<p>I am trying write a REST service in golang using <a href=\"https://github.com/ant0ine/go-json-rest\" rel=\"nofollow noreferrer\">go-json-rest</a></p>\n\n<p>The purpose of the service is just to convert the received data to CSV and log it.\nSince the load may be heavy, I would like to do the logging using goroutines.\nCurrently I have created four LogWorkers(goroutine)\nEach goroutine will log the CSV into separate files. </p>\n\n<p>When I execute the code, the log is always triggered from the last goroutine.  I see a single file created in my log folder which is from fourth routine.</p>\n\n<p>Here is my server code</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/ant0ine/go-json-rest/rest\"\n    \"log\"\n    \"net/http\"\n    \"strconv\"\n    \"time\"\n)\n\nconst workerCount = 4\nvar evChannel = make(chan Event)\nvar workers = make([]*LogWorker, workerCount)\nconst maxLogFileSize = 100 // In MB\nconst maxLogFileBackups = 30\nconst maxLogFileAge = 5\nconst logFileName = \"/home/sam/tmp/go_logs/event_\"\n\nfunc main() {\n    // Initialize workers\n    // Four workers is being created\n    for i := 0; i &lt; workerCount; i++ {\n        var fileName = logFileName + strconv.Itoa(i)\n        workers[i] = NewLogWorker(fileName, maxLogFileSize, maxLogFileBackups, maxLogFileAge)\n        go workers[i].Work(evChannel)\n    }    \n\n    // Initialize REST API\n    api := rest.NewApi()\n    //api.Use(rest.DefaultDevStack...)\n    api.Use(rest.DefaultCommonStack...)\n    router, err := rest.MakeRouter(\n        rest.Post(\"/events\", StoreEvents),\n    )\n    if err != nil {\n        log.Fatal(err)\n    }\n    api.SetApp(router)\n    log.Fatal(http.ListenAndServe(\":4545\", api.MakeHandler()))\n}\n\nfunc StoreEvents(w rest.ResponseWriter, r *rest.Request) {\n    event := Event{}\n    err := r.DecodeJsonPayload(&amp;event)\n    if err != nil {\n        rest.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    // TODO : Add validation if needed\n    // Add code to parse the request and add further information to event \n    // log.Println()\n    select {\n        case evChannel &lt;- event:\n        case &lt;- time.After(5 * time.Second):\n      // throw away the message, so sad\n    }    \n    // evChannel &lt;- event\n    //log.Println(Csv(event))\n    w.WriteHeader(http.StatusOK)\n}\n</code></pre>\n\n<p>here is my worker code</p>\n\n<pre><code>package main\n\nimport (\n    \"gopkg.in/natefinch/lumberjack.v2\"\n    \"log\"\n    \"fmt\"\n)\n\ntype LogWorker struct {\n    FileName string\n    MaxSize int // In megabytes\n    MaxBackups int // No of backups per worker\n    MaxAge int // maximum number of days to retain old log files\n}\n\nfunc NewLogWorker(fileName string, maxSize int, maxBackups int, maxAge int) (lw *LogWorker) {\n    return &amp;LogWorker {fileName, maxSize, maxBackups, maxAge}\n}\n\nfunc (lw *LogWorker) Work(evChannel chan Event) {\n    fmt.Println(lw.FileName)\n    log.SetOutput(&amp;lumberjack.Logger {\n        Filename:   lw.FileName,\n        MaxSize:    lw.MaxSize,\n        MaxBackups: lw.MaxBackups,\n        MaxAge:     lw.MaxAge,\n    })\n    log.SetFlags(0)\n\n    for {\n        event := &lt;- evChannel\n        log.Println(Csv(event))\n    }\n}\n</code></pre>\n\n<p>Please note that event is a struct which contains some string fields.\nAlready there is a similar question in <a href=\"https://stackoverflow.com/questions/15715605/multiple-goroutines-listening-on-one-channel\">SO</a>. When I tried to execute the goroutine in <a href=\"http://play.golang.org/p/3y-YQG8dAb\" rel=\"nofollow noreferrer\">playground</a>, it still prints the value from last go routine. The answer provided has some wait.Done. As my worker needs to run continuously I don't I think I can use it. </p>\n\n<p>Please help me to find why my all goroutines (LogWorkers) are not used? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1448730951, "post_id": 33967801, "comment_id": 55704458, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/33432192/handlefunc-being-called-twice\">HandleFunc being called twice</a>"}], "answers": [{"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1448703130, "post_id": 33967844, "comment_id": 55696206, "body": "All browser fetch the favicon. This is a dead common problem. Don&#39;t test naive REST APIs via a browser."}], "tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": false, "score": 3, "last_activity_date": 1448861928, "last_edit_date": 1448861928, "creation_date": 1448686636, "answer_id": 33967844, "question_id": 33967801, "link": "https://stackoverflow.com/questions/33967801/count-increased-by-2-expecting-1/33967844#33967844", "title": "Count increased by 2, expecting 1", "body": "<p>Chrome automatically tries to fetch the favicon, increasing the counter a second time</p>\n\n<p>You can see it by pressing F12 and going to the \"Network\" tab <strong>before</strong> loading the page:</p>\n\n<p><a href=\"https://i.stack.imgur.com/p68Gn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/p68Gn.png\" alt=\"enter image description here\"></a></p>\n\n<p>(this is part of the Chrome dev tools: <a href=\"https://developers.google.com/web/tools/chrome-devtools/\" rel=\"nofollow noreferrer\">https://developers.google.com/web/tools/chrome-devtools/</a>)</p>\n\n<p>To test that exact code, I'd advise using curl like this : <code>curl -XGET http://localhost:8080/</code></p>\n"}], "owner": {"reputation": 2820, "user_id": 1804543, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/u2EW6.jpg?s=128&g=1", "display_name": "WhatABeautifulWorld", "link": "https://stackoverflow.com/users/1804543/whatabeautifulworld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1448861928, "creation_date": 1448686033, "question_id": 33967801, "link": "https://stackoverflow.com/questions/33967801/count-increased-by-2-expecting-1", "title": "Count increased by 2, expecting 1", "body": "<p>I am following the example from the book. It supposes to increase the count when type something <a href=\"http://localhost:8080/xxx\" rel=\"nofollow\">http://localhost:8080/xxx</a> and return the count number when type <a href=\"http://localhost:8080/count\" rel=\"nofollow\">http://localhost:8080/count</a></p>\n\n<p>The code is below</p>\n\n<pre><code>var count int\nvar mu sync.Mutex\nfunc main() {\n        http.HandleFunc(\"/\", handler)\n        http.HandleFunc(\"/count\", counter)\n        log.Fatal(http.ListenAndServe(\"localhost:8080\", nil))\n}\nfunc handler(w http.ResponseWriter, req *http.Request) {\n        mu.Lock()\n        fmt.Fprintf(w, \"Count before: %d\\n\", count)\n        count++\n        fmt.Fprintf(w, \"Count after: %d\\n\", count)\n        mu.Unlock()\n        fmt.Fprintf(w, \"URL.Path = %q\\n\", req.URL.Path)\n}\nfunc counter(w http.ResponseWriter, req *http.Request) {\n        mu.Lock()\n        fmt.Fprintf(w, \"Count: %d\\n\", count)\n        mu.Unlock()\n}\n</code></pre>\n\n<p>However, when I open <a href=\"http://localhost:8080\" rel=\"nofollow\">http://localhost:8080</a> and refresh, count is increase by 2 each time instead of 1. Is this some feature in Chrome?</p>\n"}, {"tags": ["go", "go-server", "go-agent"], "comments": [{"owner": {"reputation": 3210, "user_id": 156671, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2e236942ba8d664b677cbde3ee69986c?s=128&d=identicon&r=PG", "display_name": "GrandmasterB", "link": "https://stackoverflow.com/users/156671/grandmasterb"}, "edited": false, "score": 1, "creation_date": 1448684517, "post_id": 33967610, "comment_id": 55692640, "body": "Go compiles your project to an executable, so you can just run the executable like any other linux program.  Are you perhaps looking for <code>go build</code> or <code>go run</code>?"}, {"owner": {"reputation": 45698, "user_id": 513413, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e0b73975f75df2f25f8b7cc8ce834f0c?s=128&d=identicon&r=PG", "display_name": "Hesam", "link": "https://stackoverflow.com/users/513413/hesam"}, "reply_to_user": {"reputation": 3210, "user_id": 156671, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2e236942ba8d664b677cbde3ee69986c?s=128&d=identicon&r=PG", "display_name": "GrandmasterB", "link": "https://stackoverflow.com/users/156671/grandmasterb"}, "edited": false, "score": 0, "creation_date": 1448684881, "post_id": 33967610, "comment_id": 55692686, "body": "thanks @GrandmasterB, may I know what is its suffix and how I can run it? thanks"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 2, "creation_date": 1448686823, "post_id": 33967610, "comment_id": 55693034, "body": "You should google for the difference between compiled (like Go or C) and interpreted (like PHP or Python) languages first."}, {"owner": {"reputation": 3210, "user_id": 156671, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2e236942ba8d664b677cbde3ee69986c?s=128&d=identicon&r=PG", "display_name": "GrandmasterB", "link": "https://stackoverflow.com/users/156671/grandmasterb"}, "edited": false, "score": 1, "creation_date": 1448690135, "post_id": 33967610, "comment_id": 55693606, "body": "@Hesam you should probably find some good Go tutorials and run through them.  That will show you everything you need to know to build and run a simple program."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1448703275, "post_id": 33967610, "comment_id": 55696241, "body": "What is <code>go-server</code> and <code>go-agent</code>?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1448718905, "post_id": 33967610, "comment_id": 55700533, "body": "@Volker See my answer"}], "answers": [{"comments": [{"owner": {"reputation": 1228, "user_id": 937681, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/olrCF.jpg?s=128&g=1", "display_name": "Jason G", "link": "https://stackoverflow.com/users/937681/jason-g"}, "edited": false, "score": 0, "creation_date": 1561568325, "post_id": 33972009, "comment_id": 100110756, "body": "how do you keep it running when you are not SSH&#39;d into the server and have it auto start if the server restarts?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 1228, "user_id": 937681, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/olrCF.jpg?s=128&g=1", "display_name": "Jason G", "link": "https://stackoverflow.com/users/937681/jason-g"}, "edited": false, "score": 0, "creation_date": 1561588603, "post_id": 33972009, "comment_id": 100118368, "body": "@JasonG That is a whole different story, called process management and heavily depends on your OS and its flavor."}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": true, "score": 3, "last_activity_date": 1448718145, "creation_date": 1448718145, "answer_id": 33972009, "question_id": 33967610, "link": "https://stackoverflow.com/questions/33967610/how-to-run-a-go-project-on-go-server/33972009#33972009", "title": "How to run a Go project on Go server?", "body": "<p>The <code>go-server</code> and <code>go-agent</code> are part of the <a href=\"http://www.go.cd\" rel=\"nofollow\" title=\"Website of Go Continuous Delivery\">Go continuous delivery system</a> and are absolutely not needed to run a program written in the <a href=\"http://www.golang.org\" rel=\"nofollow\">Go programming language</a>.</p>\n\n<p>Actually, you don't need <em>anything</em> to run a compiled program written in Go, since it is <a href=\"https://en.wikipedia.org/wiki/Static_build\" rel=\"nofollow\">statically compiled</a> (by default, dynamic linking available), meaning that all necessary libraries are put into the executable itself and the executable is self sufficient (within certain limits, but that is an edge case, here).</p>\n\n<p>So in order to run a Go program, just build it and call it like</p>\n\n<pre><code>$ /path/to/programName\nHello, World!\n</code></pre>\n\n<p>(assuming you build the classical example).</p>\n\n<p>Please see <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow\">How to Write Go Code</a> for details.</p>\n"}, {"tags": [], "owner": {"reputation": 623, "user_id": 5615224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7bea88308ec27975167f216eb8f998e?s=128&d=identicon&r=PG&f=1", "display_name": "sfault", "link": "https://stackoverflow.com/users/5615224/sfault"}, "is_accepted": false, "score": 0, "last_activity_date": 1448734168, "creation_date": 1448734168, "answer_id": 33974677, "question_id": 33967610, "link": "https://stackoverflow.com/questions/33967610/how-to-run-a-go-project-on-go-server/33974677#33974677", "title": "How to run a Go project on Go server?", "body": "<p>To run a golang program you can either do <code>go run</code> or <code>go install</code>. If you haven't setup go environment you can use <a href=\"https://github.com/moovweb/gvm\" rel=\"nofollow\">gvm</a> or on linux distro install using package manager.</p>\n"}], "owner": {"reputation": 45698, "user_id": 513413, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e0b73975f75df2f25f8b7cc8ce834f0c?s=128&d=identicon&r=PG", "display_name": "Hesam", "link": "https://stackoverflow.com/users/513413/hesam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7801, "favorite_count": 0, "accepted_answer_id": 33972009, "answer_count": 2, "score": 1, "last_activity_date": 1610282077, "creation_date": 1448683995, "last_edit_date": 1610282077, "question_id": 33967610, "link": "https://stackoverflow.com/questions/33967610/how-to-run-a-go-project-on-go-server", "title": "How to run a Go project on Go server?", "body": "<p>I have no experience on GoLang.</p>\n<p>I have a Go project and I want to run it on my local server on my ubuntu 14.04. I have installed Go server and Go agent and they are running.</p>\n<pre><code>hesam: ~ $ sudo /etc/init.d/go-server start\n[sudo] password for hesam: \nusing default settings from /etc/default/go-server\nStarted Go Server on http://hesam:8153/go\nhesam: ~ $ sudo /etc/init.d/go-agent start\n[Fri Nov 27 20:46:44 MST 2015] using default settings from /etc/default/go-agent\nStarted Go Agent.\nhesam: ~ $\n</code></pre>\n<p>Based on what command line said <code>/var/go/</code> is the folder that I can use to put my GO project inside. Based on what I know in Apache server there is <code>www</code> folder that we will have access to from localhost. So, I'm expecting something like this with Go server (but seems I'm wrong).</p>\n<p>My project contains some folders such as <code>client</code>, <code>config</code>, <code>protocol</code>, <code>server' and two files </code>chat.json<code>and</code>main.go<code>. I thought </code>main.go<code>acts as</code>index.html` or similar.</p>\n<p>So, how can I run the project on server?</p>\n"}, {"tags": ["json", "go", "marshalling"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1448663958, "post_id": 33965169, "comment_id": 55688789, "body": "To understand your problem: why do you need to marshal into portable format?"}, {"owner": {"reputation": 2549, "user_id": 749515, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/fdf40887bfac87aba430eec018cc0d2a?s=128&d=identicon&r=PG", "display_name": "pavelkolodin", "link": "https://stackoverflow.com/users/749515/pavelkolodin"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1448666202, "post_id": 33965169, "comment_id": 55689367, "body": "@elithrar i don&#39;t need to and don&#39;t have to. The only restriction for the format is to be backward-compartible: it must support loading old files with no new keys it the file"}], "answers": [{"tags": [], "owner": {"reputation": 6235, "user_id": 622060, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/59aeda6ad8dea5965841953391441d7d?s=128&d=identicon&r=PG", "display_name": "Per Johansson", "link": "https://stackoverflow.com/users/622060/per-johansson"}, "is_accepted": false, "score": 0, "last_activity_date": 1448664679, "last_edit_date": 1448664679, "creation_date": 1448663956, "answer_id": 33965619, "question_id": 33965169, "link": "https://stackoverflow.com/questions/33965169/go-how-to-json-marshal-mapintint/33965619#33965619", "title": "go: How to json.Marshal map[int]int?", "body": "<p>Do the encoding in code. It's easy and will probably be faster as a bonus.</p>\n\n<p>This should work:</p>\n\n<pre><code>var buf bytes.Buffer\nfirst := true\nfmt.Fprint(&amp;buf, \"{\")\nfor k, v := range m {\n    if first {\n        first = false\n    } else {\n        fmt.Fprint(&amp;buf, \",\")\n    }\n    fmt.Fprintf(&amp;buf, `\"%d\":%d`, k, v)\n}\nfmt.Fprint(&amp;buf, \"}\")\n</code></pre>\n\n<p>If you need to pass this on to <code>encoding/json</code> you can use <code>json.RawMessage(buf.Bytes())</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 1, "last_activity_date": 1448664023, "creation_date": 1448664023, "answer_id": 33965624, "question_id": 33965169, "link": "https://stackoverflow.com/questions/33965169/go-how-to-json-marshal-mapintint/33965624#33965624", "title": "go: How to json.Marshal map[int]int?", "body": "<p>No, you can't convert the map on the fly. You will need to have your original map till you populate the new one (then it can be removed).</p>\n\n<p>First question you have to ask yourself: what are you going to do with that json, because modern computers have a lot of RAM, so storing even 4gb will not be a problem (and I highly doubt you are going to send 4gb json request).</p>\n\n<p>Once you know why exactly are you encoding your stuff you can look for an appropriate format.</p>\n\n<p>For example you can serialize your map.</p>\n\n<p><kbd><a href=\"http://play.golang.org/p/QIWKQD4EL9\" rel=\"nofollow\">Go Playground</a></kbd></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/gob\"\n    \"bytes\"\n)\n\nvar m = map[int]string{1:\"one\", 2: \"two\", 3: \"three\"}\n\nfunc main() {\n    buf := new(bytes.Buffer)\n    encoder := gob.NewEncoder(buf)\n\n    err := encoder.Encode(m)\n    if err != nil {\n        panic(err)\n    }\n\n// your encoded stuff\nfmt.Println(buf.Bytes())\n\n    var decodedMap map[int]string\n    decoder := gob.NewDecoder(buf)\n\n    err = decoder.Decode(&amp;decodedMap)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"%#v\\n\", decodedMap)\n}\n</code></pre>\n"}], "owner": {"reputation": 2549, "user_id": 749515, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/fdf40887bfac87aba430eec018cc0d2a?s=128&d=identicon&r=PG", "display_name": "pavelkolodin", "link": "https://stackoverflow.com/users/749515/pavelkolodin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 423, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1448664679, "creation_date": 1448660832, "last_edit_date": 1448661563, "question_id": 33965169, "link": "https://stackoverflow.com/questions/33965169/go-how-to-json-marshal-mapintint", "title": "go: How to json.Marshal map[int]int?", "body": "<p>I know, Json does not support anything else than strings for keys.</p>\n\n<p>But converting entire <code>map[int]int</code> to temporaty <code>map[string]int</code> is not always possible because second one does not fit into memory.</p>\n\n<p>Is there an approach to convert int key on the fly?</p>\n\n<p>Is there any json-like format with int keys? YAML? Some binary format?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1448921270, "post_id": 33979796, "comment_id": 55773752, "body": "This is great! Thank you so much. I must have missed the http.ReadResponse func. And I love the fact that calling the read func over and over again just works!"}, {"owner": {"reputation": 2736, "user_id": 370662, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/10f19a9e600c4ed64f53a986fba57e21?s=128&d=identicon&r=PG", "display_name": "korylprince", "link": "https://stackoverflow.com/users/370662/korylprince"}, "reply_to_user": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1448927890, "post_id": 33979796, "comment_id": 55776526, "body": "Yeah, I was surprised it worked also. But it&#39;s bascially working off Content-Length so it makes sense. Would probably be better if you had some kind of delimiter between requests/responses and used something like <code>io.LimitedReader</code> to make sure you don&#39;t get thrown off by a bad HTTP response."}, {"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "edited": false, "score": 0, "creation_date": 1576802459, "post_id": 33979796, "comment_id": 105024445, "body": "I keep getting &#39;unexpected EOF&#39;"}, {"owner": {"reputation": 121, "user_id": 10485585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4f290d6cb7512a1e8adc10a5780e89e?s=128&d=identicon&r=PG&f=1", "display_name": "zzell", "link": "https://stackoverflow.com/users/10485585/zzell"}, "edited": false, "score": 0, "creation_date": 1592220293, "post_id": 33979796, "comment_id": 110337414, "body": "Such solution won&#39;t work with HTTP/2, <code>ReadResponse</code> fails with &quot;malformed HTTP version HTTP/2&quot;"}, {"owner": {"reputation": 2736, "user_id": 370662, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/10f19a9e600c4ed64f53a986fba57e21?s=128&d=identicon&r=PG", "display_name": "korylprince", "link": "https://stackoverflow.com/users/370662/korylprince"}, "reply_to_user": {"reputation": 121, "user_id": 10485585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4f290d6cb7512a1e8adc10a5780e89e?s=128&d=identicon&r=PG&f=1", "display_name": "zzell", "link": "https://stackoverflow.com/users/10485585/zzell"}, "edited": false, "score": 0, "creation_date": 1592281397, "post_id": 33979796, "comment_id": 110361479, "body": "@zzell seems related to <a href=\"https://github.com/golang/go/issues/18464\" rel=\"nofollow noreferrer\">this</a>"}], "tags": [], "owner": {"reputation": 2736, "user_id": 370662, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/10f19a9e600c4ed64f53a986fba57e21?s=128&d=identicon&r=PG", "display_name": "korylprince", "link": "https://stackoverflow.com/users/370662/korylprince"}, "is_accepted": true, "score": 10, "last_activity_date": 1564263179, "last_edit_date": 1564263179, "creation_date": 1448775821, "answer_id": 33979796, "question_id": 33963467, "link": "https://stackoverflow.com/questions/33963467/parse-http-requests-and-responses-from-text-file-in-go/33979796#33979796", "title": "Parse HTTP requests and responses from text file in Go", "body": "<p>It's actually pretty straightforward:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"os\"\n)\n\ntype Connection struct {\n    Request  *http.Request\n    Response *http.Response\n}\n\nfunc ReadHTTPFromFile(r io.Reader) ([]Connection, error) {\n    buf := bufio.NewReader(r)\n    stream := make([]Connection, 0)\n\n    for {\n        req, err := http.ReadRequest(buf)\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n            return stream, err\n        }\n\n        resp, err := http.ReadResponse(buf, req)\n        if err != nil {\n            return stream, err\n        }\n\n        //save response body\n        b := new(bytes.Buffer)\n        io.Copy(b, resp.Body)\n        resp.Body.Close()\n        resp.Body = ioutil.NopCloser(b)\n\n        stream = append(stream, Connection{Request: req, Response: resp})\n    }\n    return stream, nil\n\n}\nfunc main() {\n    f, err := os.Open(\"/tmp/test.http\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer f.Close()\n    stream, err := ReadHTTPFromFile(f)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    for _, c := range stream {\n        b, err := httputil.DumpRequest(c.Request, true)\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Println(string(b))\n        b, err = httputil.DumpResponse(c.Response, true)\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Println(string(b))\n    }\n}\n</code></pre>\n\n<p>A few notes:</p>\n\n<ul>\n<li>There are <a href=\"https://golang.org/pkg/net/http/#ReadRequest\" rel=\"noreferrer\"><code>http.ReadRequest</code></a> and <a href=\"https://golang.org/pkg/net/http/#ReadResponse\" rel=\"noreferrer\"><code>http.ReadResponse</code></a></li>\n<li><code>http.ReadRequest</code> and <code>http.ReadResponse</code> can be called over and over again on the same <code>bufio.Reader</code> until <code>EOF</code> and it will \"just work\"\n\n<ul>\n<li>\"just working\" depends on the Content-Length header being present and correct, so reading the body will place the Reader at the start of the next request/response</li>\n<li><a href=\"https://golang.org/src/net/http/transfer.go#L305\" rel=\"noreferrer\">Read the code</a> to understand exactly what will work and what won't</li>\n</ul></li>\n<li><code>resp.Body</code> must be <code>Close</code>ed per the docs, so we have to copy it to another buffer to keep it</li>\n<li>Using your example data (modifying Content-Length to match your truncation), this code will output the same Requests and Responses as given</li>\n<li><code>httputil.DumpRequest</code> and <code>httputil.DumpResponse</code> won't necessarily dump the HTTP headers in the same order as the input file, so don't expect a <code>diff</code> to be perfect</li>\n</ul>\n"}], "owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7634, "favorite_count": 3, "accepted_answer_id": 33979796, "answer_count": 1, "score": 6, "last_activity_date": 1564263179, "creation_date": 1448651092, "last_edit_date": 1448662758, "question_id": 33963467, "link": "https://stackoverflow.com/questions/33963467/parse-http-requests-and-responses-from-text-file-in-go", "title": "Parse HTTP requests and responses from text file in Go", "body": "<p>Given the following file which holds a HTTP pipelined stream of HTTP requests and HTTP responses.</p>\n\n<p><strong>How can I parse this file into my <code>stream</code> variable?</strong></p>\n\n<pre><code>type Connection struct{\n   Request *http.Request\n   Response *http.Response\n}\nstream := make([]Connection, 0)\n</code></pre>\n\n<p>The raw file:</p>\n\n<pre><code>GET /ubuntu/dists/trusty/InRelease HTTP/1.1\nHost: archive.ubuntu.com\nCache-Control: max-age=0\nAccept: text/*\nUser-Agent: Debian APT-HTTP/1.3 (1.0.1ubuntu2)\n\nHTTP/1.1 404 Not Found\nDate: Thu, 26 Nov 2015 18:26:36 GMT\nServer: Apache/2.2.22 (Ubuntu)\nVary: Accept-Encoding\nContent-Length: 311\nContent-Type: text/html; charset=iso-8859-1\n\n&lt;!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"&gt;\n&lt;html&gt;&lt;head&gt;\n&lt;title&gt;404 Not Found&lt;/title&gt;\n&lt;/head&gt;&lt;body&gt;\n&lt;h1&gt;Not Found&lt;/h1&gt;\n&lt;p&gt;The requested URL /ubuntu/dists/trusty/InRelease was not found on this server.&lt;/p&gt;\n&lt;hr&gt;\n&lt;address&gt;Apache/2.2.22 (Ubuntu) Server at archive.ubuntu.com Port 80&lt;/address&gt;\n&lt;/body&gt;&lt;/html&gt;\nGET /ubuntu/dists/trusty-updates/InRelease HTTP/1.1\nHost: archive.ubuntu.com\nCache-Control: max-age=0\nAccept: text/*\nUser-Agent: Debian APT-HTTP/1.3 (1.0.1ubuntu2)\n\nHTTP/1.1 200 OK\nDate: Thu, 26 Nov 2015 18:26:37 GMT\nServer: Apache/2.2.22 (Ubuntu)\nLast-Modified: Thu, 26 Nov 2015 18:03:00 GMT\nETag: \"fbb7-5257562a5fd00\"\nAccept-Ranges: bytes\nContent-Length: 64439\nCache-Control: max-age=382, proxy-revalidate\nExpires: Thu, 26 Nov 2015 18:33:00 GMT\n\n-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA512\n\nOrigin: Ubuntu\nLabel: Ubuntu\nSuite: trusty-updates\nVersion: 14.04\nCodename: trusty\n[... truncated by author]\n</code></pre>\n\n<p>I know there is <a href=\"https://golang.org/pkg/net/http/#ReadRequest\" rel=\"noreferrer\">http.ReadRequest</a>. What about the Response? Any ideas/feedback/thoughts are appreciated.</p>\n"}, {"tags": ["go", "gnupg", "openpgp"], "comments": [{"owner": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "edited": false, "score": 0, "creation_date": 1448676344, "post_id": 33963284, "comment_id": 55691434, "body": "<a href=\"https://godoc.org/golang.org/x/crypto/openpgp\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/crypto/openpgp</a>"}, {"owner": {"reputation": 22311, "user_id": 130006, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a8460f1891830c4cfdfb6707d8cb56ea?s=128&d=identicon&r=PG", "display_name": "mikewilliamson", "link": "https://stackoverflow.com/users/130006/mikewilliamson"}, "reply_to_user": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "edited": false, "score": 0, "creation_date": 1448678952, "post_id": 33963284, "comment_id": 55691842, "body": "@saarrrr, I have come across that library already, but it&#39;s not obvious to me how to use it in this way. If you could provide an example it would be appreciated. I&#39;ve tried to clarify my question a little."}, {"owner": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "edited": false, "score": 0, "creation_date": 1448679195, "post_id": 33963284, "comment_id": 55691882, "body": "<a href=\"https://gist.github.com/stuart-warren/93750a142d3de4e8fdd2\" rel=\"nofollow noreferrer\">gist.github.com/stuart-warren/93750a142d3de4e8fdd2</a>"}, {"owner": {"reputation": 22311, "user_id": 130006, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a8460f1891830c4cfdfb6707d8cb56ea?s=128&d=identicon&r=PG", "display_name": "mikewilliamson", "link": "https://stackoverflow.com/users/130006/mikewilliamson"}, "reply_to_user": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "edited": false, "score": 0, "creation_date": 1448690952, "post_id": 33963284, "comment_id": 55693786, "body": "@saarrrr That code appears to be encrypting and decrypting stuff. What I am looking for is verifying a downloaded file with an asc signature. There are links to two examples in my question. Take a peek. Basically &quot;gpg --verify package_name.asc&quot; is what I am trying to do, and it looks like I need to add a key (using a fingerprint?) before I can do that. Any thoughts?"}], "answers": [{"tags": [], "owner": {"reputation": 3457, "user_id": 3108853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db3d997e8c35cb14623d4dc4de494801?s=128&d=identicon&r=PG&f=1", "display_name": "lsowen", "link": "https://stackoverflow.com/users/3108853/lsowen"}, "is_accepted": true, "score": 3, "last_activity_date": 1448918934, "creation_date": 1448918934, "answer_id": 34008326, "question_id": 33963284, "link": "https://stackoverflow.com/questions/33963284/verify-gpg-signature-in-go-openpgp/34008326#34008326", "title": "Verify gpg signature in Go openpgp", "body": "<p>I was able to verify a gpg signature using the following code:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"golang.org/x/crypto/openpgp\"\n        \"os\"\n)\n\nfunc main() {\n        keyRingReader, err := os.Open(\"signer-pubkey.asc\")\n        if err != nil {\n                fmt.Println(err)\n                return\n        }\n\n        signature, err := os.Open(\"signature.asc\")\n        if err != nil {\n                fmt.Println(err)\n                return\n        }\n\n        verification_target, err := os.Open(\"mysql-5.7.9-win32.zip\")\n        if err != nil {\n                fmt.Println(err)\n                return\n        }\n\n        keyring, err := openpgp.ReadArmoredKeyRing(keyRingReader)\n        if err != nil {\n                fmt.Println(\"Read Armored Key Ring: \" + err.Error())\n                return\n        }\n        entity, err := openpgp.CheckArmoredDetachedSignature(keyring, verification_target, signature)\n        if err != nil {\n                fmt.Println(\"Check Detached Signature: \" + err.Error())\n                return\n        }\n\n        fmt.Println(entity)\n}\n</code></pre>\n\n<p>Full code: <a href=\"https://gist.github.com/lsowen/d420a64821414cd2adfb\" rel=\"nofollow\">https://gist.github.com/lsowen/d420a64821414cd2adfb</a></p>\n"}], "owner": {"reputation": 22311, "user_id": 130006, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a8460f1891830c4cfdfb6707d8cb56ea?s=128&d=identicon&r=PG", "display_name": "mikewilliamson", "link": "https://stackoverflow.com/users/130006/mikewilliamson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1142, "favorite_count": 1, "accepted_answer_id": 34008326, "answer_count": 1, "score": 7, "last_activity_date": 1448918934, "creation_date": 1448650128, "last_edit_date": 1448808712, "question_id": 33963284, "link": "https://stackoverflow.com/questions/33963284/verify-gpg-signature-in-go-openpgp", "title": "Verify gpg signature in Go openpgp", "body": "<p>I'm playing with writing a Go program that downloads and verifies files.\nI am hoping to avoid forcing the user to install gnupg (if possible).</p>\n\n<p>Is it possible to verify a downloaded file with a gpg signature (asc file) as described <a href=\"https://dev.mysql.com/doc/refman/5.7/en/checking-gpg-signature.html\" rel=\"nofollow\">here</a> or <a href=\"http://tor.hermetix.org/verifying-signatures.html.en\" rel=\"nofollow\">here</a> using Go's openpgp lib or some other Go library?</p>\n\n<p>Any examples demonstrating how to use openpgp to verify a file with an asc signature would be appreciated.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1448651387, "post_id": 33963169, "comment_id": 55684413, "body": "Make sure your checkout is up to date by using the <code>-u</code> option with <code>go get</code>. I would also install an up to date version of the official version of go (it&#39;s possible that gccgo may not work with Oracle)"}], "answers": [{"tags": [], "owner": {"reputation": 938, "user_id": 1772722, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/17346489240f67dafa4bad5967fa1aae?s=128&d=identicon&r=PG", "display_name": "lionelmessi", "link": "https://stackoverflow.com/users/1772722/lionelmessi"}, "is_accepted": true, "score": 0, "last_activity_date": 1448652338, "creation_date": 1448652338, "answer_id": 33963719, "question_id": 33963169, "link": "https://stackoverflow.com/questions/33963169/installing-golang-oracle-but-getting-error-undefined-reference-to-golang-org/33963719#33963719", "title": "Installing Golang Oracle but getting &quot;error: undefined reference to &#39;golang.org_x_tools_container_intsets.popcount&#39;&quot;", "body": "<p>Seems like we need to remove gcc-go(installed using apt-get) and install Go from the website <a href=\"https://golang.org/\" rel=\"nofollow\">https://golang.org/</a> . This fixes the issue.</p>\n"}], "owner": {"reputation": 938, "user_id": 1772722, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/17346489240f67dafa4bad5967fa1aae?s=128&d=identicon&r=PG", "display_name": "lionelmessi", "link": "https://stackoverflow.com/users/1772722/lionelmessi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 465, "favorite_count": 0, "accepted_answer_id": 33963719, "answer_count": 1, "score": 0, "last_activity_date": 1448652338, "creation_date": 1448649536, "question_id": 33963169, "link": "https://stackoverflow.com/questions/33963169/installing-golang-oracle-but-getting-error-undefined-reference-to-golang-org", "title": "Installing Golang Oracle but getting &quot;error: undefined reference to &#39;golang.org_x_tools_container_intsets.popcount&#39;&quot;", "body": "<p>I tried installing Oracle on my Ubuntu machine using the following cmd:</p>\n\n<blockquote>\n  <p>go get golang.org/x/tools/cmd/oracle</p>\n</blockquote>\n\n<p>but I am getting the following error:</p>\n\n<blockquote>\n  <p>#golang.org/x/tools/cmd/oracle\n  /home/rr/Proj/go/src/golang.org/x/tools/container/intsets/sparse.go:140: error: undefined reference to 'golang.org_x_tools_container_intsets.popcount'\n  /home/rr/Proj/go/src/golang.org/x/tools/container/intsets/util.go:51: error: undefined reference to 'golang.org_x_tools_container_intsets.popcount'\n  collect2: error: ld returned 1 exit status</p>\n</blockquote>\n\n<p>My Go version is </p>\n\n<blockquote>\n  <p>go version xgcc (Ubuntu 4.9.1-0ubuntu1) 4.9.1 linux/amd64</p>\n</blockquote>\n\n<p>Anyone else facing the same issue?</p>\n"}, {"tags": ["reflection", "go", "identifier"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1448649397, "post_id": 33963048, "comment_id": 55683637, "body": "Use <code>reflect.Type</code> as the map key."}, {"owner": {"reputation": 442, "user_id": 3158232, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ol4CR.jpg?s=128&g=1", "display_name": "deankarn", "link": "https://stackoverflow.com/users/3158232/deankarn"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1448651406, "post_id": 33963048, "comment_id": 55684423, "body": "Perfect Thanks! I had used that elsewhere in my code, guess I just needed a fresh pair of eyes; couldn&#39;t see the forest because of the trees"}], "answers": [{"comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1450188690, "post_id": 33964382, "comment_id": 56324126, "body": "@joeybloggs: Remember to <a href=\"http://stackoverflow.com/help/someone-answers\">accept answers</a> you feel answered your questions."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1448663796, "last_edit_date": 1448663796, "creation_date": 1448655754, "answer_id": 33964382, "question_id": 33963048, "link": "https://stackoverflow.com/questions/33963048/go-differentiate-between-structs-with-same-name-in-the-same-package/33964382#33964382", "title": "Go Differentiate Between Structs with same name in the same package", "body": "<p>To uniquely identify types in a map, use <a href=\"https://godoc.org/reflect#Type\" rel=\"nofollow\"><code>reflect.Type</code></a> as the map key:</p>\n\n<pre><code>var cache map[reflect.Type]cachedType\n</code></pre>\n\n<p>This is recommended by the <a href=\"https://godoc.org/reflect#Type\" rel=\"nofollow\">reflect documentation</a>:</p>\n\n<blockquote>\n  <p>To test for [type] equality, compare the Types directly.</p>\n</blockquote>\n"}], "owner": {"reputation": 442, "user_id": 3158232, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ol4CR.jpg?s=128&g=1", "display_name": "deankarn", "link": "https://stackoverflow.com/users/3158232/deankarn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 464, "favorite_count": 0, "accepted_answer_id": 33964382, "answer_count": 1, "score": 1, "last_activity_date": 1448663796, "creation_date": 1448648977, "question_id": 33963048, "link": "https://stackoverflow.com/questions/33963048/go-differentiate-between-structs-with-same-name-in-the-same-package", "title": "Go Differentiate Between Structs with same name in the same package", "body": "<p><strong>Background:</strong></p>\n\n<p>I am trying to cache some struct information for efficiency but am having trouble differentiating between struct with the same name, within the same package.</p>\n\n<p><strong>Example Code:</strong></p>\n\n<pre><code>func Struct(s interface{}){\n  val := reflect.ValueOf(s)\n  typ := val.Type()\n\n  // cache in map, but with what key? \n  typ.Name()               // not good enough\n  typ.PkgPath + typ.Name() // not good enough\n}\n\nfunc Caller1() {\n  type Test struct {\n    Name string\n  }\n\n  t:= Test{\n    Name:\"Test Name\",\n  }\n\n  Struct(t)\n}\n\nfunc Caller2() {\n  type Test struct {\n    Address string\n    Other string\n  }\n\n  t:= Test{\n    Address:\"Test Address\",\n    Other:\"OTHER\",\n  }\n\n  Struct(t)\n}\n</code></pre>\n\n<p><strong>Problem</strong></p>\n\n<p>Can't find a proper unique key as:</p>\n\n<ul>\n<li>Name is the same \"Test\"</li>\n<li>PkgPath with be identical as both functions are in same package</li>\n<li>Pointers etc is out because need a consistent key otherwise caching would be pointless</li>\n</ul>\n\n<p>Can anyone help in finding a way to uniquely identify these structs? </p>\n\n<p>P.S. I do realize that changing of the struct name would solve the issue, but need to handle this scenario as I have a generic library that others will be calling and may have the structs defined like the above example.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 1, "last_activity_date": 1448633402, "last_edit_date": 1448633402, "creation_date": 1448631671, "answer_id": 33958679, "question_id": 33958485, "link": "https://stackoverflow.com/questions/33958485/go-pipeline-using-channels/33958679#33958679", "title": "Go pipeline using channels", "body": "<p>Your main function exits so the whole program ends. It should wait for end of processing. Moreover, process function should loop over channel with range keyword.</p>\n\n<p>Scaffolding for a working solution looks like that:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc process(input chan int, done chan struct{}) {\n    for i := range input {\n        fmt.Println(i)\n    }\n    done &lt;- struct{}{}\n}\n\nfunc main() {\n    input := make(chan int)\n    done := make(chan struct{})\n\n    go process(input, done)\n\n    for i := 1; i &lt; 10; i++ {\n        input &lt;- i\n    }\n    close(input)\n\n    &lt;-done\n}\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/EmYeLSF4fj\" rel=\"nofollow\">Playground</a></kbd></p>\n"}, {"comments": [{"owner": {"reputation": 1900, "user_id": 1496890, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f23055d756c85d4549a20bc6ce7965ba?s=128&d=identicon&r=PG", "display_name": "jmng", "link": "https://stackoverflow.com/users/1496890/jmng"}, "edited": false, "score": 0, "creation_date": 1448639693, "post_id": 33959176, "comment_id": 55679404, "body": "Thanks, this works, but it appears that send and receiving are executed sequentially, am I understanding it wrong? My goal was to have process() execute in parallel with main(), consuming data from the bufferChan channel as it becomes available, but it seems that main() executes the whole for() cycle and only then does process() start printing messages."}, {"owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "reply_to_user": {"reputation": 1900, "user_id": 1496890, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f23055d756c85d4549a20bc6ce7965ba?s=128&d=identicon&r=PG", "display_name": "jmng", "link": "https://stackoverflow.com/users/1496890/jmng"}, "edited": false, "score": 1, "creation_date": 1448640979, "post_id": 33959176, "comment_id": 55680048, "body": "Yeah this is because there is only one go Routine to consume what is on the channel bufferChan. Look at this example <a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\">gobyexample.com/worker-pools</a> this is how you can achieve parallel processing."}], "tags": [], "owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "is_accepted": true, "score": 2, "last_activity_date": 1448633382, "creation_date": 1448633382, "answer_id": 33959176, "question_id": 33958485, "link": "https://stackoverflow.com/questions/33958485/go-pipeline-using-channels/33959176#33959176", "title": "Go pipeline using channels", "body": "<p>The reason for func process not printing anything is that you func main exits after the for loop for rows.Next finishes thereby exiting the program. You need to do couple of things. </p>\n\n<ol>\n<li>Add call to close after for loop to indicate end adding message to\nbuffered channel else it can lead to deadlock. So call\nclose(bufferChan)    </li>\n<li>Use range to iterate over channel in your func process.        </li>\n<li>Pass an additional channel to process to know when it finishes so\nthat main can wait till process finishes.</li>\n</ol>\n\n<p>Look at the code snippet below for example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    bufferChan := make(chan int, 1000)\n    done := make(chan bool)\n    go process(bufferChan, done)\n    for i := 0; i &lt; 100; i++ {\n        bufferChan &lt;- i\n    }\n    close(bufferChan)\n\n    select {\n    case &lt;-done:\n        fmt.Println(\"Done\")\n    }\n\n}\n\nfunc process(c chan int, done chan bool) {\n    for s := range c {\n        fmt.Println(s)\n    }   \n    done &lt;- true\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 787, "user_id": 3959912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SVNx7.jpg?s=128&g=1", "display_name": "Arif A.", "link": "https://stackoverflow.com/users/3959912/arif-a"}, "is_accepted": false, "score": 1, "last_activity_date": 1512323856, "creation_date": 1512323856, "answer_id": 47621423, "question_id": 33958485, "link": "https://stackoverflow.com/questions/33958485/go-pipeline-using-channels/47621423#47621423", "title": "Go pipeline using channels", "body": "<p>I believe you are looking for <code>io.pipe()</code> go API which creates a synchronous <strong>in-memory pipe</strong> between a writer and reader/s. There is no buffering here. It can be used to connect code expecting an <code>io.Reader</code> with code expecting an <code>io.Writer</code>.</p>\n\n<p>In your case, <code>io.PipeWriter</code> is the code \"reading value from the database\" and \"io.PipeReader\" is the code \"writing the value to the screen\".</p>\n\n<p>Here, an example of streaming data without any buffer i.e <code>bytes.Buffer</code>.  </p>\n\n<pre><code>// Set up the pipe to write data directly into the Reader.\npr, pw := io.Pipe()\n// Write JSON-encoded data to the Writer end of the pipe.\n// Write in a separate concurrent goroutine, and remember\n// to Close the PipeWriter, to signal to the paired PipeReader\n// that we\u2019re done writing.\ngo func() {\n  err := json.NewEncoder(pw).Encode(&amp;v)\n  pw.Close()\n}()\n// Send the HTTP request. Whatever is read from the Reader\n// will be sent in the request body.\n// As data is written to the Writer, it will be available\n// to read from the Reader.\nresp, err := http.Post(\u201cexample.com\u201d, \u201capplication/json\u201d, pr)\n</code></pre>\n\n<p>Reference:</p>\n\n<p><a href=\"https://medium.com/stupid-gopher-tricks/streaming-data-in-go-without-buffering-3285ddd2a1e5\" rel=\"nofollow noreferrer\">https://medium.com/stupid-gopher-tricks/streaming-data-in-go-without-buffering-3285ddd2a1e5</a></p>\n"}], "owner": {"reputation": 1900, "user_id": 1496890, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f23055d756c85d4549a20bc6ce7965ba?s=128&d=identicon&r=PG", "display_name": "jmng", "link": "https://stackoverflow.com/users/1496890/jmng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 33959176, "answer_count": 3, "score": 1, "last_activity_date": 1512323856, "creation_date": 1448630965, "question_id": 33958485, "link": "https://stackoverflow.com/questions/33958485/go-pipeline-using-channels", "title": "Go pipeline using channels", "body": "<p>I'm exploring Go and trying to set up a sort of pipeline using channels. I just want to read something in main() and send them to process() for processing, in this case just print the value to the screen.</p>\n\n<p>Unfortunately, in the code below, it appears that process() never reads from the channel, or at least it doesn't print anything; what am I doing wrong?</p>\n\n<pre><code>package main\n\nimport ( \"fmt\" ; \"database/sql\" ; _ \"github.com/lib/pq\" ; \"time\" ; \"gopkg.in/redis.v3\" )//; \"strconv\" )\n\ntype Record struct {\n    userId, myDate int\n    prodUrl string\n}\n\n\nfunc main(){\n\n    //connect to db\n    db, err := sql.Open(...)\n    defer db.Close()\n\n    //error check here...\n\n    //exec query\n    rows, err := db.Query(\"select userID,url,date from mytable limit 10\")\n    defer rows.Close()\n\n    //error check here...   \n\n    //create channel to buffer rows read\n    bufferChan := make(chan *Record,1000)\n    go process(bufferChan)\n\n    //iterate through results and send them to process()\n    row := new(Record)\n    for rows.Next(){\n        err := rows.Scan(&amp;row.userId, &amp;row.prodUrl, &amp;row.myDate)        \n        bufferChan &lt;- row\n        fmt.Printf(\"row sent %v\",row.userId)                    \n    }   \n}\n\n//prints Record values\nfunc process (buffer chan *Record) {\n    row := &lt;- buffer\n    fmt.Printf(\"row received: %d %v %d \", row.userId,row.prodUrl,row.myDate)\n}\n</code></pre>\n"}, {"tags": ["multithreading", "go", "concurrency", "locking", "shared-state"], "answers": [{"comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1448631255, "post_id": 33957495, "comment_id": 55674720, "body": "So <code>Unlock()</code> does not unlock the already locked <code>Cond</code> in another <code>goroutine</code>?"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1448631366, "post_id": 33957495, "comment_id": 55674789, "body": "Silly me! I&#39;ve already acquired the lock before calling <code>Wait()</code>!"}], "tags": [], "owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "is_accepted": true, "score": 2, "last_activity_date": 1448627474, "creation_date": 1448627474, "answer_id": 33957495, "question_id": 33954763, "link": "https://stackoverflow.com/questions/33954763/is-calling-the-wait-method-of-sync-cond-concurrently-safe/33957495#33957495", "title": "Is Calling the `Wait()` method of `sync.Cond` Concurrently, Safe?", "body": "<p>Yes it is safe to call <code>Wait</code> even when it calls <code>L.Unlock()</code> first but it is essential that you acquired the lock before calling <code>Wait</code> and before checking your condition since, in this situation, both are not thread safe.</p>\n\n<blockquote>\n  <p><code>Wait</code> atomically unlocks <code>c.L</code> <strong>and suspends execution of the calling goroutine.</strong> After later resuming execution, <code>Wait</code> locks <code>c.L</code> before returning. </p>\n</blockquote>\n\n<ol>\n<li>The goroutine that calls <code>Wait</code> acquired the lock, checked the condition and found it to be unsatisfactory. </li>\n<li>Now it waits but in order to allow for changes of the condition it needs to give the lock back. <code>Wait</code> does that automatically for you and then suspends the goroutine. </li>\n<li>Now changes of the condition can happen and eventually the goroutine is awoken by <code>Broadcast</code> or <code>Signal</code>. It then acquires the lock to check the condition once again (This must happen one-by-one for each waiting goroutine or else there would be no way telling how many goroutines are running around freely now).</li>\n</ol>\n"}], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 33957495, "answer_count": 1, "score": 1, "last_activity_date": 1448627474, "creation_date": 1448618274, "question_id": 33954763, "link": "https://stackoverflow.com/questions/33954763/is-calling-the-wait-method-of-sync-cond-concurrently-safe", "title": "Is Calling the `Wait()` method of `sync.Cond` Concurrently, Safe?", "body": "<p>Is calling the <code>Wait()</code> method of <code>sync.Cond</code> safe when according to the documentation, it performs an <code>Unlock()</code> first?</p>\n\n<p>Assume we are checking for a condition to be met:</p>\n\n<pre><code>func sample() {\n    cond = &amp;sync.Cond{L: &amp;sync.Mutex{}} // accessible by other parts of program\n\n    go func() {\n        cond.L.Lock()\n        for !condition() {\n            cond.Wait()\n        }\n        // do stuff ...\n        cond.L.Unlock()\n    }()\n\n    go func() {\n        cond.L.Lock()\n        mutation()\n        cond.L.Unlock()\n\n        cond.Signal()\n    }()\n}\n</code></pre>\n\n<p>And:</p>\n\n<pre><code>func condition() bool {\n    // assuming someSharedState is a more complex state than just a bool\n    return someSharedState\n}\n\nfunc mutation() {\n    // assuming someSharedState is a more complex state than just a bool\n    // (A) state mutation on someSharedState\n}\n</code></pre>\n\n<p>Since <code>Wait()</code> performs an <code>Unlock</code>, should (A) has a locking of it's own? Or being atomic?</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"tags": [], "owner": {"reputation": 1728, "user_id": 1628065, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/uhAcU.png?s=128&g=1", "display_name": "drtf", "link": "https://stackoverflow.com/users/1628065/drtf"}, "is_accepted": false, "score": 0, "last_activity_date": 1448625901, "creation_date": 1448625901, "answer_id": 33957053, "question_id": 33952908, "link": "https://stackoverflow.com/questions/33952908/google-app-engine-changes-content-type-to-text-html-even-though-it-is-set-to-app/33957053#33957053", "title": "Google App Engine changes content-type to text/html even though it is set to application/xml", "body": "<p>See information from <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow\">http/header</a>:</p>\n\n<blockquote>\n  <p>WriteHeader sends an HTTP response header with status code. If\n  WriteHeader is not called explicitly, the first call to Write will\n  trigger an implicit WriteHeader(http.StatusOK). Thus explicit calls\n  to WriteHeader are mainly used to send error codes.</p>\n</blockquote>\n\n<p>first try settings the header then send it</p>\n"}, {"comments": [{"owner": {"reputation": 8775, "user_id": 821110, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/fa6fca5f613944238a91d2daeba67b9d?s=128&d=identicon&r=PG", "display_name": "W.K.S", "link": "https://stackoverflow.com/users/821110/w-k-s"}, "edited": false, "score": 0, "creation_date": 1448643184, "post_id": 33960758, "comment_id": 55681060, "body": "It feels so obvious now! Thanks"}, {"owner": {"reputation": 757655, "user_id": 95810, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e8d5fe90f1fe2148bf130cccd4dc311c?s=128&d=identicon&r=PG", "display_name": "Alex Martelli", "link": "https://stackoverflow.com/users/95810/alex-martelli"}, "reply_to_user": {"reputation": 8775, "user_id": 821110, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/fa6fca5f613944238a91d2daeba67b9d?s=128&d=identicon&r=PG", "display_name": "W.K.S", "link": "https://stackoverflow.com/users/821110/w-k-s"}, "edited": false, "score": 0, "creation_date": 1448646667, "post_id": 33960758, "comment_id": 55682528, "body": "@W.K.S, you&#39;re welcome! I hope you will now accept this answer as per usual Stack etiquette."}], "tags": [], "owner": {"reputation": 757655, "user_id": 95810, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e8d5fe90f1fe2148bf130cccd4dc311c?s=128&d=identicon&r=PG", "display_name": "Alex Martelli", "link": "https://stackoverflow.com/users/95810/alex-martelli"}, "is_accepted": true, "score": 2, "last_activity_date": 1448638947, "creation_date": 1448638947, "answer_id": 33960758, "question_id": 33952908, "link": "https://stackoverflow.com/questions/33952908/google-app-engine-changes-content-type-to-text-html-even-though-it-is-set-to-app/33960758#33960758", "title": "Google App Engine changes content-type to text/html even though it is set to application/xml", "body": "<p>Look at the documentation in <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow\">https://golang.org/pkg/net/http/#ResponseWriter</a> , and I quote:</p>\n\n<blockquote>\n  <p>Changing the header after a call to WriteHeader (or Write) has no\n  effect</p>\n</blockquote>\n\n<p>Now look at your code:</p>\n\n<pre><code>w.WriteHeader(status)\nw.Header().Set(\"Content-Type\", contentType)\n</code></pre>\n\n<p>as you see, you <em>are</em> indeed \"Changing the header after a call to WriteHeader\" -- hence, it \"has no effect\".</p>\n\n<p>So, do your \"changing the header\" <strong>before</strong> that call instead:</p>\n\n<pre><code>w.Header().Set(\"Content-Type\", contentType)\nw.WriteHeader(status)\n</code></pre>\n\n<p>I don't think this is at all specific to app engine -- it should apply to any use of <code>http</code> in Go.</p>\n"}], "owner": {"reputation": 8775, "user_id": 821110, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/fa6fca5f613944238a91d2daeba67b9d?s=128&d=identicon&r=PG", "display_name": "W.K.S", "link": "https://stackoverflow.com/users/821110/w-k-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 33960758, "answer_count": 2, "score": 0, "last_activity_date": 1448638947, "creation_date": 1448611945, "last_edit_date": 1495541240, "question_id": 33952908, "link": "https://stackoverflow.com/questions/33952908/google-app-engine-changes-content-type-to-text-html-even-though-it-is-set-to-app", "title": "Google App Engine changes content-type to text/html even though it is set to application/xml", "body": "<p>This question has been asked <a href=\"https://stackoverflow.com/questions/992180/google-app-engine-http-header-content-type-not-correct-once-application-is-deplo\">before</a> but that answer applies to python applications. I'd like to know how to fix the issue for go applications.</p>\n\n<p>I've deployed a web service on Google App Engine which is consumed by mobile clients. Using the function below, I send the response either as XML or JSON (as requested by the client)</p>\n\n<pre><code>func (api *API) Respond(w http.ResponseWriter, r *http.Request, body interface{}, status int) {\n\n    var contentType string\n    var content []byte\n    var err error\n\n    if r.Header.Get(\"Accept\") == \"application/xml\" {\n\n        contentType = \"application/xml; charset=UTF-8\"\n        content, err = xml.Marshal(body)\n\n    } else {\n\n        contentType = \"application/json; charset=UTF-8\"\n        content, err = json.MarshalIndent(body, \"\", \"  \")\n    }\n\n    if err != nil {\n        panic(err)\n    }\n\n    w.WriteHeader(status)\n    w.Header().Set(\"Content-Type\", contentType)\n    w.Write(content)\n}\n</code></pre>\n\n<p>In either case, however, the client device receives a Content-Type of <code>text/html</code>. How can I fix this? Here's the app.yam file for my application:</p>\n\n<pre><code>application: wks-api\nversion: 3\nruntime: go\napi_version: go1\n\nhandlers:\n- url: /.*\n  script: api\n</code></pre>\n"}, {"tags": ["string", "pointers", "go", "unsafe"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1448620279, "post_id": 33952378, "comment_id": 55668609, "body": "Never use unsafe. Performance is never that critical."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1497212188, "last_edit_date": 1497212188, "creation_date": 1448612508, "answer_id": 33953027, "question_id": 33952378, "link": "https://stackoverflow.com/questions/33952378/what-are-the-possible-consequences-of-using-unsafe-conversion-from-byte-to-str/33953027#33953027", "title": "What are the possible consequences of using unsafe conversion from []byte to string in go?", "body": "<p>Modifying something that the language spec guarantees to be immutable is an act of treason.</p>\n\n<p>Since the spec guarantees that <code>string</code>s are immutable, compilers are allowed to generate code that caches their values and does other optimization based on this. You can't change values of <code>string</code>s in any normal way, and if you resort to dirty ways (like package <code>unsafe</code>) to still do it, you lose all the guarantees provided by the spec, and by continuing to use the modified <code>string</code>s, you may bump into \"bugs\" and unexpected things randomly.</p>\n\n<p>For example if you use a <code>string</code> as a key in a map and you change the <code>string</code> after you put it into the map, you might not be able to find the associated value in the map using either the original or the modified value of the <code>string</code> (this is implementation dependent).</p>\n\n<p>To demonstrate this, see this example:</p>\n\n<pre><code>m := map[string]int{}\nb := []byte(\"hi\")\ns := *(*string)(unsafe.Pointer(&amp;b))\nm[s] = 999\n\nfmt.Println(\"Before:\", m)\n\nb[0] = 'b'\nfmt.Println(\"After:\", m)\n\nfmt.Println(\"But it's there:\", m[s], m[\"bi\"])\n\nfor i := 0; i &lt; 1000; i++ {\n    m[strconv.Itoa(i)] = i\n}\nfmt.Println(\"Now it's GONE:\", m[s], m[\"bi\"])\nfor k, v := range m {\n    if k == \"bi\" {\n        fmt.Println(\"But still there, just in a different bucket: \", k, v)\n    }\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/VbQ90I5Fnd\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Before: map[hi:999]\nAfter: map[bi:&lt;nil&gt;]\nBut it's there: 999 999\nNow it's GONE: 0 0\nBut still there, just in a different bucket:  bi 999\n</code></pre>\n\n<p>At first, we just see some weird result: simple <code>Println()</code> is not able to find its value. It sees something (key is found), but value is displayed as <code>nil</code> which is not even a valid value for the value type <code>int</code> (zero value for <code>int</code> is <code>0</code>).</p>\n\n<p>If we grow the map to be big (we add 1000 elements), internal data structure of the map gets restructured. After this, we're not even able to find our value by explicitly asking for it with the appropriate key. It is still in the map as iterating over all its key-value pairs we find it, but since hash code changes as the value of the <code>string</code> changes, most likely it is searched for in a different bucket than where it is (or where it should be).</p>\n\n<p>Also note that code using package <code>unsafe</code> may work as you expect it now, but the same code might work completely differently (meaning it may break) with a future (or old) version of Go as <em>\"packages that import unsafe may be non-portable and are not protected by the Go 1 compatibility guidelines\"</em>.</p>\n\n<p>Also you may run into unexpected errors as the modified <code>string</code> might be used in different ways. Someone might just copy the string header, someone may copy its content. See this example:</p>\n\n<pre><code>b := []byte{'h', 'i'}\ns := *(*string)(unsafe.Pointer(&amp;b))\n\ns2 := s                 // Copy string header\ns3 := string([]byte(s)) // New string header but same content\nfmt.Println(s, s2, s3)\nb[0] = 'b'\n\nfmt.Println(s == s2)\nfmt.Println(s == s3)\n</code></pre>\n\n<p>We created 2 new local variables <code>s2</code> and <code>s3</code> using <code>s</code>, <code>s2</code> initialized by copying the string header of <code>s</code>, and <code>s3</code> is initialized with a new <code>string</code> value (new string header) but with the same content. Now if you modify the original <code>s</code>, you would expect in a correct program that comparing the new strings to the original you would get the same result be it either <code>true</code> or <code>false</code> (based on if values were cached, but should be the same).</p>\n\n<p>But the output is (try it on the <a href=\"http://play.golang.org/p/xHgLh3gW64\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>hi hi hi\ntrue\nfalse\n</code></pre>\n"}], "owner": {"reputation": 1695, "user_id": 617556, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6136180203540c5248e37d1124ac7999?s=128&d=identicon&r=PG", "display_name": "Paperback Writer", "link": "https://stackoverflow.com/users/617556/paperback-writer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1497212188, "creation_date": 1448609753, "last_edit_date": 1448617955, "question_id": 33952378, "link": "https://stackoverflow.com/questions/33952378/what-are-the-possible-consequences-of-using-unsafe-conversion-from-byte-to-str", "title": "What are the possible consequences of using unsafe conversion from []byte to string in go?", "body": "<p>The preferred way of converting <code>[]byte</code> to <code>string</code> is this:</p>\n\n<pre><code>var b []byte\n// fill b\ns := string(b)\n</code></pre>\n\n<p>In this code byte slice is copied, which can be a problem in situations where performance is important. </p>\n\n<p>When performance is critical, one can consider performing the unsafe conversion:</p>\n\n<pre><code>var b []byte\n// fill b\ns :=  *(*string)(unsafe.Pointer(&amp;b))\n</code></pre>\n\n<p>My question is: what can go wrong when using the unsafe conversion? I known that <code>string</code> should be immutable and if we change <code>b</code>, <code>s</code> will also be changed. And still: so what? Is it all bad that can happen?</p>\n"}, {"tags": ["dictionary", "reflection", "struct", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1448608621, "post_id": 33951307, "comment_id": 55662207, "body": "Take a look at how <a href=\"https://github.com/mitchellh/mapstructure\" rel=\"nofollow noreferrer\">github.com/mitchellh/mapstructure</a> does it (or use that library directly)"}], "owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 541, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1448605122, "creation_date": 1448605122, "question_id": 33951307, "link": "https://stackoverflow.com/questions/33951307/how-to-convert-slice-of-map-to-slice-of-struct-in-go", "title": "How to convert slice of map to slice of struct in go?", "body": "<p>I am trying to convert to map to struct, I am almost done, finally I got a problem, I can not convert slice to struct:</p>\n\n<pre><code>func readDocTo(in bson.M, out reflect.Value) {\n    outt := out.Type()\n    outk := outt.Kind()\n\n    for {\n        if outk == reflect.Ptr &amp;&amp; out.IsNil() {\n            out.Set(reflect.New(outt.Elem()))\n        }\n        if outk == reflect.Ptr {\n            out = out.Elem()\n            outt = out.Type()\n            outk = out.Kind()\n            continue\n        }\n        break\n    }\n\n    st := out.Type()\n    n := st.NumField()\n    for i := 0; i &lt; n; i++ {\n        field := st.Field(i)\n        if field.PkgPath != \"\" {\n            continue // Private field\n        }\n        tag := field.Tag.Get(\"bson\")\n        if tag == \"\" &amp;&amp; strings.Index(string(field.Tag), \":\") &lt; 0 {\n            tag = string(field.Tag)\n        }\n        if tag == \"-\" {\n            continue\n        }\n\n        // XXX Drop this after a few releases.\n        if s := strings.Index(tag, \"/\"); s &gt;= 0 {\n            recommend := tag[:s]\n            for _, c := range tag[s+1:] {\n                switch c {\n                case 'c':\n                    recommend += \",omitempty\"\n                case 's':\n                    recommend += \",minsize\"\n                default:\n                    msg := fmt.Sprintf(\"Unsupported flag %q in tag %q of type %s\", string([]byte{uint8(c)}), tag, st)\n                    panic(externalPanic(msg))\n                }\n            }\n            msg := fmt.Sprintf(\"Replace tag %q in field %s of type %s by %q\", tag, field.Name, st, recommend)\n            panic(externalPanic(msg))\n        }\n\n        if tag == \"\" {\n            tag = strings.ToLower(field.Name)\n        }\n\n        fieldt := field.Type\n        val, ok := in[tag]\n        switch fieldt.Kind() {\n        case reflect.Ptr:\n            if !ok {\n                out.Field(i).Set(reflect.New(fieldt.Elem()))\n            } else {\n                readDocTo(val.(bson.M), out.Field(i))\n            }\n        case reflect.String:\n            if ok {\n                out.Field(i).Set(reflect.ValueOf(val))\n            }\n        case reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64:\n            out.Field(i).SetInt(reflect.ValueOf(val).Int())\n        case reflect.Slice:\n            if ok {\n                s := reflect.ValueOf(val)\n                for j := 0; j &lt; s.Len(); j++ {\n                    item := s.Index(j)\n                    fmt.Println(item.Interface().(bson.M))\n                    fmt.Println(out.Field(i))\n                    // TODO\n                    // readDocTo(item.Interface().(bson.M), out.Field(i).Elem())\n                }\n            }\n        }\n\n    }\n}\n</code></pre>\n"}, {"tags": ["c++", "perl", "go", "hashtable"], "comments": [{"owner": {"reputation": 89231, "user_id": 10320, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/pijgr.jpg?s=128&g=1", "display_name": "dreamlax", "link": "https://stackoverflow.com/users/10320/dreamlax"}, "edited": false, "score": 0, "creation_date": 1448601012, "post_id": 33950565, "comment_id": 55659707, "body": "Is it possible that the C++ implementation is constructing a new <code>std::string</code> every time it is doing a lookup?"}, {"owner": {"reputation": 19932, "user_id": 2068573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/0e6f781a205f3521290f89c84dc5f95d?s=128&d=identicon&r=PG", "display_name": "Neil Kirk", "link": "https://stackoverflow.com/users/2068573/neil-kirk"}, "edited": false, "score": 1, "creation_date": 1448601074, "post_id": 33950565, "comment_id": 55659718, "body": "Yes cache the key in a local string variable outside the for loop."}, {"owner": {"reputation": 1478, "user_id": 5557309, "user_type": "registered", "profile_image": "https://graph.facebook.com/1621133335/picture?type=large", "display_name": "James Picone", "link": "https://stackoverflow.com/users/5557309/james-picone"}, "edited": false, "score": 0, "creation_date": 1448601105, "post_id": 33950565, "comment_id": 55659727, "body": "Can you inspect the assembly output for the C++ and the Go versions? It&#39;s entirely possible that a compiler is being clever, and doing something like eliminating the loop because it has no side effects."}, {"owner": {"reputation": 19932, "user_id": 2068573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/0e6f781a205f3521290f89c84dc5f95d?s=128&d=identicon&r=PG", "display_name": "Neil Kirk", "link": "https://stackoverflow.com/users/2068573/neil-kirk"}, "edited": false, "score": 0, "creation_date": 1448601174, "post_id": 33950565, "comment_id": 55659749, "body": "Also grab the string in x with a reference or pointer to avoid copying."}, {"owner": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 3, "creation_date": 1448601268, "post_id": 33950565, "comment_id": 55659778, "body": "Did you turn optimization on?"}, {"owner": {"reputation": 89231, "user_id": 10320, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/pijgr.jpg?s=128&g=1", "display_name": "dreamlax", "link": "https://stackoverflow.com/users/10320/dreamlax"}, "reply_to_user": {"reputation": 42006, "user_id": 3807729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UEUbF.jpg?s=128&g=1", "display_name": "Galik", "link": "https://stackoverflow.com/users/3807729/galik"}, "edited": false, "score": 0, "creation_date": 1448601341, "post_id": 33950565, "comment_id": 55659793, "body": "@Galik: I would say not. When I compile the code without <code>-O2</code> it takes almost the same amount as time as OP, but with <code>-O2</code> it takes no time at all."}, {"owner": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "edited": false, "score": 0, "creation_date": 1448601466, "post_id": 33950565, "comment_id": 55659832, "body": "Thanks for the suggestions, I updated the C++ version (see &quot;Update 1&quot;) but there is not much difference."}, {"owner": {"reputation": 19932, "user_id": 2068573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/0e6f781a205f3521290f89c84dc5f95d?s=128&d=identicon&r=PG", "display_name": "Neil Kirk", "link": "https://stackoverflow.com/users/2068573/neil-kirk"}, "edited": false, "score": 0, "creation_date": 1448601502, "post_id": 33950565, "comment_id": 55659843, "body": "The conversion of the string literal to a string is a greater cost than the return value."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 89231, "user_id": 10320, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/pijgr.jpg?s=128&g=1", "display_name": "dreamlax", "link": "https://stackoverflow.com/users/10320/dreamlax"}, "edited": false, "score": 0, "creation_date": 1448601550, "post_id": 33950565, "comment_id": 55659861, "body": "@dreamlax optimization probably removes the hash access (the result of which is unused) entirely. Probably need to assign it to a <code>volatile</code> variable or some such."}, {"owner": {"reputation": 564, "user_id": 1972061, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fDQyj.jpg?s=128&g=1", "display_name": "cezheng", "link": "https://stackoverflow.com/users/1972061/cezheng"}, "edited": false, "score": 0, "creation_date": 1448601983, "post_id": 33950565, "comment_id": 55659961, "body": "outside the for loop, add  string key = &quot;China&quot;;  in for loop use mymap[key]"}, {"owner": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "reply_to_user": {"reputation": 564, "user_id": 1972061, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fDQyj.jpg?s=128&g=1", "display_name": "cezheng", "link": "https://stackoverflow.com/users/1972061/cezheng"}, "edited": false, "score": 0, "creation_date": 1448602333, "post_id": 33950565, "comment_id": 55660039, "body": "@cezheng and other.  Tried it. See update 3.  Thx."}, {"owner": {"reputation": 564, "user_id": 1972061, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fDQyj.jpg?s=128&g=1", "display_name": "cezheng", "link": "https://stackoverflow.com/users/1972061/cezheng"}, "edited": false, "score": 0, "creation_date": 1448602436, "post_id": 33950565, "comment_id": 55660075, "body": "@codingFun what about mymap.at(key);"}, {"owner": {"reputation": 19932, "user_id": 2068573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/0e6f781a205f3521290f89c84dc5f95d?s=128&d=identicon&r=PG", "display_name": "Neil Kirk", "link": "https://stackoverflow.com/users/2068573/neil-kirk"}, "edited": false, "score": 0, "creation_date": 1448602439, "post_id": 33950565, "comment_id": 55660077, "body": "What is the time with update 3 and optimization?"}, {"owner": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "reply_to_user": {"reputation": 564, "user_id": 1972061, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fDQyj.jpg?s=128&g=1", "display_name": "cezheng", "link": "https://stackoverflow.com/users/1972061/cezheng"}, "edited": false, "score": 0, "creation_date": 1448603226, "post_id": 33950565, "comment_id": 55660296, "body": "@cezheng, no difference between <code>mymap.at(key);</code> and <code>mymap[key];</code>"}, {"owner": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "reply_to_user": {"reputation": 19932, "user_id": 2068573, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/0e6f781a205f3521290f89c84dc5f95d?s=128&d=identicon&r=PG", "display_name": "Neil Kirk", "link": "https://stackoverflow.com/users/2068573/neil-kirk"}, "edited": false, "score": 0, "creation_date": 1448603349, "post_id": 33950565, "comment_id": 55660339, "body": "@neil-kirk In update 3, with optimization, it&#39;s about 80ms.  So optimization really made a huge difference here."}, {"owner": {"reputation": 6223, "user_id": 2726892, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/DE8Dn.png?s=128&g=1", "display_name": "MooseBoys", "link": "https://stackoverflow.com/users/2726892/mooseboys"}, "edited": false, "score": 0, "creation_date": 1448603558, "post_id": 33950565, "comment_id": 55660405, "body": "Do you also have a debugger attached?"}, {"owner": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "reply_to_user": {"reputation": 6223, "user_id": 2726892, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/DE8Dn.png?s=128&g=1", "display_name": "MooseBoys", "link": "https://stackoverflow.com/users/2726892/mooseboys"}, "edited": false, "score": 0, "creation_date": 1448604126, "post_id": 33950565, "comment_id": 55660554, "body": "@MooseBoys  no sir. I didn&#39;t.  Your question got me curious and I ran it from gdb (on the update 3 version, non-optimized),  it&#39;s only marginally slower than running directly: about 230ms."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 2, "creation_date": 1448606557, "post_id": 33950565, "comment_id": 55661394, "body": "I would actually not care about these benchmarks because at least at the moment the Perl code is not doing what it should do, even after it got &quot;fixes&quot;. I don&#39;t know about the other code but it might be wrong too or the compiler would have optimized stuff away. Definitely far from any reliable benchmarks."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 3, "creation_date": 1448606881, "post_id": 33950565, "comment_id": 55661517, "body": "Apart from that: using benchmarks which run not even a second is useless because it is pure luck in which power mode the processor is currently and what processes might just run in parallel and eat CPU time. Real benchmarks run hours to make sure that the benchmark is not affected by such problems too much,"}, {"owner": {"reputation": 3327, "user_id": 1604311, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/0frKT.jpg?s=128&g=1", "display_name": "Arunesh Singh", "link": "https://stackoverflow.com/users/1604311/arunesh-singh"}, "edited": false, "score": 0, "creation_date": 1448610052, "post_id": 33950565, "comment_id": 55662844, "body": "Why didn&#39;t you improved perl version  <code>$x = $mymap{&quot;China&quot;};</code> to <code>$mymap{&quot;China&quot;}</code> although it will give you a <code>warning</code> and change this  <code>for ($i=0; $i&lt;1000000; $i++)</code> to perlish <code>for my $i(0 .. 1000000)</code>."}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1448659323, "post_id": 33950565, "comment_id": 55687184, "body": "Perl&#39;s version might not be the fastest since it has to deal with two string storage formats. It also has heavy data types. There&#39;s also time spent storing the keys into a second hash so they can be used by multiple hashes. Perl&#39;s version is very robust to attacks, which may or may not have an effect on performance. Also, <code>for ($i=0; $i&lt;1000000; $i++)</code> is an inefficient way of writing <code>for my $i (0..999999)</code>."}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1448659378, "post_id": 33950565, "comment_id": 55687200, "body": "PS, <code>mymap[&quot;China&quot;];</code> should be <code>x = mymap[&quot;China&quot;];</code> in the C++ version to be equivalent to the other two."}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1448659446, "post_id": 33950565, "comment_id": 55687223, "body": "PS, You misspelled Madrid :)"}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "edited": false, "score": 0, "creation_date": 1448659566, "post_id": 33950565, "comment_id": 55687271, "body": "I find it very interesting that you got the same numbers for <code>$mymap[&quot;China&quot;]</code> (effectively <code>$mymap[0]</code>) as for <code>$mymap{&quot;China&quot;}</code>, or did you forget to the update the time after changing the code?"}], "answers": [{"comments": [{"owner": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "edited": false, "score": 0, "creation_date": 1448602203, "post_id": 33950725, "comment_id": 55660012, "body": "removing the extra constructor call helps,  but it seems C++ version is still fairly slow.  Thanks!"}, {"owner": {"reputation": 1478, "user_id": 5557309, "user_type": "registered", "profile_image": "https://graph.facebook.com/1621133335/picture?type=large", "display_name": "James Picone", "link": "https://stackoverflow.com/users/5557309/james-picone"}, "reply_to_user": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "edited": false, "score": 0, "creation_date": 1448603392, "post_id": 33950725, "comment_id": 55660351, "body": "I&#39;m still really curious to see what the difference between the Go assembly and the C++ assembly are."}], "tags": [], "owner": {"reputation": 1478, "user_id": 5557309, "user_type": "registered", "profile_image": "https://graph.facebook.com/1621133335/picture?type=large", "display_name": "James Picone", "link": "https://stackoverflow.com/users/5557309/james-picone"}, "is_accepted": false, "score": 2, "last_activity_date": 1448601765, "last_edit_date": 1495542616, "creation_date": 1448601765, "answer_id": 33950725, "question_id": 33950565, "link": "https://stackoverflow.com/questions/33950565/performance-of-hash-table-why-is-c-the-slowest/33950725#33950725", "title": "Performance of hash table, why is C++ the slowest?", "body": "<p>This is a guess:</p>\n\n<p>unordered_map::operator[] requires a string argument. You are providing a char*. Without optimisations on, the C++ version is likely calling the std::string(char*) constructor a million times in order to turn \"China\" into a std::string. Go's language spec likely makes \"string literals\" of the same type as string, so no constructors need to be called.</p>\n\n<p>With optimisations on, the string constructor will get hoisted out of the loop and you won't see the same problem. Or quite possibly no code will be generated except the two system calls to get the time and the system call to print the difference, because ultimately it all has no effect.</p>\n\n<p>To confirm that, you'd have to actually look at what assembly is being generated. That'll be a compiler option. See <a href=\"https://stackoverflow.com/questions/137038/how-do-you-get-assembler-output-from-c-c-source-in-gcc\">this</a> question for the flags required for GCC.</p>\n"}, {"comments": [{"owner": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "edited": false, "score": 0, "creation_date": 1448605988, "post_id": 33951352, "comment_id": 55661178, "body": "Thanks @steffen-ullrich for pointing the syntax. It&#39;s now fixed, but performance number didn&#39;t go up."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "edited": false, "score": 1, "creation_date": 1448606088, "post_id": 33951352, "comment_id": 55661213, "body": "@codingFun: Don&#39;t expect the number to go up because it should do actually more complex operations after the code got fixed. Also like I said: benchmarks are lies and micro benchmarks like yours doubly so. Read the parts about CPU, power mode, scheduler.... And verify what the other code does, based on the generated code and not your input. Like I said a smart compiler might realize that it does nothing useful and optimize it away."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "edited": false, "score": 0, "creation_date": 1448606400, "post_id": 33951352, "comment_id": 55661326, "body": "@codingFun: Apart from that your code is still wrong and if you would actually use warnings like I&#39;ve recommended you would see it."}, {"owner": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "edited": false, "score": 0, "creation_date": 1448606780, "post_id": 33951352, "comment_id": 55661482, "body": "you are right. Micro benchmark can only give a very rough idea. More study would be needed to make a choice on which language to choose for a project.   By the way, I had the typo in <code>$x = $mymap[&quot;China&quot;];</code> when I was editing it. It&#39;s now updated now. Performance is about 180ms."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "edited": false, "score": 2, "creation_date": 1448607055, "post_id": 33951352, "comment_id": 55661567, "body": "@codingFun: as you can see the performance varies a lot when making small changes.  Just a simple change from <code>$x = $mymap{..}</code> to <code>my $x = $mymap{...}</code> will affect the performance significantly. And on my system there are differences of 50% between multiple runs of the program."}, {"owner": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "edited": false, "score": 0, "creation_date": 1448607422, "post_id": 33951352, "comment_id": 55661709, "body": "you are right again, I tried <code>my $x = $mymap{...}</code> and the speed does increase (time is reduced) by about 25%.  Since 200ms is a short time,  there are big difference from run to run (as you pointed out), I stabilized it by running the loop of 30M (instead of 1M) and normalized the time for 1M loops."}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": false, "score": 16, "last_activity_date": 1448607616, "last_edit_date": 1448607616, "creation_date": 1448605305, "answer_id": 33951352, "question_id": 33950565, "link": "https://stackoverflow.com/questions/33950565/performance-of-hash-table-why-is-c-the-slowest/33951352#33951352", "title": "Performance of hash table, why is C++ the slowest?", "body": "<p>From your Perl code (before your attempts to fix it):</p>\n\n<blockquote>\n<pre><code>@mymap = ();\n$mymap[\"U.S.\"] = \"Washington\";\n$mymap[\"U.K.\"] = \"London\";\n</code></pre>\n</blockquote>\n\n<p>This is not a map but an array. The syntax for hash maps is:</p>\n\n<pre><code>  %mymap;\n  $mymap{\"U.S.\"} = ....\n</code></pre>\n\n<p>Thus what you effectively do is to create an array and not a hash map and access the element 0 all the time. \nPlease, use <code>use strict;</code> and <code>use warnings;</code> all the time with Perl and even a simple syntax check with warnings would have shown you the problem:</p>\n\n<pre><code>perl -cw x.pl\nArgument \"U.S.\" isn't numeric in array element at x.pl line 9.\nArgument \"U.K.\" isn't numeric in array element at x.pl line 10.\n</code></pre>\n\n<p>Apart from that the main part of the benchmark effectively does nothing useful (assign a variable and never use it) and some compilers can detect it and simply optimize it away.</p>\n\n<p>If you would check the code generated by your Perl program you would see:</p>\n\n<pre><code>$ perl -MO=Deparse x.pl\n@mymap = ();\n$mymap[0] = 'Washington';\n$mymap[0] = 'London';\n...\nfor ($i = 0; $i &lt; 1000000; ++$i) {\n    $x = $mymap[0];\n}\n</code></pre>\n\n<p>That is it detects the problem at compile time and replaces it with an access to array index 0.</p>\n\n<p>Thus whenever do benchmarks you need to:</p>\n\n<ul>\n<li>Check that your program actually does what it is supposed to.</li>\n<li>Check that the compiler does not optimize things away and does not execute stuff at compile time where other languages will do it at run time. Any kind of statements with no or predictable results are prone to such optimization.</li>\n<li>Verify that you actually measure what you intend to measure and not something else. Even small changes to the program can affect the run time because there is a memory allocation needed were not was before etc and these changes might not be related to what you intend to measure. In your benchmark you measure the access to the same hash element again and again without any access to other elements in between. This is an activity which can play very nice with processor caches but probably does not reflect real world use.</li>\n</ul>\n\n<p>And, using a simple timer is not a realistic benchmark. There are other processes on the system, there is the scheduler, there is cache trashing... and with today's CPU it highly depends on the load on the system because maybe the CPU will run one benchmark in a lower power mode than the other benchmarks, i.e. with a different CPU clock. For example multiple runs of the same \"benchmark\" vary in the measured time between 100ms and 150ms on my system. </p>\n\n<p>Benchmarks are lies and micro benchmarks like yours doubly so.</p>\n"}, {"tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 3, "last_activity_date": 1448608445, "creation_date": 1448608445, "answer_id": 33952054, "question_id": 33950565, "link": "https://stackoverflow.com/questions/33950565/performance-of-hash-table-why-is-c-the-slowest/33952054#33952054", "title": "Performance of hash table, why is C++ the slowest?", "body": "<p>This just shows that for this particular use case Go hash map implementation is optimized very well.</p>\n\n<p><code>mymap[\"China\"]</code> calls <a href=\"https://github.com/golang/go/blob/432cb66f16b2bb6a167725057168bbe4aefe5fb5/src/runtime/hashmap_fast.go#L181\" rel=\"nofollow\">mapaccess1_faststr</a> that is specifically optimized for string keys. Particularly for small one-bucket maps the hash code is not even calculated for short (less than 32 bytes) strings.</p>\n"}, {"comments": [{"owner": {"reputation": 99643, "user_id": 445517, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/57e2ba76e6290c4e9e19821a068bc8c1?s=128&d=identicon&r=PG", "display_name": "CodesInChaos", "link": "https://stackoverflow.com/users/445517/codesinchaos"}, "edited": false, "score": 0, "creation_date": 1448628398, "post_id": 33955645, "comment_id": 55673052, "body": "Switching to <code>char*</code> means that you use reference equality, so the code won&#39;t work if you pass it strings which come from a different source."}, {"owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "reply_to_user": {"reputation": 99643, "user_id": 445517, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/57e2ba76e6290c4e9e19821a068bc8c1?s=128&d=identicon&r=PG", "display_name": "CodesInChaos", "link": "https://stackoverflow.com/users/445517/codesinchaos"}, "edited": false, "score": 0, "creation_date": 1448628612, "post_id": 33955645, "comment_id": 55673169, "body": "@CodesInChaos You are right, but I don&#39;t think this is the point of that micro-benchmark."}, {"owner": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "edited": false, "score": 0, "creation_date": 1448639665, "post_id": 33955645, "comment_id": 55679389, "body": "Thanks @Jens for the detailed explanation. The collision is indeed a big problem. Using a different key, &quot;France&quot;, improves the performance by about 25%.  Comparing pointers does improve the performance tremendously but it&#39;s not what we need here.  I believe the performance has a lot to do with the number of instructions executed, as  james-picone pointed out on the assembly generated.  Created a update 5 on the question. Thanks."}, {"owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "reply_to_user": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "edited": false, "score": 0, "creation_date": 1448640560, "post_id": 33955645, "comment_id": 55679861, "body": "@codingFun The example using the pointers shows that a good part of the runtime is spent computing hash values, because this is what changes with the type. I guess that the go version either has a much better hash function for strings, maybe caching the has value and thus computing it only once, or that it uses some other strategy to implement a map for small strings."}, {"owner": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "edited": false, "score": 0, "creation_date": 1448642209, "post_id": 33955645, "comment_id": 55680581, "body": "@jens, same here. Just wish C++ implementation could catch up with that of go."}], "tags": [], "owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "is_accepted": false, "score": 4, "last_activity_date": 1448624111, "last_edit_date": 1448624111, "creation_date": 1448621064, "answer_id": 33955645, "question_id": 33950565, "link": "https://stackoverflow.com/questions/33950565/performance-of-hash-table-why-is-c-the-slowest/33955645#33955645", "title": "Performance of hash table, why is C++ the slowest?", "body": "<p>I've modified your example a little bit to get some details about the structure of the hash table:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;unordered_map&gt;\n#include &lt;sys/time.h&gt;\n#include &lt;chrono&gt;\n\nusing namespace std;\nint main()\n{\n    std::unordered_map&lt;std::string, std::string&gt; mymap;\n\n    // populating container:\n    mymap[\"U.S.\"] = \"Washington\";\n    mymap[\"U.K.\"] = \"London\";\n    mymap[\"France\"] = \"Paris\";\n    mymap[\"Russia\"] = \"Moscow\";\n    mymap[\"China\"] = \"Beijing\";\n    mymap[\"Germany\"] = \"Berlin\";\n    mymap[\"Japan\"] = \"Tokyo\";\n    mymap[\"China\"] = \"Beijing\";\n    mymap[\"Italy\"] = \"Rome\";\n    mymap[\"Spain\"] = \"Madrad\";\n\n    std::hash&lt;std::string&gt; h;\n    for ( auto const&amp; i : mymap )\n    {\n\n        printf( \"hash(%s) = %ud\\n\", i.first.c_str(), h( i.first ) );\n    }\n\n    for ( int i = 0; i != mymap.bucket_count(); ++i )\n    {\n        auto const bucketsize = mymap.bucket_size( i );\n        if ( 0 != bucketsize )\n        {\n            printf( \"size of bucket %d = %d\\n\", i, bucketsize );\n        }\n    }\n\n    auto const start = std::chrono::steady_clock::now();\n\n    string const x = \"China\";\n    std::string res;\n\n    for ( int i = 0; i &lt; 1000000; i++ )\n    {\n        mymap.find( x );\n    }\n\n    auto const elapsed = std::chrono::steady_clock::now() - start;\n    printf( \"%s\\n\", res );\n    printf( \"took %d ms\\n\",\n            std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;( elapsed ).count() );\n    return 0;\n}\n</code></pre>\n\n<p>Running this on my system, I get a runtime of ~68ms with the following output:</p>\n\n<pre><code>hash(Japan) = 3611029618d\nhash(Spain) = 749986602d\nhash(China) = 3154384700d\nhash(U.S.) = 2546447179d\nhash(Italy) = 2246786301d\nhash(Germany) = 2319993784d\nhash(U.K.) = 2699630607d\nhash(France) = 3266727934d\nhash(Russia) = 3992029278d\nsize of bucket 0 = 0\nsize of bucket 1 = 0\nsize of bucket 2 = 1\nsize of bucket 3 = 1\nsize of bucket 4 = 1\nsize of bucket 5 = 0\nsize of bucket 6 = 1\nsize of bucket 7 = 0\nsize of bucket 8 = 0\nsize of bucket 9 = 2\nsize of bucket 10 = 3\n</code></pre>\n\n<p>It turns out that the hash table is not well optimized and contains some collisions. Further printing the elements in the bucket shows that Spain and China are in bucket 9. The bucket is probably a linked list with nodes distributed in memory, explaining the performance drop.</p>\n\n<p>If you choose another hash table size such that there are no collisions, you can get a speedup. I tested it with adding <code>mymap.rehash(1001)</code> and got I speedup of 20-30% to something between 44-52ms.</p>\n\n<p>Now, another point would be computation of the hash values for \"China\". The function is executed in each iteration. We can make this go away when we switch to constant plain C strings:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;unordered_map&gt;\n#include &lt;sys/time.h&gt;\n#include &lt;chrono&gt;\n\nstatic auto constexpr us = \"U.S.\";\nstatic auto constexpr uk = \"U.K.\";\nstatic auto constexpr fr = \"France\";\nstatic auto constexpr ru = \"Russia\";\nstatic auto constexpr cn = \"China\";\nstatic auto constexpr ge = \"Germany\";\nstatic auto constexpr jp = \"Japan\";\nstatic auto constexpr it = \"Italy\";\nstatic auto constexpr sp = \"Spain\";\n\nusing namespace std;\nint main()\n{\n    std::unordered_map&lt;const char*, std::string&gt; mymap;\n\n    // populating container:\n    mymap[us] = \"Washington\";\n    mymap[uk] = \"London\";\n    mymap[fr] = \"Paris\";\n    mymap[ru] = \"Moscow\";\n    mymap[cn] = \"Beijing\";\n    mymap[ge] = \"Berlin\";\n    mymap[jp] = \"Tokyo\";\n    mymap[it] = \"Rome\";\n    mymap[sp] = \"Madrad\";\n\n    string const x = \"China\";\n    char const* res = nullptr;\n    auto const start = std::chrono::steady_clock::now();\n    for ( int i = 0; i &lt; 1000000; i++ )\n    {\n        res = mymap[cn].c_str();\n    }\n\n    auto const elapsed = std::chrono::steady_clock::now() - start;\n    printf( \"%s\\n\", res );\n    printf( \"took %d ms\\n\",\n            std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;( elapsed ).count() );\n    return 0;\n}\n</code></pre>\n\n<p>On my machine, this reduces the runtime by 50% to ~20ms. The difference is that instead of computing the hash value from the string contents, it now just transforms the address into a hash value which is much faster because it just returns the address value as a size_t. We also do not need to rehash because there are no collisions for the bucket with <code>cn</code>.</p>\n"}], "owner": {"reputation": 4181, "user_id": 3337677, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/2a3cb5dc363dbc123686e074c4c3181e?s=128&d=identicon&r=PG&f=1", "display_name": "packetie", "link": "https://stackoverflow.com/users/3337677/packetie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1853, "favorite_count": 1, "answer_count": 4, "score": 7, "last_activity_date": 1448639299, "creation_date": 1448600632, "last_edit_date": 1448639299, "question_id": 33950565, "link": "https://stackoverflow.com/questions/33950565/performance-of-hash-table-why-is-c-the-slowest", "title": "Performance of hash table, why is C++ the slowest?", "body": "<p>Ran a simple performance test on hash,  it appears C++ version is the slower than both the perl version and the golang version. </p>\n\n<ul>\n<li>perl version took about 200 millisecond,  </li>\n<li>C++ version took 280 millisecond. </li>\n<li>golang version took 56 millisecond. </li>\n</ul>\n\n<p>On my PC with Core(TM) i7-2670QM CPU @ 2.20GHz, Ubuntu 14.04.3LTS,  </p>\n\n<p>Any ideas?</p>\n\n<p>perl version</p>\n\n<pre><code>use Time::HiRes qw( usleep ualarm gettimeofday tv_interval nanosleep\n                      clock_gettime clock_getres clock_nanosleep clock\n                      stat );\nsub getTS {\n    my ($seconds, $microseconds) = gettimeofday;\n    return $seconds + (0.0+ $microseconds)/1000000.0;\n}\nmy %mymap;\n$mymap{\"U.S.\"} = \"Washington\";\n$mymap{\"U.K.\"} = \"London\";\n$mymap{\"France\"} = \"Paris\";\n$mymap{\"Russia\"} = \"Moscow\";\n$mymap{\"China\"} = \"Beijing\";\n$mymap{\"Germany\"} = \"Berlin\";\n$mymap{\"Japan\"} = \"Tokyo\";\n$mymap{\"China\"} = \"Beijing\";\n$mymap{\"Italy\"} = \"Rome\";\n$mymap{\"Spain\"} = \"Madrad\";\n$x = \"\";\n$start = getTS();\nfor ($i=0; $i&lt;1000000; $i++) {\n    $x = $mymap{\"China\"};\n}\nprintf \"took %f sec\\n\", getTS() - $start;\n</code></pre>\n\n<p>C++ version</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;unordered_map&gt;\n#include &lt;sys/time.h&gt;\n\ndouble getTS() {\n    struct timeval tv;\n    gettimeofday(&amp;tv, NULL);\n    return tv.tv_sec + tv.tv_usec/1000000.0;\n}\nusing namespace std;\nint main () {\n  std::unordered_map&lt;std::string,std::string&gt; mymap;\n\n  // populating container:\n    mymap[\"U.S.\"] = \"Washington\";\n    mymap[\"U.K.\"] = \"London\";\n    mymap[\"France\"] = \"Paris\";\n    mymap[\"Russia\"] = \"Moscow\";\n    mymap[\"China\"] = \"Beijing\";\n    mymap[\"Germany\"] = \"Berlin\";\n    mymap[\"Japan\"] = \"Tokyo\";\n    mymap[\"China\"] = \"Beijing\";\n    mymap[\"Italy\"] = \"Rome\";\n    mymap[\"Spain\"] = \"Madrad\";  \n\n  double start = getTS();\n  string x;\n  for (int i=0; i&lt;1000000; i++) {\n      mymap[\"China\"];\n  }\n  printf(\"took %f sec\\n\", getTS() - start);\n  return 0;\n}\n</code></pre>\n\n<p>Golang version</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc main() {\n    var x string\n    mymap := make(map[string]string)\n    mymap[\"U.S.\"] = \"Washington\";\n    mymap[\"U.K.\"] = \"London\";\n    mymap[\"France\"] = \"Paris\";\n    mymap[\"Russia\"] = \"Moscow\";\n    mymap[\"China\"] = \"Beijing\";\n    mymap[\"Germany\"] = \"Berlin\";\n    mymap[\"Japan\"] = \"Tokyo\";\n    mymap[\"China\"] = \"Beijing\";\n    mymap[\"Italy\"] = \"Rome\";\n    mymap[\"Spain\"] = \"Madrad\";\n    t0 := time.Now()\n    sum := 1\n    for sum &lt; 1000000 {\n        x = mymap[\"China\"]\n        sum += 1\n    }\n    t1 := time.Now()\n    fmt.Printf(\"The call took %v to run.\\n\", t1.Sub(t0))\n    fmt.Println(x)\n}\n</code></pre>\n\n<p><strong>Update 1</strong></p>\n\n<p>To improve C++ version, changed <code>x = mymap[\"China\"];</code> to <code>mymap[\"China\"];</code>, but there is very little difference in performance. </p>\n\n<p><strong>Update 2</strong></p>\n\n<p>I got the original result when compiling without any optimization: <code>g++ -std=c++11 unorderedMap.cc</code>.  With \"-O2\" optimization, it cost only about half the time (150ms)</p>\n\n<p><strong>Update 3</strong></p>\n\n<p>To remove the possible <code>char*</code> to <code>string</code> constructor call, I created a string constant. The time comes down to about 220ms (no optimization in compiling).  Thanks to the suggestion from @neil-kirk, with optimization, (-O2 flag),  the time is about 80ms.  </p>\n\n<pre><code>  double start = getTS();\n  string x = \"China\";\n  for (int i=0; i&lt;1000000; i++) {\n      mymap[x];\n  }\n</code></pre>\n\n<p><strong>Update 4</strong></p>\n\n<p>Thanks to @steffen-ullrich who pointed out there is a syntax error for perl version. I Changed it. The performance number is about 150ms. </p>\n\n<p><strong>Update 5</strong> </p>\n\n<p>It appears the number of executed instructions matters. Using command <code>valgrind --tool=cachegrind &lt;cmd&gt;</code></p>\n\n<p>For Go version</p>\n\n<pre><code>$ valgrind --tool=cachegrind  ./te1\n==2103== Cachegrind, a cache and branch-prediction profiler\n==2103== Copyright (C) 2002-2013, and GNU GPL'd, by Nicholas Nethercote et al.\n==2103== Using Valgrind-3.10.0.SVN and LibVEX; rerun with -h for copyright info\n==2103== Command: ./te1\n==2103== \n--2103-- warning: L3 cache found, using its data for the LL simulation.\nThe call took 1.647099s to run.\nBeijing\n==2103== \n==2103== I   refs:      255,763,381\n==2103== I1  misses:          3,709\n==2103== LLi misses:          2,743\n==2103== I1  miss rate:        0.00%\n==2103== LLi miss rate:        0.00%\n==2103== \n==2103== D   refs:      109,437,132  (77,838,331 rd   + 31,598,801 wr)\n==2103== D1  misses:        352,474  (   254,714 rd   +     97,760 wr)\n==2103== LLd misses:        149,260  (    96,250 rd   +     53,010 wr)\n==2103== D1  miss rate:         0.3% (       0.3%     +        0.3%  )\n==2103== LLd miss rate:         0.1% (       0.1%     +        0.1%  )\n==2103== \n==2103== LL refs:           356,183  (   258,423 rd   +     97,760 wr)\n==2103== LL misses:         152,003  (    98,993 rd   +     53,010 wr)\n==2103== LL miss rate:          0.0% (       0.0%     +        0.1%  )\n</code></pre>\n\n<p>For C++ optimized version (no optimization flag)</p>\n\n<pre><code>$ valgrind --tool=cachegrind ./a.out\n==2180== Cachegrind, a cache and branch-prediction profiler\n==2180== Copyright (C) 2002-2013, and GNU GPL'd, by Nicholas Nethercote et al.\n==2180== Using Valgrind-3.10.0.SVN and LibVEX; rerun with -h for copyright info\n==2180== Command: ./a.out\n==2180== \n--2180-- warning: L3 cache found, using its data for the LL simulation.\ntook 64.657681 sec\n==2180== \n==2180== I   refs:      5,281,474,482\n==2180== I1  misses:            1,710\n==2180== LLi misses:            1,651\n==2180== I1  miss rate:          0.00%\n==2180== LLi miss rate:          0.00%\n==2180== \n==2180== D   refs:      3,170,495,683  (1,840,363,429 rd   + 1,330,132,254 wr)\n==2180== D1  misses:           12,055  (       10,374 rd   +         1,681 wr)\n==2180== LLd misses:            7,383  (        6,132 rd   +         1,251 wr)\n==2180== D1  miss rate:           0.0% (          0.0%     +           0.0%  )\n==2180== LLd miss rate:           0.0% (          0.0%     +           0.0%  )\n==2180== \n==2180== LL refs:              13,765  (       12,084 rd   +         1,681 wr)\n==2180== LL misses:             9,034  (        7,783 rd   +         1,251 wr)\n==2180== LL miss rate:            0.0% (          0.0%     +           0.0%  )\n</code></pre>\n\n<p>For C++ optimized version</p>\n\n<pre><code>$ valgrind --tool=cachegrind ./a.out\n==2157== Cachegrind, a cache and branch-prediction profiler\n==2157== Copyright (C) 2002-2013, and GNU GPL'd, by Nicholas Nethercote et al.\n==2157== Using Valgrind-3.10.0.SVN and LibVEX; rerun with -h for copyright info\n==2157== Command: ./a.out\n==2157== \n--2157-- warning: L3 cache found, using its data for the LL simulation.\ntook 9.419447 sec\n==2157== \n==2157== I   refs:      1,451,459,660\n==2157== I1  misses:            1,599\n==2157== LLi misses:            1,549\n==2157== I1  miss rate:          0.00%\n==2157== LLi miss rate:          0.00%\n==2157== \n==2157== D   refs:        430,486,197  (340,358,108 rd   + 90,128,089 wr)\n==2157== D1  misses:           12,008  (     10,337 rd   +      1,671 wr)\n==2157== LLd misses:            7,372  (      6,120 rd   +      1,252 wr)\n==2157== D1  miss rate:           0.0% (        0.0%     +        0.0%  )\n==2157== LLd miss rate:           0.0% (        0.0%     +        0.0%  )\n==2157== \n==2157== LL refs:              13,607  (     11,936 rd   +      1,671 wr)\n==2157== LL misses:             8,921  (      7,669 rd   +      1,252 wr)\n==2157== LL miss rate:            0.0% (        0.0%     +        0.0%  )\n</code></pre>\n"}, {"tags": ["multithreading", "unix", "go", "concurrency", "elixir"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1448585298, "post_id": 33948726, "comment_id": 55656707, "body": "This is definitely not an answer to the q as posed, but 1) I know Go can start OS threads to let code keep running during blocking syscalls; I don&#39;t know if those threads have, e.g., the big stack allocation you&#39;d tend to associate with a pthreads thread or similar, and 2) it seems plausible to me that the fork+exec for the process would dominate the cost of this operation, and the thread on your program&#39;s side is small in comparison."}, {"owner": {"reputation": 4136, "user_id": 340811, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/87d770f5a0843a130b55572651e9d7d0?s=128&d=identicon&r=PG", "display_name": "Samuel Lampa", "link": "https://stackoverflow.com/users/340811/samuel-lampa"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1448585850, "post_id": 33948726, "comment_id": 55656821, "body": "@twotwotwo: True, the Go threads don&#39;t seem to be terribly heavy-weight. But still, based on my experiments, they still seem to limit the number of external processes that can be practically managed at least more than in Elixir, because of the (small) extra cost."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1448589261, "post_id": 33948726, "comment_id": 55657418, "body": "A thread is an OS thread, aka a pthread, and is completely separate from goroutines."}, {"owner": {"reputation": 5127, "user_id": 6449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fda08117336cfde6562315df04b976e8?s=128&d=identicon&r=PG", "display_name": "Dave Cheney", "link": "https://stackoverflow.com/users/6449/dave-cheney"}, "edited": false, "score": 3, "creation_date": 1448590426, "post_id": 33948726, "comment_id": 55657630, "body": "Spawning a subprocess will probably consume up to three goroutines blocked on read/write of the usual file descriptors. The scheduler will also spawn three OS threads to replace those consumed by blocking on those read/write operations. How big of a problem is this ? I don&#39;t know but it depends on how many threads is too many, vs how many open file descriptors is too many."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1448603895, "post_id": 33948726, "comment_id": 55660498, "body": "I tested a 10-thread and 100-thread under go1.5 on Ubuntu amd64. The incremental cost of each of the 90 extra open processes in resident size (roughly, physical memory occupied) worked out to 30.4kb. The virtual-memory size increased 108kb/process, but by definition that doesn&#39;t mean 108kb physical RAM occupied. You could run far better tests, but <code>this &gt; nothing</code> i figure."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1448604084, "post_id": 33948726, "comment_id": 55660543, "body": "does someone can confirm and answer why <code>starting 2500 external sleep processes - does also start 2500 operating system threads.</code> ?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1448604217, "post_id": 33948726, "comment_id": 55660588, "body": "@JiangYD -- Yes, Go will start OS threads sometimes. In some places, like its networking stack, Go uses asynchronous syscalls that don&#39;t block the OS thread. <code>exec.Command</code> apparently uses syscalls that block the OS thread, so Go has to start another thread so <code>GOMAXPROCS</code> OS threads can be running Go code. If you want a deeper answer, maybe post an SO question about it (or search around online); potentially too broad a topic for a comment."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1448604849, "post_id": 33948726, "comment_id": 55660783, "body": "(To Dave&#39;s point about open filehandles, with a 1024-file ulimit you can only open 300something processes&#39; <code>stdin</code>/<code>out</code>/<code>err</code>; if the memory-consumption rate from my tiny benchmark holds, that&#39;s 10MB RSS, so, yeah, other factors may limit you before exec.Command overhead does.)"}, {"owner": {"reputation": 4136, "user_id": 340811, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/87d770f5a0843a130b55572651e9d7d0?s=128&d=identicon&r=PG", "display_name": "Samuel Lampa", "link": "https://stackoverflow.com/users/340811/samuel-lampa"}, "reply_to_user": {"reputation": 5127, "user_id": 6449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fda08117336cfde6562315df04b976e8?s=128&d=identicon&r=PG", "display_name": "Dave Cheney", "link": "https://stackoverflow.com/users/6449/dave-cheney"}, "edited": false, "score": 0, "creation_date": 1448630847, "post_id": 33948726, "comment_id": 55674488, "body": "@DaveCheney: True, without changing the default ulimit for open files (which is typically 1024 or so), you will run into this limit far before the number of threads seems to become a problem. I&#39;m still trying to figure out what the other limits are, if any, that I seem to be running into, while increasing the number of processes ... will know more very soon. Maybe it was all the open files limit ..."}, {"owner": {"reputation": 4136, "user_id": 340811, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/87d770f5a0843a130b55572651e9d7d0?s=128&d=identicon&r=PG", "display_name": "Samuel Lampa", "link": "https://stackoverflow.com/users/340811/samuel-lampa"}, "edited": false, "score": 0, "creation_date": 1448637867, "post_id": 33948726, "comment_id": 55678322, "body": "Hi all, I have now, after setting ulimit -n very large (1M), managed to start up to 4999 external sleep commands. This results in basically exactly 10K threads to be started for the process. When I go up to 5000 extenal processes, I get a crash. I take this to mean that I&#39;m running into some kind of limit on the number of threads per process amounting to ~10K, though I don&#39;t know what it is. That&#39;s of course quite a respectable number of processes started though, so I&#39;m not really complaining."}], "answers": [{"comments": [{"owner": {"reputation": 4136, "user_id": 340811, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/87d770f5a0843a130b55572651e9d7d0?s=128&d=identicon&r=PG", "display_name": "Samuel Lampa", "link": "https://stackoverflow.com/users/340811/samuel-lampa"}, "edited": false, "score": 0, "creation_date": 1448630289, "post_id": 33951418, "comment_id": 55674180, "body": "Thanks Jiang, I was also trying this method, but it also starts equally many threads. In your code, you have to do a sleep of a high number of seconds (like 3600, which is an hour), not just an echo. Also, I think you have to have a cmd.Wait() inside the go-routine, just before wg.Done(), to keep it from finishing until the command is finished. When I fix this, I get the same result, see: <a href=\"https://gist.github.com/samuell/630467732703feefcc81\" rel=\"nofollow noreferrer\">gist.github.com/samuell/630467732703feefcc81</a>"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 4136, "user_id": 340811, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/87d770f5a0843a130b55572651e9d7d0?s=128&d=identicon&r=PG", "display_name": "Samuel Lampa", "link": "https://stackoverflow.com/users/340811/samuel-lampa"}, "edited": false, "score": 1, "creation_date": 1448847824, "post_id": 33951418, "comment_id": 55736363, "body": "but, all i said is not to wait :(  wait will consume a thread and can not reuse  with other goroutines, I think."}, {"owner": {"reputation": 4136, "user_id": 340811, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/87d770f5a0843a130b55572651e9d7d0?s=128&d=identicon&r=PG", "display_name": "Samuel Lampa", "link": "https://stackoverflow.com/users/340811/samuel-lampa"}, "edited": false, "score": 0, "creation_date": 1449139835, "post_id": 33951418, "comment_id": 55881093, "body": "Yeah, but then one can&#39;t get the output of those processes, which is one very important point for me, and was mentioned in the question."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 4136, "user_id": 340811, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/87d770f5a0843a130b55572651e9d7d0?s=128&d=identicon&r=PG", "display_name": "Samuel Lampa", "link": "https://stackoverflow.com/users/340811/samuel-lampa"}, "edited": false, "score": 0, "creation_date": 1449201114, "post_id": 33951418, "comment_id": 55914257, "body": "of  course we can read the output of processes, even without wait. this is an other question like <code>how to read output of process without wait process finish</code>."}, {"owner": {"reputation": 4136, "user_id": 340811, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/87d770f5a0843a130b55572651e9d7d0?s=128&d=identicon&r=PG", "display_name": "Samuel Lampa", "link": "https://stackoverflow.com/users/340811/samuel-lampa"}, "edited": false, "score": 0, "creation_date": 1449246411, "post_id": 33951418, "comment_id": 55938173, "body": "I maybe did not state it, but I want to run these long-running processes in parallel, not sequentially (will edit the question to clarify). If you know a way to run these long-running processes in parallel, and receive their output in the end, without starting additional threads, I&#39;m very interested in a working code example!"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 4136, "user_id": 340811, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/87d770f5a0843a130b55572651e9d7d0?s=128&d=identicon&r=PG", "display_name": "Samuel Lampa", "link": "https://stackoverflow.com/users/340811/samuel-lampa"}, "edited": false, "score": 0, "creation_date": 1450159241, "post_id": 33951418, "comment_id": 56305786, "body": "finally I have time to finish the example, check the update."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 4136, "user_id": 340811, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/87d770f5a0843a130b55572651e9d7d0?s=128&d=identicon&r=PG", "display_name": "Samuel Lampa", "link": "https://stackoverflow.com/users/340811/samuel-lampa"}, "edited": false, "score": 0, "creation_date": 1450757179, "post_id": 33951418, "comment_id": 56558197, "body": "also this <a href=\"http://stackoverflow.com/questions/34346064/go-memory-leak-when-doing-concurrent-os-exec-command-wait/34357485\" title=\"go memory leak when doing concurrent os exec command wait\">stackoverflow.com/questions/34346064/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1450793561, "post_id": 33951418, "comment_id": 56576568, "body": "This is still incorrect. First, it&#39;s incorrect to call Wait until everything is read through the StdoutPipe, since Wait implicitly tries to close the pipe. Second, you&#39;re blocking the output of the processes, which will deadlock if the command doesn&#39;t sufficiently buffer its output.  Not related to the command: you&#39;re leaking time.Tickers - if you need to select on a time interval, use <code>time.After</code> or a <code>time.Ticker</code> you can Stop, but in this case just use a <code>time.Sleep</code>, or even better don&#39;t use anything because you shouldn&#39;t need to have to sleep to get around a race."}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 1, "last_activity_date": 1450845225, "last_edit_date": 1450845225, "creation_date": 1448605671, "answer_id": 33951418, "question_id": 33948726, "link": "https://stackoverflow.com/questions/33948726/can-go-spawn-and-communicate-with-external-processes-without-starting-one-os-thr/33951418#33951418", "title": "Can Go spawn and communicate with external processes without starting one OS-thread per external process?", "body": "<p>I find that if we not <code>wait</code> processes, the Go runtime will not start <code>2500 operating system threads</code>. so please use  cmd.Start() other than cmd.Output().</p>\n\n<p>But seems it is impossible to read the process's <code>stdout</code> without consuming a OS thread by golang os package. I think it is because os package not use non-block io to read the pipe.</p>\n\n<p>The bottom, following program runs well on my Linux, although it block the process's stdout as @JimB said in comment, maybe it is because we have small output and it fit the system buffers.</p>\n\n<pre><code>func main() {\n    concurrentProcessCount := 50\n    wtChan := make(chan *result, concurrentProcessCount)\n    for i := 0; i &lt; concurrentProcessCount; i++ {\n        go func(i int) {\n            fmt.Println(\"Starting process \", i, \"...\")\n            cmd := exec.Command(\"bash\", \"-c\", \"for i in 1 2 3 4 5; do echo to sleep $i seconds;sleep $i;echo done;done;\")\n            outPipe,_ := cmd.StdoutPipe()\n            err := cmd.Start()\n            if err != nil {\n                panic(err)\n            }\n            &lt;-time.Tick(time.Second)\n            fmt.Println(\"Finishing process \", i, \"...\")\n            wtChan &lt;- &amp;result{cmd.Process, outPipe}\n        }(i)\n    }\n\n    fmt.Println(\"root:\",os.Getpid());\n\n    waitDone := 0\n    forLoop:\n    for{\n        select{\n        case r:=&lt;-wtChan:\n            r.p.Wait()\n            waitDone++\n            output := &amp;bytes.Buffer{}\n            io.Copy(output, r.b)\n            fmt.Println(waitDone, output.String())\n            if waitDone == concurrentProcessCount{\n                break forLoop\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 4136, "user_id": 340811, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/87d770f5a0843a130b55572651e9d7d0?s=128&d=identicon&r=PG", "display_name": "Samuel Lampa", "link": "https://stackoverflow.com/users/340811/samuel-lampa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2450, "favorite_count": 2, "answer_count": 1, "score": 10, "last_activity_date": 1450845225, "creation_date": 1448583590, "last_edit_date": 1449246483, "question_id": 33948726, "link": "https://stackoverflow.com/questions/33948726/can-go-spawn-and-communicate-with-external-processes-without-starting-one-os-thr", "title": "Can Go spawn and communicate with external processes without starting one OS-thread per external process?", "body": "<p><strong>Short version:</strong></p>\n\n<p>Is it possible in Golang to spawn a number of external processes (shell commands) <strong>in parallel</strong>, such that it does not start one <strong>operating system thread</strong> per external process ... and still be able to receive its output when it is finished?</p>\n\n<p><strong>Longer version:</strong></p>\n\n<p>In Elixir, if you use ports, you can spawn thousands of external processes without really increasing the number of threads in the Erlang virtual machine.</p>\n\n<p>E.g. the following code snippet, which starts 2500 external <code>sleep</code> processes, is managed by only 20 <strong>operating system threads</strong> under the Erlang VM:</p>\n\n<pre><code>defmodule Exmultiproc do\n  for _ &lt;- 1..2500 do\n    cmd = \"sleep 3600\"\n    IO.puts \"Starting another process ...\"\n    Port.open({:spawn, cmd}, [:exit_status, :stderr_to_stdout])\n  end\n  System.cmd(\"sleep\", [\"3600\"])\nend\n</code></pre>\n\n<p>(Provided you set <code>ulimit -n</code> to a high number, such as 10000)</p>\n\n<p>On the other hand, the following code in Go, which is supposed to do the same thing - starting 2500 external <code>sleep</code> processes - does also start 2500 <strong>operating system threads</strong>. So it obviously starts one <strong>operating system thread</strong> per (blocking?) system call (so as not to block the whole CPU, or similar, if I understand correctly):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n    \"sync\"\n)\n\nfunc main() {\n    wg := new(sync.WaitGroup)\n    for i := 0; i &lt; 2500; i++ {\n        wg.Add(1)\n        go func(i int) {\n            fmt.Println(\"Starting sleep \", i, \"...\")\n            cmd := exec.Command(\"sleep\", \"3600\")\n            _, err := cmd.Output()\n            if err != nil {\n                panic(err)\n            }\n            fmt.Println(\"Finishing sleep \", i, \"...\")\n            wg.Done()\n        }(i)\n    }\n    fmt.Println(\"Waiting for WaitGroup ...\")\n    wg.Wait()\n    fmt.Println(\"WaitGroup finished!\")\n}\n</code></pre>\n\n<p>Thus, I was wondering if there is a way to write the Go code so that it does the similar thing as the Elixir code, not opening one <strong>operating system thread</strong> per external process?</p>\n\n<p>I'm basically looking for a way to manage at least a few thousand external long-running (up to 10 days) processes, in a way that causes as little problems as possible with any virtual or physical limits in the operating system.</p>\n\n<p><em>(Sorry for any mistakes in the codes, as I'm new to Elixir and, and quite new to Go. I'm eager to get to know any mistakes I'm doing.)</em></p>\n\n<p>EDIT: Clarified about the requirement to run the long-running processes in parallel.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1448578288, "post_id": 33947944, "comment_id": 55654955, "body": "Add your code to your question (SO prefers code here rather than linked to elsewhere)"}, {"owner": {"reputation": 1, "user_id": 5609939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b53abb3563bc5cb10203ad0505483357?s=128&d=identicon&r=PG&f=1", "display_name": "rz.Robin", "link": "https://stackoverflow.com/users/5609939/rz-robin"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1448578950, "post_id": 33947944, "comment_id": 55655156, "body": "done, put main code part in question body"}], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 2, "last_activity_date": 1448584295, "creation_date": 1448584295, "answer_id": 33948798, "question_id": 33947944, "link": "https://stackoverflow.com/questions/33947944/walking-through-go-struct-fields-with-reflect-doesnt-match-case-mapstringinte/33948798#33948798", "title": "Walking through go struct fields with reflect doesn&#39;t match case map[string]interface{}", "body": "<p>The problem is <code>case map[string]interface{}</code> won't match <code>map[string]Host</code> so it will get parsed as a struct, which it isn't.</p>\n\n<p>You will either have to check <code>new_v.Kind()</code> and handle maps via reflection or add a special case for <code>map[string]Host</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 5609939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b53abb3563bc5cb10203ad0505483357?s=128&d=identicon&r=PG&f=1", "display_name": "rz.Robin", "link": "https://stackoverflow.com/users/5609939/rz-robin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1448584295, "creation_date": 1448577518, "last_edit_date": 1448579815, "question_id": 33947944, "link": "https://stackoverflow.com/questions/33947944/walking-through-go-struct-fields-with-reflect-doesnt-match-case-mapstringinte", "title": "Walking through go struct fields with reflect doesn&#39;t match case map[string]interface{}", "body": "<p>I have unusual task:\n1. parse json message to Go struct\n2. verify that all fields in JSON are within specific limits:\n- string fields length no longer fixed constant\n- maps contain no more than fixed number elements\n- if values of map keys are nested structs verify for above 2 rules</p>\n\n<p>To do this I use reflect, then iterating over elements, \nand doing type checking:\n- if int or float - nothing to do - no verification\n- if string - verify length (and return if failed)\n- if map verify map length (and return if failed), then iterate over map values and recursively check if their fields violate string/map rules\n- default (I assume that this is struct nested JSON structure): convert it to interface slice and do recursive call. </p>\n\n<p>Problem: \nIn JSON, I would have different map value types like: \n- map[string]MyStruct1\n- map[string]MyStruct2\n- etc.</p>\n\n<p>So when I'm doing type checking I write:\ncase map[string]interface{}</p>\n\n<p>But in my program this case is never matched and goes to case default, \ncausing some error. </p>\n\n<p>Any possible way to match type with case - map[string]interface{} ????</p>\n\n<p>Here is my code for reference: \n<a href=\"http://play.golang.org/p/IVXHLBRuPK\" rel=\"nofollow\">http://play.golang.org/p/IVXHLBRuPK</a></p>\n\n<pre><code>func validate(vals []interface{}) bool {\nresult := true\n    for _, elem := range vals {\n        switch v := elem.(type) {\n        case int, float64:\n            fmt.Println(\"Got int or float: \", v)\n        case string:\n            fmt.Println(\"Got string\", v)\n            if len(elem.(string)) &gt; 5 {\n                fmt.Println(\"String rule Violation!\")\n                result = false\n                break\n                fmt.Println(\"After Break\")\n            }\n        case map[string]interface{}:\n            fmt.Println(\"Got map\", v)\n            if len(elem.(map[string]interface{})) &gt; 1 || !validate(elem.([]interface{})) {\n                fmt.Println(\"Map length rule Violation!\")\n                result = false\n                break\n            }\n        default:\n            fmt.Println(\"Got struct:\", v)\n\n            // Convert to interface list all other structures no string/int/float/map:\n            new_v := reflect.ValueOf(elem)\n            new_values := make([]interface{}, new_v.NumField())\n            for j := 0; j &lt; new_v.NumField(); j++ {\n                new_values[j] = new_v.Field(j).Interface()\n            }\n\n            // Recursively call for validate nested structs\n            if !validate(new_values) {\n                result = false\n                break\n            }\n        }\n    }\n    fmt.Println(\"After Break 2\")\n    return result\n}\n\n\n\nfunc main() {\n// Test truct:\nx := C{1, B{\"abc\", A{10, 0.1, map[string]Host{\"1,2,3,4\": Host{\"1.2.3.4\"}}}}}\n\n// Conversion:\nv := reflect.ValueOf(x)\nvalues := make([]interface{}, v.NumField())\nfor i := 0; i &lt; v.NumField(); i++ {\n    values[i] = v.Field(i).Interface()\n}\n\n// Validate function verification\nfmt.Println(validate(values))\n}\n</code></pre>\n\n<p>In this example I can't ever reach case: map[string]interface{}</p>\n\n<p>Big kudos on helpful suggestions!</p>\n"}, {"tags": ["unicode", "go"], "comments": [{"owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 6, "creation_date": 1448577239, "post_id": 33947871, "comment_id": 55654625, "body": "Myth?! Which part of <a href=\"https://golang.org/ref/spec#Source_code_representation\" rel=\"nofollow noreferrer\">the spec</a> is unclear about this?"}, {"owner": {"reputation": 544, "user_id": 2469559, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/7DCjy.jpg?s=128&g=1", "display_name": "Benjamin R", "link": "https://stackoverflow.com/users/2469559/benjamin-r"}, "reply_to_user": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 0, "creation_date": 1448577379, "post_id": 33947871, "comment_id": 55654669, "body": "@KerrekSB Yep, see I knew I had read it somewhere, but why isn&#39;t it working? Maybe it&#39;s just the go-plus package, keeps saying it&#39;s an &#39;illegal character&#39;."}, {"owner": {"reputation": 228853, "user_id": 827263, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/216c1db53d752f87dd8176a6ba0c2190?s=128&d=identicon&r=PG", "display_name": "Keith Thompson", "link": "https://stackoverflow.com/users/827263/keith-thompson"}, "edited": false, "score": 1, "creation_date": 1448577502, "post_id": 33947871, "comment_id": 55654703, "body": "@BenjaminR: We don&#39;t know what you tried to do or just what error message you saw. Please update your question with that information."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1448578153, "post_id": 33947871, "comment_id": 55654907, "body": "Note that &quot;part of the UTF-8 set&quot; isn&#39;t a good measure of support: there are multiple versions of the spec, and <i>many</i> categories (ASCII being one of those, Cyrillic another, etc). Most programming languages with UTF-8 support usually restrict identifiers to a short list of categories."}, {"owner": {"reputation": 544, "user_id": 2469559, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/7DCjy.jpg?s=128&g=1", "display_name": "Benjamin R", "link": "https://stackoverflow.com/users/2469559/benjamin-r"}, "edited": false, "score": 0, "creation_date": 1448578161, "post_id": 33947871, "comment_id": 55654912, "body": "I&#39;ll take the -1 on the question, because believe me, there will be thousands of others who will google &#39;golang utf characters in variables&#39; or some equivalent. I deserve to be punished for being lazy, no doubt."}, {"owner": {"reputation": 544, "user_id": 2469559, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/7DCjy.jpg?s=128&g=1", "display_name": "Benjamin R", "link": "https://stackoverflow.com/users/2469559/benjamin-r"}, "edited": false, "score": 1, "creation_date": 1536169022, "post_id": 33947871, "comment_id": 91331097, "body": "For the record, this is now a &quot;notable question&quot;. You can either despair at this, or accept that maybe my asking it wasn&#39;t so unreasonable as first thought."}], "answers": [{"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 6, "last_activity_date": 1448582834, "last_edit_date": 1592644375, "creation_date": 1448577452, "answer_id": 33947930, "question_id": 33947871, "link": "https://stackoverflow.com/questions/33947871/does-go-golang-actually-permit-unicode-characters-in-variable-names/33947930#33947930", "title": "Does Go (golang) actually permit unicode characters in variable names?", "body": "<p>Go supports <em>some</em> of the Unicode categories as per <a href=\"https://golang.org/ref/spec#Identifiers\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Identifiers</a></p>\n<blockquote>\n<p>Identifiers name program entities such as variables and types. An identifier is a sequence of one or more letters and digits. The first character in an identifier must be a letter.</p>\n<pre><code>identifier = letter { letter | unicode_digit } .\n</code></pre>\n</blockquote>\n<p>The above classes are defined in the spec as:</p>\n<blockquote>\n<pre><code>unicode_letter = /* a Unicode code point classified as &quot;Letter&quot; */ .\nunicode_digit  = /* a Unicode code point classified as &quot;Decimal Digit&quot; */ .\n</code></pre>\n<p>In The Unicode Standard 6.3, Section 4.5 &quot;General Category&quot; defines a set of character categories. Go treats those characters in category <a href=\"http://www.fileformat.info/info/unicode/category/Lu/list.htm\" rel=\"nofollow noreferrer\">Lu</a>, <a href=\"http://www.fileformat.info/info/unicode/category/Ll/list.htm\" rel=\"nofollow noreferrer\">Ll</a>, <a href=\"http://www.fileformat.info/info/unicode/category/Lt/list.htm\" rel=\"nofollow noreferrer\">Lt</a>, <a href=\"http://www.fileformat.info/info/unicode/category/Lm/list.htm\" rel=\"nofollow noreferrer\">Lm</a>, or <a href=\"http://www.fileformat.info/info/unicode/category/Lo/list.htm\" rel=\"nofollow noreferrer\">Lo</a> as Unicode letters, and those in category <a href=\"http://www.fileformat.info/info/unicode/category/Nd/list.htm\" rel=\"nofollow noreferrer\">Nd</a> as Unicode digits.</p>\n</blockquote>\n<p>The 'short' answer is that <em>some</em> operators are supported, depending on their character class. The more esoteric/specialist ones won't be.</p>\n"}, {"tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": false, "score": 2, "last_activity_date": 1448578341, "creation_date": 1448578341, "answer_id": 33948088, "question_id": 33947871, "link": "https://stackoverflow.com/questions/33947871/does-go-golang-actually-permit-unicode-characters-in-variable-names/33948088#33948088", "title": "Does Go (golang) actually permit unicode characters in variable names?", "body": "<p>Why not\n\u013eubozvu\u010dn\u00e1_sloven\u010dina := 3</p>\n\n<p>works, althoght it is not good for other programmers, who don't understand this language.</p>\n"}, {"comments": [{"owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 7, "creation_date": 1505136902, "post_id": 42753718, "comment_id": 79275903, "body": "Woah there satan!"}], "tags": [], "owner": {"reputation": 2677, "user_id": 1740154, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/keyyz.jpg?s=128&g=1", "display_name": "twitchdotcom slash KANJICODER", "link": "https://stackoverflow.com/users/1740154/twitchdotcom-slash-kanjicoder"}, "is_accepted": false, "score": 6, "last_activity_date": 1489356042, "creation_date": 1489356042, "answer_id": 42753718, "question_id": 33947871, "link": "https://stackoverflow.com/questions/33947871/does-go-golang-actually-permit-unicode-characters-in-variable-names/42753718#42753718", "title": "Does Go (golang) actually permit unicode characters in variable names?", "body": "<p><strong>Yes</strong>. I've been programming for a few months in a mix of Japanese and English. All types in my project are two characters long.</p>\n\n<p>Example: </p>\n\n<pre><code>type T\u578b struct{}; //model      (literally: mold/model)\ntype T\u793a struct{}; //view       (literally: show      )\ntype T\u5e2b struct{}; //controller (literally: master    )\n</code></pre>\n\n<p>The antithesis of \"clean code\". The idea is that your brain is better at\nparsing short and concise variable names.</p>\n\n<p>Also, when creating a new problem domain, variable names get out of hand.\nImagine we are programming a new thing. It is milled oats mixed with water, a sweet crystalline substance, and then heat treated in a hot box for 35 minutes.</p>\n\n<p>Variable Name:\nHeatTreatedMilledOatsWithWaterAndSweetCrystal</p>\n\n<p>Yeah, we could just call it cake. But no one has invented cake yet.</p>\n\n<p>Or we could just:</p>\n\n<pre><code>//Literally: \u98df==\"Meal\". \n//In Code  : \u98df==\"Heat Treated Milled Oats,Water,And Sweet Crystal\"\ntype T\u98df struct{};\n</code></pre>\n"}], "owner": {"reputation": 544, "user_id": 2469559, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/7DCjy.jpg?s=128&g=1", "display_name": "Benjamin R", "link": "https://stackoverflow.com/users/2469559/benjamin-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5997, "favorite_count": 0, "accepted_answer_id": 33947930, "answer_count": 3, "score": 7, "last_activity_date": 1489356042, "creation_date": 1448577098, "last_edit_date": 1448593817, "question_id": 33947871, "link": "https://stackoverflow.com/questions/33947871/does-go-golang-actually-permit-unicode-characters-in-variable-names", "title": "Does Go (golang) actually permit unicode characters in variable names?", "body": "<p>Or is that a myth? <s>Can't see it mentioned in any official documentation</s> (it's there, D'oh!) \u2013 it sure doesn't seem to work for me when using Atom with the go-plus package. It's a shame as I am doing a lot of math operations, and I love mathematic notation. </p>\n\n<p>Update: I don't consider any mathematical symbol as esoteric: \u2016 \u23cb\u222a\nCompared to any emoji: \ud83d\ude00</p>\n\n<p>A yes or no answer with a reference to an official source would be sufficient for a tick!</p>\n\n<p>Update: Thanks to elithrar's answer, I found 'Latin letter lateral click' \u01c1 to be a seemingly perfect analogue to 'Double vertical line' that I wanted.</p>\n"}, {"tags": ["logging", "go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "edited": false, "score": 0, "creation_date": 1449715933, "post_id": 33948610, "comment_id": 56132022, "body": "With this, every where we need logging, we need to pass around request instance to retrieve the ID. This is painful. From handlers, we may call many functions which could be utility functions/database methods etc. All these methods can be modified to accept Request instance."}, {"owner": {"reputation": 3281, "user_id": 4131775, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KDmA5SDbD84/AAAAAAAAAAI/AAAAAAAAAAA/WQxPLtYrNu4/photo.jpg?sz=128", "display_name": "Feiyu Zhou", "link": "https://stackoverflow.com/users/4131775/feiyu-zhou"}, "edited": false, "score": 0, "creation_date": 1605166740, "post_id": 33948610, "comment_id": 114569345, "body": "Do Not Use gorilla/context anymore, it having been born well before context.Context existed, does not play well with the shallow copying of the request that http.Request.WithContext (added to net/http Go 1.7 onwards) performs."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": false, "score": 2, "last_activity_date": 1448582777, "last_edit_date": 1448582777, "creation_date": 1448582395, "answer_id": 33948610, "question_id": 33947545, "link": "https://stackoverflow.com/questions/33947545/go-log-thread-id-in-gorilla-handler/33948610#33948610", "title": "Go log thread id in Gorilla Handler", "body": "<p>The <a href=\"https://github.com/gorilla/handlers\" rel=\"nofollow\">gorilla/handlers</a> library doesn't provide a way to do this by default: the logging functions there log in Apache formats, which don't provide for this.</p>\n\n<p>Also keep in mind that a \"thread ID\" doesn't make sense here - you want a <em>request</em> ID that is associated with a <code>*http.Request</code>.</p>\n\n<p>You could write your own RequestID middleware that creates an ID and stores in the request context for other middleware/handlers to retrieve as-needed:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/rand\"\n    \"encoding/base64\"\n    \"net/http\"\n\n    \"github.com/gorilla/context\"\n)\n\nconst ReqID string = \"gorilla.RequestID\"\n\n// RequestID wraps handlers and makes a unique (32-byte) request ID available in\n// the request context.\n// Example:\n//      http.Handle(\"/\", RequestID(LoggingHandler(YourHandler)))\n//\n//      func LoggingHandler(h http.Handler) http.Handler {\n//          fn := func(w http.ResponseWriter, r *http.Request) {\n//              h.ServeHTTP(w, r)\n//\n//              id := GetRequestID(r)\n//              log.Printf(\"%s | %s\", id, r.RemoteAddr)\n//          }\n//\n//          return http.HandlerFunc(fn)\n//      }\nfunc RequestID(h http.Handler) http.Handler {\n    fn := func(w http.ResponseWriter, r *http.Request) {\n        b := make([]byte, 8)\n        _, err = rand.Read(&amp;b)\n        if err != nil {\n            http.Error(w, http.StatusText(500), 500)\n            return\n        }\n\n        base64ID := base64.URLEncoding.EncodeToString(b)\n\n        context.Set(r, ReqID, base64ID)\n\n        h.ServeHTTP(w, r)\n        // Clear the context at the end of the request lifetime\n        context.Clear(r)\n    }\n\n    return http.HandlerFunc(fn)\n}\n\nfunc GetRequestID(r *http.Request) string {\n    if v, ok := context.GetOK(r, ReqID); ok {\n        if id, ok := v.(string); ok {\n            return id\n        }\n    }\n\n    return \"\"\n}\n</code></pre>\n\n<p>Keep in mind that the code above is not tested. Written off the top of my head in the Playground, so please let me know if there's a bug.</p>\n\n<p>Improvements you could consider beyond this basic example:</p>\n\n<ul>\n<li>Prefix the ID with the hostname - helpful if you are aggregating logs from multiple processes/machines)</li>\n<li>Provide a timestamp or incrementing integer as part of the final ID to help trace requests over time</li>\n<li>Benchmark it.</li>\n</ul>\n\n<p>Note that under extremely high loads (e.g. tens of thousands of req/s - tens of millions of hits per day), this may not be performant, but is unlikely to be a bottleneck for > 99% of users.</p>\n\n<p>PS: I may look at providing a <code>handlers.RequestID</code> implementation in the gorilla/handlers library at some point - if you'd like to see it, raise an issue on the repo and I'll see if I can find time to implement a more complete take on the above.</p>\n"}, {"tags": [], "owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "is_accepted": true, "score": 0, "last_activity_date": 1449764355, "creation_date": 1449764355, "answer_id": 34206765, "question_id": 33947545, "link": "https://stackoverflow.com/questions/33947545/go-log-thread-id-in-gorilla-handler/34206765#34206765", "title": "Go log thread id in Gorilla Handler", "body": "<p>Based on <a href=\"https://groups.google.com/forum/#!searchin/golang-nuts/Logging\" rel=\"nofollow\">https://groups.google.com/forum/#!searchin/golang-nuts/Logging</a>$20http$20thread/golang-nuts/vDNEH3_vMXQ/uyqGEwdchzgJ, <code>ThreadLocal</code> concept is not possible with Go. <br><br>Every where you need logging, it requires to pass in http <code>Request</code> instance so that the context associated with the request can be retrieved and one can fetch the unique ID from this context for the request.\nBut its not practical to pass Request instance to all the layers/methods.</p>\n"}], "owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1499, "favorite_count": 0, "accepted_answer_id": 34206765, "answer_count": 2, "score": 2, "last_activity_date": 1449764355, "creation_date": 1448574947, "last_edit_date": 1448575559, "question_id": 33947545, "link": "https://stackoverflow.com/questions/33947545/go-log-thread-id-in-gorilla-handler", "title": "Go log thread id in Gorilla Handler", "body": "<p>How do we get the <code>thread id</code> or any other unique Id of the http request being handled by the handler in logging inside <code>Gorilla Handlers</code>?\n<br>\nIn Java, when Tomcat or other container handles multiple http requests, thread id helps to track all the log messages for respective http request handling.\n<br>\nWhat is the equivalent in <code>Go</code>? Given a Rest API developed using <code>Gorilla</code> library, how do I track all log statements of specific http request inside a handler processing?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14981, "user_id": 2679935, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/wU0qy.jpg?s=128&g=1", "display_name": "julienc", "link": "https://stackoverflow.com/users/2679935/julienc"}, "edited": false, "score": 0, "creation_date": 1448573276, "post_id": 33947044, "comment_id": 55653328, "body": "Why don&#39;t you want to use reflection? Performance issues?"}, {"owner": {"reputation": 4049, "user_id": 1133802, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/c77d19fe400931dea2eb52303a851bb6?s=128&d=identicon&r=PG", "display_name": "mostruash", "link": "https://stackoverflow.com/users/1133802/mostruash"}, "reply_to_user": {"reputation": 14981, "user_id": 2679935, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/wU0qy.jpg?s=128&g=1", "display_name": "julienc", "link": "https://stackoverflow.com/users/2679935/julienc"}, "edited": false, "score": 0, "creation_date": 1448574238, "post_id": 33947044, "comment_id": 55653697, "body": "I&#39;m still trying to figure out if Go has merits over C other than readability, having reflection and goroutines. Lots of language features are missing and it works on top of a garbage collector.   Other than that, I couldn&#39;t find a (un)marshaller that behaves as I want it to and too lazy to write my own."}], "answers": [{"comments": [{"owner": {"reputation": 4049, "user_id": 1133802, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/c77d19fe400931dea2eb52303a851bb6?s=128&d=identicon&r=PG", "display_name": "mostruash", "link": "https://stackoverflow.com/users/1133802/mostruash"}, "edited": false, "score": 0, "creation_date": 1448575184, "post_id": 33947477, "comment_id": 55654012, "body": "I wanted to control what happens when one of the properties in the map doesn&#39;t exist. Let&#39;s assume <code>age</code> can be 0. I believe <code>mapstructure</code> will assign 0-value to <code>age</code> if it doesn&#39;t exist in the map. What if I want to return an error in some cases and allow 0-value in others? If there were a nullable integer type, that would solve my problem as I could figure out if the value doesn&#39;t exist or if it&#39;s actually zero."}, {"owner": {"reputation": 4049, "user_id": 1133802, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/c77d19fe400931dea2eb52303a851bb6?s=128&d=identicon&r=PG", "display_name": "mostruash", "link": "https://stackoverflow.com/users/1133802/mostruash"}, "edited": false, "score": 0, "creation_date": 1448575691, "post_id": 33947477, "comment_id": 55654189, "body": "But still, when you decode <code>{id: 0, name: &quot;test&quot;}</code>, <code>result.Age</code> will be 0. When you decode <code>{id: 0, name: &quot;test&quot;, age: 0}</code>, <code>result.Age</code> will be 0 again. So I cannot know for sure if age exists in the map or not. Basically in mathematical terms, I need <code>Decode</code> to be a 1-to-1 function :)"}, {"owner": {"reputation": 14981, "user_id": 2679935, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/wU0qy.jpg?s=128&g=1", "display_name": "julienc", "link": "https://stackoverflow.com/users/2679935/julienc"}, "reply_to_user": {"reputation": 4049, "user_id": 1133802, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/c77d19fe400931dea2eb52303a851bb6?s=128&d=identicon&r=PG", "display_name": "mostruash", "link": "https://stackoverflow.com/users/1133802/mostruash"}, "edited": false, "score": 0, "creation_date": 1448575899, "post_id": 33947477, "comment_id": 55654262, "body": "Well, I agree this is a limitation of my solution ... I will try to find a workaround, but I can&#39;t think of any one right now."}], "tags": [], "owner": {"reputation": 14981, "user_id": 2679935, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/wU0qy.jpg?s=128&g=1", "display_name": "julienc", "link": "https://stackoverflow.com/users/2679935/julienc"}, "is_accepted": false, "score": 3, "last_activity_date": 1448575491, "last_edit_date": 1448575491, "creation_date": 1448574490, "answer_id": 33947477, "question_id": 33947044, "link": "https://stackoverflow.com/questions/33947044/convert-map-to-struct/33947477#33947477", "title": "Convert map to struct", "body": "<p>Let's say I assume you don't want to use reflection because you don't want to do it yourself. In this case, what about using an <a href=\"https://github.com/mitchellh/mapstructure\" rel=\"nofollow\">external package</a> that does it for you ?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"github.com/mitchellh/mapstructure\"\n\ntype MyStruct struct {\n    Id   int\n    Name string\n    Age  int\n}\n\nfunc main() {\n    var m = make(map[string]interface{})\n    m[\"Id\"] = 17\n    m[\"Name\"] = \"foo\"\n    m[\"Age\"] = 42\n    fmt.Printf(\"%+v\\n\", m)\n\n    res, err := CreateFromMap(m)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(\"%+v\\n\", res)\n}\n\nfunc CreateFromMap(m map[string]interface{}) (MyStruct, error) {\n    var result MyStruct\n    err := mapstructure.Decode(m, &amp;result)\n    return result, err\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>map[Age:42 Name:foo Id:17]\n{Id:17 Name:foo Age:42}\n</code></pre>\n\n<p>It has the advantage to work whatever your structure looks like, but it uses reflection internally. Actually, I don't see any \"nice\" way to do what you want without using reflection and/or repetitive code for each attribute of your structure. The downside, however, is that you will have to use capitalized attributes so that they would be exported to external packages.</p>\n\n<h3>Edit (to answer your question in the comments):</h3>\n\n<p>On my opinion, if you want to specify additional rules when \"creating\" the structure, it should be after the decoding operation.\nFor instance:</p>\n\n<pre><code>func CreateFromMap(m map[string]interface{}) (MyStruct, error) {\n    var result MyStruct\n    err := mapstructure.Decode(m, &amp;result)\n    if err != nil {\n         return result, err\n    }\n    if result.Age &lt;= 0 {\n        result.Age = 0\n    }\n    if result.Name == \"\" {\n        return result, errors.New(\"empty name is not allowed\")\n    }\n\n    return result, err\n}\n</code></pre>\n\n<p>This way, you will clearly separate the \"conversion\" part from your structure's specific rules processing.</p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 5047482, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wIHWjkm5N5o/AAAAAAAAAAI/AAAAAAAAAKc/Iawajkdm00c/photo.jpg?sz=128", "display_name": "Georgi Alexandrov", "link": "https://stackoverflow.com/users/5047482/georgi-alexandrov"}, "is_accepted": false, "score": 5, "last_activity_date": 1510845752, "creation_date": 1510845752, "answer_id": 47333324, "question_id": 33947044, "link": "https://stackoverflow.com/questions/33947044/convert-map-to-struct/47333324#47333324", "title": "Convert map to struct", "body": "<p>You can just Marshal/Unmarshal, but property names should match</p>\n\n<pre><code>func CreateFromMap(m map[string]interface{}) (MyStruct, error) {\n    data, _ := json.Marshal(m)\n    var result MyStruct\n    err := json.Unmarshal(data, &amp;result)\n    return result, err\n}\n</code></pre>\n"}], "owner": {"reputation": 4049, "user_id": 1133802, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/c77d19fe400931dea2eb52303a851bb6?s=128&d=identicon&r=PG", "display_name": "mostruash", "link": "https://stackoverflow.com/users/1133802/mostruash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7725, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1510845752, "creation_date": 1448572276, "question_id": 33947044, "link": "https://stackoverflow.com/questions/33947044/convert-map-to-struct", "title": "Convert map to struct", "body": "<p>Ok, the title is a little bit misleading. What I'm after is as follows:</p>\n\n<pre><code>type MyStruct struct {\n    id   int\n    name string\n    age  int\n}\n\nfunc CreateFromMap(m map[string]interface{}) (MyStruct, error) {\n    var (\n        id   int\n        name string\n        age  int\n        ok   bool\n    )\n    err := errors.New(\"Error!\")\n    id, ok = m[\"id\"].(int)\n    if !ok {\n        return nil, err\n    }\n    name, ok = m[\"name\"].(string)\n    if !ok {\n        return nil, err\n    }\n    age, ok = m[\"age\"].(int)\n    if !ok {\n        return nil, err\n    }\n    return MyStruct{id, name, age}, nil\n}\n</code></pre>\n\n<p><strong>Don't ask:</strong> Why I'm not using <code>CreateFromMap(int, string, int)</code>. That object comes from somewhere else, out of my control.</p>\n\n<p>It's already boring to map each key, value pair in the map to struct properties. But checking if everything is <code>ok</code> or not after each conversion is chaotic.</p>\n\n<p>Is there an easier way of doing this other than reflection?</p>\n"}, {"tags": ["go", "mocking"], "answers": [{"tags": [], "owner": {"reputation": 3695, "user_id": 1360261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/710b744442d5e038351521a8d8f3e661?s=128&d=identicon&r=PG", "display_name": "Bubbles", "link": "https://stackoverflow.com/users/1360261/bubbles"}, "is_accepted": false, "score": 2, "last_activity_date": 1448573033, "last_edit_date": 1448573033, "creation_date": 1448572664, "answer_id": 33947133, "question_id": 33945873, "link": "https://stackoverflow.com/questions/33945873/how-can-i-mock-a-method-on-go/33947133#33947133", "title": "How can I mock a method on Go?", "body": "<p>Since Go does not have any form of inheritance, you probably won't be able to get exactly what you're looking for. However, there are some alternate approaches to these kinds of relationships that I find work well enough.</p>\n\n<p>But first, let's take a deeper look into what, exactly is going on in your code. You probably already know most of this, but restating it might make the behavior a little more obvious:</p>\n\n<p>When you initially declare <code>mockFoo</code>:</p>\n\n<pre><code>type mockFoo struct {\n    *foo\n}\n</code></pre>\n\n<p>This doesn't create any real relationship between the two types. What it does do is promote methods from <code>foo</code> to <code>mockFoo</code>. That means any method on <code>foo</code> that is not also on <code>mockFoo</code> will be added to the latter. So that means <code>myB.largerInt()</code> and <code>myB.foo.largerInt()</code> are identical invocations; there's just no real relationship from foo->mockFoo that can be used like you laid out.</p>\n\n<p>This is intentional - part of the idea of composition opposed to inheritance is that it makes it considerably easier to reason about the behavior of subcomponents by limiting how they interact.</p>\n\n<hr>\n\n<p>So: where does that leave you? I'd say that conventional mocking won't port very well with Go, but similar principles will. Rather than trying to \"subclass\" foo by creating a wrapper, you have to isolate all the methods of the mocked target into a distinct interface.</p>\n\n<p>But: what if you want to test methods on <code>foo</code> that have no side effects? You've already hit upon one alternative to this: put all the functionality you wish to test in separate static methods. Then <code>foo</code> can delegate all its static behavior to them, and they will be quite easy to test.</p>\n\n<p>There are other options that are more akin to the structure you laid out. For instance, you could invert the relationship between <code>mockFoo</code> and <code>foo</code>:</p>\n\n<pre><code>type foo struct {\n    fooMethods\n}\n\ntype fooMethods interface {\n    largeInt() int\n}\n\nfunc (this *foo) largerInt() int {\n    return this.largeInt() + 10\n}\n\ntype fooMethodsStd struct{}\n\nfunc (this *fooMethodsStd) largeInt() int {\n    return 42\n}\n\nvar defaultFooMethods = &amp;fooMethodsStd{}\n\ntype fooMethodsMock struct{}\n\nfunc (this *fooMethodsMock) largeInt() int {\n    return 43\n}\n\nvar mockedFooMethods = &amp;fooMethodsMock{}\n\nfunc main() {\n    normal := foo{defaultFooMethods}\n    mocked := foo{mockedFooMethods}\n\n    fmt.Println(normal.largerInt()) // 52\n    fmt.Println(mocked.largerInt()) // 53\n}\n</code></pre>\n\n<p>Then, you \"plug\" the stateful component of the struct rather than manage it through inheritance. You'd then set if to <code>defaultFooMethods</code> during runtime, and use a mocked version for testing. This is a little annoying due to the lack of default values in structs, but it works.</p>\n\n<hr>\n\n<p>For those who favor composition over inheritance, this is a feature, not a bug. Arbitrarily mocking methods with side effects is a messy business - there's nothing in the program itself to suggest what is stateful and must be isolated, and what is not. Forcing the clarification of the relationship beforehand can take some more work, but does make the interactions and behavior of the code more obvious.</p>\n"}], "owner": {"reputation": 2455, "user_id": 1130121, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/pyv4p.jpg?s=128&g=1", "display_name": "konr", "link": "https://stackoverflow.com/users/1130121/konr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1448573033, "creation_date": 1448566407, "question_id": 33945873, "link": "https://stackoverflow.com/questions/33945873/how-can-i-mock-a-method-on-go", "title": "How can I mock a method on Go?", "body": "<p>Suppose I have a type <code>foo</code> with a method <code>largerInt()</code> that calls <code>largeInt()</code>. I want to test <code>largerInt()</code>, so I need to mock <code>largeInt()</code>, because of possible side effects. </p>\n\n<p>I'm failing to do so, however. Using interfaces and composition, I can mock <code>largeInt()</code>, but inside <code>largerInt()</code>, it seems unmockable, as when calling it, there are no references to the wrapper type.</p>\n\n<p>Any idea on how to do it? Below is a snippet I created to illustrate the problem</p>\n\n<p>Thanks!</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype foo struct {\n}\n\ntype mockFoo struct {\n    *foo\n}\n\ntype MyInterface interface {\n    largeInt() int\n}\n\nfunc standaloneLargerInt(obj MyInterface) int {\n    return obj.largeInt() + 10\n}\n\nfunc (this *foo) largeInt() int {\n    return 42\n}\n\nfunc (this *mockFoo) largeInt() int {\n    return 43\n}\n\nfunc (this *foo) largerInt() int {\n    return this.largeInt() + 10\n}\n\nfunc main() {\n    myA := &amp;foo{}\n    myB := &amp;mockFoo{}\n    fmt.Printf(\"%s\\n\", standaloneLargerInt(myA)) // 52\n    fmt.Printf(\"%s\\n\", standaloneLargerInt(myB)) // 53\n\n    fmt.Printf(\"%s\\n\", myA.largerInt()) // 52\n    fmt.Printf(\"%s\\n\", myB.largerInt()) // 52\n\n}\n</code></pre>\n"}, {"tags": ["windows", "go"], "answers": [{"tags": [], "owner": {"reputation": 346, "user_id": 3747083, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tCQCI.jpg?s=128&g=1", "display_name": "Kookerus", "link": "https://stackoverflow.com/users/3747083/kookerus"}, "is_accepted": true, "score": 12, "last_activity_date": 1448566187, "last_edit_date": 1495542813, "creation_date": 1448566187, "answer_id": 33945828, "question_id": 33945738, "link": "https://stackoverflow.com/questions/33945738/do-i-need-the-go-language-runtime-to-run-a-compiled-go-application/33945828#33945828", "title": "Do I need the Go language runtime to run a compiled Go application?", "body": "<p>As long as any dependencies your program has are installed on the machine running the program, or your program is statically compiled, the user will be able to run your program without installing anything. A better answer might be <a href=\"https://stackoverflow.com/a/23072968/3747083\">here</a>.</p>\n"}], "owner": {"reputation": 226, "user_id": 2664162, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000969615516/picture?type=large", "display_name": "Mark Howard", "link": "https://stackoverflow.com/users/2664162/mark-howard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4660, "favorite_count": 1, "accepted_answer_id": 33945828, "answer_count": 1, "score": 7, "last_activity_date": 1448566187, "creation_date": 1448565725, "question_id": 33945738, "link": "https://stackoverflow.com/questions/33945738/do-i-need-the-go-language-runtime-to-run-a-compiled-go-application", "title": "Do I need the Go language runtime to run a compiled Go application?", "body": "<p>With the Go programming language when I build an executable on Windows do I need the Go runtime installed to run the application on another machine?</p>\n"}, {"tags": ["go", "beego", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 249, "user_id": 1644033, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/25a28669256c08e8b495ced8e69507a4?s=128&d=identicon&r=PG&f=1", "display_name": "user1644033", "link": "https://stackoverflow.com/users/1644033/user1644033"}, "is_accepted": true, "score": 3, "last_activity_date": 1448647399, "last_edit_date": 1495535578, "creation_date": 1448647399, "answer_id": 33962751, "question_id": 33945624, "link": "https://stackoverflow.com/questions/33945624/beego-template-value-range-executing-content-not-a-field-of-struct-type/33962751#33962751", "title": "beego template value range executing &quot;content&quot; not a field of struct type", "body": "<p>I found this nice little link: <a href=\"https://stackoverflow.com/questions/14800204/in-a-template-how-do-you-access-an-outer-scope-while-inside-of-a-with-or-rang?rq=1\">In a template how do you access an outer scope while inside of a &quot;with&quot; or &quot;range&quot; scope?</a></p>\n\n<pre><code>{{with .Inner}}\n  Outer: {{$.OuterValue}}\n  Inner: {{.InnerValue}}\n{{end}}\n</code></pre>\n\n<p>That's it. :)</p>\n"}], "owner": {"reputation": 249, "user_id": 1644033, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/25a28669256c08e8b495ced8e69507a4?s=128&d=identicon&r=PG&f=1", "display_name": "user1644033", "link": "https://stackoverflow.com/users/1644033/user1644033"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 33962751, "answer_count": 1, "score": 2, "last_activity_date": 1448647399, "creation_date": 1448565270, "question_id": 33945624, "link": "https://stackoverflow.com/questions/33945624/beego-template-value-range-executing-content-not-a-field-of-struct-type", "title": "beego template value range executing &quot;content&quot; not a field of struct type", "body": "<p>in my controller i set the following data:</p>\n\n<pre><code>c.Data[\"foos\"] = foos\n</code></pre>\n\n<p>and</p>\n\n<pre><code>c.Data[\"user\"] = user\n</code></pre>\n\n<p>So if I ask some property from user in the view, all fine.</p>\n\n<pre><code>{{if .user.IsSuperUser}}\n    &lt;th&gt;ID&lt;/th&gt;\n    &lt;th&gt;Username&lt;/th&gt;\n{{end}}\n</code></pre>\n\n<p>But in:</p>\n\n<pre><code>&lt;tbody&gt;\n{{range $foo := .foos}}\n   &lt;tr&gt;\n   {{if .user.IsSuperUser}}\n      &lt;td&gt;xyz&lt;/td&gt;\n      &lt;td&gt;abc&lt;/td&gt;\n   {{end}}\n...\n</code></pre>\n\n<blockquote>\n  <p>myBeego:template: foo/foos.tpl:56:46: executing \"content\" at\n  &lt;.user.IsSuperUser>: user is not a field of struct type *models.Foo</p>\n</blockquote>\n\n<p>How can I handle that?</p>\n\n<p>Thanks for every help and happy Thanksgiving.</p>\n"}, {"tags": ["linux", "sockets", "go", "tcp"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1448558971, "post_id": 33943028, "comment_id": 55647597, "body": "Uh... The first example uses the <code>printf</code> command which is a POSIX shell&#39;s builtin. It works (somewhat) like <code>echo</code> so your shell example sends a string &quot;COMMAND HERE&quot; without double quotes and a newline to <code>nc</code>&#39;s stdin. Then in your Go example you suddenly list <code>printf</code> in the string which you send to your server. Is this intended? And do you really need <code>\\\\n</code>s? Each <code>\\` gets replaced with one </code>` so you&#39;re literally sending <code>\\n</code>s to the server. I&#39;d say your <code>TransCommand</code> should be something like <code>&quot;cmd:list_cmds\\ncommit:1\\nend\\n&quot;</code> or such."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1448559120, "post_id": 33943028, "comment_id": 55647669, "body": "You see, too many questions arise just from analyzing your post. That is, your question is too far from an <a href=\"http://stackoverflow.com/help/mcve\">MCVE</a>. So please try 1) narrowing your problem(s) down. Use Wireshark to sniff the network traffic which gets passed to the server and verify that a) what gets passed is what you expect to be passed; b) the server responds. 2) Isolate different problems and solve them separately."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1448559504, "post_id": 33943028, "comment_id": 55647833, "body": "Another obvious flaw with your code is that you look at TCP as if it was a message-oriented transport, while <i>it is not!</i> When you <code>conn.Read()</code>, it might legitimately return you a single byte even if you pass it a 100MiB-worth buffer. So if you really intend to implement some ASCII-line-based protocol over TCP, consider using <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"nofollow noreferrer\"><code>bufio.Scanner</code></a> or -- better -- <a href=\"https://golang.org/pkg/net/textproto/\" rel=\"nofollow noreferrer\"><code>net&#47;textproto</code></a>. You might look at how <code>net&#47;smtp</code> is implemented to get the idea."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1448559880, "post_id": 33943028, "comment_id": 55648009, "body": "And by the way, why you have tagged your question <code>ssh</code>? Is there SSH involved? If so, may it be that you&#39;re just trying to somehow reimplement <a href=\"https://godoc.org/golang.org/x/crypto/ssh\" rel=\"nofollow noreferrer\"><code>crypto&#47;ssh</code></a>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1448593896, "post_id": 33943028, "comment_id": 55658238, "body": "Your first read will exit the process immediate if the server closed the connection, your second read (via ioutil.ReadAll) will block indefinitely until the server closes the connection."}, {"owner": {"reputation": 1067, "user_id": 435478, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Fj0sO.jpg?s=128&g=1", "display_name": "Hamza", "link": "https://stackoverflow.com/users/435478/hamza"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1448626243, "post_id": 33943028, "comment_id": 55671889, "body": "@kostix You are right, I was so confused, I had to pass the command without the printf or escaping the \\n, the printf actually will evaluate the string, then pass it to nc stdin, now the command is executed properly and I get the result back, All I&#39;m dealing with now is how to properly read the result"}, {"owner": {"reputation": 1067, "user_id": 435478, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Fj0sO.jpg?s=128&g=1", "display_name": "Hamza", "link": "https://stackoverflow.com/users/435478/hamza"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1448626304, "post_id": 33943028, "comment_id": 55671929, "body": "@kostix about the ssh tag, yes I was interested in creating an SSH client instead if the current process is not a wise choice"}], "owner": {"reputation": 1067, "user_id": 435478, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Fj0sO.jpg?s=128&g=1", "display_name": "Hamza", "link": "https://stackoverflow.com/users/435478/hamza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1314, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1448565221, "creation_date": 1448554483, "last_edit_date": 1448565221, "question_id": 33943028, "link": "https://stackoverflow.com/questions/33943028/how-to-execute-a-command-via-an-open-tcp-connection-in-golang", "title": "How to execute a command via an open TCP connection in Golang", "body": "<p>I have a problem with Golang, what I'm trying to do is open a TCP connection with a transaction server, execute command then get the output.</p>\n\n<p>I'm used to send the command using nc :</p>\n\n<pre><code>printf \"COMMAND HERE\" | nc HOST PORT\n</code></pre>\n\n<p>For the golang wrapper in dev, This is my current code :</p>\n\n<pre><code>     TransCommand := \"printf \\\"cmd:list_cmds\\\\ncommit:1\\\\nend\\\\n\\\"\"\n     conn, err := net.Dial(\"tcp\", hostName+\":\"+portNum)\n\n     if err != nil {\n             fmt.Println(err)\n             return\n     }\n\n     _, err = conn.Write([]byte(TransCommand))\n    if err != nil {\n            println(\"Write to server failed:\", err.Error())\n            os.Exit(1)\n    }\n\n    println(\"Writing to Trans : \", TransCommand)\n\n    reply := make([]byte, 4096)\n\n    _, err = conn.Read(reply)\n    if err != nil {\n            println(\"Write to Trans server failed:\", err.Error())\n            os.Exit(1)\n    }\n\n    println(\"Response from Trans : \", string(reply))\n\n\n    fmt.Println(ioutil.ReadAll(conn))\n\n\n    conn.Close()\n</code></pre>\n\n<p>It only returns an output saying that TCP connection is open, I use the same logic in a Ruby GEM, and it works great :</p>\n\n<pre><code>def tcp_send_and_receive(native)\n        socket = TCPSocket.new(@host, @port)\n\n        while line = socket.gets\n          break if line == \"220 CONNECTED.\\n\"\n        end\n\n        socket.write(native)\n        native_reply = socket.read\n        native_reply\n      end\n</code></pre>\n\n<p>Is there any difference between Golang and the Ruby implementation ? if not can I stimulate the execution of the command using a TCP connection to the server ?</p>\n"}, {"tags": ["networking", "go", "interface", "promiscuous-mode"], "answers": [{"tags": [], "owner": {"reputation": 2736, "user_id": 370662, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/10f19a9e600c4ed64f53a986fba57e21?s=128&d=identicon&r=PG", "display_name": "korylprince", "link": "https://stackoverflow.com/users/370662/korylprince"}, "is_accepted": false, "score": 3, "last_activity_date": 1448789579, "last_edit_date": 1495540389, "creation_date": 1448789579, "answer_id": 33981311, "question_id": 33942828, "link": "https://stackoverflow.com/questions/33942828/golang-get-promiscuous-mode-status-of-network-interfaces/33981311#33981311", "title": "Golang - get promiscuous mode status of network interfaces", "body": "<p>It doesn't appear Go has a cross-platform way of checking the PROMISC flag (I can't even find out for sure if such a flag exists for windows.) Here is a way to get it on linux, which I'm guessing you're on:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"syscall\"\n    \"unsafe\"\n)\n\nfunc GetPromiscuous(i net.Interface) (bool, error) {\n    tab, err := syscall.NetlinkRIB(syscall.RTM_GETLINK, syscall.AF_UNSPEC)\n    if err != nil {\n        return false, os.NewSyscallError(\"netlinkrib\", err)\n    }\n    msgs, err := syscall.ParseNetlinkMessage(tab)\n    if err != nil {\n        return false, os.NewSyscallError(\"parsenetlinkmessage\", err)\n    }\nloop:\n    for _, m := range msgs {\n        switch m.Header.Type {\n        case syscall.NLMSG_DONE:\n            break loop\n        case syscall.RTM_NEWLINK:\n            ifim := (*syscall.IfInfomsg)(unsafe.Pointer(&amp;m.Data[0]))\n            if ifim.Index == int32(i.Index) {\n                return (ifim.Flags &amp; syscall.IFF_PROMISC) != 0, nil\n            }\n        }\n    }\n    return false, os.ErrNotExist\n}\n\nfunc main() {\n    ints, err := net.Interfaces()\n    if err != nil {\n        panic(err)\n    }\n\n    for _, i := range ints {\n        p, err := GetPromiscuous(i)\n        if err != nil {\n            panic(err)\n        }\n        fmt.Println(i.Name, p)\n    }\n}\n</code></pre>\n\n<p>This is based of the <a href=\"https://golang.org/src/net/interface_linux.go#L16\" rel=\"nofollow noreferrer\"><code>interfaceTable</code></a> function in the standard library. It uses <a href=\"http://man7.org/linux/man-pages/man7/rtnetlink.7.html\" rel=\"nofollow noreferrer\"><code>rtnetlink</code></a> to get the flags of the interface. Unless you want to roll your own <code>syscall.NetlinkRIB</code> function, this code will always pull the information for every network device and filter out the requested one.</p>\n\n<p>A bit less magical way to get the flag you want is to use cgo and ioctl:</p>\n\n<pre><code>package main\n\n/*\n#include &lt;stdlib.h&gt;\n#include &lt;stdbool.h&gt;\n#include &lt;string.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;sys/ioctl.h&gt;\n#include &lt;net/if.h&gt;\n\nbool is_promisc(char *name) {\n    int s = socket(AF_INET, SOCK_STREAM, 0);\n    struct ifreq *i = malloc(sizeof *i);\n\n    strncpy((char *)&amp;(i-&gt;ifr_name), name, IFNAMSIZ);\n\n    ioctl(s, SIOCGIFFLAGS, i);\n\n    bool p = (i-&gt;ifr_flags &amp; IFF_PROMISC) != 0;\n\n    free(i);\n\n    return p;\n}\n*/\nimport \"C\"\nimport (\n    \"fmt\"\n    \"net\"\n)\n\nfunc GetPromiscuous(i net.Interface) (bool, error) {\n    set, err := C.is_promisc(C.CString(i.Name))\n    return bool(set), err\n}\n\nfunc main() {\n    ints, err := net.Interfaces()\n    if err != nil {\n        panic(err)\n    }\n\n    for _, i := range ints {\n        p, err := GetPromiscuous(i)\n        if err != nil {\n            panic(err)\n        }\n        fmt.Println(i.Name, p)\n    }\n\n}\n</code></pre>\n\n<p>A final note is that either way may not always tell you correctly whether an interface is actually in promiscuous mode or not. See <a href=\"http://oss.sgi.com/projects/netdev/archive/2002-02/msg00031.html\" rel=\"nofollow noreferrer\">this thread</a> for more details.</p>\n\n<p>From what I'm reading using the netlink route should work correctly, but another post says we should be checking the promiscuous count. Please let me know if someone knows how to do that, because I can't find how to. The <a href=\"https://stackoverflow.com/questions/22533297/detect-if-interface-is-in-promiscuous-mode-with-c?rq=1\">only stackoverflow question</a> on the matter has <a href=\"https://xkcd.com/979/\" rel=\"nofollow noreferrer\">gone unanswered</a>.</p>\n\n<p>I think either of these methods will work as long as you're not doing any crazy networking stuff (bridge, vlan interfaces, macvtap, etc.) The code definitely works if you use iproute2 tools to turn promisc on and off on an interface.</p>\n"}, {"tags": [], "owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "is_accepted": true, "score": 2, "last_activity_date": 1449219979, "creation_date": 1449219979, "answer_id": 34084479, "question_id": 33942828, "link": "https://stackoverflow.com/questions/33942828/golang-get-promiscuous-mode-status-of-network-interfaces/34084479#34084479", "title": "Golang - get promiscuous mode status of network interfaces", "body": "<p>The working environment is Ubuntu, I used the <code>ifconfig</code> command and checked each interface details to see if it contains the word <code>PROMISC</code>. Something like this:</p>\n\n<pre><code>//\n// get the interfaces\n//\ninterfaces, err := net.Interfaces()\n\n//\n// run the ifconfig command\n//\nout, err := exec.Command(\"/bin/sh\", \"-c\", \"ifconfig\").Output()\n\nvar ifc Iface\nvar ifaceset []Iface\n\n//\n// split the output to handle each interface separately\n//\nvar ifaceDetails = strings.Split(string(out), \"\\n\\n\")\n\n//\n// iterate interfaces\n//\nfor _, i := range interfaces {\n    ifc.Name = i.Name\n    if strings.Contains(i.Flags.String(), \"up\") {\n    ifc.Status = \"UP\"\n    } else {\n        ifc.Status = \"DOWN\"\n    }\n    if strings.Contains(i.Flags.String(), \"multicast\") {\n        ifc.Multicast = true\n    } else {\n        ifc.Multicast = false\n    }\n    if strings.Contains(i.Flags.String(), \"broadcast\") {\n        ifc.Broadcast = true\n    } else {\n        ifc.Broadcast = false\n    }\n\n    //\n    // try to find the word PROMISC to check if it is UP\n    //\n    for _, ifdetails := range ifaceDetails {\n        if strings.Contains(ifdetails, i.Name) {\n            if strings.Contains(ifdetails, \"PROMISC\") {\n                ifc.Promisc = true\n            } else {\n                ifc.Promisc = false\n            }\n\n        }\n    }\n    ifaceset = append(ifaceset, ifc)\n}\n</code></pre>\n\n<p>}</p>\n"}], "owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2063, "favorite_count": 1, "accepted_answer_id": 34084479, "answer_count": 2, "score": 2, "last_activity_date": 1504868571, "creation_date": 1448553779, "last_edit_date": 1504868571, "question_id": 33942828, "link": "https://stackoverflow.com/questions/33942828/golang-get-promiscuous-mode-status-of-network-interfaces", "title": "Golang - get promiscuous mode status of network interfaces", "body": "<p>I use the following Go code to get some info about the network interfaces. Any suggestions on how I would be able to get the status of promiscuous mode for each interface?</p>\n\n<pre><code>type Iface struct {\n  Name      string `json:\"name\"`\n  Status    string `json:\"status\"`\n  Multicast bool   `json:\"multicast\"`\n  Broadcast bool   `json:\"broadcast\"`\n}\n\nfunc (c *InterfacesController) GetInterfaces() {\n  interfaces, err := net.Interfaces()\n\n  if err != nil {\n    fmt.Println(err)\n    return\n  }\n\n  var ifaceset []Iface\n  var ifc Iface\n\n  for _, i := range interfaces {\n    ifc.Name = i.Name\n    if strings.Contains(i.Flags.String(), \"up\") {\n        ifc.Status = \"UP\"\n    } else {\n        ifc.Status = \"DOWN\"\n    }\n    if strings.Contains(i.Flags.String(), \"multicast\") {\n        ifc.Multicast = true\n    } else {\n        ifc.Multicast = false\n    }\n    if strings.Contains(i.Flags.String(), \"broadcast\") {\n        ifc.Broadcast = true\n    } else {\n        ifc.Broadcast = false\n    }\n    ifaceset = append(ifaceset, ifc)\n  }\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 277, "user_id": 1429798, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4b4ef66644c8053b172cc5a9c7e0daa6?s=128&d=identicon&r=PG", "display_name": "zelon", "link": "https://stackoverflow.com/users/1429798/zelon"}, "edited": false, "score": 0, "creation_date": 1448678517, "post_id": 33942814, "comment_id": 55691788, "body": "Thank you. You&#39;re right. And I&#39;ve had slow latency with production performance because of my region. I&#39;m in Korea. I&#39;ve tried the appengine with go in US central via cloud computing. That response with 37ms."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1448553728, "creation_date": 1448553728, "answer_id": 33942814, "question_id": 33942583, "link": "https://stackoverflow.com/questions/33942583/too-slow-ttfblatency-with-go-language-in-appengine/33942814#33942814", "title": "too slow TTFB(latency) with go language in appengine", "body": "<p>Local test performance has nothing to do with production performance. There is nothing wrong with what you see.</p>\n\n<p>Usually first requests are slower than subsequent ones as the AppEngine SDK performs file system scans, compiling and first-time loading and execution of package <code>init()</code> functions of your application's code.</p>\n\n<p>What you see is a 1-second <code>Waiting (TTFB)</code> time, it stands for Time To First Byte (<a href=\"https://developer.chrome.com/devtools/docs/network#resource-network-timing\" rel=\"nofollow\">source</a>):</p>\n\n<blockquote>\n  <p>Time spent waiting for the initial response, also known as the Time To First Byte. This time captures the latency of a round trip to the server in addition to the time spent waiting for the server to deliver the response.</p>\n</blockquote>\n\n<p>This 1 second TTFB most likely includes all the tasks I listed above the SDK has to perform, which isn't so bad if you think about that.</p>\n\n<p>Don't worry, production environment runs \"pre-compiled\" native binary code, none of these have to be performed and you will see most likely a response time (TTFB) around 20-30 ms. </p>\n"}], "owner": {"reputation": 277, "user_id": 1429798, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4b4ef66644c8053b172cc5a9c7e0daa6?s=128&d=identicon&r=PG", "display_name": "zelon", "link": "https://stackoverflow.com/users/1429798/zelon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 810, "favorite_count": 0, "accepted_answer_id": 33942814, "answer_count": 1, "score": 0, "last_activity_date": 1448553728, "creation_date": 1448553049, "question_id": 33942583, "link": "https://stackoverflow.com/questions/33942583/too-slow-ttfblatency-with-go-language-in-appengine", "title": "too slow TTFB(latency) with go language in appengine", "body": "<p><a href=\"https://i.stack.imgur.com/3cjzd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3cjzd.png\" alt=\"Check this ttfb\"></a></p>\n\n<p>I'm testing go lang in appengine. But it's too slow response. I've checked with chrome and found that the problem is 'Waiting(TTFB)'</p>\n\n<p>The source code is very simple and official example(<a href=\"https://github.com/GoogleCloudPlatform/appengine-try-go\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/appengine-try-go</a>).</p>\n\n<p>What's wrong? Is this normal?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1448546015, "post_id": 33940337, "comment_id": 55639856, "body": "Go has no covariant types. You need to stuff your items in jobList into a []interface{} first before passing the []interface{} to your function. BTW. Don&#39;t use interface{}."}, {"owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1448546058, "post_id": 33940337, "comment_id": 55639889, "body": "@Volker why not <code>interface{}</code> ?"}, {"owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1448546271, "post_id": 33940337, "comment_id": 55640018, "body": "@Volker and what is difference between my code and this <a href=\"http://bazaar.launchpad.net/+branch/mgo/v2/view/head:/session.go#L1823\" rel=\"nofollow noreferrer\">mgo insert method</a>"}, {"owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "edited": false, "score": 0, "creation_date": 1448547825, "post_id": 33940337, "comment_id": 55640981, "body": "Remove &quot;...&quot; 3 dots from &quot;this.setItemList(jobColl, jobList...)&quot;, it should be this.setItemList(jobColl, jobList), jobList is already an array"}, {"owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "reply_to_user": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "edited": false, "score": 0, "creation_date": 1448547937, "post_id": 33940337, "comment_id": 55641052, "body": "@PrashantThakkar that is not right, jobList will become just one parameter, such as <code>[3, 4, 5]</code>, if without <code>....</code>, it becomes <code>[[3, 4, 5]] </code>"}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1448552076, "post_id": 33940337, "comment_id": 55643670, "body": "I remember in the past someone had a similar problem with <code>fmt.Sscan</code>: <a href=\"http://stackoverflow.com/q/28604563/847869\">stackoverflow.com/q/28604563/847869</a>"}, {"owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "edited": false, "score": 0, "creation_date": 1448552763, "post_id": 33940337, "comment_id": 55644078, "body": "This is a quite common golang gotcha."}], "answers": [{"tags": [], "owner": {"reputation": 4579, "user_id": 1114274, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ebd3b90b30e78d29cc01c13ba6ebb090?s=128&d=identicon&r=PG", "display_name": "Mike Graf", "link": "https://stackoverflow.com/users/1114274/mike-graf"}, "is_accepted": false, "score": 1, "last_activity_date": 1456447534, "creation_date": 1456447534, "answer_id": 35641298, "question_id": 33940337, "link": "https://stackoverflow.com/questions/33940337/how-to-declare-a-function-accept-an-array-of-interface-in-golang/35641298#35641298", "title": "how to declare a function accept an array of interface in golang?", "body": "<p>I think what you're looking for <a href=\"http://play.golang.org/p/MjSUMFYs22\" rel=\"nofollow\">is this</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    interfacetious := []interface{}{\"s\", 123, float64(999)}\n    stuff(interfacetious)\n    stuff2(interfacetious...)\n\n    stuff2(\"or\", 123, \"separate\", float64(99), \"values\")\n}\n\n// Stuff can only work with slice of things\nfunc stuff(s []interface{}) {\n    fmt.Println(s)\n}\n\n// Stuff2 is polyvaridc and can handle individual vars, or a slice with ...\nfunc stuff2(s ...interface{}) {\n    fmt.Println(s)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1549, "user_id": 13631587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c4714de792628cb0aa0a4e39cf6eaa1?s=128&d=identicon&r=PG", "display_name": "Jon Nickles", "link": "https://stackoverflow.com/users/13631587/jon-nickles"}, "is_accepted": false, "score": 2, "last_activity_date": 1592329133, "last_edit_date": 1592329133, "creation_date": 1592328768, "answer_id": 62414355, "question_id": 33940337, "link": "https://stackoverflow.com/questions/33940337/how-to-declare-a-function-accept-an-array-of-interface-in-golang/62414355#62414355", "title": "how to declare a function accept an array of interface in golang?", "body": "<p>The question correctly declares the <code>setItemList</code> method, assuming that you want a variadic argument. Because the <code>setList</code> function works with any Mongo document type, it is appropriate to use <code>interface{}</code> in this scenario.</p>\n\n<p>A <code>[]*cv_type.CvJobItemRaw</code> cannot be converted to a <code>[]interface{}</code>.  Write a loop to create the <code>[]interface{}</code> from <code>jobList</code>.</p>\n\n<pre><code>jobList := cvRaw.GetJobList()\ns := make([]interface{}, len(t))\nfor i, v := range t {\n    s[i] = v\n}\nthis.setItemList(jobColl, s...)\n</code></pre>\n\n<p>See the <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">Go Language FAQ</a> for more details.</p>\n"}], "owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3818, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1592329133, "creation_date": 1448545653, "question_id": 33940337, "link": "https://stackoverflow.com/questions/33940337/how-to-declare-a-function-accept-an-array-of-interface-in-golang", "title": "how to declare a function accept an array of interface in golang?", "body": "<p>I want to declare a function accept array of interface, such as this:</p>\n\n<pre><code>func (this *CvStoreServiceImpl) setItemList(coll *mgo.Collection, itemList ...interface{}) (err error)\n</code></pre>\n\n<p>Howerver, when I call this function like as follow failed:</p>\n\n<pre><code>jobList := cvRaw.GetJobList()\nthis.setItemList(jobColl, jobList...)\n</code></pre>\n\n<p>here this the error:</p>\n\n<pre><code>cannot use cvRaw.GetJobList() (type []*cv_type.CvJobItemRaw) as type []interface {} in argument to this.setItemList\n</code></pre>\n"}, {"tags": ["go", "marshalling"], "comments": [{"owner": {"reputation": 8251, "user_id": 2912665, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XrRhd.jpg?s=128&g=1", "display_name": "CinCout", "link": "https://stackoverflow.com/users/2912665/cincout"}, "edited": false, "score": 3, "creation_date": 1448542701, "post_id": 33939274, "comment_id": 55637705, "body": "Post your code here."}], "answers": [{"tags": [], "owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "is_accepted": false, "score": 0, "last_activity_date": 1448542647, "creation_date": 1448542647, "answer_id": 33939346, "question_id": 33939274, "link": "https://stackoverflow.com/questions/33939274/unable-to-unmarshall-the-data-correctly-in-golang-from-a-map-to-a-structure/33939346#33939346", "title": "Unable to Unmarshall the data correctly in golang from a map to a structure", "body": "<p><code>json.Marshal</code> and <code>json.Unmarshal</code> can only work on exported struct fields. Your fields aren't exported and aren't visible to the json code.</p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 5608520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1eeb6a59d3d36e14536b5bb3077cfb1?s=128&d=identicon&r=PG&f=1", "display_name": "Anupam Dewan", "link": "https://stackoverflow.com/users/5608520/anupam-dewan"}, "edited": false, "score": 0, "creation_date": 1448603611, "post_id": 33939377, "comment_id": 55660420, "body": "Thanks for the help:)"}], "tags": [], "owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "is_accepted": false, "score": 0, "last_activity_date": 1448542751, "creation_date": 1448542751, "answer_id": 33939377, "question_id": 33939274, "link": "https://stackoverflow.com/questions/33939274/unable-to-unmarshall-the-data-correctly-in-golang-from-a-map-to-a-structure/33939377#33939377", "title": "Unable to Unmarshall the data correctly in golang from a map to a structure", "body": "<p>The reason for your unmarshal not working is that you need to expose fields of the struct and for doing that you need to start field name with Capital letters. Something has below:</p>\n\n<pre><code>type PDPOffer struct {\n        Cart_value            int    `json:\"cart_value\"`\n        Discount_amount_default int    `json:\"discount_amount_default\"`\n        Max_discount           string `json:\"max_discount\"`\n        }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 5608520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1eeb6a59d3d36e14536b5bb3077cfb1?s=128&d=identicon&r=PG&f=1", "display_name": "Anupam Dewan", "link": "https://stackoverflow.com/users/5608520/anupam-dewan"}, "edited": false, "score": 0, "creation_date": 1448603596, "post_id": 33941370, "comment_id": 55660413, "body": "Thanks for the help:)"}], "tags": [], "owner": {"reputation": 41, "user_id": 5154031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/955ya.jpg?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/5154031/matt"}, "is_accepted": false, "score": 0, "last_activity_date": 1448548980, "creation_date": 1448548980, "answer_id": 33941370, "question_id": 33939274, "link": "https://stackoverflow.com/questions/33939274/unable-to-unmarshall-the-data-correctly-in-golang-from-a-map-to-a-structure/33941370#33941370", "title": "Unable to Unmarshall the data correctly in golang from a map to a structure", "body": "<p>Also, you were trying to marshal an int value into a string for \"max_discount\", you need to store it as a string in your map that you're marshaling:</p>\n\n<pre><code>a := map[string]interface{}{\n    \"cart_value\":   1,\n    \"max_discount\": \"2\",\n}\n</code></pre>\n\n<p>The error handling had a bug checking for <code>err1 != nil</code> then printing <code>err</code> which was hiding the message <code>error: json: cannot unmarshal number into Go value of type string</code></p>\n\n<p>Working example with all the fixes: <a href=\"http://play.golang.org/p/L8VC-531nS\" rel=\"nofollow\">http://play.golang.org/p/L8VC-531nS</a></p>\n"}], "owner": {"reputation": 1, "user_id": 5608520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1eeb6a59d3d36e14536b5bb3077cfb1?s=128&d=identicon&r=PG&f=1", "display_name": "Anupam Dewan", "link": "https://stackoverflow.com/users/5608520/anupam-dewan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 3, "score": -2, "last_activity_date": 1448549162, "creation_date": 1448542432, "last_edit_date": 1448549162, "question_id": 33939274, "link": "https://stackoverflow.com/questions/33939274/unable-to-unmarshall-the-data-correctly-in-golang-from-a-map-to-a-structure", "title": "Unable to Unmarshall the data correctly in golang from a map to a structure", "body": "<p>I am currently unable to unmarshall the data correctly from a map into a structure. Following is a code snippet (<a href=\"http://play.golang.org/p/ShHLoThxNc\" rel=\"nofollow\">Brief Code at playground</a>):</p>\n\n<p>Request you to kindly provide the reason of getting default values on unmarshlling back the data.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n    \"os\"\n    )\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    type PDPOffer struct {\n        cart_value            int    `json:\"cart_value\"`\n        discount_amount_default int    `json:\"discount_amount_default\"`\n        max_discount           string `json:\"max_discount\"`\n        }\n\n        a:= map[string]interface{} {\n        \"cart_value\"              : 1,\n        \"max_discount\"            : 2,\n        }\n        var pdf PDPOffer\n        b, err := json.Marshal(a)\n        if err != nil {\n            fmt.Println(\"error:\", err)\n        }\n        os.Stdout.Write(b)//working\n        err1 := json.Unmarshal(b, &amp;pdf)\n        if err1 != nil {\n            fmt.Println(\"error:\", err)\n        }\n        fmt.Printf(\"%+v\", pdf)//displaying just the defualt values????????\n}\n</code></pre>\n"}, {"tags": ["regex", "string", "file", "replace", "go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1448540105, "post_id": 33937187, "comment_id": 55636110, "body": "Well, when your regexp becomes <code>&quot;&quot;(?m)[\\r\\n]+^.*$VP_Name.*$&quot;</code>, the regexp engine tries to find the end of the string (<code>$</code>) right before the text &quot;VP_Name&quot;, so what did you expect?"}, {"owner": {"reputation": 441, "user_id": 5252482, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/6la8h.jpg?s=128&g=1", "display_name": "Murali Manohar", "link": "https://stackoverflow.com/users/5252482/murali-manohar"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1448540270, "post_id": 33937187, "comment_id": 55636191, "body": "So how could i find a character $"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1448540814, "post_id": 33937187, "comment_id": 55636488, "body": "By escaping it with a backslash. You really should start with some introductory material on using regular expressions. <a href=\"http://play.golang.org/p/BArHfpBPiM\" rel=\"nofollow noreferrer\">here</a>&#39;s how I would do what you need. To expand on this solution a bit more: there&#39;s no need to explicitly mess wiwith line endings as you are slurping the whole file and process it in a single piece."}, {"owner": {"reputation": 441, "user_id": 5252482, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/6la8h.jpg?s=128&g=1", "display_name": "Murali Manohar", "link": "https://stackoverflow.com/users/5252482/murali-manohar"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1448541152, "post_id": 33937187, "comment_id": 55636707, "body": "Thank you so much now it works perfectly."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1448545036, "post_id": 33937187, "comment_id": 55639254, "body": "Glad it helped. But please don&#39;t just blindly copy my solution! You have to work out several things from it for yourself: 1) Escaping; 2) Capturing groups of characters with <code>(...)</code>; 3) Exclusion matchng (<code>[^&quot;]*</code> matches 0 or more of any characters except <code>&quot;</code>); 4) Using of captured groups in the substitution text (read the manual on <code>Regexp.ReplaceAllString()</code>)."}], "owner": {"reputation": 441, "user_id": 5252482, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/6la8h.jpg?s=128&g=1", "display_name": "Murali Manohar", "link": "https://stackoverflow.com/users/5252482/murali-manohar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 763, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1448537311, "creation_date": 1448536466, "last_edit_date": 1448537311, "question_id": 33937187, "link": "https://stackoverflow.com/questions/33937187/replacing-a-particular-line-in-a-inc-file-using-golang", "title": "Replacing a particular line in a .inc file using golang", "body": "<p>I have a file named aab.inc and i have a line <strong>$VP_Name=\"Some Messages\"</strong> I wrote a code in golang so that it reads the file aab.inc and Removes <strong>any line</strong> that has a <strong>word</strong> <strong>VP_Name</strong> and in my code i also included that That line(which contains the word <strong>VP_Name</strong>) is replaced with <strong>$VP_Name=\"Alternate Message\"</strong> but my problem is it never deletes the line if i give the word as <strong>$VP_Name</strong> and it replaces the line as <strong>=\"Alternate Message\"</strong> in the place if I give the replacing word as <strong>$VP_Name=\"Alternate Message\"</strong>  . But it deletes the line if give the word as <strong>VP_Name</strong> alone(Without $) and replaces the line as <strong>VP_Name=\"Alternate Message\"</strong> if the replacing text is given without the $ symbol. </p>\n\n<p>My code is as follows</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"regexp\"\nimport \"os\"\nimport \"io/ioutil\"\nfunc main() {\n\n    ConfigFile1, err := os.Open(\"aab.inc\")\n         if err != nil {\n                 fmt.Println(\"Error opening file:\", err)\n                 return\n         }\n        defer ConfigFile1.Close()\n\n    ConfigFiledata1, _ := ioutil.ReadAll(ConfigFile1)\n    //Try with $VP_Name\n    re := regexp.MustCompile(\"(?m)[\\r\\n]+^.*VP_Name.*$\")\n    // Actual Word is $VP_Name=\"Alternate Message\" \n    res := re.ReplaceAllString(string(ConfigFiledata1), \"\\nVP_Name=\\\"Alternate Message\\\"\")\n\n    fmt.Println(res)    \n\n    out := []byte(res)\n    if err := ioutil.WriteFile(\"aab_final.inc\",out, 0666); err != nil {\n            fmt.Println(err)\n            os.Exit(1)\n        }\n}\n</code></pre>\n\n<p>The new replaced line should come in the next line should not append with any other lines but even i use \\n before the replacing text the result is as below </p>\n\n<p>Output</p>\n\n<pre><code>$VP_Roll=\"\";VP_Name=\"Alternate Message\";\n$VP_Failure=\"Yes\";\n</code></pre>\n\n<p>What is the Problem in including the $ in the code and why the text is not replaced in a new line even \\n was specified.</p>\n\n<p>Thanks in Advance</p>\n"}, {"tags": ["multithreading", "go", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1448538043, "post_id": 33936193, "comment_id": 55634806, "body": "Why should this code &quot;run faster&quot;? Which parts do you expect to run in parallel on individual CPU cores? How much do you expect this parallelism to be? (Compared to the synchronised code parts and the snchronisation overhead?)"}, {"owner": {"reputation": 108, "user_id": 4358695, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000310460695/picture?type=large", "display_name": "Pallav Agarwal", "link": "https://stackoverflow.com/users/4358695/pallav-agarwal"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1448538628, "post_id": 33936193, "comment_id": 55635183, "body": "@Volker The program should run faster since in most cases, the proposals of men are being sent to different women, and those engagements are inherently independent of each other. If the go scheduler distributes the processes on separate threads, the only time they would be serialized would be when multiple men propose to the same women at the same time."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1448542459, "post_id": 33936193, "comment_id": 55637525, "body": "Cool. Now take a look at what actual computation is done in this &quot;inherently independent&quot; engagements <b>beside</b> channel sends/receives: Basically nothing. What is executing in parallel on different cores are a handful if <code>if</code>s and <code>for</code>s, a handful of integer assignments and arithmetic and memory access crossing cache lines (<code>human</code> is &#39;big&#39;, <code>man</code>and <code>woman</code> are big). To sum up: Your code consists of communications and synchronisation overhead with almost no CPU-local work (which I&#39;d guess to not be CPU-cache local in addition). No speed gained."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1448542805, "post_id": 33936193, "comment_id": 55637766, "body": "@PallavAgarwal: I can&#39;t reproduce your results. I had to interrupt the program to end it. <code>go version devel +21efa7b Wed Nov 25 23:31:47 2015 +0000 linux&#47;amd64</code>. <code>$ go build so.go &amp;&amp; time .&#47;so</code>. <code>GOMAXPROCS 8 NumCPU 4</code>. <code>^C</code>. <code>real 3m53.027s  user 0m0.003s  sys 0m0.003s</code>."}, {"owner": {"reputation": 108, "user_id": 4358695, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000310460695/picture?type=large", "display_name": "Pallav Agarwal", "link": "https://stackoverflow.com/users/4358695/pallav-agarwal"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1448554666, "post_id": 33936193, "comment_id": 55645256, "body": "@peterSO Please check the EDIT in the question"}], "answers": [{"comments": [{"owner": {"reputation": 108, "user_id": 4358695, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000310460695/picture?type=large", "display_name": "Pallav Agarwal", "link": "https://stackoverflow.com/users/4358695/pallav-agarwal"}, "edited": false, "score": 0, "creation_date": 1448555325, "post_id": 33943264, "comment_id": 55645651, "body": "Damn. Now I didn&#39;t expect that. I&#39;ll report back after checking with bigger files (and hopefully faster inputting method). Thanks for pointing out."}], "tags": [], "owner": {"reputation": 36, "user_id": 5608280, "user_type": "registered", "profile_image": "https://graph.facebook.com/1007828145903243/picture?type=large", "display_name": "Vinayak Tantia", "link": "https://stackoverflow.com/users/5608280/vinayak-tantia"}, "is_accepted": true, "score": 2, "last_activity_date": 1448555213, "creation_date": 1448555213, "answer_id": 33943264, "question_id": 33936193, "link": "https://stackoverflow.com/questions/33936193/golang-program-executing-on-single-thread-even-with-gomaxprocs4/33943264#33943264", "title": "GoLang program executing on single thread even with GOMAXPROCS(4)", "body": "<p>I think the input file you provided would take that much time to be read by the program(via scanf per line).</p>\n"}], "owner": {"reputation": 108, "user_id": 4358695, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000310460695/picture?type=large", "display_name": "Pallav Agarwal", "link": "https://stackoverflow.com/users/4358695/pallav-agarwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1145, "favorite_count": 0, "accepted_answer_id": 33943264, "answer_count": 1, "score": 2, "last_activity_date": 1448555213, "creation_date": 1448533695, "last_edit_date": 1448554692, "question_id": 33936193, "link": "https://stackoverflow.com/questions/33936193/golang-program-executing-on-single-thread-even-with-gomaxprocs4", "title": "GoLang program executing on single thread even with GOMAXPROCS(4)", "body": "<p>In the following GoLang program, I am trying to implement the <a href=\"https://en.wikipedia.org/wiki/Stable_marriage_problem\" rel=\"nofollow\">stable marriage problem</a> for N men and N women, using 2*N goroutines (1 for each man and woman).</p>\n\n<p>The program closely follows the program definition as each goroutine (read \"each man\") sends a message via channel to the desired woman goroutine who in turn rejects/accepts his proposal. I expected the program to easily be scheduled on multiple threads on setting <code>runtime.GOMAXPROCS(4)</code> however it still runs in (almost) the exact same time (and running linux command <code>time</code> still shows CPU usage at <code>100%</code> instead of expected <code>400%</code>)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"time\"\n)\n\nconst N = 500\n\ntype human struct {\n    pref    [N]int\n    phone   chan int\n    cur_eng int\n    cur_num int\n    id      int\n}\n\nvar men = [N]human{}\nvar women = [N]human{}\n\nfunc man(id int) {\n    guy := &amp;men[id]\n    for {\n        runtime.Gosched()\n        for j := guy.cur_num + 1; j &lt; N; j++ {\n            guy.cur_num = j\n            girl := &amp;women[guy.pref[guy.cur_num]]\n            girl.phone &lt;- guy.id\n            msg := &lt;-guy.phone\n            if msg == 1 {\n                guy.cur_eng = guy.pref[guy.cur_num]\n                break\n            }\n        }\n        select {\n        case &lt;-guy.phone:\n            guy.cur_eng = -1\n        }\n    }\n}\n\nfunc woman(id int, termi chan bool) {\n    girl := &amp;women[id]\n    for {\n\n        runtime.Gosched()\n        select {\n        case msg := &lt;-girl.phone:\n            if msg &gt;= 0 {\n                if girl.cur_eng == -1 {\n                    men[msg].phone &lt;- 1\n                    girl.cur_eng = msg\n                    termi &lt;- true\n                } else if girl.pref[girl.cur_eng] &lt; girl.pref[msg] {\n                    men[msg].phone &lt;- 0\n                } else {\n                    men[msg].phone &lt;- 1\n                    men[girl.cur_eng].phone &lt;- -10\n                    girl.cur_eng = msg\n                }\n            }\n        }\n    }\n}\n\nfunc main() {\n    runtime.GOMAXPROCS(8)\n    for i := 0; i &lt; N; i++ {\n        men[i] = human{pref: [N]int{}, phone: make(chan int), cur_eng: -1, cur_num: -1, id: i}\n        for j := 0; j &lt; N; j++ {\n            fmt.Scanf(\"%d\\n\", &amp;(men[i].pref[j]))\n        }\n    }\n    for i := 0; i &lt; N; i++ {\n        women[i] = human{pref: [N]int{}, phone: make(chan int), cur_eng: -1, cur_num: -1, id: i}\n        for j := 0; j &lt; N; j++ {\n            t := 0\n            fmt.Scanf(\"%d\\n\", &amp;t)\n            women[i].pref[t] = j\n        }\n    }\n    termi := make(chan bool)\n    for i := 0; i &lt; N; i++ {\n        go man(i)\n        go woman(i, termi)\n    }\n    for i := 0; i &lt; N; i++ {\n        &lt;-termi\n    }\n    time.Sleep(100 * time.Millisecond)\n    for i := 0; i &lt; N; i++ {\n        fmt.Printf(\"%d %d\\n\", i, men[i].cur_eng)\n    }\n}\n</code></pre>\n\n<p><strong>EDIT</strong>: The serial implementation of the program I made is <a href=\"http://pastebin.com/PgPAUTAi\" rel=\"nofollow\">here</a>. The time comparison shows both running in almost identical time (1.27s for serial, 1.30s for above one).</p>\n\n<p>Also, the algorithm followed for the parallel implementation was made according to <a href=\"http://www.oocities.org/vijayiyer01/docs/parallel_doc2.doc\" rel=\"nofollow\">this</a> as well as I could understand (I used goroutines as I didn't know how to use MPI).\nPlease feel free to suggest an alternative implementation (parallel) if possible.</p>\n\n<p>The program above needs the following as input file : <a href=\"https://drive.google.com/file/d/0B6jsnt965ZwrWlV1OE9LLVA1LUk/view?usp=sharing\" rel=\"nofollow\">https://drive.google.com/file/d/0B6jsnt965ZwrWlV1OE9LLVA1LUk/view?usp=sharing</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 2, "creation_date": 1564086803, "post_id": 33937116, "comment_id": 100925926, "body": "thanks james for sharing! I guess this should be the accepted answer as provides a more detailed answer of the internals of interfaces and struct&#39;s pointer receiver methods."}, {"owner": {"reputation": 3343, "user_id": 2790983, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/TCp89.jpg?s=128&g=1", "display_name": "Uday Hiwarale", "link": "https://stackoverflow.com/users/2790983/uday-hiwarale"}, "edited": false, "score": 0, "creation_date": 1579890500, "post_id": 33937116, "comment_id": 105930949, "body": "&quot;If we directly stored a struct in the interface variable, we&#39;d need to create a pointer to that struct to complete the method call.&quot; - Not true actually. Here is an example:  <a href=\"https://play.golang.org/p/v3Rl3l0MKZ7\" rel=\"nofollow noreferrer\">play.golang.org/p/v3Rl3l0MKZ7</a>"}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "reply_to_user": {"reputation": 3343, "user_id": 2790983, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/TCp89.jpg?s=128&g=1", "display_name": "Uday Hiwarale", "link": "https://stackoverflow.com/users/2790983/uday-hiwarale"}, "edited": false, "score": 0, "creation_date": 1581477382, "post_id": 33937116, "comment_id": 106443523, "body": "@UdayHiwarale: your example includes no interface variables.  See this error: <a href=\"https://play.golang.org/p/0ABWJlxC_oQ\" rel=\"nofollow noreferrer\">play.golang.org/p/0ABWJlxC_oQ</a>"}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": false, "score": 32, "last_activity_date": 1448536269, "creation_date": 1448536269, "answer_id": 33937116, "question_id": 33936081, "link": "https://stackoverflow.com/questions/33936081/golang-method-with-pointer-receiver/33937116#33937116", "title": "Golang method with pointer receiver", "body": "<p>The simple answer is that you won't be able to have the struct implement your interface while having <code>SetSomeField</code> work the way you want.</p>\n\n<p>However, a pointer to the struct will implement the interface, so changing your <code>Create</code> method to do <code>return &amp;obj</code> should get things working.</p>\n\n<p>The underlying problem is that your modified <code>SetSomeField</code> method is no longer in the method set of <code>Implementation</code>.  While the type <code>*Implementation</code> will inherit the non-pointer receiver methods, the reverse is not true.</p>\n\n<p>The reason for this is related to the way interface variables are specified: the only way to access the dynamic value stored in an interface variable is to copy it.  As an example, imagine the following:</p>\n\n<pre><code>var impl Implementation\nvar iface IFace = &amp;impl\n</code></pre>\n\n<p>In this case, a call to <code>iface.SetSomeField</code> works because it can copy the pointer to use as the receiver in the method call.  If we directly stored a struct in the interface variable, we'd need to create a pointer to that struct to complete the method call.  Once such a pointer is made, it is possible to access (and potentially modify) the interface variable's dynamic value without copying it.</p>\n"}, {"tags": [], "owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "is_accepted": true, "score": 70, "last_activity_date": 1448536581, "creation_date": 1448536581, "answer_id": 33937234, "question_id": 33936081, "link": "https://stackoverflow.com/questions/33936081/golang-method-with-pointer-receiver/33937234#33937234", "title": "Golang method with pointer receiver", "body": "<p>Your pointer to the struct should implement the Interface. In that way you can modify its fields.</p>\n\n<p>Look at how I modified your code, to make it working as you expect: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype IFace interface {\n    SetSomeField(newValue string)\n    GetSomeField() string\n}\n\ntype Implementation struct {\n    someField string\n}    \n\nfunc (i *Implementation) GetSomeField() string {\n    return i.someField\n}\n\nfunc (i *Implementation) SetSomeField(newValue string) {\n    i.someField = newValue\n}\n\nfunc Create() *Implementation {\n    return &amp;Implementation{someField: \"Hello\"}\n}\n\nfunc main() {\n    var a IFace\n    a = Create()\n    a.SetSomeField(\"World\")\n    fmt.Println(a.GetSomeField())\n}\n</code></pre>\n"}], "owner": {"reputation": 9113, "user_id": 146003, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/272ed3d9a5c9813ed1fad7ab8f512576?s=128&d=identicon&r=PG", "display_name": "Atmocreations", "link": "https://stackoverflow.com/users/146003/atmocreations"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48016, "favorite_count": 18, "closed_date": 1570832499, "accepted_answer_id": 33937234, "answer_count": 2, "score": 51, "last_activity_date": 1448536581, "creation_date": 1448533382, "last_edit_date": 1495542373, "question_id": 33936081, "link": "https://stackoverflow.com/questions/33936081/golang-method-with-pointer-receiver", "closed_reason": "Duplicate", "title": "Golang method with pointer receiver", "body": "<p>I have this example code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype IFace interface {\n    SetSomeField(newValue string)\n    GetSomeField() string\n}\n\ntype Implementation struct {\n    someField string\n}\n\nfunc (i Implementation) GetSomeField() string {\n    return i.someField\n}\n\nfunc (i Implementation) SetSomeField(newValue string) {\n    i.someField = newValue\n}\n\nfunc Create() IFace {\n    obj := Implementation{someField: \"Hello\"}\n    return obj // &lt;= Offending line\n}\n\nfunc main() {\n    a := Create()\n    a.SetSomeField(\"World\")\n    fmt.Println(a.GetSomeField())\n}\n</code></pre>\n\n<p><code>SetSomeField</code> does not work as expected because its receiver is not of pointer type.</p>\n\n<p>If I change the method to a pointer receiver, what I would expect to work, it looks like this:</p>\n\n<pre><code>func (i *Implementation) SetSomeField(newValue string) { ...\n</code></pre>\n\n<p>Compiling this leads to the following error:</p>\n\n<pre><code>prog.go:26: cannot use obj (type Implementation) as type IFace in return argument:\nImplementation does not implement IFace (GetSomeField method has pointer receiver)\n</code></pre>\n\n<p>How can I have the <code>struct</code> implement the interface <strong>and</strong> the method <code>SetSomeField</code> change the value of the actual instance without creating a copy?</p>\n\n<p>Here's a hackable snippet:\n<a href=\"https://play.golang.org/p/ghW0mk0IuU\" rel=\"noreferrer\">https://play.golang.org/p/ghW0mk0IuU</a></p>\n\n<p>I've already seen this question <a href=\"https://stackoverflow.com/questions/29221854/in-go-golang-how-can-you-cast-an-interface-pointer-into-a-struct-pointer\">In go (golang), how can you cast an interface pointer into a struct pointer?</a>, but I cannot see how it is related to this example.</p>\n"}, {"tags": ["c++", "multithreading", "bash", "c++11", "go"], "comments": [{"owner": {"reputation": 519, "user_id": 5534341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b3bjF.jpg?s=128&g=1", "display_name": "Jerome", "link": "https://stackoverflow.com/users/5534341/jerome"}, "edited": false, "score": 0, "creation_date": 1448530181, "post_id": 33934841, "comment_id": 55629723, "body": "Look here : <a href=\"http://stackoverflow.com/questions/16964563/why-is-multithreaded-slower\" title=\"why is multithreaded slower\">stackoverflow.com/questions/16964563/&hellip;</a>"}, {"owner": {"reputation": 388, "user_id": 2587102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb73c5c317537efcdbeb19cacb0222ed?s=128&d=identicon&r=PG", "display_name": "Melkon", "link": "https://stackoverflow.com/users/2587102/melkon"}, "edited": false, "score": 1, "creation_date": 1448530332, "post_id": 33934841, "comment_id": 55629851, "body": "Depends on your code. Just because you use multiple thread it doesn&#39;t mean you will get faster code. Actually bad multithreaded code can easily be slower than the single threaded version. This is a hard territory. :)"}, {"owner": {"reputation": 426, "user_id": 5571277, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IrSIrAF1xYo/AAAAAAAAAAI/AAAAAAAAAEY/YpqfdVW5VZ4/photo.jpg?sz=128", "display_name": "Mistermatt", "link": "https://stackoverflow.com/users/5571277/mistermatt"}, "reply_to_user": {"reputation": 519, "user_id": 5534341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b3bjF.jpg?s=128&g=1", "display_name": "Jerome", "link": "https://stackoverflow.com/users/5534341/jerome"}, "edited": false, "score": 0, "creation_date": 1448530377, "post_id": 33934841, "comment_id": 55629881, "body": "@Jerome I already removed all the print-things to get faster"}, {"owner": {"reputation": 426, "user_id": 5571277, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IrSIrAF1xYo/AAAAAAAAAAI/AAAAAAAAAEY/YpqfdVW5VZ4/photo.jpg?sz=128", "display_name": "Mistermatt", "link": "https://stackoverflow.com/users/5571277/mistermatt"}, "reply_to_user": {"reputation": 388, "user_id": 2587102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb73c5c317537efcdbeb19cacb0222ed?s=128&d=identicon&r=PG", "display_name": "Melkon", "link": "https://stackoverflow.com/users/2587102/melkon"}, "edited": false, "score": 0, "creation_date": 1448530444, "post_id": 33934841, "comment_id": 55629924, "body": "@Melkon the code is dividing the range given in command-line args to all the threads, only some addition and multiplications are threaded (:"}, {"owner": {"reputation": 388, "user_id": 2587102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb73c5c317537efcdbeb19cacb0222ed?s=128&d=identicon&r=PG", "display_name": "Melkon", "link": "https://stackoverflow.com/users/2587102/melkon"}, "edited": false, "score": 0, "creation_date": 1448530652, "post_id": 33934841, "comment_id": 55630064, "body": "@Mistermatt: But it&#39;s matter alot how much times threads have to wait for each other, how much times CPU caches invalidating etc. These overheads can become huge. Also C++11 have a different memory model to support multithreading, so if you use an old compiler you can have serious issues because of it also. If you can show your code i suggest you to do it, so someone may can help you. :) (I don&#39;t know much about GO and i also doesn&#39;t have wide knowledge about multithreading.)"}, {"owner": {"reputation": 519, "user_id": 5534341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b3bjF.jpg?s=128&g=1", "display_name": "Jerome", "link": "https://stackoverflow.com/users/5534341/jerome"}, "edited": false, "score": 0, "creation_date": 1448530700, "post_id": 33934841, "comment_id": 55630106, "body": "@Mistermatt create thread take time too, same for wakeup a core."}, {"owner": {"reputation": 426, "user_id": 5571277, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IrSIrAF1xYo/AAAAAAAAAAI/AAAAAAAAAEY/YpqfdVW5VZ4/photo.jpg?sz=128", "display_name": "Mistermatt", "link": "https://stackoverflow.com/users/5571277/mistermatt"}, "reply_to_user": {"reputation": 388, "user_id": 2587102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb73c5c317537efcdbeb19cacb0222ed?s=128&d=identicon&r=PG", "display_name": "Melkon", "link": "https://stackoverflow.com/users/2587102/melkon"}, "edited": false, "score": 0, "creation_date": 1448530933, "post_id": 33934841, "comment_id": 55630255, "body": "@Melkon I&#39;m using the latest version of g++ to compile, with -std=c++0x -pthread flags"}, {"owner": {"reputation": 388, "user_id": 2587102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb73c5c317537efcdbeb19cacb0222ed?s=128&d=identicon&r=PG", "display_name": "Melkon", "link": "https://stackoverflow.com/users/2587102/melkon"}, "edited": false, "score": 0, "creation_date": 1448531170, "post_id": 33934841, "comment_id": 55630409, "body": "@Mistermatt Ok, so you doesn&#39;t suffer because of the old memory model, but there still can be alot of problem. Writing good multithreaded code is really hard, i don&#39;t know if you can achieve correct measurement between the languages without wider knowledge. :/ Without the actual code it&#39;s hard to help you."}, {"owner": {"reputation": 426, "user_id": 5571277, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IrSIrAF1xYo/AAAAAAAAAAI/AAAAAAAAAEY/YpqfdVW5VZ4/photo.jpg?sz=128", "display_name": "Mistermatt", "link": "https://stackoverflow.com/users/5571277/mistermatt"}, "reply_to_user": {"reputation": 388, "user_id": 2587102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb73c5c317537efcdbeb19cacb0222ed?s=128&d=identicon&r=PG", "display_name": "Melkon", "link": "https://stackoverflow.com/users/2587102/melkon"}, "edited": false, "score": 0, "creation_date": 1448531478, "post_id": 33934841, "comment_id": 55630627, "body": "@Melkon Links was already included but my bad, it was not well formatted"}, {"owner": {"reputation": 388, "user_id": 2587102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb73c5c317537efcdbeb19cacb0222ed?s=128&d=identicon&r=PG", "display_name": "Melkon", "link": "https://stackoverflow.com/users/2587102/melkon"}, "edited": false, "score": 0, "creation_date": 1448531801, "post_id": 33934841, "comment_id": 55630860, "body": "@Mistermatt, sry, didn&#39;t notice it. At first sight the C++ code is fine, did el.pescado&#39;s answer was the problem?"}, {"owner": {"reputation": 426, "user_id": 5571277, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IrSIrAF1xYo/AAAAAAAAAAI/AAAAAAAAAEY/YpqfdVW5VZ4/photo.jpg?sz=128", "display_name": "Mistermatt", "link": "https://stackoverflow.com/users/5571277/mistermatt"}, "edited": false, "score": 1, "creation_date": 1448532001, "post_id": 33934841, "comment_id": 55630980, "body": "The server is actually running the script with higher number of rectangles but it seems it was the time format !"}], "answers": [{"comments": [{"owner": {"reputation": 426, "user_id": 5571277, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IrSIrAF1xYo/AAAAAAAAAAI/AAAAAAAAAEY/YpqfdVW5VZ4/photo.jpg?sz=128", "display_name": "Mistermatt", "link": "https://stackoverflow.com/users/5571277/mistermatt"}, "edited": false, "score": 0, "creation_date": 1448534238, "post_id": 33935298, "comment_id": 55632391, "body": "I had divided the output provided by the %U by the number of cores used and now with the %e it gives me larger times than before"}], "tags": [], "owner": {"reputation": 17713, "user_id": 226648, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/3196df423fd95dc4fce7dfadb8ec9953?s=128&d=identicon&r=PG", "display_name": "el.pescado", "link": "https://stackoverflow.com/users/226648/el-pescado"}, "is_accepted": true, "score": 9, "last_activity_date": 1448531285, "creation_date": 1448531285, "answer_id": 33935298, "question_id": 33934841, "link": "https://stackoverflow.com/questions/33934841/why-my-programs-is-taking-longer-to-execute-with-more-threads-allocated/33935298#33935298", "title": "Why my programs is taking longer to execute with more threads allocated?", "body": "<p>According to <code>man time</code>:</p>\n\n<blockquote>\n  <p>U      Total number of CPU-seconds that the process used directly (in user mode), in seconds.</p>\n</blockquote>\n\n<p>You are measuring CPU-seconds, i.e. time spent by each CPU cumulatively, not \"wallclock\" seconds. This measure won't go down with additional threads, because it is proportional to amount of work which is constant. On the other hand, this may go up with number of threads, as every new thread incurs some additional bookkeeping.</p>\n\n<p>If you want to list \"real\" time, use <code>%e</code> specifier.</p>\n"}], "owner": {"reputation": 426, "user_id": 5571277, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IrSIrAF1xYo/AAAAAAAAAAI/AAAAAAAAAEY/YpqfdVW5VZ4/photo.jpg?sz=128", "display_name": "Mistermatt", "link": "https://stackoverflow.com/users/5571277/mistermatt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 33935298, "answer_count": 1, "score": 0, "last_activity_date": 1448540474, "creation_date": 1448530073, "last_edit_date": 1448540474, "question_id": 33934841, "link": "https://stackoverflow.com/questions/33934841/why-my-programs-is-taking-longer-to-execute-with-more-threads-allocated", "title": "Why my programs is taking longer to execute with more threads allocated?", "body": "<p>I wrote two programs that computes area of a function with a certain number of rectangles using Riemann sums, one is written in Go and the other with C++.</p>\n\n<p>The objective was to measure execution time and see which language is the faster on multithreading.</p>\n\n<p>I ran the program on a 32-cores server (Dual Intel Xeon) using a bash script4 to run it with 1, 2, 4, 8, 16 and 32 threads. The script use <code>time --format %U</code> to get the execution time .</p>\n\n<p>But as you can see in the results running the Go version using 1 core is 1.19 seconds and with 32 cores it's 1.69 seconds ! I thought using more cores would have made computations faster...</p>\n\n<p>Did I made an error writing my programs ? Is the measure of time accurate ? Or maybe the results are good but how ?</p>\n\n<p>Thank you in advance for your answers !</p>\n\n<p>Sources :</p>\n\n<p>Go code  : <a href=\"https://github.com/Mistermatt007/Benchmark-go-vs-cpp/blob/master/CalculGo/Calcul.go\" rel=\"nofollow\">https://github.com/Mistermatt007/Benchmark-go-vs-cpp/blob/master/CalculGo/Calcul.go</a></p>\n\n<p>C++ code : <a href=\"https://github.com/Mistermatt007/Benchmark-go-vs-cpp/blob/master/CalculCpp/Calcul.cpp\" rel=\"nofollow\">https://github.com/Mistermatt007/Benchmark-go-vs-cpp/blob/master/CalculCpp/Calcul.cpp</a></p>\n\n<p>launch script : <a href=\"https://github.com/Mistermatt007/Benchmark-go-vs-cpp/blob/master/script/Launch.sh\" rel=\"nofollow\">https://github.com/Mistermatt007/Benchmark-go-vs-cpp/blob/master/script/Launch.sh</a></p>\n\n<p>Riemann sums  : <a href=\"http://mathworld.wolfram.com/RiemannSum.html\" rel=\"nofollow\">http://mathworld.wolfram.com/RiemannSum.html</a></p>\n\n<p>first results : <a href=\"https://github.com/Mistermatt007/Benchmark-go-vs-cpp/blob/master/results/GoVSCpp.txt\" rel=\"nofollow\">https://github.com/Mistermatt007/Benchmark-go-vs-cpp/blob/master/results/GoVSCpp.txt</a></p>\n"}, {"tags": ["linux", "go", "cron", "crontab"], "answers": [{"comments": [{"owner": {"reputation": 1737, "user_id": 4148743, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/WTsH1.png?s=128&g=1", "display_name": "Anders Andersen", "link": "https://stackoverflow.com/users/4148743/anders-andersen"}, "edited": false, "score": 0, "creation_date": 1448532059, "post_id": 33934906, "comment_id": 55631035, "body": "The log level 2 tells me it cant find the file. I have checked like ten times now. The path is correct."}, {"owner": {"reputation": 1737, "user_id": 4148743, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/WTsH1.png?s=128&g=1", "display_name": "Anders Andersen", "link": "https://stackoverflow.com/users/4148743/anders-andersen"}, "edited": false, "score": 0, "creation_date": 1448539088, "post_id": 33934906, "comment_id": 55635468, "body": "I had a error in my program. Its was looking in the wrong directory. The debugging via the log line you provided help finding this problem."}], "tags": [], "owner": {"reputation": 113, "user_id": 5580883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dLO6a.jpg?s=128&g=1", "display_name": "andrew", "link": "https://stackoverflow.com/users/5580883/andrew"}, "is_accepted": false, "score": 2, "last_activity_date": 1448530258, "creation_date": 1448530258, "answer_id": 33934906, "question_id": 33934764, "link": "https://stackoverflow.com/questions/33934764/crontab-wont-run-go-golang-program/33934906#33934906", "title": "Crontab won&#39;t run go / golang program", "body": "<p>Maybe something wrong, and the program print some log, but the log will be redirected to the /dev/null, and you can't check the error log.\nyou can add this to print the log to some log file.</p>\n\n<pre><code>*/5 * * * * /backup/main 1&gt;&gt; /path/to/log/file 2&gt;&gt;/path/to/error_log/file\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1737, "user_id": 4148743, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/WTsH1.png?s=128&g=1", "display_name": "Anders Andersen", "link": "https://stackoverflow.com/users/4148743/anders-andersen"}, "edited": false, "score": 0, "creation_date": 1448532148, "post_id": 33934955, "comment_id": 55631090, "body": "The env just tells me the following &quot;no such file or directory&quot;. So it seems environment can&#39;t find the folder/file. Any idea to fix this?"}, {"owner": {"reputation": 339, "user_id": 5606904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f291f1187419a1923db0c97f4c404899?s=128&d=identicon&r=PG&f=1", "display_name": "obscurite", "link": "https://stackoverflow.com/users/5606904/obscurite"}, "reply_to_user": {"reputation": 1737, "user_id": 4148743, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/WTsH1.png?s=128&g=1", "display_name": "Anders Andersen", "link": "https://stackoverflow.com/users/4148743/anders-andersen"}, "edited": false, "score": 0, "creation_date": 1448532826, "post_id": 33934955, "comment_id": 55631525, "body": "Huh. Which file are you trying to run? Paste the full path as well as an ls -l on the file."}], "tags": [], "owner": {"reputation": 339, "user_id": 5606904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f291f1187419a1923db0c97f4c404899?s=128&d=identicon&r=PG&f=1", "display_name": "obscurite", "link": "https://stackoverflow.com/users/5606904/obscurite"}, "is_accepted": false, "score": 3, "last_activity_date": 1448530400, "creation_date": 1448530400, "answer_id": 33934955, "question_id": 33934764, "link": "https://stackoverflow.com/questions/33934764/crontab-wont-run-go-golang-program/33934955#33934955", "title": "Crontab won&#39;t run go / golang program", "body": "<p>The conventional wisdom about cron silent failures is that it's probably the environment. By wrapping your golang program in a shell script, you can control the environment (and get your profiles to run). You can also put in useful debug bits like \"env\". </p>\n\n<p>To simulate cron with it's empty env run:</p>\n\n<pre><code>env -i ./myscript.sh\n</code></pre>\n\n<p>where myscript.sh is chmod +x and just runs \"env\". Then put your golang command in there and see if it still works without the environment. Then when you've proved it's the environment (hopefully), use a shell script in cron.</p>\n"}, {"comments": [{"owner": {"reputation": 106, "user_id": 4710662, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206249203887928/picture?type=large", "display_name": "\u0414\u0435\u043d\u0438\u0441 \u0421\u043c\u0430\u043b\u044c", "link": "https://stackoverflow.com/users/4710662/%d0%94%d0%b5%d0%bd%d0%b8%d1%81-%d0%a1%d0%bc%d0%b0%d0%bb%d1%8c"}, "edited": false, "score": 0, "creation_date": 1518508758, "post_id": 43412512, "comment_id": 84524202, "body": "Thanks, Garvit! In my case it was enough to add GOPATH=/path/to/my/project/"}], "tags": [], "owner": {"reputation": 1222, "user_id": 5806017, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/TXRib.jpg?s=128&g=1", "display_name": "Garvit Jain", "link": "https://stackoverflow.com/users/5806017/garvit-jain"}, "is_accepted": false, "score": 4, "last_activity_date": 1492176375, "creation_date": 1492176375, "answer_id": 43412512, "question_id": 33934764, "link": "https://stackoverflow.com/questions/33934764/crontab-wont-run-go-golang-program/43412512#43412512", "title": "Crontab won&#39;t run go / golang program", "body": "<p>Hoping to help others who couldn't find the solution as me:</p>\n\n<p>The issue can be resolved by adding path and gopath variables to the <code>crontab -e</code> file.</p>\n\n<p>you can find them by running <code>echo $PATH</code> <code>echo $GOPATH</code></p>\n\n<pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/usr/local/go/bin:/root/bin\nGOPATH=/var/projects/src\n\n# +---------------- minute (0 - 59)\n# |  +------------- hour (0 - 23)\n# |  |  +---------- day of month (1 - 31)\n# |  |  |  +------- month (1 - 12)\n# |  |  |  |  +---- day of week (0 - 6) (Sunday=0)\n# |  |  |  |  |\n  */5 * * * * /backup/main\n</code></pre>\n\n<p>Your code may not be running due error that go was not able to find packages</p>\n\n<p>i.e. the third packages that you installed by running <code>go get</code> example</p>\n\n<pre><code>go get gopkg.in/gomail.v2\n</code></pre>\n\n<p>The problem is that you may have <code>go get</code> from your working directory!\nIn my case which is <code>GOPATH=/var/projects/src</code></p>\n\n<p>you can see the package inside </p>\n\n<p><code>/your/working_directory/src/pkg/linux_amd64</code></p>\n"}, {"tags": [], "owner": {"reputation": 117, "user_id": 1491233, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/XFWKq.jpg?s=128&g=1", "display_name": "Morn&#233; Kruger", "link": "https://stackoverflow.com/users/1491233/morn%c3%a9-kruger"}, "is_accepted": false, "score": 0, "last_activity_date": 1604006674, "creation_date": 1604006674, "answer_id": 64599418, "question_id": 33934764, "link": "https://stackoverflow.com/questions/33934764/crontab-wont-run-go-golang-program/64599418#64599418", "title": "Crontab won&#39;t run go / golang program", "body": "<p>I stumbled onto this post as this was exactly the problem that I encountered.\ncrontab not running my compiled golang binary.\nFor me, the problem was the incorrect configuration of the crontab line.\nI followed the following format in the configuration and that did the trick for me:</p>\n<pre><code>* * * * * cd folder_containing_exe &amp;&amp; ./exe_name\n</code></pre>\n<p><em>note!</em> This runs the binary every minute<br />\nsource: <a href=\"https://stackoverflow.com/questions/3474280/how-to-set-up-a-cron-job-to-run-an-executable-every-hour\">How to set up a cron job to run an executable every hour?</a><br />\nHope this can perhaps help someone with a similar issue.</p>\n"}], "owner": {"reputation": 1737, "user_id": 4148743, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/WTsH1.png?s=128&g=1", "display_name": "Anders Andersen", "link": "https://stackoverflow.com/users/4148743/anders-andersen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3229, "favorite_count": 0, "answer_count": 4, "score": 3, "last_activity_date": 1604006674, "creation_date": 1448529882, "last_edit_date": 1492199784, "question_id": 33934764, "link": "https://stackoverflow.com/questions/33934764/crontab-wont-run-go-golang-program", "title": "Crontab won&#39;t run go / golang program", "body": "<p>I have setup crontab to run a compiled golang script. The script is responsable for copying a folder to a ftp. Nothing special in this. </p>\n\n<p>I can run the program in the commandline by just typing \"/backup/main\" And it all works. </p>\n\n<p>Now I want to run this program every night. I have setup the cronjob to run every 5 minutes to test if it works. And it dont! </p>\n\n<p>If I check the syslog I can see the program is beeing called, but nothing happens. </p>\n\n<p>The file \"/backup/main\" is chmod a+x\nThe crontab is set in \"sudo\" (sudo crontab -e). So alle permissions should be ok. </p>\n\n<p>The line in crontab:</p>\n\n<p>*/5 * * * * /backup/main</p>\n\n<p>Hops someone can help.</p>\n"}, {"tags": ["json", "nginx", "go", "hex", "decoding"], "answers": [{"comments": [{"owner": {"reputation": 2090, "user_id": 1661304, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/9b28a71116ef84b382a419e36528afd7?s=128&d=identicon&r=PG", "display_name": "Asaf", "link": "https://stackoverflow.com/users/1661304/asaf"}, "edited": false, "score": 0, "creation_date": 1448528047, "post_id": 33933971, "comment_id": 55628301, "body": "Thanks! It does give me a solution for the case I described my question, but it does not solve the case when the string is a mix of valid and non-valid JSON. See my updated question. Thanks again! BTW, this happens because the nginx encode only the request body params."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 2090, "user_id": 1661304, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/9b28a71116ef84b382a419e36528afd7?s=128&d=identicon&r=PG", "display_name": "Asaf", "link": "https://stackoverflow.com/users/1661304/asaf"}, "edited": false, "score": 0, "creation_date": 1448532800, "post_id": 33933971, "comment_id": 55631513, "body": "@Asaf: Why shouldn&#39;t Not_a_Golfer&#39;s code fail on the &quot;mix of valid and non-valid JSON&quot;?"}, {"owner": {"reputation": 2090, "user_id": 1661304, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/9b28a71116ef84b382a419e36528afd7?s=128&d=identicon&r=PG", "display_name": "Asaf", "link": "https://stackoverflow.com/users/1661304/asaf"}, "edited": false, "score": 0, "creation_date": 1448533483, "post_id": 33933971, "comment_id": 55631923, "body": "If I run @Not_a_Golfer &#39;s code, I get the error &quot;invalid syntax&quot; on this line <code>s, err := strconv.Unquote(fmt.Sprintf(&quot;%s&quot;, qs))</code>"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 2090, "user_id": 1661304, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/9b28a71116ef84b382a419e36528afd7?s=128&d=identicon&r=PG", "display_name": "Asaf", "link": "https://stackoverflow.com/users/1661304/asaf"}, "edited": false, "score": 0, "creation_date": 1448533593, "post_id": 33933971, "comment_id": 55631979, "body": "@Asaf are you sure you&#39;re using the backticks properly? stack overflow might treat them badly"}, {"owner": {"reputation": 2090, "user_id": 1661304, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/9b28a71116ef84b382a419e36528afd7?s=128&d=identicon&r=PG", "display_name": "Asaf", "link": "https://stackoverflow.com/users/1661304/asaf"}, "edited": false, "score": 0, "creation_date": 1448533777, "post_id": 33933971, "comment_id": 55632102, "body": "@Not_a_Golfer Well, I think so.. :\\ If you can confirm that my new example (updated in my question) is working with your code, I&#39;ll try looking again the wrong backticks."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 2090, "user_id": 1661304, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/9b28a71116ef84b382a419e36528afd7?s=128&d=identicon&r=PG", "display_name": "Asaf", "link": "https://stackoverflow.com/users/1661304/asaf"}, "edited": false, "score": 0, "creation_date": 1448558865, "post_id": 33933971, "comment_id": 55647551, "body": "@asaf not it&#39;s not... I&#39;d try to just fix the data, but you can cteate your own unquote function"}, {"owner": {"reputation": 2090, "user_id": 1661304, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/9b28a71116ef84b382a419e36528afd7?s=128&d=identicon&r=PG", "display_name": "Asaf", "link": "https://stackoverflow.com/users/1661304/asaf"}, "edited": false, "score": 0, "creation_date": 1448652653, "post_id": 33933971, "comment_id": 55684838, "body": "So I took @Not_a_Golfer advise, and added the line: <code>qs = strings.Replace(qs, &quot;\\&quot;&quot;, &quot;\\\\x22&quot;, -1)</code> in order to make his solution complete for my needs."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 5, "last_activity_date": 1448529054, "last_edit_date": 1448529054, "creation_date": 1448527359, "answer_id": 33933971, "question_id": 33933577, "link": "https://stackoverflow.com/questions/33933577/go-how-to-decode-convert-a-txt-file-contains-hex-chars-into-readable-string/33933971#33933971", "title": "Go - How to decode/convert a txt file contains hex chars into readable string", "body": "<p>You can use <code>strconv.Unquote</code> to convert the string to a normal one:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n\n    // this is what your input string looks like...\n    qs := \"{\\\\x22device_id\\\\x22: \\\\x221234567890\\\\x22}\"\n\n    // now let's convert it to a normal string\n    // note that it has to look like a Go string literal so we're\n    // using Sprintf\n    s, err := strconv.Unquote(fmt.Sprintf(`\"%s\"`, qs))\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(s)\n\n    // just for good measure, let's see if it can actually be decoded.\n    // SPOILER ALERT: It decodes just fine!\n    var v map[string]interface{}\n    if err := json.Unmarshal([]byte(s), &amp;v); err != nil {\n        panic(err)\n\n    }\n    fmt.Println(v)\n}\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/uCPAW5TjdH\" rel=\"nofollow\">Playground</a></kbd></p>\n"}], "owner": {"reputation": 2090, "user_id": 1661304, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/9b28a71116ef84b382a419e36528afd7?s=128&d=identicon&r=PG", "display_name": "Asaf", "link": "https://stackoverflow.com/users/1661304/asaf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1335, "favorite_count": 1, "accepted_answer_id": 33933971, "answer_count": 1, "score": 6, "last_activity_date": 1448531927, "creation_date": 1448525963, "last_edit_date": 1448531927, "question_id": 33933577, "link": "https://stackoverflow.com/questions/33933577/go-how-to-decode-convert-a-txt-file-contains-hex-chars-into-readable-string", "title": "Go - How to decode/convert a txt file contains hex chars into readable string", "body": "<p>I've got a log file, where each line is a JSON. Due to some Nginx security reasons, the logs are being saved in a hexadecimal format (e.g. the char \" will be converted to \\x22). Here is an example of a JSON line:</p>\n\n<pre><code> { \"body_bytes_sent\": \"474\", \"params\": {\\x22device_id\\x22: \\x221234567890\\x22} }\n</code></pre>\n\n<p>My goal:</p>\n\n<ol>\n<li>Read the file line by line.</li>\n<li><p>Convert each line to a readable format</p>\n\n<pre><code>{ \"body_bytes_sent\": \"474\", \"params\" : {\"device_id\": \"1234567890\"} }\n</code></pre></li>\n<li><p>Convert this string into a JSON object so I could manipulate it.</p></li>\n</ol>\n\n<p>Any help will be appreciated.</p>\n"}, {"tags": ["go", "goji"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1448574705, "post_id": 33932887, "comment_id": 55653875, "body": "I&#39;ve merged in multipart form support to goji/csrf: <a href=\"https://github.com/goji/csrf/pull/4\" rel=\"nofollow noreferrer\">github.com/goji/csrf/pull/4</a> (I&#39;d missed this when merging in other commits from its sister-project, gorilla/csrf)"}, {"owner": {"reputation": 1575, "user_id": 549529, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/c6d37b088a99ad744492e4e16b857c86?s=128&d=identicon&r=PG", "display_name": "ginad", "link": "https://stackoverflow.com/users/549529/ginad"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1450235263, "post_id": 33932887, "comment_id": 56348679, "body": "Thanks for the hard work"}], "owner": {"reputation": 1575, "user_id": 549529, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/c6d37b088a99ad744492e4e16b857c86?s=128&d=identicon&r=PG", "display_name": "ginad", "link": "https://stackoverflow.com/users/549529/ginad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1448523223, "creation_date": 1448523223, "question_id": 33932887, "link": "https://stackoverflow.com/questions/33932887/how-goji-csrf-not-working-with-multipart", "title": "how goji csrf not working with multipart", "body": "<p>I'm learning how to develop a website using go and I've decided to try Goji. Everything is working fine except when I'm trying to use CSRF (<code>goji-csrf</code>) on a file upload I keep getting <code>Forbidden - CSRF token invalid</code> but when I removed <code>enctype=\"multipart/form-data\"</code> in the template the csrf middleware is working fine.</p>\n\n<p>Thanks for the answer in advance guys.</p>\n"}, {"tags": ["go", "nohup"], "answers": [{"comments": [{"owner": {"reputation": 1945, "user_id": 1586394, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/1hfhi.jpg?s=128&g=1", "display_name": "maddygoround", "link": "https://stackoverflow.com/users/1586394/maddygoround"}, "edited": false, "score": 0, "creation_date": 1448524281, "post_id": 33933051, "comment_id": 55626304, "body": "Thank you very much for clearing this for me.it did run.Thanks again"}], "tags": [], "owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "is_accepted": true, "score": 2, "last_activity_date": 1448523863, "creation_date": 1448523863, "answer_id": 33933051, "question_id": 33932531, "link": "https://stackoverflow.com/questions/33932531/nohup-return-to-back-to-program-in-golang/33933051#33933051", "title": "nohup return to back to program in golang", "body": "<p>So it seems that there are a few things that are tripping out up. I've rewritten the code below, but let me first address each one explicitly so I can explain what I think the confusion is and explain my changes:</p>\n\n<ul>\n<li><code>destinationDirPath + \"/pf_file_monitor.sh\"</code> - this isn't technically wrong, but it's much more idiomatic (and more reliable) to use <a href=\"https://golang.org/pkg/path/filepath/#Join\" rel=\"nofollow\"><code>filepath.Join</code></a>; as a general rule, you should never be doing manual string concatenation of paths unless you have a good reason</li>\n<li><code>$&gt;</code> - I assume what you're trying to do here is redirect the output of the command to the log file. The issue here is that the symbol <code>$&gt;</code> is only meaningful when you're in a shell (like <code>sh</code> or <code>bash</code>). Go, on the other hand, just sees it as another command line argument, and passes it as an argument to the program. Thus, you're going to have to do this manually. In the example I give below, what I do is open the file up and then set <code>cmd</code>'s stdout and stderr pipes (these are <code>io.Writer</code>s that control where stdout and stderr go) to the file handle.</li>\n<li>It won't run in the background. The problem here is that you're using the <a href=\"https://golang.org/pkg/os/exec/#Cmd.Run\" rel=\"nofollow\"><code>Run</code></a> method, which will run the command and block until it finishes. You instead want the <a href=\"https://golang.org/pkg/os/exec/#Cmd.Start\" rel=\"nofollow\"><code>Start</code></a> method, which only starts the command and then immediately returns so your program can keep running.</li>\n</ul>\n\n<p>Hope this helps! Here's the updated implementation:</p>\n\n<pre><code>script := filepath.Join(destinationDirPath, \"pf_file_monitor.sh\")\nlog := filepath.Join(destinationDirPath, \"nohup.out\")\ncmd := exec.Command(\"nohup\", \"sh\", script)\n\nf, err := os.Create(log)\nif err != nil {\n    // handle error\n}\n\n// redirect both stdout and stderr to the log file\ncmd.Stdout = f\ncmd.Stderr = f\n\n// start command (and let it run in the background)\nerr = cmd.Start()\nif err != nil {\n    // handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 1945, "user_id": 1586394, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/1hfhi.jpg?s=128&g=1", "display_name": "maddygoround", "link": "https://stackoverflow.com/users/1586394/maddygoround"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1945, "favorite_count": 0, "accepted_answer_id": 33933051, "answer_count": 1, "score": 1, "last_activity_date": 1448523863, "creation_date": 1448521833, "question_id": 33932531, "link": "https://stackoverflow.com/questions/33932531/nohup-return-to-back-to-program-in-golang", "title": "nohup return to back to program in golang", "body": "<p>We are trying to excute a nohup script from the golang and here is the command we excute </p>\n\n<pre><code>cmd := exec.Command(\"nohup\",\"sh\",destinationDirPath + \"/pf_file_monitor.sh\",\"&amp;&gt;\",destinationDirPath + \"/nohup.out\",\"&amp;\")\n_,err = cmd.Output();\n</code></pre>\n\n<p>The problem is after excuting this command the control is not returing back to the program.</p>\n\n<p>Can anyone please assist me in this ?</p>\n"}, {"tags": ["go", "pkcs#8"], "answers": [{"tags": [], "owner": {"reputation": 3404, "user_id": 1356883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43b6bc536b1c55643d004555a8403865?s=128&d=identicon&r=PG", "display_name": "kofemann", "link": "https://stackoverflow.com/users/1356883/kofemann"}, "is_accepted": false, "score": 4, "last_activity_date": 1492387673, "last_edit_date": 1492387673, "creation_date": 1478705048, "answer_id": 40510456, "question_id": 33932221, "link": "https://stackoverflow.com/questions/33932221/golang-marshal-pkcs8-private-key/40510456#40510456", "title": "golang - marshal PKCS8 private key?", "body": "<p>Funny enough, there are no standard function to do that, but here is a custom solution:</p>\n\n<pre><code>type pkcs8Key struct {\n    Version             int\n    PrivateKeyAlgorithm []asn1.ObjectIdentifier\n    PrivateKey          []byte\n}\n\n\nfunc rsa2pkcs8(key *rsa.PrivateKey) ([]byte, error) {\n    var pkey pkcs8Key\n    pkey.Version = 0 \n    pkey.PrivateKeyAlgorithm = make([]asn1.ObjectIdentifier, 1)\n    pkey.PrivateKeyAlgorithm[0] = asn1.ObjectIdentifier{1, 2, 840, 113549, 1, 1, 1}\n    pkey.PrivateKey = x509.MarshalPKCS1PrivateKey(key)\n\n    return asn1.Marshal(pkey)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12330, "user_id": 479900, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd48848f9904bdce25eb2a2824842f50?s=128&d=identicon&r=PG", "display_name": "James Roper", "link": "https://stackoverflow.com/users/479900/james-roper"}, "is_accepted": false, "score": 3, "last_activity_date": 1575603280, "creation_date": 1575603280, "answer_id": 59206489, "question_id": 33932221, "link": "https://stackoverflow.com/questions/33932221/golang-marshal-pkcs8-private-key/59206489#59206489", "title": "golang - marshal PKCS8 private key?", "body": "<p>Since the above answer was written, go 1.10 has been released with a <a href=\"https://golang.org/pkg/crypto/x509/#MarshalPKCS8PrivateKey\" rel=\"nofollow noreferrer\"><code>x509.MarshalPKCS8PrivateKey</code></a> method.</p>\n"}], "owner": {"reputation": 1739, "user_id": 57357, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/46b892c9b15be26fec41fe9112410d5f?s=128&d=identicon&r=PG", "display_name": "Dan Tanner", "link": "https://stackoverflow.com/users/57357/dan-tanner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1681, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1575603280, "creation_date": 1448520543, "question_id": 33932221, "link": "https://stackoverflow.com/questions/33932221/golang-marshal-pkcs8-private-key", "title": "golang - marshal PKCS8 private key?", "body": "<p>Is there a way to marshal a PKCS8 private key in go 1.5?<br>\ne.g. something similar to or starting from <code>x509.MarshalPKCS1PrivateKey</code>?</p>\n"}]