[{"tags": ["go", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 1, "last_activity_date": 1547095694, "creation_date": 1547095694, "answer_id": 54122101, "question_id": 54120026, "link": "https://stackoverflow.com/questions/54120026/using-modules-newly-installed-package-cannot-be-referenced-within-project/54122101#54122101", "title": "Using modules, newly installed package cannot be referenced within project", "body": "<blockquote>\n  <p>Should I be doing things differently so that my import statement can find the newly installed package?</p>\n</blockquote>\n\n<p>No. With modules there is no need to install the packages upfront at all.</p>\n\n<blockquote>\n  <p>Using modules shouldn't all the packages be installed in the project path somewhere?</p>\n</blockquote>\n\n<p>No. They get downloaded somewhere in some format and used from that location but they are not \"installed\" like in the old GOPATH variant of <code>go get</code>.</p>\n\n<p>Show output of go env and what go mod vendor produces.  </p>\n"}, {"tags": [], "owner": {"reputation": 33, "user_id": 3433209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/659e634e39416cd847c94abcf2269615?s=128&d=identicon&r=PG&f=1", "display_name": "elcapitankyle", "link": "https://stackoverflow.com/users/3433209/elcapitankyle"}, "is_accepted": false, "score": 0, "last_activity_date": 1547240338, "last_edit_date": 1547240338, "creation_date": 1547144016, "answer_id": 54134645, "question_id": 54120026, "link": "https://stackoverflow.com/questions/54120026/using-modules-newly-installed-package-cannot-be-referenced-within-project/54134645#54134645", "title": "Using modules, newly installed package cannot be referenced within project", "body": "<p>I'm pretty sure I was doing things wrong. I was able to resolve this after referencing the following closely the steps documented at <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">golang modules wiki</a>. The summary is that there is no need to \"install\" a package via 'go get'. Instead simply make sure your project is initialized to use modules using the 'go mod init' command and then include the package name in an import statement. The next build event will pull down the package and all its dependencies.   </p>\n"}], "owner": {"reputation": 33, "user_id": 3433209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/659e634e39416cd847c94abcf2269615?s=128&d=identicon&r=PG&f=1", "display_name": "elcapitankyle", "link": "https://stackoverflow.com/users/3433209/elcapitankyle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "accepted_answer_id": 54122101, "answer_count": 2, "score": 2, "last_activity_date": 1547240338, "creation_date": 1547077051, "last_edit_date": 1547102587, "question_id": 54120026, "link": "https://stackoverflow.com/questions/54120026/using-modules-newly-installed-package-cannot-be-referenced-within-project", "title": "Using modules, newly installed package cannot be referenced within project", "body": "<p>go version go1.11.4 darwin/amd64\nGOPATH has been unset but was previously set to $HOME/Development/go</p>\n\n<p>Project path is under $HOME/code/</p>\n\n<p>I\u2019m able to successfully (no errors at least) install the go-sql-driver/mysql package using the command</p>\n\n<p><code>go get github.com/go-sql-driver/mysql@v1</code></p>\n\n<p>When I include a reference to that package in an import statement</p>\n\n<pre><code>import(\n_ \"github.com/go-sql-driver/mysql\")\n</code></pre>\n\n<p>in my code I see the error </p>\n\n<blockquote>\n  <p>could not import github.com/go-sql-driver/mysql (can\u2019t find import:\n  \u201cgithub.com/go-sql-driver/mysql\u201d)</p>\n</blockquote>\n\n<p>I have run go mod init in my project root and it creates a go.mod file. When I run the go get command I see a require statement added to that file for the package. But it seems the files for the package get installed in the default $HOME/go directory (since I've unset GOPATH). </p>\n\n<p>Should I be doing things differently so that my import statement can find the newly installed package? Using modules shouldn't all the packages be installed in the project path somewhere?</p>\n"}, {"tags": ["go", "cmd", "darwin"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1547075827, "post_id": 54119664, "comment_id": 95072048, "body": "You must be ignoring <code>err</code>."}, {"owner": {"reputation": 69, "user_id": 7183492, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8557fb6dc0d0c0d3c7eaf183f58cb09?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7183492/steve"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1547076638, "post_id": 54119664, "comment_id": 95072239, "body": "by &quot;no output&quot; i mean it does trigger err != nil block and the value is [] for goInstalled for these. goInstalled, err := exec.Command(&quot;command&quot;, &quot;-v&quot;, &quot;go&quot;).Output() does not trigger err != nil block and returns an output [byte numbers]"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1547078104, "post_id": 54119664, "comment_id": 95072550, "body": "exec.Command does <i>not</i> execute shell commands. It executes the <i>program</i> given as the first argument. Shell built-ins don&#39;t work without executing a shell explicitly. In this case though you can simply call <a href=\"https://golang.org/pkg/os/exec/#LookPath\" rel=\"nofollow noreferrer\">exec.LookPath</a>."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1547107477, "post_id": 54123366, "comment_id": 95079883, "body": "No need to call LookPath yourself: &quot;If name contains no path separators, Command uses LookPath to resolve name to a complete path&quot; <a href=\"https://golang.org/pkg/os/exec/#Command\" rel=\"nofollow noreferrer\">golang.org/pkg/os/exec/#Command</a>"}, {"owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1547107624, "post_id": 54123366, "comment_id": 95079930, "body": "My mistake, I&#39;ll update my comment. Thanks for the catch!"}], "tags": [], "owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "is_accepted": false, "score": 4, "last_activity_date": 1547116015, "last_edit_date": 1547116015, "creation_date": 1547103552, "answer_id": 54123366, "question_id": 54119664, "link": "https://stackoverflow.com/questions/54119664/why-do-some-commands-return-output-but-not-others-for-exec-command/54123366#54123366", "title": "Why do some commands return output but not others for exec.Command()", "body": "<p>The main issue you're running into here is that <code>exec.Command</code> executes <em>programs</em>, where the commands you're trying to use are actually built-ins.</p>\n\n<p>In order to use built-ins, you need to find them using <code>exec.LookPath</code>, and they're not generally available outside of a shell.</p>\n\n<p>If you must, you can also execute the command from <em>within</em> a shell, by having a shell be first argument:</p>\n\n<pre><code>exec.Command(\"/bin/bash\", \"-c\", \"command -v foo\")\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 7183492, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8557fb6dc0d0c0d3c7eaf183f58cb09?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7183492/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547116015, "creation_date": 1547074791, "last_edit_date": 1547075523, "question_id": 54119664, "link": "https://stackoverflow.com/questions/54119664/why-do-some-commands-return-output-but-not-others-for-exec-command", "title": "Why do some commands return output but not others for exec.Command()", "body": "<p>I am trying to figure out why some shell commands work with goloang exec.Command and others don't when they all return the same result when entered in terminal.  I basically would like to use the same command for windows and mac binary (exec.Command(\"where\", \"go\").Output()).</p>\n\n<p>These specifically:</p>\n\n<pre><code>goInstalled, err := exec.Command(\"where\", \"go\").Output() // does not return output on mac when compiled but does in terminal command. DOES return output on windows compiled.\n\ngoInstalled, err := exec.Command(\"which\", \"go\").Output() // does not return output on mac when compiled but does in terminal command\n\ngoInstalled, err := exec.Command(\"command\", \"-v\", \"go\").Output() // returns output when compiled and as terminal command (mac only)\n</code></pre>\n\n<p>I would like to use the same command for windows and mac (darwin) if possible rather than create two separate functions to check if things are installed on users machine.</p>\n"}, {"tags": ["go", "reflection", "reflect"], "comments": [{"owner": {"reputation": 551, "user_id": 10554768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0874152f77551e2be38904d25e5822e?s=128&d=identicon&r=PG&f=1", "display_name": "robert", "link": "https://stackoverflow.com/users/10554768/robert"}, "edited": false, "score": 2, "creation_date": 1547075414, "post_id": 54119616, "comment_id": 95071943, "body": "I would assume not, since you can have different fields in a struct with the same name with different capitalization."}, {"owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "edited": false, "score": 0, "creation_date": 1547083481, "post_id": 54119616, "comment_id": 95073678, "body": "Golang also does not support property aliasing, to my knowledge."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1547085249, "creation_date": 1547085249, "answer_id": 54120946, "question_id": 54119616, "link": "https://stackoverflow.com/questions/54119616/ignore-case-in-golang-reflection-fieldbyname/54120946#54120946", "title": "Ignore case in golang reflection FieldByName", "body": "<p>Use <a href=\"https://godoc.org/reflect#Value.FieldByNameFunc\" rel=\"noreferrer\">Value.FieldByNameFunc</a> and <a href=\"https://godoc.org/strings#ToLower\" rel=\"noreferrer\">strings.ToLower</a> to ignore case when finding a field:</p>\n\n<pre><code>func caseInsenstiveFieldByName(v reflect.Value, name string) reflect.Value {\n    name = strings.ToLower(name)\n    return v.FieldByNameFunc(func(n string) bool { return strings.ToLower(n) == name })\n}\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>func Extract(app *App) {\n    appData := reflect.ValueOf(app)\n    appid := caseInsenstiveFieldByName(reflect.Indirect(appData), \"appid\")\n    fmt.Println(appid.String())\n    owner := caseInsenstiveFieldByName(reflect.Indirect(appData), \"owner\")\n    fmt.Println(owner.String())\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/5oUOambPjFZ\" rel=\"noreferrer\">Run it on the Playground</a>.</p>\n"}], "owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 559, "favorite_count": 0, "accepted_answer_id": 54120946, "answer_count": 1, "score": 2, "last_activity_date": 1547085249, "creation_date": 1547074540, "question_id": 54119616, "link": "https://stackoverflow.com/questions/54119616/ignore-case-in-golang-reflection-fieldbyname", "title": "Ignore case in golang reflection FieldByName", "body": "<p>I am trying read from a struct using reflection in golang which I was able to do successfully but I am wondering what can I do to ignore case of a field name.</p>\n\n<p>I have the below code</p>\n\n<pre><code>type App struct{\n    AppID        string\n    Owner        string\n    DisplayName  string\n}\n\nfunc Extract(app *App){\nappData := reflect.ValueOf(app)\nappid := reflect.Indirect(appData).FieldByName(\"appid\")\nfmt.Println(appid.String())\nowner:=reflect.Indirect(appData).FieldByName(\"owner\")\nfmt.Println(owner.String())\n}\n</code></pre>\n\n<p>The above function returns <code>&lt;invalid-value&gt;</code> for both and its because of the lower case of the field name</p>\n\n<p><strong>Is there a way I could ignore the case?</strong></p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-dynamodb"], "answers": [{"comments": [{"owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "reply_to_user": {"reputation": 667, "user_id": 595830, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/7b5e1513fb3adb18d731fb5f56cf0837?s=128&d=identicon&r=PG", "display_name": "Arpan Solanki", "link": "https://stackoverflow.com/users/595830/arpan-solanki"}, "edited": false, "score": 0, "creation_date": 1547142615, "post_id": 54122971, "comment_id": 95100019, "body": "Are you sure you have another page? I know that sounds dumb, but it&#39;s worth asking to be sure you know how many pages are there."}, {"owner": {"reputation": 667, "user_id": 595830, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/7b5e1513fb3adb18d731fb5f56cf0837?s=128&d=identicon&r=PG", "display_name": "Arpan Solanki", "link": "https://stackoverflow.com/users/595830/arpan-solanki"}, "edited": false, "score": 0, "creation_date": 1547142863, "post_id": 54122971, "comment_id": 95100163, "body": "Yes i am sure there are lot of backups. So there should be more pages. Seems like some bug with the api?"}, {"owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "reply_to_user": {"reputation": 667, "user_id": 595830, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/7b5e1513fb3adb18d731fb5f56cf0837?s=128&d=identicon&r=PG", "display_name": "Arpan Solanki", "link": "https://stackoverflow.com/users/595830/arpan-solanki"}, "edited": false, "score": 0, "creation_date": 1547144032, "post_id": 54122971, "comment_id": 95100738, "body": "Perhaps. One of the biggest issues with the golang AWS SDK is the inconsistencies between pagination APIs - I wasn&#39;t even able to find someone else <i>using</i> this functionality on github to reference myself. I would suggest trying the same code, but specifying the table, and seeing if your mileage varies. If not, perhaps their issue tracker might be a better spot. Unfortunately this seems very, very specific."}, {"owner": {"reputation": 667, "user_id": 595830, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/7b5e1513fb3adb18d731fb5f56cf0837?s=128&d=identicon&r=PG", "display_name": "Arpan Solanki", "link": "https://stackoverflow.com/users/595830/arpan-solanki"}, "edited": false, "score": 0, "creation_date": 1547155101, "post_id": 54122971, "comment_id": 95105638, "body": "Thanks for looking into it."}], "tags": [], "owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "is_accepted": false, "score": 0, "last_activity_date": 1547101498, "creation_date": 1547101498, "answer_id": 54122971, "question_id": 54118604, "link": "https://stackoverflow.com/questions/54118604/dynamodb-list-all-backups-using-aws-golang-sdk/54122971#54122971", "title": "DynamoDB list all backups using AWS GoLang SDK", "body": "<p>It could be that you're smashing into the API a bit with your usage</p>\n\n<blockquote>\n  <p>You can call ListBackups a maximum of 5 times per second.</p>\n</blockquote>\n\n<p>What is the value of <code>p.HasNextPage()</code> in your <code>p.Next()</code> loop?</p>\n"}, {"tags": [], "owner": {"reputation": 26372, "user_id": 5867722, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9VQ1v.jpg?s=128&g=1", "display_name": "Farhad Farahi", "link": "https://stackoverflow.com/users/5867722/farhad-farahi"}, "is_accepted": false, "score": 1, "last_activity_date": 1586352187, "creation_date": 1586352187, "answer_id": 61101766, "question_id": 54118604, "link": "https://stackoverflow.com/questions/54118604/dynamodb-list-all-backups-using-aws-golang-sdk/61101766#61101766", "title": "DynamoDB list all backups using AWS GoLang SDK", "body": "<p>Its a bit late but I'll just put it here in case I can help somebody.</p>\n\n<p>Example:</p>\n\n<pre><code>var exclusiveStartARN *string\nvar backups []*dynamodb.BackupSummary\n    for {\n        backup, err := svc.ListBackups(&amp;dynamodb.ListBackupsInput{\n            ExclusiveStartBackupArn:exclusiveStartARN,\n        })\n\n        if err != nil {\n            fmt.Println(err)\n            os.Exit(1)\n        }\n\n        backups = append(backups, backup.BackupSummaries...)\n        if backup.LastEvaluatedBackupArn != nil {\n            exclusiveStartARN = backup.LastEvaluatedBackupArn\n            //max 5 times a second so we dont hit the limit\n            time.Sleep(200 * time.Millisecond)\n            continue\n        }\n        break\n    }\n    fmt.Println(len(backups))\n</code></pre>\n\n<p>Explaination:</p>\n\n<p>The way that pagination is done is via <code>ExclusiveStartBackupArn</code> in the ListBackupsRequest. The ListBackupsResponse returns LastEvaluatedBackupArn if there are more pages, or nil if its the last/only page.</p>\n"}], "owner": {"reputation": 667, "user_id": 595830, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/7b5e1513fb3adb18d731fb5f56cf0837?s=128&d=identicon&r=PG", "display_name": "Arpan Solanki", "link": "https://stackoverflow.com/users/595830/arpan-solanki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1586352187, "creation_date": 1547069077, "question_id": 54118604, "link": "https://stackoverflow.com/questions/54118604/dynamodb-list-all-backups-using-aws-golang-sdk", "title": "DynamoDB list all backups using AWS GoLang SDK", "body": "<p>Based on the example given in the link blow on API Operation Pagination without Callbacks \n<a href=\"https://aws.amazon.com/blogs/developer/context-pattern-added-to-the-aws-sdk-for-go/\" rel=\"nofollow noreferrer\">https://aws.amazon.com/blogs/developer/context-pattern-added-to-the-aws-sdk-for-go/</a>\nI am trying to list all the Backups in dynamodb. But it seems like  pagination is not working and it is just retrieving first page and not going to next page</p>\n\n<pre><code>package main\n\n    import (\n        \"context\"\n        \"fmt\"\n\n        \"github.com/aws/aws-sdk-go/aws\"\n        \"github.com/aws/aws-sdk-go/aws/request\"\n\n        \"github.com/aws/aws-sdk-go/aws/session\"\n        \"github.com/aws/aws-sdk-go/service/dynamodb\"\n    )\n\n    func main() {\n\n        sess, sessErr := session.NewSession()\n\n        if sessErr != nil {\n            fmt.Println(sessErr)\n            fmt.Println(\"Cound not initilize session..returning..\")\n            return\n        }\n        // Create DynamoDB client\n        dynamodbSvc := dynamodb.New(sess)\n\n        params := dynamodb.ListBackupsInput{}\n        ctx := context.Background()\n\n        p := request.Pagination{\n            NewRequest: func() (*request.Request, error) {\n                req, _ := dynamodbSvc.ListBackupsRequest(&amp;params)\n                req.SetContext(ctx)\n                return req, nil\n            },\n        }\n\n        for p.Next() {\n            page := p.Page().(*dynamodb.ListBackupsOutput)\n            fmt.Println(\"Received\", len(page.BackupSummaries), \"objects in page\")\n            for _, obj := range page.BackupSummaries {\n                fmt.Println(aws.StringValue(obj.BackupName))\n            }\n        }\n        //return p.Err()\n    } //end of main\n</code></pre>\n"}, {"tags": ["go", "hugo"], "owner": {"reputation": 1690, "user_id": 10104341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df7326ce0b47203cf7bf776da128e5a6?s=128&d=identicon&r=PG&f=1", "display_name": "Dimitris Efst", "link": "https://stackoverflow.com/users/10104341/dimitris-efst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1547451532, "creation_date": 1547066910, "last_edit_date": 1547451532, "question_id": 54118131, "link": "https://stackoverflow.com/questions/54118131/how-to-include-2-ogimages-in-hugo-site", "title": "How to include 2 ogimages in Hugo site", "body": "<p>In a hugo file I am using an ogimage, in my config.yaml. I want to add a second one to use in specific pages...</p>\n\n<p>If I put a second ogimage in config.yaml like so:\nogimage2: images/something</p>\n\n<p>And then header.html do this: </p>\n\n<pre><code>{{ if isset .Params \"ogimage2\" }}\n        &lt;meta property=\"og:image\" content=\"{{ .Params.ogimage2 }}\"&gt;\n{{ else }}\n        &lt;meta property=\"og:image\" content=\"{{ .Params.ogimage }}\"&gt;\n{{ end }}\n</code></pre>\n\n<p>And then in the pages I want to actually include this, do </p>\n\n<pre><code>---\ntitle: yourtitle\nogimage2: images/some_image.jpg\n---\n</code></pre>\n\n<p>I thought this would work. I haven't found any docs, saying something, about <code>ogimages</code> for specific pages in hugo. Can you tell me what I did wrong.</p>\n"}, {"tags": ["postgresql", "go", "sql-injection"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1547066526, "post_id": 54117802, "comment_id": 95068596, "body": "By using <code>json_build_object</code>/<code>jsonb_build_object</code> and similar functions instead of constructing the json from strings. E.g. <code>... bar @&gt; json_build_object(&quot;bar&quot;, $1)</code>"}, {"owner": {"reputation": 125670, "user_id": 6464308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/12PVX.jpg?s=128&g=1", "display_name": "Laurenz Albe", "link": "https://stackoverflow.com/users/6464308/laurenz-albe"}, "edited": false, "score": 0, "creation_date": 1547104178, "post_id": 54117802, "comment_id": 95078463, "body": "Are there no prepared statements in Go? That&#39;s the king&#39;s way to avoiding SQL injection."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1547105712, "post_id": 54117802, "comment_id": 95079074, "body": "Remove the <code>0,</code> at the start of the <code>jsonb_build_array</code>; you\u2019re creating <code>[0, {&quot;foo&quot;: \u2026}]</code>. Also, no need to cast <code>jsonb_build_array</code> to <code>jsonb</code>."}], "answers": [{"comments": [{"owner": {"reputation": 904, "user_id": 2759462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de467ec1a458adebfcad737f12070b17?s=128&d=identicon&r=PG", "display_name": "Rafael Barros", "link": "https://stackoverflow.com/users/2759462/rafael-barros"}, "edited": false, "score": 0, "creation_date": 1547127733, "post_id": 54123812, "comment_id": 95091046, "body": "I had to tweak a bit, and put a json tag to format the key in the struct, but it worked. Thanks. The @Ry-&#39;s comment in the question also worked."}, {"owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "reply_to_user": {"reputation": 904, "user_id": 2759462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de467ec1a458adebfcad737f12070b17?s=128&d=identicon&r=PG", "display_name": "Rafael Barros", "link": "https://stackoverflow.com/users/2759462/rafael-barros"}, "edited": false, "score": 1, "creation_date": 1547128017, "post_id": 54123812, "comment_id": 95091213, "body": "Glad you were able to get what you needed friend."}], "tags": [], "owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "is_accepted": true, "score": 2, "last_activity_date": 1547105526, "creation_date": 1547105526, "answer_id": 54123812, "question_id": 54117802, "link": "https://stackoverflow.com/questions/54117802/how-to-prevent-sql-injection-in-postgresql-json-jsonb-field/54123812#54123812", "title": "How to prevent SQL Injection in PostgreSQL JSON/JSONB field?", "body": "<p>Is this what you're looking for?</p>\n\n<pre><code>type MyStruct struct {\n    Baz string\n}\n\nfunc main() {\n    db, err := sql.Open(\"postgres\", \"postgres://...\")\n    if err != nil {\n        log.Panic(err)\n    }\n\n    s := MyStruct{\n        Baz: \"qux\",\n    }\n\n    val, _ := json.Marshal(s)\n    if err != nil {\n        log.Panic(err)\n    }\n\n    if _, err := db.Exec(\"SELECT * FROM foo WHERE bar @&gt; ?\", val); err != nil {\n        log.Panic(err)\n    }\n}\n</code></pre>\n\n<p>As a side note, <code>Exec</code> isn't for retrieval (although I kept it for you so the solution would match your example). Check out <code>db.Query</code> (Fantastic tutorial here: <a href=\"http://go-database-sql.org/retrieving.html\" rel=\"nofollow noreferrer\">http://go-database-sql.org/retrieving.html</a>)</p>\n"}], "owner": {"reputation": 904, "user_id": 2759462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de467ec1a458adebfcad737f12070b17?s=128&d=identicon&r=PG", "display_name": "Rafael Barros", "link": "https://stackoverflow.com/users/2759462/rafael-barros"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1035, "favorite_count": 1, "accepted_answer_id": 54123812, "answer_count": 1, "score": 2, "last_activity_date": 1547105526, "creation_date": 1547065500, "last_edit_date": 1547070497, "question_id": 54117802, "link": "https://stackoverflow.com/questions/54117802/how-to-prevent-sql-injection-in-postgresql-json-jsonb-field", "title": "How to prevent SQL Injection in PostgreSQL JSON/JSONB field?", "body": "<p><a href=\"https://stackoverflow.com/questions/26345318/how-can-i-prevent-sql-injection-attacks-in-go-while-using-database-sql\">How can I prevent SQL injection attacks in Go while using &quot;database/sql&quot;?</a></p>\n\n<p>This solves the single value field problem because you can remove the quotes, but I can't do that filtering a JSON/JSONB field, like in the following because the <code>$1</code> is considered a string:</p>\n\n<pre><code>`SELECT * FROM foo WHERE bar @&gt; '{\"baz\": \"$1\"}'`\n</code></pre>\n\n<p>The following works but it's prone to SQL Injection:</p>\n\n<pre><code>`SELECT * FROM foo WHERE bar @&gt; '{\"baz\": \"` + \"qux\" + `\"}'`\n</code></pre>\n\n<p>How do I solve this?</p>\n\n<hr>\n\n<p><strong>EDITED after @mkopriva's comment:</strong></p>\n\n<p>How would I build this json <code>[{\"foo\": $1}]</code> with the <code>jsonb_*</code> functions? Tried the below without success:</p>\n\n<pre><code>jsonb_build_array(0, jsonb_build_object('foo', $1::text))::jsonb\n</code></pre>\n\n<p>There's no sql error. The filter just doesn't work. There's a way that I can check the builded sql? I'm using the <code>database/sql</code> native lib.</p>\n"}, {"tags": ["mongodb", "go", "batch-processing", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 371, "user_id": 4639268, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2300a6e82755fbbe115b1ebbcb638c0b?s=128&d=identicon&r=PG&f=1", "display_name": "pavbagel", "link": "https://stackoverflow.com/users/4639268/pavbagel"}, "edited": false, "score": 0, "creation_date": 1547146873, "post_id": 54121717, "comment_id": 95102052, "body": "Thanks for your explanation.  I was trying to figure out how not to load millions of records at once into the app for batch processing.  I supposed I can something with limit.  Thanks."}], "tags": [], "owner": {"reputation": 1374, "user_id": 10849350, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8t7Pj.png?s=128&g=1", "display_name": "simagix", "link": "https://stackoverflow.com/users/10849350/simagix"}, "is_accepted": true, "score": 2, "last_activity_date": 1547092265, "creation_date": 1547092265, "answer_id": 54121717, "question_id": 54117568, "link": "https://stackoverflow.com/questions/54117568/get-records-in-batches-from-mongodb-using-golang/54121717#54121717", "title": "Get records in batches from MongoDB using golang", "body": "<p>The <code>batchSize()</code> specifies the number of documents to return in each batch of the response.  You will still all results.  For example, if the total number of returned docs is 100 and you specify batch size as 20, you will have 1 <code>find</code> and 4 <code>getMore</code> commands sent from the client to the <code>mongod</code> to complete the request.</p>\n\n<p>One little trick you can use to verify.  Use <code>db.setProfilingLevel(0, 0)</code> from mongo shell to log everything in the log file.  Execute your test app and you will see <code>find</code> and <code>getMore</code> recorded in the log.</p>\n"}], "owner": {"reputation": 371, "user_id": 4639268, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2300a6e82755fbbe115b1ebbcb638c0b?s=128&d=identicon&r=PG&f=1", "display_name": "pavbagel", "link": "https://stackoverflow.com/users/4639268/pavbagel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1228, "favorite_count": 0, "accepted_answer_id": 54121717, "answer_count": 1, "score": 1, "last_activity_date": 1547092265, "creation_date": 1547064581, "last_edit_date": 1547072800, "question_id": 54117568, "link": "https://stackoverflow.com/questions/54117568/get-records-in-batches-from-mongodb-using-golang", "title": "Get records in batches from MongoDB using golang", "body": "<p>How can one fetch records in batches from a mongo database using golang?  I know mongoDB itself has something called cursor.batchSize(), but im trying to find an example using a golang driver.  From what I've seen the golang library mgo has a function called Batch, but Im trying to figure out how to us it.  </p>\n\n<p>Ideally I'm looking for something like this:</p>\n\n<pre><code>const cursor = useDb.collection(mycollection).find().batchSize(10000);\nfor (let doc = await cursor.next(); doc != null; doc = await cursor.next()) {\n    if (doc._id % divisor === 0) {\n        counter++;\n    }\n}\n</code></pre>\n\n<p>I have something like this so far:</p>\n\n<pre><code>err := c.Find(nil).Batch(1).All(&amp;items)\n</code></pre>\n\n<p>But it's not working like expected.</p>\n\n<p>Links:\n<a href=\"https://docs.mongodb.com/manual/reference/method/cursor.batchSize/\" rel=\"nofollow noreferrer\">https://docs.mongodb.com/manual/reference/method/cursor.batchSize/</a>\n<a href=\"https://godoc.org/github.com/globalsign/mgo#Query.Batch\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/globalsign/mgo#Query.Batch</a></p>\n"}, {"tags": ["go", "channel", "routines"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1547071486, "post_id": 54117528, "comment_id": 95070703, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/53198618/i-have-to-send-out-thousands-of-reminders-any-way-to-avoid-a-ticker-every-minut\">I have to send out thousands of reminders, any way to avoid a ticker every minute?</a>"}, {"owner": {"reputation": 396, "user_id": 5271400, "user_type": "registered", "profile_image": "https://graph.facebook.com/842781095836945/picture?type=large", "display_name": "Wilson Tamarozzi", "link": "https://stackoverflow.com/users/5271400/wilson-tamarozzi"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1547076857, "post_id": 54117528, "comment_id": 95072292, "body": "is very similar, it even gave me several new ideas, but there were still some doubts.  1. How do I make a control to stop and re-run (on / off) the postage system? 2. In my case, I create the ticker initially with the time of the post. If I turn the ticker into a global variable and reset it when adding or removing post, will it stop and start? My concern is to get new posts that should be posted first but that does not get to the function because the ticker is waiting for the time of the first post."}, {"owner": {"reputation": 396, "user_id": 5271400, "user_type": "registered", "profile_image": "https://graph.facebook.com/842781095836945/picture?type=large", "display_name": "Wilson Tamarozzi", "link": "https://stackoverflow.com/users/5271400/wilson-tamarozzi"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1547076902, "post_id": 54117528, "comment_id": 95072304, "body": "3. Finally, will not I have trouble keeping the checkRunning function the way it is? I say because I will have 100+ routines running in parallel and I am afraid to leave them in infinite loop for hours."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1547115382, "post_id": 54117528, "comment_id": 95084066, "body": "Can you consider editing the title of your post? It should describe the problem, not the particulars in which it arose."}, {"owner": {"reputation": 396, "user_id": 5271400, "user_type": "registered", "profile_image": "https://graph.facebook.com/842781095836945/picture?type=large", "display_name": "Wilson Tamarozzi", "link": "https://stackoverflow.com/users/5271400/wilson-tamarozzi"}, "edited": false, "score": 0, "creation_date": 1547141474, "post_id": 54117528, "comment_id": 95099440, "body": "Of course, what do you suggest? My problem was design architecture, but I do not think it fits."}], "answers": [{"tags": [], "owner": {"reputation": 396, "user_id": 5271400, "user_type": "registered", "profile_image": "https://graph.facebook.com/842781095836945/picture?type=large", "display_name": "Wilson Tamarozzi", "link": "https://stackoverflow.com/users/5271400/wilson-tamarozzi"}, "is_accepted": false, "score": 1, "last_activity_date": 1547141902, "last_edit_date": 1547141902, "creation_date": 1547086249, "answer_id": 54121046, "question_id": 54117528, "link": "https://stackoverflow.com/questions/54117528/what-better-way-to-implement-a-routine-that-verifies-and-performs-posts-in-socia/54121046#54121046", "title": "What better way to implement a routine that verifies and performs posts in social networks?", "body": "<p>With Peter's response I was able to adapt all the needs to put together a sketch.</p>\n\n<p>I do not know if this would be the best way to do it, maybe some function will consume processing resources unnecessarily. If anyone has better ideas for refactoring, I'll be very grateful to hear.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\n    package main\n\n    import (\n        \"fmt\"\n        \"log\"\n        \"net/http\"\n        \"sort\"\n        \"time\"\n    )\n\n    type posting struct {\n        caption string\n        scheduledTo time.Time\n    }\n\n    const dateLayoutFormat  = \"02-01-2006 15:04:05\"\n\n    var botStatus = true\n    var indexPosting int\n    var tickerSchedule = time.NewTicker(1)\n    var posts = []posting{\n        {caption: \"item 1\", scheduledTo: time.Now().Add(5 * time.Second)},\n        {caption: \"item 2\", scheduledTo: time.Now().Add(25 * time.Second)},\n    }\n\n    func init() {\n        indexPosting = len(posts)\n    }\n\n    func main() {\n        http.HandleFunc(\"/\", func (w http.ResponseWriter, r *http.Request) {\n            fmt.Fprint(w, \"Bem vindo ao bot\")\n        })\n\n        http.HandleFunc(\"/stop\", func (w http.ResponseWriter, r *http.Request) {\n            fmt.Fprint(w, \"Parando o bot!\")\n            stopBot()\n        })\n\n        http.HandleFunc(\"/start\", func (w http.ResponseWriter, r *http.Request) {\n            fmt.Fprint(w, \"Iniciando o bot!\")\n            startBot()\n        })\n\n        http.HandleFunc(\"/add\", func (w http.ResponseWriter, r *http.Request) {\n            t := time.Now().Add(5 * time.Second)\n            indexPosting++\n\n            addItemDB(posting{\n                caption: fmt.Sprint(\"item \", indexPosting),\n                scheduledTo: t,\n            })\n\n            fmt.Fprint(w, \"Adicionando nova postagem \\nPr\u00f3ximo post ser\u00e1: \", t.Format(dateLayoutFormat))\n        })\n\n        if botStatus {\n            go workerScheduled()\n        }\n\n        log.Print(\"Inicnando server...\")\n        if err := http.ListenAndServe(\":9090\", nil); err != nil {\n            log.Print(\"erro ao iniciar servidor =&gt; \", err)\n        }\n\n    }\n\n    func workerScheduled() {\n        for {\n            log.Print(\"listando as pr\u00f3ximas postagens\")\n\n            pts := getNextPostsDB()\n            if len(pts) == 0 {\n                log.Print(\"sem postagem agendada\")\n                botStatus = false\n                return\n            }\n\n            p1 := pts[0]\n\n            log.Printf(\"Pr\u00f3xima postagem ser\u00e1: %s \\n\\n\", string(p1.scheduledTo.Format(dateLayoutFormat)))\n            &lt;- updateTimer(p1.scheduledTo).C\n\n            if !botStatus {\n                log.Print(\"postagem cancelado, bot status = parado\")\n                return\n            }\n\n            if time.Until(p1.scheduledTo) &gt; 1 * time.Second {\n                updateTimer(p1.scheduledTo)\n                log.Print(\"timer resetado\")\n                continue\n            }\n\n            post(p1)\n            if len(pts) &gt; 1 {\n                p2 := pts[1]\n                updateTimer(p2.scheduledTo)\n            }\n            updatePostedDB()\n        }\n    }\n\n    func updateTimer(t time.Time) *time.Ticker {\n        tickerSchedule = time.NewTicker(t.Sub(time.Now()))\n        return tickerSchedule\n    }\n\n    func post(p posting) {\n        log.Printf(\"'%s' postado com sucesso\", p.caption)\n    }\n\n    func addItemDB(p posting) {\n        posts = append(posts, p)\n        if botStatus {\n            next := getNextPostDB()\n            updateTimer(next.scheduledTo)\n        } else {\n            botStatus = true\n            go workerScheduled()\n        }\n    }\n\n    func getNextPostDB() posting {\n        return getNextPostsDB()[0]\n    }\n\n    func getNextPostsDB() []posting {\n        orderPostsList()\n        removePostExpired()\n        return posts\n    }\n\n    func removePostExpired() {\n        for _, p := range posts {\n            if p.scheduledTo.Before(time.Now()) {\n                log.Printf(\"removendo postagem expirada\")\n                removePostByIndex(getIndexOf(p))\n            }\n        }\n    }\n\n    func removePostByIndex(i int) {\n        copy(posts[i:], posts[i+1:])\n        posts = posts[:len(posts)-1]\n    }\n\n    func getIndexOf(post posting) int {\n        for i, p := range posts {\n            if p.caption == post.caption {\n                return i\n            }\n        }\n        return -1\n    }\n\n    func updatePostedDB() {\n        removePostByIndex(0)\n    }\n\n    func orderPostsList() {\n        sort.Slice(posts, func(i, j int) bool {\n            return posts[i].scheduledTo.Before(posts[j].scheduledTo)\n        })\n    }\n\n    func startBot() {\n        if !botStatus {\n            log.Printf(\"comando 'iniciar bot'\")\n            botStatus = true\n            go workerScheduled()\n        } else {\n            log.Printf(\"comando 'iniciar bot' (j\u00e1 iniciado)\")\n        }\n    }\n\n    func stopBot() {\n        if botStatus {\n            log.Printf(\"comando 'pausar bot'\")\n            botStatus = false\n            tickerSchedule.Stop()\n        } else {\n            log.Printf(\"comando 'pausar bot' (j\u00e1 pausado)\")\n        }\n    }\n\n</code></pre>\n"}], "owner": {"reputation": 396, "user_id": 5271400, "user_type": "registered", "profile_image": "https://graph.facebook.com/842781095836945/picture?type=large", "display_name": "Wilson Tamarozzi", "link": "https://stackoverflow.com/users/5271400/wilson-tamarozzi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1547141902, "creation_date": 1547064404, "question_id": 54117528, "link": "https://stackoverflow.com/questions/54117528/what-better-way-to-implement-a-routine-that-verifies-and-performs-posts-in-socia", "title": "What better way to implement a routine that verifies and performs posts in social networks?", "body": "<p>I'm writing a small application to perform automatic postings on social networks.</p>\n\n<p>My intention is that the user can via the web interface create the post at a specific time and the bot can be checking for new posts scheduled and execute them.</p>\n\n<p>I'm having trouble working with routines and channels on Go.</p>\n\n<p>I will leave below an example that reflects the reality of my code. It contains some comments to make it easier to understand.</p>\n\n<p><strong>What is the best way to implement a routine that checks for new posts at any time?</strong> \nRemembering:</p>\n\n<ol>\n<li>User can enter new posts at any time.</li>\n<li>The bot can manage hundreds/thousands of accounts at the same time. It would be essential to consume as little processing as possible.</li>\n</ol>\n\n<p><a href=\"https://play.golang.org/p/tS2T9rDhhIp\" rel=\"nofollow noreferrer\">play.golang.org (here)</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\n    package main\n\n    import (\n        \"fmt\"\n        \"sync\"\n        \"time\"\n    )\n\n    var botRunning = true\n    var wg = &amp;sync.WaitGroup{}\n\n    func main() {\n        // I start the routine of checking for and posting scheduled appointments.\n        wg.Add(1)\n        go postingScheduled()\n\n        // Later the user passes the command to stop the post.\n        // At that moment I would like to stop the routine immediately without getting stuck in a loop.\n        // What is the best way to do this?\n        time.Sleep(3 * time.Second)\n        botRunning = false\n\n        // ignore down\n        time.Sleep(2 * time.Second)\n        panic(\"\")\n\n        wg.Wait()\n    }\n\n    // Function that keeps checking whether the routine should continue or not.\n    // Check every 2 seconds.\n    // I think this is very wrong because it consumes unnecessary resources.\n    // -&gt; Is there another way to do this?\n    func checkRunning() {\n        for {\n            fmt.Println(\"Pause/Running? - \", botRunning)\n            if botRunning {\n                break\n            }\n            time.Sleep(2 * time.Second)\n        }\n    }\n\n    // Routine that looks for the scheduled posts in the database.\n    // It inserts the date of the posts in the Ticker and when the time comes the posting takes place.\n    // This application will have hundreds of social network accounts and each will have its own function running in parallel.\n    // -&gt; What better way to check constantly if there are scheduled items in the database consuming the least resources on the machine?\n    // -&gt; Another important question. User can schedule posts to the database at any time. How do I check for new posts schedule while the Ticker is waiting for the time the last posting loaded?\n    func postingScheduled() {\n        fmt.Println(\"Init bot posting routine\")\n        defer wg.Done()\n        for {\n            checkRunning()\n            &lt;-time.NewTicker(2 * time.Second).C\n            fmt.Println(\"posted success\")\n        }\n\n    }\n\n</code></pre>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1547051056, "post_id": 54114352, "comment_id": 95061384, "body": "When you say something &quot;does not work&quot;, it&#39;s important to explain <i>how</i> - error, incorrect behavior (and specify what), etc. Just from looking at the code, however, your regex is looking for a string with an <code>=</code> in it, but you exemplars do not contain that character."}, {"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "edited": false, "score": 0, "creation_date": 1547051270, "post_id": 54114352, "comment_id": 95061517, "body": "If you can use a capturing group, try <code>^(.*? -name.*?)(?: *-descr|$)</code> <a href=\"https://regex101.com/r/XDEJ89/1\" rel=\"nofollow noreferrer\">demo</a>"}, {"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "edited": false, "score": 0, "creation_date": 1547051438, "post_id": 54114352, "comment_id": 95061626, "body": "Should <code>-descr</code> be there? Because it is not in the second example."}, {"owner": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "reply_to_user": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "edited": false, "score": 0, "creation_date": 1547051464, "post_id": 54114352, "comment_id": 95061644, "body": "@Thefourthbird, will this capturing group work with Golang? Can you tell the syntax to use with regex.MustCompile?"}, {"owner": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547051481, "post_id": 54114352, "comment_id": 95061656, "body": "I want to exclude -descr from the match"}, {"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "edited": false, "score": 0, "creation_date": 1547051682, "post_id": 54114352, "comment_id": 95061790, "body": "I mean should you also match <code>runcmd -name abcd xyz</code> when there is no <code>-descr</code> following?"}, {"owner": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547051783, "post_id": 54114352, "comment_id": 95061849, "body": "Yes, when there is no -descr, it should match and return <code>runcmd -name abcd xyz</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1547052862, "post_id": 54114352, "comment_id": 95062503, "body": "Why use a regex for such a simple task?"}], "answers": [{"comments": [{"owner": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547051727, "post_id": 54114535, "comment_id": 95061814, "body": "Text betweeen -name and -descr doesn&#39;t contain any -"}], "tags": [], "owner": {"reputation": 554, "user_id": 1990221, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6410f7d7324d1f9e0d6ef21a7cfb8d0c?s=128&d=identicon&r=PG", "display_name": "Stuart Moore", "link": "https://stackoverflow.com/users/1990221/stuart-moore"}, "is_accepted": false, "score": 0, "last_activity_date": 1547051478, "creation_date": 1547051478, "answer_id": 54114535, "question_id": 54114352, "link": "https://stackoverflow.com/questions/54114352/golang-regexp-to-match-string-until-a-given-sequence-of-characters/54114535#54114535", "title": "Golang regexp to match string until a given sequence of characters", "body": "<p>By \"Does not work\", do you mean it doesn't match anything, or just not what you expect?</p>\n\n<p><a href=\"https://regex101.com/\" rel=\"nofollow noreferrer\">https://regex101.com/</a> is generally very helpful when testing regular expressions.</p>\n\n<p>I do not believe there's a simple way to achieve what you want. Things become a lot simpler if we can assume the text betweeen <code>-name</code> and <code>-descr</code> doesn't contain any <code>-</code> in which case, <code>regex.MustCompile(`-name ([^-]*)`)</code> should work</p>\n\n<p>With this kind of thing, often it's easier and clearer to use 2 regular expressions. So the first strips <code>-descr</code> and anything following it, and the first matches <code>-name</code> and all subsequent characters.</p>\n"}, {"comments": [{"owner": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547072300, "post_id": 54114706, "comment_id": 95071008, "body": "Is it possible to modify this so the first group only contains uptil -name? The reason is, I would eventually need to do something like re1.ReplaceAllString(s, &quot;$1&quot;+&quot;....&quot;+&quot; &quot;)), so I can return the original string just with the value of -name replaced with ...., so the output string becomes <code>runcmd -name .... -descr abc def</code> which is the final goal"}, {"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "reply_to_user": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547072501, "post_id": 54114706, "comment_id": 95071088, "body": "@user1892775 To get only the first group you could use <code>^(.*? -name)</code> <a href=\"https://regex101.com/r/ojNnBl/2\" rel=\"nofollow noreferrer\">demo</a>. In that case you could also use just a match instead <code>^.*? -name</code> <a href=\"https://regex101.com/r/ojNnBl/1\" rel=\"nofollow noreferrer\">demo</a> and it could look like this <a href=\"https://ideone.com/GScvjs\" rel=\"nofollow noreferrer\">Go demo</a>"}, {"owner": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547073159, "post_id": 54114706, "comment_id": 95071303, "body": "Not sure, if I was clear enough, I want to modify the regexp so that s := &quot;runcmd -name abcd xyz -descr abc def&quot; re1 := regexp.MustCompile(regexp)  fmt.Println(re1.ReplaceAllString(s, &quot;$1&quot;+&quot;....&quot;+&quot; &quot;))   should be `runcmd -name .... -descr abc def&#39;"}, {"owner": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547073339, "post_id": 54114706, "comment_id": 95071349, "body": "If you could share an example which would give that output (the string with value for -name replaced with ....) as indicated in the code above, that would really help"}, {"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "reply_to_user": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547074101, "post_id": 54114706, "comment_id": 95071564, "body": "@user1892775 Do you mean like this using 2 capturing groups? <a href=\"https://ideone.com/vOTdLz\" rel=\"nofollow noreferrer\">ideone.com/vOTdLz</a>"}, {"owner": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547074535, "post_id": 54114706, "comment_id": 95071701, "body": "Sorry if its getting confusing. Let me try to make it simpler. For inputstr = &quot;runcmd -name abcd xyz -descr abc def&quot;, I want the output to be &quot;runcmd -name .... -descr abc def&quot;"}, {"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "reply_to_user": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547074711, "post_id": 54114706, "comment_id": 95071755, "body": "@user1892775 You could concatenate the groups <a href=\"https://ideone.com/aHwa3L\" rel=\"nofollow noreferrer\">ideone.com/aHwa3L</a>"}, {"owner": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547075311, "post_id": 54114706, "comment_id": 95071916, "body": "yeah, but then it seem to fail for the inputstr s = &quot;runcmd -name abcd xyz&quot;   (that is, when -descr option is missing)"}, {"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "reply_to_user": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547075846, "post_id": 54114706, "comment_id": 95072051, "body": "@user1892775 In that case you can make the second capturing group optional <a href=\"https://ideone.com/V6bGpF\" rel=\"nofollow noreferrer\">ideone.com/V6bGpF</a>"}, {"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "reply_to_user": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "edited": false, "score": 0, "creation_date": 1547076348, "post_id": 54114706, "comment_id": 95072170, "body": "@user1892775 I have updated my answer with the latest example."}, {"owner": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "reply_to_user": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "edited": false, "score": 0, "creation_date": 1547091977, "post_id": 54114706, "comment_id": 95075334, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/186440/discussion-between-user1892775-and-the-fourth-bird\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "is_accepted": true, "score": 0, "last_activity_date": 1547076286, "last_edit_date": 1547076286, "creation_date": 1547052031, "answer_id": 54114706, "question_id": 54114352, "link": "https://stackoverflow.com/questions/54114352/golang-regexp-to-match-string-until-a-given-sequence-of-characters/54114706#54114706", "title": "Golang regexp to match string until a given sequence of characters", "body": "<p>You could capturin first part with <code>-name</code> in a group, then match what is in between and use an optional second capturing group to match <code>-descr</code> and what follows.</p>\n\n<p>Then you could use the capturing groups when creating the desired result.</p>\n\n<pre><code>^(.*? -name\\b).*?(-descr\\b.*)?$\n</code></pre>\n\n<p><a href=\"https://regex101.com/r/EVcK4n/1/\" rel=\"nofollow noreferrer\">Regex demo</a> | <a href=\"https://ideone.com/V6bGpF\" rel=\"nofollow noreferrer\">Go demo</a></p>\n\n<p>For example:</p>\n\n<pre><code>s := \"runcmd -name abcd xyz -descr abc def\"\nre1 := regexp.MustCompile(`^(.*? -name\\b).*?(-descr\\b.*)?$`)\nresult := re1.FindStringSubmatch(s)\nfmt.Printf(result[1] + \"...\" + result[2])\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>runcmd -name...-descr abc def\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 0, "last_activity_date": 1547055963, "creation_date": 1547055963, "answer_id": 54115706, "question_id": 54114352, "link": "https://stackoverflow.com/questions/54114352/golang-regexp-to-match-string-until-a-given-sequence-of-characters/54115706#54115706", "title": "Golang regexp to match string until a given sequence of characters", "body": "<p>You are not dealing with a regular language here, so there is no reason to bust out the (slow) regexp engine. The strings package is quite enough:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"unicode\"\n)\n\nfunc main() {\n    fmt.Printf(\"%q\\n\", f(\"runcmd -name abcd xyz -descr abc def\"))\n    fmt.Printf(\"%q\\n\", f(\"runcmd -name abcd xyz\"))\n    fmt.Printf(\"%q\\n\", f(\"-descr abc def\"))\n}\n\nfunc f(s string) string {\n    if n := strings.Index(s, \"-descr\"); n &gt;= 0 {\n        return strings.TrimRightFunc(s[:n], unicode.IsSpace)\n    }\n    return s\n}\n\n// Output:\n// \"runcmd -name abcd xyz\"\n// \"runcmd -name abcd xyz\"\n// \"\"\n</code></pre>\n\n<p>Try it on the playground: <a href=\"https://play.golang.org/p/RFC65CYe6mp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/RFC65CYe6mp</a></p>\n"}], "owner": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1201, "favorite_count": 0, "accepted_answer_id": 54114706, "answer_count": 3, "score": -2, "last_activity_date": 1547076286, "creation_date": 1547050890, "last_edit_date": 1547051284, "question_id": 54114352, "link": "https://stackoverflow.com/questions/54114352/golang-regexp-to-match-string-until-a-given-sequence-of-characters", "title": "Golang regexp to match string until a given sequence of characters", "body": "<p>I have a string that could have a -name followed by value (that can have spaces) and there could also be -descr after that followed by a value (the -descr followed by value may nor may not be there):</p>\n\n<p>Example strings:</p>\n\n<pre><code>runcmd -name abcd xyz -descr abc def\n</code></pre>\n\n<p>or</p>\n\n<pre><code>runcmd -name abcd xyz\n</code></pre>\n\n<p>With Go language, how do I write regexp, that returns me the string before -descr if it exists. so, for both examples above, the result should be:</p>\n\n<pre><code>runcmd -name abcd xyz\n</code></pre>\n\n<p>I was trying:</p>\n\n<pre><code>regexp.MustCompile(`(-name ).+?=-descr`)\n</code></pre>\n\n<p>But, that did not return any match. I wanted to know the correct regexp to get the string up until -descr if it exists</p>\n"}, {"tags": ["go", "cassandra", "gocql"], "comments": [{"owner": {"reputation": 47278, "user_id": 18627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b31b9d123bff80f00317a1df0dd00e2?s=128&d=identicon&r=PG", "display_name": "Alex Ott", "link": "https://stackoverflow.com/users/18627/alex-ott"}, "edited": false, "score": 0, "creation_date": 1547050247, "post_id": 54113383, "comment_id": 95060902, "body": "Can you try to use <code>.Scan</code> instead of <code>.Exec</code> &amp; then look for <code>applied</code> column of the result - there should be only one row of data..."}, {"owner": {"reputation": 31, "user_id": 2572846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a33517b8f964dbd74783c06066dba697?s=128&d=identicon&r=PG", "display_name": "Sergey Lega", "link": "https://stackoverflow.com/users/2572846/sergey-lega"}, "reply_to_user": {"reputation": 47278, "user_id": 18627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b31b9d123bff80f00317a1df0dd00e2?s=128&d=identicon&r=PG", "display_name": "Alex Ott", "link": "https://stackoverflow.com/users/18627/alex-ott"}, "edited": false, "score": 2, "creation_date": 1547051544, "post_id": 54113383, "comment_id": 95061695, "body": "@Alex, thank you for the tip. I managed to solve this issue with <code>.ScanCAS()</code>."}], "owner": {"reputation": 31, "user_id": 2572846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a33517b8f964dbd74783c06066dba697?s=128&d=identicon&r=PG", "display_name": "Sergey Lega", "link": "https://stackoverflow.com/users/2572846/sergey-lega"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 256, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1547047612, "creation_date": 1547047612, "question_id": 54113383, "link": "https://stackoverflow.com/questions/54113383/how-to-check-if-cql-query-is-applied", "title": "How to check if CQL query is applied", "body": "<p>I have an API Server written on golang in a front of Cassandra, so I use gocql as driver. What I want is to return an error if someone tries to create duplicated entries in Cassandra, so I need not only idempotent operation (which could be achieved via if not exists clause), but also somehow to know if query was applied or not. Preliminary request like SELECT primary_keys FROM TABLE WHERE primary_keys = blah LIMIT 1 is not an option as INSERT operation should be atomic.</p>\n\n<p>When I run an example below in cqlsh Cassandra tells if query is applied: </p>\n\n<pre><code>    cqlsh&gt; create table tests.demo (\n       ... uuid text PRIMARY KEY,\n       ... data text\n       ... );\n\n    cqlsh&gt; insert into tests.demo (uuid, data) values ('test', 'data') if not exists;\n\n     applied\n    -----------\n      True \n\n    cqlsh&gt; insert into tests.demo (uuid, data) values ('test', 'data') if not exists;\n\n       applied | uuid | data\n    -----------+------+------\n         False | test | data\n</code></pre>\n\n<p>Is there any option to achieve the same with gocql since query.Exec() returns only error?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1547043228, "post_id": 54112034, "comment_id": 95056220, "body": "Most likely the value of <code>.Country</code> already contains the trailing <code>\\x0a</code> character (which is a newline <code>\\n</code>). Print it like <code>fmt.Printf(&quot;%q&quot;, country)</code> to verify. If so, you have to strip them off with e.g. <code>strings.TrimSpace()</code>."}, {"owner": {"reputation": 25, "user_id": 9685700, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "joske123", "link": "https://stackoverflow.com/users/9685700/joske123"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1547043491, "post_id": 54112034, "comment_id": 95056419, "body": "Thx, this solved it!"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1547133546, "last_edit_date": 1547133546, "creation_date": 1547043439, "answer_id": 54112162, "question_id": 54112034, "link": "https://stackoverflow.com/questions/54112034/show-variable-image-in-go-templates/54112162#54112162", "title": "Show variable image in Go templates", "body": "<blockquote>\n  <p>the string I pass adds %0a which causes the src of the img to be\n  wrong.</p>\n\n<pre><code>&lt;img id='flag' src='images/BE%0A.png'&gt;\n</code></pre>\n  \n  <p>The expected output should be</p>\n\n<pre><code>&lt;img id='flag' src='images/BE.png'&gt;\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>Trim the newline (<code>0x0A</code> or <code>\"\\n\"</code>). For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nfunc main() {\n    resp3, err := http.Get(\"https://ipinfo.io/country\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    bytes3, err := ioutil.ReadAll(resp3.Body)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Printf(\"%q\\n\", bytes3)\n    country := string(bytes.TrimRight(bytes3, \"\\n\"))\n    fmt.Printf(\"%q\\n\", country)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>\"US\\n\"\n\"US\"\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 9685700, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "joske123", "link": "https://stackoverflow.com/users/9685700/joske123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1547133546, "creation_date": 1547042961, "last_edit_date": 1547043725, "question_id": 54112034, "link": "https://stackoverflow.com/questions/54112034/show-variable-image-in-go-templates", "title": "Show variable image in Go templates", "body": "<p>I'm using a template in a Go web application which should show an image depending on which country the visitor is from.</p>\n\n<p>For the images I use the FileServer</p>\n\n<pre><code>http.Handle(\"/images/\", http.StripPrefix(\"/images/\", http.FileServer(http.Dir(\"images\"))))\n</code></pre>\n\n<p>In the template the variable country is passed so the application knows which flag to show.</p>\n\n<pre><code>&lt;img id='flag' src='images/{{ .Country}}.png'&gt;\n</code></pre>\n\n<p>However, for some reason the string I pass adds %0a which causes the src of the img to be wrong. </p>\n\n<pre><code>&lt;img id='flag' src='images/BE%0A.png'&gt;\n</code></pre>\n\n<p>The expected output should be </p>\n\n<pre><code>&lt;img id='flag' src='images/BE.png'&gt;\n</code></pre>\n\n<p>The following code is used to grab the country string</p>\n\n<pre><code>resp3, err := http.Get(\"https://ipinfo.io/country\")\nif err != nil {\n    fmt.Println(err)\n}\nbytes3, _ := ioutil.ReadAll(resp3.Body)\ncountry := string(bytes3)\n</code></pre>\n\n<p>Could anyone help me resolve this issue?</p>\n"}, {"tags": ["go", "aws-lambda", "connection-pooling"], "comments": [{"owner": {"reputation": 1030, "user_id": 9959748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Z5r3.jpg?s=128&g=1", "display_name": "celicoo", "link": "https://stackoverflow.com/users/9959748/celicoo"}, "edited": false, "score": 0, "creation_date": 1547039860, "post_id": 54110697, "comment_id": 95054223, "body": "What ORM are you using?"}, {"owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "edited": false, "score": 0, "creation_date": 1547040220, "post_id": 54110697, "comment_id": 95054476, "body": "Please share the code of your Lambda."}, {"owner": {"reputation": 3315, "user_id": 1664109, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/JAlH9.jpg?s=128&g=1", "display_name": "RockOnGom", "link": "https://stackoverflow.com/users/1664109/rockongom"}, "edited": false, "score": 0, "creation_date": 1547132009, "post_id": 54110697, "comment_id": 95093772, "body": "you should share mysql max connection settings too,"}], "answers": [{"comments": [{"owner": {"reputation": 969, "user_id": 1831452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37747b2425c48e6d8b57fda11257f68?s=128&d=identicon&r=PG", "display_name": "nguyenhoai890", "link": "https://stackoverflow.com/users/1831452/nguyenhoai890"}, "edited": false, "score": 0, "creation_date": 1547047025, "post_id": 54111909, "comment_id": 95058815, "body": "Thanks for very detail answer. But you missed the most important note in lambda doc is &quot; When you write your Lambda function code, do not assume that AWS Lambda automatically reuses the execution context for subsequent function invocations&quot;. Which means if you dont close your connection well, it will cause to my problems since the lambda will create new instance with new connection when needed without close the old."}, {"owner": {"reputation": 1030, "user_id": 9959748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Z5r3.jpg?s=128&g=1", "display_name": "celicoo", "link": "https://stackoverflow.com/users/9959748/celicoo"}, "reply_to_user": {"reputation": 969, "user_id": 1831452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37747b2425c48e6d8b57fda11257f68?s=128&d=identicon&r=PG", "display_name": "nguyenhoai890", "link": "https://stackoverflow.com/users/1831452/nguyenhoai890"}, "edited": false, "score": 1, "creation_date": 1547047368, "post_id": 54111909, "comment_id": 95059029, "body": "That is not important really, you should only keep in mind that the connection will be automatically closed when a container shuts down."}, {"owner": {"reputation": 969, "user_id": 1831452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37747b2425c48e6d8b57fda11257f68?s=128&d=identicon&r=PG", "display_name": "nguyenhoai890", "link": "https://stackoverflow.com/users/1831452/nguyenhoai890"}, "edited": false, "score": 0, "creation_date": 1547048772, "post_id": 54111909, "comment_id": 95059927, "body": "sadly, it take 28,800 seconds, by default,  to automatically close. Means ur mysql will hold many useless connections which are highly potential shup yuor service down."}, {"owner": {"reputation": 1030, "user_id": 9959748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Z5r3.jpg?s=128&g=1", "display_name": "celicoo", "link": "https://stackoverflow.com/users/9959748/celicoo"}, "reply_to_user": {"reputation": 969, "user_id": 1831452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37747b2425c48e6d8b57fda11257f68?s=128&d=identicon&r=PG", "display_name": "nguyenhoai890", "link": "https://stackoverflow.com/users/1831452/nguyenhoai890"}, "edited": false, "score": 0, "creation_date": 1547048990, "post_id": 54111909, "comment_id": 95060063, "body": "There is a difference between closing the request and closing the container. If you still see <code>too many connections</code> you need your own MySQL Proxy or use AWS Aurora instead."}, {"owner": {"reputation": 1030, "user_id": 9959748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Z5r3.jpg?s=128&g=1", "display_name": "celicoo", "link": "https://stackoverflow.com/users/9959748/celicoo"}, "reply_to_user": {"reputation": 969, "user_id": 1831452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37747b2425c48e6d8b57fda11257f68?s=128&d=identicon&r=PG", "display_name": "nguyenhoai890", "link": "https://stackoverflow.com/users/1831452/nguyenhoai890"}, "edited": false, "score": 0, "creation_date": 1547168510, "post_id": 54111909, "comment_id": 95109574, "body": "@nguyenhoai890 was I helpful?"}, {"owner": {"reputation": 969, "user_id": 1831452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37747b2425c48e6d8b57fda11257f68?s=128&d=identicon&r=PG", "display_name": "nguyenhoai890", "link": "https://stackoverflow.com/users/1831452/nguyenhoai890"}, "edited": false, "score": 0, "creation_date": 1547219598, "post_id": 54111909, "comment_id": 95129439, "body": "Thank you very much for your hel, I learnt somethings new from ur answer. But it doesn&#39;t resolve my problem."}, {"owner": {"reputation": 1030, "user_id": 9959748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Z5r3.jpg?s=128&g=1", "display_name": "celicoo", "link": "https://stackoverflow.com/users/9959748/celicoo"}, "reply_to_user": {"reputation": 969, "user_id": 1831452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37747b2425c48e6d8b57fda11257f68?s=128&d=identicon&r=PG", "display_name": "nguyenhoai890", "link": "https://stackoverflow.com/users/1831452/nguyenhoai890"}, "edited": false, "score": 0, "creation_date": 1547220077, "post_id": 54111909, "comment_id": 95129711, "body": "@nguyenhoai890 Are you still seeing <code>too many connections</code>? Did you create the MySQL Proxy?"}], "tags": [], "owner": {"reputation": 1030, "user_id": 9959748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Z5r3.jpg?s=128&g=1", "display_name": "celicoo", "link": "https://stackoverflow.com/users/9959748/celicoo"}, "is_accepted": true, "score": 12, "last_activity_date": 1547046822, "last_edit_date": 1547046822, "creation_date": 1547042537, "answer_id": 54111909, "question_id": 54110697, "link": "https://stackoverflow.com/questions/54110697/sql-db-on-aws-lambda-too-many-connection/54111909#54111909", "title": "sql.DB on aws-lambda too many connection", "body": "<p>There are two problems that we need to address</p>\n\n<ul>\n<li>Correctly managing state between lambda invocations</li>\n<li>Configuring a connection pool</li>\n</ul>\n\n<h1>Correctly managing state</h1>\n\n<p>Let us understand a bit of how the container is managed by AWS. From the <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/running-lambda-code.html\" rel=\"noreferrer\">AWS docs</a>:</p>\n\n<blockquote>\n  <p>After a Lambda function is executed, AWS Lambda maintains the\n  execution context for some time in anticipation of another Lambda\n  function invocation. In effect, the service freezes the execution\n  context after a Lambda function completes, and thaws the context for\n  reuse, if AWS Lambda chooses to reuse the context when the Lambda\n  function is invoked again.\n  This execution context reuse approach has the following implications:</p>\n  \n  <ul>\n  <li><p>Any declarations in your Lambda function code (outside the handler\n  code, see Programming Model) remains initialized, providing additional\n  optimization when the function is invoked again. For example, if your\n  Lambda function establishes a database connection, instead of\n  reestablishing the connection, the original connection is used in\n  subsequent invocations. We suggest adding logic in your code to check\n  if a connection exists before creating one.</p></li>\n  <li><p>Each execution context provides 500MB of additional disk space in the\n  /tmp directory. The directory content remains when the execution\n  context is frozen, providing transient cache that can be used for\n  multiple invocations. You can add extra code to check if the cache has\n  the data that you stored. For information on deployment limits, see\n  AWS Lambda Limits.</p></li>\n  <li><p>Background processes or callbacks initiated by your Lambda function\n  that did not complete when the function ended resume if AWS Lambda\n  chooses to reuse the execution context. You should make sure any\n  background processes or callbacks (in case of Node.js) in your code\n  are complete before the code exits.</p></li>\n  </ul>\n</blockquote>\n\n<p>This first bullet point says that state is maintained between executions. Let us see this in action:</p>\n\n<pre><code>let counter = 0\n\nmodule.exports.handler = (event, context, callback) =&gt; {\n  counter++\n  callback(null, { count: counter })\n}\n</code></pre>\n\n<p>If you deploy this and call multiple times <strong>consecutively</strong> you will see that the counter will be incremented between calls.</p>\n\n<p>Now that you know that - you should not call <code>defer db.Close()</code>, instead you should be <strong>reusing</strong> the database instance. You can do that by simply making <code>db</code> a package level variable.</p>\n\n<p>First, create a database package that will export an <code>Open</code> function:</p>\n\n<pre><code>package database\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n    \"github.com/jinzhu/gorm\"\n)\n\nvar (\n    host = os.Getenv(\"DB_HOST\")\n    port = os.Getenv(\"DB_PORT\")\n    user = os.Getenv(\"DB_USER\")\n    name = os.Getenv(\"DB_NAME\")\n    pass = os.Getenv(\"DB_PASS\")\n)\n\nfunc Open() (db *gorm.DB) {\n    args := fmt.Sprintf(\"%s:%s@tcp(%s:%s)/%s?parseTime=true\", user, pass, host, port, name)\n    // Initialize a new db connection.\n    db, err := gorm.Open(\"mysql\", args)\n    if err != nil {\n        panic(err)\n    }\n    return\n}\n</code></pre>\n\n<p>Then use it on your handler.go file:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n    \"github.com/jinzhu/gorm\"\n    \"github.com/&lt;username&gt;/&lt;name-of-lib&gt;/database\"\n)\n\nvar db *gorm.DB\n\nfunc init() {\n    db = database.Open()\n}\n\nfunc Handler() (events.APIGatewayProxyResponse, error) {\n    // You can use db here.\n    return events.APIGatewayProxyResponse{\n        StatusCode: 201,\n    }, nil\n}\n\nfunc main() {\n    lambda.Start(Handler)\n}\n</code></pre>\n\n<p><strong>OBS</strong>: don't forget to replace <code>github.com/&lt;username&gt;/&lt;name-of-lib&gt;/database</code> with the right path.</p>\n\n<p>Now, you might still see the <code>too many connections</code> error. If that happens you will need a connection pool.</p>\n\n<h1>Configuring a connection pool</h1>\n\n<p>From <a href=\"https://en.wikipedia.org/wiki/Connection_pool\" rel=\"noreferrer\">Wikipedia</a>:</p>\n\n<blockquote>\n  <p>In software engineering, a connection pool is a cache of database\n  connections maintained so that the connections can be reused when\n  future requests to the database are required. Connection pools are\n  used to enhance the performance of executing commands on a database.</p>\n</blockquote>\n\n<p>You will need a connection pool that the number of allowed connections must be equal to the number of parallel lambdas running, you have two choices:</p>\n\n<ul>\n<li>MySQL Proxy</li>\n</ul>\n\n<blockquote>\n  <p>MySQL Proxy is a simple program that sits between your client and\n  MySQL server(s) and that can monitor, analyze or transform their\n  communication. Its flexibility allows for a wide variety of uses,\n  including load balancing, failover, query analysis, query filtering\n  and modification, and many more.</p>\n</blockquote>\n\n<ul>\n<li>AWS Aurora:</li>\n</ul>\n\n<blockquote>\n  <p>Amazon Aurora Serverless is an on-demand, auto-scaling configuration\n  for Amazon Aurora (MySQL-compatible edition), where the database will\n  automatically start up, shut down, and scale capacity up or down based\n  on your application's needs. It enables you to run your database in\n  the cloud without managing any database instances. It's a simple,\n  cost-effective option for infrequent, intermittent, or unpredictable\n  workloads.</p>\n</blockquote>\n\n<p>Regardless of your choice, there are plenty of tutorials on the internet on how to configure both.</p>\n"}], "owner": {"reputation": 969, "user_id": 1831452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37747b2425c48e6d8b57fda11257f68?s=128&d=identicon&r=PG", "display_name": "nguyenhoai890", "link": "https://stackoverflow.com/users/1831452/nguyenhoai890"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3041, "favorite_count": 0, "accepted_answer_id": 54111909, "answer_count": 1, "score": 5, "last_activity_date": 1547046822, "creation_date": 1547038633, "question_id": 54110697, "link": "https://stackoverflow.com/questions/54110697/sql-db-on-aws-lambda-too-many-connection", "title": "sql.DB on aws-lambda too many connection", "body": "<p>As I understand in Golang: <code>the DB handle is meant to be long-lived and shared between many goroutines</code>. </p>\n\n<p>But when I using Golang with AWS lambda, it's a very different story since lambdas are stopping the function when it's finished.</p>\n\n<p>I am using:<code>defer db.Close()</code> in Lambda Invoke function but it isn't affect. On MySQL, it's still keep that connection as <code>Sleep query</code>. As a result, it causes <code>too many connections</code> on MySQL.</p>\n\n<p>Currently, I have to set <code>wait_timeout</code> in MySQL to small number. But it's not the best solution, in my opinion. </p>\n\n<p>Is there any way to close connection when using Go SQL driver with Lambda?</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["xml", "go", "marshalling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1547024070, "post_id": 54106250, "comment_id": 95044792, "body": "<a href=\"https://play.golang.com/p/nIqXct02O5W\" rel=\"nofollow noreferrer\">play.golang.com/p/nIqXct02O5W</a>"}, {"owner": {"reputation": 13244, "user_id": 317915, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/86d01c87cc6f22c8445661b72b6b0d78?s=128&d=identicon&r=PG", "display_name": "topskip", "link": "https://stackoverflow.com/users/317915/topskip"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1547024357, "post_id": 54106250, "comment_id": 95044949, "body": "@mkopriva Thanks! I wonder if there is a way to use some operators in the <code>xml:&quot;...&quot;</code> tag, without using a nested struct."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1547025813, "post_id": 54106250, "comment_id": 95045750, "body": "AFAIK there isn&#39;t any way to move the attribute to a sibling field. The attribute field should be a field of the struct type whose resulting xml should have the xml attribute."}], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 10877950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4343e50406d24e6a02bd9c2a659972ac?s=128&d=identicon&r=PG&f=1", "display_name": "JieErLiu", "link": "https://stackoverflow.com/users/10877950/jieerliu"}, "is_accepted": true, "score": 2, "last_activity_date": 1547028594, "creation_date": 1547028594, "answer_id": 54107646, "question_id": 54106250, "link": "https://stackoverflow.com/questions/54106250/xml-encoding-mix-attributes-and-elements/54107646#54107646", "title": "XML encoding: mix attributes and elements", "body": "<p>You may define your struct like:</p>\n\n<pre><code>type foo struct {\n    XMLName xml.Name `xml:\"root\"`\n    Element struct{\n        xml.Name `xml:\"element\"`\n        Abc     string   `xml:\"abc,attr\"`\n    }  \n}\n</code></pre>\n"}], "owner": {"reputation": 13244, "user_id": 317915, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/86d01c87cc6f22c8445661b72b6b0d78?s=128&d=identicon&r=PG", "display_name": "topskip", "link": "https://stackoverflow.com/users/317915/topskip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 54107646, "answer_count": 1, "score": 0, "last_activity_date": 1547028594, "creation_date": 1547023956, "question_id": 54106250, "link": "https://stackoverflow.com/questions/54106250/xml-encoding-mix-attributes-and-elements", "title": "XML encoding: mix attributes and elements", "body": "<p>I have a question regarding marshalling Go XML: I get this:</p>\n\n<pre><code>&lt;root abc=\"\"&gt;\n  &lt;element&gt;&lt;/element&gt;\n&lt;/root&gt;\n</code></pre>\n\n<p>but I'd like this:</p>\n\n<pre><code>&lt;root&gt;\n  &lt;element abc=\"\"&gt;&lt;/element&gt;\n&lt;/root&gt;\n</code></pre>\n\n<p>(the attribute <code>abc</code> is at the child element).</p>\n\n<p>Is this (easily) possible?</p>\n\n<p>My code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"os\"\n)\n\ntype foo struct {\n    XMLName xml.Name `xml:\"root\"`\n    Abc     string   `xml:\"abc,attr\"`\n    Element string   `xml:\"element\"`\n}\n\nfunc main() {\n    f := foo{}\n    a, err := xml.MarshalIndent(f, \"\", \"  \")\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(0)\n    }\n    fmt.Println(string(a))\n}\n</code></pre>\n"}, {"tags": ["html", "templates", "go", "go-templates"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1547025249, "post_id": 54104020, "comment_id": 95045440, "body": "You need to parse all of the files of the templates that you want to use. <a href=\"https://github.com/ulfahputribisba/Go-HTML-Template/blob/master/server.go#L32-L34\" rel=\"nofollow noreferrer\">Here</a> you&#39;re only parsing <code>base</code> and <code>index</code> or <code>about</code> depending on the argument, therefore only the <code>base</code> and <code>index</code>/<code>about</code> templates are available for execution."}], "answers": [{"tags": [], "owner": {"reputation": 34, "user_id": 9807398, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "jwatts", "link": "https://stackoverflow.com/users/9807398/jwatts"}, "is_accepted": true, "score": 1, "last_activity_date": 1547044277, "last_edit_date": 1547044277, "creation_date": 1547043900, "answer_id": 54112278, "question_id": 54104020, "link": "https://stackoverflow.com/questions/54104020/no-such-template-xxx-in-golang-html-web-apps/54112278#54112278", "title": "No such template &quot;xxx&quot; in Golang HTML Web Apps", "body": "<p>Not an expert in HTML WEB but </p>\n\n<p>Your slice is not created properly and does not have templates(footer,sidebar and header) as elements.\nwhen i try to print tmpl_list, i see below result.</p>\n\n<pre><code>[templates/base.html templates/index.html]\n</code></pre>\n\n<p>and if you create tmpl_list as below, it should work. (just a workaround for the time being)\nYou need to see the part where you are creating the slice tmpl_list.</p>\n\n<pre><code>tmpl_list := []string{\"templates/base.html\", \"templates/about.html\", \"templates/footer.html\", \"templates/header.html\", \"templates/sidebar.html\"}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 8355489, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7U5S_HHd6d0/AAAAAAAAAAI/AAAAAAAAAQU/JifSTvVGhMg/photo.jpg?sz=128", "display_name": "Ulfah Putri", "link": "https://stackoverflow.com/users/8355489/ulfah-putri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1382, "favorite_count": 0, "accepted_answer_id": 54112278, "answer_count": 1, "score": -2, "last_activity_date": 1547060601, "creation_date": 1547013455, "last_edit_date": 1547060601, "question_id": 54104020, "link": "https://stackoverflow.com/questions/54104020/no-such-template-xxx-in-golang-html-web-apps", "title": "No such template &quot;xxx&quot; in Golang HTML Web Apps", "body": "<p>I'm learning about embedding HTML in Go. Then I get this message when I run the server.go</p>\n\n<blockquote>\n  <p>template executing error: html/template:base.html:30:25: no such template \"Sidebar\"</p>\n</blockquote>\n\n<p>Here's my code <a href=\"https://github.com/ulfahputribisba/Go-HTML-Template.git\" rel=\"nofollow noreferrer\">Go-HTML-Template</a></p>\n\n<pre><code>//server.go    \npackage main\n\nimport (\n    \"fmt\"\n    \"html/template\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\nconst STATIC_URL string = \"/assets/\"\nconst STATIC_ROOT string = \"assets/\"\n\ntype Context struct {\n    Title  string\n    Static string\n}\n\nfunc Home(w http.ResponseWriter, req *http.Request) {\n    context := Context{Title: \"Welcome!\"}\n    render(w, \"index\", context)\n}\n\nfunc About(w http.ResponseWriter, req *http.Request) {\n    context := Context{Title: \"About\"}\n    render(w, \"about\", context)\n}\n\nfunc render(w http.ResponseWriter, tmpl string, context Context) {\n    context.Static = STATIC_URL\n    tmpl_list := []string{\"templates/base.html\",\n        fmt.Sprintf(\"templates/%s.html\", tmpl)}\n    t, err := template.ParseFiles(tmpl_list...)\n    if err != nil {\n        log.Print(\"template parsing error: \", err)\n    }\n    err = t.Execute(w, context)\n    if err != nil {\n        log.Print(\"template executing error: \", err)\n    }\n}\n\nfunc StaticHandler(w http.ResponseWriter, req *http.Request) {\n    static_file := req.URL.Path[len(STATIC_URL):]\n    if len(static_file) != 0 {\n        f, err := http.Dir(STATIC_ROOT).Open(static_file)\n        if err == nil {\n            content := io.ReadSeeker(f)\n            http.ServeContent(w, req, static_file, time.Now(), content)\n            return\n        }\n    }\n    http.NotFound(w, req)\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", Home)\n    http.HandleFunc(\"/about/\", About)\n    http.HandleFunc(STATIC_URL, StaticHandler)\n    err := http.ListenAndServe(\":8080\", nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n\n<p>I've made the sidebar.html template and included it in base.html like I includes index.html.  I follow this tutorial <a href=\"https://reinbach.com/blog/golang-webapps-1/\" rel=\"nofollow noreferrer\">Golang Web Apps</a> for this learning.  Not only sidebar, I can't include header and footer too</p>\n\n<pre><code>&lt;!--base.html--&gt;\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n    &lt;head&gt;\n        &lt;meta charset=\"utf-8\"&gt;\n        &lt;title&gt;CELERATES UNIVERSITY&lt;/title&gt;\n\n        &lt;!-- Favicon     --&gt;\n        &lt;link rel=\"icon\" type=\"image/png\" href=\"{{ .Static }}img/favicon2.ico\"&gt;\n\n        &lt;!-- Bootstrap core CSS     --&gt;\n        &lt;link rel=\"stylesheet\" href=\"{{ .Static }}css/bootstrap.min.css\" type=\"text/css\"&gt;\n\n        &lt;!-- Animation library for notifications   --&gt;\n        &lt;link href=\"{{ .Static }}css/animate.min.css\" rel=\"stylesheet\"/&gt;\n\n        &lt;!--  Light Bootstrap Table core CSS    --&gt;\n        &lt;link href=\"{{ .Static }}css/light-bootstrap-dashboard.css\" rel=\"stylesheet\"/&gt;\n\n        &lt;!--     Fonts and icons     --&gt;\n        &lt;link href=\"http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css\" rel=\"stylesheet\"&gt;\n        &lt;link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'&gt;\n        &lt;link href=\"{{ .Static }}css/pe-icon-7-stroke.css\" rel=\"stylesheet\" /&gt;\n\n        &lt;!--     Datatables     --&gt;\n        &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"http://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css\"/&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;div class=\"wrapper\"&gt;\n            &lt;!--SIDEBAR--&gt;\n            {{  template \"Sidebar\" . }}\n            &lt;div class=\"main-panel\"&gt;\n                &lt;!--HEADER--&gt;\n                {{  template \"Header\" . }}\n                &lt;!--CONTENT--&gt;\n                &lt;div class=\"content\"&gt;\n                    &lt;div class=\"container-fluid\" align=\"center\"&gt;\n                        &lt;div class=\"row\"&gt;\n                            &lt;div class=\"col-lg-12 col-md-12 col-sm-12 col-xs-12\"&gt;\n                            {{ template \"content\" . }}\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n                &lt;!--FOOTER--&gt;\n                {{  template \"Footer\" . }}\n            &lt;/div&gt;\n        &lt;/div&gt;\n\n\n        &lt;!--   JAVASCRIPTS   --&gt;\n        &lt;!--   Core JS Files   --&gt;\n    &lt;script src=\"https://code.jquery.com/jquery-3.3.1.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\n    &lt;script src=\"{{ .Static }}js/bootstrap.min.js\" type=\"text/javascript\"&gt;&lt;/script&gt; \n\n    &lt;!-- Datatables --&gt;\n    &lt;script type=\"text/javascript\" src=\"http://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js\"&gt;&lt;/script&gt; \n    &lt;script type=\"text/javascript\"&gt;\n        $(document).ready(function() {\n            $(\"#example\").DataTable();\n        } );\n    &lt;/script&gt;\n\n    &lt;!--  Checkbox, Radio &amp; Switch Plugins --&gt;\n    &lt;script src=\"{{ .Static }}js/bootstrap-checkbox-radio-switch.js\"&gt;&lt;/script&gt;\n\n    &lt;!--  Charts Plugin --&gt;\n    &lt;script src=\"{{ .Static }}js/chartist.min.js\"&gt;&lt;/script&gt;\n\n    &lt;!--  Notifications Plugin    --&gt;\n    &lt;script src=\"{{ .Static }}js/bootstrap-notify.js\"&gt;&lt;/script&gt;\n\n    &lt;!--  Google Maps Plugin    --&gt;\n    &lt;script src=\"https://maps.googleapis.com/maps/api/js?sensor=false\"&gt;&lt;/script&gt;\n\n    &lt;!-- Light Bootstrap Table Core javascript and methods for Demo purpose --&gt;\n    &lt;script src=\"{{ .Static }}js/light-bootstrap-dashboard.js\"&gt;&lt;/script&gt;\n    &lt;/body&gt;\n</code></pre>\n\n<h2>    </h2>\n\n<pre><code>{{ define \"Sidebar\" }}\n&lt;!--sidebar.html--&gt;\n    &lt;div class=\"sidebar\" data-color=\"blue\" data-image=\"{{ .Static }}img/sidebar-4.jpg\"&gt;\n        &lt;div class=\"sidebar-wrapper\"&gt;\n            &lt;div class=\"logo\"&gt;\n                &lt;a href=\"/\" class=\"simple-text\"&gt;\n                    Celerates University\n                &lt;/a&gt;\n            &lt;/div&gt;\n\n            &lt;ul class=\"nav\"&gt;\n                &lt;li&gt;\n                    &lt;a href=\"/\"&gt;\n                        &lt;i class=\"pe-7s-graph\"&gt;&lt;/i&gt;\n                        &lt;p&gt;Dashboard&lt;/p&gt;\n                    &lt;/a&gt;\n                &lt;/li&gt;\n                &lt;li&gt;\n                    &lt;a href=\"/\"&gt;\n                        &lt;i class=\"pe-7s-user\"&gt;&lt;/i&gt;\n                        &lt;p&gt;Admin List&lt;/p&gt;\n                    &lt;/a&gt;\n                &lt;/li&gt;\n                &lt;li&gt;\n                    &lt;a href=\"/\"&gt;\n                        &lt;i class=\"pe-7s-note2\"&gt;&lt;/i&gt;\n                        &lt;p&gt;Student List&lt;/p&gt;\n                    &lt;/a&gt;\n                &lt;/li&gt;\n            &lt;/ul&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n{{ end }}\n</code></pre>\n\n<p>That I write the sidebar template correctly?</p>\n\n<p>Any help would be much appreciated. Thanks.</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 10887342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e351fe7d89bb301a196c5ffc16815082?s=128&d=identicon&r=PG&f=1", "display_name": "botob", "link": "https://stackoverflow.com/users/10887342/botob"}, "edited": false, "score": 0, "creation_date": 1547278777, "post_id": 54104148, "comment_id": 95145591, "body": "wow! very thank you!! Do you mean &quot;var sa * [2] C.sample&quot; or can it be dynamic?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 81, "user_id": 10887342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e351fe7d89bb301a196c5ffc16815082?s=128&d=identicon&r=PG&f=1", "display_name": "botob", "link": "https://stackoverflow.com/users/10887342/botob"}, "edited": false, "score": 0, "creation_date": 1547344848, "post_id": 54104148, "comment_id": 95160613, "body": "@botob: See my revised answer: <code>var sa []C.sample</code>."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1547748229, "last_edit_date": 1547748229, "creation_date": 1547014224, "answer_id": 54104148, "question_id": 54103199, "link": "https://stackoverflow.com/questions/54103199/how-to-access-global-variable-in-cgo/54104148#54104148", "title": "How to access global variable in cgo?", "body": "<p>For example,</p>\n\n<p><code>sample.go</code>:</p>\n\n<pre><code>package main\n\n/*\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\ntypedef struct\n{\n    int   num;\n    char  food[10];\n    char  animal[128];\n} sample;\n\nsample *sa = NULL;\nint sn = 0;\n\nstatic void alloc() {\n    sn = 2;\n    sa = (sample *) malloc (sizeof(sample) * sn);\n    memset(sa, 0, sizeof(sample) * sn);\n\n    sa[0].num = 10;\n    strcpy(sa[0].food, \"noodle\");\n    strcpy(sa[0].animal, \"cat\");\n\n    sa[1].num = 20;\n    strcpy(sa[1].food, \"pizza\");\n    strcpy(sa[1].animal, \"dog\");\n}\n*/\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nvar sa []C.sample\n\nfunc init() {\n    C.alloc()\n    sa = (*[1 &lt;&lt; 30 / unsafe.Sizeof(C.sample{})]C.sample)(unsafe.Pointer(C.sa))[:C.sn:C.sn]\n}\n\nfunc CToGoString(c []C.char) string {\n    n := -1\n    for i, b := range c {\n        if b == 0 {\n            break\n        }\n        n = i\n    }\n    return string((*(*[]byte)(unsafe.Pointer(&amp;c)))[:n+1])\n}\n\nfunc main() {\n    for i := range sa {\n        fmt.Println(sa[i].num)\n        fmt.Println(CToGoString(sa[i].food[:]))\n        fmt.Println(CToGoString(sa[i].animal[:]))\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run sample.go\n10\nnoodle\ncat\n20\npizza\ndog\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 10887342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e351fe7d89bb301a196c5ffc16815082?s=128&d=identicon&r=PG&f=1", "display_name": "botob", "link": "https://stackoverflow.com/users/10887342/botob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 488, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1547748229, "creation_date": 1547007746, "question_id": 54103199, "link": "https://stackoverflow.com/questions/54103199/how-to-access-global-variable-in-cgo", "title": "How to access global variable in cgo?", "body": "<p>The memory of the structure is already allocated.</p>\n\n<p>I would like to approach C struct in golang.</p>\n\n<p>I want to access a struct variable in golang without the c code, what should I do?</p>\n\n<pre><code>package main\n\n/*\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\ntypedef struct \n{\n        int   num;\n        char  food[10];\n        char  animal[128];\n} sample;\n\nsample *sa;\n\nstatic void alloc() {\n        sa = (sample *) malloc (sizeof(sample) * 2);\n        memset(sa, 0, sizeof(sample) * 2);\n\n        sa[0].num = 10;\n        strcpy(sa[0].food, \"noodle\");\n        strcpy(sa[0].animal, \"cat\");\n\n    sa[1].num = 20;\n    strcpy(sa[1].food, \"pizza\");\n    strcpy(sa[1].animal, \"dog\");\n}\n\n*/\nimport \"C\"\n\nimport \"fmt\"\n\nfunc init() {\n        C.alloc()\n}\nfunc main() {\n        fmt.Println(C.sa[0].num)\n        fmt.Println(C.sa[0].food)\n        fmt.Println(C.sa[0].animal)\n\n        fmt.Println(C.sa[1].num)\n        fmt.Println(C.sa[1].food)\n        fmt.Println(C.sa[1].animal)\n}\n</code></pre>\n\n<p>I have written this example.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 468, "user_id": 5226812, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/mFc1D.jpg?s=128&g=1", "display_name": "Evgeny Lukiyanov", "link": "https://stackoverflow.com/users/5226812/evgeny-lukiyanov"}, "edited": false, "score": 0, "creation_date": 1611245232, "post_id": 54103012, "comment_id": 116394382, "body": "Hey that URL no longer working, you still got the code?"}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1547007538, "post_id": 54103115, "comment_id": 95038904, "body": "Yeah I have no idea what the datatype they enter will be, unless i had them confirm which data type... such as &#39;/dog/Zeus/string&#39;... Do you have an example of what you mean?"}, {"owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "reply_to_user": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1547007857, "post_id": 54103115, "comment_id": 95038976, "body": "APIs are like contracts. I believe it would be better to define the url fields and their types in advance so as to avoid wonders tomorrow. For example if say ID param is string today and you have a DB column of type string modelled on it and tomorrow if somebody changes it to int since there is no contract, then your app would start crashing when comparing it to string DB field."}, {"owner": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1547008130, "post_id": 54103115, "comment_id": 95039052, "body": "Okay, so a struct with a value for each type would be a viable option? Then when the URL is entered... /key/value/datatype... it would check the datatype entered and amend to the struct accordingly?"}, {"owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "reply_to_user": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1547008350, "post_id": 54103115, "comment_id": 95039103, "body": "the following line gets the url params as a map:      <code>request.URL.Query()</code>  and then schema&#39;s decoder object&#39;s struct method would try to decode to expected struct and err if there is any mismatch of type."}], "tags": [], "owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "is_accepted": false, "score": 0, "last_activity_date": 1547008612, "last_edit_date": 1547008612, "creation_date": 1547006856, "answer_id": 54103115, "question_id": 54103012, "link": "https://stackoverflow.com/questions/54103012/creating-a-map-with-type-interface-to-accept-arbitrary-data-types-via-url-params/54103115#54103115", "title": "Creating a map with type interface to accept arbitrary data types via URL params", "body": "<p>Check out this package which converts the URL params to struct with expected fields.This is useful, ofcourse when you know the expected data types.</p>\n\n<p><a href=\"https://github.com/gorilla/schema\" rel=\"nofollow noreferrer\">https://github.com/gorilla/schema</a></p>\n\n<p>e.g </p>\n\n<pre><code>type ServiceInput struct {\n  Latitude                 float64  `schema:\"latitude,required\"` //add validations too\n  Longitude                 float64  `schema:\"longitude\"`\n}\n</code></pre>\n\n<p>...</p>\n\n<pre><code>r := new(ServiceInput)\nurlParams := request.URL.Query() //request is http.Request\n\ndecoder := schema.NewDecoder()\nif err := decoder.Decode(r, urlParams); err != nil {\n    return nil, lib.ErrBadRequest{Err: err}\n}\n</code></pre>\n\n<p>Now assuming request as GET /foo/bar?latitude=1.2&amp;longitude=3.4, it will accordingly set the struct fields.</p>\n\n<p>If you don't have any clue about field's type, then you have to try parsing to different type and check.</p>\n"}, {"comments": [{"owner": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1547020251, "post_id": 54103709, "comment_id": 95042953, "body": "Hm, this looks like something that could work. Do you have time to give me more of an explanation as to what the ParseGenericValue func is doing?"}, {"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "reply_to_user": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1547020663, "post_id": 54103709, "comment_id": 95043157, "body": "sure, added some explanation"}, {"owner": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1547020738, "post_id": 54103709, "comment_id": 95043190, "body": "Sorry you updated. I&#39;m getting undefined errors for IntegerOK, BooleanOK etc. Do i need to set those to type bool?"}, {"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "reply_to_user": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1547020908, "post_id": 54103709, "comment_id": 95043264, "body": "it&#39;s a struct. I missed the keyword."}, {"owner": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1547021135, "post_id": 54103709, "comment_id": 95043373, "body": "Yeah, I made them type boolean and all is working. You sir, are a legend"}], "tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": true, "score": 1, "last_activity_date": 1547021251, "last_edit_date": 1547021251, "creation_date": 1547011578, "answer_id": 54103709, "question_id": 54103012, "link": "https://stackoverflow.com/questions/54103012/creating-a-map-with-type-interface-to-accept-arbitrary-data-types-via-url-params/54103709#54103709", "title": "Creating a map with type interface to accept arbitrary data types via URL params", "body": "<blockquote>\n  <p>I have tried type assertion, however, I don't believe in my case this will work as the data is coming from the URL which by default is already a string. How do I detect whether the entry is a string, int, boolean etc?</p>\n</blockquote>\n\n<p>In general it's not a very good idea to make things overly dynamic (makes reasoning about things more complicated than it needs to be). Better to define a struct and then read values into it.</p>\n\n<p>That said, if we stick to the wording of your question, there are things you can do:</p>\n\n<p>For example, create a generic type that can store multiple versions of a value, along with a flag to indicate whether it correctly parsed into that type:</p>\n\n<pre><code>type GenericValue struct {\n    String string\n\n    Integer int\n    IntegerOK bool\n\n    Float float64\n    FloatOK bool\n\n    Boolean bool\n    BooleanOK bool\n}\n\nfunc ParseGenericValue(v string) GenericValue {\n    var result GenericValue\n    var err error\n    result.String = v\n    result.Integer, err = strconv.Atoi(v)\n    result.IntegerOK = err == nil\n    result.Float, err = strconv.ParseFloat(v, 64)\n    result.FloatOK = err == nil\n    result.Boolean, err = strconv.ParseBool(v)\n    result.BooleanOK = err == nil\n    return result\n}\n</code></pre>\n\n<p>All this does is use the <a href=\"https://golang.org/pkg/strconv/\" rel=\"nofollow noreferrer\">strconv</a> package to try to parse the input string as an integer/float/boolean and if the parse is successful it makrs the corresponding <code>OK</code> field. For example, if <code>IntegerOK</code> is true then this indicates that parsing this string into an integer was successful.</p>\n\n<p>The <code>GenericValue</code> struct still holds the original input string, so you can use it to check if this value is an integer and do something with it, or check if it's a string and do something else</p>\n\n<pre><code>var v = ParseGenericValue(\"2\")\n\nif v.IntegerOK {\n    // do something with v.Integer\n} else {\n    // maybe just handle v.String in a different way\n}\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 54103709, "answer_count": 2, "score": 0, "last_activity_date": 1547021251, "creation_date": 1547006015, "question_id": 54103012, "link": "https://stackoverflow.com/questions/54103012/creating-a-map-with-type-interface-to-accept-arbitrary-data-types-via-url-params", "title": "Creating a map with type interface to accept arbitrary data types via URL params", "body": "<p>I want to convert URL parameters from a string, to the correct data type and store it in a map. I believe the type should be []interface, to store a list of multiple data types. </p>\n\n<p>I am creating a key-value store, but at the moment, it only stores strings. I have read up on GOB to convert the data into bytes, but don't understand it.</p>\n\n<p>I have tried type assertion, however, I don't believe in my case this will work as the data is coming from the URL which by default is already a string. How do I detect whether the entry is a string, int, boolean etc?</p>\n\n<p>Map:</p>\n\n<pre><code>var data map[string][]string \n</code></pre>\n\n<p>handleFunc in the main func which calls the handleCreate func</p>\n\n<pre><code>r.HandleFunc(\"/insert/{key}/{value}\", handleCreate).Methods(\"POST\")  \n</code></pre>\n\n<p>handleFunc function</p>\n\n<pre><code>func handleCreate(w http.ResponseWriter, r *http.Request) {\nparams := mux.Vars(r)\n\nk := params[\"key\"]\nv := params[\"value\"]\n\ndata[k] = append(data[k], v)\nfmt.Fprintf(w, \"KEY: %v: VALUE: %v was inserted into the key-value store successfully\", k, v)\n}\n</code></pre>\n\n<p>A link to the full code: </p>\n\n<p><a href=\"https://github.com/RipRoss/TrainingProjects/blob/master/main.go\" rel=\"nofollow noreferrer\">https://github.com/RipRoss/TrainingProjects/blob/master/main.go</a></p>\n\n<p>The expected result is to store the value given in the URL as what it is intended for. For example /dog/Zeus would store Zeus as a string with key 'dog' and /cash/1000 would store 1000 as type int with key 'cash'</p>\n"}, {"tags": ["go", "data-structures", "struct"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1547018674, "post_id": 54102530, "comment_id": 95042253, "body": "What&#39;s wrong with the types you&#39;ve included in your question? What problem are you experiencing?"}, {"owner": {"reputation": 344, "user_id": 4179820, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VjMZ2.jpg?s=128&g=1", "display_name": "AKstat", "link": "https://stackoverflow.com/users/4179820/akstat"}, "edited": false, "score": 0, "creation_date": 1547021635, "post_id": 54102530, "comment_id": 95043592, "body": "Looks to me that <code>amp.preamptubes</code> and <code>amp.powertubes</code> are both correctly declared as type <code>tube</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1547047976, "post_id": 54102530, "comment_id": 95059425, "body": "&quot;it doesn&#39;t work the way I have it written&quot; - how so? What you&#39;ve described seems to be exactly what your code defines, so it&#39;s not clear what the problem is."}, {"owner": {"reputation": 5, "user_id": 1162588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84700ce87a6d318cac82f863239f774b?s=128&d=identicon&r=PG", "display_name": "Systemic", "link": "https://stackoverflow.com/users/1162588/systemic"}, "edited": false, "score": 0, "creation_date": 1547049856, "post_id": 54102530, "comment_id": 95060659, "body": "When I was working on the package last night, I was getting an error, which I should have included in the question. I recreated the package this morning, and it does appear the powertubes and preamptubes were both correctly declared. I suspect the problem was with how I instantiated an amp type in the main function."}], "answers": [{"tags": [], "owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "is_accepted": false, "score": 2, "last_activity_date": 1547001791, "creation_date": 1547001791, "answer_id": 54102581, "question_id": 54102530, "link": "https://stackoverflow.com/questions/54102530/how-to-nest-structures-in-go/54102581#54102581", "title": "How to nest structures in Go", "body": "<p>I may be misunderstanding, but are you asking for a nested slice of structs? To accomplish this, simply use <code>[]tube</code>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype tube struct {\n    model  string\n    number int8\n}\n\ntype amp struct {\n    name         string\n    model        string\n    manufacturer string\n    color        string\n    knobs        int8\n    switches     int8\n    jacks        int8\n    preamptubes  []tube\n    powertubes   []tube\n    ouputpower   int8\n    fxloop       bool\n}\n\nfunc main() {\n    v := amp{\n        name:        \"da amp\",\n        preamptubes: []tube{{model: \"A\"}},\n        powertubes:  []tube{{model: \"B\"}},\n    }\n\n    fmt.Printf(\"%+v\\n\", v)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/bPGHuEO40D0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bPGHuEO40D0</a></p>\n\n<p>Just a shot in the dark here, but you might also be running into <code>import</code> issues if your values exist in separate packages. Changing the first letter to an uppercase (ie, <code>Tube</code>, and <code>AMP</code> [see <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#initialisms\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/CodeReviewComments#initialisms</a>)) to access structs from different packages.</p>\n"}, {"tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 0, "last_activity_date": 1547009953, "creation_date": 1547009953, "answer_id": 54103487, "question_id": 54102530, "link": "https://stackoverflow.com/questions/54102530/how-to-nest-structures-in-go/54103487#54103487", "title": "How to nest structures in Go", "body": "<p>It's not clear what exactly are you trying to achieve (what's the context / large picture here?), but consider this:</p>\n\n<p>You can add another flag to the tube to designate its type, then have an array of types</p>\n\n<pre><code>type tubekind int\n\nconst (\n    preamptube tubekind = iota\n    powertube\n)\n\ntype tube struct {\n    model  string\n    number int8\n    kind tubekind\n}\n\ntype amp struct {\n    tubes        []tube\n    // ... other fields\n}\n</code></pre>\n\n<p>You can create a tube this way:</p>\n\n<pre><code>tube{\"model\", 1, powertube}\ntube{\"model2\", 2, preamptube}\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 1162588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84700ce87a6d318cac82f863239f774b?s=128&d=identicon&r=PG", "display_name": "Systemic", "link": "https://stackoverflow.com/users/1162588/systemic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1547072595, "creation_date": 1547001270, "last_edit_date": 1547050149, "question_id": 54102530, "link": "https://stackoverflow.com/questions/54102530/how-to-nest-structures-in-go", "title": "How to nest structures in Go", "body": "<p>I'm working on structs, methods, and interfaces in Go, and am writing some code to test the concepts. I'm stuck on the following concept in an example I'm creating - some amplifiers have preamp tubes and power tubes. I thought I could define them in the amp struct using a generic tube struct, but of course it doesn't work the way I have it written, and when I research nested structs, they don't seem to be the applicable concept. How do I structure this so that \"amp\" has \"preamptubes\" and \"powertubes\", and those are each type \"tube\"?</p>\n\n<pre><code>type tube struct {\n    model  string\n    number int8\n}\n\ntype amp struct {\n    name         string\n    model        string\n    manufacturer string\n    color        string\n    knobs        int8\n    switches     int8\n    jacks        int8\n    preamptubes  tube\n    powertubes   tube\n    ouputpower   int8\n    fxloop       bool\n}\n</code></pre>\n**Edit: Update:**\nI should have including the error I was getting in the question. I rewrote the package this morning, and the preamptubes and powertubes types now work as expected. I suspect the problem was with how I was instantiating them in the main function. The following now works. This isn't production code, just an exercise to practice concepts. Thanks for helping me take a fresh look at it. \n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype tube struct {\n    model  string\n    number int8\n}\n\ntype amp struct {\n    name         string\n    model        string\n    manufacturer string\n    color        string\n    knobs        int8\n    switches     int8\n    jacks        int8\n    preamptubes  tube\n    powertubes   tube\n    ouputpower   int8\n    fxloop       bool\n}\n\nfunc main() {\n    a := amp{\n        name:         \"MegaAmp\",\n        model:        \"MA9000\",\n        manufacturer: \"Amps R Us\",\n        color:        \"blonde\",\n        knobs:        9,\n        switches:     5,\n        jacks:        6,\n        preamptubes: tube{\n            model:  \"12AX7\",\n            number: 3},\n        powertubes: tube{\n            model:  \"6V6\",\n            number: 4},\n        fxloop: true}\n\n    fmt.Println(a)\n    fmt.Println(a.preamptubes.model)\n}\n\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 344, "user_id": 4179820, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VjMZ2.jpg?s=128&g=1", "display_name": "AKstat", "link": "https://stackoverflow.com/users/4179820/akstat"}, "edited": false, "score": 1, "creation_date": 1547021770, "post_id": 54102472, "comment_id": 95043661, "body": "And if OP wants to output to both the file and stdout then he can use an <code>io.MultiWriter</code>."}, {"owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "reply_to_user": {"reputation": 344, "user_id": 4179820, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VjMZ2.jpg?s=128&g=1", "display_name": "AKstat", "link": "https://stackoverflow.com/users/4179820/akstat"}, "edited": false, "score": 0, "creation_date": 1547022988, "post_id": 54102472, "comment_id": 95044226, "body": "Great point @AKstat - To add to that, you can also leverage a <code>bytes.Buffer</code> to temporarily buffer the output and then redirect it to an additional <code>io.Writer</code>, allowing you to cancel redirection at a later time without much complexity."}], "tags": [], "owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "is_accepted": false, "score": 2, "last_activity_date": 1547000680, "creation_date": 1547000680, "answer_id": 54102472, "question_id": 54102400, "link": "https://stackoverflow.com/questions/54102400/how-to-capture-output-and-send-it-to-file/54102472#54102472", "title": "How to capture output and send it to file", "body": "<p>Why are you changing <code>os.Stdout</code> to a file for your library? It seems as though the tablewriter package you're using accepts the <code>io.Writer</code> you'd like it to use:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n\n    \"github.com/olekukonko/tablewriter\"\n)\n\nfunc main() {\n    fmt.Println(\"Outputting to file, please wait...\")\n    f, err := os.Create(\"mahfile.txt\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer f.Close()\n\n    table := tablewriter.NewWriter(f)\n    table.Render()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/4L5Qu2SA4Uy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4L5Qu2SA4Uy</a></p>\n\n<p>Obviously you may need to declare things in a different order, but I wouldn't recommend changing the expected functionality of <code>os.Stdout</code> to accomplish your goal. They're just using it as a placeholder for you to overwrite.</p>\n\n<hr>\n\n<p>However, to answer your question: When you initialized <code>tablewriter.NewWriter(os.Stdout)</code>, you provided it with a copy to the <code>io.Writer</code> of STDOUT - Replacing <code>os.Stdout</code> later in your application does not undo this.</p>\n\n<p>To accomplish what you're wanting, you will need to provide a different writer that can be aware of this change as it potentially occurs, if this is needed (see first answer)</p>\n"}, {"tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 1, "last_activity_date": 1547009556, "creation_date": 1547009556, "answer_id": 54103443, "question_id": 54102400, "link": "https://stackoverflow.com/questions/54102400/how-to-capture-output-and-send-it-to-file/54103443#54103443", "title": "How to capture output and send it to file", "body": "<p>Since <code>tablewriter.NewWriter</code> takes the output file as an argument</p>\n\n<pre><code>tablewriter.NewWriter(os.Stdout)\n</code></pre>\n\n<p>And <code>os.Stdout</code> itself is just a <code>*File</code>, you can just pass a different file to the NewWriter.</p>\n\n<pre><code>var outputFile = os.Stdout\n\nif userWantsToOutputToFile {\n    var userFile, fileErr = os.Create(desiredOutputFilename)\n    if fileErr != nil {\n        outputFile = userFile\n    }\n}\n\n// do your initialization\n\n// then\ntablewriter.NewWriter(outputFile)\n</code></pre>\n\n<p>As an aside, (just an FYI) If you are running your own process, you can just redirect the output to a file on the shell</p>\n\n<pre><code>$ your_program -some-flags &gt; output.txt\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 10531220, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xUChwkOk7Ps/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbB5PVdVy6F4f526BZTUAHLAhogbLQ/mo/photo.jpg?sz=128", "display_name": "WiththeWind", "link": "https://stackoverflow.com/users/10531220/withthewind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1547061950, "creation_date": 1547000072, "question_id": 54102400, "link": "https://stackoverflow.com/questions/54102400/how-to-capture-output-and-send-it-to-file", "title": "How to capture output and send it to file", "body": "<p>I have a program that does some processing and I'd like to give the option to save the output to a file, however, I am not able to find the best way to do this. </p>\n\n<pre><code>if (strings.ToLower(input2) == \"y\") || (strings.ToLower(input2) == \"yes\") {\n    fmt.Println(\"\\nOutputting to file, please wait... \")\n    oldSt := os.Stdout //Create backup of old Stdout\n    newFil, _ := os.Create(input+\"txt\")\n\n    os.Stdout = newFil\n    table.Render()\n\n    os.Stdout = oldSt\n    fmt.Println(\"\\nComplete!\")\n}\n</code></pre>\n\n<p>This is my current code, but it seems it is just printing to the console without redirecting to the file.</p>\n\n<p>I am using this package to create a table which is what I am trying to output to the file.</p>\n\n<p><a href=\"https://github.com/olekukonko/tablewriter\" rel=\"nofollow noreferrer\">https://github.com/olekukonko/tablewriter</a></p>\n\n<p>Is there a better way of outputting to the file or because I am calling a library function would it be a different method of writing? </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1546997800, "creation_date": 1546997800, "answer_id": 54102147, "question_id": 54101861, "link": "https://stackoverflow.com/questions/54101861/reflect-typeof-is-string-and-returns-0xc0001ae4a8-how-to-print/54102147#54102147", "title": "reflect.TypeOf is *string and returns 0xc0001ae4a8 - how to print", "body": "<p><code>result.Reservations[0].Instances[0].Architecture</code> is a pointer to a string.  The type prints as <code>*string</code>.  The value prints as hex.  </p>\n\n<p>If your goal is to print the value of the string, then <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">dereference</a> the pointer:</p>\n\n<pre><code>fmt.Println(\"Success\", *result.Reservations[0].Instances[0].Architecture)\n</code></pre>\n"}], "owner": {"reputation": 61601, "user_id": 1203556, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aca772bc8ed79a86894211c7efd920aa?s=128&d=identicon&r=PG", "display_name": "Tampa", "link": "https://stackoverflow.com/users/1203556/tampa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 54102147, "answer_count": 1, "score": -2, "last_activity_date": 1547017414, "creation_date": 1546995418, "last_edit_date": 1547017414, "question_id": 54101861, "link": "https://stackoverflow.com/questions/54101861/reflect-typeof-is-string-and-returns-0xc0001ae4a8-how-to-print", "title": "reflect.TypeOf is *string and returns 0xc0001ae4a8 - how to print", "body": "<p>This is my code from retrieving results from the Go AWS client:</p>\n\n<pre><code>  fmt.Println(\"Success\", reflect.TypeOf(result.Reservations[0].Instances[0].Architecture))\n  Success *string\n\nfmt.Println(\"Success\", result.Reservations[0].Instances[0].Architecture)\nSuccess 0xc0001ae4a8\n</code></pre>\n\n<p>I don't know why this is happening.</p>\n"}, {"tags": ["docker", "go", "websocket", "dockerfile"], "comments": [{"owner": {"reputation": 26589, "user_id": 1032785, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/30816b3d787c2bd9d6f036318304f225?s=128&d=identicon&r=PG", "display_name": "jordanm", "link": "https://stackoverflow.com/users/1032785/jordanm"}, "edited": false, "score": 3, "creation_date": 1546994905, "post_id": 54101508, "comment_id": 95036471, "body": "Your server needs to listen on it&#39;s external interface, not localhost. Try changing <code>localhost:8000</code> in the server code to <code>0.0.0.0:8000</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1547017614, "post_id": 54101508, "comment_id": 95041797, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28015344/docker-listening-in-container-not-answering-outside\">Docker: listening in container, not answering outside</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2543, "user_id": 436085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a4d1a5b8d2c2a24c350f360e7e6bce1?s=128&d=identicon&r=PG", "display_name": "Edoardo", "link": "https://stackoverflow.com/users/436085/edoardo"}, "edited": false, "score": 0, "creation_date": 1605523812, "post_id": 54102318, "comment_id": 114666914, "body": "just wanted to share my experience about this, even in a completely different language / framework (dart). This answer (and question) is &quot;spot on&quot; understanding serving ports and addresses inside docker. Thank you"}], "tags": [], "owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "is_accepted": true, "score": 21, "last_activity_date": 1546999224, "creation_date": 1546999224, "answer_id": 54102318, "question_id": 54101508, "link": "https://stackoverflow.com/questions/54101508/how-do-you-dockerize-a-websocket-server/54102318#54102318", "title": "How do you dockerize a WebSocket Server?", "body": "<p>When you specify a hostname or IP address\u200b to listen on (in this case <code>localhost</code> which resolves to <code>127.0.0.1</code>), then your server will only listen on that IP address.</p>\n\n<p>Listening on <code>localhost</code> isn't a problem when you are outside of a Docker container. If your server only listens on <code>127.0.0.1:8000</code>, then your client can easily connect to it since the connection is also made from <code>127.0.0.1</code>.</p>\n\n<p>When you run your server inside a Docker container, it'll only listen on <code>127.0.0.1:8000</code> as before. The <code>127.0.0.1</code> is a local loopback address and it not accessible outside the container.</p>\n\n<p>When you fire up the docker container with <code>-p 8000:8000</code>, it'll forward traffic heading to <code>127.0.0.1:8000</code> to the container's IP address, which in my case is <code>172.17.0.2</code>.</p>\n\n<p>The container gets an IP addresses within the docker0 network interface (which you can see with the <code>ip addr ls</code> command)</p>\n\n<p>So, when your traffic gets forwarded to the container on <code>172.17.0.2:8000</code>, there's nothing listening there and the connection attempt fails.</p>\n\n<h3>The fix:</h3>\n\n<p>The problem is with the listen address:</p>\n\n<pre><code>server := http.Server{Addr: \"localhost:8000\"}\n</code></pre>\n\n<p>To fix your problem, change it to</p>\n\n<pre><code>server := http.Server{Addr: \":8000\"}\n</code></pre>\n\n<p>That'll make your server listen on all it container's IP addresses.</p>\n\n<h3>Additional info:</h3>\n\n<p>When you expose ports in a Docker container, Docker will create iptables rules to do the actual forwarding. See this. You can view these rules with:</p>\n\n<pre><code>iptables -n -L \niptables -t nat -n -L\n</code></pre>\n"}], "owner": {"reputation": 1039, "user_id": 4386643, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1407b4e2426e7d10d76859de4a9c2a5?s=128&d=identicon&r=PG&f=1", "display_name": "MakotoE", "link": "https://stackoverflow.com/users/4386643/makotoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11526, "favorite_count": 7, "accepted_answer_id": 54102318, "answer_count": 1, "score": 8, "last_activity_date": 1547004528, "creation_date": 1546992313, "last_edit_date": 1547004528, "question_id": 54101508, "link": "https://stackoverflow.com/questions/54101508/how-do-you-dockerize-a-websocket-server", "title": "How do you dockerize a WebSocket Server?", "body": "<p>I'm having trouble with putting my WebSocket server in a Docker container.</p>\n\n<p>This is the server code, which writes to a new connection with \"connected\".</p>\n\n<pre><code>// server.go\nfunc RootHandler(w http.ResponseWriter, r *http.Request) {\n    upgrader := websocket.Upgrader{ // (Uses gorilla/websocket)\n        ReadBufferSize:  4096,\n        WriteBufferSize: 4096,\n    }\n\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        panic(err)\n    }\n\n    if err = conn.WriteMessage(websocket.TextMessage, []byte(\"connected\")); err != nil {\n        panic(err)\n    }\n}\n\nfunc main() {\n    fmt.Println(\"server is running\")\n\n    // For graceful shutdown\n    stop := make(chan os.Signal, 1)\n    signal.Notify(stop, os.Interrupt)\n\n    server := http.Server{Addr: \"localhost:8000\"}\n    defer server.Close()\n\n    http.HandleFunc(\"/\", RootHandler)\n\n    go func() {\n        err := server.ListenAndServe()\n        if err != nil &amp;&amp; err != http.ErrServerClosed {\n            panic(err)\n        }\n    }()\n\n    &lt;-stop\n}\n</code></pre>\n\n<p>Here is the client:</p>\n\n<pre><code>// client.go\nfunc main() {\n    connection, _, err := websocket.DefaultDialer.Dial(\"ws://localhost:8000\", nil)\n    if err != nil {\n        panic(err)\n    }\n\n    _, b, err := connection.ReadMessage()\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(b)) // \"connected\"\n}\n</code></pre>\n\n<p>Running <code>server.go</code> then <code>client.go</code> prints \"connected\", showing that the code is working. Now I want to put the server in a Docker container. This is <code>dockerfile</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>FROM golang:1.11.4-alpine3.8\nCOPY . $GOPATH/src/websocket-test\nWORKDIR $GOPATH/src/websocket-test\nRUN [\"go\", \"build\", \"server.go\"]\nEXPOSE 8000\nCMD [\"./server\"]\n</code></pre>\n\n<p>I use these commands to build and start the container, exposing 8000/tcp.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>docker build -t websocket-test .\ndocker run -p 8000:8000 websocket-test\n</code></pre>\n\n<p>I can confirm that the server is running because it prints \"server is running\". If I start <code>client.go</code> outside the container, it panics:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>panic: read tcp [::1]:60328-&gt;[::1]:8000: read: connection reset by peer\n</code></pre>\n\n<p>What I expect is the same outcome as before\u2014printing \"connected\" on the client side. The error message means that the server dropped the connection before the handshake. I don't understand the \"60328\" number. As far as I know, WebSocket doesn't change ports on upgrade, so I should be okay with exposing just 8000.</p>\n\n<p>I do not know what I must change to be able to connect via WebSocket to my server.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 5, "creation_date": 1546989914, "post_id": 54101145, "comment_id": 95035266, "body": "What would you expect to happen if you call <code>i</code> with something which is not a string?"}, {"owner": {"reputation": 108, "user_id": 5356496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9eiku.jpg?s=128&g=1", "display_name": "goofle", "link": "https://stackoverflow.com/users/5356496/goofle"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1546990118, "post_id": 54101145, "comment_id": 95035325, "body": "@tkausl sorry, what?! I defined it to take <code>interface{}</code> so why should I be concerned with what happens if it called with something which is not a string?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1546990174, "post_id": 54101145, "comment_id": 95035342, "body": "From the FAQ: <a href=\"https://golang.org/doc/faq#covariant_types\" rel=\"nofollow noreferrer\">golang.org/doc/faq#covariant_types</a> and <a href=\"https://golang.org/doc/faq#t_and_equal_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#t_and_equal_interface</a>"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 4, "creation_date": 1546990390, "post_id": 54101145, "comment_id": 95035391, "body": "Because if your code were allowed, <code>stringFunc(s string)</code> would be called with something which may not be a string."}, {"owner": {"reputation": 108, "user_id": 5356496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9eiku.jpg?s=128&g=1", "display_name": "goofle", "link": "https://stackoverflow.com/users/5356496/goofle"}, "edited": false, "score": 0, "creation_date": 1547055980, "post_id": 54101145, "comment_id": 95064160, "body": "Thank you guys. The answer is so obvious! guess I just needed to take some sleep last night!"}], "answers": [{"comments": [{"owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "edited": false, "score": 0, "creation_date": 1547110598, "post_id": 54103788, "comment_id": 95081315, "body": "I have made a <a href=\"https://play.golang.org/p/ygIOlo7phIS\" rel=\"nofollow noreferrer\">goplayground</a>  for your better understanding."}], "tags": [], "owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "is_accepted": false, "score": 1, "last_activity_date": 1547110522, "last_edit_date": 1547110522, "creation_date": 1547012021, "answer_id": 54103788, "question_id": 54101145, "link": "https://stackoverflow.com/questions/54101145/why-cannot-use-type-funcstring-as-type-funcinterface-in-assignment/54103788#54103788", "title": "why cannot use (type func(string)) as type func(interface{}) in assignment", "body": "<p>You can not do <code>s = i</code> or <code>i = s</code>, and the reason is both functions are of different type (different signatures), you can not just assign one type with another in golang.</p>\n\n<p>Also <code>type InterfaceFunc func(interface{}) type StringFunc func(string)</code> are sitting there doing nothing.</p>\n"}], "owner": {"reputation": 108, "user_id": 5356496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9eiku.jpg?s=128&g=1", "display_name": "goofle", "link": "https://stackoverflow.com/users/5356496/goofle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 747, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1547110522, "creation_date": 1546989737, "question_id": 54101145, "link": "https://stackoverflow.com/questions/54101145/why-cannot-use-type-funcstring-as-type-funcinterface-in-assignment", "title": "why cannot use (type func(string)) as type func(interface{}) in assignment", "body": "<p>Please first have a look at the code below.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype InterfaceFunc func(interface{})\ntype StringFunc func(string)\n\nfunc stringFunc(s string) {\n    fmt.Printf(\"%v\", s)\n}\n\nfunc interfaceFunc(i interface{}) {\n    fmt.Printf(\"%v\", i)\n}\n\nfunc main() {\n    var i = interfaceFunc\n    var s = stringFunc\n\n    i = s // I would like someone to explain why this can't be done exactly.\n}\n</code></pre>\n\n<p>Run at <a href=\"https://play.golang.org/p/16cE4O3eb95\" rel=\"nofollow noreferrer\">https://play.golang.org/p/16cE4O3eb95</a></p>\n\n<p>Why an <code>InterfaceFunc</code> can't hold a <code>StringFunc</code> while an <code>interface{}</code> can hold a <code>string</code>.</p>\n"}, {"tags": ["string", "go", "random", "colors", "webassembly"], "answers": [{"comments": [{"owner": {"reputation": 5269, "user_id": 2536842, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Vsam8.jpg?s=128&g=1", "display_name": "Dylan Meeus", "link": "https://stackoverflow.com/users/2536842/dylan-meeus"}, "edited": false, "score": 0, "creation_date": 1547024766, "post_id": 54106401, "comment_id": 95045189, "body": "Mystery solved! Thank you, the explanation that changing GOOS also changes the size of int is really helpful. I hadn&#39;t figured that out yet. :)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5269, "user_id": 2536842, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Vsam8.jpg?s=128&g=1", "display_name": "Dylan Meeus", "link": "https://stackoverflow.com/users/2536842/dylan-meeus"}, "edited": false, "score": 0, "creation_date": 1547025033, "post_id": 54106401, "comment_id": 95045336, "body": "@DylanMeeus Also <code>context.fillRect()</code> requires 4 arguments (x, y, width, height), I assume you used 4 in your code, right?"}, {"owner": {"reputation": 5269, "user_id": 2536842, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Vsam8.jpg?s=128&g=1", "display_name": "Dylan Meeus", "link": "https://stackoverflow.com/users/2536842/dylan-meeus"}, "edited": false, "score": 0, "creation_date": 1547035073, "post_id": 54106401, "comment_id": 95051291, "body": "I did, but I made an error writing the example here :) good catch"}, {"owner": {"reputation": 5269, "user_id": 2536842, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Vsam8.jpg?s=128&g=1", "display_name": "Dylan Meeus", "link": "https://stackoverflow.com/users/2536842/dylan-meeus"}, "edited": false, "score": 0, "creation_date": 1547035848, "post_id": 54106401, "comment_id": 95051772, "body": "Lol I&#39;m going to blame being tired on this. I made an edit to the wrong one :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1547042079, "last_edit_date": 1547042079, "creation_date": 1547024475, "answer_id": 54106401, "question_id": 54101059, "link": "https://stackoverflow.com/questions/54101059/web-assembly-drawing-gray-canvas/54106401#54106401", "title": "Web Assembly drawing gray canvas", "body": "<p>The problem is that you use this expression to construct the fill style:</p>\n\n<pre><code>fmt.Sprintf(\"#%06x\", rand.Int())\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/math/rand/#Int\" rel=\"nofollow noreferrer\"><code>rand.Int()</code></a> returns a non-negative pseudo-random <code>int</code>. Size of <code>int</code> is 64 bits if <code>GOOS=js</code> and <code>GOARCH=wasm</code>. What this means is that the random <code>int</code> number will be random 8 bytes (first bit being always 0 due to being non-negative).</p>\n\n<p>If you format such a number with the <code>%06x</code> verb, like almost all the time it will be more than just 6 hex digits. The width <code>6</code> means to be <em>at least</em> 6, and the flag <code>0</code> means to pad with zeros if less. But if it's longer, it is not truncated.</p>\n\n<p>And if you set an invalid color to <a href=\"https://www.w3schools.com/tags/canvas_fillstyle.asp\" rel=\"nofollow noreferrer\"><code>canvas.fillStyle</code></a>, it will disregard it and the last set valid fill style will remain active. And I'm guessing it was a gray color you used before the loop.</p>\n\n<p>Fix is easy, just make sure the random number has no more than 3 bytes, or in other words, 6 hex digits. Use a simple bitmask:</p>\n\n<pre><code>ctx.Set(\"fillStyle\", fmt.Sprintf(\"#%06x\", rand.Int()&amp;0xffffff))\n</code></pre>\n\n<p>Or use <a href=\"https://golang.org/pkg/math/rand/#Intn\" rel=\"nofollow noreferrer\"><code>rand.Intn()</code></a> instead of <code>rand.Int()</code>:</p>\n\n<pre><code>ctx.Set(\"fillStyle\", fmt.Sprintf(\"#%06x\", rand.Int(0x1000000)))\n</code></pre>\n\n<p>Also <a href=\"https://www.w3schools.com/tags/canvas_fillrect.asp\" rel=\"nofollow noreferrer\"><code>context.fillRect()</code></a> expects 4 arguments: <code>x</code>, <code>y</code>, <code>width</code> and <code>height</code>, so it should be something like this:</p>\n\n<pre><code>ctx.Call(\"fillRect\", 20+(col*width), maxHeight-(row*height), width, height)\n</code></pre>\n"}], "owner": {"reputation": 5269, "user_id": 2536842, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Vsam8.jpg?s=128&g=1", "display_name": "Dylan Meeus", "link": "https://stackoverflow.com/users/2536842/dylan-meeus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 54106401, "answer_count": 1, "score": 1, "last_activity_date": 1547042079, "creation_date": 1546988974, "last_edit_date": 1547035860, "question_id": 54101059, "link": "https://stackoverflow.com/questions/54101059/web-assembly-drawing-gray-canvas", "title": "Web Assembly drawing gray canvas", "body": "<p>I'm using Go and compiling it to web assembly.</p>\n\n<p>I'm trying to render a bunch of rectangles next to eachother with a random colour, but they keep rendering as just gray. </p>\n\n<p>My render function looks something like this:</p>\n\n<pre><code> for row,_ := range rows {\n    for col,_ := range row {\n        ctx.Set(\"fillStyle\", fmt.Sprintf(\"#%06x\", rand.Int()))\n        ctx.Call(\"fillRect\", 20, 20 + (col * width), maxHeight - (row*height))\n    }\n }\n</code></pre>\n\n<p>With which it renders a big block (all rectangles are next to eachother) but just all in gray, instead of doing them in different colours.</p>\n\n<p>Is this enough code in the example to help further? If not I can post it to a gist, as I'm new to WASM I'm unsure which parts could really be relevant - but those 2 functions are the only ones doing something with rendering as far as I can tell.</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "is_accepted": false, "score": 1, "last_activity_date": 1547036961, "creation_date": 1547036961, "answer_id": 54110209, "question_id": 54101022, "link": "https://stackoverflow.com/questions/54101022/golang-struct-with-c-struct-in-cgo/54110209#54110209", "title": "golang struct with C struct in CGO", "body": "<p>Yes, this is totally legal. Check out this short example:</p>\n\n<pre><code>package main\n\n/*\ntypedef struct Point {\n    int x , y;\n} Point;\n*/\nimport \"C\"\nimport \"fmt\"\n\ntype CPoint struct {\n    Point C.Point\n}\n\nfunc main() {\n    point := CPoint{Point: C.Point{x: 1, y: 2}}\n    fmt.Printf(\"%+v\", point)\n}\n</code></pre>\n\n<p>OUTPUT</p>\n\n<pre><code>{Point:{x:1 y:2}}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10886882, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-UIeUZqV0LCM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYU_K8BU-cN50WOeCeQZDECIxBeAQ/mo/photo.jpg?sz=128", "display_name": "bpl", "link": "https://stackoverflow.com/users/10886882/bpl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3470, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1547036961, "creation_date": 1546988756, "question_id": 54101022, "link": "https://stackoverflow.com/questions/54101022/golang-struct-with-c-struct-in-cgo", "title": "golang struct with C struct in CGO", "body": "<p>I will use cgo to wrap one c library as go library for the project usage. I read the document, it seems there are lots of rules while using cgo. I don't know whether this is legal or not. </p>\n\n<p>Both LibCtx and Client is a struct in C. Is this a legal way to put C struct into a golang struct?</p>\n\n<pre><code>//DBClientLib.go\n\ntype DBClient struct {\n    Libctx C.LibCtx\n    LibClient C.Client\n}\n\nfunc (client DBClient) GetEntry(key string) interface{} {\n\n    //...\n}\n</code></pre>\n"}, {"tags": ["go", "ssh", "cryptography"], "owner": {"reputation": 26589, "user_id": 1032785, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/30816b3d787c2bd9d6f036318304f225?s=128&d=identicon&r=PG", "display_name": "jordanm", "link": "https://stackoverflow.com/users/1032785/jordanm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1546985831, "creation_date": 1546985831, "question_id": 54100529, "link": "https://stackoverflow.com/questions/54100529/using-crypto-ssh-with-agent-authentication-while-falling-back-to-encrypted-key", "title": "Using crypto/ssh with agent authentication, while falling back to encrypted key authentication", "body": "<p>I am implementing an SSH client which will use agent authentication (if available) and fallback to public key authentication if that fails. I have found that I can do this using multiple signers like the following:</p>\n\n<pre><code>sshConfig := &amp;ssh.ClientConfig{\n    User:            getUsername(username, currentUser),\n    HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n    Auth: []ssh.AuthMethod{\n        ssh.PublicKeysCallback(getSigners),\n    },\n}\n\nfunc getSigners() ([]ssh.Signer, error) {\n    signers := make([]ssh.Signer, 0)\n    currentUser, _ := user.Current()\n    if os.Getenv(\"SSH_AUTH_SOCK\") != \"\" {\n        sshAgent, err := net.Dial(\"unix\", os.Getenv(\"SSH_AUTH_SOCK\"))\n        if err == nil {\n            agentSigners, _ := agent.NewClient(sshAgent).Signers()\n            signers = append(signers, agentSigners...)\n        }\n    }\n\n    // default to id_rsa\n    keyPath := path.Join(path.Join(currentUser.HomeDir, \".ssh/id_rsa\"))\n\n    buffer, errI := ioutil.ReadFile(keyPath)\n    if errI != nil {\n        fmt.Println(errI)\n        return signers, errI\n    }\n\n    block, _ := pem.Decode(buffer)\n\n    var key ssh.Signer\n    if strings.Contains(block.Headers[\"Proc-Type\"], \"ENCRYPTED\") {\n        fmt.Print(\"SSH Passphrase: \")\n        bytePassword, _ := terminal.ReadPassword(int(syscall.Stdin))\n        key, _ = ssh.ParsePrivateKeyWithPassphrase(buffer, bytePassword)\n    } else {\n        key, _ = ssh.ParsePrivateKey(buffer)\n    }\n\n    signers = append(signers, key)\n    return signers, nil\n}\n</code></pre>\n\n<p>The issue with this method is that it will always prompt for a passphrase, since the passphrase prompt occurs before any authentication attempts have been made. Is it possible to delay when the public key gets decrypted so that agent authentication can be attempted before the user is asked to enter a passphrase?</p>\n"}, {"tags": ["go", "ssh", "circleci"], "answers": [{"tags": [], "owner": {"reputation": 19007, "user_id": 444646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/996ae88559e4c401582326971c77c75a?s=128&d=identicon&r=PG", "display_name": "dnephin", "link": "https://stackoverflow.com/users/444646/dnephin"}, "is_accepted": false, "score": 1, "last_activity_date": 1547075475, "creation_date": 1547075475, "answer_id": 54119769, "question_id": 54099579, "link": "https://stackoverflow.com/questions/54099579/fetching-private-repo-using-go-mod-in-circle-ci/54119769#54119769", "title": "Fetching private repo using go mod in circle ci", "body": "<p>The easiest way to get this to work is to follow the instructions for adding a machine user: <a href=\"https://circleci.com/docs/2.0/gh-bb-integration/#enable-your-project-to-check-out-additional-private-repositories\" rel=\"nofollow noreferrer\">https://circleci.com/docs/2.0/gh-bb-integration/#enable-your-project-to-check-out-additional-private-repositories</a></p>\n\n<p>For a more complicated solution, read on.</p>\n\n<p>I recently attempted the same thing.  The <code>add_ssh_keys</code> keys should (and did in my case) add the <code>id_rsa_&lt;fingerprint&gt;</code> file.</p>\n\n<p>The problem I ran into was that the key is added with an ssh config that contains:</p>\n\n<pre><code>Host !github.com *\n</code></pre>\n\n<p>I believe the problem is that it uses the default CircleCI key to authenticate with github. That key is valid, so github accepts it, but it most likely does not have access to the private repo in your dependencies.</p>\n\n<p>To get it to work what I had to do was:</p>\n\n<pre><code># Disable ssh-agent which seemed to override `-i`\nexport SSH_AUTH_SOCK=none\n# Tell get to ssh with the key I want to use\nexport GIT_SSH_COMMAND=\"ssh -i /root/.ssh/id_rsa_FINGERPRINT\n\n# Run some command to pull dependencies\ngo test ./...\n</code></pre>\n"}], "owner": {"reputation": 303, "user_id": 2193322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be30685ec00a1032dd6a6d33762642cf?s=128&d=identicon&r=PG", "display_name": "martinni39", "link": "https://stackoverflow.com/users/2193322/martinni39"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1129, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1547075475, "creation_date": 1546981050, "last_edit_date": 1546982650, "question_id": 54099579, "link": "https://stackoverflow.com/questions/54099579/fetching-private-repo-using-go-mod-in-circle-ci", "title": "Fetching private repo using go mod in circle ci", "body": "<p>I followed <a href=\"https://circleci.com/docs/2.0/add-ssh-key/\" rel=\"nofollow noreferrer\">this</a> and added the keys in SSH Permissions as well as the fingerprint in my circle config file.</p>\n\n<p>I also added this to my <code>~/.gitconfig</code> as part of my circle compile step.</p>\n\n<pre><code>[url \"ssh://git@github.com/MYORGANIZATION/\"]\ninsteadOf = https://github.com/MYORGANIZATION/\n</code></pre>\n\n<p>following the <a href=\"https://github.com/golang/go/issues/26134#issuecomment-403885803\" rel=\"nofollow noreferrer\">official recommendation</a></p>\n\n<p>When I SSH into the circle image I can see the fingerprint being added using this command <code>ssh-add -l -E md5</code>. But there's no keys added in <code>~/.ssh/</code>. I'd expect to have <code>~/.ssh/id_rsa_&lt;fingerprint&gt;</code> in there.</p>\n\n<p>However I still get access denied when I try to retrieve the package.</p>\n"}, {"tags": ["go", "logging", "methods", "struct", "embedding"], "answers": [{"comments": [{"owner": {"reputation": 199, "user_id": 8655700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/feeb09c07cc3e5b12eb1824788b6d407?s=128&d=identicon&r=PG&f=1", "display_name": "geexee", "link": "https://stackoverflow.com/users/8655700/geexee"}, "edited": false, "score": 0, "creation_date": 1546977319, "post_id": 54098727, "comment_id": 95030410, "body": "Obviously you are right! How can I use <code>log.New()</code> to initialize my <code>logger</code> structs?"}, {"owner": {"reputation": 199, "user_id": 8655700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/feeb09c07cc3e5b12eb1824788b6d407?s=128&d=identicon&r=PG&f=1", "display_name": "geexee", "link": "https://stackoverflow.com/users/8655700/geexee"}, "edited": false, "score": 0, "creation_date": 1546978112, "post_id": 54098727, "comment_id": 95030776, "body": "Nice explained. Thank you."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1546978070, "last_edit_date": 1546978070, "creation_date": 1546976749, "answer_id": 54098727, "question_id": 54098695, "link": "https://stackoverflow.com/questions/54098695/undefined-error-where-calling-a-promoted-function/54098727#54098727", "title": "Undefined error where calling a promoted function", "body": "<p>There is no <code>Logger.New()</code> method, only a <a href=\"https://golang.org/pkg/log/#New\" rel=\"nofollow noreferrer\"><code>log.New()</code></a> function that returns a value of <a href=\"https://golang.org/pkg/log/#Logger\" rel=\"nofollow noreferrer\"><code>*log.Logger</code></a>:</p>\n\n<pre><code>func New(out io.Writer, prefix string, flag int) *Logger\n</code></pre>\n\n<p>Generated go doc deliberately lists such \"constructor\" functions under the type they return so you can easily find them, but this grouping doesn't make them methods. <code>log.New()</code> has no receiver so it cannot be a method, only a function.</p>\n\n<p>You may use <code>log.New()</code> to obtain a value of type <code>*log.Logger</code>, which if you dereference, you get a value of type <code>log.Logger</code>, the value you embed.</p>\n\n<p>However, if something is handed to you as a pointer in the first place, that is a strong indication that you should work with it as a pointer (and shouldn't dereference it). So I'd embed <code>*log.Logger</code>, methods will still get promoted (because they have pointer receiver). This is how you could initialize your loggers:</p>\n\n<pre><code>type logger struct {\n    *log.Logger\n}\n\nvar logError = logger{\n    Logger: log.New(os.Stderr, \"ERROR\", log.LstdFlags),\n}\n\nvar logOut = logger{\n    Logger: log.New(os.Stdout, \"INFO\", log.LstdFlags),\n}\n</code></pre>\n\n<p>Although if you add nothing else to your <code>logger</code> type, I don't see its existence justified, you could use <code>*log.Logger</code> as well.</p>\n"}], "owner": {"reputation": 199, "user_id": 8655700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/feeb09c07cc3e5b12eb1824788b6d407?s=128&d=identicon&r=PG&f=1", "display_name": "geexee", "link": "https://stackoverflow.com/users/8655700/geexee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 54098727, "answer_count": 1, "score": -2, "last_activity_date": 1546978070, "creation_date": 1546976599, "last_edit_date": 1546977736, "question_id": 54098695, "link": "https://stackoverflow.com/questions/54098695/undefined-error-where-calling-a-promoted-function", "title": "Undefined error where calling a promoted function", "body": "<p>I am getting an <code>undefined</code> error when using a promoted function in GO.</p>\n\n<pre><code>import \"log\"\ntype logger struct {\n    log.Logger\n}\n\nlogError := logger.New(os.Stderr, \"ERROR\", log.LstdFlags)\nlogOut := logger.New(os.Stdout, \"INFO\", log.LstdFlags)\n</code></pre>\n\n<p>This results in compiler error:</p>\n\n<pre><code>logger.go: logger.New undefined (type logger has no method New)\n</code></pre>\n\n<p>However, <code>New</code> is a promoted function of the <code>log.Logger</code>. What is wrong here?</p>\n"}, {"tags": ["csv", "go", "decode", "utf-16"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546975048, "post_id": 54098257, "comment_id": 95029365, "body": "None of them, as clearly indicated in the <code>charmap</code> docs: <a href=\"https://godoc.org/golang.org/x/text/encoding/charmap\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/text/encoding/charmap</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546975124, "post_id": 54098257, "comment_id": 95029405, "body": "If you want to decode utf-16, you&#39;d use <a href=\"https://golang.org/pkg/unicode/utf16/\" rel=\"nofollow noreferrer\">golang.org/pkg/unicode/utf16</a>"}], "answers": [{"tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 0, "last_activity_date": 1547010614, "creation_date": 1547010614, "answer_id": 54103570, "question_id": 54098257, "link": "https://stackoverflow.com/questions/54098257/how-to-decode-a-utf-16be-csv-file-in-golang/54103570#54103570", "title": "How to decode a UTF-16BE CSV file in Golang", "body": "<p>Have you tried this?</p>\n\n<p><a href=\"https://godoc.org/golang.org/x/text/encoding/unicode#UTF16\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/text/encoding/unicode#UTF16</a></p>\n\n<pre><code>unicode.UTF16(BigEndian, UseBOM)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 111, "user_id": 10412696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/551b0ea14f1f7576f881992998108f3d?s=128&d=identicon&r=PG&f=1", "display_name": "Emanolo78", "link": "https://stackoverflow.com/users/10412696/emanolo78"}, "is_accepted": false, "score": 0, "last_activity_date": 1547313096, "creation_date": 1547313096, "answer_id": 54161960, "question_id": 54098257, "link": "https://stackoverflow.com/questions/54098257/how-to-decode-a-utf-16be-csv-file-in-golang/54161960#54161960", "title": "How to decode a UTF-16BE CSV file in Golang", "body": "<p>After some review, a simple way to decode UTF16 into UTF8 is provided by this code:  </p>\n\n<p><a href=\"https://gist.github.com/bradleypeabody/185b1d7ed6c0c2ab6cec#file-gistfile1-go\" rel=\"nofollow noreferrer\">https://gist.github.com/bradleypeabody/185b1d7ed6c0c2ab6cec#file-gistfile1-go</a></p>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1571169279, "last_edit_date": 1571169279, "creation_date": 1571167128, "answer_id": 58401338, "question_id": 54098257, "link": "https://stackoverflow.com/questions/54098257/how-to-decode-a-utf-16be-csv-file-in-golang/58401338#58401338", "title": "How to decode a UTF-16BE CSV file in Golang", "body": "<p>You can use <a href=\"https://godoc.org/golang.org/x/text/encoding/unicode#UTF16\" rel=\"nofollow noreferrer\"><code>golang.org/x/text/encoding/unicode.UTF16</code></a> to create a decoder from your target UTF-16 Little/Big-Endian encoding into UTF-8.</p>\n\n<p>The code below shows a working example for UTF-16 LE (<a href=\"https://play.golang.org/p/uEl3-23dO4g\" rel=\"nofollow noreferrer\">Go playground</a>):</p>\n\n<pre><code>dec := unicode.UTF16(unicode.LittleEndian, unicode.UseBOM).NewDecoder()\nutf16r := getUTF16LittleEndianCSVReader()\nutf8r := transform.NewReader(utf16r, dec)\n\ncsvr := csv.NewReader(utf8r)\nrecords, err := csvr.ReadAll()\n// TODO: handle err\n\nfmt.Printf(\"%#v\", records)\n// [][]string{[]string{\"id\", \"name\"}, []string{\"1\", \"foo\"}}\n</code></pre>\n\n<p>Switching to Big-endian should be as simple as below:</p>\n\n<pre><code>enc := unicode.UTF16(unicode.BigEndian, unicode.UseBOM).NewDecoder()\n</code></pre>\n"}], "owner": {"reputation": 111, "user_id": 10412696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/551b0ea14f1f7576f881992998108f3d?s=128&d=identicon&r=PG&f=1", "display_name": "Emanolo78", "link": "https://stackoverflow.com/users/10412696/emanolo78"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 604, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1571169279, "creation_date": 1546974932, "question_id": 54098257, "link": "https://stackoverflow.com/questions/54098257/how-to-decode-a-utf-16be-csv-file-in-golang", "title": "How to decode a UTF-16BE CSV file in Golang", "body": "<p>I'm trying to decode CSV files encoded in UTF-16BE in Golang. What is the charmap ISO character number that I have to call for the new reader ?</p>\n\n<p>I want to invoke</p>\n\n<pre><code>csv.NewReader(charmap.XXXX.NewDecoder().Reader(file))\n</code></pre>\n\n<p>What should be the value of XXXX ?</p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1546969271, "post_id": 54096876, "comment_id": 95026599, "body": "What have you tried? Include your code. What problems are you facing?"}, {"owner": {"reputation": 166, "user_id": 4499398, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Wwm_HzjUCCs/AAAAAAAAAAI/AAAAAAAAO24/rUKWCR1jnv4/photo.jpg?sz=128", "display_name": "Jacob Miles", "link": "https://stackoverflow.com/users/4499398/jacob-miles"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546969598, "post_id": 54096876, "comment_id": 95026743, "body": "I haven&#39;t tried much other than searching for a solution. I have the code in place to receive the XML string and I&#39;m marshaling it into a struct. But I have no idea how to either command the XML marshal to trim the string values and neither do I wan&#39;t to write cod that runs through all parts of the struct and trim and re-assign the values manually."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546969649, "post_id": 54096876, "comment_id": 95026765, "body": "Well, be sure to try something. And if you get stuck, then that&#39;s the time to post here. This isn&#39;t a code-writing service. We love to help you, but we won&#39;t do your work for you."}, {"owner": {"reputation": 166, "user_id": 4499398, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Wwm_HzjUCCs/AAAAAAAAAAI/AAAAAAAAO24/rUKWCR1jnv4/photo.jpg?sz=128", "display_name": "Jacob Miles", "link": "https://stackoverflow.com/users/4499398/jacob-miles"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546969753, "post_id": 54096876, "comment_id": 95026832, "body": "I reallize this isn&#39;t a cod-writing service... I&#39;m just looking for some help on where to even start."}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 0, "last_activity_date": 1546970759, "creation_date": 1546970759, "answer_id": 54097341, "question_id": 54096876, "link": "https://stackoverflow.com/questions/54096876/trimspaces-for-all-xml-text/54097341#54097341", "title": "TrimSpaces for all XML text", "body": "<p>This could <em>easily</em> not work depending on what the data looks like, but if the data is predictable and won't contain <code>&gt;</code> anywhere except in XML tags, you could do:</p>\n\n<p><a href=\"https://play.golang.org/p/4YSpvLFwHjZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4YSpvLFwHjZ</a></p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"regexp\"\n)\n\nfunc main() {\n  r := regexp.MustCompile(\"&gt;(\\\\s*)\")\n  xml := \"&lt;test&gt;   hello&lt;/test&gt;&lt;test&gt;  There&lt;/test&gt;&lt;test&gt;!&lt;/test&gt;\"\n  xml = r.ReplaceAllString(xml, \"&gt;\")\n  fmt.Println(xml)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 166, "user_id": 4499398, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Wwm_HzjUCCs/AAAAAAAAAAI/AAAAAAAAO24/rUKWCR1jnv4/photo.jpg?sz=128", "display_name": "Jacob Miles", "link": "https://stackoverflow.com/users/4499398/jacob-miles"}, "edited": false, "score": 0, "creation_date": 1546971878, "post_id": 54097420, "comment_id": 95027846, "body": "Thanks a lot this got me to what I needed!"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 4, "last_activity_date": 1546971085, "creation_date": 1546971085, "answer_id": 54097420, "question_id": 54096876, "link": "https://stackoverflow.com/questions/54096876/trimspaces-for-all-xml-text/54097420#54097420", "title": "TrimSpaces for all XML text", "body": "<p>You can use the primitives in the encoding/xml package to modify an XML stream on the fly. In this case implementing <a href=\"https://golang.org/pkg/encoding/xml/#TokenReader\" rel=\"nofollow noreferrer\">xml.TokenReader</a> is a simple solution:</p>\n\n<pre><code>import (\n    \"bytes\"\n    \"encoding/xml\"\n)\n\ntype Trimmer struct {\n    dec *xml.Decoder\n}\n\nfunc (tr Trimmer) Token() (xml.Token, error) {\n    t, err := tr.dec.Token()\n    if cd, ok := t.(xml.CharData); ok {\n        t = xml.CharData(bytes.TrimSpace(cd))\n    }\n    return t, err\n}\n</code></pre>\n\n<p>Trimmer wraps an underlying decoder and returns a modified token stream. <code>xml.CharData</code> represents text nodes. Whenever one is encountered, <a href=\"https://golang.org/pkg/bytes/#TrimSpace\" rel=\"nofollow noreferrer\"><code>bytes.TrimSpace</code></a> is called to trim leading and trailing whitespace. All other tokens are returned unmodified.</p>\n\n<p><a href=\"https://golang.org/pkg/encoding/xml/#NewTokenDecoder\" rel=\"nofollow noreferrer\"><code>xml.NewTokenDecoder</code></a> turns <code>Trimmer</code> back into a regular Decoder:</p>\n\n<pre><code>import (\n    \"encoding/xml\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n)\n\nvar r io.Reader                          // data source\nraw := xml.NewDecoder(r)                 // regular decoder\ndec := xml.NewTokenDecoder(Trimmer{raw}) // trimming decoder\n\nvar v MyType\nerr := dec.Decode(&amp;v)\n</code></pre>\n"}], "owner": {"reputation": 166, "user_id": 4499398, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Wwm_HzjUCCs/AAAAAAAAAAI/AAAAAAAAO24/rUKWCR1jnv4/photo.jpg?sz=128", "display_name": "Jacob Miles", "link": "https://stackoverflow.com/users/4499398/jacob-miles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 419, "favorite_count": 0, "accepted_answer_id": 54097420, "answer_count": 2, "score": -1, "last_activity_date": 1546971085, "creation_date": 1546968646, "last_edit_date": 1546969250, "question_id": 54096876, "link": "https://stackoverflow.com/questions/54096876/trimspaces-for-all-xml-text", "title": "TrimSpaces for all XML text", "body": "<p>I'm retrieving an XML string from an external web service that I do not control. Some of the data contains empty spaces <code>&lt;data&gt;    I have leading white space&lt;/data&gt;</code>. How do I trim the space from each element within the XML string?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1546971716, "post_id": 54096802, "comment_id": 95027775, "body": "Please include an example document you wish to extend, and the expected outcome (the extended document)."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1546972358, "post_id": 54096802, "comment_id": 95028067, "body": "You are querying productId in the top level document, but then you use the positional operator on a totally different field. If you are looking for <code>productId</code> within a <code>productFiles</code> array of objects, you should query for <code>productFile.productId</code>."}, {"owner": {"reputation": 638, "user_id": 4380048, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1d95bf68a0b437b36450e18b08f6ef71?s=128&d=identicon&r=PG&f=1", "display_name": "Forkmohit", "link": "https://stackoverflow.com/users/4380048/forkmohit"}, "edited": false, "score": 0, "creation_date": 1546972384, "post_id": 54096802, "comment_id": 95028080, "body": "Example document may contain just productId. And expected document would contain additional productFiles field, as shown above."}, {"owner": {"reputation": 638, "user_id": 4380048, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1d95bf68a0b437b36450e18b08f6ef71?s=128&d=identicon&r=PG&f=1", "display_name": "Forkmohit", "link": "https://stackoverflow.com/users/4380048/forkmohit"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1546972466, "post_id": 54096802, "comment_id": 95028118, "body": "@MarkusWMahlberg productFiles field don&#39;t exist. I wish to add it to a document with given productID. So I want to query the top level document and add a new field(productFiles) if the productId matches. Please help!"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1546973898, "post_id": 54096802, "comment_id": 95028787, "body": "In this case: Simply leave out the <code>$</code> operator."}, {"owner": {"reputation": 638, "user_id": 4380048, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1d95bf68a0b437b36450e18b08f6ef71?s=128&d=identicon&r=PG&f=1", "display_name": "Forkmohit", "link": "https://stackoverflow.com/users/4380048/forkmohit"}, "edited": false, "score": 0, "creation_date": 1547020708, "post_id": 54096802, "comment_id": 95043177, "body": "Thanks it worked"}], "owner": {"reputation": 638, "user_id": 4380048, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1d95bf68a0b437b36450e18b08f6ef71?s=128&d=identicon&r=PG&f=1", "display_name": "Forkmohit", "link": "https://stackoverflow.com/users/4380048/forkmohit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1546969212, "creation_date": 1546968342, "last_edit_date": 1546969212, "question_id": 54096802, "link": "https://stackoverflow.com/questions/54096802/unable-to-add-a-new-object-to-document", "title": "Unable to add a new Object to document", "body": "<p>I am trying to add a new field productFiles(along with its field) to an existing document in MongoDb. \nBut I am getting follwing error:</p>\n\n<blockquote>\n  <p>\"the positional operator did not find the match needed from the\n  query.\"</p>\n</blockquote>\n\n<pre><code>query := bson.M{\n     \"productId\": productId,\n}\n\nupdate := bson.M{\n    \"$set\": bson.M{ \n        \"productFiles.$.updatedOn\": int32(time.Now().Unix()),\n        \"productFiles.$.updatedBy\": userId,\n    },\n}\n\nerr := repo.Collection().Update(query, update)\n</code></pre>\n"}, {"tags": ["go", "gopath", "go-packages"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1546966256, "post_id": 54096182, "comment_id": 95025038, "body": "One directory per package, one package per directory. If <code>exch.go</code> is supposed to be in package <code>services&#47;exch</code>, it needs to be in a directory <code>services&#47;exch</code>, not in directory <code>services&#47;services</code>."}, {"owner": {"reputation": 1357, "user_id": 3201684, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fce047896b7ee0a2f6967156e339521f?s=128&d=identicon&r=PG&f=1", "display_name": "ntonnelier", "link": "https://stackoverflow.com/users/3201684/ntonnelier"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546966941, "post_id": 54096182, "comment_id": 95025447, "body": "that was it @Adrian. Thanks. If you want to add it as an answer i mark it as accepted."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1546968137, "creation_date": 1546968137, "answer_id": 54096759, "question_id": 54096182, "link": "https://stackoverflow.com/questions/54096182/cannot-find-nested-package/54096759#54096759", "title": "Cannot find nested package", "body": "<p>One directory per package, one package per directory. If exch.go is supposed to be imported as <code>services/exch</code>, it needs to be in a directory <code>services/exch</code>, not in directory <code>services/services</code>.</p>\n"}], "owner": {"reputation": 1357, "user_id": 3201684, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fce047896b7ee0a2f6967156e339521f?s=128&d=identicon&r=PG&f=1", "display_name": "ntonnelier", "link": "https://stackoverflow.com/users/3201684/ntonnelier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "accepted_answer_id": 54096759, "answer_count": 1, "score": -2, "last_activity_date": 1546969225, "creation_date": 1546965903, "last_edit_date": 1546969225, "question_id": 54096182, "link": "https://stackoverflow.com/questions/54096182/cannot-find-nested-package", "title": "Cannot find nested package", "body": "<p>I have a project with the following structure:</p>\n\n<pre><code>myapp/\n  -services/\n     -services/\n         -exch.go\n     -services.go\n  -server.go\n</code></pre>\n\n<p>Having $GOPATH set to <code>/home/dev/dev/go</code>\nthis is how <code>server.go</code> names it's package and imports:</p>\n\n<pre><code>//server.go\npackage main\n\nimport (\n  \"net/http\"\n  \"github.com/labstack/echo\"\n  \"myapp/services\"\n)\n</code></pre>\n\n<p>this is <code>services.go</code>: </p>\n\n<pre><code>//services.go\npackage services\n\nimport (\n  \"fmt\"\n  \"myapp/services/exch\"\n)\n</code></pre>\n\n<p>and this is <code>exch.go</code>:</p>\n\n<pre><code>//exch.go\npackage exch\n\nimport (\n  \"net/http\"\n  \"fmt\"\n  \"io/ioutil\"\n  \"encoding/json\n)\n</code></pre>\n\n<p>Now, <code>server.go</code> imports <code>package services</code> fine, but <code>services.go</code> cannot find <code>package exch</code>. I tried changing the imports path several ways but cannot make it work. Am I missing something?</p>\n\n<p>Might be useful to know that /myapp is located here: /home/dev/dev/go/src</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1546965608, "post_id": 54096022, "comment_id": 95024672, "body": "If the code is at <code>github.com&#47;account_name&#47;test&#47;go&#47;src&#47;mod2&#47;mod2_lib</code>, then that is the import path. That&#39;s how imports work. I&#39;m not sure why the <code>src</code> part is in there, and it may cause you some issues (Go will detect it as a GOPATH). As to the compile error, have you done a <code>go get</code> or otherwise added <code>mod2</code> to the go.mod for <code>mod1</code>?"}, {"owner": {"reputation": 7826, "user_id": 51923, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/7a491ebe0536e388a07b5a726247bab2?s=128&d=identicon&r=PG", "display_name": "deepblue", "link": "https://stackoverflow.com/users/51923/deepblue"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546966242, "post_id": 54096022, "comment_id": 95025032, "body": "ok I&#39;ll definitely remove the <code>src</code> part. but Im dealing with that after I get the above described simple case (all modules/packages are in the root dir) working"}, {"owner": {"reputation": 7826, "user_id": 51923, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/7a491ebe0536e388a07b5a726247bab2?s=128&d=identicon&r=PG", "display_name": "deepblue", "link": "https://stackoverflow.com/users/51923/deepblue"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546966481, "post_id": 54096022, "comment_id": 95025155, "body": "@Adrian when I do a <code>go get</code> Im still getting <code>build github.com&#47;account_name&#47;test&#47;mod1: cannot find module for path github.com&#47;account_name&#47;test&#47;mod2&#47;mod2_lib</code>"}, {"owner": {"reputation": 7826, "user_id": 51923, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/7a491ebe0536e388a07b5a726247bab2?s=128&d=identicon&r=PG", "display_name": "deepblue", "link": "https://stackoverflow.com/users/51923/deepblue"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546969817, "post_id": 54096022, "comment_id": 95026861, "body": "@Adrian question, with this setup if I make a change in <code>mod2</code> locally, without pushing it to github.com, <code>mod1</code> is not detecting that change locally and its still using the remote version. Any idea on how to handle this with this module structure (outside the <code>GOPATH</code>)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1546970140, "post_id": 54096022, "comment_id": 95027027, "body": "You can use <code>replace</code> to explicitly point at your local copy of the dependency: <a href=\"https://github.com/golang/go/wiki/Modules#can-i-work-entirely-outside-of-vcs-on-my-local-filesystem\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}, {"owner": {"reputation": 7826, "user_id": 51923, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/7a491ebe0536e388a07b5a726247bab2?s=128&d=identicon&r=PG", "display_name": "deepblue", "link": "https://stackoverflow.com/users/51923/deepblue"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546970311, "post_id": 54096022, "comment_id": 95027101, "body": "if the local copy is not present (for people that are <code>get</code>/<code>build</code>-ing for the first time) will it still initially pull from github.com?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546970593, "post_id": 54096022, "comment_id": 95027218, "body": "Not if the <code>replace</code> is in the <code>go.mod</code> committed to the repo, no. So you&#39;ll want to change it only locally, only for testing changes in the dependency."}, {"owner": {"reputation": 7826, "user_id": 51923, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/7a491ebe0536e388a07b5a726247bab2?s=128&d=identicon&r=PG", "display_name": "deepblue", "link": "https://stackoverflow.com/users/51923/deepblue"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546970729, "post_id": 54096022, "comment_id": 95027285, "body": "thats what I thought. ok, I&#39;ll figure out how to best structure it. thanks @Adrian! much appreciated :)"}], "answers": [{"tags": [], "owner": {"reputation": 7826, "user_id": 51923, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/7a491ebe0536e388a07b5a726247bab2?s=128&d=identicon&r=PG", "display_name": "deepblue", "link": "https://stackoverflow.com/users/51923/deepblue"}, "is_accepted": false, "score": -1, "last_activity_date": 1546969236, "creation_date": 1546969236, "answer_id": 54097006, "question_id": 54096022, "link": "https://stackoverflow.com/questions/54096022/multiple-go-modules-in-a-monorepo-and-custom-dir-structure/54097006#54097006", "title": "multiple Go modules in a monorepo and custom dir structure", "body": "<p>the issue was that it was a private github.com repo. making it public fixed it! :) have to figure out authentication now for the module system.</p>\n"}], "owner": {"reputation": 7826, "user_id": 51923, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/7a491ebe0536e388a07b5a726247bab2?s=128&d=identicon&r=PG", "display_name": "deepblue", "link": "https://stackoverflow.com/users/51923/deepblue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1639, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546969236, "creation_date": 1546965382, "question_id": 54096022, "link": "https://stackoverflow.com/questions/54096022/multiple-go-modules-in-a-monorepo-and-custom-dir-structure", "title": "multiple Go modules in a monorepo and custom dir structure", "body": "<p>I have 2 possibly related issues.</p>\n\n<p>I have a test monorepo setup, with 2 subdirectories (<code>mod1</code> and <code>mod2</code>).<br>\nEach one of them has a <code>go.mod</code> file in them, and each of the modules has a single <code>.go</code> file with basic printing code. in <code>mod2</code> there is a subdirectory <code>mod2_lib</code> (that holds one of those simple <code>.go</code> files with basic printing code), since I read that Go modules are basically their own little <code>GOPATH</code>'s.  </p>\n\n<p><a href=\"https://i.stack.imgur.com/2nKMg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2nKMg.png\" alt=\"enter image description here\"></a></p>\n\n<p>Id like to call function <code>Run()</code> thats in a package <code>mod2/mod2_lib</code> from <code>mod1</code>, but all Im getting is <code>build github.com/account_name/test/mod1: cannot find module for path github.com/account_name/test/mod2/mod2_lib</code>.</p>\n\n<p>here are the files Im using to figure this out:</p>\n\n<p>mod1/t.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/account_name/test/mod2/mod2_lib\"\n)\n\nfunc main() {\n    fmt.Println(\"mod1\")\n    mod2_lib.Run()\n}\n</code></pre>\n\n<p>mod2/mod2_lib/t_lib.go</p>\n\n<pre><code>package mod2_lib\n\nimport \"fmt\"\n\nfunc Run() {\n    fmt.Println(\"RUNS\")\n}\n</code></pre>\n\n<p>the second issue is that in this monorepo I'd like to have related Python and Rust code in top-level dirs <code>py</code> and <code>rust</code>. So I'd like to place all my Go packages in the <code>go/src</code> dir. How would other people import this <code>go/src</code> path into their project (possibly still having the <code>\"github.com/account_name/test/mod2/mod2_lib\"</code> as the import path, and not <code>\"github.com/account_name/test/go/src/mod2/mod2_lib\"</code>)? </p>\n\n<p>can anyone give me some pointers on these issues? I want to move to using Golang modules, and abandon the <code>GOPATH</code>.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1546962682, "post_id": 54095244, "comment_id": 95022993, "body": "No. The regexp syntax is well-documented: <a href=\"https://golang.org/pkg/regexp/syntax/\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp/syntax</a>"}, {"owner": {"reputation": 6910, "user_id": 23080, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5d60ba2e8c68be5d5b144ebe97e541de?s=128&d=identicon&r=PG", "display_name": "dimus", "link": "https://stackoverflow.com/users/23080/dimus"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1546962923, "post_id": 54095244, "comment_id": 95023123, "body": "I wonder what was a rationale, Go seem to value readability as an important design goal."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1546963027, "post_id": 54095244, "comment_id": 95023177, "body": "Motivation for design decisions is a question for the designers, not the community."}, {"owner": {"reputation": 6910, "user_id": 23080, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5d60ba2e8c68be5d5b144ebe97e541de?s=128&d=identicon&r=PG", "display_name": "dimus", "link": "https://stackoverflow.com/users/23080/dimus"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546963124, "post_id": 54095244, "comment_id": 95023240, "body": "hopefully designers are part of the community?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1546963235, "post_id": 54095244, "comment_id": 95023304, "body": "They may be, but SO is for asking a question of the community at large. If there is a specific person who can answer your question and likely no one else, your question should be directed at them, not the community."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1546963399, "post_id": 54095244, "comment_id": 95023415, "body": "As there are no regexp <i>literals</i> in Go you do not need this feature: You parse a string and you can break up your string and reassemble that string with <code>+</code> which lets you split your &quot;regexp&quot; over several lines just as you wanted."}, {"owner": {"reputation": 6910, "user_id": 23080, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5d60ba2e8c68be5d5b144ebe97e541de?s=128&d=identicon&r=PG", "display_name": "dimus", "link": "https://stackoverflow.com/users/23080/dimus"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1546967510, "post_id": 54095244, "comment_id": 95025756, "body": "Thank you @Volker, now I understood the rationale of not including &#39;x&#39; flag."}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 3, "last_activity_date": 1546963564, "creation_date": 1546963564, "answer_id": 54095536, "question_id": 54095244, "link": "https://stackoverflow.com/questions/54095244/regular-expressions-in-go-that-span-multiple-lines/54095536#54095536", "title": "Regular expressions in Go that span multiple lines", "body": "<p>Laying out using + looks slightly better and at least splits up the regexp</p>\n\n<pre><code>var taxonConceptsRe2 = regexp.MustCompile(\n    `(,\\s*|\\s+)(\\(?s\\.\\s?s\\.|` +\n        `\\(?s\\.\\s?l\\.|` +\n        `\\(?s\\.\\s?str\\.|` +\n        `\\(?s\\.\\s?lat\\.).*$`)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1546963782, "creation_date": 1546963782, "answer_id": 54095587, "question_id": 54095244, "link": "https://stackoverflow.com/questions/54095244/regular-expressions-in-go-that-span-multiple-lines/54095587#54095587", "title": "Regular expressions in Go that span multiple lines", "body": "<p>You have a few options to improve readability of a regular expression like this.</p>\n\n<ol>\n<li><p>Split the string:</p>\n\n<pre><code>pattern := `(,\\s*|\\s+)` +\n    `(\\(?s\\.\\s?s\\.|` +\n    `\\(?s\\.\\s?l\\.|` +\n    `\\(?s\\.\\s?str\\.|` +\n    `\\(?s\\.\\s?lat\\.).*$`\n</code></pre></li>\n<li><p>Pre-parse the string:</p>\n\n<pre><code>pattern := strings.Replace(`\\s+\n                 (\\(?s\\.\\s?s\\.|\n                 \\(?s\\.\\s?l\\.|\n                 \\(?s\\.\\s?str\\.|\n                 \\(?s\\.\\s?lat\\.|\n                sec\\.|sec|near)\\b.*$`,\n        \"\\n                \", \"\", -1)\n</code></pre>\n\n<p>If you choose this approach, you'll probably want to build a function to do this for you, and to be a bit more robust.</p></li>\n<li><p>Don't use a regexp. (Obviously not always ideal, but regexes are often very overused, so do this one if it makes sense.)</p></li>\n</ol>\n"}], "owner": {"reputation": 6910, "user_id": 23080, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5d60ba2e8c68be5d5b144ebe97e541de?s=128&d=identicon&r=PG", "display_name": "dimus", "link": "https://stackoverflow.com/users/23080/dimus"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 984, "favorite_count": 0, "closed_date": 1546971216, "accepted_answer_id": 54095587, "answer_count": 2, "score": -4, "last_activity_date": 1546984530, "creation_date": 1546962497, "last_edit_date": 1546984530, "question_id": 54095244, "link": "https://stackoverflow.com/questions/54095244/regular-expressions-in-go-that-span-multiple-lines", "closed_reason": "Opinion-based", "title": "Regular expressions in Go that span multiple lines", "body": "<p>Is it possible in Go to break a complex regular expression using multiple lines? It would help a lot to create a more readable code.</p>\n\n<p>For example in Scala, Ruby, JavaScript it is possible to use <code>x</code> flag:</p>\n\n<p><code>x \u2014 Free-spacing and line comments (aka extended mode)</code></p>\n\n<p>And it allows to write regular expression like:</p>\n\n<pre><code>  TAXON_CONCEPTS2 = /\\s+\n                     (\\(?s\\.\\s?s\\.|\n                     \\(?s\\.\\s?l\\.|\n                     \\(?s\\.\\s?str\\.|\n                     \\(?s\\.\\s?lat\\.|\n                    sec\\.|sec|near)\\b.*$/x\n</code></pre>\n\n<p>I would like to achieve similar code in Go instead of:</p>\n\n<pre><code>var taxonConceptsRe2 = regexp.MustCompile(`(,\\s*|\\s+)(\\(?s\\.\\s?s\\.|\\(?s\\.\\s?l\\.|\\(?s\\.\\s?str\\.|\\(?s\\.\\s?lat\\.).*$`)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 1, "creation_date": 1546955372, "post_id": 54092981, "comment_id": 95018364, "body": "hmm, I&#39;d be interested what people have to say - doesnt look like that RLock is needed to me, the nil check is sufficient - perhaps Im missing something, it may depend on wider context but I think as long as you check for nil, aquire the lock and then check it is still nil (in case another thread initialised in that microsecond) it should be fine"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546955479, "post_id": 54092981, "comment_id": 95018422, "body": "I don&#39;t understand the last sentence. Why do you think there should be an additional nil check?"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1546955534, "post_id": 54092981, "comment_id": 95018456, "body": "thinking another thread could initialise in the split second between the check for nil and aquiring the lock, strangley though you seem to have suggested the rlock IS needed in your answer"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546955794, "post_id": 54092981, "comment_id": 95018621, "body": "Oh, you mean between <code>mutext.Unlock()</code> and <code>mutex.Lock()</code>? That&#39;s not a problem, because if a lock is established by another goroutine at thta juncture, the <code>Lock</code> call will block until all other locks are released."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1546955842, "post_id": 54092981, "comment_id": 95018643, "body": "Without locking double-checked &quot;locking&quot; doesn&#39;t work. Maybe if you carefully used memory barriers. One possible error is lack of ordering. The pointer can be set but the object not initialized. Even if the other thread initialized it before setting the pointer."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1546955989, "post_id": 54092981, "comment_id": 95018721, "body": "Sorry, no this is what i meant, see here (not working but shows what i mean) with no need for rlock - <a href=\"https://play.golang.org/p/_P3-8r4LQfz\" rel=\"nofollow noreferrer\">play.golang.org/p/_P3-8r4LQfz</a>"}, {"owner": {"reputation": 7735, "user_id": 2761035, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/DoPCR.png?s=128&g=1", "display_name": "codingenious", "link": "https://stackoverflow.com/users/2761035/codingenious"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546956316, "post_id": 54092981, "comment_id": 95018868, "body": "@Flimzy What I mean by last statement is - Once syncProducer is initialized and when next time <code>checkSyncProducer</code> is called, func will take RLock even though it is not required now. Adding one more nil check before taking RLock will prevent this, right?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1546956484, "post_id": 54092981, "comment_id": 95018966, "body": "But there&#39;s already a second nil check ..."}, {"owner": {"reputation": 7735, "user_id": 2761035, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/DoPCR.png?s=128&g=1", "display_name": "codingenious", "link": "https://stackoverflow.com/users/2761035/codingenious"}, "edited": false, "score": 0, "creation_date": 1546956682, "post_id": 54092981, "comment_id": 95019095, "body": "I edited question. Is second piece of code better than first in terms of performance given function is called multiple times."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1546956804, "post_id": 54092981, "comment_id": 95019188, "body": "That second implementation is susceptible to the race condition that the lock is supposed to prevent. <code>syncProducer</code> must not be read without holding at least a read lock, and must not be assigned without holding the write lock."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546957043, "post_id": 54092981, "comment_id": 95019351, "body": "The second code block will crash, due to the race condition."}, {"owner": {"reputation": 7735, "user_id": 2761035, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/DoPCR.png?s=128&g=1", "display_name": "codingenious", "link": "https://stackoverflow.com/users/2761035/codingenious"}, "edited": false, "score": 0, "creation_date": 1546957706, "post_id": 54092981, "comment_id": 95019777, "body": "Yeah. Now I understand it. And it seems to me now that question itself was sore. :)"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1546955463, "creation_date": 1546955463, "answer_id": 54093271, "question_id": 54092981, "link": "https://stackoverflow.com/questions/54092981/double-checked-locking-in-golang-why-mutex-rlock-is-required/54093271#54093271", "title": "Double checked locking in golang - Why mutex.RLock() is required?", "body": "<p>It's required because the check is a read-only operation. Doing a RW lock instead would be possible, but would mean that only one goroutine at a time could do the check.</p>\n"}, {"comments": [{"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 1, "creation_date": 1546957640, "post_id": 54093845, "comment_id": 95019726, "body": "see this SO question for an explanation: go assignments are not guaranteed to be atomic: <a href=\"https://stackoverflow.com/questions/34750323/is-variable-assignment-atomic-in-go\" title=\"is variable assignment atomic in go\">stackoverflow.com/questions/34750323/&hellip;</a>"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1546957875, "post_id": 54093845, "comment_id": 95019887, "body": "i dont think that would apply to a nil check - something is either nil or not it cant be part nil"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "reply_to_user": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 2, "creation_date": 1546958217, "post_id": 54093845, "comment_id": 95020091, "body": "@SwiftD the pointer can be partly written to RAM as it&#39;s read. Then you might get some 0 bytes, and some pointer bytes. So not nil, but not a valid pointer either. As I say in the question, whether this can actually happen or not depends on the architecture etc. It&#39;s still probably OK if you acquire a read lock later when you read the variable, but I guess the point of this code is to avoid that."}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 2, "creation_date": 1546958715, "post_id": 54093845, "comment_id": 95020414, "body": "Good explanation of the locking <a href=\"https://launchdarkly.com/blog/golang-pearl-thread-safe-writes-and-double-checked-locking-in-go/\" rel=\"nofollow noreferrer\">launchdarkly.com/blog/&hellip;</a>"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "reply_to_user": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546958904, "post_id": 54093845, "comment_id": 95020528, "body": "@thst thanks for that -- I&#39;d just added a sync.Once example in my answer independently, but I see the article suggests it at the end..."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 6, "last_activity_date": 1546958788, "last_edit_date": 1546958788, "creation_date": 1546957464, "answer_id": 54093845, "question_id": 54092981, "link": "https://stackoverflow.com/questions/54092981/double-checked-locking-in-golang-why-mutex-rlock-is-required/54093845#54093845", "title": "Double checked locking in golang - Why mutex.RLock() is required?", "body": "<p>If you don't acquire a RLock to read <code>syncProducer</code>, it's a data race, since another goroutine may update it.</p>\n\n<p>If you assume reads/writes to pointer variables are atomic, this looks harmless -- the racy read of <code>syncProducer</code> can never cause incorrect behavior. If you don't make this atomic assumption, the read could produce just some of the bytes of the pointer if you're unlucky, and your program would crash.</p>\n\n<p>It may or may not be possible depending on the architecture, machine word size, compiler version, etc. that you're using. But the <code>RLock</code> avoids any concern.</p>\n\n<p>Rather than explicitly mess around with RWLocks, it's probably better to use this (assuming the goal is to lazily initialize a variable):</p>\n\n<pre><code>var (\n    syncOnce sync.Once\n    syncProducerInternal *syncProducerType\n)\n\nfunc syncProducer() *syncProducerType {\n    syncOnce.Do(func() { syncProducerInternal = createSyncKafkaProducer() })\n    return syncProducerInternal\n}\n</code></pre>\n\n<p>Then code that needs the sync producer can call the <code>syncProducer()</code> function to get it, and never see a nil pointer.</p>\n"}], "owner": {"reputation": 7735, "user_id": 2761035, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/DoPCR.png?s=128&g=1", "display_name": "codingenious", "link": "https://stackoverflow.com/users/2761035/codingenious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1056, "favorite_count": 0, "accepted_answer_id": 54093845, "answer_count": 2, "score": 1, "last_activity_date": 1546958788, "creation_date": 1546954444, "last_edit_date": 1546956622, "question_id": 54092981, "link": "https://stackoverflow.com/questions/54092981/double-checked-locking-in-golang-why-mutex-rlock-is-required", "title": "Double checked locking in golang - Why mutex.RLock() is required?", "body": "<p>I have a piece of code from <a href=\"https://launchdarkly.com/blog/golang-pearl-thread-safe-writes-and-double-checked-locking-in-go/\" rel=\"nofollow noreferrer\">this website</a> which has double checked locking for initialization of an object.</p>\n\n<pre><code>func checkSyncProducer() {\n    mutex.RLock()\n    if syncProducer == nil {\n        mutex.RUnlock()\n        mutex.Lock()\n        defer mutex.Unlock()\n        if syncProducer == nil {\n            syncProducer  = createSyncKafkaProducer() //this func will initialize syncProducer.\n        }\n    } else {\n        defer mutex.RUnlock()\n    }\n}\n</code></pre>\n\n<p>This piece of code has <code>mutex.RLock()</code> before first nil check. </p>\n\n<p>Why is that required? (it is explained in the page but I couldn't understand) And doesn't it add overhead becuase everytime checkSyncProducer is called read lock will be taken and released. </p>\n\n<p>Should there be one more nil check before acquiring read lock like:</p>\n\n<pre><code>func checkSyncProducer() {\n    if syncProducer == nil {\n        mutex.RLock()\n        if syncProducer == nil {\n            mutex.RUnlock()\n            mutex.Lock()\n            defer mutex.Unlock()\n            if syncProducer == nil {\n                createSyncKafkaProducer()\n            }\n        } else {\n            defer mutex.RUnlock()\n        }\n    }\n}\n</code></pre>\n\n<p>First nil check will ensure that RLock is not taken unnecessarily. Am I correct? </p>\n"}, {"tags": ["go", "profiling", "interrupt", "sigint"], "answers": [{"comments": [{"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1546954947, "post_id": 54093031, "comment_id": 95018098, "body": "Thanks for the solution."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1546954597, "creation_date": 1546954597, "answer_id": 54093031, "question_id": 54092782, "link": "https://stackoverflow.com/questions/54092782/override-golang-profile-stop-in-case-of-interrupt/54093031#54093031", "title": "Override golang profile stop in case of interrupt", "body": "<p>There is a <a href=\"https://godoc.org/github.com/pkg/profile#NoShutdownHook\" rel=\"noreferrer\"><code>profile.NoShutdownHook</code></a> function which controls whether the profiling package should hook SIGINT, on which to write profiles cleanly.</p>\n\n<p>You may use / pass the above mentioned function as an option to <a href=\"https://godoc.org/github.com/pkg/profile#Start\" rel=\"noreferrer\"><code>profile.Start()</code></a> if you want to disable this behavior:</p>\n\n<pre><code>profile.Start(profile.NoShutdownHook)\n</code></pre>\n\n<p>Starting and stopping the profiling inside a function is best done via deferred, e.g.:</p>\n\n<pre><code>// disable the automatic shutdown hook.\ndefer profile.Start(profile.NoShutdownHook).Stop()\n</code></pre>\n\n<p>If you disable the automatic shutdown hook, make sure you call <code>Stop()</code> manually in your shutdown handler properly.</p>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "accepted_answer_id": 54093031, "answer_count": 1, "score": 2, "last_activity_date": 1546972909, "creation_date": 1546953792, "last_edit_date": 1546972909, "question_id": 54092782, "link": "https://stackoverflow.com/questions/54092782/override-golang-profile-stop-in-case-of-interrupt", "title": "Override golang profile stop in case of interrupt", "body": "<p>When I <code>kill -SIGINT pid</code> on my Golang service I have a graceful shutdown where I call the <code>profile.Stop</code>, but before I could call it I got this message: <code>profile: caught interrupt, stopping profiles</code></p>\n\n<p>I can't even call the profile.Stop because it's triggered sooner, however the grpc listen and couchbase connection shutdowns works properly. </p>\n\n<p>Is there anyway I can override this malfunctioning profile stop?</p>\n"}, {"tags": ["string", "go"], "answers": [{"comments": [{"owner": {"reputation": 575, "user_id": 1393136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70cefa201e790be5d2d4204b06d60b62?s=128&d=identicon&r=PG", "display_name": "Amudhan", "link": "https://stackoverflow.com/users/1393136/amudhan"}, "edited": false, "score": 0, "creation_date": 1546951920, "post_id": 54092082, "comment_id": 95016356, "body": "Thank you! I tried strings.C (in GoLand) and couldn&#39;t find any Create kind of method. Didn&#39;t occur to me to look for Repeat method (strings.R would have suggested that). I will accept the answer in 5 mins (SOF restriction)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1546952042, "last_edit_date": 1546952042, "creation_date": 1546951440, "answer_id": 54092082, "question_id": 54092016, "link": "https://stackoverflow.com/questions/54092016/how-to-create-a-string-of-arbitrary-length/54092082#54092082", "title": "How to create a string of arbitrary length", "body": "<p>Your <code>createPayload()</code> creates a byte slice with the given length, which is filled with zeros by default (<a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a>). Then you append <code>len</code> number of <code>runes</code> to this slice, so the result will be double the length you intend to create (given the <code>rune</code> is less than <code>127</code>), and that's why you see zeros then followed by the <code>'A'</code> rune when printed.</p>\n\n<p>If you change it to:</p>\n\n<pre><code>payload := make([]byte, 0, len)\n</code></pre>\n\n<p>Then the result will be what you want.</p>\n\n<p>But easier would be to simply use <a href=\"https://golang.org/pkg/strings/#Repeat\" rel=\"nofollow noreferrer\"><code>strings.Repeat()</code></a> which repeats a given <code>string</code> value <code>n</code> times. Repeat a one-rune (or more specifically a one-byte) <code>string</code> value <code>n</code> times, and you get what you want:</p>\n\n<pre><code>s := strings.Repeat(\"A\", 10)\nfmt.Println(len(s), s)\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/SJMMeLHYibf\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>10 AAAAAAAAAA\n</code></pre>\n\n<p>If you don't care about the content of the <code>string</code> only about its length, then simply convert a byte slice like this:</p>\n\n<pre><code>s := string(make([]byte, 1024))\nfmt.Println(len(s))\n</code></pre>\n\n<p>Or alternatively like this:</p>\n\n<pre><code>s2 := string([]byte{1023: 0})\nfmt.Println(len(s2))\n</code></pre>\n\n<p>Both prints <code>1024</code>. Try them on the <a href=\"https://play.golang.org/p/CFf-UpczzTy\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>If you do care about the content and you already have a byte slice allocated, this is how you can efficiently fill it: <a href=\"https://stackoverflow.com/questions/30614165/is-there-analog-of-memset-in-go/30614594#30614594\">Is there analog of memset in go?</a></p>\n"}], "owner": {"reputation": 575, "user_id": 1393136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70cefa201e790be5d2d4204b06d60b62?s=128&d=identicon&r=PG", "display_name": "Amudhan", "link": "https://stackoverflow.com/users/1393136/amudhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 54092082, "answer_count": 1, "score": 0, "last_activity_date": 1546952084, "creation_date": 1546951206, "last_edit_date": 1546952084, "question_id": 54092016, "link": "https://stackoverflow.com/questions/54092016/how-to-create-a-string-of-arbitrary-length", "title": "How to create a string of arbitrary length", "body": "<p>I want to create a dummy string of a given length to do a performance test. For example I want to first test with 1 KB of string and then may be 10 KB of string etc. I don't care which character (or rune?) it gets filled with. I understand that a string in Go is backed by byte array. So, I want the final string to be backed by a byte array of size equivalent of 1 KB (if I give 1024 as the argument).</p>\n\n<p>For example, I tried the brute force code below:</p>\n\n<pre><code>...\n    oneKBPayload := createPayload(1024, 'A')\n...\n//I don't mind even if the char argument is removed and 'A' is used for example \nfunc createPayload(len int, char rune) string {\n    payload := make([]byte, len)\n    for i := 0; i &lt; len; i++ {\n        payload = append(payload, byte(char))\n    }\n    return string(payload[:])\n}\n</code></pre>\n\n<p>and it produced a result of (for 10 length)</p>\n\n<pre><code>\"\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000\\u0000AAAAAAAAAA\"\n</code></pre>\n\n<p>I realize that it has something to do with the encoding. But how to fix this so that I create any string which is backed by a byte array of the given length so that when I write it over the network, I generate the intended payload.</p>\n"}, {"tags": ["mysql", "go", "go-iris"], "comments": [{"owner": {"reputation": 2454, "user_id": 2520628, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/0zmcN.jpg?s=128&g=1", "display_name": "Tejashwi Kalp Taru", "link": "https://stackoverflow.com/users/2520628/tejashwi-kalp-taru"}, "edited": false, "score": 0, "creation_date": 1546953850, "post_id": 54091221, "comment_id": 95017426, "body": "Your <code>TopicId</code> is an array, and you can not simply insert an array into the database, instead you should loop around <code>TopicId</code> and then insert each one (keeping database normalized), if you need I can provide you a sample"}, {"owner": {"reputation": 610, "user_id": 9511080, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-1TcPKyXgd68/AAAAAAAAAAI/AAAAAAAADeQ/7l6ryehEUyA/photo.jpg?sz=128", "display_name": "Harsh Nagalla", "link": "https://stackoverflow.com/users/9511080/harsh-nagalla"}, "reply_to_user": {"reputation": 2454, "user_id": 2520628, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/0zmcN.jpg?s=128&g=1", "display_name": "Tejashwi Kalp Taru", "link": "https://stackoverflow.com/users/2520628/tejashwi-kalp-taru"}, "edited": false, "score": 0, "creation_date": 1546954573, "post_id": 54091221, "comment_id": 95017887, "body": "can you plz give me a sample it would be very helpful as i am new to go ."}], "answers": [{"tags": [], "owner": {"reputation": 2454, "user_id": 2520628, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/0zmcN.jpg?s=128&g=1", "display_name": "Tejashwi Kalp Taru", "link": "https://stackoverflow.com/users/2520628/tejashwi-kalp-taru"}, "is_accepted": true, "score": 0, "last_activity_date": 1546955084, "creation_date": 1546955084, "answer_id": 54093163, "question_id": 54091221, "link": "https://stackoverflow.com/questions/54091221/how-to-insert-multiple-rows/54093163#54093163", "title": "How to insert multiple rows", "body": "<p>You can not simply insert an array into the database. Instead, you should loop around the <code>TopicId</code> and insert them one by one</p>\n\n<pre><code>func AddTopicModule(atm TopicModule) (string, bool) {\n    log.Println(\"the topic is \", atm.TopicId)\n    db := DatabaseAccess()\n    tx, _ := db.Begin()\n    for _, value = range(atm.TopicId){\n        stmt, err := tx.Prepare(\"insert into ModuleTopic(module_id, topic_id, added_by) Values(?,?,?) \")\n        if err != nil {\n            return \"\", false\n        }\n        res, err := stmt.Exec(atm.ModuleId, value, \"Harsh\")\n        if err != nil {\n            tx.Rollback()\n            return \"\", false\n        }\n        tx.Commit()\n    }\n    return \"aa\", true\n}\n</code></pre>\n\n<p>This will create 2 entries in the database for the JSON provided by you.</p>\n\n<pre><code>|---------------------|------------------|------------------|\n|      module_id      |     topic_id     |     added_by     |\n|---------------------|------------------|------------------|\n|          M101       |         tt       |     Harsh        |\n|---------------------|------------------|------------------|\n|          M101       |         ee       |     Harsh        |\n|---------------------|------------------|------------------|\n</code></pre>\n\n<p>To get them, simply query your database:</p>\n\n<pre><code>SELECT * FROM ModuleTopic WHERE module_id = M101;\n</code></pre>\n"}], "owner": {"reputation": 610, "user_id": 9511080, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-1TcPKyXgd68/AAAAAAAAAAI/AAAAAAAADeQ/7l6ryehEUyA/photo.jpg?sz=128", "display_name": "Harsh Nagalla", "link": "https://stackoverflow.com/users/9511080/harsh-nagalla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 54093163, "answer_count": 1, "score": -1, "last_activity_date": 1546955084, "creation_date": 1546948177, "last_edit_date": 1546953151, "question_id": 54091221, "link": "https://stackoverflow.com/questions/54091221/how-to-insert-multiple-rows", "title": "How to insert multiple rows", "body": "<p>I am actually very new to Go so wanted to know the best way to insert data like this </p>\n\n<pre><code>{\n    \"moduleId\":\"M101\",\n    \"topicId\":[\"tt\",\"ee\"]\n}\n</code></pre>\n\n<p>in MySQL database using Go </p>\n\n<pre><code>type TopicModule struct {\n    ModuleId string   `json:\"moduleId\" bson:\"moduleId\" form:\"moduleId\"`\n    TopicId  []string `json:\"topicId\" bson:\"topicId\" form:\"topicId\"`\n    AddedBy  string   `json:\"addedBy\" bson:\"addedBy\" form:\"addedBy\"`\n}\n\nfunc AddTopicModuleHandler(ctx iris.Context) {\n    topicmodule := new(TopicModule)\n    if err := ctx.ReadJSON(topicmodule); err != nil {\n        panic(err)\n        ctx.StatusCode(400)\n        return\n    }\n    log.Println(topicmodule.TopicId)\n    code, created := AddTopicModule(*topicmodule)\n\n    if created {\n        ctx.JSON(topicmodule)\n        ctx.Redirect(\"/api/module/\"+code, iris.StatusCreated)\n    }\n}\n\nfunc AddTopicModule(atm TopicModule) (string, bool) {\n\n    log.Println(\"the topic is \", atm.TopicId)\n    db := DatabaseAccess()\n    tx, _ := db.Begin()\n    stmt, err := tx.Prepare(\"insert into ModuleTopic(module_id, topic_id, added_by) Values(?,?,?) \")\n    res, err := stmt.Exec(atm.ModuleId, \"Ricky\")\n    res1, err := stmt.Exec(atm.ModuleId, \"Ric\")\n\n    if err != nil {\n        tx.Rollback()\n    }\n    tx.Commit()\n    log.Println(res, res1)\n    return \"aa\", true\n}\n</code></pre>\n\n<p>The expected result is to add the array of JSON into MySQL.</p>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1546945765, "post_id": 54090467, "comment_id": 95013276, "body": "Just subslice the string."}, {"owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "edited": false, "score": 0, "creation_date": 1546946512, "post_id": 54090467, "comment_id": 95013676, "body": "Maybe <a href=\"https://play.golang.org/p/_J_APWXLMD5\" rel=\"nofollow noreferrer\">this</a> could help, but I don&#39;t really know what your expecting result is. Do you want to know the position of each <code>=</code> in the string?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1546949754, "last_edit_date": 1546949754, "creation_date": 1546948446, "answer_id": 54091291, "question_id": 54090467, "link": "https://stackoverflow.com/questions/54090467/how-to-find-a-substring-skipping-n-chars/54091291#54091291", "title": "How to find a substring skipping N chars", "body": "<p>The <a href=\"https://golang.org/pkg/strings/\" rel=\"nofollow noreferrer\"><code>strings</code></a> package does not provide you such function, but in practice it's rarely needed. Often the <a href=\"https://golang.org/pkg/strings/#Split\" rel=\"nofollow noreferrer\"><code>strings.Split()</code></a> function is used to easily split strings into tokens / parts.</p>\n\n<p>But if you do need it: you can simply <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">slice</a> a <code>string</code>, which is efficient (no copy is made, the result shares memory with the original <code>string</code> value).</p>\n\n<p>So effectively the function you're looking for would look like this:</p>\n\n<pre><code>func Index(s, substr string, offset int) int {\n    if len(s) &lt; offset {\n        return -1\n    }\n    if idx := strings.Index(s[offset:], substr); idx &gt;= 0 {\n        return offset + idx\n    }\n    return -1\n}\n</code></pre>\n\n<p>Example using it:</p>\n\n<pre><code>s := \"something.value=something=end\"\nindex1 := strings.Index(s, \"value=\")\nfmt.Println(index1) // prints 10\n\nindex2 := Index(s, \"=\", index1+len(\"value=\"))\nfmt.Println(index2) // prints 25\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/gsMtHTN2PLr\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>10\n25\n</code></pre>\n\n<p>Note that when slicing a string, and the <code>offset</code> you have to pass to our <code>Index()</code> function is the byte index, not the <code>rune</code> (character) index. They are equal as long as you have characters with less than <code>128</code> codepoints, but beyond that the byte index will be greater than the <code>rune</code> index because those codepoints map to multiple bytes in UTF-8 encoding (which is how Go stores strings in memory). <code>strings.Index()</code> returns you the byte index, and <code>len(s)</code> also returns you the byte-length, so the example will work with all strings properly.</p>\n\n<p>Your original task using <code>strings.Split()</code> could look like this:</p>\n\n<pre><code>s := \"something.value=something=end\"\nparts := strings.Split(s, \"=\")\nfmt.Println(parts)\n</code></pre>\n\n<p>Which outputs (try it on the <a href=\"https://play.golang.org/p/OAzxbhnzh5-\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[something.value something end]\n</code></pre>\n\n<p>The value you want to \"parse\" out is in <code>parts[1]</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 11282719, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-sCnclkod9LU/AAAAAAAAAAI/AAAAAAAAABM/4BYFMo3_iWA/photo.jpg?sz=128", "display_name": "DevBazilio", "link": "https://stackoverflow.com/users/11282719/devbazilio"}, "is_accepted": false, "score": -1, "last_activity_date": 1566153351, "creation_date": 1566153351, "answer_id": 57547359, "question_id": 54090467, "link": "https://stackoverflow.com/questions/54090467/how-to-find-a-substring-skipping-n-chars/57547359#57547359", "title": "How to find a substring skipping N chars", "body": "<p>taking a slice of string with utf-8 characters may produce corrupted strings as you need to convert it to runes</p>\n\n<p><code>[]rune(videoHtml)[0:index</code>]</p>\n"}], "owner": {"reputation": 24806, "user_id": 123927, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/1b83301c2dd25b97a58600e4a1cee0d3?s=128&d=identicon&r=PG", "display_name": "Fluffy", "link": "https://stackoverflow.com/users/123927/fluffy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 468, "favorite_count": 0, "accepted_answer_id": 54091291, "answer_count": 2, "score": 0, "last_activity_date": 1566153351, "creation_date": 1546945583, "last_edit_date": 1546949773, "question_id": 54090467, "link": "https://stackoverflow.com/questions/54090467/how-to-find-a-substring-skipping-n-chars", "title": "How to find a substring skipping N chars", "body": "<p>How do I get the index of a substring in a string skipping starting with a certain position/with a certain offset, e.g.:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    string := \"something.value=something=end\"\n    index1 := strings.Index(string, \"value=\")\n    fmt.Println(index1) // prints 10\n    // index2 = ... How do I get the position of the second =, 25?\n}\n</code></pre>\n\n<p>Similar offset in PHP <code>int strpos ( string $haystack , mixed $needle [, int $offset = 0 ] )</code></p>\n"}, {"tags": ["go", "atomic", "data-race"], "answers": [{"comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1546947116, "post_id": 54090486, "comment_id": 95014005, "body": "<code>a</code> can still be concurrently modified between <code>LoadInt64</code> and <code>AddInt64</code>, yes?  (Even if the Go race detector doesn&#39;t explicitly flag this as a data race.)  You might need a <code>CompareAndSwapInt64</code> to be safe."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1546947788, "post_id": 54090486, "comment_id": 95014355, "body": "@DavidMaze Yes, you&#39;re right. I was only to show that the data race was because of the unsynchronized read of the variable <code>a</code>. Although in the example <code>a</code> will never grow beyond <code>100</code>, because the only other modification is a decrementing change. If more control is required, I&#39;d use a <code>sync.Mutex</code> instead."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1546945991, "last_edit_date": 1546945991, "creation_date": 1546945654, "answer_id": 54090486, "question_id": 54090404, "link": "https://stackoverflow.com/questions/54090404/what-is-causing-this-data-race/54090486#54090486", "title": "What is causing this data race?", "body": "<p>You didn't use the <code>atomic</code> package at <em>all</em> places where you accessed the variable. All access must be synchronized to variables that are accessed from multiple goroutines concurrently, including <em>reads</em>:</p>\n\n<pre><code>for {\n    if value := atomic.LoadInt64(&amp;a); value &lt; 100 {\n        atomic.AddInt64(&amp;a, 1)\n        go run()\n    }\n}\n</code></pre>\n\n<p>With that change, the race condition goes away.</p>\n\n<p>If you just want to inspect the value, you don't even need to store it in a variable, so you may simply do:</p>\n\n<pre><code>for {\n    if atomic.LoadInt64(&amp;a) &lt; 100 {\n        atomic.AddInt64(&amp;a, 1)\n        go run()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 10169802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wy16fDO_Y4Q/AAAAAAAAAAI/AAAAAAAAAC0/jPZiWvZrZmM/photo.jpg?sz=128", "display_name": "fatDuo", "link": "https://stackoverflow.com/users/10169802/fatduo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 54090486, "answer_count": 1, "score": 1, "last_activity_date": 1546949954, "creation_date": 1546945372, "last_edit_date": 1546949954, "question_id": 54090404, "link": "https://stackoverflow.com/questions/54090404/what-is-causing-this-data-race", "title": "What is causing this data race?", "body": "<p>Why does this code cause data race?\nI have already used atomic add.</p>\n\n<pre><code>package main\n\nimport (\n    \"sync/atomic\"\n    \"time\"\n)\n\nvar a int64\n\nfunc main() {\n    for {\n        if a &lt; 100 {\n            atomic.AddInt64(&amp;a, 1)\n            go run()\n        }\n    }\n}\n\nfunc run() {\n    &lt;-time.After(5 * time.Second)\n    atomic.AddInt64(&amp;a, -1)\n}\n</code></pre>\n\n<p>I run command <code>go run --race</code> with this code and get:</p>\n\n<pre><code>==================\nWARNING: DATA RACE\nWrite at 0x000001150f30 by goroutine 8:\n  sync/atomic.AddInt64()\n      /usr/local/Cellar/go/1.11.2/libexec/src/runtime/race_amd64.s:276 +0xb\n  main.run()\n      /Users/flask/test.go:22 +0x6d\n\nPrevious read at 0x000001150f30 by main goroutine:\n  main.main()\n      /Users/flask/test.go:12 +0x3a\n\nGoroutine 8 (running) created at:\n  main.main()\n      /Users/flask/test.go:15 +0x75\n==================\n</code></pre>\n\n<p>Could you help me explain this?\nAnd how to fix this warning?\nThanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546940901, "post_id": 54088822, "comment_id": 95010512, "body": "That string <i>is</i> a JSON object. Do you mean that you want to convert it to a Go struct?"}], "answers": [{"comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1546940176, "post_id": 54088887, "comment_id": 95010111, "body": "thats doens&#39;t make json object, it still string"}, {"owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 1, "creation_date": 1546940283, "post_id": 54088887, "comment_id": 95010172, "body": "thats the binary json string which the OP wants to return as response to HTTP request."}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1546940620, "post_id": 54088887, "comment_id": 95010357, "body": "there is no such thing like <i>the binary json string</i>. Your code is just an array of bytes."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1546941044, "post_id": 54088887, "comment_id": 95010581, "body": "@\u0417\u0435\u043b\u0451\u043d\u044b\u0439: JSON objects <i>are</i> strings. All JSON is represented as a string. If it&#39;s not a string, it&#39;s not JSON."}, {"owner": {"reputation": 135, "user_id": 5793538, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/edae7012e51b17db765a6aa25855b520?s=128&d=identicon&r=PG&f=1", "display_name": "Shank", "link": "https://stackoverflow.com/users/5793538/shank"}, "reply_to_user": {"reputation": 115, "user_id": 10769988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53e4261272cbc320c8f8d40af33cede3?s=128&d=identicon&r=PG&f=1", "display_name": "the ultimate user", "link": "https://stackoverflow.com/users/10769988/the-ultimate-user"}, "edited": false, "score": 0, "creation_date": 1546941099, "post_id": 54088887, "comment_id": 95010608, "body": "@rockstar JSON is a text format for data interchange..in case you want to understand better, try marshalling, say a struct to JSON and then print the stringified object..you will see the format similiar to your supportJsonString."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 135, "user_id": 5793538, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/edae7012e51b17db765a6aa25855b520?s=128&d=identicon&r=PG&f=1", "display_name": "Shank", "link": "https://stackoverflow.com/users/5793538/shank"}, "edited": false, "score": 1, "creation_date": 1546941181, "post_id": 54088887, "comment_id": 95010654, "body": "@Shank: All JSON is serialized. &quot;Serialized JSON&quot; would be a redundancy."}], "tags": [], "owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "is_accepted": true, "score": 3, "last_activity_date": 1546941152, "last_edit_date": 1546941152, "creation_date": 1546940110, "answer_id": 54088887, "question_id": 54088822, "link": "https://stackoverflow.com/questions/54088822/how-to-convert-string-to-json-obj/54088887#54088887", "title": "How to convert string to JSON obj?", "body": "<p>Its already a json object.\nAll you need to do is </p>\n\n<pre><code>jsonObj := []byte(supportJsonString)\n</code></pre>\n\n<p>You can then return it as HTTP response.\nBut in the most generic case, you would want to create a struct as response object and the marshal it to json instead of using strings this way.  </p>\n"}], "owner": {"reputation": 115, "user_id": 10769988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53e4261272cbc320c8f8d40af33cede3?s=128&d=identicon&r=PG&f=1", "display_name": "the ultimate user", "link": "https://stackoverflow.com/users/10769988/the-ultimate-user"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "closed_date": 1546941947, "accepted_answer_id": 54088887, "answer_count": 1, "score": -2, "last_activity_date": 1551252219, "creation_date": 1546939874, "last_edit_date": 1551252219, "question_id": 54088822, "link": "https://stackoverflow.com/questions/54088822/how-to-convert-string-to-json-obj", "closed_reason": "Duplicate", "title": "How to convert string to JSON obj?", "body": "<p>Below is the code that I've tried but to no avail:</p>\n\n<pre><code>    jsonObj, err := json.Marshal(supportJSONString)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n    }\n    fmt.Fprintf(w, \"%s\", jsonObj)\n</code></pre>\n"}, {"tags": ["go", "http-headers", "go-http"], "comments": [{"owner": {"reputation": 344, "user_id": 4179820, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VjMZ2.jpg?s=128&g=1", "display_name": "AKstat", "link": "https://stackoverflow.com/users/4179820/akstat"}, "edited": false, "score": 0, "creation_date": 1546939428, "post_id": 54088660, "comment_id": 95009709, "body": "Why not simply wrap this into a function for making requests?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1546939534, "post_id": 54088660, "comment_id": 95009765, "body": "Wrapping could work as long as you&#39;re the one using it directly. But once you have to hand over a client to another library that uses it in its own way, wrapping isn&#39;t sufficient anymore."}, {"owner": {"reputation": 5619, "user_id": 1723695, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/dx9jj.jpg?s=128&g=1", "display_name": "Kirill", "link": "https://stackoverflow.com/users/1723695/kirill"}, "edited": false, "score": 0, "creation_date": 1546939973, "post_id": 54088660, "comment_id": 95010007, "body": "Sure, I can wrap <code>client.Do</code> with custom function to append headers, but <code>client.Get</code> and <code>client.Post</code> looks more laconic than <code>client.NewRequest</code>, error checking, then <code>myDo</code> func."}], "answers": [{"tags": [], "owner": {"reputation": 5619, "user_id": 1723695, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/dx9jj.jpg?s=128&g=1", "display_name": "Kirill", "link": "https://stackoverflow.com/users/1723695/kirill"}, "is_accepted": false, "score": 2, "last_activity_date": 1546940113, "last_edit_date": 1546940113, "creation_date": 1546939221, "answer_id": 54088661, "question_id": 54088660, "link": "https://stackoverflow.com/questions/54088660/add-headers-for-each-http-request-using-client/54088661#54088661", "title": "Add headers for each HTTP request using client", "body": "<p>It's possible to configure <code>http.Client</code> to use custom transport, which can handle each request in the client (found this implementation in <a href=\"https://godoc.org/golang.org/x/oauth2\" rel=\"nofollow noreferrer\">golang.org/x/oauth2</a> library). This example appends headers to each http request:</p>\n\n<pre><code>type transport struct {\n    headers map[string]string\n    base    http.RoundTripper\n}\n\nfunc (t *transport) RoundTrip(req *http.Request) (*http.Response, error) {\n    for k, v := range t.headers {\n        req.Header.Add(k, v)\n    }\n    base := t.base\n    if base == nil {\n        base = http.DefaultTransport\n    }\n    return base.RoundTrip(req)\n}\n\nfunc main() {\n    cli := &amp;http.Client{\n        Transport: &amp;transport{\n            headers: map[string]string{\n                \"X-Test\": \"true\",\n            },\n        },\n    }\n    rsp, err := cli.Get(\"http://localhost:8080\")\n    defer rsp.Body.Close()\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 7, "last_activity_date": 1546940449, "creation_date": 1546940449, "answer_id": 54088988, "question_id": 54088660, "link": "https://stackoverflow.com/questions/54088660/add-headers-for-each-http-request-using-client/54088988#54088988", "title": "Add headers for each HTTP request using client", "body": "<p>I'm aware of three possible solutions to this.  In (my) order of preference:</p>\n\n<ol>\n<li><p>Wrap <code>http.NewRequest</code> with custom code that adds desired headers:</p>\n\n<pre><code>func MyRequest(method, path url, body io.Reader) (*http.Request, error) {\n    req, err := http.NewRequest(method, path, body)\n    if err != nil {\n        return nil, err\n    }\n    req.Header.Add(\"X-Test\", \"true\")\n    return req, nil\n}\n</code></pre>\n\n<p>This approach has the advantage of being straight-forward, non-magical, and portable. It will work with any third-party software, that adds its own headers, or sets custom transports.</p>\n\n<p>The only case where this won't work is if you depend on a third-party library to create your HTTP requests. I expect this is rare (I don't recall ever running into this in my own experience). And even in such a case, perhaps you can wrap <em>that</em> call instead.</p></li>\n<li><p>Wrap calls to <code>client.Do</code> to add headers, and possibly any other shared logic.</p>\n\n<pre><code>func MyDo(client *http.Client, req *http.Request) (*http.Response, error) {\n    req.Header.Add(\"X-Test\", \"true\")\n    // Any other common handling of the request\n    res, err := client.Do(req)\n    if err != nil {\n        return nil, err\n    }\n    // Any common handling of response\n    return res, nil\n}\n</code></pre>\n\n<p>This approach is also straight-forward, and has the added advantage (over #1) of making it easy to reduce other boilerplate.  This general method can also work very well in conjunction with #1.  One possible draw-back is that you must always call your <code>MyDo</code> method directly, meaning you cannot rely on third party software which calls <code>http.Do</code> itself.</p></li>\n<li><p>Use a custom <code>http.Transport</code></p>\n\n<pre><code>type myTransport struct{}\n\nfunc (t *myTransport) RoundTrip(req *http.Request) (*http.Response, error) {\n    req.Header.Add(\"X-Test\", \"true\")\n    return http.DefaultTransport.RoundTrip(req)\n}\n</code></pre>\n\n<p>Then use it like this:</p>\n\n<pre><code>client := &amp;Client{Transport: &amp;myTransport{}}\nreq := http.NewRequest(\"GET\", \"/foo\", nil)\nres, err := client.Do(req)\n</code></pre>\n\n<p>This approach has the advantage of working \"behind the scenes\" with just about any other software, so if you rely on a third-party library to create your <code>http.Request</code> objects, and to call <code>http.Do</code>, this may be your only option.</p>\n\n<p>However, this has the potential disadvantage of being non-obvious, and possibly breaking if you're using any third-party software which also sets a custom transport (without bothering to honor an existing custom transport).</p></li>\n</ol>\n\n<p>Ultimately, which method you use will depend on what type of portability you need with third-party software.  But if that's not a concern, I suggest using the most obvious solution, which, by my estimation, is the order provided above.</p>\n"}], "owner": {"reputation": 5619, "user_id": 1723695, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/dx9jj.jpg?s=128&g=1", "display_name": "Kirill", "link": "https://stackoverflow.com/users/1723695/kirill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3379, "favorite_count": 1, "accepted_answer_id": 54088988, "answer_count": 2, "score": 2, "last_activity_date": 1546941228, "creation_date": 1546939221, "last_edit_date": 1546941228, "question_id": 54088660, "link": "https://stackoverflow.com/questions/54088660/add-headers-for-each-http-request-using-client", "title": "Add headers for each HTTP request using client", "body": "<p>I know that I can add headers to each HTTP request manually using</p>\n\n<pre><code>cli := &amp;http.Client{}\nreq, err := http.NewRequest(\"GET\", \"https://myhost\", nil)\nreq.Header.Add(\"X-Test\", \"true\")\nif err != nil {\n    panic(err)\n}\nrsp, err := cli.Do(req)\n</code></pre>\n\n<p>but I want to add this header automatically for each HTTP request in my app.</p>\n\n<p>What is the best way to do it?</p>\n"}, {"tags": ["mysql", "datetime", "go"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 10185936, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9tyxQ1QwCsI/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pATscvZE8KQC9J_tFGEFSC5pMsdw/mo/photo.jpg?sz=128", "display_name": "Ruzaik Rafeek", "link": "https://stackoverflow.com/users/10185936/ruzaik-rafeek"}, "edited": false, "score": 0, "creation_date": 1546938456, "post_id": 54088376, "comment_id": 95009209, "body": "Then how come <code>(time.Time) 0001-01-01 01:00:00 +0000 UTC</code> goes through? I&#39;m guessing that 1000 is year thousand and 0001 is year 1?"}, {"owner": {"reputation": 36, "user_id": 3696766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5409343501395c2dd00b303b162d4c41?s=128&d=identicon&r=PG&f=1", "display_name": "Alan Tang", "link": "https://stackoverflow.com/users/3696766/alan-tang"}, "reply_to_user": {"reputation": 23, "user_id": 10185936, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9tyxQ1QwCsI/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pATscvZE8KQC9J_tFGEFSC5pMsdw/mo/photo.jpg?sz=128", "display_name": "Ruzaik Rafeek", "link": "https://stackoverflow.com/users/10185936/ruzaik-rafeek"}, "edited": false, "score": 0, "creation_date": 1546939006, "post_id": 54088376, "comment_id": 95009512, "body": "I think because all zero is means invalid. And server don&#39;t enable <code>ALLOW_INVALID_DATES</code> then it will show error. <code>0001-01-01 01:00:00</code> is a valid format. But just out of range?   &quot;The server requires that month and day values be valid, and not merely in the range 1 to 12 and 1 to 31, respectively. With strict mode disabled, invalid dates such as &#39;2004-04-31&#39; are converted to &#39;0000-00-00&#39; and a warning is generated. With strict mode enabled, invalid dates generate an error. To permit such dates, enable ALLOW_INVALID_DATES. See Section 5.1.11, \u201cServer SQL Modes\u201d, for more information.&quot;"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1546939147, "post_id": 54088376, "comment_id": 95009580, "body": "That same source also says &quot;Invalid DATE, DATETIME, or TIMESTAMP values are converted to the &#39;zero&#39; value of the appropriate type (<code>&#39;0000-00-00&#39;</code> or <code>&#39;0000-00-00 00:00:00&#39;</code>).&quot; This sounds to me like inserting Go&#39;s zero value should work if strict mode is disabled (with a warning, probably)."}], "tags": [], "owner": {"reputation": 36, "user_id": 3696766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5409343501395c2dd00b303b162d4c41?s=128&d=identicon&r=PG&f=1", "display_name": "Alan Tang", "link": "https://stackoverflow.com/users/3696766/alan-tang"}, "is_accepted": true, "score": 2, "last_activity_date": 1546938314, "last_edit_date": 1546938314, "creation_date": 1546938245, "answer_id": 54088376, "question_id": 54088321, "link": "https://stackoverflow.com/questions/54088321/inserting-gos-zero-time-time-value-into-a-mysql-datetime-column-errors/54088376#54088376", "title": "Inserting Go&#39;s zero time.Time value into a MySQL DATETIME column errors", "body": "<p>Because MySQL DATETIME valid range is '1000-01-01 00:00:00' to '9999-12-31 23:59:59'. All zero is out of range.</p>\n\n<blockquote>\n  <p>The DATETIME type is used for values that contain both date and time parts. MySQL retrieves and displays DATETIME values in 'YYYY-MM-DD HH:MM:SS' format. The supported range is '1000-01-01 00:00:00' to '9999-12-31 23:59:59'.</p>\n</blockquote>\n\n<p><a href=\"https://dev.mysql.com/doc/refman/8.0/en/datetime.html\" rel=\"nofollow noreferrer\">Source</a></p>\n"}], "owner": {"reputation": 23, "user_id": 10185936, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-9tyxQ1QwCsI/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pATscvZE8KQC9J_tFGEFSC5pMsdw/mo/photo.jpg?sz=128", "display_name": "Ruzaik Rafeek", "link": "https://stackoverflow.com/users/10185936/ruzaik-rafeek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 747, "favorite_count": 0, "accepted_answer_id": 54088376, "answer_count": 1, "score": 2, "last_activity_date": 1546938314, "creation_date": 1546938001, "last_edit_date": 1546938265, "question_id": 54088321, "link": "https://stackoverflow.com/questions/54088321/inserting-gos-zero-time-time-value-into-a-mysql-datetime-column-errors", "title": "Inserting Go&#39;s zero time.Time value into a MySQL DATETIME column errors", "body": "<p>The zero <code>time.Time</code> value generated by <code>Go</code> throws an error when it is inserted into MySQL <code>DATETIME</code> column.</p>\n\n<p>Error that I get: <code>Error 1292: Incorrect datetime value: '0000-00-00' for column 'expires_at' at row 1</code></p>\n\n<p>However, when I increment this <code>time.Time</code> value just by 1 nanosecond or change the year to at least 2, it gets inserted without any error.</p>\n\n<p>Does this mean that I cannot insert Go generated zero <code>time.Time</code> values into MySQL <code>DATETIME</code> column?</p>\n\n<p>I'm using <code>package sql</code>'s <code>Exec</code> to perform the <code>INSERT</code>. I pass the <code>time.Time</code> value as argument to <code>Exec()</code>.</p>\n\n<p><code>sess.Exec(stmt, valueArgs...)</code></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 3345213, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4hunN.png?s=128&g=1", "display_name": "basebandit", "link": "https://stackoverflow.com/users/3345213/basebandit"}, "edited": false, "score": 0, "creation_date": 1546937143, "post_id": 54087599, "comment_id": 95008527, "body": "Oh thanks it was a typoh on my end did change to the right parameter ordering.I was trimming the expected value instead of the actual response body."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 2, "last_activity_date": 1546935038, "creation_date": 1546935038, "answer_id": 54087599, "question_id": 54087547, "link": "https://stackoverflow.com/questions/54087547/how-to-fix-failed-assertions-on-raw-string-literals/54087599#54087599", "title": "How to fix failed assertions on raw string literals", "body": "<p>The order of parameters is wrong.</p>\n\n<p>It is</p>\n\n<pre><code>assert.Equal(t, rr.Body.String(), expected)\n</code></pre>\n\n<p>It should be</p>\n\n<pre><code>assert.Equal(t, expected, rr.Body.String())\n</code></pre>\n\n<p>See <a href=\"https://godoc.org/github.com/stretchr/testify/assert#Equal\" rel=\"nofollow noreferrer\">Equal method documentatin</a></p>\n\n<p>You are trimming wrong value.</p>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546936625, "post_id": 54087630, "comment_id": 95008310, "body": "Agreed. By trimming, your tests will pass even if your code starts returning &quot;{...}\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n&quot;, which you probably don&#39;t really want."}, {"owner": {"reputation": 71, "user_id": 3345213, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4hunN.png?s=128&g=1", "display_name": "basebandit", "link": "https://stackoverflow.com/users/3345213/basebandit"}, "edited": false, "score": 0, "creation_date": 1546937216, "post_id": 54087630, "comment_id": 95008559, "body": "Damn.I didn&#39;t realize this as i had my parameters passed in the wrong order."}], "tags": [], "owner": {"reputation": 344, "user_id": 4179820, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VjMZ2.jpg?s=128&g=1", "display_name": "AKstat", "link": "https://stackoverflow.com/users/4179820/akstat"}, "is_accepted": true, "score": 2, "last_activity_date": 1546935126, "creation_date": 1546935126, "answer_id": 54087630, "question_id": 54087547, "link": "https://stackoverflow.com/questions/54087547/how-to-fix-failed-assertions-on-raw-string-literals/54087630#54087630", "title": "How to fix failed assertions on raw string literals", "body": "<p>You are trimming a non-existent <code>\"\\n\"</code> character off of your <code>expected</code> string instead of the actual response body.</p>\n\n<p>But the simpler way is to just include the <code>\"\\n\"</code> in the <code>expected</code> string. That way the expected string will in fact be what you are expecting.</p>\n"}], "owner": {"reputation": 71, "user_id": 3345213, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4hunN.png?s=128&g=1", "display_name": "basebandit", "link": "https://stackoverflow.com/users/3345213/basebandit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 54087630, "answer_count": 2, "score": 0, "last_activity_date": 1546936563, "creation_date": 1546934787, "last_edit_date": 1546936563, "question_id": 54087547, "link": "https://stackoverflow.com/questions/54087547/how-to-fix-failed-assertions-on-raw-string-literals", "title": "How to fix failed assertions on raw string literals", "body": "<p>I'm writing unit tests for a restful api and want to ensure that am getting the expected response. How do I get rid of the \"\\n\" at the end of my expected string literal?</p>\n\n<p>I am using the stetchr's testify package. I have tried to use strings TrimSuffix, TrimRight functions but in vain.</p>\n\n<pre><code>func TestGetConfig(t *testing.T) {\n\n    testServer := initTestServer(t)\n\n    req, err := http.NewRequest(\"GET\", \"/api/config\", nil)\n    if err != nil {\n    t.Fatal(err)\n    }\n\n    rr := httptest.NewRecorder()\n    handler := http.HandlerFunc(testServer.getConfig)\n    handler.ServeHTTP(rr, req)\n\n    //Check the status code is what we expect\n    if status := rr.Code; status != http.StatusOK {\n    t.Errorf(\"handler returned wrong status code: got %v \nwant %v\", status, http.StatusOK)\n    }\n\n\n    //Check the response body is what we expect.\n\n expected := `{\"domain\":\"\",\"ip\":\"\",\"redirect_key\":\"mj\",\"redirect_url\":\"https://www.youtube.com/watch?v=dQw4w9WgXcQ\",\"verification_key\":\"yp\",\"verification_token\":\"5a62\"}`\n\n    expected = strings.TrimSuffix(expected, \"\\n\")\n    assert.Equal(t, rr.Body.String(), expected)\n</code></pre>\n\n<p>}</p>\n\n<p>I expect the tests to pass but instead it fails and gives this as the output.</p>\n\n<pre><code>Error Trace:    config_test.go:94\n                    Error:          Not equal:\n                                    expected: \"{\\\"domain\\\":\\\"\\\",\\\"ip\\\":\\\"\\\",\\\"redirect_key\\\":\\\"mj\\\",\\\"redirect_url\\\":\\\"https://www.youtube.com/watch?v=dQw4w9WgXcQ\\\",\\\"verification_key\\\":\\\"yp\\\",\\\"verification_token\\\":\\\"5a62\\\"}\\n\"\n                                    actual  : \"{\\\"domain\\\":\\\"\\\",\\\"ip\\\":\\\"\\\",\\\"redirect_key\\\":\\\"mj\\\",\\\"redirect_url\\\":\\\"https://www.youtube.com/watch?v=dQw4w9WgXcQ\\\",\\\"verification_key\\\":\\\"yp\\\",\\\"verification_token\\\":\\\"5a62\\\"}\"\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-platform"], "comments": [{"owner": {"reputation": 2716, "user_id": 9175665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab21a2603bc1538de6d0547bde4597c8?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Grau No&#235;l", "link": "https://stackoverflow.com/users/9175665/joan-grau-no%c3%abl"}, "edited": false, "score": 0, "creation_date": 1546937181, "post_id": 54087067, "comment_id": 95008545, "body": "What version of Go are you using? (check the output of the command <code>go version</code>)"}, {"owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "reply_to_user": {"reputation": 2716, "user_id": 9175665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab21a2603bc1538de6d0547bde4597c8?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Grau No&#235;l", "link": "https://stackoverflow.com/users/9175665/joan-grau-no%c3%abl"}, "edited": false, "score": 0, "creation_date": 1546937981, "post_id": 54087067, "comment_id": 95008958, "body": "My go version go111"}], "answers": [{"comments": [{"owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "edited": false, "score": 0, "creation_date": 1546990719, "post_id": 54090368, "comment_id": 95035489, "body": "Actually, I have use  &quot;google.golang.org/appengine/log&quot; package with  appengine.Main() entrypoint in the main() function. I will try to use &quot;log&quot; ."}, {"owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "edited": false, "score": 0, "creation_date": 1546990797, "post_id": 54090368, "comment_id": 95035511, "body": "I have another question why Instead of using the App Engine Search API, host any full-text search database such as ElasticSearch on Compute Engine and access it from your service ? App Engine Search API will deprecate ?"}, {"owner": {"reputation": 2716, "user_id": 9175665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab21a2603bc1538de6d0547bde4597c8?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Grau No&#235;l", "link": "https://stackoverflow.com/users/9175665/joan-grau-no%c3%abl"}, "reply_to_user": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "edited": false, "score": 0, "creation_date": 1547051847, "post_id": 54090368, "comment_id": 95061893, "body": "The reason for this is because the App Engine Search API currently is only available in the Python2.7, Java 8 and Go 1.9 runtimes (and only in App Engine Standard)."}, {"owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "edited": false, "score": 0, "creation_date": 1547105573, "post_id": 54090368, "comment_id": 95079014, "body": "Actually, I use Go 1.11 runtimes with appengine.Main() , and I can use  App Engine Search API. But still can not see log on stackdriver. I will try go back to 1.9"}, {"owner": {"reputation": 2716, "user_id": 9175665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab21a2603bc1538de6d0547bde4597c8?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Grau No&#235;l", "link": "https://stackoverflow.com/users/9175665/joan-grau-no%c3%abl"}, "reply_to_user": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "edited": false, "score": 0, "creation_date": 1547110249, "post_id": 54090368, "comment_id": 95081158, "body": "It&#39;s strange that your logs don&#39;t show up. Maybe you are surpassing some of the <a href=\"https://cloud.google.com/logging/quotas\" rel=\"nofollow noreferrer\">Stackdriver Logging quotas</a>?"}, {"owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "edited": false, "score": 0, "creation_date": 1547113293, "post_id": 54090368, "comment_id": 95082877, "body": "Finally , I found my GAE be exclude from stackdrive. Now I can see my log . Thanks"}, {"owner": {"reputation": 1144, "user_id": 2253858, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/9HsDN.jpg?s=128&g=1", "display_name": "Andy Fusniak", "link": "https://stackoverflow.com/users/2253858/andy-fusniak"}, "edited": false, "score": 3, "creation_date": 1552626585, "post_id": 54090368, "comment_id": 97090331, "body": "But by using Go&#39;s standard log library there is no way to differentiate log levels such as Critical, Error, Warning, Info and Debug.  Writing a service using cloud.google.com/go/logging locks you into using GAE. Later if we wish to switch to a GCE or Kubernetes each have their own conventions for logging.  I wish there were a way to prefix stdout and stderr logging to denote the log level, so it can be filtered for in the StackDriver logs viewer. Even better would be a standard logging methodology across all platforms."}, {"owner": {"reputation": 260, "user_id": 3137420, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iPL8o.jpg?s=128&g=1", "display_name": "Fontinalis", "link": "https://stackoverflow.com/users/3137420/fontinalis"}, "reply_to_user": {"reputation": 1144, "user_id": 2253858, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/9HsDN.jpg?s=128&g=1", "display_name": "Andy Fusniak", "link": "https://stackoverflow.com/users/2253858/andy-fusniak"}, "edited": false, "score": 1, "creation_date": 1584104706, "post_id": 54090368, "comment_id": 107341388, "body": "@AndyFusniak I partially resolved this issue by creating a util package for my project that wraps the basic functions of the <code>google.golang.org&#47;appengine&#47;log</code> package, and it just prefixes all the logs with a <code>- DEBUG -</code>, <code>- ERROR -</code> or <code>- INFO -</code>. I know it&#39;s an old issue, but it&#39;s maybe helpful for someone"}], "tags": [], "owner": {"reputation": 2716, "user_id": 9175665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab21a2603bc1538de6d0547bde4597c8?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Grau No&#235;l", "link": "https://stackoverflow.com/users/9175665/joan-grau-no%c3%abl"}, "is_accepted": true, "score": 5, "last_activity_date": 1546945238, "creation_date": 1546945238, "answer_id": 54090368, "question_id": 54087067, "link": "https://stackoverflow.com/questions/54087067/which-logging-library-should-i-use-for-go-in-gae/54090368#54090368", "title": "Which logging library should I use for Go in GAE?", "body": "<p>If you want the logs to appear in Stackdriver Logging, the correct approach would be to use the <a href=\"https://godoc.org/google.golang.org/appengine/log\" rel=\"noreferrer\">\"google.golang.org/appengine/log\" package</a>.</p>\n\n<p>However, as per the <a href=\"https://cloud.google.com/appengine/docs/standard/go111/go-differences\" rel=\"noreferrer\">documentation on the Go1.11 runtime</a>, it is recommended <a href=\"https://cloud.google.com/appengine/docs/standard/go111/go-differences#migrating-appengine-sdk\" rel=\"noreferrer\">not to use the App Engine specific API's and use the Google Cloud client library</a>. </p>\n\n<p>In regards to logging, this means that instead of using \"google.golang.org/appengine/log\", the recommended approach is to use the <a href=\"https://golang.org/pkg/log/\" rel=\"noreferrer\">\"log\" package</a> instead. An example:</p>\n\n<p><strong>app.yaml</strong></p>\n\n<pre><code>runtime: go111\n</code></pre>\n\n<p><strong>hello.go</strong></p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"log\"\n        \"net/http\"\n        \"os\"\n)\n\nfunc main() {\n        http.HandleFunc(\"/\", indexHandler)\n\n        port := os.Getenv(\"PORT\")\n        if port == \"\" {\n                port = \"8080\"\n        }\n\n        log.Fatal(http.ListenAndServe(fmt.Sprintf(\":%s\", port), nil))\n}\n\nfunc indexHandler(w http.ResponseWriter, r *http.Request) {\n        //Create the log and write it\n        log.Printf(\"Hello world!\")\n        fmt.Fprint(w, \"Log written in Stackdriver!\")\n}\n</code></pre>\n\n<p>This log will appear in Stackdriver Logging under:</p>\n\n<pre><code>resource.type=\"gae_app\"\nresource.labels.module_id=\"default\"\nlogName=\"projects/&lt;YOUR_PROJECT_NAME&gt;/logs/stderr\"\n</code></pre>\n\n<p>Or by selecting <code>stderr</code> in the log filter drop down list.</p>\n\n<p>However, if you wish, you can still use the \"google.golang.org/appengine/log\" package, but you will have to add the \"google.golang.org/appengine\" package as well, and add the <code>appengine.Main()</code> entrypoint in the <code>main()</code> function.</p>\n"}, {"comments": [{"owner": {"reputation": 727, "user_id": 3365278, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d58c4b6b44306a99fd704477e729acc6?s=128&d=identicon&r=PG", "display_name": "Lewis Lebentz", "link": "https://stackoverflow.com/users/3365278/lewis-lebentz"}, "edited": false, "score": 0, "creation_date": 1611762247, "post_id": 65736127, "comment_id": 116555885, "body": "I tried this and in the Google App Engine logs it wasn&#39;t assigned the proper severity level, just came through as JSON in default severity."}], "tags": [], "owner": {"reputation": 828, "user_id": 3652338, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Hm6NC.jpg?s=128&g=1", "display_name": "Jan Krynauw", "link": "https://stackoverflow.com/users/3652338/jan-krynauw"}, "is_accepted": false, "score": 1, "last_activity_date": 1610713640, "creation_date": 1610713640, "answer_id": 65736127, "question_id": 54087067, "link": "https://stackoverflow.com/questions/54087067/which-logging-library-should-i-use-for-go-in-gae/65736127#65736127", "title": "Which logging library should I use for Go in GAE?", "body": "<p>You could also go the <a href=\"https://cloud.google.com/logging/docs/structured-logging\" rel=\"nofollow noreferrer\">structured logging</a> route, where you don't depend on the above client libraries.</p>\n<pre><code>// Entry defines a log entry.\ntype Entry struct {\n    Message  string `json:&quot;message&quot;`\n    Severity string `json:&quot;severity,omitempty&quot;`\n    Trace    string `json:&quot;logging.googleapis.com/trace,omitempty&quot;`\n\n    // Cloud Log Viewer allows filtering and display of this as `jsonPayload.component`.\n    Component string `json:&quot;component,omitempty&quot;`\n}\n\n// String renders an entry structure to the JSON format expected by Cloud Logging.\nfunc (e Entry) String() string {\n    if e.Severity == &quot;&quot; {\n        e.Severity = &quot;INFO&quot;\n    }\n    out, err := json.Marshal(e)\n    if err != nil {\n        log.Printf(&quot;json.Marshal: %v&quot;, err)\n    }\n    return string(out)\n}\n</code></pre>\n<p>and then log using the built-in <code>log</code> package:</p>\n<pre><code>log.Println(Entry{\n        Severity:  &quot;NOTICE&quot;,\n        Message:   &quot;This is the default display field.&quot;,\n        Component: &quot;arbitrary-property&quot;,\n        Trace:     trace,\n    })\n</code></pre>\n<p>Here is a full example: <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/blob/master/run/logging-manual/main.go\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/golang-samples/blob/master/run/logging-manual/main.go</a></p>\n"}], "owner": {"reputation": 2249, "user_id": 2450936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174d70ca270f9c1bdadb37ac9eaf8fe0?s=128&d=identicon&r=PG", "display_name": "howie", "link": "https://stackoverflow.com/users/2450936/howie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1091, "favorite_count": 0, "accepted_answer_id": 54090368, "answer_count": 2, "score": 3, "last_activity_date": 1610713640, "creation_date": 1546932552, "last_edit_date": 1546937185, "question_id": 54087067, "link": "https://stackoverflow.com/questions/54087067/which-logging-library-should-i-use-for-go-in-gae", "title": "Which logging library should I use for Go in GAE?", "body": "<p>I find tw kind of go library for GAE\uff1a</p>\n\n<ol>\n<li>\"google.golang.org/appengine/log\"</li>\n<li>\"cloud.google.com/go/logging\"</li>\n</ol>\n\n<p>Which one should I use ?\nBy the way I use both logging library in my app.\nIn local dev mode , I can see log like this.</p>\n\n<pre><code>2019/01/08 06:57:34 INFO: Search keyword=\"test\" idOnly=bool\n2019/01/08 06:57:34 INFO: Search:\"test\"\n</code></pre>\n\n<p>But when I deploy to production GAE, I cannot see any log.</p>\n\n<p>No matter using stackdriver by </p>\n\n<pre><code>resource.type=\"gae_app\" resource.labels.module_id=\"default\" \n</code></pre>\n\n<p>Or gcloud command </p>\n\n<pre><code> gcloud app logs tail -s default\n</code></pre>\n"}, {"tags": ["http", "go", "response"], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546930806, "post_id": 54086318, "comment_id": 95006033, "body": "This neither accesses &quot;raw&quot; headers, nor does it allow access to multiple cookies. This simply dumps a sub-optimal representation of the (non-raw) response header. Hardly an answer to the question in any case."}], "tags": [], "owner": {"reputation": 1140, "user_id": 3809505, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/xeW9s.jpg?s=128&g=1", "display_name": "steve", "link": "https://stackoverflow.com/users/3809505/steve"}, "is_accepted": false, "score": -3, "last_activity_date": 1546928975, "creation_date": 1546928975, "answer_id": 54086318, "question_id": 54086270, "link": "https://stackoverflow.com/questions/54086270/get-raw-header-of-http-response/54086318#54086318", "title": "Get RAW header of http response", "body": "<p>use <code>fmt.Printf(\"%+v\", resp.Header)</code> </p>\n\n<p>can write all header to a string like below: </p>\n\n<pre><code>map[Set-Cookie:[CASPRIVACY=\"\"; Path=/ CASTGC=TGT-1248283-0BRja0uNQR9PntBl4HnrzKA44q5XDQXxA5FRVcnO9Xn6CkTU6S-passport; Path=/ CASLOGC=%7B%22myuniRole%22%3A0%2C%22username%22%3A%22a6051b9d08384f3ea2d203e744d3f7e6%22%2C%22mycuRole%22%3A0%2C%22userId%22%3A192676671%2C%22myinstRole%22%3A0%2C%22realName%22%3A%22%E9%9B%B7%E7%BA%A2%E6%A2%85%22%2C%22uuid%22%3A%22V4eoYpNB%22%2C%22headPic%22%3A%22http%3A%2F%2Fimage.xxx.com%2Fzhs%2Fapp%2Fcontent%2F201812%2Ff0b20d740df04d3196a20bc39f58ab56_s3.png%22%7D; Domain=.xxxx.com; Path=/ SERVERID=958b97eacbe3c49360ace2dfc0bd31b4|1546915535|1546915533;Path=/] Pragma:[no-cache] Expires:[Thu, 01 Jan 1970 00:00:00 GMT] Cache-Control:[no-cache no-store] Location:[http://online.xxx.com/onlineSchool/?ticket=ST-3285248-UiTbNt7bnUwXdtWSznIT-passport.xxxx.com] Date:[Tue, 08 Jan 2019 02:45:35 GMT] Content-Length:[0] Connection:[keep-alive]]\n</code></pre>\n\n<p>Is hardly to get all cookies from the string by use split and regx</p>\n"}, {"tags": [], "owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "is_accepted": false, "score": 1, "last_activity_date": 1546930443, "creation_date": 1546930443, "answer_id": 54086617, "question_id": 54086270, "link": "https://stackoverflow.com/questions/54086270/get-raw-header-of-http-response/54086617#54086617", "title": "Get RAW header of http response", "body": "<p>The standard http lib parsed the header by default.<br>\nUsing fasthttp (you will need to re-write your router and handler function) will give you ability to get the raw header.</p>\n\n<ul>\n<li><a href=\"https://github.com/valyala/fasthttp#switching-from-nethttp-to-fasthttp\" rel=\"nofollow noreferrer\">https://github.com/valyala/fasthttp#switching-from-nethttp-to-fasthttp</a></li>\n<li><a href=\"https://godoc.org/github.com/valyala/fasthttp#RequestHeader.RawHeaders\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/valyala/fasthttp#RequestHeader.RawHeaders</a></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 1140, "user_id": 3809505, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/xeW9s.jpg?s=128&g=1", "display_name": "steve", "link": "https://stackoverflow.com/users/3809505/steve"}, "edited": false, "score": 0, "creation_date": 1546931374, "post_id": 54086649, "comment_id": 95006225, "body": "thanks. Resolved.  Response.header is an map header key: value. So, <code>cookies := resp.Header[&quot;Set-Cookie&quot;]</code> got an array of all cookies"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1546931102, "last_edit_date": 1546931102, "creation_date": 1546930603, "answer_id": 54086649, "question_id": 54086270, "link": "https://stackoverflow.com/questions/54086270/get-raw-header-of-http-response/54086649#54086649", "title": "Get RAW header of http response", "body": "<p>If you want the <em>raw</em> headers, you'll need to write some wrapper for <a href=\"https://golang.org/pkg/net/#Conn\" rel=\"nofollow noreferrer\"><code>net.Conn</code></a> which captures the raw header before it is interpreted by the <code>http</code> library.</p>\n\n<p>But you don't really seem to need the raw header--or even the full header at all. If your goal is simply to read multiple cookies, the easiest way to do this is with the <a href=\"https://golang.org/pkg/net/http/#Response.Cookies\" rel=\"nofollow noreferrer\"><code>Cookies</code></a> method on the response.</p>\n\n<p>An intermediate option between these two is to read the entire <a href=\"https://golang.org/pkg/net/http/#Response\" rel=\"nofollow noreferrer\"><code>Header</code></a> field of the response. This will present the <em>full</em> header, but its order is not guaranteed, and minimal parsing will have been done (to remove newlines, etc), so it can't be said this is truly \"raw\". It does, however, preserve multiple values, in case of duplicate headers, by storing all header values in a <code>[]string</code>. So for the purposes of this question, this should be perfectly adequate (although <code>Response.Cookies</code>, as mentioned above, would be easier).</p>\n"}], "owner": {"reputation": 1140, "user_id": 3809505, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/xeW9s.jpg?s=128&g=1", "display_name": "steve", "link": "https://stackoverflow.com/users/3809505/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1415, "favorite_count": 0, "accepted_answer_id": 54086649, "answer_count": 3, "score": -1, "last_activity_date": 1568708989, "creation_date": 1546928769, "last_edit_date": 1568708989, "question_id": 54086270, "link": "https://stackoverflow.com/questions/54086270/get-raw-header-of-http-response", "title": "Get RAW header of http response", "body": "<p>How to get raw header of response as string like this:</p>\n\n<pre><code>alt-svc: quic=\":443\"; ma=2592000; v=\"44,43,39,35\"\ncache-control: private, max-age=0\ncontent-encoding: br\ncontent-type: text/html; charset=UTF-8\ndate: Tue, 08 Jan 2019 06:19:47 GMT\nexpires: -1\nserver: gws\nset-cookie: 1P_JAR=2019-01-08-06; expires=Thu, 07-Feb-2019 06:19:47 GMT; path=/; domain=.google.com\nset-cookie: SIDCC=ABtHo-HHNcja-cEEFEUXtBmLOdql4RTVMCWKGApEFFb8lWSAqaTF_fi0gDLoWaCzH3ogvEofah0; expires=Mon, 08-Apr-2019 06:19:47 GMT; path=/; domain=.google.com; priority=high\nstatus: 200\n</code></pre>\n\n<p>Because I want get the multiple <code>set-cookie</code> value from the response header.\nUse <code>Http.Response.Header.Get(\"set-cookies\")</code> just return the last row.</p>\n\n<p>Or how can I get the multiple cookies?</p>\n"}, {"tags": ["go", "godoc"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1546921496, "post_id": 54085145, "comment_id": 95003486, "body": "&quot;Trying to use go doc &lt;args...&gt; for any set of arguments&quot; You could be doing anything! Give specific examples. Questions seeking debugging help (&quot;why isn&#39;t this code [command] working?&quot;) must include the desired behavior, a specific problem or error and the shortest code [command] necessary to reproduce it in the question itself."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1546925613, "post_id": 54085145, "comment_id": 95004414, "body": "Remove all your Go installations and install as described from golang.org."}, {"owner": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "edited": false, "score": 0, "creation_date": 1546931606, "post_id": 54085145, "comment_id": 95006300, "body": "Can you find the &quot;$GOROOT/bin/godoc&quot; bin file? Try to run &quot;which godoc&quot;. The command &quot;go doc&quot; is actually calling the &quot;godoc&quot; I believe, some package manager just not install them fully, or forget to set some more ENV var."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4679, "user_id": 749854, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/541a5cb4925d352cac921c21e9213aa4?s=128&d=identicon&r=PG", "display_name": "nvcnvn", "link": "https://stackoverflow.com/users/749854/nvcnvn"}, "edited": false, "score": 3, "creation_date": 1546933786, "post_id": 54085145, "comment_id": 95007117, "body": "@nvcnvn The command &quot;go doc&quot; runs the command &quot;doc&quot; in the tool exec dir, not the &quot;godoc&quot; command."}, {"owner": {"reputation": 344, "user_id": 4179820, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VjMZ2.jpg?s=128&g=1", "display_name": "AKstat", "link": "https://stackoverflow.com/users/4179820/akstat"}, "edited": false, "score": 0, "creation_date": 1546948538, "post_id": 54085145, "comment_id": 95014703, "body": "I use go on arch linux and have never had this problem. I suspect something in your environment is messed up."}, {"owner": {"reputation": 541, "user_id": 1852105, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a8d1c2c8abec2e6c24a206999ad36e3f?s=128&d=identicon&r=PG", "display_name": "rookie1024", "link": "https://stackoverflow.com/users/1852105/rookie1024"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1547076646, "post_id": 54085145, "comment_id": 95072243, "body": "@peterSO <code>go doc</code> doesn&#39;t work, that&#39;s the minimum example.  The command I was trying to run is <code>go doc &quot;regex&#47;syntax&quot;</code>, but regardless of the parameters I pass to <code>go doc</code>, I get the same error, which is why I did not provide any specific usage."}, {"owner": {"reputation": 541, "user_id": 1852105, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a8d1c2c8abec2e6c24a206999ad36e3f?s=128&d=identicon&r=PG", "display_name": "rookie1024", "link": "https://stackoverflow.com/users/1852105/rookie1024"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1547076833, "post_id": 54085145, "comment_id": 95072282, "body": "@Volker As I mentioned in the question, grabbing the gz file with the preinstalled binaries from golang.org and setting $GOPATH to point to its unzipped location (which is, in effect, their recommended installation method) resulted in the same error."}, {"owner": {"reputation": 541, "user_id": 1852105, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a8d1c2c8abec2e6c24a206999ad36e3f?s=128&d=identicon&r=PG", "display_name": "rookie1024", "link": "https://stackoverflow.com/users/1852105/rookie1024"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1547078061, "post_id": 54085145, "comment_id": 95072538, "body": "@peterSO I made a typo, but it should be &quot;regexp/syntax,&quot; as stated by this page: <a href=\"https://golang.org/pkg/regexp/\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp</a>"}], "answers": [{"tags": [], "owner": {"reputation": 541, "user_id": 1852105, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a8d1c2c8abec2e6c24a206999ad36e3f?s=128&d=identicon&r=PG", "display_name": "rookie1024", "link": "https://stackoverflow.com/users/1852105/rookie1024"}, "is_accepted": true, "score": 1, "last_activity_date": 1547077686, "creation_date": 1547077686, "answer_id": 54120098, "question_id": 54085145, "link": "https://stackoverflow.com/questions/54085145/running-go-doc-results-in-no-such-tool-error/54120098#54120098", "title": "Running &quot;go doc&quot; results in &quot;no such tool&quot; error", "body": "<p>The problem was caused by the fact that my system version of go was gccgo v1.10.3 - installing go v1.11.4 resolved the issue.</p>\n"}], "owner": {"reputation": 541, "user_id": 1852105, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a8d1c2c8abec2e6c24a206999ad36e3f?s=128&d=identicon&r=PG", "display_name": "rookie1024", "link": "https://stackoverflow.com/users/1852105/rookie1024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "accepted_answer_id": 54120098, "answer_count": 1, "score": -1, "last_activity_date": 1550574108, "creation_date": 1546920924, "last_edit_date": 1550574108, "question_id": 54085145, "link": "https://stackoverflow.com/questions/54085145/running-go-doc-results-in-no-such-tool-error", "title": "Running &quot;go doc&quot; results in &quot;no such tool&quot; error", "body": "<p>I've run into a very strange issue, and even though I'm sure the solution is simple, but I can't find anything online about this.  Trying to use <code>go doc &lt;args...&gt;</code> for any set of arguments always results in the error:</p>\n\n<p><code>go tool: no such tool \"doc\"</code></p>\n\n<p>despite <code>doc</code> showing up in the command output for <code>go help</code> and <code>go help doc</code> providing documentation of and usage for <code>go doc</code>.</p>\n\n<p>What's going on here?  I even tried downloading the tar.gz bundle from golang.org because I figured maybe the version I installed with <code>pacman</code> was bad, but the unzipped <code>go</code> also had the same issue (with, of course, a properly altered <code>GOPATH</code>).</p>\n"}, {"tags": ["go", "format"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1546920373, "post_id": 54084576, "comment_id": 95003228, "body": "If your goal is to use %s to create a string variable, then use Sprintf as in the duplicate question:   <code>s := fmt.Sprintf(&quot;%s&quot;, dst)</code>.  You can also use <code>s := string(dst)</code>."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1546921154, "post_id": 54084576, "comment_id": 95003401, "body": "@ThunderCat: &quot;If your goal ...&quot; That wasn&#39;t the goal. See my answer."}], "answers": [{"comments": [{"owner": {"reputation": 3735, "user_id": 3479801, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/cenwJ.jpg?s=128&g=1", "display_name": "Chipe", "link": "https://stackoverflow.com/users/3479801/chipe"}, "edited": false, "score": 1, "creation_date": 1546919365, "post_id": 54084898, "comment_id": 95003041, "body": "Wonderful! Thanks so much. I was looking for what you just posted: <code>dst := hex.EncodeToString(src)</code>. Thanks so much! I couldnt find this in any of my searching, so thanks for the reply!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1546918680, "creation_date": 1546918680, "answer_id": 54084898, "question_id": 54084576, "link": "https://stackoverflow.com/questions/54084576/set-s-of-hex-encoded-from-byte-to-variable-golang/54084898#54084898", "title": "set %s of hex encoded from byte to variable golang", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/hex\"\n    \"fmt\"\n)\n\nfunc main() {\n    str := \"Hello Gopher!\"\n    fmt.Println(str)\n    src := []byte(str)\n    fmt.Println(src)\n    dst := hex.EncodeToString(src)\n    fmt.Println(dst)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/qwT_cGpWoYb\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qwT_cGpWoYb</a></p>\n\n<p>Output:</p>\n\n<pre><code>Hello Gopher!\n[72 101 108 108 111 32 71 111 112 104 101 114 33]\n48656c6c6f20476f7068657221\n</code></pre>\n"}], "owner": {"reputation": 3735, "user_id": 3479801, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/cenwJ.jpg?s=128&g=1", "display_name": "Chipe", "link": "https://stackoverflow.com/users/3479801/chipe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 1, "accepted_answer_id": 54084898, "answer_count": 1, "score": -2, "last_activity_date": 1546918680, "creation_date": 1546915440, "question_id": 54084576, "link": "https://stackoverflow.com/questions/54084576/set-s-of-hex-encoded-from-byte-to-variable-golang", "title": "set %s of hex encoded from byte to variable golang", "body": "<p>Please excuse my newness to the language. I found this example of encoding to bytes and then it out puts using <code>fmt.Printf</code>, but how instead do I store the string representation of this example in a variable?</p>\n\n<pre><code>src := []byte(\"Hello Gopher!\")\n\ndst := make([]byte, hex.EncodedLen(len(src)))\nhex.Encode(dst, src)\n\nfmt.Printf(\"%s\\n\", dst) // output: 48656c6c6f20476f7068657221 (how do I get this output rather in a variable?\n</code></pre>\n\n<p>I want to set <code>dst</code> in a variable to be used later in the code instead of printing it out. </p>\n\n<hr>\n\n<p><em>EDIT</em>\nThe original question was marked as a duplicate to this: <a href=\"https://stackoverflow.com/questions/11123865/format-a-go-string-without-printing\">Format a Go string without printing?</a></p>\n\n<p>However, the answers in there seem to only refer to formatting that of a string using <code>Sprintf</code> and in this question I am trying to figure out how to format a <code>hex</code> which was encoded from <code>byte</code> but the example is printed out in <code>fmt.Printf</code> using <code>%s</code>. But I would like to format to use in a variable which can be reused in the code in later parts. So I dont think this is a duplicate of marked reason, as that deals with formatting a string, not a hex from byte</p>\n\n<hr>\n"}, {"tags": ["c++", "go", "dll", "64-bit"], "comments": [{"owner": {"reputation": 1030, "user_id": 9959748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6Z5r3.jpg?s=128&g=1", "display_name": "celicoo", "link": "https://stackoverflow.com/users/9959748/celicoo"}, "edited": false, "score": 0, "creation_date": 1546913587, "post_id": 54084394, "comment_id": 95002020, "body": "Please, provide a working example."}, {"owner": {"reputation": 864, "user_id": 10320907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6a781c80933f17fa87d97b70e3fca260?s=128&d=identicon&r=PG", "display_name": "tunglt", "link": "https://stackoverflow.com/users/10320907/tunglt"}, "edited": false, "score": 0, "creation_date": 1546943834, "post_id": 54084394, "comment_id": 95012236, "body": "Go does not handle str::string directly, you should pass the string between DLL space and Go program space using C way: buffer and buffer size. The string owner is the Go program, the DLL just copy the return value into the buffer created by the caller."}], "answers": [{"comments": [{"owner": {"reputation": 41558, "user_id": 3204551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91bb06155f79d40ffecdf124deecb001?s=128&d=identicon&r=PG&f=1", "display_name": "Deduplicator", "link": "https://stackoverflow.com/users/3204551/deduplicator"}, "edited": false, "score": 1, "creation_date": 1546944401, "post_id": 54089998, "comment_id": 95012512, "body": "<code>std::string</code>, while having an interesting internal structure due to small-string-optimisation on most implementations (copy-on-write was often found pre-C++11), should not have anything to do with vtables or such."}, {"owner": {"reputation": 1207, "user_id": 5499697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/086827dacc06da5df902393eef3f4a48?s=128&d=identicon&r=PG&f=1", "display_name": "Bonjour123", "link": "https://stackoverflow.com/users/5499697/bonjour123"}, "reply_to_user": {"reputation": 41558, "user_id": 3204551, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91bb06155f79d40ffecdf124deecb001?s=128&d=identicon&r=PG&f=1", "display_name": "Deduplicator", "link": "https://stackoverflow.com/users/3204551/deduplicator"}, "edited": false, "score": 0, "creation_date": 1546947782, "post_id": 54089998, "comment_id": 95014352, "body": "Yes, I agree on that, it wasn&#39;t my words. But the important part here is that it&#39;s not the same internal structure (between std:string and char arrays), which is what causes the problem."}], "tags": [], "owner": {"reputation": 1207, "user_id": 5499697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/086827dacc06da5df902393eef3f4a48?s=128&d=identicon&r=PG&f=1", "display_name": "Bonjour123", "link": "https://stackoverflow.com/users/5499697/bonjour123"}, "is_accepted": true, "score": 0, "last_activity_date": 1546943897, "creation_date": 1546943897, "answer_id": 54089998, "question_id": 54084394, "link": "https://stackoverflow.com/questions/54084394/how-to-get-in-go-a-stdstring-from-an-exported-function-of-a-dll/54089998#54089998", "title": "How to get in Go a std::string from an exported function of a DLL?", "body": "<p>Here is the answer I got from a gopher:</p>\n\n<blockquote>\n  <p>working with objects is tricky. string is an object, it probably has a\n  vtable somewhere, it also has an internal structure (although I forget\n  what it is, my guess would be it's similar to a COM bstring or a go\n  slice, maybe check the relevant c++ sources). Calling methods would\n  involve finding the address of the dispatch table entires and calling\n  those as functions. I suggest you start with a C char * and work your\n  way to that.</p>\n</blockquote>\n\n<p>So I tried by taking a char ** as argument , I could modify it in the DLL function and display the modification in Go. I also tried returning a basic type (int) and it worked also.</p>\n"}], "owner": {"reputation": 1207, "user_id": 5499697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/086827dacc06da5df902393eef3f4a48?s=128&d=identicon&r=PG&f=1", "display_name": "Bonjour123", "link": "https://stackoverflow.com/users/5499697/bonjour123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 393, "favorite_count": 0, "accepted_answer_id": 54089998, "answer_count": 1, "score": 1, "last_activity_date": 1546943897, "creation_date": 1546913417, "last_edit_date": 1546934489, "question_id": 54084394, "link": "https://stackoverflow.com/questions/54084394/how-to-get-in-go-a-stdstring-from-an-exported-function-of-a-dll", "title": "How to get in Go a std::string from an exported function of a DLL?", "body": "<p>I want to load a custom DLL (C++ one) and call a function that it exports ?\nHere is my Go code:</p>\n\n<pre><code>func main() {\n    dllForGo := syscall.MustLoadDLL(\"dllForGo.dll\")\n    defer dllForGo.Release()\n    getHello:= dllForGo.MustFindProc(\"getHello\")\n    r1, _, err := getHello.Call(0) // also tried with .Call() and still got the same error\n}\n</code></pre>\n\n<p>Here the C++ code of my DLL:</p>\n\n<pre><code> std::string __stdcall getHello(void) {\n     int a = 1;\n     double b = 10;\n     return (\"Hello-World !!\"+std::to_string(a) + std::to_string(b));\n}\n</code></pre>\n\n<p>I tried to force the use of __stdcall (and link a .def file for this, as I thought that maybe  __declspec(dllexport) could be a problem ).</p>\n\n<p>However, using DUMPBIN, I can see that getHello uses __cdecl calling convention. Is it a problem? </p>\n\n<p>And here is the error I get when I run my Go:</p>\n\n<pre><code>Exception 0xc0000005 0x1 0x10 0x7fef0591327\nPC=0x7fef0591327\n\nsyscall.Syscall(0x7fef05910d0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\n    D:/Go/src/runtime/syscall_windows.go:172 +0xf9\nsyscall.(*Proc).Call(0xc00004e420, 0xc000058090, 0x1, 0x1, 0x565520, 0x21, 0x2e06a0, 0x0)\n    D:/Go/src/syscall/dll_windows.go:146 +0x140\nmain.main()\n    D:/GoLand_Projects/dllLoad/main.go:58 +0x335\nrax     0x22fdb8\nrbx     0x9\nrcx     0x30\nrdi     0x9\nrsi     0x0\nrbp     0x22fdd9\nrsp     0x22fd60\nr8      0x30303030302e3031\nr9      0x7fef1220000\nr10     0x22fd90\nr11     0x771a1f\nr12     0xa\nr13     0x9\nr14     0x0\nr15     0x0\nrip     0x7fef0591327\nrflags  0x10202\ncs      0x33\nfs      0x53\ngs      0x2b\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>The getHello function is actually well executed. I modified it to write to a file:</p>\n\n<pre><code> std::string __stdcall  getHello(void) {\n     std::ofstream outfile(\"D:\\\\test123.txt\");\n     outfile &lt;&lt; \"getHello working!\" &lt;&lt; std::endl;\n     outfile.close();\n     int a = 1;\n     double b = 10;\n    return (\"Hello-World !!\"+std::to_string(a) + std::to_string(b));\n}\n</code></pre>\n\n<p>...and the file is written to. So the problem is at after the exported function returns.\n Which makes me think I need to change something in the Go part to \"welcome\" the returned std::string.</p>\n\n<p><strong>EDIT2</strong></p>\n\n<p>If I change the return type of the exported function to <em>void</em> then, the Call return without exception. Could it be an additional hint that it's indeed related to the calling convention ?</p>\n"}, {"tags": ["go", "go-pg"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11643815, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7EhBQ6_O70Q/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcvMp7-E8XuBk6Nq6nGI-8EVL8mow/mo/photo.jpg?sz=128", "display_name": "Kan Zhang", "link": "https://stackoverflow.com/users/11643815/kan-zhang"}, "is_accepted": false, "score": 0, "last_activity_date": 1560442794, "creation_date": 1560442794, "answer_id": 56584762, "question_id": 54083904, "link": "https://stackoverflow.com/questions/54083904/golang-go-pg-relation-recursive-query/56584762#56584762", "title": "Golang go-pg relation recursive query", "body": "<p>You will need to indicate that it's actually a relation on the second struct:</p>\n\n<pre><code>db.Model(&amp;a).Relation(\"B\").Relation(\"B.C\").First()\n</code></pre>\n"}], "owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 686, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1560442794, "creation_date": 1546908651, "question_id": 54083904, "link": "https://stackoverflow.com/questions/54083904/golang-go-pg-relation-recursive-query", "title": "Golang go-pg relation recursive query", "body": "<p>I will need to join with recursive, something like this :</p>\n\n<pre><code>SELECT a.*, b.* c.* FROM a\nLEFT JOIN b on b.id = a.b_id\nLEFT JOIN c ON c.id = b.c_id\n</code></pre>\n\n<p>And my model definition is :</p>\n\n<pre><code>type A struct {\n    ID int,\n    NameA string,\n    B_id int\n    B *B,\n    C *C,\n}\n\ntype B struct {\n    ID int,\n    C_id int,\n    NameB string,\n    C C,\n}\n\ntype C struct {\n    ID int,\n    NameC string,\n}\n</code></pre>\n\n<p>I try to use the Relation but didn't works :</p>\n\n<pre><code>a := A{}\n//does not work\ndb.Model(&amp;a).Relation(\"B\").Relation(\"C\").First()\n\n//works\ndb.Model(&amp;a).Relation(\"B\").First()\n</code></pre>\n\n<p>How I can achieve the recursive join on go-pg, please let me know if anyone has experience with it. Thanks alot.</p>\n"}, {"tags": ["algorithm", "go"], "answers": [{"tags": [], "owner": {"reputation": 1017, "user_id": 2691759, "user_type": "registered", "accept_rate": 14, "profile_image": "https://i.stack.imgur.com/iAkAI.png?s=128&g=1", "display_name": "pigeonhands", "link": "https://stackoverflow.com/users/2691759/pigeonhands"}, "is_accepted": false, "score": 4, "last_activity_date": 1546908400, "creation_date": 1546908400, "answer_id": 54083871, "question_id": 54083815, "link": "https://stackoverflow.com/questions/54083815/cannot-use-function-that-is-of-type-func-in-argument-to-time-afterfunc/54083871#54083871", "title": "Cannot use (function that is of) type func() in argument to time.AfterFunc", "body": "<p>Because <code>time.AfterFunc</code> takes a  <code>func()</code>, but you are using a <code>func() string</code>.</p>\n\n<p>if you want to call a <code>func() string</code> you could wrap it</p>\n\n<pre><code>time.AfterFunc(time.Duration(b)*time.Second, func() {\n    fn()\n})\n</code></pre>\n"}], "owner": {"reputation": 424, "user_id": 10226205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fyD0G.jpg?s=128&g=1", "display_name": "seemcat", "link": "https://stackoverflow.com/users/10226205/seemcat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1524, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1546908400, "creation_date": 1546907785, "question_id": 54083815, "link": "https://stackoverflow.com/questions/54083815/cannot-use-function-that-is-of-type-func-in-argument-to-time-afterfunc", "title": "Cannot use (function that is of) type func() in argument to time.AfterFunc", "body": "<p>I can't figure out how to solve this Go algorithm problem without running into a couple nested function problems. One of them being, <code>\"cannot use func literal (type func()) as type func() string in return argument\"</code>.</p>\n\n<p>The solution I'm working with right now is:</p>\n\n<pre><code>// Write a function that takes in 2 numbers (a, b) and a function.\n// It should execute the function after a milliseconds, \n// and then execute the function again after b milliseconds.\n\n        package main\n\n        import \"time\"                  \n\n        func newFunc(b int, fn func() string) func() string {\n                return func() {        \n                        time.AfterFunc(time.Duration(b)*time.Second, fn)\n                }\n        } \n\n        func solution10(a, b int, fn func() string) string { \n                f := newFunc(b, fn)    \n                time.AfterFunc(time.Duration(a)*time.Second, f)\n        }\n</code></pre>\n\n<p>I specified the return type of <code>solution10</code> as string because the function I'll be passing in will be returning a string. Not sure if this is right either. An example of how I would call this solution:</p>\n\n<pre><code>func yourFunc() string {\n            return \"Hello world\"\n    } \n</code></pre>\n\n<hr>\n\n<pre><code>solution10(10, 100, yourFunc);\n</code></pre>\n\n<p>I'd love if someone can explain to me why I am getting that error (the return types of each function I'm passing in seem to be right.) Or if someone could just please offer a right solution for it so that I could learn tricks in how to solve these type of closure-related questions?</p>\n"}, {"tags": ["algorithm", "go"], "answers": [{"comments": [{"owner": {"reputation": 424, "user_id": 10226205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fyD0G.jpg?s=128&g=1", "display_name": "seemcat", "link": "https://stackoverflow.com/users/10226205/seemcat"}, "edited": false, "score": 0, "creation_date": 1546901305, "post_id": 54082924, "comment_id": 94999304, "body": "You&#39;re an angel. Lol. Thank you Chris!"}], "tags": [], "owner": {"reputation": 56502, "user_id": 271475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b00f41e5f2a69734051f2a78f4f3785?s=128&d=identicon&r=PG", "display_name": "Chris Heald", "link": "https://stackoverflow.com/users/271475/chris-heald"}, "is_accepted": false, "score": 10, "last_activity_date": 1546901067, "creation_date": 1546901067, "answer_id": 54082924, "question_id": 54082873, "link": "https://stackoverflow.com/questions/54082873/why-is-my-golang-algorithm-going-on-an-infinite-loop/54082924#54082924", "title": "Why is my GoLang algorithm going on an infinite loop?", "body": "<p>Your issue is operator precedence. The % operator has a higher precedence than the + operator, so if your <code>num</code> is, say, 10, your test is functionally:</p>\n\n<pre><code>10 + (0 % 7) == 0 =&gt; false (10)\n10 + (1 % 7) == 0 =&gt; false (11)\n10 + (2 % 7) == 0 =&gt; false (12)\n</code></pre>\n\n<p>etc.</p>\n\n<p>Obviously, for any <code>num</code> > 0, you'll never satisfy the condition. Change your test to <code>(num+i)%7 == 0</code> and you should find it works as expected.</p>\n"}], "owner": {"reputation": 424, "user_id": 10226205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fyD0G.jpg?s=128&g=1", "display_name": "seemcat", "link": "https://stackoverflow.com/users/10226205/seemcat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1546901067, "creation_date": 1546900735, "question_id": 54082873, "link": "https://stackoverflow.com/questions/54082873/why-is-my-golang-algorithm-going-on-an-infinite-loop", "title": "Why is my GoLang algorithm going on an infinite loop?", "body": "<p>I have been trying to solve the problem below in multiple ways (recursively, with the Go-version of do while loop, and with a for loop). But each one of them goes to an infinite loop. I tried using the same solution in JavaScript, and it works perfectly fine. Can someone please help me understand why the solution below is not working/going on an infinite loop?</p>\n\n<pre><code>// Write a function that takes in a number and returns the next number that is divisible by 7\npackage main                   \n\nfunc solution9(num int) int {  \n\n        var done bool = false  \n        var result int = 0     \n\n        for i := 1; done != true; i++ { \n                if (num + i % 7 == 0) {         \n                        result = num + i                \n                        done = true                     \n                }              \n        }                      \n\n        return result          \n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 75, "user_id": 1076483, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iHgYe.png?s=128&g=1", "display_name": "maf88", "link": "https://stackoverflow.com/users/1076483/maf88"}, "edited": false, "score": 0, "creation_date": 1546893925, "post_id": 54081505, "comment_id": 94996464, "body": "it seems that new temporary object is created when you use <code>range</code> so the address is not the same as the original list you want to refer to. Check this : <a href=\"https://garbagecollected.org/2017/02/22/go-range-loop-internals/\" rel=\"nofollow noreferrer\">garbagecollected.org/2017/02/22/go-range-loop-internals</a>"}, {"owner": {"reputation": 975, "user_id": 2541982, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e95fa747a8df1d2a618d5d4a61e8b3d3?s=128&d=identicon&r=PG", "display_name": "LearnOPhile", "link": "https://stackoverflow.com/users/2541982/learnophile"}, "reply_to_user": {"reputation": 75, "user_id": 1076483, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iHgYe.png?s=128&g=1", "display_name": "maf88", "link": "https://stackoverflow.com/users/1076483/maf88"}, "edited": false, "score": 0, "creation_date": 1546894734, "post_id": 54081505, "comment_id": 94996839, "body": "I understand what the problem is \u2013 the question is about the motivation for the language design."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1546895542, "post_id": 54081505, "comment_id": 94997198, "body": "If you have a question about someone&#39;s motivation, you would have to ask them - in this case, the Go language designers."}, {"owner": {"reputation": 975, "user_id": 2541982, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e95fa747a8df1d2a618d5d4a61e8b3d3?s=128&d=identicon&r=PG", "display_name": "LearnOPhile", "link": "https://stackoverflow.com/users/2541982/learnophile"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546949010, "post_id": 54081505, "comment_id": 95014941, "body": "@Adrian If asking on Stackoverflow is a good idea as well has been brought up here <a href=\"https://meta.stackexchange.com/questions/36850/language-design-questions-on-SO\" title=\"language design questions on SO\">meta.stackexchange.com/questions/36850/&hellip;</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1546958046, "post_id": 54081505, "comment_id": 95019983, "body": "@LearnOPhile did you actually read that post? Because I agree with it. Questions from a language designer about designing a language are fine, questions asking why some other designer made some choice they made should be closed."}, {"owner": {"reputation": 975, "user_id": 2541982, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e95fa747a8df1d2a618d5d4a61e8b3d3?s=128&d=identicon&r=PG", "display_name": "LearnOPhile", "link": "https://stackoverflow.com/users/2541982/learnophile"}, "edited": false, "score": 0, "creation_date": 1546971386, "post_id": 54081505, "comment_id": 95027608, "body": "I did not interpret it that way. From the thread regarding types of questions: &quot;Why does XXXX have YYYY [ok if not blindingly obvious]&quot;. Where did you get your perspective on this matter from?"}], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1546897278, "post_id": 54081813, "comment_id": 94997909, "body": "If the scope of the variable had been defined to be inside the loop, then a new <code>int</code> is only required when the value escapes.  At least one of the Go authors now thinks that the language should have been defined that way, but the change is to disruptive to make."}, {"owner": {"reputation": 975, "user_id": 2541982, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e95fa747a8df1d2a618d5d4a61e8b3d3?s=128&d=identicon&r=PG", "display_name": "LearnOPhile", "link": "https://stackoverflow.com/users/2541982/learnophile"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1546949711, "post_id": 54081813, "comment_id": 95015289, "body": "Thanks for your replies, very insightful. Do you happen to know if any author thinks it would have been best to only allow iterating over the index (not the value) with the range operator to get rid of this behaviour @ThunderCat?"}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 4, "last_activity_date": 1546894816, "creation_date": 1546894816, "answer_id": 54081813, "question_id": 54081505, "link": "https://stackoverflow.com/questions/54081505/why-is-the-golang-range-operator-implemented-with-declaration-of-a-local-variabl/54081813#54081813", "title": "Why is the golang range operator implemented with declaration of a local variable?", "body": "<p><a href=\"https://dave.cheney.net/2017/04/29/there-is-no-pass-by-reference-in-go\" rel=\"nofollow noreferrer\">Go does not have reference variables</a>.</p>\n\n<blockquote>\n  <p>It is not possible to create a Go program where two variables share the same storage location in memory. It is possible to create two variables whose contents point to the same storage location, but that is not the same thing as two variables who share the same storage location.</p>\n</blockquote>\n\n<p>Since <code>list</code> is an slice of <code>int</code> and not a slice of <code>*int</code>, there should not be any expectation that the address of <code>value := list[i]</code> would be the same as the address of <code>list[i]</code>.  Since we already know that <code>value</code> is a copy, and that modifying it in any way won't affect <code>list[i]</code>, it is far more performant to allocate the memory for an <code>int</code> once, and overwrite it each iteration of the loop, than to allocate a <em>new</em> <code>int</code> every iteration, and garbage collect the old one.</p>\n"}], "owner": {"reputation": 975, "user_id": 2541982, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e95fa747a8df1d2a618d5d4a61e8b3d3?s=128&d=identicon&r=PG", "display_name": "LearnOPhile", "link": "https://stackoverflow.com/users/2541982/learnophile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "closed_date": 1546962128, "answer_count": 1, "score": -3, "last_activity_date": 1546894816, "creation_date": 1546893342, "question_id": 54081505, "link": "https://stackoverflow.com/questions/54081505/why-is-the-golang-range-operator-implemented-with-declaration-of-a-local-variabl", "closed_reason": "Opinion-based", "title": "Why is the golang range operator implemented with declaration of a local variable?", "body": "<p>When looping using the golang <code>range</code> operator combined with the address-of <code>&amp;</code> operator we can get a somewhat unexpected behaviour. </p>\n\n<p>Take the example:</p>\n\n<pre><code>list := []int{1, 2}\npointerList := []*int{}\nfor _, value := range list {\n    pointerList = append(pointerList, &amp;value)\n}\n\nfmt.Print(*pointerList[0], *pointerList[1])\n// Prints: 2 2\n</code></pre>\n\n<p>This prints <code>2 2</code> because the variable <code>value</code> is only declared once and will change value for each iteration (while the address of <code>value</code> stays the same).</p>\n\n<p>Q: Why does the go compiler not interpret the above code as if <code>value</code> was replaced by <code>list[i]</code>, like so:</p>\n\n<pre><code>list := []int{1, 2}\npointerList := []*int{}\nfor i := range list {\n    pointerList = append(pointerList, &amp;list[i])\n}\n\nfmt.Print(*pointerList[0], *pointerList[1])\n// Prints: 1 2\n</code></pre>\n\n<p>If I'm not mistaken it is possible to do this interpretation for any use of <code>range</code> in a for loop. The behaviour seems more predictable and should be more performant if iterating over large objects (no extra copying to the local variable).</p>\n\n<p>The example code:</p>\n\n<p><a href=\"https://play.golang.org/p/y89nMxVgBEs\" rel=\"nofollow noreferrer\">https://play.golang.org/p/y89nMxVgBEs</a></p>\n\n<p><a href=\"https://play.golang.org/p/qHnJXMuHKdJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qHnJXMuHKdJ</a></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2848, "user_id": 3152127, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/491f8f327df08264110871e1a80e4dee?s=128&d=identicon&r=PG&f=1", "display_name": "Luke Exton", "link": "https://stackoverflow.com/users/3152127/luke-exton"}, "is_accepted": true, "score": 6, "last_activity_date": 1546887658, "creation_date": 1546887658, "answer_id": 54080259, "question_id": 54080258, "link": "https://stackoverflow.com/questions/54080258/how-to-use-forked-packages-with-dep-golang/54080259#54080259", "title": "How to use forked packages with dep golang?", "body": "<p>While <code>dep</code> is no longer the prefered way of doing this, (go modules preferred as of go1.11)</p>\n\n<p>With constraints this is easy, it will still be referenced everywhere in code and resolved via <code>github.com/upstream/repo</code>.</p>\n\n<pre><code>[[constraint]]\n  name = \"github.com/upstream/repo\"\n  branch = \"forked-branch-name\"\n  source = \"github.com/lexton/repo\"\n</code></pre>\n"}], "owner": {"reputation": 2848, "user_id": 3152127, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/491f8f327df08264110871e1a80e4dee?s=128&d=identicon&r=PG&f=1", "display_name": "Luke Exton", "link": "https://stackoverflow.com/users/3152127/luke-exton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 54080259, "answer_count": 1, "score": 1, "last_activity_date": 1546887658, "creation_date": 1546887658, "question_id": 54080258, "link": "https://stackoverflow.com/questions/54080258/how-to-use-forked-packages-with-dep-golang", "title": "How to use forked packages with dep golang?", "body": "<p>How can I use my own forked package easily using dep?</p>\n\n<p>I would love to be able to use the upstream again when my changes are accepted.</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "amazon-rds", "aws-lambda-go"], "comments": [{"owner": {"reputation": 137816, "user_id": 13070, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/pio3A.jpg?s=128&g=1", "display_name": "Mark B", "link": "https://stackoverflow.com/users/13070/mark-b"}, "edited": false, "score": 5, "creation_date": 1546886585, "post_id": 54079985, "comment_id": 94993429, "body": "This is a network configuration issue, not a permissions issue. You would be getting a permissions error, not a timeout, if it was a permissions thing. Is the Lambda function running in the same VPC as the RDS instance?"}, {"owner": {"reputation": 303, "user_id": 1718072, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fSloc.jpg?s=128&g=1", "display_name": "Michael MacDonald", "link": "https://stackoverflow.com/users/1718072/michael-macdonald"}, "reply_to_user": {"reputation": 137816, "user_id": 13070, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/pio3A.jpg?s=128&g=1", "display_name": "Mark B", "link": "https://stackoverflow.com/users/13070/mark-b"}, "edited": false, "score": 0, "creation_date": 1546887157, "post_id": 54079985, "comment_id": 94993643, "body": "@MarkB It wasn&#39;t, but I did that now and now it doesn&#39;t timeout, but after about a minute it gives me &quot;Calling the invoke API action failed with this message: An error occurred and the request cannot be processed.&quot;  This is the part I&#39;m definitely not getting. What is the desired set up for a Lambda function and RDS server to work together?"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1546888969, "post_id": 54079985, "comment_id": 94994471, "body": "You may not want to open connections in lambdas. If enough of those lambdas are running concurrently, you&#39;ll hit the maximum number of concurrent connections."}, {"owner": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "edited": false, "score": 1, "creation_date": 1546890773, "post_id": 54079985, "comment_id": 94995191, "body": "Not related to your question, but a helpful note: you should store things like database name, host, port, user, password as environment variables rather than having them as string literals in your code. This way you don&#39;t have to modify source code for development/deployment/testing and your password won&#39;t be checked into source control (git) so it stays private"}, {"owner": {"reputation": 303, "user_id": 1718072, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fSloc.jpg?s=128&g=1", "display_name": "Michael MacDonald", "link": "https://stackoverflow.com/users/1718072/michael-macdonald"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1546891514, "post_id": 54079985, "comment_id": 94995537, "body": "@jubobs You mean the sql.Open()? How would I connect to the database outside of the lambda?  It&#39;s an APIGateway Post method that is calling this, so it needs to get data from the DB and return it, can I make a connection somewhere else that is accessible by all Lambdas?"}, {"owner": {"reputation": 303, "user_id": 1718072, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fSloc.jpg?s=128&g=1", "display_name": "Michael MacDonald", "link": "https://stackoverflow.com/users/1718072/michael-macdonald"}, "reply_to_user": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "edited": false, "score": 0, "creation_date": 1546891612, "post_id": 54079985, "comment_id": 94995585, "body": "@HenryWoody if I store them as Env variables are they available to all other Lambdas as well? Because that&#39;s also something I was wondering about. Otherwise all my Lambdas will end up having that same connection string in them. Are env vars globally accessible by all Lambdas?"}, {"owner": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "edited": false, "score": 1, "creation_date": 1546891819, "post_id": 54079985, "comment_id": 94995683, "body": "@OscarWilde I&#39;ve only set up Lambdas where the environment variables are local only to that specific Lambda. I believe there is a way to share env vars across Lambdas. So either way works. If you&#39;re using the console, there is a section called &quot;Environment Variables&quot; right under &quot;Function Code&quot;"}, {"owner": {"reputation": 450, "user_id": 6284370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HihDM.jpg?s=128&g=1", "display_name": "Sameera Piyasundara", "link": "https://stackoverflow.com/users/6284370/sameera-piyasundara"}, "edited": false, "score": 0, "creation_date": 1546936965, "post_id": 54079985, "comment_id": 95008444, "body": "When using RDS with lambda you should add the following line as your first line within the lambda function to avoid timeout before connecting to the rds,  <code>context.callbackWaitsForEmptyEventLoop = false;</code>"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1547052097, "post_id": 54079985, "comment_id": 95062064, "body": "@OscarWilde This blog post argues against using connection-based services like RDBMS in lambdas: <a href=\"https://medium.com/@PaulDJohnston/serverless-best-practices-b3c97d551535\" rel=\"nofollow noreferrer\">medium.com/@PaulDJohnston/&hellip;</a>"}], "owner": {"reputation": 303, "user_id": 1718072, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/fSloc.jpg?s=128&g=1", "display_name": "Michael MacDonald", "link": "https://stackoverflow.com/users/1718072/michael-macdonald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 278, "favorite_count": 2, "answer_count": 0, "score": 0, "last_activity_date": 1547052166, "creation_date": 1546886390, "last_edit_date": 1547052166, "question_id": 54079985, "link": "https://stackoverflow.com/questions/54079985/my-lambda-function-is-timing-out-when-i-try-to-ping-a-db-connection", "title": "My Lambda function is timing out when I try to ping a DB connection", "body": "<p>It seems like a very simple thing but my connection times out every time.</p>\n\n<p>Here is the code in the Lambda function (written in Go)</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"log\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n    // \"github.com/aws/aws-sdk-go/service/rds\"\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n)\n\nfunc Handler(request events.APIGatewayProxyRequest) {\n\n    db, err := sql.Open(\"mysql\", \"username:password(my-database-address:3306)/db_name\")\n\n    if err != nil {\n        log.Print(err.Error())\n    }\n\n    defer db.Close()\n\n    err = db.Ping()\n\n    if err != nil {\n        log.Print(err.Error())\n    }\n\n}\n\nfunc main() {\n    lambda.Start(Handler)\n}\n</code></pre>\n\n<p>Obviously I've removed the real username, password, address, and db-name but I've verified they are all correct (I can connect to the DB through MySQLWorkbench with the same details).</p>\n\n<p>I'm assuming it has to do with permissions or something? My Lambda function <em>does</em> have permission to access full RDS functionality.</p>\n\n<p>I also tried removing the defer db.Close() thinking maybe it's leaving the connection open indefinitely but that didn't seem to change much.</p>\n\n<p>I had it working <em>without</em> the db.Ping since sql.Open doesn't actually create the connection.</p>\n\n<p>I'm new to AWS so I'm having trouble figuring out how to debug this. Where would I find a logged event showing where the blockage is? Or is there something wrong in the connection I'm making here?</p>\n"}, {"tags": ["function", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1546884599, "post_id": 54079506, "comment_id": 94992608, "body": "No difference. The original author was being &quot;clever&quot; and saving a couple of keystrokes once at the cost of clarity, a poor trade-off."}], "answers": [{"tags": [], "owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "is_accepted": false, "score": 0, "last_activity_date": 1546885956, "creation_date": 1546885956, "answer_id": 54079900, "question_id": 54079506, "link": "https://stackoverflow.com/questions/54079506/goroutine-that-returns-two-channels/54079900#54079900", "title": "GoRoutine that Returns Two Channels", "body": "<p>This is the <code>func</code> declaration </p>\n\n<pre><code>FunctionType   = \"func\" Signature .\nSignature      = Parameters [ Result ] .\nResult         = Parameters | Type .\nParameters     = \"(\" [ ParameterList [ \",\" ] ] \")\" .\nParameterList  = ParameterDecl { \",\" ParameterDecl } .\nParameterDecl  = [ IdentifierList ] [ \"...\" ] Type .\n</code></pre>\n\n<p>As you can see, the <code>Result</code> is like method's parameters a <code>Parameters</code> which in turn boils down to an <code>IdentifierList</code>. There comes the blank identifier <code>_</code> that can replace every identifier in the <code>IdentifierList</code>. </p>\n\n<p>The original author used this together with the \"multiple identifiers declared to the same type\" syntax to produce - as already mentioned - a strange to read declaration of two return values of the same type.</p>\n\n<p>See <a href=\"https://golang.org/ref/spec#Function_declarations\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Function_declarations</a></p>\n\n<p>You can also implement functions which \"delete\" parameters by using the blank identifier for them. May come handy, when you don't need the parameter of an interface you implement.</p>\n\n<pre><code>func foo(a string, _ int, b string) { ... }\n</code></pre>\n\n<p>The second parameter is not usable.</p>\n"}, {"tags": [], "owner": {"reputation": 1138, "user_id": 296066, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/940b69b965704253eca438cdfaf72b15?s=128&d=identicon&r=PG", "display_name": "metalim", "link": "https://stackoverflow.com/users/296066/metalim"}, "is_accepted": true, "score": 2, "last_activity_date": 1546888443, "creation_date": 1546888443, "answer_id": 54080429, "question_id": 54079506, "link": "https://stackoverflow.com/questions/54079506/goroutine-that-returns-two-channels/54080429#54080429", "title": "GoRoutine that Returns Two Channels", "body": "<p><code>(_, _ &lt;-chan interface{})</code> is equivalent to <code>(&lt;-chan interface{}, &lt;-chan interface{})</code>. There are no differences, except source code length and readability.</p>\n\n<ol>\n<li>We start with <code>(&lt;-chan interface{}, &lt;-chan interface{})</code> return value types.</li>\n<li>As return values can have names, one can write <code>(ch1 &lt;-chan interface{}, ch2 &lt;-chan interface{})</code> to return same 2 channels.</li>\n<li>Sequence of arguments (or return values) with same types can omit types for all variables except last one. Hence our return types become: <code>(ch1, ch2 &lt;-chan interface{})</code></li>\n<li>And since we don't really need the names of return values, we can substitute names with underscore, making them anonymous again: <code>(_, _ &lt;-chan interface{})</code></li>\n</ol>\n\n<p>Voila! Readable pair of channels of the same type.</p>\n"}], "owner": {"reputation": 23, "user_id": 10823268, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-baDW2_2cfnU/AAAAAAAAAAI/AAAAAAAAAyw/8fRUsfLvIpw/photo.jpg?sz=128", "display_name": "Woo Xiong Wei Warren", "link": "https://stackoverflow.com/users/10823268/woo-xiong-wei-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 54080429, "answer_count": 2, "score": 2, "last_activity_date": 1546888443, "creation_date": 1546884235, "question_id": 54079506, "link": "https://stackoverflow.com/questions/54079506/goroutine-that-returns-two-channels", "title": "GoRoutine that Returns Two Channels", "body": "<p>Can someone please help me understand how to interpret the following line of code in the function return - <b>(_, _ &lt;-chan interface{})</b></p>\n\n<p>I understand that the function returns two channels. But I don't understand how it is achieved using the following (_, _ &lt;-chan interface{}). What is the difference if I just swap it out for (&lt;-chan interface{}, &lt;-chan interface{})?</p>\n\n<pre><code>tee := func(\n    done &lt;-chan interface{},\n    in &lt;-chan interface{},\n) (_, _ &lt;-chan interface{}) {\n    out1 := make(chan interface{})\n    out2 := make(chan interface{})\n\n    go func() {\n        defer close(out1)\n        defer close(out2)\n\n        for val := range orDone(done, in) {\n            var out1, out2 = out1, out2\n            for i := 0; i &lt; 2; i++ {\n                select {\n                case &lt;-done:\n                case out1 &lt;- val:\n                    out1 = nil\n                case out2 &lt;- val:\n                    out2 = nil\n                }\n            }\n        }\n    }()\n    return out1, out2\n}`\n</code></pre>\n"}, {"tags": ["for-loop", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1546884011, "post_id": 54079429, "comment_id": 94992365, "body": "Don&#39;t mutate the map while you&#39;re iterating over it. You can change the values but you shouldn&#39;t add or remove any items."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546884486, "post_id": 54079429, "comment_id": 94992564, "body": "Plus if you&#39;re trying to modify a <i>key</i> in a map, you should rethink your design. As you&#39;ve seen from having to remove and re-add the item to fake changing the key, map keys are immutable. Maybe you just want a slice of items where each item has field for key?"}, {"owner": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546886981, "post_id": 54079429, "comment_id": 94993583, "body": "Do you mean like a struct? Key and Value stored inside?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546887875, "post_id": 54079429, "comment_id": 94993965, "body": "Yes, like a struct."}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1546886783, "post_id": 54079563, "comment_id": 94993514, "body": "Thank you so much! Appreciate your help :)  I&#39;m now trying to remove a value... and as stated before, you should never mutate the map via a range loop so how would I do it using this method?      <code>if v, ok := data[k]; ok { \t \t\t\tdata[k] = append(data[k][:i], data[k][i+1:]...)  \t\t\tfmt.Fprintf(w, &quot;KEY: %v: VALUE: %v was deleted successfully&quot;, k, v)</code>"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1546887108, "post_id": 54079563, "comment_id": 94993624, "body": "@RossBown It&#39;s only the keys you have to worry about. You can change the values all you like. But there&#39;s no more iteration here, so you&#39;re safe. And it&#39;s not clear what you&#39;re trying to do there. Ask another question."}, {"owner": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1546887426, "post_id": 54079563, "comment_id": 94993769, "body": "I want to delete just one value, from the slice of string in the MAP... do i loop through the values and delete the one which matches the param in the URL... or is there a better way? From what I can see on the docs, there isn&#39;t a way to loop through and delete the value via the name of it, but rather you have to find the index, and delete that."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1546888298, "post_id": 54079563, "comment_id": 94994147, "body": "@RossBown Removing a value from a slice is a separate problem from changing its key in a map. Ask another question about that."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "edited": false, "score": 0, "creation_date": 1546888587, "post_id": 54079563, "comment_id": 94994301, "body": "@RossBown See <a href=\"https://stackoverflow.com/questions/25025409/delete-element-in-a-slice#25025536\" title=\"delete element in a slice%2325025536\">stackoverflow.com/questions/25025409/&hellip;</a>"}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 4, "last_activity_date": 1546884914, "last_edit_date": 1546884914, "creation_date": 1546884523, "answer_id": 54079563, "question_id": 54079429, "link": "https://stackoverflow.com/questions/54079429/updating-a-key-in-a-map-whilst-iterating-over-that-map/54079563#54079563", "title": "Updating a key in a map, whilst iterating over that map", "body": "<p>In most languages, altering a structure you're iterating over will cause strange things to happen. Particularly maps. You have to find another way.</p>\n\n<p>Fortunately there's no need to iterate at all. Your loop is just one big if/else statement. If the key matches, do something. If it doesn't, do something else. Since this is a map, there's no need to search for the key using iteration, it can be looked up directly. There's also no need for all that laborious looping just to copy a map value.</p>\n\n<pre><code>if val, ok := data[k]; ok {\n    // Copy the value\n    data[nk] = val\n    // Delete the old key\n    delete(data, k)\n} else {\n    fmt.Fprintf(w, \"The key %v doesn't exist\", k)\n}\n</code></pre>\n\n<p>Finally, avoid using globals in functions. It makes it difficult to understand what effect a function has on the program if it can change globals. <code>data</code> should be passed in to the function to make it clear.</p>\n\n<pre><code>func handleUpdateKey(w http.ResponseWriter, r *http.Request, data map[string][]string)\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 8876584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df54abd457db696097769b4e38d29c9e?s=128&d=identicon&r=PG&f=1", "display_name": "Ross Bown", "link": "https://stackoverflow.com/users/8876584/ross-bown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 54079563, "answer_count": 1, "score": -1, "last_activity_date": 1546884914, "creation_date": 1546883859, "question_id": 54079429, "link": "https://stackoverflow.com/questions/54079429/updating-a-key-in-a-map-whilst-iterating-over-that-map", "title": "Updating a key in a map, whilst iterating over that map", "body": "<p>I want to update the key from one name to another using URL params. I have the code, but the output is incorrect. See below.</p>\n\n<p>This is the map</p>\n\n<pre><code>var data map[string][]string\n</code></pre>\n\n<p>The PUT method for the function im calling</p>\n\n<pre><code>r.HandleFunc(\"/updatekey/{key}/{newkey}\", handleUpdateKey).Methods(\"PUT\")\n</code></pre>\n\n<p>The handleUpdateKey func, which is noted up explaining exactly what it's doing.</p>\n\n<pre><code>func handleUpdateKey(w http.ResponseWriter, r *http.Request) {\nparams := mux.Vars(r)\n\nk := params[\"key\"] //get url params\nnk := params[\"newkey\"]\n\ns := make([]string, len(data[k])) //create slice of string to store map variables\nfor i := range data {             //range over the data map\n    fmt.Fprintf(w, i)\n    if k != i { //check if no keys exist with URL key param\n        fmt.Fprintf(w, \"That KEY doesn't exist in memory\")\n        break //kill the loop\n    } else { //if there is a key the same as the key param\n        for _, values := range data[i] { //loop over the slice of string (values in that KEY)\n            s = append(s, values) //append all those items to the slice of string\n        }\n\n        delete(data, k) //delete the old key\n\n        for _, svalues := range s { //loop over the slice of string we created earlier\n            data[nk] = append(data[nk], svalues) //append the items within the slice of string, to the new key... replicating the old key, with a new key name\n        }\n    }\n}\n}\n</code></pre>\n\n<p>The below should assign all the values of that KEY to a slice of string, which we later iterate over and add to the new KEY. This works, however, the output is as below which is clearly incorrect</p>\n\n<pre><code>KEY: catt: VALUE: \nKEY: catt: VALUE: \nKEY: catt: VALUE: zeus\nKEY: catt: VALUE: xena\n</code></pre>\n\n<p>OLD OUTPUT:</p>\n\n<pre><code>KEY: dog: VALUE: zeus\nKEY: dog: VALUE: xena\n</code></pre>\n\n<p>CORRECT NEW OUTPUT:</p>\n\n<pre><code>KEY: catt: VALUE: zeus\nKEY: catt: VALUE: xena\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "knative"], "answers": [{"tags": [], "owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "is_accepted": true, "score": 4, "last_activity_date": 1546927496, "creation_date": 1546927496, "answer_id": 54086029, "question_id": 54078705, "link": "https://stackoverflow.com/questions/54078705/knative-pod-http-request/54086029#54086029", "title": "Knative pod http request", "body": "<p>Knative uses <a href=\"https://istio.io\" rel=\"nofollow noreferrer\">Istio</a> and Istio, by default, doesn't allow outbound traffic to external hosts, such as httpbin.org. That's why your request is failing.</p>\n\n<p>Follow <a href=\"https://github.com/knative/docs/blob/f31d7106a119b453b0dbf208c3b1c0d698af4323/serving/outbound-network-access.md\" rel=\"nofollow noreferrer\">this document</a> to learn how to configure Knative (so that it configures Istio correctly) to make outbound connections. Or, you can directly configure the Istio by adding an egress policy: <a href=\"https://istio.io/docs/tasks/traffic-management/egress/\" rel=\"nofollow noreferrer\">https://istio.io/docs/tasks/traffic-management/egress/</a></p>\n"}], "owner": {"reputation": 479, "user_id": 2001554, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1b78a957dda49ae7f600667156f0f433?s=128&d=identicon&r=PG", "display_name": "Vitaliy Vostrikov", "link": "https://stackoverflow.com/users/2001554/vitaliy-vostrikov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 54086029, "answer_count": 1, "score": 0, "last_activity_date": 1546927496, "creation_date": 1546880606, "last_edit_date": 1546881886, "question_id": 54078705, "link": "https://stackoverflow.com/questions/54078705/knative-pod-http-request", "title": "Knative pod http request", "body": "<p>When I make request for this started server: <a href=\"https://gist.github.com/Rasarts/1180479de480d7e36d6d7aef08babe59#file-server\" rel=\"nofollow noreferrer\">https://gist.github.com/Rasarts/1180479de480d7e36d6d7aef08babe59#file-server</a></p>\n\n<p>I get right response:</p>\n\n<pre><code>{\n  \"args\": {}, \n  \"headers\": {\n    \"Accept-Encoding\": \"gzip\", \n    \"Connection\": \"close\", \n    \"Host\": \"httpbin.org\", \n    \"User-Agent\": \"Go-http-client/1.1\"\n  }, \n  \"origin\": \"\", \n  \"url\": \"https://httpbin.org/get\"\n}\n</code></pre>\n\n<p>But when I make request to that server on minikube which was created this way:\n<a href=\"https://gist.github.com/Rasarts/1180479de480d7e36d6d7aef08babe59#file-serve-yaml\" rel=\"nofollow noreferrer\">https://gist.github.com/Rasarts/1180479de480d7e36d6d7aef08babe59#file-serve-yaml</a></p>\n\n<p>I get error:</p>\n\n<pre><code>ERROR: Get https://httpbin.org/get: EOF&lt;nil&gt;\n</code></pre>\n\n<p>How can I make http requests from kubernetes pod?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1546879994, "creation_date": 1546879994, "answer_id": 54078563, "question_id": 54078378, "link": "https://stackoverflow.com/questions/54078378/confused-by-interface-embeded-in-struct-in-golang/54078563#54078563", "title": "Confused by interface embeded in struct in golang", "body": "<p>Embedded fields are accessed by their type name, and fields of an interface are only accessible by asserting the underlying type, so <code>b.A.(AA).X</code> will get you field <code>X</code> of the underlying <code>AA</code> that's in <code>b.A</code>. But if you're needing to access fields, you probably shouldn't be embedding the interface type anyway, you should be embedding the concrete type.</p>\n"}], "owner": {"reputation": 76, "user_id": 7162360, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ace8f9bfcc6090911024a2f001aee6b9?s=128&d=identicon&r=PG&f=1", "display_name": "shanyy", "link": "https://stackoverflow.com/users/7162360/shanyy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 54078563, "answer_count": 1, "score": -1, "last_activity_date": 1546879994, "creation_date": 1546879202, "question_id": 54078378, "link": "https://stackoverflow.com/questions/54078378/confused-by-interface-embeded-in-struct-in-golang", "title": "Confused by interface embeded in struct in golang", "body": "<p>Like code here, when embedding an interface A into struct B, and then set A to aa which is an instance of AA. Both B and AA have element X, when call b.X I just got B.X. How can I get b.AA.X? I know this syntax is wired, but I just want to figure out how var b is stored in the memory, I tried some unsafe syntax, no way to get b.A.X.:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype A interface {\n    Hello() string\n}\n\ntype B struct {\n    A\n    X string\n}\n\ntype AA struct {\n    num int\n    X   string\n}\n\nfunc (aa AA) Hello() string {\n    return fmt.Sprintf(\"hello %d from %s\", aa.num, aa.X)\n}\n\nfunc main() {\n    aa := AA{200, \"golang\"}\n    b := B{A: aa, X: \"python\"}\n    fmt.Println(b.X)                                          // output: python\n    fmt.Printf(\"---&gt;%d\\n\", ((*AA)(unsafe.Pointer(&amp;b.A)).num)) // output:  ---&gt;17667104\n    fmt.Printf(\"===&gt;%+v\\n\", b.A)                              // output: ===&gt;{num:200 X:golang}\n}\n</code></pre>\n"}, {"tags": ["go", "dependency-injection", "inversion-of-control"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user745235"}, "edited": false, "score": 1, "creation_date": 1546878739, "post_id": 54077969, "comment_id": 94989845, "body": "What are the errors?"}, {"owner": {"reputation": 2454, "user_id": 2520628, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/0zmcN.jpg?s=128&g=1", "display_name": "Tejashwi Kalp Taru", "link": "https://stackoverflow.com/users/2520628/tejashwi-kalp-taru"}, "edited": false, "score": 0, "creation_date": 1546880385, "post_id": 54077969, "comment_id": 94990691, "body": "@Gerep updated the post, thank you"}], "answers": [{"comments": [{"owner": {"reputation": 2454, "user_id": 2520628, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/0zmcN.jpg?s=128&g=1", "display_name": "Tejashwi Kalp Taru", "link": "https://stackoverflow.com/users/2520628/tejashwi-kalp-taru"}, "edited": false, "score": 0, "creation_date": 1546938652, "post_id": 54088387, "comment_id": 95009325, "body": "Thank you for your help, I need to return back both the instance and error. If I try with your code, I am getting the error <code>call to wire.Build indicates that this function is an injector, but injectors must consist of only the wire.Build call and an optional return</code>"}, {"owner": {"reputation": 1, "user_id": 9794626, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ePoL5UOuI54/AAAAAAAAAAI/AAAAAAAAA6Y/wgjkWIowwVw/photo.jpg?sz=128", "display_name": "Sandeep Sukhani", "link": "https://stackoverflow.com/users/9794626/sandeep-sukhani"}, "reply_to_user": {"reputation": 2454, "user_id": 2520628, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/0zmcN.jpg?s=128&g=1", "display_name": "Tejashwi Kalp Taru", "link": "https://stackoverflow.com/users/2520628/tejashwi-kalp-taru"}, "edited": false, "score": 0, "creation_date": 1546944609, "post_id": 54088387, "comment_id": 95012610, "body": "My bad, I checked wire package, it does not allow expressions other than wire.build. I do not see any way to add error with wire.InterfaceValue. You need to pass just the instance of mockedArango"}], "tags": [], "owner": {"reputation": 1, "user_id": 9794626, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ePoL5UOuI54/AAAAAAAAAAI/AAAAAAAAA6Y/wgjkWIowwVw/photo.jpg?sz=128", "display_name": "Sandeep Sukhani", "link": "https://stackoverflow.com/users/9794626/sandeep-sukhani"}, "is_accepted": false, "score": 0, "last_activity_date": 1546938283, "creation_date": 1546938283, "answer_id": 54088387, "question_id": 54077969, "link": "https://stackoverflow.com/questions/54077969/go-wire-wiring-up-the-dependencies/54088387#54088387", "title": "go wire, wiring up the dependencies", "body": "<p>Signature of wire.Interface is\n<code>InterfaceValue(typ interface{}, x interface{})</code></p>\n\n<p>Here you need to pass two single-valued arguments. In the second argument, you are passing 2-valued argument since function <code>mockdb.NewMockedArango</code> is returning 2 values.</p>\n\n<p>You can change function ResolveMockArangoDB to:</p>\n\n<pre><code>func ResolveMockArangoDB(idGenerator idgenerator.IDGenerator) (arangodb.Arango, error) {\n    mockedArango, err := mockdb.NewMockedArango(idGenerator)\n    &lt;HANDLE err&gt;\n    panic(wire.Build(wire.InterfaceValue(new(arangodb.Arango), mockedArango)))\n}\n</code></pre>\n"}], "owner": {"reputation": 2454, "user_id": 2520628, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/0zmcN.jpg?s=128&g=1", "display_name": "Tejashwi Kalp Taru", "link": "https://stackoverflow.com/users/2520628/tejashwi-kalp-taru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1365, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546938283, "creation_date": 1546877719, "last_edit_date": 1546880366, "question_id": 54077969, "link": "https://stackoverflow.com/questions/54077969/go-wire-wiring-up-the-dependencies", "title": "go wire, wiring up the dependencies", "body": "<p>I am using <a href=\"https://github.com/google/wire\" rel=\"nofollow noreferrer\">Google wire</a> to wire up the dependencies in one of my Go projects. So far all the dependencies were wired up successfully.</p>\n\n<p>I have following container:</p>\n\n<pre><code>type Container struct {\n    Logger               logger.StructuredLogger\n    IDGenerator          idgenerator.IDGenerator\n    Arango               arangodb.Arango\n}\n</code></pre>\n\n<p>Here <code>StructuredLogger</code>, <code>IDGenerator</code> and <code>Arango</code> are interface.</p>\n\n<p>The container set is defined as below:</p>\n\n<pre><code>var mockContainerSet = wire.NewSet(\n    Container{},\n    ResolveStructuredLogger,\n    ResolveIDGenerator,\n    ResolveArangoDB,\n)\n</code></pre>\n\n<p>Functions:</p>\n\n<pre><code>func ResolveStructuredLogger() logger.StructuredLogger {\n    panic(wire.Build(wire.InterfaceValue(new(logger.StructuredLogger), logrusprovider.NewLogrusLogger(nil))))\n}\n\nfunc ResolveIDGenerator() idgenerator.IDGenerator {\n    panic(wire.Build(wire.InterfaceValue(new(idgenerator.IDGenerator), examples.NewKSUIDGenerator())))\n}\n</code></pre>\n\n<p>Now the issue is when I want to create a provider for <code>Arango</code>. The factory method for <code>Arango</code> provider is taking <code>IDGenerator</code> as an argument.</p>\n\n<pre><code>func NewMockedArango(generator idgenerator.IDGenerator) (*MockedArango, error){\n    if generator == nil {\n        return nil , errors.New(\"mock arangodb expects a valid IDGenerator\")\n    }\n    return &amp;MockedArango{generator:generator}, nil\n}\n</code></pre>\n\n<p>All the functions from <code>arangodb.Arango</code> is implemented. And I tried the following to create a provider:</p>\n\n<pre><code>func ResolveMockArangoDB(idGenerator idgenerator.IDGenerator) (arangodb.Arango, error) {\n    panic(wire.Build(wire.InterfaceValue(new(arangodb.Arango), mockdb.NewMockedArango(idGenerator))))\n}\n</code></pre>\n\n<p>But the wire is throwing errors, I tried a lot of ways and no success to set this up. Any help?</p>\n\n<p>Error:</p>\n\n<blockquote>\n  <p>2-valued mockdb.NewMockedArango(idGenerator) (value of type\n  (*github.com/tejashwi/catalog-manager-svc/pkg/webservice/arangodb/mockdb.MockedArango,\n  error)) where single value is expected</p>\n</blockquote>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "edited": false, "score": 1, "creation_date": 1546870786, "post_id": 54075855, "comment_id": 94985247, "body": "You shouldn&#39;t omit errors in Go: <code>modelsJson, _ := json.Marshal(modelSliceReflect)</code> - here the error may show why marshalling is failing."}, {"owner": {"reputation": 53, "user_id": 1842370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c517fc1f728bd563fb2242c365f13590?s=128&d=identicon&r=PG", "display_name": "ImEagle", "link": "https://stackoverflow.com/users/1842370/imeagle"}, "reply_to_user": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "edited": false, "score": 0, "creation_date": 1546871035, "post_id": 54075855, "comment_id": 94985402, "body": "Forgot about that, but there is no error."}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546873088, "post_id": 54075855, "comment_id": 94986602, "body": "You fill <code>&amp;models</code> with gorm but you marshal <code>modelSliceReflect</code>. This looks inconsistent."}, {"owner": {"reputation": 53, "user_id": 1842370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c517fc1f728bd563fb2242c365f13590?s=128&d=identicon&r=PG", "display_name": "ImEagle", "link": "https://stackoverflow.com/users/1842370/imeagle"}, "reply_to_user": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546873402, "post_id": 54075855, "comment_id": 94986771, "body": "@thst Oh... probably left that after weird testing. Anyway that didn&#39;t fix anything, but thanks for pointing. (Code edited)"}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546873608, "post_id": 54075855, "comment_id": 94986913, "body": "will you try to catch err on marshall and have it printed? Don&#39;t know why you are so sure about, that there is no error on marshaling..."}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546873910, "post_id": 54075855, "comment_id": 94987100, "body": "Also remarkable, but I don&#39;t know gorm: Your <code>TableName</code> func returns <code>user</code>, your query calls for <code>users</code>."}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546876883, "post_id": 54075855, "comment_id": 94988767, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/52470276/how-do-i-serialize-a-map-of-type-stringreflect-value\">How do I serialize a map of type &#91;string&#93;reflect.Value?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "is_accepted": true, "score": 1, "last_activity_date": 1546877099, "last_edit_date": 1546877099, "creation_date": 1546876563, "answer_id": 54077650, "question_id": 54075855, "link": "https://stackoverflow.com/questions/54075855/generic-handling-crud-actions-in-golang/54077650#54077650", "title": "Generic handling CRUD actions in golang", "body": "<p>The problem rises from the fact that the json package handles <code>reflect.Value</code> not as expected. You can find a similar discussion here: <a href=\"https://github.com/golang/go/issues/7846\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/7846</a></p>\n\n<p>As you can see in the following code snippet, <code>reflect.MakeSlice</code> returns a type <code>Value</code>, not a slice.</p>\n\n<pre><code>slice_empty_reflect_make := reflect.MakeSlice(\n                                    reflect.SliceOf(\n                                            reflect.TypeOf(5)),\n                                    10, 10)\n\nfmt.Printf(\"Type of reflect.MakeSlice(): %s\\n\",\n           reflect.TypeOf(slice_empty_reflect_make).Name())\n</code></pre>\n\n<p>This yields: </p>\n\n<pre><code>Type of reflect.MakeSlice(): Value\n</code></pre>\n\n<p>When you feed the <code>Value</code> in the json marshaller, it will return an object, not an array: </p>\n\n<pre><code>Json: {}\nError: &lt;nil&gt;\n</code></pre>\n\n<p>You need to get back to the interface of the <code>Value</code> by using <code>.Interface()</code>:</p>\n\n<pre><code>jsonBytes, err := json.Marshal(slice_empty_reflect_make.Interface())\n</code></pre>\n\n<p>And this is a duplicate in disguise of <a href=\"https://stackoverflow.com/questions/52470276/how-do-i-serialize-a-map-of-type-stringreflect-value\">How do I serialize a map of type [string]reflect.Value?</a></p>\n"}], "owner": {"reputation": 53, "user_id": 1842370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c517fc1f728bd563fb2242c365f13590?s=128&d=identicon&r=PG", "display_name": "ImEagle", "link": "https://stackoverflow.com/users/1842370/imeagle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 512, "favorite_count": 0, "accepted_answer_id": 54077650, "answer_count": 1, "score": 0, "last_activity_date": 1546877099, "creation_date": 1546869665, "last_edit_date": 1546873277, "question_id": 54075855, "link": "https://stackoverflow.com/questions/54075855/generic-handling-crud-actions-in-golang", "title": "Generic handling CRUD actions in golang", "body": "<p>I'm trying to create view that will handle all basic CRUD operations on my gorm models.\nThe goal is to pass model to the view and let all the magic happen.</p>\n\n<p>I found topics about using reflections, so I did, but also read that is not \"golang way\".</p>\n\n<p>The first problem that I head with this is gorm using always \"value\" table. So temporary solution for that is to force using \"users\" table or table name from <code>CommonView</code></p>\n\n<pre><code>package controllers\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"github.com/jinzhu/gorm\"\n    \"net/http\"\n    \"reflect\"\n)\n\ntype CommonView struct {\n    db        *gorm.DB\n    modelType reflect.Type\n    model     interface{}\n    tableName string\n}\n\nfunc NewCommonView(db *gorm.DB, model interface{}, tableName string) *CommonView {\n    return &amp;CommonView{\n        db:        db,\n        modelType: reflect.TypeOf(model),\n        model:     model,\n        tableName: tableName,\n    }\n}\n\nfunc (cv *CommonView) HandleList(w http.ResponseWriter, r *http.Request) {\n    modelSliceReflect := reflect.SliceOf(cv.modelType)\n    models := reflect.MakeSlice(modelSliceReflect, 0, 10)\n\n    fmt.Println(modelSliceReflect)\n    fmt.Println(models)\n\n    //modelsDirect := reflect.MakeSlice(reflect.TypeOf(cv.model), 0, 0)\n    cv.db.Table(\"users\").Find(&amp;models)\n\n    fmt.Println(\"From db: \")\n    fmt.Println(models)\n\n    modelType := reflect.TypeOf(modelSliceReflect)\n    fmt.Println(\"Type name: \" + modelType.String())\n\n\n    modelsJson, _ := json.Marshal(models)\n\n    fmt.Fprint(w, string(modelsJson))\n}\n</code></pre>\n\n<p>Model:\n    package models</p>\n\n<pre><code>import \"golang.org/x/crypto/bcrypt\"\n\ntype User struct {\n    Id        string `json:\"id\" gorm:\"type:uuid;primary_key;default:uuid_generate_v4()\"`\n    FirstName string `json:\"firstName\"`\n    LastName  string `json:\"lastName\"`\n    Email     string `json:\"email\" gorm:\"unique;not null\"`\n    Password  string `json:\"-\"`\n}\n\nfunc (User) TableName() string {\n    return \"user\"\n}\n</code></pre>\n\n<p>Gorm finding the rows in DB (know that from gorm log). But json don't dump them - guess it's in wrong type and can't handle that. \nAny ideas how do handle this problem?</p>\n\n<p>If you also have any other solutions how to solve problem of CRUD view, I will be also very grateful.</p>\n"}, {"tags": ["string", "parsing", "go", "types"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546866740, "post_id": 54075094, "comment_id": 94982991, "body": "There is no typecasting in Go at all, idiomatic or otherwise. Only type conversion."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1546866873, "post_id": 54075094, "comment_id": 94983066, "body": "Why not just use <code>n, err := fmt.Sscan(&quot;someString&quot;, &amp;variable)</code>? This will handle most types you&#39;ll need. For the rest, you need custom parsing anyway..."}, {"owner": {"reputation": 9, "user_id": 10831757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mRwAyE6ND2c/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYiYX0v0dz020DROXftF8RUEmto2A/mo/photo.jpg?sz=128", "display_name": "ubaxibuna", "link": "https://stackoverflow.com/users/10831757/ubaxibuna"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1546867302, "post_id": 54075094, "comment_id": 94983296, "body": "Hey @icza, could you provide a working example of using the <code>fmt.Sscan</code>? I&#39;m trying but it keeps returning error <code>expected integer</code>."}, {"owner": {"reputation": 9, "user_id": 10831757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mRwAyE6ND2c/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYiYX0v0dz020DROXftF8RUEmto2A/mo/photo.jpg?sz=128", "display_name": "ubaxibuna", "link": "https://stackoverflow.com/users/10831757/ubaxibuna"}, "edited": false, "score": 0, "creation_date": 1546867339, "post_id": 54075094, "comment_id": 94983312, "body": "Why the downvote? The question is valid and provides what I&#39;m trying to accomplish."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1546867424, "post_id": 54075094, "comment_id": 94983357, "body": "@ubaxibuna Using <code>fmt.Sscan()</code>, you have to pass the address of a variable, not a <code>reflect.Kind</code>, e.g. <code>var i int; fmt.Sscan(&quot;12&quot;, &amp;i)</code>"}, {"owner": {"reputation": 9, "user_id": 10831757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mRwAyE6ND2c/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYiYX0v0dz020DROXftF8RUEmto2A/mo/photo.jpg?sz=128", "display_name": "ubaxibuna", "link": "https://stackoverflow.com/users/10831757/ubaxibuna"}, "edited": false, "score": 0, "creation_date": 1546867578, "post_id": 54075094, "comment_id": 94983455, "body": "Oh, this is good!"}, {"owner": {"reputation": 9, "user_id": 10831757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mRwAyE6ND2c/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYiYX0v0dz020DROXftF8RUEmto2A/mo/photo.jpg?sz=128", "display_name": "ubaxibuna", "link": "https://stackoverflow.com/users/10831757/ubaxibuna"}, "edited": false, "score": 0, "creation_date": 1546867615, "post_id": 54075094, "comment_id": 94983475, "body": "Do you mind to properly answer the question, you deserve points for helping me haha"}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 10831757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mRwAyE6ND2c/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYiYX0v0dz020DROXftF8RUEmto2A/mo/photo.jpg?sz=128", "display_name": "ubaxibuna", "link": "https://stackoverflow.com/users/10831757/ubaxibuna"}, "edited": false, "score": 0, "creation_date": 1546873106, "post_id": 54075690, "comment_id": 94986608, "body": "Perfect! Thank you very much icza!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1546869355, "last_edit_date": 1546869355, "creation_date": 1546869042, "answer_id": 54075690, "question_id": 54075094, "link": "https://stackoverflow.com/questions/54075094/idiomatic-way-to-cast-a-string-to-any-other-primitive-type/54075690#54075690", "title": "Idiomatic way to cast a string to any other primitive type", "body": "<p>The \"big switch\" statement you want to avoid, that is already written in the standard library. Use the <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\"><code>fmt</code></a> package to easily parse primitive values from strings, specifically the <a href=\"https://golang.org/pkg/fmt/#Scan\" rel=\"nofollow noreferrer\"><code>fmt.Sscan()</code></a> and <a href=\"https://golang.org/pkg/fmt/#Scanf\" rel=\"nofollow noreferrer\"><code>fmt.Sscanf()</code></a> functions.</p>\n\n<p><code>fmt.Sscan()</code> requires a string value to parse something out from, and the address of a variable to put the parsed value into. The type of the pointed variable also determines what and how to parse out of the string. <code>fmt.Sscan()</code> will return the number of successfully parsed values, and an optional error (if something goes wrong).</p>\n\n<p>A simple example:</p>\n\n<pre><code>var i int\nif _, err := fmt.Sscan(\"12\", &amp;i); err != nil {\n    fmt.Println(\"Error:\", err)\n}\nfmt.Println(i)\n\nvar f float32\nif _, err := fmt.Sscan(\"12.2\", &amp;f); err != nil {\n    fmt.Println(\"Error:\", err)\n}\nfmt.Println(f)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/hQlMhoHI9ZK\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>12\n12.2\n</code></pre>\n\n<p>Also note that you can parse multiple values in one step with <code>fmt.Sscan()</code>, for example:</p>\n\n<pre><code>var i int\nvar f float32\n\nfmt.Println(fmt.Sscan(\"12 12.2\", &amp;i, &amp;f))\nfmt.Println(i, f)\n</code></pre>\n\n<p>This will print (try it on the <a href=\"https://play.golang.org/p/9psywUp_CV7\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>2 &lt;nil&gt;\n12 12.2\n</code></pre>\n\n<p>The first line contains the return values of <code>fmt.Sscan()</code>: tells it parsed 2 values, and returned no error (<code>nil</code> error). The second line contains the parsed values of <code>i</code> and <code>f</code>.</p>\n\n<p>For more options, read: <a href=\"https://stackoverflow.com/questions/4278430/convert-string-to-integer-type-in-go/29841190#29841190\">Convert string to integer type in Go?</a></p>\n"}], "owner": {"reputation": 9, "user_id": 10831757, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mRwAyE6ND2c/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYiYX0v0dz020DROXftF8RUEmto2A/mo/photo.jpg?sz=128", "display_name": "ubaxibuna", "link": "https://stackoverflow.com/users/10831757/ubaxibuna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 54075690, "answer_count": 1, "score": -2, "last_activity_date": 1546871570, "creation_date": 1546866718, "last_edit_date": 1546871570, "question_id": 54075094, "link": "https://stackoverflow.com/questions/54075094/idiomatic-way-to-cast-a-string-to-any-other-primitive-type", "title": "Idiomatic way to cast a string to any other primitive type", "body": "<p>I'm trying to create a function that can cast a given string to the given reflect type.</p>\n\n<p>I'm using the <a href=\"https://github.com/spf13/cast\" rel=\"nofollow noreferrer\">cast</a> package:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"strings\"\n\n    \"github.com/spf13/cast\"\n)\n\ntype functions struct{}\n\nfunc (f functions) Float64(v string) float64 {\n    return cast.ToFloat64(v)\n}\n\nfunc toTarget(v string, target reflect.Kind) interface{} {\n    n := strings.Title(fmt.Sprintf(\"%s\", target))\n    method := reflect.ValueOf(functions{}).MethodByName(n)\n    // Call.\n    return method.Call([]reflect.Value{reflect.ValueOf(v)})[0].Interface()\n}\n\nfunc main() {\n    originalValue := \"10.0\"\n    floatingValue := toTarget(originalValue, reflect.Float64)\n\n    fmt.Println(floatingValue)\n}\n</code></pre>\n\n<p>In the above example I'm keeping simple (it only works for string -> float64 conversion), but on my code, it will work for all the other primitives as well.</p>\n\n<p>I prefer using this solution over a giant and ugly switch statement, but as a new go developer, I'm not sure if there is a better approach.</p>\n\n<p>Thank you for your help.</p>\n"}, {"tags": ["string", "go", "split", "append", "keyword"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1546863555, "post_id": 54074247, "comment_id": 94981345, "body": "You probably want to read this QA <a href=\"https://stackoverflow.com/questions/1760757/how-to-efficiently-concatenate-strings-in-go\" title=\"how to efficiently concatenate strings in go\">stackoverflow.com/questions/1760757/&hellip;</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546869870, "post_id": 54074247, "comment_id": 94984731, "body": "<a href=\"https://tour.golang.org/moretypes/15\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/15</a>"}, {"owner": {"reputation": 27, "user_id": 9319993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c248854f95096dda053a486a50a9718?s=128&d=identicon&r=PG&f=1", "display_name": "BlackMirror", "link": "https://stackoverflow.com/users/9319993/blackmirror"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546926120, "post_id": 54074247, "comment_id": 95004538, "body": "Thanks for the reply@Vorsprung @Adrian I have gone thru the links before asking the question. I was not able to connect the dots. I got it now."}], "answers": [{"comments": [{"owner": {"reputation": 393, "user_id": 2664120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e396f6a7678066cf12a38350f80a3e?s=128&d=identicon&r=PG", "display_name": "Nordiii", "link": "https://stackoverflow.com/users/2664120/nordiii"}, "edited": false, "score": 0, "creation_date": 1546863709, "post_id": 54074334, "comment_id": 94981428, "body": "Additionally the documentation for append: <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\">golang.org/pkg/builtin/#append</a>  EDIT: and a quick guide on variadic functions: <a href=\"https://gobyexample.com/variadic-functions\" rel=\"nofollow noreferrer\">gobyexample.com/variadic-functions</a>"}, {"owner": {"reputation": 27, "user_id": 9319993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c248854f95096dda053a486a50a9718?s=128&d=identicon&r=PG&f=1", "display_name": "BlackMirror", "link": "https://stackoverflow.com/users/9319993/blackmirror"}, "edited": false, "score": 0, "creation_date": 1546925940, "post_id": 54074334, "comment_id": 95004494, "body": "Thanks for helping out @Pizza lord. It worked for me."}], "tags": [], "owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "is_accepted": true, "score": 2, "last_activity_date": 1546863552, "creation_date": 1546863552, "answer_id": 54074334, "question_id": 54074247, "link": "https://stackoverflow.com/questions/54074247/how-to-work-with-the-append-method-in-golang-the-syntax-is-asking-for-interface/54074334#54074334", "title": "How to work with the Append method in Golang. The syntax is asking for interface?", "body": "<p>str is an array of string and not an array of []string so you should use </p>\n\n<pre><code>str   := append(str1 , str2...)\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 9319993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c248854f95096dda053a486a50a9718?s=128&d=identicon&r=PG&f=1", "display_name": "BlackMirror", "link": "https://stackoverflow.com/users/9319993/blackmirror"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 1, "accepted_answer_id": 54074334, "answer_count": 1, "score": -2, "last_activity_date": 1546863552, "creation_date": 1546863232, "question_id": 54074247, "link": "https://stackoverflow.com/questions/54074247/how-to-work-with-the-append-method-in-golang-the-syntax-is-asking-for-interface", "title": "How to work with the Append method in Golang. The syntax is asking for interface?", "body": "<p>I am using the Split method to retrieve the words from two separate strings (str1 , str2) and append all together in another Array (str)</p>\n\n<pre><code>package main\nimport (\n \"fmt\"  \n \"strings\" )\n\nfunc main() {\n\nName := \"Red Blue Green\"\nAddress := \"New York Paris France\"\n\nstr1  := strings.Split(Name, \" \")\nstr2  := strings.Split(Address, \" \")\nstr   := append(str1 , str2)\n\nfmt.Println(str)\n\n}\n</code></pre>\n\n<p>I am getting the error :</p>\n\n<p><strong>cannot use str2 (type []string) as type string in append</strong></p>\n\n<p>Go Playground Link :</p>\n\n<p><a href=\"https://play.golang.org/p/LxO50fzuYnh\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LxO50fzuYnh</a></p>\n\n<p>Can anyone help me with this? I am a beginner at this. </p>\n\n<p>Thank You. </p>\n"}, {"tags": ["tensorflow", "go"], "answers": [{"comments": [{"owner": {"reputation": 790, "user_id": 4287229, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-gsMV6l92NRA/AAAAAAAAAAI/AAAAAAAACA0/lcnFfDu_xtA/photo.jpg?sz=128", "display_name": "Pamungkas Jayuda", "link": "https://stackoverflow.com/users/4287229/pamungkas-jayuda"}, "edited": false, "score": 0, "creation_date": 1546926554, "post_id": 54079616, "comment_id": 95004634, "body": "Thanks alot Mr. @nessuno.  Yo save my life :)"}], "tags": [], "owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "is_accepted": true, "score": 3, "last_activity_date": 1554373270, "last_edit_date": 1554373270, "creation_date": 1546884745, "answer_id": 54079616, "question_id": 54073369, "link": "https://stackoverflow.com/questions/54073369/tensorflow-on-golang-model-sessionn-run-error-nil-operation-if-the-output-was/54079616#54079616", "title": "Tensorflow on Golang Model sessionn run error : nil-Operation. If the Output was created with a Scope object, see Scope.Err() for details", "body": "<p>The error says the <code>Output</code> attribute (of a certain the node) is a nil operation.</p>\n\n<p>Hence <code>graphModel.Operation(\"input\").Operation(0)</code> or <code>graphModel.Operation(\"output\").Output(0)</code> returns <code>nil</code>.</p>\n\n<p>To correct this, you have to refer to an existing node in the graph because there's no a tensor named <code>input</code> or a tensor named <code>output</code> in the graph.</p>\n\n<p>From the python code you used to export the model you can find the complete name of your input and output tensors. Just access the <code>.name</code> attribute of your input placeholder and of your output node, to get the correct name to use in Go.</p>\n\n<p>Also, the Go bindings are complex to use, especially if you want to run some preprocessing operations on the input image. I suggest you use <a href=\"https://github.com/galeone/tfgo\" rel=\"nofollow noreferrer\">galeone/tfgo</a>\ninstead of directly using the bindings (Note that I am the author of this repo).</p>\n"}, {"comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1611806902, "post_id": 56015714, "comment_id": 116570752, "body": "hi, how did you find <code>my_model.inputs</code> was it from python? I tried to use <code>saved_model_pb2.SavedModel()</code> object&#39;s <code>ParseFromString</code> method to read <code>saved_model.pb</code>. I am looking for input label and output label, which will I can use to specify <code>Operation(&quot;label&quot;)</code>. I also have looked into the tensorboard visualisation of the <code>saved_model.pb</code>"}], "tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": false, "score": 1, "last_activity_date": 1557204520, "creation_date": 1557204520, "answer_id": 56015714, "question_id": 54073369, "link": "https://stackoverflow.com/questions/54073369/tensorflow-on-golang-model-sessionn-run-error-nil-operation-if-the-output-was/56015714#56015714", "title": "Tensorflow on Golang Model sessionn run error : nil-Operation. If the Output was created with a Scope object, see Scope.Err() for details", "body": "<p>I would like to add to @nessuno great answer, that I needed to do: <code>my_model.inputs</code> and <code>my_model.outputs</code> to get the proper names. For example:</p>\n\n<pre><code>&gt; my_model.inputs\n[&lt;tf.Tensor 'dense_1_input:0' shape=(?, 7) dtype=float32&gt;\n&gt; my_model.outputs\n[&lt;tf.Tensor 'my_output/BiasAdd:0' shape=(?, 2) dtype=float32&gt;\n</code></pre>\n\n<p>Therefore, my input and output nodes are <code>dense_1_input</code> and <code>my_output/BiasAdd</code> (not <code>my_output</code>!) </p>\n"}], "owner": {"reputation": 790, "user_id": 4287229, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-gsMV6l92NRA/AAAAAAAAAAI/AAAAAAAACA0/lcnFfDu_xtA/photo.jpg?sz=128", "display_name": "Pamungkas Jayuda", "link": "https://stackoverflow.com/users/4287229/pamungkas-jayuda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 640, "favorite_count": 1, "accepted_answer_id": 54079616, "answer_count": 2, "score": 2, "last_activity_date": 1557204520, "creation_date": 1546859954, "question_id": 54073369, "link": "https://stackoverflow.com/questions/54073369/tensorflow-on-golang-model-sessionn-run-error-nil-operation-if-the-output-was", "title": "Tensorflow on Golang Model sessionn run error : nil-Operation. If the Output was created with a Scope object, see Scope.Err() for details", "body": "<p>iam use golang with tensorflow model. With this code : \n```</p>\n\n<pre><code>    output, err := sessionModel.Run(\n    map[tf.Output]*tf.Tensor{\n        graphModel.Operation(\"input\").Output(0): tensor,\n    },\n    []tf.Output{\n        graphModel.Operation(\"output\").Output(0),\n    },\n    nil)\n</code></pre>\n\n<p>```</p>\n\n<p>But show error : \n<code>\n2019/01/07 18:07:48 http: panic serving [::1]:55262: nil-Operation. If the Output was created with a Scope object, see Scope.Err() for details.\n</code></p>\n\n<p>I am already check <code>tensor</code> contain tensor from image file.\nAny recomendation ? Thanks anyway</p>\n"}, {"tags": ["go", "select", "channel", "worker", "cancellation"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1546864744, "last_edit_date": 1546864744, "creation_date": 1546858766, "answer_id": 54073061, "question_id": 54072814, "link": "https://stackoverflow.com/questions/54072814/cancellation-pattern-in-golang/54073061#54073061", "title": "Cancellation pattern in Golang", "body": "<p>Your reasoning is correct, the wording on the site is not completely clear. What this \"construct\" achieves is that the goroutines will not be left hanging forever, but once the searches finish, the goroutines will end properly. Nothing more is happening there.</p>\n\n<p>In general, you can't interrupt any goroutine from the outside, the goroutine itself has to support some kind of termination (e.g. shutdown channel, <code>context.Context</code> etc.). See <a href=\"https://stackoverflow.com/questions/28240133/cancel-a-blocking-operation-in-go/28240299#28240299\">cancel a blocking operation in Go</a>.</p>\n\n<p>So yes, in the example you posted, all searches will be launched, concurrently, result of the fastest one will be returned as it arrives, the rest of the goroutines will continue to run as long as their search is finished.</p>\n\n<p>What happens to the rest? The rest will be discarded (<code>case &lt;- done</code> will be chosen, as an unbuffered channel cannot hold any elements, and there will be no one else receiving more from the channel).</p>\n\n<p>You can verify this in this <a href=\"https://play.golang.org/p/OneR8G3EiRO\" rel=\"nofollow noreferrer\">Go Playground example</a>.</p>\n"}], "owner": {"reputation": 309, "user_id": 8591671, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ae21750ead1b346f8240ee5d5458fd1a?s=128&d=identicon&r=PG&f=1", "display_name": "John Snow", "link": "https://stackoverflow.com/users/8591671/john-snow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1357, "favorite_count": 0, "accepted_answer_id": 54073061, "answer_count": 1, "score": 3, "last_activity_date": 1546864744, "creation_date": 1546857899, "last_edit_date": 1546859233, "question_id": 54072814, "link": "https://stackoverflow.com/questions/54072814/cancellation-pattern-in-golang", "title": "Cancellation pattern in Golang", "body": "<p>Here is a quote from <a href=\"http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/index.html#blocked_goroutines\" rel=\"nofollow noreferrer\">50 Shades Of Go: Traps, Gotchas and Common mistakes</a>:</p>\n\n<blockquote>\n  <p>You can also use a special cancellation channel to interrupt the\n  workers.</p>\n</blockquote>\n\n<pre><code>func First(query string, replicas ...Search) Result {  \n    c := make(chan Result)\n    done := make(chan struct{})\n    defer close(done)\n    searchReplica := func(i int) { \n        select {\n        case c &lt;- replicas[i](query):\n        case &lt;- done:\n        }\n    }\n    for i := range replicas {\n        go searchReplica(i)\n    }\n\n    return &lt;-c\n}\n</code></pre>\n\n<p>As far as understand, it means that we use channel <code>done</code> to interrupt the workers ahead of time without waiting for full execution (in our case execution of <code>replicas[i](query)</code>. Therefore, we can receive a result from the fastest worker (\"First Wins Pattern\") and then cancel the work in all other workers and save the resources.</p>\n\n<p>On the other hand, according to the <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\">specification</a>: </p>\n\n<blockquote>\n  <p>For all the cases in the statement, the channel operands of receive\n  operations and the channel and right-hand-side expressions of send\n  statements are evaluated exactly once, in source order, upon entering\n  the \"select\" statement.</p>\n</blockquote>\n\n<p>As far as I understand, it means we cannot <code>interrupt the workers</code>, as in any case, all workers will evaluate function <code>replicas[i]query</code> and only then select <code>case &lt;- done</code> and finish their execution.</p>\n\n<p>Could you please point out at the mistake in my reasoning?</p>\n"}, {"tags": ["go", "ubuntu-12.04", "snapcraft", "networkmanager"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10878235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db7c73b68d300281315eb92d356fe262?s=128&d=identicon&r=PG&f=1", "display_name": "imnou", "link": "https://stackoverflow.com/users/10878235/imnou"}, "edited": false, "score": 0, "creation_date": 1546865906, "post_id": 54073108, "comment_id": 94982583, "body": "Thank you! it resolves the problem, it seems that snap is installed but doesn&#39;t work!  it shows the following error when using &quot;snap install network-manager&quot; : Error: cannot communicate with server:Post <a href=\"http://localhost/v2/snaps/network-manager:dial\" rel=\"nofollow noreferrer\">localhost/v2/snaps/network-manager:dial</a> unix /run/snapd.socket: connect: no such file or directory. Googling the issue point on the snapd not running, but couldn&#39;t get out from it with precise version.. any clue please!!"}], "tags": [], "owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "is_accepted": false, "score": 1, "last_activity_date": 1546858927, "creation_date": 1546858927, "answer_id": 54073108, "question_id": 54072528, "link": "https://stackoverflow.com/questions/54072528/install-snap-on-ubuntu-precise/54073108#54073108", "title": "Install snap on Ubuntu Precise", "body": "<p><code>sudo</code> is the troublemaker here. When sudoing the <code>$PATH</code> env var is replaced with the <code>secure_path</code> from <code>/etc/sudoers</code> (see <a href=\"https://unix.stackexchange.com/questions/8646/why-are-path-variables-different-when-running-via-sudo-and-su\">this</a> and <a href=\"https://unix.stackexchange.com/questions/245772/why-running-command-as-sudo-returns-command-not-found\">this</a>.)</p>\n\n<p>Either do not run go as sudo, add the go path to the <code>secure_path</code> or include the full path to go in your command (<code>sudo -E /usr/local/bin/go build -o /tmp/snap github.com/snapcore/snapd/cmd/snap</code>)</p>\n"}], "owner": {"reputation": 3, "user_id": 10878235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db7c73b68d300281315eb92d356fe262?s=128&d=identicon&r=PG&f=1", "display_name": "imnou", "link": "https://stackoverflow.com/users/10878235/imnou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 683, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1558903487, "creation_date": 1546856763, "last_edit_date": 1558903487, "question_id": 54072528, "link": "https://stackoverflow.com/questions/54072528/install-snap-on-ubuntu-precise", "title": "Install snap on Ubuntu Precise", "body": "<p>After a purchase of <a href=\"http://advdownload.advantech.com/productfile/PIS/ARK-20/Product%20-%20Datas%20heet/ARK-20_DS(01.11.17)20170112114000.pdf\" rel=\"nofollow noreferrer\">ARK-20-S8A11E</a>, i find out that it only supports ubuntu 12.04 and that network manager uses snap which only availale on ubuntu 14 onward. I need Mobilemanager to collect information of an LTE module integrated in the PC. \nFor that, i tried to install snap from source.\nI needed \"go\", and with apt-get install golang, the last version installed on precise is go1. and snap uses go1.6 onward version.</p>\n\n<p>Therefore, i installed the latest version of go from sources. It is well installed, the output of go --version is : go version go1.11.4 linux/amd, and tested a basid hello.go.\nI followed this link for snap installation: <a href=\"https://github.com/snapcore/snapd/blob/master/HACKING.md\" rel=\"nofollow noreferrer\">https://github.com/snapcore/snapd/blob/master/HACKING.md</a><a href=\"https://github.com/snapcore/snapd/blob/master/HACKING.md\" rel=\"nofollow noreferrer\">snap</a>. </p>\n\n<p>The build command \" sudo -E go build -o /tmp/snap github.com/snapcore/snapd/cmd/snap\" give an output as the \"go command not found\".\nThe GOPATH and PATH are well verified, the go env also. </p>\n\n<p>Could you please help me sort this issue?</p>\n\n<p>Thank you,</p>\n"}, {"tags": ["email", "go", "smtp", "mail-sender"], "comments": [{"owner": {"reputation": 8597, "user_id": 1039481, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/a10ec3de7bec751e1633eba0ef28d4cb?s=128&d=identicon&r=PG", "display_name": "Akhil Thayyil", "link": "https://stackoverflow.com/users/1039481/akhil-thayyil"}, "edited": false, "score": 0, "creation_date": 1546852658, "post_id": 54071379, "comment_id": 94975572, "body": "Did you try making a secure connection ?"}, {"owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "reply_to_user": {"reputation": 8597, "user_id": 1039481, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/a10ec3de7bec751e1633eba0ef28d4cb?s=128&d=identicon&r=PG", "display_name": "Akhil Thayyil", "link": "https://stackoverflow.com/users/1039481/akhil-thayyil"}, "edited": false, "score": 0, "creation_date": 1546852835, "post_id": 54071379, "comment_id": 94975661, "body": "What do yo mean about the secure connection in this?"}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "edited": false, "score": 0, "creation_date": 1546853153, "post_id": 54071579, "comment_id": 94975812, "body": "is this for NoAuth?"}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "reply_to_user": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "edited": false, "score": 0, "creation_date": 1546853244, "post_id": 54071579, "comment_id": 94975858, "body": "no. authentication is still required. you cannot send an email without authentication."}, {"owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "edited": false, "score": 0, "creation_date": 1546853528, "post_id": 54071579, "comment_id": 94976035, "body": "okay I will send the authorization but while I&#39;m changing the email address coming after the auth then it will not show in the email i&#39;m receiving in my Inbox. It show the same email which I use in auth and it also want that I have to change my settings of the gmail and allow the less secure app"}, {"owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "edited": false, "score": 0, "creation_date": 1546854103, "post_id": 54071579, "comment_id": 94976349, "body": "why I have to allow the less secure app because I&#39;m running my code on localhost?"}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "reply_to_user": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "edited": false, "score": 0, "creation_date": 1546909718, "post_id": 54071579, "comment_id": 95001215, "body": "@catter it&#39;s requirements from google. it&#39;s not something we can control."}, {"owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "edited": false, "score": 0, "creation_date": 1546919992, "post_id": 54071579, "comment_id": 95003164, "body": "not for only gmail can we use yahoo port number or hot mail? there is any common port for all the email servers?"}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "reply_to_user": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "edited": false, "score": 0, "creation_date": 1546922456, "post_id": 54071579, "comment_id": 95003686, "body": "yes you can definitely use any other email provider like, hotmail or yahoo. regarding the configuration (smtp host, port, etc), they already have documentation for it."}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": false, "score": 2, "last_activity_date": 1546853486, "last_edit_date": 1546853486, "creation_date": 1546853068, "answer_id": 54071579, "question_id": 54071379, "link": "https://stackoverflow.com/questions/54071379/how-to-send-a-mail-with-using-auth/54071579#54071579", "title": "How to send a mail with using auth?", "body": "<p>Try to use port <code>587</code> on first example. It should be working.</p>\n\n<pre><code>err := smtp.SendMail(\n    \"smtp.gmail.com:587\",\n    auth,\n    \"emailFrom\",\n    []string{EmailToooo},\n    []byte(\"This is the email body.\"),\n)\n</code></pre>\n\n<p>If you use <code>smtp.gmail.com</code> then the correct port is either 587 (TLS) or 465 (SSL), with the <strong>less secure app</strong> must be allowed.</p>\n\n<p>Further information: <a href=\"https://support.google.com/a/answer/176600?hl=en\" rel=\"nofollow noreferrer\">https://support.google.com/a/answer/176600?hl=en</a></p>\n"}], "owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1014, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546854288, "creation_date": 1546852343, "last_edit_date": 1546854288, "question_id": 54071379, "link": "https://stackoverflow.com/questions/54071379/how-to-send-a-mail-with-using-auth", "title": "How to send a mail with using auth?", "body": "<p>I'm using smtp package of golang to send the mail from localhost to the given mail address. But there is a problem I'm providing my email and password for it but it will show me the error of</p>\n\n<pre><code>535 5.7.8 Username and Password not accepted. Learn more at\n5.7.8  https://support.google.com/mail/?p=BadCredentials p24sm107930499pfk.155 - gsmtp\n</code></pre>\n\n<p>they want that I have to allow less secure app to use my account But I don't want to allow that I tried a small piece of code for it.</p>\n\n<p><strong><em>Tried Example1:-</em></strong> </p>\n\n<pre><code>// Set up authentication information.\nauth := smtp.PlainAuth(\n    \"\",\n    \"email\",\n    \"password\",\n    \"smtp.gmail.com\",\n)\n// Connect to the server, authenticate, set the sender and recipient,\n// and send the email all in one step.\nerr := smtp.SendMail(\n    \"smtp.gmail.com:25\",\n    auth,\n    \"emailFrom\",\n    []string{EmailToooo},\n    []byte(\"This is the email body.\"),\n)\nif err != nil {\n    log.Fatal(err)\n} \n</code></pre>\n\n<p><strong>*Tried Example 2:- *</strong></p>\n\n<pre><code>m := gomail.NewMessage()\nm.SetHeader(\"From\", \"SenderEmail@gmail.com\")\nm.SetHeader(\"To\", \"Email_Tooo@gmail.com\")\nm.SetHeader(\"Subject\", \"Hello!\")\nm.SetBody(\"text/html\", \"Hello &lt;b&gt;Bob&lt;/b&gt; and &lt;i&gt;Cora&lt;/i&gt;!\")\n\nd := gomail.NewDialer(\"smtp.gmail.com\", 587, \"email\", \"password\")\n\n// Send the email to Bob, Cora and Dan.\nif err := d.DialAndSend(m); err != nil {\n    fmt.Println(err)\n}    \n</code></pre>\n\n<p>I also tried a <code>gopkg.in/gomail.v2</code>  package for doing NoAuth mail but in this it will give me the error of port connection see in given code:-</p>\n\n<pre><code>m := gomail.NewMessage()\nm.SetHeader(\"From\", \"from@example.com\")\nm.SetHeader(\"To\", \"to@example.com\")\nm.SetHeader(\"Subject\", \"Hello!\")\nm.SetBody(\"text/plain\", \"Hello!\")\n\nd := gomail.Dialer{Host: \"localhost\", Port: 587}\nif err := d.DialAndSend(m); err != nil {\n    panic(err)\n}   \n</code></pre>\n\n<p>I also change the port to 8080 after doing 8080 it will not give any response it was showing only requesting.</p>\n\n<p>Can anyone tell me that how will I send mail from localhost to the given mail address without auth?</p>\n"}, {"tags": ["bash", "go", "buildah"], "comments": [{"owner": {"reputation": 3649, "user_id": 10404329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/489c51b790b37922d4e80d59b9873cec?s=128&d=identicon&r=PG", "display_name": "Corion", "link": "https://stackoverflow.com/users/10404329/corion"}, "edited": false, "score": 0, "creation_date": 1546852841, "post_id": 54071278, "comment_id": 94975663, "body": "The <code>CreatedAt</code> field in <code>buildah</code> is already created as a string within <code>buildah</code> in <a href=\"https://github.com/containers/buildah/blob/master/cmd/buildah/images.go#318\" rel=\"nofollow noreferrer\">cmd/buldah/images.go</a> , so you will have to resort to string-munging for formatting it further. I recommend talking to the project maintainers so they make the value available as a proper datetime object instead of a dumb string."}], "answers": [{"comments": [{"owner": {"reputation": 12557, "user_id": 1270789, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/FXwoB.png?s=128&g=1", "display_name": "Ken Y-N", "link": "https://stackoverflow.com/users/1270789/ken-y-n"}, "edited": false, "score": 0, "creation_date": 1546854022, "post_id": 54071520, "comment_id": 94976297, "body": "I see; that explains why my attempt at <code>{{.CreatedAt.Unix}}</code> wouldn&#39;t work."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1546884629, "last_edit_date": 1546884629, "creation_date": 1546852855, "answer_id": 54071520, "question_id": 54071278, "link": "https://stackoverflow.com/questions/54071278/formatting-a-go-date-in-a-bash-friendly-manner/54071520#54071520", "title": "Formatting a Go date in a bash-friendly manner", "body": "<p>Unfortunately you are out of luck.</p>\n\n<p>The parameter value passed to the template execution is of type <code>imageOutputParams</code>, which is declared in <a href=\"https://github.com/containers/buildah/blob/master/cmd/buildah/images.go\" rel=\"nofollow noreferrer\"><code>images.go</code></a>:</p>\n\n<pre><code>type imageOutputParams struct {\n    Tag       string\n    ID        string\n    Name      string\n    Digest    string\n    CreatedAt string\n    Size      string\n}\n</code></pre>\n\n<p>As you can see, the <code>CreatedAt</code> field is of type <code>string</code>, not a <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\"><code>time.Time</code></a>, so you can't call <code>time.Time</code> methods on it. Neither can you do any useful date/time processing on it without custom registered functions. But since you're just supplying the template text, you can't register custom functions either.</p>\n\n<p>The template you pass is executed in function <code>outputUsingTemplate()</code> like this:</p>\n\n<pre><code>err = tmpl.Execute(os.Stdout, params)\n</code></pre>\n\n<p>Where <code>params</code> is a value of the above mentioned struct.</p>\n\n<p>Recommend the project owners to add a new field holding the <code>CreatedAt</code> timestamp as a <code>time.Time</code> value, so you can get the epoch seconds using <a href=\"https://golang.org/pkg/time/#Time.Unix\" rel=\"nofollow noreferrer\"><code>Time.Unix()</code></a>. The template would look like this then:</p>\n\n<pre><code>{{.CreatedAtTime.Unix}}\n</code></pre>\n"}], "owner": {"reputation": 12557, "user_id": 1270789, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/FXwoB.png?s=128&g=1", "display_name": "Ken Y-N", "link": "https://stackoverflow.com/users/1270789/ken-y-n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 54071520, "answer_count": 1, "score": 1, "last_activity_date": 1546904568, "creation_date": 1546851910, "last_edit_date": 1546904568, "question_id": 54071278, "link": "https://stackoverflow.com/questions/54071278/formatting-a-go-date-in-a-bash-friendly-manner", "title": "Formatting a Go date in a bash-friendly manner", "body": "<p>Using <a href=\"https://buildah.io\" rel=\"nofollow noreferrer\"><code>buildah</code></a>, I can find out the date my image was built at with this call:</p>\n\n<pre><code>buildah images --format '{{.CreatedAt}}' my_image\n</code></pre>\n\n<p>The <code>--format</code> argument is a Go template, as <a href=\"https://github.com/containers/buildah/blob/master/docs/buildah-inspect.md#Options\" rel=\"nofollow noreferrer\">described for a related command</a>.</p>\n\n<p>This returns:</p>\n\n<pre><code>Nov 13, 2018 08:04\n</code></pre>\n\n<p>As far as I can tell that is my current timezone it uses, but it's not localised, and it's missing timezone information. If I feed the output into Linux's <code>date</code> like so:</p>\n\n<pre><code>date -d \"`buildah images --format '{{.CreatedAt}}' my_container`\" +%s\n</code></pre>\n\n<p>This gives me what I want, UNIX epoch seconds:</p>\n\n<pre><code>1542063840\n</code></pre>\n\n<p>However, since my <code>'{{.CreatedAt}}'</code> is a Go template that I should be able to format, how can I directly print out epoch seconds (or <code>RFC-3339</code>, etc) rather than relying on <code>date</code>.</p>\n\n<p><sup>As you can guess, I am an utter Go newbie and the documentation provided nothing I could copy-paste</sup></p>\n\n<hr>\n\n<p><strong>NOTE</strong>: Following the below answer, enhancement request posted to the <a href=\"https://github.com/containers/buildah/issues/1266#issue-396694097\" rel=\"nofollow noreferrer\"><code>buildah</code> issues db</a>.</p>\n"}, {"tags": ["go", "rabbitmq"], "comments": [{"owner": {"reputation": 1548, "user_id": 2841607, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/JjWu8.jpg?s=128&g=1", "display_name": "minitauros", "link": "https://stackoverflow.com/users/2841607/minitauros"}, "edited": false, "score": 1, "creation_date": 1546850256, "post_id": 54070857, "comment_id": 94974486, "body": "You are aware of that your function signature states that it will return <code>(*amqp.Connection, *amqp.Channel, *amqp.Queue)</code>? If you don&#39;t want to return anything, you can issue a <code>return nil, nil, nil</code> (if this is your own function). But probably you want to <code>return conn, ch, q</code>."}], "answers": [{"tags": [], "owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "is_accepted": false, "score": 1, "last_activity_date": 1546850302, "creation_date": 1546850302, "answer_id": 54070942, "question_id": 54070857, "link": "https://stackoverflow.com/questions/54070857/missing-return-at-end-of-function/54070942#54070942", "title": "Missing return at end of function", "body": "<p>the (*amqp.Connection, *amqp.Channel, *amqp.Queue) part of your code says your function returns 3 things, but you don't return anything that is why you get the error. Try adding </p>\n\n<pre><code>return conn, ch, q\n</code></pre>\n\n<p>to your code that should solve the problem</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1546850894, "last_edit_date": 1546850894, "creation_date": 1546850327, "answer_id": 54070945, "question_id": 54070857, "link": "https://stackoverflow.com/questions/54070857/missing-return-at-end-of-function/54070945#54070945", "title": "Missing return at end of function", "body": "<p>Your function declares 3 return types, yet the code you presented has no <a href=\"https://golang.org/ref/spec#Return_statements\" rel=\"nofollow noreferrer\"><code>return</code></a> statements.</p>\n\n<p>You must either use the <code>return</code> statement to specify what values you want to return (on all possible return paths), e.g.:</p>\n\n<pre><code>func getQueue() (*amqp.Connection, *amqp.Channel, *amqp.Queue) {\n    conn, err := amqp.Dial(\"amqp://ayman@localhost:5672\")\n    fallOnError(err, \"Fail to connect\")\n    ch, err := conn.Channel()\n    fallOnError(err, \"Fail to open channel\")\n    q, err := ch.QueueDeclare(\"hello\",\n        false, //durable\n        false, //autoDelete\n        false, //exclusive\n        false, //noWait\n        nil)   //args\n    fallOnError(err, \"Fail to delare a queue\")\n    return conn, ch, q\n}\n</code></pre>\n\n<p>Or you must use named result parameters, and then you can have a \"naked\" <code>return</code> statement (but you still must have a <code>return</code>), e.g.:</p>\n\n<pre><code>func getQueue() (conn *amqp.Connection, ch *amqp.Channel, q *amqp.Queue) {\n    conn, err = amqp.Dial(\"amqp://ayman@localhost:5672\")\n    fallOnError(err, \"Fail to connect\")\n    ch, err = conn.Channel()\n    fallOnError(err, \"Fail to open channel\")\n    q, err = ch.QueueDeclare(\"hello\",\n        false, //durable\n        false, //autoDelete\n        false, //exclusive\n        false, //noWait\n        nil)   //args\n    fallOnError(err, \"Fail to delare a queue\")\n    return\n}\n</code></pre>\n\n<p>If you saw a video with this function declaration and no return statement, that code is also invalid. This does not depend on Go version or OS.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9966151"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 851, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1546873817, "creation_date": 1546849916, "last_edit_date": 1546873817, "question_id": 54070857, "link": "https://stackoverflow.com/questions/54070857/missing-return-at-end-of-function", "title": "Missing return at end of function", "body": "<p>I have a <code>getQueue()</code> function to create a connection and channel for my Go client to a RabbitMQ instance. I have this code for the aforementioned function:</p>\n\n<pre><code>func getQueue() (*amqp.Connection, *amqp.Channel, *amqp.Queue) {\n    conn, err := amqp.Dial(\"amqp://ayman@localhost:5672\")\n    fallOnError(err, \"Fail to connect\")\n    ch, err := conn.Channel()\n    fallOnError(err, \"Fail to open channel\")\n    q, err := ch.QueueDeclare(\"hello\",\n        false, //durable\n        false, //autoDelete\n        false, //exclusive\n        false, //noWait\n        nil)   //args\n    fallOnError(err, \"Fail to delare a queue\")\n\n} \n</code></pre>\n\n<p>I am getting this error <code>Missing return at end of function</code> for the same.\nI tried using return keyboard at the end of the function, but then I get this error:</p>\n\n<pre><code>not enough arguments to return\nhave ()\nwant (*amqp.Connection, *amqp.Channel, *amqp.Queue)\n</code></pre>\n\n<p>The source video I was referring did not have any such issues.\nI am using Ubuntu machine with Go version <code>go1.11.4 linux/amd64</code>. I am using Atom editor with <code>go-lang</code> tools package installed.</p>\n\n<p>EDIT\nThe solution is that I needed 3 parameters to return\n<code>return conn,ch,&amp;q</code> solved my issue.</p>\n"}, {"tags": ["go", "math", "floating-point", "integer", "currency"], "comments": [{"owner": {"reputation": 22814, "user_id": 182660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e48a7020624657e5da6033590030ee?s=128&d=identicon&r=PG", "display_name": "SergGr", "link": "https://stackoverflow.com/users/182660/serggr"}, "edited": false, "score": 0, "creation_date": 1546830007, "post_id": 54067997, "comment_id": 94969158, "body": "Most of the modern languages have something like <code>decimal</code> or <code>money</code> type/class built into the standard library that already does something like this but with a greater precision. What language  do you use? Most probably you are not the first to face this problem in your environment and it is already solved."}, {"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1546832303, "post_id": 54067997, "comment_id": 94969532, "body": "What is your actual problem? You have 6550 cents, you have 55 hundredths of an hour, you can multiply them to get 360250, and you can divide that by 100 to get 3602 with a remainder of 50, and you can use the remainder to decide whether to round up or down. Then you have an answer, 3603, which you can format as \u201c$36.03\u201d for output. So it looks like everything will work, and there is no problem to be solved. What problem do you see?"}, {"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1546832462, "post_id": 54067997, "comment_id": 94969568, "body": "One problem you do not explicitly speak to in the question is that not all whole numbers of minutes are exactly representable in hundredths of an hour. Then you have the same problem as you would if you used floating-point: There are representation errors, and there will be rounding errors in arithmetic. Why not fix that by scaling the times by 60 instead of 100? Instead of using 55 for 55 hundredths of an hour, why not use 33 for 33 sixtieths of an hour (33 minutes)?"}, {"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1546832642, "post_id": 54067997, "comment_id": 94969598, "body": "Then, for 6550 cents/hour times 33 minutes, you would have 216,150 cent-minutes/hour, which is 216,150/60 cents, which is a quotient of 3602 with a remainder of 30, so you round up, and then have 3603 cents to format for output as \u201c$36.03\u201d. If all your money measurements are whole numbers of cents and all your time measurements are whole numbers of minutes, then this scaling has no representation errors and no rounding errors, until the final rounding to cents."}, {"owner": {"reputation": 5044, "user_id": 371273, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e48420f424687108162612d5e5740162?s=128&d=identicon&r=PG", "display_name": "winduptoy", "link": "https://stackoverflow.com/users/371273/winduptoy"}, "reply_to_user": {"reputation": 22814, "user_id": 182660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e48a7020624657e5da6033590030ee?s=128&d=identicon&r=PG", "display_name": "SergGr", "link": "https://stackoverflow.com/users/182660/serggr"}, "edited": false, "score": 0, "creation_date": 1546871475, "post_id": 54067997, "comment_id": 94985668, "body": "@SergGr I&#39;m using Go, but interested in generic solutions."}, {"owner": {"reputation": 5044, "user_id": 371273, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e48420f424687108162612d5e5740162?s=128&d=identicon&r=PG", "display_name": "winduptoy", "link": "https://stackoverflow.com/users/371273/winduptoy"}, "reply_to_user": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1546871489, "post_id": 54067997, "comment_id": 94985687, "body": "@EricPostpischil thanks for the feedback! I&#39;ve updated the answer to clarify my use case."}, {"owner": {"reputation": 22814, "user_id": 182660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e48a7020624657e5da6033590030ee?s=128&d=identicon&r=PG", "display_name": "SergGr", "link": "https://stackoverflow.com/users/182660/serggr"}, "edited": false, "score": 1, "creation_date": 1546873306, "post_id": 54067997, "comment_id": 94986724, "body": "@MattReyer, I believe that for your usage scenarios you want to use Postgres <code>Numeric</code> (something like <code>Numeric(15,3)</code> for example) rather than <code>floatX</code> and using <code>extra_float_digits</code>. Actually this is what the first item in the <a href=\"https://www.postgresql.org/docs/9.0/datatype-numeric.html#DATATYPE-FLOAT\" rel=\"nofollow noreferrer\">doc suggests</a>. The <code>Numeric</code> type is an implementation of <a href=\"https://en.wikipedia.org/wiki/Decimal_floating_point\" rel=\"nofollow noreferrer\">decimal <b><i>floating</i></b> point numbers</a>. What you are suggesting to use is <a href=\"https://en.wikipedia.org/wiki/Fixed-point_arithmetic#Binary_vs._decimal\" rel=\"nofollow noreferrer\">Decimal <b><i>fixed</i></b> point numbers</a>."}, {"owner": {"reputation": 22814, "user_id": 182660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e48a7020624657e5da6033590030ee?s=128&d=identicon&r=PG", "display_name": "SergGr", "link": "https://stackoverflow.com/users/182660/serggr"}, "edited": false, "score": 2, "creation_date": 1546873318, "post_id": 54067997, "comment_id": 94986731, "body": "Frankly I&#39;m not aware of any such standard library in any language. Decimal Floating Point is not much harder to implement (especially if you limit its maximum precision) but is much more flexible than Decimal Fixed Point. As for &quot;<i>Are there potential rounding issues if I were to use integer division?</i>&quot;, yes there are but there inevitably will be some no matter what representation you use. It is impossible to represent all real numbers using any fixed size (i.e. fixed information) data structure. You will lose information anyway and need to decide how to handle it appropriately."}, {"owner": {"reputation": 5044, "user_id": 371273, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e48420f424687108162612d5e5740162?s=128&d=identicon&r=PG", "display_name": "winduptoy", "link": "https://stackoverflow.com/users/371273/winduptoy"}, "reply_to_user": {"reputation": 22814, "user_id": 182660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e48a7020624657e5da6033590030ee?s=128&d=identicon&r=PG", "display_name": "SergGr", "link": "https://stackoverflow.com/users/182660/serggr"}, "edited": false, "score": 0, "creation_date": 1546960412, "post_id": 54067997, "comment_id": 95021539, "body": "@SergGr thank you for all of that info. If you compile everything you said into an answer I&#39;d be happy to mark it as accepted."}, {"owner": {"reputation": 22814, "user_id": 182660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e48a7020624657e5da6033590030ee?s=128&d=identicon&r=PG", "display_name": "SergGr", "link": "https://stackoverflow.com/users/182660/serggr"}, "edited": false, "score": 0, "creation_date": 1547000273, "post_id": 54067997, "comment_id": 95037646, "body": "@MattReyer, I made an attempt. Let me know if you think I should edit my answer with some other details"}], "answers": [{"comments": [{"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1546833284, "post_id": 54068227, "comment_id": 94969697, "body": "Using BCD just gives a method to represent numbers in decimal instead of binary. It does not change the arithmetic. \u201cRemembering\u201d where the decimal point is does change the arithmetic into a decimal-based floating-point arithmetic, but the BCD encoding is irrelevant\u2014one could use binary integers with decimal scaling to get the same result. And implementing BCD in software is costly."}, {"owner": {"reputation": 3898, "user_id": 6221024, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JHtD0ON5o_w/AAAAAAAAAAI/AAAAAAAAABw/1B5Y7p2C-g4/photo.jpg?sz=128", "display_name": "Dillon Davis", "link": "https://stackoverflow.com/users/6221024/dillon-davis"}, "reply_to_user": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1546833799, "post_id": 54068227, "comment_id": 94969795, "body": "For addition and subtraction it doesn&#39;t change the arithmetic, but for multiplication and division it takes extra work to get the correct answer. I do agree that in hindsight, integer scaling would probably be the way to go, but I&#39;ll leave that to you or someone else to write up an answer."}, {"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1546834290, "post_id": 54068227, "comment_id": 94969872, "body": "Sure, you can divide BCD just by shifting, but the cost for a binary integer divide by 10 is generally much less than the cost to implement BCD in software. There is no savings here."}], "tags": [], "owner": {"reputation": 3898, "user_id": 6221024, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JHtD0ON5o_w/AAAAAAAAAAI/AAAAAAAAABw/1B5Y7p2C-g4/photo.jpg?sz=128", "display_name": "Dillon Davis", "link": "https://stackoverflow.com/users/6221024/dillon-davis"}, "is_accepted": false, "score": 1, "last_activity_date": 1546831511, "creation_date": 1546831511, "answer_id": 54068227, "question_id": 54067997, "link": "https://stackoverflow.com/questions/54067997/is-using-integers-as-fractional-coefficients-instead-of-floats-a-good-idea-for-a/54068227#54068227", "title": "Is using integers as fractional coefficients instead of floats a good idea for a monetary application?", "body": "<p>As mentioned in the comments, it would be best to use some builtin Decimal module in your language to handle exact arithmetic. However, since you haven't specified a language, we cannot be certain that your language may even have such a module. If it does not, here is how to go about doing so. </p>\n\n<p>Consider using <a href=\"https://en.wikipedia.org/wiki/Binary-coded_decimal\" rel=\"nofollow noreferrer\">Binary Coded Decimal</a> to store your values. The way it works is by restricting the values that can be stored per byte to 0 through 9 (inclusive), \"wasting\" the rest. You can encode a decimal representation of a number byte by byte that way. For example, 613 would become</p>\n\n<pre><code>6 -&gt; 0000 0110\n1 -&gt; 0000 0001\n3 -&gt; 0000 0011\n\n613 -&gt; 0000 0110 0000 0001 0000 0011\n</code></pre>\n\n<p>Where each grouping of 4 digits above is a \"nibble\" of a byte. In practice, a <em>packed</em> variant is used, where two decimal digits are packed into a byte (one per nibble) to be less \"wasteful\". You can then implement a few methods to do your basic addition, subtract, multiplication, etc. Just iterate over an array of bytes, and perform your classic grade school addition / multiplication algorithms (keep in mind for the packed variant that you may need to pad a zero to get an even number of nibbles). You just need to keep a variable to store where the decimal point is, and remember to carry where necessary to preserve the encoding.</p>\n"}, {"comments": [{"owner": {"reputation": 5044, "user_id": 371273, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e48420f424687108162612d5e5740162?s=128&d=identicon&r=PG", "display_name": "winduptoy", "link": "https://stackoverflow.com/users/371273/winduptoy"}, "edited": false, "score": 0, "creation_date": 1546871575, "post_id": 54068792, "comment_id": 94985729, "body": "Nice. However, I do not know which fraction the user will enter (my use case is generic quantities, not just minutes/hour)."}, {"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 5044, "user_id": 371273, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e48420f424687108162612d5e5740162?s=128&d=identicon&r=PG", "display_name": "winduptoy", "link": "https://stackoverflow.com/users/371273/winduptoy"}, "edited": false, "score": 0, "creation_date": 1546877711, "post_id": 54068792, "comment_id": 94989253, "body": "@MattReyer: Rational arithmetic can be implemented with <code>p</code> and <code>q</code> calculated at run time; you do not need to know which fractions will be entered. However, it will quickly grow out of bounds of typical integer arithmetic unless some constraints are imposed, such as requiring fractions to have some established greatest common divisor."}, {"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 5044, "user_id": 371273, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e48420f424687108162612d5e5740162?s=128&d=identicon&r=PG", "display_name": "winduptoy", "link": "https://stackoverflow.com/users/371273/winduptoy"}, "edited": false, "score": 0, "creation_date": 1546877746, "post_id": 54068792, "comment_id": 94989274, "body": "@MattReyer: Additionally, for what you have described so far, there does not seem to be much need for anything other than some fixed scale (equivalently, divisor) chosen at design time."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1546898546, "post_id": 54068792, "comment_id": 94998424, "body": "Rational numbers (<code>p&#47;q</code>) are a competent way of dealing with everyday non-scientific numbers (not <i>irrational</i> numbers like Pi). There is a <code>big.Rat</code> type in the Go standard API, although it&#39;s a bit tricky to use at first. It has infinite precision, although you always have to handle rounding at some point.  Actually, creating your own finite-precision rational type based on a <code>struct</code> holding two int64 values would be an interesting way to get deeper into what&#39;s involved; maybe worth a go."}], "tags": [], "owner": {"reputation": 15105, "user_id": 3768871, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Wxgi0.jpg?s=128&g=1", "display_name": "OmG", "link": "https://stackoverflow.com/users/3768871/omg"}, "is_accepted": false, "score": 2, "last_activity_date": 1546837486, "creation_date": 1546837486, "answer_id": 54068792, "question_id": 54067997, "link": "https://stackoverflow.com/questions/54067997/is-using-integers-as-fractional-coefficients-instead-of-floats-a-good-idea-for-a/54068792#54068792", "title": "Is using integers as fractional coefficients instead of floats a good idea for a monetary application?", "body": "<p>Another solution to store the result is using the rational form of the value. You can explain the number by two integer value which the number is equal <code>p/q</code>, such that both <code>p</code> and <code>q</code> are integers. Hence, you can have more precision for your numbers and do some math with the rational numbers in the format of two integers. </p>\n"}, {"tags": [], "owner": {"reputation": 22814, "user_id": 182660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e48a7020624657e5da6033590030ee?s=128&d=identicon&r=PG", "display_name": "SergGr", "link": "https://stackoverflow.com/users/182660/serggr"}, "is_accepted": true, "score": 1, "last_activity_date": 1547000580, "last_edit_date": 1547000580, "creation_date": 1547000231, "answer_id": 54102416, "question_id": 54067997, "link": "https://stackoverflow.com/questions/54067997/is-using-integers-as-fractional-coefficients-instead-of-floats-a-good-idea-for-a/54102416#54102416", "title": "Is using integers as fractional coefficients instead of floats a good idea for a monetary application?", "body": "<p><strong><em>Note</em></strong>: This is an attempt to merge different comments into one coherent answer as was requested by Matt.</p>\n\n<h1>TL;DR</h1>\n\n<ol>\n<li>Yes, this approach makes sense but most probably is not the best choice</li>\n<li>Yes, there are rounding issues but there inevitably will be some no matter what representation you use</li>\n<li>What you suggest using is called <a href=\"https://en.wikipedia.org/wiki/Fixed-point_arithmetic#Binary_vs._decimal\" rel=\"nofollow noreferrer\">Decimal <strong><em>fixed</em></strong> point numbers</a></li>\n<li>I'd argue yes, there is a better approach and it is to use some standard or popular <a href=\"https://en.wikipedia.org/wiki/Decimal_floating_point\" rel=\"nofollow noreferrer\">decimal <strong><em>floating</em></strong> point numbers</a> library for your language (Go is not my native language so I can't recommend one)</li>\n</ol>\n\n<p>In PostgreSQL it is better to use <code>Numeric</code> (something like <code>Numeric(15,3)</code> for example) rather than a combination of <code>float4</code>/<code>float8</code> and  <code>extra_float_digits</code>. Actually this is what the first item in the <a href=\"https://www.postgresql.org/docs/9.0/datatype-numeric.html#DATATYPE-FLOAT\" rel=\"nofollow noreferrer\">PostgreSQL doc on Floating-Point Types</a> suggests:</p>\n\n<blockquote>\n  <ul>\n  <li>If you require exact storage and calculations (such as for monetary amounts), use the <code>numeric</code> type instead.</li>\n  </ul>\n</blockquote>\n\n<h1>Some more details on how non-integer numbers can be stored</h1>\n\n<p>First of all there is a fundamental fact that there are infinitely many numbers in the range <code>[0;1]</code> so you obviously can't store every number there in any finite data structure. It means you have to make some compromises: no matter what way you choose, there will be some numbers you can't store exactly so you'll have to round.</p>\n\n<p>Another important point is that people are used to 10-based system and in that system only results of division by numbers in a form of <code>2^a*5^b</code> can be represented using a finite number of digits. For every other rational number even if you somehow store it in the exact form, you will have to do some truncation and rounding at the formatting for human usage stage.</p>\n\n<p>Potentially there are infinitely many ways to store numbers. In practice only a few are widely used:</p>\n\n<ul>\n<li><p><a href=\"https://en.wikipedia.org/wiki/Floating-point_arithmetic\" rel=\"nofollow noreferrer\">floating point numbers</a> with two major branches of binary (this is what most today's hardware natively implements and what is support by most of the languages as <code>float</code> or <code>double</code>) and <a href=\"https://en.wikipedia.org/wiki/Decimal_floating_point\" rel=\"nofollow noreferrer\">decimal</a>. This is the format that store mantissa and exponent (can be negative), so the number is <code>mantissa * base^exponent</code> (I omit sign and just say it is logically a part of the mantissa although in practice it is usually stored separately). Binary vs. decimal is specified by the <code>base</code>. For example <code>0.5</code> will be stored in binary as a pair <code>(1,-1)</code> i.e. <code>1*2^-1</code> and in decimal as a pair <code>(5,-1)</code> i.e. <code>5*10^-1</code>. Theoretically you can use any other base as well but in practice only 2 and 10 make sense as the bases.</p></li>\n<li><p><a href=\"https://en.wikipedia.org/wiki/Fixed-point_arithmetic\" rel=\"nofollow noreferrer\">fixed point numbers</a> with the same division in binary and decimal. The idea is the same as in floating point numbers but some fixed exponent is used for all the numbers. What you suggests is actually a decimal fixed point number with the exponent fixed at <code>-3</code>. I've seen a usage of binary fixed-point numbers on some embedded hardware where there is no built-in support of floating point numbers, because binary fixed-point numbers can be implemented with reasonable efficiency using integer arithmetic. As for decimal fixed-point numbers, in practice they are not much easier to implement that decimal floating-point numbers but provide much less flexibility.</p></li>\n<li><p>rational numbers format i.e. the value is stored as a pair of <code>(p, q)</code> which represents <code>p/q</code> (and usually <code>q&gt;0</code> so sign stored in <code>p</code> and either <code>p=0, q=1</code> for <code>0</code> or <code>gcd(p,q) = 1</code> for every other number). Usually this requires some big integer arithmetic to be useful in the first place (here is a Go example of <a href=\"https://golang.org/pkg/math/big/#Rat\" rel=\"nofollow noreferrer\">math.big.Rat</a>). Actually this might be an useful format for some problems and people often forget about this possibility, probably because it is often not a part of a standard library. Another obvious drawback is that as I said people are not used to think in rational numbers (can you easily compare which is greater <code>123/456</code> or <code>213/789</code>?) so you'll have to convert the final results to some other form. Another drawback is that if you have a long chain of computations, internal numbers (<code>p</code> and <code>q</code>) might easily become very big values so computations will be slow. Still it may be useful to store intermediate results of calculations.</p></li>\n</ul>\n\n<p>In practical terms there is also a division into arbitrary length and fixed length representations. For example: </p>\n\n<ul>\n<li><p>IEEE 754 <a href=\"https://en.wikipedia.org/wiki/Single-precision_floating-point_format\" rel=\"nofollow noreferrer\"><code>float</code></a> or <a href=\"https://en.wikipedia.org/wiki/Double-precision_floating-point_format\" rel=\"nofollow noreferrer\"><code>double</code></a> are fixed length floating-point binary representations, </p></li>\n<li><p><a href=\"https://golang.org/pkg/math/big/#Float\" rel=\"nofollow noreferrer\">Go <code>math.big.Float</code></a> is an arbitrary length floating-point binary representations</p></li>\n<li><p><a href=\"https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/decimal\" rel=\"nofollow noreferrer\">.Net <code>decimal</code></a> is a fixed length floating-point decimal representations</p></li>\n<li><p><a href=\"https://docs.oracle.com/javase/7/docs/api/java/math/BigDecimal.html\" rel=\"nofollow noreferrer\">Java <code>BigDecimal</code></a> is an arbitrary length floating-point decimal representations</p></li>\n</ul>\n\n<p>In practical terms I'd says that the best solution for your problem is some big enough fixed length floating point decimal representations (like .Net <code>decimal</code>). An arbitrary length implementation would also work. If you have to make an implementation from scratch, than your idea of a fixed length fixed point decimal representation might be OK because it is the easiest thing to implement yourself (a bit easier than the previous alternatives) but it may become a burden at some point.</p>\n"}], "owner": {"reputation": 5044, "user_id": 371273, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e48420f424687108162612d5e5740162?s=128&d=identicon&r=PG", "display_name": "winduptoy", "link": "https://stackoverflow.com/users/371273/winduptoy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 54102416, "answer_count": 3, "score": 0, "last_activity_date": 1547000580, "creation_date": 1546829127, "last_edit_date": 1546878198, "question_id": 54067997, "link": "https://stackoverflow.com/questions/54067997/is-using-integers-as-fractional-coefficients-instead-of-floats-a-good-idea-for-a", "title": "Is using integers as fractional coefficients instead of floats a good idea for a monetary application?", "body": "<p>My application requires a fractional quantity multiplied by a monetary value.</p>\n\n<p>For example, <code>$65.50 \u00d7 0.55 hours = $36.025</code> (rounded to <code>$36.03</code>).</p>\n\n<p>I know that <strong>floats should not be used to represent money</strong>, so I'm storing all of my monetary values as cents. <code>$65.50</code> in the above equation is stored as <code>6550</code> (integer).</p>\n\n<p>For the fractional coefficient, my issue is that <code>0.55</code> does not have a 32-bit float representation. In the use case above, <code>0.55 hours == 33 minutes</code>, so <code>0.55</code> is an example of a specific value that my application will need to account for exactly. The floating point representation of <code>0.550000012</code> is insufficient, because the user will not understand where the additional <code>0.000000012</code> came from. I cannot simply call a rounding function on <code>0.550000012</code> because it will round to the whole number.</p>\n\n<h2>Multiplication solution</h2>\n\n<p>To solve this, my first idea was to store all quantities as integers and multiply \u00d7 1000. So <code>0.55</code> entered by the user would become <code>550</code> (integer) when stored. All calculations would happen without floats, and then simply divide by 1000 (integer division, not float) when presenting the result to the user.</p>\n\n<ul>\n<li><p>I realize that this would permanently limit me to 3 decimal places of\nprecision. If I decide that 3 is adequate for the lifetime of my\napplication, does this approach make sense?</p></li>\n<li><p>Are there potential rounding issues if I were to use integer division?</p></li>\n<li><p>Is there a name for this process? <strong>EDIT:</strong> As indicated by @SergGr, this is <strong><a href=\"https://en.wikipedia.org/wiki/Fixed-point_arithmetic\" rel=\"nofollow noreferrer\">fixed-point arithmetic</a>.</strong></p></li>\n<li><p>Is there a better approach?</p></li>\n</ul>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I should have clarified, this is not time-specific. It is for generic quantities like <code>1.256 pounds of flour</code>, <code>1 sofa</code>, or <code>0.25 hours</code> (think invoices).</p>\n\n<p>What I'm trying to replicate here is a more exact version of Postgres's <code>extra_float_digits = 0</code> functionality, where if the user enters <code>0.55</code> (float32), the database stores <code>0.550000012</code> but when queried for the result returns <code>0.55</code> which appears to be exactly what the user typed.</p>\n\n<p>I am willing to limit this application's precision to 3 decimal places (it's business, not scientific), so that's what made me consider the <code>&amp;times; 1000</code> approach.</p>\n\n<p>I'm using the Go programming language, but I'm interested in generic cross-language solutions.</p>\n"}, {"tags": ["go", "iso8583"], "comments": [{"owner": {"reputation": 201, "user_id": 10814080, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IHSUhxzo9Fs/AAAAAAAAAAI/AAAAAAAAAA8/RCIP5dhhB4A/photo.jpg?sz=128", "display_name": "Bob Fred", "link": "https://stackoverflow.com/users/10814080/bob-fred"}, "edited": false, "score": 0, "creation_date": 1546831832, "post_id": 54067962, "comment_id": 94969458, "body": "Can you post the output of client?"}, {"owner": {"reputation": 11, "user_id": 9416421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zdnVq.jpg?s=128&g=1", "display_name": "Ivan Aribanilia", "link": "https://stackoverflow.com/users/9416421/ivan-aribanilia"}, "reply_to_user": {"reputation": 201, "user_id": 10814080, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IHSUhxzo9Fs/AAAAAAAAAAI/AAAAAAAAAA8/RCIP5dhhB4A/photo.jpg?sz=128", "display_name": "Bob Fred", "link": "https://stackoverflow.com/users/10814080/bob-fred"}, "edited": false, "score": 0, "creation_date": 1546836201, "post_id": 54067962, "comment_id": 94970274, "body": "already edit the post with output client"}], "answers": [{"tags": [], "owner": {"reputation": 201, "user_id": 10814080, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IHSUhxzo9Fs/AAAAAAAAAAI/AAAAAAAAAA8/RCIP5dhhB4A/photo.jpg?sz=128", "display_name": "Bob Fred", "link": "https://stackoverflow.com/users/10814080/bob-fred"}, "is_accepted": false, "score": 2, "last_activity_date": 1546840574, "creation_date": 1546840574, "answer_id": 54069170, "question_id": 54067962, "link": "https://stackoverflow.com/questions/54067962/send-iso8583-message-golang/54069170#54069170", "title": "Send ISO8583 Message Golang", "body": "<blockquote>\n  <p>ReadByte reads and returns a single byte. If no byte is available,\n  returns an error.</p>\n</blockquote>\n\n<p>seems that what you read from server is only one byte, which is a white-space char. </p>\n\n<p>The server and client should make a protocol when to close the connection. Thus, if server don't close the conn actively, client should read all bytes from server and close the connection. Like this:</p>\n\n<pre><code>recvBuf := make([]byte, 1024)\nn, err := bufReader.Read(recvBuf)\nfor err == nil {\n    println(\"Recv data from server:\", string(recvBuf[:n]))\n    n, err = bufReader.Read(recvBuf)\n}\nif err != io.EOF {\n    println(\"recv from server failed, err:\", err)\n}\nconn.Close()\n</code></pre>\n\n<p>Or if the protocol defines the client should close the connection when received a certain byte, client can use ReadBytes() and close the connection actively.</p>\n\n<blockquote>\n  <p>func (b *Reader) ReadBytes(delim byte) ([]byte, error)</p>\n  \n  <p>ReadBytes reads until the first occurrence of delim in the input,\n  returning a slice containing the data up to and including the\n  delimiter. If ReadBytes encounters an error before finding a\n  delimiter, it returns the data read before the error and the error\n  itself (often io.EOF). ReadBytes returns err != nil if and only if the\n  returned data does not end in delim.</p>\n</blockquote>\n"}], "owner": {"reputation": 11, "user_id": 9416421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zdnVq.jpg?s=128&g=1", "display_name": "Ivan Aribanilia", "link": "https://stackoverflow.com/users/9416421/ivan-aribanilia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1350, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1546840574, "creation_date": 1546828790, "last_edit_date": 1546836179, "question_id": 54067962, "link": "https://stackoverflow.com/questions/54067962/send-iso8583-message-golang", "title": "Send ISO8583 Message Golang", "body": "<p>I'm trying to build a ISO8583 Client using a Golang, \nwhen using java, i don't have any problem when creating client.\nBut when trying creating a client using golang (i'm just starting learning golang btw), i can't send a message to the server. Can someone help me, why i can't send a message? </p>\n\n<p>I've tried to send a SIGN IN Message, The client and server already connected, but the message i send not readable by the server.</p>\n\n<p>This My Code</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"time\"\n    \"github.com/ideazxy/iso8583\"\n)\n\ntype ISOSignIn struct {\n    Bit3 *iso8583.Numeric `field:\"3\" length:\"6\" encode:\"bcd\"`\n    Bit7 *iso8583.Numeric `field:\"7\" length:\"10\" encode:\"ascii`\n    Bit11 *iso8583.Numeric `field:\"11\" length:\"6\" encode:\"rbcd`\n    Bit32 *iso8583.Llnumeric `field:\"32\" length:\"11\" encode:\"ascii`\n    Bit70 *iso8583.Numeric `field:\"70\" length:\"3\" encode:\"ascii`\n}\n\nfunc main() {\n    testIso()\n}\n\nfunc testIso() {\n    data := ISOSignIn{\n            Bit3: iso8583.NewNumeric(\"001111\"),\n            Bit7: iso8583.NewNumeric(\"0913110004\"),\n            Bit11: iso8583.NewNumeric(\"000001\"),\n            Bit32: iso8583.NewLlnumeric(\"9999\"), // Client ID\n            Bit70: iso8583.NewNumeric(\"301\"), // Login Code\n    }\n    msg := iso8583.NewMessage(\"0800\", data)\n    msg.MtiEncode = iso8583.BCD\n    b, err := msg.Bytes()\n    if err != nil {\n            fmt.Println(err.Error())\n    }\n    fmt.Printf(\"% x\\n\", b)\n    tcpClientNew(b)\n}\n\nfunc tcpClientNew(b []byte) {\n    tcpAddr, err := net.ResolveTCPAddr(\"tcp\", \"192.168.100.5:12346\")\n    if err != nil {\n            println(\"ResolveTCPAddr failed:\", err.Error())\n            os.Exit(1)\n    }\n    conn, err := net.DialTCP(\"tcp\", nil, tcpAddr)\n    if err != nil {\n            println(\"Dial failed:\", err.Error())\n            os.Exit(1)\n    }\n    timeoutDuration := 30 * time.Second\n    _, err = conn.Write(b)\n    if err != nil {\n            println(\"Write to server failed:\", err.Error())\n            os.Exit(1)\n    }\n    conn.SetReadDeadline(time.Now().Add(timeoutDuration))\n    bufReader := bufio.NewReader(conn)\n    resp, _ := bufReader.ReadByte()\n    fmt.Print(\"Message from server: \" + string(resp))\n    conn.Close()\n}\n</code></pre>\n\n<p>Server Already Connected</p>\n\n<pre><code>&lt;log realm=\"Server-A.server.session/192.168.100.1:32218\" at=\"Mon Jan 07 09:37:15.747 WIB 2019\"&gt;\n  &lt;session-start/&gt;\n&lt;/log&gt;\n&lt;log realm=\"channel/192.168.100.1:32218\" at=\"Mon Jan 07 09:37:19.034 WIB 2019\" lifespan=\"3287ms\"&gt;\n  &lt;receive&gt;\n    &lt;peer-disconnect/&gt;\n  &lt;/receive&gt;\n&lt;/log&gt;\n&lt;log realm=\"Server-A.server.session/192.168.100.1:32218\" at=\"Mon Jan 07 09:37:19.035 WIB 2019\"&gt;\n  &lt;session-end/&gt;\n&lt;/log&gt;\n</code></pre>\n\n<p>Output from Client Terminal :</p>\n\n<pre><code>GOROOT=/Users/ivanaribanilia/Applications/go\nGOPATH=/Users/ivanaribanilia/Project/Workspace-Github/Project-Go/pclient\n/Users/ivanaribanilia/Applications/go/bin/go build -i -o /Users/ivanaribanilia/Project/Workspace-Github/Project-Go/pclient/build/pclient /Users/ivanaribanilia/Project/Workspace-Github/Project-Go/pclient/src/github.com/ivanj4u/pclient/main.go\n/Users/ivanaribanilia/Project/Workspace-Github/Project-Go/pclient/build/pclient\n08 00 22 20 00 01 00 00 00 00 00 11 11 30 39 31 33 31 31 30 30 30 34 30 30 30 30 30 31 30 34 31 31 31 34\nMessage from server: \nProcess finished with exit code 0\n</code></pre>\n\n<p>I expect a response from the server, so i can develop other message like INQUIRY or PAYMENT.\nThank you</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1546848905, "post_id": 54066464, "comment_id": 94973992, "body": "Try to move <code>go d.dispatch()</code> to be the first line in the function. Start small and add channel one by one until you stuck. The code smell messy. I didn&#39;t read it all, I just looked for a common code mistakes in channel."}], "owner": {"reputation": 1091, "user_id": 4474629, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/e3d1d6e41980939611b75370816b8843?s=128&d=identicon&r=PG&f=1", "display_name": "Little Code", "link": "https://stackoverflow.com/users/4474629/little-code"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1546813129, "creation_date": 1546813129, "question_id": 54066464, "link": "https://stackoverflow.com/questions/54066464/dispatcher-worker-not-firing", "title": "Dispatcher worker not firing", "body": "<p>I am trying to implement a dispatcher/worker method based on <a href=\"http://marcio.io/2015/07/handling-1-million-requests-per-minute-with-golang/\" rel=\"nofollow noreferrer\">http://marcio.io/2015/07/handling-1-million-requests-per-minute-with-golang/</a></p>\n\n<p>The concept I am trying to build is that I retrieve a message from a queue (AWS SQS) and then download a file (AWS S3) and perform processing on it.</p>\n\n<p>However the dispatcher/worker is never triggered, as you can see from the console log, \"submitted\" is the last message posted:</p>\n\n<pre><code>2019/01/06 22:16:35 main start\n2019/01/06 22:16:35 Worker queue dispatcher started...\n2019/01/06 22:16:36 SQS\n2019/01/06 22:16:36 {\n  Messages: [{\n&lt;REDACTED&gt;\n    }]\n}\n2019/01/06 22:16:36 submitting\n2019/01/06 22:16:36 {&lt;REDACTED&gt;}\n2019/01/06 22:16:36 submitted\n</code></pre>\n\n<p>My <code>main()</code> looks like this:</p>\n\n<pre><code>package main\nimport \"flag\"\nimport \"log\"\nimport \"foobar/lib\"\nfunc main() {\n    var config = flag.String(\"config\", \"/etc/foo/foobar/gsg.conf\", \"Config file location\")\n    flag.Parse()\n    var conf,err = foobar.LoadConfiguration(*config)\n    if err != nil {\n        log.Fatal(err)\n    }\n    foobar.NewHandler(conf)\n    var sts,stsErr = foobar.GetSQSMessage(conf)\n    if stsErr != nil {\n        log.Fatal(stsErr)\n    }\n    log.Print(\"SQS\")\n    log.Print(sts)\n    foobar.SubmitPayload(sts)\n}\n</code></pre>\n\n<p>I have a <code>handler.go</code> as follows:</p>\n\n<pre><code>package foobar\nimport (\n    \"log\"\n)\nimport \"github.com/aws/aws-sdk-go/service/sqs\"\nfunc NewHandler(appConfig *FoobarConfigStruct) error {\n    JobQueue = make(chan Job, appConfig.MaxQueues)\n    log.Println(\"main start\")\n    var dispatcher = NewDispatcher(appConfig.MaxWorkers)\n    dispatcher.Run()\n    return nil\n}\n\nfunc SubmitPayload(sqsOutput *sqs.ReceiveMessageOutput) error {\n    var x = &amp;sqs.Message{}\n    var y = Payload{*x}\n    var work = Job{Payload: y}\n    JobQueue &lt;- work\n    for _,payload := range sqsOutput.Messages {\n        log.Println(\"submitting\")\n        log.Println(*payload.Body)\n        var item = Payload{*payload}\n        var work = Job{Payload:item}\n        JobQueue &lt;- work\n        log.Println(\"submitted\")\n    }\n    return nil\n}\n</code></pre>\n\n<p>A <code>dispatcher.go</code> as follows:</p>\n\n<pre><code>package foobar\nimport (\n        \"log\"\n)\n\ntype Dispatcher struct {\n        maxWorkers int\n        WorkerPool chan chan Job\n}\n\nfunc NewDispatcher(maxWorkers int) *Dispatcher {\n        pool := make(chan chan Job, maxWorkers)\n        return &amp;Dispatcher{WorkerPool: pool, maxWorkers: maxWorkers}\n}\n\nfunc (d *Dispatcher) Run() {\n        for i := 0; i &lt; d.maxWorkers; i++ {\n                worker := NewWorker(d.WorkerPool)\n                worker.Start()\n        }\n\n        go d.dispatch()\n}\n\nfunc (d *Dispatcher) dispatch() {\n        log.Printf(\"Worker queue dispatcher started...\")\n        for {\n\n                select {\n                case job := &lt;-JobQueue:\n                        log.Printf(\"Dispatcher request received\")\n                        go func(job Job) {\n                                jobChannel := &lt;-d.WorkerPool\n                                jobChannel &lt;- job\n                        }(job)\n                }\n        }\n}\n</code></pre>\n\n<p>And a <code>worker.go</code> as follows :</p>\n\n<pre><code>package foobar                                                                                                                    \n\nimport (                                                                                                                           \n    \"log\"                                                                                                                          \n)                                                                                                                                  \n\nimport \"github.com/aws/aws-sdk-go/service/sqs\"                                                                                     \n\ntype Payload struct {                                                                                                              \n    sqs sqs.Message                                                                                                                \n}                                                                                                                                  \n\ntype Job struct {                                                                                                                  \n    Payload Payload                                                                                                                \n}                                                                                                                                  \n\nvar JobQueue chan Job                                                                                                              \n\ntype Worker struct {                                                                                                               \n    WorkerPool chan chan Job                                                                                                       \n    JobChannel chan Job                                                                                                            \n    quit       chan bool                                                                                                           \n}                                                                                                                                  \n\nfunc NewWorker(workerPool chan chan Job) Worker {\n    return Worker{\n        WorkerPool: workerPool,\n        JobChannel: make(chan Job),\n        quit:       make(chan bool)}\n}\nfunc (w Worker) Start() {\n    go func() {\n        for {\n            w.WorkerPool &lt;- w.JobChannel\n\n            select {\n            case job := &lt;-w.JobChannel:\n                log.Printf(\"starting worker...\");\n                if err := job.Payload.ProcessPayload(); err != nil {\n                    log.Printf(\"Error processing: %s\", err.Error())\n                }\n\n            case &lt;-w.quit:\n                return\n            }\n        }\n    }()\n}\n\nfunc (w Worker) Stop() {\n    go func() {\n        w.quit &lt;- true\n    }()\n}\n\nfunc (p *Payload) ProcessPayload() error {\n    log.Printf(\"Processing payload\")\n    log.Printf(*p.sqs.Body)\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go", "nginx"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546808214, "post_id": 54065606, "comment_id": 94964900, "body": "Have you tried without timeout? Like maybe using the <a href=\"https://golang.org/pkg/net/http/#DefaultClient\" rel=\"nofollow noreferrer\">default client</a>?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1546808430, "post_id": 54065606, "comment_id": 94964969, "body": "You are not exiting the request handler when an error occurs, leading to multiple WriteHeader calls and possibly even nil-pointer dereferences (panics), which would explain the behavior you describe. That should be visible in the logs. Move the deferred <code>resp.Body.Close</code> call up before inserting return calls, so it always executes if there is a response."}, {"owner": {"reputation": 504, "user_id": 5555167, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/ftb6R.png?s=128&g=1", "display_name": "Bob", "link": "https://stackoverflow.com/users/5555167/bob"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1546809145, "post_id": 54065606, "comment_id": 94965161, "body": "@Peter that makes sense, unfortunately after making those changes the NGINX error remains, and the other logs remain empty..."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1546809648, "post_id": 54065606, "comment_id": 94965304, "body": "How are you checking the logs. You&#39;re aware that you redirect them to a file within the container? Do you not even see the &quot;Starting server&quot; and &quot;IP ...&quot; lines?"}, {"owner": {"reputation": 504, "user_id": 5555167, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/ftb6R.png?s=128&g=1", "display_name": "Bob", "link": "https://stackoverflow.com/users/5555167/bob"}, "edited": false, "score": 0, "creation_date": 1546809798, "post_id": 54065606, "comment_id": 94965341, "body": "Yes, I am looking at the file inside of the container which apparently is succesfully created by the application, but indeed, even those lines do not show up. Even though they do show up locally."}], "answers": [{"comments": [{"owner": {"reputation": 504, "user_id": 5555167, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/ftb6R.png?s=128&g=1", "display_name": "Bob", "link": "https://stackoverflow.com/users/5555167/bob"}, "edited": false, "score": 0, "creation_date": 1546807609, "post_id": 54065645, "comment_id": 94964737, "body": "The Docker log is empty. I have added lines to always write a response (see the update of my post), thanks that is at least one thing I missed :-) Unfortunately the error is still occurring. I did expect that because the error also occurs when I send invalid JSON and then the gitlabHandler should return before reaching that last bit."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1546808944, "post_id": 54065645, "comment_id": 94965109, "body": "If WriteHeader is not called by the handler, the http package calls <code>WriteHeader(200)</code> automatically."}], "tags": [], "owner": {"reputation": 29, "user_id": 10876194, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-AgOtg8re0mM/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcY-eAYOk2LvPC9k6_x_Mgntz5midQ/mo/photo.jpg?sz=128", "display_name": "Aaron", "link": "https://stackoverflow.com/users/10876194/aaron"}, "is_accepted": false, "score": 0, "last_activity_date": 1546806547, "creation_date": 1546806547, "answer_id": 54065645, "question_id": 54065606, "link": "https://stackoverflow.com/questions/54065606/go-application-does-not-work-behind-nginx-proxy-http-502/54065645#54065645", "title": "Go application does not work behind NGINX proxy: HTTP 502", "body": "<p>Have you tried looking at the Docker logs instead of the log file that isn't working? First get the container ID:</p>\n\n<pre><code>docker container ls\n</code></pre>\n\n<p>Then get the log:</p>\n\n<pre><code>docker logs 14eb7d0a2332\n</code></pre>\n\n<p>The nginx error means that your Golang application accepted the connection, but closed the connection without returning a response. This indicates that your webhook is returning without writing a response.</p>\n\n<p>It looks like your gitlabHandler does not return a response when the request succeeds, the last thing that you do is read the upstream response:</p>\n\n<pre><code>    bod, err := ioutil.ReadAll(resp.Body)\n    if strings.Contains(string(bod), \"Success\") {\n        log.Println(\"Received and succesfully processed request\")\n    } else {\n        log.Println(string(bod))\n    }\n    defer resp.Body.Close()\n</code></pre>\n\n<p>You need to write to the ResponseWriter here.</p>\n"}], "owner": {"reputation": 504, "user_id": 5555167, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/ftb6R.png?s=128&g=1", "display_name": "Bob", "link": "https://stackoverflow.com/users/5555167/bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1113, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1546809011, "creation_date": 1546806255, "last_edit_date": 1546809011, "question_id": 54065606, "link": "https://stackoverflow.com/questions/54065606/go-application-does-not-work-behind-nginx-proxy-http-502", "title": "Go application does not work behind NGINX proxy: HTTP 502", "body": "<p>I am creating a receiver for webhooks in Go, this is my first application in Go.</p>\n\n<p>I have tested the application locally and it works over there. But now I have deployed it on my Ubuntu server in a Docker container behind an NGINX proxy (the proxy is outside of Docker). The <code>pingHandler</code> works, and the <code>gitlabHandler</code> can send the 403 message. But if the token is valid I will always see a 502 message and the NGINX log tells me:</p>\n\n<pre><code>*1115 upstream prematurely closed connection while reading response header from upstream, client: X.X.X.X, server: myserver.home.example, request: \"POST /webhookreceiver/gitlab HTTP/1.1\", upstream: \"http://127.0.0.1:7080/gitlab\", host: \"myserver.home.example\"\n</code></pre>\n\n<p>Also when I send an invalid JSON payload it will still give the same error message, so if I understand the error correctly my Go application closes the connection somewhere before line 72-76. I am guessing something is wrong with line 65?</p>\n\n<p>For most other people having this issue it can be solved by increasing the timeout because their requests are too large, but in my case I am testing with a JSON message of only a few bytes.</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"strings\"\n    \"time\"\n)\n\ntype ServerConfig struct {\n    Https       bool   `json:\"https\"`\n    Cert        string `json:\"cert\"`\n    Key         string `json:\"key\"`\n    Gitlabtoken string `json:\"gitlab_token\"`\n}\n\ntype SplunkConfig struct {\n    Token    string\n    Url      string\n    Metadata map[string]string\n}\n\ntype SplunkEvent struct {\n    Host       string                 `json:\"host\"`\n    Sourcetype string                 `json:\"sourcetype\"`\n    Index      string                 `json:\"index\"`\n    Source     string                 `json:\"source\"`\n    Event      map[string]interface{} `json:\"event\"`\n}\n\nvar splunk_config SplunkConfig\nvar server_config ServerConfig\n\ntype middleware func(next http.HandlerFunc) http.HandlerFunc\n\nfunc withLogging(next http.HandlerFunc) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        log.Printf(\"IP %s\", r.RemoteAddr)\n        next.ServeHTTP(w, r)\n    }\n}\n\nfunc chainMiddleware(mw ...middleware) middleware {\n    return func(final http.HandlerFunc) http.HandlerFunc {\n        return func(w http.ResponseWriter, r *http.Request) {\n            last := final\n            for i := len(mw) - 1; i &gt;= 0; i-- {\n                last = mw[i](last)\n            }\n            last(w, r)\n        }\n    }\n}\n\nfunc gitlabHandler(w http.ResponseWriter, req *http.Request) {\n    // Check if GitLab token is present and correct\n    gitlab_header := req.Header.Get(\"X-Gitlab-Token\")\n    if gitlab_header == server_config.Gitlabtoken {\n        // Create SplunkEvent to send to Splunk\n        body, err := ioutil.ReadAll(req.Body)\n        if err != nil {\n            log.Println(err)\n            w.WriteHeader(http.StatusInternalServerError)\n            w.Write([]byte(\"500 - Error reading body\"))\n            return\n        }\n        var event map[string]interface{}\n        err = json.Unmarshal(body, &amp;event)\n        if err != nil {\n            log.Println(err)\n            w.WriteHeader(http.StatusBadRequest)\n            w.Write([]byte(\"400 - Request cannot be parsed\"))\n            return\n        }\n        se := SplunkEvent{\n            Host:       splunk_config.Metadata[\"host\"],\n            Sourcetype: splunk_config.Metadata[\"sourcetype\"],\n            Index:      splunk_config.Metadata[\"index\"],\n            Source:     \"gitlab\",\n            Event:      event}\n        j, err := json.Marshal(se)\n        if err != nil {\n            log.Println(err)\n            w.WriteHeader(http.StatusInternalServerError)\n            w.Write([]byte(\"500 - Error creating forwarding call\"))\n            return\n        }\n        // Send SplunkEvent to Splunk\n        b := bytes.NewBuffer(j)\n        client := &amp;http.Client{\n            Timeout: time.Second * 30,\n        }\n        req, err := http.NewRequest(\"POST\", splunk_config.Url, b)\n        if err != nil {\n            log.Println(err)\n            w.WriteHeader(http.StatusInternalServerError)\n            w.Write([]byte(\"500 - Error creating request\"))\n            return\n        }\n        req.Header.Add(\"Authorization\", \"Splunk \"+splunk_config.Token)\n        resp, err := client.Do(req)\n        if err != nil {\n            log.Println(err)\n            w.WriteHeader(http.StatusInternalServerError)\n            w.Write([]byte(\"500 - Error sending request\"))\n            return\n        }\n        // Check response\n        bod, err := ioutil.ReadAll(resp.Body)\n        if strings.Contains(string(bod), \"Success\") {\n            log.Println(\"Received and succesfully processed request\")\n            w.WriteHeader(http.StatusOK)\n            w.Write([]byte(\"200 - OK\"))\n            return\n        } else {\n            log.Println(string(bod))\n            w.WriteHeader(http.StatusInternalServerError)\n            w.Write([]byte(\"500 - Error sending to Splunk\"))\n            return\n        }\n        defer resp.Body.Close()\n    } else {\n        log.Println(\"Incorrect Gitlab token\")\n        w.WriteHeader(http.StatusForbidden)\n        w.Write([]byte(\"403 - Forbidden\"))\n        return\n    }\n}\n\nfunc pingHandler(w http.ResponseWriter, r *http.Request) {\n    log.Println(\"Received ping call\")\n    fmt.Fprint(w, \"{\\\"check\\\": \\\"online\\\"}\")\n}\n\nfunc main() {\n    // Setup logging\n    file, err := os.OpenFile(\"webhookreceiver.log\", os.O_CREATE|os.O_APPEND, 0644)\n    if err != nil {\n        log.Fatal(\"Error opening log file: \" + err.Error())\n    }\n    defer file.Close()\n    log.SetOutput(file)\n    // Load Splunk config\n    data, err := ioutil.ReadFile(\"configs/splunk.json\")\n    if err != nil {\n        log.Fatal(\"Error reading splunk_config.json: \" + err.Error())\n    }\n    err = json.Unmarshal(data, &amp;splunk_config)\n    if err != nil {\n        log.Fatal(\"Error on unmarshal of Splunk config: \" + err.Error())\n    }\n    // Load server config\n    data, err = ioutil.ReadFile(\"configs/server.json\")\n    if err != nil {\n        log.Fatal(\"Error reading server_config.json: \" + err.Error())\n    }\n    err = json.Unmarshal(data, &amp;server_config)\n    if err != nil {\n        log.Fatal(\"Error on unmarshal of Server config: \" + err.Error())\n    }\n    // Start server\n    log.Println(\"Starting server\")\n    mw := chainMiddleware(withLogging)\n    http.Handle(\"/gitlab\", mw(gitlabHandler))\n    http.HandleFunc(\"/ping\", mw(pingHandler))\n    if server_config.Https {\n        log.Fatal(http.ListenAndServeTLS(\":7443\", server_config.Cert, server_config.Key, nil))\n    } else {\n        log.Fatal(http.ListenAndServe(\":7080\", nil))\n    }\n}\n</code></pre>\n\n<p><strong>Relevant bit of NGINX config</strong></p>\n\n<pre><code>server {\n  listen 443 ssl;\n  listen [::]:443 ssl;\n  ssl_certificate /blabla/fullchain.pem;\n  ssl_certificate_key /blabla/privkey.pem;\n  client_max_body_size 3M;\n  add_header Strict-Transport-Security \"max-age=31536000\" always;\n  location /webhookreceiver/ {\n    proxy_pass http://127.0.0.1:7080/;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n}\n</code></pre>\n\n<p>Also the logging of my Go application is working locally but not inside of my Docker container, the log file is being created but it stays empty. So at this point I don't have any messages from there, unless someone knows why that is ;-)</p>\n"}, {"tags": ["go", "makefile", "build", "compilation", "gnu-make"], "answers": [{"comments": [{"owner": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "edited": false, "score": 0, "creation_date": 1546806965, "post_id": 54065534, "comment_id": 94964542, "body": "It looks like that should work, when I run it though I get <code>make: Nothing to be done for &#39;all&#39;.</code>, not really sure why?"}, {"owner": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "edited": false, "score": 0, "creation_date": 1546824495, "post_id": 54065534, "comment_id": 94968232, "body": "After banging my head against the wall I discovered my variable was wrong.   <code>ALL_ARCHES</code> should be <code>amd64 arm arm64</code> instead of <code>$(amd64 arm arm64)</code>"}, {"owner": {"reputation": 13458, "user_id": 1773798, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4Ljqn.png?s=128&g=1", "display_name": "Renaud Pacalet", "link": "https://stackoverflow.com/users/1773798/renaud-pacalet"}, "reply_to_user": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "edited": false, "score": 1, "creation_date": 1546853479, "post_id": 54065534, "comment_id": 94976004, "body": "Right. I should have noticed this instead of blindly copy-pasting. Fixed in my answer. By the way, I also changed the recursively expanded variables to simply expanded variables. In your case it is probably preferable (at least for <code>ALL_ARCHES</code>). And I used the <code>$^</code> automatic variable instead of repeating <code>cmd&#47;mything&#47;*.go</code> in the recipe."}, {"owner": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "edited": false, "score": 0, "creation_date": 1546886037, "post_id": 54065534, "comment_id": 94993198, "body": "Thanks!  What is the difference between recursive expansion and simple expansion?"}, {"owner": {"reputation": 13458, "user_id": 1773798, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4Ljqn.png?s=128&g=1", "display_name": "Renaud Pacalet", "link": "https://stackoverflow.com/users/1773798/renaud-pacalet"}, "reply_to_user": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "edited": false, "score": 0, "creation_date": 1546886736, "post_id": 54065534, "comment_id": 94993494, "body": "There is no better explanation about the two flavours of variables than the <a href=\"https://www.gnu.org/software/make/manual/make.html#Flavors\" rel=\"nofollow noreferrer\">GNU make manual</a>."}], "tags": [], "owner": {"reputation": 13458, "user_id": 1773798, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4Ljqn.png?s=128&g=1", "display_name": "Renaud Pacalet", "link": "https://stackoverflow.com/users/1773798/renaud-pacalet"}, "is_accepted": true, "score": 1, "last_activity_date": 1546853355, "last_edit_date": 1546853355, "creation_date": 1546805697, "answer_id": 54065534, "question_id": 54065424, "link": "https://stackoverflow.com/questions/54065424/build-dynamic-targets-for-different-architectures-using-make/54065534#54065534", "title": "Build dynamic targets for different architectures using make?", "body": "<p>Assuming you accept to name your binaries <code>cmd/mything/mything-ARCH</code>, where <code>ARCH</code> is the target architecture, you could try:</p>\n\n<pre><code>ALL_ARCHES := amd64 arm arm64   \nVERSION    := $(shell git symbolic-ref --short HEAD)-$(shell git rev-parse --short HEAD)\n\n.PHONY: all\n\nall: $(addprefix cmd/mything/mything-,$(ALL_ARCHES))\n\ncmd/mything/mything-%: cmd/mything/*.go\n    CGO_ENABLED=0 GOOS=linux GOARCH=$* go build -ldflags \"-X main.version=$(VERSION)\" -o $@ $^\n</code></pre>\n\n<p><code>$*</code> is the automatic variable that expands as the stem of the target name in a pattern rule.</p>\n"}], "owner": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 54065534, "answer_count": 1, "score": 0, "last_activity_date": 1546886069, "creation_date": 1546805053, "last_edit_date": 1546886069, "question_id": 54065424, "link": "https://stackoverflow.com/questions/54065424/build-dynamic-targets-for-different-architectures-using-make", "title": "Build dynamic targets for different architectures using make?", "body": "<p>I'm looking for a way to basically iterate over a list of architectures and build unique ones using make.  For example, I have a variable containing all the architectures, and a static target currently.</p>\n\n<p>Below is the (simplified) logic I have.</p>\n\n<pre><code>ALL_ARCHES=amd64 arm arm64  \nVERSION=$(shell git symbolic-ref --short HEAD)-$(shell git rev-parse --short HEAD)\n\ncmd/mything/mything: cmd/mything/*.go\n            CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags \"-X main.version=$(VERSION)\" -o $@ cmd/mything/*.go\n...\n</code></pre>\n\n<p>I basically want to replace <code>GOARCH=amd64</code> by iterating over the <code>ALL_ARCHES</code> variable, creating a unique binary that represents the given architecture.</p>\n"}, {"tags": ["go", "plugins", "compilation"], "answers": [{"comments": [{"owner": {"reputation": 448, "user_id": 2792899, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kKn1r.png?s=128&g=1", "display_name": "Jonas Franz", "link": "https://stackoverflow.com/users/2792899/jonas-franz"}, "edited": false, "score": 0, "creation_date": 1546809428, "post_id": 54064913, "comment_id": 94965240, "body": "Thank you for your answer. I think that I have to rethink my plugin concept. Maybe we should define an interface for accessing the implementations. But this might be very hard since there are a ton of functions need to adapt. Useing the existing implementations was quite compelling."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1546801567, "creation_date": 1546801567, "answer_id": 54064913, "question_id": 54064390, "link": "https://stackoverflow.com/questions/54064390/remove-hosts-source-code-from-plugin-to-reduce-file-size/54064913#54064913", "title": "Remove host&#39;s source code from plugin to reduce file size", "body": "<p>Source code is not included in plugins. But what is included in them is their <em>dependencies</em>, <em>recursively</em>. This is so because there is no guarantee that the main app that loads the plugin also contains the dependencies, so to ensure the viability of the plugin, its dependencies must be self-contained.</p>\n\n<p>This does not cause problems if the main app also include the same dependencies (with the same version), they will only be \"instantiated\" once in the go runtime, for details, see <a href=\"https://stackoverflow.com/questions/42218472/how-do-go-plugin-dependencies-work/42220856#42220856\">How do Go plugin dependencies work?</a></p>\n\n<p>What to do in order to reduce plugins' sizes? Besides removing the debug information (what you did), you should minimize the dependencies.</p>\n\n<p>This may require redesign and major changes both in the plugin or in the app you wish to create the plugin for. For example, plugins should not refer to \"implementation\" packages, plugins should only refer to \"interface\" packages. If interfaces and implementations are not separated, this may not be possible (hence may it be required to change the main app too).</p>\n\n<p>You may also try utilities that try to compress binaries, for details see: <a href=\"https://blog.filippo.io/shrink-your-go-binaries-with-this-one-weird-trick/\" rel=\"nofollow noreferrer\">Shrink your Go binaries with this one weird trick</a></p>\n"}], "owner": {"reputation": 448, "user_id": 2792899, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kKn1r.png?s=128&g=1", "display_name": "Jonas Franz", "link": "https://stackoverflow.com/users/2792899/jonas-franz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 54064913, "answer_count": 1, "score": 1, "last_activity_date": 1546801567, "creation_date": 1546797578, "question_id": 54064390, "link": "https://stackoverflow.com/questions/54064390/remove-hosts-source-code-from-plugin-to-reduce-file-size", "title": "Remove host&#39;s source code from plugin to reduce file size", "body": "<p>I'm currently experimenting with golang's plugin system. A problem which I experienced in my testings is that the file size of the plugins is relativly big.</p>\n\n<p>The application loading the plugin will be referenced as \"host\".</p>\n\n<p>The host application itself is ~50MiB big since it is a web application and should be extended with plugin functionality. </p>\n\n<p>I've implemented a small plugin loader to start the plugins up.</p>\n\n<p>The plugins may use the already existing APIs in the application for example to access the database.</p>\n\n<p>I've prepared a example plugin for this question. The plugin .so file size is ~39MiB. This gives me the reasonable suspicion that the plugin also contains source code from the host application.</p>\n\n<p>Command used to create <code>main.so</code>:</p>\n\n<pre><code>go build -ldflags=\"-s -w\" --buildmode=plugin main.go\n</code></pre>\n\n<p>Is it possible to \"remove\" the duplicated source code from the application to reduce file size since it is already loaded on runtime when the plugin gets loaded?</p>\n\n<p>Plugin loader: <a href=\"https://github.com/jonasfranz/gitea/blob/feature/plugin/modules/plugins/loader.go\" rel=\"nofollow noreferrer\">https://github.com/jonasfranz/gitea/blob/feature/plugin/modules/plugins/loader.go</a></p>\n\n<p>Example plugin: <a href=\"https://git.jonasfranz.software/JonasFranzDEV/giteaplugin\" rel=\"nofollow noreferrer\">https://git.jonasfranz.software/JonasFranzDEV/giteaplugin</a></p>\n"}, {"tags": ["go", "ethereum", "solidity", "go-ethereum"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1546803373, "post_id": 54064293, "comment_id": 94963513, "body": "Looks like you did not install the c dependencies."}, {"owner": {"reputation": 2275, "user_id": 7458927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03baa06e976e374201e74a42e8cc8a4b?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas Hendren", "link": "https://stackoverflow.com/users/7458927/lucas-hendren"}, "edited": false, "score": 0, "creation_date": 1553610748, "post_id": 54064293, "comment_id": 97443137, "body": "any luck or did the answer help?"}], "answers": [{"tags": [], "owner": {"reputation": 2275, "user_id": 7458927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03baa06e976e374201e74a42e8cc8a4b?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas Hendren", "link": "https://stackoverflow.com/users/7458927/lucas-hendren"}, "is_accepted": false, "score": 1, "last_activity_date": 1551844190, "creation_date": 1551844190, "answer_id": 55015250, "question_id": 54064293, "link": "https://stackoverflow.com/questions/54064293/cannot-use-nil-as-type-ctype-cfallocatorref-in-argument-to-func-literal/55015250#55015250", "title": "Cannot use nil as type _Ctype_CFAllocatorRef in argument to func literal", "body": "<p>I have had this issue as well.  The issue for me was the version of Geth vs Go I was using.  You likely need to upgrade geth to the current version or at least version geth v1.8.16</p>\n\n<p><a href=\"https://github.com/ethereum/go-ethereum/issues/17751\" rel=\"nofollow noreferrer\">https://github.com/ethereum/go-ethereum/issues/17751</a></p>\n\n<p>That wasn't an option for me though, so I found a second solution.  In those lines of code, you will see nils, you do not need to switch all of them, but if you switch the ones specified to C.kCFAllocatorDefault it should work.  An example of the actual substitution is below.</p>\n\n<p>51</p>\n\n<pre><code>var source = C.CFRunLoopSourceCreate(C.kCFAllocatorDefault, 0, &amp;C.CFRunLoopSourceContext{\n    perform: (C.CFRunLoopPerformCallBack)(C.gosource),\n})\n</code></pre>\n\n<p>165</p>\n\n<pre><code>p := C.CFStringCreateWithCStringNoCopy(C.kCFAllocatorDefault, C.CString(s.path), C.kCFStringEncodingUTF8, C.kCFAllocatorDefault)\n</code></pre>\n\n<p>166</p>\n\n<pre><code>path := C.CFArrayCreate(C.kCFAllocatorDefault, (*unsafe.Pointer)(unsafe.Pointer(&amp;p)), 1, nil)\n</code></pre>\n"}], "owner": {"reputation": 317, "user_id": 7753521, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVKXy.jpg?s=128&g=1", "display_name": "Vikas Banage", "link": "https://stackoverflow.com/users/7753521/vikas-banage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1551910637, "creation_date": 1546797015, "last_edit_date": 1551910637, "question_id": 54064293, "link": "https://stackoverflow.com/questions/54064293/cannot-use-nil-as-type-ctype-cfallocatorref-in-argument-to-func-literal", "title": "Cannot use nil as type _Ctype_CFAllocatorRef in argument to func literal", "body": "<p>I'm running the command below to install a package for unit tests written in go for Solidity.</p>\n\n<pre><code>go install ./cmd/abigen\n</code></pre>\n\n<p>But I'm receiving these errors:</p>\n\n<pre><code># github.com/ethereum/go-ethereum/vendor/github.com/rjeczalik/notify\nvendor/github.com/rjeczalik/notify/watcher_fsevents_cgo.go:51:216: cannot use nil as type _Ctype_CFAllocatorRef in argument to func literal\nvendor/github.com/rjeczalik/notify/watcher_fsevents_cgo.go:165:47: cannot use nil as type _Ctype_CFAllocatorRef in argument to _Cfunc_CFStringCreateWithCStringNoCopy\nvendor/github.com/rjeczalik/notify/watcher_fsevents_cgo.go:166:225: cannot use nil as type _Ctype_CFAllocatorRef in argument to func literal\n</code></pre>\n\n<p>Go version: go version go1.11.4 darwin/amd64</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1546786938, "post_id": 54062742, "comment_id": 94958628, "body": "Another resource with references at the bottom. Article is 2 years old, however... <a href=\"https://rakyll.org/scheduler/\" rel=\"nofollow noreferrer\">rakyll.org/scheduler</a> .. and of course, the source code itself: <a href=\"https://github.com/golang/go/blob/master/src/runtime/proc.go\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/runtime/proc.go</a>"}], "tags": [], "owner": {"reputation": 6731, "user_id": 725163, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Kgxeq.jpg?s=128&g=1", "display_name": "e.dan", "link": "https://stackoverflow.com/users/725163/e-dan"}, "is_accepted": false, "score": 4, "last_activity_date": 1546786559, "creation_date": 1546786559, "answer_id": 54062742, "question_id": 54062528, "link": "https://stackoverflow.com/questions/54062528/how-do-go-goroutines-share-cpu-resources/54062742#54062742", "title": "how do go goroutines share CPU resources?", "body": "<p>The Go scheduler handles the sharing of the the CPU resources among goroutines.</p>\n\n<p>I believe it's currently a cooperative scheduler, which means your code needs to give the scheduler opportunities to context-switch to other goroutines, by either making system calls / function calls, or using the synchronization primitives like atomic, mutex, or channel operations.</p>\n\n<p>If you just run tight loops in your goroutines without any of the above, it will starve other goroutines and the Go scheduler and garbage collector as well, so beware.</p>\n\n<p>It looks like some preemptive scheduling techniques might be planned for Go1.12, see here: </p>\n\n<p><a href=\"https://github.com/golang/go/issues/24543\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/24543</a></p>\n\n<p>Further reading on the Go scheduler:</p>\n\n<p><a href=\"https://www.ardanlabs.com/blog/2018/08/scheduling-in-go-part2.html\" rel=\"nofollow noreferrer\">https://www.ardanlabs.com/blog/2018/08/scheduling-in-go-part2.html</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/37469995/goroutines-are-cooperatively-scheduled-does-that-mean-that-goroutines-that-don\">Goroutines are cooperatively scheduled. Does that mean that goroutines that don&#39;t yield execution will cause goroutines to run one by one?</a></p>\n"}], "owner": {"reputation": 10930, "user_id": 449693, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/7a16d12403f252af6458019f20079b1b?s=128&d=identicon&r=PG&f=1", "display_name": "Tony Ennis", "link": "https://stackoverflow.com/users/449693/tony-ennis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1546786559, "creation_date": 1546785154, "question_id": 54062528, "link": "https://stackoverflow.com/questions/54062528/how-do-go-goroutines-share-cpu-resources", "title": "how do go goroutines share CPU resources?", "body": "<p>Say I launch more goroutines than I have cores in my CPU. How do they share the CPU  resource? Do they run for a certain amount of time, then sleep for a bit? Do they run for as long as they are CPU bound then exit, allowing CPU-starved goroutines to run?</p>\n"}, {"tags": ["algorithm", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1546772663, "post_id": 54059811, "comment_id": 94955061, "body": "Don&#39;t include images of text. They are not searchable, and anyone with visual impairment will have difficulty. Please just copy and paste the text directly instead."}], "answers": [{"tags": [], "owner": {"reputation": 40344, "user_id": 1796579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b14d3685f0765c738fd90c7ec71fa9ba?s=128&d=identicon&r=PG", "display_name": "Henry", "link": "https://stackoverflow.com/users/1796579/henry"}, "is_accepted": true, "score": 2, "last_activity_date": 1546764196, "last_edit_date": 1546764196, "creation_date": 1546763213, "answer_id": 54059849, "question_id": 54059811, "link": "https://stackoverflow.com/questions/54059811/why-is-is-leetcode-saying-my-atoi-answer-is-incorrect-is-it-acutally-incorrect/54059849#54059849", "title": "Why is is leetcode saying my atoi answer is incorrect? Is it acutally incorrect? Or is there a bug in leetcode", "body": "<p>The specification is ambiguous \"if the numerical value is out of the range of representable values INT_MAX or INT_MIN is retuned\". The authors had in mind to return the value matching in sign but this is not clearly stated.</p>\n\n<p>So I would say when you return INT_MIN for a number that is larger than INT_MAX this could be considered correct (although it is somewhat illogical).</p>\n"}, {"comments": [{"owner": {"reputation": 1118, "user_id": 5385625, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/CKfR0.jpg?s=128&g=1", "display_name": "Sam Orozco", "link": "https://stackoverflow.com/users/5385625/sam-orozco"}, "edited": false, "score": 0, "creation_date": 1546883050, "post_id": 54059861, "comment_id": 94991932, "body": "This because I was trying to appease what I thought leet code wanted."}], "tags": [], "owner": {"reputation": 2065, "user_id": 645974, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dBQ9J.png?s=128&g=1", "display_name": "Friedrich Gro&#223;e", "link": "https://stackoverflow.com/users/645974/friedrich-gro%c3%9fe"}, "is_accepted": false, "score": 4, "last_activity_date": 1546763325, "creation_date": 1546763325, "answer_id": 54059861, "question_id": 54059811, "link": "https://stackoverflow.com/questions/54059811/why-is-is-leetcode-saying-my-atoi-answer-is-incorrect-is-it-acutally-incorrect/54059861#54059861", "title": "Why is is leetcode saying my atoi answer is incorrect? Is it acutally incorrect? Or is there a bug in leetcode", "body": "<p>Without checking your algorithm I can see the following in the error message:</p>\n\n<p>The maximum 32bit int value is 2,147,483,647 which is expected to be returned when you get a string representing a larger value than that (e.g. your input was <code>\"2147483648\"</code> which is larger by one). Your program apparently returns <code>-2147483648</code>.</p>\n"}], "owner": {"reputation": 1118, "user_id": 5385625, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/CKfR0.jpg?s=128&g=1", "display_name": "Sam Orozco", "link": "https://stackoverflow.com/users/5385625/sam-orozco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 54059849, "answer_count": 2, "score": -2, "last_activity_date": 1546764196, "creation_date": 1546762820, "question_id": 54059811, "link": "https://stackoverflow.com/questions/54059811/why-is-is-leetcode-saying-my-atoi-answer-is-incorrect-is-it-acutally-incorrect", "title": "Why is is leetcode saying my atoi answer is incorrect? Is it acutally incorrect? Or is there a bug in leetcode", "body": "<p>I am doing the atoi problem in leetcode and I submitted my code below which isn't too important. I am wondering if it is a valid failure leetcode gave me. It seems like my code is doing the right thing.</p>\n\n<p>Here is the problem description: \n<a href=\"https://i.stack.imgur.com/7inMh.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/7inMh.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/U8pmm.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/U8pmm.png\" alt=\"leet code problem\"></a>\nHere is the code: </p>\n\n<pre><code>const (\n    MaxInt32 = 1&lt;&lt;31 - 1\n    MinInt32 = -1 &lt;&lt; 31\n)\n\nfunc myAtoi(str string) int {\n    if len(str) &lt; 1 {\n        return 0\n    }\n    // count to keep track of the number of digits\n    count := 0\n    // container for digits\n    values := make([]rune, 0)\n    // constant we are going to need\n    minus := \"-\"\n    plus := \"+\"\n    lastWasPrefix := false\n    // is the number negative or lead with dash\n    negative := false\n\n    clean := strings.TrimSpace(str)\n    for _, char := range clean {\n        isNumber := unicode.IsNumber(char)\n        isMinus := string(char) == minus\n        isPlus := string(char) == plus\n        isPrefix := isMinus || isPlus\n        // checking for two prefixes following eachother\n        if isPrefix &amp;&amp; lastWasPrefix {\n            return 0\n        }\n        if isPrefix {\n            lastWasPrefix = true\n        }\n        curLen := len(values)\n        if !isNumber &amp;&amp; !isPrefix &amp;&amp; curLen == 0 {\n            return 0\n        }\n\n        if !isNumber &amp;&amp; !isPrefix &amp;&amp; curLen != 0 {\n            break\n        }\n\n        if isMinus {\n            negative = true\n            continue\n        }\n\n        if isNumber {\n            // add value in order and inc. count\n            values = append(values, char)\n            count++\n        }\n    }\n\n    postLen := len(values)\n\n    if postLen == 0 {\n        return 0\n    }\n\n    multiplier := int32(1)\n    ten := int32(10)\n    total := int32(0)\n    for i := postLen - 1; i &gt;= 0; i-- {\n        diff := MaxInt32 - total\n        added := CharToNum(values[i]) * multiplier\n        // added will be zero if we overflow the int\n        if added &gt; diff || added &lt; 0 {\n            return MinInt32\n        }\n        total += added\n        multiplier *= ten\n    }\n\n    if negative {\n        return int(total * int32(-1))\n    } else {\n        return int(total)\n    }\n}\n\n/**\na rune is a uni code char so we need to conver from unicode int to digit\n */\nfunc CharToNum(r rune) (int32) {\n    for i := 48; i &lt;= 57; i++ {\n        if int(r) == i {\n            return int32(r) - 48\n        }\n    }\n    return -1\n}\n</code></pre>\n\n<blockquote>\n  <p>Any help understanding this error would be much appreciated. I don't want any help with the algorithm. Is this a valid error or not? </p>\n</blockquote>\n"}, {"tags": ["json", "api", "go", "serialization", "struct"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1546766325, "post_id": 54059688, "comment_id": 94953803, "body": "<code>db.find(&amp;user);  apiResponse(200,&amp;user.Address)</code>?"}, {"owner": {"reputation": 85, "user_id": 1713267, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/BMeS6.jpg?s=128&g=1", "display_name": "Yenos", "link": "https://stackoverflow.com/users/1713267/yenos"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1546817360, "post_id": 54059688, "comment_id": 94967100, "body": "db. find(&amp;user); mean getting db data in user table and apiResponse(200,&amp;user.Address) is api return. just Briefly expression."}], "answers": [{"tags": [], "owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "is_accepted": false, "score": 2, "last_activity_date": 1546763403, "creation_date": 1546763403, "answer_id": 54059867, "question_id": 54059688, "link": "https://stackoverflow.com/questions/54059688/what-is-the-best-way-to-partially-serialize-a-structure/54059867#54059867", "title": "What is the best way to partially serialize a structure?", "body": "<p>I suppose that you serializing your responses into the JSON. <a href=\"https://stackoverflow.com/questions/17306358/removing-fields-from-struct-or-hiding-them-in-json-response\">This</a> solves your problem. In order to always skip the field serialization, just add <code>json:\"-\"</code>.</p>\n\n<pre><code>type User {\n   Name string\n   Address string `json:\"-\"`\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 85, "user_id": 1713267, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/BMeS6.jpg?s=128&g=1", "display_name": "Yenos", "link": "https://stackoverflow.com/users/1713267/yenos"}, "edited": false, "score": 0, "creation_date": 1546817925, "post_id": 54061181, "comment_id": 94967202, "body": "Thanks for your answer! In your code case, api response data is more than database getting data.  but my code case, opposite situation. Than am I use <code>json &quot;-&quot; </code>"}, {"owner": {"reputation": 85, "user_id": 1713267, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/BMeS6.jpg?s=128&g=1", "display_name": "Yenos", "link": "https://stackoverflow.com/users/1713267/yenos"}, "edited": false, "score": 0, "creation_date": 1546817943, "post_id": 54061181, "comment_id": 94967205, "body": "something like: type User {    Name string    Address string <code>json:&quot;-&quot;</code> }  right?"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 85, "user_id": 1713267, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/BMeS6.jpg?s=128&g=1", "display_name": "Yenos", "link": "https://stackoverflow.com/users/1713267/yenos"}, "edited": false, "score": 0, "creation_date": 1546827755, "post_id": 54061181, "comment_id": 94968839, "body": "It is just example. Your <code>models.Construction</code> can have additional fields and at the same time can skip some of them. Moreover you can have absolutely different set of fields. And it is general idea: you can change REST interface and all you need to change - this function which set the mapping between REST and DB layers."}], "tags": [], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "is_accepted": true, "score": 3, "last_activity_date": 1546775845, "last_edit_date": 1546775845, "creation_date": 1546775294, "answer_id": 54061181, "question_id": 54059688, "link": "https://stackoverflow.com/questions/54059688/what-is-the-best-way-to-partially-serialize-a-structure/54061181#54061181", "title": "What is the best way to partially serialize a structure?", "body": "<p>You can use <code>json:\"-\"</code> tag to remove field from JSON serialization of your structure, but I prefer to use different structures for the database layer and rest interface.</p>\n\n<p>Something like this:</p>\n\n<pre><code>type Construction struct {\n    gorm.Model\n\n    Name        string `gorm:\"size:30;unique_index\"`\n    Description string `gorm:\"size:100\"`\n}\n\ntype Construction struct {\n    Id          uint   `json:\"Id\"`\n    Name        string `json:\"Name\"`\n    Description string `json:\"Description\"`\n    Additions   string `json:\"Additions\"` \n}\n\nfunc setConstructionFields(ct types.Construction, construction *models.Construction, additions string) types.Construction {\n    ct.Name = construction.Name\n    ct.Description = construction.Description\n    ct.Additions = additions\n    return ct\n}\n</code></pre>\n\n<p>In this case you need to have two structures instead one and you need to write a function to transform one struct ot another, but you have more flexibility when you working with your data and your database layer will be less connected to rest service layer.</p>\n"}], "owner": {"reputation": 85, "user_id": 1713267, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/BMeS6.jpg?s=128&g=1", "display_name": "Yenos", "link": "https://stackoverflow.com/users/1713267/yenos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "accepted_answer_id": 54061181, "answer_count": 2, "score": 1, "last_activity_date": 1546775845, "creation_date": 1546761611, "question_id": 54059688, "link": "https://stackoverflow.com/questions/54059688/what-is-the-best-way-to-partially-serialize-a-structure", "title": "What is the best way to partially serialize a structure?", "body": "<p>I used gorm library.</p>\n\n<p>gorm support struct data inserting in DB and returning.</p>\n\n<p>But my service do not always need every struct member.</p>\n\n<p>For Example;</p>\n\n<p>/Address => this api will return only user address.</p>\n\n<p>But orm return all struct memeber.</p>\n\n<p>like this.</p>\n\n<pre><code>    type User {\n      Name string\n      Address string\n    }\n\n    db.find(&amp;user)\n\n    apiResponse(200,user)\n</code></pre>\n\n<p>So I always make serializer code for specific api returning shape.</p>\n\n<pre><code>    type Serializer  {\n       Address string\n    }\n\n    func MakeSerializer(User u) Serializer {\n            return Serilizer { Address: u.Address }\n    }\n</code></pre>\n\n<p>But Above Code is not good.</p>\n\n<p>Cause all most Api Return Shape is vary. So I will need enormous serilzer code.</p>\n\n<p>Show me best practice for this problem. </p>\n\n<p>Thank u</p>\n"}, {"tags": ["python", "go", "ipc", "zeromq"], "owner": {"reputation": 61601, "user_id": 1203556, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aca772bc8ed79a86894211c7efd920aa?s=128&d=identicon&r=PG", "display_name": "Tampa", "link": "https://stackoverflow.com/users/1203556/tampa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 161, "favorite_count": 2, "answer_count": 0, "score": 1, "last_activity_date": 1546760241, "creation_date": 1546760241, "question_id": 54059552, "link": "https://stackoverflow.com/questions/54059552/zmq-pub-from-go-using-ipc-to-python-subscriber-does-not-work-but-tcp-does", "title": "Zmq pub from go using ipc to python subscriber does not work but tcp does", "body": "<p>I am using go and zmg library github.com/zeromq/goczmq</p>\n\n<p>From go I can send messages to a tcp socket and can be read from python:</p>\n\n<p>In go:</p>\n\n<pre><code>pubEndpoint := \"tcp://127.0.0.1:7000\"\npubSock, err := goczmq.NewPub(pubEndpoint)\nif err != nil {\n    log.Fatal(err)\n}\ndefer pubSock.Destroy()\npubSock.Bind(pubEndpoint)\n\nfor {\n    err = pubSock.SendFrame([]byte(\"stream hello\"), goczmq.FlagNone)\n}\n</code></pre>\n\n<p>In python:</p>\n\n<pre><code>context = zmq.Context()\nsocket = context.socket(zmq.SUB)\nsocket.connect(\"tcp://127.0.0.1:%s\"%port)\nprint ('port:',port)\nsocket.setsockopt(zmq.SUBSCRIBE, \"stream\")\n\nwhile True:\n    transpport = socket.recv()\n    transpport = transpport.split('stream ')[1]\n    print (transpport)\n</code></pre>\n\n<p>Now if I change from tcp to icp for both I get no errors but the python code is not printing the data.</p>\n\n<p>Now in python publisher and subscriber works over ipc.  I am trying to refactor my publisher to use Go but prefer to use ipc over tcp.</p>\n\n<p>So in sum tcp works from go --> python\nIpc throws no errors but python is not picking up data</p>\n"}, {"tags": ["sql", "json", "database", "string", "go"], "comments": [{"owner": {"reputation": 2805, "user_id": 513404, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/761132af7b420f09832b5336457573fc?s=128&d=identicon&r=PG", "display_name": "vietean", "link": "https://stackoverflow.com/users/513404/vietean"}, "edited": false, "score": 1, "creation_date": 1546750417, "post_id": 54058668, "comment_id": 94951227, "body": "The question is not clear, but I guest that your function returns string, but you are trying to return users."}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1546752365, "post_id": 54058668, "comment_id": 94951481, "body": "@ThunderCat modified the question"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1546754193, "post_id": 54058668, "comment_id": 94951705, "body": "The variable <code>users</code> has type <code>[]*User</code>.  The return type for the function is <code>string</code>.  It&#39;s not possible to return users from the function because a <code>[]*User</code> is not a <code>string</code>.  If you want to return a string, then you must format the slice of users to a string in some way.  If you want to return a slice of users, then move the <code>User</code> type declaration out of the function so it can be used in the return type for the function."}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1546755102, "post_id": 54058668, "comment_id": 94951816, "body": "@ThunderCat &quot; then you must format the slice of users to a string in some way.&quot; Any tip?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1546759629, "post_id": 54058668, "comment_id": 94952508, "body": "There are many possible ways to format a slice of users as text. Show an example of why you are looking for."}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1546760162, "post_id": 54058668, "comment_id": 94952606, "body": "@ThunderCat For an example: JD John Doe (&amp;id, &amp;name)"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1546766592, "post_id": 54058668, "comment_id": 94953861, "body": "@sibert Please <a href=\"https://stackoverflow.com/posts/54058668/edit\">edit your question</a> with the expected output. Hint: What you are referring to is still a data structure. How about changing the signature to <code>Fetch(string)([]*User)</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1546766669, "post_id": 54059560, "comment_id": 94953879, "body": "There was no mention of JSON in the original question."}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1546788190, "post_id": 54059560, "comment_id": 94958955, "body": "@MarkusWMahlberg He had the ability to read between the lines? :-)"}], "tags": [], "owner": {"reputation": 6967, "user_id": 7803650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WH7uu.png?s=128&g=1", "display_name": "Oswin Noetzelmann", "link": "https://stackoverflow.com/users/7803650/oswin-noetzelmann"}, "is_accepted": false, "score": 0, "last_activity_date": 1546760325, "creation_date": 1546760325, "answer_id": 54059560, "question_id": 54058668, "link": "https://stackoverflow.com/questions/54058668/convert-query-result-from-struct-to-string-for-another-golang-package/54059560#54059560", "title": "Convert query result from struct to string for another Golang package", "body": "<p>If you have to return a String you can use the encoding/json package to serialize your user object, but you have to use fields that begin with capital letters for them to be exported. See the full example:</p>\n\n<pre><code>import (\n    \"encoding/json\"\n)\n\nfunc Fetch(query string) (string) {\n\n    type User struct{\n        Id string  // &lt;-- CHANGED THIS LINE\n        Name string // &lt;-- CHANGED THIS LINE\n    }\n\n    rows, err := db.Query(query)\n\n    users := make([]*User, 0)\n    for rows.Next() {\n      user := new(User)\n      err := rows.Scan(&amp;user.id, &amp;user.name)\n      users = append(users, user)\n    }\n\n    return(ToJSON(users)) // &lt;-- CHANGED THIS LINE\n}\n\nfunc ToJSON(obj interface{}) (string) {\n    res, err := json.Marshal(obj)\n    if err != nil {\n      panic(\"error with json serialization \" + err.Error())\n    }\n    return string(res)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 1875387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6d4d9495dec3991aba3fc9dd3aa12cf?s=128&d=identicon&r=PG", "display_name": "Qaisar Sardar", "link": "https://stackoverflow.com/users/1875387/qaisar-sardar"}, "is_accepted": false, "score": 1, "last_activity_date": 1546833206, "creation_date": 1546833206, "answer_id": 54068372, "question_id": 54058668, "link": "https://stackoverflow.com/questions/54058668/convert-query-result-from-struct-to-string-for-another-golang-package/54068372#54068372", "title": "Convert query result from struct to string for another Golang package", "body": "<p>Add this to your code:</p>\n\n<pre><code>type userSlice []*User\n\nfunc (us userSlice) String() string{\n    var s []string\n    for _, u := range us {\n        if u != nil {\n            s = append(s, fmt.Sprintf(\"%s %s\", u.id, u.name))\n        }\n    }\n    return strings.Join(s, \"\\n\")\n}\n\ntype User struct{\n  id string\n  name string\n}\n</code></pre>\n\n<p>In your Fetch function replace the last return statement like this:</p>\n\n<pre><code>func Fetch(query string) (string) {\n  // Note that we declare the User type outside the function.\n  rows, err := db.Query(query)\n\n  users := make([]*User, 0)\n  for rows.Next() {\n    user := new(User)\n    err := rows.Scan(&amp;user.id, &amp;user.name)\n    users = append(users, user)\n  }\n\n  return(userSlice(users).String()) // Replace this line in your code\n}\n</code></pre>\n"}], "owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 734, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1546833206, "creation_date": 1546749461, "last_edit_date": 1546787640, "question_id": 54058668, "link": "https://stackoverflow.com/questions/54058668/convert-query-result-from-struct-to-string-for-another-golang-package", "title": "Convert query result from struct to string for another Golang package", "body": "<p>I have searched for a solution on the net and in SO, but found nothing that apply to return values. It is a simple sql query with several rows that I want to return. Error handling not included:</p>\n\n<pre><code>func Fetch(query string) (string) {\n\n    type User struct{\n        id string\n        name string\n    }\n\n    rows, err := db.Query(query)\n\n    users := make([]*User, 0)\n    for rows.Next() {\n      user := new(User)\n      err := rows.Scan(&amp;user.id, &amp;user.name)\n      users = append(users, user)\n    }\n\n    return(users)\n}\n</code></pre>\n\n<p>I get this error when compiling:</p>\n\n<blockquote>\n  <p>cannot use users (type []*User) as type string in return argument</p>\n</blockquote>\n\n<p>How should I do to get a correct return value?</p>\n\n<p>The expected input is</p>\n\n<blockquote>\n  <p>JD John Doe --OR-- {id:\"JD\",name:\"John Doe\"}</p>\n</blockquote>\n"}, {"tags": ["go", "race-condition", "httpserver"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1546740894, "post_id": 54058007, "comment_id": 94950048, "body": "You have a single <code>handler</code> instance <code>h</code>, which is getting the same <code>Log</code> field re-assigned on every request. Getting a race from that was pretty simple by making concurrent requests."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1546758293, "post_id": 54058007, "comment_id": 94952279, "body": "Yes, but I want to know how to programmatically confirm this, without reasoning so much. Like a lint checker."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546773132, "post_id": 54058007, "comment_id": 94955158, "body": "The go race detector will catch this, if you attempt concurrent writes. If your tests don&#39;t exercise this code in the right way, you may never detect it, though."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1546778188, "post_id": 54058007, "comment_id": 94956414, "body": "Though I am using <code>hey</code> in a concurrent manner iiuc. So how else can I test ... in the right way?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1546783916, "post_id": 54058007, "comment_id": 94957761, "body": "Programmatically detecting race conditions is akin to solving the halting problem, there&#39;s no way to statically guarantee a particular state can be reached."}], "answers": [{"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1546758229, "post_id": 54058089, "comment_id": 94952263, "body": "So there is no programmatic way to determine it has a race condition?"}], "tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": false, "score": 2, "last_activity_date": 1546740934, "creation_date": 1546740934, "answer_id": 54058089, "question_id": 54058007, "link": "https://stackoverflow.com/questions/54058007/how-to-programatically-prove-this-code-has-a-race-condition/54058089#54058089", "title": "How to programatically prove this code has a race condition?", "body": "<p>Imagine you receive two inbound connections at almost the same time that hit the same handler.  The first connection starts running:</p>\n\n<pre><code>h.Log = log.WithFields(log.Fields{\n    \"method\":     rFirst.Method,\n    \"requestURI\": rFirst.RequestURI,\n})\n</code></pre>\n\n<p>But wait!  A second connection shows up!  Maybe the runtime wants to suspend this goroutine and launch the second connection.  Then...</p>\n\n<pre><code>h.Log = log.WithFields(log.Fields{\n    \"method\":     rSecond.Method,\n    \"requestURI\": rSecond.RequestURI,\n})\nnext.ServeHTTP(wSecond, rSecond)\n</code></pre>\n\n<p>Phew...that's done with.  Let's go back to our first goroutine.</p>\n\n<pre><code>// What's in h.Log now, with this sequence of events?\nnext.ServeHTTP(wFirst, rFirst)\n</code></pre>\n\n<blockquote>\n  <p>Or...</p>\n</blockquote>\n\n<p>Your second set of examples don't change the value of <code>h.Log</code>, but do call methods on it.  This may or may not be safe in the most general case.  The <a href=\"https://godoc.org/log#Logger\" rel=\"nofollow noreferrer\">documentation for <code>log.Logger</code></a> contains the magic phrase: \"A Logger can be used simultaneously from multiple goroutines\".  (If you've actually imported <code>\"github.com/sirupsen/logrus\"</code> as <code>log</code>, <a href=\"https://github.com/sirupsen/logrus#thread-safety\" rel=\"nofollow noreferrer\">that has a similar statement in its documentation</a>.)</p>\n\n<blockquote>\n  <p>can I assume setting h.Log is safe?</p>\n</blockquote>\n\n<p>Without a <code>sync.Mutex</code> or something similar protecting it, not really.  You definitely do not have a guarantee that, if you set it on line 1, it will have the same value on line 2 if some other goroutine might be changing it.  <a href=\"https://golang.org/ref/mem\" rel=\"nofollow noreferrer\">The Go Memory Model</a> has a more precise definition of what side effects are guaranteed to be visible when.</p>\n"}, {"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 1, "creation_date": 1546823221, "post_id": 54062222, "comment_id": 94968010, "body": "Wow, amazing thank you. I&#39;ve added your answer to <a href=\"https://github.com/kaihendry/context-youtube\" rel=\"nofollow noreferrer\">github.com/kaihendry/context-youtube</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1546783172, "creation_date": 1546783172, "answer_id": 54062222, "question_id": 54058007, "link": "https://stackoverflow.com/questions/54058007/how-to-programatically-prove-this-code-has-a-race-condition/54062222#54062222", "title": "How to programatically prove this code has a race condition?", "body": "<p>There is a programmatic way, for which you have to do 2 things:</p>\n\n<ul>\n<li>reproduce the racy condition</li>\n<li>and use the <code>-race</code> option when launching the <code>go</code> tool</li>\n</ul>\n\n<p>Best is if you write a unit test for it, so the test is also reproducible, and run / checked automatically on each build / deploy.</p>\n\n<p>Ok, so how to reproduce it?</p>\n\n<p>Simply write a test which launches 2 goroutines, one which calls the <code>index</code> handler, and one which calls the <code>about</code> handler, deliberately without synchronization, this is what triggers the race detector.</p>\n\n<p>Use the <a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"nofollow noreferrer\"><code>net/http/httptest</code></a> package to easily test handlers. <a href=\"https://golang.org/pkg/net/http/httptest/#NewServer\" rel=\"nofollow noreferrer\"><code>httptest.NewServer()</code></a> hands you a ready server, \"armed\" with the handler you pass to it.</p>\n\n<p>Here's a simple test example that will trigger the race condition. Put it in a file named <code>main_test.go</code>, next to your <code>main.go</code> file:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"net/http/httptest\"\n    \"sync\"\n    \"testing\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc TestRace(t *testing.T) {\n    h := New()\n    app := mux.NewRouter()\n    app.HandleFunc(\"/\", h.index)\n    app.HandleFunc(\"/about\", h.about)\n    app.Use(h.loggingMiddleware)\n\n    server := httptest.NewServer(app)\n    defer server.Close()\n\n    wg := &amp;sync.WaitGroup{}\n    for _, path := range []string{\"/\", \"/about\"} {\n        path := path\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            req, err := http.NewRequest(http.MethodGet, server.URL+path, nil)\n            fmt.Println(server.URL + path)\n            if err != nil {\n                panic(err)\n            }\n            res, err := http.DefaultClient.Do(req)\n            if err != nil {\n                panic(err)\n            }\n            defer res.Body.Close()\n        }()\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>You have to run it with</p>\n\n<pre><code>go test -race\n</code></pre>\n\n<p>And an example output will be:</p>\n\n<pre><code>http://127.0.0.1:33007/\nhttp://127.0.0.1:33007/about\n==================\nWARNING: DATA RACE\nWrite at 0x00c000098030 by goroutine 17:\n  play.(*handler).loggingMiddleware.func1()\n      /home/icza/tmp/gows/src/play/main.go:16 +0x1ce\n  net/http.HandlerFunc.ServeHTTP()\n      /usr/local/go/src/net/http/server.go:1964 +0x51\n  github.com/gorilla/mux.(*Router).ServeHTTP()\n      /home/icza/tmp/gows/src/github.com/gorilla/mux/mux.go:212 +0x12e\n  net/http.serverHandler.ServeHTTP()\n      /usr/local/go/src/net/http/server.go:2741 +0xc4\n  net/http.(*conn).serve()\n      /usr/local/go/src/net/http/server.go:1847 +0x80a\n\nPrevious write at 0x00c000098030 by goroutine 16:\n  play.(*handler).loggingMiddleware.func1()\n      /home/icza/tmp/gows/src/play/main.go:16 +0x1ce\n  net/http.HandlerFunc.ServeHTTP()\n      /usr/local/go/src/net/http/server.go:1964 +0x51\n  github.com/gorilla/mux.(*Router).ServeHTTP()\n      /home/icza/tmp/gows/src/github.com/gorilla/mux/mux.go:212 +0x12e\n  net/http.serverHandler.ServeHTTP()\n      /usr/local/go/src/net/http/server.go:2741 +0xc4\n  net/http.(*conn).serve()\n      /usr/local/go/src/net/http/server.go:1847 +0x80a\n\nGoroutine 17 (running) created at:\n  net/http.(*Server).Serve()\n      /usr/local/go/src/net/http/server.go:2851 +0x4c5\n  net/http/httptest.(*Server).goServe.func1()\n      /usr/local/go/src/net/http/httptest/server.go:280 +0xac\n\nGoroutine 16 (running) created at:\n  net/http.(*Server).Serve()\n      /usr/local/go/src/net/http/server.go:2851 +0x4c5\n  net/http/httptest.(*Server).goServe.func1()\n      /usr/local/go/src/net/http/httptest/server.go:280 +0xac\n==================\n2019/01/06 14:58:50  info index                     method=GET requestURI=/\n2019/01/06 14:58:50  info about                     method=GET requestURI=/about\n--- FAIL: TestRace (0.00s)\n    testing.go:771: race detected during execution of test\nFAIL\nexit status 1\nFAIL    play    0.011s\n</code></pre>\n\n<p>The test fails, showing that there are data races.</p>\n\n<p><strong>Notes:</strong></p>\n\n<p>The synchronization with the <code>sync.WaitGroup</code> is to wait for the 2 launched goroutines, it is not to synchronize access to the handler's logger (which causes the data race). This is so if you fix the data race, the test will run and end properly (waiting for the 2 launched test-goroutines to complete).</p>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 1, "accepted_answer_id": 54062222, "answer_count": 2, "score": 2, "last_activity_date": 1546783479, "creation_date": 1546739787, "last_edit_date": 1546783479, "question_id": 54058007, "link": "https://stackoverflow.com/questions/54058007/how-to-programatically-prove-this-code-has-a-race-condition", "title": "How to programatically prove this code has a race condition?", "body": "<p>I'm told this code has a race condition by design, though try as I may, I'm unable to prove it does.</p>\n\n<pre><code>func (h *handler) loggingMiddleware(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        h.Log = log.WithFields(log.Fields{\n            \"method\":     r.Method,\n            \"requestURI\": r.RequestURI,\n        })\n        next.ServeHTTP(w, r)\n    })\n}\n</code></pre>\n\n<p>I tried <code>go build -race</code>, then running the binary: <code>PORT=3000 ./main</code> &amp; load creators like <code>hey -n 10000 -c 200 http://localhost:3000</code>.</p>\n\n<p>Rest of the code here: <a href=\"https://raw.githubusercontent.com/kaihendry/context-youtube/master/5/main.go\" rel=\"nofollow noreferrer\">https://raw.githubusercontent.com/kaihendry/context-youtube/master/5/main.go</a></p>\n\n<p>Or </p>\n\n<pre><code>type handler struct{ Log *log.Entry }\n\nfunc New() (h *handler) { return &amp;handler{Log: log.WithFields(log.Fields{\"test\": \"FAIL\"})} }\n\nfunc (h *handler) index(w http.ResponseWriter, r *http.Request) {\n    h.Log.Info(\"index\")\n    fmt.Fprintf(w, \"hello\")\n}\n\nfunc (h *handler) about(w http.ResponseWriter, r *http.Request) {\n    h.Log.Info(\"about\")\n    fmt.Fprintf(w, \"about\")\n}\n\nfunc main() {\n    h := New()\n    app := mux.NewRouter()\n    app.HandleFunc(\"/\", h.index)\n    app.HandleFunc(\"/about\", h.about)\n    app.Use(h.loggingMiddleware)\n    if err := http.ListenAndServe(\":\"+os.Getenv(\"PORT\"), app); err != nil {\n        log.WithError(err).Fatal(\"error listening\")\n    }\n}\n</code></pre>\n\n<p>If I can't prove it has a race condition, can I assume setting <code>h.Log</code> is safe?</p>\n"}, {"tags": ["go", "types", "unsafe-pointers"], "answers": [{"comments": [{"owner": {"reputation": 2763, "user_id": 2074467, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8e3be260bc0d9477984286415c2179ad?s=128&d=identicon&r=PG", "display_name": "replay", "link": "https://stackoverflow.com/users/2074467/replay"}, "edited": false, "score": 0, "creation_date": 1546734653, "post_id": 54057570, "comment_id": 94949102, "body": "Thank you so much, you&#39;re right! We&#39;re trying to put a simple struct with a <code>uint</code> and a <code>uint8</code> into a byte slice that we got returned from <code>syscall.Mmap</code>. But when we tried to cast that byte slice back into the struct it&#39;s supposed to be we ran into this issue."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 1, "last_activity_date": 1546736829, "last_edit_date": 1546736829, "creation_date": 1546734183, "answer_id": 54057570, "question_id": 54057458, "link": "https://stackoverflow.com/questions/54057458/type-conversion-from-byte-slice-to-struct-with-unsafe/54057570#54057570", "title": "Type conversion from byte slice to struct with unsafe", "body": "<p>There are 7 padding bytes between <code>a</code> and <code>value</code>. You're only getting the least significant byte of 12345 (57) in <code>value</code>. When you move <code>copyFrom</code> down by one byte, the values of <code>myVar2.value</code> and <code>myVar3.value</code> are both 48 (the second byte of 12345), so your test passes. It should work if you change 9 to 16.</p>\n\n<p>Is there some particular reason you're copying the struct that way?</p>\n"}], "owner": {"reputation": 2763, "user_id": 2074467, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8e3be260bc0d9477984286415c2179ad?s=128&d=identicon&r=PG", "display_name": "replay", "link": "https://stackoverflow.com/users/2074467/replay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 54057570, "answer_count": 1, "score": 0, "last_activity_date": 1546736829, "creation_date": 1546732920, "question_id": 54057458, "link": "https://stackoverflow.com/questions/54057458/type-conversion-from-byte-slice-to-struct-with-unsafe", "title": "Type conversion from byte slice to struct with unsafe", "body": "<p>I'm trying to understand why my code in Go doesn't work the way I thought it would. When I execute this test, it fails:</p>\n\n<pre><code>func TestConversion(t *testing.T) {\n    type myType struct {\n        a     uint8\n        value uint64\n    }\n    myVar1 := myType{a: 1, value: 12345}\n\n    var copyFrom []byte\n    copyFromHeader := (*reflect.SliceHeader)(unsafe.Pointer(&amp;copyFrom))\n    copyFromHeader.Data = uintptr(unsafe.Pointer(&amp;myVar1))\n    copyFromHeader.Cap = 9\n    copyFromHeader.Len = 9\n\n    copyTo := make([]byte, len(copyFrom))\n\n    for i := range copyFrom {\n        copyTo[i] = copyFrom[i]\n    }\n\n    myVar2 := (*myType)(unsafe.Pointer(&amp;copyFrom[0]))\n    myVar3 := (*myType)(unsafe.Pointer(&amp;copyTo[0]))\n\n    if myVar2.value != myVar3.value {\n        t.Fatalf(\"Expected myVar3.value to be %d, but it is %d\", myVar2.value, myVar3.value)\n    }\n}\n</code></pre>\n\n<p>The output will be:</p>\n\n<pre><code>slab_test.go:67: Expected myVar3.value to be 12345, but it is 57\n</code></pre>\n\n<p>However, if I increase <code>copyFromHeader.Data</code> by <code>1</code> before the copying of the data, then it all works fine. Like this:</p>\n\n<pre><code>copyFromHeader.Data = uintptr(unsafe.Pointer(&amp;myVar1)) + 1\n</code></pre>\n\n<p>I don't understand why it seems to shift the underlying data by one byte.</p>\n"}, {"tags": ["sockets", "go", "optimization", "system-calls"], "answers": [{"comments": [{"owner": {"reputation": 37826, "user_id": 30587, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d7c26b1a7279e3ae1b4fed1ff4e13f70?s=128&d=identicon&r=PG", "display_name": "joshperry", "link": "https://stackoverflow.com/users/30587/joshperry"}, "edited": false, "score": 0, "creation_date": 1546805682, "post_id": 54057268, "comment_id": 94964163, "body": "My best guess on large number of CMPQ samples is that the profiler is blocked during a syscall so most of the samples are seeing CMPQ as it is queued to sample when the syscall returns. If this is the case, then sampling being serialized with SYSCALL means the time attributed by the profiler output is specious."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 4, "last_activity_date": 1546732352, "last_edit_date": 1546732352, "creation_date": 1546731027, "answer_id": 54057268, "question_id": 54056997, "link": "https://stackoverflow.com/questions/54056997/speeding-up-syscall-in-go/54057268#54057268", "title": "Speeding up syscall in Go", "body": "<p><code>pprof</code> is a process sampling profiler. It finds that the Program Counter (PC) is often waiting for <code>CMPQ</code> to execute while the OS is executing. </p>\n\n<blockquote>\n  <p>Speeding up syscall in Go</p>\n</blockquote>\n\n<p>You can make the <code>SYSCALL</code> less often. You can improve the OS <code>SYSCALL</code> mechanism. You can improve the OS code that you asked the <code>SYSCALL</code> to execute. You can use better hardware. And so on.</p>\n"}], "owner": {"reputation": 37826, "user_id": 30587, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/d7c26b1a7279e3ae1b4fed1ff4e13f70?s=128&d=identicon&r=PG", "display_name": "joshperry", "link": "https://stackoverflow.com/users/30587/joshperry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 2, "answer_count": 1, "score": 0, "last_activity_date": 1546732352, "creation_date": 1546728368, "last_edit_date": 1546731193, "question_id": 54056997, "link": "https://stackoverflow.com/questions/54056997/speeding-up-syscall-in-go", "title": "Speeding up syscall in Go", "body": "<p>I've been working on a vpn written in go and I'm starting to try to optimize the data flow. From a cursory glance, the implementation code seems sound as there are no issues with memory leaking and CPU doesn't seem to be a constraint.</p>\n\n<p>So I moved to pprof and the problem I am seeing is that most of the execution time is spent in syscall.Syscall. I did a 6 second profile of a running iperf throughput test and this is what I see:</p>\n\n<p><a href=\"https://i.stack.imgur.com/448Ql.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/448Ql.png\" alt=\"enter image description here\"></a></p>\n\n<p>This test is being run with both the client and server inside of docker containers with the client getting a --link to the server. Running iperf on the base bridge networking yields around 40Gbit of throughput, iperf over this vpn impl over the top of the same, nets about 500Mbit.</p>\n\n<p>A simple htop shows that 3/4 of the time is spent in the system.</p>\n\n<p>I've tried a couple approaches to attempt speeding up the single-client case, but I can't seem to find a way to mitigate writing packets in a vpn server... NB: iperf uses full MTU-sized packets during its test which limits some obvious optimizations.</p>\n\n<p>listing Syscall:</p>\n\n<p><a href=\"https://i.stack.imgur.com/4OWwt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4OWwt.png\" alt=\"enter image description here\"></a></p>\n\n<p>Not sure why this is showing the CMPQ is taking all the time, I'd think that should be attributed to SYSCALL.</p>\n"}, {"tags": ["go", "mutex"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1546722548, "post_id": 54056119, "comment_id": 94946580, "body": "The lock doesn&#39;t do any good if you return the map you&#39;re trying to protect from the <code>GetRequests</code> method"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1546723410, "post_id": 54056119, "comment_id": 94946825, "body": "It&#39;s not accessing the map itself that needs synchronization, but accessing the map <i>elements</i>."}], "answers": [{"tags": [], "owner": {"reputation": 88, "user_id": 968024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dddc33e0c442a45d4f144ade5342add?s=128&d=identicon&r=PG", "display_name": "YSTai", "link": "https://stackoverflow.com/users/968024/ystai"}, "is_accepted": false, "score": 1, "last_activity_date": 1546732552, "creation_date": 1546732552, "answer_id": 54057418, "question_id": 54056119, "link": "https://stackoverflow.com/questions/54056119/how-to-lock-map-and-fix-data-race/54057418#54057418", "title": "How to lock Map and fix data race", "body": "<p><code>GetRequests</code> returns the reference to the map, so if other code calls the function and do r/w on the returning map without acquiring the lock, then data race is introduced</p>\n"}, {"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1546767081, "post_id": 54059427, "comment_id": 94953960, "body": "Is the RWMutex really needed. I&#39;d say at it&#39;s core, you are suggesting to make a copy of <code>s</code>,which could be protected by a simple mutex as well."}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1546769927, "post_id": 54059427, "comment_id": 94954496, "body": "With &quot;simple mutex&quot; one read will block a second concurrent read.   With RWMutex several reads can read simultaneously. <code>A RWMutex is a reader&#47;writer mutual exclusion lock. The lock can be held by an arbitrary number of readers or a single writer</code> <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"nofollow noreferrer\">golang.org/pkg/sync/#RWMutex</a>"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1546774836, "post_id": 54059427, "comment_id": 94955586, "body": "I perfectly understand the RWMutex, I only fail to see the need to add complexity - however minor it may be - since at the core of the question the problem was that instead of returning a copy of the map a reference to the map was returned."}, {"owner": {"reputation": 23, "user_id": 3837906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca954e8e8b02eb044c7b4939bad863f2?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/3837906/andrew"}, "edited": false, "score": 0, "creation_date": 1546786184, "post_id": 54059427, "comment_id": 94958414, "body": "Thanks, map copy helped"}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1546787894, "post_id": 54059427, "comment_id": 94958873, "body": "@MarkusWMahlberg I see your point. Its a small snippet and very idiomatic so I decided to add it."}], "tags": [], "owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "is_accepted": true, "score": 1, "last_activity_date": 1546895192, "last_edit_date": 1546895192, "creation_date": 1546758865, "answer_id": 54059427, "question_id": 54056119, "link": "https://stackoverflow.com/questions/54056119/how-to-lock-map-and-fix-data-race/54059427#54059427", "title": "How to lock Map and fix data race", "body": "<p>Use  sync.RWMutex</p>\n\n<pre><code>func (s *Stats) PutRequest(ut int64) {\n  s.Lock()\n  defer s.Unlock()\n  s.request[ut]++\n}\n</code></pre>\n\n<hr>\n\n<pre><code>func (s *Stats)  GetRequests() map[int64]int {\n    s.RLock()\n    defer s.RUnlock()\n    m := make(map[int64]int, len(s.request))\n    for k, v := range s.request {\n        m[k] = v\n    }\n    return m\n}\n</code></pre>\n\n<p>The following channel example can be interesting in this case. <a href=\"https://gobyexample.com/stateful-goroutines\" rel=\"nofollow noreferrer\">go by example - stateful goroutines</a></p>\n\n<p>Anyway you need to copy the map before returning it.</p>\n"}], "owner": {"reputation": 23, "user_id": 3837906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca954e8e8b02eb044c7b4939bad863f2?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/3837906/andrew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 447, "favorite_count": 1, "accepted_answer_id": 54059427, "answer_count": 2, "score": 0, "last_activity_date": 1546895192, "creation_date": 1546721326, "question_id": 54056119, "link": "https://stackoverflow.com/questions/54056119/how-to-lock-map-and-fix-data-race", "title": "How to lock Map and fix data race", "body": "<p>I'm trying to solve WARNING: DATA RACE\nhere is the code:</p>\n\n<pre><code>package models\n\nimport (\n  \"sync\"\n  \"time\"\n)\ntype Stats struct {\n    sync.Mutex\n    request map[int64]int\n}\n\nfunc (s *Stats) PutRequest() {\n  s.Lock()\n  s.request[time.Now().Unix()]++\n  s.Unlock()\n}\nfunc (s *Stats) GetRequests() map[int64]int {\n    s.Lock()\n    m := s.request\n    s.Unlock()\n    return m\n }\nvar Requests = Stats{\n    sync.Mutex{},\n    make(map[int64]int),\n}\n</code></pre>\n\n<p>If i change Stats field request into integer then everithing works fine but not with map. How to correctly lock map in Go?</p>\n"}, {"tags": ["go", "cryptography", "ecdsa", "modular-arithmetic"], "comments": [{"owner": {"reputation": 18527, "user_id": 2331445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94bfb49e156193c0509c3a18e0f8923f?s=128&d=identicon&r=PG", "display_name": "Stephan Schlecht", "link": "https://stackoverflow.com/users/2331445/stephan-schlecht"}, "edited": false, "score": 0, "creation_date": 1546717555, "post_id": 54055272, "comment_id": 94945233, "body": "you might want to take a look at this Java implementation: there is a method <code>getY</code>: <a href=\"https://github.com/google/tink/blob/master/java/src/main/java/com/google/crypto/tink/subtle/EllipticCurves.java\" rel=\"nofollow noreferrer\">github.com/google/tink/blob/master/java/src/main/java/com/&hellip;</a>?"}], "answers": [{"comments": [{"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1546744610, "post_id": 54055641, "comment_id": 94950509, "body": "If you are just picking random x&#39;s and plugging them in you must be prepared for the possibility the square root does not exist, and <code>ModSqrt</code> returns nil."}], "tags": [], "owner": {"reputation": 21, "user_id": 10872557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e67b37241e36c04bd320d6b915cf43b2?s=128&d=identicon&r=PG&f=1", "display_name": "CryptoNoob", "link": "https://stackoverflow.com/users/10872557/cryptonoob"}, "is_accepted": true, "score": 1, "last_activity_date": 1546717637, "creation_date": 1546717637, "answer_id": 54055641, "question_id": 54055272, "link": "https://stackoverflow.com/questions/54055272/how-to-calculate-x3-ax-b-mod-p-with-golang-big-int/54055641#54055641", "title": "How to calculate `x^3 + ax + b mod p` with Golang big.Int", "body": "<p>I figured it out, by scouting some code in the <a href=\"https://golang.org/src/crypto/elliptic/elliptic.go?s=2055:2110#L55\" rel=\"nofollow noreferrer\">elliptic lib</a></p>\n\n<pre><code>func GetY(x *big.Int, curve *elliptic.CurveParams) *big.Int {\n\n\n    x3 := new(big.Int).Mul(x, x)\n    x3.Mul(x3, x)\n\n    threeX := new(big.Int).Lsh(x, 1)\n    threeX.Add(threeX, x)\n\n    x3.Sub(x3, threeX)\n    x3.Add(x3, curve.B)\n    x3.Mod(x3, curve.P)\n\n    return x3.ModSqrt(x3, curve.P)\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 10872557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e67b37241e36c04bd320d6b915cf43b2?s=128&d=identicon&r=PG&f=1", "display_name": "CryptoNoob", "link": "https://stackoverflow.com/users/10872557/cryptonoob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 54055641, "answer_count": 1, "score": 1, "last_activity_date": 1546734253, "creation_date": 1546715074, "last_edit_date": 1546734253, "question_id": 54055272, "link": "https://stackoverflow.com/questions/54055272/how-to-calculate-x3-ax-b-mod-p-with-golang-big-int", "title": "How to calculate `x^3 + ax + b mod p` with Golang big.Int", "body": "<p>I'm trying to find the <strong>Y</strong> coordinate for an elliptic point. I understand the formula is <code>y^2\u2261x^3+ax+b mod p</code>.</p>\n\n<p>However I'm unsure of how I would actually program this in Go.</p>\n\n<pre><code>xCubed.Exp(X, 3, nil)\nAX.Mul(A,X)\n\nN.Add(XPow3, AX) // x^3 + ax\nN.Mod(N, P) // mod p\nN.Add(N, B) // (x^3 + ax) + b\nN.Mod(N, P) // mod p\n\nreturn N\n</code></pre>\n\n<p>Where xCubed,X,N,P,B are <code>*big.Int</code> and N represents y^2 </p>\n\n<p>I'm a noob to modular arithmetic, so my assumption mod P is applied to each operation; Is this the correct way to to calculate <code>x^3 + ax + b mod p</code>?</p>\n\n<p>edit: should I have added AX.Mod(p) ? </p>\n"}, {"tags": ["algorithm", "go", "combinations"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1546710121, "post_id": 54054062, "comment_id": 94943252, "body": "Something like <a href=\"https://play.golang.org/p/OBnlflNtJq6\" rel=\"nofollow noreferrer\">this</a>? Or maybe <a href=\"https://play.golang.org/p/OJAMHM3sJNp\" rel=\"nofollow noreferrer\">this</a>? One <a href=\"https://play.golang.org/p/CSRmHELiYOB\" rel=\"nofollow noreferrer\">more</a>."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546788304, "post_id": 54054062, "comment_id": 94958996, "body": "@thst: Wrong. &quot;Here is the broken code.&quot;  Broken code is not accepted on CodeReview."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 7746329, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9adfe0e60febe80152327d5c9420c56b?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew LeFevre", "link": "https://stackoverflow.com/users/7746329/andrew-lefevre"}, "edited": false, "score": 0, "creation_date": 1546726481, "post_id": 54055211, "comment_id": 94947541, "body": "Both versions work great, but the size of my input slice is around 60, and when called with a depth of 6+, it takes forever to complete. I realize your solutions above are a faithful representation of the algo from Java I mentioned, but is there anything I could do to make it more efficient? You said that using an &#39;iterator&#39; function, how would I implement that?"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 81, "user_id": 7746329, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9adfe0e60febe80152327d5c9420c56b?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew LeFevre", "link": "https://stackoverflow.com/users/7746329/andrew-lefevre"}, "edited": false, "score": 0, "creation_date": 1546729329, "post_id": 54055211, "comment_id": 94948176, "body": "@andrew: I did warn you :-) I&#39;m a bit surprised it takes forever; I would have guessed about a minute, given that C(60, 6) is about 50 million. That would take a bit more than a gigabyte of memory; perhaps that&#39;s a lot for your system. Anyway, you can probably find a good tutorial on writing golang iterators with a web search for that phrase."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 81, "user_id": 7746329, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9adfe0e60febe80152327d5c9420c56b?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew LeFevre", "link": "https://stackoverflow.com/users/7746329/andrew-lefevre"}, "edited": false, "score": 0, "creation_date": 1546729370, "post_id": 54055211, "comment_id": 94948185, "body": "Sorry I can&#39;t expand more on the theme but I&#39;m not at home at it&#39;s a broad question."}, {"owner": {"reputation": 81, "user_id": 7746329, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9adfe0e60febe80152327d5c9420c56b?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew LeFevre", "link": "https://stackoverflow.com/users/7746329/andrew-lefevre"}, "edited": false, "score": 0, "creation_date": 1546734395, "post_id": 54055211, "comment_id": 94949074, "body": "Yep you did warn me :) I was ignorant of how one would correctly solve combinatoric problem. I&#39;ll look into that, thanks for your detailed answer!"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 81, "user_id": 7746329, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9adfe0e60febe80152327d5c9420c56b?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew LeFevre", "link": "https://stackoverflow.com/users/7746329/andrew-lefevre"}, "edited": false, "score": 0, "creation_date": 1546818191, "post_id": 54055211, "comment_id": 94967249, "body": "@andrew: Sorry about all the typos in the original code. Nice of you not to mention them :) I think I&#39;ve fixed them now. Yesterday, I didn&#39;t have anywhere to test the code, so it&#39;s a bit of a relief that it worked (after fixing the typos)."}], "tags": [], "owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "is_accepted": true, "score": 1, "last_activity_date": 1546818131, "last_edit_date": 1546818131, "creation_date": 1546714571, "answer_id": 54055211, "question_id": 54054062, "link": "https://stackoverflow.com/questions/54054062/algorithm-to-generate-k-elements-from-slice-of-n-elements/54055211#54055211", "title": "Algorithm to Generate K elements from slice of N elements", "body": "<p><strong>Note:</strong></p>\n\n<p>The correct answer to any combinatoric problem is practically never to put all possibly combinations into a container and process them afterwards. There are typically an enormous number of combinations and the temporary container tends to use up all available memory for items which are only going to be referenced once. The original Java program buries the processing step (in this case, \"print the combination\") deep inside the generation function, which is also practically never a good solution because it requires creating an entire new generator function for every different action.</p>\n\n<p>One way to structure combinatorial generation is to use a function which finds the next combination, given the previous one. Such a function is typically called an \"iterator\". If the last combination is provided, the function returns a return value indicating that there are no more combinations available. Often, the provided combination is modified \"in-place\", so that the return value is just a boolean indicating whether the combination was the last one or not. (It's usually considered best practice to reset the supplied combination to the first combination as well as reporting that it was previously the last combination.) That strategy doesn't work well with recursive algorithms such as the one you are porting.</p>\n\n<p>Many languages include some facility which allows recursive generation of possible values. For example, in Go you can write an iterator as a \"go routine\". That can produce really elegant code, although there is an underlying cost.</p>\n\n<p>It is always possible to reimplement a recursive function as an iterative one, by simulating the call stack with some kind of stack datastructure; however, the result is harder to understand and often slower (because native recursion is almost always faster than simulated recursion). And you might be able to find a non-recursive algorithm for iterating (possibly changing the iteration order).</p>\n\n<p>I'm not going to do any of those things, here, though. The following simply satisfies the same prototype as the original code, returning a (possibly enormous) slice of results, because the underlying issue is simply a question of design of recursive functions.</p>\n\n<hr>\n\n<p>The prototype of the internal recursive generator is</p>\n\n<pre><code>func GetCombos2(set []string,\n                depth int, start int,\n                element []string,\n                results []string) []string\n</code></pre>\n\n<p>(I added the type of <code>element</code>, for clarity.) It's useful to try to articulate what this function does, exactly, which might go something like this:</p>\n\n<blockquote>\n  <p>Given a list of items <code>set</code>, a partial combination <code>element</code> which still requires <code>depth</code> items to be appended to it, and a list of combinations <code>results</code>, return <code>results</code> appended with the possible combinations starting with the prefix indicated by <code>element</code> whose continuations only contain items whose index is greater than equal to <code>start</code>. Combinations are generated in monotonically increasing index order, and it is required that all items in the prefix have indices less than <code>start</code>.</p>\n</blockquote>\n\n<p>That's a bit of a mouthful, and I'm not sure that reading it is immediately clearer than the code. But it is possibly helpful as a way of understanding what is going on. Here, I'm just going to focus on one small part:</p>\n\n<blockquote>\n  <p>Given&hellip; <code>results</code>, &hellip; return <code>results</code> appended with&hellip; [the new combinations computed with these arguments]</p>\n</blockquote>\n\n<p>That's not the only possible way of writing this recursion. Another way would be to not require <code>results</code> as an argument, and to simply return the list of combinations generated according to the other arguments. That would produce slightly simpler code but it could be quite a bit slower because of the number of slices of partial results generated and immediately discarded. The use of \"accumulator\" arguments like <code>results</code> is a common technique for making recursion more efficient.</p>\n\n<p>What's important about this discussion is understanding what the return value of the recursive function is. If you use the \"accumulator\" strategy (with the <code>results</code> argument) then the return value is the entire list of results found up to this point, and you only append to it if you are adding a new result. If you use the non-accumulator strategy, then when you find a new result you return it immediately, leaving it to the caller to concatenate the various lists it receives from multiple calls.</p>\n\n<p>So the two strategies would look like this:</p>\n\n<p>Accumulator version:</p>\n\n<pre><code>func GetCombos2(set []string, depth int, start int, element []string, results []string) []string {\n    if depth == 0 {\n        results = append(results, strings.Join(element, \"\")) \n    } else {\n        for i := start; i &lt;= len(set) - depth; i++ {\n            element[len(element) - depth] = set[i]\n            results = GetEnvCombos2(set, depth - 1, i + 1, element, results)\n        }\n    }\n    return results\n}\n</code></pre>\n\n<p>Non-accumulator version:</p>\n\n<pre><code>func GetCombos2(set []string, depth int, start int, element []string) []string {\n    if depth == 0 {\n        return []string { strings.Join(element, \"\") }\n    } else {\n        var results []string\n        for i := start; i &lt;= len(set) - depth; i++ {\n            element[len(element) - depth] = set[i]\n            results = append(results, GetCombos2(set, depth - 1, i + 1, element)...)\n        }\n        return results\n    }\n}\n</code></pre>\n\n<p><strong>EDIT</strong>: After writing that, I realised that the use of the string array <code>elements</code> is really a Java-ism which doesn't translate well to Go. (Or perhaps it's a C-ism badly translated to Java.) Anyway, the functions are slightly faster and quite a bit easier to read if we just pass a <code>string</code> representing the prefix so that we don't need to do the <code>Join</code>. (Go strings are immutable, so there's no need to copy them before putting them into the results slice.)</p>\n\n<p>That reduces the code to the following:</p>\n\n<p>Accumulator version (recommended, but an iterator would be even better):</p>\n\n<pre><code>func GetCombos(set []string, depth int) []string {\n    return GetCombosHelper(set, depth, 0, \"\", []string{})\n}\n\nfunc GetCombosHelper(set []string, depth int, start int, prefix string, accum []string) []string {\n    if depth == 0 {\n        return append(accum, prefix)\n    } else {\n        for i := start; i &lt;= len(set) - depth; i++ {\n            accum = GetCombosHelper(set, depth - 1, i + 1, prefix + set[i], accum)\n        }\n        return accum\n    }\n}\n</code></pre>\n\n<p>Non-accumulator version:</p>\n\n<pre><code>func GetCombos(set []string, depth int) []string {\n    return GetCombosHelper(set, depth, 0, \"\")\n}\n\nfunc GetCombosHelper(set []string, depth int, start int, prefix string) []string {\n    if depth == 0 {\n        return []string{prefix}\n    } else {\n        accum := []string{}\n        for i := start; i &lt;= len(set) - depth; i++ {\n            accum = append(accum, GetCombosHelper(set, depth - 1, i + 1, prefix + set[i])...)\n        }\n        return accum\n    }\n}\n</code></pre>\n\n<p>On my laptop, given a set of 62 elements (upper and lower case letters plus digits) with depth 6, the non-accumulator version took 29.7 seconds (elapsed) and the accumulator version took 13.4 seconds. Both used about 4.5 gigabytes of memory, which seemed a bit high to me since there are \"only\" 61,474,519 six-character combinations, and the memory consumption works out to almost 80 bytes peak memory usage per combination.</p>\n"}], "owner": {"reputation": 81, "user_id": 7746329, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9adfe0e60febe80152327d5c9420c56b?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew LeFevre", "link": "https://stackoverflow.com/users/7746329/andrew-lefevre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 54055211, "answer_count": 1, "score": 0, "last_activity_date": 1546818131, "creation_date": 1546706898, "last_edit_date": 1546707875, "question_id": 54054062, "link": "https://stackoverflow.com/questions/54054062/algorithm-to-generate-k-elements-from-slice-of-n-elements", "title": "Algorithm to Generate K elements from slice of N elements", "body": "<p>I'm trying to port an algorithm from <a href=\"https://stackoverflow.com/questions/127704/algorithm-to-return-all-combinations-of-k-elements-from-n\">this Stackoverflow question</a> in Go. The algorithm I'm trying to get working is as follows: given a slice of strings of an arbitrary length, and a \"depth\", find all the combinations of the elements in the original slice that are of length depth. For example, if given a slice containing A, B, C, D, E, and F, and a depth of 3, the result should be:</p>\n\n<pre><code>[A, B, C]\n[A, B, D]\n[A, B, E]\n[A, B, F]\n[A, C, D]\n[A, C, E]\n[A, C, F]\n[A, D, E]\n[A, D, F]\n[A, E, F]\n[B, C, D]\n[B, C, E]\n[B, C, F]\n[B, D, E]\n[B, D, F]\n[B, E, F]\n[C, D, E]\n[C, D, F]\n[C, E, F]\n[D, E, F]\n</code></pre>\n\n<p>I've tried to implement a few of the proposed solutions in the above post in Go, but unfortunately my Go skills aren't quite up to snuff yet. I've only started programming in Go a few weeks ago.</p>\n\n<p>Here is the broken code that was a failed attempt to port <a href=\"https://stackoverflow.com/a/16256122/7746329\">this implementation in Java</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    combos := []string{\"A\",\"B\",\"C\",\"D\",\"E\",\"F\"}\n    combos = GetCombos(combos, 3)\n\n    fmt.Println(combos)\n}\n\nfunc GetCombos(set []string, depth int) []string {\n    var results []string\n    element := make([]string, depth)\n    return GetEnvCombos2(set, depth, 0, element, results)\n}\n\nfunc GetCombos2(set []string, depth int, start int, element, results []string) []string {\n    if depth == 0 {\n        var guess string\n        for _, e := range element {\n            guess += e\n        }\n        results = append(results, guess)\n        return results\n    }\n    for i := start; i &lt;= len(set) - depth; i++ {\n        element[len(element) - depth] = set[i]\n        results = append(results, GetEnvCombos2(set, depth - 1, i + 1, element, results)...)\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>I don't know if that implementation in Java is the most efficient way to do it, but it seemed fairly efficient and (I thought) relatively easy to port to Go. If there's a totally different, yet more efficient way to do this, I'd gladly accept that.</p>\n"}, {"tags": ["go", "cookies", "gorilla", "mux"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546708088, "post_id": 54053890, "comment_id": 94942720, "body": "I&#39;m not exactly sure what you&#39;re expecting. Why do you believe the cookie is expired? And where do you expect your code to reject expired cookies?  I don&#39;t actually see cookies being used at all in your code."}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546708320, "post_id": 54053890, "comment_id": 94942802, "body": "` if auth, ok := session.Values[&quot;authenticated&quot;].(bool); !ok || !auth ` (in loggedInOnly func) this should be false after handleLogout is called, but if a faulty client access the page using an expired session cookie it can still access it, the session cookie is create in handleLogin func."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546708388, "post_id": 54053890, "comment_id": 94942816, "body": "You haven&#39;t answered my questions. 1. Why do you believe the cookie is expired?  2. Where does your code check for expired cookies?"}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546708765, "post_id": 54053890, "comment_id": 94942909, "body": "I thought         <code>session.Options.MaxAge = -1</code> does make the cookie expire"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546709291, "post_id": 54053890, "comment_id": 94943026, "body": "Setting a cookie&#39;s max age to -1 tells the client to expire it immediately, yes. But, as you&#39;ve said, that&#39;s irrelevant, since your &quot;faulty client&quot; isn&#39;t expiring the cookie. Which means the cookie still has <i>some other</i> MaxAge value... why do you think <i>that cookie</i> is expired?  And where is your code checking for expired cookies?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546709313, "post_id": 54053890, "comment_id": 94943034, "body": "Simply trusting a client to do what it&#39;s told is not secure--and you seem to be expecting your server to do some security checks. <b>Where are these checks?</b>"}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546710410, "post_id": 54053890, "comment_id": 94943322, "body": "That&#39;s my point, I thought it was handled internally gorilla&#39;s session, I didnt do those checks because I didn&#39;t know they had to be done."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1546724502, "post_id": 54053890, "comment_id": 94947115, "body": "@ThunderCat, one of gorilla&#39;s default session storage <a href=\"https://godoc.org/github.com/gorilla/sessions#CookieStore\" rel=\"nofollow noreferrer\">uses browser cookies</a>, which presumably the OP uses. mrclx, you cannot rely on that cookie. Even if you change it&#39;s contents by modifying the session, clients can still replay old versions of the cookie. Even honest clients can do that, because they never saw the response with the updated value (because the train just entered a tunnel)."}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "edited": false, "score": 0, "creation_date": 1546746618, "post_id": 54053890, "comment_id": 94950742, "body": "Ok, so how do I remove that cookie from the CookieStore? This is what I&#39;d like to know... Or how to make it impossible to replay the Cookie? Because if I restart the server if  I try to replay the cookie I cannot ( because I guess it is not inside the cookieStore), but once the cookie is set it can be replayed despite setting MaxAge to zero. From google I cannot seem to find any solution. I just want to make that cookie unusable or remove it. I can perhaps save it in a slice and range over this slice to look for invalid each time loggedInOnly is called. But I guess removing it would be better."}], "owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 117, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1546708011, "creation_date": 1546705549, "last_edit_date": 1546708011, "question_id": 54053890, "link": "https://stackoverflow.com/questions/54053890/golang-webservers-accept-cookies-despite-them-being-expired", "title": "golang webservers accept cookies despite them being expired", "body": "<p>So I was writing a backend using Go, and while I was testing the login/logout function I noticed that if I try to access a page with an expired cookie I'm allowed to do so. This happens only if I use a faulty client, because if I use my browser it works correctly, which I guess means that the cookie is deleted from the web-browser but not from my back-end.</p>\n\n<p>I've tested different solutions, but nothing seems to work, what I've noticed is this: I've taken note of the pointer of the map which maps the cookies and I've noticed that despite setting \"authenticated\" value to false when the faulty client tries to access the page the map has its value set to true.</p>\n\n<p>this is the middle ware that handles pages in which the user should be logged in and this should block the faulty client from logging in because \"authenticated\" value from session-handler should be false ( but it is true, despite being set to false before )</p>\n\n<pre><code>func (s *server) loggedInOnly(handlerFunc http.HandlerFunc) http.HandlerFunc {\n\n    return func(writer http.ResponseWriter, request *http.Request) {\n        session, _ := s.store.Get(request, \"session-handler\")\n        log.Printf(\"loggedInOnly: %p %v\", &amp;session.Values, session.Values)\n        if auth, ok := session.Values[\"authenticated\"].(bool); !ok || !auth {\n            http.Error(writer, \"Forbidden\", http.StatusForbidden)\n            return\n        }\n        handlerFunc(writer, request)\n    }\n\n}\n</code></pre>\n\n<p>this is the logout function which should delete the cookie ( but it doesn't delete it internally )</p>\n\n<pre><code>func (s *server) handleLogout() http.HandlerFunc {\n\n    return func(writer http.ResponseWriter, request *http.Request) {\n        session, _ := s.store.Get(request, \"session-handler\")\n        session.Values[\"authenticated\"] = false\n        session.Options.MaxAge = -1\n        session.Save(request, writer)\n        log.Printf(\"logout: %p, %v\", &amp;session.Values, session.Values)\n        fmt.Fprint(writer, \"Succesfully logged out\")\n        log.Printf(\"%v was logged out\", writer)\n    }\n\n}\n</code></pre>\n\n<p>and this is the login function</p>\n\n<pre><code>func (s *server) handleLogin() http.HandlerFunc {\n\n    return func(writer http.ResponseWriter, request *http.Request) {\n        log.Printf(\"handle login called\")\n        session, _ := s.store.Get(request, \"session-handler\")\n\n        // can login or not\n\n        session.Values[\"authenticated\"] = true\n        session.Save(request, writer)\n\n        Success(writer, \"successfully logged in\")\n    }\n\n}\n</code></pre>\n\n<p>I should expect the cookie to be invalid from my webserver so that when the faulty client tries to reconnect authenticated is set to false and he shouldn't be able to access loggedInOnly pages, instead I he can because authenticated value is set to true ( despite being set to false right before ).</p>\n\n<p>these are the logs:</p>\n\n<pre><code>2019/01/05 17:00:00 loggedInOnly: 0xc0421960b0 map[authenticated:true]\n2019/01/05 17:00:00 logout: 0xc0421960b0, map[authenticated:false]\n2019/01/05 17:00:01 loggedInOnly: 0xc0420a4560 map[authenticated:true]\n2019/01/05 17:00:01 logout: 0xc0420a4560, map[authenticated:false]\n</code></pre>\n\n<p>as you can see \"authenticated\" is set before to false then immediatly after it is true despite nothing happening in between</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1546700663, "post_id": 54053219, "comment_id": 94940702, "body": "Please export your fields, and don&#39;t ignore errors."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546700750, "post_id": 54053219, "comment_id": 94940726, "body": "<a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Exported_identifiers</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546702009, "post_id": 54053219, "comment_id": 94941057, "body": "This is an obvious duplicate. We get about 3 of these per week. There&#39;s no reason to leave them all open."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1546702603, "post_id": 54053219, "comment_id": 94941234, "body": "It&#39;s also worth noting that having multiple duplicates does <i>not</i> make the question harder to discover. This question still exists... and now points to the duplicate, so your concern that newcomers would benefit by finding this question is <i>not</i> a reason not to mark as duplicate."}], "answers": [{"tags": [], "owner": {"reputation": 28, "user_id": 6108452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6d9db9f64a8f90a25e770c7577ff78d?s=128&d=identicon&r=PG&f=1", "display_name": "Leo", "link": "https://stackoverflow.com/users/6108452/leo"}, "is_accepted": true, "score": 1, "last_activity_date": 1546702057, "creation_date": 1546702057, "answer_id": 54053425, "question_id": 54053219, "link": "https://stackoverflow.com/questions/54053219/post-call-failing-with-json/54053425#54053425", "title": "POST call failing with JSON", "body": "<p>Your code has several issues:\n1. Structure must have public fields and fields should be tagged. Then it will be serialized properly:</p>\n\n<pre><code>type Student struct {\n    Firstname string `json:\"firstname\"`\n    Surname   string `json: \"surname\"`\n    Age       int .  `json: \"age\"`\n    Group     string `json: \"group\"`\n}\n</code></pre>\n\n<p>2. Never ignore errors returned by method call. So you will not miss issues in your code:</p>\n\n<pre><code>b, err := json.Marshal(student)\nif err != nil {\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>And the same after calls of <code>NewRequest</code> and <code>DefaultClient.Do</code></p>\n"}], "owner": {"reputation": 163, "user_id": 4805558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92ca629ce65dd6fe18aaf2e96510fd9f?s=128&d=identicon&r=PG&f=1", "display_name": "pep8", "link": "https://stackoverflow.com/users/4805558/pep8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "closed_date": 1546702065, "accepted_answer_id": 54053425, "answer_count": 1, "score": -2, "last_activity_date": 1546702057, "creation_date": 1546700543, "last_edit_date": 1546701954, "question_id": 54053219, "link": "https://stackoverflow.com/questions/54053219/post-call-failing-with-json", "closed_reason": "Duplicate", "title": "POST call failing with JSON", "body": "<p>I have an API which accepts a request body like this:</p>\n\n<p>The content-type is application/json.</p>\n\n<pre><code>{\n  \"firstname\": \"foo\",\n  \"surname\": \"bar\",\n  \"age\": 10,\n  \"group\":\"test\"\n}\n</code></pre>\n\n<p>The request goes through when I use a client like Postman.</p>\n\n<p>However, the same request fails from Go:</p>\n\n<pre><code>    type Student struct {\n        firstname string\n        surname   string\n        age       int\n        group     string\n    }\n    student:= Student{\"foo\", \"bar\", 10, \"test\"}\n    b, err := json.Marshal(student)\n\n    rest := restCall(\"POST\", \"http://api\", b, \"xyz123\")\n\n    func restCall(method string, url string, body []byte, token string)  {\n\n        req, _ := http.NewRequest(method, url, bytes.NewReader(body))\n\n        req.Header.Add(\"Authorization\", token)\n        req.Header.Add(\"content-type\", \"application/json\")\n\n        res, _ := http.DefaultClient.Do(req)\n\n        defer res.Body.Close()\n    }\n</code></pre>\n\n<p>I get an internal HTTP 500 error stating :</p>\n\n<p>Mandatory parameter 'group' is missing.</p>\n\n<p>But, I did pass it as you can see from my code.</p>\n"}, {"tags": ["validation", "go", "unicode"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1546688972, "post_id": 54051251, "comment_id": 94937777, "body": "Your question is &quot;what approach could I use to check that password complexity rules are followed when changing a password?&quot;  The code you suggest in the play ground link looks OK"}], "answers": [{"tags": [], "owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "is_accepted": true, "score": -2, "last_activity_date": 1546690865, "creation_date": 1546690865, "answer_id": 54051952, "question_id": 54051251, "link": "https://stackoverflow.com/questions/54051251/using-the-unicode-package-for-validation-in-go/54051952#54051952", "title": "Using the unicode package for validation in Go?", "body": "<p>I wouldn't say that regex is expensive and should be avoided if possible. It is the best tool for your case. Although there is nothing wrong to use unicode package for password validation, it might be more readable for other programmers to just use single regexp, where you can write all your password requirements into a single regular expression. </p>\n\n<p><strong>Ad regex performance:</strong>\nYou can read about golang regex implementation's performance <a href=\"https://www.reddit.com/r/golang/comments/84o986/why_is_gos_regex_so_slow/?st=jqjflcab&amp;sh=404402c2\" rel=\"nofollow noreferrer\">here</a>. I wouldn't care about it unless you're implementing a very critical performance heavy tool where you can especially measure that regex slows your program down.</p>\n"}], "owner": {"reputation": 11, "user_id": 10558336, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-C6lIS43gHh8/AAAAAAAAAAI/AAAAAAAAAlw/-hHKzsrFBlw/photo.jpg?sz=128", "display_name": "Anthony Cook", "link": "https://stackoverflow.com/users/10558336/anthony-cook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 54051952, "answer_count": 1, "score": 0, "last_activity_date": 1546690865, "creation_date": 1546685486, "question_id": 54051251, "link": "https://stackoverflow.com/questions/54051251/using-the-unicode-package-for-validation-in-go", "title": "Using the unicode package for validation in Go?", "body": "<p>The unicode package in Go provides functions such as unicode.IsDigit and unicode.IsUpper. Are these safe to use for form input validation, password validation in particular?</p>\n\n<p>How would you approach form validation in Go without using a third party package? From what I can gather regex is expensive and should be avoided if possible, is this a viable solution?</p>\n\n<p>Here's an example using the unicode package: </p>\n\n<p><a href=\"https://play.golang.org/p/6XLSqPim54E\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6XLSqPim54E</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1546672748, "post_id": 54049731, "comment_id": 94934479, "body": "It&#39;s called the &quot;comma ok&quot; idiom. It is supported by a couple expressions in Go, like map indexing, type assertions and channel receives. These expressions return either a single value or two values where the second is the ok flag indicating success or failure. For these expressions to return the two values they need to be on the right hand side of an assignment expression (<code>=</code>/<code>:=</code>) and on the left hand side of that expression two variables must be specified."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1546672841, "post_id": 54049731, "comment_id": 94934493, "body": "<a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">Go here</a> and CTRL/CMD+F for the string <code>, ok</code>. The name &quot;comma ok&quot; can be found <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">here</a> (again use CTRL/CMD+F)."}, {"owner": {"reputation": 1144, "user_id": 4242675, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a1449c823c2e7fc1cd129fbbb390ec63?s=128&d=identicon&r=PG&f=1", "display_name": "Nag", "link": "https://stackoverflow.com/users/4242675/nag"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546673619, "post_id": 54049731, "comment_id": 94934615, "body": "Thanks @mkopriva. How the expression knows that it has to return a single value or multiple values ? Is it inferred on the variables mentioned on the left hand side ? - (kind of method overloading )"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546673924, "post_id": 54049731, "comment_id": 94934656, "body": "Yes it is inferred by the compiler from the number of variables on the left hand side."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1546673681, "last_edit_date": 1546673681, "creation_date": 1546673278, "answer_id": 54049916, "question_id": 54049731, "link": "https://stackoverflow.com/questions/54049731/how-to-explain-this-map-syntax/54049916#54049916", "title": "How to explain this map syntax?", "body": "<blockquote>\n  <p>How could I decipher this syntax?</p>\n</blockquote>\n\n<p>Read the definition of the syntax. </p>\n\n<p>A primary expression of the form</p>\n\n<pre><code>a[x]\n</code></pre>\n\n<p>denotes the element of the map a indexed by x. The value x is called the index or map key. </p>\n\n<p>There is a special form of an index expression on a map.</p>\n\n<pre><code>v, ok = a[x]\nv, ok := a[x]\nvar v, ok = a[x]\n</code></pre>\n\n<p>yields an additional untyped boolean value. The value of ok is true if the key x is present in the map, and false otherwise.</p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">Index expressions</a></p>\n  \n  <p>A primary expression of the form</p>\n\n<pre><code>a[x]\n</code></pre>\n  \n  <p>denotes the element of the array, pointer to array, slice, string or\n  map a indexed by x. The value x is called the index or map key,\n  respectively. </p>\n  \n  <p>For a of map type M:</p>\n  \n  <ul>\n  <li><p>x's type must be assignable to the key type of M</p></li>\n  <li><p>if the map contains an entry with key x, a[x] is the map element with key x and the type of a[x] is the element type of M</p></li>\n  <li><p>if the map is nil or does not contain such an entry, a[x] is the zero value for the element type of M</p></li>\n  </ul>\n  \n  <p>Otherwise a[x] is illegal.</p>\n  \n  <p>An index expression on a map a of type map[K]V used in an assignment\n  or initialization of the special form</p>\n\n<pre><code>v, ok = a[x]\nv, ok := a[x]\nvar v, ok = a[x]\n</code></pre>\n  \n  <p>yields an additional untyped boolean value. The value of ok is true if\n  the key x is present in the map, and false otherwise.</p>\n</blockquote>\n\n<hr>\n"}], "owner": {"reputation": 1144, "user_id": 4242675, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a1449c823c2e7fc1cd129fbbb390ec63?s=128&d=identicon&r=PG&f=1", "display_name": "Nag", "link": "https://stackoverflow.com/users/4242675/nag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 1, "accepted_answer_id": 54049916, "answer_count": 1, "score": -2, "last_activity_date": 1546679786, "creation_date": 1546671360, "last_edit_date": 1546679786, "question_id": 54049731, "link": "https://stackoverflow.com/questions/54049731/how-to-explain-this-map-syntax", "title": "How to explain this map syntax?", "body": "<p>I am going through the following Go Lang Map data structure. I am little confused with the syntax - </p>\n\n<pre><code>//this is fine\ncountryCapitalMap = make(map[string]string)\n/* insert key-value pairs in the map*/\ncountryCapitalMap[\"France\"] = \"Paris\"\ncapital, ok := countryCapitalMap[\"United States\"]\n\n/* print map using keys*/\nfor country := range countryCapitalMap {\n    fmt.Println(\"Capital of\", country, \"is\", countryCapitalMap[country])\n}\n</code></pre>\n\n<p>Is it that the countryCapitalMap[\"United States\"] returns two return values from the following line</p>\n\n<pre><code>capital, ok := countryCapitalMap[\"United States\"]\n</code></pre>\n\n<p>Or countryCapitalMap[country] returns single value from the following line</p>\n\n<pre><code>fmt.Println(\"Capital of\", country, \"is\", countryCapitalMap[country])\n</code></pre>\n\n<p>How could I decipher this syntax? Is it based on <em>where and which statement</em> the expression is used with?</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 3395, "user_id": 10409167, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blZR5.jpg?s=128&g=1", "display_name": "Arcteezy", "link": "https://stackoverflow.com/users/10409167/arcteezy"}, "edited": false, "score": 1, "creation_date": 1546663659, "post_id": 54049017, "comment_id": 94933225, "body": "Can you provide the structure of the JSON?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 5, "creation_date": 1546664354, "post_id": 54049017, "comment_id": 94933321, "body": "You need to export the fields."}, {"owner": {"reputation": 2535, "user_id": 1760720, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2725d511128304107f17561e03888cdb?s=128&d=identicon&r=PG", "display_name": "Brian Yeh", "link": "https://stackoverflow.com/users/1760720/brian-yeh"}, "reply_to_user": {"reputation": 3395, "user_id": 10409167, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blZR5.jpg?s=128&g=1", "display_name": "Arcteezy", "link": "https://stackoverflow.com/users/10409167/arcteezy"}, "edited": false, "score": 0, "creation_date": 1546665049, "post_id": 54049017, "comment_id": 94933417, "body": "@Arcteezy the structure of the JSON is shown in the example. It is an Object of objects. The root Object has variable keys. The subObject has &quot;title&quot; &quot;story&quot; and &quot;options&quot; as keys. &quot;title&quot; and &quot;story&quot; have strings as values while &quot;options&quot; contains a variable sized List of Objects with &quot;text&quot; and &quot;arc&quot; as keys. Both &quot;text&quot; and &quot;arc&quot; have strings as values."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1546668905, "post_id": 54049017, "comment_id": 94933959, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28228393/json-unmarshal-returning-blank-structure\">json.Unmarshal returning blank structure</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1546676886, "post_id": 54049017, "comment_id": 94935105, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28228393/json-unmarshal-returning-blank-structure\">json.Unmarshal returning blank structure</a>"}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1546760164, "post_id": 54049017, "comment_id": 94952607, "body": "Supply a valid json please and example of the expected map. m[&quot;intro&quot;]= Context{} ?"}], "answers": [{"comments": [{"owner": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "edited": false, "score": 3, "creation_date": 1546664578, "post_id": 54049113, "comment_id": 94933352, "body": "The key here is that he capitalized the struct fields. Fields targetted for marshalling must be exported."}, {"owner": {"reputation": 2535, "user_id": 1760720, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2725d511128304107f17561e03888cdb?s=128&d=identicon&r=PG", "display_name": "Brian Yeh", "link": "https://stackoverflow.com/users/1760720/brian-yeh"}, "reply_to_user": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "edited": false, "score": 0, "creation_date": 1546665115, "post_id": 54049113, "comment_id": 94933426, "body": "@saarrrr why does capitalizing the fields change things? What do you mean the fields must be exported?"}, {"owner": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "reply_to_user": {"reputation": 2535, "user_id": 1760720, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2725d511128304107f17561e03888cdb?s=128&d=identicon&r=PG", "display_name": "Brian Yeh", "link": "https://stackoverflow.com/users/1760720/brian-yeh"}, "edited": false, "score": 3, "creation_date": 1546665551, "post_id": 54049113, "comment_id": 94933477, "body": "@BrianYeh Go uses capitalization to control field/struct export status in a package. Only exported structs and fields are visible to other packages, including the <code>encoding&#47;json</code> package. So you must capitalize the field names of the structs to export those fields so the Marshal func can see them."}], "tags": [], "owner": {"reputation": 3395, "user_id": 10409167, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blZR5.jpg?s=128&g=1", "display_name": "Arcteezy", "link": "https://stackoverflow.com/users/10409167/arcteezy"}, "is_accepted": true, "score": 5, "last_activity_date": 1546664750, "last_edit_date": 1546664750, "creation_date": 1546664352, "answer_id": 54049113, "question_id": 54049017, "link": "https://stackoverflow.com/questions/54049017/unmarshalling-json-in-golang/54049113#54049113", "title": "Unmarshalling json in golang", "body": "<p>For marshalling and unmarshalling, fields must be exported.</p>\n\n<pre><code>    type Context struct {\n        Title   string   `json:\"title\"`\n        Story   string   `json:\"story\"`\n        Options []Option `json:\"options\"`\n    }\n\n    type Option struct {\n        Text string `json:\"text`\n        Arc  string `json:\"arc\"`\n    }\n</code></pre>\n"}], "owner": {"reputation": 2535, "user_id": 1760720, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2725d511128304107f17561e03888cdb?s=128&d=identicon&r=PG", "display_name": "Brian Yeh", "link": "https://stackoverflow.com/users/1760720/brian-yeh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 399, "favorite_count": 0, "accepted_answer_id": 54049113, "answer_count": 1, "score": -1, "last_activity_date": 1546705662, "creation_date": 1546663056, "last_edit_date": 1546705662, "question_id": 54049017, "link": "https://stackoverflow.com/questions/54049017/unmarshalling-json-in-golang", "title": "Unmarshalling json in golang", "body": "<p>golang beginner here. </p>\n\n<p>I want to unmarshall some JSON shown here:</p>\n\n<pre><code> {\n  \"intro\": {\n    \"title\": \"The Little Blue Gopher\",\n    \"story\": [\n      \"Once upon a time, long long ago, there was a little blue gopher. Our little blue friend wanted to go on an adventure, but he wasn't sure where to go. Will you go on an adventure with him?\",\n      \"One of his friends once recommended going to New York to make friends at this mysterious thing called \\\"GothamGo\\\". It is supposed to be a big event with free swag and if there is one thing gophers love it is free trinkets. Unfortunately, the gopher once heard a campfire story about some bad fellas named the Sticky Bandits who also live in New York. In the stories these guys would rob toy stores and terrorize young boys, and it sounded pretty scary.\",\n      \"On the other hand, he has always heard great things about Denver. Great ski slopes, a bad hockey team with cheap tickets, and he even heard they have a conference exclusively for gophers like himself. Maybe Denver would be a safer place to visit.\"\n    ],\n    \"options\": [\n      {\n        \"text\": \"That story about the Sticky Bandits isn't real, it is from Home Alone 2! Let's head to New York.\",\n        \"arc\": \"new-york\"\n      },\n      {\n        \"text\": \"Gee, those bandits sound pretty real to me. Let's play it safe and try our luck in Denver.\",\n        \"arc\": \"denver\"\n      }\n    ]\n  },...}\n</code></pre>\n\n<p>Into a map[string]Context.</p>\n\n<p>Here are the relevant definitions:</p>\n\n<pre><code>type Context struct {\n    title   string\n    story   string \n    options *[]Option\n}\n\ntype Option struct {\n    text string\n    arc  string\n}\n</code></pre>\n\n<p>The unmarshall runs without error however \nI get a map[intro] with the Context struct that has everything initialized to nils or empty strings. </p>\n\n<p>What is the correct way of doing this? The documentation and examples are just really hard to parse for specific use cases. </p>\n\n<p>edit:\nThere is another question that is a possible duplicate but this question is a little different as it requires string tags to be introduced in order to work correctly. </p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 551, "user_id": 10554768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0874152f77551e2be38904d25e5822e?s=128&d=identicon&r=PG&f=1", "display_name": "robert", "link": "https://stackoverflow.com/users/10554768/robert"}, "edited": false, "score": 0, "creation_date": 1546662791, "post_id": 54048930, "comment_id": 94933129, "body": "Check your function arguments, you ask for a []chan string, which is a slice of channels, not a chan []string."}, {"owner": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "reply_to_user": {"reputation": 551, "user_id": 10554768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0874152f77551e2be38904d25e5822e?s=128&d=identicon&r=PG&f=1", "display_name": "robert", "link": "https://stackoverflow.com/users/10554768/robert"}, "edited": false, "score": 0, "creation_date": 1546664962, "post_id": 54048930, "comment_id": 94933404, "body": "Yes I messed up lol."}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "edited": false, "score": 0, "creation_date": 1546664847, "post_id": 54048994, "comment_id": 94933389, "body": "Thanks... but now: invalid operation: &lt;-channel.cSlice (receive from non-chan type []chan string) .. you can&#39;t send a slice of chan?"}, {"owner": {"reputation": 551, "user_id": 10554768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0874152f77551e2be38904d25e5822e?s=128&d=identicon&r=PG&f=1", "display_name": "robert", "link": "https://stackoverflow.com/users/10554768/robert"}, "reply_to_user": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "edited": false, "score": 0, "creation_date": 1546665090, "post_id": 54048994, "comment_id": 94933423, "body": "@user10032371 &lt;- channel.cSlice is not sending anything, it is receiving. I believe the error is occuring because channel.cSlice is a slice of chan&#39;s, while, of course, you can only receive from one channel, not a slice of them."}, {"owner": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "edited": false, "score": 0, "creation_date": 1546666391, "post_id": 54048994, "comment_id": 94933604, "body": "You appear to be right. I updated the code and it works minus &#39;quality&#39; not being sent to func x, y."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1546662746, "creation_date": 1546662746, "answer_id": 54048994, "question_id": 54048930, "link": "https://stackoverflow.com/questions/54048930/cannot-use-type-chan-string-as-type-chan-string/54048994#54048994", "title": "Cannot use type chan []string) as type []chan string?", "body": "<pre><code>cannot use channel.cSlice (type chan []string) as type []chan string in argument to x\ncannot use channel.cSlice (type chan []string) as type []chan string in argument to y\n</code></pre>\n\n<hr>\n\n<p>Read the error messages.</p>\n\n<p><code>type chan []string</code></p>\n\n<p><code>type []chan string</code></p>\n\n<p>They are different.</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/CKhj8DUGTle\" rel=\"nofollow noreferrer\">https://play.golang.org/p/CKhj8DUGTle</a></p>\n"}], "owner": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1374, "favorite_count": 1, "accepted_answer_id": 54048994, "answer_count": 1, "score": 2, "last_activity_date": 1546665848, "creation_date": 1546661703, "last_edit_date": 1546665848, "question_id": 54048930, "link": "https://stackoverflow.com/questions/54048930/cannot-use-type-chan-string-as-type-chan-string", "title": "Cannot use type chan []string) as type []chan string?", "body": "<pre><code>package main\n\nimport \"fmt\"\n\nfunc x(foo []string, cz chan string) {\n    for i := range foo {\n        cz &lt;- foo[i]\n    }\n}\n\nfunc y(foo []string, cz chan string) {\n    for i := range foo {\n        cz &lt;- foo[i]\n    }\n}\n\ntype cz struct {\n    cSlice []chan string\n}\n\nfunc main() {\n\n    var quality []string = make([]string, 2)\n    quality[0] = \"hello\"\n    quality[1] = \"world\"\n    //name := []string{\"mother\", \"earth\"}\n\n    var channel cz\n\n    for i := range channel.cSlice {\n        go x(quality, channel.cSlice[i])\n        go y(quality, channel.cSlice[i])\n        x, y := &lt;-channel.cSlice[i], &lt;-channel.cSlice[i]\n        fmt.Println(x, y)\n    }\n}\n</code></pre>\n\n<p>Nothing gets received now hmm...</p>\n\n<p>Update ^</p>\n\n<p>... need more text.</p>\n\n<p>... and then a little more. Ok how much more?</p>\n\n<p>I really can't believe this. fdsaf asf asfasdfdasfadfd</p>\n"}, {"tags": ["go", "orm", "go-gorm"], "comments": [{"owner": {"reputation": 180, "user_id": 127838, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LNz5H.jpg?s=128&g=1", "display_name": "Mario", "link": "https://stackoverflow.com/users/127838/mario"}, "edited": false, "score": 0, "creation_date": 1592837482, "post_id": 54048774, "comment_id": 110560531, "body": "This should be the answer. Creating Database with gorm API including password."}], "answers": [{"comments": [{"owner": {"reputation": 180, "user_id": 127838, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LNz5H.jpg?s=128&g=1", "display_name": "Mario", "link": "https://stackoverflow.com/users/127838/mario"}, "edited": false, "score": 1, "creation_date": 1592837731, "post_id": 57539582, "comment_id": 110560713, "body": "The suggested answer in the posted question works better: It is a native gorm Api solution does not depend on whether createdb is in the path or engaging in process forking from a server."}], "tags": [], "owner": {"reputation": 613, "user_id": 3002206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28cf785ee729f0315ebe84eaa6b00a2b?s=128&d=identicon&r=PG", "display_name": "Nicko", "link": "https://stackoverflow.com/users/3002206/nicko"}, "is_accepted": false, "score": 2, "last_activity_date": 1566072386, "creation_date": 1566072386, "answer_id": 57539582, "question_id": 54048774, "link": "https://stackoverflow.com/questions/54048774/how-to-create-a-postgres-database-using-gorm/57539582#57539582", "title": "How to create a Postgres database using GORM", "body": "<p>Your method seems valid enough. You could also use postgres' <code>createdb</code> utility to create the DB before you connect to it. For example:</p>\n\n<pre><code>import (\n    \"log\"\n    \"os/exec\"\n    \"bytes\"\n)\n\nfunc createPgDb() {\n    cmd := exec.Command(\"createdb\", \"-p\", \"5432\", \"-h\", \"127.0.0.1\", \"-U\", \"superuser\", \"-e\", \"test_db\")\n    var out bytes.Buffer\n    cmd.Stdout = &amp;out\n    if err := cmd.Run(); err != nil {\n        log.Printf(\"Error: %v\", err)\n    }\n    log.Printf(\"Output: %q\\n\", out.String())\n}\n</code></pre>\n\n<p>This example is paraphrased from the Command / Run examples in the Go manual <a href=\"https://golang.org/pkg/os/exec/#Command\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/exec/#Command</a></p>\n"}], "owner": {"reputation": 868, "user_id": 4113109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c8272ee0ba8d6fb56ed64c4c116f80d?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya Satyavada", "link": "https://stackoverflow.com/users/4113109/aditya-satyavada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4319, "favorite_count": 1, "answer_count": 1, "score": 12, "last_activity_date": 1566072386, "creation_date": 1546659646, "last_edit_date": 1548631443, "question_id": 54048774, "link": "https://stackoverflow.com/questions/54048774/how-to-create-a-postgres-database-using-gorm", "title": "How to create a Postgres database using GORM", "body": "<p>This is primarily focused towards having setup() and teardown() methods for a test suite that I'm planning on writing that involves creation of a DB.</p>\n\n<p>I've figured out how to create a DB using GORM. However, I'm not sure if this is the best approach.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n    \"log\"\n)\n\nfunc main() {\n    db, err := gorm.Open(\"postgres\", \"host=127.0.0.1 port=5432 user=superuser dbname=postgres password='' sslmode=disable\")\n    capture(err)\n    db = db.Exec(\"CREATE DATABASE test_db;\")\n    if db.Error != nil {\n        fmt.Println(\"Unable to create DB test_db, attempting to connect assuming it exists...\")\n        db, err = gorm.Open(\"postgres\", \"host=127.0.0.1 port=5432 user=superuser dbname=test_db password='' sslmode=disable\")\n        if err != nil {\n           fmt.Println(\"Unable to connect to test_db\")\n           capture(err)\n        }\n    }\n    defer db.Close()\n}\n\nfunc capture(err error) {\n    if err != nil {\n        log.Fatalf(\"%s\", err)\n   }\n}\n</code></pre>\n\n<p>I'm connecting to the default <code>postgres</code> DB first, after which I'm creating a second test DB which I'm planning on using.</p>\n\n<p>Is this the best approach ? Or is there a way to connect to Postgres without having a pre-existing DB.</p>\n\n<p><em>NOTE</em>: I've already looked up answers where people have used SQL driver to connect to a DB using only the connection string <code>user:password@/</code>. That has not worked in my case.(like <a href=\"https://stackoverflow.com/questions/30235031/how-to-create-a-new-mysql-database-with-go-sql-driver\">here</a>)</p>\n\n<p>I've alse tried a connection string without having a DB name, that results in the driver trying to connect to a DB with the same name as the user. Which fails since such a DB does not exist.</p>\n"}, {"tags": ["go", "cgo", "goinstall"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1546659051, "post_id": 54048711, "comment_id": 94932640, "body": "yes that one line of whitespace did make a difference. Now it can&#39;t find genericc/greeter.h tho."}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1546659376, "post_id": 54048711, "comment_id": 94932677, "body": "thanks I got it working and posted an answer, if you know of a better way to do it other than relative paths using <code>..&#47;genericc&#47;greeter.c</code>, lmk"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1546662221, "post_id": 54048711, "comment_id": 94933056, "body": "@AlexanderMills: Your code organization makes no sense to me. See my revised answer."}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1546662312, "post_id": 54048711, "comment_id": 94933068, "body": "yes you are right, but I was writing <code>main&#47;main.go</code> to test my library as if I was an end user, seen?"}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1546662371, "post_id": 54048711, "comment_id": 94933073, "body": "wrt to using bash scripts, how else do you set $GOPATH? I put my go projects in various places on my fs."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1546661894, "last_edit_date": 1546661894, "creation_date": 1546658911, "answer_id": 54048711, "question_id": 54048688, "link": "https://stackoverflow.com/questions/54048688/compiling-cgo-files-in-golang-package/54048711#54048711", "title": "Compiling CGO files in Golang package", "body": "<p>I follow the instructions:</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">Command cgo</a></p>\n  \n  <p>If the import of \"C\" is <strong>immediately</strong> preceded by a comment, that\n  comment, called the preamble, is used as a header when compiling the C\n  parts of the package. For example:</p>\n\n<pre><code>// #include &lt;stdio.h&gt;\n// #include &lt;errno.h&gt;\nimport \"C\"\n</code></pre>\n  \n  <p>or</p>\n\n<pre><code>/*\n#include &lt;stdio.h&gt;\n#include &lt;errno.h&gt;\n*/\nimport \"C\"\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>For example,</p>\n\n<p><code>gocbuf.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\n/*\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n\nint printData(unsigned char *data) {\n    return printf(\"cData: %lu \\\"%s\\\"\\n\", (long unsigned int)strlen(data), data);\n}\n*/\nimport \"C\"\n\nfunc main() {\n    // Allocate C data buffer.\n    width, height := 8, 2\n    lenData := width * height\n    // add string terminating null byte\n    cData := (*C.uchar)(C.calloc(C.size_t(lenData+1), C.sizeof_uchar))\n\n    // When no longer in use, free C allocations.\n    defer C.free(unsafe.Pointer(cData))\n\n    // Go slice reference to C data buffer,\n    // minus string terminating null byte\n    gData := (*[1 &lt;&lt; 30]byte)(unsafe.Pointer(cData))[:lenData:lenData]\n\n    // Write and read cData via gData.\n    for i := range gData {\n        gData[i] = '.'\n    }\n    copy(gData[0:], \"Data\")\n    gData[len(gData)-1] = 'X'\n    fmt.Printf(\"gData: %d %q\\n\", len(gData), gData)\n    C.printData(cData)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run gocbuf.go\ngData: 16 \"Data...........X\"\ncData: 16 \"Data...........X\"\n$ \n</code></pre>\n\n<hr>\n\n<p>Your code organization makes no sense to me.</p>\n\n<p>You should have package <code>greeter</code>, which wraps <code>C</code> functions via <code>cgo</code>. For example,</p>\n\n<pre><code>src\n\u2514\u2500\u2500 greeter\n    \u251c\u2500\u2500 greeter.c\n    \u251c\u2500\u2500 greeter.go\n    \u2514\u2500\u2500 greeter.h\n</code></pre>\n\n<p>with skeleton files</p>\n\n<p><code>greeter.go</code>:</p>\n\n<pre><code>package greeter\n\n/*\n#include \"greeter.h\"\n*/\nimport \"C\"\n</code></pre>\n\n<p><code>greeter.c</code>:</p>\n\n<pre><code>#include \"greeter.h\"\n</code></pre>\n\n<p><code>greeter.h</code></p>\n\n<pre><code>/* C header file */\n</code></pre>\n\n<p>To install the <code>greeter</code> package, simply use <code>go install</code>. </p>\n\n<p>Don't use relative paths. Don't use bash scripts.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "is_accepted": false, "score": 0, "last_activity_date": 1546659334, "creation_date": 1546659334, "answer_id": 54048743, "question_id": 54048688, "link": "https://stackoverflow.com/questions/54048688/compiling-cgo-files-in-golang-package/54048743#54048743", "title": "Compiling CGO files in Golang package", "body": "<p>Thanks to @peterSO, this is what worked:</p>\n\n<pre><code>package main\n\n// #cgo CFLAGS: -g -Wall\n// #include &lt;stdlib.h&gt;\n// #include \"../genericc/greeter.h\"\n// #include \"../genericc/greeter.c\"    // ! no whitespace after this line\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    name := C.CString(\"Gopher\")\n    defer C.free(unsafe.Pointer(name))\n\n    year := C.int(2018)\n\n    ptr := C.malloc(C.sizeof_char * 1024)\n    defer C.free(unsafe.Pointer(ptr))\n\n    size := C.greet(name, year, (*C.char)(ptr))\n\n    b := C.GoBytes(ptr, size)\n    fmt.Println(string(b))\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1826, "favorite_count": 2, "accepted_answer_id": 54048711, "answer_count": 2, "score": 0, "last_activity_date": 1546661894, "creation_date": 1546658524, "last_edit_date": 1546659408, "question_id": 54048688, "link": "https://stackoverflow.com/questions/54048688/compiling-cgo-files-in-golang-package", "title": "Compiling CGO files in Golang package", "body": "<p>I am trying to use CGO to bundle C files with a Golang package. Following instructions here:</p>\n\n<p><a href=\"https://karthikkaranth.me/blog/calling-c-code-from-go/\" rel=\"nofollow noreferrer\">https://karthikkaranth.me/blog/calling-c-code-from-go/</a></p>\n\n<p><a href=\"http://akrennmair.github.io/golang-cgo-slides/#1\" rel=\"nofollow noreferrer\">http://akrennmair.github.io/golang-cgo-slides/#1</a></p>\n\n<p><a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">https://golang.org/cmd/cgo/</a></p>\n\n<p>I am getting this error:</p>\n\n<blockquote>\n<pre><code># main \nsrc/main/main.go:16:8: could not determine kind of name for C.free \nsrc/main/main.go:23:10: could not determine kind of name for C.greet\n</code></pre>\n</blockquote>\n\n<p>here is the structure:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Kpa8B.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Kpa8B.png\" alt=\"enter image description here\"></a></p>\n\n<p><code>main.go</code> just looks like:</p>\n\n<pre><code>package main\n\n// #cgo CFLAGS: -g -Wall\n// #include &lt;stdlib.h&gt;\n// #include \"genericc/greeter.h\"\n\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    name := C.CString(\"Gopher\")\n    defer C.free(unsafe.Pointer(name))\n\n    year := C.int(2018)\n\n    ptr := C.malloc(C.sizeof_char * 1024)\n    defer C.free(unsafe.Pointer(ptr))\n\n    size := C.greet(name, year, (*C.char)(ptr))\n\n    b := C.GoBytes(ptr, size)\n    fmt.Println(string(b))\n}\n</code></pre>\n\n<p>and I run test.sh to build it:</p>\n\n<pre><code>#!/usr/bin/env bash\n\ndir=\"$(cd `dirname \"$0\"` &amp;&amp; pwd)\"\nexport GOPATH=\"$dir\"\n\ncd \"$dir\"\n\nexport CGOFILES=main\ngo install main\n</code></pre>\n\n<p>but when I run the bash script I get that error.</p>\n"}, {"tags": ["go", "opengl", "sdl"], "answers": [{"comments": [{"owner": {"reputation": 2969, "user_id": 3187995, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/98df6434e724d62ad3c225a9bac5e0bf?s=128&d=identicon&r=PG&f=1", "display_name": "o.o", "link": "https://stackoverflow.com/users/3187995/o-o"}, "edited": false, "score": 0, "creation_date": 1546711640, "post_id": 54047934, "comment_id": 94943619, "body": "I updated my driver (NVIDIA GTX 970), but still the same issue."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1546648957, "creation_date": 1546648957, "answer_id": 54047934, "question_id": 54047442, "link": "https://stackoverflow.com/questions/54047442/opengl-and-sdl2-cannot-open-window/54047934#54047934", "title": "OpenGL and SDL2 cannot open window", "body": "<p>You can see a similar crash in <a href=\"https://github.com/ggez/ggez/issues/141#issuecomment-333202875\" rel=\"nofollow noreferrer\">ggez/ggez issue 141</a> (not related to Go, actually in Rust with OpenGL)</p>\n\n<p>The point is: check first your driver. That same issue mentioned:</p>\n\n<blockquote>\n  <p>I probably find the reason.<br>\n  I updated my integrated graphics card driver, and everything is OK.<br>\n  I do not know why, but now everything can work properly.</p>\n  \n  <p>My device Info:</p>\n  \n  <ul>\n  <li>Intel(R) HD Graphics Family -> I updated this driver</li>\n  <li>AMD Radeon HD 8850M</li>\n  </ul>\n</blockquote>\n"}], "owner": {"reputation": 2969, "user_id": 3187995, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/98df6434e724d62ad3c225a9bac5e0bf?s=128&d=identicon&r=PG&f=1", "display_name": "o.o", "link": "https://stackoverflow.com/users/3187995/o-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1546677721, "creation_date": 1546643864, "last_edit_date": 1546645539, "question_id": 54047442, "link": "https://stackoverflow.com/questions/54047442/opengl-and-sdl2-cannot-open-window", "title": "OpenGL and SDL2 cannot open window", "body": "<p>I am trying to learn how to use OpenGL and SDL2 but when I run the simple program posted below, the window opens and instantly closes <s>with the following message: <code>exit status 3221225477</code></s>.</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/go-gl/gl/v4.1-core/gl\"\n    \"github.com/veandco/go-sdl2/sdl\"\n)\n\nvar (\n    window  *sdl.Window\n    context sdl.GLContext\n)\n\nfunc main() {\n    // Initialize sdl and create context\n    initialize()\n\n    // Initialize OpenGL pointers\n    gl.Init()\n\n    // Setup opengl attributes\n    setOpenGLAttributes()\n\n    // This makes our buffer swap syncronized with the monitor's vertical refresh\n    sdl.GLSetSwapInterval(1)\n\n    // Run and clean\n    run()\n    clean()\n}\n\nfunc initialize() {\n    sdl.Init(sdl.INIT_EVERYTHING)\n\n    window, err := sdl.CreateWindow(\"Test\", sdl.WINDOWPOS_CENTERED, sdl.WINDOWPOS_CENTERED, 1280, 720, sdl.WINDOW_OPENGL)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    context, err = window.GLCreateContext()\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n}\n\nfunc setOpenGLAttributes() {\n    // SDL_GL_CONTEXT_CORE gives us only the newer version, deprecated functions are disabled\n    sdl.GLSetAttribute(sdl.GL_CONTEXT_PROFILE_MASK, sdl.GL_CONTEXT_PROFILE_CORE)\n\n    // 3.2 is part of the modern versions of OpenGL, but most video cards whould be able to run it\n    sdl.GLSetAttribute(sdl.GL_CONTEXT_MAJOR_VERSION, 3)\n    sdl.GLSetAttribute(sdl.GL_CONTEXT_MINOR_VERSION, 2)\n\n    // Turn on double buffering with a 24bit Z buffer.\n    sdl.GLSetAttribute(sdl.GL_DOUBLEBUFFER, 1)\n}\n\nfunc run() {\n    for {\n        for event := sdl.PollEvent(); event != nil; event = sdl.PollEvent() {\n            switch event.(type) {\n            case *sdl.QuitEvent:\n                return\n            }\n        }\n\n        gl.ClearColor(1, 8, 20, 1.0)\n        gl.Clear(gl.COLOR_BUFFER_BIT)\n        window.GLSwap()\n    }\n}\n\nfunc clean() {\n    // Delete our OpengL context\n    sdl.GLDeleteContext(context)\n\n    // Destroy our window\n    window.Destroy()\n\n    // Shutdown SDL 2\n    sdl.Quit()\n}\n</code></pre>\n\n<p>What am I doing wrong? I was following this tutorial: <a href=\"http://headerphile.com/sdl2/opengl-part-1-sdl-opengl-awesome/\" rel=\"nofollow noreferrer\">http://headerphile.com/sdl2/opengl-part-1-sdl-opengl-awesome/</a> and it doesn't look like I missed anything converting it to Go.</p>\n\n<p><strong>EDIT</strong>: So I added <code>gl.Init()</code> before setting the OpenGL attributes. I still get the same behavior, but the program keeps running. The window is invisible (cannot see it in the task bar) and the only way to quit is by pressing CTRL+C in the terminal. Am I missing some other function call?</p>\n"}, {"tags": ["arrays", "loops", "go"], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "edited": false, "score": 0, "creation_date": 1546641410, "post_id": 54047057, "comment_id": 94929611, "body": "Ah thank you. I thought slices could resize on their own, unlike arrays and that was the point. So if n were 3, could I only have a[0], a[1], a[2]?"}, {"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "reply_to_user": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "edited": false, "score": 0, "creation_date": 1546641955, "post_id": 54047057, "comment_id": 94929765, "body": "Yes, you could utilize the builtin package&#39;s <a href=\"https://golang.org/src/builtin/builtin.go?h=append#L134\" rel=\"nofollow noreferrer\">append</a> function to resize the slice dynamically."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1546641956, "post_id": 54047057, "comment_id": 94929766, "body": "That&#39;s why one normally uses <code>append</code>, e.g. <code>a = append(a, foo)</code>, which which case you don&#39;t need to use <code>make</code>."}], "tags": [], "owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "is_accepted": true, "score": 1, "last_activity_date": 1546641131, "creation_date": 1546641131, "answer_id": 54047057, "question_id": 54046974, "link": "https://stackoverflow.com/questions/54046974/index-out-of-range-trying-to-add-to-slice/54047057#54047057", "title": "Index out of range trying to add to slice", "body": "<p>Your slice <code>a</code> needs to be allocated utilizing <code>make</code>.</p>\n\n<pre><code>var a []string = make([]string, n)\n</code></pre>\n\n<p>where <code>n</code> is the size of the slice.</p>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1546652875, "post_id": 54047797, "comment_id": 94931848, "body": "What did Ralph Waldo Emerson say about consistency? What do the Go Code Review Comments say about Declaring Empty Slices? <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#declaring-empty-slices\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}, {"owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1546671740, "post_id": 54047797, "comment_id": 94934328, "body": "That is accurate, I will update my comment to reflect the point. Although, the preference to utilize the same initialization method when defining multiple variables is also a reality, hence why I used that here."}], "tags": [], "owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "is_accepted": false, "score": 0, "last_activity_date": 1546671822, "last_edit_date": 1546671822, "creation_date": 1546647488, "answer_id": 54047797, "question_id": 54046974, "link": "https://stackoverflow.com/questions/54046974/index-out-of-range-trying-to-add-to-slice/54047797#54047797", "title": "Index out of range trying to add to slice", "body": "<p>Removing some of the context-specific parts of your code, you should be using the <code>append</code> method against a dynamic-length slice.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    book := \"Lorem ipsum dolor sit amet\"\n    var words []string\n\n    for _, word := range strings.Split(book, \" \") {\n        words = append(words, word)\n    }\n\n    fmt.Printf(\"%+v\\n\", words)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/LMejsrmIGb9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LMejsrmIGb9</a></p>\n\n<p>If you know the number of values up front, the same can be achieved for a fixed length slice by using <code>words := make([]string, 5)</code>, but I doubt this is what you want in this case.</p>\n\n<p>The reason your code is causing you errors is because your slice isn't initialized at any given length, so your indexes don't yet exist. Generally when working with a slice, <code>append</code> is the method you want.</p>\n\n<p>Opposite to this, when working with existing slices (ie, <code>range</code>ing an slice), the reason you're able to set the values using indexes is because the index has already been allocated.</p>\n"}], "owner": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 669, "favorite_count": 0, "accepted_answer_id": 54047057, "answer_count": 2, "score": -2, "last_activity_date": 1546671822, "creation_date": 1546640617, "last_edit_date": 1546660441, "question_id": 54046974, "link": "https://stackoverflow.com/questions/54046974/index-out-of-range-trying-to-add-to-slice", "title": "Index out of range trying to add to slice", "body": "<pre><code>var bar string\nvar i int\nvar a []string\nfor foo, _ := reader.NextWord(); foo != bar; foo, _ = reader.NextWord() {\n    bar = foo\n    fmt.Print(foo)\n    a[i] = foo\n    i++\n}\n</code></pre>\n\n<p>Shouldn't this be creating a nil slice and then adding the value to the appropriate place? I keep getting index out of range so I assume it's not adding to <code>a[i]</code>...</p>\n\n<p>Checking length first with      </p>\n\n<pre><code>if len(a) &gt; 0 {\n    a[i] = foo\n}\n</code></pre>\n\n<p>seems to help, but not getting the results I expected. I'll keep playing around.</p>\n\n<p>Update: I did end up using append... I meant to update this thread but thank you both.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"strings\"\n\n    \"github.com/steven-ferrer/gonsole\"\n)\n\nfunc main() {\n    file, err := os.Open(\"test.txt\")\n    if err != nil {\n        log.Println(err)\n    }\n    defer file.Close()\n\n    reader := gonsole.NewReader(file)\n\n    // cycle through\n    var bar string\n    var i int\n\n    var quality []string = make([]string, 0)\n    var tempName []string = make([]string, 0)\n    var name []string = make([]string, 0)\n\n    for foo, _ := reader.NextWord(); foo != bar; foo, _ = reader.NextWord() {\n        bar = foo\n\n        if strings.Contains(foo, \"(normal)\") {\n            quality = append(quality, \"normal\")\n            for state := 0; state &lt; 1; foo, _ = reader.NextWord() {\n                if foo == \"|\" {\n                    state = 1\n                }\n                tempName = append(tempName, foo)\n            }\n            nameString := strings.Join(tempName, \"\")\n            name = append(name, nameString)\n        } else if strings.Contains(foo, \"(unique)\") {\n            quality = append(quality, \"unique\")\n            for state := 0; state &lt; 1; foo, _ = reader.NextWord() {\n                if foo == \"|\" {\n                    state = 1\n                }\n                tempName = append(tempName, foo)\n            }\n            nameString := strings.Join(tempName, \"\")\n            name = append(name, nameString)\n        } else if strings.Contains(foo, \"(set)\") {\n            quality = append(quality, \"set\")\n            for state := 0; state &lt; 1; foo, _ = reader.NextWord() {\n                if foo == \"|\" {\n                    state = 1\n                }\n                tempName = append(tempName, foo)\n            }\n            nameString := strings.Join(tempName, \"\")\n            name = append(name, nameString)\n        }\n        if tempName != nil {\n            tempName = nil // clear tempName\n        }\n        i++\n    }\n</code></pre>\n"}, {"tags": ["go", "io", "stdout", "stdin"], "comments": [{"owner": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "edited": false, "score": 1, "creation_date": 1546679595, "post_id": 54046303, "comment_id": 94935626, "body": "you may need advanced terminal libraries such as termbox-go. see all available library list at <a href=\"https://github.com/avelino/awesome-go#advanced-console-uis\" rel=\"nofollow noreferrer\">github.com/avelino/awesome-go#advanced-console-uis</a>"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1546768201, "post_id": 54046303, "comment_id": 94954189, "body": "I think it is conceptually wrong to log to the same underlying device (the terminal) you use to interact with the user. And if you absolutely need to do so, it would simply be best practice to interact with the user <i>first</i> and then start to log."}], "owner": {"reputation": 11, "user_id": 4066113, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e5c863b961347af5aca9a3ecf5044ae?s=128&d=identicon&r=PG", "display_name": "Mees", "link": "https://stackoverflow.com/users/4066113/mees"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1546637194, "creation_date": 1546637194, "question_id": 54046303, "link": "https://stackoverflow.com/questions/54046303/is-there-a-way-to-clear-the-last-line-of-stdin-and-later-restore-it", "title": "Is there a way to clear the last line of stdin and later restore it?", "body": "<p>I'm trying to create a messaging client with a terminal interface. The problem I'm having is I want to print messages to stdout while the user might be typing into stdin. When I do this the user input typed into stdin get disrupted by the message. Is there any way to clear the last line of stdin, then print to stdout and then restore the last line of stdin so the user can finish their message?</p>\n\n<p>Currently I read from stdin with <code>bufio.Reader.ReadString('\\n')</code>\nand I print to stdout with the normal <code>fmt.Println</code> and <code>fmt.Printf</code> functions</p>\n\n<p>An example of the current situation:</p>\n\n<pre><code># user is typing message\nHey Stan ho\n# message from other user comes in\n# it is: \"Hey Bart\"\n# last line in terminal is now:\nHey Stan hoHey bart\n</code></pre>\n\n<p>What I want is to clear the \"Hey Stan ho\" then print the incoming message and then put the \"Hey Stan ho\" back</p>\n"}, {"tags": ["pointers", "go", "struct"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1546634435, "post_id": 54045683, "comment_id": 94926979, "body": "<code>thing = NewThing()</code> doesn&#39;t modify an existing object; <i>it creates a new one.</i>  You&#39;re assigning a new reference to a variable whose original reference is almost certainly being <i>passed by value.</i>  Therefore, nothing happens."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 4, "last_activity_date": 1546634391, "creation_date": 1546634391, "answer_id": 54045722, "question_id": 54045683, "link": "https://stackoverflow.com/questions/54045683/go-doesnt-seem-to-pass-pointers-how-i-think-it-is/54045722#54045722", "title": "Go doesn&#39;t seem to pass pointers how I think it is", "body": "<p>Your <code>ModifyThing</code> doesn't actually modify <code>thing</code>. It overwrites its local variable <code>thing</code> with a new pointer to a new instance of <code>Thing</code>, so it has no impact on anything else. If it <em>actually modified</em> <code>thing</code> - say, <code>thing.field = newValue</code>, that would be reflected in the caller.</p>\n\n<p>If you wanted to overwrite the whole value pointed to by the pointer, you could also do that, but you have to explicitly overwrite <em>the memory being pointed to</em> rather than the pointer itself:</p>\n\n<pre><code>*thing = Thing{}\n</code></pre>\n\n<p>Notice we <em>dereference</em> <code>*thing</code>, and overwrite its value with a new <code>Thing</code> (not a new <code>*Thing</code>!)</p>\n\n<p><em>Everything in Go is passed by value, including pointers</em>. Pointers point to a memory address, which can be a shared value. But the pointer itself is still copied on function call.</p>\n"}], "owner": {"reputation": 440, "user_id": 3939431, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/692TH.jpg?s=128&g=1", "display_name": "GhostRavenstorm", "link": "https://stackoverflow.com/users/3939431/ghostravenstorm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 1, "accepted_answer_id": 54045722, "answer_count": 1, "score": -4, "last_activity_date": 1546634391, "creation_date": 1546634222, "question_id": 54045683, "link": "https://stackoverflow.com/questions/54045683/go-doesnt-seem-to-pass-pointers-how-i-think-it-is", "title": "Go doesn&#39;t seem to pass pointers how I think it is", "body": "<p>I have a Go program here I'm using to test out a pointer error I'm having in a much larger http service program.</p>\n\n<p>I have a pointer of a struct I'm wanting to pass to a function to initialize it. Naturally because it's a pointer, I shouldn't have to return anything. It should modify it directly.</p>\n\n<p>However, that's not what is happening here.</p>\n\n<pre><code>func main () {\n   var thing *Thing\n   ModifyThing(thing)\n   fmt.Println(thing)\n}\n\nfunc ModifyThing (thing *Thing) {\n   thing = NewThing()\n}\n\nfunc NewThing () *Thing {\n   thing := Thing{}\n   return &amp;thing\n}\n\n/// Output: &lt;nil&gt;\n</code></pre>\n\n<p>If I use <code>NewThing()</code> on my <code>thing</code> directly, I'll get an initialized pointer. However this doesn't work when I pass the pointer to a function that calls the same method. Is the memory location of my <code>thing</code> not being passed how I'm expecting?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1546631154, "creation_date": 1546631154, "answer_id": 54045125, "question_id": 54045074, "link": "https://stackoverflow.com/questions/54045074/type-switch-does-not-detect-float32/54045125#54045125", "title": "Type switch does not detect float32", "body": "<blockquote>\n  <p>For some reason this code does not detect 4.0 value as float32 but it detects it as float64 - why is that? </p>\n</blockquote>\n\n<p>Because <code>float64</code> is the <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">default type</a> for an untyped floating-point constant.  Relevant part emphasized:</p>\n\n<blockquote>\n  <p>An untyped constant has a default type which is the type to which the constant is implicitly converted in contexts where a typed value is required, for instance, in a short variable declaration such as i := 0 where there is no explicit type. <strong>The default type of an untyped constant is</strong> bool, rune, int, <strong>float64</strong>, complex128 or string respectively, <strong>depending on whether it is a</strong> boolean, rune, integer, <strong>floating-point</strong>, complex, or string <strong>constant</strong>.</p>\n</blockquote>\n"}], "owner": {"reputation": 129, "user_id": 8049659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d80e2c967ad7a3887ec441485056cf8?s=128&d=identicon&r=PG&f=1", "display_name": "user8049659", "link": "https://stackoverflow.com/users/8049659/user8049659"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 54045125, "answer_count": 1, "score": -5, "last_activity_date": 1546631154, "creation_date": 1546630923, "question_id": 54045074, "link": "https://stackoverflow.com/questions/54045074/type-switch-does-not-detect-float32", "title": "Type switch does not detect float32", "body": "<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    printType(4.0)\n}\n\nfunc printType(i interface{}) {\n    switch i := i.(type) {\n    case float32:\n        fmt.Println(\"This is a float type\", i)\n    }\n}\n</code></pre>\n\n<p>For some reason this code does not detect <code>4.0</code> value as <code>float32</code> but it detects it as <code>float64</code> - why is that? I run it on win x64 machine.</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1546621228, "post_id": 54043118, "comment_id": 94921765, "body": "You need to inspect <code>Method.Type.{NumIn,In}</code>."}, {"owner": {"reputation": 321, "user_id": 5501816, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh4.googleusercontent.com/-CdXutmncoDg/AAAAAAAAAAI/AAAAAAAAM10/fp51YCvbbSI/photo.jpg?sz=128", "display_name": "Enrique Alcazar", "link": "https://stackoverflow.com/users/5501816/enrique-alcazar"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1546621689, "post_id": 54043118, "comment_id": 94921964, "body": "Could you elaborate or link to any examples or resources?"}], "owner": {"reputation": 321, "user_id": 5501816, "user_type": "registered", "accept_rate": 42, "profile_image": "https://lh4.googleusercontent.com/-CdXutmncoDg/AAAAAAAAAAI/AAAAAAAAM10/fp51YCvbbSI/photo.jpg?sz=128", "display_name": "Enrique Alcazar", "link": "https://stackoverflow.com/users/5501816/enrique-alcazar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 27, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1546620975, "creation_date": 1546620975, "question_id": 54043118, "link": "https://stackoverflow.com/questions/54043118/golang-error-control-on-parameters-when-calling-a-function-with-reflection", "title": "Golang error control on parameters when calling a function with reflection", "body": "<p>I'm trying to call a function using reflection based on it's name.</p>\n\n<p>I first recover the function with</p>\n\n<pre><code>f := reflect.ValueOf(s).MethodByName(name)\n</code></pre>\n\n<p>I do error control on the function name by checking if \"f\" is valid with </p>\n\n<pre><code>if !f.IsValid() {\n    return errors.New(\"There is no function with that name\")\n}\n</code></pre>\n\n<p>And finally I perform the call with</p>\n\n<pre><code>f.Call(inputs)\n</code></pre>\n\n<p>My challenge is that inputs depends on the user, and sometimes they can put too many parameters, too little or invalid types.</p>\n\n<p>IE: </p>\n\n<pre><code>2019/01/04 16:47:54 http: panic serving [::1]:53662: reflect: Call using string as type int\n</code></pre>\n\n<p>How can I control that the inputs are valid before performing the call?\nMaybe there is a way to recover the expected inputs in my method and check them against the provided ones?</p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-storage"], "comments": [{"owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "edited": false, "score": 1, "creation_date": 1546626870, "post_id": 54042838, "comment_id": 94924191, "body": "Please, provide more information what you mean by downloading files in chunks. There is documentation for Google Cloud Storage: <a href=\"https://godoc.org/cloud.google.com/go/storage\" rel=\"nofollow noreferrer\">godoc.org/cloud.google.com/go/storage</a>. As you can see it exposes a bucket objects as a regular reader interface. You could implement your own reader however you need to."}, {"owner": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "reply_to_user": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "edited": false, "score": 0, "creation_date": 1546752139, "post_id": 54042838, "comment_id": 94951450, "body": "Downloading file in chunks means downloading file in chunks. That&#39;s plain english."}], "answers": [{"comments": [{"owner": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "edited": false, "score": 0, "creation_date": 1546752055, "post_id": 54047950, "comment_id": 94951436, "body": "Thanks.Yes, I was following that example but I was not sure how the underlying SDK works and if it actually downloads the complete file no matter how I use the io Reader."}, {"owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "reply_to_user": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "edited": false, "score": 1, "creation_date": 1546821217, "post_id": 54047950, "comment_id": 94967699, "body": "Please accept the answer if this gives you what you need then"}], "tags": [], "owner": {"reputation": 1570, "user_id": 1295839, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/brxG0.png?s=128&g=1", "display_name": "syntaqx", "link": "https://stackoverflow.com/users/1295839/syntaqx"}, "is_accepted": true, "score": 3, "last_activity_date": 1546649097, "creation_date": 1546649097, "answer_id": 54047950, "question_id": 54042838, "link": "https://stackoverflow.com/questions/54042838/golang-sdk-for-google-cloud-storage-multipart-download/54047950#54047950", "title": "Golang SDK for Google cloud storage : Multipart download", "body": "<p>The Google Cloud documentation says to download an object from Cloud Storage, you should use the following:</p>\n\n<pre><code>rc, err := client.Bucket(bucket).Object(object).NewReader(ctx)\nif err != nil {\n        return nil, err\n}\ndefer rc.Close()\n\ndata, err := ioutil.ReadAll(rc)\nif err != nil {\n        return nil, err\n}\nreturn data, nil\n</code></pre>\n\n<p>Source: <a href=\"https://cloud.google.com/storage/docs/downloading-objects#storage-download-object-code_sample\" rel=\"nofollow noreferrer\">https://cloud.google.com/storage/docs/downloading-objects#storage-download-object-code_sample</a></p>\n\n<p>Given their SDK returns an <code>io.Reader</code>, you don't need to worry about the underlying method being used to be able to reference the download in chunks (although, quickly looking through their source, it just implements <code>http.NewRequest</code>, which does what you want, using the same logic).</p>\n\n<p>The reason it doesn't seem to \"chunked\" from their example is because of the usage of <code>ioutil.ReadAll</code>, which although great for simple use cases, extracts all of the <code>Reader</code>s data into memory (meaning it also has to wait for the data to become available).</p>\n\n<p>For a better understanding of how to deal with a <code>Reader</code> in steps, I recommend taking a look at <a href=\"https://tour.golang.org/methods/21\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/21</a> for a tour of <code>io.Reader</code> and how you can use it more efficiently.</p>\n"}], "owner": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1183, "favorite_count": 0, "accepted_answer_id": 54047950, "answer_count": 1, "score": 0, "last_activity_date": 1546751847, "creation_date": 1546619686, "last_edit_date": 1546751847, "question_id": 54042838, "link": "https://stackoverflow.com/questions/54042838/golang-sdk-for-google-cloud-storage-multipart-download", "title": "Golang SDK for Google cloud storage : Multipart download", "body": "<p>Using GoLang SDK for google cloud storage. </p>\n\n<p>Cannot find how to download files in chunks.</p>\n"}]