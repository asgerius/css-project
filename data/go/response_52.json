[{"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "edited": false, "score": 0, "creation_date": 1452124598, "post_id": 34645031, "comment_id": 57036029, "body": "Thanks for your reply!   So for example, split our user and artist into two separate collection? But then how would I link a users artists to the user?"}, {"owner": {"reputation": 11620, "user_id": 1832301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dfe654f47e3de2384ffd4e2165c575c?s=128&d=identicon&r=PG", "display_name": "BraveNewCurrency", "link": "https://stackoverflow.com/users/1832301/bravenewcurrency"}, "reply_to_user": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "edited": false, "score": 0, "creation_date": 1452125065, "post_id": 34645031, "comment_id": 57036161, "body": "You can store an array of Object IDs, and simly remember to query the other collection. <a href=\"https://docs.mongodb.org/manual/tutorial/model-referenced-one-to-many-relationships-between-documents/#data-modeling-publisher-and-books\" rel=\"nofollow noreferrer\">docs.mongodb.org/manual/tutorial/&hellip;</a>"}, {"owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "edited": false, "score": 0, "creation_date": 1452170097, "post_id": 34645031, "comment_id": 57055657, "body": "Is there a recommended way to do this using the Go mgo library? Or is it just a case of manually creating a new document, getting the ID, then updating the parent document and pushing the id into the array?   Thanks for all your help!"}, {"owner": {"reputation": 11620, "user_id": 1832301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dfe654f47e3de2384ffd4e2165c575c?s=128&d=identicon&r=PG", "display_name": "BraveNewCurrency", "link": "https://stackoverflow.com/users/1832301/bravenewcurrency"}, "reply_to_user": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "edited": false, "score": 0, "creation_date": 1452371746, "post_id": 34645031, "comment_id": 57143323, "body": "The latter. There are ORMs that handle parent/child relationships. But using an ORM is a complexity trade-off."}], "tags": [], "owner": {"reputation": 11620, "user_id": 1832301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dfe654f47e3de2384ffd4e2165c575c?s=128&d=identicon&r=PG", "display_name": "BraveNewCurrency", "link": "https://stackoverflow.com/users/1832301/bravenewcurrency"}, "is_accepted": true, "score": 2, "last_activity_date": 1452126750, "last_edit_date": 1452126750, "creation_date": 1452124153, "answer_id": 34645031, "question_id": 34644754, "link": "https://stackoverflow.com/questions/34644754/how-would-i-select-all-embedded-documents-of-the-same-type-in-mgo-mongodb/34645031#34645031", "title": "How would I select all embedded documents of the same type in mgo Mongodb?", "body": "<p>I think you are assuming <code>mgo</code> is an \"<a href=\"https://en.wikipedia.org/wiki/Object-relational_mapping\" rel=\"nofollow\">ORM</a>\". But it's just a simple way to store data in Mongo. There are 3 different ways to fix your problem:</p>\n\n<ol>\n<li><p>Put different types into different collections. That way, every document is the same type.  (Collections are like \"tables\" in a relational database).</p></li>\n<li><p>Tag each thing with it's type (i.e. store the object type in a field), then you can query on it.</p></li>\n<li><p>If you are feeling dangerous, you can assume all Artists have Genres, and all Users have a Profile. Then use <code>$exists</code> to select only that type.</p></li>\n</ol>\n\n<p>The first option is the usual way to do it. You should have specific reasons for doing #2 or #3, as they could be slower.</p>\n"}], "owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 34645031, "answer_count": 1, "score": 0, "last_activity_date": 1452126750, "creation_date": 1452122548, "question_id": 34644754, "link": "https://stackoverflow.com/questions/34644754/how-would-i-select-all-embedded-documents-of-the-same-type-in-mgo-mongodb", "title": "How would I select all embedded documents of the same type in mgo Mongodb?", "body": "<p>I have a go application which uses mgo/mongodb. I'm using embedded documents rather than relational ones. </p>\n\n<p>So I have... (some code redacted for brevity).</p>\n\n<pre><code>type User struct {\n    Id          bson.ObjectId `bson:\"_id,omitempty\" json:\"id\"`\n    Name        string        `form:\"name\" bson:\"name\" json:\"name\"`\n    Password    string        `form:\"password\" bson:\"password,omitempty\" json:\"password\" binding:\"required\"`\n    Email       string        `form:\"email\" bson:\"email,omitempty\" json:\"email\" binding:\"required\"`\n    Artists     []Artist      `form:\"artists\" bson:\"artists,omitempty\" json:\"artists\" inline`\n    Releases    []Release     `form:\"releases\" bson:\"releases,omitempty\" json:\"releases\" inline`\n    ContentFeed []Content     `form:\"content_feed\" bson:\"content_feed,omitempty\" json:\"content_feed\" inline`\n    Profile     Profile       `form:\"profile\" bson:\"profile,omitempty\" json:\"profile\" inline`\n    TopTracks   []Track       `form:\"top_tracks\" bson:\"top_tracks\" json:\"top_tracks\" inline`\n}\n\ntype Artist struct {\n    Id     bson.ObjectId `bson:\"_id,omitempty\" json:\"id\"`\n    Title  string        `form:\"title\" bson:\"title\" json:\"title\"`\n    Genres string        `form:\"genres\" bson:\"genres\" json:\"genres\"`\n}\n\nfunc (repo *ArtistRepo) GetArtists() ([]Artist, error) {\n    results := &amp;[]Artist{}\n    err := repo.collection.Find(???).All(results)\n    return results, err\n}\n</code></pre>\n\n<p>I'm trying to get all of the artists, from all of the users essentially. But I can't figure what I need in my query? I've touched briefly on Map/Reduce, but it didn't seem to apply to what I'm trying to do. </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1452121896, "post_id": 34644194, "comment_id": 57035068, "body": "Composition is the ubiquitous computer science term, worth pointing out though that the actual Go feature being utilized here is embedding."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1452122234, "post_id": 34644194, "comment_id": 57035197, "body": "@evanmcdonnal True, but I intentionally used this wording, because of <a href=\"https://en.wikipedia.org/wiki/Composition_over_inheritance\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Composition_over_inheritance</a>"}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 8, "last_activity_date": 1452119874, "creation_date": 1452119874, "answer_id": 34644194, "question_id": 34644117, "link": "https://stackoverflow.com/questions/34644117/golang-struct-inheritance-not-working-as-intended/34644194#34644194", "title": "Golang struct inheritance not working as intended?", "body": "<p>You need to explicitly create Base field like that</p>\n\n<pre><code>f(Something{\n    Base: Base{a: \"letter a\"},\n    c:    \"letter c\",\n})\n</code></pre>\n\n<p>Go has no inheritance, it is just composition.</p>\n"}, {"comments": [{"owner": {"reputation": 2250, "user_id": 5832767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pk3M7.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5832767/tom"}, "edited": false, "score": 1, "creation_date": 1580120928, "post_id": 34644202, "comment_id": 105980569, "body": "I can&#39;t edit the answer to fix it: small typo <code>emedding</code> --&gt; <code>embedding</code>"}], "tags": [], "owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "is_accepted": true, "score": 30, "last_activity_date": 1580215119, "last_edit_date": 1580215119, "creation_date": 1452119908, "answer_id": 34644202, "question_id": 34644117, "link": "https://stackoverflow.com/questions/34644117/golang-struct-inheritance-not-working-as-intended/34644202#34644202", "title": "Golang struct inheritance not working as intended?", "body": "<p>Golang doesn't provide the typical notion of inheritance. What you are accomplishing here is embedding. </p>\n\n<p>It does not give the outer struct the fields of the inner struct but instead allows the outer struct to access the fields of the inner struct.</p>\n\n<p>In order to create the outer struct <code>Something</code> you need to give its fields which include the inner struct <code>Base</code></p>\n\n<p>In your case:</p>\n\n<pre><code>Something{Base: Base{a: \"letter a\"}, c: \"letter c\"}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 3, "last_activity_date": 1452120057, "creation_date": 1452120057, "answer_id": 34644235, "question_id": 34644117, "link": "https://stackoverflow.com/questions/34644117/golang-struct-inheritance-not-working-as-intended/34644235#34644235", "title": "Golang struct inheritance not working as intended?", "body": "<p>You have to actually instantiate the embedded struct as well. Just so you know this isn't inheritance technically, no such feature exists in Go. It's called embedding. It just hoists fields and methods from the embedded type to the embeddors scope. So anyway, the composite literal instantiation you're trying to do would look like this;</p>\n\n<pre><code>f(Something{\n    Base: Base{a: \"a\", b: \"b\"},\n    c:    \"c\",\n})\n</code></pre>\n"}], "owner": {"reputation": 743, "user_id": 879289, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d58efa6db4cf5a4c8e2fcbab751f2858?s=128&d=identicon&r=PG", "display_name": "beetree", "link": "https://stackoverflow.com/users/879289/beetree"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15623, "favorite_count": 0, "accepted_answer_id": 34644202, "answer_count": 3, "score": 17, "last_activity_date": 1580215119, "creation_date": 1452119495, "question_id": 34644117, "link": "https://stackoverflow.com/questions/34644117/golang-struct-inheritance-not-working-as-intended", "title": "Golang struct inheritance not working as intended?", "body": "<p>Check out <a href=\"https://play.golang.org/p/elIHgHAZjT\" rel=\"noreferrer\" title=\"this sandbox\">this sandbox</a></p>\n\n<p>When declaring a struct that inherits from a different struct:</p>\n\n<pre><code>type Base struct {\n    a string\n    b string\n}\n\ntype Something struct {\n    Base\n    c string\n}\n</code></pre>\n\n<p>Then calling functions specifying values for the inherited values gives a compilation error:</p>\n\n<pre><code>f(Something{\n    a: \"letter a\",\n    c: \"letter c\",\n})\n</code></pre>\n\n<p>The error message is: <code>unknown Something field 'a' in struct literal</code>.</p>\n\n<p>This seems highly weird to me. Is this really the intended functionality?</p>\n\n<p>Thanks for the help!</p>\n"}, {"tags": ["regex", "http", "go", "io"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1452105249, "post_id": 34640163, "comment_id": 57025855, "body": "The response is a stream, you happen to be using a method called <code>readAll</code>. I bet you can find some other options like readline."}], "answers": [{"tags": [], "owner": {"reputation": 97745, "user_id": 884978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdb4f5f287976278b6e02f66e85c41dc?s=128&d=identicon&r=PG", "display_name": "creack", "link": "https://stackoverflow.com/users/884978/creack"}, "is_accepted": false, "score": 3, "last_activity_date": 1452105200, "creation_date": 1452105200, "answer_id": 34640243, "question_id": 34640163, "link": "https://stackoverflow.com/questions/34640163/http-get-request-in-go-get-a-few-lines/34640243#34640243", "title": "http Get request in Go (Get a few lines)", "body": "<p>If you know how much you need to read from the response, you can use a LimitReader (<a href=\"https://golang.org/pkg/io/#LimitedReader\" rel=\"nofollow\">https://golang.org/pkg/io/#LimitedReader</a>), otherwise, the easiest way would be a make a read (or a Scanner) to consume your body until you finish your patterns.</p>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1452122601, "last_edit_date": 1452122601, "creation_date": 1452105247, "answer_id": 34640252, "question_id": 34640163, "link": "https://stackoverflow.com/questions/34640163/http-get-request-in-go-get-a-few-lines/34640252#34640252", "title": "http Get request in Go (Get a few lines)", "body": "<p>Don't use <code>ReadAll</code>, just read a chunk you know will be large enough to capture the part of the request you want</p>\n\n<pre><code>// response must be in the first 2048 bytes\nbuf := make([]byte, 2048)\nn, err := resp.Body.Read(buf)\nMyFunction(buf[:n])\n</code></pre>\n\n<p>Or via an <code>io.LimitedReader</code></p>\n\n<pre><code>buf, err := ioutil.ReadAll(io.LimitReader(resp.Body, 2048))\n</code></pre>\n\n<p>Or if you really need to read via lines, a <code>bufio.Scanner</code></p>\n\n<pre><code>scanner := bufio.NewScanner(resp.Body)\nfor i := 0; i &lt; fewLines &amp;&amp; scanner.Scan(); i++ {\n    MyFunction(scanner.Bytes())\n}\n</code></pre>\n\n<p>Note however if you don't finish reading the response Body, it will prevent your client from reusing connections, and if there is a large amount of incoming data the server may not like you frequently closing the connection early.</p>\n"}], "owner": {"reputation": 693, "user_id": 4197901, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4924ea36bee5a4df8e17c819b86faddb?s=128&d=identicon&r=PG&f=1", "display_name": "KD157", "link": "https://stackoverflow.com/users/4197901/kd157"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1298, "favorite_count": 3, "accepted_answer_id": 34640252, "answer_count": 2, "score": 0, "last_activity_date": 1452122601, "creation_date": 1452104925, "question_id": 34640163, "link": "https://stackoverflow.com/questions/34640163/http-get-request-in-go-get-a-few-lines", "title": "http Get request in Go (Get a few lines)", "body": "<p>I need to get only a <strong>first few lines</strong> of a <code>http.Get(&lt;url&gt;</code>) request in go lang.Is there any way to do it.I don't need the entire response. I need to match a pattern which will be there only in the first few lines. Fetching the entire response and getting the regular expression is making it very very slow because the number of characters in the response are very huge.Which is the fastest way to do it.\nCurrently i am doing</p>\n\n<pre><code>http.Get(&lt;url&gt;) \n</code></pre>\n\n<p>// returns a response</p>\n\n<pre><code>ioutil.readAll(response of the above url)\n</code></pre>\n\n<p>// returns a byte array</p>\n\n<pre><code> MyFunction(search for reg exp in the byte array)\n</code></pre>\n\n<p>Is there any method to fetch a few lines or avoid fetching the entire response and match the pattern.</p>\n"}, {"tags": ["unicode", "go", "utf-8"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1452103706, "post_id": 34639566, "comment_id": 57024937, "body": "Python keeps a separate &quot;unicode&quot; representation internally which requires encoding and decoding. Since go assumes utf-8 in all cases whete it matters (runes are utf-8), you don&#39;t worry about it unless you&#39;re trying to consume or produce a different encoding."}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 6, "last_activity_date": 1452202954, "last_edit_date": 1452202954, "creation_date": 1452103702, "answer_id": 34639799, "question_id": 34639566, "link": "https://stackoverflow.com/questions/34639566/how-to-store-text-internally-in-a-go-program/34639799#34639799", "title": "How to store text internally in a Go program?", "body": "<p>Generally speaking, in Go you will be writing a <code>[]byte</code> like when using the <code>ioutil</code> package's <code>WriteFile</code> method; <a href=\"https://golang.org/pkg/io/ioutil/#WriteFile\" rel=\"nofollow noreferrer\">https://golang.org/pkg/io/ioutil/#WriteFile</a></p>\n\n<p>So yes, the answer is that you explicitly declare the encoding. Since the string is just a byte slice, there is no inherent encoding, however string literals in Go source will be UTF-8. If you haven't already read this Go blog post by Robert Pike on strings, bytes and runes, it's worth the time; <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">https://blog.golang.org/strings</a></p>\n"}], "owner": {"reputation": 7466, "user_id": 288424, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cf91d37f026ddaccc28c9907b567ab13?s=128&d=identicon&r=PG&f=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/288424/neil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 34639799, "answer_count": 1, "score": 0, "last_activity_date": 1452202954, "creation_date": 1452102823, "last_edit_date": 1452107144, "question_id": 34639566, "link": "https://stackoverflow.com/questions/34639566/how-to-store-text-internally-in-a-go-program", "title": "How to store text internally in a Go program?", "body": "<blockquote>\n  <p>Software should only work with Unicode strings internally, converting to a particular encoding on output.</p>\n</blockquote>\n\n<p>-- <a href=\"https://docs.python.org/2/howto/unicode.html#tips-for-writing-unicode-aware-programs\" rel=\"nofollow\">Python Docs</a></p>\n\n<p>The above quote is from the Python docs. Python has a unicode string type so this makes sense. Go doesn't have unicode strings. As strings are just an immutable byte slice. What would be the equivalent quote for Go?</p>\n\n<p>Would it be to convert text to utf-8 on entry to the program and store as utf-8 internally, and then output utf-8?</p>\n"}, {"tags": ["go", "unique", "google-bigquery"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1452103885, "post_id": 34639372, "comment_id": 57025039, "body": "Use tabledata&#39;s list method with a filter to check if the entries exist already. Basically, do a select, if you get something back then don&#39;t insert the corresponding record, if you don&#39;t then it&#39;s new and you can safely insert."}, {"owner": {"reputation": 13, "user_id": 5708616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/933920f2c2e5d13a04247ea610b402c4?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5708616/kevin"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1452106518, "post_id": 34639372, "comment_id": 57026685, "body": "Cant really do that. It creates an expense."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1452106673, "post_id": 34639372, "comment_id": 57026781, "body": "Without the field having a primary key constraint to prevent the insert, there is no way you can ensure uniqueness without increasing the cost of insert. There&#39;s no way around checking whether or not the record exists."}, {"owner": {"reputation": 13, "user_id": 5708616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/933920f2c2e5d13a04247ea610b402c4?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5708616/kevin"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1452268415, "post_id": 34639372, "comment_id": 57107526, "body": "Thanks Evan. I think I have to choose not to avoid duplicates."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 5708616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/933920f2c2e5d13a04247ea610b402c4?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5708616/kevin"}, "edited": false, "score": 0, "creation_date": 1452105610, "post_id": 34639912, "comment_id": 57026095, "body": "Thank you for answering me. Do you mean that I need to create a new table and copy rows from one to the other? That will cause some querying expenses"}, {"owner": {"reputation": 115571, "user_id": 5221944, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/iqXab.png?s=128&g=1", "display_name": "Mikhail Berlyant", "link": "https://stackoverflow.com/users/5221944/mikhail-berlyant"}, "reply_to_user": {"reputation": 13, "user_id": 5708616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/933920f2c2e5d13a04247ea610b402c4?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5708616/kevin"}, "edited": false, "score": 0, "creation_date": 1452108859, "post_id": 34639912, "comment_id": 57028151, "body": "I think, uniqueness check will incur extra querying expenses no matter what final option you will use"}, {"owner": {"reputation": 13, "user_id": 5708616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/933920f2c2e5d13a04247ea610b402c4?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5708616/kevin"}, "edited": false, "score": 0, "creation_date": 1452268474, "post_id": 34639912, "comment_id": 57107569, "body": "Thanks Mikhail. I don&#39;t think I should do uniqueness anymore then."}], "tags": [], "owner": {"reputation": 115571, "user_id": 5221944, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/iqXab.png?s=128&g=1", "display_name": "Mikhail Berlyant", "link": "https://stackoverflow.com/users/5221944/mikhail-berlyant"}, "is_accepted": true, "score": 2, "last_activity_date": 1452104035, "creation_date": 1452104035, "answer_id": 34639912, "question_id": 34639372, "link": "https://stackoverflow.com/questions/34639372/golang-bigquery-check-unique-key-before-inserting/34639912#34639912", "title": "Golang: Bigquery Check Unique Key before Inserting", "body": "<p>In BigQuery, there is no any API or Function to specifically do uniqueness check of given field<br>\nYou can meet your requirements by constructing your insert as join of source with destination and insert only unique ones<br>\nThis might require you first to insert your data into \u201ctemp\u201d table and then do above join in GBQ  </p>\n"}, {"comments": [{"owner": {"reputation": 991, "user_id": 1061927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc0ad4a66f66d793ea39a35ddacbcb45?s=128&d=identicon&r=PG", "display_name": "Dynom", "link": "https://stackoverflow.com/users/1061927/dynom"}, "edited": false, "score": 0, "creation_date": 1516796479, "post_id": 46516870, "comment_id": 83834120, "body": "However do note that the InsertID is potentially short-lived (the documentation guarantees at least one minute). So there is a fair chance that inserting with the same InsertID some time after that, won&#39;t actually be deduplicated (@see <a href=\"https://cloud.google.com/bigquery/streaming-data-into-bigquery\" rel=\"nofollow noreferrer\">cloud.google.com/bigquery/streaming-data-into-bigquery</a>)"}], "tags": [], "owner": {"reputation": 585, "user_id": 1351845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27c99f53a3d404b190dee9200fb471f5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Bauer", "link": "https://stackoverflow.com/users/1351845/vladimir-bauer"}, "is_accepted": false, "score": 0, "last_activity_date": 1506891762, "creation_date": 1506891762, "answer_id": 46516870, "question_id": 34639372, "link": "https://stackoverflow.com/questions/34639372/golang-bigquery-check-unique-key-before-inserting/46516870#46516870", "title": "Golang: Bigquery Check Unique Key before Inserting", "body": "<p>Check the doc for <a href=\"https://godoc.org/cloud.google.com/go/bigquery#StructSaver\" rel=\"nofollow noreferrer\">StructSaver</a> struct.</p>\n\n<p>It has a field <code>InserdID</code>, exactly for what you're asking:</p>\n\n<pre><code>// If non-empty, BigQuery will use InsertID to de-duplicate insertions\n// of this row on a best-effort basis.\nInsertID string\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 5708616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/933920f2c2e5d13a04247ea610b402c4?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin", "link": "https://stackoverflow.com/users/5708616/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 683, "favorite_count": 1, "accepted_answer_id": 34639912, "answer_count": 2, "score": 1, "last_activity_date": 1506891762, "creation_date": 1452102235, "question_id": 34639372, "link": "https://stackoverflow.com/questions/34639372/golang-bigquery-check-unique-key-before-inserting", "title": "Golang: Bigquery Check Unique Key before Inserting", "body": "<p>I am implementing the insertion to google bigquery using golang.\nThe file has duplicates, and needs to be update everyday. However, the duplicates should not be inserted into the bigquery.\nI use some apis by google cloud platform and golang. However, I have not found any apis can either check if unique before inserting or setting to unique for specific fields in schema.\nI am using a wrapper api and calling the function directly. However, the function does not check if the field is unique. Please suggest any bigquery apis for golang has unique key checking or unique key setting to the schema. Much appreciate! I will update replies immediately.</p>\n"}, {"tags": ["go", "martini"], "comments": [{"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "edited": false, "score": 0, "creation_date": 1452140698, "post_id": 34639199, "comment_id": 57040243, "body": "The router handler should be writing to the ResponseWriter.  Therefore, you need a middleware to access the ResponseWriter before the route writes to it.  I&#39;d suggest negroni (<a href=\"https://github.com/codegangsta/negroni\" rel=\"nofollow noreferrer\">github.com/codegangsta/negroni</a>) for more idiomatic middleware handling."}, {"owner": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "edited": false, "score": 0, "creation_date": 1452470984, "post_id": 34639199, "comment_id": 57171123, "body": "Martini is now abandoned. Try Gin instead"}], "answers": [{"tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": true, "score": 1, "last_activity_date": 1452158655, "creation_date": 1452158655, "answer_id": 34651428, "question_id": 34639199, "link": "https://stackoverflow.com/questions/34639199/what-is-the-called-order-of-the-handlers-in-martini/34651428#34651428", "title": "What is the called order of the handlers in martini?", "body": "<p>As you said, middlewares in Martini and others are called in the order they are defined: first the ones added with use, then the route middlewares, then the route handler. </p>\n\n<p>Here is the middleware example given by the martini documentation:</p>\n\n<pre><code>// log before and after a request\nm.Use(func(c martini.Context, log *log.Logger){\n    log.Println(\"before a request\")\n\n    c.Next()\n\n    log.Println(\"after a request\")\n})\n</code></pre>\n\n<p>According to this, if you have middlewares A and B and the route R, then the call chain will be something like that:</p>\n\n<pre><code>func A() {\n    // Do things before B\n\n    func B() {\n        // Do things before R\n\n        func R() {\n            // Do things in R\n        } ()\n\n        // Do things after R\n    }()\n\n    // Do things after B\n}\n</code></pre>\n\n<p>So depending of what you need, you will need to add code in a middleware before or after the <code>Next()</code>  call.</p>\n"}], "owner": {"reputation": 435, "user_id": 4977258, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/muLxr.jpg?s=128&g=1", "display_name": "Jianglong Chen", "link": "https://stackoverflow.com/users/4977258/jianglong-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "accepted_answer_id": 34651428, "answer_count": 1, "score": 0, "last_activity_date": 1452158655, "creation_date": 1452101686, "last_edit_date": 1452133357, "question_id": 34639199, "link": "https://stackoverflow.com/questions/34639199/what-is-the-called-order-of-the-handlers-in-martini", "title": "What is the called order of the handlers in martini?", "body": "<p>About golang martini</p>\n\n<ul>\n<li>We can add middlewares using m.Use(). Of course, \"Middleware Handlers are invoked in the order that they are added\".  </li>\n<li>In addition, a handler can also be added by router like r.Get(\"/\", handler).</li>\n<li>Sometimes, we also need a handler be called after the router handler. That is a handler is called before something is written to ResponseWriter.</li>\n</ul>\n\n<p>So, how to order of presentation of these handlers? I can not get solution is martini's document.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1452100235, "post_id": 34638717, "comment_id": 57022772, "body": "you can&#39;t (directly, you could implement your own UnmarshalJSON method), and why?"}, {"owner": {"reputation": 26, "user_id": 5489795, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-caVoJPfqG4A/AAAAAAAAAAI/AAAAAAAAEG4/GYfXkOqyH_Q/photo.jpg?sz=128", "display_name": "Max Wayt", "link": "https://stackoverflow.com/users/5489795/max-wayt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1452100550, "post_id": 34638717, "comment_id": 57022989, "body": "Basically I have few struct that I need to serve as json (it&#39;s an API) and store in Elasticsearch. Since ES is using json object, I want (and need) to be able to ignore some field / change their names."}, {"owner": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1452100654, "post_id": 34638717, "comment_id": 57023064, "body": "I don&#39;t think JSON is the proper package to use if you&#39;re writing a custom tag. I&#39;d say create a wrapper to the JSON package and handle any custom tags/functions in that. You can kind of see how it was done for the MongoDB BSON struct if you look at the code and try to reverse engineer it for your purposes: <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Marshal\" rel=\"nofollow noreferrer\">godoc.org/gopkg.in/mgo.v2/bson#Marshal</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1452100682, "post_id": 34638717, "comment_id": 57023086, "body": "See <a href=\"http://stackoverflow.com/questions/26426746/ignore-json-tags-when-marshalling\" title=\"ignore json tags when marshalling\">stackoverflow.com/questions/26426746/&hellip;</a>"}, {"owner": {"reputation": 26, "user_id": 5489795, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-caVoJPfqG4A/AAAAAAAAAAI/AAAAAAAAEG4/GYfXkOqyH_Q/photo.jpg?sz=128", "display_name": "Max Wayt", "link": "https://stackoverflow.com/users/5489795/max-wayt"}, "reply_to_user": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1452101016, "post_id": 34638717, "comment_id": 57023317, "body": "@Verran I&#39;ve though about &quot;forking&quot; the bson library to do that I want, and I think it will be my solution"}, {"owner": {"reputation": 26, "user_id": 5489795, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-caVoJPfqG4A/AAAAAAAAAAI/AAAAAAAAEG4/GYfXkOqyH_Q/photo.jpg?sz=128", "display_name": "Max Wayt", "link": "https://stackoverflow.com/users/5489795/max-wayt"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1452101060, "post_id": 34638717, "comment_id": 57023351, "body": "@CodingPickle the point here is that I want to keep the marshal/unmarshal functions for both tags"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1452104074, "post_id": 34638717, "comment_id": 57025159, "body": "I would take a different approach to this. I personally do not like these types of ideas. Whenever I&#39;m in this situation I either make one object that&#39;s a super set of the fields in both cases and use it everywhere or I create two different structs and methods to convert between the two. Why reinvent that json encoding wheel when you can just call some method called <code>NewApiType(EStype)</code> or <code>NewESType(ApiType)</code> and be done with it?"}], "owner": {"reputation": 26, "user_id": 5489795, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-caVoJPfqG4A/AAAAAAAAAAI/AAAAAAAAEG4/GYfXkOqyH_Q/photo.jpg?sz=128", "display_name": "Max Wayt", "link": "https://stackoverflow.com/users/5489795/max-wayt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3982, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1452152456, "creation_date": 1452100129, "last_edit_date": 1452101122, "question_id": 34638717, "link": "https://stackoverflow.com/questions/34638717/golang-marshal-unmarshal-json-with-a-custom-tag", "title": "Golang Marshal/Unmarshal json with a custom tag", "body": "<p>I want to Marshal / Unmarshal Golang object (json) with a custom tag.</p>\n\n<p>Like</p>\n\n<pre><code>type Foo struct {\n    Bar string `json:\"test\" es:\"bar\"`\n}\n\ndata, _ := json.MarshalWithESTag(Foo{\"Bar\"})\nlog.Println(string(data)) // -&gt; {\"foo\":\"bar\"}\n</code></pre>\n\n<p>In other words, I whan to use the encoding/json library with a different tag here: <a href=\"https://github.com/golang/go/blob/master/src/encoding/json/encode.go#L1033\" rel=\"nofollow\">https://github.com/golang/go/blob/master/src/encoding/json/encode.go#L1033</a></p>\n\n<p>Thanks :)</p>\n"}, {"tags": ["for-loop", "go", "range", "slice"], "answers": [{"comments": [{"owner": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "edited": false, "score": 0, "creation_date": 1452095660, "post_id": 34637016, "comment_id": 57019679, "body": "I indeed thought about that, but when you use ms[i] more then just 2 times, I thought it would be nicer to access the struct directly, in stead of accessing it through the slice all the time, because: A. you&#39;d have to write brackets all the time, and B. In most languages accessing an element in an array takes (a tiny bit of) processing time afaik, which I therefore only want to do once. So in a sense, I&#39;m trying to optimize both code writing time and processing time."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "edited": false, "score": 2, "creation_date": 1452096125, "post_id": 34637016, "comment_id": 57019991, "body": "@coolcat007: You&#39;re optimizing very prematurely. If dereferencing pointers and memory locality make a measurable impact on your program, I think you can deal with the slight inconvenience of the extra index operation. Otherwise use a slice with pointers and get your code working. If you want to do more with the &quot;minion&quot; without indexing, just assign it to a variable and stick it in the slice when you&#39;re done: <code>m := NewMinion(i); ...; ms[i] = m</code>"}, {"owner": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "edited": false, "score": 0, "creation_date": 1452097180, "post_id": 34637016, "comment_id": 57020685, "body": "Thanks for your help. That last suggestion is in my opinion the best solution to this problem. It also helps prevent the unnecessary use of pointers."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "edited": false, "score": 0, "creation_date": 1452098181, "post_id": 34637016, "comment_id": 57021366, "body": "@coolcat007: I think you may have some misconception about pointers here, since my suggestion doesn&#39;t change the use of pointers at all, and is semantically equivalent. Manual dereferencing is rarely needed in Go; perhaps the relevant section of the spec on <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">Selectors</a> may clear things up."}, {"owner": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "edited": false, "score": 0, "creation_date": 1452196426, "post_id": 34637016, "comment_id": 57073381, "body": "No what I meant was that you only dereference the pointer once in <code>ms[i] = m</code>, in stead of dereferencing it multiple times when instantiating the struct and calling the function. However, in my first comment I had forgotten that accessing elements in an array is also basicly dereferencing. Or am I wrong on that last point?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "edited": false, "score": 0, "creation_date": 1452196799, "post_id": 34637016, "comment_id": 57073592, "body": "@coolcat007: yes, you&#39;re wrong there. Assignment is <i>always</i> a copy (and everything in Go is passed by value). <code>ms[i] = m</code> is copying the value of <code>m</code> into <code>ms[i]</code>, and that value happens to be a pointer of type <code>*Minion</code> (if it were dereferenced, it would no longer be the correct type). Indexing into the slice gets you a pointer value back."}, {"owner": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "edited": false, "score": 0, "creation_date": 1452197189, "post_id": 34637016, "comment_id": 57073782, "body": "Ok, then I&#39;m not really wrong, because I was aiming at the ms[i] part, not the actual assignment. Indeed assignment is always a copy, just like in C: you copy the value of the expression on the right (be it a native type/struct/(array)pointer to the variable on the left. And concerning the dereferencing: if in C <code>ms</code> is an array <code>ms[i]</code> would be the same as <code>*(ms + i)</code>. I don&#39;t know if this is also true for slices in Go though."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "edited": false, "score": 0, "creation_date": 1452197339, "post_id": 34637016, "comment_id": 57073856, "body": "@coolcat007: that&#39;s not how slices work in go. It is similar in concept to arrays in Go, but Go has no pointer arithmetic. Note that even in C, dereferencing the array pointer is a separate step from dereferencing a pointer in an array."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1452097962, "last_edit_date": 1452097962, "creation_date": 1452094840, "answer_id": 34637016, "question_id": 34636862, "link": "https://stackoverflow.com/questions/34636862/go-how-to-properly-use-the-for-range-loop/34637016#34637016", "title": "Go how to properly use the for ... range loop", "body": "<p>Your first example is a slice of pointers, you don't need to take the address of the pointers in the slice and then dereference the pointers each time. More idiomatic Go would look like (edited slightly to run in the playground without the \"minion\" package):</p>\n\n<p><a href=\"http://play.golang.org/p/88WsCVonaL\" rel=\"nofollow\">http://play.golang.org/p/88WsCVonaL</a></p>\n\n<pre><code>// creating the slice\nms := make([]*Minion, 2)\n\n//populating the slice and make the elements start doing something\nfor i := range ms {\n    ms[i] = NewMinion(i)\n    ms[i].Start()\n\n    // (or equivalently) \n    // m := MewMinion(i)\n    // m.Start()\n    // ms[i] = m\n}\n\n// wait while the minions do all the work\ntime.Sleep(time.Millisecond * 500)\n\n// make the elements of the slice stop with what they were doing\nfor _, m := range ms {\n    m.Stop()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "edited": false, "score": 1, "creation_date": 1452095053, "post_id": 34637029, "comment_id": 57019251, "body": "I presume you mean ms[i], not m[i]? Because m is not a slice"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1452101704, "last_edit_date": 1452101704, "creation_date": 1452094873, "answer_id": 34637029, "question_id": 34636862, "link": "https://stackoverflow.com/questions/34636862/go-how-to-properly-use-the-for-range-loop/34637029#34637029", "title": "Go how to properly use the for ... range loop", "body": "<p>This is all wrong.</p>\n\n<p>There is absolutely no need to take the address of a pointer in your code. <code>ms</code> is a slice of pointers and you constructor returns a pointer so just assign i directly:</p>\n\n<pre><code>for i := range ms  {\n    ms[i] = minion.NewMinion()\n    ms[i].Start()\n}\n</code></pre>\n\n<p>Dead simple.</p>\n"}], "owner": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 34637016, "answer_count": 2, "score": 1, "last_activity_date": 1452101704, "creation_date": 1452094331, "question_id": 34636862, "link": "https://stackoverflow.com/questions/34636862/go-how-to-properly-use-the-for-range-loop", "title": "Go how to properly use the for ... range loop", "body": "<p>At the moment I have a go program that contains the following code.</p>\n\n<pre><code>package main\n\nimport \"time\"\nimport \"minions/minion\"\n\nfunc main() {\n    // creating the slice\n    ms := make([]*minion.Minion, 2)\n\n    //populating the slice and make the elements start doing something\n    for i := range ms  {\n        m := &amp;ms[i]\n        *m = minion.NewMinion()\n        (*m).Start()\n    }\n\n    // wait while the minions do all the work\n    time.Sleep(time.Millisecond * 500)\n\n    // make the elements of the slice stop with what they were doing\n    for i := range ms {\n        m := &amp;ms[i]\n        (*m).Stop()\n    }\n}\n</code></pre>\n\n<p>Here <code>NewMinion()</code> is a constructor that returns a <code>*minion.Minion</code></p>\n\n<p>The code works perfectly, but having to write <code>m := &amp;ms[i]</code> every time I use a <code>for ... range</code> loop seems to me like there should be a code writer friendlier way to tackle this problem.</p>\n\n<p>Ideally I'd like something like the following to be possible (using the made up &amp;range tag):</p>\n\n<pre><code>package main\n\nimport \"time\"\nimport \"minions/minion\"\n\nfunc main() {\n    // creating the slice\n    ms := make([]*minion.Minion, 2)\n\n    //populating the slice and make the elements start doing something\n    for _, m := &amp;range ms  {\n        *m = minion.NewMinion()\n        (*m).Start()\n    }\n\n    // wait while the minions do all the work\n    time.Sleep(time.Millisecond * 500)\n\n    // make the elements of the slice stop with what they were doing\n    for _, m := &amp;range ms {\n        (*m).Stop()\n    }\n}\n</code></pre>\n\n<p>Unfortunately, this is not a language feature as of yet. Any considerations on what would be the nicest way remove the <code>m := &amp;ms[i]</code> from the code? Or is there no way yet that takes less effort to write than this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1452094167, "post_id": 34636734, "comment_id": 57018613, "body": "I would recommend not doing this; use a <a href=\"https://golang.org/ref/spec#Map_types\" rel=\"nofollow noreferrer\">map</a> instead."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1452094205, "post_id": 34636734, "comment_id": 57018635, "body": "Ok - could you give me an idea of what you&#39;ve thinking in an answer?"}], "answers": [{"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1452094834, "post_id": 34636920, "comment_id": 57019098, "body": "A nice, clean solution - much appreciated!"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1452094529, "creation_date": 1452094529, "answer_id": 34636920, "question_id": 34636734, "link": "https://stackoverflow.com/questions/34636734/dynamic-identifiers-for-struct-properties/34636920#34636920", "title": "Dynamic identifiers for struct properties", "body": "<p>Performing reflection on the struct in order to fill-in the correct field seems like overkill, in this case.</p>\n\n<p>I would recommend having a map field in your <code>User</code> struct to hold all of the social IDs. Example:</p>\n\n<pre><code>type User struct {\n    Name string\n    IDs  map[string]string\n}\n\nfunc NewUser() *User {\n   return &amp;User{\n       IDs: make(map[string]string),\n   }\n}\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>provider := \"github\" // could be facebook or google too\nid := \"12345\"\n\nuser := NewUser()\nuser.Name = \"Bob\"\nuser.IDs[provider] = id\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 34636920, "answer_count": 1, "score": 0, "last_activity_date": 1452094529, "creation_date": 1452093931, "last_edit_date": 1452094375, "question_id": 34636734, "link": "https://stackoverflow.com/questions/34636734/dynamic-identifiers-for-struct-properties", "title": "Dynamic identifiers for struct properties", "body": "<p>A user has a number of id fields - one for each type of social login:</p>\n\n<pre><code>type User struct {\n    Name         string\n    Github_id    string\n    Facebook_id  string\n    Google_id    string\n}\n</code></pre>\n\n<p>I have variables that store the <code>provider</code> and <code>id</code>:</p>\n\n<pre><code>provider := \"github\" //could be facebook or google too\nid := \"12345\"\n</code></pre>\n\n<p>and a user:</p>\n\n<pre><code>var user User\nuser.Name = \"Bob\"\n</code></pre>\n\n<p>but how can I assign the id to the correct property? I've tried:</p>\n\n<pre><code>if provider == \"github\" {\n    field := \"Github_id\"\n    user.field = id //and also user[field] = id\n}\n</code></pre>\n\n<p>but no success so far.</p>\n\n<p><strong>Additional Note</strong></p>\n\n<p>My users may have multiple social login accounts so I can't just use a single <code>social_id</code> property as a solution to this problem.</p>\n"}, {"tags": ["http", "go", "file-descriptor"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1452093578, "post_id": 34636517, "comment_id": 57018201, "body": "Don&#39;t use <code>ab</code>. It&#39;s a poor and outdated http load tester. Use something that at least has support for http/1.1."}, {"owner": {"reputation": 3594, "user_id": 1271094, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d46e27aa6299242feaf8f734fb2f7d71?s=128&d=identicon&r=PG", "display_name": "MK Yung", "link": "https://stackoverflow.com/users/1271094/mk-yung"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1452097277, "post_id": 34636517, "comment_id": 57020743, "body": "Thanks @JimB. I have switched to <code>wrk</code> and it worked fine. But do you have any ideas on the <code>Accept Error...</code>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1452097783, "post_id": 34636517, "comment_id": 57021113, "body": "The error comes from the OS, and is exactly what it says: <code>too many open files</code>. I can&#39;t say for sure without knowing exactly what you&#39;re doing, but I presume the sockets just aren&#39;t being closed fast enough too keep pace with the new incoming connections"}], "owner": {"reputation": 3594, "user_id": 1271094, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d46e27aa6299242feaf8f734fb2f7d71?s=128&d=identicon&r=PG", "display_name": "MK Yung", "link": "https://stackoverflow.com/users/1271094/mk-yung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 238, "favorite_count": 0, "closed_date": 1452093657, "answer_count": 0, "score": 0, "last_activity_date": 1452093339, "creation_date": 1452093339, "question_id": 34636517, "link": "https://stackoverflow.com/questions/34636517/simple-golang-http-server-gets-stuck-after-number-of-requests", "closed_reason": "Duplicate", "title": "Simple golang HTTP server gets stuck after number of requests", "body": "<p><strong>Background</strong></p>\n\n<p>I have a website written in Golang that throws: </p>\n\n<p><code>http: Accept error: accept tcp [::]:8080: accept4: too many open files; retrying in 1s\n...\n...</code></p>\n\n<p>on CentOS (Production) and then do not accept any more connection. \nStress test using <code>ApacheBench</code> also stuck at around the 16500th request on my testing machine (OSX, timeout as well but without this error). </p>\n\n<hr>\n\n<p>I decided to make a minimal case on OSX. </p>\n\n<p>I adapted the following code from <a href=\"https://golang.org/doc/articles/wiki/\" rel=\"nofollow\">https://golang.org/doc/articles/wiki/</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi there, I love %s!\", r.URL.Path[1:])\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>I ran <code>ab -n 100000 -c 100 -s 10 http://localhost:8080</code> but its also stuck at around 16500th request.</p>\n\n<p>I have tried raising file descriptor limit <code>ulimit</code> from 256 to 10000 by <code>ulimit -n 10000</code>. Things did not improve.</p>\n\n<p>Is there any <code>close()</code> that I should call?</p>\n"}, {"tags": ["c++", "design-patterns", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1452098718, "post_id": 34636455, "comment_id": 57021701, "body": "Go does not have inheritance, so type hierarchies are usually something you want to avoid. C++/Java design patterns don&#39;t fit well to the structural types and composition used in Go."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1452123900, "post_id": 34636455, "comment_id": 57035807, "body": "Do a search for embedding in Go and read up on the recommended design patterns. As JimB said you&#39;ll want to rethink the design a little, the simplest way from me to describe it is that the inheritance relationship is inverted. You never inherit, you only compose/embed. In addition to that, when you&#39;d achieve polymorphic behavior using a parent type like iterating <code>[]ParentType</code> and calling <code>MethodThatsOverriden()</code> instead you&#39;ll need to define an interface and use it."}], "answers": [{"comments": [{"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "edited": false, "score": 0, "creation_date": 1452095465, "post_id": 34636667, "comment_id": 57019525, "body": "Would this allow me to, for example, have a list of Edibles, and retrieve the name of each instance without worrying about whether it&#39;s a Fruit or a Meat? I presume that adding GetName() to the Edible interface would do this, correct?"}, {"owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "reply_to_user": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "edited": false, "score": 0, "creation_date": 1452099024, "post_id": 34636667, "comment_id": 57021922, "body": "If you wanted to do it that way, yes you&#39;d need to add <code>GetName()</code> to the editable interface. Or perhaps simply something that returned a pointer to <code>EditableName</code> or whatever you have your common stuff in (<code>EdibleItem</code> perhaps)."}, {"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "edited": false, "score": 0, "creation_date": 1452102620, "post_id": 34636667, "comment_id": 57024335, "body": "In the actual implementation, I have more than one way for the top level interface to access the values of the attributes, so a method is definitely the way to go. Thanks much for the answer. This is just what I was missing. I knew it couldn&#39;t be the case that Go doesn&#39;t provide a mechanism something this fundamental."}], "tags": [], "owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "is_accepted": true, "score": 1, "last_activity_date": 1452093740, "creation_date": 1452093740, "answer_id": 34636667, "question_id": 34636455, "link": "https://stackoverflow.com/questions/34636455/idiomatic-go-equivalent-to-subclasses/34636667#34636667", "title": "Idiomatic Go equivalent to subclasses", "body": "<p>In this instance, you could have an <code>Edible</code> interface, and <code>type Fruit struct</code> and <code>type Meat struct</code> which each implemented them. Each of those could also be composed such that it contained an <code>EdibleName</code> which would provide the methods and storage space to set / get the name.</p>\n\n<p>e.g.</p>\n\n<pre><code>type Edible interface {\n    eat() int // common method\n}\n\ntype EdibleName struct {\n    name string\n}\n\n// NB getters and setters may not be idiomatic\nfunc (n *EdibleName) getName() string {\n    return n.name\n}\n\nfunc (n *EdibleName) setName(name string) {\n    n.name = name\n}\n\ntype Fruit struct {\n    pips int\n    EdibleName\n}\n\nfunc (f *Fruit) eat() int {\n    // ...\n    return 0\n}\n\ntype Meat struct {\n    animal int\n    EdibleName\n}\n\nfunc (m *Meat) eat() int {\n    animal int\n    return 0\n}\n</code></pre>\n"}], "owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 34636667, "answer_count": 1, "score": 1, "last_activity_date": 1452123720, "creation_date": 1452093185, "last_edit_date": 1452123720, "question_id": 34636455, "link": "https://stackoverflow.com/questions/34636455/idiomatic-go-equivalent-to-subclasses", "title": "Idiomatic Go equivalent to subclasses", "body": "<p>I have a lot more experience in C++ than Go. I'm trying to understand how the <a href=\"https://sourcemaking.com/design_patterns/composite\" rel=\"nofollow\">Composite design pattern</a> is expressed idiomatically in Go, in particular with reference to attributes. In C++, I'd use a parent class to hold attributes and methods that are common to a set of subclasses. I'm not seeing how this works in Go. An interface lets me define which methods to implement, but it doesn't let me provide a default implementation. I have to reimplement the method in every struct that implements the interface, and replicate all of the attributes in each struct. I can't keep common attributes in an interface, because interfaces don't have data elements. How do you do this sort of refactoring in Go?</p>\n\n<p>Here's an example (in C++) of what I'd like to be able to do in Go:</p>\n\n<pre><code>#include &lt;string&gt;\n\n/*\n * Parent class for edible things. Holds the \"name\" attribute.\n */\n\nclass Edible {\npublic:\n        Edible(const std::string &amp;aName):\n                ed_Name(aName) { }\n        const std::string &amp;name() const { return ed_Name; }\n\nprotected:\n        void setName(const std::string &amp;aName) { ed_Name = aName; }\n\nprivate:\n        std::string ed_Name;\n};\n\n/*\n * Subclass of Edible for fruits. Depends on Edible to store the name.\n */\n\nclass Fruit: public Edible {\npublic:\n        Fruit(const std::string &amp;aName,\n              const std::string &amp;aPlant):\n                Edible(aName),\n                fr_Plant(aPlant) { }\n        const std::string &amp;plant() const { return fr_Plant; }\n\nprotected:\n        void setPlant(const std::string &amp;aPlant) { fr_Plant = aPlant; }\n\nprivate:\n        std::string fr_Plant;\n};\n\n/*\n * Subclass of Edible for meats. Depends on Edible to store the name.\n * Has attributes for the animal and the cut of meat.\n */\n\nclass Meat: public Edible {\npublic:\n        Meat(const std::string &amp;aName,\n             const std::string &amp;aAnimal,\n             const std::string &amp;aCut):\n                Edible(aName),\n                me_Animal(aAnimal),\n                me_Cut(aCut) { }\n        const std::string &amp;animal() const { return me_Animal; }\n        const std::string &amp;cut() const { return me_Cut; }\nprotected:\n        void setAnimal(const std::string &amp;aAnimal) { me_Animal = aAnimal; }\n        void setCut(const std::string &amp;aCut) { me_Cut = aCut; }\nprivate:\n        std::string me_Animal;\n        std::string me_Cut;\n};\n</code></pre>\n"}, {"tags": ["pointers", "struct", "go", "slice"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1452089738, "post_id": 34635227, "comment_id": 57015485, "body": "You can&#39;t; Go types are invariant, and there are no generics. You create a slice of the type you need when you need it. Can you give an example why you would need this?"}, {"owner": {"reputation": 1781, "user_id": 4515566, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bOOZ7.jpg?s=128&g=1", "display_name": "arainone", "link": "https://stackoverflow.com/users/4515566/arainone"}, "edited": false, "score": 0, "creation_date": 1452090052, "post_id": 34635227, "comment_id": 57015691, "body": "Perhaps you should first try to write such a function and make it work for a slice of <code>integers</code> only, for example. Then your <code>AnyType</code> should be an empty interface (<code>interface{}</code>) i guess, in case you want to support different types. Also can you show us a bit code, so that we can specifically help with what you&#39;re having problems."}, {"owner": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "edited": false, "score": 0, "creation_date": 1452090083, "post_id": 34635227, "comment_id": 57015716, "body": "I am trying to make this because the <code>for ... range</code> returns a copy of the elements in the given slice.  If I want to change my elements I&#39;d normally need to use a normal for loop and fetch the element from the index <code>e = &amp;slice[idx]</code>. It would however be easier if I could get the pointer array and use the elements by reference"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1452090546, "post_id": 34635227, "comment_id": 57016032, "body": "@coolcat007: this is why <code>for ... range</code> returns an index as the first parameter, so you can index into your slice instead of making a copy. <a href=\"http://play.golang.org/p/f5ZY3-npaB\" rel=\"nofollow noreferrer\">play.golang.org/p/f5ZY3-npaB</a>"}, {"owner": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1452090776, "post_id": 34635227, "comment_id": 57016167, "body": "@JimB Yes, I know that, but having to get the element from the original array every time you use it, or in every <code>for ... range</code> loop having to type <code>elem = &amp;slice[idx]</code> gets old really fast. This PointerOf function is already a headache, where I&#39;d really like to see a <code>for ... &amp;range</code> loop in the language by default"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1452090886, "post_id": 34635227, "comment_id": 57016248, "body": "Go strives to never have hidden complexity, and your conversion requires an extra allocation and an O(n) copy. If you need to have a pointer to a value, you should always start with a pointer, i.e. your slice should be <code>[]*SomeStruct</code> from the start."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1452114029, "last_edit_date": 1452114029, "creation_date": 1452095495, "answer_id": 34637234, "question_id": 34635227, "link": "https://stackoverflow.com/questions/34635227/return-array-of-pointers-from-an-array-in-go/34637234#34637234", "title": "return array of pointers from an array in Go", "body": "<p>Use the following code to loop through a slice of structs setting a field. There's no need to create a slice of pointers.</p>\n\n<pre><code>type SomeStruct struct {\n  x int\n}\n\nfunc main() {\n  strSlice := make([]SomeStruct, 5)\n  for i := range strSlice {\n    strSlice[i].x = 5\n  }\n}\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/f5ZY3-npaB\" rel=\"nofollow\">playground example</a></kbd></p>\n\n<p>Here's the proposed PointersOf function:</p>\n\n<pre><code>func PointersOf(v interface{}) interface{} {\n  in := reflect.ValueOf(v)\n  out := reflect.MakeSlice(reflect.SliceOf(reflect.PtrTo(in.Type().Elem())), in.Len(), in.Len())\n  for i := 0; i &lt; in.Len(); i++ {\n    out.Index(i).Set(in.Index(i).Addr())\n  }\n  return out.Interface()\n}\n</code></pre>\n\n<p>and here's how to use it:</p>\n\n<pre><code>for _, elem := range PointersOf(strSlice).([]*SomeStruct) {\n    elem.x = 5\n}\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/zogM3dYj4R\" rel=\"nofollow\">playground example</a></kbd></p>\n"}], "owner": {"reputation": 983, "user_id": 2877358, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e5ddf2c6f8bcde2a6bcc2a61bd5b6c08?s=128&d=identicon&r=PG&f=1", "display_name": "Rik Schaaf", "link": "https://stackoverflow.com/users/2877358/rik-schaaf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4564, "favorite_count": 0, "accepted_answer_id": 34637234, "answer_count": 1, "score": 1, "last_activity_date": 1452114029, "creation_date": 1452089583, "last_edit_date": 1452092720, "question_id": 34635227, "link": "https://stackoverflow.com/questions/34635227/return-array-of-pointers-from-an-array-in-go", "title": "return array of pointers from an array in Go", "body": "<p>Just so you know, I am quite new to Go.</p>\n\n<p>I have been trying to make a function like this:</p>\n\n<pre><code>func PointersOf(slice []AnyType) []*AnyType{\n    //create an slice of pointers to the elements of the slice parameter\n}\n</code></pre>\n\n<p>It is like doing <code>&amp;slice[idx]</code> for all elements in the slice, but I am having trouble with how to type my parameters and return type, as well as how to create the slice itself.</p>\n\n<p>This method needs to work for slices of built-in types, as well as for slices of structs and slices of pointers to built-in types/structs</p>\n\n<p>After invoking this function it would be preferable if I don't have to cast the pointer slice</p>\n\n<hr>\n\n<p><strong>Edit:</strong>\nThe reason why I need this method is to have a generic way to use the elements of an array in a for ... range loop, in stead of using copies of that element. Consider:</p>\n\n<pre><code>type SomeStruct struct {\n    x int\n}\n\nfunc main() {\n    strSlice := make([]SomeStruct, 5)\n    for _, elem := range strSlice {\n        elem.x = 5\n    }\n}\n</code></pre>\n\n<p>This Doesn't work, because elem is a copy of the strSlice element.</p>\n\n<pre><code>type SomeStruct struct {\n    x int\n}\n\nfunc main() {\n    strSlice := make([]SomeStruct, 5)\n    for _, elem := range PointersOf(strSlice) {\n        (*elem).x = 5\n    }\n}\n</code></pre>\n\n<p>This however should work, since you only copy the pointer that points to an element in the original array.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 355, "user_id": 6874596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5wmL8.png?s=128&g=1", "display_name": "vadasambar", "link": "https://stackoverflow.com/users/6874596/vadasambar"}, "edited": false, "score": 0, "creation_date": 1601449283, "post_id": 34633601, "comment_id": 113407873, "body": "Note that both <code>file</code> and <code>err</code> need to declared beforehand to use <code>=</code> in the if statement. If you declare <code>file</code> before the <code>if</code> and expect <code>if file, err := someFunc()</code> to use the <code>file</code> you declared before, it won&#39;t work (you&#39;ll get <code>file declared but not used</code> error) and if you do <code>if file, err = someFunc()</code> that won&#39;t work either because <code>err</code> is not defined."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 2, "last_activity_date": 1452084602, "creation_date": 1452084602, "answer_id": 34633601, "question_id": 34633547, "link": "https://stackoverflow.com/questions/34633547/go-scope-with-conditional-statements-if-issue/34633601#34633601", "title": "Go scope with conditional statements (if) issue", "body": "<p>Use <code>=</code> instead of <code>:=</code>:</p>\n\n<pre><code>    file, err = xlsx.OpenFile(fileName) // &lt;-- line 24\n    sheet = file.Sheets[0] // &lt;-- line 25\n</code></pre>\n\n<p>Go allows re-declaring variables with the same name in nested blocks. <code>:=</code> declares a new variable. In your case both <code>err</code> and <code>sheet</code> are declared inside else block but are not used there.</p>\n"}, {"comments": [{"owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 0, "creation_date": 1452084875, "post_id": 34633679, "comment_id": 57012204, "body": "Thank you for the link, I misunderstood the <code>=</code> and <code>:=</code> principle."}], "tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": false, "score": 2, "last_activity_date": 1452084804, "creation_date": 1452084804, "answer_id": 34633679, "question_id": 34633547, "link": "https://stackoverflow.com/questions/34633547/go-scope-with-conditional-statements-if-issue/34633679#34633679", "title": "Go scope with conditional statements (if) issue", "body": "<p><strong>TL;DR:</strong> Use <code>=</code> for pure assignments. <code>:=</code> declares a new variable.</p>\n\n<p><code>sheet := file.Sheets[0]</code> declares a new variable within the scope of the <code>else</code> block (see the chapter <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow\">\"Short variable declaration\" from the language spec</a>). This variable shadows the variable of the same name declared in the outer scope and will not exist in the outer scope (<a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow\">see the documentation</a>):</p>\n\n<blockquote>\n  <p>The scope of a constant or variable identifier declared inside a function begins at the end of the ConstSpec or VarSpec (ShortVarDecl for short variable declarations) and ends at the end of the innermost containing block.</p>\n</blockquote>\n\n<p>So the variable <code>sheet</code> in line 25 and the variable <code>sheet</code> in lines 12 and 28 are actually <strong>two different variables</strong> (with the first one declared in line 25 never being used after assignment).</p>\n"}], "owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 600, "favorite_count": 0, "accepted_answer_id": 34633601, "answer_count": 2, "score": 1, "last_activity_date": 1452084804, "creation_date": 1452084451, "last_edit_date": 1495539193, "question_id": 34633547, "link": "https://stackoverflow.com/questions/34633547/go-scope-with-conditional-statements-if-issue", "title": "Go scope with conditional statements (if) issue", "body": "<p>I'm new to Go and I'm struggling with scope (as <a href=\"https://stackoverflow.com/questions/21481288/variable-not-declared-inside-a-if-else-statement\">others</a>).</p>\n\n<p>The code below generates:</p>\n\n<pre><code>./excel.go:24: err declared and not used\n./excel.go:25: sheet declared and not used\n</code></pre>\n\n<p><strong><em>Why does this happen? I have declared both <code>err</code> and <code>sheet</code> in the parent scope, haven't I?</em></strong></p>\n\n<p>Excel.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"fmt\"\n    \"github.com/tealeg/xlsx\"\n)\n\nfunc main() {\n    var file *xlsx.File\n    var sheet *xlsx.Sheet\n    var row *xlsx.Row\n    var cell *xlsx.Cell\n    var err error\n\n    fileName := \"MyXLSXFile.xlsx\"\n\n    if _, err := os.Stat(fileName); os.IsNotExist(err) {\n        fmt.Printf(\"File does not exist so create one\");\n        file = xlsx.NewFile()\n        sheet, err = file.AddSheet(\"Sheet1\")\n    } else {\n        fmt.Printf(\"File exists so open\");\n        file, err := xlsx.OpenFile(fileName) // &lt;-- line 24\n        sheet := file.Sheets[0] // &lt;-- line 25\n    }\n\n    row = sheet.AddRow()\n\n    cell = row.AddCell()\n    cell.Value = \"I am a cell!\"\n    cell = row.AddCell()\n    cell.Value = \"I am another cell!\"\n\n    err = file.Save(fileName)\n\n    if err != nil {\n        fmt.Printf(\"help\")\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2025, "user_id": 1359137, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/1da62381332ae241f4a28acf7c2f5f52?s=128&d=identicon&r=PG", "display_name": "Animesh Kumar Paul", "link": "https://stackoverflow.com/users/1359137/animesh-kumar-paul"}, "is_accepted": false, "score": 1, "last_activity_date": 1452081323, "creation_date": 1452081323, "answer_id": 34632540, "question_id": 34632466, "link": "https://stackoverflow.com/questions/34632466/how-to-access-global-variables-declared-in-parent-package-from-sub-packages/34632540#34632540", "title": "how to access global variables declared in parent package from sub-packages?", "body": "<p>I think you can access it by <code>models.DB</code> from user.go file</p>\n"}], "owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2561, "favorite_count": 1, "closed_date": 1452081633, "answer_count": 1, "score": 1, "last_activity_date": 1452081323, "creation_date": 1452081118, "question_id": 34632466, "link": "https://stackoverflow.com/questions/34632466/how-to-access-global-variables-declared-in-parent-package-from-sub-packages", "closed_reason": "Duplicate", "title": "how to access global variables declared in parent package from sub-packages?", "body": "<p>So lets say i have the following package structure\n<code>\n----models\n----------user\n----------message\n</code></p>\n\n<p>the <code>models</code> package would have the file <code>index.go</code> that looks something like this</p>\n\n<pre><code>package models\n\nimport \"database/sql\"\n\nvar DB *sql.DB\n</code></pre>\n\n<p>and <code>user</code> package would have a file user.go that looks like this</p>\n\n<pre><code> package user\n\n type User struct {\n     ID uint64\n     Username string\n }\n\n func One(username string) *User {\n\n // get user from database and return\n\n }\n</code></pre>\n\n<p><strong>how do i access the <code>DB</code> variable declared in <code>index.go</code> from the <code>user</code> package?</strong></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1603786"}, "edited": false, "score": 0, "creation_date": 1452097771, "post_id": 34632163, "comment_id": 57021107, "body": "The map implementation that I&#39;ve mentioned does exactly the same - a regular map with a RWMutex. But what can you say about channels vs. thread-safe containers in general? Thanks for your answer!"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1452101023, "post_id": 34632163, "comment_id": 57023326, "body": "The map implementations you mentioned tries to be more scalable by splitting the keys into multiple shards and using a single RWMutex per shard. It is not very clear if the goal has been achieved though, there are no benchmarks showing that it scales better under concurrent access."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1452101715, "post_id": 34632163, "comment_id": 57023748, "body": "channels, locks, atomic variables, thread-safe collections are just tools to achieve your goals. There are use cases for all of them, depending on your requirements. And remember that sometimes a single-threaded program is the fastest ;)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1603786"}, "edited": false, "score": 0, "creation_date": 1452111444, "post_id": 34632163, "comment_id": 57029819, "body": "Thank you for your time, you&#39;re being very helpful, and I indeed should pay more attention to the code I show people :) but can you please in sake of additional clarification highlight a few cases where channels are at their best?"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1452123924, "post_id": 34632163, "comment_id": 57035817, "body": "Read for example <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">blog.golang.org/pipelines</a>, <a href=\"http://talks.golang.org/2012/concurrency.slide#1\" rel=\"nofollow noreferrer\">talks.golang.org/2012/concurrency.slide#1</a>, <a href=\"http://blog.golang.org/advanced-go-concurrency-patterns\" rel=\"nofollow noreferrer\">blog.golang.org/advanced-go-concurrency-patterns</a>"}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 1, "last_activity_date": 1452080121, "creation_date": 1452080121, "answer_id": 34632163, "question_id": 34631561, "link": "https://stackoverflow.com/questions/34631561/should-goroutine-channel-based-mechanism-replace-a-concurrent-map/34632163#34632163", "title": "Should goroutine/channel-based mechanism replace a concurrent map?", "body": "<p>Start with the simplest approach: a map and RWMutex.</p>\n\n<p>I cannot recommend using concurrency library unless it is widely used and tested (see <a href=\"https://github.com/streamrail/concurrent-map/issues/6\" rel=\"nofollow\">https://github.com/streamrail/concurrent-map/issues/6</a> for example).</p>\n\n<p>Note that even if you use github.com/streamrail/concurrent-map you will still need to implement your own synhronisation (use RWMutex) in the following scenario:</p>\n\n<pre><code>if _, ok = m[k]; !ok {\n   m[k] = newPlayer()\n}\n</code></pre>\n\n<p>If your game is super popular and played by many players you will find that this  approach doesn't scale but I would worry about it only if it becomes a problem.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1603786"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 34632163, "answer_count": 1, "score": 0, "last_activity_date": 1452080121, "creation_date": 1452078270, "question_id": 34631561, "link": "https://stackoverflow.com/questions/34631561/should-goroutine-channel-based-mechanism-replace-a-concurrent-map", "title": "Should goroutine/channel-based mechanism replace a concurrent map?", "body": "<p>There's a <code>map[PlayerId]Player</code> to check whether player is online and perform state alterations knowing his ID. This must be done from multiple goroutines concurrently.</p>\n\n<p>For now I plan to use <a href=\"https://github.com/streamrail/concurrent-map*\" rel=\"nofollow\">streamrail's concurrent map</a>, but what about a regular map and synchronization using channels?</p>\n\n<ul>\n<li>Should it always be preferred in Go?</li>\n<li>Should it be preferred in certain circumstances?</li>\n<li>Are they basically just two ways to accomplish the same thing?</li>\n</ul>\n\n<p>BTW, I know the slogan:</p>\n\n<blockquote>\n  <p>don't communicate by sharing memory share memory by communicating</p>\n</blockquote>\n\n<p>but there are locking mechanisms in stdlib and no words in docs about not using them at all.</p>\n"}, {"tags": ["go", "time-series", "opentsdb"], "comments": [{"owner": {"reputation": 3330, "user_id": 1075324, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/750Qe.jpg?s=128&g=1", "display_name": "Abhijeet Kasurde", "link": "https://stackoverflow.com/users/1075324/abhijeet-kasurde"}, "edited": false, "score": 1, "creation_date": 1452080380, "post_id": 34631468, "comment_id": 57009456, "body": "Have you tried this <a href=\"https://github.com/bodji/gopentsdb\" rel=\"nofollow noreferrer\">github.com/bodji/gopentsdb</a> ?"}, {"owner": {"reputation": 818, "user_id": 4238326, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/5j2E9.jpg?s=128&g=1", "display_name": "vanarajcs", "link": "https://stackoverflow.com/users/4238326/vanarajcs"}, "reply_to_user": {"reputation": 3330, "user_id": 1075324, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/750Qe.jpg?s=128&g=1", "display_name": "Abhijeet Kasurde", "link": "https://stackoverflow.com/users/1075324/abhijeet-kasurde"}, "edited": false, "score": 0, "creation_date": 1452083282, "post_id": 34631468, "comment_id": 57011131, "body": "Thanks Abhijeet. Is it possible to send disk usage, cpu usage memory info?"}], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 2269979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff22a1e835980e29baccf08a62e7ff71?s=128&d=identicon&r=PG", "display_name": "molivier", "link": "https://stackoverflow.com/users/2269979/molivier"}, "is_accepted": false, "score": 1, "last_activity_date": 1452272694, "last_edit_date": 1495540769, "creation_date": 1452272694, "answer_id": 34682360, "question_id": 34631468, "link": "https://stackoverflow.com/questions/34631468/how-to-push-cpu-info-to-opentsdb-server-using-golang/34682360#34682360", "title": "How to push cpu info to OpenTSDB server using golang", "body": "<p>You can use <a href=\"https://github.com/shirou/gopsutil\" rel=\"nofollow noreferrer\">https://github.com/shirou/gopsutil</a> package to gather metrics then use http package to push data to your backend using a POST request with a json body. Have a look to this thread for posting data with golang : <a href=\"https://stackoverflow.com/questions/24455147/go-lang-how-send-json-string-in-post-request\">How do I send a JSON string in a POST request in Go</a>.</p>\n"}], "owner": {"reputation": 818, "user_id": 4238326, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/5j2E9.jpg?s=128&g=1", "display_name": "vanarajcs", "link": "https://stackoverflow.com/users/4238326/vanarajcs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1452272694, "creation_date": 1452078021, "question_id": 34631468, "link": "https://stackoverflow.com/questions/34631468/how-to-push-cpu-info-to-opentsdb-server-using-golang", "title": "How to push cpu info to OpenTSDB server using golang", "body": "<p>I need to push cpu info to OpenTSDB server using golang. </p>\n\n<p>What is the procedure to send data in golang?</p>\n\n<p>In which package should use the sent Data? (websocket or http)</p>\n\n<p>In which format should I send the data?</p>\n\n<p>What method should I use for pushing the data? (POST OR GET)</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": true, "score": 1, "last_activity_date": 1452077276, "creation_date": 1452077276, "answer_id": 34631212, "question_id": 34630833, "link": "https://stackoverflow.com/questions/34630833/cant-get-returning-string-value-of-a-method-called-via-reflection/34631212#34631212", "title": "Can&#39;t get returning string value of a method called via reflection", "body": "<p><code>.Call</code> returns a <code>slice</code> of <code>reflect.Value</code> so to do what you're trying to do you need to do something like:</p>\n\n<pre><code>package main\n\nimport (\"reflect\")\n\ntype API_EndPoint struct {}\n\nfunc main() {\n\nvar ep API_EndPoint\ns := reflect.ValueOf(&amp;ep).MethodByName(\"EndPoint_X\").Call([]reflect.Value{reflect.ValueOf(`foo bar`)})\n\nv := reflect.ValueOf(s)\ni := v.Interface()\na := i.([]reflect.Value)[0].String() // Get the first index of the slice and call the .String() method on it\n\nprintln(a) \n\n}\n\nfunc (ep *API_EndPoint) EndPoint_X( params string) string{\n\n        return \"this_is_a_string \" + params\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/MtqCrshTcH\" rel=\"nofollow\">https://play.golang.org/p/MtqCrshTcH</a></p>\n\n<blockquote>\n  <p>this_is_a_string foo bar</p>\n</blockquote>\n\n<p>Not sure what you're trying to accomplish but that should work.</p>\n"}], "owner": {"reputation": 4073, "user_id": 97464, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/hDNFN.png?s=128&g=1", "display_name": "Jase Whatson", "link": "https://stackoverflow.com/users/97464/jase-whatson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 34631212, "answer_count": 1, "score": 0, "last_activity_date": 1452077276, "creation_date": 1452076120, "question_id": 34630833, "link": "https://stackoverflow.com/questions/34630833/cant-get-returning-string-value-of-a-method-called-via-reflection", "title": "Can&#39;t get returning string value of a method called via reflection", "body": "<p>Can't get returning string value of a method called via reflection </p>\n\n<p>panic: interface conversion: interface is []reflect.Value, not string </p>\n\n<pre><code>package main\n\nimport (\n        \"reflect\"\n)\n\ntype API_EndPoint struct{}\n\nfunc main() {\n\n        var ep API_EndPoint\n        s := reflect.ValueOf(&amp;ep).MethodByName(\"EndPoint_X\").Call([]reflect.Value{reflect.ValueOf(`foo bar`)})\n\n        v := reflect.ValueOf(s)\n        i := v.Interface()\n        a := i.(string)\n\n        println(a)\n\n}\n\nfunc (ep *API_EndPoint) EndPoint_X(params string) string {\n\n        return \"this_is_a_string\" + params\n\n}\n</code></pre>\n\n<a href=\"https://play.golang.org/p/3yJ5jAb9-2\" rel=\"nofollow\">see this code in play.golang.org</a>\n"}, {"tags": ["c", "linux", "bash", "shell", "go"], "comments": [{"owner": {"reputation": 532, "user_id": 1644482, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ea25c27c274633522adb95bfd17388d4?s=128&d=identicon&r=PG", "display_name": "Sergey Kanaev", "link": "https://stackoverflow.com/users/1644482/sergey-kanaev"}, "edited": false, "score": 1, "creation_date": 1452074460, "post_id": 34630191, "comment_id": 57005811, "body": "Take a look at manpage: <code>man 7 credentials</code>. There is section <code>User and group identifiers</code>."}, {"owner": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 1, "creation_date": 1452074671, "post_id": 34630191, "comment_id": 57005941, "body": "Can&#39;t you just use <code>getuid()</code>?"}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "reply_to_user": {"reputation": 532, "user_id": 1644482, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/ea25c27c274633522adb95bfd17388d4?s=128&d=identicon&r=PG", "display_name": "Sergey Kanaev", "link": "https://stackoverflow.com/users/1644482/sergey-kanaev"}, "edited": false, "score": 0, "creation_date": 1452075007, "post_id": 34630191, "comment_id": 57006128, "body": "@SergeyKanaev Thank you, let me explore the options of that, and if I can do it with a syscall, probably that will help."}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "reply_to_user": {"reputation": 9530, "user_id": 5264491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/233d38e551f3f0f85437e4ae47353d25?s=128&d=identicon&r=PG&f=1", "display_name": "Ian Abbott", "link": "https://stackoverflow.com/users/5264491/ian-abbott"}, "edited": false, "score": 0, "creation_date": 1452075064, "post_id": 34630191, "comment_id": 57006156, "body": "@IanAbbott Nope. That will get you the effective uid, and that changes when you use sudo. I wanted to get the real uid."}], "answers": [{"comments": [{"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1452074956, "post_id": 34630349, "comment_id": 57006107, "body": "That will get you the effective uid, not the real uid. To get that, I can just use  <code>os.Getuid</code>."}, {"owner": {"reputation": 3370, "user_id": 2819650, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd1c2520461767f78a63e6cfb6431b1c?s=128&d=identicon&r=PG&f=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/2819650/coredump"}, "reply_to_user": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1452075334, "post_id": 34630349, "comment_id": 57006310, "body": "Are you shure? When i&#39;m running <code>sudo id</code> it will show roots id, but if i run <code>sudo who am i</code> it shows the id of user who actually did run sudo, even through a chain of different sudos."}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1452075482, "post_id": 34630349, "comment_id": 57006405, "body": "Yep. Checked it. <code>[scott@workbench scripts]$ sudo whoami root [scott@workbench scripts]$ whoami scott</code>"}, {"owner": {"reputation": 3370, "user_id": 2819650, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd1c2520461767f78a63e6cfb6431b1c?s=128&d=identicon&r=PG&f=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/2819650/coredump"}, "reply_to_user": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1452075593, "post_id": 34630349, "comment_id": 57006477, "body": "Not <code>whoami</code>, as i wrote <code>who am i</code> with spaces."}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1452075833, "post_id": 34630349, "comment_id": 57006654, "body": "It works in cmd, but as I mentioned with the command <code>tty</code>, Chances are that this might be getting executed in a separate forked shell that is detached from a tty (again, just a wild guess) and doesn&#39;t return a value when put inside a program,"}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1452076843, "post_id": 34630349, "comment_id": 57007321, "body": "That changes to <code>root</code> when we do sudo."}, {"owner": {"reputation": 3370, "user_id": 2819650, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd1c2520461767f78a63e6cfb6431b1c?s=128&d=identicon&r=PG&f=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/2819650/coredump"}, "reply_to_user": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1452076938, "post_id": 34630349, "comment_id": 57007384, "body": "$SUDO_USER will help if it&#39;s only one sudo, but it&#39;s not a good solution."}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1452077682, "post_id": 34630349, "comment_id": 57007838, "body": "Yes it is not reliable. They are not set on these servers :("}], "tags": [], "owner": {"reputation": 3370, "user_id": 2819650, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd1c2520461767f78a63e6cfb6431b1c?s=128&d=identicon&r=PG&f=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/2819650/coredump"}, "is_accepted": false, "score": 2, "last_activity_date": 1452077163, "last_edit_date": 1452077163, "creation_date": 1452074659, "answer_id": 34630349, "question_id": 34630191, "link": "https://stackoverflow.com/questions/34630191/what-are-the-ways-to-find-the-session-leader-or-the-controlling-tty-of-a-process/34630349#34630349", "title": "What are the ways to find the session leader or the controlling TTY of a process group in Linux?", "body": "<p>Edit:\nsudo set's <code>$SUDO_USER</code> environment variable, but it will help just with one sudo, i.e. if there was something like <code>sudo sudo -u nobody your-program</code>, <code>$SUDO_USER</code> will be set to \"root\". And there is <code>$SUDO_UID</code> too.</p>\n\n<p>Old answer: How about <code>exec.Command(\"who am i\").Output()</code> ? (won't work, still needs a tty).</p>\n"}], "owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 642, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1452077163, "creation_date": 1452074195, "question_id": 34630191, "link": "https://stackoverflow.com/questions/34630191/what-are-the-ways-to-find-the-session-leader-or-the-controlling-tty-of-a-process", "title": "What are the ways to find the session leader or the controlling TTY of a process group in Linux?", "body": "<p>This is not a language specific question, although I am using golang at the moment.</p>\n\n<p>I am writing a command line program, and I wanted to find the real UID of the program.(By realUID, I meant, if the user did a sudo, the effective uid changes, but the real uid would be the same as the user's.) </p>\n\n<ul>\n<li><p>I've read that finding the owner of the controlling tty is one way to find this, and on linux, we can use \"tty\" command, that will return the filename of the terminal connected to STDINPUT. Checking its ownership is one way. </p></li>\n<li><p>Another way is to find the session leader process, and who owns it.</p></li>\n</ul>\n\n<p>I tried the first way, using</p>\n\n<pre><code>cmdOut []byte\ncmdOut, _ = exec.Command(\"tty\").Output()\n</code></pre>\n\n<p>but it returns the output <code>not a tty</code>, when I run the program from my shell. Chances are that this might be getting executed in a separate forked shell that is detached from a tty (again, just a wild guess). </p>\n\n<p>I tried the second way using <code>os.Getppid()</code> to get the parent pid, but in reality, when running sudo, it forks again, and it is giving the parent pid of the sudo process(<code>16031</code> in the below case, whereas I am looking to grab <code>3393</code> instead.). (Pasting the process hierarchy from pstree output)\n<code>/usr/bin/termin(3383)-+-bash(3393)---sudo(16031)---Myprogram(16032)</code>, so effectively I am not able to get the session leader process, but just the parent pid.</p>\n\n<p>Can someone guide me on how do I implement this functionality using either of this method? </p>\n"}, {"tags": ["google-app-engine", "go", "jwt", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "edited": false, "score": 0, "creation_date": 1452091412, "post_id": 34630290, "comment_id": 57016626, "body": "Thanks! Great answer!"}, {"owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "edited": false, "score": 0, "creation_date": 1452107843, "post_id": 34630290, "comment_id": 57027502, "body": "Maybe not something you want to dig into, but I cant get it to work when I deploy my code. The path for key works when serving local. I get the keys by doing ioutil.readfile(&quot;keys/demo.rsa&quot;) and from root there is a folder called keys, which both demo.rsa and demo.rsa.pub is in. My file which includes them lies in another folder at the same level as keys. Do you have any idea?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "edited": false, "score": 0, "creation_date": 1452108262, "post_id": 34630290, "comment_id": 57027759, "body": "@SimonNilssonGuldstrand Please see edit. Files that need to be read by the code must be <i>application files</i> and must not match any <i>static file pattern</i>."}, {"owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "edited": false, "score": 0, "creation_date": 1452109907, "post_id": 34630290, "comment_id": 57028837, "body": "I have read the page at the link and I think I know what I want to do. But I cant get my code to deploy now. Errors in app.yaml.  I only had - url: /.*   script: _go_app first. Now i have - url: /keys   static_dir: keys   application_readable: true. Does this look good?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "edited": false, "score": 0, "creation_date": 1452110830, "post_id": 34630290, "comment_id": 57029425, "body": "@SimonNilssonGuldstrand Your first version where you only have one <code>_go_app</code> entry looks perfect. Your second example is bad: it exposes your key to be publicly available! Revert that change!"}, {"owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "edited": false, "score": 0, "creation_date": 1452110916, "post_id": 34630290, "comment_id": 57029487, "body": "Yeah I thought of that too, felt bad. But the code doesnt compile with the second part. Should I have app.yaml with only &quot;handlers: - url: /.*   script: _go_app&quot;. Dont I have to say anywhere in the file how to find the keys? That was what I got from reading the link"}, {"owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "edited": false, "score": 0, "creation_date": 1452111286, "post_id": 34630290, "comment_id": 57029734, "body": "I feel that I might not understand what you mean. Shouldnt I say in app.yaml what files to serve to my app? Or should I do it inside the golang code?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "edited": false, "score": 0, "creation_date": 1452111600, "post_id": 34630290, "comment_id": 57029924, "body": "@SimonNilssonGuldstrand By default all files will be application files. But if you define <code>static_dir</code>s and <code>static_files</code> in your <code>app.yaml</code>, those will be excluded from static files (unless you also specify <code>application_readable</code> to the static resource). In your case it should work with <code>&quot;keys&#47;demo.rsa&quot;</code>."}, {"owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1452111652, "post_id": 34630290, "comment_id": 57029964, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/99978/discussion-between-simon-nilsson-guldstrand-and-icza\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1452108228, "last_edit_date": 1592644375, "creation_date": 1452074466, "answer_id": 34630290, "question_id": 34629056, "link": "https://stackoverflow.com/questions/34629056/how-do-i-store-the-private-key-of-my-server-in-google-app-engine/34630290#34630290", "title": "How do I store the private key of my server in google app engine?", "body": "<p>On AppEngine you don't have access to the file system of the host operating system, but you can access files of your web application (you have read-only permission, you can't change them and you can't create new files in the app's folder).</p>\n<p>So the question is: do you want to change this private key from your application without redeploying your app? Or it is perfectly fine if it is deployed &quot;statically&quot; with your app's code?</p>\n<p>If you don't need to change it (or only when you redeploy your app), easiest is to store it as a &quot;static&quot; file as part of your webapp. You may refer to files of your app using relative paths, where the current or working directory is your app's root. E.g. if your app contains a <code>key</code> folder in its root (where <code>app.yaml</code> resides), and there is a <code>my_key.txt</code> file inside the <code>key</code> folder, you can refer to it with the path: <code>key/my_key.txt</code>.</p>\n<p>Actually it is quite common to &quot;ship&quot; static files with your app's code: just think of HTML templates which are read and processed by the Go code (e.g. package <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\"><code>html/template</code></a>) to produce HTML result; the content of the HTML template files are not served directly to clients.</p>\n<p>If you need to change it from time to time without having to redeploy your app, then store it in the Datastore which your app can read and modify.</p>\n<p><strong>Note:</strong></p>\n<p>One important note: not every file is readable by code, this depends on the app configuration. Quoting from <a href=\"https://cloud.google.com/appengine/docs/go/config/appconfig#Go_app_yaml_Static_file_handlers\" rel=\"nofollow noreferrer\">Configuring with app.yaml / Static file handlers</a>:</p>\n<blockquote>\n<p>Static files are files to be served directly to the user for a given URL, such as images, CSS stylesheets, or JavaScript source files. Static file handlers describe which files in the application directory are static files, and which URLs serve them.</p>\n<p>For efficiency, App Engine stores and serves static files separately from application files. Static files are not available in the application's file system. <strong>If you have data files that need to be read by the application code, the data files must be application files, and must not be matched by a static file pattern.</strong></p>\n<p>Static file handlers can be defined in two ways: as a directory structure of static files that maps to a URL path, or as a pattern that maps URLs to specific files.</p>\n</blockquote>\n<p>Read the link how to properly configure application and static files / directories.</p>\n"}, {"tags": [], "owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "is_accepted": false, "score": 0, "last_activity_date": 1452165108, "last_edit_date": 1495541704, "creation_date": 1452165108, "answer_id": 34653665, "question_id": 34629056, "link": "https://stackoverflow.com/questions/34629056/how-do-i-store-the-private-key-of-my-server-in-google-app-engine/34653665#34653665", "title": "How do I store the private key of my server in google app engine?", "body": "<p>The solution was to leave app.yaml as it were. Put app.yaml at root lvl in project. Then change all imports from starting at GOPATH to start at project root instead. The problem that made me choose to put app.yaml and main go file in a different folder under project root was because of double imports. Read this for a better understanding: <a href=\"https://stackoverflow.com/questions/26794225/google-go-appengine-imports-and-conflicts-when-serving-testing\">Google Go AppEngine imports and conflicts when serving / testing</a></p>\n\n<p>The solution made my project find the files I wanted.</p>\n"}], "owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1474, "favorite_count": 1, "accepted_answer_id": 34630290, "answer_count": 2, "score": 3, "last_activity_date": 1474818053, "creation_date": 1452070623, "last_edit_date": 1474818053, "question_id": 34629056, "link": "https://stackoverflow.com/questions/34629056/how-do-i-store-the-private-key-of-my-server-in-google-app-engine", "title": "How do I store the private key of my server in google app engine?", "body": "<p>I'm using <code>\"github.com/dgrijalva/jwt-go\"</code> to create JSON web tokens.<br>\nWhen I hosted my server locally, I could use my private key as usual. But in GAE it won't work because I don't have access to the file system.</p>\n\n<p>How would you guys do it? Store the key in datastore or any other ideas?</p>\n\n<p>Thanks</p>\n\n<p>Edit: </p>\n\n<p>My <code>app.yaml</code> looks like this (below <code>api_version</code> and stuff):</p>\n\n<pre><code>handlers:\n- url: /.*\n  script: _go_app\n</code></pre>\n"}, {"tags": ["performance", "go", "io"], "answers": [{"tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": false, "score": 4, "last_activity_date": 1452070180, "creation_date": 1452070180, "answer_id": 34628903, "question_id": 34628476, "link": "https://stackoverflow.com/questions/34628476/write-operation-cost/34628903#34628903", "title": "Write operation cost", "body": "<p>The operations that take time when writing in files are the syscalls and the disk I/O. The fact that the file pointer is open doesn't cost you anything. So naively, we could say that the second method is best.</p>\n\n<p>Now, as you may know, you OS doesn't directly write into files, it uses an internal in-memory cache for files that are written and do the real I/O later. I don't know the exacts details of that, and generally speaking I don't need to.</p>\n\n<p>What I would advise is a middle-ground solution: do a buffer for every loop iteration, and write this one N times. That way to cut a big part of the number of syscalls and (potentially) disk writes, but without consuming too much memory with the buffer (dependeing on the size of your strings, that my be a point to be taken into account).</p>\n\n<p>I would suggest benchmarking for the best solution, but due to the caching done by the system, benchmarking disk I/O is a real nightmare.</p>\n"}, {"tags": [], "owner": {"reputation": 11066, "user_id": 147057, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cf9d83a95db2460ccb18f311fa8a766c?s=128&d=identicon&r=PG", "display_name": "max taldykin", "link": "https://stackoverflow.com/users/147057/max-taldykin"}, "is_accepted": false, "score": 1, "last_activity_date": 1452072891, "creation_date": 1452072891, "answer_id": 34629736, "question_id": 34628476, "link": "https://stackoverflow.com/questions/34628476/write-operation-cost/34629736#34629736", "title": "Write operation cost", "body": "<p>Syscalls are not cheap, so the second approach is better.</p>\n\n<p>You can use <a href=\"http://lmbench.sourceforge.net/cgi-bin/man?keyword=lat_syscall&amp;section=8\" rel=\"nofollow\">lat_syscall</a> tool from lmbench to measure how long it takes to call single <code>write</code>:</p>\n\n<pre><code>$ ./lat_syscall write\nSimple write: 0.1522 microseconds\n</code></pre>\n\n<p>So, on my system it will take approximately 20000 * 0.15\u03bcs = 3ms extra time just to call <code>write</code> for every string.</p>\n"}, {"comments": [{"owner": {"reputation": 693, "user_id": 4197901, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4924ea36bee5a4df8e17c819b86faddb?s=128&d=identicon&r=PG&f=1", "display_name": "KD157", "link": "https://stackoverflow.com/users/4197901/kd157"}, "edited": false, "score": 0, "creation_date": 1452076573, "post_id": 34629965, "comment_id": 57007123, "body": "How does the second approach require fixed amount of memory. Can you please explain that? because the buffer keeps growing according to the requirement."}, {"owner": {"reputation": 693, "user_id": 4197901, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4924ea36bee5a4df8e17c819b86faddb?s=128&d=identicon&r=PG&f=1", "display_name": "KD157", "link": "https://stackoverflow.com/users/4197901/kd157"}, "edited": false, "score": 0, "creation_date": 1452082179, "post_id": 34629965, "comment_id": 57010508, "body": "yes true thanks for the edit but still writing all the bytes at once would make it faster? Lets say there are 20,000 strings with 1000 characters in each. It is hardly 20 MB."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 693, "user_id": 4197901, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4924ea36bee5a4df8e17c819b86faddb?s=128&d=identicon&r=PG&f=1", "display_name": "KD157", "link": "https://stackoverflow.com/users/4197901/kd157"}, "edited": false, "score": 0, "creation_date": 1452084166, "post_id": 34629965, "comment_id": 57011716, "body": "You can measure it. But overhead of 5000 syscalls that are needed to write 20Mb with 4kb buffer is less than a millisecond. Also unless you know the final size of data that you need to write before creating bytes,Buffer, it (bytes.Buffer) will likely have to be re-sized and it will certainly slow your app down."}, {"owner": {"reputation": 693, "user_id": 4197901, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4924ea36bee5a4df8e17c819b86faddb?s=128&d=identicon&r=PG&f=1", "display_name": "KD157", "link": "https://stackoverflow.com/users/4197901/kd157"}, "edited": false, "score": 0, "creation_date": 1452084739, "post_id": 34629965, "comment_id": 57012116, "body": "Sorry i didn&#39;t get why does it have to resize and how does it slow down the app? If overhead of 5000 syscalls that are needed to write 20Mb with 4kb buffer is less than a millisecond then no point in digging more into this topic but just wanted to know."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 693, "user_id": 4197901, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4924ea36bee5a4df8e17c819b86faddb?s=128&d=identicon&r=PG&f=1", "display_name": "KD157", "link": "https://stackoverflow.com/users/4197901/kd157"}, "edited": false, "score": 1, "creation_date": 1452084985, "post_id": 34629965, "comment_id": 57012264, "body": "Imagine you have byte.Buffer that is backed up by 10kb array. When you write 20kb of data to this byte.Buffer it will automaticlly allocate 20kb, copy the existing array to the beginning of the new array (and later will have to garbage collect the old array). As you can imagine none of these operations are free."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 8, "last_activity_date": 1452079291, "last_edit_date": 1452079291, "creation_date": 1452073554, "answer_id": 34629965, "question_id": 34628476, "link": "https://stackoverflow.com/questions/34628476/write-operation-cost/34629965#34629965", "title": "Write operation cost", "body": "<p><a href=\"https://golang.org/pkg/bufio\" rel=\"noreferrer\">bufio</a> package has been created exactly for this kind of task. Instead of making a syscall for each Write call <code>bufio.Writer</code> buffers up to a fixed number of bytes in the internal memory before making a syscall. After a syscall the internal buffer is reused for the next portion of data</p>\n\n<p>Comparing to your second approach <code>bufio.Writer</code></p>\n\n<ul>\n<li>makes more syscalls (<code>N/S</code> instead of <code>1</code>)</li>\n<li>uses less memory (<code>S</code> bytes instead of <code>N</code> bytes)</li>\n</ul>\n\n<p>where <code>S</code> - is buffer size (can be specified via <code>bufio.NewWriterSize</code>), <code>N</code> - total size of data that needs to be written.</p>\n\n<p>Example usage (<a href=\"https://play.golang.org/p/AvBE1d6wpT\" rel=\"noreferrer\">https://play.golang.org/p/AvBE1d6wpT</a>):</p>\n\n<pre><code>f, err := os.Create(\"file.txt\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer f.Close()\n\nw := bufio.NewWriter(f)\nfmt.Fprint(w, \"Hello, \")\nfmt.Fprint(w, \"world!\")\nerr = w.Flush() // Don't forget to flush!\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 693, "user_id": 4197901, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4924ea36bee5a4df8e17c819b86faddb?s=128&d=identicon&r=PG&f=1", "display_name": "KD157", "link": "https://stackoverflow.com/users/4197901/kd157"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3413, "favorite_count": 2, "answer_count": 3, "score": 5, "last_activity_date": 1575815084, "creation_date": 1452068328, "last_edit_date": 1575815084, "question_id": 34628476, "link": "https://stackoverflow.com/questions/34628476/write-operation-cost", "title": "Write operation cost", "body": "<p>I have a Go program which writes strings into a file.I have a loop which is iterated <strong>20000 times</strong> and in each iteration i am writing around 20-30 strings into a file. I just wanted to know which is the best way to write it into a file. </p>\n\n<ul>\n<li><p>Approach 1: Keep open the file pointer at the start of the code and\nwrite it for every string. It makes it 20000*30 write operations.</p></li>\n<li><p>Approach 2: Use bytes.Buffer Go and store everything in the buffer and\nwrite it at the end.Also in this case should the file pointer be\nopened from the beginning of the code or at the end of the code. Does\nit matter?</p></li>\n</ul>\n\n<p>I am assuming approach 2 should work better. Can someone confirm this with a reason. <strong>How does writing at once be better than writing periodically. Because the file pointer will anyways be open.</strong>\nI am using <code>f.WriteString(&lt;string&gt;)</code> and <code>buffer.WriteString(&lt;some string&gt;)</code> buffer is of type <code>bytes.Buffer</code> and <code>f</code> is the file pointer open.</p>\n"}, {"tags": ["javascript", "angularjs", "go", "websocket", "socket.io"], "answers": [{"comments": [{"owner": {"reputation": 391, "user_id": 1035968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8b182cff0d141fc72d765cb8b94ab225?s=128&d=identicon&r=PG&f=1", "display_name": "Random", "link": "https://stackoverflow.com/users/1035968/random"}, "edited": false, "score": 0, "creation_date": 1452097071, "post_id": 34628360, "comment_id": 57020607, "body": "Great ! Is that also the most efficient way to do it in Go or just a simple go-to solution?"}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 391, "user_id": 1035968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8b182cff0d141fc72d765cb8b94ab225?s=128&d=identicon&r=PG&f=1", "display_name": "Random", "link": "https://stackoverflow.com/users/1035968/random"}, "edited": false, "score": 1, "creation_date": 1452131104, "post_id": 34628360, "comment_id": 57037804, "body": "@Random I&#39;ve only been using Go for a few months, so in terms of efficiency I&#39;m not sure, but I&#39;ve never had a problem with this method and it doesn&#39;t seem to be slow by any means. My implementation averages about 5-10k concurrent connections and it never hiccups"}, {"owner": {"reputation": 456, "user_id": 7198753, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/201605203625626/picture?type=large", "display_name": "Nam L&#234; Qu&#253;", "link": "https://stackoverflow.com/users/7198753/nam-l%c3%aa-qu%c3%bd"}, "edited": false, "score": 0, "creation_date": 1569818554, "post_id": 34628360, "comment_id": 102705110, "body": "It&#39;s complicated and annoying. Why not use googollee/go-socket.io Why are there more stars in gorilla/websocket -.-"}], "tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": true, "score": 5, "last_activity_date": 1452069048, "last_edit_date": 1452069048, "creation_date": 1452067771, "answer_id": 34628360, "question_id": 34628021, "link": "https://stackoverflow.com/questions/34628021/golang-websocket-handler/34628360#34628360", "title": "Golang websocket handler", "body": "<p>If you've been using Javascript for a while it is really easy to implement your own version of <code>socket.on</code> and <code>socket.emit</code> here is one I made for my own projects but you can have it if you need,</p>\n\n<pre><code>// e.g.\n// let socket = new Socket(\"ws://w/e\");\n// socket.on('connected', () =&gt; { console.log('Connected'); });\n// socket.emit('lobby join', { data: { username: 'Boo' } });\n\n// Using ES2015 with Babel\nimport {EventEmitter} from 'events';\n\nclass Socket {\n    constructor(wsurl, ee = new EventEmitter()) {\n        let ws = new WebSocket(wsurl);\n        this.ee = ee;\n        this.ws = ws;\n        ws.onmessage = this.message.bind(this);\n        ws.onopen = this.open.bind(this);\n        ws.onclose = this.close.bind(this);\n    }\n    on(name, fn) {\n        this.ee.on(name, fn);\n    }\n    off(name, fn) {\n        this.ee.removeListener(name, fn);\n    }\n    emit(name, data) {\n        const message = JSON.stringify({name, data});\n        this.ws.send(message);\n    }\n    message(e) {\n        try {\n            const msgData = JSON.parse(e.data);\n            this.ee.emit(msgData.name, msgData.data);\n        }\n        catch(err) {\n            let error = {\n                message: err\n            }\n            console.log(err)\n            this.ee.emit(error.message)\n        }\n    }\n    open() {\n        this.ee.emit('connected');\n    }\n    close() {\n        this.ee.emit('disconnected');\n    }   \n}\n\nexport default Socket\n</code></pre>\n\n<p>This will let you use your common <code>socket.on('event', fn);</code> and what not</p>\n\n<p>As for handling it on the servers end:</p>\n\n<p>For receiving messages, I personally just make a switch statement that will match an incoming string to a function, e.g.: </p>\n\n<pre><code>// readPump pumps messages from the websocket connection to the hub.\nfunc (c *connection) readPump() {\n    defer c.ws.Close()\n    for {\n        _, message, err := c.ws.ReadMessage()\n        if err != nil {\n            break\n        }\n        var incMessage interface{}\n        err = json.Unmarshal(message, &amp;incMessage)\n        if err != nil {\n            log.Println(err)\n        }\n        incMessageMap := incMessage.(map[string]interface{})\n        switch incMessageMap[\"name\"] {\n        case \"lobby join\":\n             // Do something to handle joining\n        case \"lobby leave\":\n             // Do something to handle leaving\n        }\n    }\n}\n</code></pre>\n\n<p>For sending them I have a <code>send channel</code> on my connections that is stored in a map and when I need to emit I have a simple struct that takes a message name, and data, e.g.:</p>\n\n<pre><code>type wsMsg struct {\n    Name string                 `json:\"name\"`\n    Data map[string]interface{} `json:\"data\"`\n}\n\n\nc.send &lt;- wsMsg{\n     \"user joined\",\n     map[string]interface{}{\n          \"username\": \"Booh\",\n     },\n}\n</code></pre>\n\n<p>Then on the client side it would come as</p>\n\n<pre><code>socket.on('user joined', (msg) =&gt; {\n    console.log(msg) // { username: \"Booh\" }\n});\n</code></pre>\n\n<p>I suggest looking at the examples on gorillas git: <a href=\"https://github.com/gorilla/websocket/tree/master/examples/chat\" rel=\"nofollow\">https://github.com/gorilla/websocket/tree/master/examples/chat</a></p>\n"}, {"comments": [{"owner": {"reputation": 3364, "user_id": 7508700, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ms4Mr.png?s=128&g=1", "display_name": "David Buck", "link": "https://stackoverflow.com/users/7508700/david-buck"}, "edited": false, "score": 0, "creation_date": 1576072575, "post_id": 59287005, "comment_id": 104779953, "body": "When answering an old question, your answer would be much more useful to other StackOverflow users if you included some context to explain how your answer helps, particularly for a question that already has an accepted answer. See: <a href=\"https://stackoverflow.com/help/how-to-answer\">How do I write a good answer</a>."}], "tags": [], "owner": {"reputation": 1, "user_id": 11817570, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98f7c025fada6bd2660134fe19548113?s=128&d=identicon&r=PG&f=1", "display_name": "kvs", "link": "https://stackoverflow.com/users/11817570/kvs"}, "is_accepted": false, "score": 0, "last_activity_date": 1576071277, "creation_date": 1576071277, "answer_id": 59287005, "question_id": 34628021, "link": "https://stackoverflow.com/questions/34628021/golang-websocket-handler/59287005#59287005", "title": "Golang websocket handler", "body": "<p>Here is an working example of golang websocket to stream video\n<a href=\"https://github.com/interviewparrot/OpenAVStream\" rel=\"nofollow noreferrer\">https://github.com/interviewparrot/OpenAVStream</a></p>\n\n<p>Let me know if it is good enough</p>\n"}], "owner": {"reputation": 391, "user_id": 1035968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8b182cff0d141fc72d765cb8b94ab225?s=128&d=identicon&r=PG&f=1", "display_name": "Random", "link": "https://stackoverflow.com/users/1035968/random"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3018, "favorite_count": 0, "accepted_answer_id": 34628360, "answer_count": 2, "score": 3, "last_activity_date": 1576071277, "creation_date": 1452066419, "last_edit_date": 1452107389, "question_id": 34628021, "link": "https://stackoverflow.com/questions/34628021/golang-websocket-handler", "title": "Golang websocket handler", "body": "<p>I've started learning Golang after writing in Node.js for a long time and I'm a bit curious as to how am I to implement a handler - I've opted to use Gorilla Websocket since I understood it's the most reliable package out there.</p>\n\n<p>In socket.io for example you have the simple socket.on function that allows me to call a function based on the \"name\" parameter passed in JSON.</p>\n\n<p>Gorilla websocket doesn't implement such a thing, so my question is am I to sort of implement the logic behind socket.io in order to achieve what I want ?</p>\n\n<p>As in do a certain procedure based on the value transferred in the websocket ?</p>\n\n<p>If so - I need to implement it both client (I'm using AngularJS on the front-end) and server side separately by my own - make a switch case statement based on a value I get in JSON both in AngularJS for the front-end and in Go for the back-end, and also - is that the most efficient way ?</p>\n\n<p>Thanks !</p>\n"}, {"tags": ["struct", "go", "pagination", "revel"], "comments": [{"owner": {"reputation": 13085, "user_id": 37494, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/n5Ide.jpg?s=128&g=1", "display_name": "Perpetualcoder", "link": "https://stackoverflow.com/users/37494/perpetualcoder"}, "edited": false, "score": 0, "creation_date": 1452060889, "post_id": 34626654, "comment_id": 56999099, "body": "If you do not wish to implement a SQL based solution (most efficient, least flexible). You can do math and iterate over the result set in javascript or do same math in your revel controller. You will need to calculate things like total_pages = rows_returned/pagesize etc. Things get a bit complicated if u want to combine filtering and grouping."}, {"owner": {"reputation": 13085, "user_id": 37494, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/n5Ide.jpg?s=128&g=1", "display_name": "Perpetualcoder", "link": "https://stackoverflow.com/users/37494/perpetualcoder"}, "edited": false, "score": 0, "creation_date": 1452060959, "post_id": 34626654, "comment_id": 56999121, "body": "Also, tell us what package you are using for data access. What does the controller look like ?"}, {"owner": {"reputation": 139, "user_id": 2099063, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/5ECm9.jpg?s=128&g=1", "display_name": "Mardwan", "link": "https://stackoverflow.com/users/2099063/mardwan"}, "reply_to_user": {"reputation": 13085, "user_id": 37494, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/n5Ide.jpg?s=128&g=1", "display_name": "Perpetualcoder", "link": "https://stackoverflow.com/users/37494/perpetualcoder"}, "edited": false, "score": 0, "creation_date": 1452061863, "post_id": 34626654, "comment_id": 56999456, "body": "Thank you @Perpetualcoder for the fast response. I have updated the question. I hope it covers all you asked for."}, {"owner": {"reputation": 13085, "user_id": 37494, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/n5Ide.jpg?s=128&g=1", "display_name": "Perpetualcoder", "link": "https://stackoverflow.com/users/37494/perpetualcoder"}, "edited": false, "score": 0, "creation_date": 1452064483, "post_id": 34626654, "comment_id": 57000483, "body": "I just wrote some super untested code, it should give you a hint as to what can be done. Cheers!"}, {"owner": {"reputation": 13085, "user_id": 37494, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/n5Ide.jpg?s=128&g=1", "display_name": "Perpetualcoder", "link": "https://stackoverflow.com/users/37494/perpetualcoder"}, "edited": false, "score": 0, "creation_date": 1452143696, "post_id": 34626654, "comment_id": 57041115, "body": "Did the solution suffice?"}, {"owner": {"reputation": 139, "user_id": 2099063, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/5ECm9.jpg?s=128&g=1", "display_name": "Mardwan", "link": "https://stackoverflow.com/users/2099063/mardwan"}, "reply_to_user": {"reputation": 13085, "user_id": 37494, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/n5Ide.jpg?s=128&g=1", "display_name": "Perpetualcoder", "link": "https://stackoverflow.com/users/37494/perpetualcoder"}, "edited": false, "score": 0, "creation_date": 1452143866, "post_id": 34626654, "comment_id": 57041168, "body": "Hey @Perpetualcoder, honestly, you must be one of the kindest gurus ever!  I have been trying to look for ways to work the solution into my code but i haven&#39;t gotten far. My programming skill are not so good am afraid."}, {"owner": {"reputation": 13085, "user_id": 37494, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/n5Ide.jpg?s=128&g=1", "display_name": "Perpetualcoder", "link": "https://stackoverflow.com/users/37494/perpetualcoder"}, "edited": false, "score": 1, "creation_date": 1452197431, "post_id": 34626654, "comment_id": 57073912, "body": "Let me know if you want me to tweak answer. The skip value will be size * (pageneeded-1) which you will need to pass it to controller from your view. In programming community we grow by helping others. Some day you will help me out too."}], "answers": [{"tags": [], "owner": {"reputation": 13085, "user_id": 37494, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/n5Ide.jpg?s=128&g=1", "display_name": "Perpetualcoder", "link": "https://stackoverflow.com/users/37494/perpetualcoder"}, "is_accepted": true, "score": 2, "last_activity_date": 1452064362, "creation_date": 1452064362, "answer_id": 34627560, "question_id": 34626654, "link": "https://stackoverflow.com/questions/34626654/golang-revel-paginating-a-struct-array/34627560#34627560", "title": "Golang Revel: Paginating a struct array", "body": "<p>You could collect the full array of data that you return from the list function.</p>\n\n<pre><code>func paginate(x []Data, skip int, size int) []int {\nlimit := func() int {\n    if skip+size &gt; len(x) {\n        return len(x)\n    } else {\n        return skip + size\n    }\n\n}\n\nstart := func() int {\n    if skip &gt; len(x) {\n        return len(x)\n    } else {\n        return skip\n    }\n\n}\n  return x[start():limit()]\n}\n</code></pre>\n\n<p>Although you will get the behavior you want, this is very wasteful in terms of memory specially if your data array is huge.\nHope this helps.</p>\n"}], "owner": {"reputation": 139, "user_id": 2099063, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/5ECm9.jpg?s=128&g=1", "display_name": "Mardwan", "link": "https://stackoverflow.com/users/2099063/mardwan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1075, "favorite_count": 1, "accepted_answer_id": 34627560, "answer_count": 1, "score": 0, "last_activity_date": 1452064362, "creation_date": 1452060283, "last_edit_date": 1452061773, "question_id": 34626654, "link": "https://stackoverflow.com/questions/34626654/golang-revel-paginating-a-struct-array", "title": "Golang Revel: Paginating a struct array", "body": "<p>I have a struct array that I need to paginate on the view end. </p>\n\n<p>This is what my code looks like on the view:</p>\n\n<pre><code>&lt;div class=\"tab-content\"&gt;\n        &lt;div class=\"tab-pane active\" id=\"tab1\" &gt;\n          &lt;hr/&gt;\n          {{range .c}}                \n            &lt;p&gt;Number: {{.Number}}&lt;/p&gt;\n            &lt;p&gt;Name: {{.Name}}&lt;/p&gt;\n            &lt;p&gt;Parties: {{.A}} and {{.B}}&lt;/p&gt;\n            &lt;p&gt;Location: {{.Location}}&lt;/p&gt;\n          &lt;a href=\"/search\"&gt;Read More&lt;/a&gt;\n          &lt;hr/&gt;\n          {{end}}\n          &lt;div class=\"paging\"&gt;\n            &lt;ul class=\"pagination\"&gt;\n              &lt;li&gt;&lt;a href=\"#\"&gt;&lt;i class=\"fa fa-angle-left\"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;\n              &lt;li class=\"active\"&gt;&lt;a href=\"#\"&gt;1&lt;/a&gt;&lt;/li&gt;\n              &lt;li&gt;&lt;a href=\"#\"&gt;2&lt;/a&gt;&lt;/li&gt;\n              &lt;li&gt;&lt;a href=\"#\"&gt;3&lt;/a&gt;&lt;/li&gt;\n              &lt;li&gt;&lt;a href=\"#\"&gt;4&lt;/a&gt;&lt;/li&gt;\n              &lt;li&gt;&lt;a href=\"#\"&gt;5&lt;/a&gt;&lt;/li&gt;\n              &lt;li&gt;&lt;a href=\"#\"&gt;&lt;i class=\"fa fa-angle-right\"&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;\n            &lt;/ul&gt;\n          &lt;/div&gt;\n        &lt;/div&gt;\n</code></pre>\n\n<p>I have tried looking for solution to paginate this because the results are in the hundreds. The only golang solutions I have come across so far are SQL related. I would highly appreciate a solution for a struct array. </p>\n\n<p>Thank you in advance.</p>\n\n<p><strong>EDIT</strong> My back end storage is BoltDB. I get the data on the controller by calling this method</p>\n\n<pre><code>func List(bucket string)  []Data{\n    //Open BoltDB database\n    Open()\n    defer Close()\n    //Use a predefined struct to make an array\n    d:=make([]Data, 0)\n    //Fetch and unmarshal data as it is saved in byte form\n    db.View(func(tx *bolt.Tx) error {\n        cur := tx.Bucket([]byte(bucket)).Cursor()\n        for k, v := cur.First(); k != nil; k, v = cur.Next() {            \n            d1:=Data{}\n            err:= json.Unmarshal(v, &amp;d1)\n            if err !=nil{\n                return err\n            }\n            d=append(d, d1)\n        } \n        return nil  \n    })\n    //Return the array of data\n    return d\n}\n</code></pre>\n\n<p>This array is what I would like to iterate on the view.</p>\n"}, {"tags": ["python", "go", "deferred"], "answers": [{"comments": [{"owner": {"reputation": 2777, "user_id": 1002371, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/612ee2165cc4115ea14888dbf6ae24cf?s=128&d=identicon&r=PG", "display_name": "a p", "link": "https://stackoverflow.com/users/1002371/a-p"}, "edited": false, "score": 1, "creation_date": 1452051353, "post_id": 34625115, "comment_id": 56996153, "body": "One thing to remember here is that you need to have a context manager defined to use <code>with</code>. Lots of things (<code>file</code>s, <code>threading.Lock</code>, for instance) come with this built-in, but if you want to do something specific like in the first example, you have to custom build it."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 14, "last_activity_date": 1452050746, "creation_date": 1452050746, "answer_id": 34625115, "question_id": 34625089, "link": "https://stackoverflow.com/questions/34625089/python-equivalent-of-golangs-defer-statement/34625115#34625115", "title": "Python equivalent of golang&#39;s defer statement", "body": "<p>Python's <a href=\"https://docs.python.org/2/reference/compound_stmts.html#the-with-statement\">with statement</a> serves a similar purpose to Go's defer.</p>\n\n<p>The similar code in Python is:</p>\n\n<pre><code>mutex = Lock()\n\ndef someFunction():\n    with mutex:\n        # Whatever you want, with as many return statements\n        # as you want, wherever. Simply forget that you ever\n        # locked a mutex, or that you have to remember to \n        # release it again.\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 343905, "user_id": 4279, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/d92ce60d3a4cbe03598e27c2e8dee69d?s=128&d=identicon&r=PG", "display_name": "jfs", "link": "https://stackoverflow.com/users/4279/jfs"}, "is_accepted": true, "score": 22, "last_activity_date": 1452052015, "last_edit_date": 1452052015, "creation_date": 1452051663, "answer_id": 34625254, "question_id": 34625089, "link": "https://stackoverflow.com/questions/34625089/python-equivalent-of-golangs-defer-statement/34625254#34625254", "title": "Python equivalent of golang&#39;s defer statement", "body": "<p>To emulate <code>defer fmt.Println(*a, i)</code> example, you could <a href=\"https://docs.python.org/3/library/contextlib.html#contextlib.ExitStack\" rel=\"noreferrer\">use <code>contextlib.ExitStack</code></a>:</p>\n\n<pre><code>#!/usr/bin/env python3\nfrom contextlib import ExitStack\nfrom functools import partial\n\nprint(\"counting\")\nwith ExitStack() as stack:\n    for i in range(10):\n        a = i\n        stack.callback(partial(print, a, i))\n\n    x = 42\n    a = x\n    print(\"done\")\n</code></pre>\n\n<h3><a href=\"http://ideone.com/ZxufQ8\" rel=\"noreferrer\">Output</a></h3>\n\n<pre><code>counting\ndone\n9 9\n8 8\n7 7\n6 6\n5 5\n4 4\n3 3\n2 2\n1 1\n0 0\n</code></pre>\n\n<p>It is easy to emulate the mutex case:</p>\n\n<pre><code>def some_function(lock=Lock()):\n    with lock:\n        # whatever\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 301, "user_id": 9456786, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46f04b80a588e3d707a0138782230649?s=128&d=identicon&r=PG", "display_name": "kirr", "link": "https://stackoverflow.com/users/9456786/kirr"}, "edited": false, "score": 0, "creation_date": 1559240305, "post_id": 43028386, "comment_id": 99367398, "body": "A <i>defer</i> implementation partly inspired by this answer is available as part of <a href=\"https://pypi.org/project/pygolang/\" rel=\"nofollow noreferrer\">pygolang</a>: <a href=\"https://stackoverflow.com/a/53069630/9456786\">stackoverflow.com/a/53069630/9456786</a>"}], "tags": [], "owner": {"reputation": 8171, "user_id": 311655, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6bad9300ce17b6a89678ed9343647906?s=128&d=identicon&r=PG", "display_name": "DenisKolodin", "link": "https://stackoverflow.com/users/311655/deniskolodin"}, "is_accepted": false, "score": 10, "last_activity_date": 1490529283, "creation_date": 1490529283, "answer_id": 43028386, "question_id": 34625089, "link": "https://stackoverflow.com/questions/34625089/python-equivalent-of-golangs-defer-statement/43028386#43028386", "title": "Python equivalent of golang&#39;s defer statement", "body": "<p>I've made one <a href=\"https://habrahabr.ru/post/191786/\" rel=\"noreferrer\">there</a> (compatible with 2.x):</p>\n\n<pre><code>@defers_collector\ndef func():\n    f = open('file.txt', 'w')\n    defer(lambda: f.close())\n\n    defer(lambda : print(\"Defer called!\"))\n\n    def my_defer():\n    recover()\n\n    defer(lambda: my_defer())\n\n    print(\"Ok )\")\n    panic(\"WTF?\")\n\n    print(\"Never printed (((\")\n\n\nfunc()\nprint(\"Recovered!\")\n</code></pre>\n\n<p>Source of <code>defers_collector</code> is:</p>\n\n<pre><code># Go-style error handling\n\nimport inspect\nimport sys\n\ndef panic(x):\n    raise Exception(x)\n\ndef defer(x):\n    for f in inspect.stack():\n    if '__defers__' in f[0].f_locals:\n        f[0].f_locals['__defers__'].append(x)\n        break\n\ndef recover():\n    val = None\n    for f in inspect.stack():\n    loc = f[0].f_locals\n    if f[3] == '__exit__' and '__suppress__' in loc:\n        val = loc['exc_value']\n        loc['__suppress__'].append(True)\n        break\n    return val\n\nclass DefersContainer(object):\n    def __init__(self):\n    # List for sustain refer in shallow clone\n    self.defers = []\n\n    def append(self, defer):\n    self.defers.append(defer)\n\n    def __enter__(self):\n    pass\n\n    def __exit__(self, exc_type, exc_value, traceback):\n    __suppress__ = []\n    for d in reversed(self.defers):\n        try:\n            d()\n        except:\n            __suppress__ = []\n            exc_type, exc_value, traceback = sys.exc_info()\n    return __suppress__\n\n\ndef defers_collector(func):\n    def __wrap__(*args, **kwargs):\n    __defers__ = DefersContainer()\n    with __defers__:\n        func(*args, **kwargs)\n    return __wrap__\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 301, "user_id": 9456786, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46f04b80a588e3d707a0138782230649?s=128&d=identicon&r=PG", "display_name": "kirr", "link": "https://stackoverflow.com/users/9456786/kirr"}, "is_accepted": false, "score": 8, "last_activity_date": 1540919818, "creation_date": 1540919818, "answer_id": 53069630, "question_id": 34625089, "link": "https://stackoverflow.com/questions/34625089/python-equivalent-of-golangs-defer-statement/53069630#53069630", "title": "Python equivalent of golang&#39;s defer statement", "body": "<p>A <em>defer</em> implementation partly inspired by <a href=\"https://stackoverflow.com/users/311655/deniskolodin\">@DenisKolodin</a> <a href=\"https://stackoverflow.com/a/43028386/9456786\">answer</a> is available as part of <a href=\"https://pypi.org/project/pygolang\" rel=\"noreferrer\">pygolang</a>, <a href=\"https://lab.nexedi.com/kirr/pygolang/commit/5146eb0b\" rel=\"noreferrer\">2</a>:</p>\n\n<pre><code>   wc = wcfs.join(zurl)    \u2502     wc = wcfs.join(zurl)\n   defer(wc.close)         \u2502     try:\n                           \u2502        ...\n   ...                     \u2502        ...\n   ...                     \u2502        ...\n   ...                     \u2502     finally:\n                           \u2502        wc.close()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 441, "user_id": 10421006, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Tsnm2szHx0c/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPtCnPsEe83qOAB6QmDiUNyX_jGpg/mo/photo.jpg?sz=128", "display_name": "rnovatorov", "link": "https://stackoverflow.com/users/10421006/rnovatorov"}, "is_accepted": false, "score": 1, "last_activity_date": 1563623406, "creation_date": 1563623406, "answer_id": 57124418, "question_id": 34625089, "link": "https://stackoverflow.com/questions/34625089/python-equivalent-of-golangs-defer-statement/57124418#57124418", "title": "Python equivalent of golang&#39;s defer statement", "body": "<p>This complement to <a href=\"https://stackoverflow.com/a/34625254/10421006\">jfs' answer</a> pushes the <code>ExitStack</code> idea a bit further with the help of decorators:</p>\n\n<pre><code>@with_exit_stack\ndef counting(n, stack):\n    for i in range(n):\n        stack.callback(print, i)\n\n\n@with_exit_stack\ndef locking(lock, stack):\n    stack.enter_context(lock)\n    # whatever\n</code></pre>\n\n<p><code>with_exit_stack</code> is defined as follows:</p>\n\n<pre><code>import functools\nimport contextlib\n\ndef with_exit_stack(func):\n    @functools.wraps(func)\n    def wrapper(*args, **kwargs):\n        with contextlib.ExitStack() as stack:\n            return func(*args, **kwargs, stack=stack)\n\n    return wrapper\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4575, "user_id": 286182, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/126b0c09f7669aaab415178b6f4428b5?s=128&d=identicon&r=PG", "display_name": "Romuald Brunet", "link": "https://stackoverflow.com/users/286182/romuald-brunet"}, "is_accepted": false, "score": 1, "last_activity_date": 1588084175, "creation_date": 1588084175, "answer_id": 61482689, "question_id": 34625089, "link": "https://stackoverflow.com/questions/34625089/python-equivalent-of-golangs-defer-statement/61482689#61482689", "title": "Python equivalent of golang&#39;s defer statement", "body": "<p>I've tried to make an equivalent for fun (only tested as a proof of concept)</p>\n\n<p>Here is is:</p>\n\n<pre><code>import os\nimport inspect\n\n\nclass defer:\n    \"\"\"\n    Proof of concept for a python equivalent of golang's defer statement\n\n    Note that the callback order is probably not guaranteed\n\n    \"\"\"\n    def __init__(self, callback, *args, **kwargs):\n        self.callback = callback\n        self.args = args\n        self.kwargs = kwargs\n\n        # Add a reference to self in the caller variables so our __del__\n        # method will be called when the function goes out of scope\n        caller = inspect.currentframe().f_back\n        caller.f_locals[b'_' + os.urandom(48)] = self\n\n    def __del__(self):\n        self.callback(*self.args, **self.kwargs)\n</code></pre>\n\n<p>Usage example:</p>\n\n<pre><code>def main():\n    first()\n    second()\n\ndef first():\n    print('- first')\n    defer(lambda: print('   - deferred'))\n    print('- first exit')\n\ndef second():\n    print('- second')      \n\nif __name__ == '__main__':\n    main()\n</code></pre>\n"}], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13647, "favorite_count": 4, "accepted_answer_id": 34625254, "answer_count": 6, "score": 30, "last_activity_date": 1588084175, "creation_date": 1452050512, "question_id": 34625089, "link": "https://stackoverflow.com/questions/34625089/python-equivalent-of-golangs-defer-statement", "title": "Python equivalent of golang&#39;s defer statement", "body": "<p>How would one implement something that works like the <code>defer</code> statement from go in python? </p>\n\n<p>Defer pushes a function call to a stack. When the function containing the defer statement returns, the defered function calls are popped and executed one by one, in the scope that the defer statement was inside in the first place. Defer statements look like function calls, but are not executed until they are popped.</p>\n\n<p>Go example of how it works:</p>\n\n<pre><code>func main() {\n    fmt.Println(\"counting\")\n\n    var a *int\n    for i := 0; i &lt; 10; i++ {\n        a = &amp;i\n        defer fmt.Println(*a, i)\n    }\n\n    x := 42\n    a = &amp;x\n\n    fmt.Println(\"done\")\n}\n</code></pre>\n\n<p>Outputs: </p>\n\n<pre><code>counting\ndone\n9 9\n8 8\n7 7\n6 6\n5 5\n4 4\n3 3\n2 2\n1 1\n0 0\n</code></pre>\n\n<p>Go example of a usecase:</p>\n\n<pre><code>var m sync.Mutex\nfunc someFunction() {\n    m.Lock()\n    defer m.Unlock()\n    // Whatever you want, with as many return statements as you want, wherever.\n    // Simply forget that you ever locked a mutex, or that you have to remember to release it again.\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1452050884, "post_id": 34624928, "comment_id": 56996041, "body": "Is this more efficient than using the way I&#39;ve posted in the bottom of my question?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1452051164, "post_id": 34624928, "comment_id": 56996112, "body": "@Datsik <code>reflect.DeepEqual</code> is quite expensive, so I would imagine so!"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1452051176, "post_id": 34624928, "comment_id": 56996115, "body": "It is more efficient in many scenarios and correctly handles scenarios not covered by the code in the question."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1452053019, "post_id": 34624928, "comment_id": 56996572, "body": "Building two maps (by SteamID) and comparing them might be more efficient if lists of members are large."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1452050514, "last_edit_date": 1452050514, "creation_date": 1452049427, "answer_id": 34624928, "question_id": 34624701, "link": "https://stackoverflow.com/questions/34624701/idiomatic-go-way-to-compare-2-slices-to-see-which-element-has-been-removed/34624928#34624928", "title": "Idiomatic go way to compare 2 slices to see which element has been removed", "body": "<p>Sort the old and new members by a unique and sortable key. It looks like SteamID might be suitable for this purpose.  Iterate through both slices checking for added and deleted elements by comparing the keys.</p>\n\n<pre><code>func diff(old []*member, new []*member) {\n  sort.Sort(bySteamID(old))\n  sort.Sort(bySteamID(new))\n  i, j := 0, 0\n  for i &lt; len(old) &amp;&amp; j &lt; len(new) {\n    switch {\n    case old[i].SteamID &lt; new[j].SteamID:\n        fmt.Println(\" delete\", old[i].SteamID)\n        i++\n    case old[i].SteamID &gt; new[j].SteamID:\n        fmt.Println(\" add\", new[j].SteamID)\n        j++\n    default:\n        i++\n        j++\n    }\n  }\n  for i &lt; len(old) {\n    fmt.Println(\" delete\", old[i].SteamID)\n    i++\n  }\n  for j &lt; len(new) {\n    fmt.Println(\" add\", new[j].SteamID)\n    j++\n  }\n}\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/sVeHTPCsl_\" rel=\"nofollow\">playground example</a></kbd></p>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 34624928, "answer_count": 1, "score": 0, "last_activity_date": 1452050514, "creation_date": 1452047719, "last_edit_date": 1452049357, "question_id": 34624701, "link": "https://stackoverflow.com/questions/34624701/idiomatic-go-way-to-compare-2-slices-to-see-which-element-has-been-removed", "title": "Idiomatic go way to compare 2 slices to see which element has been removed", "body": "<p>I am using <a href=\"https://www.rethinkdb.com/\" rel=\"nofollow\">RethinkDB</a> in my application and I have a lobby that has users.</p>\n\n<p>RethinkDB has the ability to watch for changes to a table and when changes happen it automagically emits the changes so you can do whatever you want with the data, right now I'm trying to make it so when a user leaves the lobby I can send a websocket out to remove the user. The only thing is I'm trying to find out where the difference is in the before / after data which is a slice of <code>members</code>, this is the data:</p>\n\n<pre><code>type change struct {\n    NewVal *fields `gorethink:\"new_val,omitempty\"`\n    OldVal *fields `gorethink:\"old_val,omitempty\"`\n}\n\ntype fields struct {\n    ID      string `gorethink:\"id\"`\n    Owner   string `gorethink:\"owner\"`\n    Inqueue bool   `gorethink:\"inqueue\"`\n    Members []struct {\n        SteamID  string `gorethink:\"steamid\"`\n        Username string `gorethink:\"username\"`\n    } `gorethink:\"members\"`\n    Messages []struct {\n        Username  string    `gorethink:\"username\"`\n        Message   string    `gorethink:\"message\"`\n        CreatedAt time.Time `gorethink:\"createdAt\"`\n    } `gorethink:\"messages\"`\n}\n</code></pre>\n\n<p>Right now I'm doing </p>\n\n<pre><code>func (l *lobby) watchChanges() {\n    db := common.DB()\n    query := gorethink.Table(\"Lobbys\").Get(l.ID).Changes()\n    res, err := query.Run(db)\n    if err != nil {\n        log.Println(err)\n    }\n\n    go func(res *gorethink.Cursor, l *lobby) {\n        defer res.Close()\n        changes := new(change)\n        for res.Next(&amp;changes) {\n            if changes.NewVal != nil &amp;&amp; changes.OldVal != nil {\n                switch {\n                case len(changes.NewVal.Members) &gt; len(changes.OldVal.Members):\n                    // Member has joined so announce who it was.\n\n                case len(changes.NewVal.Members) &lt; len(changes.OldVal.Members):\n                    // Member has left so announce who it was.\n           --------&gt;\n                case len(changes.NewVal.Messages) &gt; len(changes.OldVal.Messages):\n                    // New Message was recieved so announce the message.\n\n                }\n            }\n        }\n    }(res, l)\n\n    select {\n    case &lt;-l.KillMe:\n        res.Close()\n        break\n    }\n}\n</code></pre>\n\n<p>The new entries are easy enough I'll just take the end off the slice and send that, but when it comes to the user leaving, how can I compare the <code>changes.NewVal.Members</code> and <code>changes.OldVal.Members</code> to see which index was removed so I can send the right member to remove through the websocket. Hope my question is clear let me know if it isn't.</p>\n\n<p><strong>This is how I'm currently doing it</strong></p>\n\n<pre><code>removedIndex := 0\nfor i, oldMember := range changes.OldVal.Members {\n    foundMissing := true\n    for _, newMember := range changes.NewVal.Members {\n        if reflect.DeepEqual(oldMember, newMember) {\n            foundMissing = false\n        }\n    }\n    if foundMissing {\n        removedIndex = i\n        break\n    }\n}\n</code></pre>\n\n<p>but it feels a bit hacky, is there a better way?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1452039727, "post_id": 34623523, "comment_id": 56992903, "body": "As far as I can tell there is no variable named <code>pass</code> in scope at the time you call <code>fmt.Println(pass)</code>. Not sure about this but my guess would be that is part of the response body, you&#39;ll have to unpackage it in order to print that data. For example, if the body is json, use the <code>encoding&#47;json</code> package to deserialize into some object or map and then you could do <code>myType.Password</code> but you can&#39;t just print <code>pass</code> magically without extracting it from the response. I would guess everything else is working fine. Most of it looks pretty standard. Comment out that line and check your status."}, {"owner": {"reputation": 61, "user_id": 5748076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grDzX.png?s=128&g=1", "display_name": "Nuff Monk", "link": "https://stackoverflow.com/users/5748076/nuff-monk"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1452041494, "post_id": 34623523, "comment_id": 56993416, "body": "password is generated and passed to RouterPass() like <code>func main() { \tvar password = &quot;NRTW-16SM-QFF2-282L&quot; \tRouterPass(password) }</code>"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1452046338, "post_id": 34623523, "comment_id": 56994887, "body": "why not capture again with the go program client, and compare it to the previous capture. and also the response."}, {"owner": {"reputation": 61, "user_id": 5748076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grDzX.png?s=128&g=1", "display_name": "Nuff Monk", "link": "https://stackoverflow.com/users/5748076/nuff-monk"}, "edited": false, "score": 0, "creation_date": 1452047538, "post_id": 34623523, "comment_id": 56995159, "body": "OK, I&#39;m able to change password now but with <code>form</code> instead of <code>data</code>."}, {"owner": {"reputation": 61, "user_id": 5748076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grDzX.png?s=128&g=1", "display_name": "Nuff Monk", "link": "https://stackoverflow.com/users/5748076/nuff-monk"}, "edited": false, "score": 0, "creation_date": 1452047666, "post_id": 34623523, "comment_id": 56995195, "body": "Please someone tell me how to close this question or mark it as solved."}], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 5748076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grDzX.png?s=128&g=1", "display_name": "Nuff Monk", "link": "https://stackoverflow.com/users/5748076/nuff-monk"}, "is_accepted": true, "score": 4, "last_activity_date": 1452072444, "creation_date": 1452072444, "answer_id": 34629575, "question_id": 34623523, "link": "https://stackoverflow.com/questions/34623523/making-a-post-request-in-golang/34629575#34629575", "title": "Making a post request in golang", "body": "<p>Hopefully, this will help others.</p>\n\n<p>Code that worked   </p>\n\n<pre><code>func ChangePassword(password string) {\n    hc := http.Client{}\n    routerURL := \"http://192.168.0.1/goform/form2WlanBasicSetup.cgi\"\n    form := url.Values{}\n    form.Add(\"domain\", \"1\")\n    form.Add(\"hiddenSSID\", \"0\")\n    form.Add(\"ssid\", \"Linux-PC\")\n    form.Add(\"band\", \"9\")\n    form.Add(\"chan\", \"0\")\n    form.Add(\"chanwid\", \"1\")\n    form.Add(\"txRate\", \"0\")\n    form.Add(\"method_cur\", \"0\")\n    form.Add(\"method\", \"6\")\n    form.Add(\"authType\", \"2\")\n    form.Add(\"length\", \"1\")\n    form.Add(\"format\", \"1\")\n    form.Add(\"defaultTxKeyId\", \"1\")\n    form.Add(\"key1\", \"\")\n    form.Add(\"pskFormat\", \"0\")\n    form.Add(\"pskValue\", password)\n    form.Add(\"checkWPS2\", \"1\")\n    form.Add(\"save\", \"Apply\")\n    form.Add(\"basicrates\", \"496\")\n    form.Add(\"operrates\", \"4080\")\n    req, err := http.NewRequest(\"POST\", routerURL, strings.NewReader(form.Encode()))\n    if err != nil {\n        panic(err)\n    }\n    req.PostForm = form\n    req.Header.Add(\"User-Agent\", \"Mozilla/5.0 (Windows NT 6.3; WOW64; rv:43.0) Gecko/20100101 Firefox/43.0\")\n    req.Header.Add(\"Referer\", \"http://192.168.0.1/d_wlan_basic.asp\")\n    req.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n\n    fmt.Println(form)\n    resp, err := hc.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(resp.Status)\n    fmt.Println(password)\n}\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 5748076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grDzX.png?s=128&g=1", "display_name": "Nuff Monk", "link": "https://stackoverflow.com/users/5748076/nuff-monk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4871, "favorite_count": 1, "accepted_answer_id": 34629575, "answer_count": 1, "score": 2, "last_activity_date": 1452072444, "creation_date": 1452038972, "last_edit_date": 1452041287, "question_id": 34623523, "link": "https://stackoverflow.com/questions/34623523/making-a-post-request-in-golang", "title": "Making a post request in golang", "body": "<p>I'm trying to automate following using golang</p>\n\n<ul>\n<li><strike>generate password</strike> (done)</li>\n<li><strike>push notification to all devices</strike> (done using pushbullet)</li>\n<li>change wifi router password at 192.168.0.1 (needs to be done)</li>\n</ul>\n\n<p>Wifi Router page at 192.168.0.1\n<a href=\"http://i.stack.imgur.com/I88Tl.jpg\" rel=\"nofollow\">Wifi Router page</a></p>\n\n<p>Here is a raw data captured using <em>Fiddler</em>. (When manually changed)</p>\n\n<pre><code>POST http://192.168.0.1/goform/form2WlanBasicSetup.cgi HTTP/1.1\nHost: 192.168.0.1\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:43.0) Gecko/20100101 Firefox/43.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nReferer: http://192.168.0.1/d_wlan_basic.asp\nCookie: curShow=\nX-Skyzip-Mode: high\nConnection: keep-alive\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 233\n\ndomain=1&amp;hiddenSSID=0&amp;ssid=Home&amp;band=9&amp;chan=0&amp;chanwid=1&amp;txRate=0&amp;method_cur=0&amp;method=6&amp;authType=2&amp;length=1&amp;format=1&amp;defaultTxKeyId=1&amp;key1=&amp;pskFormat=0&amp;pskValue=3ADI0NSXEAYOI0M&amp;checkWPS2=1&amp;save=Apply&amp;basicrates=496&amp;operrates=4080\n</code></pre>\n\n<p>and my <em>golang</em> code as follows </p>\n\n<pre><code>func RouterPass(pass string) {\n    routerUrl := \"http://192.168.0.1\"\n    resource := \"/goform/form2WlanBasicSetup.cgi\"\n    data := url.Values{}\n    data.Set(\"domain\", \"1\")\n    data.Add(\"ssid\", \"Home\")\n    data.Add(\"band\", \"9\")\n    data.Add(\"chan\", \"0\")\n    data.Add(\"chanwid\", \"1\")\n    data.Add(\"txRate\", \"0\")\n    data.Add(\"method_cur\", \"0\")\n    data.Add(\"method\", \"6\")\n    data.Add(\"authType\", \"2\")\n    data.Add(\"length\", \"1\")\n    data.Add(\"format\", \"1\")\n    data.Add(\"defaultTxKeyId\", \"1\")\n    data.Add(\"pskFormat\", \"0\")\n    data.Add(\"pskValue\", pass)\n    data.Add(\"checkWPS2\", \"1\")\n    data.Add(\"save\", \"Apply\")\n    data.Add(\"basicrates\", \"496\")\n    data.Add(\"operrates\", \"4080\")\n\n    u, _ := url.ParseRequestURI(routerUrl)\n    u.Path = resource\n    u.RawQuery = data.Encode()\n    urlStr := fmt.Sprintf(\"%v\", u) \n\n    client := &amp;http.Client{}\n    r, _ := http.NewRequest(\"POST\", urlStr, nil)\n    // r.Header.Add(\"Authorization\", \"auth_token=\\\"XXXXXXX\\\"\")\n    r.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    r.Header.Add(\"Content-Length\", strconv.Itoa(len(data.Encode())))\n\n    resp, _ := client.Do(r)\n    fmt.Println(pass)\n    fmt.Println(resp.Status)\n}\n</code></pre>\n\n<p>But I'm not able to change password.\nWhat am I doing wrong?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 10, "last_activity_date": 1452026727, "creation_date": 1452026727, "answer_id": 34620920, "question_id": 34620860, "link": "https://stackoverflow.com/questions/34620860/is-there-a-way-to-make-channels-receive-only/34620920#34620920", "title": "Is there a way to make channels receive-only?", "body": "<p>You can explicitly define <code>b</code>'s type as a receive-only channel and set its value to <code>a</code>. You could also cast <code>a</code> to a receive-only channel. From the <a href=\"https://golang.org/ref/spec#Channel_types\">Go spec</a>:</p>\n\n<blockquote>\n  <p>A channel may be constrained only to send or only to receive by conversion or assignment.</p>\n</blockquote>\n\n<pre><code>func main() {\n    a := make(chan string, 123)\n    var b &lt;-chan string = a // or, b := (&lt;-chan string)(a)\n\n    a &lt;- \"one\"\n    a &lt;- \"two\"\n    //b &lt;- \"beta\" // compile error because of send to receive-only channel\n    fmt.Println(\"a\", &lt;-a, \"b\", &lt;-b)\n}\n</code></pre>\n"}], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 34620920, "answer_count": 1, "score": 3, "last_activity_date": 1452026727, "creation_date": 1452026531, "question_id": 34620860, "link": "https://stackoverflow.com/questions/34620860/is-there-a-way-to-make-channels-receive-only", "title": "Is there a way to make channels receive-only?", "body": "<p>This clearly works:</p>\n\n<pre><code>// cast chan string to &lt;-chan string\nfunc RecOnly(c chan string) &lt;-chan string {\n    return c\n}\n\nfunc main() {\n    a := make(chan string, 123)\n    b := RecOnly(a)\n\n    a &lt;- \"one\"\n    a &lt;- \"two\"\n    //b &lt;- \"beta\" // compile error because of send to receive-only channel\n    fmt.Println(\"a\", &lt;-a, \"b\", &lt;-b)\n}\n</code></pre>\n\n<p>but is there a one-liner to do this, without declaring a new function?</p>\n"}, {"tags": ["json", "postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1452022208, "post_id": 34619613, "comment_id": 56985018, "body": "Might supply a complete answer later but my suggestion is fairly simple, add an extra field to your type to represent the json as a <code>[]byte</code>, let GORM unmarshal into that. After that use <code>encoding&#47;json</code> to unmarshal the <code>[]byte</code> into the target struct."}, {"owner": {"reputation": 43, "user_id": 4095775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fe6ec40f966e6c25f5ef56bf6dce84e?s=128&d=identicon&r=PG&f=1", "display_name": "Per Fr&#246;jd", "link": "https://stackoverflow.com/users/4095775/per-fr%c3%b6jd"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1452206362, "post_id": 34619613, "comment_id": 57078776, "body": "I feel bad cause I missed your comment, and it turned out to be a super easy solution. Thanks a lot!"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 4095775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fe6ec40f966e6c25f5ef56bf6dce84e?s=128&d=identicon&r=PG&f=1", "display_name": "Per Fr&#246;jd", "link": "https://stackoverflow.com/users/4095775/per-fr%c3%b6jd"}, "edited": false, "score": 0, "creation_date": 1452100873, "post_id": 34623575, "comment_id": 57023231, "body": "Thanks for the answer.    I&#39;ve set up a sub struct like your example, which unfortunately results in panic when fetching the row with the ORM, with the following message:      <code>2016&#47;01&#47;06 17:20:35 Panic recovery -&gt; reflect.Set: value of type []uint8 is not assignable to type []models.ItemInfo</code>     I tried playing around with the datatype in model.ItemInfo, shifting between int/strings, with no real luck."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 43, "user_id": 4095775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fe6ec40f966e6c25f5ef56bf6dce84e?s=128&d=identicon&r=PG&f=1", "display_name": "Per Fr&#246;jd", "link": "https://stackoverflow.com/users/4095775/per-fr%c3%b6jd"}, "edited": false, "score": 0, "creation_date": 1452131165, "post_id": 34623575, "comment_id": 57037821, "body": "@PerFr&#246;jd Can you put your code into your question so I can see it?"}, {"owner": {"reputation": 43, "user_id": 4095775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fe6ec40f966e6c25f5ef56bf6dce84e?s=128&d=identicon&r=PG&f=1", "display_name": "Per Fr&#246;jd", "link": "https://stackoverflow.com/users/4095775/per-fr%c3%b6jd"}, "edited": false, "score": 0, "creation_date": 1452154995, "post_id": 34623575, "comment_id": 57045818, "body": "Updated question with new structs and the exception"}], "tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 0, "last_activity_date": 1452039205, "creation_date": 1452039205, "answer_id": 34623575, "question_id": 34619613, "link": "https://stackoverflow.com/questions/34619613/deserializing-nested-json-or-simply-pass-it-forward-in-go/34623575#34623575", "title": "Deserializing nested JSON, or simply pass it forward in Go", "body": "<p>Make a sub struct like <code>itemInfo</code> or something like:</p>\n\n<pre><code>type itemInfo struct {\n    Stat string `json:\"stat\"`\n    Crit int    `json:\"crit\"`\n}\n</code></pre>\n\n<p>Then in your <code>Item</code> struct make</p>\n\n<pre><code>type Item struct {\n    --snip--\n    Context string `gorm:\"column:context\" json:\"context\"`\n    Stats []itemInfo `gorm:\"column:stats\" json:\"stats\" sql:\"json\"`\n    --snip--\n}\n</code></pre>\n\n<p>Then when you unmarshal it should go just fine into item info!</p>\n\n<p>Also I'm assuming you're using blizzards API, I have made a wrapper already you can view it here: <a href=\"https://github.com/Gacnt/Go-WoW-API\" rel=\"nofollow\">https://github.com/Gacnt/Go-WoW-API</a> to see how I have done it, but it's completely unfinished I only implemented the parts I needed when I was working on something.</p>\n"}, {"tags": [], "owner": {"reputation": 43, "user_id": 4095775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fe6ec40f966e6c25f5ef56bf6dce84e?s=128&d=identicon&r=PG&f=1", "display_name": "Per Fr&#246;jd", "link": "https://stackoverflow.com/users/4095775/per-fr%c3%b6jd"}, "is_accepted": true, "score": 0, "last_activity_date": 1452206592, "creation_date": 1452206592, "answer_id": 34666567, "question_id": 34619613, "link": "https://stackoverflow.com/questions/34619613/deserializing-nested-json-or-simply-pass-it-forward-in-go/34666567#34666567", "title": "Deserializing nested JSON, or simply pass it forward in Go", "body": "<p>Turns out it was easiest to just provide an additional property in the Item struct for GORM to unmarshal into []byte and then unmarshal the byte array as the sub-struct:</p>\n\n<pre><code>// Item is a thing..\ntype Item \n    Stats           []byte    `gorm:\"column:stats\"  json:\"stats\"`\n    StatsList       []ItemInfo `json:\"iteminfo\"`\n}\n</code></pre>\n\n<p>And unmarshal it like this:</p>\n\n<pre><code>err = json.Unmarshal(returnedItem.Stats, &amp;returnedItem.StatsList)\n</code></pre>\n\n<p>Thanks to @evanmcdonnal for the suggestion.</p>\n"}], "owner": {"reputation": 43, "user_id": 4095775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fe6ec40f966e6c25f5ef56bf6dce84e?s=128&d=identicon&r=PG&f=1", "display_name": "Per Fr&#246;jd", "link": "https://stackoverflow.com/users/4095775/per-fr%c3%b6jd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 959, "favorite_count": 0, "accepted_answer_id": 34666567, "answer_count": 2, "score": 0, "last_activity_date": 1452206592, "creation_date": 1452021596, "last_edit_date": 1452154962, "question_id": 34619613, "link": "https://stackoverflow.com/questions/34619613/deserializing-nested-json-or-simply-pass-it-forward-in-go", "title": "Deserializing nested JSON, or simply pass it forward in Go", "body": "<p>Building a basic API with Go, I've got JSON stored in a JSON field in a postgres table, along with some other (plain) datatypes. Using my model, I'm simply trying to fetch a row from the database and pass it forward as JSON.</p>\n\n<p>Using <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow\">GORM</a> to deserialize the data into a struct, most of the mapping happens seamlessly, except for the JSON, which depending on selected datatype either renders as a bytearray or string.</p>\n\n<p>Here are the models (Updated):</p>\n\n<pre><code>type Item struct {\n    --snip--\n    Stats []ItemInfo `gorm:\"column:stats\" json:\"stats\" sql:\"json\"`\n    --snip--\n}\n\ntype ItemInfo struct {\n    Stat        string      `json:\"stat\"`\n    Amount      int         `json:\"amount\"`\n}\n</code></pre>\n\n<p>With the typical JSON looking like this (from the DB):</p>\n\n<pre><code>[{\"stat\": \"Multistrike\", \"amount\": 193}, {\"stat\": \"Crit\", \"amount\": 145}, \n {\"stat\": \"Agility\", \"amount\": 254}, {\"stat\": \"Stamina\", \"amount\": 381}]\n</code></pre>\n\n<p>So the idea is that I simply want to pass this data on, not alter it, or deserialize it to a Go struct or anything. The controller/route follows:</p>\n\n<pre><code>func GetItem(c *gin.Context) {\n    id, err := strconv.Atoi(c.Param(\"id\"))\n\n    // Convert Parameter to int, for db query\n    if err != nil {\n        panic(err)\n    }\n\n    // Get the DB context\n    db, ok := c.MustGet(\"databaseConnection\").(gorm.DB)\n    if !ok {\n        // Do something\n    }\n\n    // Hold the structified item here.\n    var returnedItem models.Item\n\n    // Get the db row\n    db.Where(&amp;models.Item{ItemID: id}).First(&amp;returnedItem)\n\n    if c.Bind(&amp;returnedItem) == nil {\n\n        // Respond with the struct as json\n        c.JSON(http.StatusOK, returnedItem)\n    }\n}\n</code></pre>\n\n<p>Which responds with the following JSON (with stats as json.RawMessage):</p>\n\n<pre><code>{\n\n    \"context\": \"raid-finder\",\n    \"stats\": \"W3sic3RhdCI6ICJWZXJzYXRpbGl0eSIsICJhbW91bnQiOiA0NX0sIHsic3RhdCI6ICJDcml0IiwgImFtb3VudCI6IDEwMH0sIHsic3RhdCI6ICJBZ2lsaXR5IiwgImFtb3VudCI6IDEwOX0sIHsic3RhdCI6ICJTdGFtaW5hIiwgImFtb3VudCI6IDE2M31d\",\n}\n</code></pre>\n\n<p>Or alternatively (with stats as string):</p>\n\n<pre><code>{\n    \"context\": \"raid-finder\",\n    \"stats\": \"[{\\\"stat\\\": \\\"Versatility\\\", \\\"amount\\\": 45}, {\\\"stat\\\": \\\"Crit\\\", \\\"amount\\\": 100}, {\\\"stat\\\": \\\"Agility\\\", \\\"amount\\\": 109}, {\\\"stat\\\": \\\"Stamina\\\", \\\"amount\\\": 163}]\",\n}\n</code></pre>\n\n<p>What options do I have to simply pass this on, so far I've unsuccessfully attempted to map the JSON to a struct (which becomes difficult because of the dynamic data, and the reason I chose JSON to start with)?</p>\n\n<p>I realize there's some magic going on from <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow\">gin-gonic</a>, with c.JSON automatically(?) marshalling all of the data from the struct to JSON, but hoping there's some way to avoid marshalling the json data?</p>\n\n<p>When ran with the ItemInfo substruct, it panics with the following error:</p>\n\n<pre><code>2016/01/07 08:21:08 Panic recovery -&gt; reflect.Set: value of type []uint8 is not assignable to type []models.ItemInfo\n/usr/local/go/src/runtime/panic.go:423 (0x42a929)\n        gopanic: reflectcall(nil, unsafe.Pointer(d.fn), deferArgs(d), uint32(d.siz), uint32(d.siz))\n/usr/local/go/src/reflect/value.go:2158 (0x5492ce)\n        Value.assignTo: panic(context + \": value of type \" + v.typ.String() + \" is not assignable to type \" + dst.String())\n/usr/local/go/src/reflect/value.go:1327 (0x546195)\n</code></pre>\n\n<p>EDIT: Updated code:</p>\n"}, {"tags": ["azure", "go", "azure-web-app-service", "kudu"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1452021021, "post_id": 34619209, "comment_id": 56984303, "body": "Try to vendor your dependencies using a tool like godep."}, {"owner": {"reputation": 3417, "user_id": 5463877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e88da9f0b09bd7ddb86d1336e75980fd?s=128&d=identicon&r=PG", "display_name": "Xiaomin Wu", "link": "https://stackoverflow.com/users/5463877/xiaomin-wu"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1452021173, "post_id": 34619209, "comment_id": 56984415, "body": "yep, as @Not_a_Golfer suggest. vendoring should solve your issue where you have a copy of the dependency in your source code. Azure is support Go ver1.5+, you should be able to use the latest build-in vendor feature."}], "answers": [{"tags": [], "owner": {"reputation": 2349, "user_id": 316855, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1e4268090367ad8c19af73ea30561aad?s=128&d=identicon&r=PG", "display_name": "Dominic St-Pierre", "link": "https://stackoverflow.com/users/316855/dominic-st-pierre"}, "is_accepted": true, "score": 1, "last_activity_date": 1452162157, "creation_date": 1452162157, "answer_id": 34652660, "question_id": 34619209, "link": "https://stackoverflow.com/questions/34619209/how-to-deploy-an-azure-go-web-app-via-git-push-with-private-repositories-as-depe/34652660#34652660", "title": "How to deploy an Azure Go web app via git push with private repositories as dependencies?", "body": "<p>As @Not_a_Golfer and @Xiaomin said, vendoring the dependencies worked, here's what I did:</p>\n\n<ol>\n<li>Turned the env variable on locally <code>GO15VENDOREXPERIMENT=1</code></li>\n<li>Installed <code>godep</code> => <code>go get github.com/tools/godep</code></li>\n<li>Making sure your app is passing a <code>go build</code> &amp; <code>go test</code></li>\n<li>Ran <code>godep save</code> this copied all dependencies to ./vendor</li>\n<li>On my Azure web app, I also set the environment variable <code>GO15VENDOREXPERIMENT=1</code></li>\n<li>git pushed and voila.</li>\n</ol>\n\n<p>At first I did not set the environment variable on my Azure app, so the dependency resolver was not looking in ./vendor, turning it to 1 fixed everything.</p>\n"}], "owner": {"reputation": 2349, "user_id": 316855, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1e4268090367ad8c19af73ea30561aad?s=128&d=identicon&r=PG", "display_name": "Dominic St-Pierre", "link": "https://stackoverflow.com/users/316855/dominic-st-pierre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 34652660, "answer_count": 1, "score": 2, "last_activity_date": 1452162157, "creation_date": 1452020020, "question_id": 34619209, "link": "https://stackoverflow.com/questions/34619209/how-to-deploy-an-azure-go-web-app-via-git-push-with-private-repositories-as-depe", "title": "How to deploy an Azure Go web app via git push with private repositories as dependencies?", "body": "<p>What would be the proper way to deploy a Go app to Azure that have private GitHub repositories as dependencies? Here's the current error from Kudu:</p>\n\n<pre><code>Resolving dependencies\n# cd .; git clone https://github.com/my/privaterepo\n  D:\\local\\Temp\\8d315fa89272e69\\gopath\\src\\github.com\\my\\privaterepo\nCloning into 'D:\\local\\Temp\\8d315fa89272e69\\gopath\\src\\github.com\\my\\privaterepo'...\nfatal: could not read Username for 'https://github.com': Bad file descriptor\npackage github.com/my/privaterepo/pkg1: exit status 128\npackage github.com/my/privaterepo/pkg2: cannot find package $GOROOT)\n\nBuilding Go app to produce exe file\nazureapp\\file.go:8:2: cannot find package \"github.com/my/privaterepo/pkg1\" \nin any of:\n    D:\\Program Files\\Go\\1.5.1\\src\\github.com\\my\\privaterepo\\pkg1 (from $GOROOT)\n</code></pre>\n\n<p>I was previously deploying via FTP with <code>web.config</code>'s HttpPlatformHandler entry. But using git push is quicker especially for non-Windows team members.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 2, "creation_date": 1452019456, "post_id": 34618940, "comment_id": 56983421, "body": "Sorry but your code just doesn&#39;t make sense. The json you have would just plainly unmarshal into a normal struct with no problems and print your desired outputs. You&#39;re saying you want to take the name value from the json and look up an ID based on it? In my opinion, that kind of behavior certainly shouldn&#39;t be obfuscated in the unmarhsalling step... More like you should have the name, count, and greeting on the struct with json tags, then the id without a json tag, unmsarshal into the struct then call a look up id method that sets the id based on the name."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1452020068, "last_edit_date": 1452020068, "creation_date": 1452019568, "answer_id": 34619086, "question_id": 34618940, "link": "https://stackoverflow.com/questions/34618940/how-can-i-implement-unmarshaljson-for-a-type-derived-from-a-scalar-in-go/34619086#34619086", "title": "How can I implement UnmarshalJSON for a type derived from a scalar in Go?", "body": "<p>Use a pointer receiver for the unmarshal method. If a value receiver is used, changes to the receiver are lost when the method returns.</p>\n\n<p>The argument to the unmarshal method is JSON text. Unmarshal the JSON text to get a plain string with all JSON quoting removed.</p>\n\n<pre><code>func (intValue *PersonID) UnmarshalJSON(data []byte) error {\n  var s string\n  if err := json.Unmarshal(data, &amp;s); err != nil {\n    return err\n  }\n  *intValue = Lookup(s)\n  return nil\n}\n</code></pre>\n\n<p>There's a mismatch between the JSON tags an the example JSON. I changed the JSON to match the tag, but you can change it the other way.</p>\n\n<pre><code>if err := json.Unmarshal([]byte(`{\"person\": \"Ralph\", \"count\": 4, \"greeting\": \"Hello\"}`), &amp;m); err != nil {\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/-kOYet4CdH\" rel=\"nofollow\">playground example</a></kbd></p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1452021226, "creation_date": 1452021226, "answer_id": 34619511, "question_id": 34618940, "link": "https://stackoverflow.com/questions/34618940/how-can-i-implement-unmarshaljson-for-a-type-derived-from-a-scalar-in-go/34619511#34619511", "title": "How can I implement UnmarshalJSON for a type derived from a scalar in Go?", "body": "<p>Here's an answer based on my comment. I'm not sure this is exactly what you want to do as some of your questions wording confuses me however the basic idea is to separate unmarshalling and transformation into two different steps. First unmarshal raw data into a compatible type, after do a transformation to another type or enrich the type you already have like in the example below. You're welcome to hide this behavior in a custom implementation of <code>UnmarshalJSON</code> if you'd like but I would personally advise against it. Here's my two reasons; 1) it's just not consistent with Go's explicit verbose coding style 2) I despise highly obfuscated packages/libraries/languages that do stuff like this for you because sooner or later it bites you in the ass an costs you a lot more than adding that 1 line of extra code in a few places (like hours trying to debug something that makes no sense to you).</p>\n\n<pre><code>type MyType struct {\n    Id   PersonID\n    Name     string   `json: \"name\"` \n    Count    int      `json: \"count\"`\n    Greeting string   `json: \"greeting\"`\n}\n\n\nfunc main() {\n    var m MyType\n    if err := json.Unmarshal([]byte(`{\"name\": \"Ralph\", \"count\": 4, \"greeting\": \"Hello\"}`), &amp;m); err != nil {\n        fmt.Println(err)\n    } else {\n        m.Id = Lookup(m.Name) // see this isn't unmarshalling\n        // better to take the data as is and do transformation separate\n        for i := 0; i &lt; m.Count; i++ {\n            fmt.Println(m.Greeting, m.Person.Name())\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1057, "favorite_count": 1, "accepted_answer_id": 34619086, "answer_count": 2, "score": 2, "last_activity_date": 1452024264, "creation_date": 1452019101, "last_edit_date": 1452024264, "question_id": 34618940, "link": "https://stackoverflow.com/questions/34618940/how-can-i-implement-unmarshaljson-for-a-type-derived-from-a-scalar-in-go", "title": "How can I implement UnmarshalJSON for a type derived from a scalar in Go?", "body": "<p>I have a simple type that implements conversion of subtyped integer consts to strings and vice versa in Go. I want to be able to automatically unmarshal strings in JSON to values of this type. I can't, because UnmarshalJSON doesn't give me a way to return or modify the scalar value. It's expecting a struct, whose members are set by UnmarshalJSON. The \",string\" method doesn't work either for other than builtin scalar types. Is there a way to implement UnmarshalJSON correctly for a derived scalar type?</p>\n\n<p>Here's an example of what I'm after. I want it to print \"Hello Ralph\" four times, but it prints \"Hello Bob\" four times because the PersonID isn't being changed.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype PersonID int\n\nconst (\n    Bob PersonID = iota\n    Jane\n    Ralph\n    Nobody = -1\n)\n\nvar nameMap = map[string]PersonID{\n    \"Bob\":    Bob,\n    \"Jane\":   Jane,\n    \"Ralph\":  Ralph,\n    \"Nobody\": Nobody,\n}\n\nvar idMap = map[PersonID]string{\n    Bob:    \"Bob\",\n    Jane:   \"Jane\",\n    Ralph:  \"Ralph\",\n    Nobody: \"Nobody\",\n}\n\nfunc (intValue PersonID) Name() string {\n    return idMap[intValue]\n}\n\nfunc Lookup(name string) PersonID {\n    return nameMap[name]\n}\n\nfunc (intValue PersonID) UnmarshalJSON(data []byte) error {\n    // The following line is not correct\n    intValue = Lookup(string(data))\n    return nil\n}\n\ntype MyType struct {\n    Person   PersonID `json: \"person\"`\n    Count    int      `json: \"count\"`\n    Greeting string   `json: \"greeting\"`\n}\n\nfunc main() {\n    var m MyType\n    if err := json.Unmarshal([]byte(`{\"person\": \"Ralph\", \"count\": 4, \"greeting\": \"Hello\"}`), &amp;m); err != nil {\n        fmt.Println(err)\n    } else {\n        for i := 0; i &lt; m.Count; i++ {\n            fmt.Println(m.Greeting, m.Person.Name())\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["multithreading", "go", "daemon"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1452010497, "post_id": 34616169, "comment_id": 56977853, "body": "There is no such notion as &quot;creating threads&quot; in golang. If you are talking of goroutines; They are very cheap. Fire them up as needed."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1452010657, "post_id": 34616169, "comment_id": 56977964, "body": "goroutines end when their function returns. You usually don&#39;t have &quot;idle&quot; goroutines sitting around, they&#39;re either doing something or they&#39;ve returned."}, {"owner": {"reputation": 163, "user_id": 1393531, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eae6fb03b0b4794a4aff38219a09da5d?s=128&d=identicon&r=PG", "display_name": "SjB", "link": "https://stackoverflow.com/users/1393531/sjb"}, "edited": false, "score": 0, "creation_date": 1452011007, "post_id": 34616169, "comment_id": 56978228, "body": "Yes, my apologize for the incorrect nomenclature, goroutines are what I&#39;m talking about. So, having a pool of long running &quot;idle&quot; gorutines waiting for a message on a channel is no problem?"}, {"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1452011205, "post_id": 34616169, "comment_id": 56978388, "body": "@SjB how do you get a pool of idle goroutines. This doesn&#39;t sound right."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1452011254, "post_id": 34616169, "comment_id": 56978425, "body": "Goroutines don&#39;t requires an OS thread, and have a very small stack. There&#39;s no problems having a pool waiting for messages, but because they&#39;re so cheap to spawn, a &quot;worker pool&quot; isn&#39;t usually the proper way to architect a program."}, {"owner": {"reputation": 163, "user_id": 1393531, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eae6fb03b0b4794a4aff38219a09da5d?s=128&d=identicon&r=PG", "display_name": "SjB", "link": "https://stackoverflow.com/users/1393531/sjb"}, "reply_to_user": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1452011529, "post_id": 34616169, "comment_id": 56978624, "body": "@TheHippo I have a dispatcher with a chan of chan. When work comes in, it is sent to the dispatcher, who distributes it to it&#39;s waiting worker goroutines."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1452015713, "post_id": 34616169, "comment_id": 56981376, "body": "Even if the impact is minimal it would just be bad programming imo to spin up a bunch of resources that may never actually be needed. Most applications like what you describe have a main routine that is always running which would then invoke the worker routines and listen for their completion as necessary. Why would that coordinator need to prematurely allocate resources? And as JimB pointed out above the goroutine is returning automatically unless you have something blocking in it which I think would obviously be bad."}], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 1393531, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eae6fb03b0b4794a4aff38219a09da5d?s=128&d=identicon&r=PG", "display_name": "SjB", "link": "https://stackoverflow.com/users/1393531/sjb"}, "edited": false, "score": 0, "creation_date": 1452013907, "post_id": 34616794, "comment_id": 56980225, "body": "Thanks, but I was looking for a task queue pattern where there are reusable worker goroutines that wait for incoming work.The link about green threads was very helpful!"}, {"owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "reply_to_user": {"reputation": 163, "user_id": 1393531, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eae6fb03b0b4794a4aff38219a09da5d?s=128&d=identicon&r=PG", "display_name": "SjB", "link": "https://stackoverflow.com/users/1393531/sjb"}, "edited": false, "score": 0, "creation_date": 1452014177, "post_id": 34616794, "comment_id": 56980382, "body": "Yes, but you also said &quot;waiting for work on a channel&quot;, so my suggestion is to write a code consuming work tasks from a channel (which is synchronous) and spawn a goroutine as work arrives instead of bothering with reusing old ones."}], "tags": [], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "is_accepted": false, "score": 1, "last_activity_date": 1452012109, "creation_date": 1452012109, "answer_id": 34616794, "question_id": 34616169, "link": "https://stackoverflow.com/questions/34616169/should-idle-threads-be-left-around-in-long-running-process/34616794#34616794", "title": "Should idle threads be left around in long running process?", "body": "<p>First of all you can't create a thread using standard Go library. In Go universe you should use goroutines which are so called <a href=\"https://en.wikipedia.org/wiki/Green_threads\" rel=\"nofollow\">green threads</a>.</p>\n\n<p>Usually you shouldn't spawn \"reusable\" goroutines. They are cheap to create so create them on demand as work job arrives and finish (return from goroutine) as soon as work is completed.</p>\n\n<p>Also don't hesitate to create nested goroutines. In general spawn them like crazy if you feel you should do something in <strong>concurrent</strong> manner and don't try to reuse them as it makes no sense.</p>\n"}, {"comments": [{"owner": {"reputation": 163, "user_id": 1393531, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eae6fb03b0b4794a4aff38219a09da5d?s=128&d=identicon&r=PG", "display_name": "SjB", "link": "https://stackoverflow.com/users/1393531/sjb"}, "edited": false, "score": 0, "creation_date": 1452014040, "post_id": 34616836, "comment_id": 56980298, "body": "Thanks, this is the pattern I was going for: the work is all identical and doesn&#39;t need to be executed in a particular order"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1452013054, "last_edit_date": 1452013054, "creation_date": 1452012218, "answer_id": 34616836, "question_id": 34616169, "link": "https://stackoverflow.com/questions/34616169/should-idle-threads-be-left-around-in-long-running-process/34616836#34616836", "title": "Should idle threads be left around in long running process?", "body": "<p>Pattern with tasks queue and waiting workers is common in Go. Goroutines are cheap, but order of execution is nondetermined. So if you want your system behavior to be predictable, you better would control  workers rendezvous with main routine thru unbuffered channels requested in a loop or somehow else. Otherwise some of them can be spawned but remain idle which is legal.</p>\n"}, {"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 1, "last_activity_date": 1452018456, "creation_date": 1452018456, "answer_id": 34618749, "question_id": 34616169, "link": "https://stackoverflow.com/questions/34616169/should-idle-threads-be-left-around-in-long-running-process/34618749#34618749", "title": "Should idle threads be left around in long running process?", "body": "<p>There is very little cost either way. goroutines don't require a separate OS thread and consume practically no resources while blocking on a channel receive, but also cost <em>very</em> little to spin up, so there's no great reason to leave them open either.</p>\n\n<p>My code rarely uses worker pools. Generally my producer will spawn a goroutine for every unit of work it produces and hands it off directly along with a response channel, then spawns a \"listener\" that does some formatting for the work output and pipes all the responses back to the main thread. A common pattern for me looks like:</p>\n\n<pre><code>func Foo(input []interface{}) resp chan interface{} {\n    var wg sync.WaitGroup\n    resp := make(chan interface{})\n    listen := make(chan interface{})\n    theWork := makeWork(input)\n    // do work\n    for _, unitOfWork := range theWork {\n        wg.Add(1)\n        go func() {\n            // doWork has signature:\n            //   func doWork(w interface{}, ch chan interface{})\n            doWork(unitOfWork, listen)\n            wg.Done()\n        }()\n    }\n    // format the output of listen chan and send to resp chan\n    // then close resp chan so main can continue\n    go func() {\n        for r := range listen {\n            resp &lt;- doFormatting(r)\n        }\n        close(resp)\n    }()\n    // close listen chan after work is done\n    go func() {\n        wg.Wait()\n        close(listen)\n    }()\n    return resp\n}\n</code></pre>\n\n<p>Then my main function passes it some input and listens on the response channel</p>\n\n<pre><code>func main() {\n    loremipsum := []string{\"foo\", \"bar\", \"spam\", \"eggs\"}\n    response := Foo(loremipsum)\n    for output := range response {\n        fmt.Println(output)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 163, "user_id": 1393531, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eae6fb03b0b4794a4aff38219a09da5d?s=128&d=identicon&r=PG", "display_name": "SjB", "link": "https://stackoverflow.com/users/1393531/sjb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 408, "favorite_count": 0, "answer_count": 3, "score": -2, "last_activity_date": 1452018456, "creation_date": 1452010253, "last_edit_date": 1452011193, "question_id": 34616169, "link": "https://stackoverflow.com/questions/34616169/should-idle-threads-be-left-around-in-long-running-process", "title": "Should idle threads be left around in long running process?", "body": "<p>I am creating a go program that is intended to run long term and listen for work. When it receives a request, it runs the work on a process queue.</p>\n\n<p>I am new to golang and systems programming, so my question is this: should I spin up the process queue (with it's multiple idle worker threads) at the program launch (they will just sit there until work comes in) or should I spin them up when work arrives and shut them down when finished?</p>\n\n<p>I am unclear as to the overall system impact multiple idle threads will have, but I am assuming since they are idle there will be no impact until work arrives. That being said, I want to make sure my program is a \"good neighbor\" and as efficient as possible.</p>\n\n<p>--EDIT--</p>\n\n<p>To clarify, the \"process pool\" is a group of worker go routines waiting for work on a channel. Should they be started/stopped when work arrives, or started when the program launches and left waiting until work comes in?</p>\n"}, {"tags": ["date", "go"], "comments": [{"owner": {"reputation": 1749, "user_id": 3243380, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrCc3.jpg?s=128&g=1", "display_name": "nussjustin", "link": "https://stackoverflow.com/users/3243380/nussjustin"}, "edited": false, "score": 0, "creation_date": 1452010359, "post_id": 34616089, "comment_id": 56977765, "body": "The playground runs in a sandbox with a fixed time. Calling time.Now() there will always return the same time."}, {"owner": {"reputation": 3875, "user_id": 2520738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d8b9e3bb134ffcf49330f7886f1484a?s=128&d=identicon&r=PG", "display_name": "sturrockad", "link": "https://stackoverflow.com/users/2520738/sturrockad"}, "reply_to_user": {"reputation": 1749, "user_id": 3243380, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrCc3.jpg?s=128&g=1", "display_name": "nussjustin", "link": "https://stackoverflow.com/users/3243380/nussjustin"}, "edited": false, "score": 0, "creation_date": 1452010444, "post_id": 34616089, "comment_id": 56977819, "body": "Yep, see the second example, the issue isn&#39;t the time being the same it&#39;s that the year is completely wrong"}], "answers": [{"comments": [{"owner": {"reputation": 3875, "user_id": 2520738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d8b9e3bb134ffcf49330f7886f1484a?s=128&d=identicon&r=PG", "display_name": "sturrockad", "link": "https://stackoverflow.com/users/2520738/sturrockad"}, "edited": false, "score": 0, "creation_date": 1452010580, "post_id": 34616257, "comment_id": 56977906, "body": "Yep, just found that myself, might test the code against the new version later on"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 3875, "user_id": 2520738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d8b9e3bb134ffcf49330f7886f1484a?s=128&d=identicon&r=PG", "display_name": "sturrockad", "link": "https://stackoverflow.com/users/2520738/sturrockad"}, "edited": false, "score": 1, "creation_date": 1452010633, "post_id": 34616257, "comment_id": 56977947, "body": "I&#39;ve just checked. <code>fmt.Println(time.Now().Format(&quot;02_01_2006&quot;))</code> works as expected (shows <code>06_01_2016</code>) using Go tip."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 5, "last_activity_date": 1452010510, "creation_date": 1452010510, "answer_id": 34616257, "question_id": 34616089, "link": "https://stackoverflow.com/questions/34616089/formatting-dates-as-dd-mm-yyyy-in-go-gives-strange-values/34616257#34616257", "title": "Formatting dates as dd_mm_yyyy in Go gives strange values", "body": "<p>This is very likely due to the following bug: <a href=\"https://github.com/golang/go/issues/11334\">https://github.com/golang/go/issues/11334</a></p>\n\n<p>This has been fixed in Go 1.6beta1</p>\n"}, {"tags": [], "owner": {"reputation": 3875, "user_id": 2520738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d8b9e3bb134ffcf49330f7886f1484a?s=128&d=identicon&r=PG", "display_name": "sturrockad", "link": "https://stackoverflow.com/users/2520738/sturrockad"}, "is_accepted": false, "score": 0, "last_activity_date": 1452010522, "creation_date": 1452010522, "answer_id": 34616263, "question_id": 34616089, "link": "https://stackoverflow.com/questions/34616089/formatting-dates-as-dd-mm-yyyy-in-go-gives-strange-values/34616263#34616263", "title": "Formatting dates as dd_mm_yyyy in Go gives strange values", "body": "<p>Found an issue from their github:</p>\n\n<p><a href=\"https://github.com/golang/go/issues/11334\" rel=\"nofollow\">https://github.com/golang/go/issues/11334</a></p>\n\n<p>Basically _2 is taking the 2 as the day value from the reference time and then trying to parse the rest (006) which it doesn't recognise so it all goes wrong from there.</p>\n"}], "owner": {"reputation": 3875, "user_id": 2520738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d8b9e3bb134ffcf49330f7886f1484a?s=128&d=identicon&r=PG", "display_name": "sturrockad", "link": "https://stackoverflow.com/users/2520738/sturrockad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 34616257, "answer_count": 2, "score": 1, "last_activity_date": 1452010522, "creation_date": 1452009974, "question_id": 34616089, "link": "https://stackoverflow.com/questions/34616089/formatting-dates-as-dd-mm-yyyy-in-go-gives-strange-values", "title": "Formatting dates as dd_mm_yyyy in Go gives strange values", "body": "<p>So as in the title, I'm trying to format a date in dd_mm_yy format using time.Now().Format(\"02_01_2006\") as shown in this playground session:</p>\n\n<p><a href=\"http://play.golang.org/p/alAj-OcRZt\" rel=\"nofollow\">http://play.golang.org/p/alAj-OcRZt</a></p>\n\n<p>First problem, dd_mm_yyyy isn't an acceptable format, only dd_mm_yy is, which is fine I can manipulate the returned string myself.</p>\n\n<p>The problem I have for you is to help me figure out what Go is even trying to do with this input.</p>\n\n<p>You should notice the result you get is:</p>\n\n<p><code>10_1110009</code></p>\n\n<p>A good few thousand years off and it's lost the underscore which it only does it for _2. Does this character sequence represent something special here?</p>\n\n<p>Replacing the last underscore with a hyphen or space returns a valid result. dd_mm_yy works fine. Just this particular case seems to completely fly off the handle.</p>\n\n<p>On my local machine (Go playground is on a specific date) the result for today (the 5th) is:</p>\n\n<p><code>05_01 5016</code></p>\n\n<p>Which is equally strange, if not moreso as it's substituted in a space which seems to be an ANSIC thing.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1452012837, "post_id": 34614794, "comment_id": 56979498, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/18512781/built-in-source-code-location\">Built-In source code location</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1452026151, "post_id": 34614794, "comment_id": 56987105, "body": "@CodingPickle: I wasn&#39;t going to mark it as such, since that links to the old repo and old C based compiler. However, my answer will eventually be obsolete too -- so I guess that makes this question &quot;off topic&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 7, "last_activity_date": 1452007493, "last_edit_date": 1452007493, "creation_date": 1452006420, "answer_id": 34614866, "question_id": 34614794, "link": "https://stackoverflow.com/questions/34614794/how-to-extract-go-builtin-function-code-such-as-delete/34614866#34614866", "title": "How to extract go builtin function code such as delete()", "body": "<p><a href=\"https://golang.org/pkg/builtin/\" rel=\"noreferrer\"><code>builtin.go</code></a> is simply a file for documentation purposes. It doesn't contain any implementations.</p>\n\n<p>The map implementation is in <a href=\"https://golang.org/src/runtime/hashmap.go\" rel=\"noreferrer\"><code>runtime/hashmap.go</code></a>. The delete functionality is implemented in the <code>mapdelete</code> function.</p>\n"}], "owner": {"reputation": 372, "user_id": 3839487, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/PSX0M.png?s=128&g=1", "display_name": "LEo", "link": "https://stackoverflow.com/users/3839487/leo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 734, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1507794996, "creation_date": 1452006203, "last_edit_date": 1507794996, "question_id": 34614794, "link": "https://stackoverflow.com/questions/34614794/how-to-extract-go-builtin-function-code-such-as-delete", "title": "How to extract go builtin function code such as delete()", "body": "<p>I have found the builtin function in go src (/go/src/builtin/builtin.go), as following:</p>\n\n<pre><code>func delete(m map[Type]Type1, key Type)\n</code></pre>\n\n<p>But this is not source code. Who can tell me where is the builtin function source code?</p>\n"}, {"tags": ["multithreading", "go", "concurrency"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1452004154, "post_id": 34613904, "comment_id": 56973407, "body": "Are you asking how <i>you</i> can control the number of OS threads used? Read about GOMAXPROCS in the <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">runtime package documentation</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1452023842, "creation_date": 1452023842, "answer_id": 34620192, "question_id": 34613904, "link": "https://stackoverflow.com/questions/34613904/does-golang-has-capbility-to-handle-process-and-thread-besides-routine/34620192#34620192", "title": "Does golang has capbility to handle process and thread besides routine", "body": "<p>Go does manage a lot of threads and creates more routines on these threads. Go doesn't provide access to Process/Thread/Goroutine, them even haven't a names. Only channels in Go have names.</p>\n"}], "owner": {"reputation": 11, "user_id": 3581379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd7f506ad3ebbf9334776b3823707ffa?s=128&d=identicon&r=PG&f=1", "display_name": "user3581379", "link": "https://stackoverflow.com/users/3581379/user3581379"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 243, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1452023842, "creation_date": 1452003714, "question_id": 34613904, "link": "https://stackoverflow.com/questions/34613904/does-golang-has-capbility-to-handle-process-and-thread-besides-routine", "title": "Does golang has capbility to handle process and thread besides routine", "body": "<p>I know that golang is using go routine implementing the concurrency.  I assume go routine is lighter on weight than thread, one thread could have many routines.  How does the golang manage threads and routines?  Is golang always running a single thread like Node.js?  Or Golang manages a lot of threads and creates more routines on these threads?  Does golang providing some lib to touch the Process/Thread on OS level?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 1, "creation_date": 1452000945, "post_id": 34612380, "comment_id": 56971043, "body": "Take a look at this answer for a different question. <a href=\"http://stackoverflow.com/a/26962251/450989\">stackoverflow.com/a/26962251/450989</a> I mention where to put GOPATH."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 5747794, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204023423264623/picture?type=large", "display_name": "Balouh", "link": "https://stackoverflow.com/users/5747794/balouh"}, "edited": false, "score": 0, "creation_date": 1452000494, "post_id": 34612593, "comment_id": 56970753, "body": "i dont have that file in my folder :D so this could be the problem"}, {"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "reply_to_user": {"reputation": 13, "user_id": 5747794, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204023423264623/picture?type=large", "display_name": "Balouh", "link": "https://stackoverflow.com/users/5747794/balouh"}, "edited": false, "score": 1, "creation_date": 1452002178, "post_id": 34612593, "comment_id": 56971880, "body": "Well, just create it then :)"}, {"owner": {"reputation": 2684, "user_id": 800057, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/31b3500592afcf17828cbc1bf2275e73?s=128&d=identicon&r=PG", "display_name": "aacanakin", "link": "https://stackoverflow.com/users/800057/aacanakin"}, "edited": false, "score": 0, "creation_date": 1452009428, "post_id": 34612593, "comment_id": 56977136, "body": "instead of login/logout you can run <code>source $HOME&#47;.profile</code> in terminal"}, {"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "reply_to_user": {"reputation": 2684, "user_id": 800057, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/31b3500592afcf17828cbc1bf2275e73?s=128&d=identicon&r=PG", "display_name": "aacanakin", "link": "https://stackoverflow.com/users/800057/aacanakin"}, "edited": false, "score": 0, "creation_date": 1452011500, "post_id": 34612593, "comment_id": 56978594, "body": "@aacanakin yes that works for the current terminal, but if OP opens another one without logging out and back in first, it will have to be done manually again, giving the impression that editing the file was ineffective."}], "tags": [], "owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "is_accepted": false, "score": 2, "last_activity_date": 1451999536, "creation_date": 1451999536, "answer_id": 34612593, "question_id": 34612380, "link": "https://stackoverflow.com/questions/34612380/gopath-is-not-saving/34612593#34612593", "title": "GOPATH is not saving", "body": "<p>You need to edit your <code>$HOME/.profile</code> script, and add the following lines:</p>\n\n<pre><code>export GOPATH=$HOME/go\nexport PATH=$PATH:$GOPATH/bin\n</code></pre>\n\n<p>for example.</p>\n\n<p>Don't forget to logout/login after saving the file in order for the change to be taken into account.</p>\n\n<p>Adjusting the PATH variable is necessary if you install programs via <code>go get</code> in your $GOPATH and want them to be executable directly from the terminal.</p>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 5747794, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204023423264623/picture?type=large", "display_name": "Balouh", "link": "https://stackoverflow.com/users/5747794/balouh"}, "edited": false, "score": 0, "creation_date": 1452002426, "post_id": 34612984, "comment_id": 56972087, "body": "it works nice. but their is stil a problem. We habe to work with liteide. and liteide can not find the gopath"}, {"owner": {"reputation": 438, "user_id": 5378868, "user_type": "registered", "profile_image": "https://graph.facebook.com/135713123447192/picture?type=large", "display_name": "Ozzadar", "link": "https://stackoverflow.com/users/5378868/ozzadar"}, "reply_to_user": {"reputation": 13, "user_id": 5747794, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204023423264623/picture?type=large", "display_name": "Balouh", "link": "https://stackoverflow.com/users/5747794/balouh"}, "edited": false, "score": 0, "creation_date": 1452003058, "post_id": 34612984, "comment_id": 56972538, "body": "I don&#39;t use liteide personally but I did a quick search into it and it looks like you can <b>sudo nano /usr/share/liteide/liteenv/linux*.env</b> and change your gopath in there.  The full path is <b>/home/{user}/.gvm/pkgsets/go1.5.2/global/</b>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 13, "user_id": 5747794, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204023423264623/picture?type=large", "display_name": "Balouh", "link": "https://stackoverflow.com/users/5747794/balouh"}, "edited": false, "score": 0, "creation_date": 1452006151, "post_id": 34612984, "comment_id": 56974853, "body": "@Balouh: You don&#39;t need GVM. It might be a nice tool for some, but you really need to know basics like how to set a simple environment variable, as you will need it again, e.g. adding GOBIN to your PATH."}, {"owner": {"reputation": 438, "user_id": 5378868, "user_type": "registered", "profile_image": "https://graph.facebook.com/135713123447192/picture?type=large", "display_name": "Ozzadar", "link": "https://stackoverflow.com/users/5378868/ozzadar"}, "edited": false, "score": 0, "creation_date": 1452007455, "post_id": 34612984, "comment_id": 56975756, "body": "Though I agree that one should learn to set up environment variables; the reason I suggest GVM when setting up your go environment is because no matter what linux distro you&#39;re on gvm takes care of your go environment for you and allows you to test against different versions of go without having to manually change any go env variables."}, {"owner": {"reputation": 13, "user_id": 5747794, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204023423264623/picture?type=large", "display_name": "Balouh", "link": "https://stackoverflow.com/users/5747794/balouh"}, "edited": false, "score": 0, "creation_date": 1452024566, "post_id": 34612984, "comment_id": 56986317, "body": "yeah i had tro set the GOROOT in liteide. thanks guuys. i am new to linux an go so had a realy hard day to set things up"}], "tags": [], "owner": {"reputation": 438, "user_id": 5378868, "user_type": "registered", "profile_image": "https://graph.facebook.com/135713123447192/picture?type=large", "display_name": "Ozzadar", "link": "https://stackoverflow.com/users/5378868/ozzadar"}, "is_accepted": true, "score": 0, "last_activity_date": 1452000741, "creation_date": 1452000741, "answer_id": 34612984, "question_id": 34612380, "link": "https://stackoverflow.com/questions/34612380/gopath-is-not-saving/34612984#34612984", "title": "GOPATH is not saving", "body": "<p>I personally use GVM(Go Version Manager) on my linux boxes to handle gopaths</p>\n\n<p>To install:</p>\n\n<pre><code>bash &lt; &lt;(curl -s -S -L https://raw.githubusercontent.com/moovweb/gvm/master/binscripts/gvm-installer)\n</code></pre>\n\n<p>Restart your terminal and use:</p>\n\n<pre><code>apt-get install bison binutils build-essential\ngvm install go1.5.2 -B\ngvm use go1.5.2 --default\n</code></pre>\n\n<p>Your GOPATH will be set to $GOPATH and all \"go get\" will be in $GOPATH/src</p>\n\n<p>This is by far the easiest way to play with golang IMO</p>\n"}], "owner": {"reputation": 13, "user_id": 5747794, "user_type": "registered", "profile_image": "https://graph.facebook.com/10204023423264623/picture?type=large", "display_name": "Balouh", "link": "https://stackoverflow.com/users/5747794/balouh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1476, "favorite_count": 0, "closed_date": 1452001356, "accepted_answer_id": 34612984, "answer_count": 2, "score": -1, "last_activity_date": 1452000741, "creation_date": 1451998866, "question_id": 34612380, "link": "https://stackoverflow.com/questions/34612380/gopath-is-not-saving", "closed_reason": "Needs details or clarity", "title": "GOPATH is not saving", "body": "<p>I try do install golang on my laptop with Xubuntu 15.10.\nBut the GOPATH will not be saved. After reopen the terminal the GOOPATH is not set. \nAnyone an idea how to fix it ? </p>\n"}, {"tags": ["json", "rest", "go", "beego"], "comments": [{"owner": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "edited": false, "score": 2, "creation_date": 1451978526, "post_id": 34605736, "comment_id": 56957707, "body": "Would you mind to provide some minimal reproducer, ideally via  <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">play.golang.org</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1064, "user_id": 2317487, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/S9GeT.jpg?s=128&g=1", "display_name": "Aus", "link": "https://stackoverflow.com/users/2317487/aus"}, "is_accepted": false, "score": 1, "last_activity_date": 1451979163, "last_edit_date": 1451979163, "creation_date": 1451978639, "answer_id": 34606237, "question_id": 34605736, "link": "https://stackoverflow.com/questions/34605736/how-do-i-return-string-value-as-json-object-in-golang/34606237#34606237", "title": "How do I return string value as json object in golang?", "body": "<p>The string you got is a fine JSON formatted value. all you need is to unmarshal it into a correct type.</p>\n\n<p>See below code.</p>\n\n<p>However, I think you misunderstood the ServeJson(), it returns a JSON formatted string which your client will use it, and it does that just fine (see your question).</p>\n\n<p>If you remove the qoutes and slashes, You'll end up with invalid JSON string!</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"log\"\nimport \"encoding/json\"\nfunc main() {\n    var b map[string]int\n    err := json.Unmarshal ([]byte(\"{\\\"key1\\\":0,\\\"key2\\\":0}\"), &amp;b)\n    if err != nil{\n        fmt.Println(\"error: \", err)\n    }\n    log.Print(b)\n    log.Print(b[\"key1\"])\n}\n</code></pre>\n\n<p>You'll get:\n    map[key1:0 key2:0]</p>\n"}, {"comments": [{"owner": {"reputation": 641, "user_id": 2616232, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/b8ef482200e234019a0822caffed2f8c?s=128&d=identicon&r=PG", "display_name": "user2616232", "link": "https://stackoverflow.com/users/2616232/user2616232"}, "edited": false, "score": 0, "creation_date": 1451987860, "post_id": 34606294, "comment_id": 56962573, "body": "Thank you. This is what I was looking for."}], "tags": [], "owner": {"reputation": 186, "user_id": 566762, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d85ef1e30da4dbf5098ecc987c257239?s=128&d=identicon&r=PG", "display_name": "JessonChan", "link": "https://stackoverflow.com/users/566762/jessonchan"}, "is_accepted": true, "score": 5, "last_activity_date": 1452049364, "last_edit_date": 1452049364, "creation_date": 1451978868, "answer_id": 34606294, "question_id": 34605736, "link": "https://stackoverflow.com/questions/34605736/how-do-i-return-string-value-as-json-object-in-golang/34606294#34606294", "title": "How do I return string value as json object in golang?", "body": "<p>you can re-define your json format string in a new type. this is a small demo</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype JSONString string\n\nfunc (j JSONString) MarshalJSON() ([]byte, error) {\n    return []byte(j), nil\n}\n\nfunc main() {\n    s := `{\"key1\":0,\"key2\":0}`\n    content, _ := json.Marshal(JSONString(s))\n    fmt.Println(_, string(content))\n}   \n</code></pre>\n\n<p>in your case you can write like this</p>\n\n<pre><code>this.Data[\"json\"] = JSONString(dao.EventsByTimeRange(request))\nthis.ServeJson()   \n</code></pre>\n\n<p>BTW,golang-json package adds quotation marks because it treats your string as a json value,not a json k-v object.</p>\n"}], "owner": {"reputation": 641, "user_id": 2616232, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/b8ef482200e234019a0822caffed2f8c?s=128&d=identicon&r=PG", "display_name": "user2616232", "link": "https://stackoverflow.com/users/2616232/user2616232"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3971, "favorite_count": 2, "accepted_answer_id": 34606294, "answer_count": 2, "score": 5, "last_activity_date": 1452049364, "creation_date": 1451976520, "last_edit_date": 1451987695, "question_id": 34605736, "link": "https://stackoverflow.com/questions/34605736/how-do-i-return-string-value-as-json-object-in-golang", "title": "How do I return string value as json object in golang?", "body": "<p>I am using golang with beego framework and I have problem with serving strings as json.</p>\n\n<p>EventsByTimeRange returns a string value in json format</p>\n\n<pre><code>this.Data[\"json\"] = dao.EventsByTimeRange(request) // this -&gt; beego controller\nthis.ServeJson()\n\n\"{\\\"key1\\\":0,\\\"key2\\\":0}\"\n</code></pre>\n\n<p>How can I get rid of quotation marks? </p>\n"}, {"tags": ["reflection", "go"], "comments": [{"owner": {"reputation": 435, "user_id": 4977258, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/muLxr.jpg?s=128&g=1", "display_name": "Jianglong Chen", "link": "https://stackoverflow.com/users/4977258/jianglong-chen"}, "edited": false, "score": 0, "creation_date": 1451984537, "post_id": 34605415, "comment_id": 56960533, "body": "Put simply, how does golang reflection get the information of type, such as type name, storage size, fields, function and so on. Even, reflection can set the value."}], "answers": [{"comments": [{"owner": {"reputation": 435, "user_id": 4977258, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/muLxr.jpg?s=128&g=1", "display_name": "Jianglong Chen", "link": "https://stackoverflow.com/users/4977258/jianglong-chen"}, "edited": false, "score": 0, "creation_date": 1451986419, "post_id": 34606729, "comment_id": 56961597, "body": "For example,   <a href=\"https://play.golang.org/p/KGTz2WscGY\" rel=\"nofollow noreferrer\">play.golang.org/p/KGTz2WscGY</a>  How does reflection mechanism get the align information of uint type?"}], "tags": [], "owner": {"reputation": 8752, "user_id": 559289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8183a67842b916b7d7dfd99f5ce7759d?s=128&d=identicon&r=PG", "display_name": "Micka&#235;l R&#233;mond", "link": "https://stackoverflow.com/users/559289/micka%c3%abl-r%c3%a9mond"}, "is_accepted": false, "score": 2, "last_activity_date": 1451980756, "creation_date": 1451980756, "answer_id": 34606729, "question_id": 34605415, "link": "https://stackoverflow.com/questions/34605415/how-does-golang-implement-reflection/34606729#34606729", "title": "How does golang implement reflection?", "body": "<p>The description of interfaces is well described here: <a href=\"http://blog.golang.org/laws-of-reflection\" rel=\"nofollow\">The Laws of Reflection</a>.</p>\n\n<blockquote>\n  <p>A variable of interface type stores a pair: the concrete value\n  assigned to the variable, and that value's type descriptor.</p>\n</blockquote>\n\n<p>Basically, type are known statically from your code. More flexible interface types keep the original underlying type for getting back to the original data type.</p>\n"}, {"tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": true, "score": 8, "last_activity_date": 1451988229, "last_edit_date": 1451988229, "creation_date": 1451987764, "answer_id": 34608738, "question_id": 34605415, "link": "https://stackoverflow.com/questions/34605415/how-does-golang-implement-reflection/34608738#34608738", "title": "How does golang implement reflection?", "body": "<p>This is just an overview and it might be not 100% accurate but hopefully you will find it helpful.</p>\n\n<p>At build time Go linker will embed information about all types used by the application into the executable (<a href=\"https://github.com/golang/go/blob/master/src/runtime/symtab.go#L39\" rel=\"noreferrer\">https://github.com/golang/go/blob/master/src/runtime/symtab.go#L39</a>)</p>\n\n<p>Each interface value contains a pointer to the data type descriptor (<a href=\"https://github.com/golang/go/blob/master/src/runtime/type.go#L14\" rel=\"noreferrer\">https://github.com/golang/go/blob/master/src/runtime/type.go#L14</a>)</p>\n\n<p>During conversion from a type that is known at compile time to an interface value Go compiler will point type descriptor of this interface value to the concrete type descriptor (it is known at compile time!).</p>\n\n<p>E.g. when you call <code>reflect.TypeOf(uint(87))</code>:</p>\n\n<ul>\n<li>an interface value is created by the compiler that references <code>uint</code> type descriptor</li>\n<li>this interface value is passed to <code>reflect.TypeOf</code> function as argument</li>\n<li><code>reflect.TypeOf</code> function uses type descriptor that has been stored by the linker in the executable to get the align (and other) information about uint type.</li>\n</ul>\n"}], "owner": {"reputation": 435, "user_id": 4977258, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/muLxr.jpg?s=128&g=1", "display_name": "Jianglong Chen", "link": "https://stackoverflow.com/users/4977258/jianglong-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1204, "favorite_count": 1, "accepted_answer_id": 34608738, "answer_count": 2, "score": 12, "last_activity_date": 1451988229, "creation_date": 1451975019, "question_id": 34605415, "link": "https://stackoverflow.com/questions/34605415/how-does-golang-implement-reflection", "title": "How does golang implement reflection?", "body": "<p>Using reflection,  we can get the type name, storage size and the function of the given type(such as uint64, user-defined struct and so on). Even, we can modify some fields of the given type.\nHow does golang implement reflections? I guess the following ways:</p>\n\n<ol>\n<li><p>Every type in golang, including user-defined type,  itself has the information about type name, fields name and the function name. Golang reflection just reads these information or call the function.</p></li>\n<li><p>Through some mechanism, Golang can get the type name, storage size and so on. And the type itself doesn\u2019t have these information.</p></li>\n</ol>\n\n<p>I have read the golang reflection code roughly. I guessed that golang used the second way. \nWho can describe the concrete implement of reflection? Or recommend me some documents? Reading all code is difficult for me.</p>\n"}, {"tags": ["go", "gtk3"], "owner": {"reputation": 317, "user_id": 3166558, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/040bab2c7605bd44d7eb8fe6460d9d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Conner H", "link": "https://stackoverflow.com/users/3166558/conner-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 351, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1482953485, "creation_date": 1451957328, "last_edit_date": 1452016450, "question_id": 34602830, "link": "https://stackoverflow.com/questions/34602830/running-multiple-gtk-webkitwebviews-via-goroutines", "title": "Running Multiple GTK WebKitWebViews via Goroutines", "body": "<p>I'm using Go with the <a href=\"https://github.com/gotk3/gotk3\" rel=\"nofollow\">gotk3</a> and <a href=\"https://github.com/sourcegraph/go-webkit2\" rel=\"nofollow\">webkit2</a> libraries to try and build a web crawler that can parse JavaScript in the context of a WebKitWebView.</p>\n\n<p>Thinking of performance, I'm trying to figure out what would be the best way to have it crawl concurrently (if not in parallel, with multiple processors), using all available resources.</p>\n\n<p>GTK and everything with threads and goroutines are pretty new to me.  Reading from the <a href=\"https://github.com/gotk3/gotk3-examples/blob/master/gtk-examples/goroutines/goroutines.go#L49-L52\" rel=\"nofollow\">gotk3 goroutines example</a>, it states:</p>\n\n<blockquote>\n  <p>Native GTK is not thread safe, and thus, gotk3's GTK bindings may not be used from other goroutines.  Instead, glib.IdleAdd() must be used to add a function to run in the GTK main loop when it is in an idle state.</p>\n</blockquote>\n\n<p>Go will panic and show a stack trace when I try to run a function, which creates a new WebView, in a goroutine.  I'm not exactly sure why this happens, but I think it has something to do with this comment.  An example is shown below.</p>\n\n<h1>Current Code</h1>\n\n<p>Here's my current code, which has been adapted from the <a href=\"https://github.com/sourcegraph/go-webkit2/blob/master/webkit2/example_test.go\" rel=\"nofollow\">webkit2 example</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gotk3/gotk3/glib\"\n    \"github.com/gotk3/gotk3/gtk\"\n    \"github.com/sourcegraph/go-webkit2/webkit2\"\n    \"github.com/sqs/gojs\"\n)\n\nfunc crawlPage(url string) {\n    web := webkit2.NewWebView()\n\n    web.Connect(\"load-changed\", func(_ *glib.Object, i int) {\n        loadEvent := webkit2.LoadEvent(i)\n\n        switch loadEvent {\n        case webkit2.LoadFinished:\n            fmt.Printf(\"Load finished for: %v\\n\", url)\n\n            web.RunJavaScript(\"window.location.hostname\", func(val *gojs.Value, err error) {\n                if err != nil {\n                    fmt.Println(\"JavaScript error.\")\n                } else {\n                    fmt.Printf(\"Hostname (from JavaScript): %q\\n\", val)\n                }\n\n                //gtk.MainQuit()\n            })\n        }\n    })\n\n    glib.IdleAdd(func() bool {\n        web.LoadURI(url)\n        return false\n    })\n}\n\nfunc main() {\n    gtk.Init(nil)\n\n    crawlPage(\"https://www.google.com\")\n    crawlPage(\"https://www.yahoo.com\")\n    crawlPage(\"https://github.com\")\n    crawlPage(\"http://deelay.me/2000/http://deelay.me/img/1000ms.gif\")\n\n    gtk.Main()\n}\n</code></pre>\n\n<p>It seems that creating a new WebView for each URL allows them to load concurrently.  Having <code>glib.IdleAdd()</code> running in a goroutine, as per the gotk3 example, doesn't seem to have any effect (although I'm only doing a visual benchmark):</p>\n\n<pre><code>go glib.IdleAdd(func() bool { // Works\n    web.LoadURI(url)\n    return false\n})\n</code></pre>\n\n<p>However, trying to create a goroutine for each <code>crawlPage()</code> call ends in a panic:</p>\n\n<pre><code>go crawlPage(\"https://www.google.com\") // Panics and shows stack trace\n</code></pre>\n\n<p>I can run <code>web.RunJavaScript()</code> in a goroutine without issue:</p>\n\n<pre><code>        switch loadEvent {\n        case webkit2.LoadFinished:\n            fmt.Printf(\"Load finished for: %v\\n\", url)\n\n            go web.RunJavaScript(\"window.location.hostname\", func(val *gojs.Value, err error) { // Works\n                if err != nil {\n                    fmt.Println(\"JavaScript error.\")\n                } else {\n                    fmt.Printf(\"Hostname (from JavaScript): %q\\n\", val)\n                }\n\n                //gtk.MainQuit()\n            })\n        }\n</code></pre>\n\n<h1>Best Method?</h1>\n\n<p>The current methods I can think of are:</p>\n\n<ol>\n<li>Spawn new WebViews to crawl each page, as shown in the current code.  Track how many WebViews are opened and either continually delete and create new ones, or reuse a set number created initially, to where all available resources on the machine are used.  Would this be limited in terms of processor cores being used?</li>\n<li>Basic idea of #1, but running the binary multiple times (instead of one gocrawler process running on the machine, have four) to utilize all cores/resources.</li>\n<li>Run the GUI (gtk3) portion of the app in its own goroutine.  I could then pass data to other goroutines which do their own heavy processing, such as searching through content.</li>\n</ol>\n\n<p>What would actually be the best way to run this code concurrently, if possible, and max out performance?</p>\n\n<h1>Update</h1>\n\n<p>Method 1 and 2 are probably out of the picture, as I ran a test by spawning ~100 WebViews and they seem to load synchronously.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1451950224, "post_id": 34601533, "comment_id": 56949310, "body": "See <a href=\"http://stackoverflow.com/questions/4442453/mongodb-query-condition-on-comparing-2-fields\" title=\"mongodb query condition on comparing 2 fields\">stackoverflow.com/questions/4442453/&hellip;</a>"}, {"owner": {"reputation": 3443, "user_id": 1693516, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/fwHRC.jpg?s=128&g=1", "display_name": "yaoxing", "link": "https://stackoverflow.com/users/1693516/yaoxing"}, "edited": false, "score": 0, "creation_date": 1451962764, "post_id": 34601533, "comment_id": 56952669, "body": "Be careful, it works but it will not hit any index that way."}], "owner": {"reputation": 101, "user_id": 1581920, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/06009732daa93ff5ee2e4a79111a8a70?s=128&d=identicon&r=PG", "display_name": "Classico", "link": "https://stackoverflow.com/users/1581920/classico"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1451948874, "creation_date": 1451948874, "question_id": 34601533, "link": "https://stackoverflow.com/questions/34601533/find-a-document-where-field-a-less-than-b", "title": "Find a document where field A less than B", "body": "<p>I'm new in Go and MongoDB. And I faced with a following case:</p>\n\n<p>I have following document:</p>\n\n<pre><code>{\n\"_id\": \"568adf31945dbe55e3189f6a\"\n\"test1\": 5\n\"test2\": 10\n\"status\": \"in progress\"\n}\n</code></pre>\n\n<p>And I need to increment test1 field while it is less than test2.</p>\n\n<p>If I want to compare field with a static value I can use following code:</p>\n\n<pre><code>change := mgo.Change{Update: bson.M{\"$inc\": bson.M{\"test1\": 1}},}\n\nmyModel := models.MyModel{}\n\ninfo, err := db.Find(\n        bson.M{\"_id\" : bson.ObjectIdHex(\"568adf31945dbe55e3189f6a\"),\n               \"test1\": bson.M{ \"$lt\": 10 }}).Apply(change, &amp;myModel)\n</code></pre>\n\n<p>But how can I compare test1 with test2 field in the find function? (I want to have atomic find without additional requests to the database)</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["pointers", "go", "interface"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1451945737, "post_id": 34600817, "comment_id": 56947337, "body": "This line makes no sense: <code>i = &amp;i</code>"}, {"owner": {"reputation": 115, "user_id": 1358596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/rl0mZ.jpg?s=128&g=1", "display_name": "Alik Send", "link": "https://stackoverflow.com/users/1358596/alik-send"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1451945837, "post_id": 34600817, "comment_id": 56947395, "body": "May be. But first two lines in <code>stdout</code> differ"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1451948422, "post_id": 34600817, "comment_id": 56948628, "body": "Maybe the best advice here might be: Stop shaving the yak and redesign everything from scratch. NextValuer smells like forcing iterators on Go. If some thing just returns one thing after the other endlessly why not use a channel?"}, {"owner": {"reputation": 115, "user_id": 1358596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/rl0mZ.jpg?s=128&g=1", "display_name": "Alik Send", "link": "https://stackoverflow.com/users/1358596/alik-send"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1451950082, "post_id": 34600817, "comment_id": 56949253, "body": "@Volker it is just a short version to show a problem. the real code is bigger and complicated"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1451976127, "post_id": 34600817, "comment_id": 56956655, "body": "Then redesigning it seems even more appropriate."}], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 1358596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/rl0mZ.jpg?s=128&g=1", "display_name": "Alik Send", "link": "https://stackoverflow.com/users/1358596/alik-send"}, "edited": false, "score": 0, "creation_date": 1451946361, "post_id": 34600906, "comment_id": 56947666, "body": "No, I can&#39;t do it. Because I have many types, that implements <code>NextValuer</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 115, "user_id": 1358596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/rl0mZ.jpg?s=128&g=1", "display_name": "Alik Send", "link": "https://stackoverflow.com/users/1358596/alik-send"}, "edited": false, "score": 1, "creation_date": 1451946669, "post_id": 34600906, "comment_id": 56947806, "body": "@AlikSend: what do you mean &quot;no, you can&#39;t do it&quot;? You either need to start with a pointer (which is what you should be doing), or create a copy to get a pointer, there aren&#39;t any other choices. Do you want a solution which uses reflect to create a new copy of the value?"}, {"owner": {"reputation": 115, "user_id": 1358596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/rl0mZ.jpg?s=128&g=1", "display_name": "Alik Send", "link": "https://stackoverflow.com/users/1358596/alik-send"}, "edited": false, "score": 0, "creation_date": 1451947854, "post_id": 34600906, "comment_id": 56948376, "body": "@JimBe I just coming up with an idea to make it, but with that I have to change code in whole project. If it can be done with <code>reflect</code>, can you show me that? That decision because I already use <code>reflect</code> in this function"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 115, "user_id": 1358596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/rl0mZ.jpg?s=128&g=1", "display_name": "Alik Send", "link": "https://stackoverflow.com/users/1358596/alik-send"}, "edited": false, "score": 0, "creation_date": 1451953159, "post_id": 34600906, "comment_id": 56950280, "body": "@AlikSend: Added a reflect example for when you have absolutely no idea what type the interface may contain, and you need a pointer instead of a value."}, {"owner": {"reputation": 115, "user_id": 1358596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/rl0mZ.jpg?s=128&g=1", "display_name": "Alik Send", "link": "https://stackoverflow.com/users/1358596/alik-send"}, "edited": false, "score": 1, "creation_date": 1451983162, "post_id": 34600906, "comment_id": 56959850, "body": "I mark your answer as solution. But I think that redesigning is really be better in this case. Thank you"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1451953016, "last_edit_date": 1451953016, "creation_date": 1451945983, "answer_id": 34600906, "question_id": 34600817, "link": "https://stackoverflow.com/questions/34600817/pointer-to-interface-with-saving-type/34600906#34600906", "title": "Pointer to interface with saving type", "body": "<p>Never use a pointer to an interface. If you need a pointer to call a method with a pointer receiver, a pointer is what you must put into the <code>interface{}</code>.</p>\n\n<p>If you have already have value in an <code>interface{}</code> where you want to call a method with a pointer receiver, you need to make an addressable copy of that value. </p>\n\n<p>What you're trying to accomplish with <code>i = &amp;i</code> is probably:</p>\n\n<pre><code>item := i.(Item)\ni = &amp;item\n</code></pre>\n\n<p>This creates an addressable copy of the original <code>Item</code>, and then puts a pointer to that copy into <code>i</code>. Note that this can never change the value of the original <code>Item</code>.</p>\n\n<p>If you don't know the type that can be in the <code>interface{}</code>, you can make a copy of the value with \"reflect\":</p>\n\n<pre><code>func nextVal(i interface{}) {\n    // get the value in i\n    v := reflect.ValueOf(i)\n\n    // create a pointer to a new value of the same type as i\n    n := reflect.New(v.Type())\n    // set the new value with the value of i\n    n.Elem().Set(v)\n\n    // Get the new pointer as an interface, and call NextVal\n    fmt.Println(\"NextVal:\", n.Interface().(NextValuer).NextVal())\n\n    // this could also be assigned another interface{}\n    i = n.Interface()\n    nv, ok := i.(NextValuer)\n    fmt.Printf(\"i is a NextValuer: %t\\nNextVal: %d\\n\", ok, nv.NextVal())\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/gbO9QGz2Tq\" rel=\"nofollow\">http://play.golang.org/p/gbO9QGz2Tq</a></p>\n"}], "owner": {"reputation": 115, "user_id": 1358596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/rl0mZ.jpg?s=128&g=1", "display_name": "Alik Send", "link": "https://stackoverflow.com/users/1358596/alik-send"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 34600906, "answer_count": 1, "score": -1, "last_activity_date": 1451953016, "creation_date": 1451945552, "question_id": 34600817, "link": "https://stackoverflow.com/questions/34600817/pointer-to-interface-with-saving-type", "title": "Pointer to interface with saving type", "body": "<p>The shortest way to explain my problem is <a href=\"http://play.golang.org/p/cTZYcz_1BX\" rel=\"nofollow\">that code</a>:</p>\n\n<pre><code>var i interface{} // I can't change it. In fact this is a function,\ni = Item{10}      // that receives interface{}, that contain object (not pointer to object!)\n\nfmt.Printf(\"%T %v\\n\", i, i)\n// fmt.Println(i.(NextValuer).NextVal())  // won't compile\ni = &amp;i\nfmt.Printf(\"%T %v\\n\", i, i)               // there i is pointer to interface{} (not to Item)\n// fmt.Println(i.(NextValuer).NextVal())  // panics\n// fmt.Println(i.(*NextValuer).NextVal()) // won't compile\n</code></pre>\n\n<p>But if I try to set pointer to Item to i, code works:</p>\n\n<pre><code>i = &amp;Item{10}\nfmt.Printf(\"%T %v\\n\", i, i)\nfmt.Println(i.(NextValuer).NextVal())\n</code></pre>\n\n<p>But my function receives object, not pointer to it. And I can get type of it (first <code>fmt.Printf</code>). But when I try to make pointer to it, I receive pointer to <code>interface{}</code>, not to my Object (<code>Item</code>). </p>\n\n<p>Can I make pointer to this object to call <code>NextVal</code>? Or may be other ways to do it</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 548, "user_id": 1560743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2151b67a581590c280289086c3434d88?s=128&d=identicon&r=PG", "display_name": "zeroed", "link": "https://stackoverflow.com/users/1560743/zeroed"}, "edited": false, "score": 1, "creation_date": 1451944672, "post_id": 34600582, "comment_id": 56946797, "body": "Just a guest, maybe it helps:  <code>import &quot;net&#47;url&quot;</code>"}, {"owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "reply_to_user": {"reputation": 548, "user_id": 1560743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2151b67a581590c280289086c3434d88?s=128&d=identicon&r=PG", "display_name": "zeroed", "link": "https://stackoverflow.com/users/1560743/zeroed"}, "edited": false, "score": 0, "creation_date": 1451944827, "post_id": 34600582, "comment_id": 56946863, "body": "That&#39;s the answer, my god, didn&#39;t know that. Thanks mate"}], "answers": [{"tags": [], "owner": {"reputation": 548, "user_id": 1560743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2151b67a581590c280289086c3434d88?s=128&d=identicon&r=PG", "display_name": "zeroed", "link": "https://stackoverflow.com/users/1560743/zeroed"}, "is_accepted": true, "score": 3, "last_activity_date": 1451945265, "creation_date": 1451945265, "answer_id": 34600763, "question_id": 34600582, "link": "https://stackoverflow.com/questions/34600582/how-to-properly-pass-arguments-in-go-function/34600763#34600763", "title": "How to properly pass arguments in Go function?", "body": "<p>As reported in the comment, if someone else is looking for the answer, there is no mistake in the code above, just a missing import:</p>\n\n<pre><code>import \"net/url\"\n</code></pre>\n"}], "owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 34600763, "answer_count": 1, "score": -4, "last_activity_date": 1451945265, "creation_date": 1451944539, "question_id": 34600582, "link": "https://stackoverflow.com/questions/34600582/how-to-properly-pass-arguments-in-go-function", "title": "How to properly pass arguments in Go function?", "body": "<p>This is a function from the <a href=\"https://github.com/ChimeraCoder/anaconda\" rel=\"nofollow\">Anaconda</a> Go package:</p>\n\n<pre><code>func (a TwitterApi) GetHomeTimeline(v url.Values) (timeline []Tweet, err error) {\n    if v == nil {\n        v = url.Values{}\n    }\n\n    if val := v.Get(\"include_entities\"); val == \"\" {\n        v.Set(\"include_entities\", \"true\")\n    }\n\n    response_ch := make(chan response)\n    a.queryQueue &lt;- query{a.baseUrl + \"/statuses/home_timeline.json\", v, &amp;timeline, _GET, response_ch}\n    return timeline, (&lt;-response_ch).err\n}\n</code></pre>\n\n<p>When I call the function like this, it works fine:</p>\n\n<p><code>result, _ := api.GetHomeTimeline(nil)</code></p>\n\n<p>But now I want to change the argument from <code>nil</code> into something else. In the <a href=\"https://github.com/ChimeraCoder/anaconda#queries\" rel=\"nofollow\">example</a>* this is set as:</p>\n\n<pre><code>v := url.Values{}\nv.Set(\"count\", \"30\")\nresult, _ := api.GetHomeTimeline(v)\n</code></pre>\n\n<p>But this generates the error: <code>undefined: url in url.Values</code></p>\n\n<p><code>*</code> - I've set the example to match my request.</p>\n"}, {"tags": ["git", "go", "libgit2"], "answers": [{"tags": [], "owner": {"reputation": 1598, "user_id": 1104534, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad2bdd8c4d37364f52e6ab7aa92ef570?s=128&d=identicon&r=PG", "display_name": "Calin", "link": "https://stackoverflow.com/users/1104534/calin"}, "is_accepted": false, "score": 1, "last_activity_date": 1452004536, "creation_date": 1452004536, "answer_id": 34614210, "question_id": 34599073, "link": "https://stackoverflow.com/questions/34599073/git2gos-checkouthead-not-updating-the-index/34614210#34614210", "title": "git2go&#39;s CheckoutHead() not updating the index", "body": "<p>I managed to solve it by reading the tree into the index and writing the index to disk before the checkout. The code looks something like this:</p>\n\n<pre><code>repo.SetHead(\"refs/remotes/origin/master\")\n# get the index and the HEAD tree...\nindex.ReadTree(headTree)\nindex.Write()\nrepo.CheckoutHead(&amp;git.CheckoutOpts{Strategy: git.CheckoutForce})\n</code></pre>\n\n<p>This appears to have the same effect as running <code>git checkout -f origin/master</code>. But I don't know why the <a href=\"https://libgit2.github.com/libgit2/#HEAD/group/index/git_index_read_tree\" rel=\"nofollow\"><code>ReadTree()</code></a> is necessary, since <a href=\"https://libgit2.github.com/libgit2/#HEAD/group/checkout/git_checkout_head\" rel=\"nofollow\"><code>CheckoutHead()</code></a> <strong>should</strong> update the index <em>and</em> the working tree, <a href=\"https://libgit2.github.com/libgit2/#HEAD/group/checkout/git_checkout_head\" rel=\"nofollow\">per the docs</a>:</p>\n\n<blockquote>\n  <p><strong>git_checkout_head</strong><br>\n  Updates files in the index and the working tree to match the content of the commit pointed at by HEAD.</p>\n</blockquote>\n\n<p>My best guess is that the checkout doesn't work correctly because the index points to an empty tree initially. However I'm not sure if it's a libgit2 bug or not.</p>\n"}, {"comments": [{"owner": {"reputation": 1598, "user_id": 1104534, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad2bdd8c4d37364f52e6ab7aa92ef570?s=128&d=identicon&r=PG", "display_name": "Calin", "link": "https://stackoverflow.com/users/1104534/calin"}, "edited": false, "score": 1, "creation_date": 1464798517, "post_id": 37572989, "comment_id": 62635446, "body": "Thanks, yeah I noticed that this method works, but <code>git_checkout_head()</code> says it updates the index and the working tree, so I would expect it to work similar to <code>git checkout -f HEAD</code> (especially when using it with --force), why isn&#39;t this true? Also what if I have an already dirty worktree and I want to sync the worktree with the index, as I would do with <code>git checkout -f</code>? Seems to me that <code>git_checkout_head()</code> is pretty useless (with --force at least)."}, {"owner": {"reputation": 63488, "user_id": 729881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fdfaf0aad74fef442e2ffc9999ef9c1?s=128&d=identicon&r=PG", "display_name": "Edward Thomson", "link": "https://stackoverflow.com/users/729881/edward-thomson"}, "reply_to_user": {"reputation": 1598, "user_id": 1104534, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad2bdd8c4d37364f52e6ab7aa92ef570?s=128&d=identicon&r=PG", "display_name": "Calin", "link": "https://stackoverflow.com/users/1104534/calin"}, "edited": false, "score": 0, "creation_date": 1464800270, "post_id": 37572989, "comment_id": 62636497, "body": "It does update the index and the working tree.  Your example (above) shows <code>git checkout -f &lt;branch&gt;</code> and then tries to equate that with <code>git_checkout_head</code>; they are not the same.  If you are seeing differences between <code>git_checkout_head</code> and <code>git checkout -f HEAD</code> (when following the same steps) then please elucidate that in a further question or an issue."}, {"owner": {"reputation": 1598, "user_id": 1104534, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad2bdd8c4d37364f52e6ab7aa92ef570?s=128&d=identicon&r=PG", "display_name": "Calin", "link": "https://stackoverflow.com/users/1104534/calin"}, "edited": false, "score": 0, "creation_date": 1464802180, "post_id": 37572989, "comment_id": 62637617, "body": "Alright. I am seeing differences between <code>git checkout -f HEAD</code> and <code>git_checkout_head()</code>, so I will create a reproductible test case and open an issue in libgit2 (but using git2go since it&#39;s easier for me). Thanks."}, {"owner": {"reputation": 555, "user_id": 341446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13e59f481d249fa5e311c3b54139a581?s=128&d=identicon&r=PG", "display_name": "asandroq", "link": "https://stackoverflow.com/users/341446/asandroq"}, "edited": false, "score": 0, "creation_date": 1486473012, "post_id": 37572989, "comment_id": 71351454, "body": "I also don&#39;t understand why the docs for <code>git_checkout_head</code> say that it updates the index and the working tree to match the commit pointed to by HEAD when it obviously doesn&#39;t."}, {"owner": {"reputation": 63488, "user_id": 729881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fdfaf0aad74fef442e2ffc9999ef9c1?s=128&d=identicon&r=PG", "display_name": "Edward Thomson", "link": "https://stackoverflow.com/users/729881/edward-thomson"}, "reply_to_user": {"reputation": 555, "user_id": 341446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13e59f481d249fa5e311c3b54139a581?s=128&d=identicon&r=PG", "display_name": "asandroq", "link": "https://stackoverflow.com/users/341446/asandroq"}, "edited": false, "score": 1, "creation_date": 1486555645, "post_id": 37572989, "comment_id": 71393966, "body": "@asandroq Absolutely it does.  The problem is that when you change <code>HEAD</code> <i>before</i> a checkout, your working tree is now dirty.  You will see that if you change <code>HEAD</code> arbitrarily and then run <code>git status</code>.  If you then do a <code>git checkout HEAD</code>, it will try to checkout that data, but there&#39;s no guarantee that it can - because your worktree is dirty.  Do the checkout in your pristine state, then update <code>HEAD</code> if it was successful.  We&#39;ve updated the documentation to explain this better."}], "tags": [], "owner": {"reputation": 63488, "user_id": 729881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fdfaf0aad74fef442e2ffc9999ef9c1?s=128&d=identicon&r=PG", "display_name": "Edward Thomson", "link": "https://stackoverflow.com/users/729881/edward-thomson"}, "is_accepted": false, "score": 1, "last_activity_date": 1464795017, "creation_date": 1464795017, "answer_id": 37572989, "question_id": 34599073, "link": "https://stackoverflow.com/questions/34599073/git2gos-checkouthead-not-updating-the-index/37572989#37572989", "title": "git2go&#39;s CheckoutHead() not updating the index", "body": "<p>Don't update <code>HEAD</code> before checking our or your working directory will be dirty and checkout will (likely) not be able to proceed.  Instead checkout <em>to</em> what you want, and <em>then</em> update <code>HEAD</code> if checkout succeeds:</p>\n\n<p>Something like:</p>\n\n<pre><code>target, err := repo.LookupCommit(newHeadId)\nrepo.CheckoutTree(target, &amp;git.CheckoutOpts{Strategy: git.CheckoutSafe})\n_, err = repo.References.Create(\"refs/heads/master\", commitId, true, \"master\")\n</code></pre>\n"}], "owner": {"reputation": 1598, "user_id": 1104534, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad2bdd8c4d37364f52e6ab7aa92ef570?s=128&d=identicon&r=PG", "display_name": "Calin", "link": "https://stackoverflow.com/users/1104534/calin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1464795017, "creation_date": 1451938461, "last_edit_date": 1464775735, "question_id": 34599073, "link": "https://stackoverflow.com/questions/34599073/git2gos-checkouthead-not-updating-the-index", "title": "git2go&#39;s CheckoutHead() not updating the index", "body": "<p>I'm trying to initialize a repository over an existing directory, add a remote and force checkout the remote's master branch over the existing files. The cli commands for this would be:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>git init .\ngit add remote origin 'https://domain/repo.git'\ngit fetch\ngit checkout -f origin/master\n</code></pre>\n\n<p>Everything works fine but the index doesn't appear to change after the checkout. The relevant code is:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code># (init repo, add the 'origin' remote and fetch it...)\nrepo.SetHead(\"refs/remotes/origin/master\")\nrepo.CheckoutHead(&amp;git.CheckoutOpts{Strategy: git.CheckoutForce})\n</code></pre>\n\n<p>When I do a <code>git status</code>, I see the same files appearing as deleted (D) in the index and also as untracked (yes, the same file appears as both), while the workdir does contain the correct files. Since this looks like the index wasn't written to disk from memory, or has some weird cache, I also tried <code>index.Write()</code> after the checkout but that didn't make any change.</p>\n\n<p>If I run <code>git reset HEAD</code> in the repo, then <code>git status</code> returns a clean state, since the index gets updated to the current HEAD tree and it now reflects the workdir.</p>\n\n<h3>Update</h3>\n\n<p>I noticed this only happens when the files in the existing directory are the same as in the origin repo (file mode isn't important). In this case those files appear as deleted (D) and untracked (??).</p>\n\n<p>It doesn't happen when the file exists but has a different content. In this case the file correctly appears as modified (M).</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1451933421, "post_id": 34597717, "comment_id": 56941031, "body": "What do you mean &quot;Html()&quot; doesn&#39;t seem to exist? <a href=\"https://godoc.org/github.com/PuerkitoBio/goquery#Selection.Html\" rel=\"nofollow noreferrer\">godoc.org/github.com/PuerkitoBio/goquery#Selection.Html</a> -- It returns 2 values, so your code can&#39;t compile."}, {"owner": {"reputation": 1365, "user_id": 402585, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bafeba1f17a0130b4a6b2c7df709eb85?s=128&d=identicon&r=PG", "display_name": "Edd Turtle", "link": "https://stackoverflow.com/users/402585/edd-turtle"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451933636, "post_id": 34597717, "comment_id": 56941147, "body": "ahhh ha! of course, that looks way better! - thanks @JimB :) seems to work now. For the record, changed it to:  <code>html, _ := s.Html()</code> <code>fmt.Printf(&quot;Review %d: %s\\n&quot;, i, html)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 134, "user_id": 1334914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1g1u.jpg?s=128&g=1", "display_name": "Mikhail Andrianov", "link": "https://stackoverflow.com/users/1334914/mikhail-andrianov"}, "is_accepted": true, "score": 2, "last_activity_date": 1546859363, "last_edit_date": 1546859363, "creation_date": 1463233342, "answer_id": 37227396, "question_id": 34597717, "link": "https://stackoverflow.com/questions/34597717/how-to-get-the-contents-of-a-html-element/37227396#37227396", "title": "How to get the contents of a HTML element", "body": "<p>You're not getting the result (s.Html() actually exist), because you haven't set the variable and error handler. </p>\n\n<p>Please add this to your code and it will work fine: </p>\n\n<pre><code>doc.Find(\"#publication\").Each(func(i int, s *goquery.Selection) {\n    inside_html,_ := s.Html() //underscore is an error\n    fmt.Printf(\"Review %d: %s\\n\", i, inside_html)\n})\n</code></pre>\n"}], "owner": {"reputation": 1365, "user_id": 402585, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bafeba1f17a0130b4a6b2c7df709eb85?s=128&d=identicon&r=PG", "display_name": "Edd Turtle", "link": "https://stackoverflow.com/users/402585/edd-turtle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2127, "favorite_count": 0, "accepted_answer_id": 37227396, "answer_count": 1, "score": 2, "last_activity_date": 1546859363, "creation_date": 1451933044, "question_id": 34597717, "link": "https://stackoverflow.com/questions/34597717/how-to-get-the-contents-of-a-html-element", "title": "How to get the contents of a HTML element", "body": "<p>I'm quite new to Go and I'm struggling a little at the moment with parsing some html.</p>\n\n<p>The HTML looks like:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n    &lt;div&gt;something&lt;/div&gt;\n\n    &lt;div id=\"publication\"&gt;\n        &lt;div&gt;I want &lt;span&gt;this&lt;/span&gt;&lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div&gt;\n        &lt;div&gt;not this&lt;/div&gt;\n    &lt;/div&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>And I want to get this as a string:</p>\n\n<pre><code>&lt;div&gt;I want &lt;span&gt;this&lt;/span&gt;&lt;/div&gt;\n</code></pre>\n\n<p>I've tried html.NewTokenizer() (from golang.org/x/net/html) but can't seem to get the entire contents of an element back from a token or node. I've also tried using depth with this but it picked up other bits of code.</p>\n\n<p>I've also had a go with goquery which seems perfect, code:</p>\n\n<pre><code>doc, err := goquery.NewDocument(\"{url}\")\nif err != nil {\n    log.Fatal(err)\n}\n\ndoc.Find(\"#publication\").Each(func(i int, s *goquery.Selection) {\n    fmt.Printf(\"Review %d: %s\\n\", i, s.Html())\n})\n</code></pre>\n\n<p>But s.Text() will only print out the text and s.Html() doesn't seem to exist (?).</p>\n\n<p>I think parsing it as XML would work, except the actual HTML is very deep and there would have to be a struct for each parent element...</p>\n\n<p>Any help would be amazing!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 35, "user_id": 5728210, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/addde50e68dce92f3b817a4a131bd941?s=128&d=identicon&r=PG&f=1", "display_name": "mjhd", "link": "https://stackoverflow.com/users/5728210/mjhd"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1451924640, "post_id": 34595024, "comment_id": 56936124, "body": "Typically there is 4-50 in the collection"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1451925447, "post_id": 34595024, "comment_id": 56936596, "body": "A loop comparing 4-50 strings will not increase executation from 2ms to 600ms.  Something else is going on."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451925474, "post_id": 34595024, "comment_id": 56936609, "body": "Profile your code and see what is blocking. You haven&#39;t shown enough here to indicate a problem."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1451926070, "post_id": 34595024, "comment_id": 56936965, "body": "Are you actually printing something? That will certainly slow things down considerably"}, {"owner": {"reputation": 35, "user_id": 5728210, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/addde50e68dce92f3b817a4a131bd941?s=128&d=identicon&r=PG&f=1", "display_name": "mjhd", "link": "https://stackoverflow.com/users/5728210/mjhd"}, "edited": false, "score": 0, "creation_date": 1451926895, "post_id": 34595024, "comment_id": 56937456, "body": "See edit :) Found whats slowing it down"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1451928362, "post_id": 34595024, "comment_id": 56938244, "body": "You&#39;re re-parsing <code>Condition</code> 3 full times every time you call its String method. Copy it the values once into another field of the correct type, or better yet, do it during Unamrshal to remove these extra methods altogether."}, {"owner": {"reputation": 35, "user_id": 5728210, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/addde50e68dce92f3b817a4a131bd941?s=128&d=identicon&r=PG&f=1", "display_name": "mjhd", "link": "https://stackoverflow.com/users/5728210/mjhd"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451929468, "post_id": 34595024, "comment_id": 56938916, "body": "@JimB not sure I follow exactly"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451929839, "post_id": 34595024, "comment_id": 56939107, "body": "Every time <code>Condition.String()</code> is called, you call <code>Val</code> 3 more times, allocating slices and copying the values in, and then you throw it all away. At a minimum, call <code>Val</code> once for <code>String</code>, but it would be better to not allocated the extra slice every time to begin with. This is a problem, but it might not be your only problem. Either profile the code, or post a reproducible example."}, {"owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "edited": false, "score": 0, "creation_date": 1451943569, "post_id": 34595024, "comment_id": 56946245, "body": "You definitely should memorize <code>Condition.Val()</code> result if performance is your concern here. But I don&#39;t see where <code>Condition.String()</code> is called and how this can affect this particular loop..."}], "answers": [{"tags": [], "owner": {"reputation": 468, "user_id": 1117026, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/1b833426c9221e4b886def0ddd170d05?s=128&d=identicon&r=PG", "display_name": "elgris", "link": "https://stackoverflow.com/users/1117026/elgris"}, "is_accepted": false, "score": 2, "last_activity_date": 1451930073, "creation_date": 1451930073, "answer_id": 34596941, "question_id": 34595024, "link": "https://stackoverflow.com/questions/34595024/golang-slow-when-looping-over-collection/34596941#34596941", "title": "Golang slow when looping over Collection", "body": "<p>Sounds weird, but try to avoid copying of Collection elements. Something like this:</p>\n\n<pre><code>for i := range triggers.Collection {\nif triggers.Collection[i].Event == \"some value\" {\n    fmt.Println(\"We got: some value\")\n}\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 5728210, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/addde50e68dce92f3b817a4a131bd941?s=128&d=identicon&r=PG&f=1", "display_name": "mjhd", "link": "https://stackoverflow.com/users/5728210/mjhd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1451930073, "creation_date": 1451923225, "last_edit_date": 1451926826, "question_id": 34595024, "link": "https://stackoverflow.com/questions/34595024/golang-slow-when-looping-over-collection", "title": "Golang slow when looping over Collection", "body": "<p>Im feeding my app a json from Redis which I then unmarshal and loop through.</p>\n\n<p>Here is what the json Im feeding from Redis looks like:</p>\n\n<pre><code>[\n    {\n        \"titel\": \"test 1\",\n        \"event\": \"some value\",\n        \"pair\": \"some value\",\n        \"condition\": [\n            \"or\",\n            [\n                \"contains\",\n                \"url\",\n                \"/\"\n            ],[\n                \"notcontains\",\n                \"url\",\n                \"hello\"\n            ]\n        ],\n        \"actions\": [\n            [\n                \"option1\",\n                \"12\",\n                \"1\"\n            ],\n            [\n                \"option2\",\n                \"3\",\n                \"1\"\n            ]\n        ]\n    }, {\n        \"titel\": \"test 2\",\n        \"event\": \"some value\",\n        \"pair\": \"some value\",\n        \"condition\": [\n            \"or\",\n            [\n                \"contains\",\n                \"url\",\n                \"/\"\n            ]\n        ],\n        \"actions\": [\n            [\n                \"option1\",\n                \"12\",\n                \"1\"\n            ],\n            [\n                \"option2\",\n                \"3\",\n                \"1\"\n            ]\n        ]\n    }\n]\n</code></pre>\n\n<p>My struct to store the json looks like this:</p>\n\n<pre><code>type Trigger struct {\n    Event     string        `json:\"event\"`  \n    Pair      string        `json:\"pair\"`   \n    Actions   [][]string    `json:\"actions\"`\n    Condition Condition     `json:\"condition\"`\n}\n\ntype Condition []interface{}\n\nfunc (c *Condition) Typ() string {\n    return (*c)[0].(string)\n}\n\nfunc (c *Condition) Val() []string {\n    xs := (*c)[1].([]interface{})\n    ys := make([]string, len(xs))\n    for i, x := range xs {\n        ys[i] = x.(string)\n    }\n    return ys\n}\n\nfunc (c *Condition) String() (string, string, string) {\n    return c.Val()[0], c.Val()[1], c.Val()[2]\n}\n\ntype Triggers struct {\n    Collection []Trigger\n}\n</code></pre>\n\n<p>And Im unmarshaling it into the struct like so:</p>\n\n<pre><code>var triggers Triggers\nerr := json.Unmarshal([]byte(triggersJson), &amp;triggers.Collection)\nif err != nil {\n    fmt.Println(\"Error while unmarshaling triggers json: \", err)\n}\n</code></pre>\n\n<p>This works and performs perfectly fine while testing it with siege.\nHowever, as soon as I want to start loop over the struct Im starting to see long response times and timeouts.</p>\n\n<p>This is how I loop over it:</p>\n\n<pre><code>for _,element := range triggers.Collection {\n    if element.Event == \"some value\" {\n        fmt.Println(\"We got: some value\")\n    }\n }\n</code></pre>\n\n<p>Performance without the loop is 2ms on 500 concurrent connections.\nWith the loop its 600ihs ms on 500 concurrent with a bunch of timeouts</p>\n\n<p>Ideally Id like to change structure of the json to not include:</p>\n\n<pre><code>\"or\",\n</code></pre>\n\n<p>But Im not in control over the json so this is unfortunately impossible.</p>\n\n<p>Any ideas whats causing this and how it could be resolved?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>I found whats slowing the whole thing down.</p>\n\n<p>Editing my struct like:</p>\n\n<pre><code>type Trigger struct {\n    Event     string        `json:\"event\"`  \n    Pair      string        `json:\"pair\"`   \n    Actions   [][]string    `json:\"actions\"`\n    //Condition Condition     `json:\"condition\"`\n}\n</code></pre>\n\n<p>Takes it from 600ms to 100ms. However now Im not able to parse the <code>Condition</code>.</p>\n\n<p>Now sure how to parse the Condition in another way than Im currently doing due it having two different formats</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1451910962, "post_id": 34591237, "comment_id": 56927507, "body": "Have your Go server running on port 80."}, {"owner": {"reputation": 23, "user_id": 4635319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6484797dd0e5209c074319734aff62d8?s=128&d=identicon&r=PG&f=1", "display_name": "GCP", "link": "https://stackoverflow.com/users/4635319/gcp"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1451911416, "post_id": 34591237, "comment_id": 56927800, "body": "@Volker,  currently Its on port 4000 not 80. i want to run its on port 4000 but need some type of mapping that if i enter domain name on browser it should make a request to port 4000"}, {"owner": {"reputation": 468, "user_id": 1117026, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/1b833426c9221e4b886def0ddd170d05?s=128&d=identicon&r=PG", "display_name": "elgris", "link": "https://stackoverflow.com/users/1117026/elgris"}, "edited": false, "score": 0, "creation_date": 1451912267, "post_id": 34591237, "comment_id": 56928322, "body": "Try to use docker. You can run your server in docker container on port 4000 and make container to expose port 80"}, {"owner": {"reputation": 708, "user_id": 4144758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cfea5e29717057a628f9363b652e5a9b?s=128&d=identicon&r=PG&f=1", "display_name": "Daniele D", "link": "https://stackoverflow.com/users/4144758/daniele-d"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1451914076, "post_id": 34591237, "comment_id": 56929416, "body": "@Volker Don&#39;t run your web applications as root"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 708, "user_id": 4144758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cfea5e29717057a628f9363b652e5a9b?s=128&d=identicon&r=PG&f=1", "display_name": "Daniele D", "link": "https://stackoverflow.com/users/4144758/daniele-d"}, "edited": false, "score": 2, "creation_date": 1451915627, "post_id": 34591237, "comment_id": 56930438, "body": "@DanieleD: you don&#39;t need to run as root to use CAP_NET_BIND_SERVICE."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1451915524, "post_id": 34592086, "comment_id": 56930365, "body": "1 is incorrect. You can, and should run your server as an unprivileged user and still bind to 80, using linux capabilities. Use setcap and CAP_NET_BIND_SERVICE. Don&#39;t use authbind, which was written 17 years ago before linux capabilities had this, which itself has been around for many many years."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451915745, "post_id": 34592086, "comment_id": 56930511, "body": "Not to mention, authbind uses LD_PRELOAD to override the call to <code>bind</code>, which won&#39;t work with Go, because Go makes the syscall directly."}, {"owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451916287, "post_id": 34592086, "comment_id": 56930879, "body": "@JimB, thanks for the hint, I totally forgot about setcap. I&#39;ve updated my answer accordingly and removed the reference to authbind."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451916434, "post_id": 34592086, "comment_id": 56930961, "body": "If you want to be complete, instead of bringing in all of docker just to redirect a port, you can do this yourself with a simple iptables command. Iptables or capabilities are how sysadmins have been doing this long before docker existed."}, {"owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451916825, "post_id": 34592086, "comment_id": 56931233, "body": "@JimB, true. I actually intended my answer to be read as &quot;In case you&#39;re using Docker anyway, you can also...&quot;, not as &quot;Switch to Docker just for doing...&quot;. I&#39;m aware this can also be done with iptables, however I would not be able to produce the config for that off the top of my head."}], "tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": true, "score": 4, "last_activity_date": 1451916227, "last_edit_date": 1451916227, "creation_date": 1451913452, "answer_id": 34592086, "question_id": 34591237, "link": "https://stackoverflow.com/questions/34591237/golang-how-to-route-data-from-default-port-to-another4000-port/34592086#34592086", "title": "golang - how to route data from default port to another[4000] port", "body": "<p>There are several solutions for this:</p>\n\n<ol>\n<li><p>Have your Go server listen directly on port 80. However, be careful with how you implement this. <strong>Do not have your service run as root</strong>, but use Linux capabilities instead (thanks to @JimB who reminded me of this in comments). You can use <code>setcap</code> to grant a process the capability to bind to a privileged port:</p>\n\n<pre><code>&gt; setcap 'cap_net_bind_service=+ep' /path/to/your/application\n</code></pre></li>\n<li><p>Use an HTTP reverse proxy like Nginx to forward all HTTP requests from port 80 to your Go application. Here's an example configuration file for Nginx:</p>\n\n<pre><code>upstream yourgoapplication {\n  server localhost:4000;\n}\n\nserver {\n  listen 80;\n\n  server_name somedomainname;\n\n  location / {\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n\n    proxy_pass http://yourgoapplication;\n  }\n}\n</code></pre>\n\n<p>When you do this, you can configure to Go application to listen on <code>127.0.0.1:4000</code> instead of <code>0.0.0.0:4000</code> to make your application accessible <em>only</em> by port 80.</p></li>\n<li><p>If and when you are deploying your application in a Docker container, you can simply map the container port 4000 to the host port 80. <a href=\"https://docs.docker.com/engine/userguide/networking/default_network/binding/\" rel=\"nofollow\">See the manual</a> for more information.</p></li>\n</ol>\n"}], "owner": {"reputation": 23, "user_id": 4635319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6484797dd0e5209c074319734aff62d8?s=128&d=identicon&r=PG&f=1", "display_name": "GCP", "link": "https://stackoverflow.com/users/4635319/gcp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2482, "favorite_count": 0, "closed_date": 1451919872, "accepted_answer_id": 34592086, "answer_count": 1, "score": 2, "last_activity_date": 1451916227, "creation_date": 1451910683, "question_id": 34591237, "link": "https://stackoverflow.com/questions/34591237/golang-how-to-route-data-from-default-port-to-another4000-port", "closed_reason": "Not suitable for this site", "title": "golang - how to route data from default port to another[4000] port", "body": "<p>currently my go server is running on port 4000. to access web application i need to type <code>somedomainname:4000</code> in browser.</p>\n\n<p>I would like to only type <code>somedomainname</code> and it should make the connection to web server on port 4000.</p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1452056934, "post_id": 34591094, "comment_id": 56997718, "body": "I am also keen on seeing ping/pongs. For example if the client goes to sleep, I want to be able to tell what the time out is, last seen and such."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1452082280, "post_id": 34591094, "comment_id": 57010578, "body": "Starting to think it&#39;s my client that&#39;s the issue: <a href=\"https://github.com/kaihendry/WebSocketHook/tree/master/client\" rel=\"nofollow noreferrer\">github.com/kaihendry/WebSocketHook/tree/master/client</a> It doesn&#39;t seem to be able to tell when it&#39;s disconnected."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1452156644, "post_id": 34591094, "comment_id": 57046631, "body": "Yes that&#39;s right. The idea is that the socket should stay open and robust until it receives that URL message payload. However in my example it&#39;s not robust."}], "answers": [{"comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1451914665, "post_id": 34591688, "comment_id": 56929785, "body": "I don&#39;t see why a dedicated <code>Write</code> goroutine is needed, considering that <code>websocket.Conn.Write</code> is internally protected by a mutex."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1451914767, "post_id": 34591688, "comment_id": 56929855, "body": "It also makes sense to call <code>ws.Close</code> after <code>ws.Read</code>, in case a binary or text message is accidentally sent by the client."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1451914808, "post_id": 34591688, "comment_id": 56929884, "body": "Checking <code>ws.Read</code>&#39;s <code>err</code> doesn&#39;t make a lot of sense in this case either."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1451915648, "post_id": 34591688, "comment_id": 56930452, "body": "@TimCooper You&#39;re right, checking the error here doesn&#39;t make sense, I was just trying to keep as much as the original code from the question. As for a separate goroutine, it&#39;s more for readability, especially for <code>Read</code> when you&#39;re handling multiple Reads (I&#39;m more thinking of a bigger picture with channels and stuff) But in the end, readability."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1452054556, "post_id": 34591688, "comment_id": 56997030, "body": "Hmm, if I am doing it right way, why am I have stability issues I wonder in my code? <a href=\"https://github.com/kaihendry/WebSocketHook/blob/master/server/main.go\" rel=\"nofollow noreferrer\">github.com/kaihendry/WebSocketHook/blob/master/server/main.g&zwnj;&#8203;o</a>"}, {"owner": {"reputation": 2908, "user_id": 1220243, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/A8tm4.jpg?s=128&g=1", "display_name": "zero_cool", "link": "https://stackoverflow.com/users/1220243/zero-cool"}, "edited": false, "score": 0, "creation_date": 1531839551, "post_id": 34591688, "comment_id": 89741139, "body": "What&#39;s an alternative to using the word &quot;pump&quot; in the read, and write? I don&#39;t think this word is descriptive enough. Stream?"}], "tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 6, "last_activity_date": 1451916508, "last_edit_date": 1451916508, "creation_date": 1451912160, "answer_id": 34591688, "question_id": 34591094, "link": "https://stackoverflow.com/questions/34591094/how-to-keep-a-golang-org-x-net-websocket-open/34591688#34591688", "title": "How to keep a golang.org/x/net/websocket open?", "body": "<p>I misread your original question.</p>\n\n<p>No you're doing it the right away. You basically need to block the handler from returning to keep the websocket connection alive. If you don't care about the message, just discard it and do nothing with it.</p>\n\n<p>A common way people do it is to have a dedicated <code>Read</code> and <code>Write</code> goroutine, something like:</p>\n\n<pre><code>func fishHandler(ws *websocket.Conn) {\n    id := ws.RemoteAddr().String() + \"-\" + ws.Request().RemoteAddr + \"-\" + ws.Request().UserAgent()\n    sockets[id] = ws\n\n    go writePump(ws)\n    readPump(ws)\n}\n\nfunc readPump(ws *websocket.Conn) {\n    defer ws.Close()\n    msg := make([]byte, 512)\n    _, err := ws.Read(msg)\n    if err != nil {\n        return\n    }\n}\n\nfunc writePump(ws *websocket.Conn) {\n    // Hand the write messages here\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1452735704, "post_id": 34658623, "comment_id": 57305599, "body": "Even with &quot;github.com/gorilla/websocket&quot;, there isn&#39;t a minimal ping/pong example. I&#39;m told <a href=\"https://github.com/gorilla/websocket/blob/master/examples/chat/conn.go\" rel=\"nofollow noreferrer\">github.com/gorilla/websocket/blob/master/examples/chat/conn.&zwnj;&#8203;go</a> is a starting point, but it doesn&#39;t explain how to write a client binary &amp; how to watch timeouts and such."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1452738143, "post_id": 34658623, "comment_id": 57306288, "body": "@hendry I add minimal example."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1452745232, "post_id": 34658623, "comment_id": 57308026, "body": "Thanks, though I don&#39;t quite understand what&#39;s implemented by client and what&#39;s implemented by the server. Could you make it clearer?"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1452746645, "post_id": 34658623, "comment_id": 57308408, "body": "@hendry All on the same side. Peer WriteControl ping control message and then handle pong via PongHandler. Respond to ping via SetPingHandler would be enough for other side."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1452754196, "post_id": 34658623, "comment_id": 57310653, "body": "So they are on both sides, is that what you are saying? Need some time to come up with minimal example to try this. =)"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 7, "last_activity_date": 1452738021, "last_edit_date": 1452738021, "creation_date": 1452179496, "answer_id": 34658623, "question_id": 34591094, "link": "https://stackoverflow.com/questions/34591094/how-to-keep-a-golang-org-x-net-websocket-open/34658623#34658623", "title": "How to keep a golang.org/x/net/websocket open?", "body": "<p>golang.org/x/net/websocket does not implement ping-pong from RFC 6455, but the gorilla websocket <a href=\"http://github.com/gorilla/websocket\" rel=\"nofollow\">implementation</a> does.\nMinimal example with Gorilla websocket</p>\n\n<pre><code>c := time.Tick(pingInterval)\ngo func(){\n       for  _ := range c {\n           if err := conn.WriteControl(Ping...); err != nil {\n                 handle error \n            }\n      }\n   }()\n\n          -----\n\nconn.SetPongHandler(func(string) error { return conn.SetReadDeadline(time.Now().Add(pingInterval)) })\ngo func(){\n      for {\n           if _, _, err := conn.NextReader(); err != nil {\n                handle error\n           }\n       }\n    }()\n</code></pre>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3176, "favorite_count": 1, "answer_count": 2, "score": 10, "last_activity_date": 1452738021, "creation_date": 1451910198, "last_edit_date": 1452130485, "question_id": 34591094, "link": "https://stackoverflow.com/questions/34591094/how-to-keep-a-golang-org-x-net-websocket-open", "title": "How to keep a golang.org/x/net/websocket open?", "body": "<p>I'm naively use <a href=\"https://github.com/kaihendry/WebSocketHook/blob/master/server/main.go#L22\">_, err := ws.Read(msg)</a> to keep a Web socket open in my code. I don't think it works reliably.</p>\n\n<p>In other code I've noticed people doing a <a href=\"https://github.com/skarnecki/gotail/blob/master/app.go#L56\">sleep loop</a>. What's the correct way to keep a Web socket open &amp; stable? I assume the underlying library does ping/pongs?</p>\n\n<p>Update: I'm pretty confident that the <a href=\"https://github.com/kaihendry/WebSocketHook/blob/fd3fc976bf1ce5865b48005e3d4024682a1c9533/client/client.go\">client.go</a> is to blame since it doesn't seem to redial after a disconnect is seen on the server. I made <a href=\"https://youtu.be/hmOI3MIIXIM\">a video demonstrating the issue</a>.</p>\n"}, {"tags": ["selenium", "go", "automation"], "answers": [{"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 2, "last_activity_date": 1451902399, "creation_date": 1451902399, "answer_id": 34588789, "question_id": 34588393, "link": "https://stackoverflow.com/questions/34588393/go-language-automation-testing/34588789#34588789", "title": "go language Automation testing", "body": "<p>Go provides its own testing package you can view it here</p>\n\n<p><a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow\">https://golang.org/pkg/testing/</a></p>\n\n<p>You can write your own tests a common layout is to write your file, then write a <code>_test.go</code> file to test e.g.</p>\n\n<pre><code>package.go\npackage_test.go\n</code></pre>\n\n<p>then you can test your file by running</p>\n\n<p><code>go test</code></p>\n\n<p>And bam, you're good to go</p>\n\n<p>Here's a random test package from a random app for example: <a href=\"https://github.com/yohcop/openid-go/blob/master/redirect_test.go\" rel=\"nofollow\">https://github.com/yohcop/openid-go/blob/master/redirect_test.go</a></p>\n"}, {"tags": [], "owner": {"reputation": 468, "user_id": 1117026, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/1b833426c9221e4b886def0ddd170d05?s=128&d=identicon&r=PG", "display_name": "elgris", "link": "https://stackoverflow.com/users/1117026/elgris"}, "is_accepted": false, "score": 2, "last_activity_date": 1451903524, "creation_date": 1451903524, "answer_id": 34589129, "question_id": 34588393, "link": "https://stackoverflow.com/questions/34588393/go-language-automation-testing/34589129#34589129", "title": "go language Automation testing", "body": "<p>A plenty of them! You should check a list of tools for testing here: <a href=\"https://github.com/avelino/awesome-go#testing\" rel=\"nofollow\">https://github.com/avelino/awesome-go#testing</a></p>\n"}, {"tags": [], "owner": {"reputation": 1162, "user_id": 1653085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8irj8.jpg?s=128&g=1", "display_name": "Vitaly Velikodny", "link": "https://stackoverflow.com/users/1653085/vitaly-velikodny"}, "is_accepted": false, "score": 0, "last_activity_date": 1451908083, "creation_date": 1451908083, "answer_id": 34590482, "question_id": 34588393, "link": "https://stackoverflow.com/questions/34588393/go-language-automation-testing/34590482#34590482", "title": "go language Automation testing", "body": "<p>Try <a href=\"http://goconvey.co\" rel=\"nofollow\">http://goconvey.co</a></p>\n\n<p>GoConvey also supports Go's native testing package.</p>\n"}, {"tags": [], "owner": {"reputation": 182, "user_id": 5622186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69af54f6a46bce1f6c539f86841ed8ef?s=128&d=identicon&r=PG", "display_name": "Kiramishima", "link": "https://stackoverflow.com/users/5622186/kiramishima"}, "is_accepted": false, "score": 0, "last_activity_date": 1451941619, "creation_date": 1451941619, "answer_id": 34599851, "question_id": 34588393, "link": "https://stackoverflow.com/questions/34588393/go-language-automation-testing/34599851#34599851", "title": "go language Automation testing", "body": "<p>Go provides its own testing package you can view it here</p>\n\n<p><a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow\">https://golang.org/pkg/testing/</a></p>\n\n<p>Or you can get other pkg for testing, for example testify</p>\n\n<p><a href=\"https://github.com/stretchr/testify\" rel=\"nofollow\">https://github.com/stretchr/testify</a></p>\n"}], "owner": {"reputation": 103, "user_id": 5742505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80145b164d3a44bba3a26111cc2980da?s=128&d=identicon&r=PG&f=1", "display_name": "gopinath", "link": "https://stackoverflow.com/users/5742505/gopinath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2758, "favorite_count": 0, "closed_date": 1453170395, "answer_count": 4, "score": -1, "last_activity_date": 1452165613, "creation_date": 1451901005, "question_id": 34588393, "link": "https://stackoverflow.com/questions/34588393/go-language-automation-testing", "closed_reason": "Not suitable for this site", "title": "go language Automation testing", "body": "<p>Please someone help me out on go language automation testing</p>\n\n<p>i have been working out manual coding for automation. Please help me any packages or framework available to run automation testing in go.</p>\n"}, {"tags": ["go", "homebrew"], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451920987, "post_id": 34588084, "comment_id": 56933877, "body": "<code>brew upgrade</code> without <code>brew update</code> first won&#39;t pull down new versions of formulae, so the local Homebrew install won&#39;t know a newer Go verson is available to install."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451921019, "post_id": 34588084, "comment_id": 56933906, "body": "@elithrar oh do I have them backwards"}, {"owner": {"reputation": 9424, "user_id": 1248913, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ced76ce8952257b480f8b1c96ab0a79?s=128&d=identicon&r=PG", "display_name": "Roy Lee", "link": "https://stackoverflow.com/users/1248913/roy-lee"}, "edited": false, "score": 4, "creation_date": 1501344524, "post_id": 34588084, "comment_id": 77743233, "body": "@Datsik what&#39;s <code>--cross-compile-common</code> for?"}, {"owner": {"reputation": 3439, "user_id": 1887281, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/xV9qF.jpg?s=128&g=1", "display_name": "devinbost", "link": "https://stackoverflow.com/users/1887281/devinbost"}, "reply_to_user": {"reputation": 9424, "user_id": 1248913, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ced76ce8952257b480f8b1c96ab0a79?s=128&d=identicon&r=PG", "display_name": "Roy Lee", "link": "https://stackoverflow.com/users/1248913/roy-lee"}, "edited": false, "score": 1, "creation_date": 1594339388, "post_id": 34588084, "comment_id": 111099434, "body": "@RoyLee That was to allow the binaries to be used on other platforms as well. However, if I remember correctly, that&#39;s not required with some of the newer versions of Go now."}], "tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 7, "last_activity_date": 1519030038, "last_edit_date": 1519030038, "creation_date": 1451899864, "answer_id": 34588084, "question_id": 34587978, "link": "https://stackoverflow.com/questions/34587978/how-to-upgrade-go-from-1-4-to-1-5-via-homebrew/34588084#34588084", "title": "How to upgrade go from 1.4 to 1.5 via homebrew", "body": "<p>Try running</p>\n\n<pre><code>brew update\nbrew upgrade\n\nbrew install go --cross-compile-common\n</code></pre>\n\n<p><code>brew upgrade</code> might upgrade <code>go</code> alone without having to try to install it, after you run <code>brew update/upgrade</code> try running <code>go version</code> and see which version you have.</p>\n"}, {"tags": [], "owner": {"reputation": 445, "user_id": 4265763, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_XuweyYACIs/AAAAAAAAAAI/AAAAAAAAAEI/OvebLDs1Rlo/photo.jpg?sz=128", "display_name": "Sirui Zhuang", "link": "https://stackoverflow.com/users/4265763/sirui-zhuang"}, "is_accepted": false, "score": 32, "last_activity_date": 1451962552, "creation_date": 1451962552, "answer_id": 34603488, "question_id": 34587978, "link": "https://stackoverflow.com/questions/34587978/how-to-upgrade-go-from-1-4-to-1-5-via-homebrew/34603488#34603488", "title": "How to upgrade go from 1.4 to 1.5 via homebrew", "body": "<p>You should run <code>brew update</code> first, then run <code>brew upgrade</code> to upgrade all software installed by brew. Also you can run <code>brew upgrade go</code> to upgrade go only.</p>\n"}], "owner": {"reputation": 2090, "user_id": 1112632, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/49644c9b6bd49842beb405ff505946de?s=128&d=identicon&r=PG", "display_name": "jianfeng", "link": "https://stackoverflow.com/users/1112632/jianfeng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20117, "favorite_count": 2, "answer_count": 2, "score": 9, "last_activity_date": 1519030038, "creation_date": 1451899549, "question_id": 34587978, "link": "https://stackoverflow.com/questions/34587978/how-to-upgrade-go-from-1-4-to-1-5-via-homebrew", "title": "How to upgrade go from 1.4 to 1.5 via homebrew", "body": "<p>I try brew upgrade go</p>\n\n<p>it always show:</p>\n\n<p>go 1.4.1 already installed </p>\n\n<p>how can i upgrade go to 1.5?</p>\n"}, {"tags": ["sql", "go", "h2"], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 4359487, "user_type": "registered", "profile_image": "https://graph.facebook.com/1447687639/picture?type=large", "display_name": "Kaxa", "link": "https://stackoverflow.com/users/4359487/kaxa"}, "edited": false, "score": 0, "creation_date": 1451931271, "post_id": 34596063, "comment_id": 56939877, "body": "I hope performance will keep with pg driver because h2 I like for performance"}, {"owner": {"reputation": 125, "user_id": 4359487, "user_type": "registered", "profile_image": "https://graph.facebook.com/1447687639/picture?type=large", "display_name": "Kaxa", "link": "https://stackoverflow.com/users/4359487/kaxa"}, "edited": false, "score": 0, "creation_date": 1452456760, "post_id": 34596063, "comment_id": 57166619, "body": "I tried postgres driver but does not works with h2 db, err := sql.Open(&quot;postgres&quot;, &quot;postgres://sa:123@localhost:8082/test&quot;) db, err := sql.Open(&quot;postgres&quot;, &quot;postgres://sa:123@localhost:8082/~/test&quot;)"}, {"owner": {"reputation": 125, "user_id": 4359487, "user_type": "registered", "profile_image": "https://graph.facebook.com/1447687639/picture?type=large", "display_name": "Kaxa", "link": "https://stackoverflow.com/users/4359487/kaxa"}, "edited": false, "score": 0, "creation_date": 1452500457, "post_id": 34596063, "comment_id": 57179511, "body": "with 5432 does not works.  In practite anybody used h2 in golang?"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 125, "user_id": 4359487, "user_type": "registered", "profile_image": "https://graph.facebook.com/1447687639/picture?type=large", "display_name": "Kaxa", "link": "https://stackoverflow.com/users/4359487/kaxa"}, "edited": false, "score": 0, "creation_date": 1452517336, "post_id": 34596063, "comment_id": 57190102, "body": "I haven&#39;t ;) It&#39;s 543*5* BTW"}, {"owner": {"reputation": 125, "user_id": 4359487, "user_type": "registered", "profile_image": "https://graph.facebook.com/1447687639/picture?type=large", "display_name": "Kaxa", "link": "https://stackoverflow.com/users/4359487/kaxa"}, "edited": false, "score": 0, "creation_date": 1471340042, "post_id": 34596063, "comment_id": 65296314, "body": ":) I was think tthat there was standard port"}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 2, "last_activity_date": 1451926771, "creation_date": 1451926771, "answer_id": 34596063, "question_id": 34586722, "link": "https://stackoverflow.com/questions/34586722/go-to-h2-database/34596063#34596063", "title": "Go to h2 database", "body": "<p>According to <a href=\"http://www.h2database.com/html/advanced.html\" rel=\"nofollow\">http://www.h2database.com/html/advanced.html</a>:</p>\n\n<blockquote>\n  <p>... it supports the PostgreSQL network protocol ... Support for the PostgreSQL network protocol is quite new and should be viewed as experimental. It should not be used for production applications.</p>\n</blockquote>\n\n<p>So there is high chance that <code>github.com/lib/pq</code> driver will work with h2.</p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 9925048, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c821483d5b19f40b1e84df3f62bcb60?s=128&d=identicon&r=PG&f=1", "display_name": "Small Chicope", "link": "https://stackoverflow.com/users/9925048/small-chicope"}, "is_accepted": false, "score": 5, "last_activity_date": 1528721010, "creation_date": 1528721010, "answer_id": 50798051, "question_id": 34586722, "link": "https://stackoverflow.com/questions/34586722/go-to-h2-database/50798051#50798051", "title": "Go to h2 database", "body": "<p>First of all you need to run your DB server allowing connections from any host via TCP, PotgreSQL or Web (I have done this by using a linux shell script called <strong>runH2Server.sh</strong>):</p>\n\n<pre><code>#!/bin/bash\n\nexport PATH=$PATH:/tmp/H2DB/jre1.8/bin\n\nexport CLASSPATH=/tmp/H2DB/DBServer:/tmp/H2DB/DBServer/h2.jar\n\njava -classpath $CLASSPATH org.h2.tools.Server -webAllowOthers -tcpAllowOthers -pgAllowOthers -baseDir /tmp/H2DB/DBServer\n</code></pre>\n\n<p>Running the script will produce following otuput:</p>\n\n<pre><code># ./runH2Server.sh\nWeb Console server running at http://127.0.1.1:8082 (others can connect)\nTCP server running at tcp://127.0.1.1:9092 (others can connect)\nPG server running at pg://127.0.1.1:5435 (others can connect)\n</code></pre>\n\n<p>Now your server is ready for client connections, you could test it connecting your web browser to the IP and port specified, for example: <a href=\"http://192.168.1.130:8082/login.do\" rel=\"noreferrer\">http://192.168.1.130:8082/login.do</a></p>\n\n<p>Be sure to download the Go postgres driver form \"<strong>github.com/lib/pq</strong>\".</p>\n\n<p>Now, from another host (or the same if you want) you can use the following code to test your connection:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    _ \"github.com/lib/pq\"\n)\n\nconst (\n  host     = \"192.168.1.130\"\n    port = 5435\n    user     = \"sa\"\n    password = \"\"\n    dbname   = \"/tmp/H2DB/DBServer/test\"\n)\n\nfunc main() {\n    psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\n        \"dbname=%s sslmode=disable\", host, port, user, dbname)\n\n    db, err := sql.Open(\"postgres\", psqlInfo)\n    if err != nil {\n        panic(err)\n    }\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(\"Successfully connected!\")\n\n    rows, err := db.Query(\"SHOW TABLES\")\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(\"\\n\\n=== Tables in DB ===\")\n\n    fmt.Printf(\"%10v | %15v\\n\", \"tablename\", \"tableschema\")\n    for rows.Next() {\n        var tablename string\n        var tableschema string\n        err = rows.Scan(&amp;tablename, &amp;tableschema)\n        if err != nil {\n            panic(err)\n        }\n        fmt.Printf(\"%10v | %15v\\n\", tablename, tableschema)\n    }\n\n    fmt.Println(\"\\n\\n=== Records in DB ===\")\n\n    rows, err = db.Query(\"SELECT * FROM TEST ORDER BY ID\")\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"%10v | %15v\\n\", \"ID\", \"NAME\")\n    for rows.Next() {\n        var id int\n        var name string\n        err = rows.Scan(&amp;id, &amp;name)\n        if err != nil {\n            panic(err)\n        }\n        fmt.Printf(\"%10v | %15v\\n\", id, name)\n    }\n}\n</code></pre>\n\n<p>Run it and you will have the following output:</p>\n\n<pre><code>C:\\Go\\PG_Client\n\u03bb go run PgDBClient.go\nSuccessfully connected!\n\n\n=== Tables in DB ===\n tablename |     tableschema\n      TEST |          PUBLIC\n\n\n=== Records in DB ===\n        ID |            NAME\n         1 |           Hello\n         2 |           World\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 993347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fe4bf7b2222e03187701a5d1ac273d1?s=128&d=identicon&r=PG", "display_name": "JM Robles", "link": "https://stackoverflow.com/users/993347/jm-robles"}, "is_accepted": false, "score": 1, "last_activity_date": 1605373828, "creation_date": 1605373828, "answer_id": 64836470, "question_id": 34586722, "link": "https://stackoverflow.com/questions/34586722/go-to-h2-database/64836470#64836470", "title": "Go to h2 database", "body": "<p>I have developed a &quot;native&quot; Apache H2 Database driver for Go.</p>\n<p><a href=\"https://github.com/jmrobles/h2go\" rel=\"nofollow noreferrer\">https://github.com/jmrobles/h2go</a></p>\n<p>In its day I tried to use the Postgres interface but I encountered problems diagnosing bugs in the SQL syntax.</p>\n<p>I wanted to provide a pure go alternative that would directly access H2's TCP interface.</p>\n"}], "owner": {"reputation": 125, "user_id": 4359487, "user_type": "registered", "profile_image": "https://graph.facebook.com/1447687639/picture?type=large", "display_name": "Kaxa", "link": "https://stackoverflow.com/users/4359487/kaxa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3100, "favorite_count": 1, "answer_count": 3, "score": 4, "last_activity_date": 1605373828, "creation_date": 1451893629, "last_edit_date": 1459895606, "question_id": 34586722, "link": "https://stackoverflow.com/questions/34586722/go-to-h2-database", "title": "Go to h2 database", "body": "<p>Is it possible to connect from Go code to h2 database <a href=\"http://www.h2database.com\" rel=\"nofollow\">http://www.h2database.com</a></p>\n"}, {"tags": ["memory", "data-structures", "go", "garbage-collection"], "answers": [{"comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 4, "creation_date": 1451891112, "post_id": 34585230, "comment_id": 56917383, "body": "Same idea from another angle: the spec&#39;s promised to keep pointer-keyed maps working if any future implementation has a moving GC."}], "tags": [], "owner": {"reputation": 436, "user_id": 5511980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0174993a67ce7b3ad2bcb2f12e135661?s=128&d=identicon&r=PG&f=1", "display_name": "W. Cybriwsky", "link": "https://stackoverflow.com/users/5511980/w-cybriwsky"}, "is_accepted": true, "score": 10, "last_activity_date": 1451885640, "creation_date": 1451885640, "answer_id": 34585230, "question_id": 34585018, "link": "https://stackoverflow.com/questions/34585018/is-it-safe-to-use-pointers-as-map-keys-in-go/34585230#34585230", "title": "Is it safe to use pointers as map keys in Go?", "body": "<p>Could the memory address change, in the pointers-as-uints sense? Yes, but outside of <a href=\"https://golang.org/pkg/unsafe/\" rel=\"noreferrer\" title=\"the unsafe package\">the unsafe package</a> go doesn't expose pointers as uints. So, will looking it up in the map fail? No.</p>\n\n<p>See more at <a href=\"https://golang.org/ref/spec#Map_types\" rel=\"noreferrer\" title=\"the spec for map types\">the spec</a>. The linked section even includes a pointer-keyed map as an example.</p>\n"}], "owner": {"reputation": 352, "user_id": 922070, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d27cebb97613d4b8b7204969a48b467?s=128&d=identicon&r=PG", "display_name": "skoush", "link": "https://stackoverflow.com/users/922070/skoush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3839, "favorite_count": 0, "accepted_answer_id": 34585230, "answer_count": 1, "score": 8, "last_activity_date": 1451885640, "creation_date": 1451884289, "question_id": 34585018, "link": "https://stackoverflow.com/questions/34585018/is-it-safe-to-use-pointers-as-map-keys-in-go", "title": "Is it safe to use pointers as map keys in Go?", "body": "<p>Suppose we add a value to a map using a pointer as the key. Could the memory address of this pointer ever change? If so, will looking it up in the map fail because when it was inserted, it had a different memory address?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 1, "last_activity_date": 1451878075, "last_edit_date": 1451878075, "creation_date": 1451876491, "answer_id": 34584152, "question_id": 34584126, "link": "https://stackoverflow.com/questions/34584126/how-to-format-sql-output-into-json/34584152#34584152", "title": "How to format sql output into json", "body": "<p>You could make a struct if you know what your data is going to be: e.g</p>\n\n<pre><code>type User struct {\n    Username string `json:\"username\"`\n    Email    string `json:\"email\"`\n}\n</code></pre>\n\n<p>Then on your query:</p>\n\n<pre><code>user := User{}\nerr = db.QueryRow(\"select colA, colB from table where colA = %v\", 1).Scan(&amp;user.Username,&amp;user.Email)\n    if err != nil {\n        fmt.Printf(err.Error())\n}\n</code></pre>\n\n<p>Then call marshal on it</p>\n\n<pre><code>msg, err := json.Marshal(user)\nif err != nil {\n    log.Println(err)\n}\n\nfmt.Println(string(msg)) // \"{ \"username\": \"Blah\", \"email\": \"asd@asd.com\" }\"\n</code></pre>\n\n<p>Also with the <code>json.Marshal</code> package if you're calling <code>Marshal</code> on a <code>struct</code> your fields MUST be exported by using a capital first letter on the field name, e.g. <code>Username</code></p>\n\n<blockquote>\n  <p>// Field is ignored by this package. Field int <code>json:\"-\"</code></p>\n  \n  <p>// Field appears in JSON as key \"myName\". Field int <code>json:\"myName\"</code></p>\n  \n  <p>// Field appears in JSON as key \"myName\" and // the field is omitted\n  from the object if its value is empty, // as defined above. Field int\n  <code>json:\"myName,omitempty\"</code></p>\n  \n  <p>// Field appears in JSON as key \"Field\" (the default), but // the\n  field is skipped if empty. // Note the leading comma. Field int\n  <code>json:\",omitempty\"</code></p>\n</blockquote>\n\n<p><a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\">https://golang.org/pkg/encoding/json/#Marshal</a></p>\n"}, {"tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 0, "last_activity_date": 1451878113, "creation_date": 1451878113, "answer_id": 34584311, "question_id": 34584126, "link": "https://stackoverflow.com/questions/34584126/how-to-format-sql-output-into-json/34584311#34584311", "title": "How to format sql output into json", "body": "<p>You can create a one element map and marshal it:</p>\n\n<pre><code>m := map[string]string{colA: colB}\nb, err := json.Marshal(m)\n</code></pre>\n\n<p>Full example: <a href=\"https://play.golang.org/p/ntT5h3oHvY\" rel=\"nofollow\">https://play.golang.org/p/ntT5h3oHvY</a></p>\n"}, {"tags": [], "owner": {"reputation": 438, "user_id": 5378868, "user_type": "registered", "profile_image": "https://graph.facebook.com/135713123447192/picture?type=large", "display_name": "Ozzadar", "link": "https://stackoverflow.com/users/5378868/ozzadar"}, "is_accepted": false, "score": 0, "last_activity_date": 1452002017, "last_edit_date": 1452002017, "creation_date": 1452001679, "answer_id": 34613260, "question_id": 34584126, "link": "https://stackoverflow.com/questions/34584126/how-to-format-sql-output-into-json/34613260#34613260", "title": "How to format sql output into json", "body": "<p>I'd suggest looking into some database management frameworks.</p>\n\n<p>I personally use gorm (github.com/jinzhu/gorm) for my database needs. It has functionality for automatically creating your database using structs and parsing them back out again. </p>\n\n<p>You can pair that with the \"encoding/json\" package to take it to/from json to/from your database.</p>\n\n<p>Here's some personal code you can use for reference:</p>\n\n<p><a href=\"https://github.com/Superordinate/kDaemon/blob/master/models/applications.go\" rel=\"nofollow\">Struct</a>:</p>\n\n<pre><code>type Application struct {\n  Id            int64           `json:\"id\"`\n  UserID        int64           `sql:\"not null;\" json:\"user_id\"`\n  Name          string          `sql:\"size:255; not null; unique;\" json:\"name\"`\n  ExposedPorts  string          `json:\"exposed_ports\"` //docker\n  DockerImage   string          `sql:\"size:255; not null;\" json:\"docker_image\"`\n  Dependencies  string          `json:\"dependencies\"`  \n  IsEnabled     bool            `sql:\"default:true\" json:\"is_enabled\"`\n</code></pre>\n\n<p>}</p>\n\n<p>JSON:</p>\n\n<pre><code>func (a *Application) GetJSON() (string, error) {\n    b, err := json.Marshal(a)\n    if err != nil {\n        logging.Log(err)\n        return \"\",err;\n    }\n    return string(b),err;\n}\n</code></pre>\n\n<p><a href=\"https://github.com/Superordinate/kDaemon/blob/master/database/database.go\" rel=\"nofollow\">Database</a></p>\n\n<pre><code>    //Get application information\nfunc GetApplication(id int64) (*models.Application, error) {\n app := &amp;models.Application{}\n\n err := db.Where(&amp;models.Application{Id: id}).First(&amp;app).Error\n\n return app, err\n}\n\nfunc GetApplications() ([]models.Application, error) {\n    //Returns a list of all applications \n    apps := []models.Application{}\n\n    err := db.Find(&amp;apps).Error\n\n    return apps, err\n}\n\n//delete application from database\nfunc DeleteApplication(id int64) (bool, error) {\n    logging.Log(\"Deleting Application: \", id)\n\n    app := models.Application{}\n\n    err := db.Where(&amp;models.Application{Id: id}).First(&amp;app).Error \n\n    if err != nil {\n        return false, err\n    }\n    //  TODO: Check for auth\n    //      Delete all containers\n\n    //Delete application from database\n    err = db.Delete(&amp;app).Error\n\n    if err != nil {\n       return false, err\n    }\n\n    return true, err\n\n}\n\n//Update Application\nfunc UpdateApplication(app *models.Application) (bool, error) {\n\n    newapp := models.Application{}\n    err := db.Where(&amp;models.Application{Id: app.Id}).First(&amp;newapp).Error \n\n    if err != nil {\n       return false, err\n    }\n\n    err = db.Save(&amp;app).Error\n\n    if err != nil {\n        return false, err\n    }\n\n    return true, nil\n} \n</code></pre>\n\n<p>Hope this helps :)</p>\n"}, {"tags": [], "owner": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "is_accepted": false, "score": 0, "last_activity_date": 1560936521, "creation_date": 1560936521, "answer_id": 56664412, "question_id": 34584126, "link": "https://stackoverflow.com/questions/34584126/how-to-format-sql-output-into-json/56664412#56664412", "title": "How to format sql output into json", "body": "<p>Here is a completely sample: </p>\n\n<p><code>campaign.model.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package models\n\nimport \"database/sql\"\n\n// Campaign Model\ntype Campaign struct {\n    CampaignId int `db:\"campaign_id\" json:\"campaignId\"`\n    CampaignNme string `db:\"campaign_nme\" json:\"campaignNme\"`\n    OrganizationId sql.NullInt64 `db:\"organization_id\" json:\"organizationId\"`\n}\n</code></pre>\n\n<p><code>campaign.repository.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package repositories\n\nimport (\n    \"github.com/jmoiron/sqlx\"\n    \"go-clean-arch/domain/models\"\n    \"go-clean-arch/domain/repositories\"\n)\n\ntype CampaignRepository struct {\n    Db *sqlx.DB\n}\n\nfunc NewCampaignRepository(Db *sqlx.DB) repositories.CampaignRepository {\n    return &amp;CampaignRepository{Db}\n}\n\nfunc (cr *CampaignRepository)FindById(id string) (models.Campaign, error) {\n    campaign := models.Campaign{}\n    query := `\n        SELECT\n            campaign_id,\n            campaign_nme,\n            organization_id\n        FROM \"CAMPAIGN\" WHERE campaign_id = $1\n    `\n    err := cr.Db.Get(&amp;campaign, query, id)\n    if err != nil {\n        return campaign, err\n    }\n    return campaign, nil\n}\n</code></pre>\n\n<p><code>main.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    dbConf := database.PGDatabaseConfig{\n        Host: viper.GetString(\"SQL_HOST\"),\n        Port: viper.GetString(\"SQL_PORT\"),\n        User: viper.GetString(\"SQL_USER\"),\n        Password: viper.GetString(\"SQL_PASSWORD\"),\n        Dbname: viper.GetString(\"SQL_DB\"),\n    }\n    db, err := database.ConnectPGDatabase(&amp;dbConf)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    defer func () {\n        if err := recover(); err != nil {\n            fmt.Println(err)\n        }\n    }()\n\n    //userRepository := repositories.NewUserRepository(db)\n    //users, _ := userRepository.FindAll()\n    //fmt.Printf(\"%#v\", &amp;users)\n\n    campaignRepository := repositories.NewCampaignRepository(db)\n    campaign, err := campaignRepository.FindById(\"102\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%#v\", campaign)\n    campaignJSON, err := json.Marshal(campaign)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(campaignJSON))\n\n}\n</code></pre>\n\n<p>Output: </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>\u2601  go-clean-arch [master] \u26a1  go run main.go\nmodels.Campaign{CampaignId:102, CampaignNme:\"Generic Party / Memories\", OrganizationId:sql.NullInt64{Int64:0, Valid:false}}\ncampaignJSON: {\"campaignId\":102,\"campaignNme\":\"Generic Party / Memories\",\"organizationId\":{\"Int64\":0,\"Valid\":false}}\n\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 2502053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5c7476fd88b34ca2dbf898f5056e337d?s=128&d=identicon&r=PG", "display_name": "user2502053", "link": "https://stackoverflow.com/users/2502053/user2502053"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1777, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1568880534, "creation_date": 1451876276, "last_edit_date": 1568880534, "question_id": 34584126, "link": "https://stackoverflow.com/questions/34584126/how-to-format-sql-output-into-json", "title": "How to format sql output into json", "body": "<p>I have a Go function that queries a database and returns two columns:</p>\n\n<pre><code>var colA string\nvar colB string\n\n    err = db.QueryRow(\"select colA, colB from table where colA = %v\", 1).Scan(&amp;colA,&amp;colB)\n    if err != nil {\n        fmt.Printf(err.Error())\n    }\n    fmt.Println(colA,colB)\n\n    return nil\n</code></pre>\n\n<p>I would like to return the output in json format like {colA:colB}. I have played around with the json.Marshal function but can't get it working correctly.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 0, "last_activity_date": 1451875494, "creation_date": 1451875494, "answer_id": 34584042, "question_id": 34583936, "link": "https://stackoverflow.com/questions/34583936/getting-a-fatal-error-all-goroutines-are-asleep-deadlock-with-a-simple-test/34584042#34584042", "title": "Getting a fatal error: all goroutines are asleep - deadlock! with a simple test scenario", "body": "<p>The <code>if</code> statement in your for loop doesn't let the last channel close, so your <code>goroutine</code> is left waiting on something to happen to <code>chans[i]</code> which will block the <code>defer wg.Done()</code> from ever happening which in turn will never let <code>wg.Wait()</code> finish WHICH THENNNNN will never let <code>done &lt;- struct{}{}</code> get signalled </p>\n\n<p>So in short, your <code>if statement</code> in your loop is not closing the last channel and causing a deadlock because nobody can do nothing.</p>\n\n<p>As @CodingPickle did point out, move your <code>wg.Add(1)</code> to the beginning of your <code>for loop</code> to prevent any race conditions</p>\n\n<p><a href=\"http://play.golang.org/p/j1D5LZGUhd\" rel=\"nofollow\">http://play.golang.org/p/j1D5LZGUhd</a></p>\n"}, {"comments": [{"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1451877259, "post_id": 34584043, "comment_id": 56913743, "body": "I updated the code with your comment about race condition. I intentionally put <code>if i == 0</code> for wg to block forever. Why shouldn&#39;t I be able to never decrement its semaphore to 0?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1451877501, "post_id": 34584043, "comment_id": 56913792, "body": "If wg.Wait never returns, then the program does not send a value to <code>done</code>.  If the program does not send a value to <code>done</code>, then main blocks indefinitely.  The runtime prints an error because all goroutines are blocked. No forward progress can be made."}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1451878044, "post_id": 34584043, "comment_id": 56913913, "body": "Interesting. So in order for main() to rever return I should use <code>for {...}</code> instead of <code>done := make(chan struct{}); &lt;-done</code> (I am getting the same deadlock error with the latter.)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1451878725, "post_id": 34584043, "comment_id": 56914065, "body": "The code <code>done := make(chan struct{}); &lt;-done</code> is one way to prevent main from exiting.  The empty select statement <code>select {}</code> is simpler and clearer. The empty for statement <code>for {}</code> is not a way to prevent main from exiting because it consumes CPU time as it spins.  If main does not exit, then your program deadlocks.  The runtime does not detect the deadlock when <code>for {}</code> is used, but it&#39;s still a deadlock."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1451879241, "post_id": 34584043, "comment_id": 56914171, "body": "@JohnDifool are you doing all this on play.golang??? If you are they won&#39;t let you use their play tool to run never ending stuff and it will always end with dead lock"}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1451879343, "post_id": 34584043, "comment_id": 56914195, "body": "You wrote: &quot;The code <code>done := make(chan struct{}); &lt;-done</code> is one way to prevent main from exiting&quot; but when I do that, I still get &quot;fatal error: all goroutines are asleep - deadlock!&quot;. And when I use <code>select {}</code>, same issue. I agree about cpu usage, but how do I stop the runtime from moaning about the deadlock then?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1451879474, "post_id": 34584043, "comment_id": 56914221, "body": "Can you explain why you don&#39;t want the runtime to complain when the program is deadlocked? There&#39;s usually no point in continuing to run a program when the program is blocked indefinitely."}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1451880982, "post_id": 34584043, "comment_id": 56914536, "body": "Hmmm... I think I went too far in my quest of minimalizing my original use case. I found somewhere on google group what seems to be the reason for what I end up getting with select: &quot;...it&#39;s just that that rule [select blocking on nil] is superseded by another which says at least one goroutine must be able to make progress. &quot; So blocking main is fine, as long as I have another go routine doing some real work."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1451875502, "creation_date": 1451875502, "answer_id": 34584043, "question_id": 34583936, "link": "https://stackoverflow.com/questions/34583936/getting-a-fatal-error-all-goroutines-are-asleep-deadlock-with-a-simple-test/34584043#34584043", "title": "Getting a fatal error: all goroutines are asleep - deadlock! with a simple test scenario", "body": "<p>Here's what's going on:</p>\n\n<ul>\n<li>The first <code>go func(i int) {</code> goroutine does not exit because <code>chans[0]</code> is not closed.</li>\n<li>Because the goroutine does not exit, <code>wg.Done</code> is not called.</li>\n<li>The call to <code>wg.Wait()</code> blocks forever because of the previous point.</li>\n<li>Main blocks forever because the signal is not sent to <code>done</code>. </li>\n</ul>\n\n<p>You can fix the deadlock by removing the <code>if i != 0 {</code>, but there is another issue. There is a race on the wait group. It's possible that wg.Done() is called before wg.Add(1) is called.  Call wg.Add() before starting the goroutine to avoid the race.</p>\n"}], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 882, "favorite_count": 0, "accepted_answer_id": 34584043, "answer_count": 2, "score": 0, "last_activity_date": 1451877012, "creation_date": 1451874592, "last_edit_date": 1451877012, "question_id": 34583936, "link": "https://stackoverflow.com/questions/34583936/getting-a-fatal-error-all-goroutines-are-asleep-deadlock-with-a-simple-test", "title": "Getting a fatal error: all goroutines are asleep - deadlock! with a simple test scenario", "body": "<p>I am trying to repro an issue and came to a minimum use case with the following code. If I close all the channels (bypassing the i == 0 test), things are working as expected. Wg state decrements and done is triggered, main exits fine. When I skip closing one of these channel (on purpose), I expect the main routine to wait while the waitgroup semaphore will block indefinitely in this case. Instead, I am getting an error: \"fatal error: all goroutines are asleep - deadlock!\". Why is that? I must have missed something fundamental or this the runtime being overzealous?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nconst N int = 4\n\nfunc main() {\n\n    done := make(chan struct{})\n    defer close(done)\n\n    fmt.Println(\"Beginning...\")\n\n    chans := make([]chan int, N)\n    var wg sync.WaitGroup\n\n    for i := 0; i &lt; N; i++ {\n        wg.Add(1)\n        chans[i] = make(chan int)\n        go func(i int) { // p0\n            defer wg.Done()\n            for m := range chans[i] {\n                fmt.Println(\"Received \", m)\n            }\n            fmt.Println(\"Ending p\", i)\n        }(i)\n    }\n\n    go func() {\n        wg.Wait()\n        done &lt;- struct{}{} // signal main that we are done\n    }()\n\n    for i := 0; i &lt; N; i++ {\n        fmt.Println(\"Closing c\", i)\n        if i != 0 { // Skip #0 so wg doesn't reach '0'\n            close(chans[i])\n        }\n    }\n\n    &lt;-done // wait to receive signal from anonymous join function\n    fmt.Println(\"Ending.\")\n}\n</code></pre>\n\n<p><strong>UPDATE:</strong> I edited the code to avoid the race condition. Still getting this error. </p>\n\n<p>The <code>if i != 0</code> is there because it's intentional. I want the wg.Wait to block forever (with its semaphore never reaching 0.) Why can't I do that? It seems the same as if I were using <code>&lt;-done</code> without a matching <code>done &lt;- struct{}{}</code> somewhere else. Would the compiler complain too in that case?</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1451877320, "last_edit_date": 1451877320, "creation_date": 1451876488, "answer_id": 34584151, "question_id": 34583722, "link": "https://stackoverflow.com/questions/34583722/goroutines-channels-and-stopping-short/34584151#34584151", "title": "Goroutines channels and &quot;stopping short&quot;", "body": "<p>The program sends two values to the channel <code>out</code> and reads one value from the channel <code>out</code>.  One of the values is not received.</p>\n\n<p>If the channel is unbuffered (capacity 0), then one of the sending goroutines will block until the program exits.  This is a leak.</p>\n\n<p>If the channel is created with a capacity of 1, then both goroutines can send to the channel and exit. The first value sent to the channel is received by <code>main</code>. The second value remains in the channel.</p>\n\n<p>If the main function does not receive a value from the channel <code>out</code>, then a channel of capacity 2 is required to prevent the goroutines from blocking indefinitely.</p>\n"}], "owner": {"reputation": 677, "user_id": 764384, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/7792c766c5034f2d1322b38d9ed1bad0?s=128&d=identicon&r=PG", "display_name": "slmyers", "link": "https://stackoverflow.com/users/764384/slmyers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 34584151, "answer_count": 1, "score": 0, "last_activity_date": 1451877320, "creation_date": 1451872388, "question_id": 34583722, "link": "https://stackoverflow.com/questions/34583722/goroutines-channels-and-stopping-short", "title": "Goroutines channels and &quot;stopping short&quot;", "body": "<p>I'm reading/working through <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow\">Go Concurrency Patterns: Pipelines and cancellation</a>, but i'm having trouble understanding the <strong>Stopping short</strong> section. We have the following functions: </p>\n\n<pre><code>func sq(in &lt;-chan int) &lt;-chan int {\n    out := make(chan int)\n    go func() {\n        for n := range in {\n            out &lt;- n * n\n        }\n        close(out)\n    }()\n    return out\n}\n\nfunc gen(nums ...int) &lt;-chan int {\n    out := make(chan int)\n    go func() {\n        for _, n := range nums {\n            out &lt;- n\n        }\n        close(out)\n    }()\n    return out\n}\nfunc merge(cs ...&lt;-chan int) &lt;-chan int {\n    var wg sync.WaitGroup\n    out := make(chan int, 1) // enough space for the unread inputs\n\n    // Start an output goroutine for each input channel in cs.  output\n    // copies values from c to out until c is closed, then calls wg.Done.\n    output := func(c &lt;-chan int) {\n        for n := range c {\n            out &lt;- n\n        }\n        wg.Done()\n    }\n    wg.Add(len(cs))\n    for _, c := range cs {\n        go output(c)\n    }\n\n    // Start a goroutine to close out once all the output goroutines are\n    // done.  This must start after the wg.Add call.\n    go func() {\n        wg.Wait()\n        close(out)\n    }()\n    return out\n}\n\nfunc main() {\n    in := gen(2, 3)\n\n    // Distribute the sq work across two goroutines that both read from in.\n    c1 := sq(in)\n    c2 := sq(in)\n\n    // Consume the first value from output.\n    out := merge(c1, c2)\n    fmt.Println(&lt;-out) // 4 or 9\n    return\n    // Apparently if we had not set the merge out buffer size to 1\n    // then we would have a hanging go routine. \n}\n</code></pre>\n\n<p>Now, if you notice line <code>2</code> in <code>merge</code>, it says we make the out <code>chan</code> with <code>buffer</code> size 1, because this is enough space for the unread inputs. However, I'm almost positive that we should allocate a <code>chan</code> with <code>buffer</code> size 2. In accordance with this code sample:</p>\n\n<pre><code>c := make(chan int, 2) // buffer size 2\nc &lt;- 1  // succeeds immediately\nc &lt;- 2  // succeeds immediately\nc &lt;- 3  // blocks until another goroutine does &lt;-c and receives 1 \n</code></pre>\n\n<p>Because this section implies that a <code>chan</code> of <code>buffer</code> size 3 would not block. Can anyone please clarify/assist my understanding? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1752, "user_id": 864097, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/OLdiH.png?s=128&g=1", "display_name": "curtisp", "link": "https://stackoverflow.com/users/864097/curtisp"}, "edited": false, "score": 2, "creation_date": 1451867744, "post_id": 34581352, "comment_id": 56911877, "body": "hey what&#39;s happening here? what is with negative points?"}, {"owner": {"reputation": 1752, "user_id": 864097, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/OLdiH.png?s=128&g=1", "display_name": "curtisp", "link": "https://stackoverflow.com/users/864097/curtisp"}, "edited": false, "score": 1, "creation_date": 1451868418, "post_id": 34581352, "comment_id": 56912011, "body": "The assumption I  did not do any research is incorrect. I did and after 60 minutes asked an earnest question and received two good answers. What else is SO for?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1451870090, "post_id": 34581352, "comment_id": 56912345, "body": "Genaki, forgive me, but on <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org-&gt;Documents-&gt;Learning Go the second document is &quot;How to Write Go Code&quot;</a> which has a section called <a href=\"https://golang.org/doc/code.html#remote\" rel=\"nofollow noreferrer\">Remote packages</a> which deals with exactly your question. Can we agree that your research was probably a bit fluffy? ;) Read the docs. Thoroughly. Really, they are worth it."}, {"owner": {"reputation": 1752, "user_id": 864097, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/OLdiH.png?s=128&g=1", "display_name": "curtisp", "link": "https://stackoverflow.com/users/864097/curtisp"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1451871038, "post_id": 34581352, "comment_id": 56912525, "body": "I did see that. One of it&#39;s first sentences &quot;An import path can describe&quot; makes it seem &quot;optional&quot; or &quot;alternate&quot; method of getting packages and method appeared reliant on GitHub and Mercurial which also makes it seem exceptional. I earnestly needed more. Patrick&#39;s answer nailed it for me unambiguously which is what I needed. Earnest question after earnest research. Frankly I think question is good as it relates Go to Python (cool to see Glide mentioned which supports benefit). Net effect of negative points will be to drive people away from this question which now has good replies."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1451871150, "post_id": 34581352, "comment_id": 56912542, "body": "Well, people are free to voice their opinion. Do not kill the messenger ;)"}, {"owner": {"reputation": 1752, "user_id": 864097, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/OLdiH.png?s=128&g=1", "display_name": "curtisp", "link": "https://stackoverflow.com/users/864097/curtisp"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1451871473, "post_id": 34581352, "comment_id": 56912603, "body": "And messenger shouldn&#39;t kill the message either ; )"}, {"owner": {"reputation": 881, "user_id": 276186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c5627ef10f7577e6994bc424aa830f2?s=128&d=identicon&r=PG", "display_name": "PerroVerd", "link": "https://stackoverflow.com/users/276186/perroverd"}, "edited": false, "score": 1, "creation_date": 1454344383, "post_id": 34581352, "comment_id": 57991014, "body": "Only answering your first doubt. The name of the language is just Go, but you use golang on online documentation to allow proper search"}], "answers": [{"tags": [], "owner": {"reputation": 1862, "user_id": 5721508, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-K96d4k4SZro/AAAAAAAAAAI/AAAAAAAAAhE/mzgiGnLhPSU/photo.jpg?sz=128", "display_name": "Patrick Lee", "link": "https://stackoverflow.com/users/5721508/patrick-lee"}, "is_accepted": true, "score": 9, "last_activity_date": 1451853825, "creation_date": 1451853825, "answer_id": 34581375, "question_id": 34581352, "link": "https://stackoverflow.com/questions/34581352/go-golang-does-it-have-equivalent-of-python-pip-install-to-install-package/34581375#34581375", "title": "Go / golang - does it have equivalent of python &quot;pip install&quot; to install packages?", "body": "<p>Go has <code>go get</code> which is similar to <code>pip install</code> in Python. (<a href=\"https://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies\">ref</a>)</p>\n"}, {"comments": [{"owner": {"reputation": 1752, "user_id": 864097, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/OLdiH.png?s=128&g=1", "display_name": "curtisp", "link": "https://stackoverflow.com/users/864097/curtisp"}, "edited": false, "score": 0, "creation_date": 1451855742, "post_id": 34581465, "comment_id": 56908507, "body": "Ah ok I see those packages in the GOPATH src folder. I was expecting to get them into my app&#39;s GOROOT/myapp/src folder. Getting clearer thanks."}, {"owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "reply_to_user": {"reputation": 1752, "user_id": 864097, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/OLdiH.png?s=128&g=1", "display_name": "curtisp", "link": "https://stackoverflow.com/users/864097/curtisp"}, "edited": false, "score": 1, "creation_date": 1451855979, "post_id": 34581465, "comment_id": 56908575, "body": "@genoki go trough that Organization doc and all should be clear. I don&#39;t know why you expected the lib to be there. You can read about GOROOT and GOPATH there: <a href=\"http://stackoverflow.com/questions/7970390/what-should-be-the-values-of-gopath-and-goroot\" title=\"what should be the values of gopath and goroot\">stackoverflow.com/questions/7970390/&hellip;</a>"}], "tags": [], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "is_accepted": false, "score": 5, "last_activity_date": 1451855590, "last_edit_date": 1451855590, "creation_date": 1451854340, "answer_id": 34581465, "question_id": 34581352, "link": "https://stackoverflow.com/questions/34581352/go-golang-does-it-have-equivalent-of-python-pip-install-to-install-package/34581465#34581465", "title": "Go / golang - does it have equivalent of python &quot;pip install&quot; to install packages?", "body": "<p>Read every single line of this beautiful documentation's section: <a href=\"https://golang.org/doc/code.html#Organization\" rel=\"nofollow\">https://golang.org/doc/code.html#Organization</a></p>\n\n<p>BTW, all packages you have in your import section are from standard library. So you don't have to install anything for this example.</p>\n\n<p>Best way to install a package is <code>go get</code> which simply clones a git repo to your <code>$GOPATH/src</code> and you should stick to it as long as you can.\nIf you <strong>must</strong> use some package version you can create fork for a specified commit and <code>go get</code> that fork or use one of many vendoring toolds <a href=\"https://github.com/golang/go/wiki/PackageManagementTools\" rel=\"nofollow\">https://github.com/golang/go/wiki/PackageManagementTools</a></p>\n"}, {"tags": [], "owner": {"reputation": 577, "user_id": 11910, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3fd9b06332a078b20711de31074ea2f6?s=128&d=identicon&r=PG", "display_name": "Matt Farina", "link": "https://stackoverflow.com/users/11910/matt-farina"}, "is_accepted": false, "score": 4, "last_activity_date": 1451869307, "creation_date": 1451869307, "answer_id": 34583444, "question_id": 34581352, "link": "https://stackoverflow.com/questions/34581352/go-golang-does-it-have-equivalent-of-python-pip-install-to-install-package/34583444#34583444", "title": "Go / golang - does it have equivalent of python &quot;pip install&quot; to install packages?", "body": "<p>The <a href=\"https://github.com/Masterminds/glide\" rel=\"nofollow\">Glide</a> package manager is maybe your closest option to pip. You have config (and lock) files, can specify versions, etc.</p>\n\n<p>Until Go 1.6 is out you'll need to set the environment variable <code>GO15VENDOREXPERIMENT=1</code> for the <code>go</code> tool to pickup the packages in the <code>vendor/</code> folder. In Go 1.6 this will be on by default. Glide stores packages in a <code>vendor/</code> folder instead of the <code>GOPATH</code> (even though the root project needs to be in the <code>GOPATH</code>) so that different applications can have and regularly use different versions of dependencies.</p>\n\n<p>If you want something a little different there are <a href=\"https://github.com/golang/go/wiki/PackageManagementTools\" rel=\"nofollow\">numerous package managers listed on the wiki</a>.</p>\n\n<p><em>Disclosure: I'm on of Glide's developers. Pip was one of the inspirations for it.</em></p>\n"}], "owner": {"reputation": 1752, "user_id": 864097, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/OLdiH.png?s=128&g=1", "display_name": "curtisp", "link": "https://stackoverflow.com/users/864097/curtisp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3921, "favorite_count": 1, "accepted_answer_id": 34581375, "answer_count": 3, "score": 6, "last_activity_date": 1451869307, "creation_date": 1451853630, "question_id": 34581352, "link": "https://stackoverflow.com/questions/34581352/go-golang-does-it-have-equivalent-of-python-pip-install-to-install-package", "title": "Go / golang - does it have equivalent of python &quot;pip install&quot; to install packages?", "body": "<p>Have just started learning about Go (do people say \"Go\" or \"Golang\"?)</p>\n\n<p>I got the hello world example running. I have my GOROOT AND GOPATH set up.</p>\n\n<p>Now I want to do something bit more advanced, for example open csv file, for which I found a tutorial to do that <a href=\"http://www.dotnetperls.com/csv-go\" rel=\"noreferrer\">here</a> </p>\n\n<p>In order to make this script work, I need the packages that are being imported eg \"bufio\", \"encoding/csv\", etc.</p>\n\n<p>Do I have to manually search <a href=\"https://github.com/golang/go/wiki/Projects\" rel=\"noreferrer\">https://github.com/golang/go/wiki/Projects</a> or some other repository, download and unzip these into my GOPATH \"pkg\" directory? </p>\n\n<p>Or does Go/Golang have something equivalent to Python's \"pip install\" that would do this for me?</p>\n\n<pre><code>import (\n    \"bufio\"\n    \"encoding/csv\"\n    \"os\"\n    \"fmt\"\n    \"io\"\n)\n\nfunc main() {\n    // Load a TXT file.\n    f, _ := os.Open(\"C:\\\\Users\\\\bb\\\\Documents\\\\Dropbox\\\\Data\\\\bc hydro tweets\\\\bchtweets.csv\")\n\n    // Create a new reader.\n    r := csv.NewReader(bufio.NewReader(f))\n    for {\n    record, err := r.Read()\n    // Stop at EOF.\n    if err == io.EOF {\n        break\n    }\n    // Display record.\n    // ... Display record length.\n    // ... Display all individual elements of the slice.\n    fmt.Println(record)\n    fmt.Println(len(record))\n    for value := range record {\n        fmt.Printf(\"  %v\\n\", record[value])\n    }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "edited": false, "score": 0, "creation_date": 1451855319, "post_id": 34581321, "comment_id": 56908373, "body": "Can&#39;t you just call <code>subrouter.PathPrefix</code>?"}, {"owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "edited": false, "score": 0, "creation_date": 1451856211, "post_id": 34581321, "comment_id": 56908645, "body": "And how <code>subrouter</code> is created?"}, {"owner": {"reputation": 389, "user_id": 99336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1d1414ce8d21b8dc64a10867968ad77?s=128&d=identicon&r=PG", "display_name": "Rikard", "link": "https://stackoverflow.com/users/99336/rikard"}, "reply_to_user": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "edited": false, "score": 0, "creation_date": 1451885096, "post_id": 34581321, "comment_id": 56915484, "body": "@kopiczko then the subrouter has to know the pathprefix which I don&#39;t want"}, {"owner": {"reputation": 389, "user_id": 99336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1d1414ce8d21b8dc64a10867968ad77?s=128&d=identicon&r=PG", "display_name": "Rikard", "link": "https://stackoverflow.com/users/99336/rikard"}, "reply_to_user": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "edited": false, "score": 0, "creation_date": 1452541373, "post_id": 34581321, "comment_id": 57205590, "body": "meanwhile, I make due with creating a router via SubRouter and passing it to a &quot;RegisterRoutes&quot; method"}], "answers": [{"tags": [], "owner": {"reputation": 1519, "user_id": 506016, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9b2ef6443a54b6be94a1c522b67b661a?s=128&d=identicon&r=PG&f=1", "display_name": "MondayPaper", "link": "https://stackoverflow.com/users/506016/mondaypaper"}, "is_accepted": false, "score": 0, "last_activity_date": 1455642251, "creation_date": 1455642251, "answer_id": 35438643, "question_id": 34581321, "link": "https://stackoverflow.com/questions/34581321/set-gorilla-mux-subrouter/35438643#35438643", "title": "Set gorilla mux subrouter", "body": "<p>I feel the same way, and have to live with the same \"workaround\". I would like to set the subrouter to an existing router. Like: </p>\n\n<pre><code>r.PathPrefix(\"/api\").SetSubrouter(api.GetRouter()) //won't work\n</code></pre>\n\n<p>That would let my api feel more autonomous / loosely coupled. But <em>getting</em> a subrouter is all we have from gorilla.</p>\n\n<pre><code>s := r.PathPrefix(\"/api\").Subrouter()\napi.SetRoutes(s)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12105467, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-wOFHawthQDY/AAAAAAAAAAI/AAAAAAAABeA/VRhLKBtlVEw/photo.jpg?sz=128", "display_name": "Sirex2003", "link": "https://stackoverflow.com/users/12105467/sirex2003"}, "is_accepted": false, "score": 0, "last_activity_date": 1569401639, "creation_date": 1569401639, "answer_id": 58094698, "question_id": 34581321, "link": "https://stackoverflow.com/questions/34581321/set-gorilla-mux-subrouter/58094698#58094698", "title": "Set gorilla mux subrouter", "body": "<p>You can do it like this:</p>\n\n<p><strong>v1 package file:</strong></p>\n\n<pre><code>func Handlers(subrouter *mux.Router) {\n    //base handler, i.e. /v1\n    r.StrictSlash(true)\n    subrouter.HandleFuc(\"/route1/\", ...)\n    subrouter.HandleFuc(\"/route2/\", ...)\n}\n</code></pre>\n\n<p><strong>main file:</strong></p>\n\n<pre><code>r := mux.NewRouter()\npackage.Handlers(r.PathPrefix(\"/api/v1\").Subrouter())\n</code></pre>\n"}], "owner": {"reputation": 389, "user_id": 99336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1d1414ce8d21b8dc64a10867968ad77?s=128&d=identicon&r=PG", "display_name": "Rikard", "link": "https://stackoverflow.com/users/99336/rikard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1365, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1569401639, "creation_date": 1451853451, "question_id": 34581321, "link": "https://stackoverflow.com/questions/34581321/set-gorilla-mux-subrouter", "title": "Set gorilla mux subrouter", "body": "<p>If I have a mux.Router, how do I set it to be a \"subrouter\"? All examples I can find creates a new router by calling Route.Subrouter() and then setting Handlers on it, but I already have a router!</p>\n\n<pre><code>// does not know about \"/api/v1/\"\nv1_router := mux.NewRouter()\nsubrouter.HandleFuc(\"/route1/\", ...)\nsubrouter.HandleFuc(\"/route2/\", ...)\n\n// does not now about route1, route2\nr := mux.NewRouter()\nr.PathPrefix(\"/api/v1/\").???(v1_router)\n</code></pre>\n\n<p>I hope I'm making sense...</p>\n"}, {"tags": ["http", "go", "server", "google-compute-engine"], "answers": [{"comments": [{"owner": {"reputation": 376, "user_id": 2348705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13a37cab3b0733af5c7829aa1d8278b1?s=128&d=identicon&r=PG", "display_name": "Igor Dubinskiy", "link": "https://stackoverflow.com/users/2348705/igor-dubinskiy"}, "edited": false, "score": 2, "creation_date": 1451899930, "post_id": 34580966, "comment_id": 56921083, "body": "I believe omitting the hostname entirely would also work: <code>&quot;:1234&quot; </code>."}], "tags": [], "owner": {"reputation": 512, "user_id": 2079457, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvpZY.jpg?s=128&g=1", "display_name": "ppp", "link": "https://stackoverflow.com/users/2079457/ppp"}, "is_accepted": true, "score": 6, "last_activity_date": 1451851057, "creation_date": 1451851057, "answer_id": 34580966, "question_id": 34580905, "link": "https://stackoverflow.com/questions/34580905/deploy-go-webserver-to-google-compute-engine/34580966#34580966", "title": "Deploy Go webserver to Google compute engine", "body": "<p>Try changing <code>host</code> from <code>localhost</code> to <code>0.0.0.0</code>, because right now it's only listening to \"inside\" requests.</p>\n"}], "owner": {"reputation": 754, "user_id": 3476897, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/57E2l.png?s=128&g=1", "display_name": "Kugel", "link": "https://stackoverflow.com/users/3476897/kugel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 463, "favorite_count": 0, "accepted_answer_id": 34580966, "answer_count": 1, "score": 8, "last_activity_date": 1451851057, "creation_date": 1451850535, "question_id": 34580905, "link": "https://stackoverflow.com/questions/34580905/deploy-go-webserver-to-google-compute-engine", "title": "Deploy Go webserver to Google compute engine", "body": "<p>I just started to test Google compute engine. Now I'm trying to deploy my Go (golang) application on it, so that it can be reached from outside. I use compute engine in favor of the app engine, since my application requires a MongoDB database.</p>\n\n<p>I did the following:</p>\n\n<ol>\n<li>create compute engine instance</li>\n<li>setup up firewall so that port 1234 is open and IP is static</li>\n<li>install MongoDB</li>\n<li>upload my application</li>\n<li>start</li>\n</ol>\n\n<p>The application starts just fine. But I cannot reach it from outside if I open it in my browser with ip:1234. I also tried to start it on port 80 as root user, but this didn't work neither.</p>\n\n<p>The server is configured as following:</p>\n\n<pre><code>{\n    \"host\": \"localhost:1234\",\n    \"dbhost\": \"localhost\",\n    \"db\": \"dbname\",\n    \"logfile\": \"log\"\n}\n</code></pre>\n\n<p>When I'm using an apache server it servers port 80 and the page is displayed... OS is ubuntu 14.04.</p>\n\n<p>The main simply adds some handlers to a mux and adds a FileServer to the public dir:</p>\n\n<pre><code>mux.Handle(\"/\", http.FileServer(http.Dir(public_dir)))\n// [...]\nif err := http.ListenAndServe(cfg.Host, mux); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>So what's the issue here?</p>\n"}, {"tags": ["oop", "go"], "answers": [{"comments": [{"owner": {"reputation": 17491, "user_id": 901827, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86a6acccf7e8dbe398ebda4f8524ed50?s=128&d=identicon&r=PG", "display_name": "LinearZoetrope", "link": "https://stackoverflow.com/users/901827/linearzoetrope"}, "edited": false, "score": 1, "creation_date": 1451861308, "post_id": 34580836, "comment_id": 56910272, "body": "In fact, I&#39;m kind of curious why the example doesn&#39;t use <code>struct{}</code> which is the usual suspect for &quot;who cares what this even is?&quot;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 17491, "user_id": 901827, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86a6acccf7e8dbe398ebda4f8524ed50?s=128&d=identicon&r=PG", "display_name": "LinearZoetrope", "link": "https://stackoverflow.com/users/901827/linearzoetrope"}, "edited": false, "score": 1, "creation_date": 1451920232, "post_id": 34580836, "comment_id": 56933407, "body": "@Jsor: probably because that particular example (and most of &quot;net/rpc&quot;) are very old, predating go1 be a few years (circa 2009). Plus the extra 4-8 bytes allocated to register its methods aren&#39;t going to make any difference in the program overall."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1451850724, "last_edit_date": 1451850724, "creation_date": 1451850143, "answer_id": 34580836, "question_id": 34580253, "link": "https://stackoverflow.com/questions/34580253/static-class-method-in-go-language/34580836#34580836", "title": "Static class method in go language", "body": "<p>This doesn't have anything to do with OOP, it's simply that the rpc package's convention works by exporting methods from an \"object\" (with object here meaning any value with a non-empty method set)</p>\n\n<p>The <code>int</code> is significant as the type of <code>Arith</code>, but it's not significant in this particular example, since the receiver is never referenced in the methods. </p>\n\n<p>So yes, this example is kind of like a static class, but try not to map Java OOP ideas to Go, because Go is very different, as there are no \"classes\" or inheritance. </p>\n"}, {"comments": [{"owner": {"reputation": 15271, "user_id": 133747, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6703c5e8fecd2b0d0d3e137bcff7c61e?s=128&d=identicon&r=PG", "display_name": "huggie", "link": "https://stackoverflow.com/users/133747/huggie"}, "edited": false, "score": 0, "creation_date": 1592290273, "post_id": 58485283, "comment_id": 110364235, "body": "What does <code>(Arith)</code> in <code>main</code> mean?"}, {"owner": {"reputation": 15271, "user_id": 133747, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6703c5e8fecd2b0d0d3e137bcff7c61e?s=128&d=identicon&r=PG", "display_name": "huggie", "link": "https://stackoverflow.com/users/133747/huggie"}, "edited": false, "score": 0, "creation_date": 1592290525, "post_id": 58485283, "comment_id": 110364346, "body": "Oh it refers to the struct definition itself. I got it."}], "tags": [], "owner": {"reputation": 1288, "user_id": 7225929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa26a9a36b086d9872cbe4c70355dfd3?s=128&d=identicon&r=PG&f=1", "display_name": "omotto", "link": "https://stackoverflow.com/users/7225929/omotto"}, "is_accepted": false, "score": 1, "last_activity_date": 1571657036, "creation_date": 1571657036, "answer_id": 58485283, "question_id": 34580253, "link": "https://stackoverflow.com/questions/34580253/static-class-method-in-go-language/58485283#58485283", "title": "Static class method in go language", "body": "<p>Another way to call simulating an static method, despite the fact it isn't, is as follows:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Arith struct {\n}\n\nfunc (Arith) Multiply(a float32, b float32) float32 {\n    return a * b\n}\n\nfunc main() {\n    result := (Arith).Multiply(Arith{}, 15, 25)\n    fmt.Println(result)\n}\n</code></pre>\n\n<p>But from my point of view, it is less understandable than placing this method in a separate package <code>arith</code> outside from class <code>Arith</code></p>\n"}], "owner": {"reputation": 2917, "user_id": 486167, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f043204ff888375a2657ec3bc149c53c?s=128&d=identicon&r=PG", "display_name": "Asad Iqbal", "link": "https://stackoverflow.com/users/486167/asad-iqbal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3014, "favorite_count": 0, "accepted_answer_id": 34580836, "answer_count": 2, "score": 1, "last_activity_date": 1571657036, "creation_date": 1451847001, "question_id": 34580253, "link": "https://stackoverflow.com/questions/34580253/static-class-method-in-go-language", "title": "Static class method in go language", "body": "<p>I am looking at the example code at:  <a href=\"https://golang.org/pkg/net/rpc/\" rel=\"nofollow\">https://golang.org/pkg/net/rpc/</a></p>\n\n<pre><code>type Arith int\n\nfunc (t *Arith) Multiply(args *Args, reply *int) error {\n    *reply = args.A * args.B\n    return nil\n}\n</code></pre>\n\n<p>From an OOP perspective, <code>Multiply</code> seems like a static method which doesn't access any data in <code>Arith</code> class; as the variable <code>t</code> is not used. Does it mean that <code>int</code> in <code>type Arith int</code> does not have any significance?</p>\n"}, {"tags": ["go", "string-formatting"], "answers": [{"tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": true, "score": 5, "last_activity_date": 1451837606, "creation_date": 1451837606, "answer_id": 34578638, "question_id": 34578466, "link": "https://stackoverflow.com/questions/34578466/dynamically-built-formatting-strings-in-golang/34578638#34578638", "title": "Dynamically built formatting strings in Golang", "body": "<p>The issue is in your <code>for format := range formats</code> construct. Keep in mind that <code>range formats</code> will return <em>two</em> values: the actual value from the slice *and its index (which is the first value). So <code>\"%q =&gt; \" + format + \"\\n\"</code> will actually try to concatenate <code>\"%s =&gt; \"</code> with the numeric iteration index.</p>\n\n<p>If you want to iterate over the values contained in the slice, use the following loop for that:</p>\n\n<pre><code>for _, format := range formats {\n    // ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1162, "user_id": 1653085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8irj8.jpg?s=128&g=1", "display_name": "Vitaly Velikodny", "link": "https://stackoverflow.com/users/1653085/vitaly-velikodny"}, "is_accepted": false, "score": 1, "last_activity_date": 1451838051, "last_edit_date": 1451838051, "creation_date": 1451837680, "answer_id": 34578654, "question_id": 34578466, "link": "https://stackoverflow.com/questions/34578466/dynamically-built-formatting-strings-in-golang/34578654#34578654", "title": "Dynamically built formatting strings in Golang", "body": "<p>See <a href=\"https://golang.org/doc/effective_go.html#for\" rel=\"nofollow\">golang For</a> and <a href=\"https://golang.org/doc/effective_go.html#blank\" rel=\"nofollow\">blank identifier</a></p>\n\n<blockquote>\n  <p>If you're looping over an array, slice, string, or map, or reading\n  from a channel, a range clause can manage the loop.</p>\n\n<pre><code>for key, value := range oldMap {\n    newMap[key] = value\n}\n</code></pre>\n</blockquote>\n\n<p>Right way to range with array</p>\n\n<pre><code>for index, value := range formats {\n</code></pre>\n\n<p>if you want to skip index do</p>\n\n<pre><code>for _, value := range formats {\n</code></pre>\n"}], "owner": {"reputation": 7664, "user_id": 128444, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6c168d6b26b2a683965dd6ec15226671?s=128&d=identicon&r=PG", "display_name": "Dominic Zukiewicz", "link": "https://stackoverflow.com/users/128444/dominic-zukiewicz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1328, "favorite_count": 0, "accepted_answer_id": 34578638, "answer_count": 2, "score": 2, "last_activity_date": 1451838051, "creation_date": 1451836552, "last_edit_date": 1451837926, "question_id": 34578466, "link": "https://stackoverflow.com/questions/34578466/dynamically-built-formatting-strings-in-golang", "title": "Dynamically built formatting strings in Golang", "body": "<p>I am attempting to create a formatting string dynamically in Go. The idea is that a map is created with the formatting types. Then a loop goes through them to output the various types. </p>\n\n<p>The end result is to see how the formatting affects the output. </p>\n\n<p>(I appreciate the example will produce the same output, but I would change <code>f</code> over time to other types)</p>\n\n<p>Below is an example of this:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"strings\"\n)\n\nvar formats = []string{\"%f\", \"%v\"}\nvar f float32 = 1 &lt;&lt; 24\n\nfunc main() {\n    for format := range formats {\n        // Generate formatting string here\n        parts := \"%q =&gt; \" + format + \"\\n\"\n        fmt.Printf(parts, format, f)\n    }\n}\n</code></pre>\n\n<p>The compiler is complaining about a int() conversion at the <code>parts:</code> line:</p>\n\n<blockquote>\n  <blockquote>\n    <p>at line 11, file ch3/floating_point.go cannot convert \"%q => \" to type int</p>\n    \n    <p>at line 11, file ch3/floating_point.go  invalid operation: \"%q => \" + format` (mismatched types string and int)</p>\n  </blockquote>\n</blockquote>\n\n<p>I have attempted joining strings, but no luck:</p>\n\n<pre><code>parts:= strings.Join([]string{\"%q =&gt;\",format,\"\\n\"), \" \")\nfmt.Printf(parts,format,f)\n</code></pre>\n\n<p>Also <code>fmt.Fprintf</code> isn't helping either:</p>\n\n<pre><code>for format := range formats {\n      // Generate formatting string here\n      parts := fmt.Fprintf(\"%q =&gt; \" + format, format, f)\n      fmt.Println(parts)\n    }\n</code></pre>\n"}, {"tags": ["go", "jwt", "jwt-go"], "answers": [{"tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": true, "score": 8, "last_activity_date": 1451838354, "last_edit_date": 1451838354, "creation_date": 1451838004, "answer_id": 34578710, "question_id": 34578326, "link": "https://stackoverflow.com/questions/34578326/how-to-verify-a-json-web-token-with-the-jwt-go-library/34578710#34578710", "title": "How to verify a JSON Web Token with the jwt-go library?", "body": "<p>The <code>keyFunc</code> is supposed to return the private key that the library should use to verify the token's signature. How you obtain this key is entirely up to you.</p>\n\n<p>The example from the documentation shows a non-standard (not defined in <a href=\"https://tools.ietf.org/html/rfc7519\" rel=\"noreferrer\">RFC 7519</a>) additional feature that is offered by the jwt-go library. Using a <code>kid</code> field in the header (short for <em>key ID</em>), clients can specify with <em>which key</em> the token was signed. On verification, you can then use the key ID to look up one of (possible several) known keys (how and if you implement this key lookup is up to you).</p>\n\n<p>If you do not want to use this feature, just don't. Simply return a static byte stream from the <code>keyFunc</code> without inspecting the token headers:</p>\n\n<pre><code>token, err := jwt.Parse(myToken, func(token *jwt.Token) (interface{}, error) {\n    key, err := ioutil.ReadFile(\"your-private-key.pem\")\n    if err != nil {\n        return nil, errors.New(\"private key could not be loaded\")\n    }\n    return key, nil\n})\n</code></pre>\n"}], "owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4116, "favorite_count": 1, "accepted_answer_id": 34578710, "answer_count": 1, "score": 7, "last_activity_date": 1588106572, "creation_date": 1451835714, "last_edit_date": 1588106572, "question_id": 34578326, "link": "https://stackoverflow.com/questions/34578326/how-to-verify-a-json-web-token-with-the-jwt-go-library", "title": "How to verify a JSON Web Token with the jwt-go library?", "body": "<p>I am using the jwt-go library in golang, and using the <strong>HS512</strong> algorithm for signing the token. I want to make sure the token is valid and the example in the docs is like this:</p>\n\n<pre><code>token, err := jwt.Parse(myToken, func(token *jwt.Token) (interface{}, error) {\n    return myLookupKey(token.Header[\"kid\"])\n})\n\nif err == nil &amp;&amp; token.Valid {\n    fmt.Println(\"Your token is valid.  I like your style.\")\n} else {\n    fmt.Println(\"This token is terrible!  I cannot accept this.\")\n}\n</code></pre>\n\n<p>I understand that <code>myToken</code> is the string token and the <code>keyFunc</code> gets passed the parsed token, but I don't understand what <code>myLookupKey</code>  function is supposed to do?, and <code>token.Header</code> doesn't have a <code>kid</code> value when i print it to console and even thought the token has all the data I put in it, <code>token.Valid</code> is always false. <strong>Is this a bug? How do I verify the token is valid?</strong></p>\n"}, {"tags": ["pointers", "go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1451827783, "creation_date": 1451827783, "answer_id": 34577044, "question_id": 34576919, "link": "https://stackoverflow.com/questions/34576919/go-golang-do-method-pointers-always-increment-per-source-definition/34577044#34577044", "title": "Go (golang) - do method pointers always increment per source definition?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language Specification</a></p>\n  \n  <p>This is a reference manual for the Go programming language.</p>\n</blockquote>\n\n<p>The order is not defined in the Go language specification therefore the order is undefined. It's implementation dependent.</p>\n"}], "owner": {"reputation": 9331, "user_id": 216012, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e80bdb7a7d2f6be1f039b83b365e03ee?s=128&d=identicon&r=PG", "display_name": "Lee Benson", "link": "https://stackoverflow.com/users/216012/lee-benson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 1, "accepted_answer_id": 34577044, "answer_count": 1, "score": 2, "last_activity_date": 1451827783, "creation_date": 1451826902, "question_id": 34576919, "link": "https://stackoverflow.com/questions/34576919/go-golang-do-method-pointers-always-increment-per-source-definition", "title": "Go (golang) - do method pointers always increment per source definition?", "body": "<p>When methods are defined in Go, does the pointer <em>always</em> increment in the exact order in which they are defined in source - or is it possible that lower pointer space could be re-allocated?</p>\n\n<p>For example - is <code>methods</code> now in the guaranteed order of A, Z, D, B regardless of go version or arch?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"sort\"\n)\n\ntype t struct{}\n\nfunc (a *t) A() {}\nfunc (a *t) Z() {}\nfunc (a *t) D() {}\nfunc (a *t) B() {}\n\ntype addr struct {\n    Addr   uintptr\n    Method string\n}\n\ntype addrList []addr\n\nfunc (a addrList) Len() int {\n    return len(a)\n}\n\nfunc (a addrList) Less(i, j int) bool {\n    return a[i].Addr &lt; a[j].Addr\n}\nfunc (a addrList) Swap(i, j int) {\n    a[i], a[j] = a[j], a[i]\n}\n\nfunc main() {\n\n    methods := addrList{}\n    fooType := reflect.TypeOf(&amp;t{})\n\n    for i := 0; i &lt; fooType.NumMethod(); i++ {\n        method := fooType.Method(i)\n        methods = append(methods, addr{method.Func.Pointer(), method.Name})\n    }\n\n    sort.Sort(methods)\n    fmt.Println(methods)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 0, "creation_date": 1451819755, "post_id": 34575846, "comment_id": 56896513, "body": "What if I need to use values from all go routines before proceeding -  finished sending vs  finished receiving. Do you know?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 1, "creation_date": 1451823415, "post_id": 34575846, "comment_id": 56897552, "body": "then you can close the channel after wg.Wait and the receive loop will exit."}, {"owner": {"reputation": 1739, "user_id": 91449, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/279929b6e31ee2eda28479f7829e6bb0?s=128&d=identicon&r=PG", "display_name": "Guildencrantz", "link": "https://stackoverflow.com/users/91449/guildencrantz"}, "edited": false, "score": 0, "creation_date": 1451869118, "post_id": 34575846, "comment_id": 56912163, "body": "You could also move <code>wg.Done()</code>: If it&#39;s not done when you post the item to the channel, but when it&#39;s actually processed, then you should be calling <code>wg.Done()</code> in your anonymous channel consumer (after printing <code>Packing received cake</code>)."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 4, "last_activity_date": 1451819495, "creation_date": 1451819495, "answer_id": 34575846, "question_id": 34575778, "link": "https://stackoverflow.com/questions/34575778/sync-waitgroup-why-one-go-routine-comes-after-wait/34575846#34575846", "title": "sync.WaitGroup - why one go routine comes after .wait()", "body": "<p>It's perfectly normal. The <code>wg.Wait()</code> makes sure that all goroutines finished sending data to the channel before we continue, it doesn't synchronize the prints of \"Packing received cake\". </p>\n\n<p>When everyone has finished sending the data down the channel, the channel has one item in it, right? but the Waitgroup is finished. </p>\n\n<p>So you have a race condition where the main goroutine continues to \"we are done\" and the receiving goroutine receives and prints. This is not synchronized and you have no guarantee which will happen first.</p>\n"}], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451819495, "creation_date": 1451818941, "question_id": 34575778, "link": "https://stackoverflow.com/questions/34575778/sync-waitgroup-why-one-go-routine-comes-after-wait", "title": "sync.WaitGroup - why one go routine comes after .wait()", "body": "<p>From the following I get:<br>\nPacking received cake:  Strawberry Cake <br>\nPacking received cake:  Strawberry Cake <br>\nPacking received cake:  Strawberry Cake <br>\nPacking received cake:  Strawberry Cake <br>\nWe are done!<br>\nPacking received cake:  Strawberry Cake <br></p>\n\n<p>I did not expect \"We are done!\" to be second last?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    // \"strconv\"\n    // \"time\"\n    \"sync\"\n)\n\nfunc makeCakeAndSend(cs chan string, wg *sync.WaitGroup) {\n    cakeName := \"Strawberry Cake \"\n    cs &lt;- cakeName\n    wg.Done()\n}\n\nfunc receiveCakeAndPack(cs chan string) {\n    for s := range cs {\n        fmt.Println(\"Packing received cake: \", s)\n    }\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    cs := make(chan string)\n\n    wg.Add(5)\n\n    for i := 1; i &lt;= 5; i++ {\n        go makeCakeAndSend(cs, &amp;wg)\n    }\n\n    // go receiveCakeAndPack(cs)\n\n    go func() {\n        for s := range cs {\n            fmt.Println(\"Packing received cake: \", s)\n        }\n        close(cs)\n    }()\n\n    wg.Wait()\n\n    fmt.Println(\"We are done!\")\n\n    var input string\n    fmt.Scanln(&amp;input)\n}\n</code></pre>\n"}, {"tags": ["templates", "struct", "go", "interface", "embedding"], "answers": [{"comments": [{"owner": {"reputation": 1414, "user_id": 822779, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/aJm0V.jpg?s=128&g=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/822779/sam"}, "edited": false, "score": 0, "creation_date": 1452411464, "post_id": 34577294, "comment_id": 57152195, "body": "Thank you for your detailed and insightful answer!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1451834714, "last_edit_date": 1451834714, "creation_date": 1451829574, "answer_id": 34577294, "question_id": 34575704, "link": "https://stackoverflow.com/questions/34575704/template-object-field-enforcement/34577294#34577294", "title": "Template object field enforcement", "body": "<p>Executing a template does not enforce anything to the parameters, <a href=\"https://golang.org/pkg/html/template/#Template.Execute\" rel=\"nofollow\"><code>Template.Execute()</code></a> accepts a value of type <code>interface{}</code>.</p>\n\n<p>You are the one creating the <code>HomePage</code>, <code>RegisterPage</code> and <code>ContactPage</code> structs. What stops you from embedding a <code>BasePage</code> struct with the required fields? Are you worried you will forget about it? You will notice it at the first testing, I wouldn't worry about that:</p>\n\n<pre><code>type BasePage struct {\n    Title string\n    Other string\n    // other required fields...\n}\n\ntype HomePage struct {\n    BasePage\n    // other home page fields...\n}\n\ntype RegisterPage struct {\n    BasePage\n    // other register page fields...\n}\n</code></pre>\n\n<p>If you want from code to check if page structs embed the <code>BasePage</code>, I recommend another way: interfaces.</p>\n\n<pre><code>type HasBasePage interface {\n    GetBasePage() BasePage\n}\n</code></pre>\n\n<p>Example <code>HomePage</code> that implements it:</p>\n\n<pre><code>type HomePage struct {\n    BasePage\n    // other home page fields...\n}\n\nfunc (h *HomePage) GetBasePage() BasePage {\n    return h.BasePage\n}\n</code></pre>\n\n<p>Now obviously only pages that have a <code>GetBasePage()</code> method can be passed as a value of <code>HasBasePage</code>:</p>\n\n<pre><code>var page HasBasePage = &amp;HomePage{} // Valid, HomePage implements HasBasePage\n</code></pre>\n\n<p>If you don't want to use interfaces, you can use the <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow\"><code>reflect</code></a> package to check if a value is a struct value and if it embeds another interface. Embedded structs appear and can be accessed like ordinary fields e.g. with <a href=\"https://golang.org/pkg/reflect/#Value.FieldByName\" rel=\"nofollow\"><code>Value.FieldByName()</code></a>, with the type name being the field name.</p>\n\n<p>Example code using <code>reflect</code> to check if a value embeds <code>BasePage</code>:</p>\n\n<pre><code>page := &amp;HomePage{BasePage: BasePage{Title: \"Home page\"}}\n\nv := reflect.ValueOf(page)\nif v.Kind() == reflect.Ptr {\n    v = v.Elem()\n}\nif v.Kind() != reflect.Struct {\n    fmt.Println(\"Error: not struct!\")\n    return\n}\nbptype := reflect.TypeOf(BasePage{})\nbp := v.FieldByName(bptype.Name()) // \"BasePage\"\nif !bp.IsValid() || bp.Type() != bptype {\n    fmt.Println(\"Error: struct does not embed BasePage!\")\n    return\n}\n\nfmt.Printf(\"%+v\", bp)\n</code></pre>\n\n<p>Output (try it on the <kbd><a href=\"http://play.golang.org/p/m9EgovLcHy\" rel=\"nofollow\">Go Playground</a></kbd>):</p>\n\n<pre><code>{Title:Home page Other:}\n</code></pre>\n"}], "owner": {"reputation": 1414, "user_id": 822779, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/aJm0V.jpg?s=128&g=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/822779/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 34577294, "answer_count": 1, "score": 1, "last_activity_date": 1451834714, "creation_date": 1451818428, "last_edit_date": 1451831924, "question_id": 34575704, "link": "https://stackoverflow.com/questions/34575704/template-object-field-enforcement", "title": "Template object field enforcement", "body": "<p>Go provides great build in HTML templating functionality, however for me it is important that I can ensure certain fields will always be available to templates in my application. A good example of this is a title field, which needs to be shown on every HTML page. </p>\n\n<p>Given the following pages:<br>\n<code>Home</code><br>\n<code>Register</code><br>\n<code>Contact</code></p>\n\n<p>I would likely create the following objects for the templating system:<br>\n<code>HomePage</code> struct<br>\n<code>RegisterPage</code> struct<br>\n<code>ContactPage</code> struct  </p>\n\n<p>Is there a recommended way to ensure that the structs for each page have certain fields available to them?</p>\n\n<p>Ideally I would implement this through Polymorphism, but that isn't officially supported in Go. The alternative, <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow\">embedding</a> doesn't appear to have any enforcement, i.e all of the child structs <em>can</em> embed a parent struct but don't <em>have to</em>.</p>\n\n<p>Let me know if I haven't expressed my question clearly enough.</p>\n"}, {"tags": ["google-app-engine", "go", "struct", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 5895, "user_id": 1279005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c64c420648367c4731d652862fb53d0d?s=128&d=identicon&r=PG", "display_name": "Dmytro Sadovnychyi", "link": "https://stackoverflow.com/users/1279005/dmytro-sadovnychyi"}, "edited": false, "score": 0, "creation_date": 1451818560, "post_id": 34575542, "comment_id": 56896139, "body": "It&#39;s not possible with datastore. But you can workaround it by additional Kind: <a href=\"https://webapp-improved.appspot.com/_modules/webapp2_extras/appengine/auth/models.html#Unique\" rel=\"nofollow noreferrer\">webapp-improved.appspot.com/_modules/webapp2_extras/appengin&zwnj;&#8203;e/&hellip;</a>"}, {"owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "reply_to_user": {"reputation": 5895, "user_id": 1279005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c64c420648367c4731d652862fb53d0d?s=128&d=identicon&r=PG", "display_name": "Dmytro Sadovnychyi", "link": "https://stackoverflow.com/users/1279005/dmytro-sadovnychyi"}, "edited": false, "score": 0, "creation_date": 1451836731, "post_id": 34575542, "comment_id": 56901672, "body": "Okey thanks! Will have a look"}], "answers": [{"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 0, "last_activity_date": 1451819007, "creation_date": 1451819007, "answer_id": 34575785, "question_id": 34575542, "link": "https://stackoverflow.com/questions/34575542/golang-datastore-struct-keeping-field-unique-and-required/34575785#34575785", "title": "golang datastore struct: keeping field unique and required", "body": "<p>From the Datastore API:</p>\n\n<blockquote>\n  <p>By default, for struct pointers, all properties are potentially\n  indexed, and the property name is the same as the field name (and\n  hence must start with an upper case letter). Fields may have a\n  <code>datastore:\"name,options\"</code> tag. The tag name is the property name,\n  which must be one or more valid Go identifiers joined by \".\", but may\n  start with a lower case letter. An empty tag name means to just use\n  the field name. A \"-\" tag name means that the datastore will ignore\n  that field. If options is \"noindex\" then the field will not be\n  indexed. If the options is \"\" then the comma may be omitted. <strong>There are\n  no other recognized options.</strong></p>\n</blockquote>\n\n<p>Not possible to set those type of tags with Datastore. </p>\n"}], "owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 242, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1474845956, "creation_date": 1451817291, "last_edit_date": 1474845956, "question_id": 34575542, "link": "https://stackoverflow.com/questions/34575542/golang-datastore-struct-keeping-field-unique-and-required", "title": "golang datastore struct: keeping field unique and required", "body": "<p>Im wondering how to best guarantee that a field is unique and isn't saved to the datastore if it isn't. Also that it should be required. I am using this field as stringID and need it to be unique. I know that I can simply try to get an entity by this field and see if it exists and build a logic around it. But is there a simpler way like declaring in your struct that the field should be unique and/or required? Like the mockup below.</p>\n\n<pre><code>type Car struct {\n    Regnr  string \"required\" \"unique\"\n}\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1451812063, "post_id": 34574891, "comment_id": 56894446, "body": "<code>time.Parse()</code> returns an error. Print that and you&#39;ll know."}], "answers": [{"tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": true, "score": 3, "last_activity_date": 1451812331, "creation_date": 1451812331, "answer_id": 34574950, "question_id": 34574891, "link": "https://stackoverflow.com/questions/34574891/go-parse-string-to-time/34574950#34574950", "title": "Go parse string to time", "body": "<p>First of all: You're silently ignoring the error this is returned as second return value of <code>time.Parse</code>. I'd suggest handling the error appropriately, instead.</p>\n\n<p>Secondly, let's have a look at the documentation of <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow\"><code>time.Parse</code></a>:</p>\n\n<blockquote>\n  <p><code>Parse</code> parses a formatted string and returns the time value it represents. <strong>The layout defines the format by showing how the reference time, defined to be <code>Mon Jan 2 15:04:05 -0700 MST 2006</code> would be interpreted if it were the value</strong>; it serves as an example of the input format. The same interpretation will then be made to the input string.</p>\n</blockquote>\n\n<p>The <code>time.Parse</code> function expects its <code>layout</code> parameter to represent a fixed example date. So, in order to parse the date <code>Sun, 03 Jan 2016 10:00:07 CET</code>, the appropriate example layout string should be <code>Mon, 02 Jan 2006 15:04:05 MST</code>:</p>\n\n<pre><code>layout := \"Mon, 02 Jan 2006 15:04:05 MST\"\nt, err := time.Parse(layout, \"Sun, 03 Jan 2016 10:00:07 CET\")\nif err != nil {\n    // handle the error somehow!\n}\n\nfmt.Println(t)\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 5728210, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/addde50e68dce92f3b817a4a131bd941?s=128&d=identicon&r=PG&f=1", "display_name": "mjhd", "link": "https://stackoverflow.com/users/5728210/mjhd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 34574950, "answer_count": 1, "score": -2, "last_activity_date": 1451812331, "creation_date": 1451811788, "question_id": 34574891, "link": "https://stackoverflow.com/questions/34574891/go-parse-string-to-time", "title": "Go parse string to time", "body": "<p>I've got the following string:</p>\n\n<pre><code>Sun, 03 Jan 2016 10:00:07 CET\n</code></pre>\n\n<p>Id like to parse it into time, but cannot seem to figure out how to write the format.</p>\n\n<p>This is what I've got so far:</p>\n\n<pre><code>layout := \"Mon, 01 Jan 03:04:05\"\nt, _ := time.Parse(layout, \"Sun, 03 Jan 2016 10:00:07 CET\")\nfmt.Println(t)\n</code></pre>\n\n<p>Output I get is: </p>\n\n<pre><code>0001-01-01 00:00:00 +0000 UTC\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "youtube-api", "youtube-data-api", "google-api-go-client"], "answers": [{"tags": [], "owner": {"reputation": 376, "user_id": 2348705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13a37cab3b0733af5c7829aa1d8278b1?s=128&d=identicon&r=PG", "display_name": "Igor Dubinskiy", "link": "https://stackoverflow.com/users/2348705/igor-dubinskiy"}, "is_accepted": false, "score": 0, "last_activity_date": 1451808335, "creation_date": 1451808335, "answer_id": 34574528, "question_id": 34573979, "link": "https://stackoverflow.com/questions/34573979/how-to-fetch-youtube-playlist-videos-using-go-on-app-engine/34574528#34574528", "title": "how to fetch youtube playlist videos using Go on app engine", "body": "<p>Unfortunately, the linked doc doesn't quite explain why your code isn't working. On App Engine, you need to use a special <code>http.Transport</code> provided by the <code>urlfetch</code> package; see <a href=\"https://cloud.google.com/appengine/docs/go/urlfetch/\" rel=\"nofollow\">https://cloud.google.com/appengine/docs/go/urlfetch/</a></p>\n"}, {"tags": [], "owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "is_accepted": true, "score": 0, "last_activity_date": 1451862337, "creation_date": 1451862337, "answer_id": 34582664, "question_id": 34573979, "link": "https://stackoverflow.com/questions/34573979/how-to-fetch-youtube-playlist-videos-using-go-on-app-engine/34582664#34582664", "title": "how to fetch youtube playlist videos using Go on app engine", "body": "<p>Found the solution. Below code did the task for me.</p>\n\n<pre><code>func FetchVideos(w http.ResponseWriter, r *http.Request) {\n    var service *youtube.Service\n    ctx := appengine.NewContext(r)\n\n    transport := &amp;transport.APIKey{\n        Key:       apiKey,\n        Transport: &amp;urlfetch.Transport{Context: ctx}}\n    client := &amp;http.Client{Transport: transport}\n\n    var err error\n    service, err = youtube.New(client)\n    if err != nil {\n        log.Println(\"ERROR in creating youtube New client \", err)\n    }\n    var items *youtube.PlaylistItemListResponse\n    if items, err = service.PlaylistItems.List(\"snippet\").PlaylistId(\"PLHyTuYqPkZCzt7mWZ4hmmrRdjLJiw6O2T\").Do(); err != nil {\n        log.Println(\"Error in fetching playlist items \", err)\n    }\n    log.Println(Jsonify(items))\n</code></pre>\n"}], "owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 0, "accepted_answer_id": 34582664, "answer_count": 2, "score": 0, "last_activity_date": 1575368674, "creation_date": 1451802644, "last_edit_date": 1575368674, "question_id": 34573979, "link": "https://stackoverflow.com/questions/34573979/how-to-fetch-youtube-playlist-videos-using-go-on-app-engine", "title": "how to fetch youtube playlist videos using Go on app engine", "body": "<p>Using Api key I was able to fetch the videos in a playlist from <strong>Api Explorer</strong>. <strong>Execute without OAuth</strong> fetched the results json. Here is the link.<br>\n<a href=\"https://developers.google.com/apis-explorer/?hl=en_US#p/youtube/v3/youtube.playlistItems.list?part=snippet&amp;playlistId=PLHyTuYqPkZCzt7mWZ4hmmrRdjLJiw6O2T&amp;_h=2&amp;\" rel=\"nofollow\">https://developers.google.com/apis-explorer/?hl=en_US#p/youtube/v3/youtube.playlistItems.list?part=snippet&amp;playlistId=PLHyTuYqPkZCzt7mWZ4hmmrRdjLJiw6O2T&amp;_h=2&amp;</a></p>\n\n<p>Implementing the same call using Go on App engine fails with below error:</p>\n\n<pre>\n Get https://www.googleapis.com/youtube/v3/playlistItems?alt=json&part=snippet&playlistId=PLHyTuYqPkZCzt7mWZ4hmmrRdjLJiw6O2T: http.DefaultTransport and http.DefaultClient are not available in App Engine. See https://cloud.google.com/appengine/docs/go/urlfetch/\n</pre>\n\n<p>Here is the code I use:\n</p>\n\n<pre><code>import (\n    \"net/http\"\n    \"code.google.com/p/google-api-go-client/googleapi/transport\"\n    \"code.google.com/p/google-api-go-client/youtube/v3\"\n    \"log\"\n)\n\n    var service *youtube.Service\n    func init() {\n        var err error\n        log.Println(\"Apikey = \", apiKey)\n        client := &amp;http.Client{Transport: &amp;transport.APIKey{Key: apiKey}}\n        service, err = youtube.New(client)\n        if err != nil {\n            log.Println(\"ERROR in creating youtube New client \", err)\n        }\n        var items *youtube.PlaylistItemListResponse\n        if items, err = service.PlaylistItems.List(\"snippet\").PlaylistId(\"PLHyTuYqPkZCzt7mWZ4hmmrRdjLJiw6O2T\").Do(); err != nil {\n            log.Println(\"Error in fetching playlist items \", err) //this line shows the error\n        }\n        log.Println(Jsonify(items))\n    }\n</code></pre>\n\n<p>As of now, I run my code on local dev server i.e <strong>goapp serve</strong></p>\n\n<p>What is missing? How do I fetch youtube playlist videos using v3 api and ApiKey?</p>\n"}, {"tags": ["go", "rethinkdb"], "answers": [{"tags": [], "owner": {"reputation": 5046, "user_id": 3200554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a018f6e3757b55a3df0a735acc199b4?s=128&d=identicon&r=PG&f=1", "display_name": "mlucy", "link": "https://stackoverflow.com/users/3200554/mlucy"}, "is_accepted": true, "score": 7, "last_activity_date": 1451800220, "creation_date": 1451800220, "answer_id": 34573767, "question_id": 34573655, "link": "https://stackoverflow.com/questions/34573655/how-to-delete-an-element-in-an-array-with-rethinkdb/34573767#34573767", "title": "How to delete an element in an array with RethinkDB", "body": "<p>You probably want something like this:</p>\n\n<pre><code>r.db('gofinder').table('Lobbys').get(ID).update(function(row) {\n  return {members: row('members').setDifference(['Gacnt'])};\n})\n</code></pre>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 1, "accepted_answer_id": 34573767, "answer_count": 1, "score": 4, "last_activity_date": 1451800220, "creation_date": 1451798985, "last_edit_date": 1451799797, "question_id": 34573655, "link": "https://stackoverflow.com/questions/34573655/how-to-delete-an-element-in-an-array-with-rethinkdb", "title": "How to delete an element in an array with RethinkDB", "body": "<p>I have a table that contains <code>Lobbys</code> which are essentially just Party Rooms, it has a Members array and a Messages array, this is an example:</p>\n\n<pre><code>{\n\"id\":  \"a77be9ff-e10f-41c1-8a4c-66b5a55d823c\" ,\n\"members\": [\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\" ,\n\"Gacnt\"\n] ,\n\"messages\": [ ]\n}\n</code></pre>\n\n<p>Right now when a users websocket connects to the <code>Lobby</code> it will add their username to the <code>Members</code> list, and I'm trying to make it so that when the user leaves the <code>Party</code> it removes them from the members list, I came up with this:</p>\n\n<pre><code>r.db(\"gofinder\").table(\"Lobbys\").get(\"a77be9ff-e10f-41c1-8a4c-66b5a55d823c\")(\"members\").update({\n  members: r.db(\"gofinder\").table(\"Lobbys\").get(\"a77be9ff-e10f-41c1-8a4c-66b5a55d823c\")(\"members\").ne(\"Gacnt\")\n})\n</code></pre>\n\n<p>But I get the error:</p>\n\n<pre><code>e: Could not prove argument deterministic.  Maybe you want to use the non_atomic flag? in:\nr.db(\"gofinder\").table(\"Lobbys\").get(\"a77be9ff-e10f-41c1-8a4c-66b5a55d823c\")(\"members\").update({\"members\": r.db(\"gofinder\").table(\"Lobbys\").get(\"a77be9ff-e10f-41c1-8a4c-66b5a55d823c\")(\"members\").ne(\"Gacnt\")})\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>But obviously there is an error, I'm new to Rethink so I'm not sure exactly how to do this, unless I'm supposed to select the array, modify it myself and then put the new array back in.</p>\n\n<p>Right now I am currently using this solution but I feel like it could probably be simpler, especially if I could leave it to <code>ReQL</code> to modify the array instead of having to do it manually</p>\n\n<p><strong>This is my current solution and not relevant to the question</strong></p>\n\n<pre><code>query = gorethink.Table(\"Lobbys\").Get(userinfo.LobbyID).Field(\"members\")\nres, err := query.Run(db)\nif err != nil {\n    log.Println(err)\n}\ndefer res.Close()\nvar members []string\nif err = res.All(&amp;members); err != nil {\n    log.Println(err)\n}\n\nfor i := 0; i &lt; len(members); i++ {\n    if members[i] == userinfo.Username {\n        members = append(members[:i], members[i+1:]...)\n        i--\n    }\n}\n\nquery = gorethink.Table(\"Lobbys\").Get(userinfo.LobbyID).Update(map[string]interface{}{\n    \"members\": members,\n})\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 1, "creation_date": 1451781536, "post_id": 34572122, "comment_id": 56889362, "body": "I don&#39;t get the same output. On 1.5.2 it prints as expected - five &quot;true&quot; lines and then it deadlocks because channel is not being closed and range loop just waits forever"}], "answers": [{"comments": [{"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1495710927, "post_id": 34572268, "comment_id": 75372336, "body": "Why range does not stop automatically?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 2, "creation_date": 1495722076, "post_id": 34572268, "comment_id": 75379706, "body": "@inanc Range stops when the channel is closed. Otherwise, it blocks waiting for values."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1451781905, "creation_date": 1451781905, "answer_id": 34572268, "question_id": 34572122, "link": "https://stackoverflow.com/questions/34572122/fatal-error-all-goroutines-are-asleep-deadlock/34572268#34572268", "title": "fatal error all goroutines are asleep deadlock", "body": "<p>Because the channel <code>c</code> is not closed, the range loop does not exit.  This code will not block:</p>\n\n<pre><code>func main() {\n  var c chan bool = make(chan bool, 2)\n\n  for i := 0; i &lt; 5; i++ {\n    go printer(c)\n  }\n\n  for i := 0; i &lt; 5; i++ {\n    fmt.Println(&lt;-c)\n  }\n}\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/DurYw16O2j\" rel=\"noreferrer\">playground example</a></kbd></p>\n"}], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2188, "favorite_count": 0, "closed_date": 1451787324, "accepted_answer_id": 34572268, "answer_count": 1, "score": 4, "last_activity_date": 1451781942, "creation_date": 1451780343, "question_id": 34572122, "link": "https://stackoverflow.com/questions/34572122/fatal-error-all-goroutines-are-asleep-deadlock", "closed_reason": "Duplicate", "title": "fatal error all goroutines are asleep deadlock", "body": "<p>Can you explain the following error: fatal error: \n<br>true\n<br>true\n<br>all goroutines are asleep - deadlock!<br></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc printer(ch chan bool) {\n    ch &lt;- true\n}\n\nfunc main() {\n    var c chan bool = make(chan bool, 2)\n\n    for i := 0; i &lt; 5; i++ {\n        go printer(c)\n    }\n\n    for i := range c {\n        fmt.Println(i)\n    }\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "entity", "google-cloud-datastore"], "answers": [{"tags": [], "owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "is_accepted": false, "score": 0, "last_activity_date": 1451768773, "creation_date": 1451768773, "answer_id": 34570731, "question_id": 34570633, "link": "https://stackoverflow.com/questions/34570633/golang-datastore-get-object/34570731#34570731", "title": "golang datastore get object", "body": "<p>I noticed that if I create a car by inserting the regnr as key like this:</p>\n\n<pre><code>car := &amp;types.Car{\n            Model:        req.Model,\n            Regnr:        req.Regnr,\n            Year:         req.Year,\n            Type:         req.Type,\n            CreationTime: time.Now(),\n            Sold:         false,\n        }\n        //key := datastore.NewKey(context, \"Car\", \"\", 0, nil)\n        carKey := datastore.NewKey(context, \"Car\", req.Regnr, 0, nil)\n        _, err := datastore.Put(context, carKey, car)\n</code></pre>\n\n<p>I can find it by doing as I wrote in the question. But is this a good way of doing it? I plan on keeping the regnr unique anyway if it is neccesary.</p>\n"}, {"comments": [{"owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "edited": false, "score": 0, "creation_date": 1451816533, "post_id": 34571354, "comment_id": 56895576, "body": "Thank you so much for a wonderful answer! :) I will go with the option of saving with regnr as key. But I have a question of whether I can declare in the struct of a car if a field is unique or not? like this: Regnr        string <code>json:&quot;regnr&quot; binding:&quot;required&quot;</code>. Although I think this is from mongodb."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "edited": false, "score": 0, "creation_date": 1451824898, "post_id": 34571354, "comment_id": 56897937, "body": "@SimonNilssonGuldstrand Using the datastore, you can&#39;t specify if you want a field to be unique. You can&#39;t even make the Key a field of the struct to be filled automatically. Keys are usually passed to <code>Get()</code> and returned by <code>Put()</code>. You may add Key to the struct, but you have to set that manually. You can&#39;t specify Key to be unique, but since it is <code>regnr</code>, you said it is naturally unique. If by any chance you would save another <code>Car</code> with an existing <code>regnr</code>, that would overwrite the existing entity."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1451775008, "last_edit_date": 1495540928, "creation_date": 1451773579, "answer_id": 34571354, "question_id": 34570633, "link": "https://stackoverflow.com/questions/34570633/golang-datastore-get-object/34571354#34571354", "title": "golang datastore get object", "body": "<p>You can't find the inserted entity, because it was saved with a different key than the one you try to get it by.</p>\n\n<p>This line:</p>\n\n<pre><code>_, err := datastore.Put(context, datastore.NewIncompleteKey(context, \"Car\", nil), car)\n</code></pre>\n\n<p>Saves a <code>Car</code> entity with a newly created, incomplete key. If you try to save an entity with an incomplete key, the datastore will assign a (randomly distributed) unique <em>numeric ID</em> to it. A <strong>numeric ID</strong>, not a <code>string</code> <code>name</code>.</p>\n\n<p>And then you try to get it with a key having a <code>string</code> <code>name</code>:</p>\n\n<pre><code>carKey := datastore.NewKey(context, \"Car\", regnr, 0, nil)\n</code></pre>\n\n<p>They will never match! The <a href=\"https://cloud.google.com/appengine/docs/go/datastore/entities#Go_Kinds_and_identifiers\" rel=\"nofollow noreferrer\"><em>identifier</em></a> part of an entity's key can either be</p>\n\n<ul>\n<li>a <em>key name</em> string</li>\n<li>or an integer <em>numeric ID</em></li>\n</ul>\n\n<p>But not both. So when you save an entity, its key either has a <code>string</code> id called <em>name</em> OR (exclusive OR) an <code>int64</code> id called <em>intID</em>.</p>\n\n<p>Please do read my answer about entity identifiers: <a href=\"https://stackoverflow.com/a/29573089/1705598\">Can I use AllocateIDs as \u201cstring\u201d ?</a></p>\n\n<p>Your options are:</p>\n\n<h3>I. <code>regnr</code> as string name</h3>\n\n<p>Either use <code>regnr</code> as a <code>string</code> <code>name</code> if you do have guarantee it's unique, and it is always present (no entity to be saved without <code>regnr</code>):</p>\n\n<pre><code>carKey := datastore.NewKey(context, \"Car\", req.Regnr, 0, nil)\n</code></pre>\n\n<p>This is <strong>not</strong> an incomplete key if <code>req.Regnr</code> is not an empty string, and thus it will be used as the <code>string</code> <code>name</code> of the entity's key. Which means later you can get this entity by:</p>\n\n<pre><code>carKey := datastore.NewKey(context, \"Car\", regnr, 0, nil)\nerr := datastore.Get(context, carKey, &amp;car)\n</code></pre>\n\n<h3>II. <code>regnr</code> as \"normal\" property</h3>\n\n<p>Or define <code>regnr</code> as a \"normal\" property and save entities with an incomplete key, leaving the unique numeric ID assignment to the system. This won't limit you in finding entities by <code>regnr</code> as you can filter entities by it if it's an indexed property. In this alternative <code>regnr</code> is not part of the entity's key, so you can't use <code>datastore.Get()</code> to get an entity, you have to use a query, e.g. <code>datastore.NewQuery()</code>.</p>\n\n<h3>Comparision:</h3>\n\n<p>Pros of I. are that it's more compact, uses less datastore space, faster and easier to get entities by <code>regnr</code>.</p>\n\n<p>Cons of I. are that you are responsible keeping <code>regnr</code> unique, and you can't save <code>Car</code> entities without <code>regnr</code> (which may or may not be a problem).</p>\n"}], "owner": {"reputation": 478, "user_id": 1103562, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ef07743a8a849d44a56f4f0e80169e33?s=128&d=identicon&r=PG", "display_name": "Simon Guldstrand", "link": "https://stackoverflow.com/users/1103562/simon-guldstrand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 592, "favorite_count": 0, "accepted_answer_id": 34571354, "answer_count": 2, "score": 2, "last_activity_date": 1474845964, "creation_date": 1451768118, "last_edit_date": 1474845964, "question_id": 34570633, "link": "https://stackoverflow.com/questions/34570633/golang-datastore-get-object", "title": "golang datastore get object", "body": "<p>I need some guidance whether I am doing this correct. Im trying to get a single object of a car. This is how I create a car:</p>\n\n<pre><code> car := &amp;types.Car{\n            Model:        req.Model,\n            Regnr:        req.Regnr,\n            Year:         req.Year,\n            Type:         req.Type,\n            CreationTime: time.Now(),\n            Sold:         false,\n        }\n        //key := datastore.NewKey(context, \"Car\", \"\", 0, nil)\n\n        _, err := datastore.Put(context, datastore.NewIncompleteKey(context, \"Car\", nil), car)\n</code></pre>\n\n<p>This is the way im trying to get the car again.</p>\n\n<pre><code>vars := mux.Vars(r)\n        regnr := vars[\"regnr\"]\n        car := types.Car{}\n        carKey := datastore.NewKey(context, \"Car\", regnr, 0, nil)\n        err := datastore.Get(context, carKey, &amp;car)\n        if err != nil {\n            log.Println(\"error getting car\", err)\n            w.WriteHeader(http.StatusInternalServerError)\n            return\n        }\n</code></pre>\n\n<p>But I get the error: \"error getting car datastore: no such entity\"</p>\n\n<p>I know I can do a GetAll and limit to one. But if im deleting an object, I need the entity. I guess. So I want to do it right.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4159, "user_id": 3925041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/nUSoq.png?s=128&g=1", "display_name": "SexxLuthor", "link": "https://stackoverflow.com/users/3925041/sexxluthor"}, "edited": false, "score": 0, "creation_date": 1451772825, "post_id": 34570157, "comment_id": 56887094, "body": "I&#39;ve been assured there&#39;s a way to get the original response (and headers) from the wrapped handler, but I haven&#39;t been able to figure out how."}, {"owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "reply_to_user": {"reputation": 4159, "user_id": 3925041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/nUSoq.png?s=128&g=1", "display_name": "SexxLuthor", "link": "https://stackoverflow.com/users/3925041/sexxluthor"}, "edited": false, "score": 0, "creation_date": 1451778326, "post_id": 34570157, "comment_id": 56888658, "body": "@SexxLuthor, as I said, the handler itself is not associated with a request in any kind (if you have a look at the <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow noreferrer\">documentation</a>, you&#39;ll see that the <code>http.Handler</code> interface does not offer much besides the <code>ServeHTTP</code> method). The idea that I wanted to express in my answer was that you can wrap the handler yourself and then access the original request in your own middleware <i>before</i> invoking the wrapped handler function."}, {"owner": {"reputation": 4159, "user_id": 3925041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/nUSoq.png?s=128&g=1", "display_name": "SexxLuthor", "link": "https://stackoverflow.com/users/3925041/sexxluthor"}, "edited": false, "score": 0, "creation_date": 1451781381, "post_id": 34570157, "comment_id": 56889321, "body": "&quot;access the HTTP headers that were already set by the decorated handlers&quot; is actually what I&#39;m trying to do, i.e., get the response headers that were set by <code>originalHandler</code>, and then do stuff with them in Middleware(), setting additional header(s) on the original response, before finally calling ServeHTTP. Middleware() decorates the original <code>http.Handler</code> now, which returns a new <code>HandlerFunc</code> as you describe above."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451828310, "post_id": 34570157, "comment_id": 56898886, "body": "You need to decorate the ResponseWriter - <a href=\"https://justinas.org/writing-http-middleware-in-go/\" rel=\"nofollow noreferrer\">justinas.org/writing-http-middleware-in-go</a>"}], "tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": false, "score": 3, "last_activity_date": 1451778375, "last_edit_date": 1451778375, "creation_date": 1451764955, "answer_id": 34570157, "question_id": 34569457, "link": "https://stackoverflow.com/questions/34569457/how-can-i-get-response-headers-from-a-handler-type/34570157#34570157", "title": "How can I get response headers from a Handler type?", "body": "<p>Strictly speaking, you cannot. In priniple, the <code>http.Handler</code> is a <em>function</em> that is invoked for each request. As such, it is not bound to any specific request; it will be re-used for an arbitrary number of requests. As such, there is no way to retrieve HTTP request or response headers from an existing <code>http.Handler</code> object.</p>\n\n<p>You can however, decorate the handler with <em>your own middleware</em> to access HTTP response headers that were set by the middleware function.</p>\n\n<p>A middleware function as described in your question will typically be implemented like this:</p>\n\n<pre><code>func Middleware(originalHandler http.Handler) http.Handler {\n    return http.HandlerFunc(func(rw http.ResponseWriter, req *http.Request) {\n        // call the original handler that is wrapped by this middleware\n        originalHandler.ServeHTTP(rw, req)\n    }\n}\n</code></pre>\n\n<p>This function \"decorates\" the original <code>http.Handler</code> that is passed as a parameter into the middleware function by returning a <em>new</em> handler that implements custom logic and calls the original (wrapped) handler function at some point.</p>\n\n<p>Within the new function, you can access the <code>http.ResponseWriter</code> object as usual to access the HTTP headers that were already set by the decorated handlers:</p>\n\n<pre><code>func Middleware(originalHandler http.Handler) http.Handler {\n    return http.HandlerFunc(func(rw http.ResponseWriter, req *http.Request) {\n        // Add new headers to the response...\n        rw.Header().Set(\"X-My-Own-Header\", \"foo\")\n\n        // ...or access data from the original request\n        fmt.Println(req.Header().Get(\"X-My-Request-Header\")\n\n        // call the original handler that is wrapped by this middleware\n        originalHandler.ServeHTTP(rw, req)\n\n        // Access headers in the response object\n        rw.Header().Get(\"X-Header-Set-By-Middleware\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 4159, "user_id": 3925041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/nUSoq.png?s=128&g=1", "display_name": "SexxLuthor", "link": "https://stackoverflow.com/users/3925041/sexxluthor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 687, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1451778375, "creation_date": 1451760536, "question_id": 34569457, "link": "https://stackoverflow.com/questions/34569457/how-can-i-get-response-headers-from-a-handler-type", "title": "How can I get response headers from a Handler type?", "body": "<p>Given a middleware function with a signature like:</p>\n\n<pre><code>func Middleware(handler http.Handler) http.Handler\n</code></pre>\n\n<p>How can I get response headers set and passed to it from a calling function?</p>\n\n<p>First a HandlerFunc (the \"base\" or main server function) is initialized with some response headers. Then it is passed to and wrapped by the middleware function in the conventional manner.</p>\n\n<p>How can I get the Response and its headers from the <code>handler</code> parameter?</p>\n\n<p>I've tried a number of things but can't get at the header values.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1451759828, "post_id": 34569181, "comment_id": 56882986, "body": "You have your function returning a <code>map[string]Records</code> but the thing you&#39;re fetching from the DB is a <code>string</code>, not a <code>Records</code>, whatever that is. What&#39;s supposed to happen there?"}], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 1, "last_activity_date": 1451760252, "creation_date": 1451760252, "answer_id": 34569412, "question_id": 34569181, "link": "https://stackoverflow.com/questions/34569181/go-return-map-from-sql-query/34569412#34569412", "title": "GO: Return map from SQL query", "body": "<p>First, you need to build up your query. As it is, you're not even using your function input. Since we have a variable number of arguments, we need to do a little work to construct the right number of placeholders:</p>\n\n<pre><code>query := `select callid, foo from bardata where callid in (` +\n    strings.Repeat(`?,`, len(callIds) - 1) + `?)`\n</code></pre>\n\n<p>then, execute with the values passed in:</p>\n\n<pre><code>rows, err := db.Query(query, callIds...)\nif err != nil {\n    // handle it\n}\ndefer rows.Close()\n</code></pre>\n\n<p>then collect the results:</p>\n\n<pre><code>ret := map[string]string{}\nfor rows.Next() {\n    var callid, foo string\n    err = rows.Scan(&amp;callid, &amp;foo)\n    if err != nil {\n        // handle it\n    }\n    ret[callid] = foo\n}\n\nreturn ret\n</code></pre>\n\n<p>Caveats:</p>\n\n<ol>\n<li><p>This will cause a placeholder mismatch error if <code>callIds</code> is an empty slice. If that's possible, then you need to detect it and handle it separately (maybe by returning an error or an empty map \u2014 querying the DB shouldn't be necessary).</p></li>\n<li><p>This returns a <code>map[string]string</code> where the values are whatever \"foo\" is. In your question you have the function returning a <code>map[string]Records</code> but there's no information about what a <code>Records</code> might be or how to fetch one.</p></li>\n<li><p>You might want to handle <code>sql.ErrNoRows</code> differently from other errors.</p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 3238, "user_id": 7404943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/364eff21ecce181be48b17e7208397e2?s=128&d=identicon&r=PG&f=1", "display_name": "barbsan", "link": "https://stackoverflow.com/users/7404943/barbsan"}, "edited": false, "score": 0, "creation_date": 1554190701, "post_id": 55468874, "comment_id": 97649713, "body": "Add some explanation to improve quality of your answer"}], "tags": [], "owner": {"reputation": 11, "user_id": 11297642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76bbe3a4f63cb79821512fbc9772fbb4?s=128&d=identicon&r=PG", "display_name": "user11297642", "link": "https://stackoverflow.com/users/11297642/user11297642"}, "is_accepted": false, "score": 0, "last_activity_date": 1554189077, "creation_date": 1554189077, "answer_id": 55468874, "question_id": 34569181, "link": "https://stackoverflow.com/questions/34569181/go-return-map-from-sql-query/55468874#55468874", "title": "GO: Return map from SQL query", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/bobby96333/goSqlHelper\"\n)\n\nfunc main(){\n    fmt.Println(\"hello\")\n    conn,err :=goSqlHelper.MysqlOpen(\"user:password@tcp(127.0.0.1:3306)/dbname\")\n    checkErr(err)\n    row,err := conn.QueryRow(\"select * from table where col1 = ? and  col2 = ?\",\"123\",\"abc\")\n    checkErr(err)\n    if *row==nil {\n        fmt.Println(\"no found row\")\n    }else{\n        fmt.Printf(\"%+v\",row)\n    }\n}\n\nfunc checkErr(err error){\n    if err!=nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<p>&amp;map[col1:abc col2:123]</p>\n"}], "owner": {"reputation": 69, "user_id": 2502053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5c7476fd88b34ca2dbf898f5056e337d?s=128&d=identicon&r=PG", "display_name": "user2502053", "link": "https://stackoverflow.com/users/2502053/user2502053"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1506, "favorite_count": 0, "accepted_answer_id": 34569412, "answer_count": 2, "score": 0, "last_activity_date": 1554189077, "creation_date": 1451758913, "question_id": 34569181, "link": "https://stackoverflow.com/questions/34569181/go-return-map-from-sql-query", "title": "GO: Return map from SQL query", "body": "<p>I am querying a mysql database in a GO function and want to return key value pairs in a map but can't quite figure out how to accomplish this. So far I have this function:</p>\n\n<pre><code>func GetData(callIds []string) map[string]Records {\n    //db insert\n    db, err := sql.Open(\"mysql\", mySql)\n    if err != nil {\n        fmt.Printf(err.Error())\n    }\n    defer db.Close()\n    //db query\n    var foo string\n    err = db.QueryRow(\"select foo from bardata where callId = %v\", 1).Scan(&amp;foo)\n    if err != nil {\n        fmt.Printf(err.Error())\n    }\n    fmt.Println(foo)\n\n    return nil\n</code></pre>\n\n<p>I want to return a map with the key being <code>callId</code> and value being <code>foo</code> for each row returned from the query.</p>\n"}, {"tags": ["go", "database-migration", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 164, "user_id": 1080651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a804d7084809b251cb27f0b2ded22509?s=128&d=identicon&r=PG", "display_name": "j4zz", "link": "https://stackoverflow.com/users/1080651/j4zz"}, "edited": false, "score": 0, "creation_date": 1451775765, "post_id": 34570759, "comment_id": 56887985, "body": "I was hoping there would be an existing wrapper somehow like <a href=\"https://github.com/jinzhu/gorm/pull/295/files\" rel=\"nofollow noreferrer\">.Open since this pull request</a>, but for <code>sql.Tx</code>."}], "tags": [], "owner": {"reputation": 1162, "user_id": 1653085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8irj8.jpg?s=128&g=1", "display_name": "Vitaly Velikodny", "link": "https://stackoverflow.com/users/1653085/vitaly-velikodny"}, "is_accepted": true, "score": 1, "last_activity_date": 1451768988, "creation_date": 1451768988, "answer_id": 34570759, "question_id": 34568997, "link": "https://stackoverflow.com/questions/34568997/writing-a-goose-go-migration-with-gorm/34570759#34570759", "title": "Writing a goose go migration with gorm", "body": "<p>goose know nothing about gorm and his functions (CreateTable etc.)</p>\n\n<p>Look at the end of <a href=\"https://bitbucket.org/liamstask/goose/src/8488cc47d90c8a502b1c41a462a6d9cc8ee0a895/lib/goose/migration_go.go?at=master&amp;fileviewer=file-view-default#cl-125\" rel=\"nofollow\">goose / lib / goose / migration_go.go</a></p>\n\n<p>goose just create transaction</p>\n\n<pre><code>db, err := goose.OpenDBFromDBConf(&amp;conf)\nif err != nil {\n    log.Fatal(\"failed to open DB:\", err)\n}\ndefer db.Close()\n\ntxn, err := db.Begin()\nif err != nil {\n    log.Fatal(\"db.Begin:\", err)\n}\n\n{{ .Func }}(txn)\n\nerr = goose.FinalizeMigration(&amp;conf, txn, {{ .Direction }}, {{ .Version }})\nif err != nil {\n    log.Fatal(\"Commit() failed:\", err)\n}\n</code></pre>\n\n<p>and use <a href=\"https://golang.org/pkg/database/sql/#Tx\" rel=\"nofollow\">sql.Tx</a> from \"database/sql\" package</p>\n\n<p>but you can implement custom wrapper using gorm ;-)</p>\n"}], "owner": {"reputation": 164, "user_id": 1080651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a804d7084809b251cb27f0b2ded22509?s=128&d=identicon&r=PG", "display_name": "j4zz", "link": "https://stackoverflow.com/users/1080651/j4zz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1330, "favorite_count": 0, "accepted_answer_id": 34570759, "answer_count": 1, "score": 1, "last_activity_date": 1451768988, "creation_date": 1451757826, "question_id": 34568997, "link": "https://stackoverflow.com/questions/34568997/writing-a-goose-go-migration-with-gorm", "title": "Writing a goose go migration with gorm", "body": "<p>A default <a href=\"https://bitbucket.org/liamstask/goose\" rel=\"nofollow\">goose</a> go migration prepares a function providing an <code>*sql.Tx</code>:</p>\n\n<blockquote>\n  <p>A transaction is provided, rather than the DB instance directly, since goose also needs to record the schema version within the same transaction. Each migration should run as a single transaction to ensure DB integrity, so it's good practice anyway.</p>\n</blockquote>\n\n<p>I would like to write my migration using <a href=\"https://github.com/jinzhu/gorm#migration\" rel=\"nofollow\">gorm migrations</a>, but I\u2019m not sure how to use the given transaction to that purpose. Here\u2019s an example:</p>\n\n<pre><code>func Up_20151230135812(txn *sql.Tx) {\n  txn.CreateTable(&amp;User{})\n}\n</code></pre>\n\n<p>The build gives me <code>txn.CreateTable undefined (type *sql.Tx has no field or method CreateTable)</code> as expected. How can I grab the transaction for use with gorm?</p>\n"}, {"tags": ["go", "viper-go"], "comments": [{"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 1, "creation_date": 1451759089, "post_id": 34568631, "comment_id": 56882683, "body": "Posting this as an issue / question on the Viper Github project may get you some good feedback there too.  I investigated that project a bit and then just went with JSON so I could use the standard library and not have a dependency on something else.  Defined a struct the way I wanted and then you can serialize to a file very easily.  Viper looks to provide a lot of extra bits if you need it though."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1451792408, "post_id": 34568631, "comment_id": 56891201, "body": "I think this is intended behavior, iirc. Since the first two configuration locations most likely do not hold a config file, but viper is supposed to read them, it throws an error. The error handling simply is a bit rough, imho. What happens if you remove the ConfigPaths under <code>&#47;usr</code>?"}, {"owner": {"reputation": 1847, "user_id": 391464, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1XdRz.png?s=128&g=1", "display_name": "yee", "link": "https://stackoverflow.com/users/391464/yee"}, "edited": false, "score": 0, "creation_date": 1452074444, "post_id": 34568631, "comment_id": 57005798, "body": "There&#39;s already a issue on viper&#39;s repo: <a href=\"https://github.com/spf13/viper/issues/33\" rel=\"nofollow noreferrer\">github.com/spf13/viper/issues/33</a>"}], "owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2595, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1483634669, "creation_date": 1451755720, "last_edit_date": 1495542829, "question_id": 34568631, "link": "https://stackoverflow.com/questions/34568631/initializing-a-new-go-configuration-with-viper", "title": "Initializing a new Go configuration with Viper", "body": "<p>I've been exploring configuration management in Go using the <a href=\"https://github.com/spf13/viper\" rel=\"nofollow noreferrer\">viper package</a>, which I learned about in <a href=\"https://stackoverflow.com/questions/16465705/how-to-handle-configuration-in-go\">another question</a>. I'm having trouble understanding how to initialize a new configuration. What I want to do is to find system configurations if they exist, then user configuration, and then, if all else fails, to create (and then use) a new user configuration from defaults. The next time I run the app, I'd expect to find the configuration that I previously created. I'm using it like this:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"github.com/spf13/viper\"\n    \"os\"\n    \"os/user\"\n    \"path/filepath\"\n)\n\nusr, err := user.Current()\nappMode := \"test\" // or \"production\" or...\nconfigDir := filepath.Join(usr.HomeDir, \".myapp\")\nconfig := viper.New()\n\nconfig.SetConfigName(appMode)\nconfig.SetConfigType(\"json\")\n\nconfig.SetDefault(\"group1.key1\", \"value1.1\")\nconfig.SetDefault(\"group1.key2\", 1234)\nconfig.SetDefault(\"group2.key1\", \"value2.1\")\nconfig.SetDefault(\"group2.key2\", 5678)\n\nconfig.AddConfigPath(\"/usr/share/myapp/config\")\nconfig.AddConfigPath(\"/usr/local/share/myapp/config\")\nconfig.AddConfigPath(configDir)\n\nif err := config.ReadInConfig(); err != nil {\n    filename := filepath(configDir, fmt.Sprintf(\"%s.json\", appMode))\n    _, err := os.Create(filename)\n    if err != nil {\n        panic(fmt.Stringf(\"Failed to create %s\", filename))\n    }\n}\n\nif err := config.ReadInConfig(); err != nil {\n    panic(\"Created %s, but Viper failed to read it: %s\",\n          filename, err)\n}\n</code></pre>\n\n<p>At this point, I would like for ~/.myapp/test.json to be created for me with the following:</p>\n\n<pre><code>{\n    \"group1\": {\n        \"key1\": \"value1.1\",\n        \"key2\": 1234\n    },\n    \"group2\": {\n        \"key1\": \"value2.1\",\n        \"key2\": 5678\n    }\n}\n</code></pre>\n\n<p>The result is that the file is empty, and the second attempt to read the file also fails with the message \"open : no such file or directory\" even though it exists. If I hand-edit the file, Viper finds it and parses it. Obviously I can create the JSON file programatically, but this seems like such an obvious use case that I must be missing something here.</p>\n"}, {"tags": ["node.js", "go", "cryptography", "jwt", "jwt-go"], "answers": [{"tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": false, "score": 7, "last_activity_date": 1451755720, "creation_date": 1451755720, "answer_id": 34568630, "question_id": 34568121, "link": "https://stackoverflow.com/questions/34568121/can-a-jwt-created-in-one-language-or-library-be-decoded-and-verified-in-another/34568630#34568630", "title": "Can a jwt created in one language or library be decoded and verified in another?", "body": "<p><strong>TL;DR: Yes.</strong></p>\n\n<p>Interoperability is kind of the point of using JSON web tokens. <a href=\"https://tools.ietf.org/html/rfc7519\">RFC 7519</a> explicitly defines (independent of implenentation language) how JWTs are to be issued and verified and all known implementations (at least those <a href=\"http://jwt.io/#libraries-io\">listed on the project website</a>) follow this standard.</p>\n\n<p>Personally, I've used <a href=\"https://github.com/dgrijalva/jwt-go\">jwt-go</a> (Go), <a href=\"https://github.com/auth0/node-jsonwebtoken\">jsonwebtoken</a> (Node.JS) and <a href=\"https://github.com/firebase/php-jwt\">php-jwt</a> (PHP) and <a href=\"https://bitbucket.org/b_c/jose4j/wiki/Home\">jose4j</a> (Java, Scala) all in conjunction and never encountered any interoperability issues.</p>\n"}], "owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1588099102, "creation_date": 1451752547, "last_edit_date": 1588099102, "question_id": 34568121, "link": "https://stackoverflow.com/questions/34568121/can-a-jwt-created-in-one-language-or-library-be-decoded-and-verified-in-another", "title": "Can a jwt created in one language or library be decoded and verified in another?", "body": "<p>So I have an API server that uses <strong>golang</strong> and the <strong>jwt-go</strong> library to issue jwt and i want to have a <strong>socket.io</strong> server running using <strong>node.js</strong> and <strong>jsonwebtoken</strong> library that needs to decode and verify the token, so my question is can I issue a token from one library, decode and verify it from another?</p>\n"}, {"tags": ["nginx", "go", "passenger"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 3, "last_activity_date": 1451753425, "creation_date": 1451753425, "answer_id": 34568274, "question_id": 34568073, "link": "https://stackoverflow.com/questions/34568073/running-a-go-webserver-behind-phusion-passenger/34568274#34568274", "title": "Running a Go webserver behind Phusion Passenger", "body": "<p>No, you can't. Passenger doesn't actually use HTTP internally; it uses a custom protocol (like FastCGI or SCGI but incompatible with both) to communicate with your app and requires its own code in the application for management and dispatching requests. They don't provide such support code for Go.</p>\n"}, {"tags": [], "owner": {"reputation": 449, "user_id": 4986798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625e6675083855baac5405d6c88af52d?s=128&d=identicon&r=PG&f=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/4986798/michael"}, "is_accepted": true, "score": 2, "last_activity_date": 1570134990, "creation_date": 1570134990, "answer_id": 58226542, "question_id": 34568073, "link": "https://stackoverflow.com/questions/34568073/running-a-go-webserver-behind-phusion-passenger/58226542#58226542", "title": "Running a Go webserver behind Phusion Passenger", "body": "<p>This is actually possible now, Passenger 6 has added generic language support. You can find the tutorial here: <a href=\"https://www.phusionpassenger.com/docs/advanced_guides/gls/go.html\" rel=\"nofollow noreferrer\">https://www.phusionpassenger.com/docs/advanced_guides/gls/go.html</a></p>\n\n<p>Basically:</p>\n\n<ol>\n<li>Compile your Go program and put the binary somewhere convenient. The application needs to accept configuration to choose what port to run on.</li>\n<li><code>passenger start --app-start-command 'env PORT=$PORT ./main'</code> assuming main is your program name.</li>\n</ol>\n\n<p>Passenger will try to tell the application what port to start on so that it can have port 80/443.</p>\n"}], "owner": {"reputation": 4068, "user_id": 224732, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/14e1fb975cbce8ae37b509446e660e27?s=128&d=identicon&r=PG", "display_name": "Erik Rothoff", "link": "https://stackoverflow.com/users/224732/erik-rothoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 58226542, "answer_count": 2, "score": 1, "last_activity_date": 1570134990, "creation_date": 1451752253, "question_id": 34568073, "link": "https://stackoverflow.com/questions/34568073/running-a-go-webserver-behind-phusion-passenger", "title": "Running a Go webserver behind Phusion Passenger", "body": "<p>Phusion Passenger has a great ecosystem for running webapps behind a webserver. I have experience with it from Ruby and Node.js apps. Now I rewrote a webservice to use Go, and it's time to deploy it. It seems natural to put Passenger+Nginx in front of the go webserver (using <code>net/http</code>). Searching around it seems that nobody has tried this, or asked about this anywhere...</p>\n\n<p>I can't seem to find a configuration option to attach a custom binary, instead of <code>passenger_ruby</code>/<code>passenger_node</code> etc. </p>\n\n<p>Can (should?) I use Phusion Passenger to run my binary created using <code>go build</code>?</p>\n"}, {"tags": ["opengl", "go"], "answers": [{"comments": [{"owner": {"reputation": 241, "user_id": 3318040, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/5b295dd3671f965c2ad052d2b6956ea9?s=128&d=identicon&r=PG&f=1", "display_name": "Gippeumi", "link": "https://stackoverflow.com/users/3318040/gippeumi"}, "edited": false, "score": 0, "creation_date": 1451749410, "post_id": 34567547, "comment_id": 56879105, "body": "I also tried glVertexPointer. But It didn&#39;t worked, too. I edited question."}], "tags": [], "owner": {"reputation": 374839, "user_id": 734069, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a356923f858fbe363dad1dc566837fc6?s=128&d=identicon&r=PG", "display_name": "Nicol Bolas", "link": "https://stackoverflow.com/users/734069/nicol-bolas"}, "is_accepted": false, "score": 0, "last_activity_date": 1451748731, "creation_date": 1451748731, "answer_id": 34567547, "question_id": 34567190, "link": "https://stackoverflow.com/questions/34567190/why-gldrawarrays-fails-with-gl-invalid-operation/34567547#34567547", "title": "Why glDrawArrays fails with GL_INVALID_OPERATION?", "body": "<pre><code>C.glEnableClientState(GL_VERTEX_ARRAY);\nC.glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 0, (unsafe.Pointer)(&amp;vertices));\n</code></pre>\n\n<p><code>glVertexPointer</code> and <code>glVertexAttribPointer</code> are not the same function. If you're using old \"client state\" vertex arrays, then you meant <code>glVertexPointer</code>. <code>glVertexAttribPointer</code> is for doing shader-based rendering.</p>\n"}], "owner": {"reputation": 241, "user_id": 3318040, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/5b295dd3671f965c2ad052d2b6956ea9?s=128&d=identicon&r=PG&f=1", "display_name": "Gippeumi", "link": "https://stackoverflow.com/users/3318040/gippeumi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 389, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451781943, "creation_date": 1451746235, "last_edit_date": 1495535301, "question_id": 34567190, "link": "https://stackoverflow.com/questions/34567190/why-gldrawarrays-fails-with-gl-invalid-operation", "title": "Why glDrawArrays fails with GL_INVALID_OPERATION?", "body": "<p>I am using OpenGL to draw a rectangle, and I am doing this with golang.</p>\n\n<p>I am not using red, green, blue argument for now.</p>\n\n<pre><code>var vertices = []float64{ \n    -1.0, -1.0,  0.0,   // V1 - bottom left \n    -1.0,  1.0,  0.0,   // V2 - top left \n    1.0, -1.0,  0.0,    // V3 - bottom right \n    1.0,  1.0,  0.0,    // V4 - top right \n}\n\nfunc DisplayWrite(red []byte, green []byte, blue []byte) {\n    const GL_TRUE = 1\n    const GL_FALSE = 0\n    const GL_FLOAT = 0x1406\n    const GL_VERTEX_ARRAY = 0x8074\n    const GL_TRIANGLE_STRIP = 0x0005\n    C.glLoadIdentity();\n    chkGlErr(\"glLoadIdentity\")\n    C.glTranslatef(0.0, 0.0, -5.0);\n    chkGlErr(\"glTranslatef\")\n    C.glEnableClientState(GL_VERTEX_ARRAY);\n    chkGlErr(\"glEnableClientState\")\n    C.glColor4f(1.0, 1.0, 1.0, 1.0);\n    chkGlErr(\"glColor4f\")\n    C.glVertexPointer(3, GL_FLOAT, 0, (unsafe.Pointer)(&amp;vertices));\n    chkGlErr(\"glVertexPointer\")\n    C.glDrawArrays(GL_TRIANGLE_STRIP, 0, (C.GLsizei)(len(vertices) / 3));\n    chkGlErr(\"glDrawArrays\")\n    C.glDisableClientState(GL_VERTEX_ARRAY);\n    chkGlErr(\"glDisableClientState\")\n    const GL_UNSIGNED_BYTE = 0x1401\n    //C.glDrawPixels(Width, Height, GL_RED, GL_UNSIGNED_BYTE, &amp;red[0])\n    //C.glDrawPixels(Width, Height, GL_GREEN, GL_UNSIGNED_BYTE, &amp;green[0])\n    //C.glDrawPixels(Width, Height, GL_GREEN, GL_UNSIGNED_BYTE, &amp;blue[0])\n}\n</code></pre>\n\n<p>Problem is when I call glDrawArrays like this:</p>\n\n<pre><code>C.glDrawArrays(GL_TRIANGLE_STRIP, 0, (C.GLsizei)(len(vertices) / 3));\n</code></pre>\n\n<p>It draws nothing and error is GL_INVALID_OPERATION.\nIs something wrong with the way I draw something?</p>\n\n<p>This is setup part:</p>\n\n<pre><code>func DisplayInit() DispInitStatus {\n    //(EGL and OpenGL ES initialization codes...)\n\n    C.glViewport(0, 0, (C.GLsizei)(dWidth), (C.GLsizei)(dHeight));\n    chkGlErr(\"glViewport\")\n    C.glMatrixMode(GL_PROJECTION);\n    chkGlErr(\"glMatrixMode\")\n    C.glLoadIdentity();\n    chkGlErr(\"glLoadIdentity\")\n\n    makeFrustum(45.0, (float64)(dWidth) / (float64)(dHeight), 0.1, 100.0)\n\n    C.glMatrixMode(GL_MODELVIEW);\n    chkGlErr(\"glMatrixMode\")\n    C.glLoadIdentity();\n    chkGlErr(\"glLoadIdentity\")\n\n    //C.glHint(GL_PERSPECTIVE_CORRECTION_HINT, GL_NICEST);\n    //chkGlErr(\"glHint\")\n    C.glClearColor(1.0, 0.0, 0.0, 1.0);\n    chkGlErr(\"glClearColor\")\n    C.glClear(GL_COLOR_BUFFER_BIT);\n    chkGlErr(\"glClear\")\n    fmt.Println(\"EGL/GLES is now ready\")\n    return Disp_Ok\n    //No error with these.\n}\n</code></pre>\n\n<p>And main function</p>\n\n<p>(DisplayUpdate does glFlush and eglSwapBuffers. It works with no problem.)</p>\n\n<pre><code>func main() {\n    runtime.LockOSThread()\n    DisplayInit()\n    red := make([]byte, dWidth*dHeight)\n    gre := make([]byte, dWidth*dHeight)\n    blu := make([]byte, dWidth*dHeight)\n    DisplayWrite(red, gre, blu)\n    DisplayUpdate()\n    for {\n    }\n}\n</code></pre>\n\n<p>I googled and found this:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/13051587/why-does-opengls-gldrawarrays-fail-with-gl-invalid-operation-under-core-profi\">Why does OpenGL&#39;s glDrawArrays() fail with GL_INVALID_OPERATION under Core Profile 3.2, but not 3.3 or 4.2?</a></p>\n\n<p>And I tried using runtime.LockOSThread() like above, but still doesn't work.</p>\n\n<p>ADD: Added makeFrustum.</p>\n\n<pre><code>func makeFrustum(fovY, aspectRatio, front, back float64) {\n    tangent := math.Tan(fovY / 2 * (3.14159265 / 180.0));   // tangent of half fovY\n    height := front * tangent;          // half height of near plane\n    width := height * aspectRatio;      // half width of near plane\n    // params: left, right, bottom, top, near, far\n    C.glFrustumf((C.GLfloat)(-width), (C.GLfloat)(width), (C.GLfloat)(-height), (C.GLfloat)(height), (C.GLfloat)(front), (C.GLfloat)(back));\n    chkGlErr(\"glFrustumf\")\n}\n</code></pre>\n\n<p>This causes no error, too.</p>\n\n<p>This does same thing as gluPerspective.</p>\n\n<p><a href=\"https://www.opengl.org/sdk/docs/man2/xhtml/gluPerspective.xml\" rel=\"nofollow noreferrer\">https://www.opengl.org/sdk/docs/man2/xhtml/gluPerspective.xml</a></p>\n"}, {"tags": ["struct", "go", "initialization"], "answers": [{"comments": [{"owner": {"reputation": 1741, "user_id": 10996, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a85c5ff020f9699080bccc5cb845efbf?s=128&d=identicon&r=PG&f=1", "display_name": "talonx", "link": "https://stackoverflow.com/users/10996/talonx"}, "edited": false, "score": 0, "creation_date": 1451734919, "post_id": 34565332, "comment_id": 56874593, "body": "Perfect, I was looking for such an idiom if there was no inbuilt way."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1451733908, "creation_date": 1451733908, "answer_id": 34565332, "question_id": 34565202, "link": "https://stackoverflow.com/questions/34565202/setting-the-initial-value-of-a-struct-field-to-that-of-another-in-go/34565332#34565332", "title": "Setting the initial value of a struct field to that of another in Go", "body": "<p>You can't avoid having to specify the value twice, but an idiomatic way would be to create a constructor-like creator function for it:</p>\n\n<pre><code>func NewJob(time int) Job {\n    return Job{totalTime: time, timeToCompletion: time}\n}\n</code></pre>\n\n<p>And using it you only have to specify the time value once when passing it to our <code>NewJob()</code> function:</p>\n\n<pre><code>j := NewJob(10)\n</code></pre>\n"}], "owner": {"reputation": 1741, "user_id": 10996, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a85c5ff020f9699080bccc5cb845efbf?s=128&d=identicon&r=PG&f=1", "display_name": "talonx", "link": "https://stackoverflow.com/users/10996/talonx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 540, "favorite_count": 0, "accepted_answer_id": 34565332, "answer_count": 1, "score": 6, "last_activity_date": 1451740357, "creation_date": 1451733095, "last_edit_date": 1451740357, "question_id": 34565202, "link": "https://stackoverflow.com/questions/34565202/setting-the-initial-value-of-a-struct-field-to-that-of-another-in-go", "title": "Setting the initial value of a struct field to that of another in Go", "body": "<p>In Go, let's say I have this struct:</p>\n\n<pre><code>type Job struct {\n    totalTime int\n    timeToCompletion int\n}\n</code></pre>\n\n<p>and I initialize a struct object like:</p>\n\n<pre><code>j := Job {totalTime : 10, timeToCompletion : 10}\n</code></pre>\n\n<p>where the constraint is that <code>timeToCompletion</code> is always equal to <code>totalTime</code> when the struct is created (they can change later). Is there a way to achieve this in Go so that I don't have to initialize both fields?</p>\n"}, {"tags": ["go", "cron"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451740905, "post_id": 34565070, "comment_id": 56876279, "body": "Functions that use time durations are monotonic, and you can&#39;t speed them up by changing the system time (which can always cause other unexpected problems). If the program is in a timer or sleep, it has no way of knowing that the system time changed."}, {"owner": {"reputation": 595, "user_id": 5443590, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/8c3c26c54f6d700cd85d73e1f0cc4b5f?s=128&d=identicon&r=PG&f=1", "display_name": "GKV", "link": "https://stackoverflow.com/users/5443590/gkv"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1451985215, "post_id": 34565070, "comment_id": 56960888, "body": "does i am doing any thing wrong ,or it will work fine in production ,I am doing right or not the SPECIFICATION i am passing to ADDFUN is correct or not ."}, {"owner": {"reputation": 9424, "user_id": 1248913, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ced76ce8952257b480f8b1c96ab0a79?s=128&d=identicon&r=PG", "display_name": "Roy Lee", "link": "https://stackoverflow.com/users/1248913/roy-lee"}, "edited": false, "score": 0, "creation_date": 1465890461, "post_id": 34565070, "comment_id": 63076446, "body": "perhaps you could refer to this minimalist cron go-package: <a href=\"https://github.com/roylee0704/gron\" rel=\"nofollow noreferrer\">github.com/roylee0704/gron</a>"}], "answers": [{"comments": [{"owner": {"reputation": 595, "user_id": 5443590, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/8c3c26c54f6d700cd85d73e1f0cc4b5f?s=128&d=identicon&r=PG&f=1", "display_name": "GKV", "link": "https://stackoverflow.com/users/5443590/gkv"}, "edited": false, "score": 0, "creation_date": 1456383220, "post_id": 34567841, "comment_id": 58923165, "body": "i Overcome with that problem by just adding another job which run frequently ,like every 2min or 5 min, then  after changing system time i am able to  test jobs after 24H,48H,72H etc."}], "tags": [], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "is_accepted": false, "score": 5, "last_activity_date": 1451750975, "last_edit_date": 1451750975, "creation_date": 1451750844, "answer_id": 34567841, "question_id": 34565070, "link": "https://stackoverflow.com/questions/34565070/cron-golang-running-after-every-24-hour/34567841#34567841", "title": "cron golang running after every 24 Hour?", "body": "<p>This is not how cron works. Cron won't run overdue tasks when you change system time. Think what would happen if it worked that way and you turned your machine on after 2 days with job scheduled to run every 5 minutes. If you really want to test it that way you should change the system time to a time just before your job is supposed to run and wait to see if it does.</p>\n\n<p>Personally I think that it's a better idea to pass hour and minute as parameters and check if the job is running on next minute or something.</p>\n"}], "owner": {"reputation": 595, "user_id": 5443590, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/8c3c26c54f6d700cd85d73e1f0cc4b5f?s=128&d=identicon&r=PG&f=1", "display_name": "GKV", "link": "https://stackoverflow.com/users/5443590/gkv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1423, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1452103122, "creation_date": 1451732019, "last_edit_date": 1451739346, "question_id": 34565070, "link": "https://stackoverflow.com/questions/34565070/cron-golang-running-after-every-24-hour", "title": "cron golang running after every 24 Hour?", "body": "<p><code>cron</code> golang is running after every 24 hours but when I am trying to change the system time, it is not invoking.</p>\n\n<h2>code:</h2>\n\n<pre><code>package main;\n\nimport(\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n    \"gopkg.in/robfig/cron.v2\"\n    \"time\"\n    )\n\nfunc Envoke_ASSET_INFO() {    \n    fmt.Println(\"Invoking Envoke_ASSET_INFO \", time.Now())\n}\n\nfunc main(){\n    C:=cron.New()\n\n    min:=strconv.Itoa(int(17))\n    h:=strconv.Itoa(int(16))\n\n    sep:=\"0\"+\" \"+min+\" \"+h+\" \"+\"*\"+\" \"+\"*\"+\" \"+\"*\"\n    fmt.Println(\"SPECIFATION PASSED TO FUNCTION :\", sep)    \n    C.AddFunc(sep, Envoke_ASSET_INFO )\n    C.Start()\n    select{}\n}\n</code></pre>\n\n<p>When I am running this program it is evoking my function. But when I change my system time (+24 hours) to check the next evoking it is not happening.</p>\n"}, {"tags": ["mysql", "go"], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": true, "score": 3, "last_activity_date": 1451717582, "creation_date": 1451717582, "answer_id": 34563442, "question_id": 34563303, "link": "https://stackoverflow.com/questions/34563303/golang-mysql-undefined-sql-query/34563442#34563442", "title": "golang mysql undefined: sql.Query", "body": "<p>Look at the <a href=\"https://golang.org/pkg/database/sql/#example_DB_Query\" rel=\"nofollow\">documentation</a>. <code>Open</code> returns a \"pointer to a database\", <code>Query</code> is a method that uses this pointer (and not sql). So you need to do something like this:</p>\n\n<pre><code>db, err := sql.Open(\"mysql\", \"dbaccess:dbaccess@/dbaccess\")\nif err != nil {\n    panic(err.Error())\n}\ndefer rows.Close()\n\nrows, err := db.Query(\"select * from people where id = ?\", 1)\nif err != nil {\n    panic(err.Error())\n}\ndefer rows.Close()\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 5645343, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/aceafcadfded241dc64799a0a326cf83?s=128&d=identicon&r=PG&f=1", "display_name": "batflaps", "link": "https://stackoverflow.com/users/5645343/batflaps"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2822, "favorite_count": 0, "accepted_answer_id": 34563442, "answer_count": 1, "score": 1, "last_activity_date": 1451717582, "creation_date": 1451716420, "question_id": 34563303, "link": "https://stackoverflow.com/questions/34563303/golang-mysql-undefined-sql-query", "title": "golang mysql undefined: sql.Query", "body": "<p>I'm trying to do a golang db query like:</p>\n\n<pre><code>package main\nimport \"fmt\"\nimport \"database/sql\"\nimport _ \"github.com/go-sql-driver/mysql\"\n\nvar (\n    name string\n    id int\n    age int\n)\n\nfunc main() {\n    rows, err := sql.Open(\"mysql\", \"dbaccess:dbaccess@/dbaccess\")\n    if err != nil {\n        panic(err.Error())\n    }\n    defer rows.Close()\n\n    rows, err = sql.Query(\"select * from people where id = ?\", 1)\n    if err != nil {\n        panic(err.Error())\n    }\n    defer rows.Close()\n\n    for rows.Next() {\n        err := rows.Scan(&amp;id, &amp;name)\n        if err != nil {\n        panic(err.Error())\n        }\n        fmt.Println(id, name)\n    }\n    err = rows.Err()\n    if err != nil {\n        panic(err.Error())\n}\n\n}\n</code></pre>\n\n<p>But I get the error:</p>\n\n<pre><code>20: undefined: sql.Query\n</code></pre>\n\n<p>I tried to put a colon before = but then got an error:</p>\n\n<pre><code>20: no new variables on left side of :=\n</code></pre>\n\n<p>what am I missing? I know there are other errors in the code, but just trying to debug/learn as I go.</p>\n"}, {"tags": ["go", "compiler-errors", "dynamic-compilation"], "comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1451718918, "post_id": 34562242, "comment_id": 56870646, "body": "Is <a href=\"https://github.com/golang/go/wiki/GccgoCrossCompilation#build-1\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/GccgoCrossCompilation#build-1</a> relevant here? And what versiob of gcc do you have (as in <a href=\"http://grokbase.com/t/gg/golang-nuts/159cbsm8mg/go-nuts-building-goarch-386-c-shared-library-using-gccgo\" rel=\"nofollow noreferrer\">grokbase.com/t/gg/golang-nuts/159cbsm8mg/&hellip;</a>)"}, {"owner": {"reputation": 11, "user_id": 5737198, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-g3_uVFHEuH8/AAAAAAAAAAI/AAAAAAAAABE/4WES2Lg3GOM/photo.jpg?sz=128", "display_name": "Mostafa Dahab", "link": "https://stackoverflow.com/users/5737198/mostafa-dahab"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 1, "creation_date": 1451765416, "post_id": 34562242, "comment_id": 56884938, "body": "I have realized the gccgo isn&#39;t supported on Windows yet, so I have tried xgo not working, my gcc version is 4.8.4"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1451766177, "post_id": 34562242, "comment_id": 56885195, "body": "That version seems way too old to support the latest go version needed for cross-compilation."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1451813032, "post_id": 34562242, "comment_id": 56894673, "body": "So what&#39;s the problem, if it compiles fine (without the use of -compiler) the binary should still run just fine from your first build without the compiler flag you should be able to just run that file on Windows?"}, {"owner": {"reputation": 11, "user_id": 5737198, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-g3_uVFHEuH8/AAAAAAAAAAI/AAAAAAAAABE/4WES2Lg3GOM/photo.jpg?sz=128", "display_name": "Mostafa Dahab", "link": "https://stackoverflow.com/users/5737198/mostafa-dahab"}, "reply_to_user": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1451967294, "post_id": 34562242, "comment_id": 56953692, "body": "@Datsik I can compile to windows successfully, but I can&#39;t dynamically compile to windows"}, {"owner": {"reputation": 11, "user_id": 5737198, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-g3_uVFHEuH8/AAAAAAAAAAI/AAAAAAAAABE/4WES2Lg3GOM/photo.jpg?sz=128", "display_name": "Mostafa Dahab", "link": "https://stackoverflow.com/users/5737198/mostafa-dahab"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1451967319, "post_id": 34562242, "comment_id": 56953701, "body": "@VonC what is the version I need to compile to windows ?"}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1451969696, "post_id": 34562242, "comment_id": 56954351, "body": "@MostafaDahab ok. You should fix your question title and body then because it&#39;s misleading."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1451971257, "post_id": 34562242, "comment_id": 56954849, "body": "@MostafaDahab the most recent version you can find. 5+."}, {"owner": {"reputation": 11, "user_id": 5737198, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-g3_uVFHEuH8/AAAAAAAAAAI/AAAAAAAAABE/4WES2Lg3GOM/photo.jpg?sz=128", "display_name": "Mostafa Dahab", "link": "https://stackoverflow.com/users/5737198/mostafa-dahab"}, "reply_to_user": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1452094099, "post_id": 34562242, "comment_id": 57018566, "body": "@Datsik if you read the title &quot;error with dynamic compile golang&quot; npt &quot;error with compile golang&quot; there is &quot;Dynamic&quot;"}, {"owner": {"reputation": 11, "user_id": 5737198, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-g3_uVFHEuH8/AAAAAAAAAAI/AAAAAAAAABE/4WES2Lg3GOM/photo.jpg?sz=128", "display_name": "Mostafa Dahab", "link": "https://stackoverflow.com/users/5737198/mostafa-dahab"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1453201002, "post_id": 34562242, "comment_id": 57487811, "body": "@VonC I have tried with the latest gcc5 same issue"}], "owner": {"reputation": 11, "user_id": 5737198, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-g3_uVFHEuH8/AAAAAAAAAAI/AAAAAAAAABE/4WES2Lg3GOM/photo.jpg?sz=128", "display_name": "Mostafa Dahab", "link": "https://stackoverflow.com/users/5737198/mostafa-dahab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 921, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1451707029, "creation_date": 1451704498, "last_edit_date": 1451707029, "question_id": 34562242, "link": "https://stackoverflow.com/questions/34562242/error-with-dynamic-compile-golang", "title": "error with dynamic compile golang", "body": "<p>i'm trying to dynamically compile go file for windows in linux host my code:</p>\n\n<pre><code>package main\nimport \"fmt\"\nfunc main() {\n    fmt.Println(\"Hello, \u4e16\u754c\")\n}\n</code></pre>\n\n<p>when i'm trying to compile:</p>\n\n<pre><code>root@vm:/home/ubuntu/workspace# echo $GOROOT\n/opt/go\nroot@vm:/home/ubuntu/workspace# echo $GOPATH\n/home/ubuntu/workspace/\nroot@vm:/home/ubuntu/workspace# go build // works !\nroot@vm:/home/ubuntu/workspace# go build -compiler gccgo // works !\nroot@vm:/home/ubuntu/workspace# ls -sh workspace \n28K workspace\nroot@vm:/home/ubuntu/workspace# GOOS=windows GOARCH=386 go build // works !\nroot@vm:/home/ubuntu/workspace# GOOS=windows GOARCH=386 go build -compiler gccgo\n# _/home/ubuntu/workspace\n./main.go:2:11: error: import file \u2018fmt\u2019 not found\n import \"fmt\"\n           ^\n./main.go:4:2: error: reference to undefined name \u2018fmt\u2019\n  fmt.Println(\"Hello, \u4e16\u754c\")\n  ^\nroot@vm:/home/ubuntu/workspace# \n</code></pre>\n\n<p>also in windows there is error:</p>\n\n<pre><code>C:\\Users\\vm\\Documents\\aatest&gt;go build -compiler gccgo\ngo build _/C_/Users/vm/Documents/aatest: : exec: \"C:\\\\Users\\\\vm\\\\Documents\\\\aatest\": file does not exist\n\nC:\\Users\\vm\\Documents\\aatest&gt;go build main.go -compiler gccgo\nnamed files must be .go files\n</code></pre>\n\n<p>help with any platform will be fine</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1451692791, "post_id": 34561226, "comment_id": 56866179, "body": "Your code might have a race on connection.disconnecting.  Run with the race detector.  I think your best bet is to <a href=\"https://godoc.org/github.com/dancannon/gorethink#Connection.Close\" rel=\"nofollow noreferrer\">close the underlying network connection</a> to the database.  This should cause Next to return immedidatly with an error."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1451692913, "post_id": 34561226, "comment_id": 56866212, "body": "@CodingPickle I&#39;ve been using one connection for basically everything, I don&#39;t know if that is good or bad practice. So if I .close I think every other connection would be affected No race conditions either btw from what I can see using --race"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1451694418, "post_id": 34561226, "comment_id": 56866532, "body": "I suspected a race because I assumed that <code>c.disconnecting = true</code> is executed from a different goroutine from the goroutine than the one that executes ` if c.disconnecting {`."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1451694628, "post_id": 34561226, "comment_id": 56866568, "body": "@CodingPickle there actually may be but that&#39;s not my biggest concern at the moment :)"}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1451702781, "post_id": 34561226, "comment_id": 56867917, "body": "@CodingPickle Thanks for the <code>res.Close()</code> suggestion, I&#39;ve posted an answer and gave you credit, I would just delete it normally after finding an answer without one being posted here yet but <code>Go</code> seems to need all the Q&amp;A it can get from my experience x.x"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1451705341, "post_id": 34561226, "comment_id": 56868275, "body": "The code as written handles breaking out of a loop when the condition is detected.  The issue is that Next blocks. I suggest changing the title to &quot;how to break out of rethinkdb&#39;s Next&quot; or something similar."}], "answers": [{"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 0, "last_activity_date": 1451702735, "creation_date": 1451702735, "answer_id": 34562102, "question_id": 34561226, "link": "https://stackoverflow.com/questions/34561226/how-to-stop-rethinkdbs-next-changes/34562102#34562102", "title": "How to stop rethinkdbs Next (.Changes())", "body": "<p>So I came up with a solution, which seems to work fine using a suggestion from @CodingPickle, in a nutshell, run the for loop in its own goroutine and then do <code>res.Close()</code> when its done watching.</p>\n\n<pre><code>func (c *connection) watchUsers() {\n    db := common.DB()\n    query := gorethink.Table(\"Users\").Filter(map[string]interface{}{\n        \"online\": 1,\n    }).Changes(gorethink.ChangesOpts{\n        IncludeInitial: true,\n    })\n    res, err := query.Run(db)\n    if err != nil {\n        log.Println(err)\n    }\n\n    go func(res *gorethink.Cursor, c *connection) {\n        defer res.Close()\n        var users interface{}\n        for res.Next(&amp;users) {\n            usersNewMap := users.(map[string]interface{})[\"new_val\"]\n            user := usersNewMap.(map[string]interface{})\n            c.send &lt;- wsMsg{\n                \"user add\",\n                map[string]interface{}{\n                    \"username\": user[\"username\"].(string),\n                    \"uuid\":     user[\"id\"].(string),\n                },\n            }\n        }\n        log.Println(\"Ended gracefully\")\n    }(res, c)\n\n    select {\n    case &lt;-c.disconnecting:\n        res.Close()\n        break\n    case &lt;-c.stopWatchingUsers:\n        res.Close()\n        break\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1451705446, "creation_date": 1451692092, "last_edit_date": 1451705446, "question_id": 34561226, "link": "https://stackoverflow.com/questions/34561226/how-to-stop-rethinkdbs-next-changes", "title": "How to stop rethinkdbs Next (.Changes())", "body": "<p>I am currently using <code>RethinkDB</code> in my app because of their real time event driven data. I currently have this watch function that checks for users that are online:</p>\n\n<pre><code>func (c *connection) watchUsers() {\n    db := common.DB()\n    query := gorethink.Table(\"Users\").Filter(map[string]interface{}{\n        \"online\": 1,\n    }).Changes(gorethink.ChangesOpts{\n        IncludeInitial: true,\n    })\n    res, err := query.Run(db)\n    if err != nil {\n        log.Println(err)\n    }\n    defer res.Close()\n    var users interface{}\n    for res.Next(&amp;users) {\n        if c.disconnecting {\n            break\n        }\n        usersNewMap := users.(map[string]interface{})[\"new_val\"]\n        user := usersNewMap.(map[string]interface{})\n        log.Println(user[\"username\"])\n        c.ws.WriteJSON(wsMsg{\n            \"user add\",\n            map[string]interface{}{\n                \"username\": user[\"username\"].(string),\n                \"uuid\":     user[\"id\"].(string),\n            },\n        })\n    }\n    log.Println(\"Ended on disconnect\")\n}\n</code></pre>\n\n<p>The only problem is I need the <code>watchUsers</code> function to return when the websocket disconnects. Right now I have </p>\n\n<pre><code>defer func() {\n   c.disconnecting = true\n}()\n</code></pre>\n\n<p>in the websocket its self which then when the watch tries to get more data on another announcement, it then will break the loop and end the goroutine. The only problem is what if there is no data to be broadcasted for a while and now this goroutine just hangs out for a while taking up unnecessary space. So my question is, how can I break this for loop with some sort of event driven method, it would be easier if I could just have <code>res.Next</code> be a channel because then I could use a select but this is not the case.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1451689318, "post_id": 34560833, "comment_id": 56865425, "body": "@CodingPickle answered this question just before I did, so if you&#39;re going to accept an answer, take his/hers."}], "answers": [{"comments": [{"owner": {"reputation": 7906, "user_id": 244009, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bd8e93613dba2b3b39c97afd6d065279?s=128&d=identicon&r=PG", "display_name": "codefx", "link": "https://stackoverflow.com/users/244009/codefx"}, "edited": false, "score": 0, "creation_date": 1451689311, "post_id": 34560873, "comment_id": 56865422, "body": "Thanks for the reply. This is a neat trick."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 9, "last_activity_date": 1451689006, "creation_date": 1451689006, "answer_id": 34560873, "question_id": 34560833, "link": "https://stackoverflow.com/questions/34560833/what-does-this-golang-code-do/34560873#34560873", "title": "What does this golang code do?", "body": "<p>This line is a compile time check that <a href=\"https://github.com/digitalocean/godo/blob/2688c11a02dc3deac65645c82c3c812f95e417bf/droplets.go#L28\" rel=\"noreferrer\">*DropletsServiceOp</a> satisfies the <a href=\"https://github.com/digitalocean/godo/blob/2688c11a02dc3deac65645c82c3c812f95e417bf/droplets.go#L13-L24\" rel=\"noreferrer\">DropletsService</a> interface.</p>\n\n<p>The line has no effect on the execution of the program.</p>\n"}, {"tags": [], "owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "is_accepted": false, "score": 3, "last_activity_date": 1451689079, "creation_date": 1451689079, "answer_id": 34560885, "question_id": 34560833, "link": "https://stackoverflow.com/questions/34560833/what-does-this-golang-code-do/34560885#34560885", "title": "What does this golang code do?", "body": "<p>If you look at the blame on that file, at that line, you get a clue:</p>\n\n<p><a href=\"https://github.com/digitalocean/godo/blame/master/droplets.go#L32\" rel=\"nofollow\">https://github.com/digitalocean/godo/blame/master/droplets.go#L32</a></p>\n\n<p>It does a compile-time check that <code>*DropletsServiceOp</code> satisfies the <code>DropletsService</code> interface.  Prior to the commit introducing that, they were doing this in their test suite.</p>\n"}], "owner": {"reputation": 7906, "user_id": 244009, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bd8e93613dba2b3b39c97afd6d065279?s=128&d=identicon&r=PG", "display_name": "codefx", "link": "https://stackoverflow.com/users/244009/codefx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "closed_date": 1511567128, "accepted_answer_id": 34560873, "answer_count": 2, "score": 4, "last_activity_date": 1451689079, "creation_date": 1451688688, "question_id": 34560833, "link": "https://stackoverflow.com/questions/34560833/what-does-this-golang-code-do", "closed_reason": "Duplicate", "title": "What does this golang code do?", "body": "<p>I was reading DigitalOcean's golang client. I noticed that they create an instance of their *Op struct in a <code>_</code> variable. Example: \n<a href=\"https://github.com/digitalocean/godo/blob/master/droplets.go#L32\" rel=\"nofollow\">https://github.com/digitalocean/godo/blob/master/droplets.go#L32</a></p>\n\n<pre><code>var _ DropletsService = &amp;DropletsServiceOp{}\n</code></pre>\n\n<p>Why is this line needed? </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": false, "score": 0, "last_activity_date": 1451671808, "creation_date": 1451671808, "answer_id": 34558668, "question_id": 34558579, "link": "https://stackoverflow.com/questions/34558579/accessing-json-properties-when-not-using-struct/34558668#34558668", "title": "Accessing JSON properties when not using struct", "body": "<p>If you just happen to have fields that may not be specified, you can unmarshal your input into a struct with pointer. If the field isn't present, the pointer will be <code>nil</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Foo struct {\n    A *string\n    B *string\n    C *int\n}\n\nfunc main() {\n    var input string = `{\"A\": \"a\",\"C\": 3}`\n    var foo Foo\n    json.Unmarshal([]byte(input), &amp;foo)\n    fmt.Printf(\"%#v\\n\", foo)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/MkNCmM1IVp\" rel=\"nofollow\">Playground</a></p>\n\n<p>If you really want something more flexible, you can also unmarshal your input into a <code>map[string]interface{}</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    var input string = `{\"A\": \"a\",\"C\": 3}`\n    var foo map[string]interface{} = make(map[string]interface{})\n    json.Unmarshal([]byte(input), &amp;foo)\n    fmt.Printf(\"%#v\\n\", foo)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/YeSzrcXfyt\" rel=\"nofollow\">Playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1451672754, "post_id": 34558691, "comment_id": 56860987, "body": "Silly question but how do I access just one specific property. I&#39;ve tried <code>result.name</code> but this produce an error"}, {"owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1451672998, "post_id": 34558691, "comment_id": 56861069, "body": "@tommyd456: <code>result[&quot;name&quot;]</code>."}, {"owner": {"reputation": 23431, "user_id": 719363, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/76ca4397a6ec4aa8fcf85dc53e1cbab6?s=128&d=identicon&r=PG", "display_name": "Alex Gitelman", "link": "https://stackoverflow.com/users/719363/alex-gitelman"}, "edited": false, "score": 2, "creation_date": 1451675799, "post_id": 34558691, "comment_id": 56861819, "body": "Also you don&#39;t need to have separate cast, you can just do <code>var result map[string]interface{}</code> and use it in <code>Unmarshal</code>. Here is an example: <a href=\"http://play.golang.org/p/QeL8lIinQf\" rel=\"nofollow noreferrer\">play.golang.org/p/QeL8lIinQf</a>"}], "tags": [], "owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "is_accepted": true, "score": 5, "last_activity_date": 1451671947, "creation_date": 1451671947, "answer_id": 34558691, "question_id": 34558579, "link": "https://stackoverflow.com/questions/34558579/accessing-json-properties-when-not-using-struct/34558691#34558691", "title": "Accessing JSON properties when not using struct", "body": "<p>You can unmarshal it into an <code>interface{}</code>. If you do that, <code>json.Unmarshal</code> will unmarshal a JSON object into a Go map.</p>\n\n<p>For example:</p>\n\n<pre><code>var untypedResult interface{}\nerr := json.Unmarshal(..., &amp;untypedResult)\n\nresult := untypedResult.(map[string]interface{})\n\n// ... now you can iterate over the keys and values of result ...\n</code></pre>\n\n<p>See &lt;<a href=\"http://blog.golang.org/json-and-go#TOC_5.\">http://blog.golang.org/json-and-go#TOC_5.</a>&gt; for a complete example.</p>\n"}, {"tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": false, "score": 0, "last_activity_date": 1451671994, "creation_date": 1451671994, "answer_id": 34558696, "question_id": 34558579, "link": "https://stackoverflow.com/questions/34558579/accessing-json-properties-when-not-using-struct/34558696#34558696", "title": "Accessing JSON properties when not using struct", "body": "<p>When unmarshalling a JSON document, not all properties that are defined in the struct need to be present in the JSON document. In your example, you could define the following struct:</p>\n\n<pre><code>type MyJson struct {\n    Name string `json:\"name\"`\n    Town string `json:\"town\"`\n    Email string `json:\"email\"`\n}\n</code></pre>\n\n<p>When your use this struct to unmarshal a JSON document that has one or more of these properties missing, they will be initialized with the respective type's null value (an empty string for <code>string</code> properties).</p>\n\n<hr>\n\n<p><strong>Alternatively</strong>, you can use the generic <code>interface{}</code> type for unmarshalling and then use type assertions. This is documented in-depth in the <a href=\"http://blog.golang.org/json-and-go\" rel=\"nofollow\">blog post \"JSON and GO\"</a>:</p>\n\n<pre><code>var jsonDocument interface{}\n\nerr := json.Unmarshal(jsonString, &amp;jsonDocument)\nmap := jsonDocument.(map[string]interface{})\ntown := map[\"town\"].(string);\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 34558691, "answer_count": 3, "score": 0, "last_activity_date": 1451671994, "creation_date": 1451671107, "question_id": 34558579, "link": "https://stackoverflow.com/questions/34558579/accessing-json-properties-when-not-using-struct", "title": "Accessing JSON properties when not using struct", "body": "<p>I have some JSON and I need to be able to access the properties. As the JSON properties can vary I can't create a <code>struct</code> to unmarshal into.</p>\n\n<p><strong>Example</strong></p>\n\n<p>The JSON could be this:</p>\n\n<pre><code>{\"name\" : \"John Doe\", \"email\" : \"john@doe.com\"}\n</code></pre>\n\n<p>or this:</p>\n\n<pre><code>{\"town\" : \"Somewhere\", \"email\" : \"john@doe.com\"}\n</code></pre>\n\n<p>or anything else.</p>\n\n<p>How can I access each of the properties?</p>\n"}, {"tags": ["templates", "go", "assets"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1451674917, "post_id": 34558551, "comment_id": 56861634, "body": "In Go, you could traverse your assets dir on application startup and output hashed filenames into (e.g.) <code>&#47;public&#47;dist</code> - whilst also generating a map of the original filename (key) and the hashed filename (value) that you apply as a <code>template.FuncMap</code> when initializing templates. Have the funcmap take the string argument and replace it with the hash - e.g. <code>{{ hashed &quot;style.css&quot; }}</code> becomes <code>&#47;public&#47;dist&#47;stylesheet-d861367de2.css</code> after the funcmap is applied. Alternatively, use a JS tool like webpack to compile SASS/uglify JS, generate a manifest and have your Go program read the manifest."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1451674931, "post_id": 34558551, "comment_id": 56861639, "body": "(A good example can be found here: <a href=\"https://github.com/runemadsen/ok-go/blob/fd17a2ccd485c935d20407347ca79057aa43ceab/config/assets.go\" rel=\"nofollow noreferrer\">github.com/runemadsen/ok-go/blob/&hellip;</a> + related code)"}, {"owner": {"reputation": 632, "user_id": 1879976, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o8Fh4.png?s=128&g=1", "display_name": "pram", "link": "https://stackoverflow.com/users/1879976/pram"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451687673, "post_id": 34558551, "comment_id": 56864990, "body": "very nice, thank you. that example is helpful"}], "answers": [{"comments": [{"owner": {"reputation": 632, "user_id": 1879976, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o8Fh4.png?s=128&g=1", "display_name": "pram", "link": "https://stackoverflow.com/users/1879976/pram"}, "edited": false, "score": 0, "creation_date": 1451687724, "post_id": 34559119, "comment_id": 56865000, "body": "this works great! do you know if theres a trivial way to get the newest (modified) file? or do i have to stat everything"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1451676021, "last_edit_date": 1451676021, "creation_date": 1451675166, "answer_id": 34559119, "question_id": 34558551, "link": "https://stackoverflow.com/questions/34558551/automatic-asset-revision-filenames-in-go-html-templates/34559119#34559119", "title": "Automatic asset revision filenames in Go HTML templates", "body": "<p>Write a <a href=\"https://godoc.org/text/template#Template.Funcs\" rel=\"nofollow\">template function</a> to resolve the name.  Here's an example template function:</p>\n\n<pre><code>func resolveName(p string) (string, error) {\n  i := strings.LastIndex(p, \".\")\n  if i &lt; 0 {\n    i = len(p)\n  }\n  g := p[:i] + \"-*\" + p[i:]\n  matches, err := filepath.Glob(g)\n  if err != nil {\n    return \"\", err\n  }\n  if len(matches) != 1 {\n    return \"\", fmt.Errorf(\"%d matches for %s\", len(matches), p)\n  }\n  return matches[0], nil\n}\n</code></pre>\n\n<p>and here's how to use it in a template when registered as the function \"resolveName\":</p>\n\n<pre><code>&lt;link rel=\"stylesheet\" href=\"{{ .MyCssFile | resolveName }}\" /&gt;\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/SrOObPeiaa\" rel=\"nofollow\">playground example</a></kbd></p>\n\n<p>This function resolves the name of the file every time the template is rendered.  A more clever function might cache names as they are resolved or walk the directory tree at startup to prebuild a cache.</p>\n"}, {"tags": [], "owner": {"reputation": 93, "user_id": 236964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73d165a5cd45139879be2b1eeab94d2d?s=128&d=identicon&r=PG", "display_name": "Stephan Olmer", "link": "https://stackoverflow.com/users/236964/stephan-olmer"}, "is_accepted": false, "score": 0, "last_activity_date": 1565354472, "creation_date": 1565354472, "answer_id": 57430278, "question_id": 34558551, "link": "https://stackoverflow.com/questions/34558551/automatic-asset-revision-filenames-in-go-html-templates/57430278#57430278", "title": "Automatic asset revision filenames in Go HTML templates", "body": "<p>I knew it's too old, but maybe <a href=\"https://github.com/catcombo/go-staticfiles\" rel=\"nofollow noreferrer\">this library</a> will help you. It allows to collect and hash static files. Also it has function to reverse file path from the orignal location to the hashed location:</p>\n\n<pre><code>staticFilesPrefix := \"/static/\"\nstaticFilesRoot := \"output/dir\"\n\nstorage := NewStorage(staticFilesRoot)\nerr := storage.LoadManifest()\n\nfuncs := template.FuncMap{\n    \"static\": func(relPath string) string {\n        return staticFilesPrefix + storage.Resolve(relPath)\n    },\n}\ntmpl := template.Must(\n    template.New(\"\").Funcs(funcs).ParseFiles(\"templates/main.tpl\")\n)\n</code></pre>\n\n<p>Now you can call static function in templates like this <code>{{static \"css/style.css\"}}</code>. The call will be converted to <code>/static/css/style.d41d8cd98f00b204e9800998ecf8427e.css</code>.</p>\n"}], "owner": {"reputation": 632, "user_id": 1879976, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o8Fh4.png?s=128&g=1", "display_name": "pram", "link": "https://stackoverflow.com/users/1879976/pram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 569, "favorite_count": 0, "accepted_answer_id": 34559119, "answer_count": 2, "score": 2, "last_activity_date": 1565437289, "creation_date": 1451670881, "last_edit_date": 1592644375, "question_id": 34558551, "link": "https://stackoverflow.com/questions/34558551/automatic-asset-revision-filenames-in-go-html-templates", "title": "Automatic asset revision filenames in Go HTML templates", "body": "<p>I'm looking for help on implementing something that automatically includes versioned filenames in a Go HTML template. For example, in my template I have something like this in the head:</p>\n<pre><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;{{ .MyCssFile }}&quot; /&gt;\n</code></pre>\n<p>The stylesheets themselves have a chunk of MD5 hash appended to the name from a gulp script called gulp-rev</p>\n<pre><code>stylesheet-d861367de2.css\n</code></pre>\n<p>The purpose is to ensure new changes are picked up by browsers, but also allow caching. Here is an example implementation in Django for a better explanation:</p>\n<p><a href=\"https://docs.djangoproject.com/en/1.9/ref/contrib/staticfiles/#manifeststaticfilesstorage\" rel=\"nofollow noreferrer\">https://docs.djangoproject.com/en/1.9/ref/contrib/staticfiles/#manifeststaticfilesstorage</a></p>\n<blockquote>\n<p>A subclass of the StaticFilesStorage storage backend which stores the file names it handles by appending the MD5 hash of the file\u2019s content to the filename. For example, the file css/styles.css would also be saved as css/styles.55e7cbb9ba48.css.</p>\n<p>The purpose of this storage is to keep serving the old files in case some pages still refer to those files, e.g. because they are cached by you or a 3rd party proxy server. Additionally, it\u2019s very helpful if you want to apply far future Expires headers to the deployed files to speed up the load time for subsequent page visits.</p>\n</blockquote>\n<p>Now I'm wondering how to best pull this off in Go? I intend to serve the files from the built in <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\">file server</a>.</p>\n<p>My current thoughts are:</p>\n<ul>\n<li>Have a loop that checks for the newest stylesheet file in a directory. Sounds slow.</li>\n<li>Do some kind of redirect/rewrite to a generically named file (as in file.css is served on a request to file-hash.css).</li>\n<li>Have Go manage the asset naming itself, appending the hash or timestamp.</li>\n<li>Maybe its better handled with nginx or something else?</li>\n</ul>\n"}, {"tags": ["templates", "go", "revel", "go-templates"], "comments": [{"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1451812125, "post_id": 34558409, "comment_id": 56894456, "body": "This looks about to be the best solution when using revel. Is there any reason you&#39;re using revel and not something like <a href=\"http://www.gorillatoolkit.org/pkg/mux\" rel=\"nofollow noreferrer\">mux</a>? Go&#39;s got a pretty solid <code>net&#47;http</code> package."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1451834409, "post_id": 34558409, "comment_id": 56900873, "body": "@Datsik: I&#39;ve used the net/http package first. In principle, there&#39;s no real need for something like revel yet, but I thought I&#39;d give it a spin because they seem to be looking for (or hopefully even working at) an integrated ORM, which would make it a full, easy to use package. In short: no specific reason for using revel yet, just me wanting to see if there are any promising frameworks being built"}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1451850615, "post_id": 34558409, "comment_id": 56906797, "body": "fair enough. Revel is pretty solid. I&#39;ve used it a couple times but I&#39;ve found it much easier to build apps just using gorillas mux/session package combined with jinzus <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">gorm package</a>"}], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 371, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1451669835, "creation_date": 1451669835, "question_id": 34558409, "link": "https://stackoverflow.com/questions/34558409/pass-current-route-to-template", "title": "Pass current route to template", "body": "<p>I've been playing around with golang for a couple of weeks now, and recently started to look into the revel framework.<br>\nIn other languages/frameworks that I've used, it's always been possible to check what the current route is from within the template. Something that made it easier for me to keep things like navigation in a separate template file, and just do this:</p>\n\n<pre><code>&lt;!-- in header template --&gt;\n&lt;ul class=\"nav\"&gt;\n    {{ if eq .req.action \"App.Index\" }}\n        &lt;li class=\"active\"&gt;&lt;a href=\"#\"&gt;\n    {{ else }}\n        &lt;li&gt;&lt;a href=\"{{url \"App.Index\" }}\"&gt;\n    {{end}}\n    Home&lt;/a&gt;&lt;/li&gt;\n    &lt;!-- other links here --&gt;\n&lt;/ul&gt;\n</code></pre>\n\n<p>This isn't the actual code I'm writing, but I hope this makes it clear what the idea is: Have a template for the navigation handy, and set classes/links according to which action is the current one.<br>\nAfter some time going through the source code, and a number of golang template examples, I couldn't quite see any way in which the current action or anything else is exposed to the template.</p>\n\n<p>To get around this, I'm currently using a func interceptor which automatically sets a render argument for me:</p>\n\n<pre><code>func prependRoute(c *revel.Controller) revel.Result {\n    c.RenderArgs[\"_current_route\"] = c.Action\n    return nil\n}\n</code></pre>\n\n<p>This is working fine, but it feels a bit hacky. I think I'm probably missing something really obvious that would allow me to reserve func interceptors for when I really need them.</p>\n\n<p><strong><em>The question</em></strong>, then, is simple: What is the correct, and most reliable way to find out what the current action is in a revel template?</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 1347, "user_id": 1559202, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/3dabf6305a8fd64f9c020d2257263fbb?s=128&d=identicon&r=PG", "display_name": "John Kenn", "link": "https://stackoverflow.com/users/1559202/john-kenn"}, "edited": false, "score": 1, "creation_date": 1452851068, "post_id": 34555120, "comment_id": 57358677, "body": "Additional info for others: When using gin framework, when a panic happens, it will automatically respond with a 500 internal server error."}], "tags": [], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "is_accepted": true, "score": 2, "last_activity_date": 1451653826, "last_edit_date": 1451653826, "creation_date": 1451641979, "answer_id": 34555120, "question_id": 34554999, "link": "https://stackoverflow.com/questions/34554999/what-would-happen-if-an-error-happened-and-my-golang-app-didnt-handle-it/34555120#34555120", "title": "What would happen if an error happened and my golang app didn&#39;t handle it?", "body": "<blockquote>\n  <p>In the next example above, only the RecordNotFound() error is being handled, but what if it throws a different error?</p>\n</blockquote>\n\n<p>If you won't catch the error it will continue on the code. Error is not a special type it's a simple <a href=\"https://golang.org/src/errors/errors.go\" rel=\"nofollow\">struct</a> </p>\n\n<pre><code>err := FunctionThatReturnsError()  \nif err == myError.RecordNotFound() { // if err is not RecordNotFound then it won't enter the if simple as that. \n    // Do something.  \n}  \n\n// continue code.  \n</code></pre>\n\n<blockquote>\n  <p>Will my app automatically respond with a 500 server internal error and will the app keep on running properly?</p>\n</blockquote>\n\n<p>There will be no response if the go routine doesn't panic or you return a response. If you want to handle it you can do:</p>\n\n<pre><code>err := FunctionThatReturnsError()  \nif err == myError.RecordNotFound() {\n      panic(\"RecordNotFound\")\n} \n</code></pre>\n\n<p>or </p>\n\n<pre><code>err := FunctionThatReturnsError()  \nif err == myError.RecordNotFound() {\n      c.JSON(500, \"Record not found\"}\n} \n</code></pre>\n\n<p>I don't recommend the panic method. If you're curious google why.</p>\n"}, {"tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": false, "score": 2, "last_activity_date": 1451653773, "last_edit_date": 1451653773, "creation_date": 1451653392, "answer_id": 34556369, "question_id": 34554999, "link": "https://stackoverflow.com/questions/34554999/what-would-happen-if-an-error-happened-and-my-golang-app-didnt-handle-it/34556369#34556369", "title": "What would happen if an error happened and my golang app didn&#39;t handle it?", "body": "<p>Go doesn't have exceptions. Instead of catching exceptions, you get errors via return values from functions. So there's no throwing or anything special going on behind the scenes, just a function that returns an error value, and like any other return value - you can discard it.</p>\n\n<p>I wouldn't recommend discarding errors though. If you feel lazy or lost about what to do with an error - just log it:</p>\n\n<pre><code>log.Error(err)\n</code></pre>\n\n<p>You never know if an error you discarded is causing this mysterious bug you can swear is coming from anywhere but your own code.</p>\n"}, {"tags": [], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "is_accepted": false, "score": 1, "last_activity_date": 1451687055, "creation_date": 1451687055, "answer_id": 34560646, "question_id": 34554999, "link": "https://stackoverflow.com/questions/34554999/what-would-happen-if-an-error-happened-and-my-golang-app-didnt-handle-it/34560646#34560646", "title": "What would happen if an error happened and my golang app didn&#39;t handle it?", "body": "<blockquote>\n  <p>I wonder what would happen if an error happened and my app didn't handle it?</p>\n</blockquote>\n\n<p>Then the state of the app is undefined. If you don't check error values your app will be using values which are undefined (probably nil for pointers and \"zeros\" for values) or assuming that side effect occurred but it might not.</p>\n\n<p>Let's say you have a function with signature <code>func CreateStruct() (T, err)</code>\nand call it like that <code>t, _ := CreateStruct()</code> (not checking for error) you should not expect <code>t</code> variable to have a proper value set.\nIf you have function like <code>func Update() err</code> and you call it without error checking then you can't know whether update was performed or not.</p>\n\n<p>Of course everything depends on API and implementation. But you get the idea.</p>\n\n<blockquote>\n  <p>but what if it throws a different error?</p>\n</blockquote>\n\n<p>It's impossible. There is not throwing error mechanism in Go. Error can only be returned as a normal value.</p>\n\n<hr>\n\n<p>You should <strong>never</strong> be lazy with handling errors. It's very important part of programming and Go makes it easier to realize.</p>\n"}], "owner": {"reputation": 1347, "user_id": 1559202, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/3dabf6305a8fd64f9c020d2257263fbb?s=128&d=identicon&r=PG", "display_name": "John Kenn", "link": "https://stackoverflow.com/users/1559202/john-kenn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "accepted_answer_id": 34555120, "answer_count": 3, "score": 2, "last_activity_date": 1451687055, "creation_date": 1451640727, "last_edit_date": 1451642222, "question_id": 34554999, "link": "https://stackoverflow.com/questions/34554999/what-would-happen-if-an-error-happened-and-my-golang-app-didnt-handle-it", "title": "What would happen if an error happened and my golang app didn&#39;t handle it?", "body": "<p>I'm currently using <a href=\"https://github.com/jinzhu/gorm#query-with-where-plain-sql\" rel=\"nofollow\">gorm</a> and <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow\">gin framework</a>. I wonder what would happen if an error happened and my app didn't handle it?</p>\n\n<p>Example:</p>\n\n<pre><code>if err := db.Where(\"name = ?\", \"jinzhu\").First(&amp;user).Error; err != nil {\n    // error handling...\n}\n</code></pre>\n\n<p>In the above example, the error is being handled. </p>\n\n<pre><code>if db.Model(&amp;user).Related(&amp;credit_card).RecordNotFound() {\n    // no credit card found error handling\n}\n</code></pre>\n\n<p>In the next example above, only the <code>RecordNotFound()</code> error is being handled, but what if it throws a different error? what will happen?</p>\n\n<p>Will my app automatically respond with a 500 server internal error and will the app keep on running properly?</p>\n"}, {"tags": ["mysql", "go", "gorp"], "answers": [{"tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": true, "score": 0, "last_activity_date": 1451611013, "last_edit_date": 1495535285, "creation_date": 1451611013, "answer_id": 34552879, "question_id": 34552723, "link": "https://stackoverflow.com/questions/34552723/passing-a-variadic-parameter-for-select-query/34552879#34552879", "title": "Passing a variadic parameter for select query", "body": "<p>Found an answer based on <a href=\"https://stackoverflow.com/questions/7975095/pass-string-slice-to-variadic-empty-interface-parameter?rq=1\">Pass string slice to variadic empty interface parameter</a></p>\n\n<p>Below is the updated code to achieve the task</p>\n\n<pre><code>func GetAgregatedDownloadsFromTo(constrains dao.Constrains) [] dao.NameValue {\n    dbMap := utils.GetDBConnection(\"radsummary\");\n    defer dbMap.Db.Close()\n    var totalDailyDownloads[] dao.NameValue\n    query := \"SELECT SUM(outputoctets) as value ,date as name FROM dailyacct where date &gt;= ? AND date &lt; ? \"\n\n    if len(constrains.LocationGroups) &gt; 0 {\n        args := make([]interface{}, len(constrains.LocationGroups)+2)\n        args[0] = constrains.From\n        args[1] = constrains.To\n        for index, value := range constrains.LocationGroups { args[index+2] = value }\n\n        query = query + \" AND calledstationid=? \"\n        for i := 1; i&lt; len(constrains.LocationGroups); i++ {\n            query = query + \" OR calledstationid=? \"\n        }\n        query = query + \" group by date\"\n        print(query)\n        _, err := dbMap.Select(&amp;totalDailyDownloads, query, args...)\n        if err != nil {\n            panic(err.Error()) // proper error handling instead of panic\n        }\n    }\n    return totalDailyDownloads\n}\n</code></pre>\n\n<p>Here I had to convert the  string slice to an interface slice.</p>\n"}], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 1, "accepted_answer_id": 34552879, "answer_count": 1, "score": 0, "last_activity_date": 1451611172, "creation_date": 1451608797, "question_id": 34552723, "link": "https://stackoverflow.com/questions/34552723/passing-a-variadic-parameter-for-select-query", "title": "Passing a variadic parameter for select query", "body": "<p>I'm trying to build a query as follows, here I'm using gorp.</p>\n\n<pre><code>func GetAgregatedDownloadsFromTo(constrains Constrains) [] dao.NameValue {\n    dbMap := utils.GetDBConnection(\"radsummary\");\n    defer dbMap.Db.Close()\n    var totalDailyDownloads[] NameValue\n    query := \"SELECT SUM(outputoctets) as value ,date as name FROM dailyacct where date &gt;= ? AND date &lt; ? \"\n\n    if len(constrains.LocationGroups) &gt; 0 {\n        query = query + \" AND calledstationid=? \"\n        for i := 1; i&lt; len(constrains.LocationGroups); i++ {\n            query = query + \" OR calledstationid=? \"\n        }\n        query = query + \" group by date\"\n        print(query)\n        _, err := dbMap.Select(&amp;totalDailyDownloads, query, constrains.From, constrains.To, constrains.LocationGroups...)\n        if err != nil {\n            panic(err.Error()) // proper error handling instead of panic\n        }\n    }\n    return totalDailyDownloads\n}\n\ntype Constrains struct {\n    From string `json:\"from\"`\n    To string   `json:\"to\"`\n    LocationGroups []string    `json:\"locationgroups\"`\n}\n</code></pre>\n\n<p>Query construction happens based on the length of constrains.LocationGroups. Trouble I'm having is passing the variable number of args to the Select query once I give constrains.LocationGroups... as select query parameters it throws a compiler error <code>too many arguments in call to dbMap.Select</code></p>\n\n<p>Is it possible to achieve this kind of requirement?. Appreciate your input.</p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1451608342, "post_id": 34552334, "comment_id": 56848051, "body": "@ZanLynx: while this question says they got a deadlock in their sample code, it doesn&#39;t sound like they are trying to do the same thing as in that other question."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "reply_to_user": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1451608391, "post_id": 34552334, "comment_id": 56848063, "body": "@JamesHenstridge Of course not the same thing. But it looks like the general problem and solution are identical for this question."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1451608505, "post_id": 34552334, "comment_id": 56848085, "body": "And I just noticed even if you fix the buffering your for loops are not in goroutines and will therefore block unless you always make your buffers larger than your loop size."}], "answers": [{"tags": [], "owner": {"reputation": 376, "user_id": 2348705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13a37cab3b0733af5c7829aa1d8278b1?s=128&d=identicon&r=PG", "display_name": "Igor Dubinskiy", "link": "https://stackoverflow.com/users/2348705/igor-dubinskiy"}, "is_accepted": true, "score": 2, "last_activity_date": 1451613299, "last_edit_date": 1451613299, "creation_date": 1451612943, "answer_id": 34552989, "question_id": 34552334, "link": "https://stackoverflow.com/questions/34552334/consume-or-put-back-go-channels/34552989#34552989", "title": "&quot;Consume or put back&quot; Go channels", "body": "<p>You have a deadlock because your even and odd goroutines are blocked on sending to <code>out</code> because nothing is reading from it. Why is nothing reading <code>out</code>? Because the <code>main</code> goroutine is blocked on sending to <code>input</code> because nothing is reading from it. Why is nothing reading from <code>input</code>? Because the two goroutines that would read from it are blocked.</p>\n\n<p>Also, both <code>filterEven</code> and <code>filterOdd</code> will only run once unless you wrap their contents in <code>for { }</code> (but then they'll never stop until you <code>break</code>). On the other hand, <code>range even</code> will block (and <code>range odd</code> never happens) when nothing is left to write to <code>even</code> , because <code>range</code> over a channel only stops when the channel is closed or <code>break</code> is called.</p>\n\n<p>In general, these aren't hard problems to solve as long as you know when you can close a channel. With what you're describing, that gets more difficult. None of the goroutines know when it's OK to close <code>input</code>, because all three write to it and two also read from it. You can use a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow\"><code>sync.WaitGroup</code></a> to make sure that everything you've put into the <code>input</code> channel has been processed before closing it. Once it's closed, the two other goroutines can use that as a signal to close their own channels and <code>break</code> or <code>return</code> to finish running.</p>\n\n<p>However, writes to the <code>in</code> and <code>out</code> channels will still block until there is a corresponding read, because they are unbuffered. However, if you buffer them by specifying a size as the second argument to <code>make</code>, writes won't block until the channel is full. Since you know neither <code>even</code> or <code>odd</code> will have more written to them than what <code>main</code> send to <code>input</code>, you can use that as a safe buffer capacity.</p>\n\n<p>Here's an example of using a <code>WaitGroup</code> with buffered channels for your code: <a href=\"https://play.golang.org/p/VXqfwUwRcx\" rel=\"nofollow\">https://play.golang.org/p/VXqfwUwRcx</a></p>\n\n<p>If you don't want buffered channels, you can also use another pair of goroutines to capture the values and send them back to <code>main</code> as slices once finished. This way writes on the <code>even</code> and <code>odd</code> channels don't block: <a href=\"https://play.golang.org/p/i5vLDcsK1v\" rel=\"nofollow\">https://play.golang.org/p/i5vLDcsK1v</a></p>\n\n<p>Otherwise, if don't need to print the contents of each channel all at once, you can use those two extra goroutines to read from the channels and print right away: <a href=\"https://play.golang.org/p/OCaUTcJkKB\" rel=\"nofollow\">https://play.golang.org/p/OCaUTcJkKB</a></p>\n"}], "owner": {"reputation": 18772, "user_id": 278984, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/29a6c77c187f2a5d02d2b79df4b31223?s=128&d=identicon&r=PG", "display_name": "spacemonkey", "link": "https://stackoverflow.com/users/278984/spacemonkey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 995, "favorite_count": 0, "closed_date": 1451685601, "accepted_answer_id": 34552989, "answer_count": 1, "score": 1, "last_activity_date": 1451613299, "creation_date": 1451603609, "question_id": 34552334, "link": "https://stackoverflow.com/questions/34552334/consume-or-put-back-go-channels", "closed_reason": "Duplicate", "title": "&quot;Consume or put back&quot; Go channels", "body": "<p>I am trying to have two separate consumer go routines, that would filter out even and odd numbers from the input channel. This is just a toy example in order to see if it is possible to have consumers do something with the message read from the input channel if it matches certain condition, otherwise put back onto the input channel.</p>\n\n<p>My current code is as follows:</p>\n\n<pre><code>package main\n\nfunc filterOdd(ch chan int, out chan int) {\n    val := &lt;- ch\n    if val % 2 == 0 {\n        ch &lt;- val\n    } else {\n        out &lt;- val\n    }\n}\nfunc filterEven(ch chan int, out chan int) {\n    val := &lt;- ch\n    if val % 2 != 0 {\n        ch &lt;- val\n    } else {\n        out &lt;- val\n    }\n}\n\nfunc main() {\n    even := make(chan int)\n    odd := make(chan int)\n    input := make(chan int)\n    go filterOdd(input, odd)\n    go filterEven(input, even)\n    for i:=1; i &lt;= 10; i++ {\n        input &lt;- i\n    }\n\n    println(\"Even...\")\n    for i := range even {\n        println(i)\n    }\n\n    println(\"Odd...\")\n    for i := range odd {\n        println(i)\n    }\n}\n</code></pre>\n\n<p>However, this produces the following output:</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan send]:\nmain.main()\n    /tmp/sandbox594577124/main.go:27 +0x140\n\ngoroutine 4 [chan send]:\nmain.filterOdd(0x10336100, 0x103360c0)\n    /tmp/sandbox594577124/main.go:8 +0xc0\ncreated by main.main\n    /tmp/sandbox594577124/main.go:24 +0xc0\n</code></pre>\n\n<p>Link to the Go Playground: <a href=\"https://play.golang.org/p/9RIvFsGKI-\" rel=\"nofollow\">https://play.golang.org/p/9RIvFsGKI-</a></p>\n"}, {"tags": ["security", "encryption", "go", "aes", "kdf"], "comments": [{"owner": {"reputation": 962, "user_id": 3784644, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/GnY64.jpg?s=128&g=1", "display_name": "DTSCode", "link": "https://stackoverflow.com/users/3784644/dtscode"}, "edited": false, "score": 3, "creation_date": 1451603348, "post_id": 34552301, "comment_id": 56847178, "body": "note that codereview.stackexchange.com is a thing"}, {"owner": {"reputation": 2559, "user_id": 5087125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6R64Z.jpg?s=128&g=1", "display_name": "pvg", "link": "https://stackoverflow.com/users/5087125/pvg"}, "edited": false, "score": 2, "creation_date": 1451603563, "post_id": 34552301, "comment_id": 56847212, "body": "<a href=\"http://codahale.com/how-to-safely-store-a-password/\" rel=\"nofollow noreferrer\">codahale.com/how-to-safely-store-a-password</a>"}, {"owner": {"reputation": 2559, "user_id": 5087125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6R64Z.jpg?s=128&g=1", "display_name": "pvg", "link": "https://stackoverflow.com/users/5087125/pvg"}, "edited": false, "score": 0, "creation_date": 1451603823, "post_id": 34552301, "comment_id": 56847261, "body": "Also are you actually encrypting the password? Because if so, that&#39;s a relatively terrible idea if all you need is validation. If not, 1Password has fairly extensive specs on how they do it."}, {"owner": {"reputation": 8652, "user_id": 2040863, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/IspsC.jpg?s=128&g=1", "display_name": "John Hascall", "link": "https://stackoverflow.com/users/2040863/john-hascall"}, "edited": false, "score": 0, "creation_date": 1451604882, "post_id": 34552301, "comment_id": 56847446, "body": "Typically encryption is not used for passwords -- there is no need to be able to retrieve the plaintext -- in fact, that&#39;s a negative.  Typically you do: <code>V = Hash(SALT, PASSWORD)</code> and save V &amp; SALT.  Then when it comes time to verify, you recompute <code>V2 = Hash(SALT, MIGHTBEPASSWORD)</code>.  Then if V2 == V, the password was correct.  The tricky bit is making sure that <code>Hash()</code> has all the cryptographic properties you want it to have."}, {"owner": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "edited": false, "score": 0, "creation_date": 1451605607, "post_id": 34552301, "comment_id": 56847590, "body": "I&#39;m not encrypting or storing the password. I&#39;m storing the random salt and the IV unencrypted in the ciphertext, and the key is recomputed using the salt with the provided password at the time of decryption."}, {"owner": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "edited": false, "score": 0, "creation_date": 1451605724, "post_id": 34552301, "comment_id": 56847605, "body": "My idea of storing the HMAC in the encrypted portion of the ciphertext is to authenticate the plaintext as well as to validate its integrity"}, {"owner": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "reply_to_user": {"reputation": 2559, "user_id": 5087125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6R64Z.jpg?s=128&g=1", "display_name": "pvg", "link": "https://stackoverflow.com/users/5087125/pvg"}, "edited": false, "score": 0, "creation_date": 1451605787, "post_id": 34552301, "comment_id": 56847621, "body": "@pvg Also, what are the benefits of using bcrypt over pbkdf2? It seems like most sources suggest that pdkdf2 &gt; bcrypt"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451606187, "post_id": 34552301, "comment_id": 56847680, "body": "Which sources? PBKDF2 should only be used where you require it due to specifications (e.g. satisfying FIPS/NIST requirements). bcrypt is much harder to parallelize, and (as per my answer) scrypt is harder again. RE: authenticating the plaintext: you should authenticate the ciphertext, in which case you should use AES-GCM (<a href=\"https://golang.org/pkg/crypto/cipher/#NewGCM\" rel=\"nofollow noreferrer\">golang.org/pkg/crypto/cipher/#NewGCM</a>) to do it in one pass."}, {"owner": {"reputation": 2559, "user_id": 5087125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6R64Z.jpg?s=128&g=1", "display_name": "pvg", "link": "https://stackoverflow.com/users/5087125/pvg"}, "edited": false, "score": 0, "creation_date": 1451606273, "post_id": 34552301, "comment_id": 56847699, "body": "@DesmondLee bcrypt has the more foolproof, simpler API, in its typical implementations. For most purposes, the debates about the advantage of one over the other are rather theoretical, when in doubt, use bcrypt. If you can derive the plaintext of the password, then yes, you are storing the password. Short of writing a password manager, you should not do that since it tends to have the security of storing the password in plaintext."}, {"owner": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "reply_to_user": {"reputation": 2559, "user_id": 5087125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6R64Z.jpg?s=128&g=1", "display_name": "pvg", "link": "https://stackoverflow.com/users/5087125/pvg"}, "edited": false, "score": 0, "creation_date": 1451606597, "post_id": 34552301, "comment_id": 56847750, "body": "@pvg I think I am misunderstanding. I can&#39;t derive the plaintext of the password. The user is providing it to decrypt the message."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451606751, "post_id": 34552301, "comment_id": 56847779, "body": "An attacker could\u2014without having to run any rounds of bcrypt/scrypt\u2014by testing a bunch of passwords from a password dump. You&#39;re storing <code>[32 bit salt] [128 bit iv] encrypted([32 bit hmac] [plaintext])</code> - AES decrypt operations on modern CPUs are <i>very</i> (very) fast."}, {"owner": {"reputation": 2559, "user_id": 5087125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6R64Z.jpg?s=128&g=1", "display_name": "pvg", "link": "https://stackoverflow.com/users/5087125/pvg"}, "edited": false, "score": 1, "creation_date": 1451606934, "post_id": 34552301, "comment_id": 56847807, "body": "ok, is this question really about encrypting/decrypting a message, using some key derived from from user supplied secret? because that&#39;s a somewhat different question and you&#39;ve awoken the hounds by saying &#39;password encryption&#39;."}, {"owner": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "edited": false, "score": 0, "creation_date": 1451606990, "post_id": 34552301, "comment_id": 56847818, "body": "pvg: Yes, that&#39;s what this question is about. I realized that my wording in the title is the cause of the misunderstanding. Thanks"}, {"owner": {"reputation": 2559, "user_id": 5087125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6R64Z.jpg?s=128&g=1", "display_name": "pvg", "link": "https://stackoverflow.com/users/5087125/pvg"}, "edited": false, "score": 1, "creation_date": 1451607027, "post_id": 34552301, "comment_id": 56847827, "body": "The answer to that one is probably &#39;use NaCl&#39;. If it&#39;s about real-time messages, use OTR."}, {"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1451659663, "post_id": 34552301, "comment_id": 56857163, "body": "32 bit salt, 32 IV and 32 bit HMAC all seem too small to provide any meaningful security. You probably meant bytes, right? Otherwise, you really should increase those numbers."}, {"owner": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "edited": false, "score": 0, "creation_date": 1451661473, "post_id": 34552301, "comment_id": 56857631, "body": "Yes, I got bits/bytes mixed up in my question. I corrected the mistakes in the question"}], "answers": [{"comments": [{"owner": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "edited": false, "score": 0, "creation_date": 1451606424, "post_id": 34552529, "comment_id": 56847727, "body": "I&#39;m confused about #1, because I don&#39;t believe I am encrypting the password (unless my understanding of what I am doing with the HMAC part is incorrect)  I&#39;m storing the generated salt and using the PBKDF2 in the decryption stage to obtain the key. The reason I MAC then encrypt is to prevent an adversary from giving invalid ciphertexts. I&#39;ll look into MAC-then-encrypt vs encrypt-then-MAC to gain a better understanding.  Also, I&#39;m confused about the sentence about not needing the plaintext back. Isn&#39;t that the point of decryption?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "edited": false, "score": 0, "creation_date": 1451606882, "post_id": 34552529, "comment_id": 56847799, "body": "As per your post, you&#39;re storing <code>[32 bit salt] [128 bit iv] encrypted([32 bit hmac] [plaintext])</code> \u2014 which shows you encrypting the password. Further, if an adversary is giving invalid ciphertexts, it doesn&#39;t matter: the HMAC exists to help you validate it (by running HMAC over the ciphertext and constant-time comparing both HMACs)."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "edited": false, "score": 0, "creation_date": 1451606944, "post_id": 34552529, "comment_id": 56847809, "body": "Decryption does give you the plaintext back, but ask yourself: why do you need it? Why does everyone else recommend bcrypt/scrypt instead of some kind of strange PDKDF2 + HMAC-SHA-256 + AES-CBC construction?"}, {"owner": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "edited": false, "score": 0, "creation_date": 1451607613, "post_id": 34552529, "comment_id": 56847923, "body": "My original question title might have caused some confusion about the purpose of my script. It&#39;s not for encrypting passwords, but for encrypting a message with a user supplied password. The supplied password is used along with the saved salt to generate the symmetric key with PBKDF2. But from your answer it seems like PBKDF2 is weak against brute force attacks, and I should use bcrypt/script instead. It also seems like I should use AES-GCM instead of AES-CBC/HMAC-SHA-256. Is that correct?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "edited": false, "score": 0, "creation_date": 1451607709, "post_id": 34552529, "comment_id": 56847944, "body": "In which case you should use AES-GCM (only) or (better still) Go&#39;s NaCl implementation, which uses Salsa20 &amp; Poly1305 to encrypt messages with a shared key: <a href=\"https://godoc.org/golang.org/x/crypto/nacl/secretbox\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/crypto/nacl/secretbox</a>"}, {"owner": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "edited": false, "score": 0, "creation_date": 1451607773, "post_id": 34552529, "comment_id": 56847956, "body": "Thanks for your detailed answers"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "edited": false, "score": 0, "creation_date": 1451607895, "post_id": 34552529, "comment_id": 56847978, "body": "@DesmondLee No problems. I&#39;ve added mention of secretbox &amp; AES-GCM to the accepted answer for posterity as well."}, {"owner": {"reputation": 2559, "user_id": 5087125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6R64Z.jpg?s=128&g=1", "display_name": "pvg", "link": "https://stackoverflow.com/users/5087125/pvg"}, "edited": false, "score": 1, "creation_date": 1451608120, "post_id": 34552529, "comment_id": 56848012, "body": "@elithrar it&#39;s probably worth removing the stuff about passwords (or maybe swapping the order), since it turned out the thing is really about key derivation and encryption rather than password validation or storage, which is what it confusingly looked like initially."}, {"owner": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "edited": false, "score": 0, "creation_date": 1451612831, "post_id": 34552529, "comment_id": 56848706, "body": "@elithar What would I use to encrypt larger amounts of data? (like journals, articles, etc)"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1451615662, "post_id": 34552529, "comment_id": 56849052, "body": "How large are we talking? secretbox is still OK for that, otherwise AES-GCM."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 7, "last_activity_date": 1451630783, "last_edit_date": 1492087698, "creation_date": 1451606078, "answer_id": 34552529, "question_id": 34552301, "link": "https://stackoverflow.com/questions/34552301/how-secure-is-my-encryption-with-password-script-golang-aes256-pbkdf2-hmac/34552529#34552529", "title": "How secure is my encryption with password script? (Golang, AES256, pbkdf2, hmac)", "body": "<p><strong>Note</strong>, since the question was about encrypting messages rather than passwords: If you're encrypting small messages rather than hashing passwords, Go's <a href=\"https://godoc.org/golang.org/x/crypto/nacl/secretbox\" rel=\"nofollow noreferrer\">secretbox</a> package\u2014as part of its NaCl implementation\u2014is the way to go. If you're intent on rolling your own\u2014and I strongly recommend against it, unless it stays within your own dev environment\u2014then AES-GCM is the way to go here.</p>\n\n<p>Otherwise, most of the below still applies:</p>\n\n<ol>\n<li>Symmetric encryption isn't useful for passwords. There should be no reason why you need the plaintext back\u2014you should only care about comparing hashes (or, more precisely, derivative keys).</li>\n<li>PBKDF2, compared to scrypt or bcrypt, is not ideal (10002 rounds, in 2015, is probably a bit low too). scrypt is memory-hard and much harder to parallelize on a GPU, and in 2015, has had a sufficiently long life as to make it safer than bcrypt (you would still use bcrypt in cases where the scrypt library for your language wasn't great).</li>\n<li>MAC-then-encrypt <a href=\"https://crypto.stackexchange.com/questions/202/should-we-mac-then-encrypt-or-encrypt-then-mac\">has issues</a> - you should encrypt-then-MAC.</li>\n<li>Given #3, you should use AES-GCM (Galois Counter Mode) over AES-CBC + HMAC.</li>\n</ol>\n\n<p>Go has a great <a href=\"https://godoc.org/golang.org/x/crypto/bcrypt\" rel=\"nofollow noreferrer\">bcrypt</a> package with an easy-to-use API (generates salts for you; securely compares).</p>\n\n<p>I also wrote an <a href=\"https://github.com/elithrar/simple-scrypt\" rel=\"nofollow noreferrer\">scrypt</a> package that mirrors that package, as the underlying scrypt package requires you to validate your own params and generate your own salts.</p>\n"}], "owner": {"reputation": 707, "user_id": 2152216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35dca7d1903ca92929424078005423b2?s=128&d=identicon&r=PG", "display_name": "Desmond Lee", "link": "https://stackoverflow.com/users/2152216/desmond-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2840, "favorite_count": 1, "accepted_answer_id": 34552529, "answer_count": 1, "score": 1, "last_activity_date": 1451661380, "creation_date": 1451603246, "last_edit_date": 1451661380, "question_id": 34552301, "link": "https://stackoverflow.com/questions/34552301/how-secure-is-my-encryption-with-password-script-golang-aes256-pbkdf2-hmac", "title": "How secure is my encryption with password script? (Golang, AES256, pbkdf2, hmac)", "body": "<p>First, I want to say that this is just an learning exercise and I do not intend to use this in production.</p>\n\n<p>I wrote a small application in Golang with two functions: <code>encrypt(plaintext string, password string)</code> and <code>decrypt(encrypted string, password string)</code></p>\n\n<p>The encryption steps are:</p>\n\n<ol>\n<li>Generate random 256 bits to use as salt</li>\n<li>Generate 128 bits to use as an Initialization Vector</li>\n<li>Use PDKDF2 to generate a 32 bit key from the password and salt</li>\n<li>Generate an 32 bit HMAC with the key and plaintext, and append it to the beginning of the plaintext</li>\n<li>Encrypt the hmac+plaintext with AES in CFB mode</li>\n</ol>\n\n<p>The returned byte array looks like this:</p>\n\n<pre><code>[256 bit salt] [128 bit iv] encrypted([256 bit hmac] [plaintext])\n</code></pre>\n\n<p>When decrypting:</p>\n\n<ol>\n<li>Extract the salt and use it with the provided password to compute the key</li>\n<li>Extract the IV and decrypt the encrypted portion of the ciphertext</li>\n<li>Extract the mac from the decrypted value</li>\n<li>Validate the mac with the plaintext </li>\n</ol>\n\n<p>I'm not crazy enough to use my own encryption script in any production projects, so please point me to any libraries that do this for me (simple password / message encryption that is relatively secure)</p>\n\n<p>Here is the source code to the two functions:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"crypto/rand\"\n    \"crypto/cipher\"\n    \"crypto/aes\"\n    \"crypto/sha256\"\n    \"crypto/hmac\"\n    \"golang.org/x/crypto/pbkdf2\"\n)\n\n\nconst saltlen = 32\nconst keylen = 32\nconst iterations = 100002\n\n// returns ciphertext of the following format:\n// [32 bit salt][128 bit iv][encrypted plaintext]\nfunc encrypt(plaintext string, password string) string {\n    // allocate memory to hold the header of the ciphertext\n    header := make([]byte, saltlen + aes.BlockSize)\n\n    // generate salt\n    salt := header[:saltlen]\n    if _, err := io.ReadFull(rand.Reader, salt); err != nil {\n        panic(err)\n    }\n\n    // generate initialization vector\n    iv := header[saltlen:aes.BlockSize+saltlen]\n    if _, err := io.ReadFull(rand.Reader, iv); err != nil {\n        panic(err)\n    }\n\n    // generate a 32 bit key with the provided password\n    key := pbkdf2.Key([]byte(password), salt, iterations, keylen, sha256.New)\n\n    // generate a hmac for the message with the key\n    mac := hmac.New(sha256.New, key)\n    mac.Write([]byte(plaintext))\n    hmac := mac.Sum(nil)\n\n    // append this hmac to the plaintext\n    plaintext = string(hmac) + plaintext\n\n    //create the cipher\n    block, err := aes.NewCipher(key)\n    if err != nil {\n        panic(err)\n    }\n\n    // allocate space for the ciphertext and write the header to it\n    ciphertext := make([]byte, len(header) + len(plaintext))\n    copy(ciphertext, header)\n\n    // encrypt\n    stream := cipher.NewCFBEncrypter(block, iv)\n    stream.XORKeyStream(ciphertext[aes.BlockSize+saltlen:], []byte(plaintext))\n    return string(ciphertext)\n}\n\nfunc decrypt(encrypted string, password string) string {\n    ciphertext := []byte(encrypted)\n    // get the salt from the ciphertext\n    salt := ciphertext[:saltlen]\n    // get the IV from the ciphertext\n    iv := ciphertext[saltlen:aes.BlockSize+saltlen]\n    // generate the key with the KDF\n    key := pbkdf2.Key([]byte(password), salt, iterations, keylen, sha256.New)\n\n    block, err := aes.NewCipher(key)\n    if (err != nil) {\n        panic(err)\n    }\n\n    if len(ciphertext) &lt; aes.BlockSize {\n        return \"\"\n    }\n\n    decrypted := ciphertext[saltlen+aes.BlockSize:]\n    stream := cipher.NewCFBDecrypter(block, iv)\n    stream.XORKeyStream(decrypted, decrypted)\n\n    // extract hmac from plaintext\n    extractedMac := decrypted[:32]\n    plaintext := decrypted[32:]\n\n    // validate the hmac\n    mac := hmac.New(sha256.New, key)\n    mac.Write(plaintext)\n    expectedMac := mac.Sum(nil)\n    if !hmac.Equal(extractedMac, expectedMac) {\n        return \"\"\n    }\n\n    return string(plaintext)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 6, "creation_date": 1451588075, "post_id": 34550557, "comment_id": 56843388, "body": "Have you tried localhost:8080/stuff ? The port number should be before the path, not after it."}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 5, "last_activity_date": 1451588286, "creation_date": 1451588286, "answer_id": 34550607, "question_id": 34550557, "link": "https://stackoverflow.com/questions/34550557/http-server-only-serves-from-browser/34550607#34550607", "title": "HTTP server only serves &quot;/&quot; from browser", "body": "<p>Yes. You're not using a valid url. The port number comes before the path. The scheme below describes a url. You hsould have <code>localhost:8080/whatever/the/path/is</code> and never <code>localhost/some/path/this/should/never/work/because/its/not/valid:8080</code></p>\n\n<p>scheme:[//[user:password@]host[:port]][/]path[?query][#fragment]</p>\n"}], "owner": {"reputation": 233, "user_id": 1837743, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/23c78d0187b5980444847fada9395b78?s=128&d=identicon&r=PG", "display_name": "gigatropolis", "link": "https://stackoverflow.com/users/1837743/gigatropolis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1451588286, "creation_date": 1451587992, "question_id": 34550557, "link": "https://stackoverflow.com/questions/34550557/http-server-only-serves-from-browser", "title": "HTTP server only serves &quot;/&quot; from browser", "body": "<p>I basically cut and pasted the example to make a web server from this link:  <a href=\"http://thenewstack.io/building-a-web-server-in-go/\" rel=\"nofollow\">http://thenewstack.io/building-a-web-server-in-go/</a></p>\n\n<p>Posted the code here:\n<a href=\"http://play.golang.org/p/RvEr7E-v9q\" rel=\"nofollow\">http://play.golang.org/p/RvEr7E-v9q</a></p>\n\n<p>I run the server and put in browser \"localhost:8080\" and this calls the <code>hello(w,r)</code> handler as expected. When trying from browser \"localhost/stuff:8080\" it doesn't even call the <code>ServeHTTP(w http.ResponseWriter, r *http.Request)</code></p>\n\n<p>What fundamentally ridiculous thing am I doing wrong here?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "edited": false, "score": 1, "creation_date": 1451585186, "post_id": 34550011, "comment_id": 56842370, "body": "You probably passed a pointer to an interface not an interface to a function. Can you provide more context? Code where you use <code>entry</code>?"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1451614106, "post_id": 34550011, "comment_id": 56848857, "body": "<code>os.FileInfo</code> is an interface, not a struct. You&#39;ve probably made a mistake if you have pointer to one."}], "answers": [{"comments": [{"owner": {"reputation": 721, "user_id": 4628081, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yGbnkCNSojE/AAAAAAAAAAI/AAAAAAAAAcY/zmn34zFQAVI/photo.jpg?sz=128", "display_name": "Francesco Gualazzi", "link": "https://stackoverflow.com/users/4628081/francesco-gualazzi"}, "edited": false, "score": 0, "creation_date": 1475605813, "post_id": 34550541, "comment_id": 67006570, "body": "Understandable :) thank you"}], "tags": [], "owner": {"reputation": 1739, "user_id": 91449, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/279929b6e31ee2eda28479f7829e6bb0?s=128&d=identicon&r=PG", "display_name": "Guildencrantz", "link": "https://stackoverflow.com/users/91449/guildencrantz"}, "is_accepted": false, "score": 1, "last_activity_date": 1451882556, "last_edit_date": 1451882556, "creation_date": 1451587862, "answer_id": 34550541, "question_id": 34550011, "link": "https://stackoverflow.com/questions/34550011/golang-why-must-you-dereference-a-fileinfo-pointer-to-be-able-to-access-its-mem/34550541#34550541", "title": "golang: Why must you dereference a FileInfo pointer to be able to access its members", "body": "<blockquote>\n  <p>The Go spec seems to indicates that you shouldn't have to explicitly\n  dereference a pointer</p>\n</blockquote>\n\n<p>What are you interpreting to mean this?</p>\n\n<p>That question out of the way: You don't need to explicitly dereference pointers when they're hidden behind <code>interface</code>, but you need to make sure that whatever you're using as the interface implements that interface.</p>\n\n<p>In English: You can create a struct which implements an interface, pass it or a pointer to it as that interface, and never worry about dereferencing. However: If you pass a pointer to that interface you'll get a compile time error because the interface pointer itself doesn't implement the interface.</p>\n\n<p><a href=\"https://play.golang.org/p/CmjV20QyjH\" rel=\"nofollow\" title=\"In code\">In code</a>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Iface interface {\n    Name() string\n}\n\ntype Strct struct {\n    name string\n}\n\nfunc (s Strct) Name() string {\n    return s.name\n}\n\nfunc PrintName(i Iface) {\n    fmt.Println(i.Name())\n}\n\nfunc main() {\n    s := Strct{name: \"strct\"}\n    // Strct implements Iface\n    PrintName(s)\n\n    // *Struct implements Iface\n    PrintName(&amp;s)\n\n    var si Iface\n\n    // Explicitly setting Iface to Strct works\n    si = Strct{name: \"Iface from Strct\"}\n    PrintName(si)\n\n    // Explicitly setting Iface to *Strct works\n    si = &amp;Strct{name: \"Iface from *Strct\"}\n    PrintName(si) \n\n    // Uncomment the next line to see the error when you try to use a pointer to an interface\n    //PrintName(&amp;si)\n}\n</code></pre>\n"}], "owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 766, "favorite_count": 0, "closed_date": 1451683698, "answer_count": 1, "score": 0, "last_activity_date": 1451882556, "creation_date": 1451584783, "question_id": 34550011, "link": "https://stackoverflow.com/questions/34550011/golang-why-must-you-dereference-a-fileinfo-pointer-to-be-able-to-access-its-mem", "closed_reason": "Duplicate", "title": "golang: Why must you dereference a FileInfo pointer to be able to access its members", "body": "<p>The Go spec seems to indicates that you shouldn't have to explicitly dereference a pointer, but this appears to not work for FileInfo pointers:</p>\n\n<blockquote>\n  <p>src/pathfingerprint/pfinternal/path.go:78: entry.Name undefined (type\n  *os.FileInfo has no field or method Name)</p>\n</blockquote>\n\n<p>Obviously, <code>(*entry).Name()</code> works fine.</p>\n\n<p>Why? What makes this works differently?</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "edited": false, "score": 0, "creation_date": 1451574532, "post_id": 34548166, "comment_id": 56838170, "body": "I did that for simplicity sake, but my handlers are actually defined in the routes package, so i still need to take the routes out of the main function"}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "reply_to_user": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "edited": false, "score": 2, "creation_date": 1451574732, "post_id": 34548166, "comment_id": 56838249, "body": "I don&#39;t get the point of this: either way you&#39;re still going to write your routes somewhere\u2026 If your &quot;main&quot; is too long, maybe you can write an <code>NewRouter</code> helper that will initialize it for you."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "reply_to_user": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "edited": false, "score": 1, "creation_date": 1451574777, "post_id": 34548166, "comment_id": 56838265, "body": "Another solution would be to have an initialization function in your route package that take the router as input and add the routes as it see fit. But I strongly advise against."}], "tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": true, "score": 11, "last_activity_date": 1451574644, "last_edit_date": 1451574644, "creation_date": 1451574316, "answer_id": 34548166, "question_id": 34548039, "link": "https://stackoverflow.com/questions/34548039/how-to-organize-gorilla-mux-routes/34548166#34548166", "title": "how to organize gorilla mux routes?", "body": "<p>What about something like this ?</p>\n\n<pre><code>//main.go\npackage main\n\nimport (\n    \"NovAPI/routes\"\n    \"fmt\"\n    \"github.com/gorilla/mux\"\n    \"net/http\"\n)\n\nfunc main() {\n\n    router := mux.NewRouter().StrictSlash(true)\n\n    router.HandleFunc(\"/hello\", HelloHandler)\n    router.HandleFunc(\"/user\", UserHandler)\n    router.HandleFunc(\"/route2\", Route2Handler)\n    router.HandleFunc(\"/route3\", Route3Handler)\n    // route declarations continue like this\n\n    http.ListenAndServe(\":1128\", router)\n\n}\n\nfunc HelloHandler(res http.ResponseWriter, req *http.Request) {\n    fmt.Fprintln(res, \"Hello\")\n}\n\nfunc UserHandler(res http.ResponseWriter, req *http.Request) {\n    fmt.Fprintln(res, \"User\")\n}\n\nfunc Route2Handler(res http.ResponseWriter, req *http.Request) {\n    fmt.Fprintln(res, \"Route2\")\n}\n\nfunc Route3Handler(res http.ResponseWriter, req *http.Request) {\n    fmt.Fprintln(res, \"Route3\")\n}\n</code></pre>\n\n<p>That way you can put your handlers in other files, or even other packages.</p>\n\n<p>If you endup with additionnal dependencies like a database, you can even avoid the need of the global var using a constructor trick:</p>\n\n<pre><code>//main.go\n\nfunc main() {\n    db := sql.Open(\u2026)\n\n    //...\n\n    router.HandleFunc(\"/hello\", NewHelloHandler(db))\n\n    //...\n}\n\nfunc NewHelloHandler(db *sql.DB) func(http.ResponseWriter, *http.Request) {\n    return func(res http.ResponseWriter, req *http.Request) {\n        // db is in the local scope, and you can even inject it to test your\n        // handler\n        fmt.Fprintln(res, \"Hello\")\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 599, "user_id": 4327041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ZbnQ.jpg?s=128&g=1", "display_name": "abm", "link": "https://stackoverflow.com/users/4327041/abm"}, "is_accepted": false, "score": 6, "last_activity_date": 1451577252, "creation_date": 1451577252, "answer_id": 34548687, "question_id": 34548039, "link": "https://stackoverflow.com/questions/34548039/how-to-organize-gorilla-mux-routes/34548687#34548687", "title": "how to organize gorilla mux routes?", "body": "<p>I like checking out other projects in github to grab ideas on how to do stuff, and for these cases I usually take a look first at the <a href=\"https://github.com/docker/docker\" rel=\"noreferrer\">Docker repo</a>. This is the way they do it:</p>\n\n<p>For the <a href=\"https://github.com/docker/docker/tree/master/api/server/router/system\" rel=\"noreferrer\">system</a>'s routes, define all handlers in <a href=\"https://github.com/docker/docker/blob/master/api/server/router/system/system_routes.go\" rel=\"noreferrer\">system_routes.go</a> and then initialize those routes on a NewRouter function in <a href=\"https://github.com/docker/docker/blob/master/api/server/router/system/system.go\" rel=\"noreferrer\">system.go</a>.</p>\n\n<pre><code>type systemRouter struct {\n    backend Backend\n    routes  []router.Route\n}\n\nfunc NewRouter(b Backend) router.Router {\n    r := &amp;systemRouter{\n        backend: b,\n    }\n\n    r.routes = []router.Route{\n        local.NewOptionsRoute(\"/\", optionsHandler),\n        local.NewGetRoute(\"/_ping\", pingHandler),\n        local.NewGetRoute(\"/events\", r.getEvents),\n        local.NewGetRoute(\"/info\", r.getInfo),\n        local.NewGetRoute(\"/version\", r.getVersion),\n        local.NewPostRoute(\"/auth\", r.postAuth),\n    }\n\n    return r\n}\n\n// Routes return all the API routes dedicated to the docker system.\nfunc (s *systemRouter) Routes() []router.Route {\n    return s.routes\n}\n</code></pre>\n\n<p>Notice that systemRouter implements the <a href=\"https://github.com/docker/docker/blob/master/api/server/router/router.go\" rel=\"noreferrer\">router.Router</a> interface and the Routes function returns a []router.Route, and their handlers are defined as</p>\n\n<pre><code>func(ctx context.Context, w http.ResponseWriter, r *http.Request, vars map[string]string) error\n</code></pre>\n\n<p>instead of Go's standard http handler:</p>\n\n<pre><code>func(w http.ResponseWriter, r *http.Request)\n</code></pre>\n\n<p>So there's extra code of theirs to convert a Docker API Handler to a Go HTTP Handler at the <a href=\"https://github.com/docker/docker/blob/master/api/server/server.go#L147-L172\" rel=\"noreferrer\">makeHttpHandler</a> function.</p>\n\n<p>And finally, to add those routes to their mux router, on their <a href=\"https://github.com/docker/docker/blob/master/api/server/server.go#L191-L209\" rel=\"noreferrer\">server.go</a> they implement several other functions to <a href=\"https://github.com/docker/docker/blob/master/api/server/middleware.go#L160-L182\" rel=\"noreferrer\">add middleware</a> to their handlers.</p>\n\n<p>If this is something that you think it's what you are looking for, then take your time to analyze the Docker code for their routes, and if you need me to elaborate more or if I missed anything, post a comment. </p>\n"}, {"tags": [], "owner": {"reputation": 461, "user_id": 7168774, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5nTie.jpg?s=128&g=1", "display_name": "Loris", "link": "https://stackoverflow.com/users/7168774/loris"}, "is_accepted": false, "score": 16, "last_activity_date": 1537771651, "creation_date": 1537771651, "answer_id": 52473957, "question_id": 34548039, "link": "https://stackoverflow.com/questions/34548039/how-to-organize-gorilla-mux-routes/52473957#52473957", "title": "how to organize gorilla mux routes?", "body": "<p>You can modularize your routers independently into different packages, and mount them on the main router</p>\n\n<p>Elaborating just a little on the following <a href=\"https://github.com/gorilla/mux/issues/136\" rel=\"noreferrer\">issue</a>, you can come up with this approach, that makes it quite scalable (and easier to test, to some degree)</p>\n\n<p>/api/router.go\n</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package api\n\nimport (\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc Router() *mux.Router {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/\", home)\n    return router\n}\n\nfunc home(w http.ResponseWriter, req *http.Request) {\n    w.Write([]byte(\"hello from API\"))\n}\n</code></pre>\n\n<p>/main.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"strings\"\n\n    \"github.com/...yourPath.../api\"\n    \"github.com/...yourPath.../user\"\n    \"github.com/gorilla/mux\"\n)\n\nfunc main() {\n    router := mux.NewRouter()\n\n    router.HandleFunc(\"/\", home)\n    mount(router, \"/api\", api.Router())\n    mount(router, \"/user\", user.Router())\n\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n\nfunc mount(r *mux.Router, path string, handler http.Handler) {\n    r.PathPrefix(path).Handler(\n        http.StripPrefix(\n            strings.TrimSuffix(path, \"/\"),\n            handler,\n        ),\n    )\n}\n\nfunc home(w http.ResponseWriter, req *http.Request) {\n    w.Write([]byte(\"Home\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5845, "favorite_count": 5, "accepted_answer_id": 34548166, "answer_count": 3, "score": 13, "last_activity_date": 1537771651, "creation_date": 1451573602, "question_id": 34548039, "link": "https://stackoverflow.com/questions/34548039/how-to-organize-gorilla-mux-routes", "title": "how to organize gorilla mux routes?", "body": "<p>i am using <a href=\"http://www.gorillatoolkit.org/pkg/mux\" rel=\"noreferrer\">Gorilla Mux</a> for writing a REST API and i am having trouble organizing my routes, currently all of my routes are defined in the <code>main.go</code> file like this</p>\n\n<pre><code>//main.go\npackage main\n\nimport (\n    \"NovAPI/routes\"\n    \"fmt\"\n    \"github.com/gorilla/mux\"\n    \"net/http\"\n)\n\nfunc main() {\n\n    router := mux.NewRouter().StrictSlash(true)\n\n    router.HandleFunc(\"/hello\", func(res http.ResponseWriter, req *http.Request) {\n        fmt.Fprintln(res, \"Hello\")\n    })\n\n    router.HandleFunc(\"/user\", func(res http.ResponseWriter, req *http.Request) {\n        fmt.Fprintln(res, \"User\")\n    })\n\n    router.HandleFunc(\"/route2\", func(res http.ResponseWriter, req *http.Request) {\n        fmt.Fprintln(res, \"Route2\")\n    })\n\n    router.HandleFunc(\"/route3\", func(res http.ResponseWriter, req *http.Request) {\n        fmt.Fprintln(res, \"Route3\")\n    })\n\n    // route declarations continue like this\n\n    http.ListenAndServe(\":1128\", router)\n\n}\n</code></pre>\n\n<p>so what i want to do is take out and split this route declaration into multiple files, how would i go about doing that? <strong>thanks in advance.</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1451639853, "post_id": 34547457, "comment_id": 56852557, "body": "Go doesn&#39;t have a <code>char</code> type. Those are <code>rune</code> literals and <code>rune</code> is a type alias for <code>int32</code>. See <a href=\"https://golang.org/ref/spec#Rune_literals\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Rune_literals</a> for more details."}], "answers": [{"comments": [{"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 0, "creation_date": 1451640747, "post_id": 34547729, "comment_id": 56852712, "body": "reflect.TypeOf(&#39;a&#39;) returns int32 even via a variable. <a href=\"http://play.golang.org/p/udDxnPquaA\" rel=\"nofollow noreferrer\">play.golang.org/p/udDxnPquaA</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 1, "creation_date": 1451929095, "post_id": 34547729, "comment_id": 56938726, "body": "@voutasaurus: The &quot;default type&quot; of an untyped constant written as a rune literal is <code>rune</code>, which is simply an alias for <code>int32</code>. Since reflect has to convert it to a valid type to determine what it is, both versions print <code>int32</code>. I added a link to the &quot;Constants&quot; spec which explains default types."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1451928916, "last_edit_date": 1451928916, "creation_date": 1451571891, "answer_id": 34547729, "question_id": 34547457, "link": "https://stackoverflow.com/questions/34547457/what-this-array-init-syntax-mean-elements-with-keys/34547729#34547729", "title": "What this array init syntax mean? (elements with keys)", "body": "<p>For an array or slice literal, the index values must be constants. From the docs on <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow\">\"composite literals\"</a></p>\n\n<blockquote>\n  <p>For array and slice literals the following rules apply:</p>\n  \n  <ul>\n  <li>Each element has an associated integer index marking its position in the array.</li>\n  <li>An element with a key uses the key as its index; the key must be a constant integer expression.</li>\n  <li>An element without a key uses the previous element's index plus one. If the first element has no key, its index is zero.</li>\n  </ul>\n</blockquote>\n\n<p>The literal characters in the example are untyped <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow\">constants</a>, which just happen to be written as a single rune literal. If you were to assign any of those values to a variable to use as the index, the code would not compile.</p>\n"}], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 1, "accepted_answer_id": 34547729, "answer_count": 1, "score": 7, "last_activity_date": 1451928916, "creation_date": 1451570267, "last_edit_date": 1451581549, "question_id": 34547457, "link": "https://stackoverflow.com/questions/34547457/what-this-array-init-syntax-mean-elements-with-keys", "title": "What this array init syntax mean? (elements with keys)", "body": "<p>I recently found the code below:</p>\n\n<pre><code>var noEscape = [256]bool{\n    'A': true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true,\n    'a': true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true,\n    '0': true, true, true, true, true, true, true, true, true, true,\n    '-': true,\n    '.': true,\n    '_': true,\n    '~': true,\n}\n</code></pre>\n\n<p>I understand that this <code>[N]bool</code> is initialized with N <code>false</code> (zeros) by default. And if the index followed by a colon is specified values can are defined form the index (inclusive). Where is it described? What types can be used as an index value (there is a <code>char</code> in the example)?</p>\n"}, {"tags": ["go", "types", "assertion"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1451580788, "post_id": 34545019, "comment_id": 56840735, "body": "In the more general case (i.e. outside of JSON) you could just create a type switch - <a href=\"https://golang.org/doc/effective_go.html#type_switch\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#type_switch</a> - and only create cases for the types you &#39;care&#39; about. Have the <code>default</code> case return an error."}], "answers": [{"comments": [{"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1451558549, "post_id": 34545098, "comment_id": 56831900, "body": "Aha! Thanks. That makes sense. I think key is to stick to <code>int64</code> in my user input parser logic."}, {"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1451576699, "post_id": 34545098, "comment_id": 56839092, "body": "These two interfaces are still possible from JSON or user input, so that  they could either be float64 or int64. Seems a 2x2 metrics comparison is still inevitable."}, {"owner": {"reputation": 376, "user_id": 2348705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13a37cab3b0733af5c7829aa1d8278b1?s=128&d=identicon&r=PG", "display_name": "Igor Dubinskiy", "link": "https://stackoverflow.com/users/2348705/igor-dubinskiy"}, "reply_to_user": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 1, "creation_date": 1451590075, "post_id": 34545098, "comment_id": 56843961, "body": "@ElgsQianChen If you are unmarshalling JSON into a <code>map[string]interface{}</code>, the <code>encoding&#47;json</code> package <i>guarantees</i> that all numbers will be <code>float64</code>. If you&#39;re unmarshalling into a struct, you can just make the field whatever numeric type you need, or use <a href=\"https://golang.org/pkg/encoding/json/#Number\" rel=\"nofollow noreferrer\"><code>json.Number</code></a>."}], "tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": true, "score": 6, "last_activity_date": 1451558282, "creation_date": 1451558282, "answer_id": 34545098, "question_id": 34545019, "link": "https://stackoverflow.com/questions/34545019/golang-compare-numbers/34545098#34545098", "title": "Golang compare numbers", "body": "<p>If your input comes from JSON input, then it's a <code>float64</code>, as per the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"noreferrer\">doc</a>:</p>\n\n<blockquote>\n  <p>To unmarshal JSON into an interface value, Unmarshal stores one of these in the interface value:</p>\n  \n  <ul>\n  <li>bool, for JSON booleans</li>\n  <li>float64, for JSON numbers</li>\n  <li>string, for JSON strings</li>\n  <li>[]interface{}, for JSON arrays</li>\n  <li>map[string]interface{}, for JSON objects</li>\n  <li>nil for JSON null</li>\n  </ul>\n</blockquote>\n\n<p>If its comes from user input, it is whatever you decided it was when you read it, so you shouldn't have any problem to get the right type.</p>\n"}], "owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5259, "favorite_count": 0, "accepted_answer_id": 34545098, "answer_count": 1, "score": 1, "last_activity_date": 1451558282, "creation_date": 1451557943, "question_id": 34545019, "link": "https://stackoverflow.com/questions/34545019/golang-compare-numbers", "title": "Golang compare numbers", "body": "<p>I have two <code>interface{}</code>s <code>a</code> and <code>b</code> from JSON decoding and user input, let's say: </p>\n\n<pre><code>var a interface{} = ...\nvar b interface{} = ...\n</code></pre>\n\n<p>I know they are numbers. They could be any of the following types:</p>\n\n<pre><code>unit\nunit8\nuint16\nuint32\nuint64\nint\nint8\nint16\nint32\nint64\nfloat\nfloat32\nfloat64\n</code></pre>\n\n<p>I wrote some test code as follows. It turned out that when a variable is <code>int</code>, it will fail with <code>int64</code> assertion.</p>\n\n<pre><code>var a interface{} = 1\nv, f := a.(int64)\nfmt.Println(v, f) //0 false\nv1, f1 := a.(int)\nfmt.Println(v1, f1) //1 true\n</code></pre>\n\n<p>So now my question is as follows: in order to compare these two numbers, do I have to test all the permutations of these more than 10 types just in order to get the types of these two <code>interface{}</code> variables? Ideally, I just want to cast them to <code>int64</code> or <code>float64</code>, but if they are <code>int</code> or <code>float</code>, I have no way to find them until exhausted all possible types.</p>\n"}, {"tags": ["pointers", "struct", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1451569200, "post_id": 34543430, "comment_id": 56836124, "body": "Go has no notion of &quot;references&quot;. Don&#39;t name pointers &quot;references&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "edited": false, "score": 0, "creation_date": 1451569563, "post_id": 34543716, "comment_id": 56836263, "body": "<code>iDoTakeAPointer</code> function also receives a copy of the pointer (but the data it points to is exactly the same)."}, {"owner": {"reputation": 47877, "user_id": 414062, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/xc7mu.jpg?s=128&g=1", "display_name": "Dominic", "link": "https://stackoverflow.com/users/414062/dominic"}, "edited": false, "score": 0, "creation_date": 1556907512, "post_id": 34543716, "comment_id": 98601049, "body": "I find <code>new</code> a completely bizarre decision from the go team, <code>&amp;</code> is what other languages use, <code>new</code> seems like you&#39;re allocating memory and copying the item to it which is the inverse."}], "tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": true, "score": 62, "last_activity_date": 1451552799, "last_edit_date": 1451552799, "creation_date": 1451551959, "answer_id": 34543716, "question_id": 34543430, "link": "https://stackoverflow.com/questions/34543430/golang-basics-struct-and-new-keyword/34543716#34543716", "title": "Golang basics struct and new() keyword", "body": "<p><code>new</code> allocates zeroed storage for a new item or type whatever and then returns a pointer to it. I don't think it really matters on if you use <code>new</code> vs short variable declaration <code>:= type{}</code> it's mostly just preference</p>\n\n<p>As for <code>pointer2</code>, the <code>pointer2</code> variable holds its own data, when you do </p>\n\n<pre><code>// initializing a zeroed 'passport in memory'\npointerp2 := new(passport)\n// setting the field Name to whatever\npointerp2.Name = \"Anotherscott\"\n</code></pre>\n\n<p><code>new</code> allocates zeroed storage in memory and returns a pointer to it, so in short, new will return a pointer to whatever you're making that is why <code>pointerp2</code> returns <code>&amp;{ Anotherscott }</code></p>\n\n<p>You mainly want to use pointers when you're passing a variable around that you need to modify (but be careful of data races use mutexes or channels If you need to read and write to a variable from different functions)</p>\n\n<p>A common method people use instead of <code>new</code> is just short dec a pointer type:</p>\n\n<p><code>blah := &amp;passport{}</code></p>\n\n<p>blah is now a pointer to type passport</p>\n\n<p>You can see in this playground:</p>\n\n<p><a href=\"http://play.golang.org/p/9OuM2Kqncq\" rel=\"noreferrer\">http://play.golang.org/p/9OuM2Kqncq</a></p>\n\n<p>When passing a pointer, you can modify the original value. When passing a non pointer you can't modify it. That is because in go variables are passed as a copy. So in the <code>iDontTakeAPointer</code> function it is receiving a copy of the tester struct then modifying the name field and then returning, which does nothing for us as it is modifying the copy and not the original. </p>\n"}, {"comments": [{"owner": {"reputation": 376, "user_id": 2348705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13a37cab3b0733af5c7829aa1d8278b1?s=128&d=identicon&r=PG", "display_name": "Igor Dubinskiy", "link": "https://stackoverflow.com/users/2348705/igor-dubinskiy"}, "reply_to_user": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1451555263, "post_id": 34543789, "comment_id": 56830377, "body": "@Datsik It <i>prints</i> <code>[]</code>, but its value <code>nil</code>; see <a href=\"https://tour.golang.org/moretypes/11\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/11</a>. There&#39;s also a good discussion at <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/vNodYyoUu9Q\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/vNodYyoUu9Q</a>. TL;DR: a nil slice acts like an empty slice in many ways. <a href=\"https://github.com/golang/go/issues/12780#issuecomment-144051177\" rel=\"nofollow noreferrer\">&quot;This is intended behaviour and even documented behaviour.&quot;</a>."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1451555857, "post_id": 34543789, "comment_id": 56830638, "body": "I&#39;m aware of that, but just for the next new commers to read this should understand that, even though they see [] it is still actually nil. Case in point would be getting null for a json value: <a href=\"http://play.golang.org/p/GiQnKssZjH\" rel=\"nofollow noreferrer\">play.golang.org/p/GiQnKssZjH</a> even though when you&#39;re debugging you think you have an empty slice"}], "tags": [], "owner": {"reputation": 376, "user_id": 2348705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13a37cab3b0733af5c7829aa1d8278b1?s=128&d=identicon&r=PG", "display_name": "Igor Dubinskiy", "link": "https://stackoverflow.com/users/2348705/igor-dubinskiy"}, "is_accepted": false, "score": 4, "last_activity_date": 1451553086, "last_edit_date": 1491982277, "creation_date": 1451552377, "answer_id": 34543789, "question_id": 34543430, "link": "https://stackoverflow.com/questions/34543430/golang-basics-struct-and-new-keyword/34543789#34543789", "title": "Golang basics struct and new() keyword", "body": "<ol>\n<li><p>There is variable that holds the data yet. You can dereference the pointer using <code>*pointerp2</code>, and even assign it that to a variable (<code>p2 := pointerp2</code>), but this variable would be a copy of the data. That is, modifying one no longer affects the other (<a href=\"http://play.golang.org/p/9yRYbyvG8q\" rel=\"nofollow noreferrer\">http://play.golang.org/p/9yRYbyvG8q</a>).</p></li>\n<li><p><code>new</code> tends to be less popular, especially with regard to structs. A good discussion of its purpose (hint: it came first) and use cases can be found at <a href=\"https://softwareengineering.stackexchange.com/a/216582\">https://softwareengineering.stackexchange.com/a/216582</a>.</p></li>\n</ol>\n\n<p>Edit: Also, <code>p1</code> is not really a different kind of initialization from <code>p3</code>, but instead of assigning a value to any of the type's fields they are initialized to their zero value (<code>\"\"</code> for <code>string</code>, <code>nil</code> for <code>[]byte</code>). The same would happen for any omitted fields:</p>\n\n<pre><code>p4 := passport{\n    Name: \"Scott\",\n    Surname: \"Adam\",\n}\n</code></pre>\n\n<p>In this case, <code>p4.Photo</code> and <code>p4.DateOfBirth</code> would still be zero-valued (<code>nil</code> and <code>\"\"</code> respectively). The <code>passport{}</code> case it just one where all the fields are omitted.</p>\n"}, {"tags": [], "owner": {"reputation": 3405, "user_id": 7034183, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YcIEw.jpg?s=128&g=1", "display_name": "Remario", "link": "https://stackoverflow.com/users/7034183/remario"}, "is_accepted": false, "score": 2, "last_activity_date": 1514749583, "creation_date": 1514749583, "answer_id": 48045276, "question_id": 34543430, "link": "https://stackoverflow.com/questions/34543430/golang-basics-struct-and-new-keyword/48045276#48045276", "title": "Golang basics struct and new() keyword", "body": "<p>All the new keyword does is basically create a instance of the type you want. However instead of returning the plain declaration of the type, it references it and return the acutal memory address of that type in the program process heap. </p>\n"}], "owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52454, "favorite_count": 11, "accepted_answer_id": 34543716, "answer_count": 3, "score": 41, "last_activity_date": 1514749583, "creation_date": 1451550466, "question_id": 34543430, "link": "https://stackoverflow.com/questions/34543430/golang-basics-struct-and-new-keyword", "title": "Golang basics struct and new() keyword", "body": "<p>I was learning golang, and as I was going through the chapter that describes Structures, I came across different ways to initialize structures. </p>\n\n<pre><code>p1 := passport{}\nvar p2 passport\np3 := passport{\n    Photo: make([]byte, 0, 0),\n    Name: \"Scott\",\n    Surname: \"Adam\",\n    DateOfBirth: \"Some time\",\n}\n\nfmt.Printf(\"%s\\n%s\\n%s\\n\", p1, p2, p3)\n</code></pre>\n\n<p>While these print the values of the structures as</p>\n\n<p><code>{   }\n{   }\n{ Scott Adam Some time}</code>\n, the following code below prints with an ampersand because it is a reference.</p>\n\n<pre><code>pointerp1 := &amp;p3\nfmt.Printf(\"%s\", pointerp1)\npointerp2 := new(passport)\npointerp2.Name = \"Anotherscott\"\nfmt.Printf(\"%s\", pointerp2)\n</code></pre>\n\n<p><code>&amp;{ Scott Adam Some time}&amp;{ Anotherscott  }</code></p>\n\n<p>Kindly help me with my doubts.</p>\n\n<ol>\n<li><p>in the usage <code>pointerp1 := &amp;p3</code>, <code>pointerp1</code> is the reference variable to <code>p3</code>, which holds the actual data. Similarly, what would be the actual variable that holds the data for <code>pointerp2</code>?</p></li>\n<li><p>What would be the best scenarios to use these different types of initialization?</p></li>\n</ol>\n"}]