[{"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514455166, "post_id": 47999605, "comment_id": 82978836, "body": "<code>I&#39;m new to the go language and functional programming.</code> -- Go is not a functional language."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514475422, "post_id": 47999605, "comment_id": 82988752, "body": "&quot;enumerate the benefits&quot; is both too broad and opinion-based. Try a web search for <i>uses for anonymous functions</i> or something."}, {"owner": {"reputation": 43, "user_id": 4729739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grFHx.jpg?s=128&g=1", "display_name": "jorge pirro", "link": "https://stackoverflow.com/users/4729739/jorge-pirro"}, "edited": false, "score": 0, "creation_date": 1514559723, "post_id": 47999605, "comment_id": 83018188, "body": "I never said that go is a functional language. I only said I&#39;m new to the idea of functional programming and Go."}], "answers": [{"comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1514419575, "post_id": 47999775, "comment_id": 82968605, "body": "Also <a href=\"https://golang.org/pkg/path/filepath/#WalkFunc\" rel=\"nofollow noreferrer\"><code>filepath.WalkFunc</code></a>."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 3, "last_activity_date": 1514438489, "last_edit_date": 1514438489, "creation_date": 1514417057, "answer_id": 47999775, "question_id": 47999605, "link": "https://stackoverflow.com/questions/47999605/anonymous-functions-in-golang/47999775#47999775", "title": "Anonymous Functions in Golang", "body": "<p>A function literal represents an anonymous function. The <a href=\"https://golang.org/ref/spec#Function_literals\" rel=\"nofollow noreferrer\">specification mentions the primary benefit of function literals</a>:</p>\n\n<blockquote>\n  <p>Function literals are closures: they may refer to variables defined in a surrounding function. Those variables are then shared between the surrounding function and the function literal, and they survive as long as they are accessible.</p>\n</blockquote>\n\n<p>Here are some examples uses of anonymous functions: <a href=\"https://godoc.org/sort#example-Slice\" rel=\"nofollow noreferrer\">sort.Slice</a>, <a href=\"https://godoc.org/net/http#example-ServeMux-Handle\" rel=\"nofollow noreferrer\">http mux.HandleFunc</a>, <a href=\"https://golang.org/doc/effective_go.html#recover\" rel=\"nofollow noreferrer\">panic recovery</a>, <a href=\"https://golang.org/doc/effective_go.html#goroutines\" rel=\"nofollow noreferrer\">goroutines</a>, <a href=\"https://stackoverflow.com/questions/40042698/how-to-pass-a-variable-in-a-golang-callback-function\">filepath.Walk</a>, <a href=\"https://godoc.org/go/ast#example-Inspect\" rel=\"nofollow noreferrer\">ast.Inspect</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1132, "user_id": 1754827, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/GGorI.png?s=128&g=1", "display_name": "Aurelia", "link": "https://stackoverflow.com/users/1754827/aurelia"}, "is_accepted": false, "score": 0, "last_activity_date": 1514417408, "creation_date": 1514417408, "answer_id": 47999820, "question_id": 47999605, "link": "https://stackoverflow.com/questions/47999605/anonymous-functions-in-golang/47999820#47999820", "title": "Anonymous Functions in Golang", "body": "<p>The specific use case for function literals that are not stored in a variable and executed immediately is creating a new function scope to run <code>defer</code> in.</p>\n\n<p>As an example, if you use <code>sync.Mutex</code> (which in a lot of cases should be replaced by channels, but that's another topic) you can scope a piece of code that needs a certain mutex locked down and still use defered unlock without keeping the mutex locked during the entire function run.</p>\n\n<p>You can also defer the anonymous function if you don't want to run it immediately. This is often used with <code>recover</code> to handle panics within the function call.</p>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 4729739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grFHx.jpg?s=128&g=1", "display_name": "jorge pirro", "link": "https://stackoverflow.com/users/4729739/jorge-pirro"}, "edited": false, "score": 0, "creation_date": 1514559421, "post_id": 47999857, "comment_id": 83018053, "body": "Thanks for the reply but it would be better to use smaller functions because: 1. They are self-documenting 2. They are unit testable."}], "tags": [], "owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "is_accepted": false, "score": 2, "last_activity_date": 1514417805, "creation_date": 1514417805, "answer_id": 47999857, "question_id": 47999605, "link": "https://stackoverflow.com/questions/47999605/anonymous-functions-in-golang/47999857#47999857", "title": "Anonymous Functions in Golang", "body": "<p>An example from the <a href=\"https://golang.org/pkg/net/http/#ListenAndServe\" rel=\"nofollow noreferrer\">Go documentation for <code>net/http</code></a>.</p>\n\n<p>Here's a simple web server handling the path <code>/hello</code>:</p>\n\n<pre><code>package main\n\nimport (\n  \"io\"\n  \"net/http\"\n  \"log\"\n)\n\n// hello world, the web server\nfunc HelloServer(w http.ResponseWriter, req *http.Request) {\n  io.WriteString(w, \"hello, world!\\n\")\n}\n\nfunc main() {\n  http.HandleFunc(\"/hello\", HelloServer)\n  log.Fatal(http.ListenAndServe(\":12345\", nil))\n}\n</code></pre>\n\n<p>Do you notice that the function <code>HelloServer</code> is defined only to be passed to the call to <code>http.HandleFunc</code> on the first line of <code>main</code>? Using an anonymous function this could instead be written:</p>\n\n<pre><code>package main\n\nimport (\n  \"io\"\n  \"net/http\"\n  \"log\"\n)\n\nfunc main() {\n  http.HandleFunc(\"/hello\", func (w http.ResponseWriter, req *http.Request) {\n    io.WriteString(w, \"hello, world!\\n\")\n  })\n\n  log.Fatal(http.ListenAndServe(\":12345\", nil))\n}\n</code></pre>\n\n<p>When a function only needs to be used at one place, it might be a good idea to use an anonymous function, especially when its body is small.</p>\n"}], "owner": {"reputation": 43, "user_id": 4729739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/grFHx.jpg?s=128&g=1", "display_name": "jorge pirro", "link": "https://stackoverflow.com/users/4729739/jorge-pirro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1922, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1514438489, "creation_date": 1514415645, "question_id": 47999605, "link": "https://stackoverflow.com/questions/47999605/anonymous-functions-in-golang", "title": "Anonymous Functions in Golang", "body": "<p>I'm new to the go language and functional programming. </p>\n\n<p>My question is:  but can you enumerate the benefits of anonymous functions in golang. I understand from this <a href=\"https://golangcode.com/anonymous-functions/\" rel=\"nofollow noreferrer\">site</a> that anonymous functions are \"segments code which will only need to get run once and doesn\u2019t need to be referenced.\" but I can't find the benefit from them.</p>\n"}, {"tags": ["go", "types", "syntax"], "comments": [{"owner": {"reputation": 2337, "user_id": 4699289, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/WYFjz.jpg?s=128&g=1", "display_name": "Sam Houston", "link": "https://stackoverflow.com/users/4699289/sam-houston"}, "edited": false, "score": 0, "creation_date": 1514418215, "post_id": 47999597, "comment_id": 82968322, "body": "Why the downvote? How should I be constructing my questions better?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1514455251, "post_id": 47999597, "comment_id": 82978895, "body": "I haven&#39;t down voted, but I would imagine the down votes are for the normal reason: lack of research effort."}, {"owner": {"reputation": 2337, "user_id": 4699289, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/WYFjz.jpg?s=128&g=1", "display_name": "Sam Houston", "link": "https://stackoverflow.com/users/4699289/sam-houston"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514456487, "post_id": 47999597, "comment_id": 82979577, "body": "Fair enough, next time I&#39;ll spend more time with a programming language before asking any questions"}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 0, "creation_date": 1514580617, "post_id": 47999597, "comment_id": 83026548, "body": "If you declare your maps as <code>map[string]interface{}</code>, then you can iterate over keys (which are strings in all cases) with a unique function."}], "answers": [{"tags": [], "owner": {"reputation": 1356, "user_id": 5688488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b0072c03a45630ffe30f8a9e1a3f00?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Kadish", "link": "https://stackoverflow.com/users/5688488/benjamin-kadish"}, "is_accepted": false, "score": 3, "last_activity_date": 1514415910, "creation_date": 1514415910, "answer_id": 47999644, "question_id": 47999597, "link": "https://stackoverflow.com/questions/47999597/func-that-can-take-multiple-types/47999644#47999644", "title": "func that can take multiple types", "body": "<p>A way to solve this problem is to use \"interface{}\" when creating the maps and then use a <a href=\"https://tour.golang.org/methods/16\" rel=\"nofollow noreferrer\">type switch</a> statement in the method i.e.</p>\n\n<pre><code>func mapKeys(m map[string]interface{}) []string {\n    for k,v := range m {\n        switch a := v.(type) {\n        case int:\n          ... do int stuff\n        case string:\n          ... do string stuff\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 2, "last_activity_date": 1514416069, "creation_date": 1514416069, "answer_id": 47999662, "question_id": 47999597, "link": "https://stackoverflow.com/questions/47999597/func-that-can-take-multiple-types/47999662#47999662", "title": "func that can take multiple types", "body": "<p>Go does not have user specified generic parameter types, so what you are describing must be done via:</p>\n\n<ol>\n<li>Separate functions that accept the different types you wish to support, or</li>\n<li>A function that accepts the empty interface (<code>interface{}</code>) and uses <a href=\"http://godoc.org/reflect\" rel=\"nofollow noreferrer\">reflection</a>.</li>\n</ol>\n\n<p>Here is an example implementation of the second approach:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    stringStringMap := map[string]string{\n        \"one\": \"first\",\n        \"two\": \"second\",\n    }\n\n    fmt.Println(mapKeys(stringStringMap)) // [\"one\", \"two\"]\n\n    stringIntMap := map[string]int{\n        \"one\": 1,\n        \"two\": 2,\n    }\n\n    fmt.Println(mapKeys(stringIntMap)) // [\"one\", \"two\"]\n}\n\nfunc mapKeys(m interface{}) []string {\n    v := reflect.ValueOf(m)\n    if v.Kind() != reflect.Map {\n        panic(\"m is not a map\")\n    }\n    if v.Type().Key().Kind() != reflect.String {\n        panic(\"m does not have a string key\")\n    }\n    keys := make([]string, 0, v.Len())\n    for _, key := range v.MapKeys() {\n        keys = append(keys, key.String())\n    }\n    return keys\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 0, "creation_date": 1514541824, "post_id": 48005432, "comment_id": 83010508, "body": "@coredump: That depends on perspective. On the screen, the code is seemingly duplicated, but the semantics, and the machine-readable code are not, due to different types. The first for loop is really <code>for var key string = ...</code> and the second is <code>for var key int = ...</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 0, "creation_date": 1514541873, "post_id": 48005432, "comment_id": 83010538, "body": "@coredump: Some of the code could be de-duplicated. <code>keys</code> could be defined before the switch (but then one won&#39;t know what size to make it, hurting efficiency), or one could move the <code>return</code> to after the switch.  Both of these options hurt readability, though. But they are options, if one wants to be pedantic :) But the for loops, despite appearing duplicate, really aren&#39;t."}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 0, "creation_date": 1514559736, "post_id": 48005432, "comment_id": 83018192, "body": "It seems that if you want to change how you build <code>keys</code> for <code>string</code> and use a doubly-linked list instead, you are going to change it for <code>int</code> too. That&#39;s pretty much the definition of code duplication (<a href=\"http://wiki.c2.com/?DuplicatedCode\" rel=\"nofollow noreferrer\">wiki.c2.com/?DuplicatedCode</a>, <a href=\"https://en.wikipedia.org/wiki/Duplicate_code\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Duplicate_code</a>). Even if the clones might lead each to different machine code, this does not change the fact that what the programmer manipulates, the source, is duplicated; the logic for adding keys is the same. Also, I am not sure the ranges are different: after all, you only iterate over keys."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 1, "creation_date": 1514567531, "post_id": 48005432, "comment_id": 83021534, "body": "@coredump: I welcome you to provide your own, better answer."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1514455508, "creation_date": 1514455508, "answer_id": 48005432, "question_id": 47999597, "link": "https://stackoverflow.com/questions/47999597/func-that-can-take-multiple-types/48005432#48005432", "title": "func that can take multiple types", "body": "<p>There is a third option not mentioned yet, and that is to use a type switch. This may be a good option if you know that you'll be passing a manageable number of types to the function. It would work like this:</p>\n\n<pre><code>func Keys(m interface{}) ([]string, error) {\n    switch t := m.(type) {\n    case map[string]string:\n        keys := make([]string, 0, len(t))\n        for key := range t {\n            keys = append(keys, key)\n        }\n        return keys, nil\n    case map[string]int:\n        keys := make([]string, 0, len(t))\n        for key := range t {\n            keys = append(keys, key)\n        }\n        return keys, nil\n    default:\n        return nil, fmt.Errorf(\"unknown map type: %T\", m)\n    }\n}\n</code></pre>\n\n<p>This still gives you a bunch of seemingly duplicate code, but at least it's all behind a single function name, and it's more efficient than reflection.</p>\n"}], "owner": {"reputation": 2337, "user_id": 4699289, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/WYFjz.jpg?s=128&g=1", "display_name": "Sam Houston", "link": "https://stackoverflow.com/users/4699289/sam-houston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1199, "favorite_count": 2, "accepted_answer_id": 48005432, "answer_count": 3, "score": 0, "last_activity_date": 1514455508, "creation_date": 1514415594, "question_id": 47999597, "link": "https://stackoverflow.com/questions/47999597/func-that-can-take-multiple-types", "title": "func that can take multiple types", "body": "<p>I'm trying to create a helper function which will take a map with string keys and return a slice of the map keys.</p>\n\n<p>The problem is that I want the function to not care about the type of the map values.</p>\n\n<p>For example:</p>\n\n<pre><code>stringStringMap := map[string]string{\n    \"one\": \"first\",\n    \"two\": \"second\"\n}\n\nmapKeys(stringStringMap) // [\"one\", \"two\"]\n\nstringIntMap := map[string]int{\n    \"one\": 1,\n    \"two\": 2,\n}\n\nmapKeys(strinIntMap) // [\"one\", \"two\"]\n</code></pre>\n\n<p>It seems that the only way around this problem is to create two similar helpers. Something like this:</p>\n\n<pre><code>func mapKeys(m map[string]string) []string {\n    ...\n}\n\nfunc mapKeys2(m map[string]int) []string {\n    ...\n}\n</code></pre>\n\n<p>But this seems ugly. Is this helper function I'm trying to create possible?If not, is there a good convention I should follow when writing this?</p>\n"}, {"tags": ["node.js", "go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 1, "last_activity_date": 1514413724, "last_edit_date": 1514413724, "creation_date": 1514413282, "answer_id": 47999318, "question_id": 47999304, "link": "https://stackoverflow.com/questions/47999304/node-js-buffer-from-hex-and-readuint16be-in-golang/47999318#47999318", "title": "Node.js Buffer from hex and readUInt16BE in Golang", "body": "<p>You are appending a decimal value of 24 to the buffer, when you should be appending the hexadecimal value 0x24:</p>\n\n<pre><code>v := make([]byte, 0, 2)\nv = append(v, 0)\nv = append(v, 0x24)\nfmt.Println(v)\n\nx := binary.BigEndian.Uint16(v)\nfmt.Println(x)\n</code></pre>\n\n<p>Converting the the original Node.js code to Go would look something like the following:</p>\n\n<pre><code>import (\n    \"encoding/binary\"\n    \"encoding/hex\"\n)\n\nb, err := hex.DecodeString(`002400050200000000320000000003847209cd4450ff94ad8c0000000002c581000001d3`)\nif err != nil {\n    // TODO: handle error\n}\n_ = binary.BigEndian.Uint16(b[:2])\n</code></pre>\n"}], "owner": {"reputation": 516, "user_id": 2491419, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/39a71c3bc86fc29820738ffaddb4877a?s=128&d=identicon&r=PG", "display_name": "Danilo Aburto Vivians", "link": "https://stackoverflow.com/users/2491419/danilo-aburto-vivians"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 701, "favorite_count": 0, "accepted_answer_id": 47999318, "answer_count": 1, "score": 0, "last_activity_date": 1514413724, "creation_date": 1514413155, "question_id": 47999304, "link": "https://stackoverflow.com/questions/47999304/node-js-buffer-from-hex-and-readuint16be-in-golang", "title": "Node.js Buffer from hex and readUInt16BE in Golang", "body": "<p>I have a code like this in nodejs:</p>\n\n<pre><code>// Create Buffer from hex representation\nb = new Buffer('002400050200000000320000000003847209cd4450ff94ad8c0000000002c581000001d3', 'hex')\n\n// Read with offset 0\nb.readUInt16BE(0) // -&gt; Out: 36\n</code></pre>\n\n<p>It reads a string which is an hex representation of data. When first two bytes are read readUInt16BE, an int (36) is obtained. That is the expected behavior.</p>\n\n<p>I need to replicate this behavior using Go, but I have some troubles.</p>\n\n<p>1) How to create a buffer from an string in hex format?\n2) How to implement a readUInt16BE function in order to obtain (36) when first two bytes are read?</p>\n\n<p>I can create a buffer with 00 24, but I need to use any string.</p>\n\n<pre><code>// Creates buffer [00 24]\nv := make([]byte, 0, 2)\nv = append(v, 0)\nv = append(v, 24)\nfmt.Println(v) // -&gt; out: [0 24]\n</code></pre>\n\n<p>Finally, I am a little confused with function binary.BigEndian.Uint16, which is returning 24 instead 36.</p>\n\n<pre><code>x := binary.BigEndian.Uint16(v)\nfmt.Println(x) // -&gt; out: 24\n</code></pre>\n\n<p>Can you help me to understand this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514407192, "post_id": 47998359, "comment_id": 82965082, "body": "Can you mark the line in your source that&#39;s last in the stack trace from the panic?"}, {"owner": {"reputation": 1169, "user_id": 498109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100036fbeed75b1abf5bf0161d1fb560?s=128&d=identicon&r=PG", "display_name": "Vadyus", "link": "https://stackoverflow.com/users/498109/vadyus"}, "edited": false, "score": 0, "creation_date": 1514407414, "post_id": 47998359, "comment_id": 82965161, "body": "I bet it&#39;s <code>b, err := ioutil.ReadAll(resp.Body)</code>"}, {"owner": {"reputation": 461, "user_id": 7647297, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-IkUGmoG0Wxw/AAAAAAAAAAI/AAAAAAAAABw/Wk5yAPARLxM/photo.jpg?sz=128", "display_name": "Rohit Kumar", "link": "https://stackoverflow.com/users/7647297/rohit-kumar"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514407531, "post_id": 47998359, "comment_id": 82965200, "body": "@Adrian please see the edit."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1169, "user_id": 498109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100036fbeed75b1abf5bf0161d1fb560?s=128&d=identicon&r=PG", "display_name": "Vadyus", "link": "https://stackoverflow.com/users/498109/vadyus"}, "edited": false, "score": 0, "creation_date": 1514407587, "post_id": 47998359, "comment_id": 82965226, "body": "@Vadyus why would that be? The response body will not be <code>nil</code>. It may be empty, but it will not be <code>nil</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514407665, "post_id": 47998359, "comment_id": 82965251, "body": "Rohit, can you double-check the error and the source? Line 41 in the quoted source is the closing brace of <code>main</code>, which cannot generate a nil pointer dereference error."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1514407733, "post_id": 47998359, "comment_id": 82965273, "body": "Actually, on closer inspection, I&#39;d be willing to bet it&#39;s the very last block. You&#39;re calling <code>err.Error()</code> outside of any block that checks if <code>err</code> is <code>nil</code> or not."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1514407746, "post_id": 47998359, "comment_id": 82965276, "body": "You\u2019re not handling the error, you\u2019re only printing it. The response isn\u2019t valid after an error."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514407902, "post_id": 47998359, "comment_id": 82965329, "body": "Good catch, I didn&#39;t notice it wasn&#39;t bailing after the errors. So, yes... it should exit after an error (or at least not try to use the response after an error), and it shouldn&#39;t try to use the error unless it&#39;s checked that it&#39;s not <code>nil</code>."}, {"owner": {"reputation": 461, "user_id": 7647297, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-IkUGmoG0Wxw/AAAAAAAAAAI/AAAAAAAAABw/Wk5yAPARLxM/photo.jpg?sz=128", "display_name": "Rohit Kumar", "link": "https://stackoverflow.com/users/7647297/rohit-kumar"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514408684, "post_id": 47998359, "comment_id": 82965591, "body": "@Adrian yes. you are right. Thanks :)"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 2, "last_activity_date": 1514414403, "last_edit_date": 1514414403, "creation_date": 1514410814, "answer_id": 47998970, "question_id": 47998359, "link": "https://stackoverflow.com/questions/47998359/golang-panic-runtime-error-invalid-memory-address-or-nil-pointer-dereference/47998970#47998970", "title": "Golang panic: runtime error: invalid memory address or nil pointer dereference", "body": "<p>As mentioned by commenters, your code is only <em>printing</em> errors, not <em>handling</em> them by altering the behavior of the program.</p>\n\n<pre><code>resp, err := client.Do(req)\nif err != nil {\n    fmt.Printf(\"server not responding %s\", err.Error())\n}\n// ...\n\nb, err := ioutil.ReadAll(resp.Body)\n</code></pre>\n\n<p>In the snippet above, if there was an error then it gets printed; however, flow control proceeds as usual even though the \"resp\" object is probably not valid (e.g. nil).</p>\n\n<p>When a library program encounters an error you should usually return it immediately without any further action. For end-user applications, you should usually display the error (typically on the stderr stream) and exit the program (typically with a nonzero exit code). For example:</p>\n\n<pre><code>resp, err := client.Do(req)\nif err != nil {\n    fmt.Fprintf(os.Stderr, \"ERROR: %s\\n\", err)\n    os.Exit(1) // Exit the program if we didn't get a response.\n}\n// ...\n\nb, err := ioutil.ReadAll(resp.Body)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 117, "user_id": 3936574, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/Oybc6.jpg?s=128&g=1", "display_name": "Erabor E.Henry", "link": "https://stackoverflow.com/users/3936574/erabor-e-henry"}, "is_accepted": false, "score": 1, "last_activity_date": 1597700480, "last_edit_date": 1597700480, "creation_date": 1545059573, "answer_id": 53818004, "question_id": 47998359, "link": "https://stackoverflow.com/questions/47998359/golang-panic-runtime-error-invalid-memory-address-or-nil-pointer-dereference/53818004#53818004", "title": "Golang panic: runtime error: invalid memory address or nil pointer dereference", "body": "<p>I am just seeing this question and I just wanted to contribute.\nAs mentioned by @maerics.As mentioned by commenters, your code is only printing errors, not handling them by altering the behavior of the program. My observation is also that there are two places that you are printing out errors and not handling them.</p>\n<pre><code>if err != nil {\n        fmt.Printf(&quot;server not responding %s&quot;, err.Error())\n    }\n</code></pre>\n<p>It should be:</p>\n<pre><code>if err != nil {\n        fmt.Printf(&quot;server not responding %s&quot;, err.Error())\n        return // the return statement here helps to handle the error\n    }\n</code></pre>\n<p>Also the second one which is :</p>\n<pre><code>if err != nil {\n        fmt.Printf(&quot;Test case failed with error %s&quot;, err.Error())\n    }\n</code></pre>\n<p>It should rather be :</p>\n<pre><code>if err != nil {\n        fmt.Printf(&quot;Test case failed with error %s&quot;, err.Error())\n        return // the return statement here helps to handle the error\n    }\n</code></pre>\n"}], "owner": {"reputation": 461, "user_id": 7647297, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh4.googleusercontent.com/-IkUGmoG0Wxw/AAAAAAAAAAI/AAAAAAAAABw/Wk5yAPARLxM/photo.jpg?sz=128", "display_name": "Rohit Kumar", "link": "https://stackoverflow.com/users/7647297/rohit-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7803, "favorite_count": 0, "accepted_answer_id": 47998970, "answer_count": 2, "score": -1, "last_activity_date": 1597700480, "creation_date": 1514407112, "last_edit_date": 1514407494, "question_id": 47998359, "link": "https://stackoverflow.com/questions/47998359/golang-panic-runtime-error-invalid-memory-address-or-nil-pointer-dereference", "title": "Golang panic: runtime error: invalid memory address or nil pointer dereference", "body": "<p>i'm new to golang and it may be a very basic thing but i can't seems to find the solution.</p>\n\n<p>the request return json which is like this.</p>\n\n<pre><code>{\"uuid\":\"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a22\",\"name\":\"core1\",\"owner\":\"systems\",\"description\":\"new\",\"creation_date\":\"2017-06-10T14:20:00Z\"}\n</code></pre>\n\n<p>This is the gocode.  </p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\ntype Project struct {\n    Uuid          string `json:\"uuid\"`\n    Name          string `json:\"name\"`\n    Owner         string `json:\"owner\"`\n    Description   string `json:\"description\"`\n    Creation_date string `json:\"creation_date\"`\n}\n\nfunc main() {\n    tr := &amp;http.Transport{\n        TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},\n    }\n    client := &amp;http.Client{Transport: tr}\n    req, err := http.NewRequest(\"GET\", \"https://localhost:4443/project/core1\", nil)\n    req.SetBasicAuth(\"rohit\", \"rohit\")\n    resp, err := client.Do(req)\n    if err != nil {\n        fmt.Printf(\"server not responding %s\", err.Error())\n    }\n    var p Project\n\n    b, err := ioutil.ReadAll(resp.Body)\n    defer resp.Body.Close()\n    err = json.Unmarshal(b, &amp;p)\n    if err != nil {\n        fmt.Printf(\"Test case failed with error %s\", err.Error())\n    }\n    if resp.StatusCode != 403 {\n        fmt.Printf(\"failed %s\", err.Error())\n    }\n}\n</code></pre>\n\n<p>after running i'm getting this error</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0x40142f]\n\ngoroutine 1 [running]:\npanic(0x60c860, 0xc42000c130)\n    /usr/local/go/src/runtime/panic.go:500 +0x1a1\nmain.main()\n    /home/rohitk/Go_projects/src/first_program/test/main.go:41 +0x42f\nexit status 2\n</code></pre>\n\n<p>i checked and response body has right data.\ncan someone please suggest what's happening here.Thanks!</p>\n"}, {"tags": ["go", "collision-detection", "game-engine", "game-physics"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514400802, "post_id": 47997105, "comment_id": 82962580, "body": "It looks like the code is written to do exactly what appears in the GIF, how do you want it to behave?"}, {"owner": {"reputation": 117, "user_id": 1715816, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6a9b11c53cb80e788dfb35fc87813921?s=128&d=identicon&r=PG", "display_name": "Felipe Rocha", "link": "https://stackoverflow.com/users/1715816/felipe-rocha"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514402438, "post_id": 47997105, "comment_id": 82963234, "body": "I would like for the character to stand on top of the enemy if falling from the top, and for the character to stop moving if colliding with the enemy from the right to left. I just don&#39;t see where I&#39;m making my mistake, and I&#39;ve been staring at this code for over two weeks now..."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514403256, "post_id": 47997105, "comment_id": 82963554, "body": "It looks like you do your Y-axis resolution, update <code>NextY</code>, then do your X-axis resolution, which doesn&#39;t know you&#39;ve already resolved Y-axis and they no longer overlap, so it moves them to the side as well."}, {"owner": {"reputation": 117, "user_id": 1715816, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6a9b11c53cb80e788dfb35fc87813921?s=128&d=identicon&r=PG", "display_name": "Felipe Rocha", "link": "https://stackoverflow.com/users/1715816/felipe-rocha"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514408852, "post_id": 47997105, "comment_id": 82965641, "body": "It still doesn&#39;t work. If I change <code>collidingX := IsOverlapping(p1.X, p1.X + c1.W, p2.X, p2.X + c2.W)</code> to <code>collidingX := IsOverlapping(p1.NextX, p1.NextX + c1.W, p2.NextX, p2.NextX + c2.W)</code> and do the same for the Y coordinates, now the character just slides through all the way to the end of the area block, and falls through"}], "owner": {"reputation": 117, "user_id": 1715816, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6a9b11c53cb80e788dfb35fc87813921?s=128&d=identicon&r=PG", "display_name": "Felipe Rocha", "link": "https://stackoverflow.com/users/1715816/felipe-rocha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1514399960, "creation_date": 1514399960, "question_id": 47997105, "link": "https://stackoverflow.com/questions/47997105/weird-issue-in-collision-resolution-of-non-static-bodies", "title": "Weird issue in collision resolution of non-static bodies", "body": "<p>I'm a bit of a beginner in engine development, so I decided to write my own engine from scratch so I could learn more about what happens under everything.</p>\n\n<p>I've been progressing fairly well, except the physics engine side of things have been giving me a bit of a headache.</p>\n\n<p>Here's a gif of what I mean:</p>\n\n<p><a href=\"https://i.stack.imgur.com/2WuqJ.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2WuqJ.gif\" alt=\"Weird collision issue\"></a></p>\n\n<p>Essentially, the engine works just fine as long as the player is not colliding with another non-static body from either above or from right to left. </p>\n\n<p>Here's my collision resolution code written in go:</p>\n\n<pre><code>package resources\n\nimport (\n  \"game/pidgeot-socket/ecs\"\n\n  \"github.com/bxcodec/saint\"\n)\n\ntype PhysicsSystem struct {\n  Hub *Hub\n}\n\nfunc (system PhysicsSystem) Loop() {\n  entities, err := system.Hub.World.AllEntitiesWithComponent(ecs.CollisionComponent)\n  if err != nil { return }\n\n  for e, _ := range entities {\n    // apply impulse\n    c_p, _ := system.Hub.World.GetComponent(e, ecs.CollisionComponent)\n    c := (*c_p).(*ecs.Collision)\n\n    p_p, _ := system.Hub.World.GetComponent(e, ecs.PositionComponent)\n    p := (*p_p).(*ecs.Position)\n\n    if c.WithGravity {\n      // Add gravity\n      c.ImpulseY = saint.Min(c.ImpulseY + 1, c.MaxSpeedY)\n    }\n\n    // apply impulse\n    p.NextY = p.Y + c.ImpulseY\n    p.NextX = p.X + c.ImpulseX\n  }\n\n  // resolving collisions\n  for e1, _ := range entities {\n    c1_p, _ := system.Hub.World.GetComponent(e1, ecs.CollisionComponent)\n    c1 := (*c1_p).(*ecs.Collision)\n\n    if c1.IsStatic { continue }\n\n    for e2, _ := range entities {\n      if e1 == e2 { continue }\n\n      system.ResolveCollision(entities, e1, e2)\n    }\n  }\n\n  // moving entities\n  for e, _ := range entities {\n    p_p, _ := system.Hub.World.GetComponent(e, ecs.PositionComponent)\n    p := (*p_p).(*ecs.Position)\n\n    if (p.X != p.NextX || p.Y != p.NextY) {\n      p.X = p.NextX\n      p.Y = p.NextY\n\n      system.Hub.broadcast &lt;- system.Hub.World.GetComponentMessage(e, p_p)\n    }\n  }\n}\n\nfunc (system PhysicsSystem) ResolveCollision(entities map[ecs.EID]*ecs.Component, e1 ecs.EID, e2 ecs.EID) {\n  c1_p, _ := system.Hub.World.GetComponent(e1, ecs.CollisionComponent)\n  p1_p, _ := system.Hub.World.GetComponent(e1, ecs.PositionComponent)\n  c1 := (*c1_p).(*ecs.Collision)\n  p1 := (*p1_p).(*ecs.Position)\n\n  c2_p, _ := system.Hub.World.GetComponent(e2, ecs.CollisionComponent)\n  p2_p, _ := system.Hub.World.GetComponent(e2, ecs.PositionComponent)\n  c2 := (*c2_p).(*ecs.Collision)\n  p2 := (*p2_p).(*ecs.Position)\n\n  // resolve y-axis\n  collidingX := IsOverlapping(p1.X, p1.X + c1.W, p2.X, p2.X + c2.W)\n  collidingY := IsOverlapping(p1.NextY, p1.NextY + c1.H, p2.NextY, p2.NextY + c2.H)\n  colliding := collidingX &amp;&amp; collidingY\n\n  if colliding {\n    direction := func (impulse int) int {if impulse &lt; 0 { return 1 } else { return -1 }}(c1.ImpulseY)\n    overlap := CalculateOverlap(p1.NextY, p1.NextY + c1.H, p2.NextY, p2.NextY + c2.H)\n\n    p1.NextY += (direction * overlap)\n    c1.ImpulseY = 0\n    c1.IsJumping = false\n  }\n\n  // resolve x-axis\n  collidingX = IsOverlapping(p1.NextX, p1.NextX + c1.W, p2.NextX, p2.NextX + c2.W)\n  collidingY = IsOverlapping(p1.Y, p1.Y + c1.H, p2.Y, p2.Y + c2.H)\n  colliding = collidingX &amp;&amp; collidingY\n\n  if colliding {\n    direction := func (impulse int) int {if impulse &lt; 0 { return 1 } else { return -1 }}(c1.ImpulseX)\n    overlap := CalculateOverlap(p1.NextX, p1.NextX + c1.W, p2.NextX, p2.NextX + c2.W)\n\n    p1.NextX += (direction * overlap)\n  }\n\n  for e3, _ := range entities {\n    if e1 == e3 { continue }\n\n    c3_p, _ := system.Hub.World.GetComponent(e3, ecs.CollisionComponent)\n    p3_p, _ := system.Hub.World.GetComponent(e3, ecs.PositionComponent)\n    c3 := (*c3_p).(*ecs.Collision)\n    p3 := (*p3_p).(*ecs.Position)\n\n    collidingX = IsOverlapping(p1.NextX, p1.NextX + c1.W, p3.NextX, p3.NextX + c3.W)\n    collidingY = IsOverlapping(p1.NextY, p1.NextY + c1.H, p3.NextY, p3.NextY + c3.H)\n    colliding = collidingX &amp;&amp; collidingY\n\n    if colliding { system.ResolveCollision(entities, e1, e3) }\n  }\n}\n</code></pre>\n\n<p>Anything I could do to solve that issue?</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1514397452, "post_id": 47996557, "comment_id": 82961244, "body": "Because it&#39;s uninitialized, therefore <code>nil</code>, which is an invalid argument to Unmarshal as specified in the docs. But a pointer to a nil pointer is not nil itself that&#39;s why that works."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1514397707, "post_id": 47996557, "comment_id": 82961348, "body": ".. to illustrate: <a href=\"https://play.golang.org/p/y3h_dD9bePU\" rel=\"nofollow noreferrer\">play.golang.org/p/y3h_dD9bePU</a>. And the first paragraph <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">here</a> states that an error is returned if v is nil."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1514401640, "last_edit_date": 1514401640, "creation_date": 1514401180, "answer_id": 47997304, "question_id": 47996557, "link": "https://stackoverflow.com/questions/47996557/why-is-unmarshaling-into-a-pointer-variable-not-possible/47997304#47997304", "title": "Why is unmarshaling into a pointer variable not possible?", "body": "<blockquote>\n  <p>Why is unmarshaling into a pointer variable not possible?</p>\n</blockquote>\n\n<p>It is possible. In fact, it's required. Unmarshaling to a non-pointer is not possible.</p>\n\n<blockquote>\n<pre><code>json: Unmarshal(nil *main.configuration)\n</code></pre>\n</blockquote>\n\n<p>This error isn't saying you can't unmarshal to a pointer, it's saying you can't unmarshal to a nil pointer. The pointer must point to a valid (probably zero-value) variable.</p>\n\n<p>Replace</p>\n\n<pre><code>var config *configuration\n</code></pre>\n\n<p>With</p>\n\n<pre><code>config := new(configuration)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>config := &amp;configuration{}\n</code></pre>\n\n<p>and it should work just fine.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 47997304, "answer_count": 1, "score": -6, "last_activity_date": 1514401640, "creation_date": 1514397139, "question_id": 47996557, "link": "https://stackoverflow.com/questions/47996557/why-is-unmarshaling-into-a-pointer-variable-not-possible", "title": "Why is unmarshaling into a pointer variable not possible?", "body": "<p>I use a pointer variable at package level:</p>\n\n<pre><code>var config *configuration\n</code></pre>\n\n<p>But the attempt to unmarshal into the variable results in this error: <code>json: Unmarshal(nil *main.configuration)</code>. However unmarshaling into an pointer to the pointer variable is successful. What is the reason for this?</p>\n"}, {"tags": ["go", "mux"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514391128, "post_id": 47995240, "comment_id": 82958570, "body": "You&#39;re calling <code>http.ListenAndServe</code> without actually passing it your router. See the <code>http.Handle(&quot;&#47;&quot;, r)</code> in the first example in the <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\"><code>gorilla&#47;mux</code> readme</a>."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 1, "creation_date": 1514391732, "post_id": 47995240, "comment_id": 82958835, "body": "Why the downvote? This seems like a fine question..."}], "answers": [{"comments": [{"owner": {"reputation": 685, "user_id": 7047363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a4cda8321abd1a553445a95258babb?s=128&d=identicon&r=PG&f=1", "display_name": "muthukumar selvaraj", "link": "https://stackoverflow.com/users/7047363/muthukumar-selvaraj"}, "edited": false, "score": 0, "creation_date": 1527684862, "post_id": 47995264, "comment_id": 88219803, "body": "<code>http.Handle(&quot;&#47;api&quot;, router1)</code> --&gt; not found ? -- how to find this  \t<code>http.Handle(&quot;&#47;&quot;, route2)</code> --&gt; success"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 8, "last_activity_date": 1514391083, "creation_date": 1514391083, "answer_id": 47995264, "question_id": 47995240, "link": "https://stackoverflow.com/questions/47995240/gorilla-mux-404/47995264#47995264", "title": "Gorilla Mux 404", "body": "<p>To use the router, you must pass it to the HTTP server. </p>\n\n<pre><code>log.Fatal(http.ListenAndServe(\":8000\", myRouter))\n</code></pre>\n\n<p>or register it with the default serve mux:</p>\n\n<pre><code>http.Handle(\"/\", myRouter)\nlog.Fatal(http.ListenAndServe(\":8000\", nil))\n</code></pre>\n"}], "owner": {"reputation": 1323, "user_id": 1800508, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/f50c0dc2a98227d029183f22cfd73570?s=128&d=identicon&r=PG&f=1", "display_name": "Quesofat", "link": "https://stackoverflow.com/users/1800508/quesofat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1578, "favorite_count": 0, "accepted_answer_id": 47995264, "answer_count": 1, "score": 3, "last_activity_date": 1514391083, "creation_date": 1514390977, "question_id": 47995240, "link": "https://stackoverflow.com/questions/47995240/gorilla-mux-404", "title": "Gorilla Mux 404", "body": "<p>I'm taking this holiday break to freshen up on Go. Unfortunately the code I have below is throwing a 404 on both of the routes. This is the latest iteration. I originally had the router in a handleRouter function and thought taking it out would fix the 404ing. Spoiler alert: it didn't. How can I fix this? Thanks!</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\ntype Article struct {\n    Title   string `json:\"Title\"`\n    Desc    string `json:\"desc\"`\n    Content string `json:\"content\"`\n}\n\ntype Articles []Article\n\nfunc main() {\n    fmt.Println(\"Router v2 - Muxx\")\n\n    myRouter := mux.NewRouter()\n    myRouter.HandleFunc(\"/all\", returnAllArticles).Methods(\"GET\")\n    myRouter.HandleFunc(\"/\", homePage).Methods(\"GET\")\n    log.Fatal(http.ListenAndServe(\":8000\", nil))\n}\n\nfunc homePage(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintln(w, \"Hello:\")\n    fmt.Println(\"Endpoint Hit: homepage\")\n}\n\nfunc returnAllArticles(w http.ResponseWriter, r *http.Request) {\n    articles := Articles{\n        Article{Title: \"Hello\", Desc: \"Article Description\", Content: \"Article Content\"},\n        Article{Title: \"Hello 2\", Desc: \"Article Description\", Content: \"Article Content\"},\n    }\n\n    fmt.Println(\"Endpoint Hit: returnAllArticles\")\n    json.NewEncoder(w).Encode(articles)\n\n}\n</code></pre>\n"}, {"tags": ["regex", "go"], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1514390104, "last_edit_date": 1514390104, "creation_date": 1514389740, "answer_id": 47994945, "question_id": 47994516, "link": "https://stackoverflow.com/questions/47994516/positive-lookahead-overlapping-matches-regex/47994945#47994945", "title": "Positive lookahead + overlapping matches regex", "body": "<p>The real challenge here is that the matches at position 19 and 20 are <em>overlapping</em>, which means we can't use any of the go builtin \"FindAll...\" functions since they only find non-overlapping matches. This means that we've got to match the regex repeatedly against substrings starting after subsequent match indices if we want to find them all.</p>\n\n<p>For the regex itself I've used a non-capturing group <code>(?:...)</code> instead of a lookahead assertion. Additionally, the regex will also match percent-signs at the end of the string, since they cannot be followed by two hex digits:</p>\n\n<pre><code>func findPlainPercentIndices(s string) []int {\n    re := regexp.MustCompile(`%(?:[[:xdigit:]][[:^xdigit:]]|[[:^xdigit:]]|$)`)\n    indices := []int{}\n    idx := 0\n\n    for {\n        m := re.FindStringIndex(s[idx:])\n        if m == nil {\n            break\n        }\n        nextidx := idx + m[0]\n        indices = append(indices, nextidx)\n        idx = nextidx + 1\n    }\n\n    return indices\n}\n\nfunc main() {\n    str := \"%d%2524e%25f%255E00%%%252611%25%%\"\n    //      012345678901234567890123456789012\n    //      0         1         2         3\n    fmt.Printf(\"OK: %#v\\n\", findPlainPercentIndices(str))\n    // OK: []int{0, 19, 20, 31, 32}\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1514408398, "post_id": 47998549, "comment_id": 82965500, "body": "Those expressions will find <i>any</i> percent sign though, not just the ones that are <i>not</i> followed by two hex digits as the OP asked"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1514408891, "post_id": 47998549, "comment_id": 82965655, "body": "Ah ok, I see. Yes, that will indeed find the expected items"}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "reply_to_user": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1514409337, "post_id": 47998549, "comment_id": 82965803, "body": "I think that you overestimated this case. There is no overlapping. Overlapping would be if these 2 following chars could contain %.."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1514409845, "post_id": 47998549, "comment_id": 82965994, "body": "Yeah, I assumed that the indices of the match locations were the interesting part, but that&#39;s obviously an assumption. Although, it does seem like some of the items are followed by <code>%</code>s in his example..."}], "tags": [], "owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "is_accepted": true, "score": 1, "last_activity_date": 1514408107, "creation_date": 1514408107, "answer_id": 47998549, "question_id": 47994516, "link": "https://stackoverflow.com/questions/47994516/positive-lookahead-overlapping-matches-regex/47998549#47998549", "title": "Positive lookahead + overlapping matches regex", "body": "<p>I only tried this on regex101 (marked golang regex), but it seems that it works as expected:</p>\n\n<pre><code>%[0-9a-fA-F][0-9a-fA-F]|(%)\n</code></pre>\n\n<p>or simpler:</p>\n\n<pre><code>%[0-9a-fA-F]{2}|(%)\n</code></pre>\n"}], "owner": {"reputation": 2323, "user_id": 4642859, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/cbbd31a436ff596d2ea6eebbb5ca477c?s=128&d=identicon&r=PG&f=1", "display_name": "3kt", "link": "https://stackoverflow.com/users/4642859/3kt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 570, "favorite_count": 0, "accepted_answer_id": 47998549, "answer_count": 2, "score": 2, "last_activity_date": 1514408107, "creation_date": 1514387761, "question_id": 47994516, "link": "https://stackoverflow.com/questions/47994516/positive-lookahead-overlapping-matches-regex", "title": "Positive lookahead + overlapping matches regex", "body": "<p>I'm looking for a regex to match all <code>%</code> that are not followed by a valid 2-characters hex code (2 characters in a-fA-F0-9). I came up with <code>(%)(?=([0-9a-fA-F][^0-9a-fA-F]|[^0-9a-fA-F]))</code> which works well but is <strong>not supported in golang</strong>, because of the positive lookahead (<code>?=</code>).</p>\n\n<p>How can I translate it (or maybe make it simpler?), so that it works with go?</p>\n\n<p>For example, given the string <code>%d%2524e%25f%255E00%%%252611%25</code>, it should match the first <code>%</code> and the first two ones of the <code>%%%</code> substring.</p>\n\n<p>ie: <a href=\"https://regex101.com/r/y0YQ1I/2\" rel=\"nofollow noreferrer\">https://regex101.com/r/y0YQ1I/2</a></p>\n"}, {"tags": ["postgresql", "go", "grpc", "go-gorm", "proto3"], "answers": [{"tags": [], "owner": {"reputation": 9, "user_id": 12180390, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ypEmUuOCFoA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc8HwHuySGJzOAJnAFKhkIfjqzzQw/photo.jpg?sz=128", "display_name": "Rustam Turgunov", "link": "https://stackoverflow.com/users/12180390/rustam-turgunov"}, "is_accepted": false, "score": 0, "last_activity_date": 1570513753, "creation_date": 1570513753, "answer_id": 58280800, "question_id": 47994094, "link": "https://stackoverflow.com/questions/47994094/integrating-gorm-model-fields-into-protobuf-definitions/58280800#58280800", "title": "Integrating gorm.Model fields into protobuf definitions", "body": "<p>Try to use <a href=\"https://github.com/infobloxopen/protoc-gen-gorm\" rel=\"nofollow noreferrer\">protoc-gen-gorm</a>. It will create another file .pb.gorm.go</p>\n"}, {"tags": [], "owner": {"reputation": 26, "user_id": 14179181, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TQ1Ad.png?s=128&g=1", "display_name": "nobane", "link": "https://stackoverflow.com/users/14179181/nobane"}, "is_accepted": true, "score": 1, "last_activity_date": 1598566684, "creation_date": 1598566684, "answer_id": 63624863, "question_id": 47994094, "link": "https://stackoverflow.com/questions/47994094/integrating-gorm-model-fields-into-protobuf-definitions/63624863#63624863", "title": "Integrating gorm.Model fields into protobuf definitions", "body": "<p>The <code>protoc-gen-gorm</code> project did not work for me. It looks like there is some blending of proto2 and proto3 happening, and ultimately I was unable to get it to work.</p>\n<p>My solution was to create a script to do post processing after I generate the go files from protobuf.</p>\n<p>If this was my proto <code>profile/profile.proto</code>:</p>\n<pre><code>message Profile {\n  uint64 id = 1;\n  string name = 2;\n  bool active = 3;\n  // ...\n}\n</code></pre>\n<p>Which created <code>profile/profile.pb.go</code> with standard <code>protoc</code> command:</p>\n<pre><code>// ...\ntype Profile struct {\n    state         protoimpl.MessageState\n    sizeCache     protoimpl.SizeCache\n    unknownFields protoimpl.UnknownFields\n\n    Id     uint64 `protobuf:&quot;varint,1,opt,name=id,proto3&quot; json:&quot;id,omitempty&quot;`\n    Name   string `protobuf:&quot;bytes,2,opt,name=name,proto3&quot; json:&quot;name,omitempty&quot;`\n    Active bool   `protobuf:&quot;varint,3,opt,name=active,proto3&quot; json:&quot;active,omitempty&quot;`\n}\n// ...\n</code></pre>\n<p>I use this script <code>gorm.sh</code>:</p>\n<pre><code>#!/bin/bash\n\ng () {\n  sed &quot;s/json:\\&quot;$1,omitempty\\&quot;/json:\\&quot;$1,omitempty\\&quot; gorm:\\&quot;type:$2\\&quot;/&quot;\n}\n\ncat $1 \\\n| g &quot;id&quot; &quot;primary_key&quot; \\\n| g &quot;name&quot; &quot;varchar(100)&quot; \\\n&gt; $1.tmp &amp;&amp; mv $1{.tmp,}\n</code></pre>\n<p>Which I invoke on my go file after it's generated with <code>./gorm.sh profile/profile.pb.go</code> and the result of <code>profile/profile.pb.go</code> is:</p>\n<pre><code>// ...\ntype Profile struct {\n    state         protoimpl.MessageState\n    sizeCache     protoimpl.SizeCache\n    unknownFields protoimpl.UnknownFields\n\n    Id     uint64 `protobuf:&quot;varint,1,opt,name=id,proto3&quot; json:&quot;id,omitempty&quot; gorm:&quot;type:primary_key&quot;`\n    Name   string `protobuf:&quot;bytes,2,opt,name=name,proto3&quot; json:&quot;name,omitempty&quot; gorm:&quot;type:varchar(100)&quot;`\n    Active bool   `protobuf:&quot;varint,3,opt,name=active,proto3&quot; json:&quot;active,omitempty&quot;`\n}\n// ...\n</code></pre>\n"}], "owner": {"reputation": 965, "user_id": 3291194, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ziZgJ.jpg?s=128&g=1", "display_name": "Alex Luis Arias", "link": "https://stackoverflow.com/users/3291194/alex-luis-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1938, "favorite_count": 1, "accepted_answer_id": 63624863, "answer_count": 2, "score": 6, "last_activity_date": 1598566684, "creation_date": 1514385808, "last_edit_date": 1514394211, "question_id": 47994094, "link": "https://stackoverflow.com/questions/47994094/integrating-gorm-model-fields-into-protobuf-definitions", "title": "Integrating gorm.Model fields into protobuf definitions", "body": "<p>I am trying to figure out how to integrate the gorm.Model fields (deleted_at, create_at, id, etc) into my proto3 definitions. However, I can't a datetime type for proto3. I tried looking for documentation on how to serialize the gorm fields to strings (since proto3 handles strings) but I have not found anything. </p>\n\n<p>Has anyone been able to successfully use the gorm model fields in their proto definitions? I'm using go-micro's plugin to generate *pb.go files.</p>\n\n<p>Here's my current message definition which doesn't work. It seems like empty strings are being stored in the database for deleted_at since when querying for deleted_at is null the postgres database returns nothing. </p>\n\n<pre><code>message DatabaseConfig {\n    string address = 1;\n    int32 port = 2;\n    string databaseName = 3;\n    string username = 4;\n    string password = 5;\n    string databaseType = 6;\n    string quertStatement = 7;\n    int32 id = 8;\n    string createdAt = 9;\n    string updatedAt = 10;\n    string deletedAt = 11;\n}\n</code></pre>\n\n<p>UPDATE: \nI've updated my proto def to the following but gorm still isn't properly using the Id, CreatedAt, UpdatedAt, and DeletedAt fields</p>\n\n<pre><code>syntax = \"proto3\";\n\npackage go.micro.srv.importer;\n\nimport \"google/protobuf/timestamp.proto\";\nimport \"github.com/gogo/protobuf/gogoproto/gogo.proto\";\n\nservice ImporterService {\n    rpc CreateDatabaseConfig(DatabaseConfig) returns (Response) {}\n    rpc RetrieveDatabaseConfig(GetRequest) returns (Response) {}\n    rpc UpdateDatabaseConfig(DatabaseConfig) returns (Response) {}\n    rpc DeleteDatabaseConfig(DatabaseConfig) returns (Response) {}\n}\n\n\nmessage GetRequest {}\n\n\nmessage DatabaseConfig {\n    string address = 1;\n    int32 port = 2;\n    string databaseName = 3;\n    string username = 4;\n    string password = 5;\n    string databaseType = 6;\n    string quertStatement = 7;\n    int32 id = 8;\n    google.protobuf.Timestamp createdAt = 9 [(gogoproto.stdtime) = true];\n    google.protobuf.Timestamp updatedAt = 10 [(gogoproto.stdtime) = true];\n    google.protobuf.Timestamp deletedAt = 11 [(gogoproto.stdtime) = true];\n}\n\n\nmessage Response {\n    bool created = 1;\n    DatabaseConfig database_config = 2;\n\n    repeated DatabaseConfig databaseConfigs = 3;\n}\n</code></pre>\n"}, {"tags": ["http", "go", "port"], "answers": [{"comments": [{"owner": {"reputation": 3248, "user_id": 1262542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7cf2d499caed8b2c28ccc311ddffaeb?s=128&d=identicon&r=PG", "display_name": "Stefan Hanke", "link": "https://stackoverflow.com/users/1262542/stefan-hanke"}, "edited": false, "score": 1, "creation_date": 1514456241, "post_id": 47992797, "comment_id": 82979447, "body": "I&#39;m always intrigued by the open type/closed type dichotomy. I&#39;d like to see something like a <i>mixed</i> type where there are some defaults (here e.g. well-known ports and services) but also allows extending them, ultimately to support autocompletion. In my limited working knowledge TypeScripts ADTs come closest, maybe Swifts ADTs can express this also directly."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 144, "last_activity_date": 1514380542, "last_edit_date": 1514380542, "creation_date": 1514380202, "answer_id": 47992797, "question_id": 47992477, "link": "https://stackoverflow.com/questions/47992477/why-is-port-a-string-and-not-an-integer/47992797#47992797", "title": "Why is port a string and not an integer?", "body": "<p>This is because what appears after the colon can be either a port number or service name.</p>\n\n<p>The following is a valid example where the service name is used instead of a port number:</p>\n\n<pre><code>listener, err := net.Listen(\"tcp\", \"localhost:https\") // port 443\n// ...\n</code></pre>\n\n<p>The port mapping for a particular service can be looked up using <a href=\"https://godoc.org/net#LookupPort\" rel=\"noreferrer\"><code>net.LookupPort</code></a>. On Unix systems, the <code>/etc/services</code> file is sourced for the mappings.</p>\n"}, {"comments": [{"owner": {"reputation": 19199, "user_id": 1424877, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/8a14e5bb44bbb4c2721ac711bd8a7bcf?s=128&d=identicon&r=PG", "display_name": "Quuxplusone", "link": "https://stackoverflow.com/users/1424877/quuxplusone"}, "edited": false, "score": 0, "creation_date": 1570736963, "post_id": 48074693, "comment_id": 103018245, "body": "In libGURL, <code>url.port()</code> returns a string... but GURL also provides <code>url.has_port()</code>. So theoretically we could distinguish <code>http:&#47;&#47;example.com:&#47;path</code> (has a port, but <code>port()</code> is empty-string) from <code>http:&#47;&#47;example.com&#47;path</code> (doesn&#39;t have a port). Of course GURL itself doesn&#39;t do this! It even reports that <code>http:&#47;&#47;example.com:80&#47;path</code> &quot;doesn&#39;t have a port,&quot; on the grounds that the explicitly specified port is redundant with the scheme. Which is <a href=\"https://tools.ietf.org/id/draft-jennings-http-srv-01.html\" rel=\"nofollow noreferrer\">crazy</a>, but never mind... Point is, <code>String</code> is not <code>Optional</code>. Don&#39;t conflate them."}], "tags": [], "owner": {"reputation": 1082, "user_id": 3254469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66f5b2e2d08cdbb1a19b2d69799db8ad?s=128&d=identicon&r=PG&f=1", "display_name": "Fadid", "link": "https://stackoverflow.com/users/3254469/fadid"}, "is_accepted": false, "score": 0, "last_activity_date": 1515575447, "last_edit_date": 1515575447, "creation_date": 1514972122, "answer_id": 48074693, "question_id": 47992477, "link": "https://stackoverflow.com/questions/47992477/why-is-port-a-string-and-not-an-integer/48074693#48074693", "title": "Why is port a string and not an integer?", "body": "<p>For a number the default value is 0: if a function </p>\n\n<pre><code> func (u * URL) Port () string\n</code></pre>\n\n<p>return number instead of sting the port will be 0</p>\n\n<p>Port 0 is a reserved port in TCP/IP networking, meaning that it should not be used in TCP or UDP messages. However, port 0 carries special significance in network programming, particularly Unix socket programming: for requesting system-allocated, dynamic ports.</p>\n\n<p>it is a need for programming in several functions</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8079, "favorite_count": 10, "accepted_answer_id": 47992797, "answer_count": 2, "score": 107, "last_activity_date": 1515575447, "creation_date": 1514378825, "question_id": 47992477, "link": "https://stackoverflow.com/questions/47992477/why-is-port-a-string-and-not-an-integer", "title": "Why is port a string and not an integer?", "body": "<p>The <a href=\"https://golang.org/pkg/net/url/#URL.Port\" rel=\"noreferrer\"><code>Port</code></a> method returns a string and not an integer. What is the reason for that and is it safe to prefix the port with \":\"? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 833, "user_id": 7498628, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-qMH6F-M2q4U/AAAAAAAAAAI/AAAAAAAAAA0/UpXnAhY-GiY/photo.jpg?sz=128", "display_name": "Shubham Chaudhary", "link": "https://stackoverflow.com/users/7498628/shubham-chaudhary"}, "edited": false, "score": 0, "creation_date": 1514371528, "post_id": 47990646, "comment_id": 82949766, "body": "I posted question different than what I needed. Sorry about that.  Please have a look at the edited question."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 1, "last_activity_date": 1514371985, "last_edit_date": 1514371985, "creation_date": 1514371000, "answer_id": 47990646, "question_id": 47990587, "link": "https://stackoverflow.com/questions/47990587/running-a-statement-only-on-outermost-function-of-recursion-in-golang/47990646#47990646", "title": "Running a statement only on outermost function of recursion in Golang", "body": "<p><strong>Answer to edited question</strong>:</p>\n\n<p>You can use he second pattern below again:</p>\n\n<pre><code>func fact(n int, outerMost bool) int {\n   if n == 0 {\n      return 1\n   }\n   fact := n * fact(n-1, false)\n   if outerMost {\n       fmt.Printf(strconv.Itoa(n))\n   }\n   return fact \n}\n\nfunc main() {\n    fact(4, true)\n}\n</code></pre>\n\n<p>Again, you can use closures or helper functions to clean this up.</p>\n\n<p><em>Original answer:</em></p>\n\n<p>Try using a global variable:</p>\n\n<pre><code>var outerMost bool = true\n\nfunc fact(n int) int {\n    if outerMost {\n        fmt.Printf(strconv.Itoa(n))\n        outerMost = false\n    }\n    if n == 0 {\n       return 1\n    }\n    return n * fact(n-1)\n}\n\nfunc main() {\n    fact(4)\n}\n</code></pre>\n\n<p>There are other ways to achieve this. For example, you can use similar technique with closures as well. Or add another parameter to <code>fact</code>:</p>\n\n<pre><code>func fact(n int, outerMost bool) int {\n    if outerMost {\n        fmt.Printf(strconv.Itoa(n))\n        outerMost = false\n    }\n    if n == 0 {\n       return 1\n    }\n    return n * fact(n-1, outerMost)\n}\n\nfunc main() {\n    fact(4, true)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 1, "last_activity_date": 1514371791, "last_edit_date": 1514371791, "creation_date": 1514371098, "answer_id": 47990679, "question_id": 47990587, "link": "https://stackoverflow.com/questions/47990587/running-a-statement-only-on-outermost-function-of-recursion-in-golang/47990679#47990679", "title": "Running a statement only on outermost function of recursion in Golang", "body": "<p>You could pass something like a <code>depth</code> that gets incremented at each call. Eg:</p>\n\n<pre><code>func fact(depth int, n int) int {\n   if n == 0 {\n      return 1\n   }\n   fact := n * fact(depth + 1, n-1)\n   if depth == 0 {\n       fmt.Println(fact)  // I assume you meant to print fact here.\n   }\n   return fact \n}\nfunc main() {\n  fact(0, 4)\n}\n</code></pre>\n\n<p>If this is really your use case, you're much better off doing:</p>\n\n<pre><code>func fact(n int) int {\n  if n == 0 {\n     return 1\n  }\n  return n * fact(n-1)\n}\nfunc main() {\n  fmt.Println(fact(4))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1514384067, "creation_date": 1514384067, "answer_id": 47993669, "question_id": 47990587, "link": "https://stackoverflow.com/questions/47990587/running-a-statement-only-on-outermost-function-of-recursion-in-golang/47993669#47993669", "title": "Running a statement only on outermost function of recursion in Golang", "body": "<p>A simple anonymous function is probably the cleanest, as it does not add a parameter, complicating the API for external callers just to implement internal logic.</p>\n\n<pre><code>func fact(n int) int {\n    var facto func(n int) int\n    facto = func(n int) int {\n        if n == 0 {\n            return 1\n        }\n        fact := n * facto(n-1)\n        return fact\n    }\n    n = facto(n)\n    fmt.Printf(\"%d\", n)\n    return n\n}\n</code></pre>\n\n<p>This achieves the same functionality, but the caller doesn't have to know to pass an additional bool or int value that's irrelevant to it. Full example here: <a href=\"https://play.golang.org/p/7vHwPDN2_FL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7vHwPDN2_FL</a></p>\n"}, {"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1514397558, "creation_date": 1514397558, "answer_id": 47996639, "question_id": 47990587, "link": "https://stackoverflow.com/questions/47990587/running-a-statement-only-on-outermost-function-of-recursion-in-golang/47996639#47996639", "title": "Running a statement only on outermost function of recursion in Golang", "body": "<p>To answer the question itself: if for some reason you really want to run something that is only for outermost func call and don't want to change api, Golang has a runtime lib for that.\nYou may do it as:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"strconv\"\n)\n\nfunc outer_most() bool {\n    pc:=make([]uintptr,2)\n    runtime.Callers(2,pc) //skip: 1 - runtime.Caller, 2 - outer_most itself\n    return runtime.FuncForPC(pc[0])!=runtime.FuncForPC(pc[1]) // test if the caller of the caller is the same func, otherwise it is the outermost\n}\n\nfunc fact(n int) int {\n   if n == 0 {\n      return 1\n   }\n   fact := n * fact(n-1)\n   if outer_most() {\n       fmt.Printf(strconv.Itoa(n))\n   }\n   return fact \n}\n\nfunc main() {\n  fact(4)\n}\n</code></pre>\n\n<p>playground: <a href=\"https://play.golang.org/p/ro1ZOn6yIR7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ro1ZOn6yIR7</a>\nIt is no good practice, but solve the question most straightfowardly.</p>\n\n<p>Note:\nUse a global variable is very likely to cause glitches. You need to set it every time you call the func, and if there is concurency, data race would be involved.</p>\n\n<p>And if you are unconfortable with the fact that the extra bool argument get allocated every recursive call (which could be countless time), you may look at @Adrian 's answer or wrap it as a method of a bool.</p>\n"}], "owner": {"reputation": 833, "user_id": 7498628, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-qMH6F-M2q4U/AAAAAAAAAAI/AAAAAAAAAA0/UpXnAhY-GiY/photo.jpg?sz=128", "display_name": "Shubham Chaudhary", "link": "https://stackoverflow.com/users/7498628/shubham-chaudhary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 47996639, "answer_count": 4, "score": 0, "last_activity_date": 1514397558, "creation_date": 1514370787, "last_edit_date": 1514371309, "question_id": 47990587, "link": "https://stackoverflow.com/questions/47990587/running-a-statement-only-on-outermost-function-of-recursion-in-golang", "title": "Running a statement only on outermost function of recursion in Golang", "body": "<p>I have a recursive function and I want one execute some statement only for the outermost call to the function. How do I achieve this functionality?</p>\n\n<pre><code>func fact(n int) int {\n   if n == 0 {\n      return 1\n   }\n   fact := n * fact(n-1)\n   if outer_most{\n       fmt.Printf(strconv.Itoa(n))\n   }\n   return fact \n}\nfunc main() {\n  fact(4)\n}\n</code></pre>\n\n<p>This should print only <code>4</code></p>\n"}, {"tags": ["go", "middleware", "go-gin"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514372332, "post_id": 47990026, "comment_id": 82950117, "body": "I don&#39;t understand what &quot;c.Request.Body is 0&quot; means. c.Request.Body is an io.ReadCloser--<code>0</code> is an impossible value for an io.ReadCloser. Can you elaborate on what you mean? Do you mean that the value read from the body is the string <code>&quot;0&quot;</code>? Or do you mean that it&#39;s 0-bytes long? Or something else?"}, {"owner": {"reputation": 197, "user_id": 6433808, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-Aj9BD9CYEv4/AAAAAAAAAAI/AAAAAAABQUw/V954hpYA8oA/photo.jpg?sz=128", "display_name": "rluisr", "link": "https://stackoverflow.com/users/6433808/rluisr"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514376178, "post_id": 47990026, "comment_id": 82951847, "body": "@Flimzy sorry <code>c.Request.Body.Read</code> not <code>c.Request.Body</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514376250, "post_id": 47990026, "comment_id": 82951885, "body": "<code>c.Request.Body.Read</code> is a function, not an integer. Are you saying <i>that</i> returns <code>0</code> as the number of bytes read?"}, {"owner": {"reputation": 197, "user_id": 6433808, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-Aj9BD9CYEv4/AAAAAAAAAAI/AAAAAAABQUw/V954hpYA8oA/photo.jpg?sz=128", "display_name": "rluisr", "link": "https://stackoverflow.com/users/6433808/rluisr"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514378506, "post_id": 47990026, "comment_id": 82952935, "body": "@Flimzy yes <code>fmt.Println(c.Request.Body.Read(body))</code>"}], "answers": [{"comments": [{"owner": {"reputation": 197, "user_id": 6433808, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-Aj9BD9CYEv4/AAAAAAAAAAI/AAAAAAABQUw/V954hpYA8oA/photo.jpg?sz=128", "display_name": "rluisr", "link": "https://stackoverflow.com/users/6433808/rluisr"}, "edited": false, "score": 1, "creation_date": 1514376574, "post_id": 47991225, "comment_id": 82952054, "body": "Thanks @hobbs ! solve this problem. I learned a lot from your comment!"}, {"owner": {"reputation": 197, "user_id": 6433808, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-Aj9BD9CYEv4/AAAAAAAAAAI/AAAAAAABQUw/V954hpYA8oA/photo.jpg?sz=128", "display_name": "rluisr", "link": "https://stackoverflow.com/users/6433808/rluisr"}, "edited": false, "score": 0, "creation_date": 1514377324, "post_id": 47991225, "comment_id": 82952383, "body": "If you&#39;d like please teach me how to use <code>io.LimitedReader</code>. I don&#39;t understand even googled this method."}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "reply_to_user": {"reputation": 197, "user_id": 6433808, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-Aj9BD9CYEv4/AAAAAAAAAAI/AAAAAAABQUw/V954hpYA8oA/photo.jpg?sz=128", "display_name": "rluisr", "link": "https://stackoverflow.com/users/6433808/rluisr"}, "edited": false, "score": 0, "creation_date": 1514384557, "post_id": 47991225, "comment_id": 82955652, "body": "@rluisr this might help <a href=\"https://stackoverflow.com/a/38874756/678491\">Limiting amount of data read in the response to a HTTP GET request</a>"}, {"owner": {"reputation": 197, "user_id": 6433808, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-Aj9BD9CYEv4/AAAAAAAAAAI/AAAAAAABQUw/V954hpYA8oA/photo.jpg?sz=128", "display_name": "rluisr", "link": "https://stackoverflow.com/users/6433808/rluisr"}, "reply_to_user": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1514453314, "post_id": 47991225, "comment_id": 82977856, "body": "@biosckon thanks comment. this code is return <code>0</code>. Do you know what is wrong? <a href=\"https://play.golang.org/p/40c6XQ44ESz\" rel=\"nofollow noreferrer\">play.golang.org/p/40c6XQ44ESz</a>"}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "reply_to_user": {"reputation": 197, "user_id": 6433808, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-Aj9BD9CYEv4/AAAAAAAAAAI/AAAAAAABQUw/V954hpYA8oA/photo.jpg?sz=128", "display_name": "rluisr", "link": "https://stackoverflow.com/users/6433808/rluisr"}, "edited": false, "score": 0, "creation_date": 1514460223, "post_id": 47991225, "comment_id": 82981324, "body": "@rluisr if you have solved it, please post answer to your own question."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 5, "last_activity_date": 1514373482, "creation_date": 1514373482, "answer_id": 47991225, "question_id": 47990026, "link": "https://stackoverflow.com/questions/47990026/gin-if-request-body-bound-in-middleware-c-request-body-become-0/47991225#47991225", "title": "Gin If `request body` bound in middleware, c.Request.Body become 0", "body": "<p>You can only read the Body from the client once. The data is streaming from the user, and they're not going to send it again. If you want to read it more than once, you're going to have to <em>buffer</em> the whole thing in memory, like so:</p>\n\n<pre><code>bodyCopy := new(bytes.Buffer)\n// Read the whole body\n_, err := io.Copy(bodyCopy, req.Body)\nif err != nil {\n    return err\n}\nbodyData := bodyCopy.Bytes()\n// Replace the body with a reader that reads from the buffer\nreq.Body = ioutil.NopCloser(bytes.NewReader(bodyData))\n// Now you can do something with the contents of bodyData,\n// like passing it to json.Unmarshal\n</code></pre>\n\n<p>Note that buffering the entire request into memory means that a user can cause you to allocate unlimited memory -- you should probably either block this at a frontend proxy or use an <code>io.LimitedReader</code> to limit the amount of data you'll buffer.</p>\n\n<p>You also have to read the entire body before Unmarshal can start its work -- this is probably no big deal, but you can do better using <code>io.TeeReader</code> and <code>json.NewDecoder</code> if you're so inclined.</p>\n\n<p>Better, of course, would be to figure out a way to restructure your code so that buffering the body and decoding it twice aren't necessary.</p>\n"}], "owner": {"reputation": 197, "user_id": 6433808, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-Aj9BD9CYEv4/AAAAAAAAAAI/AAAAAAABQUw/V954hpYA8oA/photo.jpg?sz=128", "display_name": "rluisr", "link": "https://stackoverflow.com/users/6433808/rluisr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1671, "favorite_count": 1, "accepted_answer_id": 47991225, "answer_count": 1, "score": 1, "last_activity_date": 1597431162, "creation_date": 1514368753, "last_edit_date": 1597431162, "question_id": 47990026, "link": "https://stackoverflow.com/questions/47990026/gin-if-request-body-bound-in-middleware-c-request-body-become-0", "title": "Gin If `request body` bound in middleware, c.Request.Body become 0", "body": "<p>My API server has middle ware which is getting token from request header.\nIf it access is correct, its go next function.</p>\n\n<p>But request went to middle ware and went to next function, <code>c.Request.Body</code> become <code>0</code>.</p>\n\n<p><strong>middle ware</strong></p>\n\n<pre><code>func getUserIdFromBody(c *gin.Context) (int) {\n    var jsonBody User\n\n    length, _ := strconv.Atoi(c.Request.Header.Get(\"Content-Length\"))\n    body := make([]byte, length)\n    length, _ = c.Request.Body.Read(body)\n    json.Unmarshal(body[:length], &amp;jsonBody)\n\n    return jsonBody.Id\n}\n\nfunc CheckToken() (gin.HandlerFunc) {\n    return func(c *gin.Context) {\n        var userId int\n\n        config := model.NewConfig()\n\n        reqToken := c.Request.Header.Get(\"token\")\n\n        _, resBool := c.GetQuery(\"user_id\")\n        if resBool == false {\n            userId = getUserIdFromBody(c)\n        } else {\n            userIdStr := c.Query(\"user_id\")\n            userId, _ = strconv.Atoi(userIdStr)\n        }\n    ...\n        if ok {\n            c.Nex()\n            return\n        }\n}\n</code></pre>\n\n<p><strong>next func</strong></p>\n\n<pre><code>func bindOneDay(c *gin.Context) (model.Oneday, error) {\n    var oneday model.Oneday\n\n    if err := c.BindJSON(&amp;oneday); err != nil {\n        return oneday, err\n    }\n    return oneday, nil\n}\n</code></pre>\n\n<p><code>bindOneDay</code> return error with <code>EOF</code>. because maybe <code>c.Request.Body</code> is <code>0</code>.</p>\n\n<p>I want to get <code>user_id</code> from request body in middle ware.\nHow to do it without problem that <code>c.Request.Body</code> become 0</p>\n"}, {"tags": ["go", "type-assertion"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1514365141, "post_id": 47989157, "comment_id": 82946813, "body": "What do you mean &quot;does not work&quot;?  What output did you receive? What did you expect instead?"}, {"owner": {"reputation": 1944, "user_id": 4120554, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-RKmmNTC8iUo/AAAAAAAAAAI/AAAAAAAAAGs/oQQp9tU-Zb4/photo.jpg?sz=128", "display_name": "Marco Talento", "link": "https://stackoverflow.com/users/4120554/marco-talento"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514367390, "post_id": 47989157, "comment_id": 82947769, "body": "Does not work means <code>ok</code> is false! But your answer below makes everything clear for me!"}], "answers": [{"comments": [{"owner": {"reputation": 1944, "user_id": 4120554, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-RKmmNTC8iUo/AAAAAAAAAAI/AAAAAAAAAGs/oQQp9tU-Zb4/photo.jpg?sz=128", "display_name": "Marco Talento", "link": "https://stackoverflow.com/users/4120554/marco-talento"}, "edited": false, "score": 0, "creation_date": 1514367332, "post_id": 47989212, "comment_id": 82947740, "body": "Makes sense, thank you very much!! I cannot unmarshal at that point so I would need to iterate the <code>[]interface{}</code> array and check if all values are float!"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 5, "last_activity_date": 1514367898, "last_edit_date": 1514367898, "creation_date": 1514365356, "answer_id": 47989212, "question_id": 47989157, "link": "https://stackoverflow.com/questions/47989157/golang-type-assertion-arrays/47989212#47989212", "title": "Golang Type Assertion Arrays", "body": "<p>Your question is unclear, but it appears to boil down to the following:</p>\n\n<p>By default, <code>json.Unmarshal</code> unmarshals all numbers into float64, since all numbers in JSON are floats. If you want some other type, you need to use a specific type in your target type. Examples:</p>\n\n<pre><code>var x map[string]interface{}\njson.Unmarshal([]byte(`{\"foo\":123}`), &amp;x) // { \"foo\": float64(123) }\n</code></pre>\n\n<p>vs:</p>\n\n<pre><code>var x map[string]int64\njson.Unmarshal([]byte(`{\"foo\":123}`), &amp;x) // { \"foo\": int64(123) }\n</code></pre>\n\n<p>And by default, all JSON arrays unmarshal to <code>[]interface{}</code>, because the members can be of any type, including mixed types. If you want a specific type, again, you have to be specific:</p>\n\n<pre><code>var x interface{}\njson.Unmarshal([]byte(`[1,2,3]`), &amp;x) // []interface{}{float64(1), float64(2), float64(3)}\n</code></pre>\n\n<p>vs:</p>\n\n<pre><code>var x []int64\njson.Unmarshal([]byte(`[1,2,3]`), &amp;x) // []int64{1,2,3}\n</code></pre>\n"}], "owner": {"reputation": 1944, "user_id": 4120554, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-RKmmNTC8iUo/AAAAAAAAAAI/AAAAAAAAAGs/oQQp9tU-Zb4/photo.jpg?sz=128", "display_name": "Marco Talento", "link": "https://stackoverflow.com/users/4120554/marco-talento"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4221, "favorite_count": 1, "accepted_answer_id": 47989212, "answer_count": 1, "score": -2, "last_activity_date": 1514367898, "creation_date": 1514365074, "question_id": 47989157, "link": "https://stackoverflow.com/questions/47989157/golang-type-assertion-arrays", "title": "Golang Type Assertion Arrays", "body": "<p>For what I understand type assertion can only be used in interfaces and basically check if a determined type implements the interface.</p>\n\n<p>I am having some weird scenarios:</p>\n\n<pre><code>func binder(value interface{}) {\n   // Does not work\n   valueInt, ok := value.(int)\n\n   // Works\n   valueInt, ok := value.(float64)\n\n   // Does not work \n   coordinates, ok := value.([]int)\n\n   // Does not work \n   coordinates, ok := value.([]float64) \n}\n</code></pre>\n\n<p>Basically, my <code>value</code> is an empty interface and I am getting from a <code>json.Unmarshall</code>.</p>\n\n<p><strong>Scenario 1</strong></p>\n\n<p>when I pass a simple integer it does not work but if I check if is a float it works...</p>\n\n<p><strong>Scenario 2</strong></p>\n\n<p>When I pass an array of int or floats does not work! As you can see when I am debugging I am receiving an array but for some reason assertion does not work.</p>\n\n<p><a href=\"https://i.stack.imgur.com/Jituv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Jituv.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514364596, "post_id": 47988674, "comment_id": 82946599, "body": "Any question that begins with &quot;What is the fastest way&quot; is best answered by benchmarks."}, {"owner": {"reputation": 37141, "user_id": 5315974, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/MNGHV.png?s=128&g=1", "display_name": "Vao Tsun", "link": "https://stackoverflow.com/users/5315974/vao-tsun"}, "edited": false, "score": 1, "creation_date": 1514365421, "post_id": 47988674, "comment_id": 82946944, "body": "<a href=\"https://stackoverflow.com/a/35388503/5315974\">stackoverflow.com/a/35388503/5315974</a>"}], "answers": [{"comments": [{"owner": {"reputation": 833, "user_id": 7498628, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-qMH6F-M2q4U/AAAAAAAAAAI/AAAAAAAAAA0/UpXnAhY-GiY/photo.jpg?sz=128", "display_name": "Shubham Chaudhary", "link": "https://stackoverflow.com/users/7498628/shubham-chaudhary"}, "edited": false, "score": 0, "creation_date": 1514363947, "post_id": 47988861, "comment_id": 82946358, "body": "In the blog post, <code>COPY</code> outperforms the <code>INSERT</code> with many rows. Is there any reason not to use <code>COPY</code> over <code>INSERT</code>?"}, {"owner": {"reputation": 3513, "user_id": 6103001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a874dcd5632319daf12801f77659d63?s=128&d=identicon&r=PG&f=1", "display_name": "Micha\u0142 Zaborowski", "link": "https://stackoverflow.com/users/6103001/micha%c5%82-zaborowski"}, "reply_to_user": {"reputation": 833, "user_id": 7498628, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-qMH6F-M2q4U/AAAAAAAAAAI/AAAAAAAAAA0/UpXnAhY-GiY/photo.jpg?sz=128", "display_name": "Shubham Chaudhary", "link": "https://stackoverflow.com/users/7498628/shubham-chaudhary"}, "edited": false, "score": 1, "creation_date": 1514364031, "post_id": 47988861, "comment_id": 82946389, "body": "not really. <code>pg_dump</code> generates dumps with <code>COPY</code> by default."}], "tags": [], "owner": {"reputation": 3513, "user_id": 6103001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a874dcd5632319daf12801f77659d63?s=128&d=identicon&r=PG&f=1", "display_name": "Micha\u0142 Zaborowski", "link": "https://stackoverflow.com/users/6103001/micha%c5%82-zaborowski"}, "is_accepted": true, "score": 1, "last_activity_date": 1514363640, "creation_date": 1514363640, "answer_id": 47988861, "question_id": 47988674, "link": "https://stackoverflow.com/questions/47988674/how-to-batch-sql-statements-in-postgres-using-golang/47988861#47988861", "title": "How to batch SQL statements in Postgres using Golang", "body": "<p>There is a bit old depesz <a href=\"https://www.depesz.com/2007/07/05/how-to-insert-data-to-database-as-fast-as-possible/\" rel=\"nofollow noreferrer\">blog post</a> on that. His programs are Perl scripts, but if you concentrate on SQL... Anyway - from DB perspective, you can use <code>COPY</code>, or <code>INSERT</code> with many rows in <code>VALUES</code>. It looks that around 20 is good choice, but it is worth to test that in your case. If performance is key factor, I would put around 2000-5000 rows per transaction. Also, from DB perspective transaction, and session are two separate things. So you can open session, and to many transactions in it. </p>\n\n<p>For PostgreSQL starting new session per operation is really bad idea - DB spawns new process for each session. One of answers for the question you referred contains <a href=\"https://godoc.org/github.com/lib/pq#hdr-Bulk_imports\" rel=\"nofollow noreferrer\">this</a>. So you open connection, and then transaction, as it should be done. </p>\n"}], "owner": {"reputation": 833, "user_id": 7498628, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-qMH6F-M2q4U/AAAAAAAAAAI/AAAAAAAAAA0/UpXnAhY-GiY/photo.jpg?sz=128", "display_name": "Shubham Chaudhary", "link": "https://stackoverflow.com/users/7498628/shubham-chaudhary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1795, "favorite_count": 0, "accepted_answer_id": 47988861, "answer_count": 1, "score": 0, "last_activity_date": 1514363640, "creation_date": 1514362740, "question_id": 47988674, "link": "https://stackoverflow.com/questions/47988674/how-to-batch-sql-statements-in-postgres-using-golang", "title": "How to batch SQL statements in Postgres using Golang", "body": "<p>What is the fastest way to send batch requests to Postgres database using Golang? Each request contains 500-200000 rows.<br>\nMethods I know about are-<br>\n 1. Using database/sql package's transaction Begin, Prepare, Commit.<br>\n 2. Sending all data in one statement.<br>\n 3. Sending a list of statements using sql.Exec() method.<br>\nIs there some other way to send batch requests without making a connection at every statement? If not which is the best way of these?</p>\n\n<p>This question is similar to question at- <a href=\"https://stackoverflow.com/questions/12486436/golang-how-do-i-batch-sql-statements-with-package-database-sql\">Golang how do I batch sql statements with package database.sql</a></p>\n"}, {"tags": ["database", "go", "bolt"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 6, "last_activity_date": 1514364827, "creation_date": 1514364827, "answer_id": 47989101, "question_id": 47988415, "link": "https://stackoverflow.com/questions/47988415/how-to-get-number-of-keys-in-a-bucket-in-bolt/47989101#47989101", "title": "How to get number of keys in a bucket in bolt", "body": "<p>I've never heard of or used bolt, but <a href=\"https://godoc.org/github.com/boltdb/bolt\" rel=\"noreferrer\">the docs</a> suggest that the <a href=\"https://godoc.org/github.com/boltdb/bolt#Bucket.Stats\" rel=\"noreferrer\"><code>Stats</code></a> method will do what you want.</p>\n"}], "owner": {"reputation": 357, "user_id": 1650924, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/Y9y6q.jpg?s=128&g=1", "display_name": "H&#224; Link", "link": "https://stackoverflow.com/users/1650924/h%c3%a0-link"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1039, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1514364827, "creation_date": 1514361366, "question_id": 47988415, "link": "https://stackoverflow.com/questions/47988415/how-to-get-number-of-keys-in-a-bucket-in-bolt", "title": "How to get number of keys in a bucket in bolt", "body": "<p>I am using bolt to store data, in a bucket I store key as versioning and I only want to keep a maximum number of versions in a bucket. Then I want to know if in a bucket there are too many keys. However, I cannot find a simple way than traverse all keys and count.</p>\n\n<p>Does anyone know how to get the number of keys in a bucket?</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514383578, "post_id": 47987531, "comment_id": 82955232, "body": "Or just use simple <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertions</a>."}], "tags": [], "owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "is_accepted": true, "score": 3, "last_activity_date": 1514356765, "creation_date": 1514356765, "answer_id": 47987531, "question_id": 47987246, "link": "https://stackoverflow.com/questions/47987246/unmarshal-multiple-data-types-in-one-key-in-goalng/47987531#47987531", "title": "Unmarshal multiple data types in one key in goalng", "body": "<p>The easiest way is to just use interface{} in your struct.  See:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype decoded struct {\n    Value interface{}       `json:\"value\"`\n}\n\nfunc decode(jstr string) {\n    var val decoded\n    json.Unmarshal([]byte(jstr), &amp;val)\n    fmt.Printf(\"%v\\n\", val.Value)\n}\n\nfunc main() {\n    decode(`{\"value\": \"ve\"}`)\n    decode(`{\"value\": [\"ve\",\"ff\"]}`)\n    decode(`{\"value\": [1,2]}`)\n    decode(`{\"value\": 3}`)\n}\n</code></pre>\n\n<p>You'll probably need to combine this with stuff in <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">the reflect package</a> or (as I did above) fmt.Sprintf() or similar to actually get at your data.  This is, however, good enough to decode and put in a structure:</p>\n\n<pre><code>$ ./spike \nve\n[ve ff]\n[1 2]\n3\n</code></pre>\n"}], "owner": {"reputation": 309, "user_id": 4517341, "user_type": "registered", "accept_rate": 36, "profile_image": "https://graph.facebook.com/100000867481103/picture?type=large", "display_name": "Kumar Siva", "link": "https://stackoverflow.com/users/4517341/kumar-siva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 47987531, "answer_count": 1, "score": -1, "last_activity_date": 1514356765, "creation_date": 1514355341, "question_id": 47987246, "link": "https://stackoverflow.com/questions/47987246/unmarshal-multiple-data-types-in-one-key-in-goalng", "title": "Unmarshal multiple data types in one key in goalng", "body": "<p>I have JSON key which will have any one the below data.</p>\n\n<p>1.{\"value\": \"ve\"}</p>\n\n<p>2.{\"value\": [\"ve\",\"ff\"]}</p>\n\n<p>3.{\"value\": [1,2]}</p>\n\n<p>4.{\"value\": 3}</p>\n\n<p>How to unmarshal into a golang's struct?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1514398271, "post_id": 47986973, "comment_id": 82961563, "body": "In practice you just keep a reference to the original slice if you want the space from the original slice."}], "answers": [{"tags": [], "owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "is_accepted": true, "score": 0, "last_activity_date": 1514354858, "creation_date": 1514354858, "answer_id": 47987165, "question_id": 47986973, "link": "https://stackoverflow.com/questions/47986973/can-i-recover-elements-that-i-sliced-off-the-beginning-of-a-slice/47987165#47987165", "title": "Can I recover elements that I sliced off the beginning of a slice?", "body": "<p>It will not be garbage collected:<a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Go Slices: usage and internals</a></p>\n\n<p>If you read <a href=\"https://stackoverflow.com/questions/36706843/how-to-get-the-underlying-array-of-a-slice-in-go\">this answer</a> it shows you how to use reflection to get the underlying array, from which 1 is recoverable using unsafe and reflect packages.</p>\n\n<pre><code>s := []int{1, 2, 3, 4}\nhdr := (*reflect.SliceHeader)(unsafe.Pointer(&amp;s))\ndata := *(*[4]int)(unsafe.Pointer(hdr.Data))\n</code></pre>\n"}], "owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 47987165, "answer_count": 1, "score": 1, "last_activity_date": 1514354858, "creation_date": 1514353694, "question_id": 47986973, "link": "https://stackoverflow.com/questions/47986973/can-i-recover-elements-that-i-sliced-off-the-beginning-of-a-slice", "title": "Can I recover elements that I sliced off the beginning of a slice?", "body": "<pre><code>a := []int{1,2,3,4,5,6}\nb := a[1:len(a)-1]\nfmt.Println(b) // -&gt; [2 3 4 5]\n</code></pre>\n\n<p>I can get the <code>6</code> back from <code>b</code>:</p>\n\n<pre><code>c := b[:len(b)+1]\nfmt.Println(c) // -&gt; [2 3 4 5 6]\n</code></pre>\n\n<p>But can I get the <code>1</code> back?</p>\n\n<p>If I try</p>\n\n<pre><code>c := b[-1:]\n</code></pre>\n\n<p>I get</p>\n\n<blockquote>\n  <p>invalid slice index -1 (index must be non-negative)</p>\n</blockquote>\n\n<p>If I can't get it back, does it mean it will be garbage collected?</p>\n"}, {"tags": ["javascript", "python", "regex", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1514344270, "post_id": 47985855, "comment_id": 82940629, "body": "Show what you tried so far."}, {"owner": {"reputation": 162909, "user_id": 1175966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d3d9dfbd040f9cbc1a6b82f0da2b345?s=128&d=identicon&r=PG", "display_name": "charlietfl", "link": "https://stackoverflow.com/users/1175966/charlietfl"}, "edited": false, "score": 0, "creation_date": 1514344546, "post_id": 47985855, "comment_id": 82940694, "body": "Will pattern word length and string word length always be same?"}, {"owner": {"reputation": 17567, "user_id": 197473, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/NMUlT.png?s=128&g=1", "display_name": "Vishal", "link": "https://stackoverflow.com/users/197473/vishal"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514345381, "post_id": 47985855, "comment_id": 82940871, "body": "@CeriseLim&#243;n I have tried it. I will post it. I know I can do it multiple iteration but got stuck trying to achieve it in a single iteration."}], "answers": [{"tags": [], "owner": {"reputation": 9345, "user_id": 4237316, "user_type": "registered", "accept_rate": 47, "profile_image": "https://graph.facebook.com/100004533998341/picture?type=large", "display_name": "Harald Nordgren", "link": "https://stackoverflow.com/users/4237316/harald-nordgren"}, "is_accepted": false, "score": 0, "last_activity_date": 1514344463, "creation_date": 1514344463, "answer_id": 47985897, "question_id": 47985855, "link": "https://stackoverflow.com/questions/47985855/capture-values-from-a-string-based-on-pattern/47985897#47985897", "title": "Capture values from a string based on pattern", "body": "<p>In python:</p>\n\n<pre><code>str = \"The quick brown fox jumps over the lazy dog\"\npat = \"The quick brown * jumps over the lazy *\"\n\nresult = []\nfor p, s in zip(pat.split(), str.split()):\n    if p == \"*\":\n        result.append(s)\n\nprint(result)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 2, "last_activity_date": 1514353489, "last_edit_date": 1514353489, "creation_date": 1514345626, "answer_id": 47986018, "question_id": 47985855, "link": "https://stackoverflow.com/questions/47985855/capture-values-from-a-string-based-on-pattern/47986018#47986018", "title": "Capture values from a string based on pattern", "body": "<p>The trick is to convert the pattern into a regular expression that captures the expected values from the given string:</p>\n\n<pre><code>func capture(pat, str string) []string {\n    // Capture all sequences of non-whitespace characters between word boundaries.\n    re := strings.Replace(pat, \"*\", `(\\b\\S+\\b)`, -1)\n    groups := regexp.MustCompile(re).FindAllStringSubmatch(str, -1)\n    if groups == nil {\n        return []string{}\n    }\n    return groups[0][1:]\n}\n\nfunc main() {\n    pat := \"The quick brown * jumps over the lazy *\"\n    str := \"The quick brown fox jumps over the lazy dog\"\n\n    fmt.Printf(\"OK: %s\\n\", capture(pat, str))\n    // OK: [fox dog]\n}\n</code></pre>\n"}], "owner": {"reputation": 17567, "user_id": 197473, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/NMUlT.png?s=128&g=1", "display_name": "Vishal", "link": "https://stackoverflow.com/users/197473/vishal"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "closed_date": 1514362192, "accepted_answer_id": 47986018, "answer_count": 2, "score": -6, "last_activity_date": 1514353489, "creation_date": 1514344039, "question_id": 47985855, "link": "https://stackoverflow.com/questions/47985855/capture-values-from-a-string-based-on-pattern", "closed_reason": "Needs more focus", "title": "Capture values from a string based on pattern", "body": "<p>I am looking for an approach to the following problem. It captures all <code>*</code> values from the string using a provided pattern.</p>\n\n<pre><code>function capture(pattern, string) {\n}\n</code></pre>\n\n<p>Example:</p>\n\n<p>Input</p>\n\n<ul>\n<li><p>Pattern <code>The quick brown * jumps over the lazy *</code></p></li>\n<li><p>String <code>The quick brown fox jumps over the lazy dog</code></p></li>\n</ul>\n\n<p>Output <code>[fox, dog]</code></p>\n\n<p>Is it possible to solve it using regex?</p>\n"}, {"tags": ["go", "go-iris"], "comments": [{"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1514317787, "post_id": 47982478, "comment_id": 82934762, "body": "I understand that you want <code>c.APIController.Model</code> to contain a model of any type, but how do you want to use the model?"}, {"owner": {"reputation": 368, "user_id": 1050258, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a7195d0605c38904c4543f67c741cec?s=128&d=identicon&r=PG", "display_name": "Muavia", "link": "https://stackoverflow.com/users/1050258/muavia"}, "reply_to_user": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1514351705, "post_id": 47982478, "comment_id": 82942135, "body": "@md2perpe updated the question for precise usage."}], "answers": [{"comments": [{"owner": {"reputation": 368, "user_id": 1050258, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a7195d0605c38904c4543f67c741cec?s=128&d=identicon&r=PG", "display_name": "Muavia", "link": "https://stackoverflow.com/users/1050258/muavia"}, "edited": false, "score": 0, "creation_date": 1514370614, "post_id": 47990191, "comment_id": 82949319, "body": "I was experimenting along the lines of defining <code>APIController.Model</code> as an <code>interface{}</code> but that method had its shortcomings. Yours seems like better option."}], "tags": [], "owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "is_accepted": true, "score": 1, "last_activity_date": 1514369361, "creation_date": 1514369361, "answer_id": 47990191, "question_id": 47982478, "link": "https://stackoverflow.com/questions/47982478/golang-iris-initialize-parent-controllers-model-to-child-controllers-model/47990191#47990191", "title": "Golang Iris: Initialize parent controller&#39;s model to child controller&#39;s model", "body": "<p>First make <code>Model</code> an interface instead of a struct. Have it contain all methods that should be common to all models:</p>\n\n<pre><code>type Model interface {\n    // Common methods\n}\n</code></pre>\n\n<p>Then, as long as <code>User</code> implements all those methods, you can have</p>\n\n<pre><code>c.APIController.Model = new(Models.User) // Now works!\n</code></pre>\n\n<p>One of the common methods could be <code>Save</code>. Otherwise make <code>Save</code> a non-method:</p>\n\n<pre><code>func Save(m Model) error {\n    ...\n}\n</code></pre>\n"}], "owner": {"reputation": 368, "user_id": 1050258, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a7195d0605c38904c4543f67c741cec?s=128&d=identicon&r=PG", "display_name": "Muavia", "link": "https://stackoverflow.com/users/1050258/muavia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 338, "favorite_count": 0, "accepted_answer_id": 47990191, "answer_count": 1, "score": 1, "last_activity_date": 1514369361, "creation_date": 1514313744, "last_edit_date": 1514351557, "question_id": 47982478, "link": "https://stackoverflow.com/questions/47982478/golang-iris-initialize-parent-controllers-model-to-child-controllers-model", "title": "Golang Iris: Initialize parent controller&#39;s model to child controller&#39;s model", "body": "<p>I understand that Go is not an object-oriented language but I'm trying to implement a inheritance structure in my Iris controllers as suggested by <a href=\"https://medium.com/@simplyianm/why-gos-structs-are-superior-to-class-based-inheritance-b661ba897c67\" rel=\"nofollow noreferrer\">this</a> article. My main motivation for doing so is to avoid repetition. So far, it has been working for me. Take a look at the following code for example.</p>\n\n<pre><code>// APIController.go (package Controllers)\ntype APIController struct {\n    mvc.C\n}\nfunc (c *APIController) Post(data map[string][]string) ([]byte, error) {\n    data_parsed := c.ParseFormData(data)\n    return json.Marshal(data_parsed)\n}\n\n// UserController.go  (package Controllers)\ntype UserController struct {\n    mvc.C\n    *APIController\n}\n\nfunc (c *UserController) Post() ([]byte, error) {\n    return c.APIController.Post(c.Ctx.FormValues())\n}\n</code></pre>\n\n<p>So far so good.</p>\n\n<p>But I'm finding it difficult to replicate the same strategy for Models. This is what I've done so far</p>\n\n<pre><code>// Model.go (package Models)\ntype Model struct {\n    Id         string `json:\"_id\"`\n    Created_at string `json:\"created_at\"`\n    Updated_at string `json:\"updated_at\"`\n    Deleted_at string `json:\"deleted_at\"`\n}\n// implements further set of functions to be used by 'child' models...\n\n// User.go (package Models)\ntype User struct {\n    *Model\n\n    First_name string `json:\"first_name\"`\n    Last_name  string `json:\"last_name\"`\n    Email      string `json:\"email\"`\n    Username   string `json:\"username\"`\n    Password   string `json:\"password\"`\n    Last_login string `json:\"last_login\"`\n}\n\n\n// APIController.go (package Controllers)\ntype APIController struct {\n    mvc.C\n    Model Models.Model\n}\n\n// UserController.go  (package Controllers)\ntype UserController struct {\n    mvc.C\n    *APIController\n}\n\nfunc (c *UserController) Post() ([]byte, error) {\n    c.APIController.Model = new(Models.User) //WRONG!\n    return c.APIController.Post(c.Ctx.FormValues())\n}\n</code></pre>\n\n<p>As you can see, the APIController is expecting type <code>Models.Model</code> while UserController is passing <code>*Models.User</code>. The end goal is to have a generic model in APIController that any model from any controller and then is able to call all the functions defined in Models.Model so that I don't have to call those function everywhere. </p>\n\n<p>Is it possible to do so? If not, what might be the best approach to avoid repeating the code?</p>\n\n<p><strong>Update</strong></p>\n\n<p>By using inheritance and single parent model and using that in parent <code>APIController</code>, I want to avoid replicating my filter/CRUD logic. For example, inside <code>UserController</code>, if I want to save a record, then instead of using <code>User.Save(input_data)</code> inside <code>UserController</code>, the <code>Save</code> should ideally be defined inside <code>Models.Model</code> and from <code>APIController</code>, I'm able to call <code>Model.Save(input_data)</code> rather than making the same call from child controllers individually.</p>\n"}, {"tags": ["ruby", "go", "encryption", "rsa"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1514308953, "post_id": 47981709, "comment_id": 82931886, "body": "Why do you need the output to be identical? Have you checked whether the message encrypted by Go can be decrypted by Ruby as required?"}, {"owner": {"reputation": 9795, "user_id": 1566187, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/00cb2ecc49f0f05736dc7c14bbccfeaa?s=128&d=identicon&r=PG", "display_name": "Ely", "link": "https://stackoverflow.com/users/1566187/ely"}, "edited": false, "score": 0, "creation_date": 1514309050, "post_id": 47981709, "comment_id": 82931920, "body": "I&#39;d be interested in the versions you are using for Ruby at least. And the goal or objective. What is the PKI used for concretely ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1514309269, "post_id": 47981709, "comment_id": 82931965, "body": "You should never end up the identical cipher text, else someone would be able to break the encryption."}, {"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 3, "creation_date": 1514310342, "post_id": 47981709, "comment_id": 82932303, "body": "In other words, you did it wrong in Ruby because it gave you the rope to hang yourself, now your looking to do it wrong in Go."}, {"owner": {"reputation": 441, "user_id": 6451721, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh4.googleusercontent.com/-4pC3WCmF5xE/AAAAAAAAAAI/AAAAAAAAAFI/NjnGhmZoI6w/photo.jpg?sz=128", "display_name": "Fer Vargas", "link": "https://stackoverflow.com/users/6451721/fer-vargas"}, "edited": false, "score": 0, "creation_date": 1514310701, "post_id": 47981709, "comment_id": 82932400, "body": "Im using ruby 1.9.3, the encrypted part can be decrypted but ruby doesn&#39;t give the output that is needed.  As a side note, I didn&#39;t code the ruby part that we&#39;re trying to change to golang, that is just the tip of a horrible coded rails iceberg."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514313044, "post_id": 47981709, "comment_id": 82933139, "body": "Can you expand on that? If Ruby can decrypt it, you&#39;re halfway home. What&#39;s wrong with the output? It seems like that&#39;s the problem to fix."}, {"owner": {"reputation": 441, "user_id": 6451721, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh4.googleusercontent.com/-4pC3WCmF5xE/AAAAAAAAAAI/AAAAAAAAAFI/NjnGhmZoI6w/photo.jpg?sz=128", "display_name": "Fer Vargas", "link": "https://stackoverflow.com/users/6451721/fer-vargas"}, "edited": false, "score": 0, "creation_date": 1514313537, "post_id": 47981709, "comment_id": 82933297, "body": "Let me edit the question, since i overlooked a couple of details."}, {"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1514314432, "post_id": 47981709, "comment_id": 82933646, "body": "As far as I can tell all public interfaces available from <code>crypto&#47;rsa</code> enforce either PKCS15 or OAEP padding and will thus always reject your ciphertext during decryption. Either do it right in Ruby or you&#39;ll have to roll your own rsa decryptor in go."}, {"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 1, "creation_date": 1514330771, "post_id": 47981709, "comment_id": 82938378, "body": "To add to everyone else&#39;s concerns, a more existential one.  RSA crypto has a very limited possible message length (somewhat less than the number of bits in the key).  The more typical approach is to use the public key to encrypt a random symmetric key for e.g. AES-256-CBC or similar and use that to send the actual message.  See <a href=\"https://stackoverflow.com/questions/5866129/rsa-encryption-problem-size-of-payload-data\" title=\"rsa encryption problem size of payload data\">stackoverflow.com/questions/5866129/&hellip;</a> and <a href=\"https://crypto.stackexchange.com/questions/14/how-can-i-use-asymmetric-encryption-such-as-rsa-to-encrypt-an-arbitrary-length\" title=\"how can i use asymmetric encryption such as rsa to encrypt an arbitrary length\">crypto.stackexchange.com/questions/14/&hellip;</a>"}, {"owner": {"reputation": 8340, "user_id": 1645712, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/48781792c1fb7d61086b4fb612938c13?s=128&d=identicon&r=PG", "display_name": "gusto2", "link": "https://stackoverflow.com/users/1645712/gusto2"}, "edited": false, "score": 0, "creation_date": 1514358566, "post_id": 47981709, "comment_id": 82944395, "body": "what is the <code>cryptorand</code> variable?"}], "answers": [{"comments": [{"owner": {"reputation": 441, "user_id": 6451721, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh4.googleusercontent.com/-4pC3WCmF5xE/AAAAAAAAAAI/AAAAAAAAAFI/NjnGhmZoI6w/photo.jpg?sz=128", "display_name": "Fer Vargas", "link": "https://stackoverflow.com/users/6451721/fer-vargas"}, "edited": false, "score": 0, "creation_date": 1514406924, "post_id": 47987979, "comment_id": 82964981, "body": "Thank you so much. Now I have a better understanding of how this works, I modified a couple of things in the code and now it works. I edited the question with the changes."}], "tags": [], "owner": {"reputation": 8340, "user_id": 1645712, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/48781792c1fb7d61086b4fb612938c13?s=128&d=identicon&r=PG", "display_name": "gusto2", "link": "https://stackoverflow.com/users/1645712/gusto2"}, "is_accepted": true, "score": 2, "last_activity_date": 1514368549, "last_edit_date": 1514368549, "creation_date": 1514358999, "answer_id": 47987979, "question_id": 47981709, "link": "https://stackoverflow.com/questions/47981709/ruby-rsa-public-key-encryption-to-golang/47987979#47987979", "title": "Ruby RSA public key encryption to Golang", "body": "<p>I am no knowledgeable about golang, however I may know something about RSA.</p>\n\n<p>The difference seems to be in the <a href=\"https://en.wikipedia.org/wiki/Padding_(cryptography)\" rel=\"nofollow noreferrer\">padding</a>.</p>\n\n<p>For ruby - no padding is used<br/>\nFor golang - PKCS1v15 padding is used </p>\n\n<p>In the <em>ruby</em>example you use <code>OpenSSL::PKey::RSA::NO_PADDING</code> is used which is <strong>VERY VERY unsafe</strong>. It is called <em>textbook</em> RSA and is not inteded in real-life use as it has many weaknesses and dangerous traps. So <strong>the ruby example is very dangerously unsafe</strong> because of using the textbook RSA. As well it is limited to encrypting small messages (much smaller than the keyspace).</p>\n\n<p>There are two padding types used with RSA:</p>\n\n<ul>\n<li><p>PKCS1 v1 (commonly referred as PKCS1) - this is a deterministic padding (the output is always the same), many cryptographers consider this option obsolete as some weaknesses has been found when not used properly, but it is still in use and not considered broken.</p></li>\n<li><p>PKCS1 v2 (commonly refered as OAEP or PSS) which is stochastic (randomized) padding. You can distinguish the last two as the output of OAEP is always different.</p></li>\n</ul>\n\n<blockquote>\n  <p>One of the problems is that ruby can encrypt the text with no problem, and in golang I'm getting an error that the key is too short to encrypt everything</p>\n</blockquote>\n\n<p>You've provided only a small part of the golang example, so <em>here I may only assume many things</em>.</p>\n\n<p>As you claim the golang example outputs randomized output and according to the parameters PKCS1 v1.5 is used, I'd assume the implementation is doing <a href=\"https://en.wikipedia.org/wiki/Hybrid_cryptosystem\" rel=\"nofollow noreferrer\">hybrid encryption</a> which is good and much safer way to encrypt data with RSA (using symmetric encryption with random key and wrap/encrypt the key with RSA).</p>\n"}], "owner": {"reputation": 441, "user_id": 6451721, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh4.googleusercontent.com/-4pC3WCmF5xE/AAAAAAAAAAI/AAAAAAAAAFI/NjnGhmZoI6w/photo.jpg?sz=128", "display_name": "Fer Vargas", "link": "https://stackoverflow.com/users/6451721/fer-vargas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 978, "favorite_count": 0, "accepted_answer_id": 47987979, "answer_count": 1, "score": 0, "last_activity_date": 1514406872, "creation_date": 1514308777, "last_edit_date": 1514406872, "question_id": 47981709, "link": "https://stackoverflow.com/questions/47981709/ruby-rsa-public-key-encryption-to-golang", "title": "Ruby RSA public key encryption to Golang", "body": "<p>I'm currently working on a project where I have to \"convert\" some code from Ruby(version 1.9.3p194) to Golang(version 1.7). There is this part where Ruby uses RSA public key encryption and I always get a consistent result every time it gets executed. This is the function used:</p>\n\n<p><strong>Edit</strong>: I overlooked that after the public key encryption, there is a base 64 encoding as well</p>\n\n<pre><code>public_key = OpenSSL::PKey::RSA.new(public_encryption_key)\npublic_encrypted_text = public_key.public_encrypt(text, OpenSSL::PKey::RSA::NO_PADDING)\nbase64_encrypted_text = Base64.encode64(public_encrypted_text).gsub(\"\\n\", \"\")\nescaped_encrypted_text = URI.escape(encrypted_key, \"/+=\")\n</code></pre>\n\n<p>However in Golang, due to the rsa library I can't get a consistent result since the function to encrypt takes a random parameter to generate different result each time. I understand why it needs to be different every time, but i can't get anything remotely similar to what ruby generates. These are the functions used in Golang:</p>\n\n<pre><code>//keyBytes is the public key as []byte\nblock, _ := pem.Decode(keyBytes)\nkey, err := x509.ParsePKIXPublicKey(block.Bytes)\nif err != nil {\n    return nil, err\n}\n\npubKey, ok := key.(*rsa.PublicKey)\nif !ok {\n    return nil, errors.New(\"Cannot convert to rsa.PublicKey\")\n}\n\nresult, err := rsa.EncryptPKCS1v15(cryptorand.Reader, pubKey, text)\nencryptedText := base64.URLEncoding.EncodeToString(result)\nencryptedText = strings.TrimRight(encryptedText, \"=\")\n</code></pre>\n\n<p>One of the problems is that ruby can encrypt the text with no problem, and in golang I'm getting an error that the key is too short to encrypt everything.</p>\n\n<p>If I encrypt something else, like \"Hello\". When decrypting I get from ruby the error \"padding check failed\". The decryption is being handle like follows:</p>\n\n<pre><code>private_key.private_decrypt(Base64.decode64(text))  \n</code></pre>\n\n<p><strong>EDIT:</strong> Thanks to the answer of <a href=\"https://stackoverflow.com/users/1645712/gusto2\">gusto2</a> I now know better what is going on since I didn't have much understanding of RSA.</p>\n\n<p>Now in Golang I was able to encrypt the text using PKCS1 v1.5, and just to be sure I tried to decrypt that as well, also in Golang, with no problem.</p>\n\n<p>However in Ruby I still wasn't able to decrypt using the private key. So I figured that the base64 encoding used in Golang was the issue. So I changed that part to this:</p>\n\n<pre><code>encryptedText := base64.StdEncoding.EncodeToString(result)\n</code></pre>\n\n<p>And also I removed the last line were the equal sign was being trimmed.</p>\n\n<p>With that done it worked like a charm.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1514307461, "post_id": 47981438, "comment_id": 82931440, "body": "All you can do with this type of data would be to declare <code>data</code> to be of type <code>[]interface{}</code> and then either do a bunch of type assertions, or use something like <a href=\"https://github.com/mitchellh/mapstructure\" rel=\"nofollow noreferrer\">mapstructure</a>. This is a very unfortunate API to have to work with I&#39;m afraid."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514365893, "post_id": 47981438, "comment_id": 82947120, "body": "Is there any chance you could limit your sample JSON to only the relevant bits?"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1514309132, "creation_date": 1514309132, "answer_id": 47981754, "question_id": 47981438, "link": "https://stackoverflow.com/questions/47981438/parsing-json-in-go-lang-attribute-without-name/47981754#47981754", "title": "Parsing JSON in Go Lang: Attribute without name", "body": "<p>The <code>data</code> field in your JSON object has an array <code>[\u2026]</code> as its value, and\nin your example that array has two elements: an object and a string apparently containing a floating-point number.</p>\n\n<p>As you can see, this is an array of geterogenous types,\nhence in Go, you have two options:</p>\n\n<ul>\n<li><p>Create a custom type for the elements of that array, and have an\nthat type implement the <code>encoding/json.Unmarshaler</code> interface.</p>\n\n<p>Then, in that method, you can go creative about interpreting what\nkind of data you're about to unmarshal, and act accordingly.\nBasically, you'd peek into the input data using <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Token\" rel=\"nofollow noreferrer\"><code>Decoder.Token</code></a> and then\nunmarshal the whole input byte slice into a value of an appropriate type</p></li>\n<li><p>Have the value for that <code>data</code> field to be unmarshaled into a\nslice of type <code>[]interface{}</code> and then inspect the individual elements\nby a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">type switch</a>\nor a series of \"comma ok\" type asserts.</p>\n\n<p>In this case, an object will be unmarshaled into a map of type\n<code>map[string]interface{}</code>, and that string will be unmarshaled\nto a value of type <code>string</code>.</p></li>\n</ul>\n\n<p>Basically these two approaches can be classified as \"detect type as you go\"\nvs \"unmarshal everything into data structures of the most generic types\nand deal with the real typing afterwards\".</p>\n\n<p>Here's also a third approach.</p>\n\n<p>First, it may well turn out that the types of objects in the array\nwhich is the value of that <code>data</code> field are implicit from their positions\nin the array.  You may act accordingly by unmarshaling the value of <code>data</code>\ninto an object of your custom type implementing <code>json.Unmarshaler</code>, which\n<em>knows</em> which is the real type of each data element it processes.</p>\n\n<p>Second, from that</p>\n\n<pre><code>{\n// speed object can contain following fields:\n// a (accepted), rt (rejected target), rs (rejected stale),\n// rd (rejected duplicate) and ro (rejected other)\n// if fields are not present, speed is 0\n\"a\":\"23.09\", // accepted speed (in MH/s for X11)\n\"rs\":\"0.54\", // rejected speed - stale\n}\n</code></pre>\n\n<p>I'd say that this \"object\" really can have different combinations of fields,\nso to me, this looks like a candidate to be unmarshaled into\ninto <code>map[string]string</code> or <code>map[string]float</code>,\nand not into some <code>struct</code>-typed object.</p>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 3, "last_activity_date": 1514327025, "last_edit_date": 1514327025, "creation_date": 1514313329, "answer_id": 47982413, "question_id": 47981438, "link": "https://stackoverflow.com/questions/47981438/parsing-json-in-go-lang-attribute-without-name/47982413#47982413", "title": "Parsing JSON in Go Lang: Attribute without name", "body": "<p>It seems that this \"data\" object can be described by the following struct types (assuming its shape doesn't vary from your examples):</p>\n\n<pre><code>type Data struct {\n    Timestamp *int64\n    Speed     *Speed\n    Balance   *float64\n}\n\ntype Speed struct {\n    Accepted          *float64 `json:\"a,string,omitempty\"`\n    RejectedTarget    *float64 `json:\"rt,string,omitempty\"`\n    RejectedStale     *float64 `json:\"rs,string,omitempty\"`\n    RejectedDuplicate *float64 `json:\"rd,string,omitempty\"`\n    RejectedOther     *float64 `json:\"ro,string,omitempty\"`\n}\n</code></pre>\n\n<p>The \"Speed\" struct has JSON tags since that object is well-suited for the default JSON un/marshaler.</p>\n\n<p>The \"Data\" struct, however, should implement a custom <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>json.UnmarshalJSON</code></a> so that it can handle the odd choice of a JSON array with varying types to serialize its fields. Note that my sample implementation below uses the <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\"><code>json.RawMessage</code> type</a> to simplify things a bit by allowing the JSON unmarshaler to ensure proper JSON array syntax and store the bytes of each element separately so we can unmarshal them according to their respective types and shapes:</p>\n\n<pre><code>// Parse valid JSON arrays as \"Data\" by assuming one of the following shapes:\n// 1: [int64, Speed, string(float64)]\n// 2: [Speed, string(float64)]\nfunc (d *Data) UnmarshalJSON(bs []byte) error {\n\n    // Ensure that the bytes contains a valid JSON array.\n    msgs := []json.RawMessage{}\n    err := json.Unmarshal(bs, &amp;msgs)\n    if err != nil {\n        return err\n    }\n\n    // Parse the initial message as \"Timestamp\" int64, if necessary.\n    idx := 0\n    if len(msgs) == 3 {\n        ts, err := strconv.ParseInt(string(msgs[idx]), 10, 64)\n        if err != nil {\n            return err\n        }\n        d.Timestamp = &amp;ts\n        idx++\n    }\n\n    // Parse the mandatory \"Speed\" struct per usual.\n    d.Speed = &amp;Speed{}\n    err = json.Unmarshal(msgs[idx], &amp;d.Speed)\n    idx++\n    if err != nil {\n        return err\n    }\n\n    // Parse the mandatory \"Balance\" item after trimming quotes.\n    balance, err := strconv.ParseFloat(string(msgs[idx][1:len(msgs[idx])-1]), 64)\n    if err != nil {\n        return err\n    }\n    d.Balance = &amp;balance\n\n    return nil\n}\n</code></pre>\n\n<p>As such, you can parse valid, properly shaped JSON arrays as \"Data\" objects like so:</p>\n\n<pre><code>jsonstr := `[\n  [4863234, {\"a\":\"28.6\"}, \"0\" ],\n  [{\"a\":\"23.09\",\"rs\":\"0.54\"},\"0.0001234\"]\n]`\n\ndatas := []Data{}\nerr := json.Unmarshal([]byte(jsonstr), &amp;datas)\nif err != nil {\n    panic(err)\n}\n// datas[0] = Data{Timestamp:4863234,Speed{Accepted:28.6},Balance:0}\n// datas[1] = Data{Speed{Accepted:23.09,RejectedStale:0.54},Balance:0.0001234}\n</code></pre>\n\n<p>Of course, you would also need to implement <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\"><code>json.MarshalJSON</code></a> if you want to serialize \"Data\" objects into JSON.</p>\n"}], "owner": {"reputation": 9, "user_id": 7389025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d51cd4d739c98435a3ce0ec7e0f9225b?s=128&d=identicon&r=PG&f=1", "display_name": "dfortu", "link": "https://stackoverflow.com/users/7389025/dfortu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1514327025, "creation_date": 1514307102, "question_id": 47981438, "link": "https://stackoverflow.com/questions/47981438/parsing-json-in-go-lang-attribute-without-name", "title": "Parsing JSON in Go Lang: Attribute without name", "body": "<p>I'm having some trouble parsing a JSON file from an API to Go, this is the JSON I want to parse:</p>\n\n<pre><code>{\"method\":\"stats.provider.ex\",\n\"result\":{\n    \"addr\":\"17a212wdrvEXWuipCV5gcfxdALfMdhMoqh\",\n    \"current\":[{\n        \"algo\":3, // algorithm number (3 = X11)\n        \"name\":\"X11\", // algorithm name\n        \"suffix\":\"MH\", // speed suffix (kH, MH, GH, TH,...)\n        \"profitability\":\"0.00045845\", // current profitability in BTC/suffix/Day\n        \"data\":[{ // speed object can contain following fields:\n              // a (accepted), rt (rejected target), rs (rejected stale),\n              // rd (rejected duplicate) and ro (rejected other)\n              // if fields are not present, speed is 0\n            \"a\":\"23.09\", // accepted speed (in MH/s for X11)\n            \"rs\":\"0.54\", // rejected speed - stale\n            },\n            \"0.0001234\" // balance (unpaid)\n        ]},\n        ... // other algorithms here\n    ],\n    \"past\":[{\n        \"algo\":3,\n        \"data\":[\n            [4863234, // timestamp; multiply with 300 to get UNIX timestamp\n            {\"a\":\"28.6\"}, // speed object\n            \"0\" // balance (unpaid)\n            ],[4863235,{\"a\":\"27.4\"},\"0.00000345\"],\n            ... // next entries with inc. timestamps\n        ]},\n        ... // other algorithms here\n    ],\n    \"payments\":[{\n        \"amount\":\"0.00431400\",\n        \"fee\":\"0.00023000\",\n        \"TXID\":\"txidhere\",\n        \"time\":1453538732, // UNIX timestamp\n        \"type\":0 // payment type (0 for standard NiceHash payment)\n    },\n    ... // other payments here\n    ]\n    }\n}\n</code></pre>\n\n<p>You can find more info about the API in this link: <a href=\"https://www.nicehash.com/doc-api\" rel=\"nofollow noreferrer\">https://www.nicehash.com/doc-api</a></p>\n\n<p>The problem I'm experiencing is in the data attribute:</p>\n\n<pre><code>    \"data\":[{ // speed object can contain following fields:\n          // a (accepted), rt (rejected target), rs (rejected stale),\n          // rd (rejected duplicate) and ro (rejected other)\n          // if fields are not present, speed is 0\n        \"a\":\"23.09\", // accepted speed (in MH/s for X11)\n        \"rs\":\"0.54\", // rejected speed - stale\n        },\n        \"0.0001234\" // balance (unpaid)\n    ]},\n</code></pre>\n\n<p>Because of the balance (unpaid) line, since it doesn't have a name I don't know how to do the struct in go.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514303471, "post_id": 47980689, "comment_id": 82930116, "body": "It looks like the conversion is just fine. If you only want the date part without the time, use <a href=\"https://golang.org/pkg/time/#Time.Format\" rel=\"nofollow noreferrer\"><code>Time.Format()</code></a> or <a href=\"https://golang.org/pkg/time/#Time.Date\" rel=\"nofollow noreferrer\"><code>Time.Date()</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "is_accepted": false, "score": 3, "last_activity_date": 1514303525, "creation_date": 1514303525, "answer_id": 47980851, "question_id": 47980689, "link": "https://stackoverflow.com/questions/47980689/date-conversion-in-go/47980851#47980851", "title": "date conversion in Go", "body": "<p><code>time.Parse</code> returns an object of type <code>time.Time</code> which contains date and time information. There is no type in Go only containing date information. You can however ignore the time part of the date when formatting it, eg:</p>\n\n<pre><code>fmt.Println(\"sdate\", sdate.Format(\"2006-01-02\"))\n</code></pre>\n\n<p>which will print:</p>\n\n<pre><code>sdate 2016-02-03\n</code></pre>\n\n<p>To initialize an empty time, just declare it as:</p>\n\n<pre><code>var sdate time.Time\n</code></pre>\n"}], "owner": {"reputation": 321, "user_id": 9068929, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b34f512608edfd66b7c06f9990fcea3f?s=128&d=identicon&r=PG&f=1", "display_name": "sheik", "link": "https://stackoverflow.com/users/9068929/sheik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1514303525, "creation_date": 1514302675, "last_edit_date": 1514302968, "question_id": 47980689, "link": "https://stackoverflow.com/questions/47980689/date-conversion-in-go", "title": "date conversion in Go", "body": "<p>I have below code. Having date value as string type from request and trying to convert to time type. But, I have some issue with format.</p>\n\n<pre><code>type LeanData struct {\n    Start_Date time.Time\n}   \nconst dateLayout = \"01-02-2006\"\n\nstartdate := request.FormValue(\"startdate\")\nif len(strings.TrimSpace(startdate)) &gt; 0 {\n    sdate, err := time.Parse(dateLayout, startdate)\n}\nfmt.Println(\"startdate\", startdate)\nfmt.Println(\"sdate\", sdate)\n</code></pre>\n\n<p>I have below output.</p>\n\n<pre><code>startdate 02-03-2016\nsdate 2016-02-03 00:00:00 +0000 UTC\n</code></pre>\n\n<p>Here, I am doing conversion because start date is of type time.Time.\n I want to convert it as 2016-02-03 but not with 2016-02-03 00:00:00 +0000 UTC. \nAlso, How to assign empty value to start date if value from request is nil/empty.</p>\n\n<p>Can someone let me know how to achieve this?</p>\n"}, {"tags": ["winapi", "go", "dll"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1514297401, "post_id": 47979699, "comment_id": 82927989, "body": "I highly doubt the error says &quot;path isn&#39;t exist&quot;, because that&#39;s grammatically incorrect. Can you paste the <i>exact</i> error?"}, {"owner": {"reputation": 26461, "user_id": 2141621, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/525cb8cf58e22b35b9bfc99d52cde986?s=128&d=identicon&r=PG&f=1", "display_name": "Camilo Terevinto", "link": "https://stackoverflow.com/users/2141621/camilo-terevinto"}, "edited": false, "score": 1, "creation_date": 1514297501, "post_id": 47979699, "comment_id": 82928027, "body": "Not sure why you though that <a href=\"https://stackoverflow.com/questions/tagged/c%23\">c#</a> is related to this question, so I removed it. Please only add tags relevant to the problem at hand."}, {"owner": {"reputation": 161, "user_id": 1097694, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/39866d95b0fd78089070ed2a6ac68576?s=128&d=identicon&r=PG&f=1", "display_name": "MrTwister", "link": "https://stackoverflow.com/users/1097694/mrtwister"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514298462, "post_id": 47979699, "comment_id": 82928373, "body": "@Flimzy yeah, that was just example. Also name of dll is not a &#39;dllname.dll&#39; ;)"}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 1097694, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/39866d95b0fd78089070ed2a6ac68576?s=128&d=identicon&r=PG&f=1", "display_name": "MrTwister", "link": "https://stackoverflow.com/users/1097694/mrtwister"}, "edited": false, "score": 0, "creation_date": 1514297506, "post_id": 47979728, "comment_id": 82928031, "body": "Why do you use &amp;bytePath[0] ? I tried to make a NULL terminated path, but i don&#39;t know about [0]. I mean, it works! Thank you! But what is [0] and where can i read about this?"}, {"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "reply_to_user": {"reputation": 161, "user_id": 1097694, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/39866d95b0fd78089070ed2a6ac68576?s=128&d=identicon&r=PG&f=1", "display_name": "MrTwister", "link": "https://stackoverflow.com/users/1097694/mrtwister"}, "edited": false, "score": 1, "creation_date": 1514298596, "post_id": 47979728, "comment_id": 82928409, "body": "@MrTwister It&#39;s because of difference between Go strings and what Windows want. Go string is (somewhat) a length + pointer to byte array. Windows (i.e. C string) want a byte array ending in NULL (character with 0 code). <code>bytePath[0]</code> is the first letter of byte array."}, {"owner": {"reputation": 161, "user_id": 1097694, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/39866d95b0fd78089070ed2a6ac68576?s=128&d=identicon&r=PG&f=1", "display_name": "MrTwister", "link": "https://stackoverflow.com/users/1097694/mrtwister"}, "reply_to_user": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "edited": false, "score": 0, "creation_date": 1514299449, "post_id": 47979728, "comment_id": 82928688, "body": "@ArmanOrdookhani yes, i know about NULL character and [0] is the first element :) Surprise for me is that i need to use this first element of pointer instead of just &amp;bytePath."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1514304055, "post_id": 47979728, "comment_id": 82930294, "body": "I would add a couple of assorted ideas: 1) The &quot;golang.org/x/sys/windows&quot; is not needed; just import &quot;syscall&quot; which, on Windows, contains all those <code>MustLoadDLL</code> et al; 2) The approach with <code>[]byte(path\u2026</code> only works for pathnames which are composed solely of 7-bit-clean (that is, US-ASCII) characters which is not too interesting in the present days of globalization. If this property of the paths can be guaranteed (i.e., the code will only run in a sufficiently controlled environment), that&#39;s OK; otherwise one should supposedly first convert the pathname to the active system&#39;s &quot;code page&quot;."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1514304195, "post_id": 47979728, "comment_id": 82930335, "body": "The latter can be done by calling <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd318070\" rel=\"nofollow noreferrer\"><code>kernel32!GetACP</code></a> and then using it with <code>golang.org&#47;x&#47;text&#47;encoding</code> (and its <code>charmap</code> subpackage). The result of the conversion can then be NUL-terminated and supplied down to the call of that DLL&#39;s function."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1514304410, "post_id": 47979728, "comment_id": 82930403, "body": "To expand on my first note, <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">the strings in Go are assumed do be encoded in UTF-8</a>, and type-converting them to <code>[]byte</code> would only be semantically correct if either the DLL indeed expects UTF-8-encoded pathnames (which would be very weird for Windows-specific code) or the source string only contains 7-bit characters which are encoded using a single byte each\u2014as opposed to other Unicode characters which end up encoded with 2 or more bytes eac in UTF-8."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 5, "last_activity_date": 1514297272, "creation_date": 1514297272, "answer_id": 47979728, "question_id": 47979699, "link": "https://stackoverflow.com/questions/47979699/using-dll-in-windows-go/47979728#47979728", "title": "Using DLL in windows Go", "body": "<p>Your path likely needs to be NUL terminated:</p>\n\n<pre><code>import (\n  \"golang.org/x/sys/windows\"\n)\n\nvar (\n  lib = windows.MustLoadDLL(\"dllname.dll\")\n  init = lib.MustFindProc(\"Init\")\n)\n\nfunc main() {\n  path := \"some\"\n  bytePath = []byte(path + \"\\x00\")\n\n  init.Call(\n    uintptr(unsafe.Pointer(&amp;bytePath[0])),\n    uintptr(9)\n  )\n}\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 1097694, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/39866d95b0fd78089070ed2a6ac68576?s=128&d=identicon&r=PG&f=1", "display_name": "MrTwister", "link": "https://stackoverflow.com/users/1097694/mrtwister"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 0, "accepted_answer_id": 47979728, "answer_count": 1, "score": 0, "last_activity_date": 1514303803, "creation_date": 1514297107, "last_edit_date": 1514303803, "question_id": 47979699, "link": "https://stackoverflow.com/questions/47979699/using-dll-in-windows-go", "title": "Using DLL in windows Go", "body": "<p>I'm trying to use proprietary DLL in my Go project.</p>\n\n<p>One of DLL's method description looks like this:</p>\n\n<pre><code>BYTE*   Init(const BYTE* path, int id);\n</code></pre>\n\n<p>in my test Go project I'm doing something like:</p>\n\n<pre><code>import (\n  \"golang.org/x/sys/windows\"\n)\n\nvar (\n  lib = windows.MustLoadDLL(\"dllname.dll\")\n  init = lib.MustFindProc(\"Init\")\n)\n\nfunc main() {\n  path := \"some\"\n  bytePath = []byte(path)\n\n  init.Call(\n    uintptr(unsafe.Pointer(&amp;bytePath)),\n    uintptr(9)\n  )\n}\n</code></pre>\n\n<p>Library gets called, there is an error message \"path isn't exist\", but I think that type of my path is not right. That's why library can't see the folder.</p>\n\n<p>Maybe there is a better way of doing this? Maybe it's a bad case of Go usage and I should find some package or even language?</p>\n"}, {"tags": ["mongodb", "go", "cron"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1514296014, "post_id": 47979278, "comment_id": 82927543, "body": "You would do well to use <code>gofmt</code>. Your code currently is very hard to read."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514296454, "post_id": 47979278, "comment_id": 82927703, "body": "Where is <code>config</code> defined? It looks like a global variable... if that&#39;s true, then your code is incredibly racy and buggy."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514296790, "post_id": 47979278, "comment_id": 82927799, "body": "@Flimzy Yes, Config is a package which is being used in other packages. It holds some global variables to be used by the system. The code is not buggy, it is simply using config global variables to generate correct output."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1514297231, "post_id": 47979278, "comment_id": 82927943, "body": "Okay, then your code is terribly buggy. Having middleware set a global variable is a sure way to a) make your program crash, b) access the wrong database randomly."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1514297970, "post_id": 47979278, "comment_id": 82928168, "body": "And I assure you, your code is buggy. Setting a global variable as you do, is racy. If two requests happen at the same time, they will collide and your program will crash with a data race. If two requests happen at nearly the same time, one is liable to use the other&#39;s database configuration. Unless you intend your program to crash, and to use the wrong database, these are bugs."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514297976, "post_id": 47979278, "comment_id": 82928172, "body": "Thanks for identifying these bugs. Actually, I am new to Golang. And this is my First Go project. So Can you guide me over why I should not declare globals in config. Or if there is any tutorial or article available about this, You can provide that also."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514298009, "post_id": 47979278, "comment_id": 82928190, "body": "Connection-scoped variables <i>are not config</i>. Treating them as such leads to this sort of problem. In any language. It has nothing to do with Go. Scope your variables properly, and this won&#39;t be an issue."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514299025, "post_id": 47979278, "comment_id": 82928543, "body": "@Flimzy I have build the REST api to serve content on different routes, In order to connect to DB I had to setup it as config. Can you guide me to approach it properly. As you are explaining you must have worked on this type of requirement and can guide me ( or provide me the tutorial links ) in answer"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1514299044, "post_id": 47979278, "comment_id": 82928547, "body": "I think you just need to do some refactoring; having the DB selection tied to request handling makes creating your cron job unnecessarily difficult. Having a shell script make a localhost GET request is even worse. Your request handlers and cron task should both get their DB connection from elsewhere; the request handlers from the router, the cron task from command line, env, or config file."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514299335, "post_id": 47979278, "comment_id": 82928647, "body": "@Adrian As I mentioned each merchant will have separate API url <a href=\"http://merchant.domain.com/api/v1/customer\" rel=\"nofollow noreferrer\">merchant.domain.com/api/v1/customer</a>  and each API needs to get the data from merchant specific database ( I create a new DB for each merchant on singup ) , so what would be the best way to do it ?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514299434, "post_id": 47979278, "comment_id": 82928684, "body": "Yeah, I read the question. If you&#39;re talking about a cron job, you need to stop thinking about URLs. A cron job doesn&#39;t get accessed by URL. As I wrote in my previous comment, the cron job should receive its configuration from command line, config file, or env vars."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514299535, "post_id": 47979278, "comment_id": 82928730, "body": "@Adrian I am trying for the same but not sure how can I do it. Do you have any idea or any tutorial, reference link on this ?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1514299624, "post_id": 47979278, "comment_id": 82928770, "body": "A simple web search should turn up a ton of resources on these topics. Requesting recommendations for off-site resources is off-topic for SO."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514299675, "post_id": 47979278, "comment_id": 82928782, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/161981/discussion-between-amandeep-kaur-and-adrian\">continue this discussion in chat</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514300797, "post_id": 47979278, "comment_id": 82929200, "body": "Proper program organization is not a simple matter of &quot;follow N steps.&quot; It&#39;s a learned skill. It can take years to master it. It&#39;s well beyond scope for a SO question. The bite-sized version is rules like &quot;don&#39;t use global variables&quot;, which in this case, would get you a long way."}], "answers": [{"comments": [{"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1514296987, "post_id": 47979517, "comment_id": 82927860, "body": "@Filmzy, To work <code>SetMerchantDatabase</code> independently of Router, How will I get database name as for now it is coming from a url that hits an API. I would probably need the url from which I can get the database name."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1514297023, "post_id": 47979517, "comment_id": 82927870, "body": "Can not we use shell scipt for this ?? I searched a lot for this but could not find any appropriate content for my requirement."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 1, "creation_date": 1514297281, "post_id": 47979517, "comment_id": 82927962, "body": "Your program is just very poorly designed. There&#39;s not a correct way to fix it, as it&#39;s entirely wrong at present."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1514296124, "creation_date": 1514296124, "answer_id": 47979517, "question_id": 47979278, "link": "https://stackoverflow.com/questions/47979278/run-cron-in-golang-while-having-different-databases/47979517#47979517", "title": "Run cron in Golang while having different databases", "body": "<p>You need to adapt <code>SetMerchantDatabase</code> to work independently of your router. Then you can have it set things for Cron just as well.</p>\n"}], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 499, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1514296124, "creation_date": 1514294603, "last_edit_date": 1514295991, "question_id": 47979278, "link": "https://stackoverflow.com/questions/47979278/run-cron-in-golang-while-having-different-databases", "title": "Run cron in Golang while having different databases", "body": "<p>I am working on a SaaS based project on which Merchants can subscribe to set up their online store. </p>\n\n<p><strong>Project Overview</strong></p>\n\n<p>I am using Golang (backend), Mongodb database service and Angular4 (frontend) to build the system. I have multiple merchants that can set up their store. Each merchant has its own url (having its business name as subdomain in the url) to connect to his database. </p>\n\n<p>For Routing, I am using Golang's Gin framework at back end. </p>\n\n<p><strong>Problem</strong></p>\n\n<p>I want to run the cron jobs for the merchant-specific database. In these cron jobs there are some operations that need to connect to the database. But in my routing, until a route for an API is called, the database won't be set. And ultimately, the cron does not run with proper data.</p>\n\n<p><strong>Code</strong></p>\n\n<p><strong>cron.go</strong></p>\n\n<pre><code>package cron\n\nimport (\n    \"gopkg.in/robfig/cron.v2\"\n    \"controllers\"\n)\nfunc RunCron(){ \n  c := cron.New()\n  c.AddFunc(\"@every 0h1m0s\", controllers.ExpireProviderInvitation)\n  c.Start()\n}\n</code></pre>\n\n<p><strong>Controller function</strong></p>\n\n<pre><code>func ExpireProviderInvitation() {\n    bookingAcceptTimeSetting, _ := models.GetMerchantSetting(bson.M{\"section\": \"providers\", \"option_name\": \"bookings_accept_time\"})\n    if bookingAcceptTimeSetting.OptionValue != nil{\n        allInvitations, _ := models.GetAllBookingInvitations(bson.M{ \"status\": 0, \"send_type\": \"invitation\", \"datetime\": bson.M{\"$le\": float64(time.Now().Unix()) - bookingAcceptTimeSetting.OptionValue.(float64)} })\n        if len(allInvitations) &gt; 0 {\n            for _, invitationData := range allInvitations {\n                _ = GetNextAvailableProvider(invitationData.Bid, invitationData.Pid)\n            }\n        }\n    }   \n}\n</code></pre>\n\n<p><strong>router.go</strong></p>\n\n<pre><code>func NewRouter() {\n    router := gin.Default()\n    router.Use(gin.Recovery())\n    router.Use(SetMerchantDatabase)\n\n    public := router.Group(\"/api/v1\")\n    for _, route := range publicRoutes{\n        switch route.Method {\n            case    \"GET\"   :   public.GET(route.Pattern, route.HandlerFunc)\n            case    \"POST\"  :   public.POST(route.Pattern, route.HandlerFunc)\n            case    \"PUT\"   :   public.PUT(route.Pattern, route.HandlerFunc)\n            case    \"DELETE\":   public.DELETE(route.Pattern, route.HandlerFunc) \n            default         :   public.GET(route.Pattern, func(c *gin.Context){\n                                    c.JSON(200, gin.H{\n                                        \"result\": \"Specify a valid http method with this route.\",\n                                    })\n                                })\n        }\n    }\n    router.NoRoute(controllers.UnauthorizedAccessResponse)\n    router.Run(\":8080\")\n}\n\nfunc SetMerchantDatabase(c *gin.Context){\n    subdomain := strings.Split(c.Request.Host, \".\")\n\n    if len(subdomain) &gt; 0{\n        config.Database = subdomain[0]\n        config.CurrentBusinessName = subdomain[0]\n    }else{\n        errMsg := \"Failed: Invalid domain in headers.\"\n        response := controllers.ResponseController{\n            config.FailureCode,\n            config.FailureFlag,\n            errMsg,\n            nil,\n        }\n        controllers.GetResponse(c, response)\n        c.Abort()\n    }\n    c.Next()\n}\n</code></pre>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"cron\"\n)\n\nfunc main(){\n    cron.RunCron()\n    NewRouter()\n} \n</code></pre>\n\n<p><strong>Explanation of above code</strong></p>\n\n<p>An example route can be:</p>\n\n<pre><code>Route{ \"AddCustomer\", \"POST\", \"/customer\", controllers.SaveCustomer },\n</code></pre>\n\n<p>An example API url can be:</p>\n\n<p><a href=\"http://business-name.main-domain.com/api/v1/customer\" rel=\"nofollow noreferrer\">http://business-name.main-domain.com/api/v1/customer</a></p>\n\n<p>Where \"business-name\" is the database which is set whenever an API is called.\nI want to run my cron without calling an API route. </p>\n\n<p><strong>Alternative approach</strong></p>\n\n<p>In Shell script, we can run cron by hitting url as a command. For this, I can create a url to run it as a command. But this is my theoratical approach. Also I don't know how will I get different merchant databases.</p>\n\n<p>I am not sure if this approach will work. Any kind of help will be greatly appreciated.</p>\n"}, {"tags": ["go", "memory-management", "garbage-collection"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1514294594, "post_id": 47979203, "comment_id": 82927015, "body": "Go is garbage collected. You don\u2019t do anything other than remove them from your data structure."}, {"owner": {"reputation": 577, "user_id": 3786665, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b17f61f6f0fd6680a9ed7d07ca531b37?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyWu", "link": "https://stackoverflow.com/users/3786665/crazywu"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1514295015, "post_id": 47979203, "comment_id": 82927204, "body": "@JimB can you explaing, at what moment, garbage collector will recognize this data in memory as garbage? (didn&#39;t get it)"}], "answers": [{"comments": [{"owner": {"reputation": 577, "user_id": 3786665, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b17f61f6f0fd6680a9ed7d07ca531b37?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyWu", "link": "https://stackoverflow.com/users/3786665/crazywu"}, "edited": false, "score": 0, "creation_date": 1514298288, "post_id": 47979881, "comment_id": 82928306, "body": "thanks for the good explanation"}, {"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "reply_to_user": {"reputation": 577, "user_id": 3786665, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b17f61f6f0fd6680a9ed7d07ca531b37?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyWu", "link": "https://stackoverflow.com/users/3786665/crazywu"}, "edited": false, "score": 0, "creation_date": 1514298393, "post_id": 47979881, "comment_id": 82928354, "body": "@CrazyWu Your welcome :)"}, {"owner": {"reputation": 1675, "user_id": 5797600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xGBIh.jpg?s=128&g=1", "display_name": "Xiak", "link": "https://stackoverflow.com/users/5797600/xiak"}, "edited": false, "score": 0, "creation_date": 1616145668, "post_id": 47979881, "comment_id": 117916359, "body": "current.next = nil and current.pre = nil"}, {"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "reply_to_user": {"reputation": 1675, "user_id": 5797600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xGBIh.jpg?s=128&g=1", "display_name": "Xiak", "link": "https://stackoverflow.com/users/5797600/xiak"}, "edited": false, "score": 0, "creation_date": 1616156989, "post_id": 47979881, "comment_id": 117920973, "body": "@Xiak why? .prev was not set to begin with."}], "tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": true, "score": 13, "last_activity_date": 1564402372, "last_edit_date": 1564402372, "creation_date": 1514298157, "answer_id": 47979881, "question_id": 47979203, "link": "https://stackoverflow.com/questions/47979203/how-to-free-memory-in-go/47979881#47979881", "title": "How to free memory in go?", "body": "<p>Go has garbage collection. It will scan for data that has no pointer to it and remove it from heap (Garbage collector is running beside your program). The only thing you should do is:</p>\n\n<pre><code>Current.next = nil\n</code></pre>\n\n<p>Your <code>elem{}</code> will be removed from memory eventually after you remove all pointers to it (It's not deterministic. Can't tell exactly when <code>elem{}</code> will be released). There are different implementations of garbage collection; Go's implementation may change at any time.</p>\n\n<p>If <code>Current</code> goes out of scope, you don't even need to set <code>next</code> to <code>nil</code>.</p>\n"}], "owner": {"reputation": 577, "user_id": 3786665, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b17f61f6f0fd6680a9ed7d07ca531b37?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyWu", "link": "https://stackoverflow.com/users/3786665/crazywu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13045, "favorite_count": 0, "closed_date": 1514324769, "accepted_answer_id": 47979881, "answer_count": 1, "score": 4, "last_activity_date": 1564402372, "creation_date": 1514294234, "last_edit_date": 1514295395, "question_id": 47979203, "link": "https://stackoverflow.com/questions/47979203/how-to-free-memory-in-go", "closed_reason": "Duplicate", "title": "How to free memory in go?", "body": "<p>I've started to learn Go, and found something I'm not able to find info about.</p>\n\n<p>For example, if I'm making my own list structure</p>\n\n<pre><code>type elem struct {\n    prev  *elem\n    next  *elem\n    value string\n}\n</code></pre>\n\n<p>And adding new elements to it with</p>\n\n<pre><code>Current.next = &amp;elem{}\n</code></pre>\n\n<p>How should I remove them? I mean, how can I remove data of elem from memory, not just from the list?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 6139, "user_id": 1613047, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/qMfD4.jpg?s=128&g=1", "display_name": "Aero Wang", "link": "https://stackoverflow.com/users/1613047/aero-wang"}, "edited": false, "score": 0, "creation_date": 1514340607, "post_id": 47979093, "comment_id": 82940030, "body": "Then it says <code>unused variable proxy</code>."}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 4, "last_activity_date": 1514294115, "last_edit_date": 1514294115, "creation_date": 1514293698, "answer_id": 47979093, "question_id": 47979037, "link": "https://stackoverflow.com/questions/47979037/why-is-the-proxy-undefined/47979093#47979093", "title": "Why is the proxy undefined?", "body": "<blockquote>\n  <p>Why is the proxy undefined?</p>\n</blockquote>\n\n<p>Because it is hidden by the <code>if</code> statement.</p>\n\n<p>You need define the <code>proxy</code> variable before <code>if</code> statement:</p>\n\n<pre><code>proxy := \"\" // or var proxy string\nif len(p) &gt; 1 {\n  proxy = p[1]\n} else {\n  proxy = \"127.0.0.1:9998\"\n}\n</code></pre>\n"}], "owner": {"reputation": 6139, "user_id": 1613047, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/qMfD4.jpg?s=128&g=1", "display_name": "Aero Wang", "link": "https://stackoverflow.com/users/1613047/aero-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 47979093, "answer_count": 1, "score": -3, "last_activity_date": 1514294115, "creation_date": 1514293365, "question_id": 47979037, "link": "https://stackoverflow.com/questions/47979037/why-is-the-proxy-undefined", "title": "Why is the proxy undefined?", "body": "<pre><code>func check(e error) {\n  if e != nil {\n    panic(e)\n  }\n}\nfunc main() {\n  addr := flag.String(\"addr\", \":9999\", \"server addr\")\n  flag.Parse()\n  http.HandleFunc(\"/\", WhitelistHandler)\n  http.ListenAndServe(*addr, nil)\n}\nfunc WhitelistHandler(w http.ResponseWriter, r *http.Request) {\n  pwd, _ := os.Getwd()\n  dat, err := ioutil.ReadFile(pwd + \"/whitelist.pac\")\n  check(err)\n  p := strings.Split(r.URL.Path, \"/\")\n  if len(p) &gt; 1 {\n    proxy := p[1]\n  } else {\n    proxy := \"127.0.0.1:9998\"\n  }\n  if strings.Contains(p[0], \"socks\") {\n    io.WriteString(w, string(`var wall_proxy = \"SOCKS5 `) + string(proxy) + string(\";SOCKS \") + string(proxy) + string(`;\";`) + string(\"\\n\") + string(dat))\n  } else {\n    io.WriteString(w, string(`var wall_proxy = \"PROXY `) + string(proxy) + string(`\";`) + string(\"\\n\") + string(dat))\n  }\n}\n</code></pre>\n\n<p>If I run this I will get:</p>\n\n<pre><code>./gowhitelist.go:36:68: undefined: proxy\n./gowhitelist.go:38:67: undefined: proxy\n</code></pre>\n"}, {"tags": ["android", "go"], "comments": [{"owner": {"reputation": 905471, "user_id": 115145, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/wDnd8.png?s=128&g=1", "display_name": "CommonsWare", "link": "https://stackoverflow.com/users/115145/commonsware"}, "edited": false, "score": 0, "creation_date": 1514291380, "post_id": 47978632, "comment_id": 82925954, "body": "&quot;foreground application is the application that occupies the screen&quot; -- there can be more than one &quot;foreground application&quot;, by your definition. &quot;I want the solution to use native linux ways&quot; -- most things in Android cannot be accomplished by &quot;native linux ways&quot;."}, {"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "reply_to_user": {"reputation": 905471, "user_id": 115145, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/wDnd8.png?s=128&g=1", "display_name": "CommonsWare", "link": "https://stackoverflow.com/users/115145/commonsware"}, "edited": false, "score": 0, "creation_date": 1514292133, "post_id": 47978632, "comment_id": 82926241, "body": "@CommonsWare OK, to be more precise, I want the app that takes FULL screen, not that some widget that shows the weather info...  I can even accept solutions that is NOT accurate, e.g. if an application has a higher priority can be reasonably &quot;guessed&quot; as being foreground, I can accept that solution, anything that does not rely on android-sdk is a candidate.  To clarify my purpose, I am writing an application that kills background application, or any application that is started without my consent."}, {"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "reply_to_user": {"reputation": 905471, "user_id": 115145, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/wDnd8.png?s=128&g=1", "display_name": "CommonsWare", "link": "https://stackoverflow.com/users/115145/commonsware"}, "edited": false, "score": 0, "creation_date": 1514292550, "post_id": 47978632, "comment_id": 82926372, "body": "to clarify my purpose, I want to write a service runs in background that kills any application launched without my consent, so I just want to avoid kill an application while I am using it."}, {"owner": {"reputation": 905471, "user_id": 115145, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/wDnd8.png?s=128&g=1", "display_name": "CommonsWare", "link": "https://stackoverflow.com/users/115145/commonsware"}, "edited": false, "score": 1, "creation_date": 1514292865, "post_id": 47978632, "comment_id": 82926460, "body": "&quot;I want the app that takes FULL screen, not that some widget that shows the weather info&quot; -- I was referring to multi-window (added to all phones and tablets with Android 7.0, plus some manufacturer-specific solutions before then). &quot;I want to write a service runs in background that kills any application launched without my consent, so I just want to avoid kill an application while I am using it&quot; -- that&#39;s an odd use of an HTTP daemon. Regardless, unless your device is old, rooted, or both, it would be difficult to do this <i>with</i> the SDK, let alone without it."}, {"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "reply_to_user": {"reputation": 905471, "user_id": 115145, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/wDnd8.png?s=128&g=1", "display_name": "CommonsWare", "link": "https://stackoverflow.com/users/115145/commonsware"}, "edited": false, "score": 0, "creation_date": 1514297458, "post_id": 47978632, "comment_id": 82928013, "body": "@CommonsWare I tested and unfortunately my idea requires root privilege... however, if I get root, I still think this is workable... as regarding http, I just try to use that to write a control UI, not in the focus of the whole idea."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1608154100, "post_id": 47978632, "comment_id": 115499534, "body": "I guess an android app is aware of its focus (much like web api does), using that this app can tell the background which focus state it has. but it is client dependant."}, {"owner": {"reputation": 1888, "user_id": 5509575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50f2debfe039604b4e24c7769935bca5?s=128&d=identicon&r=PG&f=1", "display_name": "Hack5", "link": "https://stackoverflow.com/users/5509575/hack5"}, "edited": false, "score": 0, "creation_date": 1608293034, "post_id": 47978632, "comment_id": 115545193, "body": "Do you have ADB access? Or better, root? Remember you can actually do a self-connection via ADB-WiFi on loopback, so if the device has at least Android 11, it can be done with minimal user interaction once per reboot."}, {"owner": {"reputation": 1888, "user_id": 5509575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50f2debfe039604b4e24c7769935bca5?s=128&d=identicon&r=PG&f=1", "display_name": "Hack5", "link": "https://stackoverflow.com/users/5509575/hack5"}, "edited": false, "score": 0, "creation_date": 1608294086, "post_id": 47978632, "comment_id": 115545584, "body": "Also, do you mind spawning an ART subprocess to run Java code as a subprocess of your Go app?"}, {"owner": {"reputation": 391, "user_id": 9708904, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gY074.jpg?s=128&g=1", "display_name": "Danial clarc", "link": "https://stackoverflow.com/users/9708904/danial-clarc"}, "edited": false, "score": 0, "creation_date": 1608558781, "post_id": 47978632, "comment_id": 115612834, "body": "You can not kill other apps without having a native app of yourself on the device, and for that, you are going to need to work with services in android"}], "answers": [{"tags": [], "owner": {"reputation": 1890, "user_id": 5164318, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2VjzX.jpg?s=128&g=1", "display_name": "emandt", "link": "https://stackoverflow.com/users/5164318/emandt"}, "is_accepted": true, "score": 0, "last_activity_date": 1608557878, "creation_date": 1608557878, "answer_id": 65393790, "question_id": 47978632, "link": "https://stackoverflow.com/questions/47978632/android-how-to-get-the-process-id-of-the-foreground-app/65393790#65393790", "title": "Android: How to get the process id of the foreground app", "body": "<p>Starting from Android SDK 26 (if I remember well) Apps are executed on -one-User-per-App, so (i.e.) WhatsApp is running on UID=30 and Telegram on UID=76, so executing a ROOT command of &quot;ps -A -o PID,USER,NAME&quot; you can parse output and then Kill all Processes that you don't want to be executed.</p>\n<pre><code>36119 u30_a149     &lt;WhatsApp_packagename&gt;\n36203 u76_a211     &lt;Telegram_packagename&gt;\n37399 root         [kworker/1:2H]\n37423 u0_a329      su\n38069 root         sh\n</code></pre>\n<p>Without Root Permissions nothing of what you're trying to achieve is possible simply because is not possibile to denied an application to be executed or to kill it without Superuser privilege.</p>\n"}], "owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 469, "favorite_count": 2, "accepted_answer_id": 65393790, "answer_count": 1, "score": 7, "last_activity_date": 1608557878, "creation_date": 1514291088, "last_edit_date": 1608279863, "question_id": 47978632, "link": "https://stackoverflow.com/questions/47978632/android-how-to-get-the-process-id-of-the-foreground-app", "title": "Android: How to get the process id of the foreground app", "body": "<p>First of all, please note that this question is <em>not</em> same as all the &quot;android foreground app&quot; questions I found on SO, please read on :-)</p>\n<p>I'm trying to write an android app for my own use, using golang, <em>without</em> using android-sdk or ndk (this is the KEY point).  It is pretty simple, just use golang to write a http service, compile it for arm CPU and voila my app is running and can be access by simply visit http://localhost.</p>\n<p>For the purpose of my app, I need to know the currently running foreground application, to define it precisely:</p>\n<ol>\n<li><p>Foreground application is the application that occupies the screen, or has an &quot;activity&quot; what-so-ever (forgive me I'm not an android developer).</p>\n</li>\n<li><p>Anything that that is depended by the foreground application (e.g. services) is NOT what I am interested in.</p>\n</li>\n<li><p>If the phone is LOCKED/screen turned off, I want the solution to tell me there is NO foreground app.</p>\n</li>\n</ol>\n<p>And since I do not use anything android, just treat the phone as a LINUX machine, I want the solution to use native LINUX ways, e.g. by inspect /proc, or by calling any installed android command line tool (including sending messages via these command line tools), but <strong>NOT</strong> using any SDK/NDK way so that I have to use java or incorporate these thing into my app.</p>\n"}, {"tags": ["go", "dependencies"], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 1, "last_activity_date": 1514305272, "creation_date": 1514305272, "answer_id": 47981139, "question_id": 47978414, "link": "https://stackoverflow.com/questions/47978414/golang-dep-having-multiple-binaries-in-one-source-tree/47981139#47981139", "title": "Golang Dep: having multiple binaries in one source tree", "body": "<p>Normally, you'd just have a single root/vendor directory that all your various deps that are referenced by the <code>lib</code> and <code>cmd</code> code</p>\n\n<p>When compiling, just do it like normal.</p>\n\n<p><code>go install ./cmd/...</code></p>\n\n<p>(or however you want to build)</p>\n"}], "owner": {"reputation": 2563, "user_id": 2736017, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/uLQEA.jpg?s=128&g=1", "display_name": "vania-pooh", "link": "https://stackoverflow.com/users/2736017/vania-pooh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 301, "favorite_count": 0, "accepted_answer_id": 47981139, "answer_count": 1, "score": 0, "last_activity_date": 1514305272, "creation_date": 1514289955, "question_id": 47978414, "link": "https://stackoverflow.com/questions/47978414/golang-dep-having-multiple-binaries-in-one-source-tree", "title": "Golang Dep: having multiple binaries in one source tree", "body": "<p>Having the following Go project layout with shared library functions in <code>lib</code> and several binaries in <code>cmd</code> using these library functions and having external dependencies:</p>\n\n<pre><code>root\n   |\n   lib\n   cmd\n     |\n     binary1\n           |\n           main.go\n     binary2\n           |\n           main.go\n     ...\n</code></pre>\n\n<p>Searching for a simple way to handle project dependencies with <code>dep</code> tool. What is the expected usage pattern: having multiple <code>Gopkg.*</code> files in each <code>binaryX</code> directory or using a pair of <code>Gopkg.toml</code> and <code>Gopkg.lock</code> files for all these binaries? In the second case how would we compile these binaries knowing that <code>vendor</code> directory will be in project root instead of <code>binaryX</code> directories?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 1, "creation_date": 1514296411, "post_id": 47977818, "comment_id": 82927685, "body": "as pointed out below, <code>speak</code> has no return value, so it can&#39;t pass anything to <code>fmt.Println</code>. Not directly related, but still worth pointing out: function names in golang are camelCased (or CamelCased for exported ones). The function <code>animal_speak</code> would be flagged up in code-review and should be changed to <code>AnimalSpeak</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514299360, "post_id": 47977818, "comment_id": 82928658, "body": "Or <code>animalSpeak</code> if it doesn&#39;t need to be exported!"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 6, "last_activity_date": 1514287188, "creation_date": 1514287188, "answer_id": 47977851, "question_id": 47977818, "link": "https://stackoverflow.com/questions/47977818/golang-interface-used-as-value-error/47977851#47977851", "title": "golang interface &quot;used as value&quot; error", "body": "<p>The interface is not used as a value.  You're using a function call that returns nothing as a value.</p>\n\n<p><code>speak()</code> returns nothing... so what do you expect it to print?</p>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 2, "last_activity_date": 1514287854, "creation_date": 1514287854, "answer_id": 47977996, "question_id": 47977818, "link": "https://stackoverflow.com/questions/47977818/golang-interface-used-as-value-error/47977996#47977996", "title": "golang interface &quot;used as value&quot; error", "body": "<p>Since you are printing the output of speak method, your speak method needs to return a string or an object whose string representation would print a string you would like to see. Here's your program modified <a href=\"https://play.golang.org/p/VDsp0cjXBd-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VDsp0cjXBd-</a> to return a string.</p>\n"}, {"tags": [], "owner": {"reputation": 1111, "user_id": 1131607, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/xLKUc.jpg?s=128&g=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/1131607/arun"}, "is_accepted": false, "score": 1, "last_activity_date": 1586333169, "creation_date": 1586333169, "answer_id": 61096048, "question_id": 47977818, "link": "https://stackoverflow.com/questions/47977818/golang-interface-used-as-value-error/61096048#61096048", "title": "golang interface &quot;used as value&quot; error", "body": "<p>This answer is based on all above answers,\nModified below function </p>\n\n<p><strong>Before</strong></p>\n\n<pre><code>   func animal_speak(a animal) {\n        fmt.Println(a.speak())\n    }\n</code></pre>\n\n<p><strong>After</strong></p>\n\n<pre><code>func animal_speak(a animal) {\n    a.speak()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/TbkGVjzpZZE\" rel=\"nofollow noreferrer\">Playgorund Link</a> </p>\n"}], "owner": {"reputation": 33, "user_id": 5118949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/abd31f56068e196d07821a203152fb4b?s=128&d=identicon&r=PG&f=1", "display_name": "Alister007", "link": "https://stackoverflow.com/users/5118949/alister007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4019, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1586333169, "creation_date": 1514287067, "last_edit_date": 1514287104, "question_id": 47977818, "link": "https://stackoverflow.com/questions/47977818/golang-interface-used-as-value-error", "title": "golang interface &quot;used as value&quot; error", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype animal interface {\n    speak()\n}\n\ntype dog struct {\n    name, sound  string\n}\n\ntype cat struct {\n    name, sound  string\n}\n\nfunc (d dog) speak() {\n    fmt.Println(d.name, \" goes \", d.sound)\n}\n\nfunc (c cat) speak() {\n    fmt.Println(c.name, \" goes \", c.sound)\n}\n\nfunc animal_speak(a animal) {\n    fmt.Println(a.speak())\n}\n\nfunc main() {\n\n    dogo := dog{\"scooby\", \"woof\"}\n    cato := cat{\"garfield\", \"meow\"}\n\n    animal_speak(dogo)\n    animal_speak(cato)\n\n}\n</code></pre>\n\n<p>When I call the animal interface it gives me the following error</p>\n\n<blockquote>\n  <p>./interface.go:28:21: a.speak() used as value</p>\n</blockquote>\n\n<p>What am I doing wrong?</p>\n\n<p><a href=\"https://play.golang.org/p/HzVzgC7u2cU\" rel=\"nofollow noreferrer\">Link to playground</a></p>\n"}, {"tags": ["unit-testing", "go", "database-testing"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1514283244, "post_id": 47976784, "comment_id": 82922862, "body": "You would not <i>unit test</i> it. Unit tests must be conducted in isolation."}, {"owner": {"reputation": 367, "user_id": 2367514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/m95rC.jpg?s=128&g=1", "display_name": "Ankit Sahu", "link": "https://stackoverflow.com/users/2367514/ankit-sahu"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1514283414, "post_id": 47976784, "comment_id": 82922915, "body": "@zerkms So this part of code will always remain uncovered when it comes to unit tests? It will only be covered when the integration tests are done, is it?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1514286370, "post_id": 47976784, "comment_id": 82924149, "body": "@zerkms: It is quite possible to test such a function with a unit test."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514319099, "post_id": 47976784, "comment_id": 82935215, "body": "@Flimzy it&#39;s a good rule of thumb to not mock interfaces you don&#39;t own. If you mock <code>db</code> object there - your test&#39;s value would be close to 0."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1514326779, "post_id": 47976784, "comment_id": 82937579, "body": "@zerkms: 1. I don&#39;t think there&#39;s any validity to that &quot;rule&quot; at all. 2. Not all mocks must happen at the interface level."}], "answers": [{"comments": [{"owner": {"reputation": 765, "user_id": 1292814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40ef9aba49bebc01053a625abcc8c3ba?s=128&d=identicon&r=PG", "display_name": "Innokentiy Alaytsev", "link": "https://stackoverflow.com/users/1292814/innokentiy-alaytsev"}, "edited": false, "score": 0, "creation_date": 1514286753, "post_id": 47977658, "comment_id": 82924315, "body": "Database part (mgo.Database) should be tested separately. Am I right?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 765, "user_id": 1292814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40ef9aba49bebc01053a625abcc8c3ba?s=128&d=identicon&r=PG", "display_name": "Innokentiy Alaytsev", "link": "https://stackoverflow.com/users/1292814/innokentiy-alaytsev"}, "edited": false, "score": 1, "creation_date": 1514287011, "post_id": 47977658, "comment_id": 82924426, "body": "@InnokentiyAlaytsev: That should be tested by the <code>mgo</code> package. The purpose of a unit test is to test a specific unit--the unit in the question is the <code>CreateAlert</code> function, so only the functionality unique to that function should be unit-tested."}, {"owner": {"reputation": 367, "user_id": 2367514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/m95rC.jpg?s=128&g=1", "display_name": "Ankit Sahu", "link": "https://stackoverflow.com/users/2367514/ankit-sahu"}, "edited": false, "score": 0, "creation_date": 1514287703, "post_id": 47977658, "comment_id": 82924656, "body": "Thank you @Flimzy for explaining what exactly needs to be tested here, made things clearer for me moving forward."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1514319269, "post_id": 47977658, "comment_id": 82935271, "body": "&quot;the mock receives the expected data, in the expected format&quot; --- this would test the implementation details, that&#39;s a no-no-no thing for unit tests."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1514326948, "post_id": 47977658, "comment_id": 82937618, "body": "@zerkms Not at all. You have misinterpreted my answer. In this case, the relevant &quot;format&quot; is just that the expected data type is sent to the expected method. In more complex cases, it may include validating that the data is in valid JSON or XML or whatever, or that the proper fields of a struct are set. Since all <i>this</i> function does is pass an argument, unaltered, the &quot;format&quot; is minimal."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1514327470, "post_id": 47977658, "comment_id": 82937739, "body": "@Flimzy any chance &quot;but a unit-test for such a small function will also be small&quot; --- to see it then?"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1514299664, "last_edit_date": 1514299664, "creation_date": 1514286227, "answer_id": 47977658, "question_id": 47976784, "link": "https://stackoverflow.com/questions/47976784/how-would-you-unit-test-a-method-whose-only-purpose-to-make-a-database-call/47977658#47977658", "title": "How would you unit test a method whose only purpose to make a database call?", "body": "<p>You would unit test it with a mock, so that the database isn't being called, but only your function is being tested.</p>\n\n<p>There are many different ways to mock a database, so I won't get into details, but a unit-test for such a small function will also be small. All you'll really be testing is that:</p>\n\n<ol>\n<li>the mock receives the expected data, in the expected format  (i.e. does it receive the <code>&amp;alert</code> value, passed to its <code>Insert()</code> method?)</li>\n<li>the mock's return value (an <code>error</code>) is returned to the caller of the function</li>\n</ol>\n\n<p>In particular, in a unit test of this function, you would <em>not</em> check that:</p>\n\n<ul>\n<li>The SQL conforms to syntax expectations (your function doesn't control SQL, such a test would really be testing your data layer/ORM)</li>\n<li>That the INSERT occurs as expected--this would be testing your database</li>\n<li>That the caller of the function has appropriate database permissions (this is again testing your data layer and/or database)</li>\n</ul>\n"}], "owner": {"reputation": 367, "user_id": 2367514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/m95rC.jpg?s=128&g=1", "display_name": "Ankit Sahu", "link": "https://stackoverflow.com/users/2367514/ankit-sahu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "closed_date": 1514298992, "accepted_answer_id": 47977658, "answer_count": 1, "score": 0, "last_activity_date": 1599334340, "creation_date": 1514282281, "last_edit_date": 1599334340, "question_id": 47976784, "link": "https://stackoverflow.com/questions/47976784/how-would-you-unit-test-a-method-whose-only-purpose-to-make-a-database-call", "closed_reason": "Opinion-based", "title": "How would you unit test a method whose only purpose to make a database call?", "body": "<p>I have method something like this:</p>\n<pre><code>func (alert *Alert) CreateAlert(db *mgo.Database) error {\n    return db.C(&quot;alerts&quot;).Insert(&amp;alert)\n}\n</code></pre>\n<p>How should I unit test this?\nIf I just call this method for uni test, then I will have to create test DB to which the call is made. I somehow feel that this would be part of integration test as we are making a call to DB.</p>\n<p>If I mock the db object, then it will never test the actual implementation.</p>\n<p>Should I test this at all? as the major goal for writing unit test if the data is inserted to DB or not, and such functionality are already tested in the library itself, in my case mgo library.</p>\n<p>Please share your thoughts on what would be the best approach for unit testing the above scenario.</p>\n"}, {"tags": ["go", "routing", "google-cloud-platform", "gcp"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514281040, "post_id": 47976333, "comment_id": 82922082, "body": "Why is <code>http.ListenAndServe</code> commented out? You&#39;re not actually starting an http server. Are you expecting something else to do it for you? If so, how is it aware of your router?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6043285"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514281408, "post_id": 47976333, "comment_id": 82922242, "body": "if I run the code using goapp serve command it&#39;s automatically hosts at 8080, When used <code>http.HandleFunc(&quot;&#47;register&quot;, RegisterHandler)</code> i have not mentioned the <code>http.ListenAndServe</code>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514281690, "post_id": 47976333, "comment_id": 82922334, "body": "Ok, but you&#39;re not showing where you register your router. If your code is at shown, the http server does not know about your router."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6043285"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514282484, "post_id": 47976333, "comment_id": 82922598, "body": "How it works when I moved to GCP with out mention <code>http.ListenAndServe</code>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1514282541, "post_id": 47976333, "comment_id": 82922618, "body": "have you tried <code>http.Handle(&quot;&#47;&quot;, router)</code> as the last line of your <code>init()</code> function?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6043285"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514285351, "post_id": 47976333, "comment_id": 82923689, "body": "Thanks @Marc I have added <code>http.Handle(&quot;&#47;&quot;, router)</code> and now it is working"}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 1, "last_activity_date": 1514286152, "creation_date": 1514286152, "answer_id": 47977634, "question_id": 47976333, "link": "https://stackoverflow.com/questions/47976333/getting-404-page-not-found-error-while-checking-from-postman/47977634#47977634", "title": "Getting 404 page not found error while checking from postman", "body": "<p>To expand on my comment above:\nA handler function (or the router from <code>julienschmidt/httprouter</code>) does not register itself. Instead, it needs to be registered with the http server.</p>\n\n<p>The simplest way to do that is usually do register with the default ServeMux using: <code>http.Handle(\"/\", router)</code></p>\n\n<p>Thus, changing the init function to the following will work:</p>\n\n<pre><code>   func init() {\n        router := httprouter.New()\n        router.GET(\"/\", Index)\n        router.GET(\"/hello/:name\", Hello)\n        http.Handle(\"/\", router)\n    }\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6043285"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2064, "favorite_count": 1, "accepted_answer_id": 47977634, "answer_count": 1, "score": 0, "last_activity_date": 1514286152, "creation_date": 1514279955, "last_edit_date": 1514280577, "question_id": 47976333, "link": "https://stackoverflow.com/questions/47976333/getting-404-page-not-found-error-while-checking-from-postman", "title": "Getting 404 page not found error while checking from postman", "body": "<p>I'm running the below code using <code>goapp serve</code>. Somehow getting <code>404 page not found</code> error while checking from postman. Could you please help me to fix this </p>\n\n<pre><code>    package hello\n\n        import (\n        \"fmt\"\n        \"net/http\"\n\n        \"github.com/julienschmidt/httprouter\"\n    )\n\n    func Index(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n        fmt.Fprint(w, \"Welcome!\\n\")\n    }\n\n    func Hello(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n        fmt.Fprintf(w, \"hello, %s!\\n\", ps.ByName(\"name\"))\n    }\n\n    func init() {\n        router := httprouter.New()\n        router.GET(\"/\", Index)\n        router.GET(\"/hello/:name\", Hello)\n//log.Fatal(http.ListenAndServe(\":8080\", router))\n\n    }\n</code></pre>\n\n<p>In postman passing endpoint \n<code>http://localhost:8080/hello/hyderabad</code></p>\n"}, {"tags": ["docker", "go", "beego", "godeps"], "answers": [{"tags": [], "owner": {"reputation": 1220, "user_id": 2578409, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003551172293/picture?type=large", "display_name": "Bruce", "link": "https://stackoverflow.com/users/2578409/bruce"}, "is_accepted": false, "score": 0, "last_activity_date": 1514276717, "creation_date": 1514276717, "answer_id": 47975831, "question_id": 47975830, "link": "https://stackoverflow.com/questions/47975830/when-build-beego-docker-image-with-default-docker-file-show-error-godep-no-g/47975831#47975831", "title": "When build beego docker image with default docker file, show error: `godep: No Godeps found (or in any parent directory)`", "body": "<p>The solution is very simple: run <code>godep save</code> in your project locally, and you will go a new folder <code>Godeps</code> in your project. it contains file:<code>Godeps.json</code>. After this, run <code>docker build .</code> again, you will got your docker image.</p>\n"}], "owner": {"reputation": 1220, "user_id": 2578409, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003551172293/picture?type=large", "display_name": "Bruce", "link": "https://stackoverflow.com/users/2578409/bruce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 417, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514276717, "creation_date": 1514276717, "question_id": 47975830, "link": "https://stackoverflow.com/questions/47975830/when-build-beego-docker-image-with-default-docker-file-show-error-godep-no-g", "title": "When build beego docker image with default docker file, show error: `godep: No Godeps found (or in any parent directory)`", "body": "<p>I'm new to Go &amp; Beego. </p>\n\n<p>When I build docker image with beego's default docker file, it shows this error :</p>\n\n<blockquote>\n  <p>godep: No Godeps found (or in any parent directory)</p>\n</blockquote>\n\n<p>The build info is:</p>\n\n<pre><code>Sending build context to Docker daemon   13.6MB\nStep 1/9 : FROM library/golang\n ---&gt; 138bd936fa29\nStep 2/9 : RUN go get github.com/tools/godep\n ---&gt; Running in 9003355d967f\n ---&gt; bae9e4289f9b\nRemoving intermediate container 9003355d967f\nStep 3/9 : RUN CGO_ENABLED=0 go install -a std\n ---&gt; Running in 63d367bd487e\n ---&gt; 3ce0b2d47c0a\nRemoving intermediate container 63d367bd487e\nStep 4/9 : ENV APP_DIR $GOPATH/src/TestProject\n ---&gt; Running in 53ddc4661a07\n ---&gt; 528794352eb0\nRemoving intermediate container 53ddc4661a07\nStep 5/9 : RUN mkdir -p $APP_DIR\n ---&gt; Running in 37718f358f5c\n ---&gt; ef9332ca086c\nRemoving intermediate container 37718f358f5c\nStep 6/9 : ENTRYPOINT (cd $APP_DIR &amp;&amp; ./TestProject)\n ---&gt; Running in 059c06321914\n ---&gt; 8538ea070871\nRemoving intermediate container 059c06321914\nStep 7/9 : ADD . $APP_DIR\n ---&gt; df129482c662\nStep 8/9 : RUN cd $APP_DIR &amp;&amp; CGO_ENABLED=0 godep go build -ldflags '-d -w -s'\n ---&gt; Running in 50b29d1307b5\ngodep: No Godeps found (or in any parent directory)\nThe command '/bin/sh -c cd $APP_DIR &amp;&amp; CGO_ENABLED=0 godep go build -ldflags '-d -w -s'' returned a non-zero code: 1\n</code></pre>\n"}, {"tags": ["mongodb", "http", "go", "mux"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1514274275, "post_id": 47975428, "comment_id": 82919992, "body": "Please show the webconsole error."}, {"owner": {"reputation": 1731, "user_id": 8813179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d2805921ad889a0371d566a75d5f7d4?s=128&d=identicon&r=PG&f=1", "display_name": "ABC", "link": "https://stackoverflow.com/users/8813179/abc"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1514274831, "post_id": 47975428, "comment_id": 82920141, "body": "I uploaded the picture of the error, Browser is safari. It does not have any console error messages. I don&#39;t know why this happens, but if I do <b>http.ServeFile(&quot;.mp4&quot;)</b> you can visit the /video.mp4 url and it loads the default safari  player."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514276502, "post_id": 47975428, "comment_id": 82920635, "body": "This <code>io.Copy(w, r)</code> is a typo right? You&#39;re not actually trying to write the request to the response but the <code>file</code>, right?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514276597, "post_id": 47975428, "comment_id": 82920668, "body": "And please do check the error returned from <code>io.Copy</code>."}, {"owner": {"reputation": 1731, "user_id": 8813179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d2805921ad889a0371d566a75d5f7d4?s=128&d=identicon&r=PG&f=1", "display_name": "ABC", "link": "https://stackoverflow.com/users/8813179/abc"}, "edited": false, "score": 0, "creation_date": 1514277525, "post_id": 47975428, "comment_id": 82920911, "body": "io.Copy has no error, and no the io.Copy is not a typo. I am new and thats what I thought I was supposed to do, to write the file into the browser. I want the file written in the response, and be able to play."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514277631, "post_id": 47975428, "comment_id": 82920941, "body": "Do this instead: <code>if _, err := io.Copy(w, file); err != nil { &#47;&#47; handle error</code>"}, {"owner": {"reputation": 1731, "user_id": 8813179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d2805921ad889a0371d566a75d5f7d4?s=128&d=identicon&r=PG&f=1", "display_name": "ABC", "link": "https://stackoverflow.com/users/8813179/abc"}, "edited": false, "score": 0, "creation_date": 1514277712, "post_id": 47975428, "comment_id": 82920955, "body": "I added the if your error handling, it still does not send the file in the <b>response</b> correctly. This must be browser problem, something with the headers maybe?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514277790, "post_id": 47975428, "comment_id": 82920989, "body": "<code>r</code> is not the file, <code>r</code> is the request you got from the client, copying that into <code>w</code> makes little sense."}, {"owner": {"reputation": 1731, "user_id": 8813179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d2805921ad889a0371d566a75d5f7d4?s=128&d=identicon&r=PG&f=1", "display_name": "ABC", "link": "https://stackoverflow.com/users/8813179/abc"}, "edited": false, "score": 0, "creation_date": 1514278031, "post_id": 47975428, "comment_id": 82921055, "body": "Oh if I did that sorry I re-typed it for stack overflow incorrectly. But, yes were are writing out to the browser not the request. Do I need to read over the bytes first and decode it, then send it out? I wouldn&#39;t even know how to begin with that. I am thinking it must be a header issue, with <b>content-length</b> and bytes."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514305282, "post_id": 47975428, "comment_id": 82930711, "body": "Try the solution from this question: <a href=\"https://stackoverflow.com/questions/38069584/golang-http-webserver-provide-video-mp4\" title=\"golang http webserver provide video mp4\">stackoverflow.com/questions/38069584/&hellip;</a>"}, {"owner": {"reputation": 1731, "user_id": 8813179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d2805921ad889a0371d566a75d5f7d4?s=128&d=identicon&r=PG&f=1", "display_name": "ABC", "link": "https://stackoverflow.com/users/8813179/abc"}, "edited": false, "score": 0, "creation_date": 1514320705, "post_id": 47975428, "comment_id": 82935721, "body": "I can not use ServeFile, because I am using a database."}], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1514364751, "creation_date": 1514364751, "answer_id": 47989083, "question_id": 47975428, "link": "https://stackoverflow.com/questions/47975428/output-in-http-a-mp4-file-issue-pulling-from-database-to-browser/47989083#47989083", "title": "Output in http a .mp4 file, issue pulling from database to browser", "body": "<p>You may want to check <code>http.ServeContent</code>. It will handle all the mess (content-type, content-length, partial data, cache) automaticlly and save you a lot of time. It takes a ReadSeeker to serve, which GridFile already implented. So your code may simply change to the below.</p>\n\n<pre><code>func movie(w http.ResponseWriter r *http.Request) {\n    file, err := db.GridFS(\"fs\").Open(\"movie.mp4\")\n    if err != nil {\n        log.Println(err)\n    }\n    defer file.Close()\n\n    http.ServeContent(w,r,\"movie.mp4\",file.UploadDate(),file)\n\n}\n</code></pre>\n\n<p>If that doesn't work, please use tools like curl or wget to download the served content and compare it to the orignal one (in db).</p>\n"}], "owner": {"reputation": 1731, "user_id": 8813179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d2805921ad889a0371d566a75d5f7d4?s=128&d=identicon&r=PG&f=1", "display_name": "ABC", "link": "https://stackoverflow.com/users/8813179/abc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 47989083, "answer_count": 1, "score": 0, "last_activity_date": 1514401028, "creation_date": 1514274119, "last_edit_date": 1514401028, "question_id": 47975428, "link": "https://stackoverflow.com/questions/47975428/output-in-http-a-mp4-file-issue-pulling-from-database-to-browser", "title": "Output in http a .mp4 file, issue pulling from database to browser", "body": "<p><strong>answered</strong></p>\n\n<p>I am having a hard time with Mongodb and Gridfs, using it with Go's http package. I am trying to store a .mp4 file into Gridfs, then pull it out into the browser for playback.</p>\n\n<blockquote>\n  <p>Heres what I am doing now. It successfully pulls the file from\n  database, I could even write it correctly to a download location.</p>\n</blockquote>\n\n<pre><code>// Connect to database\n// Session to database\n\nfunc movie(w http.ResponseWriter r *http.Request) {\n    file, err := db.GridFS(\"fs\").Open(\"movie.mp4\")\n    if err != nil {\n        log.Println(err)\n    }\n    defer file.Close()\n\n    w.Header.Set(\"Content-type\", \"video/mp4\")\n    if _, err := io.Copy(w, file); err != nil {\n    log.Println(err)\n    } \n    // I am trying to send it to the browser.\n    // I want to achieve same thing as, http://localhost/view/movie.mp4, \n    as if you did that.\n}\n</code></pre>\n\n<p>If the file was on the server, I would just do something like this. But instead I am trying to store it in Mongodb, for all around easier use involving metadata.</p>\n\n<pre><code>func movie(w http.ResponseWriter r *http.Request) {\n    http.ServeFile(\"./uploads/movie.mp4\") // Easy\n}\n</code></pre>\n\n<p>The browser is receiving something, but its just malformed or corrupted. Just shows the video player with an error message. Any help would be appreciated, I have only been programming a week. </p>\n\n<p>Here is a picture of the error, no console error messages.</p>\n\n<p><a href=\"https://i.stack.imgur.com/SAhn9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/SAhn9.png\" alt=\"enter image description here\"></a></p>\n\n<blockquote>\n  <p>Unless someone has an alternative to storing video files for playback\n  in browser somewhere other than MongoDB or Amazon S3. Please let me know,\n  thanks.</p>\n</blockquote>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1514262379, "creation_date": 1514262379, "answer_id": 47973879, "question_id": 47973779, "link": "https://stackoverflow.com/questions/47973779/how-to-assign-the-string-value-to-time-format-in-go/47973879#47973879", "title": "How to assign the string value to time format in GO?", "body": "<p>You have to take both returned values:</p>\n\n<pre><code>const shortForm = \"2006-Jan-02\"\nt, _ = time.Parse(shortForm, \"2013-Feb-03\")\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#Parse</a></p>\n"}, {"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": false, "score": 1, "last_activity_date": 1514263478, "creation_date": 1514263478, "answer_id": 47973970, "question_id": 47973779, "link": "https://stackoverflow.com/questions/47973779/how-to-assign-the-string-value-to-time-format-in-go/47973970#47973970", "title": "How to assign the string value to time format in GO?", "body": "<p><code>time.Parse</code> returns a time and an error.  You are assigning the string portion to <code>pdsvalue</code> which is already declared as a string when you assign the <code>FormValue</code> of \"PSD\".  <code>psdvalue</code> is therefore already a string type and cannot be assigned a time.Time value.  Use a different variable name in your assignment (and don't swallow the error either).</p>\n"}, {"tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": false, "score": 2, "last_activity_date": 1514265617, "creation_date": 1514265617, "answer_id": 47974144, "question_id": 47973779, "link": "https://stackoverflow.com/questions/47973779/how-to-assign-the-string-value-to-time-format-in-go/47974144#47974144", "title": "How to assign the string value to time format in GO?", "body": "<p>In your case error happens because you are using same var for 2 types, if you change <code>psdvalue</code> to something else it will work. Check here - <a href=\"https://play.golang.org/p/Z8_--GluMoP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Z8_--GluMoP</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    layout := \"01-02-2006\"\n    psdvalue := \"04-04-2004\"\n    parsed, err := time.Parse(layout, psdvalue)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%v\", parsed)\n}\n</code></pre>\n\n<p>Also, do not forget to handle the error in Parse function.</p>\n"}], "owner": {"reputation": 321, "user_id": 9068929, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b34f512608edfd66b7c06f9990fcea3f?s=128&d=identicon&r=PG&f=1", "display_name": "sheik", "link": "https://stackoverflow.com/users/9068929/sheik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 528, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1514293445, "creation_date": 1514261156, "last_edit_date": 1514293445, "question_id": 47973779, "link": "https://stackoverflow.com/questions/47973779/how-to-assign-the-string-value-to-time-format-in-go", "title": "How to assign the string value to time format in GO?", "body": "<p>I have below code. I am trying to convert from string value to time format and assigning the value and failing with below error at line no: </p>\n\n<pre><code>cannot assign time.Time to psdvalue (type string) in multiple assignment\n</code></pre>\n\n<p>Code: </p>\n\n<pre><code>type Tracking struct {\n    release_name       string\n    planned_start_date time.Time\n}\n\nconst layout = \"01-02-2006\"\n\nfunc saveHandler(response http.ResponseWriter, request *http.Request) {\n\n    releasevalue := request.FormValue(\"ReleaseName\")\n    psdvalue := request.FormValue(\"PSD\")\n\n    if len(strings.TrimSpace(psdvalue)) &gt; 0 {\n        //line no:              psdvalue, _ = time.Parse(layout, psdvalue)\n    }\n\n    array = append(array, Tracking{\n        release_name:       releasevalue,\n        planned_start_date: psdvalue,\n    })\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1514231716, "post_id": 47971610, "comment_id": 82912751, "body": "You didn&#39;t import the <code>echo</code> package."}, {"owner": {"reputation": 1591, "user_id": 7304216, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7948f2563d2a2d276561b3a05c357150?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Pocock", "link": "https://stackoverflow.com/users/7304216/nick-pocock"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1514231825, "post_id": 47971610, "comment_id": 82912778, "body": "I got rid of everything that wasn&#39;t relevant"}, {"owner": {"reputation": 1591, "user_id": 7304216, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7948f2563d2a2d276561b3a05c357150?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Pocock", "link": "https://stackoverflow.com/users/7304216/nick-pocock"}, "edited": false, "score": 0, "creation_date": 1514232291, "post_id": 47971610, "comment_id": 82912876, "body": "CreateWallet is not declared in package handlers. It is, so I&#39;m very confused."}], "answers": [{"tags": [], "owner": {"reputation": 1027, "user_id": 3622676, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/n4SuA.jpg?s=128&g=1", "display_name": "myartsev", "link": "https://stackoverflow.com/users/3622676/myartsev"}, "is_accepted": false, "score": 1, "last_activity_date": 1514234369, "creation_date": 1514234369, "answer_id": 47971881, "question_id": 47971610, "link": "https://stackoverflow.com/questions/47971610/some-functions-in-package-appear-as-undefined-golang/47971881#47971881", "title": "Some functions in package appear as undefined Golang", "body": "<p>There is nothing wrong with the export of the handlers package or CreateWallet.<br>\n<strong>middleware</strong> is not defined, but if you comment out those two lines everything runs fine.</p>\n\n<pre><code>package main\n\nimport (\n\"github.com/pocockn/crypto-compare-go/handlers\"\n\n\"github.com/labstack/echo\"\n\n)\n\nfunc main() {\n\ne := echo.New()\n// e.Use(middleware.Logger())\n// e.Use(middleware.Recover())\n    e.POST(\"/createWallet\", handlers.CreateWallet)\n}\n</code></pre>\n"}], "owner": {"reputation": 1591, "user_id": 7304216, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7948f2563d2a2d276561b3a05c357150?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Pocock", "link": "https://stackoverflow.com/users/7304216/nick-pocock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1457, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1514245721, "creation_date": 1514231555, "last_edit_date": 1514245721, "question_id": 47971610, "link": "https://stackoverflow.com/questions/47971610/some-functions-in-package-appear-as-undefined-golang", "title": "Some functions in package appear as undefined Golang", "body": "<p>I am attempting to create a Golang application. I have one function in my package which I can use fine, the <code>GetCoin</code> function. However, my function <code>CreateWallet</code> keeps giving me an error saying it's not defined in the package. The function name is in capitals so it's exported, but it's like my other file can't see it from the import.</p>\n\n<p>Here is the package I am importing:</p>\n\n<p><a href=\"https://github.com/pocockn/crypto-compare-go/blob/master/handlers/handlers.go\" rel=\"nofollow noreferrer\">https://github.com/pocockn/crypto-compare-go/blob/master/handlers/handlers.go</a></p>\n\n<p>Here is my main file. </p>\n\n<pre><code>import (\n\"github.com/pocockn/crypto-compare-go/handlers\"\n\n\"github.com/labstack/echo\"\n\n)\n\nfunc main() {\n\ne := echo.New()\ne.Use(middleware.Logger())\ne.Use(middleware.Recover())\n    e.POST(\"/createWallet\", handlers.CreateWallet)\n}\n</code></pre>\n"}, {"tags": ["go", "microservices", "grpc"], "answers": [{"tags": [], "owner": {"reputation": 347, "user_id": 4230468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f74df84a21ab14b6a0eed38f38266cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Grey", "link": "https://stackoverflow.com/users/4230468/grey"}, "is_accepted": false, "score": 2, "last_activity_date": 1514236953, "creation_date": 1514236953, "answer_id": 47972107, "question_id": 47971020, "link": "https://stackoverflow.com/questions/47971020/unary-vs-stream-benchmark/47972107#47972107", "title": "Unary vs Stream benchmark", "body": "<p>Sending unary almost always faster.\nUse streaming to send big files.</p>\n"}, {"tags": [], "owner": {"reputation": 3321, "user_id": 1065020, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JBqYB.jpg?s=128&g=1", "display_name": "Nishant", "link": "https://stackoverflow.com/users/1065020/nishant"}, "is_accepted": false, "score": 0, "last_activity_date": 1610622001, "last_edit_date": 1610622001, "creation_date": 1609180507, "answer_id": 65482388, "question_id": 47971020, "link": "https://stackoverflow.com/questions/47971020/unary-vs-stream-benchmark/65482388#65482388", "title": "Unary vs Stream benchmark", "body": "<p>Some benchmarks here: <a href=\"https://nshnt.medium.com/using-grpc-streams-for-unary-calls-cd64a1638c8a\" rel=\"nofollow noreferrer\">https://nshnt.medium.com/using-grpc-streams-for-unary-calls-cd64a1638c8a</a></p>\n<p>Unless you expect to have very large files that will be processed asynchronously (line by line), unary must be the right choice.</p>\n<p>There are arguments that theoretically, streams should have lower overhead. But that is not true. Streams ensure that messages are delivered in the order that they were sent, this would mean that if there are concurrent messages, there will be some kind of bottleneck.</p>\n<p><strong>Use streams when</strong></p>\n<ul>\n<li><p><strong>You would otherwise need a polling</strong> e.g. notifications, listening for events, sending data followed by deltas</p>\n</li>\n<li><p><strong>Transactions</strong> i.e lots of serial calls that must be served by a single server</p>\n</li>\n<li><p><strong>A large call that can be broken down into multiple smaller request</strong> e.g. file upload, text to speech translation</p>\n</li>\n</ul>\n<p>Some drawbacks of using streams:</p>\n<ul>\n<li><p><strong>Hard to load balance</strong> ie. Will not automatically distribute load on new servers</p>\n</li>\n<li><p><strong>Higher application level complexity</strong>. Mapping client message with server response must be done by application</p>\n</li>\n<li><p><strong>Intermittend network failures</strong>. Even small interruptions in TCP connections will fail the connection. Application-level complexity to recover from intermittent network failures.</p>\n</li>\n<li><p><strong>Maintains order for messages</strong> You can't be writting multiple messages, so if you have many requests in pipeline, they will be have to be made sequentially.</p>\n</li>\n</ul>\n"}], "owner": {"reputation": 173, "user_id": 5539716, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/uf3uM.jpg?s=128&g=1", "display_name": "Lothav", "link": "https://stackoverflow.com/users/5539716/lothav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 880, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1610622001, "creation_date": 1514225723, "last_edit_date": 1514226119, "question_id": 47971020, "link": "https://stackoverflow.com/questions/47971020/unary-vs-stream-benchmark", "title": "Unary vs Stream benchmark", "body": "<p>I'm start to play with some GRPC with Golang microservice applications.</p>\n\n<p>After read the GRPC docs something is not clear to me:</p>\n\n<blockquote>\n  <p>When to use Unary and when to use Streaming?</p>\n</blockquote>\n\n<p>I mean, as example, i'm building a microservice that will parse a XLS and back JSON to stub. I will use a thrid-party lib to parse it for me. So, my job is to receive the xls, call lib and sent it forward. Quite simple.</p>\n\n<p>What is the best pratice/performance that i can reach? Send() row by row with streaming or send whole parsed json once?</p>\n"}, {"tags": ["go", "json-rpc"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1514220584, "post_id": 47970463, "comment_id": 82910304, "body": "Two suggestions to get started: 1) don&#39;t ignore errors 2) log the raw request and response."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 1, "last_activity_date": 1514231069, "last_edit_date": 1514231069, "creation_date": 1514230044, "answer_id": 47971457, "question_id": 47970463, "link": "https://stackoverflow.com/questions/47970463/go-lang-rpc-return-eof-error/47971457#47971457", "title": "Go lang RPC return EOF error", "body": "<p>This line:</p>\n\n<pre><code>io.Copy(ioutil.Discard, resp.Body)\n</code></pre>\n\n<p>reads the <em>whole</em> <code>resp.Body</code>, leaving the reader with no more bytes to be read. Therefore any successive calls to <code>resp.Body.Read</code> will return <strong>EOF</strong> and the <code>json.Decoder.Decode</code> method does use the <code>io.Reader.Read</code> method when decoding the given reader's content, so...</p>\n\n<p>And since <code>resp.Body</code> is an <code>io.ReadCloser</code>, which is an interface that does not support \"rewinding\", and you want to read the body content more than once (ioutil.Discard and json.Decode), you'll have to read the body into a variable that you can re-read afterwards. It's up to you how you do that, a slice of bytes, or <code>bytes.Reader</code>, or something else.</p>\n\n<p>Example using <code>bytes.Reader</code>:</p>\n\n<pre><code>func (c *CallClient) Wallet(method string, req, rep interface{}) error {\n    client := &amp;http.Client{}\n    data, err := EncodeClientRequest(method, req)\n    if err != nil {\n        return err\n    }\n    reqest, err := http.NewRequest(\"POST\", c.endpoint, bytes.NewBuffer(data))\n    if err != nil {\n        return err\n    }\n    resp, err := client.Do(reqest)\n    if err != nil {\n        return err\n    }\n    defer resp.Body.Close()\n\n    // get a reader that can be \"rewound\"\n    buf := bytes.NewBuffer(nil)\n    if _, err := io.Copy(buf, resp.Body); err != nil {\n        return err\n    }\n    br := bytes.NewReader(buf.Bytes())\n\n    if _, err := io.Copy(ioutil.Discard, br); err != nil {\n        return err\n    }\n\n    // rewind\n    if _, err := br.Seek(0, 0); err != nil {\n        return err\n    }\n    return DecodeClientResponse(br, rep)\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8813780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6167778e3d9558d7ee49f3e5c2fc1b0?s=128&d=identicon&r=PG&f=1", "display_name": "thankdev", "link": "https://stackoverflow.com/users/8813780/thankdev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1171, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514231069, "creation_date": 1514220317, "question_id": 47970463, "link": "https://stackoverflow.com/questions/47970463/go-lang-rpc-return-eof-error", "title": "Go lang RPC return EOF error", "body": "<p>I'm using http to call RPC with code below</p>\n\n<pre><code>func (c *CallClient) Wallet(method string, req, rep interface{}) error {\n    client := &amp;http.Client{}\n    data, _ :=  EncodeClientRequest(method, req)\n    reqest, _ := http.NewRequest(\"POST\", c.endpoint, bytes.NewBuffer(data))\n    resp, err := client.Do(reqest)\n    if err != nil {\n        return err\n    }\n    defer resp.Body.Close()\n    io.Copy(ioutil.Discard, resp.Body)\n    return DecodeClientResponse(resp.Body, rep)\n}\n</code></pre>\n\n<p>with EncodeClientRquest &amp;&amp; DecodeClientResponse</p>\n\n<p>// EncodeClientRequest encodes parameters for a JSON-RPC client request.</p>\n\n<pre><code>func EncodeClientRequest(method string, args interface{}) ([]byte, error) {\n    c := &amp;clientRequest{\n        Version: \"2.0\",\n        Method: method,\n        Params: [1]interface{}{args},\n        Id:     uint64(rand.Int63()),\n    }\n\n    return json.Marshal(c)\n}\n</code></pre>\n\n<p>// DecodeClientResponse decodes the response body of a client request into\n// the interface reply.</p>\n\n<pre><code>func DecodeClientResponse(r io.Reader, reply interface{}) error {\n    var c clientResponse\n    if err := json.NewDecoder(r).Decode(&amp;c); err != nil {\n        return err\n    }\n    if c.Error != nil {\n        return fmt.Errorf(\"%v\", c.Error)\n    }\n    if c.Result == nil {\n        return errors.New(\"result is null\")\n    }\n    return json.Unmarshal(*c.Result, reply)\n}\n</code></pre>\n\n<p>And I got error EOF. </p>\n"}, {"tags": ["generics", "go", "struct"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514299826, "post_id": 47970417, "comment_id": 82928837, "body": "It&#39;s hard to tell from the posted source exactly how you want this to work - do both APIs need to be available on every <code>Exchange</code> object? However, I can say I&#39;m 98% sure you don&#39;t need reflection for this."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 2, "last_activity_date": 1514222295, "creation_date": 1514222295, "answer_id": 47970643, "question_id": 47970417, "link": "https://stackoverflow.com/questions/47970417/how-to-make-a-struct-field-a-generic-type/47970643#47970643", "title": "How to make a struct field a generic type", "body": "<p>Use interface:</p>\n\n<pre><code>type balancer interface {\n  Balance() int64\n}\n\ntype data struct {\n    cntr      int\n    api       balancer\n}\n</code></pre>\n\n<p>Note that unlike many other OO languages which claim they have interfaces,\nin Go, this concept \"is backwards\": <em>you</em> can define any interface and then\nmake the Go runtime make sure the value you're assigning to a variable of that custom interface 1) satisfies that interface, and 2) allows directly calling the interface methods on it.\nThat is, any data structure coming from any external code can\npotentially support any number of interfaces without being aware of this.</p>\n\n<p>You may start with <a href=\"https://golang.org/doc/effective_go.html#interfaces\" rel=\"nofollow noreferrer\">this</a>.</p>\n\n<p>Note that the indicated approach only works <em>if</em> both \"wrapper\" packages\nyou import define their respective data types in such a way that they have\n<em>identical</em> <code>Balance()</code> function, and this means they must have the same return type (or have none, both).</p>\n"}], "owner": {"reputation": 11, "user_id": 7777359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e46a038f9297c62627036184c705b09a?s=128&d=identicon&r=PG&f=1", "display_name": "Bob", "link": "https://stackoverflow.com/users/7777359/bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1418, "favorite_count": 0, "accepted_answer_id": 47970643, "answer_count": 1, "score": 0, "last_activity_date": 1514245609, "creation_date": 1514219861, "last_edit_date": 1514245609, "question_id": 47970417, "link": "https://stackoverflow.com/questions/47970417/how-to-make-a-struct-field-a-generic-type", "title": "How to make a struct field a generic type", "body": "<p>I am importing two (and more to come) external libraries which are related in function, but distinct from each other. I'd like to be able to do the following:</p>\n\n<ul>\n<li>create a new object of each</li>\n<li>assign each to a field of a nested struct</li>\n<li>be able to access the library methods by using the nested struct's field</li>\n</ul>\n\n<p>Roughly something like this:</p>\n\n<pre><code>import (\n    \"github.com/bittrex_api_wrapper\"\n    \"github.com/kraken_api_wrapper\"\n)\n\ntype Exchange struct {\n    bittrex     *data\n    kraken      *data\n}\n\ntype data struct {\n    cntr      int\n    api       ????    \n}\n\nfunc Initialize() Exchange {\n    e Exchange\n\n    brex := bittrex_api_wrapper.New(\"APIKEY1\", \"SECRET1\")\n    krak := kraken_api_wrapper.New(\"APIKEY2\", \"SECRET2\")\n\n    brexData := data {\n        cntr:    0,\n        api:     brex,\n    }\n    krakData := data {\n        cntr:    0,\n        api:     krak,\n    }\n    e = Exchange {\n        bittrex:    brexData,\n        kraken:     krakData,\n    }\n\n    return e\n}\n\nfunc (e *Exchange) CheckBalance(exng string) float64 {\n    switch exng {\n        case \"kraken\":\n            return e.kraken.api.Balance()\n        case \"bittrex\":\n            return e.bittrex.api.Balance()\n    }\n}\n</code></pre>\n\n<p>In my search for an answer, it seems like the reflect package or an interface might be my solution (or some combination of the two), but I'm not a developer and very new to Go, so Reflect was a little over my head.</p>\n\n<p>Any help is much appreciated!</p>\n"}, {"tags": ["go", "floating-point", "ieee-754"], "comments": [{"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1514211363, "post_id": 47969385, "comment_id": 82908205, "body": "Can&#39;t you simply do <code>a == b</code> ? Note that fixed-size floating point values are prone to not being able to accurately represent the value you <i>want</i> it to represent, such as the value <code>0.1</code> or <code>0.3</code>. Your best option is probably, as it is in most programming languages, to subtract one from the other, do an <code>ABS</code> operation and compare to a threshold value that you consider &quot;close enough to be equal for my purpose&quot;."}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1514211604, "post_id": 47969385, "comment_id": 82908249, "body": "But again, what is wrong with simply <code>a == b</code> ? Please explain why that is not an option for you."}, {"owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "reply_to_user": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1514211687, "post_id": 47969385, "comment_id": 82908270, "body": "The problem with a threshold value is that with really small or really large numbers the threshold value will be either smaller or larger than the numbers you&#39;re actually comparing."}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1514211863, "post_id": 47969385, "comment_id": 82908314, "body": "That is correct, but it is nontypical in a given domain to have very very low values combined with very very large values in a fixed size floating point without being aware of it. <b>But again, since you&#39;ve tried to implement bit-wise equality of floating point values, what is wrong with <code>a == b</code></b>?`"}, {"owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "reply_to_user": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1514213529, "post_id": 47969385, "comment_id": 82908705, "body": "Because a==b gives the wrong answer: <code>a := 0.1; b := 0.2; fmt.Println(a+b == 0.3) &#47;&#47; false</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1514215385, "post_id": 47969385, "comment_id": 82909129, "body": "Please google what every programmer should know about floating point. 0.1+0.2 is a classical example."}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1514222732, "post_id": 47969385, "comment_id": 82910790, "body": "Yes, and that is a common problem with floating point values <b>in every language that uses fixed-size floating point</b>."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "edited": false, "score": 1, "creation_date": 1514215099, "post_id": 47969546, "comment_id": 82909075, "body": "@augustzf <a href=\"http://floating-point-gui.de/errors/comparison/#look-out-for-edge-cases\" rel=\"nofollow noreferrer\">floating-point-gui.de/errors/comparison/&hellip;</a>"}, {"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "reply_to_user": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "edited": false, "score": 0, "creation_date": 1514215842, "post_id": 47969546, "comment_id": 82909230, "body": "@augustzf You could use something like <code>math.Abs(a -  b) &lt;= float64EqualityThreshold * (math.Abs(a) + math.Abs(b)) </code>. @kostix link seems even better."}, {"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "edited": false, "score": 0, "creation_date": 1514218659, "post_id": 47969546, "comment_id": 82909840, "body": "@augustzf: There is no good generic comparison, and <a href=\"https://stackoverflow.com/questions/17040813/f-how-to-compare-floats/17047601#17047601\">no good generic comparison is possible</a>."}, {"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "reply_to_user": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 1, "creation_date": 1514233851, "post_id": 47969546, "comment_id": 82913246, "body": "@EricPostpischil I understand what you&#39;re saying but &quot;no good generic&quot; seems a bit much too me. Simple almostEqual functions can be used in most of situations. If somebody don&#39;t tolerate aggregated tiny errors he/she should not use float point calculation at all."}, {"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 0, "creation_date": 1514234516, "post_id": 47969546, "comment_id": 82913389, "body": "@ArmanOrdookhani: They can be used, but they are not good. Most Stack Overflow questions about comparing for equality in floating-point arise when somebody is experimenting with floating-point as a learning exercise. They do not have a real use. The only others I recall showing an actual need are unit-testing. (I answered one <a href=\"https://stackoverflow.com/a/21120104/298225\">here</a>.) In that case, we can bound the errors due to floating-point rounding and trust that it is lower than errors due to bugs, so there is a clear value we can use for the tolerance to make a useful comparison."}, {"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "edited": false, "score": 2, "creation_date": 1514234652, "post_id": 47969546, "comment_id": 82913416, "body": "@ArmanOrdookhani: Other than that, answers that show \u201cmethods\u201d to do floating-point comparison generally use bad examples. They use arbitrary tolerances that are not generally applicable, sometimes using <code>FLT_EPSILON</code> or <code>DBL_EPSILON</code> improperly (e.g., not scaled for the magnitudes of the numbers involved, which is only one of the errors made with them), arbitrarily switching between absolute or relative error because the author worked out something that kind of worked, not due to any theory of operation, and so on. They are kludges, not good generic solutions."}], "tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": false, "score": 16, "last_activity_date": 1514212433, "creation_date": 1514212433, "answer_id": 47969546, "question_id": 47969385, "link": "https://stackoverflow.com/questions/47969385/go-float-comparison/47969546#47969546", "title": "Go float comparison", "body": "<p>Don't use bit representation of <code>float64</code> as it don't make sense in a lot of cases. Just subtract two numbers to find out how much they differ:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nconst float64EqualityThreshold = 1e-9\n\nfunc almostEqual(a, b float64) bool {\n    return math.Abs(a - b) &lt;= float64EqualityThreshold\n}\n\nfunc main() {\n    a := 0.1\n    b := 0.2\n    fmt.Println(almostEqual(a + b, 0.3))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "edited": false, "score": 0, "creation_date": 1514219850, "post_id": 47970236, "comment_id": 82910131, "body": "I have edited the question now. I agree that for concrete applications, one probably knows what tolerance is acceptable and should define equality with that in mind. But my question is less application-specific and more about what can be achieved by inspecting the underlying bit representation of the numbers."}, {"owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "reply_to_user": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "edited": false, "score": 1, "creation_date": 1514220965, "post_id": 47970236, "comment_id": 82910385, "body": "@augustzf: Essentially nothing useful in this situation can be achieved by inspecting the bits. Generally, any useful tests can be performed with normal floating-point operations. If you are just wondering how floating-point works and should be used, rather than trying to solve a specific application problem, then the answer is that floating-point is not designed for this."}, {"owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "edited": false, "score": 0, "creation_date": 1514221109, "post_id": 47970236, "comment_id": 82910424, "body": "Yes, I&#39;ve come to the same conclusion now after reading an <a href=\"https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/\" rel=\"nofollow noreferrer\">this article</a> on the same topic."}], "tags": [], "owner": {"reputation": 139300, "user_id": 298225, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef102f4ee36e58d09e0b27cd5393a1d8?s=128&d=identicon&r=PG", "display_name": "Eric Postpischil", "link": "https://stackoverflow.com/users/298225/eric-postpischil"}, "is_accepted": true, "score": 19, "last_activity_date": 1514218837, "last_edit_date": 1514218837, "creation_date": 1514218452, "answer_id": 47970236, "question_id": 47969385, "link": "https://stackoverflow.com/questions/47969385/go-float-comparison/47970236#47970236", "title": "Go float comparison", "body": "<p>No, this is not the correct way compare floating-point values.</p>\n\n<p>You have not actually stated your real problem\u2014there is some reason you are trying to compare two floating-point numbers, but you have not said what it is.</p>\n\n<p>Floating-point arithmetic is designed to perform approximate arithmetic. It is normal that there will be an accumulation of rounding errors in floating-point operations. These errors will generally be different when values are calculated in different ways, so floating-point arithmetic should not be expected to produce equal results.</p>\n\n<p>In your example, these operations occurred:</p>\n\n<ul>\n<li><p>The decimal numeral \u201c0.1\u201d was converted to <code>float64</code> (IEEE-754 64-bit binary floating-point). This produced the value 0.1000000000000000055511151231257827021181583404541015625, which is the closest <code>float64</code> value to 0.1.</p></li>\n<li><p>The decimal numeral \u201c0.2\u201d was converted to <code>float64</code>. This produced 0.200000000000000011102230246251565404236316680908203125, which is the closest <code>float64</code> value to 0.2.</p></li>\n<li><p>These were added. This produced 0.3000000000000000444089209850062616169452667236328125. In addition to the rounding errors that occurred when 0.1 and 0.2 were rounded to the nearest values in <code>float64</code>, this contains some additional rounding error because the exact sum cannot be represented in <code>float64</code>.</p></li>\n<li><p>The decimal numeral \u201c0.3\u201d was converted to <code>float64</code>. This produced 0.299999999999999988897769753748434595763683319091796875, which is the closest <code>float64</code> value to 0.3.</p></li>\n</ul>\n\n<p>As you can see, the result of adding <code>0.1</code> and <code>0.2</code> has accumulated different rounding errors from <code>0.3</code>, so they are unequal. No correct test for equality will report they are equal. And, importantly, the errors that occurred in this example are specific to this example\u2014different sequences of floating-point operations will have different errors, and the accumulated errors <strong>are not limited to the low bits of the numbers</strong>.</p>\n\n<p>Some people try to compare by testing whether the difference is less than some small value. This is can be okay in some applications, but is it okay in your application? We do not know what you are trying to do, so we do not know what problems will occur. Tests that allow for a small error sometimes report incorrect results, either false positives (because they accept as equal numbers that would not be equal if computed with exact mathematics) or false negatives (because they reject equality for numbers that would be equal if computed with exact mathematics). Which of these errors is worse for your application? Will one of them cause a machine to break or a person to be harmed? Without knowing that, nobody can advise which incorrect result is acceptable, or even if either is.</p>\n\n<p>Additionally, how large should the tolerance for error be? The total error that can occur in a calculation depends on the sequence of operations performed and the numbers involved. Some applications will have only a small final rounding error, and some applications can have massive errors. Nobody can give a recommendation about what value to use for the tolerance without knowing more about your specific sequence of operations. Also, the solution might not be to accept a tolerance in comparing numbers but to redesign your calculations to avoid error, or at least to reduce it.</p>\n\n<p>No general solution for comparing floating-point values for \u201cequality\u201d exists because it is impossible for any such solution to exist.</p>\n"}], "owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19010, "favorite_count": 6, "closed_date": 1514224782, "accepted_answer_id": 47970236, "answer_count": 2, "score": 4, "last_activity_date": 1514219691, "creation_date": 1514211069, "last_edit_date": 1514219691, "question_id": 47969385, "link": "https://stackoverflow.com/questions/47969385/go-float-comparison", "closed_reason": "Duplicate", "title": "Go float comparison", "body": "<p>In order to compare two floats (float64) for equality in Go, my superficial understanding of IEEE 754 and binary representation of floats makes me think that this is a good solution:</p>\n\n<pre><code>func Equal(a, b float64) bool {\n    ba := math.Float64bits(a)\n    bb := math.Float64bits(b)\n    diff := ba - bb\n    if diff &lt; 0 {\n        diff = -diff\n    }\n    // accept one bit difference\n    return diff &lt; 2\n}\n</code></pre>\n\n<p>The question is: Is this a more generic, more precise, and more efficient, way to compare two arbitrarily large or small floats for \"almost equalness\", than the old <code>abs(diff) &lt; epsilon</code> hack? My reasoning being that if one allows only one bit difference in the binary representation, then the compared numbers certainly could not be any more equal, apart from strict equality, which obviously (as pointed out in the comments) can be checked with <code>==</code> for floats.</p>\n\n<p>Note: I have edited the question to make it more clear. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7297, "user_id": 5604676, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/CQ3zk.jpg?s=128&g=1", "display_name": "Sergii Bishyr", "link": "https://stackoverflow.com/users/5604676/sergii-bishyr"}, "edited": false, "score": 0, "creation_date": 1514209770, "post_id": 47968970, "comment_id": 82907877, "body": "Please check this: <a href=\"https://stackoverflow.com/questions/22770114/any-difference-in-using-an-empty-interface-or-an-empty-struct-as-a-maps-value-i\" title=\"any difference in using an empty interface or an empty struct as a maps value i\">stackoverflow.com/questions/22770114/&hellip;</a>"}, {"owner": {"reputation": 11, "user_id": 9138806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Y7x098wUE5M/AAAAAAAAAAI/AAAAAAAAAAA/9U4PXKBKkmk/photo.jpg?sz=128", "display_name": "Andrey Voronko", "link": "https://stackoverflow.com/users/9138806/andrey-voronko"}, "reply_to_user": {"reputation": 7297, "user_id": 5604676, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/CQ3zk.jpg?s=128&g=1", "display_name": "Sergii Bishyr", "link": "https://stackoverflow.com/users/5604676/sergii-bishyr"}, "edited": false, "score": 0, "creation_date": 1514211332, "post_id": 47968970, "comment_id": 82908197, "body": "__text (code) increased by only 404Kb. 404kb / ~15000 =~ 28 byte pro TreeCell{Tabs: Cell}. I believe that abnormally increased __rodata (data)"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "edited": false, "score": 0, "creation_date": 1514213866, "post_id": 47968970, "comment_id": 82908776, "body": "I think it would be better if you change the header of your question to underline that the question is about size of result binary file."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9138806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Y7x098wUE5M/AAAAAAAAAAI/AAAAAAAAAAA/9U4PXKBKkmk/photo.jpg?sz=128", "display_name": "Andrey Voronko", "link": "https://stackoverflow.com/users/9138806/andrey-voronko"}, "edited": false, "score": 0, "creation_date": 1514218089, "post_id": 47970008, "comment_id": 82909727, "body": "Thank you for answer. Why does the size __rodata increase and not __text?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11, "user_id": 9138806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Y7x098wUE5M/AAAAAAAAAAI/AAAAAAAAAAA/9U4PXKBKkmk/photo.jpg?sz=128", "display_name": "Andrey Voronko", "link": "https://stackoverflow.com/users/9138806/andrey-voronko"}, "edited": false, "score": 0, "creation_date": 1514218211, "post_id": 47970008, "comment_id": 82909746, "body": "@AndreyVoronko Why would <code>__text</code> increase and not <code>__rodata</code>? Function body is duplicated 15.000 times, that is not text but code."}, {"owner": {"reputation": 11, "user_id": 9138806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Y7x098wUE5M/AAAAAAAAAAI/AAAAAAAAAAA/9U4PXKBKkmk/photo.jpg?sz=128", "display_name": "Andrey Voronko", "link": "https://stackoverflow.com/users/9138806/andrey-voronko"}, "edited": false, "score": 0, "creation_date": 1514218545, "post_id": 47970008, "comment_id": 82909816, "body": "<code>__text</code> is code. <code>__rodata</code> is readonly data (constant, strings e.t.c ) Flags <code>-l</code> (disable inline) does not affect the result. Only <code>-N</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11, "user_id": 9138806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Y7x098wUE5M/AAAAAAAAAAI/AAAAAAAAAAA/9U4PXKBKkmk/photo.jpg?sz=128", "display_name": "Andrey Voronko", "link": "https://stackoverflow.com/users/9138806/andrey-voronko"}, "edited": false, "score": 0, "creation_date": 1514219279, "post_id": 47970008, "comment_id": 82909994, "body": "@AndreyVoronko Then you answered it: <code>__text</code> is code, and that is being duplicated by inlining."}, {"owner": {"reputation": 11, "user_id": 9138806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Y7x098wUE5M/AAAAAAAAAAI/AAAAAAAAAAA/9U4PXKBKkmk/photo.jpg?sz=128", "display_name": "Andrey Voronko", "link": "https://stackoverflow.com/users/9138806/andrey-voronko"}, "edited": false, "score": 0, "creation_date": 1514279879, "post_id": 47970008, "comment_id": 82921631, "body": "I think that this is not inline. If this would be inline, then increasing the inline function&#39;s code would increase the size of the executable file. I changed the code <code>func Cell() *string { \ts:= &quot;01234567890102345678901234567890123456789012345678900123456&zwnj;&#8203;78901023456789012345&zwnj;&#8203;67890123456789012345&zwnj;&#8203;67890&quot; \treturn &amp;s }</code> but the size remained the same"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11, "user_id": 9138806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Y7x098wUE5M/AAAAAAAAAAI/AAAAAAAAAAA/9U4PXKBKkmk/photo.jpg?sz=128", "display_name": "Andrey Voronko", "link": "https://stackoverflow.com/users/9138806/andrey-voronko"}, "edited": false, "score": 0, "creation_date": 1514280831, "post_id": 47970008, "comment_id": 82921995, "body": "@AndreyVoronko Your change does not result in bigger binary because that string literal (constant) is only stored once in the binary."}, {"owner": {"reputation": 11, "user_id": 9138806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Y7x098wUE5M/AAAAAAAAAAI/AAAAAAAAAAA/9U4PXKBKkmk/photo.jpg?sz=128", "display_name": "Andrey Voronko", "link": "https://stackoverflow.com/users/9138806/andrey-voronko"}, "edited": false, "score": 0, "creation_date": 1514283110, "post_id": 47970008, "comment_id": 82922815, "body": "I tried the same func Cell() *string { \ts:= &quot;&quot; \tfmt.Println(&quot;sdsdsdsd&quot;) \treturn &amp;s }"}, {"owner": {"reputation": 11, "user_id": 9138806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Y7x098wUE5M/AAAAAAAAAAI/AAAAAAAAAAA/9U4PXKBKkmk/photo.jpg?sz=128", "display_name": "Andrey Voronko", "link": "https://stackoverflow.com/users/9138806/andrey-voronko"}, "edited": false, "score": 0, "creation_date": 1514283729, "post_id": 47970008, "comment_id": 82923035, "body": "Ok. If it is inline. 30MB / 15000 = 2KB I think it&#39;s a lot for func Cell() *string { \ts:= &quot;&quot; \treturn &amp;s }"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1514226266, "last_edit_date": 1514226266, "creation_date": 1514216308, "answer_id": 47970008, "question_id": 47968970, "link": "https://stackoverflow.com/questions/47968970/inlining-and-output-binary-size/47970008#47970008", "title": "Inlining and output binary size", "body": "<p>The size of an <code>interface{}</code> variable is 8 or 16 bytes (depending on the architecture being 32 or 64 bit), and the size of a function variable is either 4 or 8 bytes. So there is only a 2 multiplication which would not explain the big difference in the output binary (15.000 * 8 bytes is only 120 KB).</p>\n\n<p>What you experience is the result of <em>different inlining</em> compiler optimization. The function <code>Cell()</code> is very simple and is eligible for inlining.</p>\n\n<h2>When inlining is disabled</h2>\n\n<p>If we include the <code>-gcflags '-N -l'</code> params like in your example (these flags tell the compiler to disable inlining), then references to <code>Cell</code> are not inlined, so using <code>func() *string</code> will only use a 4-byte function pointer.</p>\n\n<p>Using <code>interface{}</code> however will result in <em>inlining</em> <code>Cell</code> values. Interface values hold a copy, and the function call is not inlined, but when the function value is used when implicitly wrapped in <code>interface{}</code> values, it is inlined (duplicated). In each time, that is 15.000 times! So basically the <code>Cell()</code> function body is included 15.000 times. Now that's big, that is what makes the resulting binary 30 MB.</p>\n\n<h2>When inlining is enabled</h2>\n\n<p>If we exclude the <code>-gcflags '-N -l'</code> params, <strong>it's actually the opposite</strong>: the compiled binary is about 2 MB when using <code>interface{}</code>, and it's about 30 MB when using <code>func () *string</code>.</p>\n\n<p>This time when using the <code>Cell</code> function value in the composite literal for initializing the <code>TreeCell.Tabs</code> field, the compiler will inline the <code>Cell()</code> function in all 15.000 times! When using <code>interface{}</code>, the function bodies will not be inlined however. Not sure why, a possible explanation is that it is also inlined in case of <code>interface{}</code>, and since interface values are immutable, the same value is used 15.000 times.</p>\n"}], "owner": {"reputation": 11, "user_id": 9138806, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Y7x098wUE5M/AAAAAAAAAAI/AAAAAAAAAAA/9U4PXKBKkmk/photo.jpg?sz=128", "display_name": "Andrey Voronko", "link": "https://stackoverflow.com/users/9138806/andrey-voronko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 193, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514226266, "creation_date": 1514207481, "last_edit_date": 1514222164, "question_id": 47968970, "link": "https://stackoverflow.com/questions/47968970/inlining-and-output-binary-size", "title": "Inlining and output binary size", "body": "<pre><code>package main\n\ntype TreeCell struct {\n    Tabs func() *string\n}\n\nfunc Cell() *string {\n    s:= \"\"\n    return &amp;s\n}\n\nfunc Table(Line *[]TreeCell) {\n    if Line != nil {\n        Num[\"rtt\"] = Line\n    }\n}\n\nvar (\n    Num map[string]*[]TreeCell \n)\n\nfunc main() {\n\n    Table(&amp;[]TreeCell{\n        TreeCell{Tabs: Cell},\n        TreeCell{Tabs: Cell},\n        ...repeat 15000 times\n        TreeCell{Tabs: Cell},\n    })\n}\n</code></pre>\n\n<p>go build -a -v -gcflags \"-N -l\" -ldflags \"-s -w\"</p>\n\n<p>Size of executable file 1,9Mb</p>\n\n<pre><code>__text              1459891   16781312\n__rodata             158107   18241216\nTotal               1951521\n</code></pre>\n\n<p>if I change the <code>func() *string</code> to the <code>interface{}</code>  </p>\n\n<pre><code>type TreeCell struct {\n    Tabs interface{}\n}\n</code></pre>\n\n<p>then size of executable file 32Mb</p>\n\n<pre><code>__text               1864389   16781312\n__rodata            30375699   18645728\nTotal               32698219\n</code></pre>\n\n<p>Why?</p>\n\n<p>Go version 1.9.2</p>\n"}, {"tags": ["parsing", "go", "yaml"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514205788, "post_id": 47968591, "comment_id": 82906933, "body": "Why do you need the original indentation?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1514207927, "post_id": 47968591, "comment_id": 82907470, "body": "When you unmarshal the YAML text into a Go value, the indentation info is lost (not stored in memory), so marshaling it again can&#39;t reproduce the same indentation if it wasn&#39;t standard."}], "owner": {"reputation": 97, "user_id": 2556216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10ff698005815ae6b27596c2ce915dff?s=128&d=identicon&r=PG", "display_name": "wannamit", "link": "https://stackoverflow.com/users/2556216/wannamit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1151, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1542380694, "creation_date": 1514204721, "question_id": 47968591, "link": "https://stackoverflow.com/questions/47968591/how-to-unmarshal-and-marshal-yaml-in-go-lang-while-preserving-white-space", "title": "How to Unmarshal and Marshal YAML in GO lang, while preserving white space?", "body": "<p>I have a YAML like</p>\n\n<pre><code>data:\n  label1:\n    - someval1\n    - someval2\n  label2:\n    - otherval1\n    - otehrval2\n</code></pre>\n\n<p>Using YAML parser \"gopkg.in/yaml.v2\"</p>\n\n<pre><code>yaml.Unmarshal([]byte(yamlStr), &amp;yamlObj)\n\n# Some works and changes to yamlObj\n\ns, _ := yaml.Marshal(&amp;yamlObj)\nfmt.Println(string(s))\n</code></pre>\n\n<p>This outputs:</p>\n\n<pre><code>data:\n  label1:\n  - someval1\n  - someval2\n  label2:\n  - otherval1\n  - otehrval2\n</code></pre>\n\n<p>The resulted YAML is correct but for my task I need lists (<code>- values</code>) indented as in original YAML. Is there a way to preserve those spaces and new lines?</p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 1, "creation_date": 1514194243, "post_id": 47967352, "comment_id": 82904187, "body": "You can add the heartbeat to separate goroutine"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1514204954, "post_id": 47967352, "comment_id": 82906691, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/32937883/writing-sleep-function-based-on-time-after/32937957#32937957\">Writing Sleep function based on time.After</a>."}], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 8, "last_activity_date": 1514194373, "creation_date": 1514194373, "answer_id": 47967399, "question_id": 47967352, "link": "https://stackoverflow.com/questions/47967352/select-ignored-slow-case/47967399#47967399", "title": "select ignored slow case?", "body": "<p>You're running <code>time.After</code> as part of the select condition, which means it's evaluated at the time the select is reached... which means that it will expire 5 seconds <em>after</em> the select is reached. So you will only enter that case if <code>highFreqChan</code> doesn't have any data for 5 seconds straight.</p>\n\n<p>If you want to do something <em>every</em> 5 seconds, use a <a href=\"https://golang.org/pkg/time/#Ticker\" rel=\"noreferrer\">time.Ticker</a> instead, like so:</p>\n\n<pre><code>heartbeat := time.NewTicker(5 * time.Second)\ndefer heartbeat.Stop()\nfor {\n    select {\n    case data:= &lt;- highFreqChan:\n        // do something:\n    case &lt;- heartbeat.C:\n        // send some heartbeat like data...\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3232, "user_id": 342348, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d087287d971a900fb9772b65d6d93e2e?s=128&d=identicon&r=PG", "display_name": "coanor", "link": "https://stackoverflow.com/users/342348/coanor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 47967399, "answer_count": 1, "score": 0, "last_activity_date": 1514195235, "creation_date": 1514193945, "last_edit_date": 1514195235, "question_id": 47967352, "link": "https://stackoverflow.com/questions/47967352/select-ignored-slow-case", "title": "select ignored slow case?", "body": "<p>I'm using such a <code>select</code> on multiple cases:</p>\n\n<pre><code>for {\n    select {\n    case data:= &lt;- highFreqChan:\n        // do something:\n    case &lt;- time.After(time.Second * 5):\n        // send some heartbeat like data...\n    }\n}\n</code></pre>\n\n<p>I find that, if <code>highFreqChan</code> got huge data, the heartbeat case will not enter, and when stop sending data to <code>highFreqChan</code>, the heartbeat case alive again, how to make it always enter the heartbeat case while the <code>highFreqChan</code> still working?</p>\n"}, {"tags": ["performance", "go", "multicore", "throughput"], "comments": [{"owner": {"reputation": 848, "user_id": 2256024, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/UfVDl.png?s=128&g=1", "display_name": "sudo", "link": "https://stackoverflow.com/users/2256024/sudo"}, "edited": false, "score": 2, "creation_date": 1514181838, "post_id": 47966072, "comment_id": 82901821, "body": "This totally depends on the task you&#39;re performing are they independent, do they need to be certain order or batch etc, have a look at <a href=\"https://golang.org/src/runtime/debug.go?s=533:559#L7\" rel=\"nofollow noreferrer\">GOMAXPROCS</a> this might be useful for you"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1514195382, "post_id": 47966072, "comment_id": 82904426, "body": "The only way to know is to benchmark multiple configurations of your specific code, and on your specific hardware, and on your specific OS, and under your specific load, and see which works best."}], "answers": [{"comments": [{"owner": {"reputation": 346, "user_id": 7401775, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/79fae12e436469518f605824de67925b?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Lin", "link": "https://stackoverflow.com/users/7401775/joe-lin"}, "edited": false, "score": 0, "creation_date": 1514223267, "post_id": 47966819, "comment_id": 82910914, "body": "Thanks. So I guess the answer is that it does not matter how many go routines I have. As long as I have GOMAXPROCS set to the number of CPUs available I would have to trust Go scheduler to fully utilize the CPUs."}, {"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "reply_to_user": {"reputation": 346, "user_id": 7401775, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/79fae12e436469518f605824de67925b?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Lin", "link": "https://stackoverflow.com/users/7401775/joe-lin"}, "edited": false, "score": 2, "creation_date": 1514233308, "post_id": 47966819, "comment_id": 82913121, "body": "@JoeLin If you have a lot of CPU intensive goroutines and GOMAXPROCS equal to your CPU count it will utilize all of your CPU. You may want to benchmark producing less goroutines if you are sure that they don&#39;t block to minimize switching cost but my speculation is it doesn&#39;t matter much."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 2, "creation_date": 1514267842, "post_id": 47966819, "comment_id": 82918171, "body": "Starting Go 1.5 GOMAXPROCS is already set equal to the number of cores available on the system(<a href=\"https://golang.org/doc/go1.5#introduction\" rel=\"nofollow noreferrer\">golang.org/doc/go1.5#introduction</a>) and using as many goroutines is not going to consume all of the CPU&#39;s, it&#39;s just that they are mapping to as many threads running on the CPU&#39;s. The OS scheduler is still going to do it&#39;s work. Also the GOMAXPROCS function call will go away (<a href=\"https://golang.org/pkg/runtime/#GOMAXPROCS\" rel=\"nofollow noreferrer\">golang.org/pkg/runtime/#GOMAXPROCS</a>) eventually. You are better off benchmarking to find out what works best for you."}], "tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": false, "score": 4, "last_activity_date": 1514188988, "creation_date": 1514188988, "answer_id": 47966819, "question_id": 47966072, "link": "https://stackoverflow.com/questions/47966072/how-to-scale-number-of-go-routines-on-a-multi-core-machine-for-maximum-throughpu/47966819#47966819", "title": "How to scale number of Go routines on a multi-core machine for maximum throughput", "body": "<p>I think you are missing a point of goroutines, they are not OS threads and you should not care about their number (until you reach something like a million goroutine). Making less or more of them barely changes the performance as Go runtime will take care of scheduling them on real OS threads.</p>\n\n<p>The number of real OS threads is controled by <a href=\"https://golang.org/pkg/runtime/#GOMAXPROCS\" rel=\"nofollow noreferrer\">GOMAXPROCS</a> (you could set it with programming or as an environment variable). It's default to the number of cores on your machine.</p>\n\n<p>The point is only active goroutines are scheduled on OS threads and inactive ones (like one is waiting on a socket) are not taking any CPU resource.</p>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 3, "last_activity_date": 1514199107, "creation_date": 1514199107, "answer_id": 47967922, "question_id": 47966072, "link": "https://stackoverflow.com/questions/47966072/how-to-scale-number-of-go-routines-on-a-multi-core-machine-for-maximum-throughpu/47967922#47967922", "title": "How to scale number of Go routines on a multi-core machine for maximum throughput", "body": "<p>Since your tasks are CPU bound (rather than IO bound) you probably wouldn't benefit from having too many goroutines for sure (since they would hardly block, it may only add a switching overhead between them). If your all your tasks finish in almost the same time, then benchmarking with few numbers (of goroutines) which are multiples of GOMAXPROCS may not be a bad idea to start with.</p>\n"}], "owner": {"reputation": 346, "user_id": 7401775, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/79fae12e436469518f605824de67925b?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Lin", "link": "https://stackoverflow.com/users/7401775/joe-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1888, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1514199107, "creation_date": 1514181371, "question_id": 47966072, "link": "https://stackoverflow.com/questions/47966072/how-to-scale-number-of-go-routines-on-a-multi-core-machine-for-maximum-throughpu", "title": "How to scale number of Go routines on a multi-core machine for maximum throughput", "body": "<p>Running on a multi-core machine, I have bunch of go routines waiting on a channel for CPU intensive tasks. What is the optimal number of Go routines I should use in order to achieve maximum throughput of #tasks/second. Should it be equivalent to the number of cores or be proportional to the number of cores, or something else?</p>\n"}, {"tags": ["sockets", "go", "tcp"], "comments": [{"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 2, "creation_date": 1514180857, "post_id": 47966008, "comment_id": 82901694, "body": "Maybe you can be clearer about what you mean by guarantee. TCP tries its best to deliver messages but if there is a network problem it can&#39;t solve that."}, {"owner": {"reputation": 883, "user_id": 950907, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d68775cd1117659353ce0a0ae3b1e1d6?s=128&d=identicon&r=PG", "display_name": "Radu", "link": "https://stackoverflow.com/users/950907/radu"}, "edited": false, "score": 0, "creation_date": 1514181032, "post_id": 47966008, "comment_id": 82901717, "body": "I guess it depends on implementation, but at least in standard cases, closing a socket (after the connection has been established) should make a best attempt to deliver the data in the buffers first."}, {"owner": {"reputation": 974, "user_id": 5736835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a20959e2ab8649b47ccdf9a97e5d8422?s=128&d=identicon&r=PG&f=1", "display_name": "WDUK", "link": "https://stackoverflow.com/users/5736835/wduk"}, "reply_to_user": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 1, "creation_date": 1514181830, "post_id": 47966008, "comment_id": 82901820, "body": "@JamesKPolk i mean will the code still be on Write() and not go to Close() until the handshake has completed or failed ? Or does it write/send and then just run Close() regardless of the result of it, meaning it could close when it hasn&#39;t yet finished the acknowledgement from the client ?"}, {"owner": {"reputation": 974, "user_id": 5736835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a20959e2ab8649b47ccdf9a97e5d8422?s=128&d=identicon&r=PG&f=1", "display_name": "WDUK", "link": "https://stackoverflow.com/users/5736835/wduk"}, "reply_to_user": {"reputation": 883, "user_id": 950907, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d68775cd1117659353ce0a0ae3b1e1d6?s=128&d=identicon&r=PG", "display_name": "Radu", "link": "https://stackoverflow.com/users/950907/radu"}, "edited": false, "score": 0, "creation_date": 1514181938, "post_id": 47966008, "comment_id": 82901838, "body": "@Radu thats good to know that it tries to send the buffers, do you know where they have that mentioned any where in writing though ?"}, {"owner": {"reputation": 848, "user_id": 2256024, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/UfVDl.png?s=128&g=1", "display_name": "sudo", "link": "https://stackoverflow.com/users/2256024/sudo"}, "edited": false, "score": 2, "creation_date": 1514182318, "post_id": 47966008, "comment_id": 82901882, "body": "<code>Write()</code> is a blocking call and it return the number of <code>bytes</code> it has written and an optional <code>error</code> if any, <a href=\"https://golang.org/pkg/net/#TCPConn.Write\" rel=\"nofollow noreferrer\">more info here</a>"}, {"owner": {"reputation": 883, "user_id": 950907, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d68775cd1117659353ce0a0ae3b1e1d6?s=128&d=identicon&r=PG", "display_name": "Radu", "link": "https://stackoverflow.com/users/950907/radu"}, "edited": false, "score": 0, "creation_date": 1514183015, "post_id": 47966008, "comment_id": 82902012, "body": "It&#39;s not that easy to find something in writing, because it differs on the OS, programming language, how you set up your sockets, etc. You can find some info about how MS implements it in C# <a href=\"https://msdn.microsoft.com/en-us/library/wahsac9k(v=vs.110).aspx\" rel=\"nofollow noreferrer\">msdn.microsoft.com/en-us/library/wahsac9k(v=vs.110).aspx</a> Other languages and OSes can do it differently."}], "answers": [{"comments": [{"owner": {"reputation": 974, "user_id": 5736835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a20959e2ab8649b47ccdf9a97e5d8422?s=128&d=identicon&r=PG&f=1", "display_name": "WDUK", "link": "https://stackoverflow.com/users/5736835/wduk"}, "edited": false, "score": 0, "creation_date": 1514245257, "post_id": 47966565, "comment_id": 82915103, "body": "So whats the safe way of handling this situation where you want to close but need to know if the message successfully sent or &quot;successfully&quot; failed to send so you know to close the connection or try send again first?"}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "reply_to_user": {"reputation": 974, "user_id": 5736835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a20959e2ab8649b47ccdf9a97e5d8422?s=128&d=identicon&r=PG&f=1", "display_name": "WDUK", "link": "https://stackoverflow.com/users/5736835/wduk"}, "edited": false, "score": 0, "creation_date": 1514277268, "post_id": 47966565, "comment_id": 82920849, "body": "The peer application has to tell you."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514300302, "post_id": 47966565, "comment_id": 82929027, "body": "<code>Write</code> at least is a blocking call, not async. I don&#39;t know about <code>Close</code> but somehow I doubt its async, since every I/O call I know of in Go is blocking; Go makes everything synchronous and leaves it up to you to run it async in a goroutine if you choose to do so. It&#39;s possible under certain operating systems, the OS will run it async without the process having a say in the matter, but it&#39;s certainly not universally true."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514300409, "post_id": 47966565, "comment_id": 82929062, "body": "This is not explicitly stated in the documentation, however, it is strongly implied by the explanation of how timeouts work; <code>Write</code> and <code>Read</code> both <i>return an error</i> if the write/read times out; this would be impossible if they were writing/reading asynchronously."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514370765, "post_id": 47966565, "comment_id": 82949403, "body": "@Adrian 1. <code>write()</code> equals <code>send()</code>, which <i>operates</i> asynchronously, due to the presence of the socket send buffer. Same for <code>close(()</code>, and this remains true whether you know about it or not: otherwise there is no reason for SO_LINGER with a positive timeout to  exist. I do suggest you look this up. 2. I didn&#39;t say anything about reads working asynchronously. 3. There is no &#39;explanation of how timeouts work&#39; that says that writes return an error if <i>this</i> write times out."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514379089, "post_id": 47966565, "comment_id": 82953175, "body": "It doesn&#39;t matter how send operates, Go&#39;s Write will not return until the write is completed.  Your comment about timeouts doesn&#39;t make any sense - you set a deadline, and any subsequent operation (depending on which deadline you set) will return an error if it doesn&#39;t complete before that deadline."}], "tags": [], "owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "is_accepted": true, "score": 4, "last_activity_date": 1514186524, "creation_date": 1514186524, "answer_id": 47966565, "question_id": 47966008, "link": "https://stackoverflow.com/questions/47966008/does-disconnecting-from-tcp-socket-after-sending-message-guarantees-deliver/47966565#47966565", "title": "Does disconnecting from TCP socket after sending message guarantees deliver?", "body": "<blockquote>\n  <p>Does this guarantee delivery to client/server before <code>Close</code> is called?</p>\n</blockquote>\n\n<p>No.</p>\n\n<blockquote>\n  <p>Or will <code>Close</code> be called after the message sent</p>\n</blockquote>\n\n<p>Both the write and the close are queued for asynchronous execution.</p>\n\n<blockquote>\n  <p>and potentially close the connection during the handshakes if they were too slow to complete in time?</p>\n</blockquote>\n\n<p><code>Close</code> will queue a close for the connection. If the close handshake takes too long the connection will be reset.</p>\n"}, {"comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1514370693, "post_id": 47980323, "comment_id": 82949361, "body": "You can know whether the write succeeded in transferring your data to the socket send buffer. Nothing more."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": -1, "last_activity_date": 1514300501, "creation_date": 1514300501, "answer_id": 47980323, "question_id": 47966008, "link": "https://stackoverflow.com/questions/47966008/does-disconnecting-from-tcp-socket-after-sending-message-guarantees-deliver/47980323#47980323", "title": "Does disconnecting from TCP socket after sending message guarantees deliver?", "body": "<p>Nothing can \"guarantee delivery\" (what if the other end of the connection just crashed?). However, <code>Write</code> is a blocking call, and if you check the returned <code>error</code> value, you can at least know whether or not the write succeeded before you call <code>Close</code>.</p>\n"}], "owner": {"reputation": 974, "user_id": 5736835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a20959e2ab8649b47ccdf9a97e5d8422?s=128&d=identicon&r=PG&f=1", "display_name": "WDUK", "link": "https://stackoverflow.com/users/5736835/wduk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "accepted_answer_id": 47966565, "answer_count": 2, "score": 1, "last_activity_date": 1514300501, "creation_date": 1514180689, "last_edit_date": 1514195434, "question_id": 47966008, "link": "https://stackoverflow.com/questions/47966008/does-disconnecting-from-tcp-socket-after-sending-message-guarantees-deliver", "title": "Does disconnecting from TCP socket after sending message guarantees deliver?", "body": "<p>I couldn't find much information on this, but I have a simple sequence of code like:</p>\n\n<pre><code>// does it wait on Write() until successful handshake or attempt failure\n// or just continue on straight away?\nnet.conn.Write(buffer[1:60])\nconn.Close()\n</code></pre>\n\n<p>Does this guarantee delivery to client/server before <code>Close</code> is called? Or will Close be called after the message sent, and potentially close the connection during the handshakes if they were too slow to complete in time ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1514195063, "post_id": 47964820, "comment_id": 82904366, "body": "&quot;I have a parent strucutre defined&quot;. No you don&#39;t. There is <i>no</i> parent/child relation on Go. Forget that now and forever. Thinking about compositions as parent/child is not helpful."}], "answers": [{"tags": [], "owner": {"reputation": 1875, "user_id": 8803266, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0PJdh.png?s=128&g=1", "display_name": "Oliver Baumann", "link": "https://stackoverflow.com/users/8803266/oliver-baumann"}, "is_accepted": true, "score": 1, "last_activity_date": 1514162827, "creation_date": 1514162827, "answer_id": 47964946, "question_id": 47964820, "link": "https://stackoverflow.com/questions/47964820/convert-composed-type-in-golang/47964946#47964946", "title": "Convert Composed Type in Golang", "body": "<p>Type assertions in Go let you tap into an <em>interface's</em> concrete type, not into structs:</p>\n\n<blockquote>\n  <p>A type assertion provides access to an interface value's underlying concrete value.<br>\n  <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/15</a></p>\n</blockquote>\n\n<p>However, with slight modifications, this code works and probably behaves as you would expect:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype User struct {\n    Email    string `json:\"email\"`\n    Password string `json:\"password\"`\n}\n\ntype PublicUser User\n\nfunc main() {\n    a := User{\n        Email:    \"admin@example.net\",\n        Password: \"1234\",\n    }\n    fmt.Printf(\"%#v\\n\", a)\n    // out: User{Email:\"admin@example.net\", Password:\"1234\"}\n\n    b := PublicUser(a)\n    fmt.Printf(\"%#v\", b)\n    // out PublicUser{Email:\"admin@example.net\", Password:\"1234\"}\n}\n</code></pre>\n\n<p>Here, <code>PublicUser</code> is a redefinition of the <code>User</code> type; most importantly, it is a standalone type, shares the fields, but not the method set of User (<a href=\"https://golang.org/ref/spec#Type_definitions\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Type_definitions</a>).</p>\n\n<p>Then, you can simply use the PublicUser type constructor, as you might have been doing similarly with <code>string</code>/<code>[]byte</code> conversions: <code>foo := []byte(\"foobar\")</code>.</p>\n\n<p>If, on the other hand, you were to use an actual <a href=\"https://blog.golang.org/go1.9\" rel=\"nofollow noreferrer\">type alias</a> (<code>type PublicUser = User</code>) your output will list <code>User</code> as type for both instances: PublicUser is only a new name for the old thing, not a new type.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "anon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "accepted_answer_id": 47964946, "answer_count": 1, "score": -2, "last_activity_date": 1514195659, "creation_date": 1514160681, "last_edit_date": 1514195659, "question_id": 47964820, "link": "https://stackoverflow.com/questions/47964820/convert-composed-type-in-golang", "title": "Convert Composed Type in Golang", "body": "<p>I've been <a href=\"https://attilaolah.eu/2014/09/10/json-and-struct-composition-in-go/\" rel=\"nofollow noreferrer\">reading about</a> type alias and composed structs in Golang. I want to be able to have two structs which are structurally identical but can be easily converted between each other.</p>\n\n<p>I have a parent structure defined as:</p>\n\n<pre><code>type User struct {\n    Email    string `json:\"email\"`\n    Password string `json:\"password\"`\n}\n</code></pre>\n\n<p>And a composed struct defined as:</p>\n\n<pre><code>type PublicUser struct {\n    *User\n}\n</code></pre>\n\n<p>I would expect that if I define a <code>User</code>:</p>\n\n<pre><code>a := User{\n        Email:    \"admin@example.net\",\n        Password: \"1234\",\n    }\n</code></pre>\n\n<p>I could then perform the following type conversion:</p>\n\n<pre><code>b := (a).(PublicUser)\n</code></pre>\n\n<p>But it fails with an invalid type assertion:</p>\n\n<pre><code>invalid type assertion: a.(PublicUser) (non-interface type User on left)\n</code></pre>\n\n<p>How can I convert between structurally similar types in Go?</p>\n\n<p><a href=\"https://play.golang.org/p/I0VqrflOfXU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/I0VqrflOfXU</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514300860, "post_id": 47964223, "comment_id": 82929223, "body": "The reader also maintains an internal pointer to the current <i>byte index</i> it&#39;s reading, which it uses as it reads to return the next line when requested."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514319945, "post_id": 47964223, "comment_id": 82935506, "body": "@Adrian Where is the pointer to the byte index in the source?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514320168, "post_id": 47964223, "comment_id": 82935569, "body": "Depends on the reader, and may not be in Go source (it may be behind a syscall), but every reader knows what it&#39;s going to return for the next call to <code>Read</code>, otherwise it wouldn&#39;t work."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514321102, "post_id": 47964223, "comment_id": 82935847, "body": "I thought you were referring the <a href=\"https://godoc.org/encoding/csv#Reader\" rel=\"nofollow noreferrer\">csv Reader</a>, not the underlying io.Reader. There are io.Readers <a href=\"https://godoc.org/io#PipeReader\" rel=\"nofollow noreferrer\">that do not maintain a byte index</a> (either in Go code or in the os)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514321239, "post_id": 47964223, "comment_id": 82935905, "body": "Fair point, but that&#39;s an unusual exception. Even for a live stream like a TCP connection, the stream will be buffered, and the reader will maintain a read index within the buffer. And, since the CSV reader uses a <code>bufio.Reader</code> internally... it uses a buffer, and maintains a read index within that buffer."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 13, "last_activity_date": 1514310824, "last_edit_date": 1514310824, "creation_date": 1514152016, "answer_id": 47964223, "question_id": 47963981, "link": "https://stackoverflow.com/questions/47963981/how-does-a-reader-in-golang-automatically-iterate-in-a-loop/47964223#47964223", "title": "How does a Reader in Golang automatically iterate in a loop?", "body": "<blockquote>\n  <p>How does a Reader in Golang automatically iterate in a loop?\n  How does the reader know which iteration its on?</p>\n</blockquote>\n\n<p>The Read method returns the next record by consuming more data from the underlying io.Reader. The Read method returns io.EOF when there are no more records in the underlying reader.</p>\n\n<p>The application is responsible for calling read in a loop as shown in the example.</p>\n\n<p>The Reader does not need to know the line number to read the next record, but the Reader does maintain a <a href=\"https://github.com/golang/go/blob/f3f507b2d86bfb38c7e466a465d5b6463cfd4184/src/encoding/csv/reader.go#L147-L148\" rel=\"noreferrer\">line counter</a> in its internal state for annotating errors.</p>\n\n<p>If the application needs to know the line number, the application can declare a counter and increment the counter on each read.</p>\n\n<blockquote>\n  <p>How can I change this? E.g. grab just the first line.</p>\n</blockquote>\n\n<p>Call Read once:</p>\n\n<pre><code>f, err := os.Open(\"people.csv\")\nif err != nil {\n    // handle error\n} \ndefer f.Close()\n\nr := csv.NewReader(f)\nfirstLine, err := r.Read()\nif err != nil {\n   // handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 873894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f479d021c24900125e54ab9ed78b2f21?s=128&d=identicon&r=PG", "display_name": "Indoordinosaur", "link": "https://stackoverflow.com/users/873894/indoordinosaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2686, "favorite_count": 0, "accepted_answer_id": 47964223, "answer_count": 1, "score": 1, "last_activity_date": 1514310824, "creation_date": 1514149170, "last_edit_date": 1514150297, "question_id": 47963981, "link": "https://stackoverflow.com/questions/47963981/how-does-a-reader-in-golang-automatically-iterate-in-a-loop", "title": "How does a Reader in Golang automatically iterate in a loop?", "body": "<p>I'm reading about how to use CSVs in Golang and came across this code:</p>\n\n<pre><code>csvFile, _ := os.Open(\"people.csv\")\nreader := csv.NewReader(bufio.NewReader(csvFile))\nvar people []Person\nfor {\n    line, error := reader.Read()\n    if error == io.EOF {\n        break\n    } else if error != nil {\n        log.Fatal(error)\n    }\n    people = append(people, Person{\n        Firstname: line[0],\n        Lastname:  line[1],\n    })\n}\n</code></pre>\n\n<p>Located here: <a href=\"https://www.thepolyglotdeveloper.com/2017/03/parse-csv-data-go-programming-language/\" rel=\"nofollow noreferrer\">https://www.thepolyglotdeveloper.com/2017/03/parse-csv-data-go-programming-language/</a></p>\n\n<p>What I find confusing here is with the infinite for-loop, each iteration grabs the next line but there's no <code>lineNum++</code> type logic being passed into the Reader. How does the reader know which iteration its on? How can I change this? E.g. grab <em>just</em> the first line.</p>\n"}, {"tags": ["http", "go", "json-rpc"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514138146, "post_id": 47962676, "comment_id": 82894996, "body": "What is the &quot;rpc http handler&quot;?"}, {"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514138314, "post_id": 47962676, "comment_id": 82895032, "body": "@CeriseLimon <a href=\"https://golang.org/pkg/net/rpc/#Server.HandleHTTP\" rel=\"nofollow noreferrer\">this</a> function registers http handler in default http server."}], "answers": [{"comments": [{"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "edited": false, "score": 0, "creation_date": 1514140986, "post_id": 47963053, "comment_id": 82895697, "body": "<a href=\"http://www.jsonrpc.org/historical/json-rpc-over-http.html\" rel=\"nofollow noreferrer\">JSON-RPC specification</a> mentioned that you must use GET or POST as HTTP method but I think it is not true in your way."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "edited": false, "score": 0, "creation_date": 1514142293, "post_id": 47963053, "comment_id": 82895978, "body": "@ParhamAlvani Your question and comment on the question points to this solution. Update the question to say what you want."}, {"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "edited": false, "score": 0, "creation_date": 1514142634, "post_id": 47963053, "comment_id": 82896056, "body": "Thanks, I have updated my question. but I think this solution is the best solution based on Go builtin libraries."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1514146762, "last_edit_date": 1514146762, "creation_date": 1514139405, "answer_id": 47963053, "question_id": 47962676, "link": "https://stackoverflow.com/questions/47962676/jsonrpc-over-http-in-go/47963053#47963053", "title": "JSONRPC over HTTP in Go", "body": "<p>The built-in RPC HTTP handler uses the gob codec on a hijacked HTTP connection.  Here's how to do the same with the JSONRPC.  </p>\n\n<p>Write an HTTP handler that runs the JSONRPC server with a hijacked connection.  </p>\n\n<pre><code>func serveJSONRPC(w http.ResponseWriter, req *http.Request) {\n    if req.Method != \"CONNECT\" {\n        http.Error(w, \"method must be connect\", 405)\n        return\n    }\n    conn, _, err := w.(http.Hijacker).Hijack()\n    if err != nil {\n        http.Error(w, \"internal server error\", 500)\n        return\n    }\n    defer conn.Close()\n    io.WriteString(conn, \"HTTP/1.0 Connected\\r\\n\\r\\n\")\n    jsonrpc.ServeConn(conn)\n}\n</code></pre>\n\n<p>Register this handler with the HTTP server.  For example:</p>\n\n<pre><code> http.HandleFunc(\"/rpcendpoint\", serveJSONRPC)\n</code></pre>\n\n<p>EDIT: OP has since updated question to make it clear that they want GET/POST instead of connect.</p>\n"}], "owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1548, "favorite_count": 3, "closed_date": 1514146808, "accepted_answer_id": 47963053, "answer_count": 1, "score": 2, "last_activity_date": 1514146762, "creation_date": 1514136491, "last_edit_date": 1514142583, "question_id": 47962676, "link": "https://stackoverflow.com/questions/47962676/jsonrpc-over-http-in-go", "closed_reason": "Duplicate", "title": "JSONRPC over HTTP in Go", "body": "<p>How can I use JSON-RPC over HTTP based on <a href=\"http://www.jsonrpc.org/historical/json-rpc-over-http.html\" rel=\"nofollow noreferrer\">this specification</a> in Go?</p>\n\n<p>Go provides JSON-RPC codec in <code>net/rpc/jsonrpc</code> but this codec use network connection as input so you cannot use it with go RPC HTTP handler. I attach sample code that uses TCP for JSON-RPC:</p>\n\n<pre><code>func main() {\n    cal := new(Calculator)\n    server := rpc.NewServer()\n    server.Register(cal)\n    listener, e := net.Listen(\"tcp\", \":1234\")\n    if e != nil {\n        log.Fatal(\"listen error:\", e)\n    }\n    for {\n        if conn, err := listener.Accept(); err != nil {\n            log.Fatal(\"accept error: \" + err.Error())\n        } else {\n            log.Printf(\"new connection established\\n\")\n            go server.ServeCodec(jsonrpc.NewServerCodec(conn))\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "pq"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514136850, "post_id": 47962615, "comment_id": 82894667, "body": "You&#39;re using <code>[]int</code>, but the error says <code>*[]int64</code>. Are you sure your code matches your error message?"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 13, "last_activity_date": 1514138250, "last_edit_date": 1514138250, "creation_date": 1514137080, "answer_id": 47962753, "question_id": 47962615, "link": "https://stackoverflow.com/questions/47962615/query-for-an-integer-array-from-postresql-always-returns-uint8/47962753#47962753", "title": "Query for an integer array from PostreSQL always returns []uint8", "body": "<p>You cannot use a slice of int as a <code>driver.Value</code>. The arguments to <code>Scan</code> <em>must</em> be of one of the <a href=\"https://golang.org/pkg/database/sql/driver/#Value\" rel=\"noreferrer\">supported types</a>, or implement the <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"noreferrer\">sql.Scanner</a> interface.</p>\n\n<p>The reason you're seeing <code>[]uint8</code> in the error message is that the raw value returned from the database is a <code>[]byte</code> slice, for which <code>[]uint8</code> is a synonym.</p>\n\n<p>To interpret that <code>[]byte</code> slice appropriately as a custom PostgreSQL array type, you should use the appropriate array types defined in the <a href=\"https://godoc.org/github.com/lib/pq\" rel=\"noreferrer\">pq</a> package, such as the <a href=\"https://godoc.org/github.com/lib/pq#Int64Array\" rel=\"noreferrer\">Int64Array</a>.</p>\n\n<p>Try something like this:</p>\n\n<pre><code>var ret pq.Int64Array\nerr = db.QueryRow(\"SELECT bar FROM foo WHERE id=$1\", 1).Scan(&amp;ret)\nif err != nil {\n    fmt.Println(err)\n}\n\nfmt.Println(ret)\n</code></pre>\n"}], "owner": {"reputation": 1027, "user_id": 3622676, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/n4SuA.jpg?s=128&g=1", "display_name": "myartsev", "link": "https://stackoverflow.com/users/3622676/myartsev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2113, "favorite_count": 1, "accepted_answer_id": 47962753, "answer_count": 1, "score": 6, "last_activity_date": 1514138250, "creation_date": 1514136076, "question_id": 47962615, "link": "https://stackoverflow.com/questions/47962615/query-for-an-integer-array-from-postresql-always-returns-uint8", "title": "Query for an integer array from PostreSQL always returns []uint8", "body": "<p>Take a simple PostreSQL db with an integer array:  </p>\n\n<pre><code>CREATE TABLE foo (\n    id                       serial PRIMARY KEY,\n    bar               integer[]\n);\n\nINSERT INTO foo VALUES(DEFAULT, '{1234567, 20, 30, 40}');\n</code></pre>\n\n<p>Using pq, these values are for some reason being retrieved as an array of []uint8.<br>\nThe <a href=\"https://godoc.org/github.com/lib/pq#hdr-Data_Types\" rel=\"noreferrer\">documentation</a> says that integer types are returned as int64. Does this not apply to arrays as well?</p>\n\n<pre><code>db, err := sql.Open(\"postgres\", \"user=a_user password=your_pwd dbname=blah\")\nif err != nil {\n    fmt.Println(err)\n}\n\nvar ret []int\nerr = db.QueryRow(\"SELECT bar FROM foo WHERE id=$1\", 1).Scan(&amp;ret)\nif err != nil {\n    fmt.Println(err)\n}\n\nfmt.Println(ret)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>sql: Scan error on column index 0: unsupported Scan, storing driver.Value type []uint8 into type *[]int64\n[]\n</code></pre>\n"}, {"tags": ["go", "gomobile"], "comments": [{"owner": {"reputation": 71, "user_id": 7886345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e67502009835d30eadeb0162823d8455?s=128&d=identicon&r=PG&f=1", "display_name": "M.Nair", "link": "https://stackoverflow.com/users/7886345/m-nair"}, "edited": false, "score": 0, "creation_date": 1514139447, "post_id": 47962432, "comment_id": 82895312, "body": "I fixed it by upgrading my go version to 1.9.2. It seems OS sierra requires at least go1.7.4 or above."}, {"owner": {"reputation": 9345, "user_id": 4237316, "user_type": "registered", "accept_rate": 47, "profile_image": "https://graph.facebook.com/100004533998341/picture?type=large", "display_name": "Harald Nordgren", "link": "https://stackoverflow.com/users/4237316/harald-nordgren"}, "edited": false, "score": 1, "creation_date": 1514168079, "post_id": 47962432, "comment_id": 82900271, "body": "You can post this comment as an answer, to resolve the question."}], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 7886345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e67502009835d30eadeb0162823d8455?s=128&d=identicon&r=PG&f=1", "display_name": "M.Nair", "link": "https://stackoverflow.com/users/7886345/m-nair"}, "is_accepted": false, "score": 0, "last_activity_date": 1514215361, "creation_date": 1514215361, "answer_id": 47969899, "question_id": 47962432, "link": "https://stackoverflow.com/questions/47962432/installing-gomobile-on-mac-os-sierra-10-12/47969899#47969899", "title": "installing gomobile on mac OS Sierra 10.12", "body": "<p>I fixed it by upgrading my go version to 1.9.2. It seems OS sierra requires at least go1.7.4 or above. \u2013</p>\n"}], "owner": {"reputation": 71, "user_id": 7886345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e67502009835d30eadeb0162823d8455?s=128&d=identicon&r=PG&f=1", "display_name": "M.Nair", "link": "https://stackoverflow.com/users/7886345/m-nair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 509, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1514215361, "creation_date": 1514134449, "last_edit_date": 1514134855, "question_id": 47962432, "link": "https://stackoverflow.com/questions/47962432/installing-gomobile-on-mac-os-sierra-10-12", "title": "installing gomobile on mac OS Sierra 10.12", "body": "<p>I am trying to install gomobile on mac OS Sierra 10.12. I have go version 1.7.1 installed.</p>\n\n<p>After doing the steps given below : </p>\n\n<ol>\n<li><p><code>go get golang.org/x/mobile/cmd/gomobile</code></p></li>\n<li><p><code>gomobile init</code></p></li>\n</ol>\n\n<p>I get the following errors</p>\n\n<pre><code>gomobile: go install -pkgdir=/usr/local/mobgo/pkg/gomobile/pkg_darwin_arm std failed: exit status 2\n# internal/poll\n../go/src/internal/poll/fd_mutex.go:194:6: missing function body\n../go/src/internal/poll/fd_mutex.go:195:6: missing function body\n../go/src/internal/poll/fd_poll_runtime.go:17:6: missing function body\n../go/src/internal/poll/fd_poll_runtime.go:19:6: missing function body\n../go/src/internal/poll/fd_poll_runtime.go:20:6: missing function body\n../go/src/internal/poll/fd_poll_runtime.go:21:6: missing function body\n../go/src/internal/poll/fd_poll_runtime.go:22:6: missing function body\n../go/src/internal/poll/fd_poll_runtime.go:23:6: missing function body\n../go/src/internal/poll/fd_poll_runtime.go:24:6: missing function body\n../go/src/internal/poll/fd_poll_runtime.go:25:6: missing function body\n../go/src/internal/poll/fd_poll_runtime.go:25:6: too many errors\n</code></pre>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1514128338, "post_id": 47961245, "comment_id": 82892663, "body": "It is not clear to me what you&#39;re asking, but why are you not serializing your configuration to something like YAML or JSON?"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 10, "last_activity_date": 1514138041, "last_edit_date": 1514138041, "creation_date": 1514128727, "answer_id": 47961791, "question_id": 47961245, "link": "https://stackoverflow.com/questions/47961245/golang-dynamic-access-to-a-struct-property/47961791#47961791", "title": "Golang dynamic access to a struct property", "body": "<p>Use the <a href=\"http://godoc.org/reflect\" rel=\"noreferrer\">reflect</a> package to set a field by name:</p>\n\n<pre><code>// setField sets field of v with given name to given value.\nfunc setField(v interface{}, name string, value string) error {\n    // v must be a pointer to a struct\n    rv := reflect.ValueOf(v)\n    if rv.Kind() != reflect.Ptr || rv.Elem().Kind() != reflect.Struct {\n        return errors.New(\"v must be pointer to struct\")\n    }\n\n    // Dereference pointer\n    rv = rv.Elem()\n\n    // Lookup field by name\n    fv := rv.FieldByName(name)\n    if !fv.IsValid() {\n        return fmt.Errorf(\"not a field name: %s\", name)\n    }\n\n    // Field must be exported\n    if !fv.CanSet() {\n        return fmt.Errorf(\"cannot set field %s\", name)\n    }\n\n    // We expect a string field\n    if fv.Kind() != reflect.String {\n        return fmt.Errorf(\"%s is not a string field\", name)\n    }\n\n    // Set the value\n    fv.SetString(value)\n    return nil\n}\n</code></pre>\n\n<p>Call it like this:</p>\n\n<pre><code>var config SshConfig\n\n...\n\nerr := setField(&amp;config, split[0], strings.Join(split[1:], \" \"))\nif err != nil {\n   // handle error\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/16vqu2yhw6d\" rel=\"noreferrer\">playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": false, "score": 0, "last_activity_date": 1514197904, "creation_date": 1514197904, "answer_id": 47967780, "question_id": 47961245, "link": "https://stackoverflow.com/questions/47961245/golang-dynamic-access-to-a-struct-property/47967780#47967780", "title": "Golang dynamic access to a struct property", "body": "<p>You could use reflect package to dynamically inspect structs at runtime. See <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">docs</a> and <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">blog</a>.</p>\n\n<p>But if all you want to do is read the file into a structure its better to use something like <code>map[string]string</code>. Inspecting maps at runtime is much cleaner (e.g. you could <code>range</code> over it, check membership and ... in one line).</p>\n\n<pre><code>m := make(map[string]string)\n...\nm[split[0]] = strings.Join(split[1:], \" \")\n</code></pre>\n"}], "owner": {"reputation": 835, "user_id": 1105727, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/Ys5Bh.jpg?s=128&g=1", "display_name": "Charles Bryant", "link": "https://stackoverflow.com/users/1105727/charles-bryant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6683, "favorite_count": 0, "accepted_answer_id": 47961791, "answer_count": 2, "score": 5, "last_activity_date": 1551800496, "creation_date": 1514124317, "question_id": 47961245, "link": "https://stackoverflow.com/questions/47961245/golang-dynamic-access-to-a-struct-property", "title": "Golang dynamic access to a struct property", "body": "<p>I am writing a quick ssh config to json processor in golang. I have the following stuct:</p>\n\n<pre><code>type SshConfig struct {\n    Host string\n    Port string\n    User string\n    LocalForward string\n    ...\n}\n</code></pre>\n\n<p>I am currently looping over every line of my ssh config file and splitting the line on spaces and checking which property to update.</p>\n\n<pre><code>if split[0] == \"Port\" {\n    sshConfig.Port = strings.Join(split[1:], \" \")\n}\n</code></pre>\n\n<p>Is there a way to check a property exists and then set it dynamically?</p>\n"}, {"tags": ["go", "wmi", "ole"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1514208357, "post_id": 47961176, "comment_id": 82907560, "body": "Does the second approach works if you replace <code>CreateObject</code> with <code>GetActiveObject</code>?"}, {"owner": {"reputation": 11, "user_id": 9136438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5a64f51f6e77c6d0255e285736dd952?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/9136438/james"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1514303810, "post_id": 47961176, "comment_id": 82930216, "body": "I&#39;ve just given this a try and again I get &quot;invalid class string&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 1216, "user_id": 1424378, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/ffb07d39eccb7309c53b83f430345a34?s=128&d=identicon&r=PG&f=1", "display_name": "James Cameron", "link": "https://stackoverflow.com/users/1424378/james-cameron"}, "is_accepted": false, "score": 0, "last_activity_date": 1541502060, "creation_date": 1541502060, "answer_id": 53170555, "question_id": 47961176, "link": "https://stackoverflow.com/questions/47961176/golang-wmi-query-xp/53170555#53170555", "title": "Golang WMI query XP", "body": "<p>Stumbled upon this question and wanted to provide an answer.</p>\n\n<p>To connect to a namespace / winmgmts, you need to execute the Connect - method using the badly documented namespace argument.</p>\n\n<p>Sample code\n    package main</p>\n\n<pre><code>import (\n    \"github.com/go-ole/go-ole\"\n    \"github.com/go-ole/go-ole/oleutil\"\n)\n\nfunc main() {\n    ole.CoInitializeEx(0, ole.COINIT_MULTITHREADED)\n    defer ole.CoUninitialize()\n\n    unknown, err := oleutil.CreateObject(\"WbemScripting.SWbemLocator\")\n    if err != nil {\n        log.Panic(err)\n    }\n    defer unknown.Release()\n\n    wmi, err := unknown.QueryInterface(ole.IID_IDispatch)\n    if err != nil {\n        log.Panic(err)\n    }\n    defer wmi.Release()\n\n    // Connect to namespace\n    // root/PanasonicPC = winmgmts:\\\\.\\root\\PanasonicPC\n    serviceRaw, err := oleutil.CallMethod(wmi, \"ConnectServer\", nil, \"root/PanasonicPC\")\n    if err != nil {\n        log.Panic(err)\n    }\n    service := serviceRaw.ToIDispatch()\n    defer serviceRaw.Clear()\n\n    // Interact with service object etc\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9136438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5a64f51f6e77c6d0255e285736dd952?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/9136438/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 398, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1541502060, "creation_date": 1514123757, "last_edit_date": 1514123805, "question_id": 47961176, "link": "https://stackoverflow.com/questions/47961176/golang-wmi-query-xp", "title": "Golang WMI query XP", "body": "<p>I'm using mattn's go-ole package to connect to WMI, I got this working using some examples I found on stack and all is fine until I try to make it work in Win XP. The Microsoft documentation says <code>thatWbemScripting.SWbemLocator</code> is only available for Vista so I've been trying the <code>winmgmts</code> method that Microsoft shows for use on VBScript but i'm not getting anywhere.</p>\n\n<p>Here is what I have.</p>\n\n<p>This works on Win 7:</p>\n\n<pre><code>wmiscriptObj, err := oleutil.CreateObject(\"WbemScripting.SWbemLocator\")\n</code></pre>\n\n<p>This doesn't work in either XP or 7:</p>\n\n<pre><code>wmiscriptObj, err := oleutil.CreateObject(\"winmgmts:\\\\\\\\.\\\\root\\\\cimv2\")\n</code></pre>\n\n<p>I get invalid class as an error.</p>\n\n<p>Not sure if this helps explain things but in the past I've used Autoit to query WMI on XP and I can connect with this:</p>\n\n<pre><code>$objWMIService = ObjGet(\"winmgmts:\\\\\" &amp; $ComputerName &amp; \"\\root\\CIMV2\")\n</code></pre>\n\n<p>Any help would be much appreciated.</p>\n"}, {"tags": ["go", "optimization", "parallel-processing", "goroutine", "worker-pool"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1514109541, "post_id": 47958826, "comment_id": 82888446, "body": "There is no objective answer to this. It depends entirely on what you&#39;re doing with your workers, and what performance characteristics you&#39;re aiming for. If your workers are I/O bound (such as an HTTP or SMTP server), you could conceivably handle 1,000s of workers on a single CPU machine. If they&#39;re CPU-bound, then you may see no benefit beyond one worker per CPU."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1514112331, "post_id": 47958826, "comment_id": 82888965, "body": "Also, there&#39;s no reason to set <code>GOMAXPROCS</code> in 99.99% of modern Go applications. And setting it to num CPUs + 1 never makes sense, AFAIK. You should only set this if you want to reduce the default."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 1, "creation_date": 1514121641, "post_id": 47958826, "comment_id": 82890949, "body": "It depends on what kind of problem you are solving (CPU bound or otherwise), and the life of each of your tasks the worker thread is going to handle. You need to try out a few numbers, benchmark and see what works best for your use case."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 6522, "user_id": 931511, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/eNqBf.jpg?s=128&g=1", "display_name": "guilhebl", "link": "https://stackoverflow.com/users/931511/guilhebl"}, "edited": false, "score": 0, "creation_date": 1514195136, "post_id": 47959992, "comment_id": 82904381, "body": "&quot;My code really does implement a worker pool&quot; -- fair enough, my apologies for overlooking that. I have removed that comment from my answer. I believe the rest of the answer holds."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 6522, "user_id": 931511, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/eNqBf.jpg?s=128&g=1", "display_name": "guilhebl", "link": "https://stackoverflow.com/users/931511/guilhebl"}, "edited": false, "score": 1, "creation_date": 1514301074, "post_id": 47959992, "comment_id": 82929275, "body": "@guilhebl the alternative isn&#39;t &quot;only use a single thread in a synchronous manner&quot;. The alternative is to use unpooled workers - one goroutine per task - and let the scheduler take care of it. This is the correct solution most of the time, as the answer explains."}, {"owner": {"reputation": 6522, "user_id": 931511, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/eNqBf.jpg?s=128&g=1", "display_name": "guilhebl", "link": "https://stackoverflow.com/users/931511/guilhebl"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514331660, "post_id": 47959992, "comment_id": 82938538, "body": "@Adrian Based on this post <a href=\"http://marcio.io/2015/07/handling-1-million-requests-per-minute-with-golang/\" rel=\"nofollow noreferrer\">marcio.io/2015/07/&hellip;</a> it seems using a worker pool in certain scenarios could be reasonable in terms of better performance."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1514333046, "post_id": 47959992, "comment_id": 82938783, "body": "True, and I&#39;d never suggest it wasn&#39;t. My point is that the simple option of just starting a goroutine per task is generally sufficient, and the added complexity of a worker pool should only be added if it is necessary in a specific situation and proven through measurement to improve performance in that situation."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 8, "last_activity_date": 1514195111, "last_edit_date": 1514195111, "creation_date": 1514113219, "answer_id": 47959992, "question_id": 47958826, "link": "https://stackoverflow.com/questions/47958826/optimal-size-of-worker-pool/47959992#47959992", "title": "Optimal size of worker pool", "body": "<p>The comments in your sample code suggest you may be conflating the two concepts of <code>GOMAXPROCS</code> and a worker pool. These two concepts are completely distinct in Go.</p>\n\n<ol>\n<li><p><code>GOMAXPROCS</code> sets the maximum number of CPU threads the Go runtime will use. This defaults to the number of CPU cores found on the system, and should almost never be changed. The only time I can think of to change this would be if you wanted to explicitly limit a Go program to use fewer than the available CPUs for some reason, then you might set this to 1, for example, even when running on a 4-core CPU.  This should only ever matter in rare situations.</p>\n\n<p><strong>TL;DR;</strong> Never set <code>runtime.GOMAXPROCS</code> manually.</p></li>\n<li><p>Worker pools in Go are a set of goroutines, which handle jobs as they arrive. There are different ways of handling worker pools in Go.</p>\n\n<p>What number of workers should you use? There is no objective answer. Probably the only way to know is to benchmark various configurations until you find one that meets your requirements.</p>\n\n<p>As a simple case, suppose your worker pool is doing something very CPU-intensive. In this case, you probably want one worker per CPU.</p>\n\n<p>As a more likely example, though, lets say your workers are doing something more I/O bound--such as reading HTTP requests, or sending email via SMTP. In this case, you may reasonably handle dozens or even thousands of workers per CPU.</p>\n\n<p>And then there's also the question of if you even should use a worker pool. Most problems in Go do not require worker pools at all. I've worked on dozens of production Go programs, and never once used a worker pool in any of them. I've also written many times more one-time-use Go tools, and only used a worker pool maybe once.</p></li>\n</ol>\n\n<p>And finally, the only way in which <code>GOMAXPROCS</code> and worker pools relate is the same as how goroutines relates to <code>GOMAXPROCS</code>. From <a href=\"https://golang.org/pkg/runtime/#hdr-Environment_Variables\" rel=\"noreferrer\">the docs</a>:</p>\n\n<blockquote>\n  <p>The GOMAXPROCS variable limits the number of operating system threads that can execute user-level Go code simultaneously. There is no limit to the number of threads that can be blocked in system calls on behalf of Go code; those do not count against the GOMAXPROCS limit. This package's GOMAXPROCS function queries and changes the limit.</p>\n</blockquote>\n\n<p>From this simple description, it's easy to see that there could be many more (potentially hundreds of thousands... or more) goroutines than <code>GOMAXPROCS</code>--<code>GOMAXPROCS</code> only limits how many \"operating system threads that can execute user-level Go code simultaneously\"--goroutines which aren't executing user-level Go code at the moment don't count. And in I/O-bound goroutines (such as those waiting for a network response) aren't executing code. So you have a theoretical maximum number of goroutines limited only by your system's available memory.</p>\n"}], "owner": {"reputation": 6522, "user_id": 931511, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/eNqBf.jpg?s=128&g=1", "display_name": "guilhebl", "link": "https://stackoverflow.com/users/931511/guilhebl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3123, "favorite_count": 1, "accepted_answer_id": 47959992, "answer_count": 1, "score": 3, "last_activity_date": 1611260468, "creation_date": 1514100141, "last_edit_date": 1611260468, "question_id": 47958826, "link": "https://stackoverflow.com/questions/47958826/optimal-size-of-worker-pool", "title": "Optimal size of worker pool", "body": "<p>I'm building a Go app which uses a &quot;worker pool&quot; of goroutines, initially I start the pool creating a number of workers. I was wondering what would be the optimal number of workers in a mult-core processor, for example in a CPU with 4 cores ? I'm currently using the following aproach:</p>\n<pre><code>    // init pool\n    numCPUs := runtime.NumCPU()\n\n    runtime.GOMAXPROCS(numCPUs + 1) // numCPUs hot threads + one for async tasks.\n    maxWorkers := numCPUs * 4\n\n    jobQueue := make(chan job.Job)\n\n    module := Module{\n        Dispatcher: job.NewWorkerPool(maxWorkers),\n        JobQueue:   jobQueue,\n        Router:     router,\n    }\n\n    // A buffered channel that we can send work requests on.\n    module.Dispatcher.Run(jobQueue)\n</code></pre>\n<p>The complete implementation is under</p>\n<blockquote>\n<p>job.NewWorkerPool(maxWorkers)\nand\nmodule.Dispatcher.Run(jobQueue)</p>\n</blockquote>\n<p>My use-case for using a worker pool: I have a service which accepts requests and calls multiple external APIs and aggregate their results into a single response. Each call can be done independently from others as the order of results doesn't matter. I dispatch the calls to the worker pool where each call is done in one available goroutine in an asynchronous way. My &quot;request&quot; thread keeps listening to the return channels while fetching and aggregating results as soon as a worker thread is done. When all are done the final aggregated result is returned as a response. Since each external API call may render variable response times some calls can be completed earlier than others. As per my understanding doing it in a parallel way would be better in terms of performance as if compared to doing it in a synchronous way calling each external API one after another</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 1, "creation_date": 1514098013, "post_id": 47958457, "comment_id": 82886497, "body": "are you sure relative file paths are correct?"}, {"owner": {"reputation": 387, "user_id": 2432174, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/ioAZo.jpg?s=128&g=1", "display_name": "dinu0101", "link": "https://stackoverflow.com/users/2432174/dinu0101"}, "edited": false, "score": 0, "creation_date": 1514127542, "post_id": 47958457, "comment_id": 82892428, "body": "That is not a case of relative or absolute path. I want to reuse existing code &amp; doesn&#39;t want to duplicate. That&#39;s happening in current scenario."}], "answers": [{"comments": [{"owner": {"reputation": 387, "user_id": 2432174, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/ioAZo.jpg?s=128&g=1", "display_name": "dinu0101", "link": "https://stackoverflow.com/users/2432174/dinu0101"}, "edited": false, "score": 0, "creation_date": 1514554656, "post_id": 47964558, "comment_id": 83016007, "body": "@chawey I understood what you said. Now my concern is that when we build/install application for production then we need to change the path every time between window &amp; Linux. Please guide me how to configure path to that work on both envionments"}, {"owner": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "reply_to_user": {"reputation": 387, "user_id": 2432174, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/ioAZo.jpg?s=128&g=1", "display_name": "dinu0101", "link": "https://stackoverflow.com/users/2432174/dinu0101"}, "edited": false, "score": 0, "creation_date": 1514690480, "post_id": 47964558, "comment_id": 83049821, "body": "Actually a good reference is the linked question: <a href=\"https://stackoverflow.com/questions/31059023/how-to-reference-a-relative-file-from-code-and-tests\" title=\"how to reference a relative file from code and tests\">stackoverflow.com/questions/31059023/&hellip;</a>."}, {"owner": {"reputation": 387, "user_id": 2432174, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/ioAZo.jpg?s=128&g=1", "display_name": "dinu0101", "link": "https://stackoverflow.com/users/2432174/dinu0101"}, "edited": false, "score": 0, "creation_date": 1514738464, "post_id": 47964558, "comment_id": 83059286, "body": "@chawey Thanks. I understand the Golang.  How Golang works."}], "tags": [], "owner": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "is_accepted": false, "score": 0, "last_activity_date": 1514156104, "creation_date": 1514156104, "answer_id": 47964558, "question_id": 47958457, "link": "https://stackoverflow.com/questions/47958457/golang-config-file-should-load-their-own-package/47964558#47964558", "title": "Golang Config File should load their own package", "body": "<p>You need to approach the problem differently. You are compiling your code to a single binary file, so by the time your program is actually running, it has lost all of its package structure.</p>\n\n<p>The simplest solution is to modify <code>services/web</code> to accept a <code>web.Config</code> struct instead of loading from a file. Then the consumer (the <code>broker</code> package in this case) is responsible for providing the config. It can use a file if it wants to.</p>\n"}], "owner": {"reputation": 387, "user_id": 2432174, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/ioAZo.jpg?s=128&g=1", "display_name": "dinu0101", "link": "https://stackoverflow.com/users/2432174/dinu0101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 475, "favorite_count": 0, "closed_date": 1514204493, "answer_count": 1, "score": 0, "last_activity_date": 1514156104, "creation_date": 1514095903, "last_edit_date": 1514127313, "question_id": 47958457, "link": "https://stackoverflow.com/questions/47958457/golang-config-file-should-load-their-own-package", "closed_reason": "Duplicate", "title": "Golang Config File should load their own package", "body": "<p>I have two projects those are\n1. Web Project\n2. Broker Project</p>\n\n<pre><code>services\n    -web/util.go\n    -main.go\n    -cofig.json\n\n\nbroker\n    -consumer/redis.go\n    -consumer/mongo.go\n    -main.go\n    -&lt;cofig.go&gt;   //I do not want to make a copy here\n</code></pre>\n\n<p>I have developed an utility program for my web project which uses config.json file. In that utility program I use the code like</p>\n\n<pre><code>file, _ := os.Open(\"./config.json\")\n</code></pre>\n\n<p>That is working fine.\nWhen I included this project into Broker project like</p>\n\n<pre><code>package \"services/web\"\n</code></pre>\n\n<p>And I tried to utilize utility code in it but it tries to find 'config.json' from Broker project instead of \"services web project\". Due to this reason I need to copy the same file inside the Broker project.</p>\n\n<p>Please help me to keep single file inside 'services/web'</p>\n\n<p>Thanks is advance.</p>\n\n<p>Regards,\nDinesh  </p>\n"}, {"tags": ["http", "go", "middleware", "go-chi"], "comments": [{"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 1, "creation_date": 1514099651, "post_id": 47957988, "comment_id": 82886739, "body": "You can chain middlewares as usuall. Their docmention that it fully implements <code>Router</code> interface"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 5, "last_activity_date": 1514133604, "last_edit_date": 1514133604, "creation_date": 1514110391, "answer_id": 47959717, "question_id": 47957988, "link": "https://stackoverflow.com/questions/47957988/middleware-on-a-specific-route/47959717#47959717", "title": "Middleware on a specific route", "body": "<p>You have two options.  The natural way, supported by any router:</p>\n\n<pre><code>r.Post(\"/\", middlewareFunc(Login))\n</code></pre>\n\n<p>Or if you want to use a Chi-specific way, create a new Group for the one specific endpoint:</p>\n\n<pre><code>loginGroup := r.Group(nil)\nloginGroup.Use(middleware)\nloginGroup.Post(\"/\", Login)\n</code></pre>\n"}], "owner": {"reputation": 640, "user_id": 3197412, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2eb2a78a67a1736e656f716f2cb5e65?s=128&d=identicon&r=PG", "display_name": "batazor", "link": "https://stackoverflow.com/users/3197412/batazor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2613, "favorite_count": 1, "accepted_answer_id": 47959717, "answer_count": 1, "score": 3, "last_activity_date": 1534002084, "creation_date": 1514088235, "last_edit_date": 1534002084, "question_id": 47957988, "link": "https://stackoverflow.com/questions/47957988/middleware-on-a-specific-route", "title": "Middleware on a specific route", "body": "<p>As in <code>go-chi</code>, set middleware at the level of individual routes, and not just globally for all routes</p>\n\n<pre><code>// Routes creates a REST router\nfunc Routes() chi.Router {\n    r := chi.NewRouter()\n    r.Use(middleware.Captcha)\n\n    r.Post(\"/\", Login)\n\n    return r\n}\n</code></pre>\n\n<p>How for <code>Login</code> to specify a unique middleware or to exclude from the general middleware?</p>\n"}, {"tags": ["git", "go", "microservices", "directory-structure"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514110026, "post_id": 47957575, "comment_id": 82888539, "body": "Git does support symlinks."}, {"owner": {"reputation": 1393, "user_id": 1180020, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/gMiy1.jpg?s=128&g=1", "display_name": "mirt", "link": "https://stackoverflow.com/users/1180020/mirt"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514118705, "post_id": 47957575, "comment_id": 82890252, "body": "@Flimzy accrording to this <a href=\"https://stackoverflow.com/a/18791647/1180020\">stackoverflow.com/a/18791647/1180020</a> it doesn&#39;t. i mean it doesn&#39;t count symlink to dir as dir"}], "answers": [{"comments": [{"owner": {"reputation": 1393, "user_id": 1180020, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/gMiy1.jpg?s=128&g=1", "display_name": "mirt", "link": "https://stackoverflow.com/users/1180020/mirt"}, "edited": false, "score": 0, "creation_date": 1514118985, "post_id": 47958456, "comment_id": 82890308, "body": "So the go pkg directory wouldn&#39;t be in the git repository. Is it the right choice?"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 1393, "user_id": 1180020, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/gMiy1.jpg?s=128&g=1", "display_name": "mirt", "link": "https://stackoverflow.com/users/1180020/mirt"}, "edited": false, "score": 0, "creation_date": 1514119268, "post_id": 47958456, "comment_id": 82890359, "body": "@mirt yes, you do not need <code>pkg</code> in git repo. Only source code."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514124672, "post_id": 47958456, "comment_id": 82891679, "body": "That has more to do with git not supporting directories."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1514095897, "creation_date": 1514095897, "answer_id": 47958456, "question_id": 47957575, "link": "https://stackoverflow.com/questions/47957575/go-microservice-in-project-and-monolit-git-repository/47958456#47958456", "title": "Go microservice in project and monolit git repository", "body": "<p>Just for simplicity suppose: project is located in <code>/Users/user/Workspace/Monorepo/go-microservice</code> checked out from github repo <code>github.com/Company/Monorepo</code>.</p>\n\n<p>Make symlink from another side: from GOPATH to required folder. Your repo is kept in standard space and GO can see code with its usual path.</p>\n\n<p>Thus make in folder <code>/Users/user/go/src/github.com/Company</code> symlink <code>Monorepo</code> pointing to first path.</p>\n"}], "owner": {"reputation": 1393, "user_id": 1180020, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/gMiy1.jpg?s=128&g=1", "display_name": "mirt", "link": "https://stackoverflow.com/users/1180020/mirt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514118937, "creation_date": 1514081797, "last_edit_date": 1514118937, "question_id": 47957575, "link": "https://stackoverflow.com/questions/47957575/go-microservice-in-project-and-monolit-git-repository", "title": "Go microservice in project and monolit git repository", "body": "<p>Let's say I want to write one of my microservices in a project with go and I also want to keep monolit git repository for the whole project. The problem is that such microservice should be located under GOPATH and I can't even symlink it into my project cause git doesn't support symlinks.\nWhat are options to keep the monolit repository for project while having go microservices in it?</p>\n\n<p>Edit:\nI mean what the best practice to keep go microservice in git for non-golang project.</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514085161, "post_id": 47957540, "comment_id": 82884852, "body": "Do you want to write <code>b</code> to the file like <code>afero.WriteFile(mfs, &quot;&#47;path&#47;to&#47;file.gz&quot;, b.Bytes(), 0644)</code>?   I don&#39;t understand the question, but that&#39;s one way the code in the question can fit together."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514109981, "post_id": 47957540, "comment_id": 82888531, "body": "Are you trying to write or read a gzip file? Your question mentions both."}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "edited": false, "score": 0, "creation_date": 1514133771, "post_id": 47957540, "comment_id": 82893910, "body": "Need to write to a gzip file so that my function I am testing can read from that mocked file."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1514210332, "post_id": 47957540, "comment_id": 82907992, "body": "&quot;write a file of gzipped content&quot; <a href=\"https://stackoverflow.com/a/32017845/4466350\">stackoverflow.com/a/32017845/4466350</a>"}, {"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "edited": false, "score": 0, "creation_date": 1514367415, "post_id": 47957540, "comment_id": 82947780, "body": "What do you mean by mock? Isn&#39;t <code>b</code> in your first code snippet a mock?"}], "owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 480, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1514087224, "creation_date": 1514081132, "last_edit_date": 1514087224, "question_id": 47957540, "link": "https://stackoverflow.com/questions/47957540/how-do-i-mock-writing-to-a-gzip-file", "title": "How do I mock writing to a gzip file?", "body": "<p>I can write a normal gzip file:</p>\n\n<pre><code>var b bytes.Buffer\nw := gzip.NewWriter(&amp;b)\nw.Write([]byte(\"hello, world\\n\"))\nw.Close()\n</code></pre>\n\n<p>But I cannot figure out how to mock a gzip file so that I can read that mocked file for my tests:</p>\n\n<pre><code>afero.WriteFile(mfs, \"/path/to/file.gz\", []byte(\"here is file\"), 0644)\n</code></pre>\n\n<p>If I try to read this mock gzip file the error I get is:</p>\n\n<pre><code>gzip: invalid header\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6165, "user_id": 1901658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/95eee89c6704eb4d075c33821c61af72?s=128&d=identicon&r=PG", "display_name": "Fredrick Brennan", "link": "https://stackoverflow.com/users/1901658/fredrick-brennan"}, "edited": false, "score": 0, "creation_date": 1514074751, "post_id": 47957021, "comment_id": 82883592, "body": "Have you tried <code>&amp;_</code>?"}, {"owner": {"reputation": 2611, "user_id": 2908094, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/1717950023/picture?type=large", "display_name": "Mikhail Boyarsky", "link": "https://stackoverflow.com/users/2908094/mikhail-boyarsky"}, "reply_to_user": {"reputation": 6165, "user_id": 1901658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/95eee89c6704eb4d075c33821c61af72?s=128&d=identicon&r=PG", "display_name": "Fredrick Brennan", "link": "https://stackoverflow.com/users/1901658/fredrick-brennan"}, "edited": false, "score": 0, "creation_date": 1514075608, "post_id": 47957021, "comment_id": 82883684, "body": "yes, <code>cannot use &#39;_&#39; as a value</code>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 0, "last_activity_date": 1514111043, "creation_date": 1514111043, "answer_id": 47959768, "question_id": 47957021, "link": "https://stackoverflow.com/questions/47957021/is-there-a-dummy-pointer-type-as-function-argument-in-golang/47959768#47959768", "title": "Is there a dummy pointer type as function argument in golang", "body": "<p>No, there is not.</p>\n\n<p>You must pass a pointer to a value. You can, of course, ignore that value after it's populated by Scan:</p>\n\n<pre><code>dummy := new(T) // creates a pointer to a zero-value object of type T\nerr := rows.Scan(dummy)\n</code></pre>\n"}], "owner": {"reputation": 2611, "user_id": 2908094, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/1717950023/picture?type=large", "display_name": "Mikhail Boyarsky", "link": "https://stackoverflow.com/users/2908094/mikhail-boyarsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 47959768, "answer_count": 1, "score": 1, "last_activity_date": 1514111043, "creation_date": 1514073417, "question_id": 47957021, "link": "https://stackoverflow.com/questions/47957021/is-there-a-dummy-pointer-type-as-function-argument-in-golang", "title": "Is there a dummy pointer type as function argument in golang", "body": "<p>Is there a placeholder-like dummy pointer type which will allow not to make extra variable for rows.Scan() when number of columns mismatch with number of args in rows.Scan() in golang ?</p>\n\n<pre><code>rows, err := db.Query(`SELECT 1, 2, 3`)\nfor rows.Next() {\n    var c1 int\n    var c2 int\n    // panic (number of arguments mismatch)\n    err = rows.Scan(&amp;c1, &amp;c2)\n    // syntax error\n    err = rows.Scan(&amp;c1, &amp;c2, _)\n    // Scan error on column index 2: destination not a pointer\n    err = rows.Scan(&amp;c1, &amp;c2, nil)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1514050441, "post_id": 47954407, "comment_id": 82878359, "body": "See <a href=\"https://golang.org/ref/spec#FunctionLit\" rel=\"nofollow noreferrer\">golang.org/ref/spec#FunctionLit</a>"}], "answers": [{"comments": [{"owner": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "edited": false, "score": 6, "creation_date": 1514059765, "post_id": 47954459, "comment_id": 82880672, "body": "Nitpick: an anonymous function is not the same as a closure. This anonymous function does not refer to any variables other than the function variables."}], "tags": [], "owner": {"reputation": 249903, "user_id": 2422776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2353050223ebecb113741c29458de4b2?s=128&d=identicon&r=PG", "display_name": "Mureinik", "link": "https://stackoverflow.com/users/2422776/mureinik"}, "is_accepted": false, "score": 3, "last_activity_date": 1514049641, "creation_date": 1514049641, "answer_id": 47954459, "question_id": 47954407, "link": "https://stackoverflow.com/questions/47954407/go-func-call-confusion/47954459#47954459", "title": "Go func call confusion", "body": "<p><code>func</code> defines a <a href=\"https://gobyexample.com/closures\" rel=\"nofollow noreferrer\">closure</a>, an annonymous function. <code>handler</code> is a variable that holds a reference to this function, which you can later call by passing the arguments in parenthesis:</p>\n\n<pre><code>handler(w, req)\n</code></pre>\n"}], "owner": {"reputation": 145, "user_id": 8072061, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/d6975c97c0f39b67966db8f83a1302ef?s=128&d=identicon&r=PG&f=1", "display_name": "jenkelblankel", "link": "https://stackoverflow.com/users/8072061/jenkelblankel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1514068518, "creation_date": 1514049209, "last_edit_date": 1514068518, "question_id": 47954407, "link": "https://stackoverflow.com/questions/47954407/go-func-call-confusion", "title": "Go func call confusion", "body": "<p>In this bit of code:</p>\n\n<pre><code>handler := func(w http.ResponseWriter, r *http.Request) {\n    io.WriteString(w, \"&lt;html&gt;&lt;body&gt;Hello World!&lt;/body&gt;&lt;/html&gt;\")\n</code></pre>\n\n<p>}</p>\n\n<p>What is the <code>func</code> keyword doing? I've been reading through the Tour of Go and I'm confused as to what is going on here. </p>\n\n<p>EDITED: Added import list and function that it was apart of </p>\n\n<p>It's part of a function here:</p>\n\n<pre><code>func ExampleResponseRecorder() {\nhandler := func(w http.ResponseWriter, r *http.Request) {\n    io.WriteString(w, \"&lt;html&gt;&lt;body&gt;Hello World!&lt;/body&gt;&lt;/html&gt;\")\n}\n\nreq := httptest.NewRequest(\"GET\", \"http://example.com/foo\", nil)\nw := httptest.NewRecorder()\nhandler(w, req)\n\nresp := w.Result()\nbody, _ := ioutil.ReadAll(resp.Body)\n\nfmt.Println(resp.StatusCode)\nfmt.Println(resp.Header.Get(\"Content-Type\"))\nfmt.Println(string(body))\n\n// Output:\n// 200\n// text/html; charset=utf-8\n// &lt;html&gt;&lt;body&gt;Hello World!&lt;/body&gt;&lt;/html&gt;\n }\n\nimport (\n\"fmt\"\n\"io\"\n\"io/ioutil\"\n\"log\"\n\"net/http\"\n\"net/http/httptest\"\n)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1514049506, "post_id": 47954293, "comment_id": 82878117, "body": "my bad, thanks for recover."}, {"owner": {"reputation": 1583, "user_id": 3708323, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/Z3uza.jpg?s=128&g=1", "display_name": "tarrball", "link": "https://stackoverflow.com/users/3708323/tarrball"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1514049960, "post_id": 47954293, "comment_id": 82878250, "body": "np I just learned that 10 minutes ago myself"}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 2, "creation_date": 1553750431, "post_id": 47954293, "comment_id": 97502351, "body": "I don&#39;t agree with the downvotes because I believe this is a valid question; Especially for someone new to Go. Upvoting!"}], "answers": [{"comments": [{"owner": {"reputation": 1583, "user_id": 3708323, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/Z3uza.jpg?s=128&g=1", "display_name": "tarrball", "link": "https://stackoverflow.com/users/3708323/tarrball"}, "edited": false, "score": 0, "creation_date": 1514049014, "post_id": 47954319, "comment_id": 82877988, "body": "When you say it&#39;s discouraged by the Go community, I presume that&#39;s because the function call is less explicit?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1583, "user_id": 3708323, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/Z3uza.jpg?s=128&g=1", "display_name": "tarrball", "link": "https://stackoverflow.com/users/3708323/tarrball"}, "edited": false, "score": 1, "creation_date": 1594057126, "post_id": 47954319, "comment_id": 110987108, "body": "@tarrball Yes, that&#39;s correct. I updated the answer with an explanation."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 20, "last_activity_date": 1594060800, "last_edit_date": 1594060800, "creation_date": 1514048419, "answer_id": 47954319, "question_id": 47954293, "link": "https://stackoverflow.com/questions/47954293/call-a-packages-function-without-using-its-package-name/47954319#47954319", "title": "Call a package&#39;s function without using its package name?", "body": "<p>Use the . (explicit period) import.  The <a href=\"https://golang.org/ref/spec#Import_declarations\" rel=\"noreferrer\">specification says</a>:</p>\n<blockquote>\n<p>If an explicit period (.) appears instead of a name, all the package's exported identifiers declared in that package's package block will be declared in the importing source file's file block and must be accessed without a qualifier.</p>\n</blockquote>\n<p>Example:</p>\n<pre><code>package main\n\nimport (\n    . &quot;fmt&quot;\n)\n\nfunc main() {\n    Println(&quot;Hello, playground&quot;)\n}\n</code></pre>\n<p>The use of the explicit period is discouraged in the Go community. The dot import makes programs more difficult to read because it's unclear if a name is a package-level identifier in the current package or in an imported package.</p>\n<p>Another option is to declare a package-level variable with a reference to the function. Use a <a href=\"https://golang.org/ref/spec#Alias_declarations\" rel=\"noreferrer\">type alias</a> to reference types.</p>\n<pre><code> package main\n\nimport (\n    &quot;fmt&quot;\n)\n\nvar Println = fmt.Println\n\ntype ScanState = fmt.ScanState // type alias\n\n\nfunc main() {\n    Println(&quot;Hello, playground&quot;)\n}\n</code></pre>\n"}], "owner": {"reputation": 1583, "user_id": 3708323, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/Z3uza.jpg?s=128&g=1", "display_name": "tarrball", "link": "https://stackoverflow.com/users/3708323/tarrball"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1467, "favorite_count": 0, "accepted_answer_id": 47954319, "answer_count": 1, "score": 5, "last_activity_date": 1594060800, "creation_date": 1514048204, "question_id": 47954293, "link": "https://stackoverflow.com/questions/47954293/call-a-packages-function-without-using-its-package-name", "title": "Call a package&#39;s function without using its package name?", "body": "<p>Example: </p>\n\n<pre><code>package \"main\"\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"hey there\")\n}\n</code></pre>\n\n<p>Could be written:</p>\n\n<pre><code>package \"main\"\n\nimport blah \"fmt\"\n\nfunc main() {\n    blah.Println(\"hey there\")\n}\n</code></pre>\n\n<p>But is there anyway to import <code>fmt</code> to achieve:</p>\n\n<pre><code>package \"main\"\n\nimport \"fmt\" // ???\n\nfunc main() {\n    Println(\"hey there\")\n}\n</code></pre>\n\n<p>In C# by contrast, you can do this by using a static import (e.g., <code>using static System.Console</code>). Is this possible in Go?</p>\n"}, {"tags": ["json", "node.js", "performance", "go", "crystal-lang"], "comments": [{"owner": {"reputation": 2967, "user_id": 2035962, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/qvnVp.png?s=128&g=1", "display_name": "Stephie", "link": "https://stackoverflow.com/users/2035962/stephie"}, "edited": false, "score": 1, "creation_date": 1514131774, "post_id": 47952457, "comment_id": 82893466, "body": "Without a concrete test case to reproduce this, I can&#39;t investigate it or provide a good answer to you. Did you remember to add <code>--release</code> when benchmarking? Are you timing using <code>crystal run</code> (which includes time required to compile the binary)?"}, {"owner": {"reputation": 6606, "user_id": 1586762, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fb7415aea80a8fa64f7427086eedb6ee?s=128&d=identicon&r=PG", "display_name": "Vitalii Elenhaupt", "link": "https://stackoverflow.com/users/1586762/vitalii-elenhaupt"}, "edited": false, "score": 0, "creation_date": 1514525535, "post_id": 47952457, "comment_id": 83004731, "body": "I&#39;m able to serialize 300+ KB of html using your json struct in Crystal. To answer your question we need to have your concrete test case or benchmark."}], "answers": [{"comments": [{"owner": {"reputation": 6606, "user_id": 1586762, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fb7415aea80a8fa64f7427086eedb6ee?s=128&d=identicon&r=PG", "display_name": "Vitalii Elenhaupt", "link": "https://stackoverflow.com/users/1586762/vitalii-elenhaupt"}, "edited": false, "score": 0, "creation_date": 1514525566, "post_id": 47955902, "comment_id": 83004737, "body": "Actually it is very fast. I&#39;m able to serialize 300+ KB of html in less than 1 second..."}, {"owner": {"reputation": 2800, "user_id": 4990850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26f1aafc5591d499822488281852972f?s=128&d=identicon&r=PG", "display_name": "asterite", "link": "https://stackoverflow.com/users/4990850/asterite"}, "edited": false, "score": 2, "creation_date": 1515065217, "post_id": 47955902, "comment_id": 83162940, "body": "The JSON api was designed with performance in mind. The only reason it&#39;s slower than Go is because it&#39;s memory allocator seems to be slower than Go. But json serialization is generally super fast in Crystal."}], "tags": [], "owner": {"reputation": 4722, "user_id": 7401689, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j8SqS.jpg?s=128&g=1", "display_name": "Johannes M&#252;ller", "link": "https://stackoverflow.com/users/7401689/johannes-m%c3%bcller"}, "is_accepted": false, "score": 1, "last_activity_date": 1514062016, "creation_date": 1514062016, "answer_id": 47955902, "question_id": 47952457, "link": "https://stackoverflow.com/questions/47952457/crystal-slow-json-serialization-of-structs-containing-large-strings/47955902#47955902", "title": "Crystal: slow json serialization of structs containing large strings", "body": "<p>Like many other APIs, Crystal's JSON implementation is not really optimized for speed. It is merely to get it working. And that is actually already quite fast for most use cases, but there are certainly huge improvements awaiting.</p>\n\n<p>I'm not sure what's exactly the reason here. It might be related to string escaping, allthough this need to be done in other languages as well.</p>\n\n<p>Regarding the comparison to JavaScript, transforming an object to JSON is actually quite performant because this is a native datatype of JavaScript and implemented very efficiently. This is not dynamic code evaluation but compiled in the Javascript VM.</p>\n"}, {"comments": [{"owner": {"reputation": 509, "user_id": 2272280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcd08704d8f15a0006253bd594caa8fd?s=128&d=identicon&r=PG", "display_name": "felixbuenemann", "link": "https://stackoverflow.com/users/2272280/felixbuenemann"}, "edited": false, "score": 0, "creation_date": 1531958440, "post_id": 48001837, "comment_id": 89796652, "body": "The linked issue is about memory usage during compilation \u2013 runtime performance or memory usage is not affected by debug infos."}, {"owner": {"reputation": 70791, "user_id": 997358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f849cfde4e526e22e916fa69103ef7e7?s=128&d=identicon&r=PG", "display_name": "peak", "link": "https://stackoverflow.com/users/997358/peak"}, "reply_to_user": {"reputation": 509, "user_id": 2272280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcd08704d8f15a0006253bd594caa8fd?s=128&d=identicon&r=PG", "display_name": "felixbuenemann", "link": "https://stackoverflow.com/users/2272280/felixbuenemann"}, "edited": false, "score": 0, "creation_date": 1531976195, "post_id": 48001837, "comment_id": 89800395, "body": "@felixbuenemann - The issue has apparently been resolved, so maybe it no longer matters, but bugs sometimes come back to bite, so let me just say that you either misunderstood my comment about the issue or the issue itself."}], "tags": [], "owner": {"reputation": 70791, "user_id": 997358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f849cfde4e526e22e916fa69103ef7e7?s=128&d=identicon&r=PG", "display_name": "peak", "link": "https://stackoverflow.com/users/997358/peak"}, "is_accepted": false, "score": 0, "last_activity_date": 1514438558, "last_edit_date": 1514438558, "creation_date": 1514437540, "answer_id": 48001837, "question_id": 47952457, "link": "https://stackoverflow.com/questions/47952457/crystal-slow-json-serialization-of-structs-containing-large-strings/48001837#48001837", "title": "Crystal: slow json serialization of structs containing large strings", "body": "<p>Try:</p>\n\n<pre><code>crystal build test.cr --release --no-debug\n</code></pre>\n\n<p>If that doesn't resolve the issue, then it would be worthwhile creating a ticket at <a href=\"https://github.com/crystal-lang/crystal/issues\" rel=\"nofollow noreferrer\">https://github.com/crystal-lang/crystal/issues</a></p>\n\n<h3>Re: --no-debug</h3>\n\n<p>The <code>--no-debug</code> flag may not be necessary, but as of this writing, there is an open issue indicating that in some contexts it is:</p>\n\n<p><a href=\"https://github.com/crystal-lang/crystal/issues/4880\" rel=\"nofollow noreferrer\">https://github.com/crystal-lang/crystal/issues/4880</a></p>\n"}, {"tags": [], "owner": {"reputation": 509, "user_id": 2272280, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcd08704d8f15a0006253bd594caa8fd?s=128&d=identicon&r=PG", "display_name": "felixbuenemann", "link": "https://stackoverflow.com/users/2272280/felixbuenemann"}, "is_accepted": false, "score": 2, "last_activity_date": 1531957778, "creation_date": 1531957778, "answer_id": 51412437, "question_id": 47952457, "link": "https://stackoverflow.com/questions/47952457/crystal-slow-json-serialization-of-structs-containing-large-strings/51412437#51412437", "title": "Crystal: slow json serialization of structs containing large strings", "body": "<p>I tested this with crystal 0.25.1 (LLVM 6.0.1), go 1.10.3, node.js v8.11.2 on macOS x86_64.</p>\n\n<p>The examples all read a 161 KB html file into a string, open a tempfile and do 10.000 iterations of serializing the page object and writing it to the file.</p>\n\n<p>This generates about 1.5 GB of JSON, the system has a very fast PCIe SSD, so IO throughput is not a bottleneck.</p>\n\n<p>I chose to actually write the data to a file to make sure compilers cannot optimize the function calls away.</p>\n\n<p><strong>Crystal</strong></p>\n\n<pre><code>require \"json\"\nrequire \"tempfile\"\nurl = \"http://www.example.org\"\nhtml = File.read(\"index.html\")\n\nrecord(Page, uri : String, html : String) do\n  include JSON::Serializable\nend\n\nTempfile.open(\"foo\") do |io|\n  10_000.times do\n    page = Page.new(url, html)\n    page.to_json(io)\n  end\nend\n</code></pre>\n\n<p><strong>Go</strong></p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"io/ioutil\"\n  \"log\"\n  \"os\"\n)\n\ntype Page struct {\n  Uri  string `json=\"uri\"`\n  Html string `json=\"html\"`\n}\n\nfunc main() {\n  buf, err := ioutil.ReadFile(\"index.html\")\n  if err != nil {\n    log.Fatal(err)\n  }\n  uri := \"http://www.example.org\"\n  html := string(buf)\n  file, err := ioutil.TempFile(os.TempDir(), \"foo\")\n  if err != nil {\n    log.Fatal(err)\n  }\n  defer os.Remove(file.Name())\n  for i := 0; i &lt; 10000; i++ {\n    page := Page{uri, html}\n    json, err := json.Marshal(page)\n    if err != nil {\n      log.Fatal(err)\n    }\n    _, err = file.Write(json)\n    if err != nil {\n      log.Fatal(err)\n    }\n  }\n}\n</code></pre>\n\n<p><strong>Node.js</strong></p>\n\n<pre><code>const fs = require('fs')\nconst tmp = require('tmp')\nconst uri = 'http://www.example.org'\nconst html = fs.readFileSync('index.html')\n\ntmp.file((err, path, fd) =&gt; {\n  if (err) throw err;\n\n  for(let i = 0; i &lt; 10000; i++) {\n    const page = { uri, html }\n    const json = JSON.stringify(page)\n    fs.writeSync(fd, json)\n  }\n})\n</code></pre>\n\n<p><strong>Results</strong></p>\n\n<ul>\n<li>go: 10.88 seconds, 8.5 MB RAM</li>\n<li>crystal: 12.62 seconds, 2 MB RAM, 1.16x as slow</li>\n<li>node.js: 101.82 seconds, 75 MB RAM, 9.36x as slow</li>\n</ul>\n\n<p>Note that I compiled the the Crystal example with <code>--release</code> and updated the code for 0.25.1.</p>\n\n<p>The Node.js example used v8 instead of v10, because v10 was incompatible with the <code>node-tmp</code> npm module I used for tempfiles.</p>\n\n<p>The benchmarks were done on an early-2015 13\" Retina MacBook Pro with i7-5557U CPU, 16 GB RAM and 1 TB PCIe SSD.</p>\n"}], "owner": {"reputation": 39, "user_id": 9133770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53884f0f63104a3c99ddc0566573c514?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Antonov", "link": "https://stackoverflow.com/users/9133770/mark-antonov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 336, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1531957778, "creation_date": 1514031761, "question_id": 47952457, "link": "https://stackoverflow.com/questions/47952457/crystal-slow-json-serialization-of-structs-containing-large-strings", "title": "Crystal: slow json serialization of structs containing large strings", "body": "<p>I'm wondering why json serialization of structs containing large strings is slow in Crystal.</p>\n\n<p>The following code performs rather poorly:</p>\n\n<pre><code>struct Page\n  include AutoJson\n  field :uri, String\n  field :html, String\nend\n\npage = Page.new(url, html) # html is a string containing \u00b1128KB of html\n\npage.to_json\n</code></pre>\n\n<p>Whereas the following code in Javascript (Node.js) or Go is pretty much instantaneous (like x10~x20 times faster):</p>\n\n<p>Node.js</p>\n\n<pre><code>page = { url: url, html: html }\nJSON.stringify(page)\n</code></pre>\n\n<p>Go</p>\n\n<pre><code>type Page struct {\n  Uri string `json=\"uri\"`\n  Html string `json=\"html\"`\n}\n\npage = Page{ uri, html }\n\njson, _ = json.Marshal(page)  \n</code></pre>\n\n<p>Considering Crystal is usually very fast (on par with Go and much faster than V8 Javascript) it kinda left me wondering what was going on here.</p>\n\n<p>I've been experimenting with the Crystal code a little bit and it seems as if the incriminating bit here is the double-quote string escaping of large strings (which is obviously required when serializing json objects). But why would it take so long, I don't know (multiple allocations, copies?).</p>\n\n<p>For the record, in these example, <code>html</code> is a roughly 128KB html file loaded from disk using whatever synchronous method is available. File reading operations are obviously not taken into consideration when benchmarking these snippets.</p>\n"}, {"tags": ["mysql", "database", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 146, "user_id": 5046162, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3b7fca79030656931be21184a013adef?s=128&d=identicon&r=PG&f=1", "display_name": "kckaiwei", "link": "https://stackoverflow.com/users/5046162/kckaiwei"}, "edited": false, "score": 0, "creation_date": 1513983234, "post_id": 47947970, "comment_id": 82866439, "body": "Yeah, got it figured out!  var person Profile  res := db.Find(&amp;person, &amp;Profile{Number: inumber})  return person.Name, person.Number, person.Address, true  Were the key parts. I just didn&#39;t really understand how the db.Where was working, and that it would be saved like that. Still wrapping my head around no objects."}], "tags": [], "owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "is_accepted": true, "score": 4, "last_activity_date": 1513981075, "creation_date": 1513981075, "answer_id": 47947970, "question_id": 47947809, "link": "https://stackoverflow.com/questions/47947809/how-do-i-extract-the-data-from-a-query-in-golangs-gorm-in-mysql/47947970#47947970", "title": "How do I extract the data from a query in Golang&#39;s GORM in mysql?", "body": "<p>You need to retrieve data into some variable to be able to use it later:</p>\n\n<pre><code>p := Profile{}\nres := db.Where(\"Number = ?\", inumber).First(&amp;p)\n\n// now use p\nlog.Printf(\"%+v\", p)\n</code></pre>\n"}], "owner": {"reputation": 146, "user_id": 5046162, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3b7fca79030656931be21184a013adef?s=128&d=identicon&r=PG&f=1", "display_name": "kckaiwei", "link": "https://stackoverflow.com/users/5046162/kckaiwei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2631, "favorite_count": 0, "accepted_answer_id": 47947970, "answer_count": 1, "score": 2, "last_activity_date": 1527757294, "creation_date": 1513979748, "last_edit_date": 1527757294, "question_id": 47947809, "link": "https://stackoverflow.com/questions/47947809/how-do-i-extract-the-data-from-a-query-in-golangs-gorm-in-mysql", "title": "How do I extract the data from a query in Golang&#39;s GORM in mysql?", "body": "<p>I'm trying to read the data from a database with GoLang's GORM, and am new to Go in general. This is the snippet I'm trying to get work. It's to search a database using a number and check if it already exists. Just grasping at straws here, and not really understanding how GORM works, and can't find documentation that explains what to do after doing a Where Clause.</p>\n\n<pre><code>res := db.Where(\"Number = ?\", inumber).First(&amp;Profile{})\nlog.Print(\"Searched for profile\")\nif res.RecordNotFound() {\n    log.Print(\"Record not found\")\n    return \"\", \"\", \"\", false\n} else {\n    log.Print(\"RES\")\n\n    log.Print(res.Rows())\n    ret := res.Scan(&amp;Profile{})\n    return\n}\nreturn\n</code></pre>\n"}, {"tags": ["go", "request", "gorilla"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1513975561, "post_id": 47947133, "comment_id": 82864236, "body": "I mean.. it&#39;s a little hard to understand what you are doing... but what it sounds like is you want to work on the xml and not hold of the response. Send the xml data to be processed by queuing it up to work on later but some sub process."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513977478, "post_id": 47947133, "comment_id": 82864834, "body": "You can always just start a goroutine. They&#39;re covered in <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow noreferrer\">the Go tour</a>."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1514022107, "creation_date": 1514022107, "answer_id": 47951390, "question_id": 47947133, "link": "https://stackoverflow.com/questions/47947133/process-xmlfile-out-of-request/47951390#47951390", "title": "Process XMLFile out of request", "body": "<blockquote>\n  <p>In GoLang, its possible receive the request, return response (200), and process file out of request?</p>\n</blockquote>\n\n<p>Of course. You can use a goroutine:</p>\n\n<pre><code>func myHandler(w http.ResponseWriter, r *http.Request) {\n    go func() {\n        // Process the stuff in a goroutine\n    }()\n    w.WriteHeader(200) // but send the response immediately\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1514038125, "last_edit_date": 1514038125, "creation_date": 1514037606, "answer_id": 47953115, "question_id": 47947133, "link": "https://stackoverflow.com/questions/47947133/process-xmlfile-out-of-request/47953115#47953115", "title": "Process XMLFile out of request", "body": "<p>Yes. Go provides very convenient tools for it. One of classical approaches to this task is to make a channel which will serve as a task queue. Your API function will write to the channel new tasks and another worker goroutine will read and process them :</p>\n\n<pre><code>type Task struct {...} // some fields to describe you task - may be XML document \nvar TaskQueue chan Task\n\nfunc worker() {\n      for task := range TaskQueue {\n             // process task \n       }\n}\n\nfunc handler(w http.ResponseWriter, r*http.Request) {\n    task := Task{...} // put here some values you need \n    TaskQueue &lt;- task\n    w.WriteHeader(200)\n}\n\n\nfunc main() {\n    TaskQueue = make(chan Task, 1)\n     go worker()\n     http.Handle(\"/\", handler)\n     http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>This way gives you some flexibility:</p>\n\n<ul>\n<li>you may run several workers to process tasks in parallel and you can be sure there will be no more workers so can control load to your server</li>\n<li>if all workers are busy new tasks can be put in queue - second parameter of <code>make</code> sets queue length</li>\n<li>if queue gets overloaded you may check it in <code>handler</code> and return an error (not shown here)</li>\n</ul>\n"}], "owner": {"reputation": 139, "user_id": 4106437, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xkJMJ0AoU04/AAAAAAAAAAI/AAAAAAAApl8/y0pxJP-Spsw/photo.jpg?sz=128", "display_name": "Thiago Freitas", "link": "https://stackoverflow.com/users/4106437/thiago-freitas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1514038125, "creation_date": 1513975198, "last_edit_date": 1514021956, "question_id": 47947133, "link": "https://stackoverflow.com/questions/47947133/process-xmlfile-out-of-request", "title": "Process XMLFile out of request", "body": "<p>I created a REST API in GoLang (with gorillamux), and in one request from my API, I process an XMLFile. The problem is, this file is big, 5, 6, 10 MB. I can't process in postfile request, because the time for process. Each node of xml is an http request to another API (very time).</p>\n\n<p>The question is.</p>\n\n<p>In GoLang, its possible receive the request, return response (200), and process file out of request?</p>\n"}, {"tags": ["go", "httprequest", "chunked-encoding", "chunked", "transfer-encoding"], "answers": [{"comments": [{"owner": {"reputation": 1236, "user_id": 1176186, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/53a18d1ae5c3fe32415d91df159399bc?s=128&d=identicon&r=PG&f=1", "display_name": "thinkski", "link": "https://stackoverflow.com/users/1176186/thinkski"}, "edited": false, "score": 0, "creation_date": 1513977134, "post_id": 47947083, "comment_id": 82864726, "body": "Oh wow, this is much simpler -- thank you! And if initially I just wanted to write to a file?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1513977354, "last_edit_date": 1513977354, "creation_date": 1513974877, "answer_id": 47947083, "question_id": 47947011, "link": "https://stackoverflow.com/questions/47947011/handling-request-with-chunked-transfer-encoding/47947083#47947083", "title": "Handling request with chunked transfer-encoding", "body": "<p>The net/http client and server transparently read and write chunked bodies.</p>\n\n<p>To accept a chunked request and send it to another HTTP server, pass the server request body as the client request body.  Here's now to forward the body to another server as a PUT: </p>\n\n<pre><code> func handler(w http.ResponseWriter, r *http.Request) {\n    creq, err := http.NewRequest(\"PUT\", url, r.Body)\n    if err != nil {\n       // handle error\n    }\n    if ct := r.Header.Get(\"Content-Type\"); ct != \"\" {\n        creq.Header.Set(\"Content-Type\", ct)\n    }\n    cresp, err := http.DefaultClient.Do(creq)\n    if err != nil {\n        // handle error\n    }\n    ... do something with cresp.\n }\n</code></pre>\n\n<p>If you want to copy to a file, then io.Copy the request body to the file.</p>\n\n<pre><code> func handler(w http.ResponseWriter, r *http.Request) {\n     f, err := os.Create(\"fname\")\n     if err != nil {\n         // handle error\n     }\n     _, err := io.Copy(f, r.Body)\n     if err != nil {\n          // handle error\n     }\n     ...\n  }\n</code></pre>\n\n<p>These snippets copy the body 'on the fly'.</p>\n"}], "owner": {"reputation": 1236, "user_id": 1176186, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/53a18d1ae5c3fe32415d91df159399bc?s=128&d=identicon&r=PG&f=1", "display_name": "thinkski", "link": "https://stackoverflow.com/users/1176186/thinkski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2479, "favorite_count": 1, "accepted_answer_id": 47947083, "answer_count": 1, "score": 1, "last_activity_date": 1514022133, "creation_date": 1513974315, "last_edit_date": 1514022133, "question_id": 47947011, "link": "https://stackoverflow.com/questions/47947011/handling-request-with-chunked-transfer-encoding", "title": "Handling request with chunked transfer-encoding", "body": "<p>Does golang's net/http package support requests with chunked transfer-encoding? Thus far I have been able to use the Hijacker interface (<a href=\"https://golang.org/src/net/http/server.go?s=6173:6875#L156\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/server.go?s=6173:6875#L156</a>) to at least not close the connection and receive the full chunked request, but not yet parsing the chunks and suspect I may be going down the wrong path with this.</p>\n\n<p>From <a href=\"https://golang.org/src/net/http/httputil/httputil.go?s=688:732#L10\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/httputil/httputil.go?s=688:732#L10</a>, I see there is a chunked reader, but appears to be for internal use.</p>\n\n<p>Essentially, I'm trying to accept an HTTP PUT with 'chunked' transfer-encoding and send it off to a backend server 'on-the-fly' (i.e. without buffering the full request in golang). I have no control over the upstream request. Is there a recommended way to handle such a request, or is Hijacker the way to do it?</p>\n"}, {"tags": ["python", "go", "goland"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513974858, "post_id": 47946855, "comment_id": 82864030, "body": "Are you changing <code>GOROOT</code> anywhere?"}, {"owner": {"reputation": 55, "user_id": 9132270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a88cd190408bb73943eca7b3e338f220?s=128&d=identicon&r=PG&f=1", "display_name": "George Robinson", "link": "https://stackoverflow.com/users/9132270/george-robinson"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513975894, "post_id": 47946855, "comment_id": 82864349, "body": "I edited the post above with an answer to this comment!"}], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 0, "last_activity_date": 1513976422, "creation_date": 1513976422, "answer_id": 47947327, "question_id": 47946855, "link": "https://stackoverflow.com/questions/47946855/no-stdlib-hinting-in-goland-ide-with-custom-gopath-and-govendor/47947327#47947327", "title": "no stdlib hinting in Goland IDE with custom GOPATH and govendor", "body": "<p>Please open an issue on the tracker tracker <a href=\"https://youtrack.jetbrains.com/issues/Go\" rel=\"nofollow noreferrer\">https://youtrack.jetbrains.com/issues/Go</a> and attach the IDE logs via Help | Collect and Show Logs in.... You can lock the visibility of the logs to <code>jetbrains-team</code> and <code>GoLand team</code> only so that the logs are not publicly accessible. </p>\n\n<p>This looks either like a bug in the IDE or a configuration issue on your side but it's hard to tell which without logs. Thank you. </p>\n"}], "owner": {"reputation": 55, "user_id": 9132270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a88cd190408bb73943eca7b3e338f220?s=128&d=identicon&r=PG&f=1", "display_name": "George Robinson", "link": "https://stackoverflow.com/users/9132270/george-robinson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 47947327, "answer_count": 1, "score": 1, "last_activity_date": 1528416011, "creation_date": 1513973362, "last_edit_date": 1528416011, "question_id": 47946855, "link": "https://stackoverflow.com/questions/47946855/no-stdlib-hinting-in-goland-ide-with-custom-gopath-and-govendor", "title": "no stdlib hinting in Goland IDE with custom GOPATH and govendor", "body": "<p>I'm using Goland 2017.3 with Go 1.9.2, and have a custom GOPATH with govendor that replicates the DigitalOcean monorepo, as explained here: <a href=\"https://blog.digitalocean.com/cthulhu-organizing-go-code-in-a-scalable-repo/\" rel=\"nofollow noreferrer\">https://blog.digitalocean.com/cthulhu-organizing-go-code-in-a-scalable-repo/</a></p>\n\n<p>The structure looks like this:</p>\n\n<pre><code>gocode\n\u251c\u2500\u2500 .env.sh\n\u251c\u2500\u2500 bin\n\u251c\u2500\u2500 src\n\u2502   \u2514\u2500\u2500 acmecorp\n\u2502       \u251c\u2500\u2500 teams\n\u2502       \u2514\u2500\u2500 vendor\n\u251c\u2500\u2500 pkg\n</code></pre>\n\n<p>and <code>.env.sh</code> looks like this:</p>\n\n<pre><code>SCRIPT=`python -c \"import os,sys; print(os.path.realpath(os.path.expanduser(sys.argv[1])))\" \"${0}\"`\nGOCODE=$(dirname $SCRIPT)\nexport GOPATH=\"$GOCODE\"\nexport PATH=\"$PATH:$GOPATH/bin\"\n</code></pre>\n\n<p>I have no issue building code with <code>source .env.sh</code> and <code>govendor build</code>. <code>govendor</code> resolves all dependencies and builds the project.</p>\n\n<p>However, when I attempt to set up <code>GOPATH</code> in GoLand and set <code>PROJECT GOPATH</code> to <code>$HOME/gocode</code>, GoLand stops recognizing the stdlib because it starts looking for the stdlib in <code>vendor</code>: <code>$HOME/gocode/src/acmecorp/vendor/time has no buildable Go source files</code>. If I remove the <code>PROJECT GOPATH</code> it finds the stdlib but not the code in the mono repo.</p>\n\n<p>How can I get GoLand to stop looking in <code>vendor</code> for the stdlib?</p>\n\n<p>Edit: <code>GOROOT</code> is kept as standard in the IDE: <a href=\"https://i.stack.imgur.com/NeuiH.png\" rel=\"nofollow noreferrer\">screenshot of GOROOT</a></p>\n"}, {"tags": ["docker", "go", "lxc", "chroot", "nsenter"], "comments": [{"owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 1, "creation_date": 1513980053, "post_id": 47945803, "comment_id": 82865637, "body": "Docker calls containerd which uses runc by default to create containers, so have a look at the runc project: <a href=\"https://github.com/opencontainers/runc\" rel=\"nofollow noreferrer\">github.com/opencontainers/runc</a>"}], "answers": [{"tags": [], "owner": {"reputation": 319, "user_id": 9131523, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eff964a87d09cd576e66a5378ccbf7c?s=128&d=identicon&r=PG&f=1", "display_name": "Fully Buzzword Compliant", "link": "https://stackoverflow.com/users/9131523/fully-buzzword-compliant"}, "is_accepted": false, "score": 3, "last_activity_date": 1513968091, "creation_date": 1513968091, "answer_id": 47945964, "question_id": 47945803, "link": "https://stackoverflow.com/questions/47945803/does-docker-internally-uses-system-calls-like-chroot-unshare-nsenter-etc-or-a/47945964#47945964", "title": "Does docker internally uses system calls like chroot, unshare, nsenter, etc or a wrapper around lxc", "body": "<p>Docker is not a wrapper around LXC.  Back in the old days it did use an LXC-based mechanism for starting containers, but that was <a href=\"https://blog.docker.com/2014/03/docker-0-9-introducing-execution-drivers-and-libcontainer/\" rel=\"nofollow noreferrer\">replaced by a native implementation</a>.</p>\n\n<p>As Docker is an open source project, you can see <em>exactly</em> what it's doing by browsing through <a href=\"https://github.com/moby/moby\" rel=\"nofollow noreferrer\">the source</a> (which has since <a href=\"https://www.theregister.co.uk/2017/04/21/docker_renames_open_source_code_moby/\" rel=\"nofollow noreferrer\">been renamed \"moby\"</a>).</p>\n\n<p>The actual creation of containers is handled by the <a href=\"https://github.com/moby/moby/tree/master/vendor/github.com/opencontainers/runc/libcontainer\" rel=\"nofollow noreferrer\">libcontainer</a> component.</p>\n"}], "owner": {"reputation": 6631, "user_id": 6790948, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/w18wK.png?s=128&g=1", "display_name": "mchawre", "link": "https://stackoverflow.com/users/6790948/mchawre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1128, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1513968091, "creation_date": 1513967128, "question_id": 47945803, "link": "https://stackoverflow.com/questions/47945803/does-docker-internally-uses-system-calls-like-chroot-unshare-nsenter-etc-or-a", "title": "Does docker internally uses system calls like chroot, unshare, nsenter, etc or a wrapper around lxc", "body": "<p>I was going through an <a href=\"https://ericchiang.github.io/post/containers-from-scratch/\" rel=\"nofollow noreferrer\">article</a> to build containers from scratch without using docker just by making use of linux system calls like chroot, unshare, nsenter, etc.</p>\n\n<p>Does docker internally a wrapper around these system calls, it seems like docker exec is not using nsenter as per this <a href=\"https://stackoverflow.com/questions/27873312/docker-exec-versus-nsenter-any-gotchas\">answer</a></p>\n\n<p>If docker is using these calls which golang binary is it using to have these system calls.</p>\n\n<p>Or docker is a wrapper around lxc but it don't seems to me as per this <a href=\"https://unix.stackexchange.com/questions/254956/what-is-the-difference-between-docker-lxd-and-lxc\">answer</a></p>\n\n<p>Can anyone point me out the exact low level stuff (system calls/lxc,etc) that docker is currently using to build a container.</p>\n"}, {"tags": ["go", "networking", "gopacket"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513957259, "post_id": 47943965, "comment_id": 82857527, "body": "What specific problem are you having with your attempted implementation?"}, {"owner": {"reputation": 3121, "user_id": 521957, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5eb7181541d7455a128b552072225521?s=128&d=identicon&r=PG", "display_name": "ilyaigpetrov", "link": "https://stackoverflow.com/users/521957/ilyaigpetrov"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513957581, "post_id": 47943965, "comment_id": 82857672, "body": "@Adrian I&#39;ve answered in the why section"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513957715, "post_id": 47943965, "comment_id": 82857739, "body": "The why section says what you&#39;re trying to do. It doesn&#39;t say anything about what specific problem you&#39;re having with the code you pasted."}, {"owner": {"reputation": 3121, "user_id": 521957, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5eb7181541d7455a128b552072225521?s=128&d=identicon&r=PG", "display_name": "ilyaigpetrov", "link": "https://stackoverflow.com/users/521957/ilyaigpetrov"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513957824, "post_id": 47943965, "comment_id": 82857798, "body": "@Adrian the problem is that I want to get real IP packet on output, the same as was used to create gopacket"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1513958823, "post_id": 47943965, "comment_id": 82858249, "body": "That may be your end goal, but <i>what is the specific problem you&#39;re having with the code you pasted?</i> When you run it, what does it do that doesn&#39;t match with what is intended?"}, {"owner": {"reputation": 3121, "user_id": 521957, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5eb7181541d7455a128b552072225521?s=128&d=identicon&r=PG", "display_name": "ilyaigpetrov", "link": "https://stackoverflow.com/users/521957/ilyaigpetrov"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513959078, "post_id": 47943965, "comment_id": 82858353, "body": "@Adrian I expect hex dump to be a hex dump of a real IP packet, it should start with 45 at least, because this is how IPv4 packets start."}, {"owner": {"reputation": 4989, "user_id": 3745413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jQsNL.png?s=128&g=1", "display_name": "Ron Maupin", "link": "https://stackoverflow.com/users/3745413/ron-maupin"}, "edited": false, "score": 0, "creation_date": 1514014764, "post_id": 47943965, "comment_id": 82870865, "body": "Not all IPv4 packets start with <code>45</code> The IP version must be <code>4</code> for IPv4, but the IHL may be larger than <code>5</code> if the IPv4 packet has options."}], "answers": [{"tags": [], "owner": {"reputation": 3121, "user_id": 521957, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5eb7181541d7455a128b552072225521?s=128&d=identicon&r=PG", "display_name": "ilyaigpetrov", "link": "https://stackoverflow.com/users/521957/ilyaigpetrov"}, "is_accepted": true, "score": 4, "last_activity_date": 1514016711, "last_edit_date": 1514016711, "creation_date": 1514014325, "answer_id": 47950684, "question_id": 47943965, "link": "https://stackoverflow.com/questions/47943965/how-to-serialize-a-modified-go-packet-packet-into-real-ip-packet/47950684#47950684", "title": "How To Serialize A Modified Go Packet Packet Into Real IP Packet", "body": "<p>First, always check returned errors \u2014 it's your feedback:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>err := gopacket.SerializePacket(newBuffer, options, packet)\n// OR\nerr := gopacket.SerializeLayers(newBuffer, options,\n  ip,\n  tcp,\n)\n// THEN\nif err != nil {\n  panic(err)\n}\n</code></pre>\n\n<p>From code above you will get: <code>TCP/IP layer 4 checksum cannot be computed without network layer... call SetNetworkLayerForChecksum to set which layer to use</code></p>\n\n<p>Then, the solution is to use <code>tcp.SetNetworkLayerForChecksum(ip)</code> and the final working code:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport (\n  \"encoding/hex\"\n  \"github.com/google/gopacket\"\n  \"github.com/google/gopacket/layers\"\n  \"fmt\"\n  \"net\"\n)\n\nfunc main() {\n\n  packetData := []byte{\n    69, 0, 0, 63, 64, 237, 64, 0, 64, 6, 74, 221, 192,\n    168, 1, 90, 52, 85, 184, 151, 141, 230, 0, 80,\n    174, 147, 86, 192, 18, 107, 243, 149, 128, 24,\n    0, 229, 92, 65, 0, 0, 1, 1, 8, 10, 22, 138, 85, 109,\n    48, 16, 32, 253, 49, 50, 51, 52, 53, 54, 55, 56,\n    57, 48, 10,\n  }\n\n  fmt.Println(\"Hex dump of real IP packet taken as input:\\n\")\n  fmt.Println(hex.Dump(packetData))\n\n  packet := gopacket.NewPacket(packetData, layers.LayerTypeIPv4, gopacket.Default)\n  if ipLayer := packet.Layer(layers.LayerTypeIPv4); ipLayer != nil {\n    ip := ipLayer.(*layers.IPv4)\n    dst := ip.DstIP.String()\n    src := ip.SrcIP.String()\n\n    if tcpLayer := packet.Layer(layers.LayerTypeTCP); tcpLayer != nil {\n      tcp := tcpLayer.(*layers.TCP)\n      dst = fmt.Sprintf(\"%s:%d\", dst, tcp.DstPort)\n      src = fmt.Sprintf(\"%s:%d\", src, tcp.SrcPort)\n      fmt.Printf(\"From %s to %s\\n\\n\", src, dst)\n\n      ip.DstIP = net.ParseIP(\"8.8.8.8\")\n\n      options := gopacket.SerializeOptions{\n        ComputeChecksums: true,\n        FixLengths: true,\n      }\n\n      tcp.SetNetworkLayerForChecksum(ip)\n\n      newBuffer := gopacket.NewSerializeBuffer()\n      err := gopacket.SerializePacket(newBuffer, options, packet)\n      if err != nil {\n        panic(err)\n      }\n      outgoingPacket := newBuffer.Bytes()\n\n      fmt.Println(\"Hex dump of go packet serialization output:\\n\")\n      fmt.Println(hex.Dump(outgoingPacket))\n\n    }\n\n  }\n\n}\n</code></pre>\n\n<h1>Output</h1>\n\n<pre><code>Hex dump of real IP packet taken as input:\n\n00000000  45 00 00 3f 40 ed 40 00  40 06 4a dd c0 a8 01 5a  |E..?@.@.@.J....Z|\n00000010  34 55 b8 97 8d e6 00 50  ae 93 56 c0 12 6b f3 95  |4U.....P..V..k..|\n00000020  80 18 00 e5 5c 41 00 00  01 01 08 0a 16 8a 55 6d  |....\\A........Um|\n00000030  30 10 20 fd 31 32 33 34  35 36 37 38 39 30 0a     |0. .1234567890.|\n\nFrom 192.168.1.90:36326 to 52.85.184.151:80\n\nHex dump of go packet serialization output:\n\n00000000  45 00 00 3f 40 ed 40 00  40 06 27 ba c0 a8 01 5a  |E..?@.@.@.'....Z|\n00000010  08 08 08 08 8d e6 00 50  ae 93 56 c0 12 6b f3 95  |.......P..V..k..|\n00000020  80 18 00 e5 39 1e 00 00  01 01 08 0a 16 8a 55 6d  |....9.........Um|\n00000030  30 10 20 fd 31 32 33 34  35 36 37 38 39 30 0a     |0. .1234567890.|\n</code></pre>\n\n<p>As you see <code>08 08 08 08</code> is a new IP and payload <code>1234567890\\n</code> is also preserved, IP packet starts with 45 as usual.</p>\n"}], "owner": {"reputation": 3121, "user_id": 521957, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5eb7181541d7455a128b552072225521?s=128&d=identicon&r=PG", "display_name": "ilyaigpetrov", "link": "https://stackoverflow.com/users/521957/ilyaigpetrov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2983, "favorite_count": 2, "accepted_answer_id": 47950684, "answer_count": 1, "score": 1, "last_activity_date": 1514198808, "creation_date": 1513957012, "last_edit_date": 1514198808, "question_id": 47943965, "link": "https://stackoverflow.com/questions/47943965/how-to-serialize-a-modified-go-packet-packet-into-real-ip-packet", "title": "How To Serialize A Modified Go Packet Packet Into Real IP Packet", "body": "<h1>Why</h1>\n\n<p>I want to write a proxy server, proxy server changes IP/port of a packet and emits modified.</p>\n\n<h1>Attempt</h1>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport (\n  \"encoding/hex\"\n  \"github.com/google/gopacket\"\n  \"github.com/google/gopacket/layers\"\n  \"fmt\"\n  \"net\"\n)\n\nfunc main() {\n\n  packetData := []byte{\n    69, 0, 0, 63, 64, 237, 64, 0, 64, 6, 74, 221, 192,\n    168, 1, 90, 52, 85, 184, 151, 141, 230, 0, 80,\n    174, 147, 86, 192, 18, 107, 243, 149, 128, 24,\n    0, 229, 92, 65, 0, 0, 1, 1, 8, 10, 22, 138, 85, 109,\n    48, 16, 32, 253, 49, 50, 51, 52, 53, 54, 55, 56,\n    57, 48, 10,\n  }\n\n  fmt.Println(\"Hex dump of real IP packet taken as input:\\n\")\n  fmt.Println(hex.Dump(packetData))\n\n  packet := gopacket.NewPacket(packetData, layers.LayerTypeIPv4, gopacket.Default)\n  if ipLayer := packet.Layer(layers.LayerTypeIPv4); ipLayer != nil {\n    ip := ipLayer.(*layers.IPv4)\n    dst := ip.DstIP.String()\n    src := ip.SrcIP.String()\n\n    if tcpLayer := packet.Layer(layers.LayerTypeTCP); tcpLayer != nil {\n      tcp := tcpLayer.(*layers.TCP)\n      dst = fmt.Sprintf(\"%s:%d\", dst, tcp.DstPort)\n      src = fmt.Sprintf(\"%s:%d\", src, tcp.SrcPort)\n      fmt.Printf(\"From %s to %s\\n\\n\", src, dst)\n\n      ip.DstIP = net.ParseIP(\"8.8.8.8\")\n\n      options := gopacket.SerializeOptions{\n        ComputeChecksums: true,\n        FixLengths: true,\n      }\n      newBuffer := gopacket.NewSerializeBuffer()\n      gopacket.SerializeLayers(newBuffer, options,\n          ip,\n          tcp,\n      )\n      outgoingPacket := newBuffer.Bytes()\n\n      fmt.Println(\"Hex dump of go packet serialization output:\\n\")\n      fmt.Println(hex.Dump(outgoingPacket))\n\n    }\n\n  }\n\n}\n</code></pre>\n\n<h1>Output</h1>\n\n<pre><code>Hex dump of real IP packet taken as input:\n\n00000000  45 00 00 3f 40 ed 40 00  40 06 4a dd c0 a8 01 5a  |E..?@.@.@.J....Z|\n00000010  34 55 b8 97 8d e6 00 50  ae 93 56 c0 12 6b f3 95  |4U.....P..V..k..|\n00000020  80 18 00 e5 5c 41 00 00  01 01 08 0a 16 8a 55 6d  |....\\A........Um|\n00000030  30 10 20 fd 31 32 33 34  35 36 37 38 39 30 0a     |0. .1234567890.|\n\nFrom 192.168.1.90:36326 to 52.85.184.151:80\n\nHex dump of go packet serialization output:\n\n00000000  8d e6 00 50 ae 93 56 c0  12 6b f3 95 80 18 00 e5  |...P..V..k......|\n00000010  00 00 00 00 01 01 08 0a  16 8a 55 6d 30 10 20 fd  |..........Um0. .|\n</code></pre>\n\n<h1>What's Wrong</h1>\n\n<p>Second hex dump must start with 45 (most IPv4 packets start with 45, where 4 is a version of the protocol). Second hexdump must be identical to the first in many details except one IP address that was changed, TCP checksum and size values. Second hex dump must contain payload <code>1234567890\\n</code>.</p>\n\n<h1>Similar Questions</h1>\n\n<ol>\n<li><a href=\"https://stackoverflow.com/questions/27218989/how-to-use-golang-to-compose-raw-tcp-packet-using-gopacket-and-send-it-via-raw\">How to use Golang to compose raw TCP packet (using gopacket) and send it via raw socket</a></li>\n<li><a href=\"https://stackoverflow.com/questions/38547625/sending-udp-packets-with-gopacket\">Sending UDP packets with gopacket</a></li>\n<li><a href=\"https://stackoverflow.com/questions/28996734/changing-the-ip-address-of-a-gopacket-and-re-transmitting-using-raw-sockets\">Changing the IP address of a Gopacket and re-transmitting using raw sockets\n</a></li>\n</ol>\n"}, {"tags": ["json", "go", "struct", "marshalling", "slice"], "answers": [{"comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1513945120, "post_id": 47941053, "comment_id": 82852106, "body": "Maybe add the unmarshaller to go with it (<code>strconv.Atoi(string(b))</code> and assign that to <code>r.Role</code>)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1513956613, "post_id": 47941053, "comment_id": 82857242, "body": "@EliasVanOotegem I didn&#39;t want to include that as that wasn&#39;t the question, and marshaling <code>Role</code> this way results in data loss (e.g. <code>Role.Id</code> is lost). There is no obvious way to reconstruct <code>Role</code> from the integer only. A viable solution could be using a role registry."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1513956865, "post_id": 47941053, "comment_id": 82857356, "body": "Oh yeah, you&#39;d  lose the Id value for sure (and more over, the role registry would have to be distributed, and discussing that is way out of scope). I just meant to point out that there is a <code>json.Unmarshaller</code> interface to match the <code>json.Marshaller</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1513943421, "creation_date": 1513943421, "answer_id": 47941053, "question_id": 47940943, "link": "https://stackoverflow.com/questions/47940943/marshal-slice-of-structs-as-slice-of-numbers/47941053#47941053", "title": "Marshal slice of structs as slice of numbers", "body": "<p>You can implement any custom marshaling logic by implementing the <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\"><code>json.Marshaler</code></a> interface.</p>\n\n<p>So simply implement the <code>MarshalJSON() ([]byte, error)</code> method on <code>Role</code>, in which you marshal it like a simple <code>int</code> number.</p>\n\n<p>This is how it could look like:</p>\n\n<pre><code>func (r Role) MarshalJSON() ([]byte, error) {\n    return json.Marshal(r.Role)\n}\n</code></pre>\n\n<p>As you can see, <code>Role.MarshalJSON()</code> only marshals the <code>Role.Role</code> <code>int</code> field, and not the whole <code>struct</code>.</p>\n\n<p>Testing it:</p>\n\n<pre><code>u := User{\n    Id: \"abc\",\n    Roles: []Role{\n        Role{Id: \"a\", Role: 1},\n        Role{Id: \"b\", Role: 2},\n        Role{Id: \"c\", Role: 3},\n    },\n}\nif err := json.NewEncoder(os.Stdout).Encode(u); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Output is as you expect it (try it on the <a href=\"https://play.golang.org/p/sAhMOKA8q0D\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{\"id\":\"abc\",\"roles\":[1,2,3]}\n</code></pre>\n"}], "owner": {"reputation": 1472, "user_id": 282882, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/064cf2ac71f78d338e73dda6485b2477?s=128&d=identicon&r=PG", "display_name": "rzajac", "link": "https://stackoverflow.com/users/282882/rzajac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 587, "favorite_count": 1, "accepted_answer_id": 47941053, "answer_count": 1, "score": 3, "last_activity_date": 1513943559, "creation_date": 1513942961, "last_edit_date": 1513943559, "question_id": 47940943, "link": "https://stackoverflow.com/questions/47940943/marshal-slice-of-structs-as-slice-of-numbers", "title": "Marshal slice of structs as slice of numbers", "body": "<p>I'm trying to figure out what is the best way to marshal to JSON string below structure:</p>\n\n<pre><code>type User struct {\n    Id string    `json:\"id\"`\n    Roles []Role `json:\"roles\"`\n}\n\ntype Role struct {\n    Id string    `json:\"-\"`\n    Role int     \n}\n</code></pre>\n\n<p>Get JSON output like: <code>{\"id\": \"abc\", \"roles\": [1, 2, 3]}</code></p>\n"}, {"tags": ["go", "error-handling"], "comments": [{"owner": {"reputation": 2904, "user_id": 731931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3116de43059d7ea110181a5bb773bcdd?s=128&d=identicon&r=PG", "display_name": "xs0", "link": "https://stackoverflow.com/users/731931/xs0"}, "edited": false, "score": 8, "creation_date": 1513942571, "post_id": 47940805, "comment_id": 82850906, "body": "It&#39;s probably just saying that you don&#39;t use the <code>err</code> variable later, after setting it to nil, so you might just as well not make it nil, and only set passwordLastUsed"}, {"owner": {"reputation": 109, "user_id": 1577868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I7SGs.jpg?s=128&g=1", "display_name": "jonhadfield", "link": "https://stackoverflow.com/users/1577868/jonhadfield"}, "reply_to_user": {"reputation": 2904, "user_id": 731931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3116de43059d7ea110181a5bb773bcdd?s=128&d=identicon&r=PG", "display_name": "xs0", "link": "https://stackoverflow.com/users/731931/xs0"}, "edited": false, "score": 0, "creation_date": 1513943402, "post_id": 47940805, "comment_id": 82851304, "body": "To add some context, &#39;err&#39; is a named return from the function this snippet sits in. I do use it elsewhere in the function and immediately return it when a function it calls doesn&#39;t return a non nil value."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513943469, "post_id": 47940805, "comment_id": 82851337, "body": "You may use it elsewhere, but you are unconditionally setting it before checking it again--otherwise you wouldn&#39;t get that warning."}, {"owner": {"reputation": 109, "user_id": 1577868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I7SGs.jpg?s=128&g=1", "display_name": "jonhadfield", "link": "https://stackoverflow.com/users/1577868/jonhadfield"}, "edited": false, "score": 0, "creation_date": 1513945195, "post_id": 47940805, "comment_id": 82852142, "body": "Not sure what you mean. I&#39;m only resetting it &#39;if&#39; the time.Parse function returns an error. If I don&#39;t reset it and I reach the final return, I&#39;ll return an error to the calling function."}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 1577868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I7SGs.jpg?s=128&g=1", "display_name": "jonhadfield", "link": "https://stackoverflow.com/users/1577868/jonhadfield"}, "edited": false, "score": 0, "creation_date": 1513945317, "post_id": 47940975, "comment_id": 82852216, "body": "That makes sense, thanks. I am using it later, so I think the linter is incorrect in this specific case."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 109, "user_id": 1577868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I7SGs.jpg?s=128&g=1", "display_name": "jonhadfield", "link": "https://stackoverflow.com/users/1577868/jonhadfield"}, "edited": false, "score": 0, "creation_date": 1513945448, "post_id": 47940975, "comment_id": 82852295, "body": "No, the linter is correct. You may be using it later, but only after it&#39;s being unconditionally reset again."}, {"owner": {"reputation": 109, "user_id": 1577868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I7SGs.jpg?s=128&g=1", "display_name": "jonhadfield", "link": "https://stackoverflow.com/users/1577868/jonhadfield"}, "edited": false, "score": 1, "creation_date": 1513946195, "post_id": 47940975, "comment_id": 82852652, "body": "Ok, I understand now. I added another check &quot;if err != nil&quot; immediately after that snippet and it was no longer repeated as ineffectual. As you said, because err was always equal to nil after that piece of code, and the next piece of code reset the value of err, it really was ineffectual."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 16, "last_activity_date": 1513952212, "last_edit_date": 1513952212, "creation_date": 1513943080, "answer_id": 47940975, "question_id": 47940805, "link": "https://stackoverflow.com/questions/47940805/is-it-bad-practice-to-reset-an-error-in-golang/47940975#47940975", "title": "Is it bad practice to reset an error in golang?", "body": "<p>It's not bad practice to reset an error variable, if that's what you want to do.</p>\n\n<p>It is bad practice to set variables that aren't used later--and that's what the warning is about.</p>\n\n<p>There's probably never a reason to reset an error <em>as you are doing</em>, since after the <code>if</code> block <code>err</code> will <em>always</em> be <code>nil</code>.</p>\n\n<p>It does make sense if you're only resetting in some cases. A common example:</p>\n\n<pre><code>result, err := db.Query(...)\nif err == sql.ErrNoRows {\n    err = nil // Ignore not-found rows\n}\nif err != nil {\n    return err // But return all other errors\n}\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 1577868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I7SGs.jpg?s=128&g=1", "display_name": "jonhadfield", "link": "https://stackoverflow.com/users/1577868/jonhadfield"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11198, "favorite_count": 2, "accepted_answer_id": 47940975, "answer_count": 1, "score": 8, "last_activity_date": 1513952212, "creation_date": 1513942359, "question_id": 47940805, "link": "https://stackoverflow.com/questions/47940805/is-it-bad-practice-to-reset-an-error-in-golang", "title": "Is it bad practice to reset an error in golang?", "body": "<p>When parsing a string as text, I want any non-parseable string to result in a zero time and then carry on.</p>\n\n<pre><code>passwordLastUsed, err = time.Parse(time.RFC3339, record[lastUsed])\nif err != nil {\n    err = nil\n    passwordLastUsed = time.Time{}\n}\n</code></pre>\n\n<p>This code looks a bit messy and the 'ineffassign' linter returns this for the 'err = nil' statement:</p>\n\n<blockquote>\n  <p>warning: ineffectual assignment to err (ineffassign)</p>\n</blockquote>\n\n<p>Is there a better way of handling this or should I just ignore the linter?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 7, "last_activity_date": 1612523998, "last_edit_date": 1612523998, "creation_date": 1513942250, "answer_id": 47940781, "question_id": 47940761, "link": "https://stackoverflow.com/questions/47940761/unable-to-run-tests-on-the-terminal/47940781#47940781", "title": "Unable to run tests on the terminal", "body": "<p>Your error message explains the problem exactly:</p>\n<blockquote>\n<p>can't load package: package crypto-compare-go: found packages main (main.go) and handler (main_test.go) in /Users/pocockn/go/src/crypto-compare-go</p>\n</blockquote>\n<p>You have two package declarations in the same package. This is invalid.</p>\n<p><code>main.go</code> has:</p>\n<pre><code>package main\n</code></pre>\n<p>and <code>main_test.go</code> has:</p>\n<pre><code>package handler\n</code></pre>\n<p>Make them match.</p>\n<p>As a special case, if you desire your tests to run in a separate pacakge (i.e. so that you can test the public API, without access to internals), you can name your test package <code>main_test</code>, but this must match the other package name, suffixed with <code>_test</code>.</p>\n"}], "owner": {"reputation": 1591, "user_id": 7304216, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7948f2563d2a2d276561b3a05c357150?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Pocock", "link": "https://stackoverflow.com/users/7304216/nick-pocock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 0, "answer_count": 1, "score": -6, "last_activity_date": 1612523998, "creation_date": 1513942153, "last_edit_date": 1612523925, "question_id": 47940761, "link": "https://stackoverflow.com/questions/47940761/unable-to-run-tests-on-the-terminal", "title": "Unable to run tests on the terminal", "body": "<p>I am attempting to add my Go project to CircleCi for CI. However when it gets to the testing stage I get some errors. I've then tried to run 'go test' locally on my terminal in the Go project and I get the following error.</p>\n<blockquote>\n</blockquote>\n<p>can't load package: package crypto-compare-go: found packages main (main.go) and handler (main_test.go) in /Users/pocockn/go/src/crypto-compare-go</p>\n<p>crypto-compare-go is the name of the parent folder that holds the Go program. It is under</p>\n<blockquote>\n<p>go &gt; src &gt;</p>\n</blockquote>\n<p>On my machine.</p>\n<p>Below is how my project is structured.</p>\n<p><a href=\"https://i.stack.imgur.com/yzfMM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/yzfMM.png\" alt=\"enter image description here\" /></a></p>\n<p>I just want to run go test and it run the tests in my project. I've also tried go test ./... but get the same problem</p>\n"}, {"tags": ["multithreading", "pointers", "go", "unsafe"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1513942008, "post_id": 47940394, "comment_id": 82850624, "body": "Your code is racy thus undefined. You <i>must</i> <i>not</i> write to the same variable concurrently. No arguing."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1513949864, "post_id": 47940394, "comment_id": 82854375, "body": "When using concurrency, always run tests with race detector (<code>go test -race</code>), because you have potential concurrent assignments to the same pointer, and that&#39;s bad. This is exactly why golang has things like <code>select</code>, channels and the <code>sync</code> package containing useful ditties like <code>sync.Mutex</code>. Also: <code>var p *Point = nil</code> can be shortened to <code>var p *Point</code>"}, {"owner": {"reputation": 11, "user_id": 9130493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d80ae9c4bf4004287adb56b2f5bfcee6?s=128&d=identicon&r=PG&f=1", "display_name": "san yue", "link": "https://stackoverflow.com/users/9130493/san-yue"}, "edited": false, "score": 0, "creation_date": 1514021972, "post_id": 47940394, "comment_id": 82872219, "body": "thank you . I now know how to deal with this problem. The consequences of such behavior are not clear at present. The entire application is suspended, there is no response, which is not conducive to find the problem."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1514123726, "post_id": 47940394, "comment_id": 82891443, "body": "You have 2 busy loops in your code. That\u2019s going to cause problems regardless of race conditions."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9130493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d80ae9c4bf4004287adb56b2f5bfcee6?s=128&d=identicon&r=PG&f=1", "display_name": "san yue", "link": "https://stackoverflow.com/users/9130493/san-yue"}, "edited": false, "score": 0, "creation_date": 1514021177, "post_id": 47941468, "comment_id": 82872076, "body": "thanks .Your understanding is very good, I now know how to deal with this problem. What I want to say is that the consequences of such behavior are unpredictable at this time if there is competition. However, the entire application is suspended, with no response, which is not good for handling the problem."}, {"owner": {"reputation": 11, "user_id": 9130493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d80ae9c4bf4004287adb56b2f5bfcee6?s=128&d=identicon&r=PG&f=1", "display_name": "san yue", "link": "https://stackoverflow.com/users/9130493/san-yue"}, "edited": false, "score": 0, "creation_date": 1514022103, "post_id": 47941468, "comment_id": 82872241, "body": "time.Sleep  just solve the probability of error, and can not solve the problem. locker  is a viable option"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 11, "user_id": 9130493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d80ae9c4bf4004287adb56b2f5bfcee6?s=128&d=identicon&r=PG&f=1", "display_name": "san yue", "link": "https://stackoverflow.com/users/9130493/san-yue"}, "edited": false, "score": 0, "creation_date": 1514024484, "post_id": 47941468, "comment_id": 82872662, "body": "Yes, that&#39;s why I mention locking is the correct approach (as also implied in @Volker comments). The above code also serves to demonstrate the perils of not using proper synchronization primitives."}], "tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 1, "last_activity_date": 1514024754, "last_edit_date": 1514024754, "creation_date": 1513945276, "answer_id": 47941468, "question_id": 47940394, "link": "https://stackoverflow.com/questions/47940394/go-pointer-multi-thread-read-and-write-errors/47941468#47941468", "title": "Go pointer multi-thread read and write errors", "body": "<p>The issue is not just that there's a race, but something gets screwed with scheduling when there is a race. The following code has some of the options which will make this code produce the desired output (it's commented). So you either:</p>\n\n<ol>\n<li>add a lock which will fix the race conditions [the correct way] </li>\n</ol>\n\n<p>OR</p>\n\n<ol start=\"2\">\n<li>add a small sleep to each of the racing routines - race continues to be there</li>\n</ol>\n\n<p>This code </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"sync\"\n    \"time\"\n)\n\ntype Point struct {\n    X int\n    Y int\n}\n\nvar lock sync.Mutex\n\nfunc main() {\n    // runtime.GOMAXPROCS(4)\n    fmt.Println(\"Max # of parallel processes = \", MaxParallelism())\n\n    var p *Point = nil\n    test := true\n    go func() {\n        for test {\n            // lock.Lock()\n            if tmp := p; tmp == nil {\n                p = &amp;Point{}\n            }\n            // lock.Unlock()\n            // time.Sleep(1 * time.Nanosecond)\n\n        }\n    }()\n    go func() {\n        for test {\n            // lock.Lock()\n            if tmp := p; tmp != nil {\n                p = nil\n            }\n            // lock.Unlock()\n            // time.Sleep(1 * time.Nanosecond)\n        }\n    }()\n\n    n := 0\n    for test {\n        n++\n        fmt.Printf(\"testing%v....\\r\\n\", n)\n        time.Sleep(1000 * time.Millisecond)\n    }\n\n    fmt.Printf(\"test fail\")\n}\n\nfunc MaxParallelism() int {\n    maxProcs := runtime.GOMAXPROCS(0)\n    numCPU := runtime.NumCPU()\n    if maxProcs &lt; numCPU {\n        return maxProcs\n    }\n    return numCPU\n}\n</code></pre>\n\n<p>Output (on my machine. Please note # of goroutines should be equal or less than the # of virtual processesors for possible parallel computing):</p>\n\n<pre><code>go run main.go \nMax # of parallel processes =  4\ntesting1....\n</code></pre>\n\n<p>Inspite of the fact that there are 4 virtual processors the issue seems to be that main never gets scheduled after the first sleep. Apparently when there's a race condition this is somehow inexplicably (atleast for me) rearing it's ugly head. Another observation is that if we reduce one of the two goroutines and also go on to modify the p variable in main's loop, then it works. All this seems to give an impression that the behaviour of the runtime processing is  unpredictable when there are race conditions.</p>\n"}], "owner": {"reputation": 11, "user_id": 9130493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d80ae9c4bf4004287adb56b2f5bfcee6?s=128&d=identicon&r=PG&f=1", "display_name": "san yue", "link": "https://stackoverflow.com/users/9130493/san-yue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1514024754, "creation_date": 1513940460, "last_edit_date": 1513941286, "question_id": 47940394, "link": "https://stackoverflow.com/questions/47940394/go-pointer-multi-thread-read-and-write-errors", "title": "Go pointer multi-thread read and write errors", "body": "<p>Normal should be constant output</p>\n\n<pre><code>test1\ntest2\n........\n</code></pre>\n\n<p>But only test1 output, the program hung up, there is no response\nThe assignment of the pointer is the most basic operation, this should be thread-safe to meet the period\nBut this test has not been able to</p>\n\n<pre><code>type Point struct {\n    X int\n    Y int\n}\n\nfunc main() {\n    var p *Point = nil\n    test := true\n    go func() {\n        for test {\n            if tmp := p; tmp == nil {\n                p = &amp;Point{}\n            }\n        }\n    }()\n    go func() {\n        for test {\n            if tmp := p; tmp != nil {\n                p = nil\n            }\n        }\n    }()\n\n    n := 0\n    for test {\n        n++\n        fmt.Printf(\"testing%v....\\r\\n\",n)\n        time.Sleep(1000 * time.Millisecond)\n    }\n\n    fmt.Printf(\"test fail\")\n}\n</code></pre>\n\n<p>code:\n<a href=\"https://play.golang.org/p/-NTq-2iyX5W\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-NTq-2iyX5W</a></p>\n\n<p>if change pointer to int, this is good</p>\n\n<pre><code>func main() {\n    var p int = 0\n    test := true\n    go func() {\n        for test {\n            if tmp := p; tmp == 0 {\n                p = 1\n            }\n        }\n    }()\n    go func() {\n        for test {\n            if tmp := p; tmp != 0 {\n                p = 0\n            }\n        }\n    }()\n\n    n := 0\n    for test {\n        n++\n        fmt.Printf(\"testing%v....\\r\\n\",n)\n        time.Sleep(1000 * time.Millisecond)\n    }\n\n    fmt.Printf(\"test fail\")\n}\n</code></pre>\n"}, {"tags": ["maven", "go", "maven-metadata"], "comments": [{"owner": {"reputation": 27024, "user_id": 774183, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/1a319d488294dc382be41fa8226e71c3?s=128&d=identicon&r=PG", "display_name": "carlspring", "link": "https://stackoverflow.com/users/774183/carlspring"}, "edited": false, "score": 0, "creation_date": 1516126960, "post_id": 47940380, "comment_id": 83559963, "body": "What version of Maven is this? Do you have a sample <code>pom.xml</code> and very basic app that you could show this with?"}, {"owner": {"reputation": 693, "user_id": 1802697, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eH3MJ.jpg?s=128&g=1", "display_name": "Igor Maznitsa", "link": "https://stackoverflow.com/users/1802697/igor-maznitsa"}, "edited": false, "score": 0, "creation_date": 1527930677, "post_id": 47940380, "comment_id": 88320697, "body": "since 2.1.8 version there was improved compatibility with standard install and deploy goals"}], "owner": {"reputation": 1, "user_id": 9130685, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-P21B9eefiBU/AAAAAAAAAAI/AAAAAAAADMg/dTYj6Az88bQ/photo.jpg?sz=128", "display_name": "Valentin Lavrinenko", "link": "https://stackoverflow.com/users/9130685/valentin-lavrinenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1513940422, "creation_date": 1513940422, "question_id": 47940380, "link": "https://stackoverflow.com/questions/47940380/maven-doesnt-upload-maven-metadata-xml-with-mvn-golang-wrapper-plugin", "title": "Maven doesn&#39;t upload maven-metadata.xml with mvn-golang-wrapper plugin", "body": "<p>I use <a href=\"https://github.com/raydac/mvn-golang\" rel=\"nofollow noreferrer\">mvn-golang-wrapper</a> plugin to build binary for Go project, and <em>maven-assembly-plugin</em> to pack that binary and some related files to a <em>.tar.gz</em> artifact. To make <em>mvn-golang-wrapper</em> work, I specify <code>&lt;packaging&gt;mvn-golang&lt;/packaging&gt;</code> in my <em>pom.xml</em>.</p>\n\n<p>The issue is that with <code>&lt;packaging&gt;mvn-golang&lt;/packaging&gt;</code>, when Maven uploads the <em>.tar.gz</em> to the artifactory, it doesn't create nor update <em>maven-metadata.xml</em> there. If I remove the <code>&lt;packaging&gt;</code> tag, <em>maven-metadata.xml</em> gets created, but, of course, Go binary doesn't get built.</p>\n\n<p>Just in case, Maven is being run on TeamCity CI.</p>\n"}, {"tags": ["go", "hyperledger-fabric", "vendor"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1513930983, "post_id": 47938005, "comment_id": 82845222, "body": "Your guess i right. Must change code."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1513951577, "post_id": 47938005, "comment_id": 82855121, "body": "This is why it&#39;s dangerous for libraries to do this sort of thing in <code>init</code> functions. They should only register handlers when you explicitly tell them to."}, {"owner": {"reputation": 311, "user_id": 5820951, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fae089cafa3154d92231b4321ef7111a?s=128&d=identicon&r=PG&f=1", "display_name": "Chalex", "link": "https://stackoverflow.com/users/5820951/chalex"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1514040512, "post_id": 47938005, "comment_id": 82876121, "body": "Thank you. @Volker @Adrian. I found the reason. It&#39;s because of the <code>golang.org&#47;x&#47;net&#47;trace</code> project. In it&#39;s <code>init()</code> function, they handle the <code>debug&#47;request</code> with hard code. So if two projects both import that library, then there is a conflict."}], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 10414882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fb7e0ce8eda2553909afb013c208821?s=128&d=identicon&r=PG&f=1", "display_name": "anisbhsl", "link": "https://stackoverflow.com/users/10414882/anisbhsl"}, "edited": false, "score": 0, "creation_date": 1594798646, "post_id": 47968885, "comment_id": 111248986, "body": "The cause of issue is as explained by @chalex above. The temporary fix for me was to comment out the <code>init()</code> method inside the <code>$GOPATH&#47;pkg&#47;mod&#47;&lt;mypackage&gt;&#47;Godeps&#47;_&#47;x&#47;net&#47;trace&#47;trace.go</code>"}], "tags": [], "owner": {"reputation": 311, "user_id": 5820951, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fae089cafa3154d92231b4321ef7111a?s=128&d=identicon&r=PG&f=1", "display_name": "Chalex", "link": "https://stackoverflow.com/users/5820951/chalex"}, "is_accepted": true, "score": 9, "last_activity_date": 1514206722, "creation_date": 1514206722, "answer_id": 47968885, "question_id": 47938005, "link": "https://stackoverflow.com/questions/47938005/panic-http-multiple-registrations-for-debug-requests/47968885#47968885", "title": "panic: http: multiple registrations for /debug/requests", "body": "<p>I found the reason. It's because of the <code>golang.org/x/net/trace</code> project. In it's <code>init()</code> function, they handle the <code>debug/request</code> with hard code. So if two projects both import that library, then there is a conflict.</p>\n"}, {"comments": [{"owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "edited": false, "score": 0, "creation_date": 1543404574, "post_id": 50520887, "comment_id": 93905419, "body": "Does anyone know a way to figure out WHAT package is responsible for the &quot;double&quot; vendoring?"}], "tags": [], "owner": {"reputation": 1220, "user_id": 2578409, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003551172293/picture?type=large", "display_name": "Bruce", "link": "https://stackoverflow.com/users/2578409/bruce"}, "is_accepted": false, "score": 5, "last_activity_date": 1538055080, "last_edit_date": 1538055080, "creation_date": 1527217283, "answer_id": 50520887, "question_id": 47938005, "link": "https://stackoverflow.com/questions/47938005/panic-http-multiple-registrations-for-debug-requests/50520887#50520887", "title": "panic: http: multiple registrations for /debug/requests", "body": "<p>More than one project used <code>golang.org/x/net/trace</code>, and some project saved <code>golang.org/x/net/trace</code> in its <code>vendor</code> directory, so that is causing the conflict. Fix the conflict by deleting others and only leaving one,then the problem will be solved.</p>\n"}], "owner": {"reputation": 311, "user_id": 5820951, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fae089cafa3154d92231b4321ef7111a?s=128&d=identicon&r=PG&f=1", "display_name": "Chalex", "link": "https://stackoverflow.com/users/5820951/chalex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5861, "favorite_count": 4, "accepted_answer_id": 47968885, "answer_count": 2, "score": 9, "last_activity_date": 1543404372, "creation_date": 1513930469, "last_edit_date": 1526144818, "question_id": 47938005, "link": "https://stackoverflow.com/questions/47938005/panic-http-multiple-registrations-for-debug-requests", "title": "panic: http: multiple registrations for /debug/requests", "body": "<p>I vendored two projects in my go project. And I successfully compiled my project. When I ran my project, it reported error <code>\"panic: http: multiple registrations for /debug/requests\"</code>. The detailed errors is shown below.</p>\n\n<pre><code>goroutine 1 [running]:\nnet/http.(*ServeMux).Handle(0x19ae000, 0x126bb20, 0xf, 0x1964540, 0x1297d90)\n/usr/local/go/src/net/http/server.go:2270 +0x627\nnet/http.(*ServeMux).HandleFunc(0x19ae000, 0x126bb20, 0xf, 0x1297d90)\n/usr/local/go/src/net/http/server.go:2302 +0x55\nnet/http.HandleFunc(0x126bb20, 0xf, 0x1297d90)\n/usr/local/go/src/net/http/server.go:2314 +0x4b\ngithub.own.com/chalex/testfabric/vendor/github.com/hyperledger/fabric-sdk-go/vendor/golang.org/x/net/trace.init.0()\n/home/chalex/ibm/src/github.own.com/chalex/testfabric/vendor/github.com/hyperledger/fabric-sdk-go/vendor/golang.org/x/net/trace/trace.go:115 +0x42\ngithub.own.com/chalex/testfabric/vendor/github.com/hyperledger/fabric-sdk-go/vendor/golang.org/x/net/trace.init()\n&lt;autogenerated&gt;:1 +0x1cd\ngithub.own.com/chalex/testfabric/vendor/github.com/hyperledger/fabric-sdk-go/vendor/google.golang.org/grpc.init()\n&lt;autogenerated&gt;:1 +0x82\ngithub.own.com/chalex/testfabric/vendor/github.com/hyperledger/fabric-sdk-go/third_party/github.com/hyperledger/fabric/protos/peer.init()\n&lt;autogenerated&gt;:1 +0x6f\ngithub.own.com/chalex/testfabric/vendor/github.com/hyperledger/fabric-sdk-go/api/apitxn.init()\n&lt;autogenerated&gt;:1 +0x44\ngithub.own.com/chalex/testfabric/chaincode/client.init()\n&lt;autogenerated&gt;:1 +0x49\nmain.init()\n</code></pre>\n\n<p>Does anyone have any idea on how to fix it? I guess it's because the two projects I imported both listen on <code>/debug/requests</code>?</p>\n"}, {"tags": ["go", "design-patterns"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 8, "creation_date": 1513929932, "post_id": 47937857, "comment_id": 82844859, "body": "What is your threat model? Who are you protecting against? If somebody can read your process memory you already lost."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1513932292, "post_id": 47937857, "comment_id": 82845768, "body": "If you&#39;re worried about memory corruption at the hardware level, the solution is more fault-tolerant hardware, not different software."}, {"owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 1, "creation_date": 1513933778, "post_id": 47937857, "comment_id": 82846439, "body": "Your question does not apply to Go, but to any language. If you are worried of someone being able to read program memory read it each time you need it. If you are not worried about that because the OS already gives you that guarranty then load and forget. The question is not if Golang is safe, but if your system is safe against this kind of attack."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1513952029, "post_id": 47937857, "comment_id": 82855326, "body": "&quot;Is Go safe enough&quot; is a meaningless question - it is no more or less &quot;safe&quot; in this regard than any other language. Memory is memory, how secure it is has nothing to do with what language the binary that allocated it is written in."}], "answers": [{"tags": [], "owner": {"reputation": 483, "user_id": 9042843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d3c6cd6044d8d1ba7e4968fb0a1b2c5?s=128&d=identicon&r=PG", "display_name": "Nathan", "link": "https://stackoverflow.com/users/9042843/nathan"}, "is_accepted": true, "score": 2, "last_activity_date": 1513963462, "creation_date": 1513963462, "answer_id": 47945197, "question_id": 47937857, "link": "https://stackoverflow.com/questions/47937857/whats-best-practice-for-loading-keys-in-a-go-web-app/47945197#47945197", "title": "Whats best practice for loading keys in a Go web app?", "body": "<p>What you're probably looking for is called a Hardware Security Module (HSM). With AWS and Google Cloud the HSM is wrapped and access is provided via a Key Management Service API.</p>\n\n<p>This essentially separates your keys from your server in a similar way a Yubikey affords protection for laptop/desktop encryption keys.</p>\n\n<p>AWS provides both \"CloudHSM\" and \"KMS\";</p>\n\n<ul>\n<li><a href=\"https://aws.amazon.com/cloudhsm/\" rel=\"nofollow noreferrer\">https://aws.amazon.com/cloudhsm/</a></li>\n<li><a href=\"https://aws.amazon.com/kms/\" rel=\"nofollow noreferrer\">https://aws.amazon.com/kms/</a></li>\n<li><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/kms/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/kms/</a></li>\n</ul>\n\n<p>Google Cloud provides \"Cloud KMS\"</p>\n\n<ul>\n<li><a href=\"https://cloud.google.com/kms/\" rel=\"nofollow noreferrer\">https://cloud.google.com/kms/</a></li>\n<li><a href=\"https://cloud.google.com/kms/docs/reference/libraries#client-libraries-install-go\" rel=\"nofollow noreferrer\">https://cloud.google.com/kms/docs/reference/libraries#client-libraries-install-go</a></li>\n</ul>\n\n<p>If you use these services it means you submit raw data to the API and receive back encrypted data or to decrypt submit the encrypted data. In practise this limits the ability of an attacker to steal your keys, offsite the data, and decrypt in bulk. Access Control is managed through IAM. If your sites compromised they can still decrypt the data on the compromised servers which requires that you monitor \"normal\" behaviour for KMS requests. It doesn't eliminate the threat but it can help minimise the impact.</p>\n"}], "owner": {"reputation": 330, "user_id": 4262249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WJRFp.jpg?s=128&g=1", "display_name": "Charles Kenney", "link": "https://stackoverflow.com/users/4262249/charles-kenney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "closed_date": 1514288224, "accepted_answer_id": 47945197, "answer_count": 1, "score": -3, "last_activity_date": 1513963462, "creation_date": 1513929779, "question_id": 47937857, "link": "https://stackoverflow.com/questions/47937857/whats-best-practice-for-loading-keys-in-a-go-web-app", "closed_reason": "Needs details or clarity", "title": "Whats best practice for loading keys in a Go web app?", "body": "<p>I usually worry about memory corruption with leaving my public and private keys in memory for access throughout my applications. I'm very new to Go and I'm wondering what the best practice is for making these keys available.</p>\n\n<p>Is Go safe enough that I should be able to store these in memory, no problem. Or should I only keep my public key in memory for validation and load my private key every time I need to sign a token?</p>\n"}, {"tags": ["mysql", "google-app-engine", "go", "google-cloud-sql", "app-engine-flexible"], "comments": [{"owner": {"reputation": 16516, "user_id": 1133291, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/538bd3553b7540f411a84101e4cbf294?s=128&d=identicon&r=PG", "display_name": "Gal Ben-Haim", "link": "https://stackoverflow.com/users/1133291/gal-ben-haim"}, "edited": false, "score": 0, "creation_date": 1513971454, "post_id": 47936867, "comment_id": 82863024, "body": "is the Cloud SQL proxy running on your Flexible instance? are you using a custom Dockerfile? please provide more information...."}, {"owner": {"reputation": 33, "user_id": 7446098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/964e1cacb8a793a33fd0ba517bc338e4?s=128&d=identicon&r=PG&f=1", "display_name": "Mudit", "link": "https://stackoverflow.com/users/7446098/mudit"}, "reply_to_user": {"reputation": 16516, "user_id": 1133291, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/538bd3553b7540f411a84101e4cbf294?s=128&d=identicon&r=PG", "display_name": "Gal Ben-Haim", "link": "https://stackoverflow.com/users/1133291/gal-ben-haim"}, "edited": false, "score": 0, "creation_date": 1514379213, "post_id": 47936867, "comment_id": 82953233, "body": "@Gal Ben-Haim : yes the Cloud SQL proxy is running on my Flexible instance (as I am not doing anything innovative but just following the documentation religiously) . Do let me know if there is a way to verify if Cloud SQL proxy is running or not .   No , I am not using any custom docker file."}], "owner": {"reputation": 33, "user_id": 7446098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/964e1cacb8a793a33fd0ba517bc338e4?s=128&d=identicon&r=PG&f=1", "display_name": "Mudit", "link": "https://stackoverflow.com/users/7446098/mudit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 199, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1513941804, "creation_date": 1513924323, "last_edit_date": 1513941804, "question_id": 47936867, "link": "https://stackoverflow.com/questions/47936867/mysql-connection-issue-while-deploying-go-code-in-google-app-engine-flexible-en", "title": "Mysql Connection Issue while deploying GO code in Google App Engine (Flexible Environment)", "body": "<p>I am facing Mysql Connection issue , while migrating my code from Standard Environment to the Flexible Environment ( Google App Engine) . </p>\n\n<p>I have even tried following : <a href=\"https://cloud.google.com/appengine/docs/flexible/go/using-cloud-sql\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/flexible/go/using-cloud-sql</a></p>\n\n<p>Stackoverflow link :\n<a href=\"https://stackoverflow.com/questions/40943098/connecting-to-cloudsql-from-app-engine-second-generation-cloudsql-go/47926441#4792644\">Connecting to CloudSQL from App Engine (Second Generation CloudSQL) GO</a></p>\n\n<p>But still not able to solve the issue . My case is :</p>\n\n<p>I have even tried deploying the code given in above stackoverflow link (with my Cloud Sql) to test if it works . But in every case I am getting an error saying :</p>\n\n<pre><code>dial unix /cloudsql/butter-142812:us-central1:test: connect: no such file or directory\n\nWhere for me dbInstanceName  = butter-142812:us-central1:test\n</code></pre>\n\n<p>But everytime I am hitting the same problem . Can you please point out if I am missing something ?</p>\n\n<p>I trying to deploy my app on Flexible Environment .</p>\n"}, {"tags": ["go", "memory", "memory-leaks", "profiling", "pprof"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1513898928, "post_id": 47934028, "comment_id": 82837431, "body": "A memory leak is almost always created by goroutines that don&#39;t return, and profiling your allocations isn&#39;t going to tell you where goroutines didn&#39;t return. The first thing to look at would be a stack trace."}, {"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513899225, "post_id": 47934028, "comment_id": 82837529, "body": "thanks @JimB, sounds like wise advice"}, {"owner": {"reputation": 926, "user_id": 2760325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0acf8a8895f6f9da5c0f202e8975a61d?s=128&d=identicon&r=PG", "display_name": "Ahmed Essam", "link": "https://stackoverflow.com/users/2760325/ahmed-essam"}, "edited": false, "score": 3, "creation_date": 1513932756, "post_id": 47934028, "comment_id": 82845974, "body": "1.371 GB is the virtual memory, not the real memory usage of your binary. For more info check out <a href=\"https://serverfault.com/questions/138427/top-what-does-virtual-memory-size-mean-linux-ubuntu\" title=\"top what does virtual memory size mean linux ubuntu\">serverfault.com/questions/138427/&hellip;</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1513951849, "post_id": 47934028, "comment_id": 82855247, "body": "Note the line <code>Showing nodes accounting for 17608.45kB, 100% of 17608.45kB total</code>. A remote profile like this takes samples for a certain period, I believe the default is 30 seconds. It will only show memory allocations <i>during the monitoring period</i>; you won&#39;t see a total equal to the total memory usage of the application. If it kept a record of every allocation since the app started, memory usage would be much, much higher just to store it."}, {"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513951981, "post_id": 47934028, "comment_id": 82855302, "body": "this is a very important insight I get from this @Adrian, thank you very much"}, {"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513952361, "post_id": 47934028, "comment_id": 82855471, "body": "@Adrian do you know how I could get more samples over time? Is querying via <code>top</code> inside the <code>go tool pprof</code> process ok or should I restart <code>go tool pprof</code> several times?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1513957168, "post_id": 47934028, "comment_id": 82857487, "body": "Per <code>go tool pprof -help</code>, you can pass <code>-seconds Duration for time-based profile collection</code> to control how long it gathers samples for profiling."}], "owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1861, "favorite_count": 3, "answer_count": 0, "score": 1, "last_activity_date": 1513929453, "creation_date": 1513898529, "last_edit_date": 1513929453, "question_id": 47934028, "link": "https://stackoverflow.com/questions/47934028/pprof-usage-and-interpretation", "title": "pprof usage and interpretation", "body": "<p>We believe our go app has a memory leak.</p>\n\n<p>In order to find out what's going on, we are trying with <code>pprof</code>.</p>\n\n<p>We are having a hard time though understanding the reads.\nWhen connecting to <code>go tool pprof http://localhost:6060/debug/pprof/heap?debug=1</code>, a sample output is</p>\n\n<pre><code>Entering interactive mode (type \"help\" for commands, \"o\" for options)\n(pprof) text\nShowing nodes accounting for 17608.45kB, 100% of 17608.45kB total\nShowing top 10 nodes out of 67\n      flat  flat%   sum%        cum   cum%\n12292.12kB 69.81% 69.81% 12292.12kB 69.81%  github.com/acct/repo/vendor/github.com/.../funcA /../github.com/acct/repo/vendor/github.com/../fileA.go\n 1543.14kB  8.76% 78.57%  1543.14kB  8.76%  github.com/acct/repo/../funcB /../github.com/acct/repo/fileB.go\n 1064.52kB  6.05% 84.62%  1064.52kB  6.05%  github.com/acct/repo/vendor/github.com/../funcC /../github.com/acct/repo/vendor/github.com/fileC.go\n  858.34kB  4.87% 89.49%   858.34kB  4.87%  github.com/acct/repo/vendor/golang.org/x/tools/imports.init /../github.com/acct/repo/vendor/golang.org/x/tools/imports/zstdlib.go\n  809.97kB  4.60% 94.09%   809.97kB  4.60%  bytes.makeSlice /usr/lib/go/src/bytes/buffer.go\n  528.17kB  3.00% 97.09%   528.17kB  3.00%  regexp.(*bitState).reset /usr/lib/go/src/regexp/backtrack.go\n</code></pre>\n\n<p>(Please forgive the clumsy obfuscation)</p>\n\n<p>We interpret <code>funcA</code> to be consuming nearly 70% of memory - but this being around 12MB.</p>\n\n<p>Now <code>top</code> though shows: </p>\n\n<pre><code>top - 18:09:44 up  2:02,  1 user,  load average: 0,75, 0,56, 0,38\nTasks: 166 total,   1 running, 165 sleeping,   0 stopped,   0 zombie\n%Cpu(s):  3,7 us,  1,6 sy,  0,0 ni, 94,3 id,  0,0 wa,  0,0 hi,  0,3 si,  0,0 st\nKiB Mem : 16318684 total, 14116728 free,  1004804 used,  1197152 buff/cache\nKiB Swap:        0 total,        0 free,        0 used. 14451260 avail Mem \n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                              \n 4902 me     20   0  1,371g 0,096g 0,016g S  12,9  0,6   1:58.14 mybin\n</code></pre>\n\n<p>which suggests 1.371 GB of memory used....where is it gone???</p>\n\n<p>Also, <code>pprof</code> docs are quite frugal. We are having difficulties even to understand how it should be used. Our binary is a daemon. For example:</p>\n\n<ol>\n<li>If we start a reading with <code>go tool pprof http://localhost:6060/debug/pprof/heap</code>, is this a one time reading at this particular time or an aggregate over time? </li>\n<li>Sometimes hitting <code>text</code> later again in <code>interactive mode</code> seems to report the same values. Are we actually looking at the same values? Do we need to restart <code>go tool pprof...</code> to get fresh values?</li>\n<li>Is it a reading of the complete heap, or of some specific go routine, of a specific point in the stack....???</li>\n</ol>\n\n<p>Finally, is this interpretation correct (from <a href=\"http://localhost:6060/debug/pprof/\" rel=\"nofollow noreferrer\">http://localhost:6060/debug/pprof/</a>):</p>\n\n<pre><code>/debug/pprof/\n\nprofiles:\n0   block\n64  goroutine\n45  heap\n0   mutex\n13  threadcreate\n</code></pre>\n\n<p>The binary has 64 open go routines and a total of 45MB of heap memory?</p>\n"}, {"tags": ["go", "assembly", "nasm", "gnu-assembler"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1513892218, "post_id": 47932759, "comment_id": 82835207, "body": "This is definitely not gas btw, it&#39;s Go assembler."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1513895292, "post_id": 47932759, "comment_id": 82836328, "body": "You can always check your translation by assembling with the Go assembler and using a disassembler (like <code>objdump -drwC -Mintel</code>) on the object file.  That gives you GNU <code>.intel_syntax</code>, which is MASM-like, but it&#39;s pretty easy to read when you&#39;re used to NASM."}, {"owner": {"reputation": 35113, "user_id": 3826372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P0peM.png?s=128&g=1", "display_name": "Ross Ridge", "link": "https://stackoverflow.com/users/3826372/ross-ridge"}, "edited": false, "score": 0, "creation_date": 1513898195, "post_id": 47932759, "comment_id": 82837244, "body": "Your translation of the Go <code>Add</code> into NASM <code>add_asm</code> looks wrong, you&#39;re missing the part where you load the parameters into <code>REG_P1</code>, <code>REG_P2</code>, and <code>REG_P3</code>. From how they <code>REG_P1</code> etc.. look like registers, but who knows what registers."}, {"owner": {"reputation": 444, "user_id": 5641235, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-loFm2-xgmKo/AAAAAAAAAAI/AAAAAAAAABs/oI5XWakjch0/photo.jpg?sz=128", "display_name": "sivizius", "link": "https://stackoverflow.com/users/5641235/sivizius"}, "edited": false, "score": 0, "creation_date": 1513901504, "post_id": 47932759, "comment_id": 82838140, "body": "because <code>mov</code> wants 2 operands of the same size, try <code>movzx</code>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9128740"}, "edited": false, "score": 0, "creation_date": 1513892557, "post_id": 47933014, "comment_id": 82835328, "body": "You can ignore the <code>(0*8)</code> part, as I have partially removed the code, that part is repeated down also from <code>(1*8)</code> to <code>(11*8)</code>. The problem is that I do not know  how to translate the following three lines:     <code>MOVB    choice+16(FP), AL     MOVBLZX AL, AX     NEGQ    AX</code>  And in the <code>Add</code> function, my version works just fine by pushing couple of r registers initially."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 0, "last_activity_date": 1513892071, "creation_date": 1513892071, "answer_id": 47933014, "question_id": 47932759, "link": "https://stackoverflow.com/questions/47932759/translating-go-assembler-to-nasm/47933014#47933014", "title": "Translating Go assembler to NASM", "body": "<p>I think you can translate these as just</p>\n\n<pre><code>mov rbx, [reg_p1]\nmov rcx, [reg_p2]\n</code></pre>\n\n<p>Unless I'm missing some subtlety, the offsets which are zero can just be ignored. The <code>*8</code> isn't a size hint since that's already in the instruction.</p>\n\n<p>The rest of your code looks wrong though. The <code>MOVB choice+16(FP), AL</code> in the original is supposed to be fetching the <code>choice</code> argument into AL, but you're setting AL to a constant 16, and the code for loading the other arguments seems to be completely missing, as is the code for all of the arguments in the other function.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9128740"}, "edited": false, "score": 0, "creation_date": 1513896986, "post_id": 47933661, "comment_id": 82836880, "body": "Choice is actually the name of the parameter in the Go function."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9128740"}, "edited": false, "score": 0, "creation_date": 1513897427, "post_id": 47933661, "comment_id": 82837013, "body": "Also, I get an error: operation size mismatch for \u2018movzx\u2019"}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1513899678, "post_id": 47933661, "comment_id": 82837680, "body": "@terett: I had another look, I think FP is a register name, either RSP or RBP.  The right offset to reach <code>choice</code> will depend on how many pushes you did."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1513899967, "post_id": 47933661, "comment_id": 82837758, "body": "@terett: what NASM source line gave you that error for <code>movzx</code>?  <code>movzx  eax, byte [valid_mem_address]</code> should assemble just fine."}, {"owner": {"reputation": 35113, "user_id": 3826372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P0peM.png?s=128&g=1", "display_name": "Ross Ridge", "link": "https://stackoverflow.com/users/3826372/ross-ridge"}, "edited": false, "score": 1, "creation_date": 1513932079, "post_id": 47933661, "comment_id": 82845672, "body": "I&#39;m not sure <code>objdump</code> will work, as Go apparently has its own object file format. It&#39;s assembly language also isn&#39;t quite real assembly language either, it&#39;s a bit more like a internal representation like LLVM&#39;s IL. The FP register is pseudo-register that doesn&#39;t correspond to any real register. The operand <code>choice+16(FP)</code> just means the third argument, the <code>choice</code> part is ignored. There&#39;s some basic documentation about Go&#39;s &quot;assembly&quot; language on their web site: <a href=\"https://golang.org/doc/asm\" rel=\"nofollow noreferrer\">golang.org/doc/asm</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9128740"}, "reply_to_user": {"reputation": 35113, "user_id": 3826372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P0peM.png?s=128&g=1", "display_name": "Ross Ridge", "link": "https://stackoverflow.com/users/3826372/ross-ridge"}, "edited": false, "score": 0, "creation_date": 1513937644, "post_id": 47933661, "comment_id": 82848472, "body": "I guess @RossRidge is right. I did run <code>go tool asm test.s</code>, which generated <code>test.o</code> for me. But when I run <code>objconv -fnasm test.o</code>, I got an error message saying: Error 2018: Unknown type 0x6F206F67 for file: test.o. Also if I run <code>objdump -drwC -Mintel test.o</code>, I get an error: objdump: test.o: File format not recognized."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9128740"}, "edited": false, "score": 0, "creation_date": 1513938495, "post_id": 47933661, "comment_id": 82848927, "body": "@PeterCordes Also, if I do something like <code>movzx  eax, byte [rsp + 16]</code> (same for <code>rbp</code> too), I still get an Error: operand size mismatch for movzx exit code: 1. But if I separate them such as <code>mov al, byte [rsp + 16]</code> then <code>movzx eax, al</code>, it compiles, but the result is still wrong, I guess I&#39;m not getting the value of the third parameter which is <code>u8</code> variable."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9128740"}, "edited": false, "score": 0, "creation_date": 1513945275, "post_id": 47933661, "comment_id": 82852191, "body": "Okay, I found the solution, and put it in the edited question. Though, your answer helped a lot. Thank you."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1513958447, "post_id": 47933661, "comment_id": 82858069, "body": "@terett: <code>movzx  eax, byte [rsp + 16]</code> assembles just fine with NASM and YASM.  If you&#39;re getting an error from &quot;something like&quot; that, whatever you tried wasn&#39;t close enough, or you have a macro <code>%define</code> that&#39;s breaking something.  Perhaps you <code>%define byte</code> to the empty string?  But that gives &quot;operation size not specified&quot; rather than mismatch."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 35113, "user_id": 3826372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P0peM.png?s=128&g=1", "display_name": "Ross Ridge", "link": "https://stackoverflow.com/users/3826372/ross-ridge"}, "edited": false, "score": 0, "creation_date": 1513961382, "post_id": 47933661, "comment_id": 82859295, "body": "@RossRidge: Thanks.  Updated the disassembly suggestion with stuff that doesn&#39;t need to understand the object file format."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1513962064, "post_id": 47933661, "comment_id": 82859572, "body": "@terett: Oh, you didn&#39;t say you wanted to call your NASM functions from something other than Go.  That makes sense in hindsight, but yes, of course you have to port it to another calling convention instead of just transliterating all the instructions.  You&#39;re correct that you don&#39;t need to load args from memory at all."}], "tags": [], "owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": true, "score": 0, "last_activity_date": 1513961951, "last_edit_date": 1513961951, "creation_date": 1513895991, "answer_id": 47933661, "question_id": 47932759, "link": "https://stackoverflow.com/questions/47932759/translating-go-assembler-to-nasm/47933661#47933661", "title": "Translating Go assembler to NASM", "body": "<p>Basic docs about Go's asm: <a href=\"https://golang.org/doc/asm\" rel=\"nofollow noreferrer\">https://golang.org/doc/asm</a>.  It's not totally equivalent to NASM or AT&amp;T syntax: <code>FP</code> is a pseudo-register name for whichever register it decides to use as the frame pointer.  (Typically RSP or RBP).  Go asm also seems to omit function prologue (and probably epilogue) instructions.  <a href=\"https://stackoverflow.com/questions/47932759/translating-go-assembler-to-nasm/47933661?noredirect=1#comment82845672_47933661\">As @RossRidge comments</a>, it's a bit more like a internal representation like LLVM IR than truly asm.</p>\n\n<p>Go also has its own object-file format, so I'm not sure you can make Go-compatible object files with NASM.</p>\n\n<p><strong>If you want to call this function from something other than Go, you'll also need to port the code to a different calling convention</strong>.  Go appears to be using a stack-args calling convention even for x86-64, unlike the normal x86-64 System V ABI or the x86-64 Windows calling convention.  (Or maybe those <code>mov</code> function args into <code>REG_P1</code> and so on instructions disappear when Go builds this source for a register-arg calling convention?)</p>\n\n<p>(This is why you could you had to use <code>movzx eax, dl</code> instead of loading from the stack at all.)</p>\n\n<p>BTW, rewriting this code in C instead of NASM would probably make even more sense if you want to use it with C.  Small functions are best inlined and optimized away by the compiler.</p>\n\n<hr>\n\n<p>It would be a good idea to check your translation, or get a starting point, by assembling with the Go assembler and using a disassembler.  </p>\n\n<p><code>objdump -drwC -Mintel</code> or <a href=\"http://agner.org/optimize/#objconv\" rel=\"nofollow noreferrer\">Agner Fog's <code>objconv</code> disassembler</a> would be good, but they don't understand Go's object-file format.  If Go has a tool to extract the actual machine code or get it in an ELF object file, do that.</p>\n\n<p>If not, you could use <code>ndisasm -b 64</code> (which treats input files as flat binaries, disassembling <em>all</em> the bytes as if they were instructions).  You can specify an offset/length if you can find out where the function starts.  x86 instructions are variable length, and disassembly will likely be \"out of sync\" at the start of the function.  You might want to add a bunch of single-byte NOP instructions (kind of a NOP sled) for the disassembler, so if it decodes some 0x90 bytes as part of an immediate or disp32 for a long instruction that was really not part of the function, it will be in sync.  (But the function prologue will still be messed up).</p>\n\n<p>You might add some \"signpost\" instructions to your Go asm functions to make it easy to find the right place in the mess of crazy asm from disassembling metadata as instructions.  e.g. put a <code>pmuludq xmm0, xmm0</code> in there somewhere, or some other instruction with a unique mnemonic that you can search for which the Go code doesn't include.  Or an instruction with an immediate that will stand out, like <code>addq $0x1234567, SP</code>.  (An instruction that will crash so you don't forget to take it out again is good here.)</p>\n\n<p>Or you could use <code>gdb</code>'s built-in disassembler: add an instruction that will segfault (like a load from a bogus absolute address (<code>movl 0, AX</code> null-pointer deref), or a register holding a non-pointer value e.g. <code>movl (AX), AX</code>).  Then you'll have an instruction-pointer value for the instructions in memory, and can disassemble from some point behind that.  (Probably the function start will be 16-byte aligned.)</p>\n\n<hr>\n\n<h2>Specific instructions.</h2>\n\n<p><code>MOVBLZX AL, AX</code> reads AL, so that's definitely an 8-bit operand.  The size for AX is given by the <code>L</code> part of the mnemonic, meaning <code>long</code> for 32 bit, like in GAS AT&amp;T syntax.  (The gas mnemonic for that form of <code>movzx</code> is <code>movzbl %al, %eax</code>).  See <a href=\"https://stackoverflow.com/questions/6555094/what-does-cltq-do-in-assembly/45386217#45386217\">What does cltq do in assembly?</a> for a table of cdq / cdqe and the AT&amp;T equivalent, and the AT&amp;T / Intel mnemonic for the equivalent MOVSX instruction.</p>\n\n<p>The NASM instruction you want is <code>movzx eax, al</code>.  Using <code>rax</code> as the destination would be a waste of a REX prefix.  Using <code>ax</code> as the destination would be a mistake: it wouldn't zero-extend into the full register, and would leave whatever high garbage.  Go asm syntax for x86 is very confusing when you're not used to it, because AX can mean AX, EAX, or RAX depending on the operand size.</p>\n\n<p>Obviously <code>mov rax, al</code> isn't a possibility: Like most instructions, <code>mov</code>  requires both its operands to be the same size.  <code>movzx</code> is one of the rare exceptions.</p>\n\n<hr>\n\n<p><code>MOVB    choice+16(FP), AL</code> is a byte load into <code>AL</code>, not an immediate move.  <code>choice+16</code> is a an offset from <code>FP</code>.  This syntax is basically the same as AT&amp;T addressing modes, with FP as a register and <code>choice</code> as an assemble-time constant.</p>\n\n<p><code>FP</code> is a pseudo-register name.  It's pretty clear that it should simply be loading the low byte of the 3rd arg-passing slot, because <code>choice</code> is the name of a function arg.  (In Go asm, <code>choice</code> is just syntactic sugar, or a constant defined as zero.)</p>\n\n<p>Before a <code>call</code> instruction, <code>rsp</code> points at the first stack arg, so that + 16 is the 3rd arg.  It appears that <code>FP</code> is that base address (and might actually be <code>rsp+8</code> or something).  After a <code>call</code> (which pushes an 8 byte return address), the 3rd stack arg is at <code>rsp + 24</code>.  After more pushes, the offset will be even larger, so adjust as necessary to reach the right location.</p>\n\n<p>If you're porting this function to be called with a standard calling convention, the 3 integer args will be passed in registers, with no stack args.  Which 3 registers depends on whether you're building for Windows vs. non-Windows.  (See Agner Fog's calling conventions doc: <a href=\"http://agner.org/optimize/\" rel=\"nofollow noreferrer\">http://agner.org/optimize/</a>)</p>\n\n<hr>\n\n<p><strong>BTW, a byte load into AL and then <code>movzx eax, al</code> is just dumb</strong>.  Much more efficient on all modern CPUs to do it in one step with</p>\n\n<pre><code>movzx  eax, byte [rsp + 24]      ; or rbp+32 if you made a stack frame.\n</code></pre>\n\n<p>I hope the source in the question is from un-optimized Go compiler output?  Or the assembler itself makes such optimizations?</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9128740"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 679, "favorite_count": 0, "accepted_answer_id": 47933661, "answer_count": 2, "score": 1, "last_activity_date": 1513961951, "creation_date": 1513890665, "last_edit_date": 1513944985, "question_id": 47932759, "link": "https://stackoverflow.com/questions/47932759/translating-go-assembler-to-nasm", "title": "Translating Go assembler to NASM", "body": "<p>I came across the following Go code:</p>\n\n<pre><code>type Element [12]uint64\n\n//go:noescape\nfunc CSwap(x, y *Element, choice uint8)\n\n//go:noescape\nfunc Add(z, x, y *Element)\n</code></pre>\n\n<p>where the <code>CSwap</code> and <code>Add</code> functions are basically coming from an assembly, and look like the following:</p>\n\n<pre><code>TEXT \u00b7CSwap(SB), NOSPLIT, $0-17\n\n    MOVQ    x+0(FP), REG_P1\n    MOVQ    y+8(FP), REG_P2\n    MOVB    choice+16(FP), AL   // AL = 0 or 1\n    MOVBLZX AL, AX              // AX = 0 or 1\n    NEGQ    AX                  // RAX = 0x00..00 or 0xff..ff\n\n    MOVQ    (0*8)(REG_P1), BX\n    MOVQ    (0*8)(REG_P2), CX\n    // Rest removed for brevity\n\nTEXT \u00b7Add(SB), NOSPLIT, $0-24\n\n    MOVQ    z+0(FP), REG_P3\n    MOVQ    x+8(FP), REG_P1\n    MOVQ    y+16(FP), REG_P2\n\n    MOVQ    (REG_P1), R8\n    MOVQ    (8)(REG_P1), R9\n    MOVQ    (16)(REG_P1), R10\n    MOVQ    (24)(REG_P1), R11\n    // Rest removed for brevity\n</code></pre>\n\n<p>What I try to do is that translate the assembly to a syntax that is more familiar to me (I think mine is more like NASM), while the above syntax is Go assembler. Regarding the <code>Add</code> method I didn't have much problem, and translated it correctly (according to test results). It looks like this in my case:</p>\n\n<pre><code>.text\n.global add_asm\nadd_asm:\n  push   r12\n  push   r13\n  push   r14\n  push   r15\n\n  mov    r8, [reg_p1]\n  mov    r9, [reg_p1+8]\n  mov    r10, [reg_p1+16]\n  mov    r11, [reg_p1+24]\n  // Rest removed for brevity\n</code></pre>\n\n<p>But, I have a problem when translating the <code>CSwap</code> function, I have something like this:</p>\n\n<pre><code>.text\n.global cswap_asm\ncswap_asm:\n  push   r12\n  push   r13\n  push   r14\n\n  mov    al, 16\n  mov    rax, al\n  neg    rax\n\n  mov    rbx, [reg_p1+(0*8)]\n  mov    rcx, [reg_p2+(0*8)]\n</code></pre>\n\n<p>But this doesn't seem to be quite correct, as I get error when compiling it. Any ideas how to translate the above <code>CSwap</code> assembly part to something like NASM?</p>\n\n<p><strong>EDIT (SOLUTION):</strong></p>\n\n<p>Okay, after the two answers below, and some testing and digging, I found out that the code uses the following three registers for parameter passing:</p>\n\n<pre><code>#define reg_p1  rdi\n#define reg_p2  rsi\n#define reg_p3  rdx\n</code></pre>\n\n<p>Accordingly, <code>rdx</code> has the value of the <code>choice</code> parameter. So, all that I had to do was use this:</p>\n\n<pre><code>movzx  rax, dl // Get the lower 8 bits of rdx (reg_p3)\nneg    rax\n</code></pre>\n\n<p>Using <code>byte [rdx]</code> or <code>byte [reg_3]</code> was giving an error, but using <code>dl</code>  seems to work fine for me.</p>\n"}, {"tags": ["html", "go", "goquery"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1513889499, "post_id": 47932537, "comment_id": 82834133, "body": "Please include your current code, explain what problem you&#39;re having, and what you expected instead."}, {"owner": {"reputation": 25, "user_id": 9128638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd686004125a743393e0bebd511d076?s=128&d=identicon&r=PG&f=1", "display_name": "Miko\u0142aj Ho\u0142ysz", "link": "https://stackoverflow.com/users/9128638/miko%c5%82aj-ho%c5%82ysz"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513889927, "post_id": 47932537, "comment_id": 82834274, "body": "done, just edited the question"}, {"owner": {"reputation": 1233, "user_id": 4983242, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KQbOP.jpg?s=128&g=1", "display_name": "Dharma Saputra", "link": "https://stackoverflow.com/users/4983242/dharma-saputra"}, "edited": false, "score": 0, "creation_date": 1513925637, "post_id": 47932537, "comment_id": 82843365, "body": "I think it will be hard, because the text that you want to extract is not in the <code>Document</code> node. Another option is using <code>regex</code> to extract it."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 9128638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd686004125a743393e0bebd511d076?s=128&d=identicon&r=PG&f=1", "display_name": "Miko\u0142aj Ho\u0142ysz", "link": "https://stackoverflow.com/users/9128638/miko%c5%82aj-ho%c5%82ysz"}, "edited": false, "score": 0, "creation_date": 1525461555, "post_id": 47984250, "comment_id": 87380815, "body": "That&#39;s what I&#39;ve done in the end. I&#39;ve used html nodes and worked on them directly (with a lot of hacking around stupidities and quirks of the original website). My code is going to land on github in a few days, I will psot a link to it in the comments when that happens."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1514351864, "last_edit_date": 1514351864, "creation_date": 1514326418, "answer_id": 47984250, "question_id": 47932537, "link": "https://stackoverflow.com/questions/47932537/retrieving-text-from-a-website-with-goquery/47984250#47984250", "title": "retrieving text from a website with goquery", "body": "<p>Unfortunately, due to how this HTML page is structured, it doesn't seem like goquery will be of much help after you've identified the section of the page that contains the movie listings in your example because the data points of interest are not isolated into elements that can be targetted by goquery.</p>\n\n<p>However, the details can easily be parsed using regular expressions, which can of course be modified as needed (especially if/when the original page changes its HTML structure).</p>\n\n<pre><code>type Movie struct {\n    Title          string\n    ReleaseYear    int\n    Rating         string\n    RuntimeMinutes int\n    Description    string\n}\n\nvar movieregexp = regexp.MustCompile(`` +\n    `&lt;h5&gt;&lt;a.*?&gt;\\s*(.*?)\\s*&lt;/a&gt;\\s*\\((\\d{4})\\)&lt;/h5&gt;` + // Title and release year\n    `[\\s\\S]*?Rating: (.*?)&lt;` +\n    `[\\s\\S]*?Running Time \\(minutes\\): (\\d{1,3})` +\n    `[\\s\\S]*?Description: ([\\s\\S]*?)&lt;`)\n\n// Returns a slice of movies parsed from the given string, possibly empty.\nfunc ParseMovies(s string) []Movie {\n    movies := []Movie{}\n    groups := movieregexp.FindAllStringSubmatch(s, -1)\n\n    if groups != nil {\n        for _, group := range groups {\n            // We know these integers parse correctly because of the regex.\n            year, _ := strconv.Atoi(group[2])\n            runtime, _ := strconv.Atoi(group[4])\n            // Append the new movie to the list.\n            movies = append(movies, Movie{\n                Title:          group[1],\n                ReleaseYear:    year,\n                Rating:         group[3],\n                RuntimeMinutes: runtime,\n                Description:    group[5],\n            })\n        }\n    }\n\n    return movies\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1514360112, "creation_date": 1514360112, "answer_id": 47988181, "question_id": 47932537, "link": "https://stackoverflow.com/questions/47932537/retrieving-text-from-a-website-with-goquery/47988181#47988181", "title": "retrieving text from a website with goquery", "body": "<p>I somehow don't like the idea of using regex to parse html. I feel it to be too fragile against minor changes like tags order or something like that.</p>\n\n<p>I think it is the best to fall back on html.Node(golang.org/x/net/html), which goquery is based on. The idea is to iterate over siblings until it runs out, or the next <code>h5</code> is encountered. It might be a little trouble to deal with links or any other element tags as the html.Node provides a rather unfriendly api regarding attributes, but switching back to goquery from it is even more trouble.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/PuerkitoBio/goquery\"\n    \"golang.org/x/net/html\"\n    \"golang.org/x/net/html/atom\"\n    \"os\"\n    \"strings\"\n)\n\ntype Movie struct {\n}\n\nfunc (m Movie) addTitle(s string) {\n    fmt.Println(\"Title\", s)\n}\n\nfunc (m Movie) addProperty(s string) {\n    if s == \"\" {\n        return\n    }\n    fmt.Println(\"Property\", s)\n}\n\nvar M []*Movie\n\nfunc parseMovie(i int, s *goquery.Selection) {\n    m := &amp;Movie{}\n    m.addTitle(s.Text())\n\nloop:\n    for node := s.Nodes[0].NextSibling; node != nil; node = node.NextSibling {\n        switch node.Type {\n        case html.TextNode:\n            m.addProperty(strings.TrimSpace(node.Data))\n        case html.ElementNode:\n            switch node.DataAtom {\n            case atom.A:\n                //link, do something. You may want to transfer back to go query\n                fmt.Println(node.Attr)\n            case atom.Br:\n                continue\n            case atom.H5:\n                break loop\n            }\n        }\n    }\n\n    M = append(M, m)\n}\n\nfunc main() {\n    r, err := os.Open(\"movie.html\")\n    if err != nil {\n        panic(err)\n    }\n    doc, err := goquery.NewDocumentFromReader(r)\n    if err != nil {\n        panic(err)\n    }\n\n    doc.Find(\"h5\").Each(parseMovie)\n}\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 9128638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd686004125a743393e0bebd511d076?s=128&d=identicon&r=PG&f=1", "display_name": "Miko\u0142aj Ho\u0142ysz", "link": "https://stackoverflow.com/users/9128638/miko%c5%82aj-ho%c5%82ysz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 714, "favorite_count": 0, "accepted_answer_id": 47988181, "answer_count": 2, "score": 0, "last_activity_date": 1514360112, "creation_date": 1513889425, "last_edit_date": 1514237518, "question_id": 47932537, "link": "https://stackoverflow.com/questions/47932537/retrieving-text-from-a-website-with-goquery", "title": "retrieving text from a website with goquery", "body": "<p>I have a html roughly looking like this:</p>\n\n<pre><code>&lt;h4&gt;Movies&lt;/h4&gt;\n    &lt;h5&gt;&lt;a href=\"external_link\" target=\"_blank\"&gt; A Song For Jenny&lt;/a&gt; (2015)&lt;/h5&gt;\n    Rating: PG&lt;br/&gt;\n    Running Time (minutes): 77&lt;br/&gt;\n    Description: This Drama, based on real life events, tells the story of a family affected directly by the 7/7 London bombings.  It shows love, loss, heartache and  ...&lt;br/&gt;\n    &lt;a href=\"/bmm/shop/Movie_Detail?movieid=2713288\"&gt;More about  A Song For Jenny&lt;/a&gt;&lt;br/&gt;\n        &lt;a href=\"/bmm/shop/Edit_Movie?movieid=2713288\"&gt;Edit  A Song For Jenny&lt;/a&gt;&lt;br/&gt;\n    &lt;br/&gt;\n    &lt;h5&gt;&lt;a href=\"link\" target=\"_blank\"&gt;#RealityHigh&lt;/a&gt; (2017)&lt;/h5&gt;\n    Rating: PG&lt;br/&gt;\n    Running Time (minutes): 99&lt;br/&gt;\n    Description: High-achieving high-school senior Dani Barnes dreams of getting into UC Davis, the world's top  veterinary school. Then a glamorous new friend draws  ...&lt;br/&gt;\n    &lt;a href=\"/bmm/shop/Movie_Detail?movieid=4089906\"&gt;More about #RealityHigh&lt;/a&gt;&lt;br/&gt;\n        &lt;a href=\"/bmm/shop/Edit_Movie?movieid=4089906\"&gt;Edit #RealityHigh&lt;/a&gt;&lt;br/&gt;\n    &lt;br/&gt;\n    &lt;h5&gt;&lt;a href=\"link\" target=\"_blank\"&gt;1 Night&lt;/a&gt; (2016)&lt;/h5&gt;\n    Rating: PG&lt;br/&gt;\n    Running Time (minutes): 80&lt;br/&gt;\n    Description: Bea, a worrisome teenager, reconnects with her introverted childhood friend, Andy. The two  overcome their differences in social status one night aft ...&lt;br/&gt;\n    &lt;a href=\"/bmm/shop/Movie_Detail?movieid=3959071\"&gt;More about 1 Night&lt;/a&gt;&lt;br/&gt;\n        &lt;a href=\"/bmm/shop/Edit_Movie?movieid=3959071\"&gt;Edit 1 Night&lt;/a&gt;&lt;br/&gt;\n    &lt;br/&gt;\n    &lt;h5&gt;&lt;a href=\"link\" target=\"_blank\"&gt;10 Cloverfield Lane&lt;/a&gt; (2016)&lt;/h5&gt;\n    Rating: PG&lt;br/&gt;\n    Running Time (minutes): 104&lt;br/&gt;\n    Description: Soon after leaving her fianc\u00e9 Michelle is involved in a car accident. She awakens\nto find herself sharing an underground bunker with Howard and Emme ...&lt;br/&gt;\n    &lt;a href=\"/bmm/shop/Movie_Detail?movieid=3052189\"&gt;More about 10 Cloverfield Lane&lt;/a&gt;&lt;br/&gt;\n        &lt;a href=\"/bmm/shop/Edit_Movie?movieid=3052189\"&gt;Edit 10 Cloverfield Lane&lt;/a&gt;&lt;br/&gt;\n    &lt;br/&gt;\n</code></pre>\n\n<p>I need to use goquery to get as much information out of this page as possible. I know how to extract the external links replaced by the word \"link\" in this fragment, I know how to get to the links with more details but I also want to extract the information only contained in text, i.e. year (in the headings), running time, shortened description  and PG rating. \nI couldn't figure out how to do this in goquery because this text isn't surrounded by any divs or other tags. I tried looking for h5 tags and then calling .Next() on them but I could only find the <code>&lt;br&gt;</code> tags, not the text inbetween. How can I do that? If there's a better way to do it than using goquery, I'm fine with that.\nMy code looks like this.</p>\n\n<pre><code>// Retrieve the page count:\n    res, err = http.Get(\"myUrlAddress\")\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(-1)\n    }\n    doc, err = goquery.NewDocumentFromResponse(res)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(-1)\n    }\n    links := doc.Find(`a[href*=\"pageIndex\"]`)\n    fmt.Println(links.Length()) // Output page count\ns := doc.Find(\"h5\").First().Next() // I expect it to be the text after the heading.\nfmt.Println(s.Text()) // But it's empty and if I check the node type it says br\n</code></pre>\n"}, {"tags": ["go", "soap", "reporting-services"], "comments": [{"owner": {"reputation": 475, "user_id": 248495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb397d569b3edfb7b8bb01d043107a83?s=128&d=identicon&r=PG", "display_name": "Ya\u015far \u015eent&#252;rk", "link": "https://stackoverflow.com/users/248495/ya%c5%9far-%c5%9eent%c3%bcrk"}, "edited": false, "score": 1, "creation_date": 1513931453, "post_id": 47932415, "comment_id": 82845416, "body": "Have you tried setting <code>SOAPAction</code> header while calling <code>ListChildren</code>?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1513940888, "post_id": 47932415, "comment_id": 82850091, "body": "1) The required value for the content type may be <code>application&#47;xml</code> or <code>text&#47;xml+soap</code> or <code>application&#47;xml+soap</code>; 2) Try setting the <code>Accept</code> header field to <code>text&#47;xml</code> or <code>application&#47;xml</code> or <code>text&#47;xml+soap</code> or <code>application&#47;xml+soap</code>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1513940974, "post_id": 47932415, "comment_id": 82850128, "body": "In general, I&#39;d try to capture the traffic of some &quot;official&quot; client making a <i>proper</i> request to that service and then try to figure out what made that possible. Look for Wireshark and <code>tcpdump</code>. (Note that this won&#39;t work with HTTPS\u2014unless you possess the server&#39;s private key)."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1513941279, "post_id": 47932415, "comment_id": 82850245, "body": "BTW the XML namespace in your cURL example has an error: it has to be &quot;<a href=\"http://schemas.xmlsoap.org/soap/\" rel=\"nofollow noreferrer\">schemas.xmlsoap.org/soap</a>&quot;. And so another shot in the dark. The namespace you apear to be using is SOAP NOTE 1.1; it might turn out your service wants to talk SOAP 1.2 instead (which has another namespace and a difference in formatting faults etc)."}], "owner": {"reputation": 189, "user_id": 5656704, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ujz2aErbj70/AAAAAAAAAAI/AAAAAAAAAeM/JDJWZKVcono/photo.jpg?sz=128", "display_name": "Joshua Klein", "link": "https://stackoverflow.com/users/5656704/joshua-klein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 669, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1513941302, "creation_date": 1513888739, "last_edit_date": 1513941302, "question_id": 47932415, "link": "https://stackoverflow.com/questions/47932415/ssrs-reportingservice2010-soap-call-returning-html-not-soap-xml", "title": "SSRS ReportingService2010 SOAP Call returning HTML, not SOAP XML", "body": "<p>I'm trying to make a SOAP call to the SSRSReporting SOAP service, and receive a SOAP response in XML format. I am trying to use <a href=\"https://github.com/hooklift/gowsdl\" rel=\"nofollow noreferrer\">go-wsdl</a> to generate a SSRS SOAP API, however it seems that its \"not working\" in Go. I want to list the children using go-wsdl. The code below is returning an empty response. </p>\n\n<pre><code>package main\n\nimport ssrs \"ssrs/myservice\"\nimport \"fmt\"\n\n//curl  http://172.16.1.249/ReportServer/ListChildren -n -v --ntlm -u viewpointops\\\\dustinf.7C49\nfunc main() {\n    fmt.Print(\"gucci\\n\")\n    client := ssrs.NewSOAPClient(\"http://$HOST/ReportServer/ReportService2010.asmx\", true, &amp;ssrs.BasicAuth{Login: \"$USER\", Password: \"$PASSWORD\"})\n    resp := ssrs.ListChildrenResponse{}\n\n    err := client.Call(\"ListChildren\", ssrs.ListChildren{ ItemPath: \"/VCS/Custom/\", Recursive: true }, resp) \n    fmt.Println(err)\n    fmt.Println(\"%v\", resp)\n}\n</code></pre>\n\n<p>I'm thinking that maybe I don't understand SOAP and what it is, but also know that when I try to duplicate the request in curl, its not returning the XML response I expect it to return. </p>\n\n<pre><code>curl http://$HOST/ReportServer/ReportService2010.asmx -n -v --ntlm -u $USER  -H \"Content-Type: text/xml; charset=utf-8\" -H \"SOAPAaction: ListChildren\" --data '&lt;Envelope xmlns=\"http://schemas.xmlg/soap/envelope/\"&gt;&lt;Body xmlns=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;&lt;ListChildren xmlns=\"http://schemas.microsoft.com/sqlserver/reporting/2010/03/01/ReportServer\"&gt;&lt;ItemPath&gt;/VCS/Custom/&lt;/ItemPath&gt;&lt;Recursive&gt;true&lt;/Recursive&gt;&lt;/ListChildren&gt;&lt;/Body&gt;&lt;/Envelope&gt;' -H \"Accept: text/xml; charset=utf-8\" -H \"User-Agent: PHP/SOAP\" \n</code></pre>\n\n<p>I receive this response: </p>\n\n<pre><code>&lt;html&gt;\n  &lt;head&gt;\n    &lt;meta name=\"Generator\" content=\"Microsoft SQL Server Reporting Services Version 11.0.6251.0\"&gt;\n    &lt;title&gt;172.16.1.249/ReportServer - /&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;&lt;H1&gt;172.16.1.249/ReportServer - /&lt;/H1&gt;&lt;hr&gt;\n\n&lt;pre&gt;   Thursday, December 12, 2013 4:04 PM        &amp;lt;dir&amp;gt; &lt;A HREF=\"?%2fVCS&amp;amp;rs:Command=ListChildren\"&gt;VCS&lt;/A&gt;\n&lt;/pre&gt;&lt;hr&gt;\nMicrosoft SQL Server Reporting Services Version 11.0.6251.0\n\n  &lt;/body&gt;\n &lt;/html&gt; \n</code></pre>\n\n<p>I'd REALLY like to have the response returned in SOAP XML format so I can use a SOAP parser. I tried the Accept Header, but that's not working. I am mostly asking SO because I don't know what else to try.  If not, I guess I can just parse the HTML version, but the whole point is to use the generated code from wsdl and use the SOAP interface. </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["postgresql", "go", "sqlx"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1513875713, "post_id": 47929502, "comment_id": 82827613, "body": "What does the panic say?"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1513886267, "post_id": 47929502, "comment_id": 82832813, "body": "have you tried $1, $2, ...?"}, {"owner": {"reputation": 3854, "user_id": 2235885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09d0d6a08639ef79ef960a52bd013e02?s=128&d=identicon&r=PG", "display_name": "joop", "link": "https://stackoverflow.com/users/2235885/joop"}, "edited": false, "score": 1, "creation_date": 1513940604, "post_id": 47929502, "comment_id": 82849962, "body": "<code>Interval</code> a bad name for a variable  (or parameter), since  it is the name for a data type. And the <code>LIMIT 1</code> makes no sense inside an <code>EXISTS</code> subquery."}], "answers": [{"tags": [], "owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "is_accepted": false, "score": 1, "last_activity_date": 1513937517, "creation_date": 1513937517, "answer_id": 47939669, "question_id": 47929502, "link": "https://stackoverflow.com/questions/47929502/interval-arg-in-postgres-query-executed-via-golang-sqlx/47939669#47939669", "title": "Interval arg in postgres query executed via Golang SQLX", "body": "<p>Unless anything has changed since 2013 this is a <em>WontFix</em> <a href=\"https://github.com/golang/go/issues/4954\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/4954</a> with the suggested solution being to implement <code>sql.Scanner</code> and <code>driver.Valuer</code></p>\n\n<p>However, for my use case I have found that simply making the argument a <code>string</code> and calling <code>time.Duration.String()</code> works. I'm working with seconds only and have only tested in this range so YMMV.</p>\n"}], "owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 935, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1513937517, "creation_date": 1513875424, "last_edit_date": 1513936029, "question_id": 47929502, "link": "https://stackoverflow.com/questions/47929502/interval-arg-in-postgres-query-executed-via-golang-sqlx", "title": "Interval arg in postgres query executed via Golang SQLX", "body": "<p>I have the following SQL statement</p>\n\n<pre><code>INSERT INTO scheduled_event_log (\"key\")\nSELECT :key WHERE NOT EXISTS( SELECT AGE(now() at time zone 'utc', timestamp_utc)\nFROM scheduled_event_log\nWHERE \"key\" = :key\n    AND age(now() at time zone 'utc', timestamp_utc) &lt; :interval limit 1 );\n</code></pre>\n\n<p><code>:interval</code> is the Postgres interval type.  I prepare this as a named statement using sqlx but passing args to <code>Exec(..)</code> where <code>:interval</code> is a Golang <code>time.Duration</code> causes a panic.</p>\n\n<p>How should an interval be specified as an argument in this way?</p>\n"}, {"tags": ["go", "types", "interface"], "answers": [{"comments": [{"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 0, "creation_date": 1513875504, "post_id": 47929326, "comment_id": 82827501, "body": "Very helpful, thank you @Adrian. I feel silly, as I&#39;ll often see questions like mine and thing &#39;gee, go read the docs&#39;, but I was searching for &#39;type&#39; - related docs, not thinking to look at switch. Feel like half of improving is shrewd doc hunting ability :)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 0, "creation_date": 1513875752, "post_id": 47929326, "comment_id": 82827630, "body": "One of my favorite things about Go is it&#39;s so simple you can read the spec in an hour or two. Of course, retaining all the details is a different matter entirely!"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 15, "last_activity_date": 1513874797, "creation_date": 1513874797, "answer_id": 47929326, "question_id": 47929276, "link": "https://stackoverflow.com/questions/47929276/implement-logical-or-for-types-within-switch/47929326#47929326", "title": "Implement logical OR for types within switch", "body": "<p>Well, I thought you couldn't, until I <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"noreferrer\">read the spec</a>. You can, and it works just like multiple cases in any other <code>switch</code> in Go:</p>\n\n<pre><code>case bool, string:\n    printString(\"type is bool or string\")  // type of i is type of x (interface{})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 0, "creation_date": 1513875230, "post_id": 47929356, "comment_id": 82827376, "body": "Oh goodness, simple!  Here&#39;s a &#39;gotcha&#39; - if we if we have: case int, int64 we cannot check for just case int later down the switch.  Thanks @Flimzy!"}, {"owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "reply_to_user": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 0, "creation_date": 1513934306, "post_id": 47929356, "comment_id": 82846693, "body": "@gpanda That&#39;s not a gotcha of this kind of switch, but of every Go switch. Whenever if finds a match it won&#39;t check the next cases. <code>passthrough</code> and <code>goto</code> can be used to aleviate this. Are you interested in this? I can give you an example but i need more space than a comment for this. Won&#39;t post it as an answer if you don&#39;t need it as it won&#39;t offer anything additional to the existing answers."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 1, "creation_date": 1513935022, "post_id": 47929356, "comment_id": 82847013, "body": "@Adirio: I think you mean <code>fallthrough</code>, but fallthrough doesn&#39;t work on type switches."}, {"owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 0, "creation_date": 1513935227, "post_id": 47929356, "comment_id": 82847125, "body": "<code>fallthrough</code> yes, sorry about the typo. Does it not work on type switches? I didn&#39;t know that. Well I guess we all learn something new each day."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513935539, "post_id": 47929356, "comment_id": 82847308, "body": "I tried it in the playground to add to this answer, and was promptly told by the compiler that fallthrough is not allowed for type switches :)"}, {"owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 1, "creation_date": 1513936050, "post_id": 47929356, "comment_id": 82847592, "body": "I guesses I should also use the playground to check and look what I found: <a href=\"https://play.golang.org/p/3EI6ZxFfuvQ\" rel=\"nofollow noreferrer\">play.golang.org/p/3EI6ZxFfuvQ</a>. It has nothing to do with <code>fallthrough</code>. The compound cases for type switches do transform into the proper type. Well they print as if they do at least."}, {"owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 0, "creation_date": 1513936906, "post_id": 47929356, "comment_id": 82848065, "body": "Well that&#39;s two things then, I had never printed the type of an interface before, never needed to. When I have this kind of cases they are usually not on builtin types and I usually build an interface for them."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1513874904, "creation_date": 1513874904, "answer_id": 47929356, "question_id": 47929276, "link": "https://stackoverflow.com/questions/47929276/implement-logical-or-for-types-within-switch/47929356#47929356", "title": "Implement logical OR for types within switch", "body": "<p>Yes, it's possible.  But then <code>t</code> has the type of <code>interface{}</code> in any compound <code>case</code>s or in the <code>default</code> case.</p>\n\n<pre><code>switch t := v.(type) {\ncase string:\n    // t is of type string\ncase int, int64:\n    // t is of type interface{}, and contains either an int or int64\ndefault:\n    // t is also of type interface{} here\n}\n</code></pre>\n"}], "owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5366, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1595591479, "creation_date": 1513874609, "last_edit_date": 1595591479, "question_id": 47929276, "link": "https://stackoverflow.com/questions/47929276/implement-logical-or-for-types-within-switch", "title": "Implement logical OR for types within switch", "body": "<p>I have a <code>[]interface{}</code> I am iterating over, and checking the type of each element within a switch. I would like to add a 'catch-all' case for any of several numeric types, i.e. <code>int || float32 || float64</code>.</p>\n\n<p>It seems we are able to check whether an element is of a single distinct type, but I have not been able to figure out the syntax for checking multiple types with <code>||</code> (or).</p>\n\n<p>Is this possible? What I've tried (<a href=\"https://play.golang.org/p/eyaHqufoDTA\" rel=\"nofollow noreferrer\">Playground</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    things := []interface{}{\"foo\", 12, 4.5, true}\n\n    for _, thing := range things {\n\n        switch t := thing.(type) {\n\n        // How can we implement logical OR for types to implement a catch-all for numerics?\n        // Throws error: \"type &lt;type&gt; is not an expression\"\n        // case ( int || float64 ) :\n        //  fmt.Printf(\"Thing %v is a 'numeric' type: %T\\n\", thing, t)\n\n\n        // Single discrete types work fine, of course\n        case string :\n            fmt.Printf(\"Thing %v is of type: %T\\n\", thing, t)   \n        case int :\n            fmt.Printf(\"Thing %v is of type: %T\\n\", thing, t)\n        case float64 :\n            fmt.Printf(\"Thing %v is of type: %T\\n\", thing, t)\n        case bool :\n            fmt.Printf(\"Thing %v is of type: %T\\n\", thing, t)\n        default :\n            fmt.Printf(\"Thing %v is of unknown type\\n\", thing)\n        }\n    }\n\n}\n</code></pre>\n"}, {"tags": ["json", "go", "struct", "initialization"], "comments": [{"owner": {"reputation": 1016, "user_id": 8456454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f627dc7d8a375702876cbfc2a22f168?s=128&d=identicon&r=PG&f=1", "display_name": "gsquaredxc", "link": "https://stackoverflow.com/users/8456454/gsquaredxc"}, "edited": false, "score": 1, "creation_date": 1513873587, "post_id": 47928983, "comment_id": 82826478, "body": "Do you want people to improve your code? I&#39;m a little confused."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1513873658, "post_id": 47928983, "comment_id": 82826521, "body": "It will take more than 2 lines to remove those 2 similar looking lines. What do you want exactly?"}, {"owner": {"reputation": 17, "user_id": 8671149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b261476d37d9dbeeab2cf21ec2d81b40?s=128&d=identicon&r=PG", "display_name": "Phong", "link": "https://stackoverflow.com/users/8671149/phong"}, "edited": false, "score": 0, "creation_date": 1513873767, "post_id": 47928983, "comment_id": 82826592, "body": "if im adding new Properties to my struct like e.g  Foo string. I have to call each new properties again with person[0].Foo  to randomizing them. Is there a better way to optimizing it?                                                                     Ideas to optimizing my Code should be enough i dont dare to ask ya for a complete solution."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1513874003, "post_id": 47928983, "comment_id": 82826734, "body": "3 lines of &quot;redundancy&quot; isn&#39;t worth eliminating. You&#39;ll make your code harder to read."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513874045, "post_id": 47928983, "comment_id": 82826760, "body": "It&#39;s about as optimized as it can be. Reducing the rework necessary when adding a field means using reflection which will be slower, i.e. de-optimizing."}, {"owner": {"reputation": 17, "user_id": 8671149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b261476d37d9dbeeab2cf21ec2d81b40?s=128&d=identicon&r=PG", "display_name": "Phong", "link": "https://stackoverflow.com/users/8671149/phong"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513874195, "post_id": 47928983, "comment_id": 82826843, "body": "@Flimzy now instead of 3 lines think about 100"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513874357, "post_id": 47928983, "comment_id": 82826932, "body": "If the 100 lines are that simple, just use 100 lines (I&#39;d move them into a stand-alone function, say <code>SetRandomValues(person)</code> or something, to leave your code flow more readable).  &quot;Redundancy&quot; in this case, is both <i>faster</i> and <i>more readable</i> than the alternative."}, {"owner": {"reputation": 864, "user_id": 4024592, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e7cf006b751bd1eb6c9d62b5a4bfb797?s=128&d=identicon&r=PG&f=1", "display_name": "Joey Harwood", "link": "https://stackoverflow.com/users/4024592/joey-harwood"}, "edited": false, "score": 0, "creation_date": 1513874915, "post_id": 47928983, "comment_id": 82827236, "body": "This would likely be better received as a question on Code Review."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1513890133, "last_edit_date": 1513890133, "creation_date": 1513874998, "answer_id": 47929381, "question_id": 47928983, "link": "https://stackoverflow.com/questions/47928983/how-to-add-struct-properties-dynamically-to-avoid-redundancy-code/47929381#47929381", "title": "How to add struct properties dynamically to avoid redundancy code?", "body": "<p>Without touching reflection, the following code is cleaner and shorter, yet identical to what your code is doing, and can be easily extended for new fields:</p>\n\n<pre><code>c := func() string { return CreateRandomChars(CreateRandomNumbers(8, 16)) }\n\np := persons[0]\np.Name = c()\np.Text = c()\np.Status = c()\n\npersons = append([]Person{p}, persons[:len(persons)-1]...)\n</code></pre>\n\n<p>Although I don't really understand why you're duplicating the first slice element and dropping the last. More logical would be to just alter the first element and not drop the last.</p>\n\n<p>A slightly modified version where the utility takes a <code>string</code> pointer could look like this:</p>\n\n<pre><code>c := func(s *string) { *s = CreateRandomChars(CreateRandomNumbers(8, 16)) }\n\np := persons[0]\nc(&amp;p.Name)\nc(&amp;p.Text)\nc(&amp;p.Status)\n\npersons = append([]Person{p}, persons[:len(persons)-1]...)\n</code></pre>\n\n<p>This pointer version can also be simplified further if the number of fields grows, as you can pass them using a <code>for</code> loop:</p>\n\n<pre><code>c := func(s *string) { *s = CreateRandomChars(CreateRandomNumbers(8, 16)) }\n\np := persons[0]\nfor _, s := range []*string{&amp;p.Name, &amp;p.Text, &amp;p.Status} {\n    c(s)\n}\n\npersons = append([]Person{p}, persons[:len(persons)-1]...)\n</code></pre>\n\n<p>And now that we're referring to the <code>c()</code> function variable only once, we can even leave it out entirely:</p>\n\n<pre><code>p := persons[0]\nfor _, s := range []*string{&amp;p.Name, &amp;p.Text, &amp;p.Status} {\n    *s = CreateRandomChars(CreateRandomNumbers(8, 16))\n}\n\npersons = append([]Person{p}, persons[:len(persons)-1]...)\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 8671149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b261476d37d9dbeeab2cf21ec2d81b40?s=128&d=identicon&r=PG", "display_name": "Phong", "link": "https://stackoverflow.com/users/8671149/phong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "closed_date": 1515016211, "accepted_answer_id": 47929381, "answer_count": 1, "score": -1, "last_activity_date": 1513890133, "creation_date": 1513873489, "last_edit_date": 1513875750, "question_id": 47928983, "link": "https://stackoverflow.com/questions/47928983/how-to-add-struct-properties-dynamically-to-avoid-redundancy-code", "closed_reason": "Needs details or clarity", "title": "How to add struct properties dynamically to avoid redundancy code?", "body": "<p>Hi I'm basically struggling to avoid redundancy in my Code.</p>\n\n<p>Here is my Struct:</p>\n\n<pre><code>type Person struct {\n    Name   string\n    Text   string\n    Status string\n}\n</code></pre>\n\n<p>Here is my Func:</p>\n\n<pre><code>func ReworkElementsFromClient(w http.ResponseWriter, r *http.Request){\n    var persons []Person\n    err := json.NewDecoder(r.Body).Decode(&amp;persons)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusBadRequest)\n        return\n    }\n\n    if len(persons) == 0 {\n        err = json.NewEncoder(w).Encode(persons)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n        }\n        return\n    }\n\n    persons = append([]Person{persons[0]}, persons...)\n    persons = persons[:len(persons)-1]\n\n//Trying to avoid redundancy here \n    persons[0].Name = CreateRandomChars(CreateRandomNumbers(8, 16))\n    persons[0].Text = CreateRandomChars(CreateRandomNumbers(8, 16))\n    persons[0].Status = CreateRandomChars(CreateRandomNumbers(8, 16))\n\n    err = json.NewEncoder(w).Encode(persons)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n        }\n    return\n    }\n</code></pre>\n\n<p>How to avoid calling each properties at <code>Person[0]</code> to randomizing them?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1513872598, "post_id": 47928695, "comment_id": 82825907, "body": "What is <code>ftr</code>, and where is it&#39;s type declaration?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513872658, "post_id": 47928695, "comment_id": 82825940, "body": "@JimB give me a min and I update the question"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513872867, "post_id": 47928695, "comment_id": 82826056, "body": "@JimB - I&#39;ve added the structs"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1513873548, "post_id": 47928877, "comment_id": 82826449, "body": "Thanks i&#39;ve close the question , What is the preferred direction , option 1 or two, for your POV"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513873636, "post_id": 47928877, "comment_id": 82826512, "body": "@Ninawatcher: pointers allow for more flexibility, especially if you need to differentiate between and empty string and no setting at all. Either way is fine depending on your needs."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1513873198, "creation_date": 1513873198, "answer_id": 47928877, "question_id": 47928695, "link": "https://stackoverflow.com/questions/47928695/update-value-in-struct-not-working/47928877#47928877", "title": "Update value in struct not working", "body": "<p>You can either use pointers:</p>\n\n<pre><code>type FTR struct {\n    Id  string\n    Mod []*Mod\n}\n</code></pre>\n\n<p>Or address your items directly</p>\n\n<pre><code>for i := range ftr.Mod {\n    switch ftr.Mod[i].Type {\n    case \"aaa\", \"bbbb\":\n        ftr.Mod[i].Type = \"cccc\"\n    case \"htr\":\n        ftr.Mod[i].Type = \"com\"\n    case \"no\":\n        ftr.Mod[i].Type = \"jnodejs\"\n    case \"jdb\":\n        ftr.Mod[i].Type = \"tomcat\"\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1513886705, "creation_date": 1513886705, "answer_id": 47932018, "question_id": 47928695, "link": "https://stackoverflow.com/questions/47928695/update-value-in-struct-not-working/47932018#47932018", "title": "Update value in struct not working", "body": "<p>While rangin over elements you get a copy of the element. Thats why changing it doesn't change original value.</p>\n\n<p>You may iterate over indices and change elements. And you do not need change slice to pointers:</p>\n\n<pre><code>type FTR struct {\n    Id       string     \n    Mod      []Mod  \n}\n\nfor index := range ftr.Mod{\n    switch ftr.Mod[index].Type {\n    case \u201caaa\u201d, \u201cbbbb\u201d:\n        ftr.Mod[index].Type = \"cccc\u201d\n    case \"htr\u201d:\n        ftr.Mod[index].Type = \"com\"\n    case \"no\":\n        ftr.Mod[index].Type = \"jnodejs\"\n    case \"jdb\u201d:\n        ftr.Mod[index].Type = \"tomcat\"\n    }\n\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 47928877, "answer_count": 2, "score": 1, "last_activity_date": 1513886705, "creation_date": 1513872538, "last_edit_date": 1513872851, "question_id": 47928695, "link": "https://stackoverflow.com/questions/47928695/update-value-in-struct-not-working", "title": "Update value in struct not working", "body": "<p>i\u2019ve struct with value and I run with loop to update value, while debug the code\nI see that it enter to the case lines like <code>element.Type = \"cccc\u201d</code> but after the loop exit when I look \nat ftr the old value exist and its not updated, what am I missing here ?</p>\n\n<pre><code>ftr := FTR{}\n\nerr = yaml.Unmarshal([]byte(yamlFile), &amp;ftr)\n\nfor index, element := range ftr.Mod{\n\n    switch element.Type {\n    case \u201caaa\u201d, \u201cbbbb\u201d:\n        element.Type = \"cccc\u201d\n    case \"htr\u201d:\n        element.Type = \"com\"\n    case \"no\":\n        element.Type = \"jnodejs\"\n    case \"jdb\u201d:\n        element.Type = \"tomcat\"\n    }\n\n}\n</code></pre>\n\n<p>This is the struct</p>\n\n<pre><code>type FTR struct {\n    Id            string     \n    Mod      []Mod  \n}\n\n\ntype Mod struct {\n    Name       string\n    Type       string\n}\n</code></pre>\n"}, {"tags": ["json", "rest", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513872358, "post_id": 47928600, "comment_id": 82825771, "body": "<code>json.Marshal</code> returns an error and a byte slice with the encoded JSON. You&#39;re discarding both, and never writing to the response writer, so no, nothing gets output to the browser. The <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>json</code> package is well-documented</a>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1513886114, "post_id": 47928600, "comment_id": 82832744, "body": "To send some response data back to the client the <i>handler</i> needs to first write that data to the response, that&#39;s where the <code>http.ResponseWriter</code> interface comes in, it allows you to write arbitrary bytes that the client will receive as the response body. So the handler must use <code>w</code> to send data back to the client, without it the client will get an empty body instead."}], "answers": [{"tags": [], "owner": {"reputation": 483, "user_id": 9042843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d3c6cd6044d8d1ba7e4968fb0a1b2c5?s=128&d=identicon&r=PG", "display_name": "Nathan", "link": "https://stackoverflow.com/users/9042843/nathan"}, "is_accepted": true, "score": 2, "last_activity_date": 1513873952, "creation_date": 1513873952, "answer_id": 47929105, "question_id": 47928600, "link": "https://stackoverflow.com/questions/47928600/how-do-i-return-a-struct-as-valid-json-in-a-rest-endpoint/47929105#47929105", "title": "How do I return a struct as valid JSON in a REST endpoint?", "body": "<p>It looks like you're coming from Ruby or another language where a value in the tail position is the return value and exceptions are used to handle errors. In Go you need to be explicit with both error handling and returns.</p>\n\n<p>This is a good article for developing a web app in Go;</p>\n\n<p><a href=\"https://golang.org/doc/articles/wiki/\" rel=\"nofollow noreferrer\">https://golang.org/doc/articles/wiki/</a></p>\n\n<p>In terms of your returnStocksFromMemory I would make the following changes ensuring you update HandleFunc with the new name appropriately:</p>\n\n<pre><code>func stocksHandler(w http.ResponseWriter, r *http.Request) {\n    enc := json.NewEncoder(w)\n    err := enc.Encode(StockDataMap)\n    if err != nil {\n      http.Error(w, err.Error(), http.StatusInternalServerError)\n      return\n    }\n}\n</code></pre>\n\n<p>Note as your code is outlined it will only return <code>{}</code>. You need to populate the <code>StockDataMap</code> with values. The change in function name is two-fold;</p>\n\n<ol>\n<li>Idiomatic Go uses concise names.</li>\n<li>Handler is generally used as a postfix for http handlers.</li>\n</ol>\n\n<p>I would encourage you to read Effective Go article to help you map your current model of development to Go;</p>\n\n<p><a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html</a></p>\n\n<p>On naming things you can review this slide deck;</p>\n\n<p><a href=\"https://talks.golang.org/2014/names.slide#1\" rel=\"nofollow noreferrer\">https://talks.golang.org/2014/names.slide#1</a></p>\n"}], "owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 47929105, "answer_count": 1, "score": -1, "last_activity_date": 1513873952, "creation_date": 1513872212, "question_id": 47928600, "link": "https://stackoverflow.com/questions/47928600/how-do-i-return-a-struct-as-valid-json-in-a-rest-endpoint", "title": "How do I return a struct as valid JSON in a REST endpoint?", "body": "<p>I am fetching some data from an API, which I want to serve in a REST endpoint from my Go application.</p>\n\n<p>the struct is as such: </p>\n\n<pre><code>type Stock struct {\n    Stock     string            `json:\"message_id,omitempty\"`\n    StockData  map[string]interface{} `json:\"status,omitempty\"`\n}\n\n//\nvar StockDataMap Stock\n</code></pre>\n\n<p>And if printed in the console, it looks as it's supposed to.</p>\n\n<p>My controller is as such:</p>\n\n<pre><code>package lib\n\nimport (\n    \"net/http\"\n    \"log\"\n    \"encoding/json\"\n)\n\nfunc returnStocksFromMemory(w http.ResponseWriter, r *http.Request) {\n    json.Marshal(StockDataMap)\n}\n\n\n// Expose controller at http://localhost:8081/\nfunc StockMarketDataController() {\n    http.HandleFunc(\"/stocks\", returnStocksFromMemory)\n    log.Fatal(http.ListenAndServe(\":8081\", nil))\n}\n</code></pre>\n\n<p>Printing <code>StockDataMap</code> results in a key:hashtable, which is what I want. However, when accessing <code>http://localhost:8081/stocks</code>, it returns nothing.</p>\n\n<p>returnStocksFromMemory surely is the problem. But how do I return the struct to valid JSON in there? Right now, it's empty as said. </p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513874295, "post_id": 47928455, "comment_id": 82826907, "body": "Does your SQL have an &#39;ON DUPLICATE&#39; or similar clause?"}, {"owner": {"reputation": 1545, "user_id": 2599698, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/828702589/picture?type=large", "display_name": "Jay Cee", "link": "https://stackoverflow.com/users/2599698/jay-cee"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513875531, "post_id": 47928455, "comment_id": 82827515, "body": "At least I never specified one!"}, {"owner": {"reputation": 483, "user_id": 9042843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d3c6cd6044d8d1ba7e4968fb0a1b2c5?s=128&d=identicon&r=PG", "display_name": "Nathan", "link": "https://stackoverflow.com/users/9042843/nathan"}, "edited": false, "score": 0, "creation_date": 1513875708, "post_id": 47928455, "comment_id": 82827609, "body": "Can you include which of the mysql drivers you&#39;re using? There are two listed here; <a href=\"https://github.com/golang/go/wiki/SQLDrivers\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/SQLDrivers</a> 1. github.com/ziutek/mymysql 2. github.com/go-sql-driver/mysql"}, {"owner": {"reputation": 1545, "user_id": 2599698, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/828702589/picture?type=large", "display_name": "Jay Cee", "link": "https://stackoverflow.com/users/2599698/jay-cee"}, "edited": false, "score": 0, "creation_date": 1513879239, "post_id": 47928455, "comment_id": 82829314, "body": "Aaah well done about it, I didn&#39;t checked and I was still using the gorm one. I&#39;ll check if it changes when I use: &quot;github.com/go-sql-driver/mysql&quot; Thanks!"}, {"owner": {"reputation": 483, "user_id": 9042843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d3c6cd6044d8d1ba7e4968fb0a1b2c5?s=128&d=identicon&r=PG", "display_name": "Nathan", "link": "https://stackoverflow.com/users/9042843/nathan"}, "edited": false, "score": 0, "creation_date": 1513880487, "post_id": 47928455, "comment_id": 82829892, "body": "GORM uses github.com/go-sql-driver/mysql under the hood;  <a href=\"https://github.com/jinzhu/gorm/search?utf8=%E2%9C%93&amp;q=mysql&amp;type=\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm/&hellip;</a>"}, {"owner": {"reputation": 1545, "user_id": 2599698, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/828702589/picture?type=large", "display_name": "Jay Cee", "link": "https://stackoverflow.com/users/2599698/jay-cee"}, "edited": false, "score": 0, "creation_date": 1513880570, "post_id": 47928455, "comment_id": 82829925, "body": "Ah, so I was already using this one : ("}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1513931673, "post_id": 47928455, "comment_id": 82845497, "body": "Possibly the prepared statements are running on different connections. Prepare statements from the same Tx (transaction) to verify. Read <a href=\"http://go-database-sql.org/prepared.html\" rel=\"nofollow noreferrer\">prepared statements</a> for details"}], "owner": {"reputation": 1545, "user_id": 2599698, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/828702589/picture?type=large", "display_name": "Jay Cee", "link": "https://stackoverflow.com/users/2599698/jay-cee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 267, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1513872472, "creation_date": 1513871622, "last_edit_date": 1513872472, "question_id": 47928455, "link": "https://stackoverflow.com/questions/47928455/go-database-sql-lastinsertid-returns-weird-value", "title": "go database/sql lastinsertid returns weird value", "body": "<p>I've got a big list of records (~21k) that I'm sending to a mysql database.</p>\n\n<p>Now in order to optimise the process, every 500 documents I'm doing a request:</p>\n\n<pre><code>for k, record := range records {\n    ...\n    sqlStatement = \"INSERT INTO ...\"\n    if k%500 == 0 {\n        stmt, err := db.Prepare(sqlStatement)\n        if err != nil {\n            log.Println(err)\n        }\n        res, err := stmt.Exec(valuesArgs...)\n        if err != nil {\n            log.Println(err)\n        }\n        fmt.Println(res.LastInsertId()) //Print 19895\n    }\n}\n</code></pre>\n\n<p>Once I finish to loop over my records I still do one more insert in case we don't have a multiple of 500 at the end of the loop:</p>\n\n<pre><code>...\nstmt, err := db.Prepare(sqlStatement)\nif err != nil {\n    log.Println(err)\n}\nres, err := stmt.Exec(valuesArgs...)\nif err != nil {\n    log.Println(err)\n}\nfmt.Println(res.LastInsertId()) // print 20394\n</code></pre>\n\n<p>And I'm quite surprised to see that it's showing an id of 20394, but in the DB the maximum id is 20741.</p>\n\n<p>Between the id within the for last loop and the id after it, there is a difference of 499.</p>\n\n<p>This I tried to put the smtc within a structure and close it after the loop / before last call, but no, it changed nothing!</p>\n\n<p>Any idea why the last id isn't the last one inserted (20741)?</p>\n"}, {"tags": ["dictionary", "go", "struct", "hashmap", "yaml"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1513867880, "post_id": 47927333, "comment_id": 82823048, "body": "Thanks you very much, 1+ can you please also provide the e.g. with the interface (<code>map[string]interface{}</code>)and how I should get the data from it as answer, now its maven opts and build parameters but it can be any values with this structure....<code>MavenOpts</code> on your example is hardcode and it can be any value..."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513868261, "post_id": 47927333, "comment_id": 82823298, "body": "Type assertions are well-documented <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">in the tour</a> and <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">in the spec</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1513868264, "post_id": 47927333, "comment_id": 82823303, "body": "my biggest lack of knowlage here that if I use the <code>map[string]interface{}</code>, how should I access to find the value e.g. for <code>skipTests</code> ..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1513868332, "post_id": 47927333, "comment_id": 82823353, "body": "Thanks but here its a deep structure ...which is a bit diffrent and a bit complicated"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1513868459, "post_id": 47927333, "comment_id": 82823450, "body": "It&#39;s not at all different. You do the exact same type assertion you find in the documentation at each level of nesting."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1513868829, "post_id": 47927333, "comment_id": 82823693, "body": "Thanks a lot Adrian"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1513868427, "last_edit_date": 1513868427, "creation_date": 1513867497, "answer_id": 47927333, "question_id": 47926697, "link": "https://stackoverflow.com/questions/47926697/construct-deep-struct-is-not-working/47927333#47927333", "title": "Construct deep struct is not working", "body": "<p>Your struct does not match the data structure. If <code>Parameters</code> is a <code>map[string]string</code>, it accepts key-value pairs where the key and value are both <code>string</code>. In your data, <code>build-parameters</code> contains an object, which contains an object, which contains a key-value pair.</p>\n\n<p>You could either redefine <code>Parameters</code> to be <code>map[string]interface{}</code> and use type assertions, or you can define the entire structure, e.g.:</p>\n\n<pre><code>type Parameters struct {\n    MavenOpts struct {\n        Defines map[string]string\n    } `yaml:\"maven-opts\"`\n}\n</code></pre>\n\n<p>If you use the empty interface, you'll have to use type assertions, which can get pretty cumbersome. For example:</p>\n\n<pre><code>if opts, ok := module.Parameters[\"maven-opts\"].(map[string]interface{}); ok {\n    if defines,ok := opts[\"defines\"].(map[string]interface{}); ok {\n        if skipTests,ok := defines[\"skipTests\"].(bool); ok {\n            // skipTests is the bool value from the yaml\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 47927333, "answer_count": 1, "score": -1, "last_activity_date": 1513868427, "creation_date": 1513865262, "last_edit_date": 1513867399, "question_id": 47926697, "link": "https://stackoverflow.com/questions/47926697/construct-deep-struct-is-not-working", "title": "Construct deep struct is not working", "body": "<p>i\u2019ve struct which responsible to parse data from yaml file\nWhile this struct is working sometimes I got some newly fields which I need to parse </p>\n\n<p><strong>This is working</strong></p>\n\n<pre><code>  - name: test1\n    type: type\n    path: path\n</code></pre>\n\n<p><strong>This is not</strong> </p>\n\n<pre><code> - name: test1\n    type: type\n    path: path\n    build-parameters:\n       maven-opts:\n          defines:\n              skipTests: true\n</code></pre>\n\n<p><strong>This is the struct</strong> </p>\n\n<pre><code>type Modules struct {\n    Name string\n    Type string\n    Path string\n    Parameters Parameters `yaml:\"build-parameters,omitempty\"`\n}\n</code></pre>\n\n<p>And the parameters is type of:</p>\n\n<pre><code>type Parameters map[string]string\n</code></pre>\n\n<p>How I should construct my struct to accept this build-parameters entries also?</p>\n\n<p>This is the library I use</p>\n\n<p><a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">https://github.com/go-yaml/yaml</a></p>\n"}, {"tags": ["go", "encryption", "rsa", "pgp"], "owner": {"reputation": 1824, "user_id": 831317, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/b03d2f333371de86586f2262ffb053bc?s=128&d=identicon&r=PG", "display_name": "kostas", "link": "https://stackoverflow.com/users/831317/kostas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 214, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1513866269, "creation_date": 1513862532, "last_edit_date": 1513866269, "question_id": 47925940, "link": "https://stackoverflow.com/questions/47925940/how-to-clearsign-and-encrypt-in-go-using-openpgp", "title": "How to clearsign and encrypt in go using openpgp", "body": "<p>My goal is to use read a PEM file (which contains a private key) and a passphrase to clearsign a file and then use openpgp to encrypt it using a public key that has been provided to me.</p>\n\n<p>I know I should use <code>block, _ := pem.Decode([]byte(pemFile))</code> to read the file and the <code>ParsePKCS1PrivateKey</code> but I am not sure how to clear sign the file using the key and the passphrase and then encrypt the signed using <code>golang.org/x/crypto/openpgp</code></p>\n\n<p>Reading the pem file and creating a private key is straightforward:</p>\n\n<pre><code>data, err := ioutil.ReadFile(\"myPemFile\")\nblock, _ := pem.Decode([]byte(data))\nkey, err := x509.ParsePKCS1PrivateKey(block.Bytes)\n</code></pre>\n\n<p>where the key is <code>*rsa.PrivateKey</code>. The question is how to use a passphrase and the private key to clear sign a file i.e. doing something equivalent to:</p>\n\n<pre><code>gpg --batch --passphrase-file &lt;passfile&gt; --clearsign &lt;unsigned file&gt; \n</code></pre>\n"}, {"tags": ["http", "testing", "go"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1513855454, "post_id": 47923284, "comment_id": 82815300, "body": "Possibly <code>100 Continue</code> reply code supposes some actions further so library is awaiting for next steps."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1513855737, "post_id": 47923284, "comment_id": 82815460, "body": "Why are you sending <code>100</code>? What do you expect to happen?"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 1, "creation_date": 1513858002, "post_id": 47923284, "comment_id": 82816771, "body": "Go doesn&#39;t seem to send the 100 (StatusContinue) response to the client. If you reorder it so that you write Hello3 first then it&#39;ll finally send a successful response (check out <a href=\"https://play.golang.org/p/gX1ra-xFSA8\" rel=\"nofollow noreferrer\">play.golang.org/p/gX1ra-xFSA8</a> - doesn&#39;t work on playground, but it&#39;ll on your system), and try playing around with it. And yes, what do you want to do btw ?"}, {"owner": {"reputation": 55, "user_id": 3212060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50106ad094ebce21e75fa21412960c8?s=128&d=identicon&r=PG&f=1", "display_name": "chyeh", "link": "https://stackoverflow.com/users/3212060/chyeh"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1513860752, "post_id": 47923284, "comment_id": 82818414, "body": "@EugeneLisitsky Doesn&#39;t <code>Close()</code> mean that it should shut down the server anyhow?"}, {"owner": {"reputation": 55, "user_id": 3212060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50106ad094ebce21e75fa21412960c8?s=128&d=identicon&r=PG&f=1", "display_name": "chyeh", "link": "https://stackoverflow.com/users/3212060/chyeh"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513860844, "post_id": 47923284, "comment_id": 82818480, "body": "@Flimzy I was just trying some <code>httptest</code> code and found that. I was confused if it&#39;s consider a bug."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1513861308, "post_id": 47923284, "comment_id": 82818752, "body": "That doesn&#39;t answer the question. What did you expect would happen? What is your reason for using 100? Was it just &quot;to see what happens&quot;? If so, now you know what happens."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1513861450, "post_id": 47923284, "comment_id": 82818830, "body": "@chyeh it cannot get to it - please look my answer."}, {"owner": {"reputation": 55, "user_id": 3212060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50106ad094ebce21e75fa21412960c8?s=128&d=identicon&r=PG&f=1", "display_name": "chyeh", "link": "https://stackoverflow.com/users/3212060/chyeh"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 1, "creation_date": 1513861472, "post_id": 47923284, "comment_id": 82818847, "body": "@Ravi thanks for your example! I&#39;m wondering if it&#39;s because 100 causes the server to wait for the following requests from the client. And I was just playing the <code>httptest</code> package!"}, {"owner": {"reputation": 55, "user_id": 3212060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50106ad094ebce21e75fa21412960c8?s=128&d=identicon&r=PG&f=1", "display_name": "chyeh", "link": "https://stackoverflow.com/users/3212060/chyeh"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513861943, "post_id": 47923284, "comment_id": 82819150, "body": "@Flimzy I read the <a href=\"https://golang.org/src/net/http/server.go?s=2857:5217#L81\" rel=\"nofollow noreferrer\">document</a> again and I guest I understand now. It just behaves this way."}, {"owner": {"reputation": 55, "user_id": 3212060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50106ad094ebce21e75fa21412960c8?s=128&d=identicon&r=PG&f=1", "display_name": "chyeh", "link": "https://stackoverflow.com/users/3212060/chyeh"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1513862039, "post_id": 47923284, "comment_id": 82819222, "body": "@EugeneLisitsky Thanks! I just understood. After <code>w.WriteHeader(100)</code> is called it waits."}], "answers": [{"comments": [{"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1513864818, "post_id": 47925565, "comment_id": 82820891, "body": "Well, I wonder if we can call it a bug that Go never communicates the Continue Status to the client as it probably should as per the RFC (<a href=\"https://tools.ietf.org/html/rfc7231#section-6.2.1\" rel=\"nofollow noreferrer\">tools.ietf.org/html/rfc7231#section-6.2.1</a>). One may assume not too many applications make use of this?"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 0, "last_activity_date": 1513861536, "last_edit_date": 1513861536, "creation_date": 1513861181, "answer_id": 47925565, "question_id": 47923284, "link": "https://stackoverflow.com/questions/47923284/http-responsewriter-writeheader-caused-deadlock/47925565#47925565", "title": "http.ResponseWriter.WriteHeader() caused deadlock", "body": "<p>If you slightly modify code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"net/http/httptest\"\n)\n\nfunc main() {\n    ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Write([]byte(\"Hello1\"))\n    }))\n    ts.Close()\n    ts = httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Write([]byte(\"Hello2\"))\n    }))\n    ts.Close()\n    ts = httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.WriteHeader(100)\n        w.Write([]byte(\"Hello3\"))\n    }))\n\n    fmt.Println(\"before get\")   ///// . &lt;----\n    res, err := http.Get(ts.URL)\n    fmt.Println(\"after get\")    ///// . &lt;----\n    if err != nil {\n        log.Fatal(err)\n    }\n    greeting, err := ioutil.ReadAll(res.Body)\n    res.Body.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    ts.Close()\n    fmt.Printf(\"%s\", greeting)\n}\n</code></pre>\n\n<p>and run it - you'll see only first line.</p>\n\n<p>That means Go http client want more data from you. So it hangs on line </p>\n\n<pre><code>    res, err := http.Get(ts.URL)\n</code></pre>\n\n<p>and cannot get to the <code>ts.Close()</code> below.</p>\n\n<p>Next - lets modify a test, so it will close a connection and this way release a clients waiting lock:</p>\n\n<pre><code>ts = httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(100)\n    w.Write([]byte(\"Hello3\"))\n    hj, _ := w.(http.Hijacker)\n    conn, _, _ := hj.Hijack()\n    conn.Close()\n}))\n</code></pre>\n\n<p>I close connection explicitly  but this way you get both check strings and test finishes ok. Try it.</p>\n\n<p>Of course it's a HTTP protocol violation so I get an error:</p>\n\n<pre><code>Get http://127.0.0.1:54243: net/http: HTTP/1.x transport connection broken: unexpected EOF\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 3212060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50106ad094ebce21e75fa21412960c8?s=128&d=identicon&r=PG&f=1", "display_name": "chyeh", "link": "https://stackoverflow.com/users/3212060/chyeh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 47925565, "answer_count": 1, "score": 1, "last_activity_date": 1513861536, "creation_date": 1513853265, "last_edit_date": 1513860592, "question_id": 47923284, "link": "https://stackoverflow.com/questions/47923284/http-responsewriter-writeheader-caused-deadlock", "title": "http.ResponseWriter.WriteHeader() caused deadlock", "body": "<p>I was trying to use the <code>httptest</code> package in golang. I found out something I don't understand. Here is the <a href=\"https://play.golang.org/p/-hDoay9lq0z\" rel=\"nofollow noreferrer\">code</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"net/http/httptest\"\n)\n\nfunc main() {\n    ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Write([]byte(\"Hello1\"))\n    }))\n    ts.Close()\n    ts = httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Write([]byte(\"Hello2\"))\n    }))\n    ts.Close()\n    ts = httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.WriteHeader(100)\n        w.Write([]byte(\"Hello3\"))\n    }))\n\n    res, err := http.Get(ts.URL)\n    if err != nil {\n        log.Fatal(err)\n    }\n    greeting, err := ioutil.ReadAll(res.Body)\n    res.Body.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    ts.Close()\n    fmt.Printf(\"%s\", greeting)\n}\n</code></pre>\n\n<p>In this code example, I was trying to open and close <code>httptest</code> servers several times. Somehow it caused deadlock in The Go Playground. I tried on my own environment (Go version: go1.7.4 darwin/amd64) and it caused hanging without responding at all.</p>\n\n<p>My question is: Why <code>w.WriteHeader(100)</code> caused deadlock but <code>w.WriteHeader(200)</code> doesn't? Is it the bug from the core library of Golang or just I misunderstood some usage? Tks!</p>\n"}, {"tags": ["go", "struct", "yaml"], "comments": [{"owner": {"reputation": 3269, "user_id": 93745, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8F5Wc.jpg?s=128&g=1", "display_name": "tinita", "link": "https://stackoverflow.com/users/93745/tinita"}, "edited": false, "score": 2, "creation_date": 1513858658, "post_id": 47923157, "comment_id": 82817139, "body": "Why are the quotes required? Since it is just a string it shouldn&#39;t matter"}], "answers": [{"tags": [], "owner": {"reputation": 2623, "user_id": 29564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92d5b470e97975daab3a277486e10d1a?s=128&d=identicon&r=PG", "display_name": "Tupteq", "link": "https://stackoverflow.com/users/29564/tupteq"}, "is_accepted": true, "score": 2, "last_activity_date": 1513863071, "creation_date": 1513863071, "answer_id": 47926070, "question_id": 47923157, "link": "https://stackoverflow.com/questions/47923157/issue-parsing-yaml-file/47926070#47926070", "title": "Issue parsing yaml file", "body": "<p>YAML standard doesn't require quoting of all values, only when you want to use escape sequences or you are using certain characters.</p>\n\n<p>This library you are using adds <code>\"...\"</code> around the string only when it's necessary. For example if you used a colon in string (try: \"3:0:0\") it'll stay in double quotes.</p>\n"}], "owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 1, "accepted_answer_id": 47926070, "answer_count": 1, "score": 0, "last_activity_date": 1513863071, "creation_date": 1513852899, "last_edit_date": 1513855776, "question_id": 47923157, "link": "https://stackoverflow.com/questions/47923157/issue-parsing-yaml-file", "title": "Issue parsing yaml file", "body": "<p>I have the following struct which filled after parsing yaml file\nThe issue is that the quote is missing </p>\n\n<blockquote>\n  <p>File in.yaml</p>\n</blockquote>\n\n<p>e.g. </p>\n\n<pre><code>_schema: \"3.0.0\"\nbar:\n- one\n</code></pre>\n\n<blockquote>\n  <p>File out.yaml</p>\n</blockquote>\n\n<pre><code>_schema: 3.0.0\nbar:\n- one\n</code></pre>\n\n<p>As you can see I got <strong>3.0.0</strong>  instead the <strong>\u201c3.0.0\u201d</strong> , Any idea how to overcome this </p>\n\n<p>This is a small program which I've created to demonstrate the issue</p>\n\n<pre><code>package main\n\nimport (\n    \"gopkg.in/yaml.v2\"\n    \"io/ioutil\"\n)\n\ntype Config struct {\n    Schema string `yaml:\"_schema\"`\n    Bar []string\n}\n\nfunc main() {\n\n    cfg := Config{}\n    source, err := ioutil.ReadFile(\"in.yaml\")\n    if err != nil {\n        panic(err)\n    }\n    err = yaml.Unmarshal([]byte(source), &amp;cfg)\n    if err != nil {\n        panic(err)\n    }\n    y, _ := yaml.Marshal(&amp;cfg)\n    err = ioutil.WriteFile(\"out.yaml\", y, 0644)}\n\n}\n</code></pre>\n"}, {"tags": ["go", "google-cloud-platform", "angular5"], "comments": [{"owner": {"reputation": 1804, "user_id": 6528560, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/10154210313253162/picture?type=large", "display_name": "Alexander Poshtaruk", "link": "https://stackoverflow.com/users/6528560/alexander-poshtaruk"}, "edited": false, "score": 1, "creation_date": 1513858812, "post_id": 47922837, "comment_id": 82817232, "body": "In app module file where you import routing module add useHash:true parameter. For example: RouterModule.forRoot(routes, {useHash: true})"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6043285"}, "reply_to_user": {"reputation": 1804, "user_id": 6528560, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/10154210313253162/picture?type=large", "display_name": "Alexander Poshtaruk", "link": "https://stackoverflow.com/users/6528560/alexander-poshtaruk"}, "edited": false, "score": 0, "creation_date": 1513869989, "post_id": 47922837, "comment_id": 82824365, "body": "@AlexanderPoshtaruk Great! I fixed the issue."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6043285"}, "is_accepted": true, "score": 0, "last_activity_date": 1514175141, "creation_date": 1514175141, "answer_id": 47965640, "question_id": 47922837, "link": "https://stackoverflow.com/questions/47922837/angular-5-go-webservices/47965640#47965640", "title": "Angular 5 &amp; Go Webservices", "body": "<p>In app module file where you import routing module add useHash:true parameter. For example: RouterModule.forRoot(routes, {useHash: true})</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6043285"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 1, "accepted_answer_id": 47965640, "answer_count": 1, "score": 0, "last_activity_date": 1514175141, "creation_date": 1513851894, "question_id": 47922837, "link": "https://stackoverflow.com/questions/47922837/angular-5-go-webservices", "title": "Angular 5 &amp; Go Webservices", "body": "<p>Angular 5 as a front end &amp; backend as Golang and written Services in go \nWhen the page is refreshed, the request is sent to the server which results in a page not found 404 error since the request bypasses the router in angular.</p>\n\n<p>Ex: From Routing if we call /login we are able to display a page but if refresh the same it is showing as page not found 404.</p>\n\n<p>Angular5:</p>\n\n<pre><code>const AppRoutes: Routes = [\n          { path: '/', component: SignupComponent, pathMatch: 'full' },\n          { path: 'login' , component: LoginComponent },\n          { path: 'home' , component: VisitsComponent},\n          { path: 'createavisit/:id', component: VisitComponent},\n      ];\n</code></pre>\n\n<p>go:</p>\n\n<pre><code>http.Handle(\"/\", http.FileServer(http.Dir(\"./angular/dist\")))\n    http.HandleFunc(\"/register\", RegisterHandler)\n    http.HandleFunc(\"/log\", LoginHandler)\n</code></pre>\n\n<p>Could someone help me to fix this issue</p>\n"}, {"tags": ["go", "sdk", "ibm-cloud-infrastructure"], "comments": [{"owner": {"reputation": 2550, "user_id": 6097503, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/NOAgH.png?s=128&g=1", "display_name": "live2", "link": "https://stackoverflow.com/users/6097503/live2"}, "edited": false, "score": 0, "creation_date": 1513851104, "post_id": 47922453, "comment_id": 82812725, "body": "Can you show a code example?"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9126484, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lwJ5WEqNakw/AAAAAAAAAAI/AAAAAAAAArU/lyZ8qiVm8hI/photo.jpg?sz=128", "display_name": "sheldon", "link": "https://stackoverflow.com/users/9126484/sheldon"}, "edited": false, "score": 0, "creation_date": 1513917105, "post_id": 47927574, "comment_id": 82841066, "body": "Is it the VPN Username? IBM engineer contacted me yesterday and confirmed Username and apikey is right. I just figured out the Username he mentioned is the VPN Username.Is that right?"}, {"owner": {"reputation": 1119, "user_id": 7703646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NBDP3.png?s=128&g=1", "display_name": "Albert Camacho", "link": "https://stackoverflow.com/users/7703646/albert-camacho"}, "reply_to_user": {"reputation": 13, "user_id": 9126484, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lwJ5WEqNakw/AAAAAAAAAAI/AAAAAAAAArU/lyZ8qiVm8hI/photo.jpg?sz=128", "display_name": "sheldon", "link": "https://stackoverflow.com/users/9126484/sheldon"}, "edited": false, "score": 0, "creation_date": 1513949020, "post_id": 47927574, "comment_id": 82853959, "body": "No, it isn&#39;t. Looks for &quot;API Username&quot; and &quot;Authentication Api Key&quot;. If you dont have one, then you need to generate it by clicking Generate in the Api Key column of table where all users are listed (Account &gt;&gt; Users). See <a href=\"https://knowledgelayer.softlayer.com/procedure/generate-api-key\" rel=\"nofollow noreferrer\">knowledgelayer.softlayer.com/procedure/generate-api-key</a>"}, {"owner": {"reputation": 1119, "user_id": 7703646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NBDP3.png?s=128&g=1", "display_name": "Albert Camacho", "link": "https://stackoverflow.com/users/7703646/albert-camacho"}, "reply_to_user": {"reputation": 13, "user_id": 9126484, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lwJ5WEqNakw/AAAAAAAAAAI/AAAAAAAAArU/lyZ8qiVm8hI/photo.jpg?sz=128", "display_name": "sheldon", "link": "https://stackoverflow.com/users/9126484/sheldon"}, "edited": false, "score": 0, "creation_date": 1513949373, "post_id": 47927574, "comment_id": 82854146, "body": "Here two images: 1) UserName and ApiKey <a href=\"https://docs.jamcracker.com/ver3.0/sites/default/files/Authentication_Key_%26_Username.png\" rel=\"nofollow noreferrer\">docs.jamcracker.com/ver3.0/sites/default/files/&hellip;</a>  2) Generate an ApiKey <a href=\"https://www.acentera.com/assets/images/SoftlayerGenerateAPIKey.png\" rel=\"nofollow noreferrer\">acentera.com/assets/images/SoftlayerGenerateAPIKey.png</a>"}], "tags": [], "owner": {"reputation": 1119, "user_id": 7703646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NBDP3.png?s=128&g=1", "display_name": "Albert Camacho", "link": "https://stackoverflow.com/users/7703646/albert-camacho"}, "is_accepted": true, "score": 0, "last_activity_date": 1513868304, "creation_date": 1513868304, "answer_id": 47927574, "question_id": 47922453, "link": "https://stackoverflow.com/questions/47922453/softlayer-sdk-softlayer-exception-public-access-denied/47927574#47927574", "title": "softlayer SDK SoftLayer_Exception_Public: Access Denied", "body": "<p>I didn't have issues when running your code, I recommend to check the username and apikey you are sending. See the <strong>API Access Information</strong> section in your profile <a href=\"https://control.softlayer.com/account/user/profile\" rel=\"nofollow noreferrer\">https://control.softlayer.com/account/user/profile</a> </p>\n"}, {"tags": [], "owner": {"reputation": 809, "user_id": 1222775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e13a63ecf1fe268955d7fd64789a552e?s=128&d=identicon&r=PG", "display_name": "Awah Teh", "link": "https://stackoverflow.com/users/1222775/awah-teh"}, "is_accepted": false, "score": 0, "last_activity_date": 1558290360, "creation_date": 1558290360, "answer_id": 56210786, "question_id": 47922453, "link": "https://stackoverflow.com/questions/47922453/softlayer-sdk-softlayer-exception-public-access-denied/56210786#56210786", "title": "softlayer SDK SoftLayer_Exception_Public: Access Denied", "body": "<p>It is worth noting that, it is not terribly well documented on IBM cloud, and the error messages returned are not terribly clear to this fact: Sometimes the Access Denied error you receive has more to do with the fact that you do not have an upgraded IBM pay as you go account.</p>\n\n<p>Worth keeping that in mind, for other users that may run into the same error message, but not know what to make of it.</p>\n"}], "owner": {"reputation": 13, "user_id": 9126484, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lwJ5WEqNakw/AAAAAAAAAAI/AAAAAAAAArU/lyZ8qiVm8hI/photo.jpg?sz=128", "display_name": "sheldon", "link": "https://stackoverflow.com/users/9126484/sheldon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 752, "favorite_count": 0, "accepted_answer_id": 47927574, "answer_count": 2, "score": 1, "last_activity_date": 1558290360, "creation_date": 1513850678, "last_edit_date": 1513852257, "question_id": 47922453, "link": "https://stackoverflow.com/questions/47922453/softlayer-sdk-softlayer-exception-public-access-denied", "title": "softlayer SDK SoftLayer_Exception_Public: Access Denied", "body": "<p>Using examples in <code>Go SDK</code> with Username and <code>apikey</code> returned </p>\n\n<blockquote>\n  <p>{\"error\":\"Access Denied. \",\"code\":\"SoftLayer_Exception_Public\"}</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/softlayer/softlayer-go/services\"\n    \"github.com/softlayer/softlayer-go/session\"\n    \"github.com/softlayer/softlayer-go/sl\"\n)\n\nfunc main() {\n        userName := \"xxxx\"\n        apikey := \"xxxx\"\n        sess := session.New(userName, apikey)\n        sess.Debug = true\n        doListAccountVMsTest(sess)\n}\n\nfunc doListAccountVMsTest(sess *session.Session) {\n    service := services.GetAccountService(sess)\n\n    vms, err := service.Mask(\"id;hostname;domain\").Limit(10).GetVirtualGuests()\n    if err != nil {\n        fmt.Printf(\"Error retrieving Virtual Guests from Account: %s\\n\", err)\n        return\n    } else {\n        fmt.Println(\"VMs under Account:\")\n    }\n\n    for _, vm := range vms {\n        fmt.Printf(\"\\t[%d]%s.%s\\n\", *vm.Id, *vm.Hostname, *vm.Domain)\n    }\n}\n\nfunc handleError(err error) {\n    apiErr := err.(sl.Error)\n    fmt.Printf(\n        \"Exception: %s\\nMessage: %s\\nHTTP Status Code: %d\\n\",\n        apiErr.Exception,\n        apiErr.Message,\n        apiErr.StatusCode)\n}\n</code></pre>\n"}, {"tags": ["go", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 1071, "user_id": 3296612, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/DXU72.jpg?s=128&g=1", "display_name": "xren", "link": "https://stackoverflow.com/users/3296612/xren"}, "edited": false, "score": 2, "creation_date": 1513900838, "post_id": 47927455, "comment_id": 82837963, "body": "In my case, I cann&#39;t use <code>stream.Recv()</code> to detect. I did use the second way, watch the stream.Context().Done(), but it took a very very long time to notice client is gone. I&#39;m going to implement my own heartbeat to make it work."}, {"owner": {"reputation": 1071, "user_id": 3296612, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/DXU72.jpg?s=128&g=1", "display_name": "xren", "link": "https://stackoverflow.com/users/3296612/xren"}, "edited": false, "score": 0, "creation_date": 1513900909, "post_id": 47927455, "comment_id": 82837987, "body": "By the way, yes, i unplug the cable literally! Thanks for your tips, really help a lot."}], "tags": [], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "is_accepted": true, "score": 0, "last_activity_date": 1513867911, "creation_date": 1513867911, "answer_id": 47927455, "question_id": 47922221, "link": "https://stackoverflow.com/questions/47922221/go-grpc-server-doesnt-known-client-ungraceful-dead/47927455#47927455", "title": "go grpc server doesn&#39;t known client ungraceful dead", "body": "<p>Your <code>GRPC</code> server-side handler will know about client context cancellation the next time it will try to <code>Send</code>/<code>Recv</code> message to/from stream: the error will be returned:</p>\n\n<pre><code>func (s *server) handler(stream your_service.Stream) error {\n    if err := stream.Recv(); err != nil {\n        // you will have context cancelation error here\n    }\n}\n</code></pre>\n\n<p>In some cases it may be useful to check context cancellation explicitly:</p>\n\n<pre><code>func (s *server) handler(stream your_service.Stream) error {\n     // some logic\n     select {\n         case &lt;-stream.Context().Done():\n             return stream.Context().Err()\n         default:\n     }\n}\n</code></pre>\n\n<p>By the way, do you unplug the cable literally? Because it may be treated in different ways by the operational system. Why don't you use any modern virtualization tools, like Docker, for your tests?</p>\n"}, {"tags": [], "owner": {"reputation": 675, "user_id": 1810778, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/jqVJb.jpg?s=128&g=1", "display_name": "Chris Del Guercio", "link": "https://stackoverflow.com/users/1810778/chris-del-guercio"}, "is_accepted": false, "score": 2, "last_activity_date": 1523913955, "creation_date": 1523913955, "answer_id": 49866489, "question_id": 47922221, "link": "https://stackoverflow.com/questions/47922221/go-grpc-server-doesnt-known-client-ungraceful-dead/49866489#49866489", "title": "go grpc server doesn&#39;t known client ungraceful dead", "body": "<p>I had the exact same problem as you did. In my case, when I used Ctrl-C to terminate my test client, the server detected it pretty quickly, but when I used Ctrl-Z (or if I cut power to my micro-controller) the server would take forever to close the hanging connection. You need to use some sort of heartbeat to check on the connection using something like gRPC's keepAlive feature. I had to create my own heartbeat message that I sent periodically because of a problem with using gRPC behind Envoy (<a href=\"https://github.com/envoyproxy/envoy/issues/2086\" rel=\"nofollow noreferrer\">https://github.com/envoyproxy/envoy/issues/2086</a>)</p>\n"}], "owner": {"reputation": 1071, "user_id": 3296612, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/DXU72.jpg?s=128&g=1", "display_name": "xren", "link": "https://stackoverflow.com/users/3296612/xren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1965, "favorite_count": 0, "accepted_answer_id": 47927455, "answer_count": 2, "score": 2, "last_activity_date": 1523913955, "creation_date": 1513849980, "question_id": 47922221, "link": "https://stackoverflow.com/questions/47922221/go-grpc-server-doesnt-known-client-ungraceful-dead", "title": "go grpc server doesn&#39;t known client ungraceful dead", "body": "<p>I am using go-grpc to create a bidirectional stream. When I unplug the cable, the server doesn't known client is dead for a very very long time. How can I detect client is gone in this case ???</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513855898, "post_id": 47922204, "comment_id": 82815562, "body": "Does <code>actions...</code> not work?"}, {"owner": {"reputation": 198, "user_id": 3467934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wj3za.jpg?s=128&g=1", "display_name": "Cyrille", "link": "https://stackoverflow.com/users/3467934/cyrille"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513857066, "post_id": 47922204, "comment_id": 82816270, "body": "@Flimzy nope; the compiler complains : <code>cannot use actions (type []string) as type []driver.Value in argument to mock.ExpectQuery(&quot;^select .*&quot;).WithArgs</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513860808, "post_id": 47922204, "comment_id": 82818452, "body": "Convert <code>actions</code> to type <code>[]driver.Value</code> then."}, {"owner": {"reputation": 198, "user_id": 3467934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wj3za.jpg?s=128&g=1", "display_name": "Cyrille", "link": "https://stackoverflow.com/users/3467934/cyrille"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513863892, "post_id": 47922204, "comment_id": 82820322, "body": "@Flimzy unfortunately this yields exactly the same output as in case 2."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513864677, "post_id": 47922204, "comment_id": 82820805, "body": "Sorry, which is case 2?"}, {"owner": {"reputation": 198, "user_id": 3467934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wj3za.jpg?s=128&g=1", "display_name": "Cyrille", "link": "https://stackoverflow.com/users/3467934/cyrille"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513865208, "post_id": 47922204, "comment_id": 82821155, "body": "The second one; it outputs the same as with <code>...WithArgs(actions[0], actions[1])...</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513865609, "post_id": 47922204, "comment_id": 82821431, "body": "You didn&#39;t include the full output in that case, so I&#39;m not sure what&#39;s missing."}], "answers": [{"tags": [], "owner": {"reputation": 198, "user_id": 3467934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wj3za.jpg?s=128&g=1", "display_name": "Cyrille", "link": "https://stackoverflow.com/users/3467934/cyrille"}, "is_accepted": true, "score": 1, "last_activity_date": 1513866866, "creation_date": 1513866866, "answer_id": 47927136, "question_id": 47922204, "link": "https://stackoverflow.com/questions/47922204/how-to-use-go-sqlmock-withargs-with-a-variable-number-of-arguments/47927136#47927136", "title": "How to use go-sqlmock WithArgs() with a variable number of arguments?", "body": "<p>I found a way to fix my problem : If I convert the slice of strings to a slice of interfaces for db.Query, it works just fine:</p>\n\n<pre><code>boundValues := make([]interface{}, len(actions))\n\nfor i, val := range actions {\n    boundValues[i] = val\n}\n\nrows, err := db.Query(query, boundValues...)\n</code></pre>\n\n<p>Then for the tests:</p>\n\n<pre><code>mock.ExpectQuery(`^select .*`).WithArgs(actions[0], actions[1]).WillReturnRows(rows)\n</code></pre>\n\n<p>NOTE: passing just <code>db.Query(query, actions...)</code> does not work; this results in <code>cannot use actions (type []string) as type []interface {} in argument to db.Query</code></p>\n"}, {"comments": [{"owner": {"reputation": 175, "user_id": 2149780, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/d45f9db0a43e38841c944dbaa7ae7651?s=128&d=identicon&r=PG&f=1", "display_name": "user2149780", "link": "https://stackoverflow.com/users/2149780/user2149780"}, "edited": false, "score": 0, "creation_date": 1535056719, "post_id": 49316144, "comment_id": 90937552, "body": "if int64 is in the types allowed in driver.Value, then why won&#39;t a []int64 work?"}, {"owner": {"reputation": 3996, "user_id": 1615594, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VD0n3.jpg?s=128&g=1", "display_name": "tsuz", "link": "https://stackoverflow.com/users/1615594/tsuz"}, "reply_to_user": {"reputation": 175, "user_id": 2149780, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/d45f9db0a43e38841c944dbaa7ae7651?s=128&d=identicon&r=PG&f=1", "display_name": "user2149780", "link": "https://stackoverflow.com/users/2149780/user2149780"}, "edited": false, "score": 0, "creation_date": 1535154774, "post_id": 49316144, "comment_id": 90976695, "body": "You could do  []driver.Value{&lt;int64&gt;, &lt;int64&gt;,...}"}], "tags": [], "owner": {"reputation": 3996, "user_id": 1615594, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VD0n3.jpg?s=128&g=1", "display_name": "tsuz", "link": "https://stackoverflow.com/users/1615594/tsuz"}, "is_accepted": false, "score": 4, "last_activity_date": 1521188914, "creation_date": 1521188914, "answer_id": 49316144, "question_id": 47922204, "link": "https://stackoverflow.com/questions/47922204/how-to-use-go-sqlmock-withargs-with-a-variable-number-of-arguments/49316144#49316144", "title": "How to use go-sqlmock WithArgs() with a variable number of arguments?", "body": "<p>Accepted answer using <code>[]interface{}</code> would work for string but it can throw an error for other types.</p>\n\n<p><strong>Short answer</strong></p>\n\n<pre><code>actions := []driver.Value{\"click\", \"event\"}\nmock.ExpectQuery(`^select .*`).WithArgs(actions...).WillReturnRows(rows)\n</code></pre>\n\n<p><strong>Long answer</strong></p>\n\n<p>The argument requires <code>driver.Value</code> <a href=\"https://github.com/DATA-DOG/go-sqlmock/blob/9d03611ad1ffde3b3b63004e31c67f237bc6e7c3/expectations.go#L136\" rel=\"nofollow noreferrer\">reference</a> and driver.Value can be one of these <a href=\"https://golang.org/pkg/database/sql/driver/#Value\" rel=\"nofollow noreferrer\">types</a>:</p>\n\n<ul>\n<li>int64</li>\n<li>float64</li>\n<li>bool</li>\n<li>[]byte</li>\n<li>string</li>\n<li>time.Time</li>\n</ul>\n\n<p>so, the correct answer is</p>\n\n<pre><code>actions := []driver.Value{\"click\", \"event\"}\nmock.ExpectQuery(`^select .*`).WithArgs(actions...).WillReturnRows(rows)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 13301201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/974b2df609ff862bbcd0047fbc8e006d?s=128&d=identicon&r=PG&f=1", "display_name": "9r1nc3w1ll", "link": "https://stackoverflow.com/users/13301201/9r1nc3w1ll"}, "is_accepted": false, "score": 0, "last_activity_date": 1592128754, "creation_date": 1592128754, "answer_id": 62370976, "question_id": 47922204, "link": "https://stackoverflow.com/questions/47922204/how-to-use-go-sqlmock-withargs-with-a-variable-number-of-arguments/62370976#62370976", "title": "How to use go-sqlmock WithArgs() with a variable number of arguments?", "body": "<p>A much cleaner solution would be to use this.</p>\n\n<pre><code>/* Prepare database mock */\ntype AnyNumber struct{}\n\n// Match satisfies sqlmock.Argument interface\nfunc (a AnyNumber) Match(v driver.Value) bool {\n    _, ok := v.(float64)\n    return ok\n}\n</code></pre>\n\n<p>And then use <code>AnyNumber{}</code> as the argument in <code>WithArgs</code></p>\n\n<p>Here is the reference in the docs <a href=\"https://github.com/DATA-DOG/go-sqlmock#matching-arguments-like-timetime\" rel=\"nofollow noreferrer\">Click Here</a></p>\n"}], "owner": {"reputation": 198, "user_id": 3467934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Wj3za.jpg?s=128&g=1", "display_name": "Cyrille", "link": "https://stackoverflow.com/users/3467934/cyrille"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5625, "favorite_count": 1, "accepted_answer_id": 47927136, "answer_count": 3, "score": 4, "last_activity_date": 1592128754, "creation_date": 1513849930, "question_id": 47922204, "link": "https://stackoverflow.com/questions/47922204/how-to-use-go-sqlmock-withargs-with-a-variable-number-of-arguments", "title": "How to use go-sqlmock WithArgs() with a variable number of arguments?", "body": "<p>I use go-sqlmock (<a href=\"https://godoc.org/github.com/DATA-DOG/go-sqlmock\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/DATA-DOG/go-sqlmock</a>) to test a function that receives a variable number of arguments (I simplified the function for the sake of simplicity and stripped out most of the code):</p>\n\n<pre><code>func getHits(db *sql.DB, actions ...string) (hits []Hit, err error) {\n   // ...\n   query := `select * from table where action in (?,?)`\n   rows, err := db.Query(query, actions)\n   // ...\n}\n</code></pre>\n\n<p>The tests look like that:</p>\n\n<pre><code>// rows := ...\nactions := []string{\"click\", \"event\"}\nmock.ExpectQuery(`^select .*`).WithArgs(actions).WillReturnRows(rows)\nhits, err := getHits(db, actions...)\nif mockErr := mock.ExpectationsWereMet(); mockErr != nil {\n    log.Fatalf(\"there were unfulfilled expections: %s\", mockErr)\n}\n</code></pre>\n\n<p>Then I get this output:</p>\n\n<pre><code>2017/12/21 10:38:23 there were unfulfilled expections: there is a remaining expectation which was not matched: ExpectedQuery =&gt; expecting Query or QueryRow which:\n- matches sql: '^select .*'\n- is with arguments:\n  0 - [click event]\n- should return rows: ...\n</code></pre>\n\n<p>If I change the tests like this:</p>\n\n<pre><code>mock.ExpectQuery(`^select .*`).WithArgs(actions[0], actions[1]).WillReturnRows(rows)\n</code></pre>\n\n<p>Then I get this output:</p>\n\n<pre><code>2017/12/21 10:44:41 there were unfulfilled expections: there is a remaining expectation which was not matched: ExpectedQuery =&gt; expecting Query or QueryRow which:\n- matches sql: '^select .*'\n- is with arguments:\n  0 - click\n  1 - event\n- should return rows:\n</code></pre>\n\n<p>The only I can make it pass is by calling :</p>\n\n<pre><code>db.Query(query, actions[0], actions[1])\n</code></pre>\n\n<p>which is what I obviously don't want to do as I don't know the number of actions...</p>\n\n<p>Does anyone have an idea on how I could fix or debug this ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1513848363, "post_id": 47921219, "comment_id": 82811013, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/18626933/why-does-golang-compiler-think-the-variable-is-declared-but-not-used\">Why does golang compiler think the variable is declared but not used?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 303, "user_id": 8008395, "user_type": "registered", "profile_image": "https://graph.facebook.com/1019408758194319/picture?type=large", "display_name": "Bohdan Kostko", "link": "https://stackoverflow.com/users/8008395/bohdan-kostko"}, "edited": false, "score": 0, "creation_date": 1513848237, "post_id": 47921329, "comment_id": 82810936, "body": "Still, I would recommend to use custom interface (<code>type CustomStructInterface{}</code>) instead of an empty one"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "reply_to_user": {"reputation": 303, "user_id": 8008395, "user_type": "registered", "profile_image": "https://graph.facebook.com/1019408758194319/picture?type=large", "display_name": "Bohdan Kostko", "link": "https://stackoverflow.com/users/8008395/bohdan-kostko"}, "edited": false, "score": 0, "creation_date": 1513849315, "post_id": 47921329, "comment_id": 82811576, "body": "@BohdanKostko indeed. In sake of simplicity I use an empty interface."}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 0, "last_activity_date": 1513846589, "creation_date": 1513846589, "answer_id": 47921329, "question_id": 47921219, "link": "https://stackoverflow.com/questions/47921219/assign-different-struct-to-variable-in-if-else-block-in-golang/47921329#47921329", "title": "Assign different struct to variable in If-else block in golang", "body": "<p>You can, use an <code>interface{}</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Struct1 struct {\n    a string\n}\n\ntype Struct2 struct {\n    b int\n}\n\nfunc main() {\n    var c interface{}\n    if true {\n        c = Struct1{a: \"\"}\n    } else {\n        c = Struct2{b: 1}\n    }\n    fmt.Printf(\"type %T\", c)\n}\n// Print:\n// type main.Struct1\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Z1cT9qjFmfU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Z1cT9qjFmfU</a></p>\n"}], "owner": {"reputation": 833, "user_id": 7498628, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-qMH6F-M2q4U/AAAAAAAAAAI/AAAAAAAAAA0/UpXnAhY-GiY/photo.jpg?sz=128", "display_name": "Shubham Chaudhary", "link": "https://stackoverflow.com/users/7498628/shubham-chaudhary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1557, "favorite_count": 0, "accepted_answer_id": 47921329, "answer_count": 1, "score": -1, "last_activity_date": 1513846589, "creation_date": 1513846172, "last_edit_date": 1513846475, "question_id": 47921219, "link": "https://stackoverflow.com/questions/47921219/assign-different-struct-to-variable-in-if-else-block-in-golang", "title": "Assign different struct to variable in If-else block in golang", "body": "<p>I want to do something like this</p>\n\n<pre><code>type Struct1 {\n    a string\n}\ntype Struct 2{\n    b int\n}\n\nif something{\n    c := Struct1{a:''}\n}else{\n    c := Struct2{b:1}\n}\n\nsomefunc(c)\n</code></pre>\n\n<p>I know I can't declare c inside of one block and then access it outside. </p>\n\n<p>I tried something like this </p>\n\n<pre><code>type Struct1 {\n    a string\n}\ntype Struct 2{\n    b int\n}\n\nc := Struct2{b:1}\nif something{\n    c := Struct1{a:''}\n}\n\nsomefunc(c)\n</code></pre>\n\n<p>It gives error- <code>Cannot assign Struct1 to c(type Struct2)</code>  </p>\n\n<p>How can I achieve something like this?</p>\n"}, {"tags": ["go", "google-cloud-platform", "api-key", "google-cloud-vision"], "comments": [{"owner": {"reputation": 1364, "user_id": 791842, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e22db9b1ffd20305669ffe5676baca02?s=128&d=identicon&r=PG", "display_name": "sathishvj", "link": "https://stackoverflow.com/users/791842/sathishvj"}, "edited": false, "score": 0, "creation_date": 1513848981, "post_id": 47920981, "comment_id": 82811369, "body": "I&#39;ve now implemented this without the client libraries as a regular REST call.  But still interested to know if it&#39;s possible with the client libraries."}], "answers": [{"tags": [], "owner": {"reputation": 6461, "user_id": 4482491, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dkgo5ho-Jjw/AAAAAAAAAAI/AAAAAAAAACU/9EcPCl9XBEY/photo.jpg?sz=128", "display_name": "dsesto", "link": "https://stackoverflow.com/users/4482491/dsesto"}, "is_accepted": true, "score": 3, "last_activity_date": 1513861140, "creation_date": 1513861140, "answer_id": 47925550, "question_id": 47920981, "link": "https://stackoverflow.com/questions/47920981/how-to-make-an-api-key-based-rest-call-with-google-cloud-client-library/47925550#47925550", "title": "How to make an API-key based REST call with Google Cloud client library", "body": "<p>According to what I found in the official documentation (both in <a href=\"https://github.com/GoogleCloudPlatform/google-cloud-go#authorization\" rel=\"nofollow noreferrer\">GitHub</a> and <a href=\"https://godoc.org/cloud.google.com/go\" rel=\"nofollow noreferrer\">Golang documentation</a>) of the Google Cloud client libraries for Golang, the current supported authentication methods are <strong>Google Application Default Credentials</strong> and <strong>Service Accounts</strong>, so there is no such option to authenticate using an API key.</p>\n\n<p>However, as pointed out <a href=\"https://cloud.google.com/docs/authentication/#api_keys\" rel=\"nofollow noreferrer\">in the documentation</a>, Google recommends using Service Accounts instead of API keys for security reasons, so I would suggest that you go with that option if you can.</p>\n\n<blockquote>\n  <p>API keys can be used when calling Google APIs that don't require\n  authentication, and when using Google Cloud Endpoints. <strong>For security\n  reasons, we recommend using service accounts instead</strong>.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "is_accepted": false, "score": 0, "last_activity_date": 1518645078, "creation_date": 1518645078, "answer_id": 48796844, "question_id": 47920981, "link": "https://stackoverflow.com/questions/47920981/how-to-make-an-api-key-based-rest-call-with-google-cloud-client-library/48796844#48796844", "title": "How to make an API-key based REST call with Google Cloud client library", "body": "<p>@dsesto is right, it's always better to use a Service Account to authenticate. However, if you want to use an API key, it should work.</p>\n\n<p>I've opened a <a href=\"https://github.com/google/google-api-go-client/issues/252\" rel=\"nofollow noreferrer\">github issue</a> on that library explaining the error.</p>\n\n<p>The same request using curl works properly (no credentials):</p>\n\n<pre><code>curl https://vision.googleapis.com/v1/images:annotate?key=&lt;API_KEY&gt;  -H'content-type:application/json' -d'{\n \"requests\": [\n  {\n   \"image\": {\n    \"source\": {\n     \"imageUri\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Google_2015_logo.svg/1200px-Google_2015_logo.svg.png\"\n    }\n   },\n   \"features\": [\n    {\n     \"type\": \"LABEL_DETECTION\"\n    }\n   ]\n  }\n ]\n}'\n</code></pre>\n"}], "owner": {"reputation": 1364, "user_id": 791842, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e22db9b1ffd20305669ffe5676baca02?s=128&d=identicon&r=PG", "display_name": "sathishvj", "link": "https://stackoverflow.com/users/791842/sathishvj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1843, "favorite_count": 0, "accepted_answer_id": 47925550, "answer_count": 2, "score": 0, "last_activity_date": 1518645078, "creation_date": 1513845288, "last_edit_date": 1513866358, "question_id": 47920981, "link": "https://stackoverflow.com/questions/47920981/how-to-make-an-api-key-based-rest-call-with-google-cloud-client-library", "title": "How to make an API-key based REST call with Google Cloud client library", "body": "<p>I'm trying to make an API call to Google Cloud Vision API using an API key from Golang. But I'm getting a <code>400: bad request, invalid_grant error</code>.  </p>\n\n<p>The apiKey/apiKeyOption part of the code below is mine.</p>\n\n<p>What is the right way to make this call?  Is it possible at all?</p>\n\n<pre><code>import (\n    // ...\n    \"google.golang.org/api/option\"\n    vision \"cloud.google.com/go/vision/apiv1\"\n    \"golang.org/x/net/context\"\n)\n\nfunc getImageLabels(filename string) []string {\n\n    ctx := context.Background()\n\n    apiKey := \"...\" // I have a valid api key generated in the console.\n    apiKeyOption := option.WithAPIKey(apiKey)\n\n    client, err := vision.NewImageAnnotatorClient(ctx, apiKeyOption)\n\n    // ...\n    labels, err := client.DetectLabels(ctx, image, nil, 10)\n\n}\n</code></pre>\n\n<p>...</p>\n\n<pre><code>Failed to detect labels: rpc error: code = Internal desc = transport: oauth2: cannot fetch token: 400 Bad Request\nResponse: {\n  \"error\" : \"invalid_grant\"\n}\n</code></pre>\n"}, {"tags": ["go", "interface", "mocking", "statsd"], "answers": [{"tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": true, "score": 3, "last_activity_date": 1513878322, "creation_date": 1513878322, "answer_id": 47930166, "question_id": 47919776, "link": "https://stackoverflow.com/questions/47919776/mock-statsd-client-in-go-test-package/47930166#47930166", "title": "Mock statsd client in Go test package", "body": "<p>Many of the project I work on use statsd and have teetered between just leaving the calls in the tests, because they are so lightweight, and programming to a metrics interface (as you have already done <code>StasdAccess</code>).</p>\n\n<p>Since the interface is already initialized, you should be able to use the interface to break the configuration dependency in your code, and provide a <a href=\"https://about.sourcegraph.com/go/advanced-testing-in-go/#testing-as-a-public-api\" rel=\"nofollow noreferrer\">test implementation</a> to use in your tests:</p>\n\n<pre><code>package_metrics/\n   testing.go\n</code></pre>\n\n<hr>\n\n<pre><code>// testing.go\n\ntype StubStatsd struct {}\nfunc (s StubStatsd) Inc(stat string, value int64, rate float32) error {\n  return nil\n}\nfunc (s StubStatsd) Gauge(...\nfunc (s StubStatsd) Timing(...\n</code></pre>\n\n<p>Now when your tests would like to call a method or initialize a component that requires a <code>StatsdAccess</code> parameter it could use the testing stub to meet the requirements</p>\n\n<pre><code>func TestSomething_NeedsStatsd(t *testing.T) {\n     statsdStub := StubStatsd{}\n     someMethodThatRequiresStatsd(stasdStub)\n}\n</code></pre>\n"}], "owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 701, "favorite_count": 0, "accepted_answer_id": 47930166, "answer_count": 1, "score": 0, "last_activity_date": 1513878322, "creation_date": 1513840471, "last_edit_date": 1513840893, "question_id": 47919776, "link": "https://stackoverflow.com/questions/47919776/mock-statsd-client-in-go-test-package", "title": "Mock statsd client in Go test package", "body": "<p>I use <a href=\"https://github.com/cactus/go-statsd-client\" rel=\"nofollow noreferrer\">this</a> <code>statsd package</code> to send metrics to our <code>statsd server</code>. To initialize the client, I call a <code>metrics.Setup()</code> in my main which does the init. This package looks like this:</p>\n\n<p><strong>package:</strong></p>\n\n<pre><code>package metrics\n\nimport (\n    \"fmt\"\n\n    \"github.com/cactus/go-statsd-client/statsd\"\n)\n\n// Client can be used to send stats to\nvar Client StatsdAccess\n\n// Setup initialises metrics gathering\nfunc Setup() {\n    if Client == nil {\n        prefix := fmt.Sprintf(\"app.%s\", logging.GetHost())\n        std, err := statsd.NewBufferedClient(fmt.Sprintf(\"localhost:1234\", prefix, 0, 0)\n        if err != nil {\n            logrus.Errorf(\"unable to dial the statsd host: %q\", err)\n            return\n        }\n        Client = std\n    }\n}\n\n// StatsdAccess is used as interface to statsd functions\ntype StatsdAccess interface {\n    Inc(stat string, value int64, rate float32) error\n    Gauge(stat string, value int64, rate float32) error\n    Timing(stat string, delta int64, rate float32) error\n}\n</code></pre>\n\n<p>From this moment on, the other package send metrics though this global Client by doing this: <code>metrics.Client.Inc(\"some.counter\", 1, 1.0)</code>. This works fine, but now I have a problem with my test files. They now fail when a package actually uses the <code>metrics package</code> to send metrics. This is obvious, because the metrics package has not been initialized, etc. So my question -I think- is: how can I mock the <code>statsd client</code> in my test files?</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 6, "creation_date": 1513837349, "post_id": 47919017, "comment_id": 82805739, "body": "Deref pointers with *. <i>Please</i> take the Tour of Go. Now."}, {"owner": {"reputation": 47, "user_id": 4003965, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/100004587033109/picture?type=large", "display_name": "Ahmed Ashraf", "link": "https://stackoverflow.com/users/4003965/ahmed-ashraf"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1520154364, "post_id": 47919017, "comment_id": 85192575, "body": "Okay I well and Thanks :)"}], "answers": [{"tags": [], "owner": {"reputation": 68, "user_id": 8233041, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-O9Zdub1OlY0/AAAAAAAAAAI/AAAAAAAAAJE/vNGgfBuy2bI/photo.jpg?sz=128", "display_name": "Vinay Mahamuni", "link": "https://stackoverflow.com/users/8233041/vinay-mahamuni"}, "is_accepted": true, "score": 0, "last_activity_date": 1513837710, "creation_date": 1513837710, "answer_id": 47919155, "question_id": 47919017, "link": "https://stackoverflow.com/questions/47919017/get-value-from-pointer/47919155#47919155", "title": "Get value from pointer", "body": "<p>Try using </p>\n\n<p><code>fmt.prinln(*result.Total)</code></p>\n"}], "owner": {"reputation": 47, "user_id": 4003965, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/100004587033109/picture?type=large", "display_name": "Ahmed Ashraf", "link": "https://stackoverflow.com/users/4003965/ahmed-ashraf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 744, "favorite_count": 0, "accepted_answer_id": 47919155, "answer_count": 1, "score": -5, "last_activity_date": 1513855971, "creation_date": 1513837061, "last_edit_date": 1513855971, "question_id": 47919017, "link": "https://stackoverflow.com/questions/47919017/get-value-from-pointer", "title": "Get value from pointer", "body": "<p>I'm using a github sdk for Go. The github sdk return a struct object like:</p>\n\n<pre><code>type IssuesSearchResult struct {\n    Total             *int    `json:\"total_count,omitempty\"`\n    IncompleteResults *bool   `json:\"incomplete_results,omitempty\"`\n    Issues            []Issue `json:\"items,omitempty\"`\n}\n</code></pre>\n\n<p>If I want to print the total number like</p>\n\n<pre><code>result := client.Search.Issues.....\nfmt.prinln(result.Total)\n</code></pre>\n\n<p>it will print the address in memory like <code>0xc420228080</code> but I want the real value like 4 or 5 , I tried to find how can I do that but I couldn't get the correct answer</p>\n"}, {"tags": ["go", "bigdata"], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1513856403, "post_id": 47920483, "comment_id": 82815859, "body": "I&#39;d also note that pretty much &quot;standard&quot; <a href=\"https://github.com/boltdb/bolt\" rel=\"nofollow noreferrer\">BoltDB</a> appears to handle 1TB data sets\u2014according to the project&#39;s docs. There&#39;s also a battle-tested <a href=\"https://github.com/syndtr/goleveldb\" rel=\"nofollow noreferrer\">LevelDB</a>, but I&#39;m not sure about its size limits."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1513855279, "last_edit_date": 1513855279, "creation_date": 1513843444, "answer_id": 47920483, "question_id": 47918487, "link": "https://stackoverflow.com/questions/47918487/bigfiles-in-golang/47920483#47920483", "title": "Bigfiles in Golang", "body": "<p>The recommended solution depends on your unposted requirements, such as do you need to modify the files? Do you need the ability to remove them? Do you need distributed storage etc?</p>\n\n<p>If you only need to add new files which you don't intend to change, you may use <a href=\"https://github.com/icza/kvcache\" rel=\"nofollow noreferrer\"><code>github.com/icza/kvcache</code></a> (disclosure: I'm the author). <code>kvcache</code> stores all entries in 2 files only (1 for index and 1 for data), and keeps the index in memory too, so lookups are as fast as possible, and transferring the files is equivalent to copying 2 files only.</p>\n\n<p>MongoDB has <a href=\"https://docs.mongodb.com/manual/core/gridfs/\" rel=\"nofollow noreferrer\">GridFS</a> which gives you a file system-like API and allows you to store metadata for files and search them. The <a href=\"https://godoc.org/gopkg.in/mgo.v2\" rel=\"nofollow noreferrer\"><code>mgo</code></a> library also supports accessing and using the GridFS, see the <a href=\"https://godoc.org/gopkg.in/mgo.v2#GridFS\" rel=\"nofollow noreferrer\"><code>mgo.GridFS</code></a> and <a href=\"https://godoc.org/gopkg.in/mgo.v2#GridFile\" rel=\"nofollow noreferrer\"><code>mgo.GridFile</code></a> types.</p>\n\n<p>You may also opt to store your files in the cloud, there are countless services and Go client libraries, all of them providing basic search functionality.</p>\n\n<p>Also be sure to check this question+answers on ServerFault:</p>\n\n<p><a href=\"https://serverfault.com/questions/95444/storing-a-million-images-in-the-filesystem\">Storing a million images in the filesystem</a></p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1513851859, "post_id": 47921300, "comment_id": 82813233, "body": "I have doubts about the efficiency of adding <i>millions</i> of files into a zip archive. Someone should put it under tests..."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1513856095, "post_id": 47921300, "comment_id": 82815673, "body": "@icza, sure, that was my doubt, too. Bu the OP explicitly mentioned that the files are &quot;very small&quot;, so I naturally assumed they are small as, say, less than one KiB, and that might fit into a 4GB &quot;standard ZIP&quot; module\u2014or maybe not."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1513846939, "last_edit_date": 1513846939, "creation_date": 1513846495, "answer_id": 47921300, "question_id": 47918487, "link": "https://stackoverflow.com/questions/47918487/bigfiles-in-golang/47921300#47921300", "title": "Bigfiles in Golang", "body": "<p>Maybe a simple ZIP archive (supposedly with zero compression) would work for you? It has a natural index into the contents (file streams), so when you <a href=\"https://golang.org/pkg/archive/zip/#NewReader\" rel=\"nofollow noreferrer\">open it using <code>archive/zip</code></a>, you get back\n<a href=\"https://golang.org/pkg/archive/zip/#Reader\" rel=\"nofollow noreferrer\">a slice of \"file info blocks\"</a>,\neach of which \"knows\" how to locate and read its corresponding file stream.\n(There's even a way to get the offset of the file's data, and read it\ndirectly\u2014bypassing a no-op \"decompressor\" and checksum verification,\nso you could explore this possible speed tweak if your measurements would\nshow the speed of accessing that data \"the normal way\" will be suboptimal.)</p>\n\n<p>You could then create a map indexed by file names for fast access.</p>\n\n<p>Or maybe go further and create a hierarchy of such maps\nto simulate a \"natural\" directory tree.\nOr maybe have several ZIP archives in a filesystem tree.</p>\n\n<hr>\n\n<p>And naturally, if everything you'd want to have is a r/o blob of file stream blobs + index, that would be a reasonably straightforward thing to implement yourself\u2014both for reading and writing. If you're not too much into designing stuff, I'd look at the <a href=\"https://www.kernel.org/pub/software/scm/git/docs/technical/pack-format.txt\" rel=\"nofollow noreferrer\">format of the Git \"pack files\"</a>.</p>\n"}], "owner": {"reputation": 2005, "user_id": 1871890, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4359cdd9f14bbbe17c56f2fb2d2de25d?s=128&d=identicon&r=PG", "display_name": "Mathieu Nls", "link": "https://stackoverflow.com/users/1871890/mathieu-nls"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1513855279, "creation_date": 1513834197, "question_id": 47918487, "link": "https://stackoverflow.com/questions/47918487/bigfiles-in-golang", "title": "Bigfiles in Golang", "body": "<p>I am dealing with an application that contains millions of very small files and it s becoming a pain. It's very hard to transfer.</p>\n\n<p>So, I thought of bigfiles or another virtual file system that could create a large file, containing all my data indexed.</p>\n\n<p>How would one go about this in golang ? Do you have any lib to recommend?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 26267, "user_id": 2067753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYUrE.png?s=128&g=1", "display_name": "Paul Maxwell", "link": "https://stackoverflow.com/users/2067753/paul-maxwell"}, "edited": false, "score": 0, "creation_date": 1513823201, "post_id": 47916809, "comment_id": 82802124, "body": "Can you get the table definitions and all index definitions for these tables and add them to the question please."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1513826463, "post_id": 47916809, "comment_id": 82802814, "body": "And <code>fmt.Sprintf</code> is how you totally <b>NOT</b> parameterise your queries."}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "edited": false, "score": 0, "creation_date": 1513826748, "post_id": 47916809, "comment_id": 82802872, "body": "so I should use prepared statements?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1513826770, "post_id": 47916809, "comment_id": 82802883, "body": "Yep, I&#39;d say so."}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1513826730, "post_id": 47917178, "comment_id": 82802867, "body": "Starting postgresql 9.4 those <code>COUNT(expr)</code> can be substituted with slightly more idiomatic <code>COUNT(*) FILTER (WHERE ...)</code> <a href=\"https://www.postgresql.org/docs/current/static/sql-expressions.html#SYNTAX-AGGREGATES\" rel=\"nofollow noreferrer\">postgresql.org/docs/current/static/&hellip;</a>"}, {"owner": {"reputation": 26267, "user_id": 2067753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYUrE.png?s=128&g=1", "display_name": "Paul Maxwell", "link": "https://stackoverflow.com/users/2067753/paul-maxwell"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1513827058, "post_id": 47917178, "comment_id": 82802961, "body": "&quot;slightly more idiomatic&quot; as in: &quot;to date, unique to Postgres&quot;? see: <a href=\"http://modern-sql.com/feature/filter\" rel=\"nofollow noreferrer\">modern-sql.com/feature/filter</a>. Whilst this filter is now part of the standard it isn&#39;t yet widely adopted, so I tend to ignore it"}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "edited": false, "score": 0, "creation_date": 1513827296, "post_id": 47917178, "comment_id": 82803017, "body": "what does &quot;then 1&quot; means in the case expression inside count means?"}, {"owner": {"reputation": 26267, "user_id": 2067753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYUrE.png?s=128&g=1", "display_name": "Paul Maxwell", "link": "https://stackoverflow.com/users/2067753/paul-maxwell"}, "edited": false, "score": 0, "creation_date": 1513827563, "post_id": 47917178, "comment_id": 82803085, "body": "<code>the COUNT()</code> function increments for any non-NULL value, so the <code>then 1</code> simply provides that non-NULL value. I could have used, for example, <code>then &#39;X&#39;</code> and got the same result."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1513836806, "post_id": 47917178, "comment_id": 82805540, "body": "@Used_By_Already <code>!=</code> is also a not so standardised operator, which does not stop you from using it. Whatever."}, {"owner": {"reputation": 26267, "user_id": 2067753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYUrE.png?s=128&g=1", "display_name": "Paul Maxwell", "link": "https://stackoverflow.com/users/2067753/paul-maxwell"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1513838309, "post_id": 47917178, "comment_id": 82806060, "body": "@zerkms Lol, I nearly did make that change, but as it is most commonly used by users of other programming languges I left it as is. I routinely use <code>&lt;&gt;</code> for my own code. Cheers."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1513839190, "post_id": 47917178, "comment_id": 82806425, "body": "Btw, <code>FILTER</code> should be in general better to optimise (since it&#39;s a predicate not an expression), not in this case though."}, {"owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "edited": false, "score": 0, "creation_date": 1513848172, "post_id": 47917178, "comment_id": 82810895, "body": "I can&#39;t believe how much performance was improved with indexing symbols and dates column, and using the query above. From more than an hour to only <b>two minutes</b> now. Do you think two minutes is still a lot of time for the above goal?"}, {"owner": {"reputation": 26267, "user_id": 2067753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYUrE.png?s=128&g=1", "display_name": "Paul Maxwell", "link": "https://stackoverflow.com/users/2067753/paul-maxwell"}, "edited": false, "score": 0, "creation_date": 1513849658, "post_id": 47917178, "comment_id": 82811787, "body": "2 minutes is still lengthy but it is 6 million+ rows and we have no idea what the server is etc. But to go any further without much more detail would be in the realm of guesswork. Use an explain plan to find out what is happening with the new query and the new index. If you think more speed can be gained you could open a new performance question  containing extra details."}, {"owner": {"reputation": 26267, "user_id": 2067753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYUrE.png?s=128&g=1", "display_name": "Paul Maxwell", "link": "https://stackoverflow.com/users/2067753/paul-maxwell"}, "edited": false, "score": 0, "creation_date": 1513849840, "post_id": 47917178, "comment_id": 82811902, "body": "by the way, you might consider &quot;partitioning&quot; of that table as well. That is a detailed topic I&#39;m not expert with. DBA&#39;s are. You could try a question at <a href=\"https://dba.stackexchange.com/\">dba.stackexchange.com</a>"}], "tags": [], "owner": {"reputation": 26267, "user_id": 2067753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qYUrE.png?s=128&g=1", "display_name": "Paul Maxwell", "link": "https://stackoverflow.com/users/2067753/paul-maxwell"}, "is_accepted": true, "score": 1, "last_activity_date": 1513824141, "creation_date": 1513824141, "answer_id": 47917178, "question_id": 47916809, "link": "https://stackoverflow.com/questions/47916809/how-do-i-make-this-golang-to-postgres-query-faster-any-specific-alternatives/47917178#47917178", "title": "How do I make this Golang to Postgres query faster? Any specific alternatives?", "body": "<p>Couple of things I note from the question.</p>\n\n<p>Try to avoid scanning 6 million+ rows to arrive at 2174 values (i.e. avoid <code>Select distinct symbol from table_name;</code>). Do you not have (or can you build) a \"master table\" of symbols with a primary key of the symbols?</p>\n\n<p>Combine your queries to test the data such as the following:</p>\n\n<pre><code>select\n       count(*) c1\n     , count(case when open != 0 and high != 0 and low != 0 and close != 0 then 1 end) as c2\nfrom table_name \nwhere symbol='symbol' \nand date&gt;= 'EVALDATE' \n</code></pre>\n\n<p>An index on (symbol, date) would assist performance.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1514568441, "creation_date": 1514568441, "answer_id": 48026181, "question_id": 47916809, "link": "https://stackoverflow.com/questions/47916809/how-do-i-make-this-golang-to-postgres-query-faster-any-specific-alternatives/48026181#48026181", "title": "How do I make this Golang to Postgres query faster? Any specific alternatives?", "body": "<p>In Go, clean 7,914,698 rows for 3,142 symbols in 28.7 seconds, which is better than 3,960 seconds (1 hour and 6 minutes) for 6,610,598 rows for 2,174 symbols.</p>\n\n<p>Output:</p>\n\n<pre><code>$ go run clean.go\nclean: 7914698 rows 28.679295705s\n\n$ psql\npsql (9.6.6)\n\npeter=# \\d clean\n         Table \"public.clean\"\n Column |       Type       | Modifiers \n--------+------------------+-----------\n id     | integer          | \n symbol | text             | not null\n date   | date             | not null\n close  | double precision | \n volume | integer          | \n open   | double precision | \n high   | double precision | \n low    | double precision | \nIndexes:\n    \"clean_pkey\" PRIMARY KEY, btree (symbol, date)\n\npeter=# SELECT COUNT(*) FROM clean;\n  count  \n---------\n 7914698\n\npeter=# SELECT COUNT(DISTINCT symbol) FROM clean;\n count \n-------\n  3142\n\npeter=# \\q\n$\n</code></pre>\n\n<p><code>clean.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"strconv\"\n    \"time\"\n\n    _ \"github.com/lib/pq\"\n)\n\nfunc clean(db *sql.DB, EVALDATE time.Time, MINCTD, MINDP int) (int64, time.Duration, error) {\n    start := time.Now()\n\n    tx, err := db.Begin()\n    if err != nil {\n        return 0, 0, err\n    }\n    committed := false\n    defer func() {\n        if !committed {\n            tx.Rollback()\n        }\n    }()\n\n    {\n        const query = `DROP TABLE IF EXISTS clean;`\n        if _, err := tx.Exec(query); err != nil {\n            return 0, 0, err\n        }\n    }\n\n    var nRows int64\n    {\n        const query = `\n            CREATE TABLE clean AS\n                SELECT id, symbol, date, close, volume, open, high, low \n                FROM unclean \n                WHERE symbol IN (\n                    SELECT symbol\n                    FROM unclean\n                    WHERE date &gt;= $1\n                    GROUP BY symbol\n                    HAVING \n                        COUNT(*) &gt;= $2\n                        AND \n                        COUNT(CASE WHEN NOT (open &gt;0 AND high &gt;0 AND low &gt;0 AND close &gt;0) THEN 1 END) &lt;= $3\n                )\n                ORDER BY symbol, date\n            ;\n        `\n        EVALDATE := EVALDATE.Format(\"'2006-01-02'\")\n        MINCTD := strconv.Itoa(MINCTD)\n        MINDP := strconv.Itoa(MINDP)\n        res, err := tx.Exec(query, EVALDATE, MINCTD, MINDP)\n        if err != nil {\n            return 0, 0, err\n        }\n        nRows, err = res.RowsAffected()\n        if err != nil {\n            return 0, 0, err\n        }\n    }\n\n    {\n        const query = `ALTER TABLE clean ADD PRIMARY KEY (symbol, date);`\n        _, err := tx.Exec(query)\n        if err != nil {\n            return 0, 0, err\n        }\n    }\n\n    if err = tx.Commit(); err != nil {\n        return 0, 0, err\n    }\n    committed = true\n\n    since := time.Since(start)\n\n    {\n        const query = `ANALYZE clean;`\n        if _, err := db.Exec(query); err != nil {\n            return nRows, since, err\n        }\n    }\n\n    return nRows, since, nil\n}\n\nfunc main() {\n    db, err := sql.Open(\"postgres\", \"user=peter password=peter dbname=peter\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer db.Close()\n    var ( // one year\n        EVALDATE = time.Now().AddDate(-1, 0, 0)\n        MINCTD   = 240\n        MINDP    = 5\n    )\n    nRows, since, err := clean(db, EVALDATE, MINCTD, MINDP)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(\"clean:\", nRows, \"rows\", since)\n    return\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/qVOQQ6mcU-1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qVOQQ6mcU-1</a></p>\n\n<hr>\n\n<p>References:</p>\n\n<p>Technical Analysis of the Financial Markets: A Comprehensive Guide to Trading Methods and Applications, John J. Murphy.</p>\n\n<p>An Introduction to Database Systems, 8th Edition, C.J. Date.</p>\n\n<p>PostgreSQL: Introduction and Concepts, Bruce Momjian.</p>\n\n<p>PostgreSQL 9.6.6 Documentation, PostgreSQL.</p>\n"}], "owner": {"reputation": 305, "user_id": 8406346, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3805482de243084ae3898bd42f413496?s=128&d=identicon&r=PG&f=1", "display_name": "JohnStephen.19", "link": "https://stackoverflow.com/users/8406346/johnstephen-19"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1794, "favorite_count": 1, "accepted_answer_id": 47917178, "answer_count": 2, "score": 0, "last_activity_date": 1514568441, "creation_date": 1513820986, "last_edit_date": 1513825622, "question_id": 47916809, "link": "https://stackoverflow.com/questions/47916809/how-do-i-make-this-golang-to-postgres-query-faster-any-specific-alternatives", "title": "How do I make this Golang to Postgres query faster? Any specific alternatives?", "body": "<p>I am using Golang and Postgres to filter some financial data. I have a Postgres database which has a single table containing a single Stock Market (if that's the correct term). This table has columns for id, symbol, date, open, high, low, close and volume. The total number of rows is 6,610,598 and the number of distinct stocks (symbols) is 2174.</p>\n\n<p>Now what I want to do is to filter the data from that table, and save to another table. So the first one contains raw data and second one contains cleaned data.</p>\n\n<p>We have three parameters, a date (EVALDATE) and 2 integers (MINCTD &amp; MINDP). First, we have to select only those stocks that will pass our minimum calendar trading days parameter. So that will be selected by (NOTE: we use golang for this)</p>\n\n<pre><code>symbols []string got its value from ( Select distinct symbol from table_name; )\n[]filteredSymbols\nvar symbol, date string\nvar open, high, low, close float64\nvar volume int\nfor _, symbol := range symbols {\n    var count int\n    query := fmt.Sprintf(\"Select count(*) from table_name where symbol = '%s' and date &gt;= '%s';\", symbol, EVALDATE)\n    row := db.QueryRow(query)\n    if err := row.Scan(&amp;count); err != nil ........\n    if count &gt;= MINCTD\n        filteredSymbols = append(filteredSymbols, symbol)\n}\n</code></pre>\n\n<p>Basically, the operation above only asks for those symbols which has enough number of rows from the EVALDATE up to current date (latest date in data) that will satisfy MINCTD. The operation above took  <strong>30 minutes</strong></p>\n\n<p>If a symbol satisfies the first filter above, it will undergo a second filter which will test if within that period (EVALDATE to LATEST_DATE) it has enough rows that contain complete data (no OHLC without values). So the query below is used to filter the symbols which passed the filter above:</p>\n\n<pre><code>Select count(*) from table_name where symbol='symbol' and date&gt;= 'EVALDATE' and open != 0 and high != 0 and low != 0 and close != 0;\n</code></pre>\n\n<p>This query took <strong>36 minutes</strong>.</p>\n\n<p>After getting the slice of symbols which passed both filter, I will then grab their data again using postgres query then begin a bulk insert to another table.</p>\n\n<p>So <strong>1 hour and 6 minutes</strong> is not very acceptable. What should I do then? Grab all data then filter using Golang in memory?</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513819204, "post_id": 47916534, "comment_id": 82801241, "body": "An <code>http.Request</code> isn\u2019t really a thing that can serialized. What is the problem you\u2019re trying to solve?"}, {"owner": {"reputation": 45, "user_id": 1180696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16a378c2ca728750b0c62218e8a166fa?s=128&d=identicon&r=PG", "display_name": "sillydong", "link": "https://stackoverflow.com/users/1180696/sillydong"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1513822541, "post_id": 47916534, "comment_id": 82802004, "body": "I&#39;m trying to check the http request in agent side and if it is a dangerous request, I will send it to the server side via grpc. I need to serialize the request so that I can pass it and store it into mogodb."}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 1180696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16a378c2ca728750b0c62218e8a166fa?s=128&d=identicon&r=PG", "display_name": "sillydong", "link": "https://stackoverflow.com/users/1180696/sillydong"}, "edited": false, "score": 0, "creation_date": 1513925206, "post_id": 47926446, "comment_id": 82843230, "body": "I add those fields in the struct manually to pass it. Thanks a lot."}, {"owner": {"reputation": 98, "user_id": 8862808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41b7e30f64c8992897bd2668a35ede46?s=128&d=identicon&r=PG&f=1", "display_name": "lucas alcantara", "link": "https://stackoverflow.com/users/8862808/lucas-alcantara"}, "reply_to_user": {"reputation": 45, "user_id": 1180696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16a378c2ca728750b0c62218e8a166fa?s=128&d=identicon&r=PG", "display_name": "sillydong", "link": "https://stackoverflow.com/users/1180696/sillydong"}, "edited": false, "score": 0, "creation_date": 1513947880, "post_id": 47926446, "comment_id": 82853482, "body": "If this answered your question, please mark as an answer."}], "tags": [], "owner": {"reputation": 98, "user_id": 8862808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41b7e30f64c8992897bd2668a35ede46?s=128&d=identicon&r=PG&f=1", "display_name": "lucas alcantara", "link": "https://stackoverflow.com/users/8862808/lucas-alcantara"}, "is_accepted": true, "score": 2, "last_activity_date": 1513864437, "creation_date": 1513864437, "answer_id": 47926446, "question_id": 47916534, "link": "https://stackoverflow.com/questions/47916534/how-to-wrap-http-request-into-proto-file/47926446#47926446", "title": "How to wrap http.Request into proto file", "body": "<p>you can rather than pass the <code>http.Request</code> pass the <code>http.Request.Body</code> or <code>http.Request.Header</code> depends on what do you use on your server.</p>\n"}], "owner": {"reputation": 45, "user_id": 1180696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16a378c2ca728750b0c62218e8a166fa?s=128&d=identicon&r=PG", "display_name": "sillydong", "link": "https://stackoverflow.com/users/1180696/sillydong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 47926446, "answer_count": 1, "score": 0, "last_activity_date": 1513925104, "creation_date": 1513818713, "last_edit_date": 1513925104, "question_id": 47916534, "link": "https://stackoverflow.com/questions/47916534/how-to-wrap-http-request-into-proto-file", "title": "How to wrap http.Request into proto file", "body": "<p>I need to wrap a http.Request into proto file so that I can send a request instance to the server side from client side, as the following code shows:</p>\n\n<pre><code>message WrapRequest{\n  *http.Request request = 1; // this is wrong\n  int64 start = 2;\n  int64 stop = 3;\n  bool match = 4;\n  string ruleid = 5;\n}\n</code></pre>\n\n<p>I'm sure the request line in my code is wrong, is there anyone who knows how to achieve it. Thanks a lot.</p>\n"}]