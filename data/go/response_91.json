[{"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 2, "creation_date": 1475707832, "post_id": 39884835, "comment_id": 67056553, "body": "structs are the only object type in Go and they follow most of the same rules as in C. If you know enough to ask the question you should also know enough to find the answer."}], "answers": [{"tags": [], "owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "is_accepted": true, "score": 0, "last_activity_date": 1475727705, "creation_date": 1475727705, "answer_id": 39887471, "question_id": 39884835, "link": "https://stackoverflow.com/questions/39884835/golang-struct-definition-patterns/39887471#39887471", "title": "Golang struct definition patterns", "body": "<p>Like this?</p>\n\n\n\n<pre><code>type BEncodeType int\n\nconst (\n    TypeBInt BEncodeType = iota\n    TypeBString\n    TypeBList\n    TypeBDict\n)\n\ntype BEncode interface {\n    Type() BEncodeType\n    Val() interface{}\n}\n\ntype BInt int\n\nfunc (n *BInt) Type() BEncodeType {\n    return TypeBInt\n}\nfunc (n *BInt) Val() interface{} {\n    return n\n}\n\ntype BString string\n\nfunc (n *BString) Type() BEncodeType {\n    return TypeBString\n}\nfunc (n *BString) Val() interface{} {\n    return n\n}\n\ntype BList []BEncode\n\nfunc (n *BList) Type() BEncodeType {\n    return TypeBList\n}\nfunc (n *BList) Val() interface{} {\n    return n\n}\n\ntype BDict map[string]BEncode\n\nfunc (n *BDict) Type() BEncodeType {\n    return TypeBDict\n}\nfunc (n *BDict) Val() interface{} {\n    return n\n}\n</code></pre>\n"}], "owner": {"reputation": 269, "user_id": 1084637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/745239e23061d746727436ec06e5dd2e?s=128&d=identicon&r=PG", "display_name": "asp5", "link": "https://stackoverflow.com/users/1084637/asp5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 566, "favorite_count": 0, "accepted_answer_id": 39887471, "answer_count": 1, "score": 0, "last_activity_date": 1475727705, "creation_date": 1475707617, "question_id": 39884835, "link": "https://stackoverflow.com/questions/39884835/golang-struct-definition-patterns", "title": "Golang struct definition patterns", "body": "<p>I'm currently playing with Go, was wondering what are the patterns for defining the data types. For example take the <a href=\"https://en.wikipedia.org/wiki/Bencode\" rel=\"nofollow\">Bencode</a> and representing it as a Go data structure. </p>\n\n<p><a href=\"https://hackage.haskell.org/package/bencode-0.6.0.0/docs/src/Data-BEncode.html#BEncode\" rel=\"nofollow\">like in Haskell</a></p>\n\n<pre><code>data BEncode = BInt Integer\n         | BString L.ByteString\n         | BList [BEncode]\n         | BDict (Map String BEncode)\n</code></pre>\n\n<p><a href=\"https://dzone.com/articles/bencoding-parser-c\" rel=\"nofollow\">in C, we can do something like this</a></p>\n\n<pre><code>struct Bencoding;\n\ntypedef struct ListNode {\n    struct Bencoding *cargo;\n    struct ListNode *next;\n} ListNode;\n\ntypedef struct DictNode {\n    char *key;\n    struct Bencoding *value;\n    struct DictNode *next;\n} DictNode;\n\ntypedef struct Bencoding {\n    BType type;\n    union {\n        long long val;  // used when type == BInt\n        ListNode *list; // used when type == BList\n        char *str;      // used when type == BString\n        DictNode *dict;\n    } cargo; // data\n} Bencoding;\n</code></pre>\n\n<p>what is the best way to define these kinds of data structures in Golang. Are there any patterns / good practices with Golang.</p>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1475702898, "post_id": 39882558, "comment_id": 67054860, "body": "Are you using <code>&quot;gopkg.in&#47;yaml.v2&quot;</code>? Silent failure is very unGo-like... The encoding packages in the standard lib are all very strict."}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 1, "creation_date": 1475736875, "post_id": 39882558, "comment_id": 67064871, "body": "Most decoders I went over with Go only treat syntax error as error. I think the way to handle is to have unit test coverage on yaml decoding on your struct. Or you&#39;d need to write your own yaml decoder implementation."}, {"owner": {"reputation": 435, "user_id": 2237320, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8b62a753ca61cb86503a96300440308e?s=128&d=identicon&r=PG", "display_name": "Alice", "link": "https://stackoverflow.com/users/2237320/alice"}, "edited": false, "score": 0, "creation_date": 1476250747, "post_id": 39882558, "comment_id": 67260610, "body": "Thanks Koala. I couldn&#39;t find a way so get it to work nicely, so I just ended up writing straight Go structs in my tests."}], "answers": [{"tags": [], "owner": {"reputation": 332, "user_id": 6006050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbce953f66a6e1092656ab9d8609910?s=128&d=identicon&r=PG&f=1", "display_name": "Reub", "link": "https://stackoverflow.com/users/6006050/reub"}, "is_accepted": false, "score": 0, "last_activity_date": 1503220884, "last_edit_date": 1503220884, "creation_date": 1503218978, "answer_id": 45780232, "question_id": 39882558, "link": "https://stackoverflow.com/questions/39882558/is-there-a-way-to-ensure-that-all-data-in-a-yaml-string-was-parsed/45780232#45780232", "title": "Is there a way to ensure that all data in a yaml string was parsed?", "body": "<h2><a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">go-yaml/yaml</a></h2>\n\n<p>For anyone searching for a solution to this problem, the yaml.v2 library has an <a href=\"http://godoc.org/gopkg.in/yaml.v2#UnmarshalStrict\" rel=\"nofollow noreferrer\">UnmarshalStrict</a> method that returns an error if there are keys in the yaml document that have no corresponding fields in the go struct.</p>\n\n<pre><code>import yaml \"gopkg.in/yaml.v2\"\n\nerr := yaml.UnmarshalStrict(data, destinationStruct)\n</code></pre>\n\n<h2><a href=\"https://github.com/BurntSushi/toml\" rel=\"nofollow noreferrer\">BurntSushi/toml</a></h2>\n\n<p>It's not part of the question, but I'd just like to document how to achieve something similar in toml:</p>\n\n<p>You can find if there were any keys in the toml file that could not be decoded by using the metadata returned by the toml.decode function.</p>\n\n<pre><code>import \"github.com/BurntSushi/toml\"\n\nmetadata, err := toml.Decode(data, destinationStruct)\nundecodedKeys := metadata.Undecoded()\n</code></pre>\n\n<p>Note that metadata.Undecoded() also returns keys that have not been decoded because of a Primitive value. You can <a href=\"https://godoc.org/github.com/BurntSushi/toml\" rel=\"nofollow noreferrer\">read more about it here</a>.</p>\n\n<h2><a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">Json</a></h2>\n\n<p>The default go json library does not support this currently, but there is a <a href=\"https://github.com/golang/go/issues/15314\" rel=\"nofollow noreferrer\">proposal ready to be merged</a>. It seems that it will be a part of go 1.10.</p>\n"}], "owner": {"reputation": 435, "user_id": 2237320, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8b62a753ca61cb86503a96300440308e?s=128&d=identicon&r=PG", "display_name": "Alice", "link": "https://stackoverflow.com/users/2237320/alice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 469, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503220884, "creation_date": 1475697148, "question_id": 39882558, "link": "https://stackoverflow.com/questions/39882558/is-there-a-way-to-ensure-that-all-data-in-a-yaml-string-was-parsed", "title": "Is there a way to ensure that all data in a yaml string was parsed?", "body": "<p>For testing, I often see go code read byte slices, which are parsed into structs using yaml, for example here:</p>\n\n<p><a href=\"https://github.com/kubernetes/kubernetes/blob/master/pkg/util/strategicpatch/patch_test.go#L74m\" rel=\"nofollow\">https://github.com/kubernetes/kubernetes/blob/master/pkg/util/strategicpatch/patch_test.go#L74m</a></p>\n\n<p>I just got bitten by not exporting my field names, resulting in an empty list which I iterated over in my test cases, thus assuming that all tests were passing (in hindsight, that should have been a red flag :)). There are other errors which are silently ignored by yaml unmarshaling, such as a key being misspelled and not matching a struct field exactly.</p>\n\n<p>Is there a way to ensure that all the data in the byte slice was actually parsed into the struct returned by yaml.Unmarshal? If not, how do others handle this situation?</p>\n"}, {"tags": ["mongodb", "go", "bson", "mgo"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1475703053, "post_id": 39882159, "comment_id": 67054941, "body": "Having some code relevant to querying a database would be a good starting place."}, {"owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1475704759, "post_id": 39882159, "comment_id": 67055607, "body": "@evanmcdonnal I added current query but it is very bad solution because I fetch all and than in go code filter"}], "answers": [{"tags": [], "owner": {"reputation": 1112, "user_id": 1944993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2a7f7834807f202f2c40c5c12aec4f5?s=128&d=identicon&r=PG", "display_name": "HoefMeistert", "link": "https://stackoverflow.com/users/1944993/hoefmeistert"}, "is_accepted": false, "score": 1, "last_activity_date": 1475731225, "creation_date": 1475731225, "answer_id": 39888066, "question_id": 39882159, "link": "https://stackoverflow.com/questions/39882159/query-where-sum-of-two-fields-is-less-than-given-value/39888066#39888066", "title": "Query where sum of two fields is less than given value", "body": "<p>You should really use the <a href=\"https://docs.mongodb.com/manual/aggregation/\" rel=\"nofollow\">Aggregation Framework</a> for this. Then it's handled server side. do something like :</p>\n\n<pre><code>db.table.aggregate(\n   [\n     { $project: { ID: 1, name : 1, total: { $add: [ \"$Sum\", \"$Delta\" ] } } },\n     { $match : { total  : { $gte: 1000 }}}\n   ]\n)\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 2, "last_activity_date": 1475750598, "last_edit_date": 1475750598, "creation_date": 1475749826, "answer_id": 39893644, "question_id": 39882159, "link": "https://stackoverflow.com/questions/39882159/query-where-sum-of-two-fields-is-less-than-given-value/39893644#39893644", "title": "Query where sum of two fields is less than given value", "body": "<p>To find all where is <code>sum + delta &lt; 1000</code>,  you may use:</p>\n\n<pre><code>pipe := c.Pipe(\n    []bson.M{\n        bson.M{\"$project\": bson.M{\"_id\": 1, \"name\": 1, \"sum\": 1, \"delta\": 1,\n            \"total\": bson.M{\"$add\": []string{\"$sum\", \"$delta\"}}}},\n        bson.M{\"$match\": bson.M{\"total\": bson.M{\"$lt\": 1000}}},\n    })\n</code></pre>\n\n<p>Here is the working code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\nfunc main() {\n    session, err := mgo.Dial(\"localhost\")\n    if err != nil {\n        panic(err)\n    }\n    defer session.Close()\n    session.SetMode(mgo.Monotonic, true) // Optional. Switch the session to a monotonic behavior.\n    c := session.DB(\"test\").C(\"MarkModel\")\n    c.DropCollection()\n    err = c.Insert(&amp;MarkModel{bson.NewObjectId(), \"n1\", 10, 1}, &amp;MarkModel{bson.NewObjectId(), \"n2\", 20, 2},\n        &amp;MarkModel{bson.NewObjectId(), \"n1\", 100, 1}, &amp;MarkModel{bson.NewObjectId(), \"n2\", 2000, 2})\n    if err != nil {\n        panic(err)\n    }\n\n    pipe := c.Pipe(\n        []bson.M{\n            bson.M{\"$project\": bson.M{\"_id\": 1, \"name\": 1, \"sum\": 1, \"delta\": 1,\n                \"total\": bson.M{\"$add\": []string{\"$sum\", \"$delta\"}}}},\n            bson.M{\"$match\": bson.M{\"total\": bson.M{\"$lt\": 1000}}},\n        })\n    r := []bson.M{}\n    err = pipe.All(&amp;r)\n    if err != nil {\n        panic(err)\n    }\n    for _, v := range r {\n        fmt.Println(v[\"_id\"], v[\"sum\"], v[\"delta\"], v[\"total\"])\n    }\n    fmt.Println()\n\n}\n\ntype MarkModel struct {\n    ID    bson.ObjectId `json: \"_id,omitempty\" bson: \"_id,omitempty\"`\n    Name  string        `json: \"name\" bson: \"name\"`\n    Sum   int           `json: \"sum\" bson: \"sum\"`\n    Delta int           `json: \"delta\" bson: \"delta\"`\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>ObjectIdHex(\"57f62739c22b1060591c625f\") 10 1 11\nObjectIdHex(\"57f62739c22b1060591c6260\") 20 2 22\nObjectIdHex(\"57f62739c22b1060591c6261\") 100 1 101\n</code></pre>\n"}], "owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 677, "favorite_count": 0, "accepted_answer_id": 39893644, "answer_count": 2, "score": -1, "last_activity_date": 1475750598, "creation_date": 1475695717, "last_edit_date": 1475750076, "question_id": 39882159, "link": "https://stackoverflow.com/questions/39882159/query-where-sum-of-two-fields-is-less-than-given-value", "title": "Query where sum of two fields is less than given value", "body": "<p>I am using Go language and MongoDB with <code>mgo.v2</code> driver and I have struct like </p>\n\n<pre><code>type MarkModel struct {\n    ID          bson.ObjectId                   `json: \"_id,omitempty\" bson: \"_id,omitempty\"`\n    Name        string                          `json: \"name\" bson: \"name\"`\n    Sum         int                             `json: \"sum\" bson: \"sum\"`\n    Delta       int                             `json: \"delta\" bson: \"delta\"`\n}\n</code></pre>\n\n<p>I need to find all where is <code>Sum + Delta &lt; 1000</code> for example. At the moment I load all and then in Go code I filter but I would like to filter on query level.<br>\nHow to make that query ? </p>\n\n<p>At the moment I return all with </p>\n\n<pre><code>marks := []MarkModel{}\nc_marks := session.DB(database).C(marksCollection)\nerr := c_marks.Find(bson.M{}).All(&amp;marks)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>and here I filter in Go code in for loop but it is not optimal ( it is bad solution ).</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 4, "creation_date": 1475690211, "post_id": 39880708, "comment_id": 67048150, "body": "&quot;access denied&quot; says it all. the user you&#39;re running that program under isn&#39;t allow to delete that file. You can&#39;t delete the executable, because it&#39;s IN USE by the program itself."}, {"owner": {"reputation": 248, "user_id": 6073838, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/1530379783927023/picture?type=large", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0410\u043d\u0442\u043e\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/6073838/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%90%d0%bd%d1%82%d0%be%d0%bd%d0%be%d0%b2"}, "reply_to_user": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 0, "creation_date": 1475690625, "post_id": 39880708, "comment_id": 67048376, "body": "In Linux delete is succesfull. Seems it&#39;s error Windows specific?"}, {"owner": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 0, "creation_date": 1475690992, "post_id": 39880708, "comment_id": 67048604, "body": "kinda. linux has a 2 level file descriptor system - you can delete/replace an in-use file, and the original will be kept around as a &quot;ghost&quot; for any process actively using it. windows doesn&#39;t, so you can&#39;t."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1475691042, "post_id": 39880708, "comment_id": 67048633, "body": "Related: <a href=\"https://stackoverflow.com/questions/1606140/how-can-a-program-delete-its-own-executable\" title=\"how can a program delete its own executable\">stackoverflow.com/questions/1606140/&hellip;</a>"}, {"owner": {"reputation": 248, "user_id": 6073838, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/1530379783927023/picture?type=large", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0410\u043d\u0442\u043e\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/6073838/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%90%d0%bd%d1%82%d0%be%d0%bd%d0%be%d0%b2"}, "edited": false, "score": 0, "creation_date": 1475691076, "post_id": 39880708, "comment_id": 67048653, "body": "Thanks for answer."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 9455417, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Nilou Marandi", "link": "https://stackoverflow.com/users/9455417/nilou-marandi"}, "is_accepted": false, "score": 1, "last_activity_date": 1520410002, "creation_date": 1520410002, "answer_id": 49146931, "question_id": 39880708, "link": "https://stackoverflow.com/questions/39880708/how-to-delete-self-executable-file-in-windows/49146931#49146931", "title": "How to delete self (executable file) in Windows?", "body": "<p>Using <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms682512%28v=vs.85%29.aspx\" rel=\"nofollow noreferrer\"><code>CreateProcess</code></a> function, as can be written in Go by using <code>syscall</code> package:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"syscall\"\n    \"os\"\n)\n\nfunc main() {\n    // write your code here \n    // &lt;----\n    fmt.Println(\"Blah Blah Blah\")\n    // ----&gt;\n    var sI syscall.StartupInfo\n    var pI syscall.ProcessInformation\n    argv := syscall.StringToUTF16Ptr(os.Getenv(\"windir\")+\"\\\\system32\\\\cmd.exe /C del \"+os.Args[0])\n    err := syscall.CreateProcess(\n        nil,\n        argv,\n        nil,\n        nil,\n        true,\n        0,\n        nil,\n        nil,\n        &amp;sI,\n        &amp;pI)\n    if err != nil {\n        fmt.Printf(\"Return: %d\\n\", err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 248, "user_id": 6073838, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/1530379783927023/picture?type=large", "display_name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0410\u043d\u0442\u043e\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/6073838/%d0%90%d0%bd%d0%b4%d1%80%d0%b5%d0%b9-%d0%90%d0%bd%d1%82%d0%be%d0%bd%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1527, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520410002, "creation_date": 1475690071, "last_edit_date": 1475690728, "question_id": 39880708, "link": "https://stackoverflow.com/questions/39880708/how-to-delete-self-executable-file-in-windows", "title": "How to delete self (executable file) in Windows?", "body": "<pre><code>package main\n\nimport \"os\"\n\nfunc main() {\n    err := os.Remove(os.Args[1])\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Compile this</p>\n\n<blockquote>\n  <p>GOOS=windows GOARCH=386 go build test.go</p>\n</blockquote>\n\n<p>Then run on wine</p>\n\n<pre><code>Z:\\tmp&gt;test.exe test.exe\nfixme:process:SetProcessPriorityBoost (0xffffffff,1): stub\npanic: remove test.exe: Access denied.\n\ngoroutine 1 [running]:\npanic(0x462c40, 0x5b3f9ca0)\n    /usr/local/go/src/runtime/panic.go:500 +0x331\nmain.main()\n    /tmp/test.go:8 +0x70\n\nZ:\\tmp&gt;fixme:console:CONSOLE_DefaultHandler Terminating process 8 on event 0\n</code></pre>\n\n<p>I think \"ok, it's wine\" and run in Win XP on VirtualBox. But that's error in Windows return. </p>\n\n<p>//Sorry for my english.</p>\n"}, {"tags": ["arrays", "json", "mongodb", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "is_accepted": true, "score": 0, "last_activity_date": 1475692996, "creation_date": 1475692996, "answer_id": 39881484, "question_id": 39878774, "link": "https://stackoverflow.com/questions/39878774/insert-new-object-into-array-attribute-in-document-in-mongodb-using-mgo-v2/39881484#39881484", "title": "Insert new object into Array Attribute in document in mongodb using mgo.v2", "body": "<p>You can use the update method to add the array element using the <strong><a href=\"http://docs.mongodb.org/manual/reference/operator/update/push/\" rel=\"nofollow\"><code>$push</code></a></strong> operator. For example:</p>\n\n<pre><code>session.DB(\"db\").C(\"configs\").Update(\n    bson.M{\"configid\": 1}, \n    bson.M{\"$push\": bson.M{\"widgets\": widget}}\n)\n</code></pre>\n"}], "owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1047, "favorite_count": 2, "accepted_answer_id": 39881484, "answer_count": 1, "score": 4, "last_activity_date": 1475692996, "creation_date": 1475683214, "question_id": 39878774, "link": "https://stackoverflow.com/questions/39878774/insert-new-object-into-array-attribute-in-document-in-mongodb-using-mgo-v2", "title": "Insert new object into Array Attribute in document in mongodb using mgo.v2", "body": "<p>I am using mgo.v2 mongodb driver to manupulation data with mongodb.I have data strucure as follow json</p>\n\n<pre><code>  \"configs\": [\n        {\n          \"configid\":1,\n          \"id\": 0,\n          \"widgets\": [\n            {\n              \"position\": 1,\n              \"type\": 1,\n              \"class\": \"normal green\",\n              \"metricid\": 5\n            },\n            {\n              \"position\": 2,\n              \"type\": 1,\n              \"class\": \"normal blue\",\n              \"metricid\": 6\n            }\n         ]\n      }\n    ]\n</code></pre>\n\n<p>I have created <code>configs</code> collection by using above json structure.</p>\n\n<pre><code>err2 := session.DB(\"db\").C(\"configs\").Insert(&amp;config)\n</code></pre>\n\n<p>but.In my case, I want add new item to widgets array to this configid. it is kind of object like this,</p>\n\n<pre><code>    {\n      \"position\": 3,\n      \"type\": 1,\n      \"class\": \"normal red\",\n      \"metricid\": 7\n    }\n</code></pre>\n\n<p>What is the best way to adding this object into widgets array in paticular configid in mongodb? I am using mgo.v2 mongodb driver</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1475683475, "post_id": 39878766, "comment_id": 67044221, "body": "What&#39;s your <code>main</code> function?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1475683516, "post_id": 39878766, "comment_id": 67044250, "body": "Have you tried printing <code>nodeType</code> to see if it&#39;s really <code>OTBMNodeTowns</code>?"}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1475683560, "post_id": 39878766, "comment_id": 67044280, "body": "Yeah removing all the goroutine stuff works fine. Sometimes if I add some stuff like print a string I can see the expected error (if my cpu is fast) I want printed so I assume the main thread is not waiting for the routines. My main function is just a call to Parse"}, {"owner": {"reputation": 1762, "user_id": 5120331, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YhTAB.png?s=128&g=1", "display_name": "Corvus Crypto", "link": "https://stackoverflow.com/users/5120331/corvus-crypto"}, "edited": false, "score": 0, "creation_date": 1475686282, "post_id": 39878766, "comment_id": 67046001, "body": "We can&#39;t tell what your main method is from this, but if you are initiating a goroutine to handle all of this, the program can indeed exit before code execution. I remember a trick posted in here by Jim B. about putting a <code>select{}</code> statement at the end of main to keep a program alive in these cases. However you&#39;ll need to use another channel or lock if you want to allow exit without sending an interrupt."}, {"owner": {"reputation": 133, "user_id": 143984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99b157fb1dc31bdea65355047233fa0d?s=128&d=identicon&r=PG", "display_name": "jmason", "link": "https://stackoverflow.com/users/143984/jmason"}, "edited": false, "score": 0, "creation_date": 1475693422, "post_id": 39878766, "comment_id": 67049995, "body": "For errChannel(), why not just do: <code>for err := range errors {</code>"}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 1, "creation_date": 1475737653, "post_id": 39878766, "comment_id": 67065326, "body": "This kind of issue is usually caused by 1 or 2 miss-called goroutine without proper sync. I&#39;ve tested with a simplified version of this, and it runs fine: <a href=\"https://play.golang.org/p/MXdDHsUL66\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MXdDHsUL66</a>. Perhaps the error comes from the code that you didn&#39;t share."}], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475683200, "creation_date": 1475683200, "question_id": 39878766, "link": "https://stackoverflow.com/questions/39878766/go-goroutines-not-beeing-executed", "title": "Go goroutines not beeing executed", "body": "<p>I am trying to achieve some sort of multi-thread processing over here. </p>\n\n<pre><code>func (m *Map) Parse(mapData Node) error {\n    wg := &amp;sync.WaitGroup{}\n    for _, node := range mapData.child {\n        wg.Add(1)\n        go parseChild(node, m, wg)\n    }\n    wg.Wait()\n    close(errors)\n    return nil\n}\n\nfunc parseChild(node Node, m *Map, wg *sync.WaitGroup) {\n    defer wg.Done()\n    var nodeType uint8\n    if err := binary.Read(node.data, binary.LittleEndian, &amp;nodeType); err != nil {\n        errors &lt;- err\n    }\n    if nodeType == OTBMNodeTowns {\n        for _, town := range node.child {\n            var nodeType uint8\n\n            if err := binary.Read(town.data, binary.LittleEndian, &amp;nodeType); err != nil {\n                errors &lt;- err\n                return\n            }\n            if nodeType != OTBMNodeTown {\n                errors &lt;- fmt.Errorf(\"Parsing map towns: expected %v got %v\", OTBMNodeTown, nodeType)\n                return\n            }\n            currentTown := Town{}\n            if err := binary.Read(town.data, binary.LittleEndian, &amp;currentTown.ID); err != nil {\n                errors &lt;- err\n                return\n            } else if currentTown.Name, err = town.ReadString(); err != nil {\n                errors &lt;- err\n                return\n            } else if currentTown.TemplePosition, err = town.ReadPosition(); err != nil {\n                errors &lt;- err\n                return\n            }\n            m.Towns = append(m.Towns, currentTown)\n            errors &lt;- fmt.Errorf(\"This should be called: %v, nodeType)\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>But my goroutine never sends anything to the errors channel. Seems to be that the main thread is not waiting for the goroutines to even finish</p>\n\n<p>I have no idea what I am missing here. Im waiting for all routines to finish using wg.Wait but doesnt seem to be working as I think it should</p>\n\n<p>And yes. the slice is populated with atleast 3 results. This is the errrors channel</p>\n\n<pre><code>var (\n    errors = make(chan error, 0)\n)\n\nfunc init() {\n    go errChannel()\n}\n\nfunc errChannel() {\n    for {\n        select {\n        case err := &lt;-errors:\n            log.Println(err)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["xml", "go"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 0, "last_activity_date": 1475683668, "creation_date": 1475683668, "answer_id": 39878927, "question_id": 39878416, "link": "https://stackoverflow.com/questions/39878416/golang-xml-unmarshal-only-returns-last-value-of-the-child-node/39878927#39878927", "title": "Golang XML Unmarshal only returns last value of the child node", "body": "<p>Try it on <a href=\"https://play.golang.org/p/JlMRGhsnC4\" rel=\"nofollow\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\ntype Member struct {\n    Names []string `xml:\"names&gt;name\"`\n    Value string   `xml:\"value&gt;string\"`\n}\n\ntype Result struct {\n    Members []Member `xml:\"params&gt;param&gt;value&gt;array&gt;data&gt;value&gt;struct&gt;member\"`\n}\n\nfunc main() {\n    data := `\n    &lt;methodResponse&gt;\n    &lt;params&gt;\n        &lt;param&gt;\n            &lt;value&gt;\n                &lt;array&gt;\n                    &lt;data&gt;\n                        &lt;value&gt;\n                            &lt;string&gt;12345abcde12345abcde12345&lt;/string&gt;\n                        &lt;/value&gt;\n                        &lt;value&gt;\n                            &lt;struct&gt;\n                                &lt;member&gt;\n                                    &lt;names&gt;\n                                     &lt;name&gt; 2 &lt;/name&gt;\n                                     &lt;name&gt; 3 &lt;/name&gt;\n                                     &lt;name&gt; 4 &lt;/name&gt;\n                                    &lt;/names&gt;\n\n                                    &lt;value&gt;\n                                        &lt;string&gt;trex&lt;/string&gt;\n                                    &lt;/value&gt;\n                                &lt;/member&gt;\n\n                                &lt;member&gt;\n                                    &lt;names&gt;\n                                     &lt;name&gt; 2 &lt;/name&gt;\n                                     &lt;name&gt; 3 &lt;/name&gt;\n                                     &lt;name&gt; 4 &lt;/name&gt;\n                                    &lt;/names&gt;\n\n                                    &lt;value&gt;\n                                        &lt;string&gt;trex&lt;/string&gt;\n                                    &lt;/value&gt;\n                                &lt;/member&gt;\n                           &lt;/struct&gt;\n                        &lt;/value&gt;\n                    &lt;/data&gt;\n                &lt;/array&gt;\n            &lt;/value&gt;\n        &lt;/param&gt;\n    &lt;/params&gt;\n&lt;/methodResponse&gt;`\n\n    v := Result{}\n    err := xml.Unmarshal([]byte(data), &amp;v)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(v)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{[{[ 2   3   4 ] trex} {[ 2   3   4 ] trex}]}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 867, "user_id": 997571, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/9Tdwb.jpg?s=128&g=1", "display_name": "Chali", "link": "https://stackoverflow.com/users/997571/chali"}, "is_accepted": false, "score": 0, "last_activity_date": 1475683696, "creation_date": 1475683696, "answer_id": 39878940, "question_id": 39878416, "link": "https://stackoverflow.com/questions/39878416/golang-xml-unmarshal-only-returns-last-value-of-the-child-node/39878940#39878940", "title": "Golang XML Unmarshal only returns last value of the child node", "body": "<p>I figured this out , by make Name as a slice </p>\n\n<p>Name  []string <code>xml:\"name\"</code></p>\n"}], "owner": {"reputation": 867, "user_id": 997571, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/9Tdwb.jpg?s=128&g=1", "display_name": "Chali", "link": "https://stackoverflow.com/users/997571/chali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 432, "favorite_count": 0, "accepted_answer_id": 39878927, "answer_count": 2, "score": 0, "last_activity_date": 1475684014, "creation_date": 1475682165, "last_edit_date": 1475684014, "question_id": 39878416, "link": "https://stackoverflow.com/questions/39878416/golang-xml-unmarshal-only-returns-last-value-of-the-child-node", "title": "Golang XML Unmarshal only returns last value of the child node", "body": "<p>I am trying to extract a simple XML from bellow XML, but the output only returns the last value of Name</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\ntype Member struct {\n    Name  []Names `xml:\"names\"`\n    Value string `xml:\"value&gt;string\"`\n}\n\ntype Names struct {\n    Name  string `xml:\"name\"`\n}\n\ntype Result struct {\n\n    Members    []Member `xml:\"params&gt;param&gt;value&gt;array&gt;data&gt;value&gt;struct&gt;member\"`\n}\n\nfunc main() {\n    data := `\n    &lt;methodResponse&gt;\n    &lt;params&gt;\n        &lt;param&gt;\n            &lt;value&gt;\n                &lt;array&gt;\n                    &lt;data&gt;\n                        &lt;value&gt;\n                            &lt;string&gt;12345abcde12345abcde12345&lt;/string&gt;\n                        &lt;/value&gt;\n                        &lt;value&gt;\n                            &lt;struct&gt;\n                                &lt;member&gt;\n                                    &lt;names&gt;\n                                     &lt;name&gt; 2 &lt;/name&gt;\n                                     &lt;name&gt; 3 &lt;/name&gt;\n                                     &lt;name&gt; 4 &lt;/name&gt;\n                                    &lt;/names&gt;\n\n                                    &lt;value&gt;\n                                        &lt;string&gt;trex&lt;/string&gt;\n                                    &lt;/value&gt;\n                                &lt;/member&gt;\n\n                                &lt;member&gt;\n                                    &lt;names&gt;\n                                     &lt;name&gt; 2 &lt;/name&gt;\n                                     &lt;name&gt; 3 &lt;/name&gt;\n                                     &lt;name&gt; 4 &lt;/name&gt;\n                                    &lt;/names&gt;\n\n                                    &lt;value&gt;\n                                        &lt;string&gt;trex&lt;/string&gt;\n                                    &lt;/value&gt;\n                                &lt;/member&gt;\n                           &lt;/struct&gt;\n                        &lt;/value&gt;\n                    &lt;/data&gt;\n                &lt;/array&gt;\n            &lt;/value&gt;\n        &lt;/param&gt;\n    &lt;/params&gt;\n&lt;/methodResponse&gt;`\n\n    v := Result{}\n    err := xml.Unmarshal([]byte(data), &amp;v)\n    if err != nil {\n        fmt.Printf(\"error: %v\", err)\n        return\n    }\n    fmt.Println(v)\n}\n</code></pre>\n"}, {"tags": ["sql", "database", "go"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 6927309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf30a8d9b274319a6566208ea41e1671?s=128&d=identicon&r=PG&f=1", "display_name": "fitti", "link": "https://stackoverflow.com/users/6927309/fitti"}, "edited": false, "score": 0, "creation_date": 1475739291, "post_id": 39878405, "comment_id": 67066242, "body": "Thanks for the answer. what does <code>be closed lazily</code> mean?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 33, "user_id": 6927309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf30a8d9b274319a6566208ea41e1671?s=128&d=identicon&r=PG&f=1", "display_name": "fitti", "link": "https://stackoverflow.com/users/6927309/fitti"}, "edited": false, "score": 1, "creation_date": 1475773665, "post_id": 39878405, "comment_id": 67089140, "body": "@fitti: it means it can be closed at any time, not necessarily synchronously with returning the connection to the pool."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1475682141, "creation_date": 1475682141, "answer_id": 39878405, "question_id": 39878279, "link": "https://stackoverflow.com/questions/39878279/how-does-setconnmaxlifetime-works-on-golang-database-sql/39878405#39878405", "title": "How does SetConnMaxLifetime works on golang database/sql", "body": "<p>No, <code>sql.DB</code> will not close an active connection. The cleaner only runs over the free connection pool. </p>\n"}], "owner": {"reputation": 33, "user_id": 6927309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf30a8d9b274319a6566208ea41e1671?s=128&d=identicon&r=PG&f=1", "display_name": "fitti", "link": "https://stackoverflow.com/users/6927309/fitti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2294, "favorite_count": 1, "accepted_answer_id": 39878405, "answer_count": 1, "score": 3, "last_activity_date": 1475682141, "creation_date": 1475681793, "question_id": 39878279, "link": "https://stackoverflow.com/questions/39878279/how-does-setconnmaxlifetime-works-on-golang-database-sql", "title": "How does SetConnMaxLifetime works on golang database/sql", "body": "<p>I am confused by the <a href=\"https://golang.org/pkg/database/sql/#DB.SetConnMaxLifetime\" rel=\"nofollow\">documentation</a> of the <code>func (db *DB) SetConnMaxLifetime(d time.Duration)</code> that states: </p>\n\n<blockquote>\n  <p>SetConnMaxLifetime sets the maximum amount of time a connection may be\n  reused. </p>\n  \n  <p>Expired connections may be closed lazily before reuse.</p>\n</blockquote>\n\n<p>Does this mean that <strong>idle</strong> connections are closed after <code>d</code> has expired or that connections are closed in any case (either idle or not) after <code>d</code> has expired like <code>SetConnMaxLifetime</code> suggests?\nAlso what does closing lazily mean in this case and is it possible to implement a timeout using this method?</p>\n"}, {"tags": ["string", "go", "int", "type-conversion"], "answers": [{"comments": [{"owner": {"reputation": 2942, "user_id": 693081, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d5c756c708e6626aae8db15c7c811a90?s=128&d=identicon&r=PG", "display_name": "Tushar", "link": "https://stackoverflow.com/users/693081/tushar"}, "reply_to_user": {"reputation": 367, "user_id": 3707288, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a4cccb853563fa6349abee5377d7a05e?s=128&d=identicon&r=PG&f=1", "display_name": "Xevious", "link": "https://stackoverflow.com/users/3707288/xevious"}, "edited": false, "score": 0, "creation_date": 1475756676, "post_id": 39876956, "comment_id": 67077368, "body": "@Xevious, Sorry for my quick response, I understood the question wrong. Apologies."}], "tags": [], "owner": {"reputation": 2942, "user_id": 693081, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d5c756c708e6626aae8db15c7c811a90?s=128&d=identicon&r=PG", "display_name": "Tushar", "link": "https://stackoverflow.com/users/693081/tushar"}, "is_accepted": false, "score": -4, "last_activity_date": 1475678304, "creation_date": 1475678304, "answer_id": 39876956, "question_id": 39876914, "link": "https://stackoverflow.com/questions/39876914/how-to-convert-a-uint16-to-a-2-byte-string-in-go/39876956#39876956", "title": "How to convert a uint16 to a 2 byte string in Go?", "body": "<p>Try the following </p>\n\n<pre><code>t := strconv.Itoa(123)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 367, "user_id": 3707288, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a4cccb853563fa6349abee5377d7a05e?s=128&d=identicon&r=PG&f=1", "display_name": "Xevious", "link": "https://stackoverflow.com/users/3707288/xevious"}, "edited": false, "score": 0, "creation_date": 1475678915, "post_id": 39877077, "comment_id": 67041050, "body": "Thank you for that. I had read over the encoding/binary page but was thrown off by varint in the names."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1475678580, "creation_date": 1475678580, "answer_id": 39877077, "question_id": 39876914, "link": "https://stackoverflow.com/questions/39876914/how-to-convert-a-uint16-to-a-2-byte-string-in-go/39877077#39877077", "title": "How to convert a uint16 to a 2 byte string in Go?", "body": "<p>While that is perfectly fine for what you're trying to do, the <a href=\"https://golang.org/pkg/encoding/binary/\"><code>encoding/binary</code></a> package has much more functionality for reading and writing binary values.</p>\n\n<p>You can use </p>\n\n<pre><code>i := uint16(0x474F)\n\nb := make([]byte, 2)\nbinary.BigEndian.PutUint16(b, i)\nfmt.Println(string(b))\n// GO\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/IdDnnOtS2V\">https://play.golang.org/p/IdDnnOtS2V</a></p>\n"}], "owner": {"reputation": 367, "user_id": 3707288, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a4cccb853563fa6349abee5377d7a05e?s=128&d=identicon&r=PG&f=1", "display_name": "Xevious", "link": "https://stackoverflow.com/users/3707288/xevious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1663, "favorite_count": 0, "accepted_answer_id": 39877077, "answer_count": 2, "score": 4, "last_activity_date": 1475678580, "creation_date": 1475678185, "last_edit_date": 1475678323, "question_id": 39876914, "link": "https://stackoverflow.com/questions/39876914/how-to-convert-a-uint16-to-a-2-byte-string-in-go", "title": "How to convert a uint16 to a 2 byte string in Go?", "body": "<p>I am dealing with some legacy data where I routinely need to convert a uint16 to a 2 byte string.</p>\n\n<p>Here is what I am using (where i is a uint16):</p>\n\n<pre><code>string([]byte {byte(i &gt;&gt; 8), byte(i &amp; 0xFF)})\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/423CAL-SJv\" rel=\"nofollow\">https://play.golang.org/p/423CAL-SJv</a></p>\n\n<p>This seems rather clunky. Is there an existing library function to do this? I have looked at both the strings and binary packages, but nothing seemed immediately obvious.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-storage"], "answers": [{"tags": [], "owner": {"reputation": 7229, "user_id": 178236, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9b46e503bdfc5dfe07ec0f5a7c542184?s=128&d=identicon&r=PG", "display_name": "Justin Beckwith", "link": "https://stackoverflow.com/users/178236/justin-beckwith"}, "is_accepted": false, "score": 0, "last_activity_date": 1489384953, "creation_date": 1489384953, "answer_id": 42757432, "question_id": 39874226, "link": "https://stackoverflow.com/questions/39874226/google-app-engine-import-issue-golang-in-app-engine-flexible-environment-fo/42757432#42757432", "title": "Google App Engine import issue (golang) in &quot;App Engine flexible environment&quot; (formerly known as &quot;Managed VMs&quot;)", "body": "<p>So sorry - we have some docs to go update.  You cannot use the golang/appengine package with the App Engine flexible environment.  The aefix tool won't work here either.  Instead of the App Engine Go SDK, you want to use the Go client library here:</p>\n\n<p><a href=\"https://github.com/GoogleCloudPlatform/google-cloud-go\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/google-cloud-go</a></p>\n\n<p>If you were previously using <code>vm:true</code>, you will need to upgrade to <code>env:flex</code> - the instructions (and the note on the go app engine library) are here:</p>\n\n<p><a href=\"https://cloud.google.com/appengine/docs/flexible/go/upgrading\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/flexible/go/upgrading</a></p>\n\n<p>Let me know if you have any questions!</p>\n"}], "owner": {"reputation": 68, "user_id": 5412162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb30c00ff0ecf1a3409f8b1a03ff2c7c?s=128&d=identicon&r=PG&f=1", "display_name": "Vroenguard", "link": "https://stackoverflow.com/users/5412162/vroenguard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 449, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1489384953, "creation_date": 1475671176, "last_edit_date": 1475671483, "question_id": 39874226, "link": "https://stackoverflow.com/questions/39874226/google-app-engine-import-issue-golang-in-app-engine-flexible-environment-fo", "title": "Google App Engine import issue (golang) in &quot;App Engine flexible environment&quot; (formerly known as &quot;Managed VMs&quot;)", "body": "<p>I am developing an API in golang directly on the \"App Engine flexible environment\" (formerly known as \"Managed VMs\").</p>\n\n<p>So far, i have been using this kind of import in my .go files :</p>\n\n<pre><code>import ( \n        \"appengine\"\n        \"appengine/datastore\"\n        ...)\n</code></pre>\n\n<p>Recently I decided to use Google Cloud Storage to store images. It requires the import of \"cloud.google.com/go/storage\". My problem is that i'm unable to deploy the app with this import (not found), or any other short version (\"go/storage\") like I use for the appengine import.</p>\n\n<p>After much research, I found this : <a href=\"https://github.com/golang/appengine#user-content-3-update-code-using-deprecated-removed-or-modified-apis\" rel=\"nofollow\">https://github.com/golang/appengine#user-content-3-update-code-using-deprecated-removed-or-modified-apis</a></p>\n\n<p>It specifies how to migrate an application using short imports (deprecated, like mine) to full imports (with repository explicit like \"google.golang.org/appengine\")</p>\n\n<p>I followed the procedure and used the script they provide to update my code (aefix). They also say to add this line to my app.yaml file :</p>\n\n<pre><code>vm : true\n</code></pre>\n\n<p>If I do, I got this error message running 'gcloud app deploy' :</p>\n\n<pre><code>ERROR: (gcloud.app.deploy) Your application does not satisfy all of the requirements for a runtime of type [go].  Please correct the errors and try again.\n</code></pre>\n\n<p>If I don't, none of my imports are working and I get the following error :</p>\n\n<pre><code>can't find import: \"google.golang.org/appengine/datastore\"\n</code></pre>\n\n<p>Here is my app.yaml file : </p>\n\n<pre><code>runtime: go\napi_version: go2\n#vm : true\n\nhandlers:\n   - url: /.*\n   script: _go_app\n</code></pre>\n\n<p>Of course, all the imports are on the server under $GOPATH/src/ so they're not really missing, more badly referenced I guess.</p>\n\n<p>I'm stuck on this problem since several days, any help of any kind would be appreciated !</p>\n\n<p>Thanks</p>\n"}, {"tags": ["pointers", "go", "struct", "types", "interface"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1475669627, "post_id": 39873323, "comment_id": 67033860, "body": "you shuoldn&#39;t pass interfaces as pointers.  a pointer to <code>*Category</code> is a  <code>Node</code>, not a pointer to <code>Node</code>."}], "answers": [{"comments": [{"owner": {"reputation": 195, "user_id": 5778483, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/530ecad826cab806010c68d4a5c7e605?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos", "link": "https://stackoverflow.com/users/5778483/marcos"}, "edited": false, "score": 0, "creation_date": 1475686007, "post_id": 39873663, "comment_id": 67045863, "body": "How do I make SetFather a method of the (pointer?) interface?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 195, "user_id": 5778483, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/530ecad826cab806010c68d4a5c7e605?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos", "link": "https://stackoverflow.com/users/5778483/marcos"}, "edited": false, "score": 0, "creation_date": 1475689561, "post_id": 39873663, "comment_id": 67047812, "body": "@Marcos When you list the <code>SetFather()</code> method &quot;under&quot; <code>Node</code>, then it will be a method of the <code>Node</code> interface. When you declare a <code>func (c *Category) SetFather(node Node)</code> method, then this <code>SetFather()</code> becomes a method of the type <code>*Category</code> (the receiver). So if you do the same with all other methods of <code>Node</code>, then the type <code>*Categroy</code> will implement <code>Node</code> and so a value of type <code>*Category</code> can be assigned to a variable of type <code>Node</code>."}, {"owner": {"reputation": 1409, "user_id": 745834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b616c6e9cb4e2fb33ce5bc17662ecfc7?s=128&d=identicon&r=PG", "display_name": "marsbear", "link": "https://stackoverflow.com/users/745834/marsbear"}, "edited": false, "score": 1, "creation_date": 1516285653, "post_id": 39873663, "comment_id": 83632374, "body": "Pointers to interfaces are used quite often. The http-package of Go wouldn&#39;t work without them."}, {"owner": {"reputation": 1409, "user_id": 745834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b616c6e9cb4e2fb33ce5bc17662ecfc7?s=128&d=identicon&r=PG", "display_name": "marsbear", "link": "https://stackoverflow.com/users/745834/marsbear"}, "edited": false, "score": 0, "creation_date": 1516285993, "post_id": 39873663, "comment_id": 83632611, "body": "Just don&#39;t write node *Node in the function header (but keep the pointers elsewhere if you want to work with pointers)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 7, "last_activity_date": 1475672885, "last_edit_date": 1475672885, "creation_date": 1475669626, "answer_id": 39873663, "question_id": 39873323, "link": "https://stackoverflow.com/questions/39873323/golang-type-assertion-with-pointers/39873663#39873663", "title": "Golang type assertion with pointers", "body": "<p>Your parameter is <code>node *Node</code>, it is of type <code>*Node</code>. <code>Node</code> is an interface type, but <code>*Node</code> is not: it is a pointer to interface.</p>\n\n<p>Don't use pointer to interface, it is very rarely needed. Instead change it to <code>node Node</code>. Also change all your other <code>*Node</code> pointers to just <code>Node</code>.</p>\n\n<p>Also if <code>Category.SetFather()</code> method intends to change the <code>Category</code> value identified as the receiver, it must be a pointer else you'd only end up changing a copy which will be discarded after <code>SetFather()</code> returns. So use a receiver like <code>c *Category</code>.</p>\n\n<p>Going further, if the <code>node</code> argument contains a <code>*Category</code> wrapped in an interface, you can't directly assign it to <code>Category.father</code> as that is a non-pointer type <code>Category</code>. You need a pointer indirection, e.g. <code>c.father = *v</code>; or change the type of the <code>father</code> field to be a pointer: <code>father *Category</code>.</p>\n\n<p>Corrected <code>SetFather()</code> method could look like this:</p>\n\n<pre><code>func (c *Category) SetFather(node Node) {\n    if v, ok := node.(*Category); ok {\n        c.father = *v\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1409, "user_id": 745834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b616c6e9cb4e2fb33ce5bc17662ecfc7?s=128&d=identicon&r=PG", "display_name": "marsbear", "link": "https://stackoverflow.com/users/745834/marsbear"}, "is_accepted": false, "score": 1, "last_activity_date": 1612819018, "last_edit_date": 1612819018, "creation_date": 1503604824, "answer_id": 45869978, "question_id": 39873323, "link": "https://stackoverflow.com/questions/39873323/golang-type-assertion-with-pointers/45869978#45869978", "title": "Golang type assertion with pointers", "body": "<p>This should work:</p>\n<pre><code>(*nodo).(Category)\n</code></pre>\n<p>De-reference first, assert afterwards.</p>\n"}], "owner": {"reputation": 195, "user_id": 5778483, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/530ecad826cab806010c68d4a5c7e605?s=128&d=identicon&r=PG&f=1", "display_name": "Marcos", "link": "https://stackoverflow.com/users/5778483/marcos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10403, "favorite_count": 1, "answer_count": 2, "score": 7, "last_activity_date": 1612819018, "creation_date": 1475668652, "last_edit_date": 1475673370, "question_id": 39873323, "link": "https://stackoverflow.com/questions/39873323/golang-type-assertion-with-pointers", "title": "Golang type assertion with pointers", "body": "<p>I've been working in an interface to use as a hierarchical tree. The idea is to aloud the concrete implementations to call <code>.Children()</code>, <code>.Father()</code> and a function to auto populate the hierarchy based on a slice of <code>{id, FatherId}</code> schema.</p>\n\n<p>I only need three different implementations of this interface, maybe it's more convenient to do the whole thing for each struct but I'm new to Go and decided to use this example to understand interfaces.</p>\n\n<p>I've come to an interface that looks something like this:</p>\n\n<pre><code>type Node interface{\n    Equals(nodo *Node) bool\n    AddChild(child *Node)\n    SetFather(father *Node)\n\n    Children() []Node\n    Father() *Node\n}\n</code></pre>\n\n<p>So the idea is call a <code>Populate</code> function:</p>\n\n<pre><code>func Populate(plainNodes []Node, HierarchichalNodes *[]Node) {}\n</code></pre>\n\n<p>Plain nodes would be items defining the id of his father:</p>\n\n<pre><code>{id: \"Animal\", father: \"\"}\n{id: \"Plant\", father: \"\"}\n{id: \"Mammals\", father: \"Animal\"}\n</code></pre>\n\n<p>Hierarchical nodes would be the result:</p>\n\n<pre><code>Animal\n|__Mammals\n\nPlant\n</code></pre>\n\n<p>The problem I'm getting is when I try to implement the interface in a concrete struct, this case <code>\"Category\"</code>.</p>\n\n<pre><code>type Category struct{\n    children []Category\n    father Category\n}\n\nfunc (c Category) SetFather(node *Node) {\n    v, ok = node.(*Category)\n    c.father = v\n}\n</code></pre>\n\n<p>Notice that in <code>Category</code> I want to work with <code>Category</code> father and children, not with interface <code>Node</code>.</p>\n\n<p>I can't do the conversion, I get :</p>\n\n<pre><code>invalid type assertion: nodo.(*Category) (non-interface type *Node on left)\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["sql", "database", "postgresql", "go", "pq"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1475662937, "post_id": 39871267, "comment_id": 67029433, "body": "Related / possible duplicate of <a href=\"http://stackoverflow.com/questions/30867337/golang-order-by-issue-with-mysql\">Golang ORDER BY issue with MySql</a>."}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1559844718, "post_id": 39871267, "comment_id": 99556288, "body": "maybe you should perform a type cast  as explained here: <a href=\"https://github.com/jackc/pgx/issues/281#issuecomment-307247685\" rel=\"nofollow noreferrer\">github.com/jackc/pgx/issues/281#issuecomment-307247685</a>"}], "answers": [{"comments": [{"owner": {"reputation": 182, "user_id": 3696649, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/aS6iJ.jpg?s=128&g=1", "display_name": "Kurt Stolle", "link": "https://stackoverflow.com/users/3696649/kurt-stolle"}, "edited": false, "score": 0, "creation_date": 1475662887, "post_id": 39871320, "comment_id": 67029407, "body": "I figured that is one method to do this, but that would require me to make a list of field names in the database, which is a hassle to update every time I update a field in the database. Is there not another way to do it using a placeholder instead?"}, {"owner": {"reputation": 1189, "user_id": 3931609, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/4n2cW.jpg?s=128&g=1", "display_name": "Kul", "link": "https://stackoverflow.com/users/3931609/kul"}, "edited": false, "score": 0, "creation_date": 1475662931, "post_id": 39871320, "comment_id": 67029428, "body": "You can apply a regex and make sure only valid characters are allowed."}, {"owner": {"reputation": 78861, "user_id": 561309, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/6d833d9f0ffa2265a01359ccecd26d54?s=128&d=identicon&r=PG&f=1", "display_name": "laurent", "link": "https://stackoverflow.com/users/561309/laurent"}, "edited": false, "score": 1, "creation_date": 1475663329, "post_id": 39871320, "comment_id": 67029650, "body": "You can also get the list of valid fields using something like this: <a href=\"http://dba.stackexchange.com/a/22368/37012\">dba.stackexchange.com/a/22368/37012</a> Then maybe cache the result of this query so that you can refer to it as needed."}], "tags": [], "owner": {"reputation": 78861, "user_id": 561309, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/6d833d9f0ffa2265a01359ccecd26d54?s=128&d=identicon&r=PG&f=1", "display_name": "laurent", "link": "https://stackoverflow.com/users/561309/laurent"}, "is_accepted": true, "score": 1, "last_activity_date": 1475662663, "creation_date": 1475662663, "answer_id": 39871320, "question_id": 39871267, "link": "https://stackoverflow.com/questions/39871267/postgres-could-not-determine-data-type-of-parameter-1-in-golang-application/39871320#39871320", "title": "Postgres could not determine data type of parameter $1 in Golang application", "body": "<p>You cannot use placeholders for field names. You'll have to build the query directly, as in:</p>\n\n<pre><code>\"SELECT `\" + field + \"` FROM \"\n</code></pre>\n\n<p>To avoid SQL injections, make sure that the field is part of a list of allowed fields beforehand.</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1475666549, "post_id": 39872049, "comment_id": 67031825, "body": "<i>Easiest</i> does not imply <i>safest</i>. Package <code>fmt</code> has no knowledge of and does not attempt to prevent any SQL injection attacks."}, {"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1475667479, "post_id": 39872049, "comment_id": 67032444, "body": "I didn&#39;t mean it to be safe, just answered the question &quot;Is there another way to do this?&quot;."}, {"owner": {"reputation": 5017, "user_id": 2047418, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1d49bccfa9d2c633db6f854e67b88362?s=128&d=identicon&r=PG", "display_name": "Filip Bartuzi", "link": "https://stackoverflow.com/users/2047418/filip-bartuzi"}, "edited": false, "score": 3, "creation_date": 1499332405, "post_id": 39872049, "comment_id": 76864495, "body": "@Jean-NicolasMoal and probably you made someone lost his job, lol :D"}], "tags": [], "owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "is_accepted": false, "score": -3, "last_activity_date": 1475667500, "last_edit_date": 1475667500, "creation_date": 1475664818, "answer_id": 39872049, "question_id": 39871267, "link": "https://stackoverflow.com/questions/39871267/postgres-could-not-determine-data-type-of-parameter-1-in-golang-application/39872049#39872049", "title": "Postgres could not determine data type of parameter $1 in Golang application", "body": "<p>IMHO an easier way, but not safe, to create SQL queries is to use fmt.Sprintf:</p>\n\n<pre><code>query := fmt.Sprintf(\"SELECT %s FROM %s WHERE uuid=%s\", field, db, UUIDOrURI)\nif err := conn.QueryRow(query).scan(&amp;ifc); err != nil {\n\n}\n</code></pre>\n\n<p>You can even specify an argument index:</p>\n\n<pre><code>query := fmt.Sprintf(\"SELECT %[2]s FROM %[1]s\", db, field)\n</code></pre>\n\n<p>In order to ease the development, I recommend to use a package for the postgresql communication, I tried <a href=\"https://github.com/go-gorp/gorp\" rel=\"nofollow\">this one</a> and worked great.</p>\n"}], "owner": {"reputation": 182, "user_id": 3696649, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/aS6iJ.jpg?s=128&g=1", "display_name": "Kurt Stolle", "link": "https://stackoverflow.com/users/3696649/kurt-stolle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6808, "favorite_count": 0, "accepted_answer_id": 39871320, "answer_count": 2, "score": 4, "last_activity_date": 1475667500, "creation_date": 1475662515, "question_id": 39871267, "link": "https://stackoverflow.com/questions/39871267/postgres-could-not-determine-data-type-of-parameter-1-in-golang-application", "title": "Postgres could not determine data type of parameter $1 in Golang application", "body": "<p>I am creating an application in Golang that uses Postgres using the pq driver. I want to make a function that can select a user-determined field from my database, but I get an error:</p>\n\n<blockquote>\n  <p>pq: could not determine data type of parameter $1</p>\n</blockquote>\n\n<p>Below is the code that generated this error:</p>\n\n<pre><code>var ifc interface{}\n\nif err := conn.QueryRow(\"SELECT $1 FROM \"+db+\" WHERE uuid=$3 OR uri=$4 LIMIT 1\", field, UUIDOrURI, UUIDOrURI).Scan(&amp;ifc); err != nil {\n    if err == sql.ErrNoRows {\n        return http.StatusNotFound\n    }\n\n    log.Println(err)\n\n    return http.StatusInternalServerError\n}\n</code></pre>\n\n<p>Why can I not insert the field that I want to  <code>SELECT</code> using <code>$1</code>? Is there another way to do this?</p>\n"}, {"tags": ["performance", "http", "go", "stack"], "comments": [{"owner": {"reputation": 1189, "user_id": 3931609, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/4n2cW.jpg?s=128&g=1", "display_name": "Kul", "link": "https://stackoverflow.com/users/3931609/kul"}, "edited": false, "score": 0, "creation_date": 1475660288, "post_id": 39869716, "comment_id": 67027702, "body": "It&#39;s easy to compare the performance of this vs the regular way of doing it. That should help you more than any comment here"}], "answers": [{"comments": [{"owner": {"reputation": 1127, "user_id": 6171872, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2wfQM.jpg?s=128&g=1", "display_name": "StarSheriff", "link": "https://stackoverflow.com/users/6171872/starsheriff"}, "edited": false, "score": 0, "creation_date": 1475663342, "post_id": 39870646, "comment_id": 67029663, "body": "Thanks, that was spot on what I hoped to get as response. +1 for putting things in perspective serving requests vs. handling stack operations. Should be obvious but it didn&#39;t occur to me in the first place."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1475676030, "last_edit_date": 1475676030, "creation_date": 1475660750, "answer_id": 39870646, "question_id": 39869716, "link": "https://stackoverflow.com/questions/39869716/http-handle-wrapper-pattern-will-the-stack-be-bloated/39870646#39870646", "title": "http.Handle wrapper pattern -&gt; will the stack be bloated?", "body": "<p>Chaining middlewares is basically just making the handlers of the chain call the next one, often based on a condition whether everything went well. Or in another approach some external mechanism may call handlers one-by-one.</p>\n\n<p>However, all things come down to that the handlers will be called. The <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow\"><code>Handler.ServeHTTP()</code></a> method looks like this:</p>\n\n<pre><code>type Handler interface {\n    ServeHTTP(ResponseWriter, *Request)\n}\n</code></pre>\n\n<p>A simple method with 2 parameters and no return values. The parameters are of type <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow\"><code>http.ResponseWriter</code></a> (an interface type) and <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow\"><code>*http.Request</code></a> (a pointer type).</p>\n\n<p>So a call to a handler's <code>ServeHTTP()</code> involves 2 things: making a copy of its arguments - which is fast since they are small, and actually making the call (taking care of stack update like create a new stack frame, record return address, save used registers, and execute the called function) - which is also very fast (see quote at the end of the answer).</p>\n\n<p>So should you worry about calling functions? No. Will this be less performant compared to a handler which contains everything? Yes. Is the difference significant? No. Serving an HTTP request could take hundreds of milliseconds (network latency included). Calling 10 functions in your handler will not make it noticeably slower.</p>\n\n<p>If you'd worry about the performance loss due to function calls, then your app would consist of one single <code>main()</code> function. Obviously nobody wants that. You create functions to break down your initially large problem to smaller ones (recursively until it is \"small enough\" to be on its own) which you can <em>oversee</em> and <em>reuse</em> and <em>test</em> independently from others, and you <em>assemble</em> your large problem from the smaller ones. It's not really a question of performance but <em>maintainability</em> and <em>reusability</em>. Would you really want to copy that 100-line code which checks the user's identity to all your 10 different handlers?</p>\n\n<p>One last thing. Should you be concerned about \"consuming\" the stack (resulting in a stack overflow error)? The answer is no. A goroutine starts with a small 4096 byte stack which grows and shrinks as needed without the risk of ever running out. Read more about it at <a href=\"http://dave.cheney.net/2013/06/02/why-is-a-goroutines-stack-infinite\" rel=\"nofollow\">Why is a Goroutine\u2019s stack infinite?</a> Also detailed at <a href=\"https://golang.org/doc/faq#goroutines\" rel=\"nofollow\">FAQ: Why goroutines instead of threads?</a></p>\n\n<blockquote>\n  <p>To make the stacks small, Go's run-time uses resizable, bounded stacks. A newly minted goroutine is given a few kilobytes, which is almost always enough. When it isn't, the run-time grows (and shrinks) the memory for storing the stack automatically, allowing many goroutines to live in a modest amount of memory. The CPU overhead averages about three cheap instructions per function call.</p>\n</blockquote>\n"}], "owner": {"reputation": 1127, "user_id": 6171872, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2wfQM.jpg?s=128&g=1", "display_name": "StarSheriff", "link": "https://stackoverflow.com/users/6171872/starsheriff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 39870646, "answer_count": 1, "score": 3, "last_activity_date": 1475676030, "creation_date": 1475658307, "question_id": 39869716, "link": "https://stackoverflow.com/questions/39869716/http-handle-wrapper-pattern-will-the-stack-be-bloated", "title": "http.Handle wrapper pattern -&gt; will the stack be bloated?", "body": "<p>I am doing a first production webservice in go, so I am quite new to the language and some concepts/patterns. </p>\n\n<p>My question is related to handlers and essentially how to pull out duplicated code without degrading performance.</p>\n\n<p>I have come accross the pattern to wrap either <code>http.Handle</code> or <code>http.HandlerFunc</code> to clean up code. For example this blog post here using an adapter pattern <a href=\"https://medium.com/@matryer/writing-middleware-in-golang-and-how-go-makes-it-so-much-fun-4375c1246e81#.hvsc236iv\" rel=\"nofollow\">https://medium.com/@matryer/writing-middleware-in-golang-and-how-go-makes-it-so-much-fun-4375c1246e81#.hvsc236iv</a></p>\n\n<p>It might end up with something like this (copied from the blob post): </p>\n\n<pre><code>http.Handle(\"/\", Adapt(indexHandler, AddHeader(\"Server\", \"Mine\"),\n                                 CheckAuth(providers),\n                                 CopyMgoSession(db),\n                                 Notify(logger), \n                               )\n</code></pre>\n\n<p>which is basically a deeply nested function call.</p>\n\n<p>The question I have is what happens in the stack and the performance of the service? With this pattern, every single user request will add at least 5 stack frames to the stack. Is that acceptable or will it have a negative effect on performance when traffic is high?</p>\n"}, {"tags": ["arrays", "go", "initialization", "slice"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 49, "last_activity_date": 1475653823, "creation_date": 1475653823, "answer_id": 39868255, "question_id": 39868029, "link": "https://stackoverflow.com/questions/39868029/how-to-generate-a-sequence-of-numbers/39868255#39868255", "title": "How to generate a sequence of numbers", "body": "<p>There is no equivalent to PHP's <code>range</code> in the Go standard library. You have to create one yourself. The simplest is to use a <code>for</code> loop:</p>\n\n<pre><code>func makeRange(min, max int) []int {\n    a := make([]int, max-min+1)\n    for i := range a {\n        a[i] = min + i\n    }\n    return a\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>a := makeRange(10, 20)\nfmt.Println(a)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/cjr9KpF4va\">Go Playground</a>):</p>\n\n<pre><code>[10 11 12 13 14 15 16 17 18 19 20]\n</code></pre>\n\n<p>Also note that if the range is small, you can use a <a href=\"https://golang.org/ref/spec#Composite_literals\">composite literal</a>:</p>\n\n<pre><code>a := []int{1, 2, 3}\nfmt.Println(a) // Output is [1 2 3]\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 7, "last_activity_date": 1475656146, "last_edit_date": 1475656146, "creation_date": 1475654605, "answer_id": 39868500, "question_id": 39868029, "link": "https://stackoverflow.com/questions/39868029/how-to-generate-a-sequence-of-numbers/39868500#39868500", "title": "How to generate a sequence of numbers", "body": "<p>1- You may use:</p>\n\n<pre><code>//Create a slice containing a range of elements.\n//\n//  start: First value of the sequence.\n//  end:   The sequence is ended upon reaching the end value.\n//  step:  step will be used as the increment between elements in the sequence.\n//         step should be given as a positive number.\n//\n//Return Values: Returns a slice of elements from start to end, inclusive.\nfunc NewSlice(start, end, step int) []int {\n    if step &lt;= 0 || end &lt; start {\n        return []int{}\n    }\n    s := make([]int, 0, 1+(end-start)/step)\n    for start &lt;= end {\n        s = append(s, start)\n        start += step\n    }\n    return s\n}\n</code></pre>\n\n<p>Try it on <a href=\"https://play.golang.org/p/tEfJFlqyBn\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n//Create a slice containing a range of elements.\n//\n//  start: First value of the sequence.\n//  end:   The sequence is ended upon reaching the end value.\n//  step:  step will be used as the increment between elements in the sequence.\n//         step should be given as a positive number.\n//\n//Return Values: Returns a slice of elements from start to end, inclusive.\nfunc NewSlice(start, end, step int) []int {\n    if step &lt;= 0 || end &lt; start {\n        return []int{}\n    }\n    s := make([]int, 0, 1+(end-start)/step)\n    for start &lt;= end {\n        s = append(s, start)\n        start += step\n    }\n    return s\n}\n\nfunc main() {\n    s := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}\n    fmt.Println(s) // [0 1 2 3 4 5 6 7 8 9]\n\n    fmt.Println(NewSlice(10, 19, 1))  // [10 11 12 13 14 15 16 17 18 19]\n    fmt.Println(NewSlice(10, 28, 2))  // [10 12 14 16 18 20 22 24 26 28]\n    fmt.Println(NewSlice(-10, -1, 1)) // [-10 -9 -8 -7 -6 -5 -4 -3 -2 -1]\n}\n</code></pre>\n\n<hr>\n\n<p>2- You may use:</p>\n\n<pre><code>// Returns a slice of elements with exact count.\n// step will be used as the increment between elements in the sequence.\n// step should be given as a positive, negative or zero number.\nfunc NewSlice(start, count, step int) []int {\n    s := make([]int, count)\n    for i := range s {\n        s[i] = start\n        start += step\n    }\n    return s\n}\n</code></pre>\n\n<p>Try it on <a href=\"https://play.golang.org/p/P3lqcVTIxM\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc NewSlice(start, count, step int) []int {\n    s := make([]int, count)\n    for i := range s {\n        s[i] = start\n        start += step\n    }\n    return s\n}\n\nfunc main() {\n    s := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}\n    fmt.Println(s) // [0 1 2 3 4 5 6 7 8 9]\n\n    fmt.Println(NewSlice(10, 10, 1))  // [10 11 12 13 14 15 16 17 18 19]\n    fmt.Println(NewSlice(10, 10, 2))  // [10 12 14 16 18 20 22 24 26 28]\n    fmt.Println(NewSlice(-1, 10, -1)) // [-1 -2 -3 -4 -5 -6 -7 -8 -9 -10]\n    fmt.Println(NewSlice(20, 10, 0))  // [20 20 20 20 20 20 20 20 20 20]\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 5017813, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x4fnD.jpg?s=128&g=1", "display_name": "hunknownz", "link": "https://stackoverflow.com/users/5017813/hunknownz"}, "is_accepted": false, "score": 0, "last_activity_date": 1579513107, "creation_date": 1579513107, "answer_id": 59820464, "question_id": 39868029, "link": "https://stackoverflow.com/questions/39868029/how-to-generate-a-sequence-of-numbers/59820464#59820464", "title": "How to generate a sequence of numbers", "body": "<p>You can try this code <a href=\"https://play.golang.org/p/zWP-LIN8njF\" rel=\"nofollow noreferrer\">GenerateSequenceInt</a>, it's like Python's <code>range</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"errors\"\n)\n\nfunc GenerateSequenceInt(begin, end, step int) (sequence []int){\n    if step == 0 {\n        panic(errors.New(\"step must not be zero\"))\n    }\n    count := 0\n    if (end &gt; begin &amp;&amp; step &gt; 0) || (end &lt; begin &amp;&amp; step &lt; 0) {\n        count = (end-step-begin)/step + 1\n    }\n\n    sequence = make([]int, count)\n    for i := 0; i &lt; count; i, begin = i+1, begin+step {\n        sequence[i] = begin\n    }\n    return\n}\n\nfunc main() {\n    seq1 := GenerateSequenceInt(-1,11,-3)   \n    fmt.Println(seq1)\n\n    seq2 := GenerateSequenceInt(1,-1,3)\n    fmt.Println(seq2)\n\n    seq3 := GenerateSequenceInt(1,1,1)\n    fmt.Println(seq3)\n\n    seq4 := GenerateSequenceInt(1, 11, 2)\n    fmt.Println(seq4)\n\n    seq5 := GenerateSequenceInt(1, -11, -2)\n    fmt.Println(seq5)\n}\n</code></pre>\n"}], "owner": {"reputation": 4379, "user_id": 184176, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/811251725188ac87f9125177073c28d0?s=128&d=identicon&r=PG", "display_name": "sepehr", "link": "https://stackoverflow.com/users/184176/sepehr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29685, "favorite_count": 5, "accepted_answer_id": 39868255, "answer_count": 3, "score": 37, "last_activity_date": 1579513107, "creation_date": 1475653043, "last_edit_date": 1577438521, "question_id": 39868029, "link": "https://stackoverflow.com/questions/39868029/how-to-generate-a-sequence-of-numbers", "title": "How to generate a sequence of numbers", "body": "<p>I want to generate a sequence of numbers in Go but I can't find any built-in functions for this.<br>\nBasically I want the equivalent of PHP's <a href=\"http://php.net/manual/en/function.range.php\" rel=\"noreferrer\">range</a> function in Golang:  </p>\n\n<pre><code>array range ( mixed $start , mixed $end [, number $step = 1 ] )\n</code></pre>\n\n<p>It would be useful when creating a slice/array of numeric types and you want to populate/initialize it with a numeric sequence.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1475652298, "post_id": 39867603, "comment_id": 67022881, "body": "Is the text inside <code>&quot;&lt;server&gt;&quot;</code> const or not?  e.g.: <code>&lt;localhost&gt;</code> or just <code>&lt;server&gt;</code>?"}, {"owner": {"reputation": 2269, "user_id": 3016716, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wCaTR.jpg?s=128&g=1", "display_name": "shivams", "link": "https://stackoverflow.com/users/3016716/shivams"}, "edited": false, "score": 0, "creation_date": 1475652371, "post_id": 39867603, "comment_id": 67022916, "body": "@Amd Text inside &lt;server&gt; is changing. That is why i need to preserve it after unmarshlling so that i can work further on it."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1475652617, "post_id": 39867603, "comment_id": 67023042, "body": "is it possible to change your JSON format a little or not? e.g. <code>{&quot;Server&quot;:&quot;Server12&quot;,&quot;Guest&quot;:&quot;Guest2&quot;,&quot;Service&quot;:&quot;Service2&quot;,&quot;&zwnj;&#8203;Part&quot;:&quot;Part2&quot;,&quot;Detai&zwnj;&#8203;ls&quot;:{&quot;Bytes&quot;:1,&quot;File&zwnj;&#8203;s&quot;:2,&quot;Timestamp&quot;:&quot;20&zwnj;&#8203;16-10-05T07:21:22.98&zwnj;&#8203;87031Z&quot;}}</code> or it is out of your control?"}, {"owner": {"reputation": 2269, "user_id": 3016716, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wCaTR.jpg?s=128&g=1", "display_name": "shivams", "link": "https://stackoverflow.com/users/3016716/shivams"}, "edited": false, "score": 0, "creation_date": 1475652725, "post_id": 39867603, "comment_id": 67023111, "body": "I know that by changing json format it would be easy. But at present it is not in my control."}], "answers": [{"comments": [{"owner": {"reputation": 2269, "user_id": 3016716, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wCaTR.jpg?s=128&g=1", "display_name": "shivams", "link": "https://stackoverflow.com/users/3016716/shivams"}, "edited": false, "score": 0, "creation_date": 1475652498, "post_id": 39867714, "comment_id": 67022987, "body": "Above structure is giving me output <code>{{{{{  0001-01-01 00:00:00 +0000 UTC}}}}}</code> for a json structure of <code>{   &quot;server&quot;: { &quot;guest&quot;: {             &quot;service&quot;: {&quot;part&quot;: {                         &quot;num&quot;: &quot;1024&quot;,                         &quot;type&quot;: &quot;10&quot;,                         &quot;timestamp&quot;: &quot;2016-02-21T12:53:12Z&quot;   }}}}}</code>"}, {"owner": {"reputation": 2269, "user_id": 3016716, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wCaTR.jpg?s=128&g=1", "display_name": "shivams", "link": "https://stackoverflow.com/users/3016716/shivams"}, "edited": false, "score": 1, "creation_date": 1475652604, "post_id": 39867714, "comment_id": 67023034, "body": "Also above structure will not preserve keys i.e. i cannot access server, guest names in struct."}], "tags": [], "owner": {"reputation": 1157, "user_id": 5154802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZqLky3QxN2E/AAAAAAAAAAI/AAAAAAAAAEE/MyYiHfmqVe0/photo.jpg?sz=128", "display_name": "shivendra pratap singh", "link": "https://stackoverflow.com/users/5154802/shivendra-pratap-singh"}, "is_accepted": false, "score": 1, "last_activity_date": 1475651989, "creation_date": 1475651989, "answer_id": 39867714, "question_id": 39867603, "link": "https://stackoverflow.com/questions/39867603/decoding-json-keeping-all-keys/39867714#39867714", "title": "Decoding JSON keeping all keys", "body": "<p>For above JSON this structure will work fine.</p>\n\n<pre><code>    type Report struct {\n        Server struct {\n            Guest struct {\n                Service struct {\n                    Part struct {\n                        Num string `json:\"num\"`\n                        Type string `json:\"type\"`\n                        Timestamp time.Time `json:\"timestamp\"`\n                    } `json:\"&lt;part&gt;\"`\n                } `json:\"&lt;service&gt;\"`\n            } `json:\"&lt;guest&gt;\"`\n        } `json:\"&lt;server&gt;\"`\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1475653615, "last_edit_date": 1475653615, "creation_date": 1475653200, "answer_id": 39868074, "question_id": 39867603, "link": "https://stackoverflow.com/questions/39867603/decoding-json-keeping-all-keys/39868074#39868074", "title": "Decoding JSON keeping all keys", "body": "<p>1- Try it on <a href=\"https://play.golang.org/p/-QKz9z3cLe\" rel=\"nofollow\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    s := `{\n    \"&lt;server1&gt;\": {\n        \"&lt;guest2&gt;\": {\n            \"&lt;service3&gt;\": {\n                \"&lt;part4&gt;\": {\n                    \"num\": 12,\n                    \"type\": 14,\n                    \"timestamp\": \"2016-02-01T12:53:12Z\"\n                }\n            }\n        }\n    }\n}`\n\n    var data map[string]map[string]map[string]map[string]Section\n    err := json.Unmarshal([]byte(s), &amp;data)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(data)\n}\n\ntype Section struct {\n    Bytes     int       `json:\"num\"`\n    Files     int       `json:\"type\"`\n    Timestamp time.Time `json:\"timestamp\"`\n}\ntype Report struct {\n    Server  string\n    Guest   string\n    Service string\n    Part    string\n    Details Section\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>map[&lt;server1&gt;:map[&lt;guest2&gt;:map[&lt;service3&gt;:map[&lt;part4&gt;:{12 14 2016-02-01 12:53:12 +0000 UTC}]]]]\n</code></pre>\n\n<hr>\n\n<p>2- Converting to <code>Report struct</code>, try it on <a href=\"https://play.golang.org/p/T6M1iZZTMY\" rel=\"nofollow\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    s := `{\n    \"&lt;server1&gt;\": {\n        \"&lt;guest2&gt;\": {\n            \"&lt;service3&gt;\": {\n                \"&lt;part4&gt;\": {\n                    \"num\": 12,\n                    \"type\": 14,\n                    \"timestamp\": \"2016-02-01T12:53:12Z\"\n                }\n            }\n        }\n    }\n}`\n\n    var data map[string]map[string]map[string]map[string]Section\n    err := json.Unmarshal([]byte(s), &amp;data)\n    if err != nil {\n        fmt.Println(err)\n    }\n    r := Report{}\n    for k, v := range data {\n        r.Server = k\n        for k2, v2 := range v {\n            r.Guest = k2\n            for k3, v3 := range v2 {\n                r.Service = k3\n                for k4, v4 := range v3 {\n                    r.Part = k4\n                    r.Details = v4\n                }\n            }\n        }\n    }\n    fmt.Println(r)\n}\n\ntype Section struct {\n    Bytes     int       `json:\"num\"`\n    Files     int       `json:\"type\"`\n    Timestamp time.Time `json:\"timestamp\"`\n}\ntype Report struct {\n    Server  string\n    Guest   string\n    Service string\n    Part    string\n    Details Section\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{&lt;server1&gt; &lt;guest2&gt; &lt;service3&gt; &lt;part4&gt; {12 14 2016-02-01 12:53:12 +0000 UTC}}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "is_accepted": false, "score": 1, "last_activity_date": 1475727070, "last_edit_date": 1475727070, "creation_date": 1475724421, "answer_id": 39887034, "question_id": 39867603, "link": "https://stackoverflow.com/questions/39867603/decoding-json-keeping-all-keys/39887034#39887034", "title": "Decoding JSON keeping all keys", "body": "<p>I've written <a href=\"https://github.com/go-restit/lzjson\" rel=\"nofollow\">a library</a> that could make this easier to work with. The <code>Reports</code> can be unmarshaled against your JSON format:</p>\n\n\n\n<pre><code>package main\n\nimport (\n    \"time\"\n\n    \"github.com/go-restit/lzjson\"\n)\n\ntype Section struct {\n    Bytes     int       `json:\"num\"`\n    Files     int       `json:\"type\"`\n    Timestamp time.Time `json:\"timestamp\"`\n}\n\ntype Report struct {\n    Server  string\n    Guest   string\n    Service string\n    Part    string\n    Details Section\n}\n\ntype Reports []Report\n\nfunc (reports *Reports) UnmarshalJSON(content []byte) (err error) {\n\n    root := lzjson.NewNode()\n    if err = json.Unmarshal(content, &amp;root); err != nil {\n        return\n    }\n\n    // reset the slice of reports\n    *reports = make([]Report, 0, 10)\n\n    for _, serverName := range root.GetKeys() {\n        server := root.Get(serverName)\n        if err = server.Error(); err != nil {\n            return\n        }\n        for _, guestName := range server.GetKeys() {\n            guest := server.Get(guestName)\n            if err = guest.Error(); err != nil {\n                return\n            }\n            for _, serviceName := range guest.GetKeys() {\n                service := guest.Get(serviceName)\n                if err = service.Error(); err != nil {\n                    return\n                }\n                for _, partName := range service.GetKeys() {\n                    part := service.Get(partName)\n                    if err = part.Error(); err != nil {\n                        return\n                    }\n                    var report Report\n                    timestamp, _ := time.Parse(\"2006-01-02T15:04:05Z\", part.Get(\"timestamp\").String())\n                    report.Server = serverName\n                    report.Guest = guestName\n                    report.Service = serviceName\n                    report.Part = partName\n                    report.Details = Section{\n                        Bytes:     part.Get(\"num\").Int(),\n                        Files:     part.Get(\"type\").Int(),\n                        Timestamp: timestamp,\n                    }\n                    *reports = append(*reports, report)\n                }\n            }\n        }\n    }\n    return\n}\n</code></pre>\n\n<p>You can now do this:</p>\n\n\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n)\n\nfunc main() {\n    raw := `\n    {\n        \"&lt;server 1&gt;\": {\n            \"&lt;guest&gt;\": {\n                \"&lt;service&gt;\": {\n                    \"&lt;part&gt;\": {\n                        \"num\": \"&lt;number&gt;\",\n                        \"type\": \"&lt;type&gt;\",\n                        \"timestamp\": \"2016-02-01T12:53:12Z\"\n                    }\n                }\n            }\n        },\n        \"&lt;server 2&gt;\": {\n            \"&lt;guest&gt;\": {\n                \"&lt;service&gt;\": {\n                    \"&lt;part&gt;\": {\n                        \"num\": \"&lt;number&gt;\",\n                        \"type\": \"&lt;type&gt;\",\n                        \"timestamp\": \"2016-02-01T12:53:12Z\"\n                    }\n                }\n            }\n        }\n    }`\n    var reports Reports\n    err := json.Unmarshal([]byte(raw), &amp;reports)\n    if err != nil {\n        log.Fatalf(\"error reading reports: %s\", err.Error())\n    }\n    log.Printf(\"Reports: %#v\", reports)\n}\n</code></pre>\n"}], "owner": {"reputation": 2269, "user_id": 3016716, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wCaTR.jpg?s=128&g=1", "display_name": "shivams", "link": "https://stackoverflow.com/users/3016716/shivams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 398, "favorite_count": 1, "accepted_answer_id": 39868074, "answer_count": 3, "score": 0, "last_activity_date": 1475727070, "creation_date": 1475651624, "last_edit_date": 1475653957, "question_id": 39867603, "link": "https://stackoverflow.com/questions/39867603/decoding-json-keeping-all-keys", "title": "Decoding JSON keeping all keys", "body": "<p>I have JSON structure of this type </p>\n\n<pre><code>{\n    \"&lt;server&gt;\": {\n        \"&lt;guest&gt;\": {\n            \"&lt;service&gt;\": {\n                \"&lt;part&gt;\": {\n                    \"num\": \"&lt;number&gt;\",\n                    \"type\": \"&lt;type&gt;\",\n                    \"timestamp\": \"2016-02-01T12:53:12Z\"\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>During unmarshaling above JSON object I need to preserve keys e.g. <code>server</code>,<code>guest</code> etc. I thought of below struct but I am unable to unmarshal above JSON object as keys are lost during unmarshalling.</p>\n\n<pre><code>type Section struct {\n    Bytes     int       \n    Files     int       \n    Timestamp time.Time \n}\ntype Report struct {\n    Server  string\n    Guest   string\n    Service string\n    Part    string\n    Details Section\n}\n</code></pre>\n\n<p>Is there any way to unmarshal above JSON object into struct keeping keys intact.</p>\n\n<p>Edit:<br>\nText inside <code>&lt;server&gt;</code> is changing. That is why I need to preserve it after unmarshlling so that I can work further on it.</p>\n"}, {"tags": ["mongodb", "sorting", "go", "mgo"], "comments": [{"owner": {"reputation": 49301, "user_id": 3100115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46d2b7e69a0a4a82fefdd01a8cf476bd?s=128&d=identicon&r=PG&f=1", "display_name": "styvane", "link": "https://stackoverflow.com/users/3100115/styvane"}, "edited": false, "score": 0, "creation_date": 1475655879, "post_id": 39867585, "comment_id": 67024844, "body": "It&#39;s unclear what the expected result is. Can you please elaborate?"}], "answers": [{"tags": [], "owner": {"reputation": 2487, "user_id": 4221475, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a15516672256c586b4e059dea9780ce8?s=128&d=identicon&r=PG&f=1", "display_name": "Sachin", "link": "https://stackoverflow.com/users/4221475/sachin"}, "is_accepted": true, "score": 0, "last_activity_date": 1475653453, "creation_date": 1475653453, "answer_id": 39868152, "question_id": 39867585, "link": "https://stackoverflow.com/questions/39867585/filter-a-collection-but-sort-on-inner-property/39868152#39868152", "title": "Filter a collection but sort on inner property", "body": "<p>Try below:</p>\n\n<pre><code>db.getCollection('main').aggregate([\n{$match: {\"campaignID\" : 12.0}},\n{$unwind:\"$entries\"},\n{$sort: {\"entries.questionscorrect\": -1}},\n{$group:{_id:\"$_id\", \n    \"entries\":{$push:\"$entries\"}}}\n])\n</code></pre>\n"}], "owner": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 39868152, "answer_count": 1, "score": 0, "last_activity_date": 1475654322, "creation_date": 1475651554, "last_edit_date": 1475654322, "question_id": 39867585, "link": "https://stackoverflow.com/questions/39867585/filter-a-collection-but-sort-on-inner-property", "title": "Filter a collection but sort on inner property", "body": "<p>Considering that I have a collection of documents like below and I want to get information returned as follows:</p>\n\n<p>Select all the entries from a campaign with <code>campaignID = 12</code>, sort by <code>entries.questionscorrect</code> in descending order with a limit of 10.</p>\n\n<p>I have made a stab at a number of queries but I seem to be getting stuck on the fact that I am selecting on one level but want to order on a lower level i.e. property.</p>\n\n<p>Here's what I have so far:</p>\n\n<p><code>db.getCollection('main').find({\"id\":4}, {\"entries\": 1}).sort({\"questionscorrect\": -1}).limit(2)</code></p>\n\n<p>How can I write this in either Go (Mgo) syntax or straight MongoDB query please?</p>\n\n<p>I keep getting returned information but sorted on the number of</p>\n\n<pre><code>{\n    \"_id\": ObjectId(\"57f4a590a4be269aa54a0505\"),\n    \"campaignID\": 12,\n    \"name\": \"name-here\",\n    \"description\": \"description-here\",\n    \"entries\": [{\n        \"id\": 1,\n        \"nickname\": \"conorh\",\n        \"name\": \"conor h***\",\n        \"email\": \"ch@gmail.com\",\n        \"agreeTerms\": true,\n        \"optInMarketing\": false,\n        \"questionscnswered\": 10,\n        \"questionscorrect\": 3\n    }, {\n        \"id\": 2,\n        \"nickname\": \"bobs\",\n        \"name\": \"bob smyth\",\n        \"email\": \"bs12121@gmail.com\",\n        \"agreeTerms\": true,\n        \"optInMarketing\": false,\n        \"questionscnswered\": 10,\n        \"questionscorrect\": 6\n    }, {\n        \"id\": 3,\n        \"nickname\": \"jd12\",\n        \"name\": \"jane doe\",\n        \"email\": \"janedough@gmail.com\",\n        \"agreeTerms\": true,\n        \"optInMarketing\": false,\n        \"questionscnswered\": 10,\n        \"questionscorrect\": 1\n    }]\n}\n</code></pre>\n"}, {"tags": ["go", "reflection", "struct", "reply"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 36, "last_activity_date": 1475652154, "last_edit_date": 1475652154, "creation_date": 1475648229, "answer_id": 39866671, "question_id": 39866503, "link": "https://stackoverflow.com/questions/39866503/get-all-fields-from-an-interface/39866671#39866671", "title": "Get all fields from an interface", "body": "<p>You can use the <a href=\"https://golang.org/pkg/reflect/#TypeOf\" rel=\"noreferrer\"><code>reflect.TypeOf()</code></a> function to obtain a <a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"noreferrer\"><code>reflect.Type</code></a> type descriptor. From there, you can list fields of the dynamic value stored in the interface.</p>\n\n<p>Example:</p>\n\n<pre><code>type Point struct {\n    X int\n    Y int\n}\n\nvar reply interface{} = Point{1, 2}\nt := reflect.TypeOf(reply)\nfor i := 0; i &lt; t.NumField(); i++ {\n    fmt.Printf(\"%+v\\n\", t.Field(i))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>{Name:X PkgPath: Type:int Tag: Offset:0 Index:[0] Anonymous:false}\n{Name:Y PkgPath: Type:int Tag: Offset:4 Index:[1] Anonymous:false}\n</code></pre>\n\n<p>The result of a <code>Type.Field()</code> call is a <a href=\"https://golang.org/pkg/reflect/#StructField\" rel=\"noreferrer\"><code>reflect.StructField</code></a> value which is a <code>struct</code>, containing the name of the field among other things:</p>\n\n<pre><code>type StructField struct {\n    // Name is the field name.\n    Name string\n    // ...\n}\n</code></pre>\n\n<p>If you also want the values of the fields, you may use <a href=\"https://golang.org/pkg/reflect/#ValueOf\" rel=\"noreferrer\"><code>reflect.ValueOf()</code></a> to obtain a <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"noreferrer\"><code>reflect.Value()</code></a>, and then you may use <a href=\"https://golang.org/pkg/reflect/#Value.Field\" rel=\"noreferrer\"><code>Value.Field()</code></a> or <a href=\"https://golang.org/pkg/reflect/#Value.FieldByName\" rel=\"noreferrer\"><code>Value.FieldByName()</code></a>:</p>\n\n<pre><code>v := reflect.ValueOf(reply)\nfor i := 0; i &lt; v.NumField(); i++ {\n    fmt.Println(v.Field(i))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>1\n2\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/a8hfdu-p4-\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>Note: often a pointer to struct is wrapped in an interface. In such cases you may use <code>Type.Elem()</code> and <a href=\"https://golang.org/pkg/reflect/#Value.Elem\" rel=\"noreferrer\"><code>Value.Elem()</code></a> to \"navigate\" to the pointed type or value:</p>\n\n<pre><code>t := reflect.TypeOf(reply).Elem()\n\nv := reflect.ValueOf(reply).Elem()\n</code></pre>\n\n<p>If you don't know whether it's a pointer or not, you can check it with <code>Type.Kind()</code> and <a href=\"https://golang.org/pkg/reflect/#Value.Kind\" rel=\"noreferrer\"><code>Value.Kind()</code></a>, comparing the result with <code>reflect.Ptr</code>:</p>\n\n<pre><code>t := reflect.TypeOf(reply)\nif t.Kind() == reflect.Ptr {\n    t = t.Elem()\n}\n\n// ...\n\nv := reflect.ValueOf(reply)\nif v.Kind() == reflect.Ptr {\n    v = v.Elem()\n}\n</code></pre>\n\n<p>Try this variant on the <a href=\"https://play.golang.org/p/TnHP6N0oyH\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>For a detailed introduction to Go's reflection, read the blog post: <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"noreferrer\">The Laws of Reflection</a>.</p>\n"}], "owner": {"reputation": 295, "user_id": 1176154, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bGOB6.jpg?s=128&g=1", "display_name": "RAFJR", "link": "https://stackoverflow.com/users/1176154/rafjr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15102, "favorite_count": 1, "accepted_answer_id": 39866671, "answer_count": 1, "score": 11, "last_activity_date": 1488282405, "creation_date": 1475647556, "last_edit_date": 1488282405, "question_id": 39866503, "link": "https://stackoverflow.com/questions/39866503/get-all-fields-from-an-interface", "title": "Get all fields from an interface", "body": "<p>How do I know the fields I can access from the <code>reply</code> object/interface? I tried reflection but it seems you have to know the field name first. What if I need to know all the fields available to me?</p>\n\n<pre><code>// Do sends a command to the server and returns the received reply.\nDo(commandName string, args ...interface{}) (reply interface{}, err error)\n</code></pre>\n"}, {"tags": ["go", "dependency-management", "glide-golang"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1475638173, "post_id": 39864668, "comment_id": 67017705, "body": "What is the output of <code>go env</code> and <code>go version</code>?"}, {"owner": {"reputation": 4480, "user_id": 1330270, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/707acab6a92493a6d76f4dcc3c7b1120?s=128&d=identicon&r=PG", "display_name": "yowmamasita", "link": "https://stackoverflow.com/users/1330270/yowmamasita"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1475638541, "post_id": 39864668, "comment_id": 67017805, "body": "@putu <a href=\"https://ghostbin.com/paste/ayebv\" rel=\"nofollow noreferrer\">ghostbin.com/paste/ayebv</a>"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1475639046, "post_id": 39864668, "comment_id": 67017910, "body": "The folder <code>&#47;home&#47;yowmamasita&#47;goprojects</code> is not in your <code>GOPATH</code>. After modifying <code>GOPATH</code> variable, make sure to run <code>source .bashrc</code> or <code>source .bash_profile</code> or simply start a new terminal."}, {"owner": {"reputation": 4480, "user_id": 1330270, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/707acab6a92493a6d76f4dcc3c7b1120?s=128&d=identicon&r=PG", "display_name": "yowmamasita", "link": "https://stackoverflow.com/users/1330270/yowmamasita"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1475639218, "post_id": 39864668, "comment_id": 67017961, "body": "@putu you mean this line doesn&#39;t mean anything <code>GOPATH=&quot;&#47;home&#47;yowmamasita&#47;.gvm&#47;pkgsets&#47;go1.7.1&#47;global:&#47;home&#47;&zwnj;&#8203;yowmamasita&#47;goprojec&zwnj;&#8203;ts&quot;</code>?"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1475639467, "post_id": 39864668, "comment_id": 67018013, "body": "It wasn&#39;t in the <code>ghostbin.com&#47;paste&#47;ayebv</code>. If you run <code>go run main.go</code> now, did you still get the error?"}, {"owner": {"reputation": 4480, "user_id": 1330270, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/707acab6a92493a6d76f4dcc3c7b1120?s=128&d=identicon&r=PG", "display_name": "yowmamasita", "link": "https://stackoverflow.com/users/1330270/yowmamasita"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1475639990, "post_id": 39864668, "comment_id": 67018145, "body": "@putu weird, I copy-pasted that from there. Anyway, yes, still getting the error"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1475640892, "post_id": 39864668, "comment_id": 67018377, "body": "Sorry, maybe I didn&#39;t read it correctly. <a href=\"https://github.com/Masterminds/glide/issues/167\" rel=\"nofollow noreferrer\">This issue</a> may help. In short, you should put your project root inside <code>$GOPATH&#47;src&#47;</code>."}, {"owner": {"reputation": 4480, "user_id": 1330270, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/707acab6a92493a6d76f4dcc3c7b1120?s=128&d=identicon&r=PG", "display_name": "yowmamasita", "link": "https://stackoverflow.com/users/1330270/yowmamasita"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1475654274, "post_id": 39864668, "comment_id": 67024001, "body": "@putu can you please put this as an answer? This solved my problem. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 2, "last_activity_date": 1475655790, "creation_date": 1475655790, "answer_id": 39868859, "question_id": 39864668, "link": "https://stackoverflow.com/questions/39864668/vendor-directory-not-being-used-to-resolve-imports-on-go-build/39868859#39868859", "title": "vendor directory not being used to resolve imports on go build", "body": "<p>Please make sure: </p>\n\n<ol>\n<li>Add the workspace (<code>/home/yowmamasita/goprojects</code>) to <code>$GOPATH</code> variable. </li>\n<li>Typically under workspace there will be three directories which are <code>bin</code>, <code>pkg</code> and <code>src</code>. <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow\">More details</a></li>\n<li>You can omit <code>pkg</code> and <code>bin</code>, but the project which is using <code>vendor</code> packages or your custom package must be placed under <code>$GOPATH/src</code>, otherwise <code>go</code> compiler will not recognized it. </li>\n</ol>\n\n<p>More discussions can be found <a href=\"https://github.com/golang/go/issues/14566\" rel=\"nofollow\">here</a> and <a href=\"https://github.com/Masterminds/glide/issues/167\" rel=\"nofollow\">here</a></p>\n\n<p>The structure should look like:</p>\n\n<pre><code> $GOPATH\n \u2514\u2500\u2500 src\n     \u2514\u2500\u2500 YOURPROJECT1\n            \u251c\u2500\u2500 source codes #1\n            \u2514\u2500\u2500 vendor/\n\n     \u2514\u2500\u2500 YOURPROJECT2\n            \u251c\u2500\u2500 source codes #2\n            \u2514\u2500\u2500 vendor/\n</code></pre>\n"}], "owner": {"reputation": 4480, "user_id": 1330270, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/707acab6a92493a6d76f4dcc3c7b1120?s=128&d=identicon&r=PG", "display_name": "yowmamasita", "link": "https://stackoverflow.com/users/1330270/yowmamasita"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1491, "favorite_count": 1, "accepted_answer_id": 39868859, "answer_count": 1, "score": 1, "last_activity_date": 1523681897, "creation_date": 1475635736, "last_edit_date": 1523681897, "question_id": 39864668, "link": "https://stackoverflow.com/questions/39864668/vendor-directory-not-being-used-to-resolve-imports-on-go-build", "title": "vendor directory not being used to resolve imports on go build", "body": "<p>I'm in the process of relearning Go. I installed the latest Go version (<code>1.7.1</code>) using <a href=\"https://github.com/moovweb/gvm\" rel=\"nofollow\">gvm</a> and I am looking to build a simple rest api app using <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow\">gin</a>. I installed it using <code>glide get https://github.com/gin-gonic/gin</code> (<a href=\"https://glide.sh/\" rel=\"nofollow\">glide</a>) and that created a \"vendor\" folder on my project root. Running my app though, <code>go run main.go</code>, I encounter this error</p>\n\n<pre><code>main.go:3:8: cannot find package \"github.com/gin-gonic/gin\" in any of:\n    /home/yowmamasita/.gvm/gos/go1.6.3/src/github.com/gin-gonic/gin (from $GOROOT)\n    /home/yowmamasita/.gvm/pkgsets/go1.6.3/global/src/github.com/gin-gonic/gin (from $GOPATH)\n</code></pre>\n\n<p>It is not resolving the \"vendor\" directory glide just created</p>\n\n<pre><code>.\n\u251c\u2500\u2500 glide.lock\n\u251c\u2500\u2500 glide.yaml\n\u251c\u2500\u2500 main.go\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 vendor\n    \u2514\u2500\u2500 github.com\n        \u2514\u2500\u2500 gin-gonic\n            \u2514\u2500\u2500 gin\n</code></pre>\n\n<p>Not sure what's happening here, I thought after 1.5, it should be able to resolve imports from \"vendor\" directories without doing anything. I even added my projects folder on my <code>$GOPATH</code></p>\n\n<p><code>/home/yowmamasita/.gvm/pkgsets/go1.7.1/global:/home/yowmamasita/goprojects</code></p>\n\n<p>What am I doing wrong here? I tried 1.6.3 too and I get the same error.</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1475642638, "post_id": 39863157, "comment_id": 67018799, "body": "What is the output of <code>gcc -v</code> It seems that the <code>gcc</code> version is too old compared to <code>g++</code>. Probably you have multiple <code>gcc</code> installation."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 24, "last_activity_date": 1571515605, "last_edit_date": 1571515605, "creation_date": 1475650129, "answer_id": 39867163, "question_id": 39863157, "link": "https://stackoverflow.com/questions/39863157/cgo-sorry-unimplemented-64-bit-mode-not-compiled-in/39867163#39867163", "title": "Cgo: sorry, unimplemented: 64-bit mode not compiled in", "body": "<p>1- Short Answer:<br>\nI tried many versions, the Only working version for both 32-bit and 64-bit <code>go build</code> in 64-bit Windows OS is <a href=\"https://sourceforge.net/projects/tdm-gcc/\" rel=\"noreferrer\"><code>tdm64-gcc-5.1.0-2.exe</code></a> (see the <a href=\"http://tdm-gcc.tdragon.net/download\" rel=\"noreferrer\">tdm-gcc page</a>).<br>\nYou may install it to <code>C:\\TDM-GCC-64\\</code> and add <code>C:\\TDM-GCC-64\\bin</code> to your <code>PATH</code>  (on top = or left).</p>\n\n<hr>\n\n<p>2- You may try <a href=\"https://sourceforge.net/projects/mingw-w64/files/mingw-w64/mingw-w64-release/\" rel=\"noreferrer\">MinGW-w64 - for 32 and 64-bit Windows</a>\nOr <a href=\"http://netassist.dl.sourceforge.net/project/mingwbuilds/host-windows/releases/4.8.1/64-bit/threads-posix/seh/x64-4.8.1-release-posix-seh-rev5.7z\" rel=\"noreferrer\">x64-4.8.1-release-posix-seh-rev5</a>.<br>\nThis versions works fine just for the 64-bit build (not 32-bit target on 64-bit OS).</p>\n\n<hr>\n\n<p>3- For Windows OS run your command prompt: <code>cmd</code> (terminal in Linux) then run this command (<code>whereis gcc</code> in Linux):</p>\n\n<pre><code>where gcc\n</code></pre>\n\n<p>Then if there are multiple gcc paths, then you may edit the order of these and put the one you need in the top or remove all others.</p>\n\n<hr>\n\n<p>4- See:  </p>\n\n<p><a href=\"https://stackoverflow.com/questions/25538885/differences-between-mingw-w64-and-tdm-gcc-for-a-simple-gdi-project\">Differences between Mingw-w64 and TDM-GCC for a simple GDI project</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/21980774/what-is-the-difference-between-orwells-mingw-and-tdm-dev-c-versions\">What is the difference between Orwell&#39;s MinGW and TDM Dev-C++ versions?</a></p>\n\n<hr>\n\n<p>I hope this helps.</p>\n"}, {"tags": [], "owner": {"reputation": 166, "user_id": 11639160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5adcfcd7961080c20363080bf57c612c?s=128&d=identicon&r=PG&f=1", "display_name": "user_number153", "link": "https://stackoverflow.com/users/11639160/user-number153"}, "is_accepted": false, "score": 0, "last_activity_date": 1567671171, "creation_date": 1567671171, "answer_id": 57801137, "question_id": 39863157, "link": "https://stackoverflow.com/questions/39863157/cgo-sorry-unimplemented-64-bit-mode-not-compiled-in/57801137#57801137", "title": "Cgo: sorry, unimplemented: 64-bit mode not compiled in", "body": "<p>what worked for me was installing the 64 bit version of mingw adding it to PATH and then removing all other mingw's from PATH and then very important RESTARTING THE COMPUTER, you have to restart your computer.</p>\n"}, {"tags": [], "owner": {"reputation": 547, "user_id": 85581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e87b6e061f678980e7e8bfdd44b1dbe0?s=128&d=identicon&r=PG", "display_name": "Fred Simon", "link": "https://stackoverflow.com/users/85581/fred-simon"}, "is_accepted": false, "score": 0, "last_activity_date": 1583670068, "creation_date": 1583670068, "answer_id": 60587406, "question_id": 39863157, "link": "https://stackoverflow.com/questions/39863157/cgo-sorry-unimplemented-64-bit-mode-not-compiled-in/60587406#60587406", "title": "Cgo: sorry, unimplemented: 64-bit mode not compiled in", "body": "<p>Good answer, but what confused me is the MinGW-w64 installer choose the Architecture i686 by default instead of x</p>\n"}], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10273, "favorite_count": 2, "accepted_answer_id": 39867163, "answer_count": 3, "score": 11, "last_activity_date": 1583670068, "creation_date": 1475622987, "last_edit_date": 1475650221, "question_id": 39863157, "link": "https://stackoverflow.com/questions/39863157/cgo-sorry-unimplemented-64-bit-mode-not-compiled-in", "title": "Cgo: sorry, unimplemented: 64-bit mode not compiled in", "body": "<p>I'm currently trying to add some C code to my Go project. nothing fancy</p>\n\n<pre><code>/*\n#include &lt;stdio.h&gt;\nvoid test() {\n    printf(\"hooola\")\n}\n*/\n\nimport (\n    \"C\"\n)\n\nfunc MessageBox() {\n    C.test()\n}\n</code></pre>\n\n<p>However this will return</p>\n\n<blockquote>\n  <p>cc1.exe: sorry, unimplemented: 64-bit mode not compiled in</p>\n</blockquote>\n\n<p>I checked my <code>g++</code> and <code>gcc</code> compilers and everything seems fine, <code>g++ -v</code> returns this</p>\n\n<pre><code>C:\\Users\\ragga&gt;g++ -v\nUsing built-in specs.\nCOLLECT_GCC=g++\nCOLLECT_LTO_WRAPPER=C:/Program\\ Files/mingw-w64/x86_64-6.2.0-posix-seh-rt_v5-rev1/mingw64/bin/../libexec/gcc/x86_64-w64-mingw32/6.2.0/lto-wrapper.exe\nTarget: x86_64-w64-mingw32\nConfigured with: ../../../src/gcc-6.2.0/configure --host=x86_64-w64-mingw32 --build=x86_64-w64-mingw32 --target=x86_64-w64-mingw32 --prefix=/mingw64 --with-sysroot=/c/mingw620/x86_64-620-posix-seh-rt_v5-rev1/mingw64 --enable-shared --enable-static --disable-multilib --enable-languages=c,c++,fortran,lto --enable-libstdcxx-time=yes --enable-threads=posix --enable-libgomp --enable-libatomic --enable-lto --enable-graphite --enable-checking=release --enable-fully-dynamic-string --enable-version-specific-runtime-libs --enable-libstdcxx-filesystem-ts=yes --disable-isl-version-check --disable-libstdcxx-pch --disable-libstdcxx-debug --enable-bootstrap --disable-rpath --disable-win32-registry --disable-nls --disable-werror --disable-symvers --with-gnu-as --with-gnu-ld --with-arch=nocona --with-tune=core2 --with-libiconv --with-system-zlib --with-gmp=/c/mingw620/prerequisites/x86_64-w64-mingw32-static --with-mpfr=/c/mingw620/prerequisites/x86_64-w64-mingw32-static --with-mpc=/c/mingw620/prerequisites/x86_64-w64-mingw32-static --with-isl=/c/mingw620/prerequisites/x86_64-w64-mingw32-static --with-pkgversion='x86_64-posix-seh-rev1, Built by MinGW-W64 project' --with-bugurl=http://sourceforge.net/projects/mingw-w64 CFLAGS='-O2 -pipe -I/c/mingw620/x86_64-620-posix-seh-rt_v5-rev1/mingw64/opt/include -I/c/mingw620/prerequisites/x86_64-zlib-static/include -I/c/mingw620/prerequisites/x86_64-w64-mingw32-static/include' CXXFLAGS='-O2 -pipe -I/c/mingw620/x86_64-620-posix-seh-rt_v5-rev1/mingw64/opt/include -I/c/mingw620/prerequisites/x86_64-zlib-static/include -I/c/mingw620/prerequisites/x86_64-w64-mingw32-static/include' CPPFLAGS= LDFLAGS='-pipe -L/c/mingw620/x86_64-620-posix-seh-rt_v5-rev1/mingw64/opt/lib -L/c/mingw620/prerequisites/x86_64-zlib-static/lib -L/c/mingw620/prerequisites/x86_64-w64-mingw32-static/lib '\nThread model: posix\ngcc version 6.2.0 (x86_64-posix-seh-rev1, Built by MinGW-W64 project)\n</code></pre>\n\n<p>While <code>gcc --version</code> returns this</p>\n\n<pre><code>g:\\Workspace\\Go\\src\\github.com\\raggaer\\snak&gt;gcc --version\ngcc (GCC) 4.8.1\nCopyright (C) 2013 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n</code></pre>\n\n<p>Both installed using mingw64bits so I am not sure where my problem is coming from?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 2, "creation_date": 1475619496, "post_id": 39862613, "comment_id": 67013275, "body": "Please give a more complete example. This is really the same as in any other language but without seeing what you want to assign to it&#39;s not possible to fully answer your question. The basic thing is, split on one, then split on the other."}, {"owner": {"reputation": 161, "user_id": 4481208, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-hXni_F6hxMs/AAAAAAAAAAI/AAAAAAAAAEY/QavUudeabis/photo.jpg?sz=128", "display_name": "Ramakanta Samal", "link": "https://stackoverflow.com/users/4481208/ramakanta-samal"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1475620053, "post_id": 39862613, "comment_id": 67013449, "body": "Sorry about that        Ok I want to split the string &quot;xxxxx:yyyyy:zzz.aaa.bbb.cc:dd&quot; into below struct type sample Struct{      Service string     Type string      Domain string      Plan string     Host string      Region string     Other string  }  So that Service = xxxxx Type = yyyyy Domain = zzzz Plan = aaa Host = bbb Region = cc Other = dd"}], "answers": [{"comments": [{"owner": {"reputation": 662, "user_id": 5008952, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/10152729711426706/picture?type=large", "display_name": "Nathan Hyland", "link": "https://stackoverflow.com/users/5008952/nathan-hyland"}, "edited": false, "score": 0, "creation_date": 1475624281, "post_id": 39863313, "comment_id": 67014633, "body": "Was just typing sudo-code of this out for him. Didn&#39;t want to answer it in code that was both ugly and a valuable lesson to learn on ones own."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 662, "user_id": 5008952, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/10152729711426706/picture?type=large", "display_name": "Nathan Hyland", "link": "https://stackoverflow.com/users/5008952/nathan-hyland"}, "edited": false, "score": 0, "creation_date": 1475624720, "post_id": 39863313, "comment_id": 67014747, "body": "@NathanHyland yeah that might be a bit too accommodating. Thankfully there is the down vote feature to help balance things out :)"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": -1, "last_activity_date": 1475624148, "creation_date": 1475624148, "answer_id": 39863313, "question_id": 39862613, "link": "https://stackoverflow.com/questions/39862613/how-to-split-a-string-by-multiple-delimiters/39863313#39863313", "title": "How to split a string by multiple delimiters", "body": "<p>Alright. This isn't a very elegant solution but it should at least get you started and works for the specific example you've given. In reality you'd probably want to add some error handling or generalize the logic a bit to work with a broader set of inputs.</p>\n\n<pre><code>type Target struct {\n    Service string\n    Type string\n    Domain string\n    Plan string\n    Host string\n    Region string\n    Other string\n}\n\nfunc main() {\n    input := `xxxxx:yyyyy:zzz.aaa.bbb.cc:dd:ee:ff`\n    t := Target{}\n    tokens := strings.Split(input, \":\")\n    t.Service = tokens[0]\n    t.Type = tokens[1]\n    subtokens := strings.Split(tokens[2], \".\")\n    t.Domain = subtokens[0]\n    t.Plan = subtokens[1]\n    t.Host = subtokens[2]\n    t.Region = subtokens[3]\n    t.Other = tokens[3]\n    fmt.Printf(\"%v\", t)\n}\n</code></pre>\n\n<p>Working example here;\n<a href=\"https://play.golang.org/p/57ZyOfdbvo\" rel=\"nofollow\">https://play.golang.org/p/57ZyOfdbvo</a></p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 42, "last_activity_date": 1475644191, "last_edit_date": 1475644191, "creation_date": 1475643539, "answer_id": 39865740, "question_id": 39862613, "link": "https://stackoverflow.com/questions/39862613/how-to-split-a-string-by-multiple-delimiters/39865740#39865740", "title": "How to split a string by multiple delimiters", "body": "<p>You may use</p>\n\n<pre><code>strings.FieldsFunc(input, Split)\n</code></pre>\n\n<p>Try it on <a href=\"https://play.golang.org/p/k3MY6bJye1\" rel=\"noreferrer\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    input := `xxxxx:yyyyy:zzz.aaa.bbb.cc:dd:ee:ff`\n    a := strings.FieldsFunc(input, Split)\n    t := Target{a[0], a[1], a[2], a[3], a[4], a[5], a[6]}\n    fmt.Println(t) // {xxxxx yyyyy zzz aaa bbb cc dd}\n}\nfunc Split(r rune) bool {\n    return r == ':' || r == '.'\n}\n\ntype Target struct {\n    Service string\n    Type    string\n    Domain  string\n    Plan    string\n    Host    string\n    Region  string\n    Other   string\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{xxxxx yyyyy zzz aaa bbb cc dd}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24503, "user_id": 632, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1c88a3c1e8226ad98fc43b4838a0c387?s=128&d=identicon&r=PG", "display_name": "Jake Pearson", "link": "https://stackoverflow.com/users/632/jake-pearson"}, "is_accepted": false, "score": 1, "last_activity_date": 1512083599, "creation_date": 1512083599, "answer_id": 47584193, "question_id": 39862613, "link": "https://stackoverflow.com/questions/39862613/how-to-split-a-string-by-multiple-delimiters/47584193#47584193", "title": "How to split a string by multiple delimiters", "body": "<p>Here is a generic function that will take a string as a set of runes to split on.</p>\n\n<pre><code>func Splitter(s string, splits string) []string {\n    m := make(map[rune]int)\n    for _, r := range splits {\n        m[r] = 1\n    }\n\n    splitter := func(r rune) bool {\n        return m[r] == 1\n    }\n\n    return strings.FieldsFunc(s, splitter)\n}\n\nfunc TestSplit() {\n    words := Splitter(\"orange apple-banana\", \" -\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 111, "user_id": 8209433, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-QaKycdhZeao/AAAAAAAAAAI/AAAAAAAAAW8/WavMPi1JNgM/photo.jpg?sz=128", "display_name": "Nafisa Israil", "link": "https://stackoverflow.com/users/8209433/nafisa-israil"}, "is_accepted": false, "score": 10, "last_activity_date": 1569148540, "last_edit_date": 1569148540, "creation_date": 1543396916, "answer_id": 53516002, "question_id": 39862613, "link": "https://stackoverflow.com/questions/39862613/how-to-split-a-string-by-multiple-delimiters/53516002#53516002", "title": "How to split a string by multiple delimiters", "body": "<p>You can use regex for splitting your string</p>\n\n<pre><code>import \"regexp\"\n\nfunc splitWord(word string) []string {\n    array := regexp.MustCompile(\"[\\\\:\\\\,\\\\.\\\\s]+\").Split(word, -1)\n    return array\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 656, "user_id": 9947010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f43ecdf86bdd8e6632ac394a5a25654a?s=128&d=identicon&r=PG&f=1", "display_name": "Dmitry Mottl", "link": "https://stackoverflow.com/users/9947010/dmitry-mottl"}, "is_accepted": false, "score": 3, "last_activity_date": 1548783489, "last_edit_date": 1548783489, "creation_date": 1548781438, "answer_id": 54426140, "question_id": 39862613, "link": "https://stackoverflow.com/questions/39862613/how-to-split-a-string-by-multiple-delimiters/54426140#54426140", "title": "How to split a string by multiple delimiters", "body": "<p>You can use this function, which can split a string by multiple runes:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import \"fmt\"\nimport \"strings\"\n\nfunc SplitAny(s string, seps string) []string {\n    splitter := func(r rune) bool {\n        return strings.ContainsRune(seps, r)\n    }\n    return strings.FieldsFunc(s, splitter)\n}\n\nfunc main() {\n    words := SplitAny(\"xxxxx:yyyyy:zzz.aaa.bbb.cc:dd:ee:ff\", \".:\")\n    fmt.Println(strings.Join(words, \" \"))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>xxxxx yyyyy zzz aaa bbb cc dd ee ff\n</code></pre>\n\n<p>Or even with one line of code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>words := strings.FieldsFunc(s, func(r rune) bool { return strings.ContainsRune(\" .:\", r) })\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 4481208, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-hXni_F6hxMs/AAAAAAAAAAI/AAAAAAAAAEY/QavUudeabis/photo.jpg?sz=128", "display_name": "Ramakanta Samal", "link": "https://stackoverflow.com/users/4481208/ramakanta-samal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15616, "favorite_count": 2, "answer_count": 5, "score": 12, "last_activity_date": 1607443496, "creation_date": 1475619410, "last_edit_date": 1607443496, "question_id": 39862613, "link": "https://stackoverflow.com/questions/39862613/how-to-split-a-string-by-multiple-delimiters", "title": "How to split a string by multiple delimiters", "body": "<p>I want to parse a string xxxxx:yyyyy:zzz.aaa.bbb.cc:dd:ee:ff to a struct in Go, how can I do it with multiple delimiter ':' and '.'.</p>\n<p>Edit:</p>\n<p>I want to split the string &quot;xxxxx:yyyyy:zzz.aaa.bbb.cc:dd&quot; into below struct type</p>\n<pre><code>type Target struct {\n    Service string\n    Type    string\n    Domain  string\n    Plan    string\n    Host    string\n    Region  string\n    Other   string\n}\n</code></pre>\n<p>So that</p>\n<pre><code>Service = xxxxx \nType = yyyyy \nDomain = zzzz \nPlan = aaa \nHost = bbb \nRegion = cc \nOther = dd \n</code></pre>\n"}, {"tags": ["go", "channel", "panic"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475619793, "post_id": 39862533, "comment_id": 67013372, "body": "In general, you shouldn&#39;t be trying to detect this, and there is another way to architect the program. There&#39;s a reason it&#39;s a panic meant to crash the program."}, {"owner": {"reputation": 1101, "user_id": 4254425, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/232cb0401b3c3e7b28959cf0606742c5?s=128&d=identicon&r=PG", "display_name": "Viacheslav Kroilov", "link": "https://stackoverflow.com/users/4254425/viacheslav-kroilov"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475620313, "post_id": 39862533, "comment_id": 67013524, "body": "It&#39;s built around TTL cache. There&#39;s a rare race condition, when we try to create future on a connector, that has just expired and was removed from the cache. I can add SharedMutex to synchronize things, but this will only add constant runtime cost while solving a <i>potential</i> RC. Dealing with panic seems a reasonable hack to me"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475620505, "post_id": 39862533, "comment_id": 67013592, "body": "But why is the channel being closed? A close is a signal that the sender (usually) sends, hence the panic when the channel is closed."}, {"owner": {"reputation": 1101, "user_id": 4254425, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/232cb0401b3c3e7b28959cf0606742c5?s=128&d=identicon&r=PG", "display_name": "Viacheslav Kroilov", "link": "https://stackoverflow.com/users/4254425/viacheslav-kroilov"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475620756, "post_id": 39862533, "comment_id": 67013687, "body": "By closing I notify senders that the reference they are holding is no more relevant. I have this code In the end of the main connector function: <code>close(c.tasks); \tfor t := range c.tasks { \t\tclose(t.PacketFromServerChan); \t}</code>"}, {"owner": {"reputation": 1101, "user_id": 4254425, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/232cb0401b3c3e7b28959cf0606742c5?s=128&d=identicon&r=PG", "display_name": "Viacheslav Kroilov", "link": "https://stackoverflow.com/users/4254425/viacheslav-kroilov"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475620832, "post_id": 39862533, "comment_id": 67013718, "body": "Maybe there&#39;s a better solution, but don&#39;t know it"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1475621030, "post_id": 39862533, "comment_id": 67013789, "body": "You usually would select on a separate channel to signal exit: <a href=\"https://play.golang.org/p/-2D4P70zm8\" rel=\"nofollow noreferrer\">play.golang.org/p/-2D4P70zm8</a>"}, {"owner": {"reputation": 1101, "user_id": 4254425, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/232cb0401b3c3e7b28959cf0606742c5?s=128&d=identicon&r=PG", "display_name": "Viacheslav Kroilov", "link": "https://stackoverflow.com/users/4254425/viacheslav-kroilov"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475621243, "post_id": 39862533, "comment_id": 67013864, "body": "Oh, that&#39;s actually nice! Much better than my implementation. Thank you for idea"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1101, "user_id": 4254425, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/232cb0401b3c3e7b28959cf0606742c5?s=128&d=identicon&r=PG", "display_name": "Viacheslav Kroilov", "link": "https://stackoverflow.com/users/4254425/viacheslav-kroilov"}, "edited": false, "score": 0, "creation_date": 1475619992, "post_id": 39862659, "comment_id": 67013431, "body": "@ViacheslavKroilov: I should mention that though it&#39;s very unlikely to change, there&#39;s no guarantee that this continues to work in future versions of Go, nor that it works with other Go implementations, since the error value isn&#39;t specified."}, {"owner": {"reputation": 1101, "user_id": 4254425, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/232cb0401b3c3e7b28959cf0606742c5?s=128&d=identicon&r=PG", "display_name": "Viacheslav Kroilov", "link": "https://stackoverflow.com/users/4254425/viacheslav-kroilov"}, "edited": false, "score": 0, "creation_date": 1475620574, "post_id": 39862659, "comment_id": 67013617, "body": "What if I simulate this panic and then store an error type? It should be the same during the run, shouldn&#39;t it?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1101, "user_id": 4254425, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/232cb0401b3c3e7b28959cf0606742c5?s=128&d=identicon&r=PG", "display_name": "Viacheslav Kroilov", "link": "https://stackoverflow.com/users/4254425/viacheslav-kroilov"}, "edited": false, "score": 0, "creation_date": 1475620834, "post_id": 39862659, "comment_id": 67013720, "body": "@ViacheslavKroilov: should be, but there&#39;s still technically nothing preventing the runtime from adding dynamic information to that string. If you&#39;re going to do this, I would just define a constant string and fix it if it breaks."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1101, "user_id": 4254425, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/232cb0401b3c3e7b28959cf0606742c5?s=128&d=identicon&r=PG", "display_name": "Viacheslav Kroilov", "link": "https://stackoverflow.com/users/4254425/viacheslav-kroilov"}, "edited": false, "score": 0, "creation_date": 1475621096, "post_id": 39862659, "comment_id": 67013814, "body": "@ViacheslavKroilov: the error&#39;s type isn&#39;t specific to this panic, it&#39;s currently called <code>plainError</code>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1475621451, "last_edit_date": 1475621451, "creation_date": 1475619699, "answer_id": 39862659, "question_id": 39862533, "link": "https://stackoverflow.com/questions/39862533/golang-get-panic-type/39862659#39862659", "title": "Golang. Get panic type", "body": "<p>The recover message in this case is an unexported error value from the runtime, with the string value of <code>\"send on closed channel\"</code>.</p>\n\n<p>The only thing you can do here is to match the error string:</p>\n\n<pre><code>if e, ok := r.(error); ok &amp;&amp; w.Error() == \"send on closed channel\" {\n    fmt.Println(\"recover from send on closed channel\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/LNcfdE9Bg2\" rel=\"nofollow\">https://play.golang.org/p/LNcfdE9Bg2</a></p>\n\n<p>In actuality, what you probably need is a separate channel to signal when to exit. </p>\n\n<pre><code>t := newConnectorTask(p)\n\nselect {\ncase &lt;-c.close:\n    // closing the c.close channel will unblock this case\n    return\ncase c.tasks &lt;- t:\n}\n</code></pre>\n"}], "owner": {"reputation": 1101, "user_id": 4254425, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/232cb0401b3c3e7b28959cf0606742c5?s=128&d=identicon&r=PG", "display_name": "Viacheslav Kroilov", "link": "https://stackoverflow.com/users/4254425/viacheslav-kroilov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 659, "favorite_count": 0, "accepted_answer_id": 39862659, "answer_count": 1, "score": 1, "last_activity_date": 1475621451, "creation_date": 1475618986, "question_id": 39862533, "link": "https://stackoverflow.com/questions/39862533/golang-get-panic-type", "title": "Golang. Get panic type", "body": "<p>There's a code: </p>\n\n<pre><code>func (c *Connector) SendPacketFuture(p []byte) (future chan []byte) {\n    defer func() {\n        // TODO Check r to catch only chan panics\n        if r := recover(); r != nil {\n            future = nil\n        }\n    }()\n    t := newConnectorTask(p)\n    c.tasks &lt;- t\n    future = t.PacketFromServerChan\n    return\n}\n</code></pre>\n\n<p><code>TODO</code> is pretty self-explanatory.\n<code>c.tasks</code> is a channel and it can be closed by another goroutine. Since there's no safe way to send to channel that can be closed, I'm catching panics here. The problem is that different panics can occur and <strong>I want to react to the one that is raised by writing to a closed chan</strong>. </p>\n\n<p>Is it possible to do this in Go?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1475616507, "creation_date": 1475616507, "answer_id": 39862056, "question_id": 39861898, "link": "https://stackoverflow.com/questions/39861898/parse-time-seconds-to-clock-in-golang/39862056#39862056", "title": "Parse time seconds to clock in Golang", "body": "<p>Put the number of seconds into the <a href=\"https://golang.org/pkg/time/#Date\" rel=\"noreferrer\"><code>time.Date</code></a> function:</p>\n\n<pre><code>t := time.Date(0, 0, 0, 0, 0, sec, 0, time.UTC)\nfmt.Println(t.Format(\"03:04 PM\"))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/zV720y4E-o\" rel=\"noreferrer\">https://play.golang.org/p/zV720y4E-o</a></p>\n"}], "owner": {"reputation": 73, "user_id": 6442787, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5777e2b9e7286d9f466ebc7aabc8177?s=128&d=identicon&r=PG&f=1", "display_name": "aquahill", "link": "https://stackoverflow.com/users/6442787/aquahill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "accepted_answer_id": 39862056, "answer_count": 1, "score": 2, "last_activity_date": 1475616507, "creation_date": 1475615807, "question_id": 39861898, "link": "https://stackoverflow.com/questions/39861898/parse-time-seconds-to-clock-in-golang", "title": "Parse time seconds to clock in Golang", "body": "<p>How to parse time seconds to the clock format in Golang?</p>\n\n<p>For example:</p>\n\n<pre><code>input: 0      =&gt; output: '12:00 AM'\ninput: 60     =&gt; output: '12:01 AM'\ninput: 60*60  =&gt; output: '1:00 AM'\n</code></pre>\n"}, {"tags": ["javascript", "http", "browser", "go"], "comments": [{"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1475606940, "post_id": 39859453, "comment_id": 67007189, "body": "Do you want to refresh the page on some event at server side?"}, {"owner": {"reputation": 6775, "user_id": 974733, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a92fc92fd900ad9712d1bc7ea6c87f01?s=128&d=identicon&r=PG", "display_name": "Mark Vincze", "link": "https://stackoverflow.com/users/974733/mark-vincze"}, "reply_to_user": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1475607555, "post_id": 39859453, "comment_id": 67007537, "body": "No, I don&#39;t want to include the web server in this story at all. (Imagine that it&#39;s not even a site coming from a server, it might be just local static html+js.) I want to programmatically refresh the browser tab from my Golang application running on the same machine as the browser."}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 3, "creation_date": 1475609110, "post_id": 39859453, "comment_id": 67008390, "body": "you can&#39;t do it. best you can do is have browser javascript polling a server endpoint /shouldIReload, or have browser javascript make that decision itself and use one of these techniques <a href=\"http://stackoverflow.com/questions/5404839/how-can-i-refresh-a-page-with-jquery/5404869#5404869\" title=\"how can i refresh a page with jquery\">stackoverflow.com/questions/5404839/&hellip;</a>"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1475609390, "post_id": 39859453, "comment_id": 67008547, "body": "maybe you can push the serverside data with a websocket to the page in question."}, {"owner": {"reputation": 6775, "user_id": 974733, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a92fc92fd900ad9712d1bc7ea6c87f01?s=128&d=identicon&r=PG", "display_name": "Mark Vincze", "link": "https://stackoverflow.com/users/974733/mark-vincze"}, "reply_to_user": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1475609456, "post_id": 39859453, "comment_id": 67008593, "body": "@Plato Well that&#39;s not out of question. In the Golang app I can host a little local http server on some predefined port, and the JS in the browser can communicate with that. So I could probably come up with a completely custom solution, I was just wondering if there is already a concise example or library for this."}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 1, "creation_date": 1475655907, "post_id": 39859453, "comment_id": 67024860, "body": "You may program a websocket endpoint on your local http server. Then you should use Javascript to connect to that endpoint and wait for the &quot;refresh trigger&quot; there."}], "answers": [{"tags": [], "owner": {"reputation": 6775, "user_id": 974733, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a92fc92fd900ad9712d1bc7ea6c87f01?s=128&d=identicon&r=PG", "display_name": "Mark Vincze", "link": "https://stackoverflow.com/users/974733/mark-vincze"}, "is_accepted": true, "score": 1, "last_activity_date": 1477839835, "creation_date": 1477839835, "answer_id": 40330428, "question_id": 39859453, "link": "https://stackoverflow.com/questions/39859453/whats-the-simplest-way-to-refresh-a-particular-browser-tab-from-a-go-applicatio/40330428#40330428", "title": "What&#39;s the simplest way to refresh a particular browser tab from a Go application?", "body": "<p>As suggested by some comments, there seems to be no API through which we could connect to a browser from Golang, query the list of tabs, and refresh a particular page (at least not in a cross-browser and cross-platform way).</p>\n\n<p>One possible approach to do this is to host a small WebSocket endpoint in Golang, and connect to it from the site we want to refresh. Then send a message through the WS connection every time we want to reload the site, and in JavaScript call <code>location.reload()</code> when we receive the message.</p>\n\n<p>I described all the details in a <a href=\"https://blog.markvincze.com/programmatically-refreshing-a-browser-tab-from-a-golang-application/\" rel=\"nofollow\">blog post</a>, and uploaded a complete working example to <a href=\"https://github.com/markvincze/golang-reload-browser\" rel=\"nofollow\">GitHub</a>.</p>\n"}], "owner": {"reputation": 6775, "user_id": 974733, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a92fc92fd900ad9712d1bc7ea6c87f01?s=128&d=identicon&r=PG", "display_name": "Mark Vincze", "link": "https://stackoverflow.com/users/974733/mark-vincze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 866, "favorite_count": 0, "accepted_answer_id": 40330428, "answer_count": 1, "score": 1, "last_activity_date": 1501934256, "creation_date": 1475606200, "question_id": 39859453, "link": "https://stackoverflow.com/questions/39859453/whats-the-simplest-way-to-refresh-a-particular-browser-tab-from-a-go-applicatio", "title": "What&#39;s the simplest way to refresh a particular browser tab from a Go application?", "body": "<p>I have a client-side Golang application running on my machine. I also have a browser open, and in that browser there might be a tab running my web application (which is completely separate from the Golang app).</p>\n\n<p>From the Golang app, I would like to programmatically refresh the browser tab (and maybe if possible, bring it to front, but that's less important).</p>\n\n<p>I researched quite a lot already, and I concluded this is not possible just by communicating to the browser, there is no standard (especially cross-platform and cross-browser) interface with which we can trigger the refresh of a specific tab of a browser.</p>\n\n<p>So I suppose I'll need to have some custom JS code running on the website with which my Golang application can communicate and trigger the refresh of the tab.</p>\n\n<p>What's the easiest way to do this?</p>\n\n<p>(I was looking at <a href=\"https://www.npmjs.com/package/livereload\" rel=\"nofollow\">livereload.js</a> and <a href=\"https://github.com/jaschaephraim/lrserver\" rel=\"nofollow\">lrserver</a>, but these all start with the premise that there is a folder of content we'd like to watch and automatically reload on any change. But I don't want that, I just programmatically want to trigger the refresh. Also, this Golang app is not hosting the website, it's just a separate client-side application.)</p>\n"}, {"tags": ["go", "jwt", "jwt-go"], "answers": [{"comments": [{"owner": {"reputation": 810, "user_id": 2623557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/100002391400401/picture?type=large", "display_name": "Putra Fajar Hasanuddin", "link": "https://stackoverflow.com/users/2623557/putra-fajar-hasanuddin"}, "edited": false, "score": 2, "creation_date": 1573833761, "post_id": 39859575, "comment_id": 104028504, "body": "how to extract if token from another microservices, i dont had secret"}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "reply_to_user": {"reputation": 810, "user_id": 2623557, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/100002391400401/picture?type=large", "display_name": "Putra Fajar Hasanuddin", "link": "https://stackoverflow.com/users/2623557/putra-fajar-hasanuddin"}, "edited": false, "score": 0, "creation_date": 1573838463, "post_id": 39859575, "comment_id": 104030897, "body": "Ideally you will need the secret to decrypt tokens in case of JWE( encrypted tokens). If you are using JWS (signed tokens) you can still read the payload, but not verify the signature."}, {"owner": {"reputation": 779, "user_id": 10160865, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9VDix.jpg?s=128&g=1", "display_name": "Dennis Glot", "link": "https://stackoverflow.com/users/10160865/dennis-glot"}, "edited": false, "score": 3, "creation_date": 1582975184, "post_id": 39859575, "comment_id": 106966252, "body": "If you wish to get claims without validating signature, just pass <code>nil</code> instead of function to <code>jwt.Parse</code>"}, {"owner": {"reputation": 3125, "user_id": 84007, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5f8dfb1530475449020d465b94031150?s=128&d=identicon&r=PG", "display_name": "Jonatan", "link": "https://stackoverflow.com/users/84007/jonatan"}, "edited": false, "score": 1, "creation_date": 1602603693, "post_id": 39859575, "comment_id": 113769835, "body": "Passing <code>nil</code> does not work, as it will fail with error: &quot;no Keyfunc was provided&quot;. <a href=\"https://github.com/dgrijalva/jwt-go/issues/37\" rel=\"nofollow noreferrer\">github.com/dgrijalva/jwt-go/issues/37</a>"}], "tags": [], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "is_accepted": true, "score": 17, "last_activity_date": 1475661586, "last_edit_date": 1475661586, "creation_date": 1475606670, "answer_id": 39859575, "question_id": 39859244, "link": "https://stackoverflow.com/questions/39859244/how-to-extract-the-claims-from-jwt-token/39859575#39859575", "title": "How to extract the claims from JWT token", "body": "<p>Sample Code:</p>\n\n<pre><code>    func extractClaims(tokenStr string) (jwt.MapClaims, bool) {\n        hmacSecretString := // Value\n        hmacSecret := []byte(hmacSecretString)\n        token, err := jwt.Parse(tokenStr, func(token *jwt.Token) (interface{}, error) {\n             // check token signing method etc\n             return hmacSecret, nil\n        })\n\n        if err != nil {\n            return nil, false\n        }\n\n        if claims, ok := token.Claims.(jwt.MapClaims); ok &amp;&amp; token.Valid {\n            return claims, true\n        } else {\n            log.Printf(\"Invalid JWT Token\")\n            return nil, false\n        }\n    }\n</code></pre>\n"}], "owner": {"reputation": 985, "user_id": 2212726, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ab1b796e095bdc5b72ca115b8dd10dd8?s=128&d=identicon&r=PG", "display_name": "user2212726", "link": "https://stackoverflow.com/users/2212726/user2212726"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13032, "favorite_count": 4, "accepted_answer_id": 39859575, "answer_count": 1, "score": 12, "last_activity_date": 1588058007, "creation_date": 1475605377, "last_edit_date": 1588058007, "question_id": 39859244, "link": "https://stackoverflow.com/questions/39859244/how-to-extract-the-claims-from-jwt-token", "title": "How to extract the claims from JWT token", "body": "<p>I'm using the dgrijalva/jwt-go/ package.</p>\n\n<p>I would like to extract the payload from the token, and I couldn't find a way to do it.</p>\n\n<hr>\n\n<p>Example (taken from : <a href=\"https://jwt.io/\" rel=\"nofollow noreferrer\">https://jwt.io/</a>):</p>\n\n<p>for encoded:</p>\n\n<blockquote>\n  <p>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</p>\n</blockquote>\n\n<p>I would like to extract the payload:</p>\n\n<pre><code>{\n  \"sub\": \"1234567890\",\n  \"name\": \"John Doe\",\n  \"admin\": true\n}\n</code></pre>\n\n<hr>\n\n<p>I will be grateful for an example (using golang).</p>\n"}, {"tags": ["go", "io", "buffer"], "comments": [{"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 3, "creation_date": 1475606122, "post_id": 39859222, "comment_id": 67006738, "body": "After your <code>for</code> loop add a call to <code>scanner.Err()</code> and see what it gives you back. Maybe there&#39;s something useful there? <a href=\"https://golang.org/pkg/bufio/#Scanner.Err\" rel=\"nofollow noreferrer\">golang.org/pkg/bufio/#Scanner.Err</a>"}], "answers": [{"comments": [{"owner": {"reputation": 195, "user_id": 10315355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bafc1e70364282b900c17a5eaa4df2b?s=128&d=identicon&r=PG&f=1", "display_name": "probhonjon", "link": "https://stackoverflow.com/users/10315355/probhonjon"}, "edited": false, "score": 0, "creation_date": 1599850313, "post_id": 39864391, "comment_id": 112913200, "body": "why buffer size set to 512*1024?"}, {"owner": {"reputation": 68, "user_id": 6893300, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dGtiy.jpg?s=128&g=1", "display_name": "Damien", "link": "https://stackoverflow.com/users/6893300/damien"}, "edited": false, "score": 0, "creation_date": 1611143864, "post_id": 39864391, "comment_id": 116354463, "body": "Simply as an example. The actual capacity will depend on your specific input."}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 20, "last_activity_date": 1475633611, "last_edit_date": 1475633611, "creation_date": 1475633274, "answer_id": 39864391, "question_id": 39859222, "link": "https://stackoverflow.com/questions/39859222/golang-how-to-overcome-scan-buffer-limit-from-bufio/39864391#39864391", "title": "Golang - How to overcome Scan() buffer limit from bufio?", "body": "<p>According to <a href=\"https://golang.org/pkg/bufio/#Scanner.Buffer\" rel=\"noreferrer\">documentation</a> and corresponding <a href=\"https://golang.org/src/bufio/scan.go\" rel=\"noreferrer\">source code</a>, by default <code>Scanner</code> uses internal buffer in which the capacity is 64K. In your case, the internal buffer is not sufficient for storing 40000 integers. Set the buffer to be used by scanner <strong>before</strong> calling <code>Scan</code>, i.e. </p>\n\n<pre><code>scanner := bufio.NewScanner(inFile)\n\n//adjust the capacity to your need (max characters in line)\nconst maxCapacity = 512*1024  \nbuf := make([]byte, maxCapacity)\nscanner.Buffer(buf, maxCapacity)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 9466442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cf59cd4a55d8243f5783c0472ba149d?s=128&d=identicon&r=PG&f=1", "display_name": "coder", "link": "https://stackoverflow.com/users/9466442/coder"}, "is_accepted": false, "score": 0, "last_activity_date": 1617809373, "last_edit_date": 1617809373, "creation_date": 1617128356, "answer_id": 66876416, "question_id": 39859222, "link": "https://stackoverflow.com/questions/39859222/golang-how-to-overcome-scan-buffer-limit-from-bufio/66876416#66876416", "title": "Golang - How to overcome Scan() buffer limit from bufio?", "body": "<p>A code to use dynamic buffer size. Get the file size and use it in the scanner</p>\n<pre><code>info, infoErr := file.Stat()\nvar maxSize int\nscanner := bufio.NewScanner(file)\nmaxSize = int(info.Size())\nbuffer := make([]byte, 0, maxSize)\nscanner.Buffer(buffer, maxSize)\n</code></pre>\n<p>For JSON add a few more bytes\nmaxSize = maxSize + 1\nor\nmaxSize = maxSize + 10</p>\n"}], "owner": {"reputation": 2449, "user_id": 4313927, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/568720341/picture?type=large", "display_name": "Nicky Feller", "link": "https://stackoverflow.com/users/4313927/nicky-feller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5782, "favorite_count": 2, "accepted_answer_id": 39864391, "answer_count": 2, "score": 6, "last_activity_date": 1617809373, "creation_date": 1475605254, "last_edit_date": 1554431461, "question_id": 39859222, "link": "https://stackoverflow.com/questions/39859222/golang-how-to-overcome-scan-buffer-limit-from-bufio", "title": "Golang - How to overcome Scan() buffer limit from bufio?", "body": "<p>I am using the <code>bufio</code> scanner's <code>.Scan()</code> method to read text file lines. However when I reach a certain size in the file lines, the scanner no longer allows me to read, it just returns an empty line.</p>\n\n<p>How should I configure the buffer to take in larger amounts of data?</p>\n\n<p><code>bigfile.txt</code> is just a file with many integers in a line separated by a space. For example, 40000 integers in one line. (note that it works for file lines of 10000 integers and less, but not 40000 for example)</p>\n\n<blockquote>\n  <p>234 544 765 45 34 67 67 87 98 43 [... n = 40000 ]</p>\n</blockquote>\n\n<pre><code>func main() {\n    readInputFile(\"bigfile.txt\")\n}\n\nfunc readInputFile(name string) {\n    inFile, _ := os.Open(name)\n    defer inFile.Close()\n\n    scanner := bufio.NewScanner(inFile)\n\n    for scanner.Scan() {\n        line := scanner.Text()\n        fmt.Printf(line)\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "go"], "comments": [{"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 2, "creation_date": 1475604611, "post_id": 39859014, "comment_id": 67005931, "body": "What is <code>j</code>? It seems to come out of nowhere."}, {"owner": {"reputation": 598, "user_id": 1692500, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6adc7f8116739bf3ba98ace33e30667c?s=128&d=identicon&r=PG", "display_name": "azizulhakim", "link": "https://stackoverflow.com/users/1692500/azizulhakim"}, "reply_to_user": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1475613659, "post_id": 39859014, "comment_id": 67010704, "body": "I was a variable initialized to loop length. Added in the code."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 3, "creation_date": 1475613877, "post_id": 39859014, "comment_id": 67010808, "body": "With optimization enabled, the C compiler will optimize your loop away, and generate code that simply does: <code>i = 999999999;  printf(&quot;matched\\n&quot;);</code>"}], "owner": {"reputation": 598, "user_id": 1692500, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6adc7f8116739bf3ba98ace33e30667c?s=128&d=identicon&r=PG", "display_name": "azizulhakim", "link": "https://stackoverflow.com/users/1692500/azizulhakim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 274, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475613634, "creation_date": 1475604447, "last_edit_date": 1475613634, "question_id": 39859014, "link": "https://stackoverflow.com/questions/39859014/c-gettimeofday-doesnt-work-properly-with-golang", "title": "C gettimeofday Doesn&#39;t Work Properly With GoLang", "body": "<p>I've a simple <code>C</code> function which I call from <code>GoLang</code>. In my <code>C</code> function I'm using <code>gettimeofday</code> function. I understand that this function doesn't give accurate time and I'm okay with that as I only need to get some idea. I just want to get the time difference to run a big <code>for loop</code>.When I run the <code>C</code> function from a <code>C</code> program, it works fine. The <code>for loop</code> takes around 3 seconds to finish. But if I call the same function from <code>GoLang</code>, it looks like that it doesn't take any time in the <code>for loop</code> The program finishes immediately. </p>\n\n<p>Here goes my code.</p>\n\n<p><strong>timetest.h</strong></p>\n\n<pre><code>#include &lt;sys/time.h&gt;\n#include&lt;stdio.h&gt;\n\n\nint TimeTest(){\n  int i=0;\n  int j = 1000000000;\n    unsigned long long startMilli=0;\n  unsigned long long endMilli=0;\n    struct timeval te;\n\n    gettimeofday(&amp;te, NULL);\n    startMilli = te.tv_sec*1000LL + te.tv_usec/1000;\n\n    for (i=0; i&lt;1000000000; i++){\n        if (j-1 == i){\n            printf(\"matched\\n\");\n        }\n    }\n\n    gettimeofday(&amp;te, NULL);\n    endMilli = te.tv_sec*1000LL + te.tv_usec/1000;\n\n    printf(\"Start = %d End = %d Total time %d\\n\", startMilli, endMilli, endMilli - startMilli);\n\n    return endMilli - startMilli;\n}\n</code></pre>\n\n<p><strong>test.go</strong></p>\n\n<pre><code>package main\n\n// #include &lt;sys/time.h&gt;\n// #include \"timetest.h\"\nimport \"C\"\n\nimport (\n    \"fmt\"\n)\n\nfunc main(){\n  diff := C.TimeTest()\n\n  fmt.Println(diff)\n}\n</code></pre>\n\n<p><strong>Main.c</strong></p>\n\n<pre><code>#include\"timetest.h\"\n\nint main(){\n  int diff = TimeTest();\n\n  printf(\"%d\\n\", diff);\n\n  return 0;\n}\n</code></pre>\n"}, {"tags": ["postgresql", "go", "pq"], "answers": [{"comments": [{"owner": {"reputation": 675, "user_id": 1593432, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/acf2511e93a790ecb2e50f31ba576673?s=128&d=identicon&r=PG", "display_name": "marsrover", "link": "https://stackoverflow.com/users/1593432/marsrover"}, "edited": false, "score": 0, "creation_date": 1475604774, "post_id": 39858402, "comment_id": 67006013, "body": "I read elsewhere that Exec was recommended for all Insert/Update transactions but this actually seems to work, so thank you."}, {"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "reply_to_user": {"reputation": 675, "user_id": 1593432, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/acf2511e93a790ecb2e50f31ba576673?s=128&d=identicon&r=PG", "display_name": "marsrover", "link": "https://stackoverflow.com/users/1593432/marsrover"}, "edited": false, "score": 0, "creation_date": 1475605885, "post_id": 39858402, "comment_id": 67006611, "body": "@marsrover yeah normally you&#39;d use Exec but postgres plus <code>RETURNING</code> is just special. I&#39;m glad I could help."}], "tags": [], "owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "is_accepted": true, "score": 3, "last_activity_date": 1475602222, "creation_date": 1475602222, "answer_id": 39858402, "question_id": 39858020, "link": "https://stackoverflow.com/questions/39858020/go-with-postgres-lastinsertedid-for-non-sequential-identifiers/39858402#39858402", "title": "Go with Postgres: LastInsertedId for non sequential identifiers", "body": "<p>From <a href=\"https://godoc.org/github.com/lib/pq#hdr-Queries\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/lib/pq#hdr-Queries</a> it looks like you should use QueryRow instead of Exec</p>\n\n<blockquote>\n  <p>pq does not support the LastInsertId() method of the Result type in database/sql. To return the identifier of an INSERT (or UPDATE or DELETE), use the Postgres RETURNING clause with a standard Query or QueryRow call:</p>\n</blockquote>\n\n<pre><code>var userid int\nerr := db.QueryRow(`INSERT INTO users(name, favorite_fruit, age)\n    VALUES('beatrice', 'starfruit', 93) RETURNING id`).Scan(&amp;userid)\n</code></pre>\n"}], "owner": {"reputation": 675, "user_id": 1593432, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/acf2511e93a790ecb2e50f31ba576673?s=128&d=identicon&r=PG", "display_name": "marsrover", "link": "https://stackoverflow.com/users/1593432/marsrover"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 39858402, "answer_count": 1, "score": 0, "last_activity_date": 1475602222, "creation_date": 1475600728, "question_id": 39858020, "link": "https://stackoverflow.com/questions/39858020/go-with-postgres-lastinsertedid-for-non-sequential-identifiers", "title": "Go with Postgres: LastInsertedId for non sequential identifiers", "body": "<p>I\u00b4m writing a small web service in Go which uses Postgres through the <a href=\"https://github.com/lib/pq\" rel=\"nofollow\">pq driver package</a>. </p>\n\n<p>I\u00b4m using a uuid\u00b4s as identifier for my models so LastInsertId won\u00b4t work. </p>\n\n<p>So I\u00b4m thinking I could something like this:</p>\n\n<pre><code>  var id string\n  res, err := session.Exec(\"INSERT INTO todos (text, list_id) VALUES ($1, $2) RETURNING todo_id\", text, listId).Scan(&amp;id)\n</code></pre>\n\n<p><code>Scan</code> does seem to play well with <code>Exec</code>. </p>\n\n<p>So how do I return the uuid from my new todo row?</p>\n"}, {"tags": ["go", "integration-testing"], "comments": [{"owner": {"reputation": 905, "user_id": 2323245, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/692ba01c39a0306d91a706c1273ca840?s=128&d=identicon&r=PG", "display_name": "sbouaked", "link": "https://stackoverflow.com/users/2323245/sbouaked"}, "edited": false, "score": 0, "creation_date": 1475595056, "post_id": 39856109, "comment_id": 67000512, "body": "For SQL, i use this kind of tools : <a href=\"https://github.com/DATA-DOG/go-sqlmock\" rel=\"nofollow noreferrer\">github.com/DATA-DOG/go-sqlmock</a> , maybe this can help you"}, {"owner": {"reputation": 627, "user_id": 2000569, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/3fc2a25dae524b3e09735e1a0f1f6a69?s=128&d=identicon&r=PG", "display_name": "fvosberg", "link": "https://stackoverflow.com/users/2000569/fvosberg"}, "reply_to_user": {"reputation": 905, "user_id": 2323245, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/692ba01c39a0306d91a706c1273ca840?s=128&d=identicon&r=PG", "display_name": "sbouaked", "link": "https://stackoverflow.com/users/2323245/sbouaked"}, "edited": false, "score": 0, "creation_date": 1475599084, "post_id": 39856109, "comment_id": 67003065, "body": "Thanks, but this doesn&#39;t test if e.g. my database schema is valid and working. E.g. complicated SELECTS or testing the elasticsearch schema. The most advantages of go-sqlmock are that I don&#39;t have to write my MapDatastore on my own. That&#39;s very nice but doesn&#39;t help me with my integration problem, does it?"}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1475656161, "post_id": 39856109, "comment_id": 67024998, "body": "You&#39;re talking about integration tests. Docker is handy because you can <code>docker rm</code> it anytime to reset. I have been using Docker to test my Elasticsearch integration in my tests."}, {"owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "edited": false, "score": 0, "creation_date": 1475656345, "post_id": 39856109, "comment_id": 67025097, "body": "Just start a new docker on every test session with proper database import. If you have proper migration practice, you may check your schema on every test session. I&#39;d use <code>Makefile</code> to store the docker setup code."}, {"owner": {"reputation": 627, "user_id": 2000569, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/3fc2a25dae524b3e09735e1a0f1f6a69?s=128&d=identicon&r=PG", "display_name": "fvosberg", "link": "https://stackoverflow.com/users/2000569/fvosberg"}, "edited": false, "score": 0, "creation_date": 1475744123, "post_id": 39856109, "comment_id": 67069234, "body": "So you would suggest to put the docker setup and the <code>go test</code> into a Makefile and let the tests fail, if someone just runs the tests without starting the mysql docker? Or should I use a go docker library to start the docker container with the MySQL server in the test code? (Which leads to a simpler API, but what should I do if there is no docker available?)"}], "owner": {"reputation": 627, "user_id": 2000569, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/3fc2a25dae524b3e09735e1a0f1f6a69?s=128&d=identicon&r=PG", "display_name": "fvosberg", "link": "https://stackoverflow.com/users/2000569/fvosberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475594394, "creation_date": 1475594394, "question_id": 39856109, "link": "https://stackoverflow.com/questions/39856109/how-to-setup-the-environmental-requirements-for-integration-tests-in-golang", "title": "How to setup the environmental requirements for integration tests in golang?", "body": "<p>I am new to golang and have two little projects started, where I got to the same problem.</p>\n\n<p>One uses a MySQL database as a datastore and the other elasticsearch. How can I write tests which cover the code for that.</p>\n\n<p>At first I\u2019ve used a HashMapDatastore, but with that I can only test my handlers and business logic, but not the persistence layer (e.g. if the persisting and retrieving works as I expect in elasticsearch) (aka integration test).</p>\n\n<p>So should I test if there is a blank database for testing?\nHow should I delete this db after each test? I\u2019ve found an approach for this in the integration tests of docker/libcompose but it is relatively complex.</p>\n\n<p>Is there a common approach for that? Testing if there is an elasticsearch with an empty index available and if not failing the tests with a good setupmessage?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["http", "post", "go"], "comments": [{"owner": {"reputation": 78861, "user_id": 561309, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/6d833d9f0ffa2265a01359ccecd26d54?s=128&d=identicon&r=PG&f=1", "display_name": "laurent", "link": "https://stackoverflow.com/users/561309/laurent"}, "edited": false, "score": 4, "creation_date": 1475581657, "post_id": 39851463, "comment_id": 66990736, "body": "Please post the actual code, not a screenshot of it (anyway, isn&#39;t it easier to copy and paste some text, rather that taking a screenshot, cutting it, and uploading it?)."}], "answers": [{"tags": [], "owner": {"reputation": 1157, "user_id": 5154802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZqLky3QxN2E/AAAAAAAAAAI/AAAAAAAAAEE/MyYiHfmqVe0/photo.jpg?sz=128", "display_name": "shivendra pratap singh", "link": "https://stackoverflow.com/users/5154802/shivendra-pratap-singh"}, "is_accepted": false, "score": 1, "last_activity_date": 1475589057, "creation_date": 1475589057, "answer_id": 39854112, "question_id": 39851463, "link": "https://stackoverflow.com/questions/39851463/how-to-send-a-post-using-golang-replace-with-this-curl-command/39854112#39854112", "title": "How to send a post using golang, replace with this curl command", "body": "<p>I can give you a simple tip. Just try to run your code using <strong>POSTMAN</strong> Tool of chrome. It's an extension. Install it and send request using that and you can generate exact code in any language for that request.</p>\n\n<p><a href=\"https://i.stack.imgur.com/e4XLL.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/e4XLL.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 3331709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88bf584dd56023adba3426641ec0f905?s=128&d=identicon&r=PG&f=1", "display_name": "Enahs", "link": "https://stackoverflow.com/users/3331709/enahs"}, "is_accepted": false, "score": 0, "last_activity_date": 1488406415, "creation_date": 1488406415, "answer_id": 42543120, "question_id": 39851463, "link": "https://stackoverflow.com/questions/39851463/how-to-send-a-post-using-golang-replace-with-this-curl-command/42543120#42543120", "title": "How to send a post using golang, replace with this curl command", "body": "<p>There is an issue with Go connecting to nginx over HTTP2. </p>\n\n<p>more details here: <a href=\"https://github.com/golang/go/issues/17066\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/17066</a></p>\n\n<p>In versions of Go after 1.6, HTTP2 is enabled by default. Disabling it should solve this.</p>\n\n<pre><code>http.DefaultClient.Transport = &amp;http.Transport{\nTLSNextProto: make(map[string]func(authority string, c *tls.Conn) http.RoundTripper),\n}\nresp, err := http.DefaultClient.Do(req)\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6328154, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wxOUc7bziHo/AAAAAAAAAAI/AAAAAAAAACI/ENB5WGwg-7U/photo.jpg?sz=128", "display_name": "user6328154", "link": "https://stackoverflow.com/users/6328154/user6328154"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2717, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1488406415, "creation_date": 1475581539, "last_edit_date": 1475805680, "question_id": 39851463, "link": "https://stackoverflow.com/questions/39851463/how-to-send-a-post-using-golang-replace-with-this-curl-command", "title": "How to send a post using golang, replace with this curl command", "body": "<p><img src=\"https://i.stack.imgur.com/XPKWE.png\" alt=\"There is my code :\"></p>\n\n<p>The error is:</p>\n\n<blockquote>\n  <p>stream error: stream ID 1; REFUSED_STREAM</p>\n</blockquote>\n\n<p>But the curl command is Ok:</p>\n\n<pre><code>curl -H \"Content-type: application/json\" -X POST -d '{\"skip_mobile\":false,\"selected_website\":[],\"basic_info\":{\"name\":\"\u738b\u51ef\",\"id_card_num\":\"410881199210130778\",\"cell_phone_num\":\"18817953402\"}}'  https://www.juxinli.com/orgApi/rest/v2/applications/yiqime\n</code></pre>\n\n<p>I want to know why</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1475582496, "post_id": 39851428, "comment_id": 66991276, "body": "<a href=\"https://play.golang.org/p/bXMCYqNq8A\" rel=\"nofollow noreferrer\">The code in the question works as expected in the playground</a>."}, {"owner": {"reputation": 1429, "user_id": 1853299, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1777296b400ae41bdb91bbd959fbb3e6?s=128&d=identicon&r=PG", "display_name": "Roshan", "link": "https://stackoverflow.com/users/1853299/roshan"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1475582915, "post_id": 39851428, "comment_id": 66991518, "body": "Thanks @MellowMarmot. I didn&#39;t post further struct methods like reset and someother things in diffrent module. Can such lines make any difference ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1475583537, "post_id": 39851428, "comment_id": 66991999, "body": "Please post a <a href=\"http://stackoverflow.com/help/mcve\">complete and verifiable example</a>. The code as posted works. It&#39;s difficult to guess what&#39;s wrong with the code that we cannot see."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1475583864, "post_id": 39851428, "comment_id": 66992260, "body": "You may be tripped up by thinking of this as inheritance. There is absolutely no inheritance going on here, just composition. A selector expression will automatically find the proper field or method to delegate to when there&#39;s no ambiguity, but <code>CombinedFlight</code> itself is not a <code>Flight</code> or a <code>FlghtMeta</code>."}], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1475591155, "post_id": 39854479, "comment_id": 66997455, "body": "This works like the code in the question. What&#39;s the advantage of using different types for the slice elements? The linked post does not address this."}], "tags": [], "owner": {"reputation": 1157, "user_id": 5154802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZqLky3QxN2E/AAAAAAAAAAI/AAAAAAAAAEE/MyYiHfmqVe0/photo.jpg?sz=128", "display_name": "shivendra pratap singh", "link": "https://stackoverflow.com/users/5154802/shivendra-pratap-singh"}, "is_accepted": false, "score": 0, "last_activity_date": 1475590050, "last_edit_date": 1495541966, "creation_date": 1475590050, "answer_id": 39854479, "question_id": 39851428, "link": "https://stackoverflow.com/questions/39851428/golang-protobuff-generated-struct-is-not-decoding-child-attribute-for-json-unma/39854479#39854479", "title": "Golang: Protobuff generated Struct is not decoding child attribute for json.Unmarshling", "body": "<p>Try to do this </p>\n\n<pre><code>        type CombinedFlight1 struct {\n            Flight\n            FlightMeta\n\n        }\n\n\n        type CombinedFlight2 struct {\n            Flight\n            FlightMeta\n\n        }\n\n        type ResponseFlight struct {\n           OnwardFlights  []CombinedFlight1  `json:\"onwardflights, omitempty\"`\n           ReturnFlights  []CombinedFlight2  `json:\"returnflights, omitempty\"`\n           Error string  `json:\"error, omitempty\"`\n        }\n</code></pre>\n\n<p>It will work fine and if you want to marshal, you have to create two different structure. For more understanding see this post</p>\n\n<p>Visit <a href=\"https://stackoverflow.com/questions/38501646/initialize-nested-struct-definition-in-golang-if-it-have-same-objects\">Initialize nested struct definition in Golang if it have same objects</a> </p>\n"}], "owner": {"reputation": 1429, "user_id": 1853299, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1777296b400ae41bdb91bbd959fbb3e6?s=128&d=identicon&r=PG", "display_name": "Roshan", "link": "https://stackoverflow.com/users/1853299/roshan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1475591996, "creation_date": 1475581424, "last_edit_date": 1475591996, "question_id": 39851428, "link": "https://stackoverflow.com/questions/39851428/golang-protobuff-generated-struct-is-not-decoding-child-attribute-for-json-unma", "title": "Golang: Protobuff generated Struct is not decoding child attribute for json.Unmarshling", "body": "<p>I have one struct which is getting used with protobuff serialiser and works well.</p>\n\n<p>This struct is generated by protobuff hence it has so many methods like Unmarshal etc. </p>\n\n<pre><code>type Flight struct {\n    FlightNo string  `json:\"flightno, omitempty\"`\n    Carrier string   `json:\"carrier, omitempty\"`\n}\nfunc (m *Flight) Unmarshal(data []byte) error {\n    l := len(data)\n    iNdEx := 0\n    for iNdEx &lt; l {\n        preIndex := iNdEx\n        var wire uint64\n        for shift := uint(0); ; shift += 7 {\n            if shift &gt;= 64 {\n                return ErrIntOverflowFlight\n            }\n            if iNdEx &gt;= l {\n                return io.ErrUnexpectedEOF\n            }\n            b := data[iNdEx]\n            iNdEx++\n            wire |= (uint64(b) &amp; 0x7F) &lt;&lt; shift\n            if b &lt; 0x80 {\n                break\n            }\n        }\n    }\n // some more code\n}\n</code></pre>\n\n<p>Then I want to add additional field to this flight info,</p>\n\n<pre><code>type FlightMeta struct {\n    Source string `json:\"source, omitempty\"`\n    Destination string `json:\"destination, omitempty\"`\n}\n</code></pre>\n\n<p>Then i have combined struct of these two,</p>\n\n<pre><code>type CombinedFlight struct {\n    Flight\n    FlightMeta\n\n}\n\ntype ResponseFlight struct {\n    OnwardFlights  []CombinedFlight  `json:\"onwardflights, omitempty\"`\n    ReturnFlights  []CombinedFlight  `json:\"returnflights, omitempty\"`\n    Error string  `json:\"error, omitempty\"`\n}\n</code></pre>\n\n<p>So when i read some data like,</p>\n\n<pre><code>str \"= `{\"onwardflights\": [{\"flightno\": \"537\", \"carrier\": \"AI\", \"source\": \"BOM\", \"destination\": \"DEL\"}], \"error\": \"false\"}`\nrespFlight = new(ResponseFlight)\n\nerr = json.Unmarshal([]byte(str), &amp;respFlight)\n\nfmt.Println(\"flightno:\", respFlight.OnwardFlights[0].FlightNo, \"flight source\", respFlight.OnwardFlights[0].Source)\n\n#prints \"flightno:537 flight source:\n</code></pre>\n\n<p>It doesn't print value for second struct, as per methis is not unmarshling properly.</p>\n\n<p>But when i set the attribute manually and marshal(encode it to json) this is working fine.\nAny leads.?</p>\n"}, {"tags": ["go", "httpserver", "http-proxy"], "comments": [{"owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "edited": false, "score": 0, "creation_date": 1475592064, "post_id": 39848379, "comment_id": 66998153, "body": "You&#39;ll need to check the headers. However, I&#39;m not sure whether they will be present as the transport layer is adding them into a private <a href=\"https://golang.org/src/net/http/transport.go#L289\" rel=\"nofollow noreferrer\">extra header section</a>. Dump the req resp headers anyway ? They might give you a clue."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 6767074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f29ef5865f6806ab604df98299743b56?s=128&d=identicon&r=PG&f=1", "display_name": "Pieterjan Lambein", "link": "https://stackoverflow.com/users/6767074/pieterjan-lambein"}, "edited": false, "score": 0, "creation_date": 1475649394, "post_id": 39860474, "comment_id": 67021306, "body": "Yea, I think thats the only way it would.. Though I&#39;m quite concerned with security issues here."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 33, "user_id": 6767074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f29ef5865f6806ab604df98299743b56?s=128&d=identicon&r=PG&f=1", "display_name": "Pieterjan Lambein", "link": "https://stackoverflow.com/users/6767074/pieterjan-lambein"}, "edited": false, "score": 0, "creation_date": 1475671395, "post_id": 39860474, "comment_id": 67035070, "body": "@PieterjanLambein: There&#39;s not really any security issue. Proxies are already known by their address in the &quot;by&quot; field of the &quot;Forwarded&quot; header, or in the &quot;Via&quot; header, or just by the host recording the connecting address. If you&#39;re still concerned, use an opaque identifier that doesn&#39;t correlate to anything outside the execution of your program."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 0, "last_activity_date": 1475610004, "creation_date": 1475610004, "answer_id": 39860474, "question_id": 39848379, "link": "https://stackoverflow.com/questions/39848379/go-roundtrip-transport-proxy-address/39860474#39860474", "title": "Go RoundTrip/Transport Proxy Address", "body": "<p>Have the Proxy function add a header to record the proxy server used:</p>\n\n<pre><code>Transport{\n    Proxy: func(req *Request) (*url.URL, error) {\n        p, err := proxyrouter.Calculateproxy(req)\n        if err != nil {\n            return err\n        }\n        req.Header.Set(\"X-Proxy-Addr\", p.String())\n        return req, nil\n    },\n}\n</code></pre>\n\n<p>The <a href=\"https://golang.org/pkg/net/http/#Response\" rel=\"nofollow\"><code>http.Response</code></a> has a reference to the originating request</p>\n\n<pre><code>proxy := resp.Request.Header.Get(\"X-Proxy-Addr\")\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 6767074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f29ef5865f6806ab604df98299743b56?s=128&d=identicon&r=PG&f=1", "display_name": "Pieterjan Lambein", "link": "https://stackoverflow.com/users/6767074/pieterjan-lambein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 660, "favorite_count": 0, "accepted_answer_id": 39860474, "answer_count": 1, "score": 1, "last_activity_date": 1475610004, "creation_date": 1475572254, "question_id": 39848379, "link": "https://stackoverflow.com/questions/39848379/go-roundtrip-transport-proxy-address", "title": "Go RoundTrip/Transport Proxy Address", "body": "<p>I understand that the Proxy field of http.Transport asks for a function that generates proxy server addresses. So this is my roundtripper:</p>\n\n<pre><code>roundtripper := &amp;http.Transport{\n    Proxy: proxyrouter.Calculateproxy,\n...\n}\n</code></pre>\n\n<p>So the type of Proxy is <code>func(*Request) (*url.URL, error)</code>. This gets linked to the server and is later on called with:</p>\n\n<pre><code>response := roundtripper.RoundTrip(request)\n</code></pre>\n\n<p>Which returns the response. Now is there any way to know what proxy address was used to get this response? (since my Calculateproxy function just takes random addresses)</p>\n"}, {"tags": ["dictionary", "go", "config"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1475568599, "post_id": 39847140, "comment_id": 66982941, "body": "If it does the job I would not worry about it. Go is not about elegant code, but about working code..."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1475568809, "post_id": 39847140, "comment_id": 66983049, "body": "That said, I would put a test <code>if len(tmp) &gt;= 2</code> before accessing it (<code>tmp[0]</code>) because that may fail."}, {"owner": {"reputation": 2211, "user_id": 5785847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7PbW4.jpg?s=128&g=1", "display_name": "Mikey", "link": "https://stackoverflow.com/users/5785847/mikey"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1475568908, "post_id": 39847140, "comment_id": 66983110, "body": "@RickyA Very good point, I actually haven&#39;t really put any error checking in there. Will add it into what I&#39;m working on, thanks."}], "answers": [{"comments": [{"owner": {"reputation": 2211, "user_id": 5785847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7PbW4.jpg?s=128&g=1", "display_name": "Mikey", "link": "https://stackoverflow.com/users/5785847/mikey"}, "edited": false, "score": 0, "creation_date": 1475569709, "post_id": 39847473, "comment_id": 66983513, "body": "That&#39;s an interesting way to go about it, if I wanted to also trim any whitespace with <code>strings.TrimSpace()</code> would it be a case of looping through elements and updating them, or is there a way to apply it to the csv reader? Just so I can avoid the <code>[    Var2 Value2]</code>"}, {"owner": {"reputation": 2211, "user_id": 5785847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7PbW4.jpg?s=128&g=1", "display_name": "Mikey", "link": "https://stackoverflow.com/users/5785847/mikey"}, "edited": false, "score": 0, "creation_date": 1475572108, "post_id": 39847473, "comment_id": 66984926, "body": "Looks interesting, will see if anyone else has any suggestions. If not I&#39;ll accept this answer later."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 3, "last_activity_date": 1475578269, "last_edit_date": 1475578269, "creation_date": 1475569328, "answer_id": 39847473, "question_id": 39847140, "link": "https://stackoverflow.com/questions/39847140/is-there-a-better-way-to-parse-this-map/39847473#39847473", "title": "Is there a better way to parse this Map?", "body": "<p>1- You may read all with just one function call <code>r.ReadAll()</code> using <code>csv.NewReader</code> from <code>encoding/csv</code> with:</p>\n\n<pre><code>r.Comma = '='\nr.TrimLeadingSpace = true\n</code></pre>\n\n<p>And result is <code>[][]string</code>, and <strong>input order is preserved</strong>, Try it on <a href=\"https://play.golang.org/p/4Un7b7zn6o\" rel=\"nofollow\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    text := `Var1=Value1\n    Var2=Value2\n    Var3=Value3`\n\n    r := csv.NewReader(strings.NewReader(text))\n    r.Comma = '='\n    r.TrimLeadingSpace = true\n\n    all, err := r.ReadAll()\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(all)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[[Var1 Value1] [Var2 Value2] [Var3 Value3]]\n</code></pre>\n\n<hr>\n\n<p>2- You may fine-tune <code>csv.ReadAll()</code> to convert the output to the map, but <strong>the order is not preserved</strong>, try it on <a href=\"https://play.golang.org/p/d4VQi5ehH6\" rel=\"nofollow\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"io\"\n    \"strings\"\n)\n\nfunc main() {\n    text := `Var1=Value1\n    Var2=Value2\n    Var3=Value3`\n    r := csv.NewReader(strings.NewReader(text))\n    r.Comma = '='\n    r.TrimLeadingSpace = true\n    all, err := ReadAll(r)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(all)\n}\n\nfunc ReadAll(r *csv.Reader) (map[string]string, error) {\n    m := make(map[string]string)\n    for {\n        tmp, err := r.Read()\n        if err == io.EOF {\n            return m, nil\n        }\n        if err != nil {\n            return nil, err\n        }\n        m[tmp[0]] = tmp[1]\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>map[Var2:Value2 Var3:Value3 Var1:Value1]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2211, "user_id": 5785847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7PbW4.jpg?s=128&g=1", "display_name": "Mikey", "link": "https://stackoverflow.com/users/5785847/mikey"}, "edited": false, "score": 1, "creation_date": 1475577883, "post_id": 39849834, "comment_id": 66988339, "body": "Can&#39;t really argue with that, brilliant answer. Primarily the only reason I chose the plaintext format was due it being how I&#39;ve seen it handled in other languages. Will give the other question you mentioned a read after I&#39;ve digested your answer fully. Thanks though :D"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2211, "user_id": 5785847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7PbW4.jpg?s=128&g=1", "display_name": "Mikey", "link": "https://stackoverflow.com/users/5785847/mikey"}, "edited": false, "score": 0, "creation_date": 1475604546, "post_id": 39849834, "comment_id": 67005908, "body": "@Pigeon Made a couple of more edits to make it even more useful / informative."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1475604964, "last_edit_date": 1495541802, "creation_date": 1475576567, "answer_id": 39849834, "question_id": 39847140, "link": "https://stackoverflow.com/questions/39847140/is-there-a-better-way-to-parse-this-map/39849834#39849834", "title": "Is there a better way to parse this Map?", "body": "<p>First, I would recommend to read this related question: <a href=\"https://stackoverflow.com/questions/16465705/how-to-handle-configuration-in-go\">How to handle configuration in Go</a></p>\n\n<p>Next, I would really consider storing your configuration in another format. Because what you propose isn't a standard. It's close to <a href=\"https://en.wikipedia.org/wiki/.properties\" rel=\"nofollow noreferrer\">Java's property file format (<code>.properties</code>)</a>, but even property files may contain Unicode sequences and thus your code is not a valid <code>.properties</code> format parser as it doesn't handle Unicode sequences at all.</p>\n\n<p>Instead I would recommend to use <a href=\"http://www.json.org/\" rel=\"nofollow noreferrer\">JSON</a>, so you can easily parse it with Go or with any other language, and there are many tools to edit JSON texts, and still it is human-friendly.</p>\n\n<p>Going with the JSON format, decoding it into a <code>map</code> is just one function call: <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\"><code>json.Unmarshal()</code></a>. It could look like this:</p>\n\n<pre><code>text := `{\"Var1\":\"Value1\", \"Var2\":\"Value2\", \"Var3\":\"Value3\"}`\n\nvar m map[string]string\nif err := json.Unmarshal([]byte(text), &amp;m); err != nil {\n    fmt.Println(\"Invalid config file:\", err)\n    return\n}\n\nfmt.Println(m)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/eFUZ7vKm47\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>map[Var1:Value1 Var2:Value2 Var3:Value3]\n</code></pre>\n\n<p>The <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>json</code></a> package will handle formatting and escaping for you, so you don't have to worry about any of those. It will also detect and report errors for you. Also JSON is more flexible, your config may contain numbers, texts, arrays, etc. All those come for \"free\" just because you chose the JSON format.</p>\n\n<p>Another popular format for configuration is <a href=\"http://yaml.org/\" rel=\"nofollow noreferrer\">YAML</a>, but the Go standard library does not include a YAML parser. See Go implementation <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\"><code>github.com/go-yaml/yaml</code></a>.</p>\n\n<p>If you don't want to change your format, then I would just use the code you posted, because it does exactly what you want it to do: process input line-by-line, and  parse a <code>name = value</code> pair from each line. <em>And it does it in a clear and obvious way</em>. Using a CSV or any other reader for this purpose is bad because they hide what's under the hood (they intentionally and rightfully hide format specific details and transformations). A CSV reader <em>is</em> a CSV reader <em>first</em>; even if you change the tabulator / comma symbol: it <em>will</em> interpret certain escape sequences and might give you different data than what you see in a plain text editor. This is an unintended behavior from your point of view, but hey, your input is <em>not</em> in CSV format and yet you asked a reader to interpret it <em>as</em> CSV!</p>\n\n<p>One improvement I would add to your solution is the use of <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"nofollow noreferrer\"><code>bufio.Scanner</code></a>. It can be used to read an input line-by-line, and it handles different styles of newline sequences. It could look like this:</p>\n\n<pre><code>text := `Var1=Value1\nVar2=Value2\nVar3=Value3`\n\nscanner := bufio.NewScanner(strings.NewReader(text))\n\nm := map[string]string{}\nfor scanner.Scan() {\n    parts := strings.Split(scanner.Text(), \"=\")\n    if len(parts) == 2 {\n        m[strings.TrimSpace(parts[0])] = strings.TrimSpace(parts[1])\n    }\n}\nif err := scanner.Err(); err != nil {\n    fmt.Println(\"Error encountered:\", err)\n}\n\nfmt.Println(m)\n</code></pre>\n\n<p>Output is the same. Try it on the <a href=\"https://play.golang.org/p/TPklh3Pa92\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Using <code>bufio.Scanner</code> has another advantage: <a href=\"https://golang.org/pkg/bufio/#NewScanner\" rel=\"nofollow noreferrer\"><code>bufio.NewScanner()</code></a> accepts an <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a>, the general interface for \"all things being a source of bytes\". This means if your config is stored in a file, you don't even have to read all the config into the memory, you can just open the file e.g. with <a href=\"https://golang.org/pkg/os/#Open\" rel=\"nofollow noreferrer\"><code>os.Open()</code></a> which returns a value of <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>*os.File</code></a> which also implements <code>io.Reader</code>, so you may directly pass the <code>*os.File</code> value to <code>bufio.NewScanner()</code> (and so the <code>bufio.Scanner</code> will read from the file and not from an in-memory buffer like in the example above).</p>\n"}], "owner": {"reputation": 2211, "user_id": 5785847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7PbW4.jpg?s=128&g=1", "display_name": "Mikey", "link": "https://stackoverflow.com/users/5785847/mikey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 39849834, "answer_count": 2, "score": 2, "last_activity_date": 1475604964, "creation_date": 1475568080, "last_edit_date": 1475604702, "question_id": 39847140, "link": "https://stackoverflow.com/questions/39847140/is-there-a-better-way-to-parse-this-map", "title": "Is there a better way to parse this Map?", "body": "<p>Fairly new to Go, essentially in the actual code I'm writing I plan to read from a file which will contain environment variables, i.e. <code>API_KEY=XYZ</code>. Means I can keep them out of Version control. The below solution 'works' but I feel like there is probably a better way of doing it.</p>\n\n<p>The end goal is to be able to access the elements from the file like so\n<code>m[\"API_KEY\"]</code> and that would print <code>XYZ</code>. This may even already exist and I'm re-inventing the wheel, I saw Go has environment variables but it didn't seem to be what I was after specifically.</p>\n\n<p>So any help is appreciated. </p>\n\n<p><a href=\"https://play.golang.org/p/a7xKPmjaSy\" rel=\"nofollow\">Playground</a></p>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nvar m = make(map[string]string)\n\nfunc main() {\n\n    text := `Var1=Value1\n    Var2=Value2\n    Var3=Value3`\n\n    arr := strings.Split(text, \"\\n\")\n\n    for _, value := range arr {\n        tmp := strings.Split(value, \"=\")\n        m[strings.TrimSpace(tmp[0])] = strings.TrimSpace(tmp[1])\n    }\n\n    fmt.Println(m)\n\n}\n</code></pre>\n"}, {"tags": ["web", "go", "gzip"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1475566665, "post_id": 39844866, "comment_id": 66981948, "body": "Also never parse your templates inside the handler, especially if it&#39;s large. For details see <a href=\"http://stackoverflow.com/a/28453523/1705598\">It takes too much time when using \u201ctemplate\u201d package to generate a dynamic web page to client in golang</a>"}, {"owner": {"reputation": 141, "user_id": 6029027, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ac9c83841db833d09ea9bfaf8d72d42?s=128&d=identicon&r=PG&f=1", "display_name": "Wyatt", "link": "https://stackoverflow.com/users/6029027/wyatt"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1476020576, "post_id": 39844866, "comment_id": 67168838, "body": "@icza It&#39;s not about the global variable. Because the .js and .css file is too big, it takes too much time for the browser to download the web content."}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 6029027, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ac9c83841db833d09ea9bfaf8d72d42?s=128&d=identicon&r=PG&f=1", "display_name": "Wyatt", "link": "https://stackoverflow.com/users/6029027/wyatt"}, "edited": false, "score": 0, "creation_date": 1476020032, "post_id": 39846111, "comment_id": 67168717, "body": "I have tried this code, but when I query this url. I only donwload this zip file. My code is given above"}], "tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": false, "score": 2, "last_activity_date": 1475564629, "creation_date": 1475564629, "answer_id": 39846111, "question_id": 39844866, "link": "https://stackoverflow.com/questions/39844866/how-to-gzip-a-template-in-golang-web/39846111#39846111", "title": "how to gzip a template in golang web", "body": "<p>You can use package <a href=\"https://golang.org/pkg/compress/gzip/#NewWriter\" rel=\"nofollow\"><code>compress/gzip</code></a>:</p>\n\n<blockquote>\n  <p><strong>func NewWriter(w io.Writer) *Writer</strong></p>\n  \n  <p>NewWriter returns a new Writer.<br>\n  Writes to the returned writer are compressed and written to w.  </p>\n  \n  <p>It is the caller's responsibility to call Close on the WriteCloser<br>\n  when done. Writes may be buffered and not flushed until Close.</p>\n</blockquote>\n\n<p>In your code, it might look like this:</p>\n\n<pre><code>gz := gzip.NewWriter(w)\ndefer gz.Close()\n\nerr = tmpl.Execute(gz, nil)\nif err != nil {\n    http.Error(gz, err.Error(), http.StatusInternalServerError)\n    return\n}\n</code></pre>\n\n<p><strong>Ps.</strong></p>\n\n<p>You might want to check the <code>Accept-Encoding</code> header in the request to see if the browser accepts gzip encoded content.</p>\n"}, {"tags": [], "owner": {"reputation": 141, "user_id": 6029027, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ac9c83841db833d09ea9bfaf8d72d42?s=128&d=identicon&r=PG&f=1", "display_name": "Wyatt", "link": "https://stackoverflow.com/users/6029027/wyatt"}, "is_accepted": true, "score": -1, "last_activity_date": 1476180568, "creation_date": 1476180568, "answer_id": 39974960, "question_id": 39844866, "link": "https://stackoverflow.com/questions/39844866/how-to-gzip-a-template-in-golang-web/39974960#39974960", "title": "how to gzip a template in golang web", "body": "<p>Anyway, I have not solved this problem. As I mentioned, when I add this code, restart the server and query this url, I actually download the zip file!?</p>\n\n<p>In the end, I used Nginx to make a reverse proxy to compress the template. It works.</p>\n\n<p>Still thanks to @Anisus</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 3831106, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y78DP.jpg?s=128&g=1", "display_name": "areed", "link": "https://stackoverflow.com/users/3831106/areed"}, "is_accepted": false, "score": 1, "last_activity_date": 1481597243, "creation_date": 1481597243, "answer_id": 41112983, "question_id": 39844866, "link": "https://stackoverflow.com/questions/39844866/how-to-gzip-a-template-in-golang-web/41112983#41112983", "title": "how to gzip a template in golang web", "body": "<blockquote>\n<pre><code>r.Header.Set(\"Accept-Encoding\", \"gzip\")\n</code></pre>\n</blockquote>\n\n<p>Setting the headers on the request has no effect. You would want to read this header to determine whether to use gzip.</p>\n\n<p>The reason the browser downloads the file instead of rendering it is that it's missing a content type. When you write to an http.ResponseWriter without setting the Content-Type there's an algorithm that determines the Content-Type and sets the correct header. But with your body gzipped, it can't determine the correct content type. Add this before you write any data back to the client:</p>\n\n<pre><code>w.Header().Set(\"Content-Type\", \"text/html\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 3790098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12c8d6d722407b7fbbb9c085c898882b?s=128&d=identicon&r=PG&f=1", "display_name": "ianovici", "link": "https://stackoverflow.com/users/3790098/ianovici"}, "is_accepted": false, "score": 0, "last_activity_date": 1548166800, "creation_date": 1548166800, "answer_id": 54310289, "question_id": 39844866, "link": "https://stackoverflow.com/questions/39844866/how-to-gzip-a-template-in-golang-web/54310289#54310289", "title": "how to gzip a template in golang web", "body": "<p>This is a bit to late but i hope someone else finds this usefull.</p>\n\n<p>The code works but you need to set the header to be properly interpreted by the browser:</p>\n\n<pre><code>w.Header().Add(\"Content-Type\",\"text/html\")\nw.Header().Add(\"Content-Encoding\",\"gzip\")\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 6029027, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ac9c83841db833d09ea9bfaf8d72d42?s=128&d=identicon&r=PG&f=1", "display_name": "Wyatt", "link": "https://stackoverflow.com/users/6029027/wyatt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1000, "favorite_count": 1, "accepted_answer_id": 39974960, "answer_count": 4, "score": 1, "last_activity_date": 1548166800, "creation_date": 1475559530, "last_edit_date": 1476067816, "question_id": 39844866, "link": "https://stackoverflow.com/questions/39844866/how-to-gzip-a-template-in-golang-web", "title": "how to gzip a template in golang web", "body": "<p>I have already set the value of contest-encoding, but how can I gzip the template, since the file is still to big.</p>\n\n<pre><code>func indexPageHandler(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Encoding\", \"gzip\")\n    r.Header.Set(\"Accept-Encoding\", \"gzip\")\n    tmpl, err := template.New(\"index.html\").ParseGlob(\"./templates/*\")\n    if err != nil {\n        log.Println(err)\n        return\n    }   \n    err = tmpl.Execute(w, nil)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }   \n}\n</code></pre>\n\n<p>Is there any function that can gzip the response\uff1f]</p>\n\n<p>Followed by the advise, I changed my code as this:</p>\n\n<pre><code>func indexPageHandler(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Encoding\", \"gzip\")\n    r.Header.Set(\"Accept-Encoding\", \"gzip\")\n    gz := gzip.NewWriter(w)\n    defer gz.Close()\n    tmpl, err := template.New(\"index.html\").ParseGlob(\"./templates/*\")\n    if err != nil {\n        log.Println(err)\n        return\n    }   \n    err = tmpl.Execute(gz, nil)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }   \n}\n</code></pre>\n\n<p>But when I query the url, I only download the gzip file. What's wrong with it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "edited": false, "score": 0, "creation_date": 1475547286, "post_id": 39843134, "comment_id": 66975844, "body": "Side note but probably related - In terms of cool Go web frameworks that use a middleware pattern with a general syntax that might be familiar to Express is <a href=\"https://echo.labstack.com\" rel=\"nofollow noreferrer\">echo.labstack.com</a>."}, {"owner": {"reputation": 269, "user_id": 6177750, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/efd32d64c102e217a24256a5fd748055?s=128&d=identicon&r=PG", "display_name": "adamSiwiec", "link": "https://stackoverflow.com/users/6177750/adamsiwiec"}, "reply_to_user": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "edited": false, "score": 0, "creation_date": 1475547390, "post_id": 39843134, "comment_id": 66975868, "body": "@syllabix I am trying to create a copy of Echo :)"}], "answers": [{"tags": [], "owner": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "is_accepted": true, "score": 8, "last_activity_date": 1475549487, "last_edit_date": 1475549487, "creation_date": 1475549152, "answer_id": 39843383, "question_id": 39843134, "link": "https://stackoverflow.com/questions/39843134/using-callbacks-and-functions-as-a-type-in-go/39843383#39843383", "title": "Using callbacks and functions as a type in go", "body": "<p>You are on the right track - creating a type for a func on the context you are using it adds clearer design intent and more importantly additional type safety.</p>\n\n<p>You just need to modify you example a bit for it to compile:</p>\n\n<pre><code>package main\n\nimport \"log\"\n\n//the return type of the func is part of its overall type definition - specify string as it's return type to comply with example you have above\ntype foo func(string, string) string\n\nfunc bar(route string, io foo) {\n\n    log.Printf(\"I am inside of bar\")\n    response := io(\"param\", \"param\")\n    log.Println(response)\n\n}\n\nfunc main() {\n\n    bar(\"Hello\", func(arg1, arg2 string) string {\n        return arg1 + arg2\n    })\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 9182641, "user_type": "registered", "profile_image": "https://graph.facebook.com/10211163572862072/picture?type=large", "display_name": "Paco Preciado Mendoza", "link": "https://stackoverflow.com/users/9182641/paco-preciado-mendoza"}, "is_accepted": false, "score": 0, "last_activity_date": 1555267818, "creation_date": 1555267818, "answer_id": 55678832, "question_id": 39843134, "link": "https://stackoverflow.com/questions/39843134/using-callbacks-and-functions-as-a-type-in-go/55678832#55678832", "title": "Using callbacks and functions as a type in go", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n)\n\ntype foo func(string, string)\n\nfunc bar(route string, callback foo) bool {\n //...logic\n\n  /* you can return the callback to use the \n     parameters and also in the same way you \n     could verify the bar function\n   */\n    callback(\"param\", \"param\")\n    return true\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n\n    res := bar(\"Hello\", func(arg1, arg2 string) {\n        log.Println(arg1 + \"_1\")\n        log.Println(arg2 + \"_2\")\n    })\n\n    fmt.Println(\"bar func res: \", res)\n}\n</code></pre>\n"}], "owner": {"reputation": 269, "user_id": 6177750, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/efd32d64c102e217a24256a5fd748055?s=128&d=identicon&r=PG", "display_name": "adamSiwiec", "link": "https://stackoverflow.com/users/6177750/adamsiwiec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2692, "favorite_count": 1, "accepted_answer_id": 39843383, "answer_count": 2, "score": 3, "last_activity_date": 1555267818, "creation_date": 1475546805, "last_edit_date": 1475549126, "question_id": 39843134, "link": "https://stackoverflow.com/questions/39843134/using-callbacks-and-functions-as-a-type-in-go", "title": "Using callbacks and functions as a type in go", "body": "<p>I am attempting to create a sort of function that is similar to the Express (NodeJS) route method in Go:</p>\n\n<pre><code>app.get(\"route/here/\", func(req, res){\n    res.DoStuff()\n});    \n</code></pre>\n\n<p>In this example I want \"foo\" (the type) to be the same as the anonymous function in the above method. Here is one of my failed attempts using Go:</p>\n\n<pre><code>type foo func(string, string)\n\nfunc bar(route string, io foo) {\n        log.Printf(\"I am inside of bar\")\n        // run io, maybe io() or io(param, param)?\n}\n\nfunc main() {\n        bar(\"Hello\", func(arg1, arg2) {\n                return  arg + arg2\n        })\n}\n</code></pre>\n\n<p>How might I fix my dilemma? Should I not use a type and use something else? What are my options?</p>\n"}, {"tags": ["python", "go"], "comments": [{"owner": {"reputation": 55248, "user_id": 642070, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c280b71b3187d1cc113a6e302b414b9?s=128&d=identicon&r=PG", "display_name": "tdelaney", "link": "https://stackoverflow.com/users/642070/tdelaney"}, "edited": false, "score": 1, "creation_date": 1475539834, "post_id": 39842242, "comment_id": 66974149, "body": "The python script should write to <code>stdout</code>. You could <code>print</code> or <code>sys.stdout.write</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1475544751, "post_id": 39842242, "comment_id": 66975281, "body": "Show the code for test.py."}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1987437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/508e14a7e9414311eff04b2fd8d20ed6?s=128&d=identicon&r=PG", "display_name": "Liam Kelly", "link": "https://stackoverflow.com/users/1987437/liam-kelly"}, "is_accepted": false, "score": 0, "last_activity_date": 1475540677, "creation_date": 1475540677, "answer_id": 39842421, "question_id": 39842242, "link": "https://stackoverflow.com/questions/39842242/go-exec-external-python-script-and-get-the-returned-output/39842421#39842421", "title": "Go exec external python script and get the returned output", "body": "<p>I think i found the bug, you need to put the full path to \"test.py\"</p>\n\n<p><strong>Test</strong></p>\n\n<p>I have two files in a directory:\n    test.py\n    test.go</p>\n\n<p>The <code>test.py</code> is:</p>\n\n<pre><code>#!/usr/bin/env python3\n\nprint(\"Hello from python\")\n</code></pre>\n\n<p>and <code>test.go</code> is:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"os/exec\"\n)\n\nfunc main() {\n\n//cmd := exec.Command(\"test.py\")\n// I got an error because test.py was not in my PATH, which makes sense\n// When i added './' the program worked because go knew where to find test.py\ncmd := exec.Command(\"./test.py\")\nout, err := cmd.CombinedOutput()\nif err != nil {\n    fmt.Println(err)\n}\nfmt.Println(string(out))\n}\n</code></pre>\n\n<p>And I get the following output:</p>\n\n<pre><code>$ go run ./test.go \nHello from python\n</code></pre>\n"}], "owner": {"reputation": 561, "user_id": 1330831, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n2hjY.jpg?s=128&g=1", "display_name": "ast", "link": "https://stackoverflow.com/users/1330831/ast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1442, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1475577458, "creation_date": 1475539210, "last_edit_date": 1475577458, "question_id": 39842242, "link": "https://stackoverflow.com/questions/39842242/go-exec-external-python-script-and-get-the-returned-output", "title": "Go exec external python script and get the returned output", "body": "<p>In my Go file i use exec to run the external script:</p>\n\n<pre><code>cmd := exec.Command(\"test.py\")\nout, err := cmd.CombinedOutput()\nif err != nil {\n    fmt.Println(err)\n}\nfmt.Println(string(out))\n</code></pre>\n\n<p>The python script it's executed fine, but the go <code>fmt.Println(string(out))</code> prints nothing. </p>\n\n<p>The question it's how i should return the value from the Python script to be read back again from Go?</p>\n\n<p>Python pseudo code:</p>\n\n<p><code>def main():\n    ...\n    ...\n    return value</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1475587367, "post_id": 39841756, "comment_id": 66994762, "body": "You&#39;re not showing how your semaphore is supposed to limit concurrency, and you don&#39;t appear to be using it normal manner. There&#39;s no reason for that level of concurrency when talking to the filesystem and a database, why spawn 40k goroutines for this? Your stack trace starts with a failed cgo call, but you&#39;re not showing the relevant part of the stack trace. What are you using cgo for?"}, {"owner": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475613802, "post_id": 39841756, "comment_id": 67010774, "body": "@JimB 1. <code>parseFIle()</code> has <code>&lt;- task.routinesChannel</code> in the beginning. If I understand correctly, if go routines are already drained all numbers from channel, goroutine should block. 2. I understand that I can re-write it in a manner of workers receiving file names over channel. But I&#39;m curious if such level of concurrency can be maintained. What scares me is leaky connections (?) 3. I&#39;m not accessing cgo directly, this is a runtime crash. Output is 38MB in size :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475614867, "post_id": 39841756, "comment_id": 67011265, "body": "I see, you&#39;re sort of using the semaphore backwards so you can use it to count files as well. You need to limit the concurrency in some manner, so spawning all the goroutines at once and having them block on the semaphore doesn&#39;t really gain you anything. You might as well try to use a reasonable number of gorouitnes, at least to eliminate other variables that could be causing issues. If you&#39;re not using cgo, it may be the host net resolver, but regardless of how big the stack trace is a random goroutine in &quot;chan receive&quot; is not the one that caused the fault."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475615299, "post_id": 39841756, "comment_id": 67011470, "body": "There&#39;s simply not enough info here. The goroutine stack that caused the fault may help. Also, that DB package doesn&#39;t look very well tested, and the http handling doesn&#39;t look like it&#39;s going to deal with any concurrency very well. This clinet looks like it can open up an unlimited number of connections to the DB. I don&#39;t think it will leak connections, but it&#39;s going to open and close large numbers of connections when there&#39;s high concurrency."}, {"owner": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475702482, "post_id": 39841756, "comment_id": 67054686, "body": "Thanks for your comments! I&#39;ve reverted semaphore so it will send on attempt to lock (in <code>parseFile</code>) and receive on unlock (when parsing completes), this allowed me to restrain goroutines. Putting some of allocations after starting goroutine also helps :)"}], "owner": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 183, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475537147, "creation_date": 1475535947, "last_edit_date": 1475537147, "question_id": 39841756, "link": "https://stackoverflow.com/questions/39841756/hitting-limits-with-goroutines-arango", "title": "Hitting limits with goroutines &amp; aranGO", "body": "<p>I'm trying to parse ~40k files into JSON and save them to ArangoDB (this is a part of my 4fun project). This can be simplified as:</p>\n\n<pre><code>func walkRepository(task *RepositoryProcessingTask) {\n    filepath.Walk(task.Repository.Path, func(path string, info os.FileInfo, err error) error {\n        // ...\n        go parseFile(task, file)\n        // ...\n        return nil\n    })\n}\n\nfunc parseFile(task *RepositoryProcessingTask, file *RepositoryFile) {\n    &lt;- task.routinesChannel\n    defer finishProcessingFile(task)\n\n    // Saves to ArangoDB (opens http connection)\n    err = db.Col(\"File\").Save(file)\n\n    // ...\n}\n</code></pre>\n\n<p>So, basically, I'm spawning 40k routines. Since each routine opens file and http socket to ArangoDB (I'm using <a href=\"https://github.com/diegogub/aranGO/tree/v2\" rel=\"nofollow\">arangGO.v2</a> ), I'm hitting 1k open file limit pretty easily. </p>\n\n<p>I've tried to limit number of routines running in parallel via channel-semaphore, but with no luck:</p>\n\n<pre><code>const (\n    maxRunningRoutines = 256\n)\n\n// on task creation\ntask.routinesChannel = make(chan int32, maxRunningRoutines)\n\n// on task start\nfor i := int32(0) ; i &lt; maxRunningRoutines ; i += 1 {\n    task.routinesChannel &lt;- i\n}\n\n// when parsing completes\ntask.routinesChannel &lt;- processedFiles\n</code></pre>\n\n<p>Finally, I have increased open-file limit, but it causes program to crash:</p>\n\n<pre><code>runtime/cgo: pthread_create failed: Resource temporarily unavailable\nSIGABRT: abort\nPC=0x7fcddd12c5f7 m=2\n\ngoroutine 0 [idle]:\n\n...\n\ngoroutine 81348 [chan receive]:\nnet/http.(*Transport).getConn.func2.1(0xcc732b2120, 0xc8200ec0c0, 0x959c08)\n        /usr/lib/golang/src/net/http/transport.go:698 +0x48\ncreated by net/http.(*Transport).getConn.func2\n        /usr/lib/golang/src/net/http/transport.go:702 +0x70\n</code></pre>\n\n<p>My guess is that HTTP connections spawned by DB client are not closing ASAP which causes trouble. But how could I fix it and prove it that this is real cause?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1475591132, "post_id": 39841580, "comment_id": 66997434, "body": "More an FYI: Most docker commands accept a <code>--format</code> option which needs to be a Golang Template (from the <code>text&#47;template</code>) package."}], "answers": [{"comments": [{"owner": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "edited": false, "score": 0, "creation_date": 1475535714, "post_id": 39841646, "comment_id": 66973164, "body": "Thank you very much. I came very close to the code as in your solution while trying things out yesterday but sometimes things just don&#39;t work :(. Yes, I am interested in the safer way you explained in your answer. Can you please provide that too for this JSON. Thanks again."}, {"owner": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "edited": false, "score": 0, "creation_date": 1475536447, "post_id": 39841646, "comment_id": 66973363, "body": "Actually, I just need to have an equivalent struct representing the JSON and Unmarshal into it (if thats what you meant). I can try this myself if you give some pointers. Thanks."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "edited": false, "score": 1, "creation_date": 1475537082, "post_id": 39841646, "comment_id": 66973524, "body": "@GauravSinha yep, that&#39;s what I mean and here is an example of that; <a href=\"https://play.golang.org/p/VfHst9GaiR\" rel=\"nofollow noreferrer\">play.golang.org/p/VfHst9GaiR</a> I&#39;ll post some of the relevant code into my answer though I&#39;ve done a lot of sloppy stuff just to prove the data is there/show how to access it."}, {"owner": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "edited": false, "score": 0, "creation_date": 1475537224, "post_id": 39841646, "comment_id": 66973560, "body": "defined the struct and seems to work, <a href=\"https://play.golang.org/p/2uTLoDqPnF\" rel=\"nofollow noreferrer\">play.golang.org/p/2uTLoDqPnF</a>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "edited": false, "score": 1, "creation_date": 1475537338, "post_id": 39841646, "comment_id": 66973590, "body": "@GauravSinha yep. I also included the json tags, they&#39;re not necessary in this particular example though because the field names in Go exactly match those in the json. It&#39;s quite common that you have to use those though (the most obvious example is when the fields in json are lower cased, you usually need them to be exported in Go which makes them different than what&#39;s in the json)."}, {"owner": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "edited": false, "score": 0, "creation_date": 1475537603, "post_id": 39841646, "comment_id": 66973640, "body": "saw your example, it is a great help :) BTW - unrelated to my original question, why do we unmarshal it, instead can we just use decode. Wondering if that has any implications."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "edited": false, "score": 1, "creation_date": 1475539596, "post_id": 39841646, "comment_id": 66974093, "body": "@GauravSinha I think the two are basically equivalent, I just used unmarshal because I&#39;m used to it and I think it&#39;s more convenient. I&#39;d have to do a bit of research to be sure about that."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 3, "last_activity_date": 1475537220, "last_edit_date": 1475537220, "creation_date": 1475535115, "answer_id": 39841646, "question_id": 39841580, "link": "https://stackoverflow.com/questions/39841580/parsing-json-in-go/39841646#39841646", "title": "Parsing JSON in go", "body": "<p>Your code just needs to be modified to further unpackage the data. You're leaving it with each container object represented as an <code>interface{}</code> which makes it so you can't access the fields within it. Another assert on each to make it a <code>map[string]interface{}</code> will allow you to access the fields within by name (like <code>IPv4Address</code>). Here's a working example; <a href=\"https://play.golang.org/p/4OC5axN4Gd\" rel=\"nofollow\">https://play.golang.org/p/4OC5axN4Gd</a></p>\n\n<p>Here's the important code change;</p>\n\n<pre><code>    containers := (foo[0][\"Containers\"]).(map[string]interface{})\n\n    //fmt.Printf(\"containers %+v\", containers)\n    for _, v := range containers {\n        unwrapped := v.(map[string]interface{})\n        fmt.Printf(\"\\ncont %+v\\n\", unwrapped[\"IPv4Address\"])            \n    }\n</code></pre>\n\n<p><code>v</code> is just an <code>interface{}</code> so you have no way of accessing the <code>IPv4Address</code> field without asserting again/converting into a type.</p>\n\n<p>Now that works fine, however, I would recommend getting away from the heavy use of interfaces in your code. Your code is full of unsafe operations that create a need for a lot of error handling (like every time you attempt access into the map you have the potential to throw, as well as anytime you do a type assert). There are plenty of examples of how to do this here on SO but if you leave a comment requesting it I can produce another example that will unmarshal into structs. This is a lot more safe and maintainable imo because most errors will be raised on the call to unmarshal, rather than having potentially a lot of code that works with the results that could all cause a panic.</p>\n\n<p>Here is some play code that has all the types in it and uses unmarshal; <a href=\"https://play.golang.org/p/VfHst9GaiR\" rel=\"nofollow\">https://play.golang.org/p/VfHst9GaiR</a></p>\n\n<p>Your types can be represented with the following;</p>\n\n<pre><code>type DockerInstance struct {\n    Name string `json:\"Name\"`\n    Id string `json:\"Id\"`\n    Scope string `json:\"Scope\"`\n    Driver string `json:\"Driver\"`   \n    EnableIPv6 bool `json:\"EnableIPv6\"`\n    IPAM IPAM `json:\"IPAM\"`\n    Internal bool `json:\"Internal\"`\n    Containers map[string]Container `json:\"Containers\"`\n    Options map[string]string `json:\"Options\"`\n    Labels interface{} `json:\"Labels\"`\n}\n\ntype IPAM struct {\n    Driver string `json:\"Driver\"`\n    Options interface{} `json:\"Options\"`\n    Config []Conf `json:\"Config\"`\n}\n\ntype Conf struct {\n    Subnet string `json:\"Subnet\"`\n}\n\ntype Container struct {\n    Name string `json:\"Name\"`\n        EndPointID string `json:\"EndpointID\"`\n    MacAddress string `json:\"MacAddress\"`\n        IPv4Address string `json:\"IPv4Address\"`\n    IPv6Address string `json:\"IPv6Address\"`\n}\n</code></pre>\n\n<p>There's a few stuff I still have set to interface, that's just cause the sample json doesn't include any data for them so I can't know what their type should be in the Go source. Here's some basic stuff I also added in your main to test out the objects/make sure I had things defined correctly;</p>\n\n<pre><code>docks := []DockerInstance{} //note you're using an array of the top level type\nerr := json.Unmarshal([]byte(teststring), &amp;docks)\nif err != nil {\n    fmt.Println(err)\n} else {\n    fmt.Println()\n    fmt.Println()\n    fmt.Println(docks[0].Name)\n}\n\nfor k, v := range docks[0].Containers {\n    fmt.Println(k)\n    fmt.Println(v.IPv4Address)\n}\n\nfor k, v := range docks[0].Options {\n      fmt.Println(k)\n    fmt.Println(v)\n}\n</code></pre>\n"}], "owner": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 696, "favorite_count": 0, "accepted_answer_id": 39841646, "answer_count": 1, "score": 0, "last_activity_date": 1475537220, "creation_date": 1475534692, "question_id": 39841580, "link": "https://stackoverflow.com/questions/39841580/parsing-json-in-go", "title": "Parsing JSON in go", "body": "<p>My question is about parsing JSON files in golang. </p>\n\n<p>Specifically, I am trying to parse output of a command \"docker network inspect bridge\", which happens to be in JSON format. The command is described here. My goal is to get a list of \"IPv4Address\" for the listed containers. </p>\n\n<p>I have tried to do this but failing to convert map[string]interface{} to map[string]string. My code is here:- <a href=\"https://play.golang.org/p/eO_j996gGb\" rel=\"nofollow\">https://play.golang.org/p/eO_j996gGb</a> </p>\n\n<pre><code>$ sudo docker network inspect bridge\n[\n    {\n        \"Name\": \"bridge\",\n        \"Id\": \"b2b1a2cba717161d984383fd68218cf70bbbd17d328496885f7c921333228b0f\",\n        \"Scope\": \"local\",\n        \"Driver\": \"bridge\",\n        \"IPAM\": {\n            \"Driver\": \"default\",\n            \"Config\": [\n                {\n                    \"Subnet\": \"172.17.42.1/16\",\n                    \"Gateway\": \"172.17.42.1\"\n                }\n            ]\n        },\n        \"Internal\": false,\n        \"Containers\": {\n            \"bda12f8922785d1f160be70736f26c1e331ab8aaf8ed8d56728508f2e2fd4727\": {\n                \"Name\": \"container2\",\n                \"EndpointID\": \"0aebb8fcd2b282abe1365979536f21ee4ceaf3ed56177c628eae9f706e00e019\",\n                \"MacAddress\": \"02:42:ac:11:00:02\",\n                \"IPv4Address\": \"172.17.0.2/16\",\n                \"IPv6Address\": \"\"\n            },\n            \"f2870c98fd504370fb86e59f32cd0753b1ac9b69b7d80566ffc7192a82b3ed27\": {\n                \"Name\": \"container1\",\n                \"EndpointID\": \"a00676d9c91a96bbe5bcfb34f705387a33d7cc365bac1a29e4e9728df92d10ad\",\n                \"MacAddress\": \"02:42:ac:11:00:01\",\n                \"IPv4Address\": \"172.17.0.1/16\",\n                \"IPv6Address\": \"\"\n            }\n        },\n        \"Options\": {\n            \"com.docker.network.bridge.default_bridge\": \"true\",\n            \"com.docker.network.bridge.enable_icc\": \"true\",\n            \"com.docker.network.bridge.enable_ip_masquerade\": \"true\",\n            \"com.docker.network.bridge.host_binding_ipv4\": \"0.0.0.0\",\n            \"com.docker.network.bridge.name\": \"docker0\",\n            \"com.docker.network.driver.mtu\": \"1500\"\n        }\n    }\n]\n</code></pre>\n\n<p>What is the correct way to parse such JSON files in golang. I did try using type conversion but doesn't help. I have tried many things but finally could only get as far as the code shown in the snippet. How can I extract the IPv4Address field from the \"cont\" object? </p>\n\n<p>Link to go playground snippet I have is <a href=\"https://play.golang.org/p/eO_j996gGb\" rel=\"nofollow\">https://play.golang.org/p/eO_j996gGb</a>. Any help is greatly appreciated (willing to try things out, don't need just the code but ideas :) Thanks. </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 6824098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd0de5692bbd1cd46d753c3e2d995eeb?s=128&d=identicon&r=PG&f=1", "display_name": "Pippin", "link": "https://stackoverflow.com/users/6824098/pippin"}, "edited": false, "score": 0, "creation_date": 1475610697, "post_id": 39843300, "comment_id": 67009256, "body": "Thanks! I&#39;ll give it a try."}], "tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": true, "score": 3, "last_activity_date": 1475548422, "creation_date": 1475548422, "answer_id": 39843300, "question_id": 39841414, "link": "https://stackoverflow.com/questions/39841414/how-to-reduce-repetitive-http-handler-code-in-golang/39843300#39843300", "title": "How to reduce repetitive http handler code in golang?", "body": "<p>Why not create a factory function for the <code>http.Handler</code> used with each <code>Thing</code>? This allows you to write the <code>showHandler</code> logic once and parameterize the instantiation of individual things. </p>\n\n<pre><code>// A ThingFactory returns a Thing struct configured with the given ID.\ntype ThingFactory func(id int64) interface{}\n\n// The createShowHandler function is a factory function for creating a handler\n// which uses the getThing factory function to obtain an instance of a\n// thing to use when generating a view.\nfunc createShowHandler(getThing ThingFactory) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        vars := mux.Vars(r)\n        id, err := strconv.ParseInt(vars[\"id\"], 10, 64)\n\n        if err != nil {\n            errorHandler(w, err)\n            return\n        }\n\n        thing := getThing(id)\n        err = db.First(&amp;thing, id).Error\n\n        if err != nil {\n            errorHandler(w, err)\n        }\n\n        if thing1.ID &gt; 0 {\n            jsonHeaders(w, http.StatusOK)\n            if err := json.NewEncoder(w).Encode(thing1); err != nil {\n                errorHandler(w, err)\n            }\n            return\n        }\n\n        notFoundHandler(w, r)\n    }\n}\n</code></pre>\n\n<p>This function can be used to systematically create routes for a given router. For instance, I can create an explicit registry which keeps track of the path for each thing as well as a <code>ThingFactory</code> instance which is used when calling the <code>createShowHandler</code> factory function.</p>\n\n<pre><code>router := mux.NewRouter()\napiRouter := router.PathPrefix(\"/v1\").Subrouter()\n\nregistry := []struct {\n    path    string\n    handler ThingFactory\n}{\n    {\"/thing1/{id}\", func(id int64) interface{} { return Thing1{ID: id} }},\n    {\"/thing2/{id}\", func(id int64) interface{} { return Thing2{ID: id} }},\n    {\"/thing3/{id}\", func(id int64) interface{} { return Thing3{ID: id} }},\n}\n\nfor _, registrant := range registry {\n    apiRouter.HandleFunc(registrant.path, createShowHandler(registrant.handler)).Methods(\"GET\")\n}\n</code></pre>\n\n<p>Naturally, you would want to define interfaces for the various interaction points in a program like this to gain more type safety when dealing with a large number of instances. A more robust registry could be implemented that provided an interface for <code>Thing</code>s to register themselves with.</p>\n"}], "owner": {"reputation": 45, "user_id": 6824098, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd0de5692bbd1cd46d753c3e2d995eeb?s=128&d=identicon&r=PG&f=1", "display_name": "Pippin", "link": "https://stackoverflow.com/users/6824098/pippin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 520, "favorite_count": 0, "accepted_answer_id": 39843300, "answer_count": 1, "score": 3, "last_activity_date": 1475548422, "creation_date": 1475533810, "question_id": 39841414, "link": "https://stackoverflow.com/questions/39841414/how-to-reduce-repetitive-http-handler-code-in-golang", "title": "How to reduce repetitive http handler code in golang?", "body": "<p>I'm designing a API server in Go. I have many database tables, each with a matching <code>struct</code>. Each has a route and handler:</p>\n\n<pre><code>type Thing1 struct {\n   ID int64\n   Name string\n   ...\n}\n\nfunc main() {\n    ...\n    router := mux.NewRouter()\n    apiRouter := router.PathPrefix(\"/v1\").Subrouter()\n    apiRouter.HandleFunc(\"/thing1/{id}\", Thing1ShowHandler).Methods(\"GET\")\n}\n\nfunc Thing1ShowHandler(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n\n    id, err := strconv.ParseInt(vars[\"id\"], 10, 64)\n    if err != nil {\n        errorHandler(w, err)\n        return\n    }\n    thing1 := Thing1{ID: id}\n    err = db.First(&amp;thing1, id).Error\n    if thing1.ID &gt; 0 {\n        jsonHeaders(w, http.StatusOK)\n        if err := json.NewEncoder(w).Encode(thing1); err != nil {\n            errorHandler(w, err)\n        }\n        return\n    }\n    notFoundHandler(w, r)\n}\n</code></pre>\n\n<p>The code for <code>Thing2</code> is pretty much identical, as it is for <code>Thing3</code> and so on. I will end up with hundreds of things, and therefore lots of duplicated code. It feels like I'm doing something horribly wrong. What's the best way to make this more DRY?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "is_accepted": false, "score": 0, "last_activity_date": 1475552016, "creation_date": 1475552016, "answer_id": 39843729, "question_id": 39840327, "link": "https://stackoverflow.com/questions/39840327/go-command-returns-not-found-but-works-in-terminal/39843729#39843729", "title": "Go command returns not found but works in terminal", "body": "<p>It would be helpful to see more of your code but I think I know what you're trying to do. You can call <code>Remove</code> just on your <code>collection</code>. </p>\n\n<p>So (err handling removed for brevity):</p>\n\n<p><code>session</code> being the session variable:</p>\n\n<pre><code>collection := session.DB(\"your_db_name\").C(\"main\")\n\nerr = collection.Remove(bson.M{\"id\":1})\n</code></pre>\n"}], "owner": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 167, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1475552016, "creation_date": 1475528327, "question_id": 39840327, "link": "https://stackoverflow.com/questions/39840327/go-command-returns-not-found-but-works-in-terminal", "title": "Go command returns not found but works in terminal", "body": "<p>I am trying to remove a record from MongoDB using the following line of Go code:</p>\n\n<p><code>mg.collection.Remove(bson.M{\"id\": 1})</code> this command returns a not found error but the following piece of codes works without issue in the terminal and Robomongo:</p>\n\n<p><code>db.getCollection('main').remove({\"id\":1})</code></p>\n\n<p>What am I doing wrong in Go?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["sockets", "go", "docker"], "comments": [{"owner": {"reputation": 2234, "user_id": 875882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b19a2eda07d44c4a9e83c8e99046be75?s=128&d=identicon&r=PG", "display_name": "Haoming Zhang", "link": "https://stackoverflow.com/users/875882/haoming-zhang"}, "edited": false, "score": 0, "creation_date": 1475528604, "post_id": 39840235, "comment_id": 66970501, "body": "Looks like your project is enabled https, but your local docker daemon still in plain http. Maybe this doc helps <a href=\"https://docs.docker.com/engine/security/https/\" rel=\"nofollow noreferrer\">docs.docker.com/engine/security/https</a>"}, {"owner": {"reputation": 50397, "user_id": 1318694, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JPEVC.png?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/1318694/matt"}, "edited": false, "score": 0, "creation_date": 1475540163, "post_id": 39840235, "comment_id": 66974223, "body": "What are the command line options you pass to your docker instance? (<code>ps -ef | grep docker</code> What&#39;s in your <code>&#47;etc&#47;docker&#47;daemon.json</code>? Do you get a standard response to a <code>curl --unix-socket &#47;var&#47;run&#47;docker.sock http:&#47;v1.23&#47;containers&#47;json?all=1</code>"}], "answers": [{"tags": [], "owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "is_accepted": false, "score": 0, "last_activity_date": 1492043624, "creation_date": 1492043624, "answer_id": 43381725, "question_id": 39840235, "link": "https://stackoverflow.com/questions/39840235/error-when-creating-container-with-golang-docker-engine/43381725#43381725", "title": "Error when creating container with golang docker engine", "body": "<pre><code>client.NewEnvClient()\n</code></pre>\n\n<p>Last time I tried, this API expects environment variables like <code>DOCKER_HOST</code> in a different syntax from than the normal docker client.</p>\n\n<p>From the <a href=\"https://github.com/docker/docker/blob/master/client/client.go#L84\" rel=\"nofollow noreferrer\">client.go</a>:</p>\n\n<pre><code>// NewEnvClient initializes a new API client based on environment variables.\n// Use DOCKER_HOST to set the url to the docker server.\n// Use DOCKER_API_VERSION to set the version of the API to reach, leave empty for latest.\n// Use DOCKER_CERT_PATH to load the TLS certificates from.\n// Use DOCKER_TLS_VERIFY to enable or disable TLS verification, off by default.\n</code></pre>\n\n<p>To use this, you need DOCKER_HOST to be set/exported in one of these formats:</p>\n\n<ol>\n<li>unix:///var/run/docker.sock</li>\n<li><a href=\"http://localhost:2375\" rel=\"nofollow noreferrer\">http://localhost:2375</a></li>\n<li><a href=\"https://localhost:2376\" rel=\"nofollow noreferrer\">https://localhost:2376</a></li>\n</ol>\n"}], "owner": {"reputation": 173, "user_id": 4112854, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/be654ce623e60d9c1e86714b48533cd3?s=128&d=identicon&r=PG&f=1", "display_name": "jybateman", "link": "https://stackoverflow.com/users/4112854/jybateman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1055, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1492043624, "creation_date": 1475527969, "last_edit_date": 1492022632, "question_id": 39840235, "link": "https://stackoverflow.com/questions/39840235/error-when-creating-container-with-golang-docker-engine", "title": "Error when creating container with golang docker engine", "body": "<p>I am creating a project in Go and I am using both \"github.com/docker/docker/client\" and \"github.com/docker/docker/api/types\", but when I try and create a container I get the following error:</p>\n\n<blockquote>\n  <p>ERROR: 2016/10/03 22:39:26 containers.go:84: error during connect: Post <a href=\"https://%2Fvar%2Frun%2Fdocker.sock/v1.23/containers/create\" rel=\"nofollow noreferrer\">https://%2Fvar%2Frun%2Fdocker.sock/v1.23/containers/create</a>: http: server gave HTTP response to HTTPS client</p>\n</blockquote>\n\n<p>I can't understand why this is happening and it only happened after using the new golang docker engine(the old \"github.com/docker/engine-api\" is now deprecated).</p>\n\n<p>The code isn't anything complicated, so I wonder if I am missing something:</p>\n\n<pre><code>    resp, err := cli.Pcli.ContainerCreate(context.Background(), initConfig(), nil, nil, \"\")\n    if err != nil {\n            return err\n    }\n</code></pre>\n\n<p>And the initConfig that is called does the following:</p>\n\n<pre><code>func initConfig() (config *container.Config) {\n    mount := map[string]struct{}{\"/root/host\": {}}\n    return &amp;container.Config{Image: \"leadis_image\", Volumes: mount, Cmd: strslice.StrSlice{\"/root/server.py\"}, AttachStdout: true}}\n</code></pre>\n\n<p>Also here is my dockerfile</p>\n\n<blockquote>\n  <p>FROM        debian</p>\n  \n  <p>MAINTAINER  Leadis Journey</p>\n  \n  <p>LABEL   Description=\"This docker image is used to compile and execute user's program.\"</p>\n  \n  <p>LABEL   Version=\"0.1\"</p>\n  \n  <p>VOLUME  /root/host/</p>\n  \n  <p>RUN     apt-get update &amp;&amp; yes | apt-get upgrade</p>\n  \n  <p>RUN     yes | apt-get install gcc g++ python3 make</p>\n  \n  <p>COPY    container.py /root/server.py</p>\n</blockquote>\n\n<p><strong>EDIT</strong></p>\n\n<p>Just tried to test it with a simpler program</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"os\"\n        \"io/ioutil\"\n        \"github.com/docker/docker/client\"\n        \"github.com/docker/docker/api/types\"\n        \"github.com/docker/docker/api/types/container\"\n        \"github.com/docker/docker/api/types/strslice\"\n        \"golang.org/x/net/context\"\n)\n\n\nfunc initConfig() (config *container.Config) {\n        mount := map[string]struct{}{\"/root/host\": {}}\n        return &amp;container.Config{Image: \"leadis_image\", Volumes: mount, Cmd: strslice.StrSlice{\"/root/server.py\"}, AttachStdout: true}\n}\n\nfunc main() {\n        client, _ := client.NewEnvClient()\n\n\n        cwd, _ := os.Getwd()\n        ctx, err := os.Open(cwd+\"/Dockerfile.tar.gz\")\n        if err != nil {\n                fmt.Println(err)\n                return\n        }\n        build, err := client.ImageBuild(context.Background(), ctx, types.ImageBuildOptions{Tags: []string{\"leadis_image\"}, Context: ctx, SuppressOutput: false})\n        if err != nil {\n                fmt.Println(err)\n                return\n        }\n\n        b, _ := ioutil.ReadAll(build.Body)\n        fmt.Println(string(b))\n        _, err = client.ContainerCreate(context.Background(), initConfig(), nil, nil, \"\")\n        if err != nil {\n                fmt.Println(err)\n        }\n}\n</code></pre>\n\n<p>Same dockerfile, but I still get the same error:</p>\n\n<blockquote>\n  <p>error during connect: Post\n  <a href=\"https://%2Fvar%2Frun%2Fdocker.sock/v1.23/containers/create\" rel=\"nofollow noreferrer\">https://%2Fvar%2Frun%2Fdocker.sock/v1.23/containers/create</a>: http:\n  server gave HTTP response to HTTPS client</p>\n</blockquote>\n"}, {"tags": ["go", "console"], "comments": [{"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 2, "creation_date": 1475531210, "post_id": 39839661, "comment_id": 66971570, "body": "maybe you could do something like this with one of these <a href=\"https://github.com/avelino/awesome-go#advanced-console-uis\" rel=\"nofollow noreferrer\">github.com/avelino/awesome-go#advanced-console-uis</a> specifically termbox or one of the packages built on top of it?"}, {"owner": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "reply_to_user": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 0, "creation_date": 1476061289, "post_id": 39839661, "comment_id": 67180427, "body": "@jcbwlkr thanks. I ended up using <code>termbox-go</code> from your link. I had to write my own print functions and manage cursor position etc., but in the end I got the effect I wanted."}, {"owner": {"reputation": 127, "user_id": 10176807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83f8fa107bdcc124bc29c8153bda63f1?s=128&d=identicon&r=PG&f=1", "display_name": "Sharon KatzR7", "link": "https://stackoverflow.com/users/10176807/sharon-katzr7"}, "edited": false, "score": 0, "creation_date": 1569553942, "post_id": 39839661, "comment_id": 102642211, "body": "Could you share the final code? (Of course just the sharable part ...)"}, {"owner": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "reply_to_user": {"reputation": 127, "user_id": 10176807, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83f8fa107bdcc124bc29c8153bda63f1?s=128&d=identicon&r=PG&f=1", "display_name": "Sharon KatzR7", "link": "https://stackoverflow.com/users/10176807/sharon-katzr7"}, "edited": false, "score": 0, "creation_date": 1577646125, "post_id": 39839661, "comment_id": 105215718, "body": "@SharonKatzR7 It&#39;s an open source repository: <a href=\"https://github.com/hazrmard/gobol\" rel=\"nofollow noreferrer\">github.com/hazrmard/gobol</a> Specifically, check out <code>shell.go</code> and <code>printNewMessage()</code>. Not very well documented - it was more of a learning project."}], "answers": [{"comments": [{"owner": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "edited": false, "score": 0, "creation_date": 1476061116, "post_id": 39849291, "comment_id": 67180394, "body": "Thanks. However this looks like it would only work on linux, not windows, given the arguments to <code>exec.Command</code>."}], "tags": [], "owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "is_accepted": false, "score": 1, "last_activity_date": 1475577818, "last_edit_date": 1475577818, "creation_date": 1475574918, "answer_id": 39849291, "question_id": 39839661, "link": "https://stackoverflow.com/questions/39839661/how-to-print-to-console-while-waiting-for-user-input-in-go/39849291#39849291", "title": "How to print to console while waiting for user input in Go?", "body": "<p>To clear a line you can use <code>\\r</code> to return the cursor to the beginning of line and then replace all the characters on the line with whitespace and then issue another <code>\\r</code> to return to the beginning of line again. For example (add more spaces if needed):</p>\n\n<pre><code>fmt.Printf(\"\\r                                                        \\r\")\n</code></pre>\n\n<p>Now you can print your background data on top of the data user had inputted.</p>\n\n<p>Then how do you reprint the data user had inputted? You can't read it from terminal itself so you have to save it somewhere while it's being input. One way to do this would be to disable input buffering on your terminal so each character you type immediately gets flushed to stdin where you can read it. For example:</p>\n\n<pre><code>var input []byte\nreader := bufio.NewReader(os.Stdin)\n// disables input buffering\nexec.Command(\"stty\", \"-F\", \"/dev/tty\", \"cbreak\", \"min\", \"1\").Run()\n// append each character that gets typed to input slice\nfor {\n        b, err := reader.ReadByte()\n        if err != nil {\n                panic(err)\n        }\n        input = append(input, b)\n}\n</code></pre>\n\n<p>So when you need to insert background data, first clear the line, then print your background data and finally print the contents of the input variable on the next line.</p>\n"}], "owner": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 765, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1475577818, "creation_date": 1475525641, "last_edit_date": 1475526488, "question_id": 39839661, "link": "https://stackoverflow.com/questions/39839661/how-to-print-to-console-while-waiting-for-user-input-in-go", "title": "How to print to console while waiting for user input in Go?", "body": "<p>I am writing an interactive application that accepts user inputs in a loop and prints out responses in the background. The reader part of my code looks like:  </p>\n\n<pre><code>scanner := bufio.NewReader(os.Stdin)\nfor {\n    fmt.Print(\":: \")                // prompt for user to enter stuff\n    in,_:=scanner.ReadString('\\n')\n}\n</code></pre>\n\n<p>However, while I am waiting for the user input, I want to print some asynchronous data I got over the network like so:  </p>\n\n<pre><code>&gt;&gt; Some text\n&gt;&gt; :: Hi I'm the user and I'm\n</code></pre>\n\n<p>Now some background data arrives:  </p>\n\n<pre><code>&gt;&gt; Some text\n&gt;&gt; This data was printed while user was inputting\n&gt;&gt; :: Hi I'm the user and I'm\n</code></pre>\n\n<p>And now the user can finish their input:  </p>\n\n<pre><code>&gt;&gt; Some text\n&gt;&gt; This data was printed while user was inputting\n&gt;&gt; :: Hi I'm the user and I'm entering some text\n&gt;&gt; :: \n</code></pre>\n\n<p>I'm thinking that the background routine would need to scan <code>stdin</code> for text, erase it somehow, print its own data, and restore the original text. I do not know how to scan text that has not been input via the enter key, or how to clear a line. How do I go about it?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 16, "user_id": 7013550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c6218984449b9f903d51ee3906ac66f?s=128&d=identicon&r=PG", "display_name": "Anon", "link": "https://stackoverflow.com/users/7013550/anon"}, "is_accepted": true, "score": 0, "last_activity_date": 1476360264, "creation_date": 1476360264, "answer_id": 40020512, "question_id": 39839093, "link": "https://stackoverflow.com/questions/39839093/go-library-async-auto-for-golang/40020512#40020512", "title": "Go Library - async.auto for golang", "body": "<p>You can try this: </p>\n\n<p><a href=\"https://github.com/kamildrazkiewicz/go-flow\" rel=\"nofollow\">https://github.com/kamildrazkiewicz/go-flow</a></p>\n\n<p>It's based on channels draining (async.auto uses topological sort) but it works in similar way. </p>\n"}], "owner": {"reputation": 13300, "user_id": 2521225, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/39c72c6dc4d20a8e736f8ed0d08fa646?s=128&d=identicon&r=PG&f=1", "display_name": "samol", "link": "https://stackoverflow.com/users/2521225/samol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 40020512, "answer_count": 1, "score": -3, "last_activity_date": 1476360264, "creation_date": 1475523231, "question_id": 39839093, "link": "https://stackoverflow.com/questions/39839093/go-library-async-auto-for-golang", "title": "Go Library - async.auto for golang", "body": "<p>In Nodejs, we have async.auto (<a href=\"http://caolan.github.io/async/docs.html#.auto\" rel=\"nofollow\">http://caolan.github.io/async/docs.html#.auto</a>) which automatically manages the fan out order through a topological sort.</p>\n\n<p>Is there a similar library in Go that manages your order of requests</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 648, "user_id": 1981061, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bf8c5be4f273295132879954ce1e7b11?s=128&d=identicon&r=PG", "display_name": "Griffin", "link": "https://stackoverflow.com/users/1981061/griffin"}, "edited": false, "score": 0, "creation_date": 1475506106, "post_id": 39834259, "comment_id": 66958265, "body": "Although you are flushing and not keeping the rows in the memory the result of the query which you are storing in &#39;r&#39; will be all the 200000 rows. I bet if you check you will see memory usage spikes to 1.5GB right after c.Query() line."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1475508608, "post_id": 39834259, "comment_id": 66959867, "body": "What type is <code>c</code>? Why is it closed before reading from <code>r</code>? Also, have you tried putting <code>res</code> initialisation outside of the cycle?"}, {"owner": {"reputation": 328, "user_id": 495600, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/8183f0e2a203c53b30ce70d0cc7417c0?s=128&d=identicon&r=PG", "display_name": "Kallol", "link": "https://stackoverflow.com/users/495600/kallol"}, "edited": false, "score": 0, "creation_date": 1475509033, "post_id": 39834259, "comment_id": 66960136, "body": "C is the connection object. I didn&#39;t try to initialize res outside cycle. My understanding is the res will be garbage collected at the end of the loop."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 1, "creation_date": 1475510254, "post_id": 39834259, "comment_id": 66960950, "body": "Try to define <code>res</code> as <code>var res StatsData</code> outside of range and call <code>sqlstruct.Scan(&amp;res, r)</code>"}, {"owner": {"reputation": 1762, "user_id": 5120331, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YhTAB.png?s=128&g=1", "display_name": "Corvus Crypto", "link": "https://stackoverflow.com/users/5120331/corvus-crypto"}, "edited": false, "score": 1, "creation_date": 1475511558, "post_id": 39834259, "comment_id": 66961706, "body": "Couple things come to mind, the first being you should get in a habit to use defer for the closing of your cursor, connection and file to keep things idiomatic. Second: 1.5 GB for this seems off unless whatever &quot;p&quot; is stores some large result. Is it virtual mem you are looking at perhaps? Also is there a reason you can&#39;t pass the reference to CalculateData instead of passing the dereferenced value?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1475511762, "post_id": 39834259, "comment_id": 66961821, "body": "@Kallol What exactly is &quot;connection object&quot;? If you&#39;re using something fancy, it might pull all the data before closing. Try closing <code>c</code> after the loop or even better, use <code>defer</code> as Corvus Crypto suggested."}, {"owner": {"reputation": 328, "user_id": 495600, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/8183f0e2a203c53b30ce70d0cc7417c0?s=128&d=identicon&r=PG", "display_name": "Kallol", "link": "https://stackoverflow.com/users/495600/kallol"}, "edited": false, "score": 0, "creation_date": 1475543458, "post_id": 39834259, "comment_id": 66975029, "body": "Thank you all for the suggestions. I made the changes as mentioned: 1) Initiated res outside loop 2) Used defer close(c)  But still, the result is not as expected. The query returns 1700000 rows of 22 columns  I tried out a few more checks like I commented out  p.CalculateData(*res) // This function calculates and writes result into buffer and can see the memory remaining stable.  This tells me that when I am calculating and writing the result to buffer, the memory is going high. Does Flush() clears up buffer everytime?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1475574769, "post_id": 39834259, "comment_id": 66986576, "body": "@Kallol Another suggestion: what does <code>p.CalculateData</code> return? If it&#39;s <code>string</code> then it could cause the allocations because <code>string &lt;-&gt; []byte</code> conversions almost always copy data."}, {"owner": {"reputation": 328, "user_id": 495600, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/8183f0e2a203c53b30ce70d0cc7417c0?s=128&d=identicon&r=PG", "display_name": "Kallol", "link": "https://stackoverflow.com/users/495600/kallol"}, "edited": false, "score": 0, "creation_date": 1475581883, "post_id": 39834259, "comment_id": 66990872, "body": "Yes. It returns a string and I am converting it to byte while writing to the buffer.Should I use WriteString?"}], "owner": {"reputation": 328, "user_id": 495600, "user_type": "registered", "accept_rate": 23, "profile_image": "https://www.gravatar.com/avatar/8183f0e2a203c53b30ce70d0cc7417c0?s=128&d=identicon&r=PG", "display_name": "Kallol", "link": "https://stackoverflow.com/users/495600/kallol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 253, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475505631, "creation_date": 1475505631, "question_id": 39834259, "link": "https://stackoverflow.com/questions/39834259/memory-going-high-while-writing-data-to-file-in-golang", "title": "Memory going high while writing data to file in golang", "body": "<p>Use case:</p>\n\n<ol>\n<li>Read the content from a table in Postgres</li>\n<li>Process the row Write to a file</li>\n<li>Write the content to a file</li>\n</ol>\n\n<p>So I have used postgres/sql to read the rows from the table and buffered writer to write the processed row to file. I have also taken care to make sure to flush the buffer at the end of each row so that I can keep control of the memory. But still I can see the memory going as high as 1.5 GB while processing close to 200000 rows.</p>\n\n<p>The code snippet is as below:</p>\n\n<pre><code>    r, e := c.Query(\"select * from tab1\")\n    if e != nil {\n            fmt.Println(\"Error while query\", e.Error())\n    }\n    c.Close()\n    //file is the filehandler for the output file\n    fileWriter := bufio.NewWriter(file)\n    for r.Next() {\n            var res *StatsData = &amp;StatsData{}\n            e = sqlstruct.Scan(res, r)\n            if e != nil {\n                    fmt.Println(\"Failed to scan\", e.Error())\n                    continue\n            }\n            dt := p.CalculateData(*res)\n            fileWriter.Write([]byte(dt))\n            fileWriter.Flush()\n            res = nil\n    }\n    r.Close()\n    file.Close()\n</code></pre>\n\n<p>I expected that since I am flushing the fileWriter at the end of each loop, the buffer will be flushed to the underlying writer which will write the data to the file. Hence the memory usage will be almost constant throughout the operation. </p>\n\n<p>Where am I wrong in my understanding? What can I do more to make sure that the memory can be kept under control?</p>\n"}, {"tags": ["go", "naming-conventions", "acronym"], "comments": [{"owner": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "edited": false, "score": 0, "creation_date": 1475493050, "post_id": 39830166, "comment_id": 66949972, "body": "Why wouldn&#39;t you use underscores? <code>MPEG_DASH_STREAM</code>"}, {"owner": {"reputation": 1041, "user_id": 2772588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b6fb04e8ecf4cae2da6d45b813f7829c?s=128&d=identicon&r=PG", "display_name": "ababo", "link": "https://stackoverflow.com/users/2772588/ababo"}, "reply_to_user": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "edited": false, "score": 0, "creation_date": 1475493153, "post_id": 39830166, "comment_id": 66950029, "body": "That&#39;s logical, but I doubt it&#39;s recommended."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1475494385, "post_id": 39830166, "comment_id": 66950720, "body": "I don&#39;t think there is a way to make them more readable without breaking the code style. I&#39;d suggest sticking to want you have, and maybe take icza&#39;s advice and put <code>Stream</code> in front of constants."}, {"owner": {"reputation": 21605, "user_id": 1142167, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/f9MAS.jpg?s=128&g=1", "display_name": "Joel Cornett", "link": "https://stackoverflow.com/users/1142167/joel-cornett"}, "edited": false, "score": 0, "creation_date": 1544585189, "post_id": 39830166, "comment_id": 94324460, "body": "My advice: readability is more important than dogmatic adherence to a particular code style. In this case something like <code>MpegDASHStream</code> or <code>MPEGDashStream</code> seems like an acceptable compromise."}], "answers": [{"comments": [{"owner": {"reputation": 1041, "user_id": 2772588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b6fb04e8ecf4cae2da6d45b813f7829c?s=128&d=identicon&r=PG", "display_name": "ababo", "link": "https://stackoverflow.com/users/2772588/ababo"}, "edited": false, "score": 14, "creation_date": 1475493474, "post_id": 39830270, "comment_id": 66950207, "body": "Yes, but what about sequenced acronyms? They make them quite unreadable."}, {"owner": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "edited": false, "score": 0, "creation_date": 1475493502, "post_id": 39830270, "comment_id": 66950224, "body": "I like this better! The effective go webpage also says this:"}, {"owner": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "edited": false, "score": 0, "creation_date": 1475493522, "post_id": 39830270, "comment_id": 66950238, "body": "&quot;MixedCaps  Finally, the convention in Go is to use MixedCaps or mixedCaps rather than underscores to write multiword names.&quot;"}, {"owner": {"reputation": 1041, "user_id": 2772588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b6fb04e8ecf4cae2da6d45b813f7829c?s=128&d=identicon&r=PG", "display_name": "ababo", "link": "https://stackoverflow.com/users/2772588/ababo"}, "edited": false, "score": 7, "creation_date": 1475493688, "post_id": 39830270, "comment_id": 66950339, "body": "MixedCaps is OK, but the rule about uppercasing acronyms can produce unreadable sequences without visual separation."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 8, "last_activity_date": 1475495824, "last_edit_date": 1592644375, "creation_date": 1475493236, "answer_id": 39830270, "question_id": 39830166, "link": "https://stackoverflow.com/questions/39830166/glued-acronyms-and-golang-naming-convention/39830270#39830270", "title": "Glued acronyms and golang naming convention", "body": "<p>Go's naming convention prefers MixedCaps rather than underscores, so don't use them. Source: <a href=\"https://golang.org/doc/effective_go.html#mixed-caps\" rel=\"noreferrer\">Effective Go: MixedCaps</a></p>\n<p>Usually when you have constants for different values of an entity, a more easily readable way is to start constant names with the entity, which is then followed by the name of the concrete value. Great examples are the <a href=\"https://golang.org/pkg/net/http/\" rel=\"noreferrer\"><code>net/http</code></a> package:</p>\n<pre><code>const (\n    MethodGet  = &quot;GET&quot;\n    MethodHead = &quot;HEAD&quot;\n    MethodPost = &quot;POST&quot;\n    // ...\n)\n\nconst (\n    StatusContinue           = 100 // RFC 7231, 6.2.1\n    StatusSwitchingProtocols = 101 // RFC 7231, 6.2.2\n    StatusProcessing         = 102 // RFC 2518, 10.1\n\n    StatusOK                 = 200 // RFC 7231, 6.3.1\n    StatusCreated            = 201 // RFC 7231, 6.3.2\n    // ...\n)\n</code></pre>\n<p>Also you don't need to repeat the expression with <code>iota</code> identifier. <a href=\"https://golang.org/ref/spec#Constant_declarations\" rel=\"noreferrer\">Spec: Constant declarations:</a></p>\n<blockquote>\n<p>Within a parenthesized <code>const</code> declaration list the expression list may be omitted from any but the first declaration. Such an empty list is equivalent to the textual substitution of the first preceding non-empty expression list and its type if any. Omitting the list of expressions is therefore equivalent to repeating the previous list.</p>\n</blockquote>\n<p>So in your case it could simply look like this, which is quite clear and readable:</p>\n<pre><code>// stream types\nconst (\n    StreamMPEGDASH = iota\n    StreamHLS\n    StreamMPEGTSUDP\n    StreamMPEGTSRTP\n)\n</code></pre>\n<p>Also see <a href=\"https://github.com/golang/go/wiki/CodeReviewComments\" rel=\"noreferrer\">Go Code Review Comments</a> for more details. Acronyms can be found in the <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#initialisms\" rel=\"noreferrer\">Initialisms</a> section:</p>\n<blockquote>\n<p>Words in names that are initialisms or acronyms (e.g. &quot;URL&quot; or &quot;NATO&quot;) have a consistent case. For example, &quot;URL&quot; should appear as &quot;URL&quot; or &quot;url&quot; (as in &quot;urlPony&quot;, or &quot;URLPony&quot;), never as &quot;Url&quot;. Here's an example: ServeHTTP not ServeHttp.</p>\n<p>This rule also applies to &quot;ID&quot; when it is short for &quot;identifier,&quot; so write &quot;appID&quot; instead of &quot;appId&quot;.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 486, "user_id": 2672500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dcfdcfde8c781ab3be905da858d01d9?s=128&d=identicon&r=PG", "display_name": "Jean Spector", "link": "https://stackoverflow.com/users/2672500/jean-spector"}, "is_accepted": false, "score": 5, "last_activity_date": 1597139639, "creation_date": 1597139639, "answer_id": 63355758, "question_id": 39830166, "link": "https://stackoverflow.com/questions/39830166/glued-acronyms-and-golang-naming-convention/63355758#63355758", "title": "Glued acronyms and golang naming convention", "body": "<p>What you do is the canonical Golang way.</p>\n<p>According to <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#initialisms\" rel=\"noreferrer\">Code Review Comments</a>, you should string the acronyms in <code>ALLCAPS</code>:</p>\n<blockquote>\n<p>Words in names that are initialisms or acronyms (e.g. &quot;URL&quot; or &quot;NATO&quot;) have a consistent case. For example, &quot;URL&quot; should appear as &quot;URL&quot; or &quot;url&quot; (as in &quot;urlPony&quot;, or &quot;URLPony&quot;), never as &quot;Url&quot;. As an example: ServeHTTP not ServeHttp. For identifiers with multiple initialized &quot;words&quot;, use for example &quot;xmlHTTPRequest&quot; or &quot;XMLHTTPRequest&quot;.</p>\n</blockquote>\n<p>Do I like it? Not so much.</p>\n<p>You could move the words around a bit to make it more readable, e.g. <code>MPEGStreamDASH</code></p>\n<p>If you really hate it - then you need to realize it's your code and you can do whatever you like - be it <code>MpegDashStream</code>, <code>MPEG_DASH_Stream</code> or even <code>MpEg_DaSh_StreaM</code> - but that would be evil ;-)</p>\n"}], "owner": {"reputation": 1041, "user_id": 2772588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b6fb04e8ecf4cae2da6d45b813f7829c?s=128&d=identicon&r=PG", "display_name": "ababo", "link": "https://stackoverflow.com/users/2772588/ababo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7151, "favorite_count": 1, "answer_count": 2, "score": 12, "last_activity_date": 1597139639, "creation_date": 1475492875, "question_id": 39830166, "link": "https://stackoverflow.com/questions/39830166/glued-acronyms-and-golang-naming-convention", "title": "Glued acronyms and golang naming convention", "body": "<p>Is there a way to make the constants below to be more readable without breaking golang naming convention?</p>\n\n<pre><code>const ( // stream types\n    MPEGDASHStream  = iota\n    HLSStream       = iota\n    MPEGTSUDPStream = iota\n    MPEGTSRTPStream = iota\n)\n</code></pre>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1475543820, "post_id": 39829663, "comment_id": 66975097, "body": "See <a href=\"http://stackoverflow.com/a/31742265/1705598\">Golang: format a string without printing?</a>"}, {"owner": {"reputation": 2138, "user_id": 208928, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/750d9308974f986f174f94947adaeec2?s=128&d=identicon&r=PG", "display_name": "Sairam", "link": "https://stackoverflow.com/users/208928/sairam"}, "edited": false, "score": 0, "creation_date": 1475777831, "post_id": 39829663, "comment_id": 67091427, "body": "Would a template fit better here? <a href=\"https://golang.org/pkg/text/template/#example_Template\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template/#example_Template</a>"}, {"owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "edited": false, "score": 0, "creation_date": 1595875173, "post_id": 39829663, "comment_id": 111620093, "body": "If you&#39;re handling HTML, though, you should consider using a <a href=\"https://godoc.org/honnef.co/go/js/dom\" rel=\"nofollow noreferrer\">DOM</a> so that way the opening/closing tags, attributes, etc. are all <i>automatically</i> correct."}], "answers": [{"comments": [{"owner": {"reputation": 306, "user_id": 4144399, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100003597293998/picture?type=large", "display_name": "Ali", "link": "https://stackoverflow.com/users/4144399/ali"}, "edited": false, "score": 0, "creation_date": 1475492005, "post_id": 39829727, "comment_id": 66949417, "body": "it work for simple string.what about array of string ? my input is array of string."}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 306, "user_id": 4144399, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100003597293998/picture?type=large", "display_name": "Ali", "link": "https://stackoverflow.com/users/4144399/ali"}, "edited": false, "score": 0, "creation_date": 1475492115, "post_id": 39829727, "comment_id": 66949464, "body": "You can just loop over the array doing above modification in the loop body."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 15, "last_activity_date": 1475491402, "creation_date": 1475491402, "answer_id": 39829727, "question_id": 39829663, "link": "https://stackoverflow.com/questions/39829663/how-to-insert-a-string-inside-another-string-using-go-lang/39829727#39829727", "title": "How to insert a string inside another string using Go lang", "body": "<p>You can simply use slice operations on the string:</p>\n\n<p>package main</p>\n\n<pre><code>func main() {\n    p := \"green\"\n    index := 2\n    q := p[:index] + \"HI\" + p[index:]\n    fmt.Println(p, q)\n}\n</code></pre>\n\n<p>Working example: <a href=\"https://play.golang.org/p/01phuBKuBB\" rel=\"noreferrer\">https://play.golang.org/p/01phuBKuBB</a></p>\n"}, {"tags": [], "owner": {"reputation": 2776, "user_id": 1987437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/508e14a7e9414311eff04b2fd8d20ed6?s=128&d=identicon&r=PG", "display_name": "Liam Kelly", "link": "https://stackoverflow.com/users/1987437/liam-kelly"}, "is_accepted": false, "score": 2, "last_activity_date": 1475499690, "creation_date": 1475499690, "answer_id": 39832325, "question_id": 39829663, "link": "https://stackoverflow.com/questions/39829663/how-to-insert-a-string-inside-another-string-using-go-lang/39832325#39832325", "title": "How to insert a string inside another string using Go lang", "body": "<p>You could turn the first string into a template for Sprintf. It would look like this:</p>\n\n<pre><code>p := \"&lt;/table&gt;%s&lt;/body&gt;&lt;/html&gt;\"\nout := fmt.Sprintf(p,\"&lt;pagebreak /&gt;\")\n</code></pre>\n\n<p>Working code here: <a href=\"https://play.golang.org/p/AInfyQwpy2\" rel=\"nofollow\">https://play.golang.org/p/AInfyQwpy2</a></p>\n"}, {"tags": [], "owner": {"reputation": 109, "user_id": 4250322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5afba80b1f22e48449b27a935247edbc?s=128&d=identicon&r=PG&f=1", "display_name": "Amogh Antarkar", "link": "https://stackoverflow.com/users/4250322/amogh-antarkar"}, "is_accepted": false, "score": 0, "last_activity_date": 1551718564, "last_edit_date": 1551718564, "creation_date": 1551595434, "answer_id": 54966277, "question_id": 39829663, "link": "https://stackoverflow.com/questions/39829663/how-to-insert-a-string-inside-another-string-using-go-lang/54966277#54966277", "title": "How to insert a string inside another string using Go lang", "body": "<p>I had used <code>rune</code> and <code>bytes.Buffer</code> to insert <code>&lt;\\b&gt;</code> bold tags at between two indexes and build a result string as below. </p>\n\n<pre><code>for j:=0; j&lt; len(resultstrIntervals);j++{\n\n        startIndex:= resultstrIntervals[j].Start\n        endIndex:= resultstrIntervals[j].End\n\n        for i &lt;= endIndex &amp;&amp; i &lt;= len(s) {\n\n            if i == startIndex{\n                buffer.WriteRune('&lt;')\n                buffer.WriteRune('b')\n                buffer.WriteRune('&gt;')\n\n\n            }else if i == endIndex{\n\n                buffer.WriteRune('&lt;')\n                buffer.WriteRune('/')\n                buffer.WriteRune('b')\n                buffer.WriteRune('&gt;')\n\n            }\n            if i &lt; len(strArr){\n                buffer.WriteRune(strArr[i])\n            }\n            i++\n\n        }\n\n    }\n    fmt.Print(buffer.String())\n</code></pre>\n\n<p><a href=\"https://github.com/amoghantarkar/GoProject/blob/master/AddBoldToString.go\" rel=\"nofollow noreferrer\">example</a></p>\n"}], "owner": {"reputation": 306, "user_id": 4144399, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/100003597293998/picture?type=large", "display_name": "Ali", "link": "https://stackoverflow.com/users/4144399/ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13303, "favorite_count": 1, "accepted_answer_id": 39829727, "answer_count": 3, "score": 8, "last_activity_date": 1551718564, "creation_date": 1475491177, "question_id": 39829663, "link": "https://stackoverflow.com/questions/39829663/how-to-insert-a-string-inside-another-string-using-go-lang", "title": "How to insert a string inside another string using Go lang", "body": "<p>Most programming languages have a function that allows us to insert one string into another string. For example, I can take the string Green and the string HI, and perform an operation Green.insert(HI,2) to get the resulatant string GrHIeen. But such a function does not come with the standard GO lang library.</p>\n\n<p>Is there any Golang function which I can use to insert a string inside an string?</p>\n\n<p>For example</p>\n\n<pre><code>string = \"&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;\"\n\n// I want Following Output\n\nstring = \"&lt;/table&gt;&lt;pagebreak /&gt;&lt;/body&gt;&lt;/html&gt;\"\n</code></pre>\n"}, {"tags": ["node.js", "git", "go", "deployment"], "answers": [{"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 2, "last_activity_date": 1475483985, "creation_date": 1475483985, "answer_id": 39827524, "question_id": 39827246, "link": "https://stackoverflow.com/questions/39827246/repeatable-installs-of-a-go-application/39827524#39827524", "title": "Repeatable installs of a Go application?", "body": "<p>First of all, you're indeed thinking like a JS developer. Go is compiled, and thus the proper way to deploy a Go app is not to use the source code at all - you build it on your build server, and deploy a binary. So on the server level you simply don't care anymore, the only place where you need dependencies is the build system.</p>\n\n<p>Now, the standard way to do this in go is to <em>vendor</em> dependencies with your source, that is make sure they are included in the git repo. Another approach is the express them in a manifest file and fetch them with an external tool. These are both more reliable than the naive approach, of simply using <code>go get</code> in build time, fetching the current version of your dependencies (this requires no manifest file).</p>\n\n<p>There are many tools for vendoring management, to name two: <a href=\"https://github.com/tools/godep\" rel=\"nofollow noreferrer\">Godep</a> and <a href=\"http://dave.cheney.net/2016/06/26/automatically-fetch-your-projects-dependencies-with-gb\" rel=\"nofollow noreferrer\">gb</a></p>\n"}], "owner": {"reputation": 42794, "user_id": 135829, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/zfWZK.jpg?s=128&g=1", "display_name": "Sergei Basharov", "link": "https://stackoverflow.com/users/135829/sergei-basharov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 39827524, "answer_count": 1, "score": 0, "last_activity_date": 1475483985, "creation_date": 1475482837, "question_id": 39827246, "link": "https://stackoverflow.com/questions/39827246/repeatable-installs-of-a-go-application", "title": "Repeatable installs of a Go application?", "body": "<p>I am from the NodeJS/JavaScript world where I have <code>npm</code> and dependencies written down in the <code>package.json</code>. When I deploy it, I know that I just need to run <code>npm install</code> and all the dependencies consumed by the app will be installed.</p>\n\n<p>How is it supposed to be done for a Go project? Suppose I have a source code of the app which I deploy remotely by, say, running <code>git pull</code>. Now, how do I make sure the dependencies are present? What I see is I need to install a package manager manually then install dependencies using it?</p>\n\n<p>What's a standard way of deploying a Go app on a server?</p>\n"}, {"tags": ["go", "docker", "dns", "kubernetes", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475506952, "post_id": 39827099, "comment_id": 66958830, "body": "That Go issue isn&#39;t related, and was also fixed 2 years ago, so I&#39;m not sure why you&#39;re dropping it in here. <code>GODEBUG=netdns</code> is a runtime option, not a compile time option, so it has no effect here. The net package works fine without cgo, what issues are you having without it? If you did need cgo for other operations, you use the <code>netgo</code> tag to build without the cgo resolver."}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475507325, "post_id": 39827099, "comment_id": 66959055, "body": "@JimB Only thing that I am sure is that net.LookupHost return empty for my service  hostname and returns actual ips for let&#39;s say google.com."}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475507405, "post_id": 39827099, "comment_id": 66959113, "body": "I need to disable cgo to cross compile from OS X to scratch/alpine. Ain&#39;t that right?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475507673, "post_id": 39827099, "comment_id": 66959282, "body": "OK I think I see what&#39;s going on, you&#39;re conflating a bunch of details here. Yes, you need to disable cgo to cross compile (well, not strictly speaking, but creating a cross-compiling toolchain is not a simple task). If you want to use the host resolver, you need to link to be able to link to the host resolver, hence you need to build on Alpine or something using the same libc. Since you&#39;re using docker, you shouldn&#39;t need to cross compile at all; build the binary in a container matching the target."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475507678, "post_id": 39827099, "comment_id": 66959286, "body": "Since the DNS appears to be broken in some way, you may also need to set <code>GODEBUG=netdns=cgo</code> in the final container to force the use of the host resolver."}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475508670, "post_id": 39827099, "comment_id": 66959908, "body": "So I would have two dockerfiles. One with golang:alpine that would compile and output a binarie. And then Add to the scratch image? Do you got any reference on that workflow? @JimB"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475509603, "post_id": 39827099, "comment_id": 66960514, "body": "No references handy, but that&#39;s the basic idea. I prefer to have the build container output the tarball for the docker build context directly to stdout for the next stage, but you could send only the binary to stdout and COPY it yourself, or even just put any build artifacts in a mounted volume. As for the DNS not resolving to what you expect, I would ask about that behavior in a more kubernetes specific forum, as the Go resolver seems to be working as intended."}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475516049, "post_id": 39827099, "comment_id": 66964027, "body": "@JimB It is a go 1.7 issue. They took off .local away from dns resolution on 1.7.  <a href=\"https://github.com/golang/go/issues/16739\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/16739</a> Seems like its fixed on 1.7.1"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475517304, "post_id": 39827099, "comment_id": 66964656, "body": "That makes sense. I was assuming you were on go1.7.1"}], "owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1240, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1475482254, "creation_date": 1475482254, "question_id": 39827099, "link": "https://stackoverflow.com/questions/39827099/golang-dns-without-cgo-on-a-kubernetes-cluster", "title": "Golang DNS without CGO on a Kubernetes Cluster", "body": "<p>I got a api written in Golang and deployed in a Kubernetes cluster.\nMeaning it runs inside a docker container with the scratch image.\nTo compile to a light image like scratch/alpine I need to turn off cgo.\nBut the net package does not work well without cgo. I know there is an issue with the net package because itself uses cgo.</p>\n\n<p>All the services I need to use for this app are on another Kubernetes namespace, so the only way go get to it is using DNS. I am in a corner here.</p>\n\n<p>I build the binaries with something like this</p>\n\n<pre><code>GOOS='linux' CGO_ENABLED=0 GODEBUG=netdns=go+1 go build -a -installsuffix cgo -ldflags -s -o ./dist/prod/api ./src/backend/api.go\n</code></pre>\n\n<p>Which by itself does not resolve the issue, but as stated <a href=\"https://github.com/golang/go/issues/4714\" rel=\"nofollow\">here</a> by <a href=\"https://github.com/bradfitz\" rel=\"nofollow\">Brad Fitzpatrick</a> from the go team, there is a hackaround it. Which I finally got it to work like </p>\n\n<pre><code>//Connect is a function that connects to MOngoDB\nfunc Connect() (*mgo.Session, error) {\n    var host string\n    if os.Getenv(\"KUBERNETES\") == \"true\" {\n        cmd := exec.Command(\"ping\", \"-c\", \"1\", viper.GetString(\"MONGO-HOST\"))\n        var out bytes.Buffer\n        cmd.Stdout = &amp;out\n        _ = cmd.Run()\n        match := regexp.MustCompile(`\\(([^\\)]+)\\)`).FindStringSubmatch(out.String())\n        host = match[1]\n    } else {\n        host = viper.GetString(\"MONGO-HOST\")\n    }\n\n    inf := &amp;mgo.DialInfo{\n        Addrs:    []string{host + \":\" + viper.GetString(\"MONGO-PORT\")},\n        Timeout:  5 * time.Second,\n        Database: \"admin\",\n        Username: viper.GetString(\"MONGO-USER\"),\n        Password: viper.GetString(\"MONGO-PASS\"),\n    }\n    return mgo.DialWithInfo(inf)\n}\n</code></pre>\n\n<p>It just cuts the output of a ping command and use the resolved ip instead of the hostname to avoid the issue with dns. But it adds an extra complexity that my app should not be handling. How can I make better?</p>\n"}, {"tags": ["rest", "go"], "comments": [{"owner": {"reputation": 2979, "user_id": 1053931, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mp3h1.jpg?s=128&g=1", "display_name": "evgeny.myasishchev", "link": "https://stackoverflow.com/users/1053931/evgeny-myasishchev"}, "edited": false, "score": 0, "creation_date": 1520834794, "post_id": 39826703, "comment_id": 85461438, "body": "Same issue for me. I think major thing is that binding/validation is coupled with a model. Better option could be to have it done per route, but with gin it&#39;s not easily possible."}, {"owner": {"reputation": 65, "user_id": 363135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04ed63c62481a69061239f932df4a5fe?s=128&d=identicon&r=PG", "display_name": "markos", "link": "https://stackoverflow.com/users/363135/markos"}, "edited": false, "score": 0, "creation_date": 1529524514, "post_id": 39826703, "comment_id": 88909631, "body": "Were you able to find a solution?"}], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 2, "last_activity_date": 1533497329, "creation_date": 1533497329, "answer_id": 51697584, "question_id": 39826703, "link": "https://stackoverflow.com/questions/39826703/c-bindjson-with-optional-parameters/51697584#51697584", "title": "c.BindJSON with optional parameters", "body": "<p>Just found that question unanswered.</p>\n\n<p>So you want to bind all parameters and minimal one is required</p>\n\n<blockquote>\n  <p>How can make binding to all parameters but not all together.</p>\n</blockquote>\n\n<p>You almost answered your question here:</p>\n\n<blockquote>\n  <p>If I remove binding:\"required\" from all fields it always matches</p>\n</blockquote>\n\n<p>So I would remove the required and check every value.</p>\n\n<pre><code>var json Person\nif err := c.BindJSON(&amp;json); err != nil {\n        // error handling here\n        // something went wrong\n    }\n    if json.Name == \"\" &amp;&amp; json.Account == \"\" &amp;&amp; json.PrimaryOwner  == \"\" {\n        // no key is given... \n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2538, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1533497329, "creation_date": 1475480761, "last_edit_date": 1475487304, "question_id": 39826703, "link": "https://stackoverflow.com/questions/39826703/c-bindjson-with-optional-parameters", "title": "c.BindJSON with optional parameters", "body": "<p>I am using go-gin and trying to implement a PATCH API. 3 fields are editable so I have a struct defined like this </p>\n\n<pre><code>type Person struct {\n    Name         string  `form:\"name\" json:\"name\" binding:\"required\"`\n    Account      string  `form:\"account\" json:\"account\" binding:\"required\"`\n    PrimaryOwner string  `form:\"primary_owner\" json:\"primary_owner\" binding:\"required\"`\n}\n</code></pre>\n\n<p>I am trying to bind json like this:</p>\n\n<pre><code>var json Person\nif c.BindJSON(&amp;json) == nil {\n        fmt.Println(\"json matched!!!!!!!\")\n    }else {\n        fmt.Println(\"json not matched!!!!!!!\")\n}\n</code></pre>\n\n<p>Problem is it tries to bind all the parameters. If I give all parameters it gets matched but even if one parameter is missing it goes in else block. In patch API I don't want compulsary binding. If I remove <code>binding:\"required\"</code> from all fields it always matches, even if I give some key like <code>sdfsdfsdf</code>. How can make binding to all parameters but not all together. The keys in json request body should be verified but all keys should not be required at the same time.</p>\n"}, {"tags": ["go", "channel"], "answers": [{"comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 3, "creation_date": 1481647884, "post_id": 39826883, "comment_id": 69456692, "body": "I love this answer, especially the bit about using time.After(time.Second). I didn&#39;t know that could be done."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 46, "last_activity_date": 1601151040, "last_edit_date": 1601151040, "creation_date": 1475481401, "answer_id": 39826883, "question_id": 39826692, "link": "https://stackoverflow.com/questions/39826692/what-are-channels-used-for/39826883#39826883", "title": "What are channels used for?", "body": "<p>I think the spec is pretty clear on this. <a href=\"https://golang.org/ref/spec#Channel_types\" rel=\"nofollow noreferrer\">Spec: Channel types:</a></p>\n<blockquote>\n<p>A channel provides a mechanism for <a href=\"https://golang.org/ref/spec#Go_statements\" rel=\"nofollow noreferrer\">concurrently executing functions</a> to communicate by <a href=\"https://golang.org/ref/spec#Send_statements\" rel=\"nofollow noreferrer\">sending</a> and <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">receiving</a> values of a specified element type.</p>\n</blockquote>\n<p>When you have multiple goroutines which are executed concurrently, channels provide the easiest way to allow the goroutines to communicate with each other.</p>\n<p>One way for communication would be via a &quot;shared&quot; variable which is visible to both goroutines, but that would require proper locking / synchronized access.</p>\n<p>Instead, Go favors channels. Quoting from <a href=\"https://golang.org/doc/effective_go.html#sharing\" rel=\"nofollow noreferrer\">Effective Go: Share by communicating</a>:</p>\n<blockquote>\n<p>Do not communicate by sharing memory; instead, share memory by communicating.</p>\n</blockquote>\n<p>So instead of putting messages into a shared slice for example, you can create a channel (visible to both goroutines), and without any external synchronization / locking, one goroutine can send messages (values) via the channel, and the other goroutine can receive them.</p>\n<blockquote>\n<p>Only one goroutine has access to the value at any given time. Data races cannot occur, by design.</p>\n</blockquote>\n<p>So in fact, any number of goroutines can send values on the same channel, and any number of goroutines can receive values from it, still without any further synchronization. See related question for more details: <a href=\"https://stackoverflow.com/questions/34039229/if-i-am-using-channels-properly-should-i-need-to-use-mutexes\">If I am using channels properly should I need to use mutexes?</a></p>\n<h3>Channel example</h3>\n<p>Let's see an example where we start 2 additional goroutines for concurrent computation purposes. We pass a number to the first, which adds 1 to it, and delivers the result on a 2nd channel. The 2nd goroutine will receive a number, multiply it by 10 and deliver it to the result channel:</p>\n<pre><code>func AddOne(ch chan&lt;- int, i int) {\n    i++\n    ch &lt;- i\n}\n\nfunc MulBy10(ch &lt;-chan int, resch chan&lt;- int) {\n    i := &lt;-ch\n    i *= 10\n    resch &lt;- i\n}\n</code></pre>\n<p>This is how it can be called / used:</p>\n<pre><code>func main() {\n    ch := make(chan int)\n    resch := make(chan int)\n\n    go AddOne(ch, 9)\n    go MulBy10(ch, resch)\n\n    result := &lt;-resch\n    fmt.Println(&quot;Result:&quot;, result)\n}\n</code></pre>\n<p>Communicating via channels also takes care of goroutines waiting for each other. In this example it means <code>MulBy10()</code> will wait until <code>AddOne()</code> delivers the incremented number, and <code>main()</code> will wait for <code>MulBy10()</code> before printing the result. Output as expected (try it on the <a href=\"https://play.golang.org/p/RuTvpkee4v\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>Result: 100\n</code></pre>\n<h3>Language support</h3>\n<p>There are a number of language constructs which are for easy use of channels, for example:</p>\n<ul>\n<li>The <code>for ... range</code> on a channel loops over values received from a channel, until the channel is closed.</li>\n<li>The <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\"><code>select</code></a> statement can be used to list multiple channel operations such as <em>send on a channel</em> and <em>receive from a channel</em>, and the one that can proceed without blocking will be selected (randomly if there are multiple ones that can proceed; and will block if none is ready).</li>\n<li>There is a special form of the receive operator which allows you to check if the channel was closed (besides receiving a value): <code>v, ok := &lt;-ch</code></li>\n<li>The builtin <a href=\"https://golang.org/pkg/builtin/#len\" rel=\"nofollow noreferrer\"><code>len()</code></a> function tells the number of elements queued (unread); the builting <a href=\"https://golang.org/pkg/builtin/#cap\" rel=\"nofollow noreferrer\"><code>cap()</code></a> function returns the channel buffer capacity.</li>\n</ul>\n<h3>Other uses</h3>\n<p>For a more practical example, see how channels can be used to implement a <a href=\"https://stackoverflow.com/a/38172204/1705598\">worker pool</a>. A similar use is distributing values from a <a href=\"https://stackoverflow.com/a/34466755/1705598\">producer to consumer(s)</a>.</p>\n<p>Another practical example is to implement a <a href=\"https://stackoverflow.com/a/38506367/1705598\">memory pool using buffered channels</a>.</p>\n<p>And yet another practical example is <a href=\"https://stackoverflow.com/questions/36417199/how-to-broadcast-message-using-channel/49877632#49877632\">an elegant implementation of a broker</a>.</p>\n<p>A channel is often used to timeout some blocking operation, utilizing a channel returned by <a href=\"https://golang.org/pkg/time/#After\" rel=\"nofollow noreferrer\"><code>time.After()</code></a> which &quot;fires&quot; after the specified delay / duration (&quot;fires&quot; means a value will be sent on it). See this example for demonstration (try it on the <a href=\"https://play.golang.org/p/QHveRuk6OI\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>ch := make(chan int)\n\nselect {\ncase i := &lt;-ch:\n    fmt.Println(&quot;Received:&quot;, i)\ncase &lt;-time.After(time.Second):\n    fmt.Println(&quot;Timeout, no value received&quot;)\n}\n</code></pre>\n<p>It can be used to wait for a maximum time amount for some value, but if other goroutines cannot supply the value by that time, we may decide to do something else instead.</p>\n<p>Also a special form of communication may be just to signal completion of some operation (without actually sending any &quot;useful&quot; data). Such case may be implemented by a channel with any element type, e.g. <code>chan int</code>, and sending any value on it, e.g. <code>0</code>. But since the sent value holds no information, you may declare it like <code>chan struct{}</code>. Or even better, if you only need a one-time signalling, you may just close the channel which can be intercepted on the other side using <code>for ... range</code>, or receiving from it (as receiving from a closed channel proceeds immediately, yielding the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> of the element type). Also know that even though a channel may be used for this kind of signalling, there's a better alternative for this: <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a>.</p>\n<h3>Further reading</h3>\n<p>It's worth knowing about the channel axioms to avoid suprising behaviour: <a href=\"https://stackoverflow.com/questions/39015602/how-does-a-non-initialized-channel-behave\">How does a non initialized channel behave?</a></p>\n<p><a href=\"https://blog.golang.org/share-memory-by-communicating\" rel=\"nofollow noreferrer\">The Go Blog: Share Memory By Communicating</a></p>\n<p><a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">The Go Blog: Go Concurrency Patterns: Pipelines and cancellation</a></p>\n<p><a href=\"https://blog.golang.org/advanced-go-concurrency-patterns\" rel=\"nofollow noreferrer\">The Go Blog: Advanced Go Concurrency Patterns</a></p>\n<p><a href=\"https://www.ardanlabs.com/blog/2014/02/the-nature-of-channels-in-go.html\" rel=\"nofollow noreferrer\">Ardan labs: The Nature Of Channels In Go</a></p>\n"}, {"comments": [{"owner": {"reputation": 3168, "user_id": 5558126, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/222b3385ea809d92778c8d79a0498115?s=128&d=identicon&r=PG&f=1", "display_name": "Pim verleg", "link": "https://stackoverflow.com/users/5558126/pim-verleg"}, "edited": false, "score": 12, "creation_date": 1475506235, "post_id": 39831976, "comment_id": 66958351, "body": "I love the illustrations!"}, {"owner": {"reputation": 2698, "user_id": 855668, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5b065990b5c4608409ff9a81ffbfd7b2?s=128&d=identicon&r=PG", "display_name": "workdreamer", "link": "https://stackoverflow.com/users/855668/workdreamer"}, "edited": false, "score": 4, "creation_date": 1505288484, "post_id": 39831976, "comment_id": 79345428, "body": "This was a huge help! Thank you very much"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1566995270, "post_id": 39831976, "comment_id": 101829014, "body": "<i>&quot;order does not matter&quot;</i> \u2013 this is not true. The Go spec states that: <i>&quot;Channels act as first-in-first-out queues.&quot;</i>"}], "tags": [], "owner": {"reputation": 1157, "user_id": 5154802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZqLky3QxN2E/AAAAAAAAAAI/AAAAAAAAAEE/MyYiHfmqVe0/photo.jpg?sz=128", "display_name": "shivendra pratap singh", "link": "https://stackoverflow.com/users/5154802/shivendra-pratap-singh"}, "is_accepted": true, "score": 66, "last_activity_date": 1567156428, "last_edit_date": 1567156428, "creation_date": 1475498650, "answer_id": 39831976, "question_id": 39826692, "link": "https://stackoverflow.com/questions/39826692/what-are-channels-used-for/39831976#39831976", "title": "What are channels used for?", "body": "<p><strong>chan</strong> is a channel in Golang. In simple word you can think it as a box in which you put a item at one end and then pick it from other end.</p>\n\n<p><strong>Unbuffered Channels</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/Lq7ZG.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/Lq7ZG.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>Buffered Channel</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/kSx6w.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/kSx6w.png\" alt=\"enter image description here\"></a></p>\n\n<p>This is the small code I have written for you to understand channels. Now change order of go routines and see the outputs. Each time output may differ.</p>\n\n<pre><code>    package main\n\n    import (\n        \"fmt\"\n        \"time\"\n    )\n\n    func main() {\n        messages := make(chan int)\n        go func() {\n            time.Sleep(time.Second * 3)\n            messages &lt;- 1\n        }()\n        go func() {\n            time.Sleep(time.Second * 2)\n            messages &lt;- 2\n        }() \n        go func() {\n            time.Sleep(time.Second * 1)\n            messages &lt;- 3\n        }()\n        go func() {\n            for i := range messages {\n                fmt.Println(i)\n            }\n        }()\n        go func() {\n            time.Sleep(time.Second * 1)\n            messages &lt;- 4\n        }()\n        go func() {\n            time.Sleep(time.Second * 1)\n            messages &lt;- 5\n        }()\n        time.Sleep(time.Second * 5)\n    }\n</code></pre>\n\n<p>For best understanding visit this blog where go routines and channels are described in GUI. </p>\n\n<p>Visit <a href=\"http://divan.github.io/posts/go_concurrency_visualize/\" rel=\"noreferrer\">http://divan.github.io/posts/go_concurrency_visualize/</a> </p>\n"}, {"comments": [{"owner": {"reputation": 1669, "user_id": 12396017, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Nk8xz.png?s=128&g=1", "display_name": "Maxim Sagaydachny", "link": "https://stackoverflow.com/users/12396017/maxim-sagaydachny"}, "edited": false, "score": 0, "creation_date": 1582214252, "post_id": 60323659, "comment_id": 106708124, "body": "Welcome to StackOverflow! StackOverflow is designed to accumulate good questions along with good answers. Please edit your post and fix the link. You can see that 2 persons already provided great answers to this question. Why don&#39;t you make easy to understand explanation instead of sending people to the Internet? If you think you can provide superior answer (compared to existing 2 answers) then please extend your answer."}], "tags": [], "owner": {"reputation": 11, "user_id": 10690600, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-yKDJrTQdoMQ/AAAAAAAAAAI/AAAAAAAAUXA/8Imb6Z9BplI/photo.jpg?sz=128", "display_name": "Wasim Akram P.V", "link": "https://stackoverflow.com/users/10690600/wasim-akram-p-v"}, "is_accepted": false, "score": 1, "last_activity_date": 1582220046, "last_edit_date": 1582220046, "creation_date": 1582213446, "answer_id": 60323659, "question_id": 39826692, "link": "https://stackoverflow.com/questions/39826692/what-are-channels-used-for/60323659#60323659", "title": "What are channels used for?", "body": "<p>To better understand the concept of channels in Go, you can first learn about Go routines and then read the below link which clearly explains the concept of Channels in golang.</p>\n\n<p><a href=\"https://medium.com/rungo/anatomy-of-channels-in-go-concurrency-in-go-1ec336086adb\" rel=\"nofollow noreferrer\">https://medium.com/rungo/anatomy-of-channels-in-go-concurrency-in-go-1ec336086adb</a></p>\n\n<p>Please refer to this link to get a detailed idea of channels with the help of examples.</p>\n"}, {"tags": [], "owner": {"reputation": 7429, "user_id": 4811873, "user_type": "registered", "accept_rate": 6, "profile_image": "https://www.gravatar.com/avatar/2ef5bab087ac0b70e03e34b0b0009fd5?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Robinson", "link": "https://stackoverflow.com/users/4811873/mike-robinson"}, "is_accepted": false, "score": 1, "last_activity_date": 1582220254, "creation_date": 1582220254, "answer_id": 60325684, "question_id": 39826692, "link": "https://stackoverflow.com/questions/39826692/what-are-channels-used-for/60325684#60325684", "title": "What are channels used for?", "body": "<p>The concept is very similar to something that's been in Unix/Linux since the beginning:  <em>pipes.</em></p>\n\n<p>These are a reliable inter-process / inter-thread communication facility that is built-in to the language.  Very convenient.</p>\n"}], "owner": {"reputation": 3168, "user_id": 5558126, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/222b3385ea809d92778c8d79a0498115?s=128&d=identicon&r=PG&f=1", "display_name": "Pim verleg", "link": "https://stackoverflow.com/users/5558126/pim-verleg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12235, "favorite_count": 11, "accepted_answer_id": 39831976, "answer_count": 4, "score": 34, "last_activity_date": 1601151040, "creation_date": 1475480747, "last_edit_date": 1566996133, "question_id": 39826692, "link": "https://stackoverflow.com/questions/39826692/what-are-channels-used-for", "title": "What are channels used for?", "body": "<p>When looking through some Go code I found the following:</p>\n\n<pre><code>  ch := make(chan int)\n</code></pre>\n\n<p>I looked up in a online tutorial how Go Channels work:</p>\n\n<p><a href=\"https://tour.golang.org/concurrency/2\" rel=\"noreferrer\">https://tour.golang.org/concurrency/2</a></p>\n\n<p>But I find this example unclear.</p>\n\n<p>Can someone give me a easy explanation and an example of the use of channels?</p>\n"}, {"tags": ["go", "rabbitmq", "amqp"], "answers": [{"tags": [], "owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "is_accepted": true, "score": 1, "last_activity_date": 1475552010, "last_edit_date": 1475552010, "creation_date": 1475551292, "answer_id": 39843636, "question_id": 39825884, "link": "https://stackoverflow.com/questions/39825884/rabbitmq-pub-sub-implementation-not-working/39843636#39843636", "title": "RabbitMQ pub/sub implementation not working", "body": "<p>Some silly mistake here. When exchangeRecieve ends, the defer statments are triggered and hence closed the connections. That's why my rewrite fails.</p>\n\n<p>I've changed my code this way and it worked:</p>\n\n\n\n<pre><code>import (\n    \"fmt\"\n    \"os\"\n    \"testing\"\n    \"time\"\n\n    \"github.com/streadway/amqp\"\n)\n\nfunc TestDummy(t *testing.T) {\n    amqpURL := os.Getenv(\"CLOUDAMQP_URL\")\n    t.Logf(\"  [*] amqpURL: %s\", amqpURL)\n\n    results1 := exchangeReceive(t, \"consumer 1\", amqpURL)\n    results2 := exchangeReceive(t, \"consumer 2\", amqpURL)\n    time.Sleep(50 * time.Millisecond)\n\n    exchangeSend(t, amqpURL, \"Hello World\")\n    if want, have := \"Hello World\", &lt;-results1; want != have {\n        t.Errorf(\"expected %#v, got %#v\", want, have)\n    }\n    if want, have := \"Hello World\", &lt;-results2; want != have {\n        t.Errorf(\"expected %#v, got %#v\", want, have)\n    }\n}\n\nfunc exchangeReceive(t *testing.T, name, amqpURL string) &lt;-chan string {\n\n    out := make(chan string)\n\n    failOnError := func(err error, msg string) {\n        if err != nil {\n            t.Fatalf(\"%s: %s\", msg, err)\n            panic(fmt.Sprintf(\"%s: %s\", msg, err))\n        }\n    }\n\n    conn, err := amqp.Dial(amqpURL)\n    failOnError(err, \"Failed to connect to RabbitMQ\")\n\n    ch, err := conn.Channel()\n    failOnError(err, \"Failed to open a channel\")\n\n    err = ch.ExchangeDeclare(\n        \"logs\",   // name\n        \"fanout\", // type\n        true,     // durable\n        false,    // auto-deleted\n        false,    // internal\n        false,    // no-wait\n        nil,      // arguments\n    )\n    failOnError(err, \"Failed to declare an exchange\")\n\n    q, err := ch.QueueDeclare(\n        \"\",    // name\n        false, // durable\n        false, // delete when usused\n        true,  // exclusive\n        false, // no-wait\n        nil,   // arguments\n    )\n    failOnError(err, \"Failed to declare a queue\")\n\n    err = ch.QueueBind(\n        q.Name, // queue name\n        \"\",     // routing key\n        \"logs\", // exchange\n        false,\n        nil)\n    failOnError(err, \"Failed to bind a queue\")\n\n    msgs, err := ch.Consume(\n        q.Name, // queue\n        \"\",     // consumer\n        true,   // auto-ack\n        false,  // exclusive\n        false,  // no-local\n        false,  // no-wait\n        nil,    // args\n    )\n    failOnError(err, \"Failed to register a consumer\")\n\n    go func() {\n        for d := range msgs {\n            t.Logf(\"  [x] %s received: %s\", name, d.Body)\n            out &lt;- string(d.Body)\n        }\n    }()\n\n    t.Logf(\"  [*] %s ready to receive\", name)\n    return out\n}\n\nfunc exchangeSend(t *testing.T, amqpURL, msg string) {\n    failOnError := func(err error, msg string) {\n        if err != nil {\n            t.Fatalf(\"%s: %s\", msg, err)\n            panic(fmt.Sprintf(\"%s: %s\", msg, err))\n        }\n    }\n\n    conn, err := amqp.Dial(amqpURL)\n    failOnError(err, \"Failed to connect to RabbitMQ\")\n    defer conn.Close()\n\n    ch, err := conn.Channel()\n    failOnError(err, \"Failed to open a channel\")\n    defer ch.Close()\n\n    err = ch.ExchangeDeclare(\n        \"logs\",   // name\n        \"fanout\", // type\n        true,     // durable\n        false,    // auto-deleted\n        false,    // internal\n        false,    // no-wait\n        nil,      // arguments\n    )\n    failOnError(err, \"Failed to declare an exchange\")\n\n    body := []byte(msg)\n    err = ch.Publish(\n        \"logs\", // exchange\n        \"\",     // routing key\n        false,  // mandatory\n        false,  // immediate\n        amqp.Publishing{\n            ContentType: \"text/plain\",\n            Body:        []byte(body),\n        })\n    failOnError(err, \"Failed to publish a message\")\n\n    t.Logf(\" [x] Sent %s\", body)\n}\n</code></pre>\n"}], "owner": {"reputation": 6154, "user_id": 372172, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1e3e64f71bb0a748cffdf0baec8b95cb?s=128&d=identicon&r=PG", "display_name": "Koala Yeung", "link": "https://stackoverflow.com/users/372172/koala-yeung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 39843636, "answer_count": 1, "score": 1, "last_activity_date": 1475552010, "creation_date": 1475477283, "last_edit_date": 1475551217, "question_id": 39825884, "link": "https://stackoverflow.com/questions/39825884/rabbitmq-pub-sub-implementation-not-working", "title": "RabbitMQ pub/sub implementation not working", "body": "<p>I've converted the <a href=\"http://www.rabbitmq.com/tutorials/tutorial-three-go.html\" rel=\"nofollow\">RabbitMQ pub/sub tutorial</a> into the below dummy test. Somehow it is not working as expected.</p>\n\n<p><code>amqpURL</code> is a valid AMQP service (i.e. RabbitMQ) URL. I've tested it with the queue example and it works. Somehow it fails in \"exchange\"</p>\n\n<p>I'd expect TestDummy to log \" [x] Hello World\". Somehow it is not happening. Only the sending half is working as expected.</p>\n\n<p>What did I got wrong?</p>\n\n\n\n<pre><code>import (\n    \"fmt\"\n    \"log\"\n    \"testing\"\n\n    \"github.com/streadway/amqp\"\n)\n\nfunc TestDummy(t *testing.T) {\n    done := exchangeReceive()\n    exchangeSend(\"Hello World\")\n    &lt;-done\n}\n\nfunc exchangeSend(msg string) {\n    failOnError := func(err error, msg string) {\n        if err != nil {\n            log.Fatalf(\"%s: %s\", msg, err)\n            panic(fmt.Sprintf(\"%s: %s\", msg, err))\n        }\n    }\n\n    log.Printf(\"exchangeSend: connect %s\", amqpURL)\n    conn, err := amqp.Dial(amqpURL)\n    failOnError(err, \"Failed to connect to RabbitMQ\")\n    defer conn.Close()\n\n    ch, err := conn.Channel()\n    failOnError(err, \"Failed to open a channel\")\n    defer ch.Close()\n\n    err = ch.ExchangeDeclare(\n        \"logs\",   // name\n        \"fanout\", // type\n        true,     // durable\n        false,    // auto-deleted\n        false,    // internal\n        false,    // no-wait\n        nil,      // arguments\n    )\n    failOnError(err, \"Failed to declare an exchange\")\n\n    body := []byte(msg)\n    err = ch.Publish(\n        \"logs\", // exchange\n        \"\",     // routing key\n        false,  // mandatory\n        false,  // immediate\n        amqp.Publishing{\n            ContentType: \"text/plain\",\n            Body:        []byte(body),\n        })\n    failOnError(err, \"Failed to publish a message\")\n\n    log.Printf(\" [x] Sent %s\", body)\n}\n\nfunc exchangeReceive() &lt;-chan bool {\n\n    done := make(chan bool)\n\n    failOnError := func(err error, msg string) {\n        if err != nil {\n            log.Fatalf(\"%s: %s\", msg, err)\n            panic(fmt.Sprintf(\"%s: %s\", msg, err))\n        }\n    }\n\n    log.Printf(\"exchangeReceive: connect %s\", amqpURL)\n    conn, err := amqp.Dial(amqpURL)\n    failOnError(err, \"Failed to connect to RabbitMQ\")\n    defer conn.Close()\n\n    ch, err := conn.Channel()\n    failOnError(err, \"Failed to open a channel\")\n    defer ch.Close()\n\n    err = ch.ExchangeDeclare(\n        \"logs\",   // name\n        \"fanout\", // type\n        true,     // durable\n        false,    // auto-deleted\n        false,    // internal\n        false,    // no-wait\n        nil,      // arguments\n    )\n    failOnError(err, \"Failed to declare an exchange\")\n\n    q, err := ch.QueueDeclare(\n        \"\",    // name\n        false, // durable\n        false, // delete when usused\n        true,  // exclusive\n        false, // no-wait\n        nil,   // arguments\n    )\n    failOnError(err, \"Failed to declare a queue\")\n\n    err = ch.QueueBind(\n        q.Name, // queue name\n        \"\",     // routing key\n        \"logs\", // exchange\n        false,\n        nil)\n    failOnError(err, \"Failed to bind a queue\")\n\n    msgs, err := ch.Consume(\n        q.Name, // queue\n        \"\",     // consumer\n        true,   // auto-ack\n        false,  // exclusive\n        false,  // no-local\n        false,  // no-wait\n        nil,    // args\n    )\n    failOnError(err, \"Failed to register a consumer\")\n\n    go func() {\n        for d := range msgs {\n            log.Printf(\" [x] %s\", d.Body)\n            done &lt;- true\n        }\n    }()\n\n    log.Printf(\" [*] Waiting for logs. To exit press CTRL+C\")\n\n    return done\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "bson", "mgo"], "comments": [{"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1475477237, "post_id": 39825754, "comment_id": 66941754, "body": "i did go trough that question. but it is not give solution."}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1475477309, "post_id": 39825754, "comment_id": 66941779, "body": "db.collection.count({id=0}) this is only mongo shell command..I want to know do it using mgo package in golang."}, {"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1475477373, "post_id": 39825754, "comment_id": 66941808, "body": "That is the answer to your question as the <i>count</i> you use, didn&#39;t provide a boolean value, just an integer as a sum of records that match the condition. If your issue, from here, is just the go syntax have a look here: <a href=\"http://stackoverflow.com/questions/18721801/mgo-time-time-or-boolean-check\" title=\"mgo time time or boolean check\">stackoverflow.com/questions/18721801/&hellip;</a>"}, {"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1475477594, "post_id": 39825754, "comment_id": 66941918, "body": "do you mean <i>collection.Find(bson.M{&quot;id&quot;: 0}).Count()</i> ?"}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1475477810, "post_id": 39825754, "comment_id": 66942024, "body": "is that work? please wait for check it. thank you."}, {"owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1475478363, "post_id": 39825754, "comment_id": 66942296, "body": "it is works. thank you for support."}], "owner": {"reputation": 594, "user_id": 2303808, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cNIwW.jpg?s=128&g=1", "display_name": "Sandun Priyanka", "link": "https://stackoverflow.com/users/2303808/sandun-priyanka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 178, "favorite_count": 0, "closed_date": 1475478634, "answer_count": 0, "score": 0, "last_activity_date": 1475476644, "creation_date": 1475476644, "question_id": 39825754, "link": "https://stackoverflow.com/questions/39825754/check-object-value-exist-in-mongodb-document-in-golang-using-mgo-package", "closed_reason": "Duplicate", "title": "Check object value exist in mongodb document in golang using mgo package", "body": "<p>I need to check that <strong>object with FIELD value X</strong> already exists in mongo db using mgo package in golang. I already use $exists, that will find objects with FIELD no matter what its value. But I only need to know that object already is in db with value using <strong>mgo package in golang</strong>.</p>\n\n<p>I also use <code>db.collection.count({id=0})</code> in mongo shell. it give a boolean value as what i expected. but there is no method in <strong>mgo package(golang)</strong>. i want to know that representation using mgo package.</p>\n\n<pre><code>\"dbconfigs\": [\n    {\n      \"id\": 0,\n      \"default\": true,\n      \"widgets\": [\n        {\n          \"id\": 1,\n          \"position\": 1,\n          \"type\": 1,\n          \"class\": \"normal green\",\n          \"metric\": {\n            \"id\": 5,\n            \"name\": \"Total Downloads\",\n            \"category\": \"Usage Analytics\",\n            \"type\": 1,\n            \"api\": \"url2\",\n            \"templateurl\": \"\"\n          }\n        },\n        {\n          \"id\": 2,\n          \"position\": 2,\n          \"type\": 1,\n          \"class\": \"normal red\",\n          \"metric\": {\n            \"id\": 6,\n            \"name\": \"Total Uploads\",\n            \"category\": \"Usage Analytics\",\n            \"type\": 1,\n            \"api\": \"url1\",\n            \"templateurl\": \"\"\n          }\n        }\n]\n}]\n</code></pre>\n\n<p>according to the above example i want know wheather dbconfigs --> id = 0 is already exists or not as a boolean value.</p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 133, "user_id": 143984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99b157fb1dc31bdea65355047233fa0d?s=128&d=identicon&r=PG", "display_name": "jmason", "link": "https://stackoverflow.com/users/143984/jmason"}, "edited": false, "score": 0, "creation_date": 1475696524, "post_id": 39825671, "comment_id": 67051739, "body": "I haven&#39;t used gRPC yet myself but I will be soon and during my research I&#39;ve seen the server interface methods pass a <code>ctx context.Context</code> argument. I would like to assume this context will be cancelled if the connection with the client is closed. See <a href=\"http://www.grpc.io/docs/tutorials/basic/go.html\" rel=\"nofollow noreferrer\">Go gRPC Basics</a>"}, {"owner": {"reputation": 3889, "user_id": 100405, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/924e4500ab6bdce291ab6346099ede26?s=128&d=identicon&r=PG", "display_name": "weima", "link": "https://stackoverflow.com/users/100405/weima"}, "reply_to_user": {"reputation": 133, "user_id": 143984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99b157fb1dc31bdea65355047233fa0d?s=128&d=identicon&r=PG", "display_name": "jmason", "link": "https://stackoverflow.com/users/143984/jmason"}, "edited": false, "score": 0, "creation_date": 1475818928, "post_id": 39825671, "comment_id": 67104992, "body": "thanks for your comment!!. i have explored <code>ctx.Done()</code> option. this channel is closed per operation, on the same connection. thats not what i am looking for. i am looking for a channel to read connection closed event."}, {"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 0, "creation_date": 1523041982, "post_id": 39825671, "comment_id": 86412418, "body": "In our rpc app we periodically poll with time.Ticker, calling a status function, and if that returns a connection error we mark the worker as dead from the master side. Not sure if this is good enough for your use case."}], "answers": [{"comments": [{"owner": {"reputation": 2958, "user_id": 70535, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/800e63992b25e6d1cf824d45d98b8ccc?s=128&d=identicon&r=PG", "display_name": "codecraig", "link": "https://stackoverflow.com/users/70535/codecraig"}, "edited": false, "score": 8, "creation_date": 1576165638, "post_id": 51397938, "comment_id": 104818712, "body": "isn&#39;t your solution only for client-side? I thought the OP was asking how to know on the server-side."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 2, "last_activity_date": 1531904854, "creation_date": 1531904854, "answer_id": 51397938, "question_id": 39825671, "link": "https://stackoverflow.com/questions/39825671/grpc-go-how-to-know-in-server-side-when-client-closes-the-connection/51397938#51397938", "title": "grpc go : how to know in server side, when client closes the connection", "body": "<p>Assuming that the server is implemented in go, there's an API on the <code>*grpc.ClientConn</code> that reports state changes in the connection.</p>\n\n<pre><code>func (cc *ClientConn) WaitForStateChange(ctx context.Context, sourceState connectivity.State) bool\n</code></pre>\n\n<p><a href=\"https://godoc.org/google.golang.org/grpc#ClientConn.WaitForStateChange\" rel=\"nofollow noreferrer\">https://godoc.org/google.golang.org/grpc#ClientConn.WaitForStateChange</a></p>\n\n<p>These are the docs on each of the <code>connectivity.State</code></p>\n\n<p><a href=\"https://github.com/grpc/grpc/blob/master/doc/connectivity-semantics-and-api.md\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc/blob/master/doc/connectivity-semantics-and-api.md</a></p>\n\n<p>If you need to expose a channel that you can listen to for the client closing the connection then you could do something like this:</p>\n\n<pre><code>func connectionOnState(ctx context.Context, conn *grpc.ClientConn, states ...connectivity.State) &lt;-chan struct{} {\n    done := make(chan struct{})\n\n    go func() {\n        // any return from this func will close the channel\n        defer close(done)\n\n        // continue checking for state change \n        // until one of break states is found\n        for { \n            change := conn.WaitForStateChange(ctx, conn.GetState())\n            if !change {\n                // ctx is done, return\n                // something upstream is cancelling\n                return\n            }\n\n            currentState := conn.GetState()\n\n            for _, s := range states {\n                if currentState == s {\n                    // matches one of the states passed\n                    // return, closing the done channel\n                    return \n                }\n            }\n        }\n    }()\n\n    return done\n}\n</code></pre>\n\n<p>If you only want to consider connections that are shutting down or shutdown, then you could call it like so:</p>\n\n<pre><code>// any receives from shutdownCh will mean the state Shutdown\nshutdownCh := connectionOnState(ctx, conn, connectivity.Shutdown) \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1241, "user_id": 5113452, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-22iWoM7-su0/AAAAAAAAAAI/AAAAAAAABRc/-rv3aMq0L0I/photo.jpg?sz=128", "display_name": "Franci", "link": "https://stackoverflow.com/users/5113452/franci"}, "is_accepted": false, "score": 0, "last_activity_date": 1610471110, "last_edit_date": 1610471110, "creation_date": 1610470526, "answer_id": 65688401, "question_id": 39825671, "link": "https://stackoverflow.com/questions/39825671/grpc-go-how-to-know-in-server-side-when-client-closes-the-connection/65688401#65688401", "title": "grpc go : how to know in server side, when client closes the connection", "body": "<p>Based on your code, it's an unary rpc call, the client connect to server for only one time, send a request and get a response. The client will wait for the response until timeout.</p>\n<p>In server side streaming, you can get the client disconnect from</p>\n<pre><code>&lt;-grpc.ServerStream.Context.Done()\n</code></pre>\n<p>signal.</p>\n<p>With that above, you must implement your own channel in a go routine to build your logic. Use <code>select</code> statement as:</p>\n<pre><code>select {\n    case &lt;-srv.Context().Done():\n        return\n    case res := &lt;-&lt;YOUR OWN CHANNEL, WITH RECEIVED RESQUEST OR YOUR RESPONSE&gt;\n        ....\n}\n</code></pre>\n<p>In client streaming, besides the above signal, you can check whether the server can receive the msg:</p>\n<pre><code>req, err := grpc.ServerStream.Recv()\nif err == io.EOF {\n    break\n} else if err != nil {\n    return err\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 5761434, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LIPKBXYePIY/AAAAAAAAAAI/AAAAAAAAAFI/MKsQEoGdf34/photo.jpg?sz=128", "display_name": "\u866b\u5b50\u6a31\u6843", "link": "https://stackoverflow.com/users/5761434/%e8%99%ab%e5%ad%90%e6%a8%b1%e6%a1%83"}, "is_accepted": false, "score": 0, "last_activity_date": 1612320916, "creation_date": 1612320916, "answer_id": 66020582, "question_id": 39825671, "link": "https://stackoverflow.com/questions/39825671/grpc-go-how-to-know-in-server-side-when-client-closes-the-connection/66020582#66020582", "title": "grpc go : how to know in server side, when client closes the connection", "body": "<p>as the github issue:<a href=\"https://github.com/improbable-eng/grpc-web/issues/57\" rel=\"nofollow noreferrer\">link</a>\nyou can do like this</p>\n<pre><code>err = stream.Context().Err()\nif err != nil {\n    break\n}\n</code></pre>\n"}], "owner": {"reputation": 3889, "user_id": 100405, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/924e4500ab6bdce291ab6346099ede26?s=128&d=identicon&r=PG", "display_name": "weima", "link": "https://stackoverflow.com/users/100405/weima"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9050, "favorite_count": 2, "answer_count": 3, "score": 10, "last_activity_date": 1612320916, "creation_date": 1475476248, "question_id": 39825671, "link": "https://stackoverflow.com/questions/39825671/grpc-go-how-to-know-in-server-side-when-client-closes-the-connection", "title": "grpc go : how to know in server side, when client closes the connection", "body": "<p>I am using grpc go</p>\n\n<p>i have an rpc which looks roughly like this</p>\n\n<pre><code>196 service MyService {\n197   // Operation 1\n198   rpc Operation1(OperationRequest) returns (OperationResponse) {\n199       option (google.api.http) = {\n200         post: \"/apiver/myser/oper1\"\n201         body: \"*\"\n202     };\n203   }\n</code></pre>\n\n<p>Client connects by using grpc.Dial() method</p>\n\n<p>When a client connects, the server does some book keeping. when the client disconnects, the bookkeeping needs to be removed.</p>\n\n<p>is there any callback that can be registered which can be used to know that client has closed the session.</p>\n"}, {"tags": ["http", "go", "goquery"], "answers": [{"tags": [], "owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "is_accepted": true, "score": 1, "last_activity_date": 1475471474, "creation_date": 1475471474, "answer_id": 39824911, "question_id": 39824794, "link": "https://stackoverflow.com/questions/39824794/goquery-response-code/39824911#39824911", "title": "GoQuery Response Code", "body": "<p>I don't think that <code>NewDocument</code> gives you the chance to bail based on a status code, but you can use <code>NewDocumentFromResponse</code> instead. E.g.:</p>\n\n<pre><code>res, err := http.Get(url)\nif err != nil {\n    log.Fatal(err)\n}\n\n// Check for a 200 status (or a non-403, or whatever you want)\nif res.StatusCode == 200 {\n    doc, err := goquery.NewDocumentFromResponse(res)\n    if err != nil {\n        log.Fatal(err)\n    }\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 2784831, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d7185139c911df0481bd379b60aeee4c?s=128&d=identicon&r=PG&f=1", "display_name": "tvishwa107", "link": "https://stackoverflow.com/users/2784831/tvishwa107"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 39824911, "answer_count": 1, "score": 0, "last_activity_date": 1475471474, "creation_date": 1475470431, "question_id": 39824794, "link": "https://stackoverflow.com/questions/39824794/goquery-response-code", "title": "GoQuery Response Code", "body": "<p>In GoQuery, if I create a snippet as follows:     </p>\n\n<pre><code>    doc, err := goquery.NewDocument(s)\n    if err != nil {\n        log.Fatal(err)\n    }                 \n</code></pre>\n\n<p>where s is a valid url, I can see the error string, but if the page is returning a 403, how do I find out and stop instead of letting my code run?</p>\n\n<p>Is there a way to find the http response using Goquery?</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 117, "user_id": 6913795, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2-owcLtIIvc/AAAAAAAAAAI/AAAAAAAABT4/NQFPTg02-XU/photo.jpg?sz=128", "display_name": "Lasitha Senanayake", "link": "https://stackoverflow.com/users/6913795/lasitha-senanayake"}, "is_accepted": false, "score": 0, "last_activity_date": 1475470099, "creation_date": 1475470099, "answer_id": 39824758, "question_id": 39824698, "link": "https://stackoverflow.com/questions/39824698/minimal-diffing-with-golang-templates/39824758#39824758", "title": "Minimal diffing with golang templates?", "body": "<p>try this way put the html files to html folder  add html and js files to it.</p>\n\n<pre><code>func webServer() {\nhttp.Handle(\n    \"/\",\n    http.StripPrefix(\n        \"/\",\n        http.FileServer(http.Dir(\"html\")),\n    ),\n)\nhttp.ListenAndServe(\":9000\", nil)\n</code></pre>\n\n<p>}</p>\n\n<p>AND BROWSE IT UNDER <a href=\"http://localhost:9000/\" rel=\"nofollow\">http://localhost:9000/</a></p>\n"}], "owner": {"reputation": 1229, "user_id": 6336858, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ebcd58007a9088efe7c1605069558559?s=128&d=identicon&r=PG&f=1", "display_name": "omgj", "link": "https://stackoverflow.com/users/6336858/omgj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1475470699, "creation_date": 1475469622, "last_edit_date": 1475470699, "question_id": 39824698, "link": "https://stackoverflow.com/questions/39824698/minimal-diffing-with-golang-templates", "title": "Minimal diffing with golang templates?", "body": "<p>Let's say I have a page, it a header and a body. In the header are links, and on click the body changes, but the header remains.\nTo build this with the <code>html/template</code> library is easy, but also seems dumb if I just send back a whole new page (fetching the information in the header from the database every time). How to I switch out body templates depending on the <code>url</code> I guess.</p>\n\n<p>Here is what I have:</p>\n\n<p>`</p>\n\n<pre><code>{{template \"GlobalNav\"}} \n {{template \"GroupHeader\" .Header }} \n {{ if eq .Active \"\" }}\n {{ template \"GroupBody\" .Body }}\n {{ else if eq .Active \"papers\" }}\n {{ template \"GroupPapers\" .Body }}\n {{ else if eq .Active \"projects\" }}\n {{ template \"GroupProjects\" .Body }}\n {{ end }}`\n\nServer Side:\n\n`http.HandleFunc(\"/g/\", Groups)\nhttp.HandleFunc(\"/g/papers\", GroupsPapers)\nhttp.HandleFunc(\"/g/projects\", GroupsProjects)\nfunc Groups() {\n header := fromDBHeader(id)\nbody := fromDBMain(id)\nrender Home template ...\n}\nfunc GroupsPapers() {\n  header := fromDBHeader(id)\n   body := fromDBPapers(id)\n   render Paper template ...\n   }\nfunc GroupsProjects() {\nheader := fromDBHeader(id)\nbody := fromDBProjects(id)\nrender Project template ...\n}\n</code></pre>\n\n<p>`</p>\n\n<p>Is it time for some JS?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1475446026, "last_edit_date": 1475446026, "creation_date": 1475444951, "answer_id": 39822047, "question_id": 39821658, "link": "https://stackoverflow.com/questions/39821658/generic-handling-of-json-requests-and-responses/39822047#39822047", "title": "Generic handling of JSON requests and responses", "body": "<p>You can use reflection to eliminate the boilerplate. Here's an example that adapts a func(pointer) (pointer, error) to an http.Handler that handles the JSON encoding and decoding.</p>\n\n<pre><code>type jsonHandler struct {\n    fn interface{}\n}\n\nfunc (jh jsonHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    // allocate the input argument\n    v := reflect.ValueOf(jh.fn)\n    arg := reflect.New(v.Type().In(0).Elem())\n\n    // decode to the argument\n    if err := json.NewDecoder(r.Body).Decode(arg.Interface()); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    // invoke the function\n    out := v.Call([]reflect.Value{arg})\n\n    // check error\n    if err, ok := out[1].Interface().(error); ok &amp;&amp; err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    // decode result\n    if err := json.NewEncoder(w).Encode(out[0].Interface()); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n}\n</code></pre>\n\n<p>Here's an example of how to use this adapter:</p>\n\n<pre><code>type Input struct {\n    A, B int\n}\n\ntype Output struct {\n    Result int\n}\n\nfunc add(in *Input) (*Output, error) {\n    return &amp;Output{Result: in.A + in.B}, nil\n}\n\nhandler := jsonHandler{add}  // handler satisfies http.Handler\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/pCMg-LAhGR\" rel=\"nofollow\">working playground example</a></p>\n\n<p>The code will panic if the function does not have a single pointer argument and return a pointer and an error. A more robust and complete implementation should check that the function meets these constraints before returning the handler. </p>\n\n<pre><code>func newHandler(fn interface{)) (http.Handler, error) {\n    // use reflect to check fn, return error\n    ...\n\n    return jsonHandler{fn}, nil\n}\n</code></pre>\n\n<p>The use of reflection in this answer is somewhat similar <a href=\"https://godoc.org/net/rpc/jsonrpc\" rel=\"nofollow\">to an approach used in the standard library</a>.</p>\n"}], "owner": {"reputation": 1125, "user_id": 1698309, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cDGnK.png?s=128&g=1", "display_name": "tmh", "link": "https://stackoverflow.com/users/1698309/tmh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 350, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1475446026, "creation_date": 1475442050, "question_id": 39821658, "link": "https://stackoverflow.com/questions/39821658/generic-handling-of-json-requests-and-responses", "title": "Generic handling of JSON requests and responses", "body": "<p>Assume a Go program with several handler functions like this:</p>\n\n<pre><code>type FooRequest struct {\n    FooField string `json:\"foofield\"`\n    // ...\n}\n\ntype FooResponse struct {\n    BarField string `json:\"barfield\"`\n    // ...\n}\n\nfunc handleFoo(w http.ResponseWriter, r *http.Request) {\n    var req FooRequest\n    if err := json.NewDecoder(r.Body).Decode(&amp;req); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    // do what actually matters:\n\n    foo := DoStuff(req)\n\n    baz, err := DoSomething(foo)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)            \n        return\n    }\n\n    resp := DoEvenMoreStuff(baz)\n\n    // back to boiler plate:\n\n    if err := json.NewEncoder(w).Encode(resp); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)            \n        return\n    }\n\n}\n</code></pre>\n\n<p>How could this code be refactored to avoid the JSON decoding/encoding boiler plate?</p>\n\n<p>I would probably like to see a generic \"handle JSON\" func and another func handling the actual foo stuff:</p>\n\n<pre><code>func handleJson(w http.ResponseWriter, r *http.Request) {\n    var req FooRequest // what about this line?\n    if err := json.NewDecoder(r.Body).Decode(&amp;req); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    resp, err := handleFooElegantly(req)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    if err := json.NewEncoder(w).Encode(resp); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n}\n\nfunc handleFoo(req FooRequest) (FooResponse, error) {\n    var resp FooResponse\n    foo := DoStuff(req)\n\n    baz, err := DoSomething(foo)\n    if err != nil {\n      return resp, err\n    }\n\n    resp = DoEvenMoreStuff(baz)\n\n    return resp, nil\n}\n</code></pre>\n\n<p>That leaves us with the problem of telling the JSON decoder the type it should try to decode.</p>\n\n<p>What would be the idiomatic Go way of implementing this? </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1475445818, "creation_date": 1475445818, "answer_id": 39822180, "question_id": 39821084, "link": "https://stackoverflow.com/questions/39821084/websocket-waiting-for-message-with-timeout/39822180#39822180", "title": "Websocket waiting for message with Timeout", "body": "<p>Use the <a href=\"https://godoc.org/github.com/gorilla/websocket#Conn.SetReadDeadline\" rel=\"noreferrer\">read deadline</a> to implement the timeouts:</p>\n\n<pre><code>ws, err := upgrader.Upgrade(w, r, nil)\nif err != nil {\n    // handle error\n}\n\n// Read the initial message with deadline of 30 seconds\nws.SetReadDeadline(time.Now().Add(30 * time.Second))\nmt, message, err := c.ReadMessage()\nif err != nil {\n   // Handle the error which might be a deadline exceeded error.\n}\n// process the initial message\n// ...\n\nfor {\n    // Read next message with deadline of 45 minutes\n    ws.SetReadDeadline(time.Now().Add(45 * time.Minute))\n    mt, message, err = c.ReadMessage()\n    if err != nil {\n        // Handle the error which might be a deadline exceeded error.\n    }\n    // process message\n     // ....\n}\n</code></pre>\n"}], "owner": {"reputation": 1216, "user_id": 1424378, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/ffb07d39eccb7309c53b83f430345a34?s=128&d=identicon&r=PG&f=1", "display_name": "James Cameron", "link": "https://stackoverflow.com/users/1424378/james-cameron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2734, "favorite_count": 0, "accepted_answer_id": 39822180, "answer_count": 1, "score": 2, "last_activity_date": 1475445818, "creation_date": 1475438270, "question_id": 39821084, "link": "https://stackoverflow.com/questions/39821084/websocket-waiting-for-message-with-timeout", "title": "Websocket waiting for message with Timeout", "body": "<p>I want to create a Websocket connection via GO. This connection follows a clearly defined pattern: The client should \"authenticate\" (enter data) themself immediately after creating the connection. If the client does not do it, the connection will be closed after a short period.</p>\n\n<p>My current code contains this initial timeout (initTimeout) and the maximum timeout for all connections. While those timers can easily be checked, i am not sure how i can combine the timers with waiting for a message which blocks the execution.</p>\n\n<pre><code>ws, err := upgrader.Upgrade(w, r, nil)\ninitTimeout := time.NewTicker(time.Duration(30) * time.Second)\nmaxTimeout := time.NewTicker(time.Duration(45) * time.Minute)\n\nfor {\n    select {\n        case &lt;- initTimeout.C:\n            ws.WriteMessage(websocket.TextMessage, []byte(\"No input received\"))\n            ws.Close()\n        case &lt;- maxTimeout.C:\n            ws.WriteMessage(websocket.TextMessage, []byte(\"Maximum timeout\"))\n            ws.Close()\n        default:\n            mt, message, err := c.ReadMessage()\n            // will this block the timers?\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 1, "last_activity_date": 1475437280, "creation_date": 1475437280, "answer_id": 39820939, "question_id": 39819929, "link": "https://stackoverflow.com/questions/39819929/using-empty-interfaces-in-go/39820939#39820939", "title": "Using empty interfaces in go", "body": "<ol>\n<li><p><code>this</code> is not a keyword in go; any variable name can be used there. That is called the <em>receiver</em>. A function declared in that way must be called like <code>thing.func(params)</code>, where \"thing\" is an expression of the type of the receiver. Within the function, the receiver is set to the value of <code>thing</code>.</p></li>\n<li><p>A struct literal does not have to contain values for all the fields (or any of them). Any fields not explicitly set will have the <em>zero value</em> for their types.</p></li>\n<li><p>As you said, an empty interface can take on a value of any type. To use a value of type <code>interface{}</code>, you would use <em>type assertion</em> or a <em>type switch</em> to determine the type of the value, or you could use <em>reflection</em> to use the value without having to have code for the specific type.</p></li>\n<li><p>What specifically about that statement do you not understand? <code>json</code> is the name of a package in which the function <code>NewDecoder</code> is declared. That function is called, and then the <code>Decode</code> function (which is implemented by the type of the return value of <code>NewDecoder</code>) is called on that return value.</p></li>\n</ol>\n\n<p>You may want to take a look at <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow\">Effective Go</a> and/or <a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language Specification</a> for more information.</p>\n"}], "owner": {"reputation": 421, "user_id": 6862012, "user_type": "registered", "accept_rate": 18, "profile_image": "https://www.gravatar.com/avatar/f6e2aaae0112ecfad3fed2ba18452b7f?s=128&d=identicon&r=PG&f=1", "display_name": "John Dui", "link": "https://stackoverflow.com/users/6862012/john-dui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2211, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1475437280, "creation_date": 1475430936, "question_id": 39819929, "link": "https://stackoverflow.com/questions/39819929/using-empty-interfaces-in-go", "title": "Using empty interfaces in go", "body": "<p>I am trying to understand the code that is used at my company. I am new to go lang, and I have already gone through the tutorial on their official website. However, I am having a hard time wrapping my head around empty interfaces, i.e. interface{}. From various sources online, I figured out that the empty interface can hold any type. But, I am having a hard time figuring out the codebase, especially some of the functions. I will not be posting the entire thing here, but just the minimal functions in which it has been used. Please bear with me! </p>\n\n<pre><code>Function (I am trying to understand): \n\nfunc (this *RequestHandler) CreateAppHandler(rw http.ResponseWriter, r *http.Request) *foo.ResponseError {\n    var data *views.Data = &amp;views.Data{Attributes: &amp;domain.Application{}}\n    var request *views.Request = &amp;views.Request{Data: data}\n\n\n    if err := json.NewDecoder(r.Body).Decode(request); err != nil {\n        logrus.Error(err)\n        return foo.NewResponsePropogateError(foo.STATUS_400, err)\n    }\n    requestApp := request.Data.Attributes.(*domain.Application)\n    requestApp.CreatedBy = user\n</code></pre>\n\n<p>Setting some context, <code>RequestHandler</code> is a struct defined in the same package as this code. <code>domain</code> and <code>views</code> are seperate packages. Application is a struct in the package domain. The following two structs are part of the package views:</p>\n\n<pre><code>type Data struct {\n    Id         string      `json:\"id\"`\n    Type       string      `json:\"type\"`\n    Attributes interface{} `json:\"attributes\"`\n}\n\ntype Request struct {\n    Data *Data `json:\"data\"`\n}\n</code></pre>\n\n<p>The following are part of the package json: </p>\n\n<pre><code>func NewDecoder(r io.Reader) *Decoder {\n    return &amp;Decoder{r: r}\n}\n\nfunc (dec *Decoder) Decode(v interface{}) error {\n    if dec.err != nil {\n        return dec.err\n    }\n\n    if err := dec.tokenPrepareForDecode(); err != nil {\n        return err\n    }\n\n    if !dec.tokenValueAllowed() {\n        return &amp;SyntaxError{msg: \"not at beginning of value\"}\n    }\n\n    // Read whole value into buffer.\n    n, err := dec.readValue()\n    if err != nil {\n        return err\n    }\n    dec.d.init(dec.buf[dec.scanp : dec.scanp+n])\n    dec.scanp += n\n\n    // Don't save err from unmarshal into dec.err:\n    // the connection is still usable since we read a complete JSON\n    // object from it before the error happened.\n    err = dec.d.unmarshal(v)\n\n    // fixup token streaming state\n    dec.tokenValueEnd()\n\n    return err\n}\n\n\ntype Decoder struct {\n    r     io.Reader\n    buf   []byte\n    d     decodeState\n    scanp int // start of unread data in buf\n    scan  scanner\n    err   error\n\n    tokenState int\n    tokenStack []int\n}\n</code></pre>\n\n<p>Now, I understood that, in the struct Data in package views, Application is being set as a type for the empty interface.  After that, a pointer to Request in the same package is created which points to the variable data. </p>\n\n<p>I have the following doubts: </p>\n\n<ol>\n<li>What exactly does <code>this</code> keyword mean in Go? What is the purpose of writing <code>this * RequestHandler</code>?</li>\n<li>Initialization of a structure in Go can be done while assigning it to a variable by specifying the values of all it's members. However, here, for the struct <code>Data</code>, only the empty interface value is assigned and the values for the other two fields are not assigned? </li>\n<li>What is the advantage of assigning the Application struct to an empty interface? Does it mean I can use the struct members using the interface variable directly?</li>\n<li>Can someone help me figure out the meaning of this statement? <code>json.NewDecoder(r.Body).Decode(request)</code>?</li>\n</ol>\n\n<p>While I know this is too much, but I am having a hard time figuring out the meaning of interfaces in Go. Please help! </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19, "user_id": 4466763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nn6Fa.jpg?s=128&g=1", "display_name": "Cesar SC", "link": "https://stackoverflow.com/users/4466763/cesar-sc"}, "edited": false, "score": 0, "creation_date": 1475432896, "post_id": 39819668, "comment_id": 66930760, "body": "Thanks to Bart for indenting de code."}], "answers": [{"tags": [], "owner": {"reputation": 19, "user_id": 4466763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nn6Fa.jpg?s=128&g=1", "display_name": "Cesar SC", "link": "https://stackoverflow.com/users/4466763/cesar-sc"}, "is_accepted": false, "score": 0, "last_activity_date": 1475671744, "last_edit_date": 1475671744, "creation_date": 1475459905, "answer_id": 39823623, "question_id": 39819668, "link": "https://stackoverflow.com/questions/39819668/golang-tcp-client-server-program/39823623#39823623", "title": "Golang tcp client server program", "body": "<pre><code>package main\n\nimport (\n    \"net\"\n    \"sync\"\n    \"log\"\n    \"bufio\"\n    \"os\"\n    \"io\"\n    \"time\"\n)\n\nfunc receiveConn() net.Conn {\n    for{\n        xx, err := net.Dial(\"tcp\", \"localhost:9002\")\n        if err == nil{\n            return xx\n        }\n        time.Sleep(1 * time.Second)\n    }\n}\n\nvar wg sync.WaitGroup\n\nfunc main() {\n    wg.Add(2)\n\n    go func() {\n        listen, err := net.Listen(\"tcp\", \"localhost:9001\")\n        if err != nil {\n            log.Fatal(err)\n        }\n        defer listen.Close()\n\n        for {\n            conn, err := listen.Accept()\n            defer conn.Close()\n            if err != nil {\n                log.Fatal(err)\n            }\n\n            io.Copy(os.Stdout, conn)\n\n        }\n    }()\n\n    go func() {\n        dial := receiveConn()\n\n        defer dial.Close()\n        scanner := bufio.NewScanner(os.Stdin)\n        for scanner.Scan() {\n            if scanner.Text() == \"a\"{\n                dial.Write([]byte(\"Your mate has left the room\"))\n                break\n            }\n            dial.Write([]byte(scanner.Text() + \"\\n\"))\n        }\n    }()\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>SOLVED!!!!</p>\n"}], "owner": {"reputation": 19, "user_id": 4466763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nn6Fa.jpg?s=128&g=1", "display_name": "Cesar SC", "link": "https://stackoverflow.com/users/4466763/cesar-sc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 854, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1476448320, "creation_date": 1475429334, "last_edit_date": 1476448320, "question_id": 39819668, "link": "https://stackoverflow.com/questions/39819668/golang-tcp-client-server-program", "title": "Golang tcp client server program", "body": "<p>I can do a server program or a client program, but I don't know how to do a client/server program.\nDoes someone knows what's wrong with this code? Thanks.</p>\n\n<pre><code>package main\n\nimport (\n    \"net\"\n    \"os\"\n    \"bufio\"\n    \"io\"\n)\n\nfunc main() {\n    listen, _ := net.Listen(\"tcp\", \"localhost:9001\")\n\n\ndial, _ := net.Dial(\"tcp\", \"localhost:9002\")\n\n\nscanner := bufio.NewScanner(os.Stdin)\nfor scanner.Scan() {\n    conn, _ := listen.Accept()\n    if scanner.Text() == \"a\"{\n        conn.Close()\n        listen.Close()\n        dial.Close()\n        break\n    }\n    dial.Write([]byte(scanner.Text()))\n\n    io.Copy(os.Stdout, conn)\n}\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["java", "android", "go", "backend"], "answers": [{"tags": [], "owner": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "is_accepted": false, "score": 3, "last_activity_date": 1475424410, "creation_date": 1475424410, "answer_id": 39818930, "question_id": 39818686, "link": "https://stackoverflow.com/questions/39818686/designing-android-app-backend/39818930#39818930", "title": "designing android app backend", "body": "<p>This question could definitely result in a myriad of answers and approaches. But, in terms of something straightforward to maintain (considering you have Go tagged in the question) I would recommend checking out the following:</p>\n\n<p>For using Go, I have found <a href=\"https://echo.labstack.com/\" rel=\"nofollow\">Echo</a> to be a pretty awesome framework to bootstrap Go web services. It offers a very flexible and performant router that uses a middleware design pattern, as well as a lot of other nice features. </p>\n\n<p>For hosting and maintaining your web services, you should look into using <a href=\"https://dashboard.heroku.com/\" rel=\"nofollow\">Heroku</a>. They have a pretty amazing platform that officially supports Go deployments. You can start for free, and then scale up your services pretty effortlessly. They also offer myriad of third party integrations for monitoring, logging, emails, sms, and databases. </p>\n\n<p>In terms of databases, that one can't be answered really without a significant amount of knowledge around what you are doing with your data - but using Heroku, you can spin up a PostGres SQL instance, MongoDB, and Redis for free. For what you are doing it sounds like a combination of the above might be useful for your needs. </p>\n\n<p>In terms of Android development - I have not found anything better than Android Studio. It's free, provides all the emulators you could ever need, and in general all the features you would want out of an IDE to do Android right, plus it is maintained by Google. </p>\n\n<p>Good luck!</p>\n"}], "owner": {"reputation": 455, "user_id": 5319832, "user_type": "registered", "accept_rate": 3, "profile_image": "https://lh4.googleusercontent.com/-34cPi0hUQqE/AAAAAAAAAAI/AAAAAAAAAqI/7o-f7Zx76NA/photo.jpg?sz=128", "display_name": "ShyamSundar R", "link": "https://stackoverflow.com/users/5319832/shyamsundar-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1475424410, "creation_date": 1475422994, "question_id": 39818686, "link": "https://stackoverflow.com/questions/39818686/designing-android-app-backend", "title": "designing android app backend", "body": "<p>If I need to design an entire android app and host my app on google play, and my users need to get real-time data, how would I go about designing the backend.</p>\n\n<p>I learnt few things about views, view groups, layouts, event listeners in java, programming in latest android studio. But I'm just in the learning phase.</p>\n\n<p>Is there any other better IDE. Can we program in atom, does it has any package that can emulate android phones.</p>\n\n<p>Mainly I'm concerned about the DB choice, frontend-backend communication. Is there any service which is open source for hosting in the cloud that has a great uptime and supporting easy scaling. Of course, I can google each and everything, but those will be on different perspectives. I just wanted some answer which is tailor made and easy to understand.</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "is_accepted": true, "score": 11, "last_activity_date": 1475421411, "last_edit_date": 1475421411, "creation_date": 1475420743, "answer_id": 39818335, "question_id": 39818254, "link": "https://stackoverflow.com/questions/39818254/goroutines-order-of-execution/39818335#39818335", "title": "goroutines order of execution", "body": "<p>You have nothing explicitly synchronizing the order of the two goroutines. If you run this enough times, you will see the calls to <code>fmt.Println</code> print in different sequences. When executing goroutines, as they are concurrent operations, you have no guarantees when they will execute and/or complete. You need to use various standard library packages, or channels themselves to synchronize the execution of concurrently running goroutines. </p>\n\n<p>For example (by leveraging the blocking nature of channels, you could do something like):</p>\n\n<pre><code>func main() {\n\n    c := make(chan int)\n\n    go sum([]int{1, 2, 3}, c)\n\n    //use the channel to block until it receives a send\n    x := &lt;-c\n    fmt.Println(x)\n\n    //then execute the next routine\n    go sum([]int{4, 5, 6}, c)\n\n    x = &lt;-c\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>Another example (significantly less practical, but here to look at other common go synchronization features) you could introduce a wait group, and a range over a channel:</p>\n\n<pre><code>func sum(a []int, c chan int, wg *sync.WaitGroup) {\n    defer wg.Done()\n    fmt.Println(\"summing: \", a)\n    total := 0\n    for _, v := range a {\n        total += v\n    }\n    //fmt.Println(\"send to c\",total)\n    c &lt;- total // send total to c\n}\n\nfunc main() {\n\n    c := make(chan int)\n    wg := new(sync.WaitGroup)\n\n    //concurrently call the concurrent calls to sum, allowing execution to continue to the range of the channel \n    go func() {\n        //increment the wait group, and pass it to the sum func to decrement it when it is complete\n        wg.Add(1)\n        go sum([]int{1, 2, 3}, c, wg)\n        //wait for the above call to sum to complete\n        wg.Wait()\n        //and repeat...\n        wg.Add(1)\n        go sum([]int{4, 5, 6}, c, wg)\n        wg.Wait()\n        //all calls are complete, close the channel to allow the program to exit cleanly \n        close(c)\n    }()\n\n    //range of the channel\n    for theSum := range c {\n        x := theSum\n        fmt.Println(x)\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 6911938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98437a73f18927ba2e70198ad3244089?s=128&d=identicon&r=PG&f=1", "display_name": "jwtnb", "link": "https://stackoverflow.com/users/6911938/jwtnb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4429, "favorite_count": 1, "accepted_answer_id": 39818335, "answer_count": 1, "score": 5, "last_activity_date": 1585278049, "creation_date": 1475420187, "question_id": 39818254, "link": "https://stackoverflow.com/questions/39818254/goroutines-order-of-execution", "title": "goroutines order of execution", "body": "<p>I'm trying to understand this piece of code, not sure why the 2nd go is executed before the 1st one. It'd be great if someone can really help me out with this!</p>\n\n<pre><code>func sum(a []int, c chan int) {\n   fmt.Println(\"summing: \", a)\n   total := 0\n   for _, v := range a {\n      total += v\n   }\n   //fmt.Println(\"send to c\",total)\n   c &lt;- total  // send total to c\n}\nfunc main() {\n    //a := []int{7, 2, 8,134,23,23,1,23,1234,143, -9, 4, 0, 1234}\n\n    c := make(chan int)\n\n    go sum([]int{1,2,3}, c)\n    go sum([]int{4,5,6}, c)\n\n    x := &lt;-c\n    fmt.Println(x)\n    x = &lt;-c\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>OUTPUT:</p>\n\n<pre><code>summing:  [4 5 6]\n15\nsumming:  [1 2 3]\n6\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "edited": false, "score": 2, "creation_date": 1475413780, "post_id": 39817124, "comment_id": 66924786, "body": "Why don&#39;t you want to use JSON?"}, {"owner": {"reputation": 185, "user_id": 4396517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6d20a12a0638586b073d44e2fe1ba41?s=128&d=identicon&r=PG&f=1", "display_name": "user44168", "link": "https://stackoverflow.com/users/4396517/user44168"}, "reply_to_user": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "edited": false, "score": 0, "creation_date": 1475414163, "post_id": 39817124, "comment_id": 66924898, "body": "For example, if my struct has an array field (like struct Data { Values [3]int }), and the json to unmarshall is {&quot;Values&quot; : [1, 2, 3, 4, /*more than the array&#39;s capacity*/]}, then json.Unmarshal will run successfully, silently discarding the extra values. I do not know how many more undocumented quirks like this are in the encoding/json package."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475414575, "post_id": 39817124, "comment_id": 66925029, "body": "The %v format isn&#39;t defined the same for all types, nor is it unambiguous. You need a serialization format, not the pretty-print output from the fmt package. How about using gob?"}, {"owner": {"reputation": 185, "user_id": 4396517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6d20a12a0638586b073d44e2fe1ba41?s=128&d=identicon&r=PG&f=1", "display_name": "user44168", "link": "https://stackoverflow.com/users/4396517/user44168"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475415565, "post_id": 39817124, "comment_id": 66925309, "body": "@JimB I guess I was hoping for a default pretty-read symmetric to the pretty-print. As for gob, since I want my marshalled text to be human-readable, I still need to write a custom decoder. Nevertheless, thanks for the suggestion."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1475502011, "post_id": 39817124, "comment_id": 66955477, "body": "@user44168: I wouldn&#39;t consider that an &quot;undocumented quirk&quot; with json, that&#39;s pretty standard behavior for serialization protocols in general. You could enforce a schema of your own by unmarshaling into a generic intermediate structure and checking the fields before applying them to the final type. The only serialization protocol with a standard enforceable schema that is also human readable I know of is XML. You may be better off working around the well-known behavior of json. (You can also implement <code>fmt.Scanner</code>, but I have yet to try that myself, or seen it used)"}, {"owner": {"reputation": 185, "user_id": 4396517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6d20a12a0638586b073d44e2fe1ba41?s=128&d=identicon&r=PG&f=1", "display_name": "user44168", "link": "https://stackoverflow.com/users/4396517/user44168"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475514454, "post_id": 39817124, "comment_id": 66963258, "body": "@JimB I&#39;ll keep in mind your comments about unmarshalling into intermediate structures and about standard behaviour of protocols (I expected a little more from Go?). As for fmt.Scanner - I&#39;ve found just <a href=\"https://github.com/rogpeppe/rog-go/blob/master/loopback/parse.go\" rel=\"nofollow noreferrer\">one</a> example of it&#39;s use. It&#39;s not particularly friendly."}], "owner": {"reputation": 185, "user_id": 4396517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6d20a12a0638586b073d44e2fe1ba41?s=128&d=identicon&r=PG&f=1", "display_name": "user44168", "link": "https://stackoverflow.com/users/4396517/user44168"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 299, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475415651, "creation_date": 1475412188, "last_edit_date": 1475413353, "question_id": 39817124, "link": "https://stackoverflow.com/questions/39817124/golang-cant-scan-type-error", "title": "Golang: &quot;can&#39;t scan type&quot; error", "body": "<p>Suppose that I have a struct d of some type Data. In Golang, I can easily marshall it to a string it using:</p>\n\n<pre><code>marshalled := fmt.Sprintf(\"%v\", d)\n</code></pre>\n\n<p>but if I try to unmarshall it like this:</p>\n\n<pre><code>fmt.Sscanf(marshalled, \"%v\", &amp;d)\n</code></pre>\n\n<p>I get an error:</p>\n\n<pre><code>can't scan type: *Data\n</code></pre>\n\n<p>Question: How can I parse a string to my struct without writing a custom Lexer/Parser? I'd prefer not to use encoding/json too.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1475408460, "post_id": 39816579, "comment_id": 66923498, "body": "Have you added <code>$GOPATH&#47;bin</code> to your PATH?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475409084, "post_id": 39816579, "comment_id": 66923622, "body": "And use <code>go install</code> to install the binary in GOPATH/bin"}, {"owner": {"reputation": 1571, "user_id": 1041618, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/ZY0v7.jpg?s=128&g=1", "display_name": "Shamsher", "link": "https://stackoverflow.com/users/1041618/shamsher"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475409971, "post_id": 39816579, "comment_id": 66923796, "body": "Yes I already did both the steps you mentioned"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1475410568, "post_id": 39816579, "comment_id": 66923937, "body": "Related: <a href=\"http://stackoverflow.com/questions/30612611/what-does-go-build-build\">What does go build build?</a> <code>go build</code> leaves the executable in the current working directory."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1475410888, "post_id": 39816579, "comment_id": 66924009, "body": "And btw your package name is <code>gosymbol</code>, not <code>symbol</code>."}, {"owner": {"reputation": 1571, "user_id": 1041618, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/ZY0v7.jpg?s=128&g=1", "display_name": "Shamsher", "link": "https://stackoverflow.com/users/1041618/shamsher"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1475411832, "post_id": 39816579, "comment_id": 66924280, "body": "@icza please have a look at <a href=\"https://github.com/shamsher31/gosymbol/blob/master/symbol.go#L2\" rel=\"nofollow noreferrer\">github.com/shamsher31/gosymbol/blob/master/symbol.go#L2</a> name . there is no restriction that folder and package name should be same."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1475413534, "post_id": 39816579, "comment_id": 66924723, "body": "That isn&#39;t a <code>main</code> package. It doesn&#39;t build a binary."}], "answers": [{"comments": [{"owner": {"reputation": 558, "user_id": 5214808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/043f377949498c0236a79ff5cb613a2f?s=128&d=identicon&r=PG&f=1", "display_name": "AlexanderD", "link": "https://stackoverflow.com/users/5214808/alexanderd"}, "edited": false, "score": 6, "creation_date": 1488535624, "post_id": 39955829, "comment_id": 72284829, "body": "Also don&#39;t forget to reload the configuration once its changed with <code>source ~&#47;.bashrc</code>"}, {"owner": {"reputation": 371, "user_id": 10874122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e24aba718cf977adb110b9fccc495c?s=128&d=identicon&r=PG", "display_name": "Wicak", "link": "https://stackoverflow.com/users/10874122/wicak"}, "edited": false, "score": 0, "creation_date": 1568476118, "post_id": 39955829, "comment_id": 102289881, "body": "Thanks, this work for me. I using zshrc, sudo nano ~/.zshrc"}], "tags": [], "owner": {"reputation": 1571, "user_id": 1041618, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/ZY0v7.jpg?s=128&g=1", "display_name": "Shamsher", "link": "https://stackoverflow.com/users/1041618/shamsher"}, "is_accepted": false, "score": 28, "last_activity_date": 1476093831, "creation_date": 1476093831, "answer_id": 39955829, "question_id": 39816579, "link": "https://stackoverflow.com/questions/39816579/command-not-found-after-go-build/39955829#39955829", "title": "command not found after go build", "body": "<p>You need following configuration for ubuntu.</p>\n\n<pre><code>$ sudo gedit ~/.bashrc\n</code></pre>\n\n<p>Add the following config</p>\n\n<pre><code>export PATH=$PATH:/usr/local/go/bin\nexport GOPATH=$HOME/go;\nexport PATH=$PATH:$GOPATH/bin;\n</code></pre>\n\n<p><code>/usr/local/go/bin</code> will be your go installation path and \n<code>$GOPATH/bin</code> will be where your custom build packages will get installed.</p>\n"}, {"comments": [{"owner": {"reputation": 3588, "user_id": 1842743, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AUYWV.png?s=128&g=1", "display_name": "PodTech.io", "link": "https://stackoverflow.com/users/1842743/podtech-io"}, "edited": false, "score": 0, "creation_date": 1528205148, "post_id": 50409010, "comment_id": 88411769, "body": "on windows its %GOPATH% into %PATH%"}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1532948186, "post_id": 50409010, "comment_id": 90150046, "body": "Pretty sure that should be %GOPATH%\\bin added to %PATH% if you are on WIndows"}], "tags": [], "owner": {"reputation": 626, "user_id": 3292527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53eda21a54269e646a1687c0406478c1?s=128&d=identicon&r=PG&f=1", "display_name": "AlexPes", "link": "https://stackoverflow.com/users/3292527/alexpes"}, "is_accepted": false, "score": 0, "last_activity_date": 1601415041, "last_edit_date": 1601415041, "creation_date": 1526638481, "answer_id": 50409010, "question_id": 39816579, "link": "https://stackoverflow.com/questions/39816579/command-not-found-after-go-build/50409010#50409010", "title": "command not found after go build", "body": "<p>On Windows:</p>\n<ol>\n<li>Set <code>$GOPATH</code> env, e.g., <code>$HOME/go</code></li>\n<li>Add <code>$GOPATH/bin</code> into <code>$PATH</code></li>\n</ol>\n<p>It should work now.</p>\n"}, {"tags": [], "owner": {"reputation": 2195, "user_id": 4296028, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/L1474.jpg?s=128&g=1", "display_name": "RobertMyles", "link": "https://stackoverflow.com/users/4296028/robertmyles"}, "is_accepted": false, "score": 0, "last_activity_date": 1539510695, "creation_date": 1539510695, "answer_id": 52801459, "question_id": 39816579, "link": "https://stackoverflow.com/questions/39816579/command-not-found-after-go-build/52801459#52801459", "title": "command not found after go build", "body": "<p>I was having a similar problem on OSX, I found this the easiest way to get golang up and running:</p>\n\n<p>With HomeBrew:</p>\n\n<pre><code>brew install go\n</code></pre>\n\n<p>Then add these to your <code>.bash_profile</code>: </p>\n\n<pre><code>export PATH=$PATH:$GOPATH/bin\nexport GOPATH=$HOME/.go\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5295736, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gZkeT.png?s=128&g=1", "display_name": "natade", "link": "https://stackoverflow.com/users/5295736/natade"}, "is_accepted": false, "score": 0, "last_activity_date": 1558240471, "creation_date": 1558240471, "answer_id": 56204776, "question_id": 39816579, "link": "https://stackoverflow.com/questions/39816579/command-not-found-after-go-build/56204776#56204776", "title": "command not found after go build", "body": "<p>for mac</p>\n\n<p>example I put custom go folder in workspace directory. you could change my custom go directory <code>workspace</code> by your own.</p>\n\n<p>add the following script to .bashrc</p>\n\n<pre><code>export GOROOT=\"/usr/local/go\"\nexport GOPATH=\"$HOME/workspace/go\"\nexport PATH=\"$HOME/workspace/go/bin:$PATH\"\n</code></pre>\n\n<p>then run <code>source .bashrc</code> on your terminal</p>\n"}, {"tags": [], "owner": {"reputation": 1334, "user_id": 3420618, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f86724eae25f924e613a58ee33f1994b?s=128&d=identicon&r=PG", "display_name": "PAC", "link": "https://stackoverflow.com/users/3420618/pac"}, "is_accepted": false, "score": 1, "last_activity_date": 1601415014, "last_edit_date": 1601415014, "creation_date": 1581527757, "answer_id": 60193774, "question_id": 39816579, "link": "https://stackoverflow.com/questions/39816579/command-not-found-after-go-build/60193774#60193774", "title": "command not found after go build", "body": "<p>For <strong>Go</strong> latest version <strong>go1.13.7 and above</strong></p>\n<p>If you have installed Go in its default location, then you no need to set up the <code>GOROOT</code> path.</p>\n<p>The default location for <strong>Unix</strong> or <strong>macOS</strong> is <code>/usr/local/go</code> and for <strong>Windows</strong>  - <code>c:\\Go</code>.</p>\n<p>You can verify the path using the command <code>go env</code>.</p>\n<p><strong>Note:</strong> If you are the getting the same error &quot;command not found&quot;, then you need to unset <a href=\"https://dave.cheney.net/2013/06/14/you-dont-need-to-set-goroot-really\" rel=\"nofollow noreferrer\"><code>GOROOT</code></a>.</p>\n<p>If you want to set up Go in the preferred location, then you need to export the <code>GOROOT</code> path like this:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>export GOROOT=&quot;/your/preferred/location&quot;\n</code></pre>\n<p>and</p>\n<pre class=\"lang-sh prettyprint-override\"><code>export PATH=&quot;$PATH:$GOROOT/bin&quot;\n</code></pre>\n<p>in <code>.bashrc</code> or <code>.bash_profile</code> file.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 952568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9f96febc22e848f5870bfa0856860a5?s=128&d=identicon&r=PG", "display_name": "smb", "link": "https://stackoverflow.com/users/952568/smb"}, "is_accepted": false, "score": 0, "last_activity_date": 1598424489, "creation_date": 1598424489, "answer_id": 63591977, "question_id": 39816579, "link": "https://stackoverflow.com/questions/39816579/command-not-found-after-go-build/63591977#63591977", "title": "command not found after go build", "body": "<p>as  <strong>icza</strong> said</p>\n<blockquote>\n<p>go build leaves the executable in the current working directory.</p>\n</blockquote>\n<p>Maybe help add ./ to you run command.</p>\n<pre><code>go build\n./symbol\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7816654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48c7be9e31cf8b4ae83ac64e64499378?s=128&d=identicon&r=PG", "display_name": "jquiceno", "link": "https://stackoverflow.com/users/7816654/jquiceno"}, "is_accepted": false, "score": 0, "last_activity_date": 1611345467, "creation_date": 1611345467, "answer_id": 65851936, "question_id": 39816579, "link": "https://stackoverflow.com/questions/39816579/command-not-found-after-go-build/65851936#65851936", "title": "command not found after go build", "body": "<p>i was the same problem in mac but i'm using zsh</p>\n<p>I was able to solve the problem by editing the file ~/.zsh</p>\n<pre><code>export PATH=$PATH:/usr/local/go/bin\nexport GOPATH=$HOME/go;\nexport PATH=$PATH:$GOPATH/bin;\n</code></pre>\n"}], "owner": {"reputation": 1571, "user_id": 1041618, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/ZY0v7.jpg?s=128&g=1", "display_name": "Shamsher", "link": "https://stackoverflow.com/users/1041618/shamsher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26567, "favorite_count": 4, "answer_count": 7, "score": 6, "last_activity_date": 1611345467, "creation_date": 1475408161, "last_edit_date": 1573226503, "question_id": 39816579, "link": "https://stackoverflow.com/questions/39816579/command-not-found-after-go-build", "title": "command not found after go build", "body": "<p>I have install and setup go.</p>\n\n<pre><code>export GOPATH=$HOME/go\nexport PATH=$PATH:/usr/local/go/bin\n</code></pre>\n\n<p>I have created a <a href=\"https://github.com/shamsher31/gosymbol\" rel=\"nofollow\">package</a> at following location.</p>\n\n<pre><code>$HOME/go/src/github.com/shamsher31/gosymbol\n</code></pre>\n\n<p>I build inside package folder using</p>\n\n<pre><code>go build\n</code></pre>\n\n<p>It creates binary in <code>bin</code> folder inside <code>GOPATH</code><br>\nBut when I try to run package name from command line it gives following error.</p>\n\n<pre><code>symbol: command not found\n</code></pre>\n\n<p>How can I execute binary from command line ? </p>\n"}, {"tags": ["linux", "go", "out-of-memory"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475406681, "post_id": 39816250, "comment_id": 66923102, "body": "Sys is the total amount allocated. It&#39;s a counter, it never goes down."}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475407821, "post_id": 39816250, "comment_id": 66923379, "body": "i see. But there is some correlation between when that number is very large and when I get that cannot create process error. So at some point my program takes enough memory to trigger that state. And even though it gives it back, I still can&#39;t fork."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475408149, "post_id": 39816250, "comment_id": 66923444, "body": "What is the system memory state when the program fails? What is the exact error message?"}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475410158, "post_id": 39816250, "comment_id": 66923847, "body": "exact error message is &quot;fork/exec /path/to/exec: cannot allocate memory&quot;. And system memory state is fine, the box has 12 gigs and very little is in use."}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475410579, "post_id": 39816250, "comment_id": 66923941, "body": "ah, &quot;@bioothod when fork fails, it&#39;s because it cannot allocate enough virtual memory to (potentially) hold a copy of the daemon&#39;s allocated virtual memory, so the resident set size of 1.1 GB is irrelevant. Your daemon using 30.4 GB of virtual memory when the problem manifests makes your report consistent with others, as far as I can tell. Which does not tell us where this virtual memory leak comes from, though.&quot; from <a href=\"https://github.com/docker/docker/issues/8539#issuecomment-244318346\" rel=\"nofollow noreferrer\">github.com/docker/docker/issues/8539#issuecomment-244318346</a>"}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475410646, "post_id": 39816250, "comment_id": 66923954, "body": "sure enough my pid&#39;s VIRT is 5406364 or 5.4 gigs and 2x that would not fit."}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1475411084, "post_id": 39816250, "comment_id": 66924061, "body": "this is good info: <a href=\"http://stackoverflow.com/a/35027241/148736\">stackoverflow.com/a/35027241/148736</a>"}], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 576, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475410707, "creation_date": 1475405664, "last_edit_date": 1495542794, "question_id": 39816250, "link": "https://stackoverflow.com/questions/39816250/how-can-i-get-linux-to-reduce-its-virt-memory-allocation-for-a-golang-process", "title": "How can I get linux to reduce its VIRT memory allocation for a golang process?", "body": "<p>from: <a href=\"https://golang.org/pkg/runtime/#MemStats\" rel=\"nofollow noreferrer\">https://golang.org/pkg/runtime/#MemStats</a></p>\n\n<blockquote>\n  <p>Alloc uint64 // bytes allocated and not yet freed<br>\n  Sys   uint64 // bytes obtained from system</p>\n</blockquote>\n\n<p>In my long running go program I'm printing out:</p>\n\n<pre><code>var mem runtime.MemStats\nruntime.ReadMemStats(&amp;mem)\nfmt.Println(\"%d, %d\", mem.Alloc/1048576, mem.Sys/1048576)\n</code></pre>\n\n<p>And I see values like:</p>\n\n<pre><code>200, 800\n350, 910\n198, 910\n</code></pre>\n\n<p>i.e. the first number mem.Alloc goes up and down. The 2nd number mem.Sys only goes up never down.</p>\n\n<p>When I look at top -p pid for the process I see the Resident memory is always in between the two numbers. Another way to say that, top always says the memory is a little more than what mem.Alloc reports but way less than mem.Sys. Sometimes the Sys number gets rather large:</p>\n\n<p>800, 4590</p>\n\n<p>and my program is in a bad state. 4.5 gigs of used memroy? But top and Alloc say it's only using about 1 gig. The bad state is I can't run:</p>\n\n<pre><code>  cmd := exec.Command(path, args...)\n  cmd.Stdout = os.Stdout\n  cmd.Stderr = os.Stderr\n  cmd.ExtraFiles = []*os.File{file}\n  err := cmd.Start()\n</code></pre>\n\n<p>because I get the error \"fork/exec /path/to/exec: cannot allocate memory\"</p>\n\n<p>How can I get that mem.Sys number to go down and be able to run cmd := exec.Command, and then cmd.Start()?</p>\n\n<p>Update: see <a href=\"https://stackoverflow.com/questions/39816250/how-can-i-get-golang-sys-memory-value-to-drop#comment66923941_39816250\">How can I get linux to reduce its VIRT memory allocation for a golang process?</a></p>\n"}, {"tags": ["xml", "http", "parsing", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1475405646, "post_id": 39815921, "comment_id": 66922877, "body": "The problem is in your main. Show your main function: <a href=\"http://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>   and you don&#39;t need: <code>resp.Header.Add(&quot;Content-Type&quot;,&quot;application&#47;xml; charset=utf-8&quot;)</code>"}, {"owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "edited": false, "score": 0, "creation_date": 1475405792, "post_id": 39815921, "comment_id": 66922899, "body": "In my main i just call this function with the web address"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 1, "creation_date": 1475406318, "post_id": 39815921, "comment_id": 66923014, "body": "So it is JSON not XML"}, {"owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "edited": false, "score": 0, "creation_date": 1475406423, "post_id": 39815921, "comment_id": 66923036, "body": "If I click on the link the browser generates an xml file, but after the GET it changes"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475407434, "post_id": 39815921, "comment_id": 66923268, "body": "The server is sending json based on the request, maybe the user agent in this case. Why not use the json? It will be easier to unmarshal and contain the same data."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475407528, "post_id": 39816415, "comment_id": 66923297, "body": "Content-Type is for the data in the request but you&#39;re not sending any. The Accept header is the standard way to request a data type."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1475408023, "post_id": 39816415, "comment_id": 66923419, "body": "You don&#39;t specify the encoding. Just <code>(&quot;Accept&quot;, &quot;application&#47;xml&quot;)</code>"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1475407751, "last_edit_date": 1475407751, "creation_date": 1475406948, "answer_id": 39816415, "question_id": 39815921, "link": "https://stackoverflow.com/questions/39815921/golang-http-xml-parsing-issue/39816415#39816415", "title": "Golang HTTP XML Parsing issue", "body": "<p>See:\n<a href=\"https://www.whatismybrowser.com/detect/what-http-headers-is-my-browser-sending\" rel=\"nofollow\">https://www.whatismybrowser.com/detect/what-http-headers-is-my-browser-sending</a></p>\n\n<p>Try this (and replace the web address with yours):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nfunc main() {\n    fmt.Println(getHttp(`http://stackoverflow.com/`))\n}\nfunc getHttp(url string) string {    \n    client := &amp;http.Client{}\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        panic(err)\n    }\n    req.Header.Set(\"ACCEPT\", \"application/xhtml+xml,application/xml\")\n    resp, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    defer resp.Body.Close()\n    data, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        panic(err)\n    }\n    return string(data)\n}\n</code></pre>\n\n<p>I hope this helps.</p>\n"}], "owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 39816415, "answer_count": 1, "score": 0, "last_activity_date": 1475729586, "creation_date": 1475403095, "last_edit_date": 1475729586, "question_id": 39815921, "link": "https://stackoverflow.com/questions/39815921/golang-http-xml-parsing-issue", "title": "Golang HTTP XML Parsing issue", "body": "<p>I'm trying to access an XML file available online, but after the GET the XML format disappears.<br>\nWhat am I doing wrong?<br>\nThank you so much!</p>\n\n<pre><code>func getHttp(address string) string{\n    resp, err := http.Get(address)\n    resp.Header.Add(\"Content-Type\",\"application/xml; charset=utf-8\")\n    if err != nil {\n        panic(err)\n    }\n\n    defer resp.Body.Close()\n\n    data, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        panic(err)\n    }\n\n    return (string(data))\n}\n</code></pre>\n\n<p>The new format looks like this: </p>\n\n<pre><code>{\"SessionKey\":\"229eaeaa9fb14a0d85ff38ae4e0c7870_ecilpojl_018FC93424D13ECC0908CE5BC5E3F86B\",\"Query\":{\"Country\":\"GB\",\"Currency\":\"GBP\",\"Locale\":\"en-gb\",\"Adults\":1,\"Children\":0,\"Infants\":0,\"OutboundDate\":\"2016-10-08\",\"LocationSchema\":\"Default\",\"CabinClass\":\"Economy\",\"GroupPricing\":false},\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>&lt;SessionKey&gt;229eaeaa9fb14a0d85ff38ae4e0c7870_ecilpojl_018FC93424D13ECC0908CE5BC5E3F86B&lt;/SessionKey&gt;\n  &lt;Query&gt;\n    &lt;Country&gt;GB&lt;/Country&gt;\n    &lt;Currency&gt;GBP&lt;/Currency&gt;\n    &lt;Locale&gt;en-gb&lt;/Locale&gt;\n    &lt;Adults&gt;1&lt;/Adults&gt;\n    &lt;Children&gt;0&lt;/Children&gt;\n    &lt;Infants&gt;0&lt;/Infants&gt;\n    &lt;OutboundDate&gt;2016-10-08&lt;/OutboundDate&gt;\n    &lt;LocationSchema&gt;Default&lt;/LocationSchema&gt;\n    &lt;CabinClass&gt;Economy&lt;/CabinClass&gt;\n    &lt;GroupPricing&gt;false&lt;/GroupPricing&gt;\n  &lt;/Query&gt;\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 1, "creation_date": 1475402371, "post_id": 39815778, "comment_id": 66922230, "body": "did you try the documentation? <a href=\"https://golang.org/doc\" rel=\"nofollow noreferrer\">golang.org/doc</a>"}, {"owner": {"reputation": 2133, "user_id": 6101969, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/af337f9791a73a3a4590d809a0bbc49e?s=128&d=identicon&r=PG&f=1", "display_name": "J.Done", "link": "https://stackoverflow.com/users/6101969/j-done"}, "reply_to_user": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1475402467, "post_id": 39815778, "comment_id": 66922255, "body": "could you give a chapter name relative to this"}], "answers": [{"comments": [{"owner": {"reputation": 2133, "user_id": 6101969, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/af337f9791a73a3a4590d809a0bbc49e?s=128&d=identicon&r=PG&f=1", "display_name": "J.Done", "link": "https://stackoverflow.com/users/6101969/j-done"}, "edited": false, "score": 0, "creation_date": 1475403669, "post_id": 39815950, "comment_id": 66922480, "body": "So should I understand it as non-name function with call immediatly like &#39;lambda&#39;?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 2133, "user_id": 6101969, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/af337f9791a73a3a4590d809a0bbc49e?s=128&d=identicon&r=PG&f=1", "display_name": "J.Done", "link": "https://stackoverflow.com/users/6101969/j-done"}, "edited": false, "score": 0, "creation_date": 1475404220, "post_id": 39815950, "comment_id": 66922566, "body": "Yes, it is called function closures."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1475405064, "last_edit_date": 1475405064, "creation_date": 1475403305, "answer_id": 39815950, "question_id": 39815778, "link": "https://stackoverflow.com/questions/39815778/golang-how-this-func-is-called/39815950#39815950", "title": "Golang - how this func is called", "body": "<p><a href=\"https://tour.golang.org/moretypes/25\" rel=\"nofollow\">function closures</a>:</p>\n\n<blockquote>\n  <p>Go functions may be closures. A closure is a function value that\n  references variables from outside its body. The function may access\n  and assign to the referenced variables; in this sense the function is\n  \"bound\" to the variables.</p>\n</blockquote>\n\n<p>To Understand this:</p>\n\n<pre><code>go func(r []string) {\n    processData(r)\n    ch &lt;- r\n}(record)\n</code></pre>\n\n<p>let's first declare this function:</p>\n\n<pre><code>func routine(r []string) {\n    processData(r)\n    ch &lt;- r\n}\n</code></pre>\n\n<p>and this global variable:</p>\n\n<pre><code>var ch = make(chan []string)\n</code></pre>\n\n<p>Now you may call it:</p>\n\n<pre><code>go routine(record)\n</code></pre>\n\n<p>this calls function named <code>routine</code> with input parameter named <code>record</code> as a goroutine.</p>\n\n<p>And see: <a href=\"https://gobyexample.com/goroutines\" rel=\"nofollow\">https://gobyexample.com/goroutines</a></p>\n\n<p>Try it on <a href=\"https://play.golang.org/p/GSO8lMxIKT\" rel=\"nofollow\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"flag\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"strings\"\n    \"time\"\n)\n\nfunc routine(r []string) {\n    processData(r)\n    ch &lt;- r\n}\n\nvar ch = make(chan []string)\n\nfunc main() {\n    start := time.Now()\n    flag.Parse()\n    fmt.Print(strings.Join(flag.Args(), \"\\n\"))\n    if *filename == \"REQUIRED\" {\n        return\n    }\n\n    csvfile, err := os.Open(*filename)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer csvfile.Close()\n\n    reader := csv.NewReader(csvfile)\n\n    i := 0\n    for {\n        record, err := reader.Read()\n        if err == io.EOF {\n            break\n        } else if err != nil {\n            fmt.Println(err)\n            return\n        }\n        i++\n\n        go routine(record)\n\n        fmt.Printf(\"go %d %s\\n\", i, record)\n    }\n    for ; i &gt;= 0; i-- {\n        fmt.Printf(\"&lt;- %d %s\\n\", i, &lt;-ch)\n    }\n\n    fmt.Printf(\"\\n%2fs\", time.Since(start).Seconds())\n\n}\n\nfunc processData([]string) {\n    time.Sleep(10 * time.Millisecond)\n}\n\nvar filename = flag.String(\"f\", \"REQUIRED\", \"source CSV file\")\nvar numChannels = flag.Int(\"c\", 4, \"num of parallel channels\")\n\n//var bufferedChannels = flag.Bool(\"b\", false, \"enable buffered channels\")\n</code></pre>\n"}], "owner": {"reputation": 2133, "user_id": 6101969, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/af337f9791a73a3a4590d809a0bbc49e?s=128&d=identicon&r=PG&f=1", "display_name": "J.Done", "link": "https://stackoverflow.com/users/6101969/j-done"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 39815950, "answer_count": 1, "score": -1, "last_activity_date": 1475405064, "creation_date": 1475401920, "question_id": 39815778, "link": "https://stackoverflow.com/questions/39815778/golang-how-this-func-is-called", "title": "Golang - how this func is called", "body": "<p>I'm working with <a href=\"https://github.com/ronnyhartenstein/golang-csv-parallel-processing/blob/dd4e75737c18fa6877a4a515074474a58555376a/import/import.go#L47\" rel=\"nofollow\">this sample</a> code but cannot understand how this function is called and which parameter is belong.</p>\n\n<pre><code>go func(r []string) {\n    processData(r)\n    ch &lt;- r\n}(record)\n</code></pre>\n"}, {"tags": ["go", "locking", "profiling", "benchmarking", "futex"], "answers": [{"comments": [{"owner": {"reputation": 259, "user_id": 341311, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/75pab.jpg?s=128&g=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/341311/christophe"}, "edited": false, "score": 0, "creation_date": 1475485100, "post_id": 39817412, "comment_id": 66945517, "body": "using explicit locking indeed results in much better performance. I&#39;ve also the *sync.Mutex to sync.Mutex. I&#39;m kind of disappointed that defer statements aren&#39;t optimized away if the compiler can detect this, but the catch is probably that it&#39;s hard for the compiler to detect (I can imagine extra code is required to execute defers when unwinding the stack during a panic)"}, {"owner": {"reputation": 1, "user_id": 6911613, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Kd5FhN5YhuI/AAAAAAAAAAI/AAAAAAAAAJI/HoEPGDeyXLk/photo.jpg?sz=128", "display_name": "Mark", "link": "https://stackoverflow.com/users/6911613/mark"}, "reply_to_user": {"reputation": 259, "user_id": 341311, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/75pab.jpg?s=128&g=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/341311/christophe"}, "edited": false, "score": 0, "creation_date": 1475507902, "post_id": 39817412, "comment_id": 66959418, "body": "You&#39;re right, the 2 forms aren&#39;t equivalent due to panic handling. Hence its hard to optimise it away entirely. Defer will be significantly faster in Go 1.8, so you might want to revisit after it is released early next year."}], "tags": [], "owner": {"reputation": 1, "user_id": 6911613, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Kd5FhN5YhuI/AAAAAAAAAAI/AAAAAAAAAJI/HoEPGDeyXLk/photo.jpg?sz=128", "display_name": "Mark", "link": "https://stackoverflow.com/users/6911613/mark"}, "is_accepted": false, "score": 0, "last_activity_date": 1475414130, "creation_date": 1475414130, "answer_id": 39817412, "question_id": 39815723, "link": "https://stackoverflow.com/questions/39815723/why-locking-in-go-much-slower-than-java-lots-of-time-spent-in-mutex-lock-mut/39817412#39817412", "title": "Why Locking in Go much slower than Java? Lot&#39;s of time spent in Mutex.Lock() Mutex.Unlock()", "body": "<p>It is best to avoid <code>defer</code> in tiny functions that need high performance since it is expensive. In most other cases, there is no need to avoid it since the cost of <code>defer</code> is outweighed by the code around it.</p>\n\n<p>I'd also recommend using <code>lock sync.Mutex</code> instead of using a pointer. The pointer creates a slight amount of extra work for the programmer (initialisation, <code>nil</code> bugs), and a slight amount of extra work for the garbage collector.</p>\n"}, {"tags": [], "owner": {"reputation": 259, "user_id": 341311, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/75pab.jpg?s=128&g=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/341311/christophe"}, "is_accepted": true, "score": 1, "last_activity_date": 1475527294, "creation_date": 1475527294, "answer_id": 39840050, "question_id": 39815723, "link": "https://stackoverflow.com/questions/39815723/why-locking-in-go-much-slower-than-java-lots-of-time-spent-in-mutex-lock-mut/39840050#39840050", "title": "Why Locking in Go much slower than Java? Lot&#39;s of time spent in Mutex.Lock() Mutex.Unlock()", "body": "<p>I've also posted this question on the <a href=\"https://groups.google.com/d/topic/golang-nuts/I-p5vmyln9c/discussion\" rel=\"nofollow\" title=\"golang-nuts\">golang-nuts</a> group. The reply from  <a href=\"https://groups.google.com/d/msg/golang-nuts/I-p5vmyln9c/OfxO0nZBBgAJ\" rel=\"nofollow\">Jesper Louis Andersen</a> explains quite well that Java uses synchronization optimization techniques such as lock escape analysis/lock elision and lock coarsening. </p>\n\n<p>Java JIT might be taking the lock and allowing multiple updates at once within the lock to increase performance. I ran the Java benchmark with <code>-Djava.compiler=NONE</code> which gave dramatic performance, but is not a fair comparison.</p>\n\n<p>I assume that many of these optimization techniques have less impact in a production environment. </p>\n"}], "owner": {"reputation": 259, "user_id": 341311, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/75pab.jpg?s=128&g=1", "display_name": "Christophe", "link": "https://stackoverflow.com/users/341311/christophe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 662, "favorite_count": 0, "accepted_answer_id": 39840050, "answer_count": 2, "score": 0, "last_activity_date": 1475527294, "creation_date": 1475401446, "question_id": 39815723, "link": "https://stackoverflow.com/questions/39815723/why-locking-in-go-much-slower-than-java-lots-of-time-spent-in-mutex-lock-mut", "title": "Why Locking in Go much slower than Java? Lot&#39;s of time spent in Mutex.Lock() Mutex.Unlock()", "body": "<p>I've written a small Go library (<a href=\"https://github.com/toefel18/go-patan\" rel=\"nofollow\" title=\"go-patan\">go-patan</a>) that collects a running min/max/avg/stddev of certain variables. I compared it to an equivalent Java implementation (<a href=\"https://github.com/toefel18/patan\" rel=\"nofollow\" title=\"patan\">patan</a>), and to my surprise the Java implementation is much faster. I would like to understand why. </p>\n\n<p>The library basically consists of a simple data store with a lock that serializes reads and writes. This is a snippet of the code: </p>\n\n<pre><code>type Store struct {\n   durations map[string]*Distribution\n   counters  map[string]int64\n   samples   map[string]*Distribution\n\n   lock *sync.Mutex\n}\n\nfunc (store *Store) addSample(key string, value int64) {\n  store.addToStore(store.samples, key, value)\n}\n\nfunc (store *Store) addDuration(key string, value int64) {\n  store.addToStore(store.durations, key, value)\n}\n\nfunc (store *Store) addToCounter(key string, value int64) {\n  store.lock.Lock()\n  defer store.lock.Unlock()\n  store.counters[key] = store.counters[key] + value\n}\n\nfunc (store *Store) addToStore(destination map[string]*Distribution, key string, value int64) {\n  store.lock.Lock()\n  defer store.lock.Unlock()\n  distribution, exists := destination[key]\n  if !exists {\n    distribution = NewDistribution()\n    destination[key] = distribution\n  }\n  distribution.addSample(value)\n}\n</code></pre>\n\n<p>I've benchmarked the GO and Java implementations (<a href=\"https://gist.github.com/toefel18/96edac8f57f9ad8a4f9a86d83e726aec\" rel=\"nofollow\">go-benchmark-gist</a>, <a href=\"https://gist.github.com/toefel18/9def55a8c3c53c79a4488c29c66f31e5\" rel=\"nofollow\">java-benchmark-gist</a>) and Java wins by far, but I don't understand why:</p>\n\n<pre><code>Go Results:\n10 threads with 20000 items took 133 millis\n100 threads with 20000 items took 1809 millis\n1000 threads with 20000 items took 17576 millis\n10 threads with 200000 items took 1228 millis\n100 threads with 200000 items took 17900 millis\n\nJava Results:\n10 threads with 20000 items takes 89 millis\n100 threads with 20000 items takes 265 millis\n1000 threads with 20000 items takes 2888 millis  \n10 threads with 200000 items takes 311 millis\n100 threads with 200000 items takes 3067 millis\n</code></pre>\n\n<p>I've profiled the program with the Go's pprof and generated a call graph <a href=\"https://gist.githubusercontent.com/toefel18/96edac8f57f9ad8a4f9a86d83e726aec/raw/c1ff6452abaefe49c3c688b3d07e4574cbe77264/call-graph.png\" rel=\"nofollow\" title=\"call-graph\">call-graph</a>. This shows that it basically spends all the time in sync.(*Mutex).Lock() and sync.(*Mutex).Unlock().</p>\n\n<p>The Top20 calls according to the profiler:</p>\n\n<pre><code>(pprof) top20\n59110ms of 73890ms total (80.00%)\nDropped 22 nodes (cum &lt;= 369.45ms)\nShowing top 20 nodes out of 65 (cum &gt;= 50220ms)\n      flat  flat%   sum%        cum   cum%\n    8900ms 12.04% 12.04%     8900ms 12.04%  runtime.futex\n    7270ms  9.84% 21.88%     7270ms  9.84%  runtime/internal/atomic.Xchg\n    7020ms  9.50% 31.38%     7020ms  9.50%  runtime.procyield\n    4560ms  6.17% 37.56%     4560ms  6.17%  sync/atomic.CompareAndSwapUint32\n    4400ms  5.95% 43.51%     4400ms  5.95%  runtime/internal/atomic.Xadd\n    4210ms  5.70% 49.21%    22040ms 29.83%  runtime.lock\n    3650ms  4.94% 54.15%     3650ms  4.94%  runtime/internal/atomic.Cas\n    3260ms  4.41% 58.56%     3260ms  4.41%  runtime/internal/atomic.Load\n    2220ms  3.00% 61.56%    22810ms 30.87%  sync.(*Mutex).Lock\n    1870ms  2.53% 64.10%     1870ms  2.53%  runtime.osyield\n    1540ms  2.08% 66.18%    16740ms 22.66%  runtime.findrunnable\n    1430ms  1.94% 68.11%     1430ms  1.94%  runtime.freedefer\n    1400ms  1.89% 70.01%     1400ms  1.89%  sync/atomic.AddUint32\n    1250ms  1.69% 71.70%     1250ms  1.69%  github.com/toefel18/go-patan/statistics/lockbased.(*Distribution).addSample\n    1240ms  1.68% 73.38%     3140ms  4.25%  runtime.deferreturn\n    1070ms  1.45% 74.83%     6520ms  8.82%  runtime.systemstack\n    1010ms  1.37% 76.19%     1010ms  1.37%  runtime.newdefer\n    1000ms  1.35% 77.55%     1000ms  1.35%  runtime.mapaccess1_faststr\n     950ms  1.29% 78.83%    15660ms 21.19%  runtime.semacquire\n     860ms  1.16% 80.00%    50220ms 67.97%  main.Benchmrk.func1\n</code></pre>\n\n<p>Can someone explain why locking in Go seems to be so much slower than in Java, what am I doing wrong? I've also written a channel based implementation in Go, but that is even slower. </p>\n"}, {"tags": ["go", "couchbase", "gocb"], "answers": [{"tags": [], "owner": {"reputation": 1884, "user_id": 430996, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5c6df24b3ea79f562bd316152cdfd11?s=128&d=identicon&r=PG", "display_name": "Matt Ingenthron", "link": "https://stackoverflow.com/users/430996/matt-ingenthron"}, "is_accepted": false, "score": 1, "last_activity_date": 1475545647, "creation_date": 1475545647, "answer_id": 39843010, "question_id": 39815387, "link": "https://stackoverflow.com/questions/39815387/consisntent-n1ql-query-couchbase-gocb-sdk/39843010#39843010", "title": "Consisntent N1QL Query Couchbase GOCB sdk", "body": "<p>Technically speaking MutationToken and asynchronous operations are not mutually exclusive.  It may be able to be done without a change to the client (I'm not sure) but the key here is to take all MutationToken responses and then issue the query with the highest number per vbucket with all of them.</p>\n\n<p>The key here is that given a single <a href=\"https://github.com/couchbase/gocb/blob/master/token.go#L10\" rel=\"nofollow\">MutationToken</a>, you can add the others to it.  I don't directly see a way to do this, but since internally it's just a map it should be relatively straightforward and I'm sure we (Couchbase) would take a contribution that does this.  At the lowest level, it's just a map of vbucket sequences that is provided to query at the time the query is issued.</p>\n"}], "owner": {"reputation": 20971, "user_id": 317384, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/be674120f51c26ee1091e887114a8e1a?s=128&d=identicon&r=PG", "display_name": "Roger Johansson", "link": "https://stackoverflow.com/users/317384/roger-johansson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1475545647, "creation_date": 1475398468, "question_id": 39815387, "link": "https://stackoverflow.com/questions/39815387/consisntent-n1ql-query-couchbase-gocb-sdk", "title": "Consisntent N1QL Query Couchbase GOCB sdk", "body": "<p>I'm currently implementing EventSourcing for my Go Actor lib.\nThe problem that I have right now is that when an actor restarts and need to replay all it's state from the event journal, the query might return inconsistent data.\nI know that I can solve this using <code>MutationToken</code></p>\n\n<p>But, if I do that, I would be forced to write all events in sequential order, that is, write the last event last.</p>\n\n<p>That way the mutation token for the last event would be enough to get all the data consistently for the specific actor.</p>\n\n<p>This is however very slow, writing about 10 000 events in order, takes about 5 sec on my setup.</p>\n\n<p>If I instead write those 10 000 async, using go routines, I can write all of the data in less than one sec.\nBut, then the writes are in indeterministic order and I can know which mutation token I can trust.\ne.g. Event 999 might be written before Event 843 due to go routine scheduling AFAIK.</p>\n\n<p>What are my options here?</p>\n"}, {"tags": ["unit-testing", "google-app-engine", "go", "google-cloud-storage"], "comments": [{"owner": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "edited": false, "score": 1, "creation_date": 1475428063, "post_id": 39814108, "comment_id": 66929130, "body": "<a href=\"https://github.com/golang/mock\" rel=\"nofollow noreferrer\">github.com/golang/mock</a> ?"}, {"owner": {"reputation": 29797, "user_id": 112, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8cff214f16c7c8e73244a8ed8dea7e0e?s=128&d=identicon&r=PG", "display_name": "Jesse Beder", "link": "https://stackoverflow.com/users/112/jesse-beder"}, "reply_to_user": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "edited": false, "score": 0, "creation_date": 1475429946, "post_id": 39814108, "comment_id": 66929707, "body": "@SachinNambiarNalavattanon I&#39;m looking for a fake storage; are you suggesting that I mock it and implement a fake myself?"}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1602478182, "post_id": 39814108, "comment_id": 113722364, "body": "If you end up calling an external resources you are not doing unit test. You have a function that get text and find most used words. This function get a bytes buffer and return slice of results. In test you take a string and turn it to a bytes buffer and send it to the function and in production you read from GCS turn the file to bytes buffer and send it to the function."}], "answers": [{"tags": [], "owner": {"reputation": 5284, "user_id": 3953357, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2f0b6d4522d8c03a21c5c41d5ba5a23?s=128&d=identicon&r=PG&f=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3953357/adam"}, "is_accepted": false, "score": 2, "last_activity_date": 1476056308, "creation_date": 1476056308, "answer_id": 39949631, "question_id": 39814108, "link": "https://stackoverflow.com/questions/39814108/how-to-unit-test-google-cloud-storage-in-golang/39949631#39949631", "title": "How to unit test google cloud storage in golang?", "body": "<p>Cloud Storage on the Python Development server is emulated using local files with the Blobstore service, which is why the solution of using a Blobstore stub with testbed (also Python-specific) worked. However there is no such local emulation for Cloud Storage on the Go runtime.</p>\n\n<p>As Sachin suggested, the way to unit test Cloud Storage is to use a mock. This is the way it's done internally and on other runtimes, such as <a href=\"https://github.com/GoogleCloudPlatform/google-cloud-node/issues/1032\" rel=\"nofollow\">node</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1730, "user_id": 573791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a286a392ecc96e9cb40c03134b96841?s=128&d=identicon&r=PG", "display_name": "bosgood", "link": "https://stackoverflow.com/users/573791/bosgood"}, "is_accepted": false, "score": 7, "last_activity_date": 1602469766, "last_edit_date": 1602469766, "creation_date": 1493311564, "answer_id": 43663603, "question_id": 39814108, "link": "https://stackoverflow.com/questions/39814108/how-to-unit-test-google-cloud-storage-in-golang/43663603#43663603", "title": "How to unit test google cloud storage in golang?", "body": "<p>One approach, also suggested <a href=\"https://stackoverflow.com/questions/19167970/mock-functions-in-go\">here</a> is to allow your GCS client to have its downloader swapped out for a stub while unit testing. First, define an interface that matches how you use the Google Cloud Storage library, and then reimplement it with fake data in your unit tests.</p>\n<p>Something like this:</p>\n<pre><code>type StorageClient interface {\n  Bucket(string) Bucket  // ... and so on, matching the Google library\n}\n\ntype Storage struct {\n  client StorageClient\n}\n\n// New creates a new Storage client\n// This is the function you use in your app\nfunc New() Storage {\n  return NewWithClient(&amp;realGoogleClient{}) // provide real implementation here as argument\n}\n\n// NewWithClient creates a new Storage client with a custom implementation\n// This is the function you use in your unit tests\nfunc NewWithClient(client StorageClient) {\n  return Storage{\n    client: client,\n  }\n}\n</code></pre>\n<p>It can be a lot of boilerplate to mock entire 3rd party APIs, so maybe you'll be able to make it easier by generating some of those mocks with <a href=\"https://github.com/golang/mock\" rel=\"nofollow noreferrer\">golang/mock</a> or <a href=\"https://github.com/vektra/mockery\" rel=\"nofollow noreferrer\">mockery</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 579, "user_id": 1608682, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/pVLpr.jpg?s=128&g=1", "display_name": "I.Tyger", "link": "https://stackoverflow.com/users/1608682/i-tyger"}, "is_accepted": false, "score": -2, "last_activity_date": 1544341543, "last_edit_date": 1544341543, "creation_date": 1544307447, "answer_id": 53687520, "question_id": 39814108, "link": "https://stackoverflow.com/questions/39814108/how-to-unit-test-google-cloud-storage-in-golang/53687520#53687520", "title": "How to unit test google cloud storage in golang?", "body": "<p>I would advice you reduce the mocks as much as possible you might need to use an hermetic approach to make it almost similar to the real thing .\n<a href=\"https://testing.googleblog.com/2012/10/hermetic-servers.html\" rel=\"nofollow noreferrer\">https://testing.googleblog.com/2012/10/hermetic-servers.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 4093761, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001374467583/picture?type=large", "display_name": "Manish Kushwaha", "link": "https://stackoverflow.com/users/4093761/manish-kushwaha"}, "is_accepted": false, "score": 1, "last_activity_date": 1614834671, "creation_date": 1614834671, "answer_id": 66468938, "question_id": 39814108, "link": "https://stackoverflow.com/questions/39814108/how-to-unit-test-google-cloud-storage-in-golang/66468938#66468938", "title": "How to unit test google cloud storage in golang?", "body": "<p>I have done something like this...</p>\n<p>Since storage client is sending HTTPS request so I mocked the HTTPS server using <code>httptest</code></p>\n<pre><code>func Test_StorageClient(t *testing.T) {\n    tests := []struct {\n        name        string\n        mockHandler func() http.Handler\n        wantErr     bool\n    }{\n        {\n            name: &quot;test1&quot;,\n            mockHandler: func() http.Handler {\n                return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n                    w.Write([]byte(&quot;22\\n96\\n120\\n&quot;))\n                    return\n                })\n            },\n            wantErr: false,\n        },\n        {\n            name: &quot;test2 &quot;,\n            mockHandler: func() http.Handler {\n                return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n                    w.WriteHeader(http.StatusNotFound)\n                    return\n                })\n            },\n            wantErr: true,\n        },\n    }\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            serv := httptest.NewTLSServer(tt.mockHandler())\n            httpclient := http.Client{\n                Transport: &amp;http.Transport{\n                    TLSClientConfig: &amp;tls.Config{\n                        InsecureSkipVerify: true,\n                    },\n                },\n            }\n            client, _ := storage.NewClient(context.Background(), option.WithEndpoint(serv.URL), option.WithoutAuthentication(), option.WithHTTPClient(&amp;httpclient))\n            got, err := readFileFromGCS(client)\n            if (err != nil) != tt.wantErr {\n                t.Errorf(&quot;error = %v, wantErr %v&quot;, err, tt.wantErr)\n                return\n            }\n        })\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 29797, "user_id": 112, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8cff214f16c7c8e73244a8ed8dea7e0e?s=128&d=identicon&r=PG", "display_name": "Jesse Beder", "link": "https://stackoverflow.com/users/112/jesse-beder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4562, "favorite_count": 0, "answer_count": 4, "score": 16, "last_activity_date": 1614834671, "creation_date": 1475385624, "last_edit_date": 1495542854, "question_id": 39814108, "link": "https://stackoverflow.com/questions/39814108/how-to-unit-test-google-cloud-storage-in-golang", "title": "How to unit test google cloud storage in golang?", "body": "<p>I'm writing an appengine app in Go that uses <a href=\"https://godoc.org/cloud.google.com/go/storage\" rel=\"noreferrer\">Google cloud storage</a>.</p>\n\n<p>For example, my \"reading\" code looks like:</p>\n\n<pre><code>client, err := storage.NewClient(ctx)\nif err != nil {\n    return nil, err\n}\ndefer func() {\n    if err := client.Close(); err != nil {\n        panic(err)\n    }\n}()\nr, err := client.Bucket(BucketName).Object(id).NewReader(ctx)\nif err != nil {\n    return nil, err\n}\ndefer r.Close()\nreturn ioutil.ReadAll(r)\n</code></pre>\n\n<p>... where <code>ctx</code> is a context from appengine.</p>\n\n<p>When I run this code in a unit test (using <code>aetest</code>), it actually sends requests to my cloud storage; I'd like to run this hermetically instead, similar to how <code>aetest</code> allows fake datastore calls.</p>\n\n<p>(Possibly related <a href=\"https://stackoverflow.com/questions/32613897/unit-testing-googles-cloud-storage-api\">question</a>, but it deals with python, and the linked <a href=\"https://github.com/GoogleCloudPlatform/appengine-gcs-client/issues/21\" rel=\"noreferrer\">github issue</a> indicates it's solved in a python-specific way).</p>\n\n<p>How can I do this?</p>\n"}, {"tags": ["pdf", "go", "text-analysis"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 5, "last_activity_date": 1475391007, "creation_date": 1475391007, "answer_id": 39814581, "question_id": 39813890, "link": "https://stackoverflow.com/questions/39813890/extract-words-from-pdf-with-golang/39814581#39814581", "title": "Extract words from PDF with golang?", "body": "<blockquote>\n  <p>all I get is a bunch of hieroglyphs.</p>\n</blockquote>\n\n<p>What you get is the content of a pdf file, which is not clear text.</p>\n\n<p>If you want to read a pdf file in Go, use <a href=\"http://libs.club/golang/data-formats/pdf\">one of the golang pdf libraries</a> like <a href=\"https://godoc.org/rsc.io/pdf\"><code>rsc.io/pdf</code></a>, or one of <a href=\"https://golanglibs.com/top?q=pdf\">those libraries</a> like <a href=\"https://github.com/yob/pdfreader\"><code>yob/pdfreader</code></a>.</p>\n\n<p>As <a href=\"https://forum.golangbridge.org/t/golang-pdf-reader-writer-based-on-template/1976/4\">mentioned here</a>:</p>\n\n<blockquote>\n  <p>I doubt there is any 'solid framework' for this kind of stuff. PDF format isn't meant to be machine-friendly by design, and AFAIK there is no guaranteed way to parse arbitrary PDFs.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 3, "creation_date": 1494952070, "post_id": 42777204, "comment_id": 75041967, "body": "I have a bug with your lib but it&#39;s not possible possible to post issue on <code>ledongthuc&#47;pdf</code> Git."}, {"owner": {"reputation": 111, "user_id": 1179472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Yig8Y.jpg?s=128&g=1", "display_name": "Le Dong Thuc", "link": "https://stackoverflow.com/users/1179472/le-dong-thuc"}, "reply_to_user": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1497351745, "post_id": 42777204, "comment_id": 76031027, "body": "@LeMoussel, not sure why can&#39;t you create the issue in my project. But anyway, you can ask send the bug here, I will try to help you"}, {"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1497508626, "post_id": 42777204, "comment_id": 76109755, "body": "@ Le Dong Thuc : See <a href=\"https://stackoverflow.com/questions/44560265/how-to-extract-plain-text-from-pdf-in-golang\">How to extract plain text from PDF in golang</a>"}, {"owner": {"reputation": 71, "user_id": 4317376, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbdfc81c53d9120a4825cea7a385def3?s=128&d=identicon&r=PG&f=1", "display_name": "KrzysztofSzarek", "link": "https://stackoverflow.com/users/4317376/krzysztofszarek"}, "reply_to_user": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1519578931, "post_id": 42777204, "comment_id": 84957337, "body": "@LeMoussel actually, you can: <a href=\"https://softwareengineering.stackexchange.com/questions/179468/forking-a-repo-on-github-but-allowing-new-issues-on-the-fork\" title=\"forking a repo on github but allowing new issues on the fork\">softwareengineering.stackexchange.com/questions/179468/&hellip;</a>"}], "tags": [], "owner": {"reputation": 111, "user_id": 1179472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Yig8Y.jpg?s=128&g=1", "display_name": "Le Dong Thuc", "link": "https://stackoverflow.com/users/1179472/le-dong-thuc"}, "is_accepted": false, "score": 6, "last_activity_date": 1489463304, "last_edit_date": 1489463304, "creation_date": 1489461623, "answer_id": 42777204, "question_id": 39813890, "link": "https://stackoverflow.com/questions/39813890/extract-words-from-pdf-with-golang/42777204#42777204", "title": "Extract words from PDF with golang?", "body": "<p>It's because the PDF doesn't only contain the text, but it also contains the formats (fonts, padding, margin, position, shapes, image) information.</p>\n\n<p>In case you need to read the plain text without format. I have forked a repository and implement the function to do that. You can check it at <a href=\"https://github.com/ledongthuc/pdf\" rel=\"noreferrer\">https://github.com/ledongthuc/pdf</a></p>\n\n<p>I also have put an example, help it useful for you.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n\n    \"github.com/ledongthuc/pdf\"\n)\n\nfunc main() {\n    content, err := readPdf(\"test.pdf\") // Read local pdf file\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(content)\n    return\n}\n\nfunc readPdf(path string) (string, error) {\n    r, err := pdf.Open(path)\n    if err != nil {\n        return \"\", err\n    }\n    totalPage := r.NumPage()\n\n    var textBuilder bytes.Buffer\n    for pageIndex := 1; pageIndex &lt;= totalPage; pageIndex++ {\n        p := r.Page(pageIndex)\n        if p.V.IsNull() {\n            continue\n        }\n        textBuilder.WriteString(p.GetPlainText(\"\\n\"))\n    }\n    return textBuilder.String(), nil\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 83, "user_id": 5072015, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-KKwiJs9kjb8/AAAAAAAAAAI/AAAAAAAAAF0/kR-V_mZoi9w/photo.jpg?sz=128", "display_name": "Max Stevens", "link": "https://stackoverflow.com/users/5072015/max-stevens"}, "edited": false, "score": 1, "creation_date": 1596049642, "post_id": 46273999, "comment_id": 111688786, "body": "Note that the docconv package has dependencies that are only available for Linux"}], "tags": [], "owner": {"reputation": 324, "user_id": 5882445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2ZB7y.png?s=128&g=1", "display_name": "Daoctor", "link": "https://stackoverflow.com/users/5882445/daoctor"}, "is_accepted": false, "score": 8, "last_activity_date": 1568653462, "last_edit_date": 1568653462, "creation_date": 1505720347, "answer_id": 46273999, "question_id": 39813890, "link": "https://stackoverflow.com/questions/39813890/extract-words-from-pdf-with-golang/46273999#46273999", "title": "Extract words from PDF with golang?", "body": "<p>I tried some go pdf libs, and found <a href=\"https://github.com/sajari/docconv\" rel=\"nofollow noreferrer\">sajari/docconv</a> works like I expect.</p>\n\n<p>easy to use, here is a example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"code.sajari.com/docconv\"\n)\n\nfunc main() {\n    res, err := docconv.ConvertPath(\"your-file.pdf\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(res)\n}\n</code></pre>\n"}], "owner": {"reputation": 1229, "user_id": 6336858, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/ebcd58007a9088efe7c1605069558559?s=128&d=identicon&r=PG&f=1", "display_name": "omgj", "link": "https://stackoverflow.com/users/6336858/omgj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18212, "favorite_count": 3, "answer_count": 3, "score": 8, "last_activity_date": 1618675243, "creation_date": 1475382814, "question_id": 39813890, "link": "https://stackoverflow.com/questions/39813890/extract-words-from-pdf-with-golang", "title": "Extract words from PDF with golang?", "body": "<p>I don't understand type conversion. I know this isn't right, all I get is a bunch of hieroglyphs.</p>\n\n<p><code>f, _ := os.Open(\"test.pdf\")\ndefer f.Close()\nio.Copy(os.Stdout, f)</code></p>\n\n<p>I want to work with the strings....</p>\n"}, {"tags": ["c++", "node.js", "go", "mfc", "cgo"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1475399990, "post_id": 39813769, "comment_id": 66921681, "body": "You may use SWIG for C++ and Go: <a href=\"http://www.swig.org/Doc2.0/Go.html\" rel=\"nofollow noreferrer\">swig.org/Doc2.0/Go.html</a>"}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 0, "creation_date": 1475436563, "post_id": 39813769, "comment_id": 66932077, "body": "You seem to be missing the obvious: ActiveX is based on COM, a language-agnostic ABI, that is callable from JavaScript (at least the <code>IDispatch</code> interface is). You are trying to write a wrapper for something, that is already consumable by your target platform."}], "answers": [{"tags": [], "owner": {"reputation": 411, "user_id": 6908891, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ye7xV.png?s=128&g=1", "display_name": "Chajnik-U", "link": "https://stackoverflow.com/users/6908891/chajnik-u"}, "is_accepted": false, "score": 1, "last_activity_date": 1475388807, "last_edit_date": 1475388807, "creation_date": 1475388333, "answer_id": 39814322, "question_id": 39813769, "link": "https://stackoverflow.com/questions/39813769/is-it-possible-to-use-visual-c-mfc-function-add-on-in-nodejs-or-golang/39814322#39814322", "title": "Is it possible to use Visual C++ MFC function add-on in nodejs or golang?", "body": "<p>You can call ATL/MFC code from your addon C++ code but you cannot tie to ATL/MFC directly from nodejs/golang without your intermediate wrapper layer.</p>\n\n<p><strong>Note</strong>: either <strong><em>node-ffi</em></strong> for nodejs or <strong><em>cgo</em></strong> for golang are useful for integration with native code but will not help to call ATL/MFC directly just because both <em>node-ffi</em> and <em>cgo</em> target C calling convention (all C++ code has to be wrapped with <strong>extern \"C\"</strong> to be callable via <em>node-ffi</em>/<em>cgo</em>). So you still need to create C++ wrapper around ATL/MFC. Also when creating your addon/extension ensure ATL/MFC exceptions (or any other C++ exceptions) do not cross module boundaries.</p>\n"}], "owner": {"reputation": 289, "user_id": 6647951, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3bd96d3ce822b7f9dba275aaa600db67?s=128&d=identicon&r=PG&f=1", "display_name": "asqdf", "link": "https://stackoverflow.com/users/6647951/asqdf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 598, "favorite_count": 2, "answer_count": 1, "score": 0, "last_activity_date": 1520668154, "creation_date": 1475381355, "question_id": 39813769, "link": "https://stackoverflow.com/questions/39813769/is-it-possible-to-use-visual-c-mfc-function-add-on-in-nodejs-or-golang", "title": "Is it possible to use Visual C++ MFC function add-on in nodejs or golang?", "body": "<p>Currently, I have some visual c++ function using MFC. Can I use this functions as c++ addons in nodejs or golang?</p>\n\n<p>To be specific, I need to somehow access to the OCX (ActiveX) object through my golang or nodejs code. So, I decided to write down the add-on using c++, but found it really difficult without using MFC/ATL things. So, can I use these MFC/ATL functions as addon/extension in nodejs or golang? Thanks! </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "is_accepted": false, "score": 0, "last_activity_date": 1475381462, "creation_date": 1475381462, "answer_id": 39813779, "question_id": 39813730, "link": "https://stackoverflow.com/questions/39813730/failed-to-implement-go-interface-because-of-pointer-receiver/39813779#39813779", "title": "Failed to implement Go interface because of pointer receiver", "body": "<p><code>NewIpcServer</code> receives an interface which can be satisfied by a value-type or a pointer-type. </p>\n\n<p>Since <code>EchoServer</code> implements the interface functions as pointer-type receiver (e.g <code>func (server *EchoServer) ...</code>) then you must pass a pointer to the <code>NewIpcServer</code> function.</p>\n\n<p>In your <code>TestIpc</code> function change <code>server</code> to be a pointer as such</p>\n\n<pre><code>server := new(EchoServer)\n</code></pre>\n\n<p>and your test should compile just fine.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1475381945, "last_edit_date": 1495541802, "creation_date": 1475381596, "answer_id": 39813790, "question_id": 39813730, "link": "https://stackoverflow.com/questions/39813730/failed-to-implement-go-interface-because-of-pointer-receiver/39813790#39813790", "title": "Failed to implement Go interface because of pointer receiver", "body": "<p>1- You may use </p>\n\n<pre><code>server := &amp;EchoServer{}\n</code></pre>\n\n<p>instead of </p>\n\n<pre><code>server := EchoServer{}\n</code></pre>\n\n<p><a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">Method sets</a>:</p>\n\n<blockquote>\n  <p>A type may have a method set associated with it. The method set of an\n  interface type is its interface. The method set of any other type <code>T</code>\n  consists of all methods declared with receiver type <code>T</code>. The method set\n  of the corresponding pointer type <code>*T</code> is the set of all methods\n  declared with receiver <code>*T</code> or <code>T</code> (that is, it also contains the method\n  set of <code>T</code>). Further rules apply to structs containing anonymous fields,\n  as described in the section on struct types. Any other type has an\n  empty method set. In a method set, each method must have a unique\n  non-blank method name.</p>\n</blockquote>\n\n<p>And see: <a href=\"https://stackoverflow.com/questions/38987391/pointer-receiver-and-value-receiver-difference-in-implementation-with-iris-frame\">Pointer receiver and Value receiver difference in implementation with Iris framework</a></p>\n\n<hr>\n\n<p>2- Or you may use</p>\n\n<pre><code>func (server EchoServer) Name() string {\n    return \"EchoServer\"\n}\n\nfunc (server EchoServer) Handle(method, params string) *Response {\n    return &amp;Response{\"OK\", \"Echo \" + method + \" \" + params}\n}\n</code></pre>\n\n<p>with </p>\n\n<pre><code>server := EchoServer{}\n</code></pre>\n"}], "owner": {"reputation": 914, "user_id": 996925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3056cef71018bbe8682e615e1d7b70ad?s=128&d=identicon&r=PG", "display_name": "Sam", "link": "https://stackoverflow.com/users/996925/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 790, "favorite_count": 0, "closed_date": 1475383472, "accepted_answer_id": 39813790, "answer_count": 2, "score": -1, "last_activity_date": 1570832531, "creation_date": 1475380869, "last_edit_date": 1475382151, "question_id": 39813730, "link": "https://stackoverflow.com/questions/39813730/failed-to-implement-go-interface-because-of-pointer-receiver", "closed_reason": "Duplicate", "title": "Failed to implement Go interface because of pointer receiver", "body": "<p>My <code>go test</code> can not be passed. What's wrong? What's the meaning of <code>(Handle method has pointer receiver)</code></p>\n\n<pre><code>package ipc\n\nimport (\n    \"testing\"\n)\n\n// import (\n//  \"encoding/json\"\n//  \"fmt\"\n// )\n\ntype Request struct {\n    Method string `json/\"method\"`\n    Params string `json/\"params\"`\n}\n\ntype Response struct {\n    Code string `json/\"code\"`\n    Body string `json/\"body\"`\n}\n\ntype Server interface {\n    Name() string\n    Handle(method, params string) *Response\n}\n\ntype IpcServer struct {\n    Server\n}\n\nfunc NewIpcServer(server Server) *IpcServer {\n    return &amp;IpcServer{server}\n}\n\ntype EchoServer struct {\n}\n\nfunc (server *EchoServer) Name() string {\n    return \"EchoServer\"\n}\n\nfunc (server *EchoServer) Handle(method, params string) *Response {\n    return &amp;Response{\"OK\", \"Echo \" + method + \" \" + params}\n}\n\nfunc TestIpc(t *testing.T) {\n    server := EchoServer{}\n\n    ipcServer := NewIpcServer(server)\n}\n</code></pre>\n\n<p>When I run <code>go test ipc_test.go</code></p>\n\n<pre><code>/ipc_test.go:49: cannot use server (type EchoServer) as type Server in argument to NewIpcServer:\n    EchoServer does not implement Server (Handle method has pointer receiver)\nFAIL    command-line-arguments [build failed]\n</code></pre>\n"}, {"tags": ["go", "middleware"], "comments": [{"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1475396614, "post_id": 39813728, "comment_id": 66920959, "body": "You miss the parenthesis <i>()</i> or is just a typo?"}, {"owner": {"reputation": 1, "user_id": 6888767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LcPto.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/6888767/dan"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1475586533, "post_id": 39813728, "comment_id": 66994162, "body": "Actually, is not a typo. newLogHandler here is a struct value. Handle is a method of it. Then who has () is a function that return a struct value."}], "owner": {"reputation": 1, "user_id": 6888767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LcPto.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/6888767/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1475380854, "creation_date": 1475380854, "question_id": 39813728, "link": "https://stackoverflow.com/questions/39813728/middleware-couldnt-be-handle-in-gin-gonic", "title": "Middleware Couldn&#39;t Be Handle In gin-gonic", "body": "<p>U know , when I write a middleware to handle log, then I put a handle resource(e.g. handle GET) middleware in front of it, and I post my code here, hope anyone can help me. Thanks.</p>\n\n<pre><code>v1Group := s.router.Group(\"/v1\")\nv1Group.Use(v1.newOtherHandler().Handle)  //handle other things\nv1Group.Use(v1.NewUserHandler().Handle)   //handle user\n{\n    v1.NewhandleResource(v1Group)     //handle resource\n}\nv1Group.Use(v1.newLogHandler.Handle)  //handle log\n</code></pre>\n\n<p>I use router.Set(\"demo\") and router.Get(\"demo\") to pass handle resource value to handle log function. But the program couldn't exec handle log. Anything in v1.newLogHandler.Handle function is not dealt. when I put log handler on resource handler, it can be execute. So u can simple think that any middleware under resource handler can't be executed. That's Why?</p>\n"}, {"tags": ["http", "go", "client", "time-wait"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1475404560, "post_id": 39813587, "comment_id": 66922637, "body": "TIME_WAIT is the normal TCP state after closing closing a connection. What exactly are you trying to test here?"}, {"owner": {"reputation": 2455, "user_id": 39939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/XEYik.jpg?s=128&g=1", "display_name": "yigal", "link": "https://stackoverflow.com/users/39939/yigal"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475417068, "post_id": 39813587, "comment_id": 66925681, "body": "JimB, I am tring to stress test the web server <a href=\"http://172.17.0.9:3000/\" rel=\"nofollow noreferrer\">172.17.0.9:3000</a> and I want to do it using just one client machine. I know that this is possible because there are no problems if I set num_coroutines to 2. but I want to use many coroutines"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475499348, "post_id": 39813587, "comment_id": 66953733, "body": "You&#39;re opening and closing connections too fast for your server. Is the server you&#39;re testing expected to reuse http/1.1 connections, or does it close the connection on every request?"}, {"owner": {"reputation": 2455, "user_id": 39939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/XEYik.jpg?s=128&g=1", "display_name": "yigal", "link": "https://stackoverflow.com/users/39939/yigal"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475504870, "post_id": 39813587, "comment_id": 66957421, "body": "JimB, the server program is very simple - I added to the question. I dont think it is using  keep alive connections."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475505209, "post_id": 39813587, "comment_id": 66957637, "body": "No, the server is using http/1.1 by default. The problem is partly because the server is too simple and not really doing any work, and benchmarking a &quot;hello world&quot; doesn&#39;t prove anything since the client is being tested just as much as the server, with conflating issues from the OS and network stack. (also see <a href=\"https://stackoverflow.com/questions/30352725\">stackoverflow.com/questions/30352725</a>)."}, {"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 0, "creation_date": 1564164949, "post_id": 39813587, "comment_id": 100954736, "body": "Adding a bit more context to &quot;TIME_WAIT is the normal TCP state after closing a connection&quot;: <a href=\"https://serverfault.com/a/23395/117206\">serverfault.com/a/23395/117206</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2455, "user_id": 39939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/XEYik.jpg?s=128&g=1", "display_name": "yigal", "link": "https://stackoverflow.com/users/39939/yigal"}, "edited": false, "score": 0, "creation_date": 1475558254, "post_id": 39834253, "comment_id": 66978373, "body": "JimB, I used the first option above and it greatly improved the behavior of the program. now it does not crash on low numbers of num_conections, but I does break for high numbers (for example 10000). I&#39;ll try the more more verbose option and see it helps more."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2455, "user_id": 39939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/XEYik.jpg?s=128&g=1", "display_name": "yigal", "link": "https://stackoverflow.com/users/39939/yigal"}, "edited": false, "score": 0, "creation_date": 1475584245, "post_id": 39834253, "comment_id": 66992502, "body": "@yigal: of course it will break if you raise concurrency high enough, what is the point of testing 10000 concurrent connections with a single http client and server over loopback? You only have so many file descriptors and ephemeral ports you can make use of without some system tuning and better configuration."}, {"owner": {"reputation": 2455, "user_id": 39939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/XEYik.jpg?s=128&g=1", "display_name": "yigal", "link": "https://stackoverflow.com/users/39939/yigal"}, "edited": false, "score": 1, "creation_date": 1475609667, "post_id": 39834253, "comment_id": 67008720, "body": "the idea is to stress test our system using just one client machine. The advantage of single client machine over multiple client machines is that is should be simpler to develop and test the stress test code. I am trying out golang for this purpose as it is a fast language with low overhead for spawning  threads/coroutines. I am not completely versed at linux optimizations, but my logic says that 10000 concurrent connections should be achievable with stock Linux. I just need to handle the TIME_WAIT problem more efficiently."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "edited": false, "score": 0, "creation_date": 1482193311, "post_id": 39834253, "comment_id": 69665735, "body": "Any difference when we do a POST request ?"}, {"owner": {"reputation": 107, "user_id": 1326168, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/DJBd4.jpg?s=128&g=1", "display_name": "Amir Khoshhal", "link": "https://stackoverflow.com/users/1326168/amir-khoshhal"}, "edited": false, "score": 0, "creation_date": 1592838976, "post_id": 39834253, "comment_id": 110561424, "body": "How can I set different proxies for every request in this way ? Is it possible ?"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 24, "last_activity_date": 1475505619, "creation_date": 1475505619, "answer_id": 39834253, "question_id": 39813587, "link": "https://stackoverflow.com/questions/39813587/go-client-program-generates-a-lot-a-sockets-in-time-wait-state/39834253#39834253", "title": "Go client program generates a lot a sockets in TIME_WAIT state", "body": "<p>The default http.Transport is opening and closing connections too quickly. Since all connections are to the same host:port combination, you need to increase <code>MaxIdleConnsPerHost</code> to match your value for <code>num_coroutines</code>. Otherwise, the transport will frequently close the extra connections, only to have them reopened immediately.</p>\n\n<p>You can set this globally on the default transport:</p>\n\n<pre><code>http.DefaultTransport.(*http.Transport).MaxIdleConnsPerHost = numCoroutines\n</code></pre>\n\n<p>Or when creating your own transport</p>\n\n<pre><code>t := &amp;http.Transport{\n    Proxy: http.ProxyFromEnvironment,\n    DialContext: (&amp;net.Dialer{\n        Timeout:   30 * time.Second,\n        KeepAlive: 30 * time.Second,\n    }).DialContext,\n    MaxIdleConnsPerHost:   numCoroutines,\n    MaxIdleConns:          100,\n    IdleConnTimeout:       90 * time.Second,\n    TLSHandshakeTimeout:   10 * time.Second,\n    ExpectContinueTimeout: 1 * time.Second,\n}\n</code></pre>\n\n<p>Similar question: <a href=\"https://stackoverflow.com/questions/37774624/go-http-get-concurrency-and-connection-reset-by-peer\">Go http.Get, concurrency, and &quot;Connection reset by peer&quot;</a></p>\n"}], "owner": {"reputation": 2455, "user_id": 39939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/XEYik.jpg?s=128&g=1", "display_name": "yigal", "link": "https://stackoverflow.com/users/39939/yigal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8357, "favorite_count": 10, "accepted_answer_id": 39834253, "answer_count": 1, "score": 11, "last_activity_date": 1554155891, "creation_date": 1475379002, "last_edit_date": 1554155891, "question_id": 39813587, "link": "https://stackoverflow.com/questions/39813587/go-client-program-generates-a-lot-a-sockets-in-time-wait-state", "title": "Go client program generates a lot a sockets in TIME_WAIT state", "body": "<p>I have a Go program that generates a lot of HTTP requests from multiple goroutines.  after running for a while, the program spits out an error: connect: cannot assign requested address.</p>\n\n<p>When checking with <code>netstat</code>, I get a high number (28229) of connections in <code>TIME_WAIT</code>.</p>\n\n<p>The high number of <code>TIME_WAIT</code> sockets happens when I the number of goroutines is 3 and is severe enough to cause a crash when it is 5.</p>\n\n<p>I run Ubuntu 14.4 under docker and go version 1.7</p>\n\n<p>This is the Go program.</p>\n\n<pre><code>package main\n\nimport (\n        \"io/ioutil\"\n        \"log\"\n        \"net/http\"\n        \"sync\"\n)\nvar wg sync.WaitGroup\nvar url=\"http://172.17.0.9:3000/\";\nconst num_coroutines=5;\nconst num_request_per_coroutine=100000\nfunc get_page(){\n        response, err := http.Get(url)\n        if err != nil {\n                log.Fatal(err)\n        } else {\n                defer response.Body.Close()\n                _, err =ioutil.ReadAll(response.Body)\n                if err != nil {\n                        log.Fatal(err)\n                }\n        }\n\n}\nfunc get_pages(){\n        defer wg.Done()\n        for i := 0; i &lt; num_request_per_coroutine; i++{\n                get_page();\n        }\n}\n\nfunc main() {\n        for i:=0;i&lt;num_coroutines;i++{\n                wg.Add(1)\n                go get_pages()\n        }\n        wg.Wait()\n}\n</code></pre>\n\n<p>This is the server program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"log\"\n)\nvar count int;\nfunc sayhelloName(w http.ResponseWriter, r *http.Request) {\n    count++;\n    fmt.Fprintf(w,\"Hello World, count is %d\",count) // send data to client side\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", sayhelloName) // set router\n    err := http.ListenAndServe(\":3000\", nil) // set listen port\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1153, "user_id": 1371064, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/NnrmE.jpg?s=128&g=1", "display_name": "Carlos Andr&#233;s Garc&#237;a", "link": "https://stackoverflow.com/users/1371064/carlos-andr%c3%a9s-garc%c3%ada"}, "edited": false, "score": 1, "creation_date": 1475371865, "post_id": 39812997, "comment_id": 66917142, "body": "try this <a href=\"http://stackoverflow.com/a/6807784/1371064\">stackoverflow.com/a/6807784/1371064</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "is_accepted": false, "score": 1, "last_activity_date": 1475377985, "creation_date": 1475377985, "answer_id": 39813504, "question_id": 39812997, "link": "https://stackoverflow.com/questions/39812997/run-threads-for-a-certain-amount-of-time-before-being-killed/39813504#39813504", "title": "Run threads for a certain amount of time - before being killed", "body": "<p>Use a wait group and a \"done\" channel to cancel running go routines and and synchronize their exits before calling <code>second</code>. Some really cool stuff on the topic can be read here <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow\">https://blog.golang.org/pipelines</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    //create a \"done\" channel that will be used to signal to all go routines running thread to quit\n    done := make(chan interface{})\n\n    //create a wait group to sync all go routines before continuing program execution\n    wg := new(sync.WaitGroup)\n\n    for i := 0; i &lt; 10; i++ {\n        //increment waitgroup\n        wg.Add(1)\n        go thread(done, wg)\n    }\n    //zzzz...\n    time.Sleep(30 * time.Second)\n    //close the done channel\n    close(done)\n    //wait for all go routines to quit\n    wg.Wait()\n    //move on\n    second()\n}\n\nfunc thread(done chan interface{}, wg *sync.WaitGroup) {\n    defer wg.Done()\n    working := true\n    for working {\n        //use a select statement to do work until done channel is closed\n        select {\n        case &lt;-done:\n            //end the loop\n            working = false\n        default:\n            fmt.Println(\"doing work...\")\n        }\n    }\n}\n\nfunc second() {\n    fmt.Println(\"program complete\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 662, "user_id": 5008952, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/10152729711426706/picture?type=large", "display_name": "Nathan Hyland", "link": "https://stackoverflow.com/users/5008952/nathan-hyland"}, "is_accepted": true, "score": 1, "last_activity_date": 1475389490, "creation_date": 1475389490, "answer_id": 39814445, "question_id": 39812997, "link": "https://stackoverflow.com/questions/39812997/run-threads-for-a-certain-amount-of-time-before-being-killed/39814445#39814445", "title": "Run threads for a certain amount of time - before being killed", "body": "<p>You could use Golang context. Here's some of my code when I was learning it.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"time\"\n\n    \"golang.org/x/net/context\"\n)\n\nfunc main() {\n    someHandler()\n}\n\nfunc someHandler() {\n    //Create a new context with a timeout duration of six seconds. You also get a cancel function you can call early. \n    //You can also have context end at a certain time, instead of a timeout\n    ctx, cancel := context.WithTimeout(context.Background(), time.Second*time.Duration(6))\n\n    for i := 0; i &lt; 5; i++ {\n        go doStuff(ctx, i)\n    }\n\n    select {\n    case &lt;- ctx.Done():\n        log.Println(\"Got a cancel request\")\n        return\n    case &lt;-time.After(time.Second * time.Duration(5)):\n        //Here I'm actually ending it earlier than the timeout with cancel().\n        log.Println(\"Timed out\")\n        cancel()\n    }\n\n}\n\nfunc doStuff(ctx context.Context, num int) {\n    for {\n        select {\n        case &lt;-ctx.Done():\n            fmt.Println(\"Done working\")\n            return\n        default:\n            fmt.Println(\"go\", num, \"working\")\n        }\n        time.Sleep(time.Second)\n    }\n}\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>$ go run app.go \ngo 0 working\ngo 4 working\ngo 2 working\ngo 3 working\ngo 1 working\ngo 1 working\ngo 0 working\ngo 4 working\ngo 3 working\ngo 2 working\ngo 0 working\ngo 4 working\ngo 2 working\ngo 1 working\ngo 3 working\ngo 4 working\ngo 3 working\ngo 0 working\ngo 2 working\ngo 1 working\ngo 3 working\ngo 4 working\ngo 1 working\ngo 0 working\ngo 2 working\n2016/10/01 23:25:23 Timed out\n</code></pre>\n"}], "owner": {"reputation": 2349, "user_id": 653331, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8a4bf914078e4f4732891156dd917d69?s=128&d=identicon&r=PG&f=1", "display_name": "p_mcp", "link": "https://stackoverflow.com/users/653331/p-mcp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 959, "favorite_count": 0, "accepted_answer_id": 39814445, "answer_count": 2, "score": 0, "last_activity_date": 1475389490, "creation_date": 1475371318, "question_id": 39812997, "link": "https://stackoverflow.com/questions/39812997/run-threads-for-a-certain-amount-of-time-before-being-killed", "title": "Run threads for a certain amount of time - before being killed", "body": "<p>How do I run 10 threads, for 30 seconds each, and then return to the program execution? For example, I want </p>\n\n<ol>\n<li>10 threads to be spawned and ran for 30 seconds.</li>\n<li>Then all threads killed</li>\n<li>Then <code>second()</code> to run (i.e. after all threads have finished executing)</li>\n</ol>\n\n<p>So far I have the following however, when I do this, the threads (obviously) keep executing and CPU usage remains at 100% after 30s:</p>\n\n<pre><code>func main(){\n    for i := 0; i &lt; 10; i++{\n        go thread()\n    }\n    time.Sleep(30 * time.Second)\n    second()\n}\n\nfunc thread() {\n    for {\n        // Do stuff\n    }\n}\n</code></pre>\n"}, {"tags": ["xml", "parsing", "go"], "answers": [{"tags": [], "owner": {"reputation": 1057, "user_id": 1750407, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/EobHJ.jpg?s=128&g=1", "display_name": "Wendy Adi", "link": "https://stackoverflow.com/users/1750407/wendy-adi"}, "is_accepted": true, "score": 2, "last_activity_date": 1506535510, "last_edit_date": 1506535510, "creation_date": 1475367378, "answer_id": 39812712, "question_id": 39812310, "link": "https://stackoverflow.com/questions/39812310/golang-xml-parsing-issue/39812712#39812712", "title": "Golang XML Parsing issue", "body": "<p>Since its available online you can use <code>net/http</code> client to retrieve the xml. Then you can use <code>encoding/xml</code> package and convert the response body to struct object, it has <code>xml.Unmarshal</code> method to convert xml string to struct - hence you should write the struct first.</p>\n\n<p><code>net/http</code> example available </p>\n\n<ul>\n<li><a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/</a></li>\n</ul>\n\n<p><code>encoding/xml</code> example </p>\n\n<ul>\n<li><a href=\"https://gist.github.com/kwmt/6135123#file-parsetvdb-go\" rel=\"nofollow noreferrer\">https://gist.github.com/kwmt/6135123#file-parsetvdb-go</a></li>\n</ul>\n"}], "owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 0, "accepted_answer_id": 39812712, "answer_count": 1, "score": 0, "last_activity_date": 1506535510, "creation_date": 1475363342, "question_id": 39812310, "link": "https://stackoverflow.com/questions/39812310/golang-xml-parsing-issue", "title": "Golang XML Parsing issue", "body": "<p>I have just started experimenting with Google's GO (Golang) language, and have run into a problem that I would like to solve efficiently. \nSo I would like to extract some data from an XML file, that is available online (I get it as the response of a polling session), but I don't know how to get started. Should I download the source code of the page, store it locally and extract the data that way or is there a possibility to extract the data without downloading the whole thing? Thank you!</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n</code></pre>\n"}, {"tags": ["c", "linux", "go"], "comments": [{"owner": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 2, "creation_date": 1475348928, "post_id": 39810431, "comment_id": 66912362, "body": "Is this the right site for that type of discussion question?"}, {"owner": {"reputation": 18493, "user_id": 388661, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/61df8d728c699c39c4c73507da598712?s=128&d=identicon&r=PG", "display_name": "davmac", "link": "https://stackoverflow.com/users/388661/davmac"}, "edited": false, "score": 0, "creation_date": 1475348929, "post_id": 39810431, "comment_id": 66912363, "body": "&quot;Although you do have to run these as sudo or as root user&quot; - did it occur to you why this is the case? Does your program that needs to run the lvm commands run as root? If not, it&#39;s not going to be able to use the library functions, presumably."}, {"owner": {"reputation": 53, "user_id": 4013924, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/100000451527380/picture?type=large", "display_name": "InitEnabler", "link": "https://stackoverflow.com/users/4013924/initenabler"}, "reply_to_user": {"reputation": 31114, "user_id": 4142924, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KmZTf.png?s=128&g=1", "display_name": "Weather Vane", "link": "https://stackoverflow.com/users/4142924/weather-vane"}, "edited": false, "score": 0, "creation_date": 1475356040, "post_id": 39810431, "comment_id": 66914274, "body": "@WeatherVane Fixed. Yea, I looked at several times and I agree it is a little lengthy and not very concise."}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 4013924, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/100000451527380/picture?type=large", "display_name": "InitEnabler", "link": "https://stackoverflow.com/users/4013924/initenabler"}, "edited": false, "score": 0, "creation_date": 1475356878, "post_id": 39810638, "comment_id": 66914459, "body": "Those points seem to be a non-issue, particularly my application is not a large web app so it won&#39;t be spawning 100 different processes to change volumes or share metadata. As for security, you are vulnerable to code injection if you don&#39;t check for those types of things. If you take of adding user validation and shell escaping / injection then you should be fine. I&#39;m pretty sure you know all this but this is more for people who are looking at this question and want an aside to the comment. Thanks :)"}], "tags": [], "owner": {"reputation": 33597, "user_id": 2445184, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/0b51ece74c2314ba345a862c4b00d804?s=128&d=identicon&r=PG", "display_name": "cmaster - reinstate monica", "link": "https://stackoverflow.com/users/2445184/cmaster-reinstate-monica"}, "is_accepted": true, "score": 2, "last_activity_date": 1475349981, "creation_date": 1475349981, "answer_id": 39810638, "question_id": 39810431, "link": "https://stackoverflow.com/questions/39810431/cli-vs-pure-c-c-library-for-a-program/39810638#39810638", "title": "CLI vs Pure C/C++ Library for a program?", "body": "<p>There are two things that may make using <code>exec</code> in the different variants a nogo: security and speed.</p>\n\n<ul>\n<li><p>Security: If you shell out with <code>system()</code> or friends, you must be absolutely certain that you don't include any strings in the command that may do funny stuff with your command line. It's the same basic problem as SQL code injection, just at a much lower and even more disastrous layer (<a href=\"https://xkcd.com/327/\" rel=\"nofollow\">obligatory XKCD</a>, just replace \"'); DROP TABLE Students;--\" with valid sh code along the lines of '\"; echo \"pwnd', well, you get the idea).</p></li>\n<li><p>Speed: When you shell out to an existing program, you create a new process, and that may be the performance hit you cannot tolerate. It's perfectly ok if the task for which you shell out takes more than a few milliseconds (process creation is somewhere in the range of a millisecond on linux), but if you want more than a thousand calls per second, you definitely need to avoid this overhead.</p></li>\n</ul>\n\n<p>If these two points are taken care of or proven to be non-issues, then it's perfectly ok to shell out to other processes.</p>\n"}], "owner": {"reputation": 53, "user_id": 4013924, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/100000451527380/picture?type=large", "display_name": "InitEnabler", "link": "https://stackoverflow.com/users/4013924/initenabler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 329, "favorite_count": 0, "closed_date": 1475419930, "accepted_answer_id": 39810638, "answer_count": 1, "score": 0, "last_activity_date": 1475355985, "creation_date": 1475348637, "last_edit_date": 1475355985, "question_id": 39810431, "link": "https://stackoverflow.com/questions/39810431/cli-vs-pure-c-c-library-for-a-program", "closed_reason": "Not suitable for this site", "title": "CLI vs Pure C/C++ Library for a program?", "body": "<p><strong>Background / Context:</strong> I am developing a Linux NAS Server (Like FreeNAS or Rockstor) using Golang, the particular features will be a JSON-REST API so that you can interact with LVM2, shares, packages, etc.</p>\n\n<p><strong>Question:</strong> With respect to security, performance, and development time, what are the advantages / disadvantages / best practices of implmenting spawned processes or using a native library for certain features for a program?</p>\n\n<p><strong>Example:</strong> For my particular use case, the NAS management system will be using LVM2 to manage volumes. However you can use the CLI to manipulate volumes or you can attempt to use the LVM2 native C API and merge it with Golangs <code>cgo</code> package.</p>\n\n<p><em>EDIT: Rephrased my question / information.</em></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 6835547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08040f3ae066f3557e7b01411aa0ea3e?s=128&d=identicon&r=PG&f=1", "display_name": "s3gfault", "link": "https://stackoverflow.com/users/6835547/s3gfault"}, "edited": false, "score": 0, "creation_date": 1475350687, "post_id": 39810043, "comment_id": 66912883, "body": "the problem is if i use go get_page(a) whats is going to happen is my main function is going to end before the loop in other words the output with only go get_page(a) is zero."}, {"owner": {"reputation": 593, "user_id": 8960344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a4695a4739b1539ab219c4d10459c7?s=128&d=identicon&r=PG", "display_name": "Nima Ghotbi", "link": "https://stackoverflow.com/users/8960344/nima-ghotbi"}, "reply_to_user": {"reputation": 35, "user_id": 6835547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08040f3ae066f3557e7b01411aa0ea3e?s=128&d=identicon&r=PG&f=1", "display_name": "s3gfault", "link": "https://stackoverflow.com/users/6835547/s3gfault"}, "edited": false, "score": 0, "creation_date": 1475352252, "post_id": 39810043, "comment_id": 66913296, "body": "you can solve that by using channels, please check out the given example. (The part with &quot;Finally we collect all the results of the work.&quot; description waits until all workers are done)"}], "tags": [], "owner": {"reputation": 593, "user_id": 8960344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a4695a4739b1539ab219c4d10459c7?s=128&d=identicon&r=PG", "display_name": "Nima Ghotbi", "link": "https://stackoverflow.com/users/8960344/nima-ghotbi"}, "is_accepted": false, "score": 0, "last_activity_date": 1475346098, "creation_date": 1475346098, "answer_id": 39810043, "question_id": 39809907, "link": "https://stackoverflow.com/questions/39809907/go-routines-in-a-loop-function-call/39810043#39810043", "title": "GO routines in a loop - function call", "body": "<p>You can use <code>go get_page(a)</code> which start a goroutine for each word on the wordlist, to set maximum concurrent calls use work pool. (<a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow\">https://gobyexample.com/worker-pools</a>)</p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 6835547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08040f3ae066f3557e7b01411aa0ea3e?s=128&d=identicon&r=PG&f=1", "display_name": "s3gfault", "link": "https://stackoverflow.com/users/6835547/s3gfault"}, "edited": false, "score": 0, "creation_date": 1475423304, "post_id": 39812883, "comment_id": 66927587, "body": "Yep got a problem with the concurrency that I didn&#39;t though before ... when we have too many connections to a website the webserver sometimes refuses more than a certain amount of connections, or the firewall even that is timing out the connections giving false information about available resources in the server but thank you for your code works in my Lab :)"}], "tags": [], "owner": {"reputation": 1153, "user_id": 1371064, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/NnrmE.jpg?s=128&g=1", "display_name": "Carlos Andr&#233;s Garc&#237;a", "link": "https://stackoverflow.com/users/1371064/carlos-andr%c3%a9s-garc%c3%ada"}, "is_accepted": false, "score": 1, "last_activity_date": 1475369739, "creation_date": 1475369739, "answer_id": 39812883, "question_id": 39809907, "link": "https://stackoverflow.com/questions/39809907/go-routines-in-a-loop-function-call/39812883#39812883", "title": "GO routines in a loop - function call", "body": "<p>You can use </p>\n\n<blockquote>\n  <p>sync.WaitGroup</p>\n</blockquote>\n\n<p>The only problem is that you have how many concurrent calls you are gonna do.</p>\n\n<p>example </p>\n\n<p>if the wordlist.txt contents this</p>\n\n<pre><code>admin.php \nadmin\nadministrator\nadministrator\n</code></pre>\n\n<p>you know that you will make 4 concurrent calls</p>\n\n<p>if the content is </p>\n\n<pre><code>admin.php\nadmin/\nadministrator/\nadministrator/\nadministrator/\nadministrator/\n</code></pre>\n\n<p>you know you will make 6 concurrent calls.</p>\n\n<p>The code below was make with a file of 3 words</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n\n      \"bufio\"\n   \"net/http\"\n    \"os\"\n)\n\n\nfunc main(){\n\n\n\n    var site string\n    var wg sync.WaitGroup\n\n    if len(os.Args) &gt; 1 {\n        site = os.Args[1]\n    } else {\n        fmt.Println(\"Need the host. Example &gt; http://www.google.com/\")\n        fmt.Println(\"wfuzz http://www.google.com/ wordlist.txt\")\n        site = \"http://www.google.com\"\n        os.Exit(1)\n    }\n\n    f, err := os.Open(os.Args[2])\n\n    if err != nil {\n        fmt.Println(\"error opening file!\", err)\n    }\n\n     wg.Add(3) // TODO check the number of words in the file \n\n\n     scanner := bufio.NewScanner(f)\n     for scanner.Scan() {\n\n        a := site + scanner.Text()\n        go get_page(a,&amp;wg)\n\n    }\n\n    if err := scanner.Err(); err != nil {\n        fmt.Println(\"error\", err)\n    }\n\n\n   wg.Wait()\n   fmt.Println(\"done\")\n\n}\n\n\n\nfunc get_page(site string,wg *sync.WaitGroup)  string{\n    a := \"\\n\"\n\n    defer wg.Done()\n\n    res, err := http.Get(site)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n\n    if res.StatusCode != 404 {\n        fmt.Println(\"Page Found!! +::\", site, \" ::+\", res.StatusCode)\n    }\n    return a\n\n} \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "is_accepted": false, "score": 2, "last_activity_date": 1475375796, "last_edit_date": 1475375796, "creation_date": 1475375475, "answer_id": 39813311, "question_id": 39809907, "link": "https://stackoverflow.com/questions/39809907/go-routines-in-a-loop-function-call/39813311#39813311", "title": "GO routines in a loop - function call", "body": "<p>Using a combination of the Go standard libraries <code>sync.WaitGroup</code> and channels, you can accomplish this without having to explicitly keep track of the number of words in the file your wish to read from. </p>\n\n<p>Modify your <code>get_page</code> (side note: it is not idiomatic go to user underscores in func names -> <a href=\"https://golang.org/doc/effective_go.html#names\" rel=\"nofollow\">https://golang.org/doc/effective_go.html#names</a> ) func to accept an additional channel and wait group and you could do something like the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n    \"sync\"\n)\n\nfunc main() {\n\n    //your previous code for getting the command line arguments from os.Args, then...\n\n    //create a WaitGroup\n    wg := new(sync.WaitGroup)\n\n    //create a channel that you can write your results too\n    resultChan := make(chan string)\n\n    scanner := bufio.NewScanner(f)\n    for scanner.Scan() {\n        //increment the waitgroup\n        wg.Add(1)\n        a := site + scanner.Text()\n        //call the getPage with the http target, with the result chan, and the waitgroup\n        go getPage(a, resultChan, wg)\n    }\n\n    if err := scanner.Err(); err != nil {\n        fmt.Println(\"error\", err)\n        //if there is an error, close the result chan so progam can exit (for more robust cancellation of potential currently running go routines, take a look at https://blog.golang.org/pipelines)\n        close(resultChan)\n    }\n\n    //start another go routine to wait for all concurrent calls to get_page to complete, then close the result channel\n    go func() {\n        wg.Wait()\n        close(resultChan)\n    }()\n\n    for result := range resultChan {\n        //deal with the result in some way\n        fmt.Println(result)\n    }\n\n    fmt.Println(\"done\")\n}\n\n//side note - it is not idiomatic go to use underscores in func name\nfunc getPage(site string, ch chan&lt;- string, wg *sync.WaitGroup) {\n    //decrement waitgroup when operation completes\n    defer wg.Done()\n\n    res, err := http.Get(site)\n    if err != nil {\n        ch &lt;- fmt.Sprintf(\"error: %s\", err)\n        return\n    }\n    if res.StatusCode != 404 {\n        ch &lt;- fmt.Sprintf(\"Page Found!! +:: %s ::+ %d\", site, res.StatusCode)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 6835547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08040f3ae066f3557e7b01411aa0ea3e?s=128&d=identicon&r=PG&f=1", "display_name": "s3gfault", "link": "https://stackoverflow.com/users/6835547/s3gfault"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1042, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1475375796, "creation_date": 1475345322, "question_id": 39809907, "link": "https://stackoverflow.com/questions/39809907/go-routines-in-a-loop-function-call", "title": "GO routines in a loop - function call", "body": "<p><strong>Description of the problem</strong></p>\n\n<p>I want to send a concurrent call to each iteration on my <em>for loop</em>.</p>\n\n<p><strong>Current Code</strong></p>\n\n<p>This program mostly try's to find a valid directory on the server </p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n    var site string\n    if len(os.Args) &gt; 1 {\n        site = os.Args[1]\n    } else {\n        fmt.Println(\"Need the host. Example &gt; http://www.google.com/\")\n        fmt.Println(\"wfuzz http://www.google.com/ wordlist.txt\")\n        site = \"http://www.google.com\"\n        os.Exit(1)\n    }\n    f, err := os.Open(os.Args[2])\n\n    if err != nil {\n        fmt.Println(\"error opening file!\", err)\n    }\n    scanner := bufio.NewScanner(f)\n    for scanner.Scan() {\n        a := site + scanner.Text()\n        get_page(a)\n    }\n    if err := scanner.Err(); err != nil {\n        fmt.Println(\"error\", err)\n    }\n\n    var input string\n    fmt.Scanln(&amp;input)\n    fmt.Println(\"done\")\n\n}\n\nfunc get_page(site string) string {\n    a := \"\\n\"\n    res, err := http.Get(site)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n    if res.StatusCode != 404 {\n        fmt.Println(\"Page Found!! +::\", site, \" ::+\", res.StatusCode)\n    }\n    return a\n}\n</code></pre>\n\n<p><strong>Goal to Achieve</strong></p>\n\n<p>What I want to achieve is mostly send on my for loop concurrent calls that way i would speed up the process and would be the end goal for the current program.</p>\n"}, {"tags": ["go", "dependency-injection", "interface", "type-conversion"], "comments": [{"owner": {"reputation": 1802, "user_id": 754854, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4acefbd570391b3abbae9cab3beeb7f1?s=128&d=identicon&r=PG", "display_name": "JoeMoe1984", "link": "https://stackoverflow.com/users/754854/joemoe1984"}, "edited": false, "score": 0, "creation_date": 1475347989, "post_id": 39807273, "comment_id": 66912050, "body": "It seems that the problem stems from the fact that these two packages have to be so similar that they seem like they do know about eachother by design but you want them not to. The &quot;VideoFile&quot; struct and &quot;File&quot; struct have to be the same for them to work properly yet they are in separate packages/modules. If you were to add a new property to the VideoFile struct like &quot;Director string&quot; then your working solutions fail to save the proper fields or you would have to add that property in the &quot;File&quot; package which negates that fact they should not know about eachother."}, {"owner": {"reputation": 646, "user_id": 4335622, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh5.googleusercontent.com/-OeTdPDQRltk/AAAAAAAAAAI/AAAAAAAAAE4/KXT0pHbxg9s/photo.jpg?sz=128", "display_name": "i.van", "link": "https://stackoverflow.com/users/4335622/i-van"}, "reply_to_user": {"reputation": 1802, "user_id": 754854, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4acefbd570391b3abbae9cab3beeb7f1?s=128&d=identicon&r=PG", "display_name": "JoeMoe1984", "link": "https://stackoverflow.com/users/754854/joemoe1984"}, "edited": false, "score": 0, "creation_date": 1475348256, "post_id": 39807273, "comment_id": 66912136, "body": "Yeah, exactly. These packages are really way too similar and making additional package with common model would be the best way. Anyway I&#39;m just curious if there are any way to do as I&#39;ve described, especially when everything works with anonymous struct way."}, {"owner": {"reputation": 1802, "user_id": 754854, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4acefbd570391b3abbae9cab3beeb7f1?s=128&d=identicon&r=PG", "display_name": "JoeMoe1984", "link": "https://stackoverflow.com/users/754854/joemoe1984"}, "edited": false, "score": 1, "creation_date": 1475348781, "post_id": 39807273, "comment_id": 66912309, "body": "I think you need to model things with the File package first and then utilize the Video package to extend from it by importing that package. That is a very acceptable design choice if you do it that way."}, {"owner": {"reputation": 646, "user_id": 4335622, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh5.googleusercontent.com/-OeTdPDQRltk/AAAAAAAAAAI/AAAAAAAAAE4/KXT0pHbxg9s/photo.jpg?sz=128", "display_name": "i.van", "link": "https://stackoverflow.com/users/4335622/i-van"}, "reply_to_user": {"reputation": 1802, "user_id": 754854, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4acefbd570391b3abbae9cab3beeb7f1?s=128&d=identicon&r=PG", "display_name": "JoeMoe1984", "link": "https://stackoverflow.com/users/754854/joemoe1984"}, "edited": false, "score": 0, "creation_date": 1475348805, "post_id": 39807273, "comment_id": 66912319, "body": "@JoeMoe1984 &quot;If you were to add a new property to the VideoFile struct like &quot;Director string&quot; then your working solutions fail to save the proper fields&quot; If we are using Anonymous struct solution, we will get an error on compilation step coz VideoFile can&#39;t be cast to struct {Name string  Size int}. I want to find something similar."}], "answers": [{"comments": [{"owner": {"reputation": 1802, "user_id": 754854, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4acefbd570391b3abbae9cab3beeb7f1?s=128&d=identicon&r=PG", "display_name": "JoeMoe1984", "link": "https://stackoverflow.com/users/754854/joemoe1984"}, "edited": false, "score": 0, "creation_date": 1475347865, "post_id": 39810262, "comment_id": 66912006, "body": "If I understand correctly, the OP doesn&#39;t want any of the packages to import one another. &quot;they shouldn&#39;t know about each others&#39; structures and interfaces&quot;. Importing the File package would mean that the Video package knows about the Files structures and interfaces."}, {"owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "reply_to_user": {"reputation": 1802, "user_id": 754854, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4acefbd570391b3abbae9cab3beeb7f1?s=128&d=identicon&r=PG", "display_name": "JoeMoe1984", "link": "https://stackoverflow.com/users/754854/joemoe1984"}, "edited": false, "score": 0, "creation_date": 1475348039, "post_id": 39810262, "comment_id": 66912066, "body": "@JoeMoe1984 Thanks, it&#39;s not clear what the OP&#39;s requirements are here, so I added a sentence about extracting mutual dependencies into a third package."}, {"owner": {"reputation": 646, "user_id": 4335622, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh5.googleusercontent.com/-OeTdPDQRltk/AAAAAAAAAAI/AAAAAAAAAE4/KXT0pHbxg9s/photo.jpg?sz=128", "display_name": "i.van", "link": "https://stackoverflow.com/users/4335622/i-van"}, "edited": false, "score": 0, "creation_date": 1475348041, "post_id": 39810262, "comment_id": 66912067, "body": "But it will lead to tight-coupling between to modules. I wanted only Main to know about both packages. In short I want to create FileSaver interface in Main package, cast it to VideoFileSaver and send it to the VideoFileProducer."}, {"owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "reply_to_user": {"reputation": 646, "user_id": 4335622, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh5.googleusercontent.com/-OeTdPDQRltk/AAAAAAAAAAI/AAAAAAAAAE4/KXT0pHbxg9s/photo.jpg?sz=128", "display_name": "i.van", "link": "https://stackoverflow.com/users/4335622/i-van"}, "edited": false, "score": 0, "creation_date": 1475348184, "post_id": 39810262, "comment_id": 66912116, "body": "@i.van Can you elaborate on your coupling concern? In particular, why is it not addressed by extracting the <code>File</code> struct and <code>FileSaver</code> interface into a third package that the <code>file</code> and <code>video</code> packages depend on?"}, {"owner": {"reputation": 646, "user_id": 4335622, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh5.googleusercontent.com/-OeTdPDQRltk/AAAAAAAAAAI/AAAAAAAAAE4/KXT0pHbxg9s/photo.jpg?sz=128", "display_name": "i.van", "link": "https://stackoverflow.com/users/4335622/i-van"}, "edited": false, "score": 0, "creation_date": 1475348586, "post_id": 39810262, "comment_id": 66912247, "body": "@weberc2 I&#39;ve got two packages that doesn&#39;t know about each other. One says &quot;Hey I have interface implementation that has a method that produces the structure that is defined in me&quot;, the other one says &quot;I&#39;m just waiting for someone who have implements the described interface with method to produce the structure that is defined in me&quot;. I don&#39;t know if it possible in Go, I&#39;m just curious about it, especially after seeing that Anonymous struct solution works fine."}, {"owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "reply_to_user": {"reputation": 646, "user_id": 4335622, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh5.googleusercontent.com/-OeTdPDQRltk/AAAAAAAAAAI/AAAAAAAAAE4/KXT0pHbxg9s/photo.jpg?sz=128", "display_name": "i.van", "link": "https://stackoverflow.com/users/4335622/i-van"}, "edited": false, "score": 1, "creation_date": 1475348912, "post_id": 39810262, "comment_id": 66912354, "body": "@i.van I updated my answer. I think this is the best possible solution given the parameters of the question. That said, the parameters themselves suggest a deeper architectural problem--delving into that is probably outside the scope of this Q/A, so feel free to elaborate in your Reddit post: <a href=\"https://www.reddit.com/r/golang/comments/55efmc/casting_between_interfaces_that_describes_same/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/55efmc/&hellip;</a>"}, {"owner": {"reputation": 646, "user_id": 4335622, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh5.googleusercontent.com/-OeTdPDQRltk/AAAAAAAAAAI/AAAAAAAAAE4/KXT0pHbxg9s/photo.jpg?sz=128", "display_name": "i.van", "link": "https://stackoverflow.com/users/4335622/i-van"}, "edited": false, "score": 0, "creation_date": 1475349389, "post_id": 39810262, "comment_id": 66912492, "body": "@weberc2 thanks, I&#39;ve answered in the Reddit post. Making common structure is the really is the most popular decision. But I want to reduce outside dependencies as much as possible. I think, I&#39;m looking for something like Adapter pattern (but with using the language specs)"}], "tags": [], "owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "is_accepted": false, "score": 1, "last_activity_date": 1475348577, "last_edit_date": 1475348577, "creation_date": 1475347479, "answer_id": 39810262, "question_id": 39807273, "link": "https://stackoverflow.com/questions/39807273/identical-structures-in-interfaces/39810262#39810262", "title": "Identical structures in interfaces", "body": "<p>Drop the <code>VideoFile</code> struct and use the <code>File</code> struct in both places. If you don't want a <code>video</code>-><code>file</code> dependency, you'll have to extract the common types (<code>File</code> and <code>FileSaver</code>) into a third package (this works for the same reason as your anonymous struct solution--the \"definition\" of the struct is accessible to both packages).</p>\n\n<p><strong>types package</strong></p>\n\n<pre><code>package types\n\ntype File struct {\n    Name string\n    Size int\n}\n\ntype FileSaver interface {\n    SaveFile(File)\n}\n</code></pre>\n\n<p><strong>file package</strong></p>\n\n<pre><code>package file\n\nimport (\n    \"fmt\"\n    \"types\"\n)\n\ntype fileSaverImpl struct{}\n\nfunc (fs fileSaverImpl) SaveFile(f types.File) {\n    fmt.Println(f.Name, f.Size)\n}\n\nfunc NewFileSaver() types.FileSaver {\n    return fileSaverImpl{}\n}\n</code></pre>\n\n<p><strong>video package</strong></p>\n\n<pre><code>package video\n\nimport \"types\"\n\ntype VideoFileProducer struct{}\n\n// NOTE: This function title is misleading; it doesn't actually\n// create a `VideoFileProducer`, but instead it makes a new file\n// and saves it with the provisioned `FileSaver`.\nfunc NewVideoFileProducer(fileSaver types.FileSaver) {\n    fileSaver.SaveFile(types.File{Name: \"Video\", Size: 256})\n}\n</code></pre>\n\n<p><strong>main package</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"file\"\n    \"video\"\n)\n\nfunc main() {\n    NewVideoFileProducer(file.NewFileSaver())\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 646, "user_id": 4335622, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh5.googleusercontent.com/-OeTdPDQRltk/AAAAAAAAAAI/AAAAAAAAAE4/KXT0pHbxg9s/photo.jpg?sz=128", "display_name": "i.van", "link": "https://stackoverflow.com/users/4335622/i-van"}, "is_accepted": true, "score": 0, "last_activity_date": 1475523888, "creation_date": 1475523888, "answer_id": 39839253, "question_id": 39807273, "link": "https://stackoverflow.com/questions/39807273/identical-structures-in-interfaces/39839253#39839253", "title": "Identical structures in interfaces", "body": "<p>I have implemented a solution that, as I think, satisfies requirements.</p>\n\n<p>It's just an implementation of Adapter pattern. On high level of module hierarchy we create new Service that implements the VideoFileSaver interfaces and calls the FileSaver interface in it.</p>\n\n<p><em>VideoFileSaver</em> --(VideoFile)--> Adapter --(File)--> <em>FileSaver</em></p>\n\n<p><a href=\"https://play.golang.org/p/fO_ML6veWt\" rel=\"nofollow\">https://play.golang.org/p/fO_ML6veWt</a></p>\n\n<p><strong>Pros of this solution</strong>: Extremely low coupling of modules, File struct can even be absolutely different from VideoFile if we add additional logic in adapter </p>\n\n<p><strong>Cons of this solution</strong>: High complexity</p>\n\n<p>I <strong>wouldn't recommend</strong> you to use this solution. It just has satisfied my curiosity but in real project instead of it you should (mostly) use the more simple way to do such things - like creating a common structure in the third module (on the low level of hierarchy). As has been described by weberc2.</p>\n"}], "owner": {"reputation": 646, "user_id": 4335622, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh5.googleusercontent.com/-OeTdPDQRltk/AAAAAAAAAAI/AAAAAAAAAE4/KXT0pHbxg9s/photo.jpg?sz=128", "display_name": "i.van", "link": "https://stackoverflow.com/users/4335622/i-van"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 1, "accepted_answer_id": 39839253, "answer_count": 2, "score": 2, "last_activity_date": 1475523888, "creation_date": 1475328881, "last_edit_date": 1475349498, "question_id": 39807273, "link": "https://stackoverflow.com/questions/39807273/identical-structures-in-interfaces", "title": "Identical structures in interfaces", "body": "<p>I have two separated modules, let's call them</p>\n\n<ol>\n<li>FileSaver</li>\n<li>VideoFileProducer</li>\n</ol>\n\n<hr>\n\n<p>I want to separate them as much as possible, they shouldn't know about each others' structures and interfaces.</p>\n\n<p>FileSaver module has these interfaces and structs: <a href=\"https://play.golang.org/p/OHObk0EPlG\" rel=\"nofollow\">https://play.golang.org/p/OHObk0EPlG</a>\nVideoFileProducer module has these interfaces and structs: \n<a href=\"https://play.golang.org/p/iBOOaSPLc0\" rel=\"nofollow\">https://play.golang.org/p/iBOOaSPLc0</a></p>\n\n<p>As you can see: </p>\n\n<ul>\n<li><code>fileSaver.File</code> is identical to the <code>videoFileProducer.VideoFile</code></li>\n<li><code>fileSaver.FileSaver</code> interface is identical to the <code>videoFileProducer.VideoFileSaver</code> interface (the difference is that the method <code>SaveFile</code> receives different_but_identical structures: <code>File</code> and <code>VideoFile</code>)</li>\n<li><code>fileSaver.fileSaverImpl</code> implements the <code>fileSaver.FileSaver</code> interface</li>\n<li><code>videoFileSaver.NewVideoFileProducer</code> receives implementation of <code>videoFileSaver.VideoFileSaver</code> interface</li>\n</ul>\n\n<p>In Main package I want to Inject FileSaver into the VideoFileProducer:\n<a href=\"https://play.golang.org/p/8B1iMCLLBE\" rel=\"nofollow\">https://play.golang.org/p/8B1iMCLLBE</a></p>\n\n<p>Of course I'm getting an error (<a href=\"https://play.golang.org/p/Eqr2ylKiQ6\" rel=\"nofollow\">https://play.golang.org/p/Eqr2ylKiQ6</a>): </p>\n\n<blockquote>\n  <p>FileSaver does not implement VideoFileSaver (wrong type for SaveFile method)</p>\n  \n  <p>have SaveFile(File)</p>\n  \n  <p>want SaveFile(VideoFile)</p>\n</blockquote>\n\n<p>These two structures are identical, we can easily convert VideoFile to File and File to VideoFile, but anyway they have different types.</p>\n\n<hr>\n\n<p>In short I want to create FileSaver interface in Main package, cast it to VideoFileSaver and send it to the VideoFileProducer.</p>\n\n<p>Or somehow to adapt FileSaver interface to be used as VideoFileSaver interface.</p>\n\n<hr>\n\n<h2>Working solution #1 (anonymous structure)</h2>\n\n<p><a href=\"https://play.golang.org/p/NJRUCCp2xS\" rel=\"nofollow\">https://play.golang.org/p/NJRUCCp2xS</a></p>\n\n<p>This solution uses anonymous structure and it can be too big to declare it as anonymous in so many places (I've got only one method but there can be many of them in real application). </p>\n\n<hr>\n\n<h2>Not working approach #1 (Fileable/VideoFileable interfaces)</h2>\n\n<p><a href=\"https://play.golang.org/p/0rP4nn7j-T\" rel=\"nofollow\">https://play.golang.org/p/0rP4nn7j-T</a></p>\n\n<p>I've tried to make the structure (File,VideoFile) to implement the interface that has a method for conversion it to the specified anonymous structure, but haven't succeeded.</p>\n\n<hr>\n\n<h2>Not working approach #1 (interface{})</h2>\n\n<p><a href=\"https://play.golang.org/p/8Q1KHhzl_g\" rel=\"nofollow\">https://play.golang.org/p/8Q1KHhzl_g</a></p>\n\n<p>Previous approach but with using interface{}. Not working because of Interface Assertion (underlying types are different)</p>\n\n<p>Is there any way to convert interface directly to other type than the underlying one (without using reflection)?</p>\n\n<hr>\n\n<h2>Working solution #2 (Fileable/VideoFileable + interface{})</h2>\n\n<p><a href=\"https://play.golang.org/p/xacNEjFG7D\" rel=\"nofollow\">https://play.golang.org/p/xacNEjFG7D</a></p>\n\n<p>I've combined last two approaches and added the using of switch to check \"is underlying interface identical to the required one\". So now I can to use VideoFileable as Fileable.</p>\n\n<p>However it's not the best-looking solution and I'm still looking for a solution which uses as less anonymous structures and interface{} as possible.</p>\n\n<hr>\n\n<h2>Working solution #3 (Fileable/VideoFileable + reflection)</h2>\n\n<p><a href=\"https://play.golang.org/p/4UPEmNkG-E\" rel=\"nofollow\">https://play.golang.org/p/4UPEmNkG-E</a> </p>\n\n<p>Converting VideoFileable to Fileable</p>\n\n<hr>\n\n<h2>Working solution #4  (interface{} + reflection)</h2>\n\n<p><a href=\"https://play.golang.org/p/AneYQVm2Gc\" rel=\"nofollow\">https://play.golang.org/p/AneYQVm2Gc</a> </p>\n\n<p>VideoFile converts directly to File</p>\n\n<hr>\n\n<hr>\n\n<p>I'm not satisfied with any of the solutions above and still looking for something more clean.</p>\n"}, {"tags": ["python", "go"], "comments": [{"owner": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "edited": false, "score": 4, "creation_date": 1475329043, "post_id": 39807266, "comment_id": 66905852, "body": "Python has optimised <code>+=</code>, avoiding creating a new string object each time; this was done because it is a common error to use <code>+=</code> to concatenate strings in a loop. You shouldn&#39;t use <code>+=</code> if you can avoid it however, use <code>str.join()</code> or just <code>&#39;test&#39; * 100000</code>."}, {"owner": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "edited": false, "score": 2, "creation_date": 1475329171, "post_id": 39807266, "comment_id": 66905898, "body": "See <a href=\"https://stackoverflow.com/q/25503703\">Why is variable1 += variable2 much faster than variable1 = variable1 + variable2</a>"}, {"owner": {"reputation": 881859, "user_id": 100297, "user_type": "moderator", "profile_image": "https://www.gravatar.com/avatar/24780fb6df85a943c7aea0402c843737?s=128&d=identicon&r=PG", "display_name": "Martijn Pieters", "link": "https://stackoverflow.com/users/100297/martijn-pieters"}, "edited": false, "score": 0, "creation_date": 1475329262, "post_id": 39807266, "comment_id": 66905919, "body": "Presumably go is creating new string objects for each concatenation too. Perhaps go has a string concatenation method that can join multiple strings into one in one step?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1475330505, "post_id": 39807266, "comment_id": 66906293, "body": "Related / possible duplicate of <a href=\"http://stackoverflow.com/questions/1760757/how-to-efficiently-concatenate-strings-in-go\">How to efficiently concatenate strings in Go?</a>"}], "owner": {"reputation": 75, "user_id": 4687483, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f692513a8ff3d165e0048d4f784831?s=128&d=identicon&r=PG&f=1", "display_name": "LWH", "link": "https://stackoverflow.com/users/4687483/lwh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 177, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1475329705, "creation_date": 1475328854, "last_edit_date": 1592644375, "question_id": 39807266, "link": "https://stackoverflow.com/questions/39807266/what-is-the-different-from-strings-operation-between-golang-and-python", "title": "What is the different from string&#39;s &quot;+&quot; operation between Golang and Python?", "body": "<p>I found String's &quot;+&quot; operation is so slowly on Go:</p>\n<pre><code>func main() {\n    start := time.Now();\n    s := &quot;&quot;\n    for i:=0;i&lt;100000;i++ {\n        s += &quot;test&quot;\n    }\n    end := time.Now();\n    fmt.Println(end.Sub(start))    //Output 6.495225211s\n}\n</code></pre>\n<p>But Python:</p>\n<pre><code>start = datetime.now()\n\ns = &quot;&quot;\n\nfor i in range(100000):\n    s += 'test'\n\nend = datetime.now()\n\nprint(end - start)    # Output 0:00:00.020291\n</code></pre>\n<p>I know how to optimize the Go code.\nI hope you can tell me why.</p>\n<p>thanks.</p>\n<hr />\n<p>I found a interesting thing on Python:</p>\n<pre><code>s = &quot;&quot;\nfor i in range(20):\n    s += 'test'\n    print(id(s))\n</code></pre>\n<p>the output is:</p>\n<blockquote>\n<p>139842066321960</p>\n<p>139842066396912</p>\n<p>139842066396912</p>\n<p>139842066400072</p>\n<p>139842066400072</p>\n<p>139842067023232</p>\n<p>139842067023232</p>\n<p>139842066384304</p>\n<p>139842066384304</p>\n<p>139842066312528</p>\n</blockquote>\n"}, {"tags": ["arrays", "string", "go"], "comments": [{"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1475345413, "post_id": 39806639, "comment_id": 66911252, "body": "So you want a map that has multiple types for the values ( strings and maps)? You might need to have a map of type map[string]interface{} and convert it too the correct type after."}, {"owner": {"reputation": 431, "user_id": 3705929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625211e431f9a4821e99dd94a148c548?s=128&d=identicon&r=PG&f=1", "display_name": "user3389", "link": "https://stackoverflow.com/users/3705929/user3389"}, "reply_to_user": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1475432667, "post_id": 39806639, "comment_id": 66930682, "body": "could you give advice how to convert such string columns[0][orderable] to map? It&#39;s not json. I thought about use regex and then create a map, but I think it&#39;s not the best solution. Thank you"}], "answers": [{"comments": [{"owner": {"reputation": 431, "user_id": 3705929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625211e431f9a4821e99dd94a148c548?s=128&d=identicon&r=PG&f=1", "display_name": "user3389", "link": "https://stackoverflow.com/users/3705929/user3389"}, "edited": false, "score": 0, "creation_date": 1475524597, "post_id": 39832283, "comment_id": 66968567, "body": "This data came from url, I got it from GET request"}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1475499551, "creation_date": 1475499551, "answer_id": 39832283, "question_id": 39806639, "link": "https://stackoverflow.com/questions/39806639/how-to-convert-string-to-mapintstring-in-golang/39832283#39832283", "title": "How to convert string to map[int]string in Golang", "body": "<p>If the above is the raw input it might make more sense to have some structs, ie: <a href=\"https://play.golang.org/p/Wy4dsxorXw\" rel=\"nofollow\">https://play.golang.org/p/Wy4dsxorXw</a></p>\n"}], "owner": {"reputation": 431, "user_id": 3705929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625211e431f9a4821e99dd94a148c548?s=128&d=identicon&r=PG&f=1", "display_name": "user3389", "link": "https://stackoverflow.com/users/3705929/user3389"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 698, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1475499551, "creation_date": 1475325142, "question_id": 39806639, "link": "https://stackoverflow.com/questions/39806639/how-to-convert-string-to-mapintstring-in-golang", "title": "How to convert string to map[int]string in Golang", "body": "<p>I stuck with a problem convert string to map.\nI've got next data from url</p>\n\n<pre><code>map[\nstart:0 \ndraw:1 \nlength:10 \n_:1475090278299 \nsearch[value]:\nsearch[regex]:false \norder[0][dir]:asc \norder[0][column]:0 \n\ncolumns[0][orderable]:true\ncolumns[0][searchable]:true  \ncolumns[0][search][value]: \ncolumns[0][search][regex]:false \ncolumns[0][data]:name \ncolumns[0][name]: \n\ncolumns[1][orderable]:true\ncolumns[1][searchable]:true \ncolumns[1][search][value]: \ncolumns[1][search][regex]:false \ncolumns[1][data]:slug \ncolumns[1][name]: \n\ncolumns[2][orderable]:true \ncolumns[2][searchable]:true \ncolumns[2][search][value]:\ncolumns[2][search][regex]:false \ncolumns[2][data]:status\ncolumns[2][name]: \n\ncolumns[3][orderable]:true\ncolumns[3][searchable]:true \ncolumns[3][search][value]: \ncolumns[3][search][regex]:false \ncolumns[3][data]:created_at\ncolumns[3][name]: \n]\n</code></pre>\n\n<p>I can get these values start:0, draw:1, length:10. But also I want to get columns and orders as a map[int]string not as a string.</p>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 744, "user_id": 1392953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/111f7728dfee50bdca97cb8dcf195e9f?s=128&d=identicon&r=PG", "display_name": "Eric Lindsey", "link": "https://stackoverflow.com/users/1392953/eric-lindsey"}, "edited": false, "score": 0, "creation_date": 1557509577, "post_id": 39806983, "comment_id": 98802853, "body": "Since using an array simplifies the code, I&#39;d like to do that. How does one specify that in a struct? I get <code>cannot use [5][2]string literal (type [5][2]string) as type [][]string in field value</code> when I try to assign the array to what I guess I&#39;m telling Go is a slice."}, {"owner": {"reputation": 744, "user_id": 1392953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/111f7728dfee50bdca97cb8dcf195e9f?s=128&d=identicon&r=PG", "display_name": "Eric Lindsey", "link": "https://stackoverflow.com/users/1392953/eric-lindsey"}, "edited": false, "score": 0, "creation_date": 1557510661, "post_id": 39806983, "comment_id": 98803350, "body": "Figured it out myself, and edited the answer to add the information."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 744, "user_id": 1392953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/111f7728dfee50bdca97cb8dcf195e9f?s=128&d=identicon&r=PG", "display_name": "Eric Lindsey", "link": "https://stackoverflow.com/users/1392953/eric-lindsey"}, "edited": false, "score": 1, "creation_date": 1557521085, "post_id": 39806983, "comment_id": 98807495, "body": "@EricLindsey While your edit is good, I&#39;m still going to reject it because I don&#39;t want to encourage the use of arrays just because initialization is easier. In Go, arrays are secondary, slices are the way to go. For details, see <a href=\"https://stackoverflow.com/questions/28957190/what-is-the-fastest-way-to-append-one-array-to-another-in-go/28957229#28957229\">What is the fastest way to append one array to another in Go?</a> Arrays have their places too, for details, see <a href=\"https://stackoverflow.com/questions/38645175/why-have-arrays-in-go/38645895#38645895\">Why have arrays in Go?</a>"}, {"owner": {"reputation": 744, "user_id": 1392953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/111f7728dfee50bdca97cb8dcf195e9f?s=128&d=identicon&r=PG", "display_name": "Eric Lindsey", "link": "https://stackoverflow.com/users/1392953/eric-lindsey"}, "edited": false, "score": 0, "creation_date": 1557554844, "post_id": 39806983, "comment_id": 98812604, "body": "fair enough, but I believe the information still has merit. What I was trying to explain with my edit was that if you need the flexibility of differing dimensions between objects then slices are the way to go. On the other hand, if your information is rigidly structured and will always be the same, then arrays are not only easier to initialize, they are also more efficient. How could I improve the edit?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 744, "user_id": 1392953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/111f7728dfee50bdca97cb8dcf195e9f?s=128&d=identicon&r=PG", "display_name": "Eric Lindsey", "link": "https://stackoverflow.com/users/1392953/eric-lindsey"}, "edited": false, "score": 0, "creation_date": 1557572467, "post_id": 39806983, "comment_id": 98816037, "body": "@EricLindsey I see you made another edit which was already rejected by others. In your edit you were saying to use arrays to have faster element access. Note that Go optimizes many things, and this may not be the case, slices may be just as fast. For details, see <a href=\"https://stackoverflow.com/questions/30525184/array-vs-slice-accessing-speed\">Array vs Slice: accessing speed</a>."}, {"owner": {"reputation": 744, "user_id": 1392953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/111f7728dfee50bdca97cb8dcf195e9f?s=128&d=identicon&r=PG", "display_name": "Eric Lindsey", "link": "https://stackoverflow.com/users/1392953/eric-lindsey"}, "edited": false, "score": 0, "creation_date": 1557597998, "post_id": 39806983, "comment_id": 98822060, "body": "I don&#39;t understand why the second edit was rejected. Perhaps I should start a new question, &quot;Why have arrays in Go if you can&#39;t find information on SO about how to use them in a struct?&quot; Thank you @icza for at least providing a reason for the first reject. In the article you linked, global arrays perform significantly better in the benchmark, and with the 1.8 optimization in the other answer on that question, they are more than three times better than slices. I&#39;m going to give up on trying to contribute information to this answer now, since people clearly don&#39;t want it here."}, {"owner": {"reputation": 328, "user_id": 7062272, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JMrN7.jpg?s=128&g=1", "display_name": "somenickname", "link": "https://stackoverflow.com/users/7062272/somenickname"}, "edited": false, "score": 0, "creation_date": 1580166706, "post_id": 39806983, "comment_id": 106001575, "body": "I want to point out that the easy way of initializing an array has a constraint -- you can only use literal or constant number as dimensions, but not variables, otherwise it gives the error   <code>non-constant array bound variable_name</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 183, "last_activity_date": 1475340254, "last_edit_date": 1495540976, "creation_date": 1475327283, "answer_id": 39806983, "question_id": 39804861, "link": "https://stackoverflow.com/questions/39804861/what-is-a-concise-way-to-create-a-2d-slice-in-go/39806983#39806983", "title": "What is a concise way to create a 2D slice in Go?", "body": "<p>There isn't a more concise way, what you did is the \"right\" way; because slices are always one-dimensional but may be composed to construct higher-dimensional objects. See this question for more details: <a href=\"https://stackoverflow.com/questions/39561140/go-how-is-two-dimensional-arrays-memory-representation\">Go: How is two dimensional array&#39;s memory representation</a>.</p>\n\n<p>One thing you can simplify on it is to use the <code>for range</code> construct:</p>\n\n<pre><code>a := make([][]uint8, dy)\nfor i := range a {\n    a[i] = make([]uint8, dx)\n}\n</code></pre>\n\n<p>Also note that if you initialize your slice with a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"noreferrer\">composite literal</a>, you get this for \"free\", for example:</p>\n\n<pre><code>a := [][]uint8{\n    {0, 1, 2, 3},\n    {4, 5, 6, 7},\n}\nfmt.Println(a) // Output is [[0 1 2 3] [4 5 6 7]]\n</code></pre>\n\n<p>Yes, this has its limits as seemingly you have to enumerate all the elements; but there are some tricks, namely you don't have to enumerate all values, only the ones that are not the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\">zero values</a> of the element type of the slice. For more details about this, see <a href=\"https://stackoverflow.com/questions/36302441/keyed-items-in-golang-array-initialization\">Keyed items in golang array initialization</a>.</p>\n\n<p>For example if you want a slice where the first 10 elements are zeros, and then follows <code>1</code> and <code>2</code>, it can be created like this:</p>\n\n<pre><code>b := []uint{10: 1, 2}\nfmt.Println(b) // Prints [0 0 0 0 0 0 0 0 0 0 1 2]\n</code></pre>\n\n<p>Also note that if you'd use <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"noreferrer\">arrays</a> instead of <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"noreferrer\">slices</a>, it can be created very easily:</p>\n\n<pre><code>c := [5][5]uint8{}\nfmt.Println(c)\n</code></pre>\n\n<p>Output is:</p>\n\n<pre><code>[[0 0 0 0 0] [0 0 0 0 0] [0 0 0 0 0] [0 0 0 0 0] [0 0 0 0 0]]\n</code></pre>\n\n<p>In case of arrays you don't have to iterate over the \"outer\" array and initialize \"inner\" arrays, as arrays are not descriptors but values. See blog post <a href=\"https://blog.golang.org/slices\" rel=\"noreferrer\">Arrays, slices (and strings): The mechanics of 'append'</a> for more details.</p>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/YN4K-vqybs\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 9230, "user_id": 426877, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/5a287a2bae7fdcf36c8ea27174d959d2?s=128&d=identicon&r=PG", "display_name": "Magnus", "link": "https://stackoverflow.com/users/426877/magnus"}, "edited": false, "score": 2, "creation_date": 1563897177, "post_id": 53575298, "comment_id": 100849532, "body": "<a href=\"https://golang.org/doc/effective_go.html#slices\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#slices</a> shows a clever way to do the contiguous memory technique leveraging slice-native syntax (eg no need to explicitly calculate slice boundaries with expressions like (i+1)*m)"}], "tags": [], "owner": {"reputation": 151, "user_id": 4450674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oCtmu.png?s=128&g=1", "display_name": "Marcos Canales Mayo", "link": "https://stackoverflow.com/users/4450674/marcos-canales-mayo"}, "is_accepted": false, "score": 15, "last_activity_date": 1554914156, "last_edit_date": 1554914156, "creation_date": 1543700349, "answer_id": 53575298, "question_id": 39804861, "link": "https://stackoverflow.com/questions/39804861/what-is-a-concise-way-to-create-a-2d-slice-in-go/53575298#53575298", "title": "What is a concise way to create a 2D slice in Go?", "body": "<p>There are two ways to use slices to create a matrix. Let's take a look at the differences between them.</p>\n\n<p>First method:</p>\n\n<pre><code>matrix := make([][]int, n)\nfor i := 0; i &lt; n; i++ {\n    matrix[i] = make([]int, m)\n}\n</code></pre>\n\n<p>Second method:</p>\n\n<pre><code>matrix := make([][]int, n)\nrows := make([]int, n*m)\nfor i := 0; i &lt; n; i++ {\n    matrix[i] = rows[i*m : (i+1)*m]\n}\n</code></pre>\n\n<p>In regards to the first method, making successive <code>make</code> calls doesn't ensure that you will end up with a contiguous matrix, so you may have the matrix divided in memory. Let's think of an example with two Go routines that could cause this:</p>\n\n<ol>\n<li>The routine #0 runs <code>make([][]int, n)</code> to get allocated memory for <code>matrix</code>, getting a piece of memory from 0x000 to 0x07F.</li>\n<li>Then, it starts the loop and does the first row <code>make([]int, m)</code>, getting from 0x080 to 0x0FF.</li>\n<li>In the second iteration it gets preempted by the scheduler.</li>\n<li>The scheduler gives the processor to routine #1 and it starts running. This one also uses <code>make</code> (for its own purposes) and gets from 0x100 to 0x17F (right next to the first row of routine #0).</li>\n<li>After a while, it gets preempted and routine #0 starts running again.</li>\n<li>It does the <code>make([]int, m)</code> corresponding to the second loop iteration and gets from 0x180 to 0x1FF for the second row. At this point, we already got two divided rows.</li>\n</ol>\n\n<p>With the second method, the routine does <code>make([]int, n*m)</code> to get all the matrix allocated in a single slice, ensuring contiguity. After that, a loop is needed to update the matrix pointers to the subslices corresponding to each row.</p>\n\n<p>You can play with the code shown above in the <a href=\"https://play.golang.org/p/8gulJLAWaEe\" rel=\"noreferrer\">Go Playground</a> to see the difference in the memory assigned by using both methods. Note that I used <code>runtime.Gosched()</code> only with the purpose of yielding the processor and forcing the scheduler to switch to another routine.</p>\n\n<p>Which one to use? Imagine the worst case with the first method, i.e. each row is not next in memory to another row. Then, if your program iterates through the matrix elements (to read or write them), there will probably be more cache misses (hence higher latency) compared to the second method because of worse data locality. On the other hand, with the second method it may not be possible to get a single piece of memory allocated for the matrix, because of memory fragmentation (chunks spread all over the memory), even though theoretically there may be enough free memory for it.</p>\n\n<p>Therefore, unless there's a lot of memory fragmentation and the matrix to be allocated is huge enough, you would always want to use the second method to get advantage of data locality.</p>\n"}], "owner": {"reputation": 2277, "user_id": 4591810, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/61e63df3db53ef926974e7a2dafd3cf7?s=128&d=identicon&r=PG&f=1", "display_name": "hazrmard", "link": "https://stackoverflow.com/users/4591810/hazrmard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95941, "favorite_count": 37, "accepted_answer_id": 39806983, "answer_count": 2, "score": 122, "last_activity_date": 1585144439, "creation_date": 1475313060, "question_id": 39804861, "link": "https://stackoverflow.com/questions/39804861/what-is-a-concise-way-to-create-a-2d-slice-in-go", "title": "What is a concise way to create a 2D slice in Go?", "body": "<p>I am learning Go by going through <a href=\"https://tour.golang.org/list\" rel=\"noreferrer\">A Tour of Go</a>. One of the exercises there asks me to create a 2D slice of <code>dy</code> rows and <code>dx</code> columns containing <code>uint8</code>. My current approach, which works, is this:  </p>\n\n<pre><code>a:= make([][]uint8, dy)       // initialize a slice of dy slices\nfor i:=0;i&lt;dy;i++ {\n    a[i] = make([]uint8, dx)  // initialize a slice of dx unit8 in each of dy slices\n}\n</code></pre>\n\n<p>I think that iterating through each slice to initialize it is too verbose. And if the slice had more dimensions, the code would become unwieldy. Is there a concise way to initialize 2D (or n-dimensional) slices in Go?  </p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 4, "creation_date": 1475291545, "post_id": 39802596, "comment_id": 66897268, "body": "This is a textbook example of not how to do balance updates because you&#39;re opening yourself up to race conditions and are attempting to mitigate that with locks, a mechanism that&#39;s bound to blow up in your face eventually. For anything involving money or money-like currency, <b>always</b> record individual debits and credits, <b>never</b> directly assign balances based on potentially out-of-date information. Do things like <code>SET balance=balance+?</code> instead, that is atomic and <i>will</i> work. Use <b>transactions</b>, not locks, to ensure atomicity and integrity."}, {"owner": {"reputation": 6339, "user_id": 304778, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/CD3Vg.jpg?s=128&g=1", "display_name": "secmask", "link": "https://stackoverflow.com/users/304778/secmask"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1475292557, "post_id": 39802596, "comment_id": 66897410, "body": "yup, I have tried many solution, such as use <i>transactions</i> (I used it in above with <code>tx.Beginx</code>, and set mysql isolation level to <code>SERIALIZABLE</code> , but it still did not work as expect. My situation need to read the row outside, validate something, then update it with new value, it should make sure balance is not changed since last query, is there a way to archive this?"}, {"owner": {"reputation": 6339, "user_id": 304778, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/CD3Vg.jpg?s=128&g=1", "display_name": "secmask", "link": "https://stackoverflow.com/users/304778/secmask"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1475292793, "post_id": 39802596, "comment_id": 66897439, "body": "because I need some validation before decide to update <code>balance</code>, then I cannt use <code>SET balance=balance+?</code> ..."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 2, "creation_date": 1475293446, "post_id": 39802596, "comment_id": 66897531, "body": "Validate all you want, but do use a <i>differential</i> update when you get around to doing it and always, always have a complete record of how the balance ended up that way. Every single alteration should be recorded as a row in some table."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1475307159, "post_id": 39803742, "comment_id": 66900009, "body": "@secmark, please be sure to read and understand <a href=\"http://go-database-sql.org/\" rel=\"nofollow noreferrer\">this tutorial</a>. Go approach to working with databases is different from those of other popular platforms, and you have to be aware of these differences."}, {"owner": {"reputation": 1069, "user_id": 161243, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f0020af3ba3c0c7ec0d8dac2503fc26?s=128&d=identicon&r=PG", "display_name": "rajya vardhan", "link": "https://stackoverflow.com/users/161243/rajya-vardhan"}, "edited": false, "score": 0, "creation_date": 1526986142, "post_id": 39803742, "comment_id": 87944666, "body": "thank you, thank you so so much!! Been banging my head around for this issue."}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 4, "last_activity_date": 1475303782, "creation_date": 1475303782, "answer_id": 39803742, "question_id": 39802596, "link": "https://stackoverflow.com/questions/39802596/mysql-safe-read-update-write/39803742#39803742", "title": "mysql safe read - update - write", "body": "<p>You misused the transaction. The <code>db</code> <strong>is not</strong> in transaction, only <code>tx</code> is. So, the statements in first and second go routine which are</p>\n\n<pre><code>err = db.Get(w1, \"SELECT * FROM test_wallet WHERE id=? FOR UPDATE\", wID) // read and lock the record\nerr = db.Get(w2, \"SELECT * FROM test_wallet WHERE id=? FOR UPDATE\", wID)\n</code></pre>\n\n<p>will not lock the row, because <code>db</code> is not wrapped in transaction. You must use <code>tx</code> to execute the query, i.e.</p>\n\n<pre><code>err = tx.Get(w1, \"SELECT * FROM test_wallet WHERE id=? FOR UPDATE\", wID) // read and lock the record\nerr = tx.Get(w2, \"SELECT * FROM test_wallet WHERE id=? FOR UPDATE\", wID)\n</code></pre>\n\n<p>After modification, I got the following result:</p>\n\n<pre><code>2016/10/01 13:26:10 got &amp;{ID:6ff45acd-701c-458f-a17f-84cc4e982c80 Balance:10} on r1\n2016/10/01 13:26:14 done on r1\n2016/10/01 13:26:14 got &amp;{ID:6ff45acd-701c-458f-a17f-84cc4e982c80 Balance:15} on r2\n2016/10/01 13:26:14 done on r2\n2016/10/01 13:26:14 &amp;{ID:6ff45acd-701c-458f-a17f-84cc4e982c80 Balance:22}\n</code></pre>\n"}], "owner": {"reputation": 6339, "user_id": 304778, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/CD3Vg.jpg?s=128&g=1", "display_name": "secmask", "link": "https://stackoverflow.com/users/304778/secmask"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2986, "favorite_count": 2, "accepted_answer_id": 39803742, "answer_count": 1, "score": 4, "last_activity_date": 1475303782, "creation_date": 1475290834, "question_id": 39802596, "link": "https://stackoverflow.com/questions/39802596/mysql-safe-read-update-write", "title": "mysql safe read - update - write", "body": "<p>I'm try to understand mysql lock record mechanic, this is show case in Golang\nor here <a href=\"https://play.golang.org/p/2fGKEyh0Wl\" rel=\"nofollow\">https://play.golang.org/p/2fGKEyh0Wl</a></p>\n\n<p>it run 2 concurrent transactions, and they read-update on the same row<br>\n- the first transaction will try to lock the row, do something (sleep for 3 secs)<br>\n- the second then try to read-update on the same key    </p>\n\n<p>the test source code</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/jmoiron/sqlx\"\n    \"github.com/satori/go.uuid\"\n    \"log\"\n    \"sync\"\n    \"time\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\ntype Wallet struct {\n    ID      string\n    Balance int64\n}\n\nfunc main() {\n    db, err := sqlx.Connect(\"mysql\", \"root:abc123@tcp(mysql:3306)/test?parseTime=true\")\n    if err != nil {\n        log.Println(err)\n        return\n    }\n    db.Exec(`CREATE TABLE test_wallet (\n    id varchar(64) NOT NULL,\n    balance bigint(20) DEFAULT NULL,\n    PRIMARY KEY (id)\n    ) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n    `)\n    var wg sync.WaitGroup\n    wg.Add(2)\n\n    wID := uuid.NewV4().String()\n    db.Exec(\"INSERT INTO test_wallet (id,balance) VALUES (?,?)\", wID, 10)\n\n    go func() {\n        defer wg.Done()\n        tx, err := db.Beginx()\n        w1 := &amp;Wallet{}\n        err = db.Get(w1, \"SELECT * FROM test_wallet WHERE id=? FOR UPDATE\", wID) // read and lock the record\n        if err != nil {\n            log.Println(err)\n        }\n        log.Printf(\"got %+v on r1\\n\", w1)\n        time.Sleep(time.Second * 3)\n        res, err := tx.Exec(\"UPDATE test_wallet SET balance=? WHERE id=?\", w1.Balance+5, wID)\n        if err != nil {\n            log.Println(err)\n        }\n        n, err := res.RowsAffected()\n        if n != 1 {\n            log.Println(\"update not affected r1\")\n        }\n        tx.Commit()\n        log.Println(\"done on r1\")\n    }()\n\n    time.Sleep(time.Second) // make sure go-routine lock `id` row\n\n    go func() {\n        defer wg.Done()\n        tx, err := db.Beginx()\n        w2 := &amp;Wallet{}\n        err = db.Get(w2, \"SELECT * FROM test_wallet WHERE id=? FOR UPDATE\", wID)\n        if err != nil {\n            log.Println(err)\n        }\n        log.Printf(\"got %+v on r2\\n\", w2)\n        res, err := tx.Exec(\"UPDATE test_wallet SET balance=? WHERE id=?\", w2.Balance+7, wID)\n        if err != nil {\n            log.Println(err)\n        }\n        n, err := res.RowsAffected()\n        if n != 1 {\n            log.Println(\"update not affected r2\")\n        }\n        tx.Commit()\n        log.Println(\"done on r2\")\n    }()\n    wg.Wait()\n    w := &amp;Wallet{}\n    err = db.Get(w, \"SELECT * FROM test_wallet WHERE id=?\", wID)\n    if err != nil {\n        log.Println(err)\n    }\n    log.Printf(\"%+v\\n\", w)\n}\n</code></pre>\n\n<p>result from my terminal</p>\n\n<pre><code>2016/10/01 09:57:00 got &amp;{ID:aab7165c-4b3b-406d-b1d0-caf3f45f72be Balance:10} on r1\n2016/10/01 09:57:01 got &amp;{ID:aab7165c-4b3b-406d-b1d0-caf3f45f72be Balance:10} on r2\n2016/10/01 09:57:01 done on r2\n2016/10/01 09:57:03 done on r1\n2016/10/01 09:57:03 &amp;{ID:aab7165c-4b3b-406d-b1d0-caf3f45f72be Balance:15}\n</code></pre>\n\n<p>it seem the second routine has not been lock ???</p>\n"}, {"tags": ["arrays", "go", "struct", "slice"], "answers": [{"tags": [], "owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "is_accepted": true, "score": 6, "last_activity_date": 1475284563, "creation_date": 1475284563, "answer_id": 39802074, "question_id": 39801833, "link": "https://stackoverflow.com/questions/39801833/how-do-i-store-different-structs-in-a-slice-or-a-struct-in-go-not-embedding/39802074#39802074", "title": "How do I STORE different structs in a slice or a struct in Go (Not embedding)", "body": "<p>I think  interface{} is what you're after. For example like this:</p>\n\n<pre><code>type A struct {\n    data string\n}\n\ntype B struct {\n     data int\n}\n\nfunc printData(s interface{}) {\n     switch s.(type) {\n         case A:\n             fmt.Printf(\"A: %s\\n\", s.(A).data)\n         case B:\n             fmt.Printf(\"B: %d\\n\", s.(B).data)\n     }\n }\n\n func main() {\n     classes := []interface{}{A{data: \"first\"}, B{data: 2}, A{data: \"third\"}}\n     for _, c := range classes {\n         printData(c)\n     }\n }\n</code></pre>\n\n<p>This is probably as close as you can get to \"duck typing\" in go.</p>\n\n<p>Though if your structs are really that similar, you might better off defining a common interface instead and implementing that interface for each struct. Here is same example using interfaces:</p>\n\n<pre><code>type DataGetter interface {\n    getDate() string\n}\n\ntype A struct {\n    data string\n}\n\nfunc (a A) getDate() string {\n    return a.data\n}\n\ntype B struct {\n    data int\n}\n\nfunc (b B) getDate() string {\n    return fmt.Sprintf(\"%d\", b.data)\n}\n\nfunc printData(s DataGetter) {\n    fmt.Printf(\"%s\\n\", s.getDate())\n}\n\nfunc main() {\n\n    classes := []DataGetter{A{data: \"first\"}, B{data: 2}, A{data: \"third\"}}\n    for _, c := range classes {\n        printData(c)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1475, "user_id": 5203951, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/fd9dc7df52e3a9be33094cd877e3f8fb?s=128&d=identicon&r=PG", "display_name": "Yami Odymel", "link": "https://stackoverflow.com/users/5203951/yami-odymel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2725, "favorite_count": 0, "accepted_answer_id": 39802074, "answer_count": 1, "score": 3, "last_activity_date": 1475284563, "creation_date": 1475281946, "question_id": 39801833, "link": "https://stackoverflow.com/questions/39801833/how-do-i-store-different-structs-in-a-slice-or-a-struct-in-go-not-embedding", "title": "How do I STORE different structs in a slice or a struct in Go (Not embedding)", "body": "<p>I am new to Golang, after I took a tour of <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow\">A Tour of Go</a>, I'm trying to make my own thing.</p>\n\n<h2>What I want</h2>\n\n<p>I want to put different types of the structs into a single slice (or struct?),</p>\n\n<p>so I can use a <code>for</code> loop to <strong>pass each struct to a function</strong>.</p>\n\n<h2>For example</h2>\n\n<p>In PHP I can store my classes in an array and pass each of them to <code>foobar()</code> like this:</p>\n\n<pre><code>$classes = [$A, $B, $C, $D];  // $A, $B, $C, $D are classes (called `struct` in Golang).\n\nforeach ($classes as $class)\n    foobar($class);\n</code></pre>\n\n<h2>What I tried</h2>\n\n<p>I tried to do the same in Golang, and I hope it looks like this:</p>\n\n<pre><code>A{B{}, C{}, D{}}\n</code></pre>\n\n<p>Since I failed on using <code>slice</code>, I decided to use <code>struct</code> to hold my <code>structs</code>:</p>\n\n<pre><code>type A struct {\n    B\n    C\n    D\n}\n\ntype B struct {\n    Date string\n}\n\ntype C struct {\n    Date string\n}\n\ntype D struct {\n    Date string\n}\n\nfunc main() {   \n    // Using reflect to loop the A struct: \n    // http://stackoverflow.com/questions/18926303/iterate-through-a-struct-in-go\n    v := reflect.ValueOf(A{})\n\n    for i := 0; i &lt; v.NumField(); i++ {\n        foobar(v.Field(i).Interface()) // Passing each struct to the `foobar()` function\n    }\n}\n</code></pre>\n\n<p>But it seems like I'm actually doing embedding instead of storing them, any suggestions please?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 11, "last_activity_date": 1475299412, "last_edit_date": 1475299412, "creation_date": 1475273371, "answer_id": 39800763, "question_id": 39800700, "link": "https://stackoverflow.com/questions/39800700/waitgroup-is-reused-before-previous-wait-has-returned/39800763#39800763", "title": "WaitGroup is reused before previous Wait has returned", "body": "<p>In your recursive cases in <code>ThreadSafeCalcWords</code>, you're calling <code>wg.Done</code> <em>before</em> calling <code>wg.Add</code>. That means that the wg can drop down to 0 (which will trigger the <code>Wait</code> to complete) before you actually finish all the work. Calling <code>Add</code> again while the <code>Wait</code> is still in the process of resolving is what triggers the error, but more importantly, it probably just plain isn't what you want. </p>\n\n<p>Change the order of operations so that you always <code>Add</code> any new work before doing <code>Done</code> on the existing work, and the <code>Wait</code> won't trigger prematurely. The simplest way to accomplish this would probably be a single call to <code>wg.Done()</code> at the bottom of the function, or a single <code>defer</code> at the top, and removing all the others.</p>\n"}], "owner": {"reputation": 444, "user_id": 4682816, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/A5AbC.gif?s=128&g=1", "display_name": "scigs", "link": "https://stackoverflow.com/users/4682816/scigs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6000, "favorite_count": 0, "accepted_answer_id": 39800763, "answer_count": 1, "score": 8, "last_activity_date": 1475299412, "creation_date": 1475273026, "question_id": 39800700, "link": "https://stackoverflow.com/questions/39800700/waitgroup-is-reused-before-previous-wait-has-returned", "title": "WaitGroup is reused before previous Wait has returned", "body": "<p>So im getting further into using golang and looking more into the concurrency it offers. I decided to try to use go routines to implement permutations of strings in a phone number. </p>\n\n<p>I am running into issues using sync.WaitGroup to coordinate the go routines that i have been using. the specific error being:</p>\n\n<p><code>WaitGroup is reused before previous Wait has returned</code></p>\n\n<p>the code being:</p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n\n    \"github.com/sbiscigl/phonenumberperm/intstack\"\n    \"github.com/sbiscigl/phonenumberperm/permutations\"\n)\n\nvar wg sync.WaitGroup\n\nfunc main() {\n    num := []int{2, 7, 1, 4, 5, 5, 2}    \n    stack := intstack.New(num)\n    permutationChannel := make(chan string)\n    wg.Add(1)\n    go permutations.ThreadSafeCalcWords(stack, \"\", permutationChannel, &amp;wg)\n    wg.Wait()\n    /*Then consume, but not implimented*/\n}\n</code></pre>\n\n<p>permutations/perm.go</p>\n\n<pre><code>package permutations\n\nimport (\n    \"fmt\"\n    \"sync\"\n\n    \"github.com/sbiscigl/phonenumberperm/intstack\"\n)\n\nvar letterMap = map[int][]string{\n    2: []string{\"a\", \"b\", \"c\"},\n    3: []string{\"d\", \"e\", \"f\"},\n    4: []string{\"g\", \"h\", \"i\"},\n    5: []string{\"j\", \"k\", \"l\"},\n    6: []string{\"m\", \"n\", \"o\"},\n    7: []string{\"p\", \"q\", \"r\", \"s\"},\n    8: []string{\"t\", \"u\", \"v\"},\n    9: []string{\"w\", \"x\", \"y\", \"z\"},\n}\n\nfunc ThreadSafeCalcWords(s intstack.IntStack, word string, ch chan&lt;- string,\n    wg *sync.WaitGroup) {\n    if s.IsEmpty() {\n        ch &lt;- fmt.Sprint(word)\n        wg.Done()\n    } else {\n        /*Check to see if the values are 1 or zero as they*/\n        /*have no letters associated with them*/\n        if s.Peek() == 1 || s.Peek() == 0 {\n            wg.Done()\n            s.Pop()\n            wg.Add(1)\n            go ThreadSafeCalcWords(s, word, ch, wg)\n        } else {\n            wg.Done()\n            for _, letter := range letterMap[s.Pop()] {\n                wg.Add(1)\n                go ThreadSafeCalcWords(s, word+letter, ch, wg)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>intstack/intstack.go</p>\n\n<pre><code>package intstack\n\nimport \"fmt\"\n\nconst (\n    maxSize = 100\n)\n\n/*IntStack implimentaiton of a stack for integers*/\ntype IntStack struct {\n    valueList []int\n    maxSize   int\n}\n\n/*New returns bew instace of IntStack*/\nfunc New(nums []int) IntStack {\n    return IntStack{\n        valueList: nums,\n        maxSize:   maxSize,\n    }\n}\n\n/*Pop pops the top value off the stack*/\nfunc (s *IntStack) Pop() int {\n    var val int\n    if !s.IsEmpty() {\n        val = s.valueList[0]\n        s.valueList = s.valueList[1:]\n    } else {\n        fmt.Println(\"stack is empty\")\n    }\n    return val\n}\n\n/*Peek returns top value*/\nfunc (s IntStack) Peek() int {\n    return s.valueList[0]\n}\n\n/*IsEmpty checks if the stack is empty*/\nfunc (s IntStack) IsEmpty() bool {\n    if len(s.valueList) &gt; 0 {\n        return false\n    }\n    return true\n}\n\n/*Print prints out the contents of the stack*/\nfunc (s IntStack) Print() {\n    for _, element := range s.valueList {\n        fmt.Print(element)\n    }\n    fmt.Print(\"\\n\")\n}\n</code></pre>\n\n<p>So after research that line is called during wg.Wait() or rathe wait groups wait function. I tried to replicate with a smaller program, but could not. My hypothesis is that once it reaches the the Wait() after it calls the the go routine, that we can no longer edit the wait group, but that sounds wrong. any insight into why this would be happening would be helpful</p>\n\n<p>repo for refrence can be found at: <a href=\"https://github.com/sbiscigl/phonenumberperm\" rel=\"noreferrer\">https://github.com/sbiscigl/phonenumberperm</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1278, "user_id": 2036231, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/nYM74.png?s=128&g=1", "display_name": "Jose Bagatelli", "link": "https://stackoverflow.com/users/2036231/jose-bagatelli"}, "edited": false, "score": 1, "creation_date": 1475275232, "post_id": 39799684, "comment_id": 66894522, "body": "Please post some example of your code"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 1, "creation_date": 1475307347, "post_id": 39799684, "comment_id": 66900063, "body": "see: How do I execute commands many times per second in Golang: <a href=\"http://stackoverflow.com/questions/39385883/how-do-i-execute-commands-many-many-times-per-second-in-golang\" title=\"how do i execute commands many many times per second in golang\">stackoverflow.com/questions/39385883/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": false, "score": 1, "last_activity_date": 1475297449, "creation_date": 1475297449, "answer_id": 39803151, "question_id": 39799684, "link": "https://stackoverflow.com/questions/39799684/limit-the-number-of-times-a-ping-a-hostname-every-second/39803151#39803151", "title": "Limit the number of times a ping a hostname every second", "body": "<p>A <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow\">channel</a> provides a concurrent synchronization mechanism you can use to coordinate with. You could use one in coordination with a <a href=\"https://golang.org/pkg/time/#Ticker\" rel=\"nofollow\"><code>time.Ticker</code></a> to periodically dispatch a given number of function calls.</p>\n\n<pre><code>// A PeriodicResource is a channel that is rebuffered periodically.\ntype PeriodicResource &lt;-chan bool\n\n// The NewPeriodicResourcePool provides a buffered channel that is filled after the\n// given duration. The size of the channel is given as count. This provides\n// a way of limiting an function to count times per duration.\nfunc NewPeriodicResource(count int, reset time.Duration) PeriodicResource {\n    ticker := time.NewTicker(reset)\n    c := make(chan bool, count)\n\n    go func() {\n        for {\n            // Await the periodic timer\n            &lt;-ticker.C\n\n            // Fill the buffer\n            for i := len(c); i &lt; count; i++ {\n                c &lt;- true\n            }\n        }\n    }()\n\n    return c\n}\n</code></pre>\n\n<p>A single go routine waits for each ticker event and attempts to fill a buffered channel to max capacity. If a consumer does not deplete the buffer any successive tick only refills it. You can use the channel to synchronously perform an action at most <strong>n</strong> times per <strong>duration</strong>. For example, I may want to call <code>doSomething()</code> no more than five times per second.</p>\n\n<pre><code>r := NewPeriodicResource(5, time.Second)\nfor {\n        // Attempt to deque from the PeriodicResource\n        &lt;-r\n\n        // Each call is synchronously drawing from the periodic resource\n        doSomething()\n}\n</code></pre>\n\n<p>Naturally, the same channel could be used to call <code>go doSomething()</code> which would fan out at most <strong>five</strong> processes per <strong>second</strong>.</p>\n"}], "owner": {"reputation": 708, "user_id": 2348668, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/01a3034479d75cafcbb36061ed78cdf9?s=128&d=identicon&r=PG", "display_name": "user2348668", "link": "https://stackoverflow.com/users/2348668/user2348668"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1475297449, "creation_date": 1475267661, "question_id": 39799684, "link": "https://stackoverflow.com/questions/39799684/limit-the-number-of-times-a-ping-a-hostname-every-second", "title": "Limit the number of times a ping a hostname every second", "body": "<p>I am writing a web crawler to learn go</p>\n\n<p>My current implementation uses 10 go routines to get websites, I want to limit the number of times I can hit a hostname every second.</p>\n\n<p>What is the best (thread-safe) approach to do this.</p>\n"}, {"tags": ["go", "popen"], "comments": [{"owner": {"reputation": 265968, "user_id": 116, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/f6flX.jpg?s=128&g=1", "display_name": "Mark Harrison", "link": "https://stackoverflow.com/users/116/mark-harrison"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1475266802, "post_id": 39799415, "comment_id": 66891674, "body": "@MarioAlexandroSantini, not a duplicate.  I&#39;m not looking for system-V IPC such as shmget."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475269075, "post_id": 39799415, "comment_id": 66892607, "body": "You&#39;re trying to Read into a slice of length 0, so you can&#39;t read any data. There needs to be something to read <i>into</i> (see <code>out</code> in my example)."}, {"owner": {"reputation": 265968, "user_id": 116, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/f6flX.jpg?s=128&g=1", "display_name": "Mark Harrison", "link": "https://stackoverflow.com/users/116/mark-harrison"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1475270141, "post_id": 39799415, "comment_id": 66893010, "body": "That works perfectly.  Thanks for the insight!"}, {"owner": {"reputation": 265968, "user_id": 116, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/f6flX.jpg?s=128&g=1", "display_name": "Mark Harrison", "link": "https://stackoverflow.com/users/116/mark-harrison"}, "reply_to_user": {"reputation": 5175, "user_id": 4370109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UcQgO.jpg?s=128&g=1", "display_name": "Brian Tompsett - \u6c64\u83b1\u6069", "link": "https://stackoverflow.com/users/4370109/brian-tompsett-%e6%b1%a4%e8%8e%b1%e6%81%a9"}, "edited": false, "score": 0, "creation_date": 1475277995, "post_id": 39799415, "comment_id": 66895146, "body": "@BrianTompsett-\u6c64\u83b1\u6069, that&#39;s the same suggestion that MarioAlexandroSantin made (and deleted?).  It&#39;s not a duplicate, as that question seems to revolve around system-V IPC."}, {"owner": {"reputation": 5175, "user_id": 4370109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UcQgO.jpg?s=128&g=1", "display_name": "Brian Tompsett - \u6c64\u83b1\u6069", "link": "https://stackoverflow.com/users/4370109/brian-tompsett-%e6%b1%a4%e8%8e%b1%e6%81%a9"}, "edited": false, "score": 0, "creation_date": 1475312941, "post_id": 39799415, "comment_id": 66901329, "body": "Noted and retracted. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1475268082, "last_edit_date": 1475268082, "creation_date": 1475266713, "answer_id": 39799469, "question_id": 39799415, "link": "https://stackoverflow.com/questions/39799415/go-bidirectional-communication-with-another-process/39799469#39799469", "title": "Go: bidirectional communication with another process?", "body": "<p>An <code>exec.Cmd</code> has fields for the process stdin, std, and stderr which you can assign.</p>\n\n<pre><code>    // Stdin specifies the process's standard input.\n    // If Stdin is nil, the process reads from the null device (os.DevNull).\n    // If Stdin is an *os.File, the process's standard input is connected\n    // directly to that file.\n    // Otherwise, during the execution of the command a separate\n    // goroutine reads from Stdin and delivers that data to the command\n    // over a pipe. In this case, Wait does not complete until the goroutine\n    // stops copying, either because it has reached the end of Stdin\n    // (EOF or a read error) or because writing to the pipe returned an error.\n    Stdin io.Reader\n\n    // Stdout and Stderr specify the process's standard output and error.\n    //\n    // If either is nil, Run connects the corresponding file descriptor\n    // to the null device (os.DevNull).\n    //\n    // If Stdout and Stderr are the same writer, at most one\n    // goroutine at a time will call Write.\n    Stdout io.Writer\n    Stderr io.Writer\n</code></pre>\n\n<p>If you want a pre-made pipe to connected to any of those, you can use the <code>*Pipe()</code> methods</p>\n\n<pre><code>func (c *Cmd) StderrPipe() (io.ReadCloser, error)\nfunc (c *Cmd) StdinPipe() (io.WriteCloser, error)\nfunc (c *Cmd) StdoutPipe() (io.ReadCloser, error)\n</code></pre>\n\n<p>A basic example using the <code>dc</code> program (sans error checking):</p>\n\n<pre><code>cmd := exec.Command(\"dc\")\nstdin, _ := cmd.StdinPipe()\nstdout, _ := cmd.StdoutPipe()\ncmd.Start()\n\nstdin.Write([]byte(\"12 34 +p\\n\"))\n\nout := make([]byte, 1024)\nn, _ := stdout.Read(out)\n\nfmt.Println(\"OUTPUT:\", string(out[:n]))\n\n// prints \"OUTPUT: 46\"\n</code></pre>\n"}], "owner": {"reputation": 265968, "user_id": 116, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/f6flX.jpg?s=128&g=1", "display_name": "Mark Harrison", "link": "https://stackoverflow.com/users/116/mark-harrison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2245, "favorite_count": 0, "accepted_answer_id": 39799469, "answer_count": 1, "score": 1, "last_activity_date": 1475278216, "creation_date": 1475266423, "last_edit_date": 1495541342, "question_id": 39799415, "link": "https://stackoverflow.com/questions/39799415/go-bidirectional-communication-with-another-process", "title": "Go: bidirectional communication with another process?", "body": "<p><strong><em>(note) not a dupe of <a href=\"https://stackoverflow.com/questions/9366550/go-inter-process-communication\">Go Inter-Process Communication</a> which is asking about System V IPC. (end note)</em></strong></p>\n\n<p>Using <code>os/exec</code>, how do I interactively communicate with another process? I'd like to get fd's for the process's stdin and stdout, and write to and read from the process using those fds.</p>\n\n<p>Most examples I have found involve running another process and then slurping the resulting output.</p>\n\n<p>Here's the python equivalent of what I'm looking for.  </p>\n\n<pre><code>p = subprocess.Popen(\"cmd\", stdin=subprocess.PIPE, stdout=subprocess.PIPE)\n(child_stdin, child_stdout) = (p.stdin, p.stdout)\n</code></pre>\n\n<p>As a tangible example, consider opening a pipe to dc, sending the line <code>12 34 +p</code> and receiving the line <code>46</code>.</p>\n\n<p><strong>(update)</strong></p>\n\n<pre><code>func main() {\n  cmd := exec.Command(\"dc\")\n  stdin, err := cmd.StdinPipe()\n  must(err)\n  stdout, err := cmd.StdoutPipe()\n  must(err)\n\n  err = cmd.Start()\n  must(err)\n\n  fmt.Fprintln(stdin, \"2 2 +p\")\n\n  line := []byte{}\n  n, err := stdout.Read(line)\n\n  fmt.Printf(\"%d :%s:\\n\", n, line)\n}\n</code></pre>\n\n<p>I see by strace that <code>dc</code> is receiving and answering as expected:</p>\n\n<pre><code>[pid  8089] write(4, \"12 23 +p\\n\", 9 &lt;unfinished ...&gt;\n...\n[pid  8095] &lt;... read resumed&gt; \"12 23 +p\\n\", 4096) = 9\n...\n[pid  8095] write(1, \"35\\n\", 3 &lt;unfinished ...&gt;\n</code></pre>\n\n<p>but I don't seem to be getting the results back into my calling program:</p>\n\n<pre><code>0 ::\n</code></pre>\n\n<p><strong>(update)</strong> </p>\n\n<p>As per the accepted answer, my problem was not allocating the string to receive the response.  Changing to <code>line := make([]byte, 100)</code> fixed everything.</p>\n"}, {"tags": ["http", "go", "gzip", "mux"], "answers": [{"comments": [{"owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "edited": false, "score": 0, "creation_date": 1575532028, "post_id": 39798516, "comment_id": 104600079, "body": "It&#39;s actually <code>--data-binary&#39;</code>."}], "tags": [], "owner": {"reputation": 416, "user_id": 4032638, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "suppandi g", "link": "https://stackoverflow.com/users/4032638/suppandi-g"}, "is_accepted": false, "score": 0, "last_activity_date": 1475262520, "creation_date": 1475262520, "answer_id": 39798516, "question_id": 39797732, "link": "https://stackoverflow.com/questions/39797732/golang-accept-gzipped-data-on-post/39798516#39798516", "title": "golang accept gzipped data on post", "body": "<p>had to use --binary-data on curl instead of --data</p>\n"}], "owner": {"reputation": 416, "user_id": 4032638, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "suppandi g", "link": "https://stackoverflow.com/users/4032638/suppandi-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 250, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1475262520, "creation_date": 1475259660, "question_id": 39797732, "link": "https://stackoverflow.com/questions/39797732/golang-accept-gzipped-data-on-post", "title": "golang accept gzipped data on post", "body": "<p>I am trying to send some data that is gzipped on a post to a golang server and use it gunzipped in the post. Basically, i do the following input</p>\n\n<pre><code>curl -X POST -H \"Content-Encoding: gzip\" -d @helloworld.gz http://myapp/\n</code></pre>\n\n<p>on the server side</p>\n\n<pre><code>func PostEndpoint(w http.ResponseWriter, req *http.Request) {\n   gunzip, err := gzip.NewReader(req.Body)\n   if err != nil {\n      log.Println(\"error unzip: \",err)\n   }\n   body , _ := ioutil.ReadAll(gunzip)\n}\n</code></pre>\n\n<p>I keep getting a EOF error. I tried to print the raw bytes with <code>ioutil.ReadAll(req.Body)</code> and it is not really the full data i sent in from curl. </p>\n\n<p>Is there something that needs to be configured to mux? right now i create it as</p>\n\n<pre><code>router := mux.NewRouter()\nrouter.HandleFunc(\"/\", GetEndpoint).Methods(\"GET\")\nrouter.HandleFunc(\"/\", PostEndpoint).Methods(\"POST\")\nlog.Fatal(http.ListenAndServe(\":80\", router))\n</code></pre>\n"}, {"tags": ["go", "hash", "struct", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1475248318, "creation_date": 1475248318, "answer_id": 39794757, "question_id": 39794721, "link": "https://stackoverflow.com/questions/39794721/how-to-convert-go-struct-to-c-struct/39794757#39794757", "title": "How to convert Go struct to C struct?", "body": "<p>You can use the <code>unsafe</code> package to cast the data. The Go compiler can no longer check the types here, so it's up to you to ensure that the size and type of everything is identical between <code>C.struct_hash</code> and <code>Hash</code>.</p>\n\n<pre><code>Chash := *(*C.struct_hash)(unsafe.Pointer(&amp;hash))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 113, "user_id": 4002702, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4c995ad0bf81e069876f183eca38fb10?s=128&d=identicon&r=PG&f=1", "display_name": "hui zhang", "link": "https://stackoverflow.com/users/4002702/hui-zhang"}, "is_accepted": false, "score": 1, "last_activity_date": 1481252672, "creation_date": 1481252672, "answer_id": 41052448, "question_id": 39794721, "link": "https://stackoverflow.com/questions/39794721/how-to-convert-go-struct-to-c-struct/41052448#41052448", "title": "How to convert Go struct to C struct?", "body": "<p>consider the align in c \nyou can not simply do the cast.\nthe best way should be  assign  value 1 by 1 from c to go or go to c.\nBut this process is painful is the struct is large and struct contain struct</p>\n"}], "owner": {"reputation": 2717, "user_id": 725174, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/fff0bcbc94ad04659527dcd14e7b0442?s=128&d=identicon&r=PG", "display_name": "Pawe\u0142 Bylica", "link": "https://stackoverflow.com/users/725174/pawe%c5%82-bylica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 981, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1481252672, "creation_date": 1475248206, "question_id": 39794721, "link": "https://stackoverflow.com/questions/39794721/how-to-convert-go-struct-to-c-struct", "title": "How to convert Go struct to C struct?", "body": "<p>I want to use cgo. On the C side I have struct containing 32 bytes.</p>\n\n<pre><code>struct hash {\n    uint8_t bytes[32];\n};\n</code></pre>\n\n<p>On the Go size I have very similar type.</p>\n\n<pre><code>type Hash [32]bytes\n</code></pre>\n\n<p>I would like to call a C function <code>void f(struct hash)</code> with an instance of <code>Hash</code> type. If possible I would also like to avoid a copy of the value.</p>\n\n<p>Simple assignment <code>Chash C.struct_hash := hash</code> does not work:</p>\n\n<blockquote>\n  <p>cannot use hash (type Hash) as type C.struct_hash in assignment</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 2, "creation_date": 1475242398, "post_id": 39792766, "comment_id": 66878442, "body": "Why not format it unconditionally?"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 5, "creation_date": 1475243610, "post_id": 39792766, "comment_id": 66879213, "body": "This is built-in to the <code>gofmt</code> program: <code>gofmt -l ...</code>"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1475244455, "post_id": 39792766, "comment_id": 66879788, "body": "you could always run <code>md5sum</code> before and after to be sure the file hasn&#39;t changed even if the timestamp has."}, {"owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "reply_to_user": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 1, "creation_date": 1564723291, "post_id": 39792766, "comment_id": 101131426, "body": "@coredump because if changes were made they would need to be committed which would break the flow; the build job is to assert not mutate"}], "answers": [{"tags": [], "owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "is_accepted": true, "score": 9, "last_activity_date": 1475253618, "creation_date": 1475253618, "answer_id": 39796269, "question_id": 39792766, "link": "https://stackoverflow.com/questions/39792766/checking-to-find-out-if-go-code-has-been-formatted/39796269#39796269", "title": "Checking to find out if go code has been formatted", "body": "<p>According to <code>gofmt -h</code> you can use <code>-l</code> option:</p>\n\n<blockquote>\n  <p>-l    list files whose formatting differs from gofmt's`</p>\n</blockquote>\n\n<p>Something like:</p>\n\n<pre><code>&gt; gofmt -l .\n</code></pre>\n\n<p>And pass the received list of files further.</p>\n"}, {"tags": [], "owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "is_accepted": false, "score": 5, "last_activity_date": 1475403711, "creation_date": 1475403711, "answer_id": 39815997, "question_id": 39792766, "link": "https://stackoverflow.com/questions/39792766/checking-to-find-out-if-go-code-has-been-formatted/39815997#39815997", "title": "Checking to find out if go code has been formatted", "body": "<p>I found this pre-commit hook <a href=\"https://tip.golang.org/misc/git/pre-commit\" rel=\"noreferrer\">enter link description here</a></p>\n\n<pre><code>1   #!/bin/sh\n 2  # Copyright 2012 The Go Authors. All rights reserved.\n 3  # Use of this source code is governed by a BSD-style\n 4  # license that can be found in the LICENSE file.\n 5  \n 6  # git gofmt pre-commit hook\n 7  #\n 8  # To use, store as .git/hooks/pre-commit inside your repository and make sure\n 9  # it has execute permissions.\n10  #\n11  # This script does not handle file names that contain spaces.\n12  \n13  gofiles=$(git diff --cached --name-only --diff-filter=ACM | grep '\\.go$')\n14  [ -z \"$gofiles\" ] &amp;&amp; exit 0\n15  \n16  unformatted=$(gofmt -l $gofiles)\n17  [ -z \"$unformatted\" ] &amp;&amp; exit 0\n18  \n19  # Some files are not gofmt'd. Print message and fail.\n20  \n21  echo &gt;&amp;2 \"Go files must be formatted with gofmt. Please run:\"\n22  for fn in $unformatted; do\n23      echo &gt;&amp;2 \"  gofmt -w $PWD/$fn\"\n24  done\n25  \n26  exit 1\n</code></pre>\n"}], "owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3921, "favorite_count": 2, "accepted_answer_id": 39796269, "answer_count": 2, "score": 9, "last_activity_date": 1475403711, "creation_date": 1475242273, "question_id": 39792766, "link": "https://stackoverflow.com/questions/39792766/checking-to-find-out-if-go-code-has-been-formatted", "title": "Checking to find out if go code has been formatted", "body": "<p>My goal is to enforce the formatting of go source code on commit.  Is there a way to find out if running <code>go fmt</code> over a file/set of files would make any changes? The only technique I can think of is to:</p>\n\n<ul>\n<li>store the current time <em>t</em></li>\n<li>run go fmt over the source</li>\n<li>iterate the source files to see if any of the last mod dates > <em>t</em></li>\n</ul>\n\n<p>I could write a tool/script to do this and execute during circle CI build. I wanted to check that I'm not reinventing the wheel before I go ahead.</p>\n"}, {"tags": ["c++", "c", "algorithm", "go"], "comments": [{"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1475238552, "post_id": 39791544, "comment_id": 66876046, "body": "I am not sure if this is the correct place to ask this question. Please don&#39;t downvote."}, {"owner": {"reputation": 7412, "user_id": 1488799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c2305b305275c01ab2d410e25b7a8c9?s=128&d=identicon&r=PG", "display_name": "Gassa", "link": "https://stackoverflow.com/users/1488799/gassa"}, "edited": false, "score": 0, "creation_date": 1475238855, "post_id": 39791544, "comment_id": 66876233, "body": "This looks no easier than <a href=\"https://en.wikipedia.org/wiki/Exact_cover\" rel=\"nofollow noreferrer\">exact cover problem</a> but with weights, so I&#39;d say a polynomial solution is unlikely."}, {"owner": {"reputation": 7412, "user_id": 1488799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c2305b305275c01ab2d410e25b7a8c9?s=128&d=identicon&r=PG", "display_name": "Gassa", "link": "https://stackoverflow.com/users/1488799/gassa"}, "edited": false, "score": 0, "creation_date": 1475239048, "post_id": 39791544, "comment_id": 66876352, "body": "In this problem, if there are only few IDs (say, at most 20), I&#39;d go with a dynamic programming solution: f (<code>s</code>: subset of IDs) = maximum possible discount for any set of offers giving exactly subset <code>s</code>."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "reply_to_user": {"reputation": 7412, "user_id": 1488799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c2305b305275c01ab2d410e25b7a8c9?s=128&d=identicon&r=PG", "display_name": "Gassa", "link": "https://stackoverflow.com/users/1488799/gassa"}, "edited": false, "score": 0, "creation_date": 1475239280, "post_id": 39791544, "comment_id": 66876498, "body": "I have edited my question. Sometimes best combination will not be <code>exact cover </code> of a set. (note: I have changed value of o5 to 30)"}, {"owner": {"reputation": 7412, "user_id": 1488799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c2305b305275c01ab2d410e25b7a8c9?s=128&d=identicon&r=PG", "display_name": "Gassa", "link": "https://stackoverflow.com/users/1488799/gassa"}, "edited": false, "score": 1, "creation_date": 1475239326, "post_id": 39791544, "comment_id": 66876514, "body": "So, you have to check all possible subsets, not just the whole set. The algorithm complexity remains the same."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "reply_to_user": {"reputation": 7412, "user_id": 1488799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c2305b305275c01ab2d410e25b7a8c9?s=128&d=identicon&r=PG", "display_name": "Gassa", "link": "https://stackoverflow.com/users/1488799/gassa"}, "edited": false, "score": 0, "creation_date": 1475239480, "post_id": 39791544, "comment_id": 66876608, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/124645/discussion-between-jagrati-and-gassa\">continue this discussion in chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1475494677, "post_id": 39792597, "comment_id": 66950855, "body": "Is there any efficient algorithm to represent <code>setOfItems by a binary number of length k</code>"}, {"owner": {"reputation": 7412, "user_id": 1488799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c2305b305275c01ab2d410e25b7a8c9?s=128&d=identicon&r=PG", "display_name": "Gassa", "link": "https://stackoverflow.com/users/1488799/gassa"}, "reply_to_user": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 1, "creation_date": 1475495101, "post_id": 39792597, "comment_id": 66951059, "body": "@Jagrati Sure. First, assign consecutive integers to all items, starting from zero. After that, each setOfItems is just a sum of 2^i for all indices i present in the set. For example, for set {0, 3, 4}, the binary representation is 2^0 + 2^3 + 2^4 = 11001 in binary."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1475495242, "post_id": 39792597, "comment_id": 66951131, "body": "I have one more doubt. Will this support cases where for a particular set there are two entries with different offerNumber and Discount?"}, {"owner": {"reputation": 7412, "user_id": 1488799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c2305b305275c01ab2d410e25b7a8c9?s=128&d=identicon&r=PG", "display_name": "Gassa", "link": "https://stackoverflow.com/users/1488799/gassa"}, "reply_to_user": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1475500848, "post_id": 39792597, "comment_id": 66954691, "body": "Sure, the <code>for each o in offer</code> loop goes through all you give it."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1475502075, "post_id": 39792597, "comment_id": 66955518, "body": "I am really new to this. can you please tell me how will I do this : <code>s &amp; o.setOfItems == 0</code> and <code>s + o.setOfItems</code> where <code>s</code> is a number from 0 to 2^k -1 and <code>o.setOfItems</code> is also a number from <code>0 to 2^k -1</code> . Sorry for bothering you so much !!"}, {"owner": {"reputation": 7412, "user_id": 1488799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c2305b305275c01ab2d410e25b7a8c9?s=128&d=identicon&r=PG", "display_name": "Gassa", "link": "https://stackoverflow.com/users/1488799/gassa"}, "reply_to_user": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1475530098, "post_id": 39792597, "comment_id": 66971154, "body": "@Jagrati &amp; is <a href=\"http://stackoverflow.com/questions/24105938/golang-bitwise-operations-as-well-as-general-byte-manipulation\">bitwise and</a>, and + is just a regular + which adds together two integers."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1475573251, "post_id": 39792597, "comment_id": 66985587, "body": "I have another problem which is similar to this question. Please help if you can: <a href=\"http://stackoverflow.com/questions/39847065/algorithm-to-find-best-combination-of-offers-depending-on-constraints\" title=\"algorithm to find best combination of offers depending on constraints\">stackoverflow.com/questions/39847065/&hellip;</a>"}], "tags": [], "owner": {"reputation": 7412, "user_id": 1488799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c2305b305275c01ab2d410e25b7a8c9?s=128&d=identicon&r=PG", "display_name": "Gassa", "link": "https://stackoverflow.com/users/1488799/gassa"}, "is_accepted": true, "score": 3, "last_activity_date": 1475246990, "last_edit_date": 1475246990, "creation_date": 1475241725, "answer_id": 39792597, "question_id": 39791544, "link": "https://stackoverflow.com/questions/39791544/algorithm-to-get-best-combination/39792597#39792597", "title": "Algorithm to get best combination", "body": "<p>Here is a dynamic programming solution which, for every possible subset of IDs, finds the combination of offers for which the discount is maximum possible.\nThis will be pseudocode.</p>\n\n<p>Let our offers be structures with fields <code>offerNumber</code>, <code>setOfItems</code> and <code>discount</code>.\nFor the purposes of implementation, we first renumerate the possible items by integers from zero to number of different possible items (say <code>k</code>) minus one.\nAfter that, we can represent <code>setOfItems</code> by a binary number of length <code>k</code>.\nFor example, if <code>k</code> = 6 and <code>setOfItems</code> = 101110<sub>2</sub>, this set includes items 5, 3, 2 and 1 and excludes items 4 and 0, since bits 5, 3, 2 and 1 are ones and bits 4 and 0 are zeroes.</p>\n\n<p>Now let <code>f[s]</code> be the best discount we can get using exactly set <code>s</code> of items.\nHere, <code>s</code> can be any integer between 0 and 2<sup>k</sup> - 1, representing one of the 2<sup>k</sup> possible subsets.\nFurthermore, let <code>p[s]</code> be the list of offers which together allow us to get discount <code>f[s]</code> for the set of items <code>s</code>.\nThe algorithm goes as follows.</p>\n\n<pre><code>initialize f[0] to zero, p[0] to empty list\ninitialize f[&gt;0] to minus infinity\ninitialize bestF to 0, bestP to empty list\nfor each s from 0 to 2^k - 1:\n    for each o in offers:\n        if s &amp; o.setOfItems == o.setOfItems:  // o.setOfItems is a subset of s\n            if f[s] &lt; f[s - o.setOfItems] + o.discount:  // minus is set subtraction\n                f[s] = f[s - o.setOfItems] + o.discount\n                p[s] = p[s - o.setOfItems] append o.offerNumber\n                if bestF &lt; f[s]:\n                    bestF = f[s]\n                    bestP = p[s]\n</code></pre>\n\n<p>After that, <code>bestF</code> is the best possible discount, and <code>bestP</code> is the list of offers which get us that discount.</p>\n\n<p>The complexity is O (|offers| * 2<sup>k</sup>) where <code>k</code> is the total number of items.</p>\n\n<p>Here is another implementation which is asymptotically the same, but might be faster in practice when most subsets are unreachable.\nIt is \"forward\" instead of \"backward\" dynamic programming.</p>\n\n<pre><code>initialize f[0] to zero, p[0] to empty list\ninitialize f[&gt;0] to -1\ninitialize bestF to 0, bestP to empty list\nfor each s from 0 to 2^k - 1:\n    if f[s] &gt;= 0:  // only for reachable s\n        if bestF &lt; f[s]:\n            bestF = f[s]\n            bestP = p[s]\n        for each o in offers:\n            if s &amp; o.setOfItems == 0:  // s and o.setOfItems don't intersect\n                if f[s + o.setOfItems] &lt; f[s] + o.discount:  // plus is set addition\n                    f[s + o.setOfItems] = f[s] + o.discount\n                    p[s + o.setOfItems] = p[s] append o.offerNumber\n</code></pre>\n"}], "owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 0, "accepted_answer_id": 39792597, "answer_count": 1, "score": 0, "last_activity_date": 1475398574, "creation_date": 1475238447, "last_edit_date": 1475398574, "question_id": 39791544, "link": "https://stackoverflow.com/questions/39791544/algorithm-to-get-best-combination", "title": "Algorithm to get best combination", "body": "<p>I have items with ID <code>1, 3, 4, 5, 6, 7</code>. Now I have data like following.\nThere is an offerId for each row. <code>Array of Ids</code> consist of combination of the <code>ID</code> in an array. <code>Discount</code> is the value for that <code>offerId</code></p>\n\n<pre><code>offerId : Array of Ids     : Discount\no1      : [1]              : 45\no2      : [1 3 4]          : 100\no3      : [3 5]            : 55\no4      : [5]              : 40\no5      : [6]              : 30\no6      : [6 7]            : 20\n</code></pre>\n\n<p>Now I have to select all the offerIds which give me best combination of Ids i.e. maximum total discount. </p>\n\n<p>For example in above case : possible results can be:</p>\n\n<p>[o2, o4, o5] maximum discount is <code>170(100 + 40 + 30)</code>.</p>\n\n<p>Note. the result offerId should be such that Ids don't repeat. Example for <code>o2,o4,o6</code> ids are [1,3,4], [5], [6] all are distinct.</p>\n\n<p>Other combination can be :\n<code>o1, o3, 06</code> for which ids are [1], [3,5], [6,7] However the total is 120(45+55+20) which is less then <code>170</code> as in previous case. </p>\n\n<p>I need an algorithm/code which will help me to identify <code>combination of offerIds</code> which will give <code>maximum discount</code> , considering that each offer should contain distinct <code>Ids</code>.</p>\n\n<p><strong>NOTE</strong> I am writing my code in <code>go</code> language. But solutions/Logic in any language will be helpful.</p>\n\n<p><strong>NOTE :</strong> I hope I am able to explain my requirement properly. please comment if any extra information is required. Thanks.</p>\n"}, {"tags": ["go", "interface", "type-assertion"], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1475248590, "post_id": 39791466, "comment_id": 66882486, "body": "@mario-stoilov, I concur: you should abstrain from using the <code>reflect</code> package as much as you can. Using it most of the time signalizes code smell as the only case where it&#39;s really called for is when you work with (user-supplied) types you completely know nothing about beforehand, and have to inspect their structure at runtime. The <code>encoding&#47;xml</code> and <code>encoding&#47;json</code> packages are two very good examples."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1475238208, "creation_date": 1475238208, "answer_id": 39791466, "question_id": 39791357, "link": "https://stackoverflow.com/questions/39791357/type-assertion-in-go/39791466#39791466", "title": "Type assertion in go", "body": "<p>The error hints that the type you want to type assert is <code>*types.VirtualDisk</code> and not <code>types.VirtualDisk</code>.</p>\n\n<p>Also that reflection trick you're trying to do is completely unnecessary, as there is a <a href=\"https://golang.org/ref/spec#Type_assertions\">special form of the type assertion</a> which reports whether the assertion holds.</p>\n\n<p>See this example:</p>\n\n<pre><code>if disk, ok := device.(*types.VirtualDisk); ok {\n    // Type assertion holds, disk is of type *types.VirtualDisk\n    // You may use it so\n}\n</code></pre>\n"}], "owner": {"reputation": 3261, "user_id": 1818847, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/fPeO9.jpg?s=128&g=1", "display_name": "Mario Stoilov", "link": "https://stackoverflow.com/users/1818847/mario-stoilov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 0, "accepted_answer_id": 39791466, "answer_count": 1, "score": 1, "last_activity_date": 1475238433, "creation_date": 1475237842, "last_edit_date": 1475238433, "question_id": 39791357, "link": "https://stackoverflow.com/questions/39791357/type-assertion-in-go", "title": "Type assertion in go", "body": "<p>I have this code snippet:</p>\n\n<pre><code>if (reflect.TypeOf(device).String() == \"*types.VirtualDisk\") {\n    disk := device.(types.VirtualDisk)\n    fmt.Printf(\"%v - %v \\n\", \"capacityInKB\", disk.CapacityInKB)\n}\n</code></pre>\n\n<p>to which I get: </p>\n\n<blockquote>\n  <p>impossible type assertion:    types.VirtualDisk does not implement\n  types.BaseVirtualDevice (GetVirtualDevice method has pointer receiver)</p>\n</blockquote>\n\n<p>But If I modify it to</p>\n\n<pre><code>if (reflect.TypeOf(device).String() == \"*types.VirtualDisk\") {\n    //disk := device.(types.VirtualDisk)\n    fmt.Printf(\"%v - %v \\n\", \"capacityInKB\", device)//disk.CapacityInKB)\n}\n</code></pre>\n\n<p>It works and prints all the properties of the object. How am I suppose to convert this?</p>\n"}, {"tags": ["go", "reader"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1475236996, "post_id": 39791021, "comment_id": 66875143, "body": "Undoable the way you asked for. Use a <code>io.TeeReader</code> to capture what you read for further reference, e.g. in a <code>bytes.Buffer</code>."}], "answers": [{"comments": [{"owner": {"reputation": 459, "user_id": 446465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e5468f8ae76cf49147676e1cb217940?s=128&d=identicon&r=PG", "display_name": "iwind", "link": "https://stackoverflow.com/users/446465/iwind"}, "edited": false, "score": 3, "creation_date": 1573477986, "post_id": 39791081, "comment_id": 103884047, "body": "A bad method if the reader contains VERY LARGE data, such as 2G byes."}], "tags": [], "owner": {"reputation": 78861, "user_id": 561309, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/6d833d9f0ffa2265a01359ccecd26d54?s=128&d=identicon&r=PG&f=1", "display_name": "laurent", "link": "https://stackoverflow.com/users/561309/laurent"}, "is_accepted": false, "score": 8, "last_activity_date": 1475236953, "creation_date": 1475236953, "answer_id": 39791081, "question_id": 39791021, "link": "https://stackoverflow.com/questions/39791021/how-to-read-multiple-times-from-same-io-reader/39791081#39791081", "title": "How to read multiple times from same io.Reader", "body": "<p>When you call <code>ReadAll</code> it's going to empty the buffer, so the second call will always return nothing. What you could do is save the result of <code>ReadAll</code> and reuse that in your functions. For example:</p>\n\n<pre><code>bytes, _ := ioutil.ReadAll(r);\nlog.Println(string(bytes))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1475238752, "post_id": 39791511, "comment_id": 66876162, "body": "I want to know the reason why not :-)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 4, "creation_date": 1475239767, "post_id": 39791511, "comment_id": 66876778, "body": "@AbhishekSoni: An <code>io.Reader</code> is a stream. Once you finish the stream, there is no more. If you read part of the stream, the next read continues where you left off."}], "tags": [], "owner": {"reputation": 96, "user_id": 6708085, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-e844hPM4Wec/AAAAAAAAAAI/AAAAAAAABVM/2voNjJ08Nn8/photo.jpg?sz=128", "display_name": "Vijay Gurunanee", "link": "https://stackoverflow.com/users/6708085/vijay-gurunanee"}, "is_accepted": false, "score": 1, "last_activity_date": 1475239624, "last_edit_date": 1475239624, "creation_date": 1475238354, "answer_id": 39791511, "question_id": 39791021, "link": "https://stackoverflow.com/questions/39791021/how-to-read-multiple-times-from-same-io-reader/39791511#39791511", "title": "How to read multiple times from same io.Reader", "body": "<p>Technically, on one reader, you cannot read multiple times.</p>\n\n<ul>\n<li>Even if you create different references <strong>but</strong></li>\n<li>when you read once it will be same object referred by all references.</li>\n<li>so what you can do is read the content and store it in one variable.</li>\n<li>Then use that variable as many times as you want.</li>\n</ul>\n\n<p>This will print twice.</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n    r := strings.NewReader(\"some io.Reader stream to be read\\n\")\n    stringData, _ := ioutil.ReadAll(r)\n    log.Println(stringData)\n    log.Println(stringData)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "is_accepted": true, "score": 82, "last_activity_date": 1568985270, "last_edit_date": 1568985270, "creation_date": 1475240285, "answer_id": 39792097, "question_id": 39791021, "link": "https://stackoverflow.com/questions/39791021/how-to-read-multiple-times-from-same-io-reader/39792097#39792097", "title": "How to read multiple times from same io.Reader", "body": "<p><a href=\"https://golang.org/pkg/io/#Reader\" rel=\"noreferrer\"><code>io.Reader</code></a> is treated like a stream. Because of this you cannot read it twice. Imagine the an incoming TCP connection. You cannot rewind the whats coming in.</p>\n\n<p>But you can use the <a href=\"https://golang.org/pkg/io/#TeeReader\" rel=\"noreferrer\"><code>io.TeeReader</code></a> to duplicate the stream:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n    r := strings.NewReader(\"some io.Reader stream to be read\\n\")\n    var buf bytes.Buffer\n    tee := io.TeeReader(r, &amp;buf)\n\n    log.Println(ioutil.ReadAll(tee))\n    log.Println(ioutil.ReadAll(&amp;buf)) \n}\n</code></pre>\n\n<p>Example on <a href=\"https://play.golang.org/p/c1P6i85dLX\" rel=\"noreferrer\">Go Playground</a></p>\n\n<p><strong>Edit:</strong> As @mrclx pointed out: You need to read from the <code>TeeReader</code> first, otherwise the buffer will be empty.</p>\n"}, {"tags": [], "owner": {"reputation": 479, "user_id": 7758011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/781b4227a39712ab2a2c50acd8beac92?s=128&d=identicon&r=PG&f=1", "display_name": "SanjX", "link": "https://stackoverflow.com/users/7758011/sanjx"}, "is_accepted": false, "score": 2, "last_activity_date": 1581002457, "creation_date": 1581002457, "answer_id": 60098300, "question_id": 39791021, "link": "https://stackoverflow.com/questions/39791021/how-to-read-multiple-times-from-same-io-reader/60098300#60098300", "title": "How to read multiple times from same io.Reader", "body": "<p>When you read from ioutil.ReadAll(r) then, the content is gone. You can\u2019t read from it a second time.\nFor an example:</p>\n\n<pre><code>var response *http.Response\n\n//Read the content\nrawBody, err := ioutil.ReadAll(response.Body)\n    if err != nil {\n        t.Error(err)\n    }\n\n// Restore the io.ReadCloser to it's original state\nresponse.Body = ioutil.NopCloser(bytes.NewBuffer(rawBody))\n</code></pre>\n"}], "owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 27375, "favorite_count": 8, "accepted_answer_id": 39792097, "answer_count": 4, "score": 50, "last_activity_date": 1594594537, "creation_date": 1475236712, "last_edit_date": 1542640515, "question_id": 39791021, "link": "https://stackoverflow.com/questions/39791021/how-to-read-multiple-times-from-same-io-reader", "title": "How to read multiple times from same io.Reader", "body": "<p>I want to use <code>request.Body(type io.ReadCloser)</code> which is containing a image.</p>\n\n<p>I dont want to use <code>ioutil.ReadAll()</code> as i want to write this body directly to the file as well as want to decode it, so i only want to use the reference to the content to pass to further function calls, </p>\n\n<p>I tried creating multiple instances of reader for example shown below</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"strings\"\n)\n\n\nfunc main() {\n    r := strings.NewReader(\"some io.Reader stream to be read\\n\")\n    a := &amp;r\n    b := &amp;r\n    log.Println(ioutil.ReadAll(*a))\n    log.Println(ioutil.ReadAll(*b))\n\n}\n</code></pre>\n\n<p>but in second call it always results into <code>nil</code>.</p>\n\n<p>Please help me how can i pass multiple separate reference for the same reader?</p>\n"}, {"tags": ["go", "https", "beego"], "answers": [{"tags": [], "owner": {"reputation": 578, "user_id": 1347587, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/54cbf90d9e92f3f6f1f069febf0429c8?s=128&d=identicon&r=PG", "display_name": "NaN", "link": "https://stackoverflow.com/users/1347587/nan"}, "is_accepted": true, "score": 0, "last_activity_date": 1475596249, "creation_date": 1475596249, "answer_id": 39856725, "question_id": 39790681, "link": "https://stackoverflow.com/questions/39790681/beego-and-https/39856725#39856725", "title": "Beego and Https", "body": "<p>Was testing in Chrome and a Chrome extension called Postman. Figured out the self signed certificate need to be accepted by Chrome by setting the chrome://flags/#allow-insecure-localhost flag.</p>\n\n<p>Another solution was to use Microsoft Edge.</p>\n"}], "owner": {"reputation": 578, "user_id": 1347587, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/54cbf90d9e92f3f6f1f069febf0429c8?s=128&d=identicon&r=PG", "display_name": "NaN", "link": "https://stackoverflow.com/users/1347587/nan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 693, "favorite_count": 0, "accepted_answer_id": 39856725, "answer_count": 1, "score": -1, "last_activity_date": 1475596249, "creation_date": 1475235529, "question_id": 39790681, "link": "https://stackoverflow.com/questions/39790681/beego-and-https", "title": "Beego and Https", "body": "<p>Tried to set up https, as described here: <a href=\"https://github.com/astaxie/beego/issues/401\" rel=\"nofollow\">https://github.com/astaxie/beego/issues/401</a> and got this in the logs:</p>\n\n<pre><code>2016/09/28 14:05:34 [I] [asm_amd64.s:2086] https server Running on https://127.0.0.1:10443\n2016/09/28 14:05:37 [server.go:2315] [HTTP] http: TLS handshake error from 127.0.0.1:65365: tls: first record does not look like a TLS handshake\n</code></pre>\n\n<p>I am running it on Windows 10. Any one got Beego working with https? I used self signed certificate, which works fine for generic golang https simple program.</p>\n"}, {"tags": ["http", "go"], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 5938719, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DxPI3.jpg?s=128&g=1", "display_name": "yinchunxiang", "link": "https://stackoverflow.com/users/5938719/yinchunxiang"}, "edited": false, "score": 0, "creation_date": 1476415276, "post_id": 39789420, "comment_id": 67345533, "body": "when server automatically uses chunked encoding, what"}, {"owner": {"reputation": 19, "user_id": 5938719, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DxPI3.jpg?s=128&g=1", "display_name": "yinchunxiang", "link": "https://stackoverflow.com/users/5938719/yinchunxiang"}, "edited": false, "score": 0, "creation_date": 1476415383, "post_id": 39789420, "comment_id": 67345568, "body": "thanks, and one more question. What is the default content-length when server uses chunked encoding automatically."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 19, "user_id": 5938719, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DxPI3.jpg?s=128&g=1", "display_name": "yinchunxiang", "link": "https://stackoverflow.com/users/5938719/yinchunxiang"}, "edited": false, "score": 0, "creation_date": 1476415420, "post_id": 39789420, "comment_id": 67345577, "body": "The content length is not specified when chunked encoding is used."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1475255176, "last_edit_date": 1475255176, "creation_date": 1475231483, "answer_id": 39789420, "question_id": 39789273, "link": "https://stackoverflow.com/questions/39789273/how-to-send-a-http-response-with-transfer-encoding-trunked-in-go/39789420#39789420", "title": "How to send a http response with &quot;Transfer-Encoding: trunked&quot; in GO", "body": "<p>The net/http server does not allow the application to control the transfer encoding.</p>\n\n<p>The net/http server automatically uses chunked encoding when the application does not set the Content-Length response header and the connection can be reused (http/1 client requested keep-alive or http/1.1 client did not request connection close).</p>\n"}], "owner": {"reputation": 19, "user_id": 5938719, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DxPI3.jpg?s=128&g=1", "display_name": "yinchunxiang", "link": "https://stackoverflow.com/users/5938719/yinchunxiang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 1, "accepted_answer_id": 39789420, "answer_count": 1, "score": 0, "last_activity_date": 1475255176, "creation_date": 1475231007, "question_id": 39789273, "link": "https://stackoverflow.com/questions/39789273/how-to-send-a-http-response-with-transfer-encoding-trunked-in-go", "title": "How to send a http response with &quot;Transfer-Encoding: trunked&quot; in GO", "body": "<p>I want to send my response data to to client with \"Transfer-Encoding:trunked\".\nBut I do not find the way to do it with Golang.\nIs there any example for this?</p>\n"}, {"tags": ["go", "slack"], "comments": [{"owner": {"reputation": 3245, "user_id": 3703534, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ApYeB.jpg?s=128&g=1", "display_name": "Sachith", "link": "https://stackoverflow.com/users/3703534/sachith"}, "edited": false, "score": 0, "creation_date": 1475417260, "post_id": 39788408, "comment_id": 66925729, "body": "I don&#39;t know anything about this(coz i&#39;m beginner for the programming),but i like to learn things like this,can you say what is this and hope this link will be helped to you,if not sorry for me :(  <a href=\"https://gist.github.com/jmervine/8321794\" rel=\"nofollow noreferrer\">gist.github.com/jmervine/8321794</a>  Good luck  @Maxim :)"}], "answers": [{"tags": [], "owner": {"reputation": 4366, "user_id": 176478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a10b460f85d3d8b9702782bf6dd72307?s=128&d=identicon&r=PG", "display_name": "dmportella", "link": "https://stackoverflow.com/users/176478/dmportella"}, "is_accepted": false, "score": 4, "last_activity_date": 1475483797, "creation_date": 1475483797, "answer_id": 39827479, "question_id": 39788408, "link": "https://stackoverflow.com/questions/39788408/slack-integration-404-expired-url-https-hooks-slack-com-commands/39827479#39827479", "title": "slack integration: 404 Expired url https://hooks.slack.com/commands", "body": "<blockquote>\n  <p>You can not increase the expire time for the URL that is a Slack internal setting. </p>\n</blockquote>\n\n<h1>Using the Slack Web API</h1>\n\n<p>You can send unattended messages to any user through the <a href=\"https://api.slack.com/methods\" rel=\"nofollow\">Slack Web API</a> which you need a token for it.</p>\n\n<p>For more information check: <a href=\"https://api.slack.com/web\" rel=\"nofollow\">https://api.slack.com/web</a>.</p>\n\n<h2>chat.postMessage</h2>\n\n<p>The Slack API has a <code>postMessage</code> command that allows the user to post messages to a channel, to the <code>slackbot</code> channel and to the user through <code>IM</code> channel (direct message). It seems you want to do the later which is quite simple.</p>\n\n<h2>Post to an IM channel</h2>\n\n<p><a href=\"https://api.slack.com/methods/chat.postMessage#channels\" rel=\"nofollow\">chat.postMessage#channels</a></p>\n\n<p>Method Url: <a href=\"https://slack.com/api/chat.postMessage\" rel=\"nofollow\">https://slack.com/api/chat.postMessage</a></p>\n\n<p>Posting to an IM channel is a little more complex when settings the value of <code>channel</code> depending on the value of <code>as_user</code>.</p>\n\n<ul>\n<li>If <code>as_user</code> is false:\n\n<ul>\n<li>Pass a username (<code>@chris</code>) as the value of <code>channel</code> to post to that user's @slackbot channel as the bot.</li>\n<li>Pass the IM channel's ID (<code>D023BB3L2</code>) as the value of <code>channel</code> to post to that IM channel as the bot. The IM channel's ID can be retrieved through the <a href=\"https://api.slack.com/methods/im.list\" rel=\"nofollow\">im.list</a> API method.</li>\n</ul></li>\n<li>If <code>as_user</code> is true:\n\n<ul>\n<li>Pass the IM channel's ID (<code>D023BB3L2</code>) as the value of <code>channel</code> to post to that IM channel as the authenticated user. The IM channel's ID can be retrieved through the im.list API method.\nTo send a direct message to the user owning the token used in the request, provide the channel field with the a conversation/IM ID value found in a method like <a href=\"https://api.slack.com/methods/im.list\" rel=\"nofollow\">im.list</a>.</li>\n</ul></li>\n</ul>\n\n<p>To send a direct message to the user <strong><em>owning</em></strong> the token used in the request, provide the <code>channel</code> field with the a conversation/IM ID value found in a method like <a href=\"https://api.slack.com/methods/im.list\" rel=\"nofollow\">im.list</a>.</p>\n\n<h2>im.list</h2>\n\n<p>This method will return a list of direct messages channels if you don't have a channel open with the user yet you can call the <code>im.open</code>. </p>\n\n<h2>im.open</h2>\n\n<p>This method is used to <code>open</code> a direct message <code>channel</code> with a specified user.</p>\n\n<p>Documentation about <code>im.open</code> can be found <a href=\"https://api.slack.com/methods/im.open\" rel=\"nofollow\">here</a>.</p>\n\n<h2>Example URL</h2>\n\n<p><code>https://slack.com/api/chat.postMessage?token=**TOKEN**&amp;channel=**Direct Channel ID**&amp;text=HelloWorld&amp;as_user=true&amp;pretty=1</code></p>\n\n<p>Just replace <code>**TOKEN**</code> and <code>**Direct Channel ID**</code> with your values and it should send a direct message to the specified user.</p>\n"}], "owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1395, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1475483797, "creation_date": 1475228435, "last_edit_date": 1592644375, "question_id": 39788408, "link": "https://stackoverflow.com/questions/39788408/slack-integration-404-expired-url-https-hooks-slack-com-commands", "title": "slack integration: 404 Expired url https://hooks.slack.com/commands", "body": "<p>Here is my golang app listening requests from slack command:\n<code>main.go</code>:</p>\n<pre><code>package main\n\nimport (\n    &quot;bytes&quot;\n    &quot;encoding/json&quot;\n    &quot;fmt&quot;\n    &quot;io/ioutil&quot;\n    &quot;net/http&quot;\n    &quot;time&quot;\n)\n\ntype SlackCmdResponse struct {\n    Text string `json:&quot;text&quot;`\n}\n\nfunc main() {\n    http.HandleFunc(&quot;/&quot;, func(w http.ResponseWriter, req *http.Request) {\n        if err := req.ParseForm(); err != nil {\n            panic(err)\n        }\n        responseUrl := req.PostFormValue(&quot;response_url&quot;)\n        go func() {\n            time.Sleep(time.Second)\n            postBack(responseUrl)\n        }()\n        rj, err := json.Marshal(SlackCmdResponse{Text: &quot;Test started&quot;})\n        if err != nil {\n            panic(err)\n        }\n        w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;)\n        w.Write(rj)\n\n    })\n    fmt.Println(&quot;listening 8383&quot;)\n    if err := http.ListenAndServe(&quot;:8383&quot;, nil); err != nil {\n        panic(err)\n    }\n}\n\nfunc postBack(responseUrl string) {\n    fmt.Println(&quot;responseUrl&quot;, responseUrl)\n    cResp := SlackCmdResponse{\n        Text: &quot;Test finished&quot;,\n    }\n    cj, err := json.Marshal(cResp)\n    if err != nil {\n        panic(err)\n    }\n    req, err := http.NewRequest(&quot;POST&quot;, responseUrl, bytes.NewReader(cj))\n    req.Header.Set(&quot;Content-Type&quot;, &quot;application/json&quot;)\n\n    resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    if resp != nil {\n        fmt.Println(resp.StatusCode)\n        if b, err := ioutil.ReadAll(resp.Body); err != nil {\n            panic(err)\n        } else {\n            fmt.Println(string(b))\n        }\n        if resp.Body != nil {\n            resp.Body.Close()\n        }\n    }\n}\n</code></pre>\n<p>I run it:</p>\n<pre><code>$ go run main.go\nlistening 8383\n</code></pre>\n<p>I use ngrok to make it accessible from the internet:</p>\n<pre><code>ngrok http 8383\n</code></pre>\n<p>I created slack slash command <code>/my-command</code> with <code>POST</code> option and pasted https URL that ngrok gave:</p>\n<p><a href=\"https://i.stack.imgur.com/xYBoZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xYBoZ.png\" alt=\"slash command options - slack\" /></a></p>\n<p>Now when I run <code>/my-command</code> in slack, I get slack reply <code>Test started</code>. And then in a second slack prints <code>Test finished</code></p>\n<p>For now, it's all fine.</p>\n<h1>Problem</h1>\n<p>If I replace line</p>\n<pre><code>time.Sleep(time.Second)\n</code></pre>\n<p>by line</p>\n<pre><code>time.Sleep(time.Hour) // long test\n</code></pre>\n<p>I don't get slack printed &quot;Test finished&quot; in hour. Instead, I see in my app logs:</p>\n<pre><code>responseUrl https://hooks.slack.com/commands/T3GBFUZ64/86817661808/XRmDO21jYaP1Wzu7GFpNw9eW\n404\nExpired url\n</code></pre>\n<p>Looks like slack's response URL has an expiration time. How to <strong>extend</strong> this <strong>expiration time</strong>?</p>\n<p>Or in a case of expiration, is there another way to send a message to the user about having the test finished? I have name and id of a user launching <code>/my-command</code></p>\n<pre><code>req.PostFormValue(&quot;user_name&quot;)\nreq.PostFormValue(&quot;user_id&quot;)\n</code></pre>\n<p>So I want to run integration tests by slack which are longer than 2 hours and get a response after finishing such tests in slack.</p>\n"}, {"tags": ["go", "beego"], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "edited": false, "score": 0, "creation_date": 1475804690, "post_id": 39821112, "comment_id": 67101383, "body": "Thanks,Just what i wanted.I have a doubt in this..Do we have to start the session before the login...Sorry new to programming.Thanks"}, {"owner": {"reputation": 459, "user_id": 307826, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YiVIy.jpg?s=128&g=1", "display_name": "Stef K", "link": "https://stackoverflow.com/users/307826/stef-k"}, "reply_to_user": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "edited": false, "score": 0, "creation_date": 1475860978, "post_id": 39821112, "comment_id": 67129161, "body": "You can start the session at application startup, so pick your setup from <a href=\"http://beego.me/docs/mvc/controller/session.md\" rel=\"nofollow noreferrer\">beego.me/docs/mvc/controller/session.md</a> and say in main before beego.run() set session&#39;s settings."}, {"owner": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "edited": false, "score": 0, "creation_date": 1478307594, "post_id": 39821112, "comment_id": 68115894, "body": "Thanks for your help Mr.Stef K"}], "tags": [], "owner": {"reputation": 459, "user_id": 307826, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YiVIy.jpg?s=128&g=1", "display_name": "Stef K", "link": "https://stackoverflow.com/users/307826/stef-k"}, "is_accepted": true, "score": 2, "last_activity_date": 1475438440, "creation_date": 1475438440, "answer_id": 39821112, "question_id": 39786398, "link": "https://stackoverflow.com/questions/39786398/how-to-add-filters-in-beego/39821112#39821112", "title": "How to add filters in beego", "body": "<p>You can do something like the following:</p>\n\n<ul>\n<li>Set the URL you want to protect in router and the corresponding filter</li>\n<li>Create a filter function which will be called by the router and check the user</li>\n</ul>\n\n<p>In more detail:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// A URL set in router.go\nbeego.InsertFilter(\"/admin/\", beego.BeforeRouter, controllers.ProtectAdminPages)\n\n// A Filter that runs before the controller\n// Filter to protect admin pages\nvar ProtectAdminPages = func(ctx *context.Context) {\n    sess, _ := beego.GlobalSessions.SessionStart(ctx.ResponseWriter, ctx.Request)\n    defer sess.SessionRelease(ctx.ResponseWriter)\n    // read the session from the request\n    ses := sess.Get(\"mysession\")\n    if ses != nil {\n        s := ses.(map[string]string)\n        // get the key identifying the user id\n        userId, _ := strconv.Atoi(s[\"id\"])\n        // a utility function that searches the database\n        // gets the user and checks for admin privileges\n        if !utils.UserIsAdmin(userId) {\n            ctx.Redirect(301, \"/some-other-page\")\n        }\n    } else {\n        ctx.Redirect(301, \"/\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 157, "user_id": 5024301, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/836491216400010/picture?type=large", "display_name": "Rajesh Kumar", "link": "https://stackoverflow.com/users/5024301/rajesh-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2016, "favorite_count": 1, "accepted_answer_id": 39821112, "answer_count": 1, "score": 4, "last_activity_date": 1578573505, "creation_date": 1475222021, "last_edit_date": 1578573505, "question_id": 39786398, "link": "https://stackoverflow.com/questions/39786398/how-to-add-filters-in-beego", "title": "How to add filters in beego", "body": "<p>I have started developing web application where the back end is Go. I'm using beego framework to develop this application.Previously i used to program in java. Java has a filter function to filter the request by url. I came to know that we can implement it in beego after reading the documentation. There they have given the following example code</p>\n\n<pre><code>var FilterUser = func(ctx *context.Context) {\n    if strings.HasPrefix(ctx.Input.URL(), \"/login\") {\n        return\n    }\n\n    _, ok := ctx.Input.Session(\"uid\").(int)\n    if !ok {\n        ctx.Redirect(302, \"/login\")\n    }\n}\n\nbeego.InsertFilter(\"/*\", beego.BeforeRouter, FilterUser) \n</code></pre>\n\n<p>The problem is I don't know where to use this block of code.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 0, "creation_date": 1475220108, "post_id": 39785289, "comment_id": 66865446, "body": "You can choose either you will use some intermediate structs for marshalling/unmarshalling (high level interface) or directly bson, or low level like bson.M, bson.D. Look at <a href=\"http://stackoverflow.com/questions/25518297/golang-bson-conversion\" title=\"golang bson conversion\">stackoverflow.com/questions/25518297/golang-bson-conversion</a>"}], "answers": [{"comments": [{"owner": {"reputation": 205, "user_id": 1112954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fba4d747a8844d0954ec3af00ef14969?s=128&d=identicon&r=PG", "display_name": "Ganesh", "link": "https://stackoverflow.com/users/1112954/ganesh"}, "edited": false, "score": 0, "creation_date": 1475257602, "post_id": 39788651, "comment_id": 66887304, "body": "What about the second parameter value, the documentation doesn&#39;t seem to elaborate what type it needs to be?  From, my understanding of go, interface{} is equivalent of void * in C or Object in java ? Pointer to an unmarshalJSON example would be even better"}, {"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 0, "creation_date": 1475265275, "post_id": 39788651, "comment_id": 66891017, "body": "There is big difference between void* and interface{}. When variable is void* there is no way to find out the type of variable. Whereas interface{} knows the type."}], "tags": [], "owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "is_accepted": true, "score": 19, "last_activity_date": 1475292095, "last_edit_date": 1475292095, "creation_date": 1475229169, "answer_id": 39788651, "question_id": 39785289, "link": "https://stackoverflow.com/questions/39785289/how-to-marshal-json-string-to-bson-document-for-writing-to-mongodb/39788651#39788651", "title": "How to marshal json string to bson document for writing to MongoDB?", "body": "<p>The <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson\" rel=\"noreferrer\"><code>gopkg.in/mgo.v2/bson</code></a> package has a function called <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#UnmarshalJSON\" rel=\"noreferrer\"><code>UnmarshalJSON</code></a> which does exactly what you want.</p>\n\n<p>The <code>data</code> parameter should hold you JSON string as <code>[]byte</code> value.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code> func UnmarshalJSON(data []byte, value interface{}) error\n</code></pre>\n\n<blockquote>\n  <p>UnmarshalJSON unmarshals a JSON value that may hold non-standard syntax as defined in BSON's extended JSON specification.</p>\n</blockquote>\n\n<p>Example:</p>\n\n<pre><code>var bdoc interface{}\nerr = bson.UnmarshalJSON([]byte(`{\"id\": 1,\"name\": \"A green door\",\"price\": 12.50,\"tags\": [\"home\", \"green\"]}`),&amp;bdoc)\nif err != nil {\n    panic(err)\n}\nerr = c.Insert(&amp;bdoc)\n\nif err != nil {\n    panic(err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "is_accepted": false, "score": 0, "last_activity_date": 1609094993, "creation_date": 1609094993, "answer_id": 65469292, "question_id": 39785289, "link": "https://stackoverflow.com/questions/39785289/how-to-marshal-json-string-to-bson-document-for-writing-to-mongodb/65469292#65469292", "title": "How to marshal json string to bson document for writing to MongoDB?", "body": "<p>There is no longer a way to do this directly with supported libraries (e.g. the mongo-go-driver). You would need to write your own converter based on the bson spec.</p>\n"}, {"tags": [], "owner": {"reputation": 779, "user_id": 10160865, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9VDix.jpg?s=128&g=1", "display_name": "Dennis Glot", "link": "https://stackoverflow.com/users/10160865/dennis-glot"}, "is_accepted": false, "score": 3, "last_activity_date": 1609878862, "creation_date": 1609878862, "answer_id": 65586173, "question_id": 39785289, "link": "https://stackoverflow.com/questions/39785289/how-to-marshal-json-string-to-bson-document-for-writing-to-mongodb/65586173#65586173", "title": "How to marshal json string to bson document for writing to MongoDB?", "body": "<p><code>mongo-go-driver</code> has a function <code>bson.UnmarshalExtJSON</code> that does the job.</p>\n<p>Here's the example:</p>\n<pre><code>var doc interface{}\nerr := bson.UnmarshalExtJSON([]byte(`{&quot;foo&quot;:&quot;bar&quot;}`), true, &amp;doc)\nif err != nil {\n    // handle error\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 0, "last_activity_date": 1615769781, "creation_date": 1615769781, "answer_id": 66631113, "question_id": 39785289, "link": "https://stackoverflow.com/questions/39785289/how-to-marshal-json-string-to-bson-document-for-writing-to-mongodb/66631113#66631113", "title": "How to marshal json string to bson document for writing to MongoDB?", "body": "<blockquote>\n<p>I do not want to create intermediate Go structs for marshaling</p>\n</blockquote>\n<p>If you do want/need to create an intermediate Go BSON structs, you could use a conversion module such <a href=\"https://github.com/sindbach/json-to-bson-go\" rel=\"nofollow noreferrer\">github.com/sindbach/json-to-bson-go</a>. For example:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    &quot;fmt&quot;\n    &quot;github.com/sindbach/json-to-bson-go/convert&quot;\n    &quot;github.com/sindbach/json-to-bson-go/options&quot;\n)\n\nfunc main() {\n    doc := `{&quot;foo&quot;: &quot;buildfest&quot;, &quot;bar&quot;: {&quot;$numberDecimal&quot;:&quot;2021&quot;} }`\n    opt := options.NewOptions()\n    result, _ := convert.Convert([]byte(doc), opt)\n    fmt.Println(result)\n}\n</code></pre>\n<p>Will produce output:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport &quot;go.mongodb.org/mongo-driver/bson/primitive&quot;\n\ntype Example struct {\n    Foo string               `bson:&quot;foo&quot;`\n    Bar primitive.Decimal128 `bson:&quot;bar&quot;`\n}\n</code></pre>\n<p>This module is compatible with <a href=\"https://pkg.go.dev/go.mongodb.org/mongo-driver\" rel=\"nofollow noreferrer\">the official MongoDB Go driver</a>, and as you can see it supports <a href=\"https://docs.mongodb.com/manual/reference/mongodb-extended-json/\" rel=\"nofollow noreferrer\">Extended JSON formats</a>.</p>\n<p>You can also visit <a href=\"https://json-to-bson-map.netlify.app\" rel=\"nofollow noreferrer\">https://json-to-bson-map.netlify.app</a> to try the module in action. You can paste a JSON document, and see the Go BSON structs as output.</p>\n"}], "owner": {"reputation": 205, "user_id": 1112954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fba4d747a8844d0954ec3af00ef14969?s=128&d=identicon&r=PG", "display_name": "Ganesh", "link": "https://stackoverflow.com/users/1112954/ganesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12886, "favorite_count": 4, "accepted_answer_id": 39788651, "answer_count": 4, "score": 13, "last_activity_date": 1615769781, "creation_date": 1475217908, "last_edit_date": 1573725694, "question_id": 39785289, "link": "https://stackoverflow.com/questions/39785289/how-to-marshal-json-string-to-bson-document-for-writing-to-mongodb", "title": "How to marshal json string to bson document for writing to MongoDB?", "body": "<p>What I am looking is equivalent of <a href=\"https://api.mongodb.com/java/3.2/org/bson/Document.html#parse-java.lang.String-\" rel=\"noreferrer\">Document.parse()</a></p>\n\n<p>in golang, that allows me create bson from json directly? I do not want to create intermediate Go structs for marshaling</p>\n"}, {"tags": ["go", "window"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 1, "creation_date": 1475218834, "post_id": 39785219, "comment_id": 66864697, "body": "To create a window where? In terminal? What kind of window?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1475219648, "post_id": 39785219, "comment_id": 66865180, "body": "Go&#39;s standard library has no support for GUI windows. For 3rd party packages supporting text-based (terminal) UI, check out <a href=\"https://github.com/avelino/awesome-go#advanced-console-uis\" rel=\"nofollow noreferrer\">Awesome Go: Advanced Console UIs</a>; for graphical UI check out <a href=\"https://github.com/avelino/awesome-go#gui\" rel=\"nofollow noreferrer\">Awesome Go: GUI</a>."}, {"owner": {"reputation": 1894, "user_id": 2269979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff22a1e835980e29baccf08a62e7ff71?s=128&d=identicon&r=PG", "display_name": "molivier", "link": "https://stackoverflow.com/users/2269979/molivier"}, "edited": false, "score": 1, "creation_date": 1475223610, "post_id": 39785219, "comment_id": 66867213, "body": "Found that one too: <a href=\"https://github.com/alexflint/gallium\" rel=\"nofollow noreferrer\">github.com/alexflint/gallium</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 1, "creation_date": 1475231725, "post_id": 39785219, "comment_id": 66872052, "body": "You also can use <a href=\"https://github.com/google/gxui\" rel=\"nofollow noreferrer\">gxui</a>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1475232108, "post_id": 39785219, "comment_id": 66872291, "body": "@Atomic_alarm Not really a good suggestion: <i>&quot;Unfortunately due to a shortage of hours in a day, GXUI is no longer maintained.&quot;</i> Last commit was Oct 2015."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1475234913, "post_id": 39785219, "comment_id": 66873893, "body": "@icza, yes, but I actually don&#39;t know the best choice for simple GUI at Go. Walk only for Windows ,  wxGo is very heavyweight as and go-qt. Maybe go-libui - the screenshots look nice."}], "answers": [{"tags": [], "owner": {"reputation": 1157, "user_id": 5154802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZqLky3QxN2E/AAAAAAAAAAI/AAAAAAAAAEE/MyYiHfmqVe0/photo.jpg?sz=128", "display_name": "shivendra pratap singh", "link": "https://stackoverflow.com/users/5154802/shivendra-pratap-singh"}, "is_accepted": true, "score": 5, "last_activity_date": 1475225856, "creation_date": 1475225856, "answer_id": 39787550, "question_id": 39785219, "link": "https://stackoverflow.com/questions/39785219/how-can-i-use-go-to-make-a-gui-window/39787550#39787550", "title": "How can I use Go to make a GUI window?", "body": "<p>walk is the most common library used for basic GUI development.</p>\n\n<p>You can import the package using:</p>\n\n<p><strong>go get github.com/lxn/walk</strong></p>\n\n<p>I assume you are working at windows OS so create an exe and run it.</p>\n\n<p>More Information about this can be gathered from its source.</p>\n\n<p>Visit <a href=\"https://github.com/lxn/walk\" rel=\"noreferrer\">https://github.com/lxn/walk</a></p>\n"}, {"comments": [{"owner": {"reputation": 167, "user_id": 10529638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00a2dd86789aad9589e2f188732411f2?s=128&d=identicon&r=PG&f=1", "display_name": "Marco", "link": "https://stackoverflow.com/users/10529638/marco"}, "edited": false, "score": 1, "creation_date": 1545056302, "post_id": 46917129, "comment_id": 94482385, "body": "If  he&#39;s only targeting e.g. Windows, why would you recommend web view? Would be a large amount of bloat when native alternatives exist. Especially since he&#39;s only displaying some text, loading an entire web view seems a bit overkill."}], "tags": [], "owner": {"reputation": 2023, "user_id": 247904, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O6InT.png?s=128&g=1", "display_name": "zserge", "link": "https://stackoverflow.com/users/247904/zserge"}, "is_accepted": false, "score": 4, "last_activity_date": 1508867961, "creation_date": 1508867961, "answer_id": 46917129, "question_id": 39785219, "link": "https://stackoverflow.com/questions/39785219/how-can-i-use-go-to-make-a-gui-window/46917129#46917129", "title": "How can I use Go to make a GUI window?", "body": "<p>A nice-looking cross-platform UI can be created using HTML5/CSS/JS. You may open a native window with a full-screen browser engine (webview) in it showing your UI.</p>\n\n<p>There is a tiny wrapper library for webviews on Windows, MacOS and Linux - <a href=\"https://github.com/zserge/webview\" rel=\"nofollow noreferrer\">https://github.com/zserge/webview</a></p>\n\n<p>You can connectyour UI and the core app parts using Go-to-JS bindings (webview library provides those) or a websocket.</p>\n"}], "owner": {"reputation": 3168, "user_id": 5558126, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/222b3385ea809d92778c8d79a0498115?s=128&d=identicon&r=PG&f=1", "display_name": "Pim verleg", "link": "https://stackoverflow.com/users/5558126/pim-verleg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8116, "favorite_count": 2, "accepted_answer_id": 39787550, "answer_count": 2, "score": 7, "last_activity_date": 1508867961, "creation_date": 1475217694, "last_edit_date": 1475220399, "question_id": 39785219, "link": "https://stackoverflow.com/questions/39785219/how-can-i-use-go-to-make-a-gui-window", "title": "How can I use Go to make a GUI window?", "body": "<p>I am in need to make a simple window in Go to display some text,\nthere is no need for a real GUI like interface.</p>\n\n<p>How can I make a window like this using Go?</p>\n"}, {"tags": ["json", "linux", "go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 1, "last_activity_date": 1475212930, "creation_date": 1475212930, "answer_id": 39784213, "question_id": 39784165, "link": "https://stackoverflow.com/questions/39784165/is-there-anyway-to-send-an-encoded-struct-as-json-without-declaring-a-struct/39784213#39784213", "title": "Is there anyway to send an encoded struct as JSON without declaring a struct?", "body": "<pre><code>json.NewEncoder(w).Encode(\n    map[string]string{\"profile_picture\": result.Profile_picture},\n)\n</code></pre>\n\n<p>would work \u2014 maps with string keys encode to JSON as objects, and you can build up whatever you like with them. It's not shorter, but it does avoid the helper type.</p>\n"}, {"tags": [], "owner": {"reputation": 497, "user_id": 2692215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d0b6dabfa2ba63adece2081af25989e?s=128&d=identicon&r=PG&f=1", "display_name": "1lann", "link": "https://stackoverflow.com/users/2692215/1lann"}, "is_accepted": false, "score": 1, "last_activity_date": 1475213386, "creation_date": 1475213386, "answer_id": 39784297, "question_id": 39784165, "link": "https://stackoverflow.com/questions/39784165/is-there-anyway-to-send-an-encoded-struct-as-json-without-declaring-a-struct/39784297#39784297", "title": "Is there anyway to send an encoded struct as JSON without declaring a struct?", "body": "<p>Alternatively to hobb's answer, you could also use an anonymous struct.</p>\n\n<pre><code>json.NewEncoder(w).Encode(\n    struct {\n        Pp string `json:\"profile_picture\"`\n    }{result.Profile_picture},\n)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 5768531, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eIkcs.jpg?s=128&g=1", "display_name": "Algoru", "link": "https://stackoverflow.com/users/5768531/algoru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 39784213, "answer_count": 2, "score": 1, "last_activity_date": 1475213386, "creation_date": 1475212712, "question_id": 39784165, "link": "https://stackoverflow.com/questions/39784165/is-there-anyway-to-send-an-encoded-struct-as-json-without-declaring-a-struct", "title": "Is there anyway to send an encoded struct as JSON without declaring a struct?", "body": "<p>I would like to know how I could simplify this piece of code:</p>\n\n<pre><code>type PP struct {\n    Profile_picture string `json:\"profile_picture\"`\n}\n\njson.NewEncoder(w).Encode(PP {result.Profile_picture})\n</code></pre>\n\n<p>Something like:</p>\n\n<pre><code>json.NewEncoder(w).Encode({result.Profile_picture})\n</code></pre>\n\n<p>^ this give me: <code>syntax error: missing operand</code></p>\n\n<p>And to get rid of:</p>\n\n<pre><code>type PP struct {\n    Profile_picture string `json:\"profile_picture\"`\n}\n</code></pre>\n\n<p>Thanks. Sorry for my english.</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 0, "creation_date": 1475210968, "post_id": 39783780, "comment_id": 66861652, "body": "Would it be a problem to loop through the rows and append the values to a slice?"}], "answers": [{"tags": [], "owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "is_accepted": false, "score": 0, "last_activity_date": 1475211037, "creation_date": 1475211037, "answer_id": 39783895, "question_id": 39783780, "link": "https://stackoverflow.com/questions/39783780/how-to-find-the-rows-count-returned-from-db-query-postgres/39783895#39783895", "title": "How to find the rows count returned from db.Query postgres", "body": "<p>The <a href=\"https://golang.org/pkg/database/sql/#Rows\" rel=\"nofollow\"><code>sql.Rows</code></a> type is designed to contain multiple results, and you need to call <code>rows.Scan</code> once per result, and call <code>rows.Next</code> to see whether there's a next result that follows all of the results processed so far.</p>\n\n<p>To quote the example from the documentation for the <a href=\"https://golang.org/pkg/database/sql/#Rows\" rel=\"nofollow\"><code>sql.Rows</code></a> type:</p>\n\n<pre><code>rows, err := db.Query(\"SELECT ...\")\n...\ndefer rows.Close()\nfor rows.Next() {\n    var id int\n    var name string\n    err = rows.Scan(&amp;id, &amp;name)\n    ...\n}\nerr = rows.Err() // get any error encountered during iteration\n...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "is_accepted": true, "score": 3, "last_activity_date": 1475222552, "creation_date": 1475222552, "answer_id": 39786549, "question_id": 39783780, "link": "https://stackoverflow.com/questions/39783780/how-to-find-the-rows-count-returned-from-db-query-postgres/39786549#39786549", "title": "How to find the rows count returned from db.Query postgres", "body": "<p>When you work with the <a href=\"https://golang.org/pkg/database/sql/#Rows\" rel=\"nofollow\">Rows</a> object, there isn't any helper method that give you the total rows count in one step. </p>\n\n<p>A simple but slower solution is to iterate through all the results using an incremental variable to store the amount of rows: </p>\n\n<pre><code>// error handling omitted\nrows, _ := db.Query(\"SELECT * FROM table\")\ndefer rows.Close()\n\ncounter := 0\nfor rows.Next() {\n // you can even scan+store the result if you need them later\n counter++\n}\n\nfmt.Println(\"we have\", counter, \"rows\")\n</code></pre>\n\n<p>Otherwise, if your goal is only to \"count\" the amount of rows, use a more dedicated query with <a href=\"https://golang.org/pkg/database/sql/#DB.QueryRow\" rel=\"nofollow\">QueryRow</a></p>\n\n<pre><code>// error handling omitted\nvar counter int\n\ndb.QueryRow(\"SELECT count(*) FROM table\").Scan(&amp;counter)\n\nfmt.Println(\"we have\", counter, \"rows\")\n</code></pre>\n"}], "owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2315, "favorite_count": 1, "accepted_answer_id": 39786549, "answer_count": 2, "score": 3, "last_activity_date": 1475222552, "creation_date": 1475210192, "question_id": 39783780, "link": "https://stackoverflow.com/questions/39783780/how-to-find-the-rows-count-returned-from-db-query-postgres", "title": "How to find the rows count returned from db.Query postgres", "body": "<p>I am using goLang lib/pq driver and trying to fetch rows from database.</p>\n\n<pre><code>rows, err := db.Query(\"select id, name from mytable limit 5\")\n</code></pre>\n\n<p>I want to have a if else clause which checks if there are rows in result set and I did this:</p>\n\n<pre><code>if(!rows.Next()){\n   log.Printf(\"no rows returned\")\n} else {\n   log.Printf(\"rows returned\")\n}\n</code></pre>\n\n<p>but this always return me 1 record less and I assume its because of the <code>if</code> clause it skips one record because as soon as I remove <code>if</code> clause I get all records correctly. How can I know the count of rows returned from the select query without executing another query?</p>\n"}]