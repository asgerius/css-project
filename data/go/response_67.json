[{"tags": ["date", "go", "formatting"], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 3, "last_activity_date": 1461194060, "creation_date": 1461194060, "answer_id": 36756862, "question_id": 36756834, "link": "https://stackoverflow.com/questions/36756834/how-to-convert-year-in-golang-to-buddhist-year/36756862#36756862", "title": "How to convert year in Golang to Buddhist year", "body": "<p>Well I highly doubt that a format string exists which will product Buddhist time so just do the simple straight forward thing and add 543 years to your date... You should probably use a constant for the <code>beDifference</code>.</p>\n\n<pre><code>t := time.Now()\nbuddhaTime = t.AddDate(543, 0, 0)\n</code></pre>\n"}], "owner": {"reputation": 3597, "user_id": 829496, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XXTbx.jpg?s=128&g=1", "display_name": "fronthem", "link": "https://stackoverflow.com/users/829496/fronthem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 437, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1461194060, "creation_date": 1461193885, "question_id": 36756834, "link": "https://stackoverflow.com/questions/36756834/how-to-convert-year-in-golang-to-buddhist-year", "title": "How to convert year in Golang to Buddhist year", "body": "<p>Basically, If I run this code I can get date</p>\n\n<pre><code>t := time.Now()\nfmt.Println(t.Format(\"02/01/2006\"))\n</code></pre>\n\n<p>My question is how to convert Go year to Buddhist year in this format?</p>\n\n<p><strong>Note</strong> a formula for converting year in A.D. to B.E format is</p>\n\n<pre><code>B.E. = A.D. + 543\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 43, "user_id": 6232345, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209425689348035/picture?type=large", "display_name": "Oleg  Shevelev", "link": "https://stackoverflow.com/users/6232345/oleg-shevelev"}, "edited": false, "score": 0, "creation_date": 1461186672, "post_id": 36754838, "comment_id": 61090738, "body": "<a href=\"https://play.golang.org/p/5od76B-GVg\" rel=\"nofollow noreferrer\">play.golang.org/p/5od76B-GVg</a>"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1461197579, "post_id": 36754838, "comment_id": 61094527, "body": "&quot;competitive environment&quot; = &quot;concurrent environment&quot;? &quot;Die Konkurrenz&quot; in German means &quot;the competition&quot; (and has nothing to do with concurrency), so I wonder if it&#39;s also confusing in other languages too."}, {"owner": {"reputation": 43, "user_id": 6232345, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209425689348035/picture?type=large", "display_name": "Oleg  Shevelev", "link": "https://stackoverflow.com/users/6232345/oleg-shevelev"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1461293071, "post_id": 36754838, "comment_id": 61143507, "body": "Concurrent:) It was late at night when I translated from Russian to English:)  Russian variant question: <a href=\"https://toster.ru/q/313102\" rel=\"nofollow noreferrer\">toster.ru/q/313102</a>"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 6232345, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209425689348035/picture?type=large", "display_name": "Oleg  Shevelev", "link": "https://stackoverflow.com/users/6232345/oleg-shevelev"}, "edited": false, "score": 0, "creation_date": 1461293451, "post_id": 36755150, "comment_id": 61143615, "body": "I want to understand how to make the removal of the objects the most rational way and avoid unnecessary locks. GC for bad objects:)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1461190302, "last_edit_date": 1461190302, "creation_date": 1461186253, "answer_id": 36755150, "question_id": 36754838, "link": "https://stackoverflow.com/questions/36754838/is-it-safe-to-be-removed-from-map-in-a-concurrent-environment-in-golang/36755150#36755150", "title": "Is it safe to be removed from map in a concurrent environment? In Golang", "body": "<p>Deleting from a map is considered a write operation, and must be serialized with all other reads and writes. If I understand your question correctly, then yes you need to either batch the deletes for later, or give up the read lock and take a write lock to complete the delete. </p>\n\n<p>The runtime attempts to detect concurrent reads and writes, and will crash with one of:</p>\n\n<pre><code>fatal error: concurrent map writes\nfatal error: concurrent map read and map write\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6232345, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209425689348035/picture?type=large", "display_name": "Oleg  Shevelev", "link": "https://stackoverflow.com/users/6232345/oleg-shevelev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3000, "favorite_count": 0, "accepted_answer_id": 36755150, "answer_count": 1, "score": 4, "last_activity_date": 1461294992, "creation_date": 1461185164, "last_edit_date": 1461294992, "question_id": 36754838, "link": "https://stackoverflow.com/questions/36754838/is-it-safe-to-be-removed-from-map-in-a-concurrent-environment-in-golang", "title": "Is it safe to be removed from map in a concurrent environment? In Golang", "body": "<p>Do I put the lock before removing the item from map?</p>\n\n<pre><code>package main\n\nimport ( \n    \"errors\"\n    \"sync\"\n    \"time\"\n)\n\ntype A struct {\n    Error error\n}\n\nfunc (a *A) Job() {\n//    ... more job\n}\n\nvar l sync.RWMutex\n\nfunc generate() {\n    l.Lock()\n    values[\"key1\"] = A{}\n    l.Unlock()\n    l.Lock()\n    values[\"key2\"] = A{}\n    values[\"key3\"] = A{}\n    l.Unlock()\n //   ...\n    l.Lock()\n    values[\"key1919\"] = A{Error: errors.New(\"oh...\")}\n    l.Unlock()\n //   ...\n    l.Lock()\n    values[\"key99999999999\"] = A{}\n    l.Unlock()\n}\n\nvar values map[string]A\n\nfunc main() {\n    values = make(map[string]A)\n    go generate()\n\n    for {\n        l.RLock()\n        for key, value := range values {\n            if value.Error != nil {\n                delete(values, key)    // it's safe? or you need to take a lock?\n            } else {\n                value.Job()\n            }   \n        }\n        l.RUnlock()\n        time.Sleep(10 * time.Second)\n    }\n}\n</code></pre>\n\n<p>Variants:</p>\n\n<ol>\n<li><p>delete in range without worrying</p></li>\n<li><p>add key in slice and separate range for to remove them</p></li>\n<li><p>l.RUnlock(); l.Lock(); delete(values, key); l.Unlock; l.RLock(); in range</p></li>\n<li><p>go l.delete(key) // gorutin splash</p></li>\n</ol>\n\n<p>Which variant is the effective removal with lock/unlock?</p>\n"}, {"tags": ["go", "global-variables", "httphandler"], "comments": [{"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461184958, "post_id": 36754619, "comment_id": 61089823, "body": "The fact that you recognize you have variables being modified between different calls indicates it&#39;s the design. Sounds like you want some sort of container. You&#39;ll want to design a struct to fit your needs, and pass that struct in to calls to your functions in somepackage."}, {"owner": {"reputation": 155, "user_id": 2048713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5561e3a9aaad516ea652edd59ae2b55e?s=128&d=identicon&r=PG", "display_name": "jcasado94", "link": "https://stackoverflow.com/users/2048713/jcasado94"}, "reply_to_user": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461185704, "post_id": 36754619, "comment_id": 61090215, "body": "Yes, that sounds good, or creating a struct for the whole package and let it contain the variables. But what about functions like Less(i, j int) from the heap interface? Those will need to access the struct and I don&#39;t see a way to pass it to them..."}, {"owner": {"reputation": 5268, "user_id": 302164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XucHp.png?s=128&g=1", "display_name": "miltonb", "link": "https://stackoverflow.com/users/302164/miltonb"}, "edited": false, "score": 0, "creation_date": 1461185753, "post_id": 36754619, "comment_id": 61090237, "body": "Look into channels <a href=\"https://golang.org/ref/spec#Channel_types\" rel=\"nofollow noreferrer\">chan</a> they solve a <i>lot</i> of problems associated with sharing memory."}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461185771, "post_id": 36754619, "comment_id": 61090246, "body": "You wouldn&#39;t need to pass the functions. You would define a struct type &lt;foo&gt; that implements the sort functions. Then you can do foo.Sort() wherever you need to. @jcasado94 if you could provide the type of data you&#39;re using, that might help us come up with a good solution. Check out <a href=\"http://stackoverflow.com/a/28999886/4746361\">stackoverflow.com/a/28999886/4746361</a> to get started."}, {"owner": {"reputation": 155, "user_id": 2048713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5561e3a9aaad516ea652edd59ae2b55e?s=128&d=identicon&r=PG", "display_name": "jcasado94", "link": "https://stackoverflow.com/users/2048713/jcasado94"}, "edited": false, "score": 0, "creation_date": 1461186661, "post_id": 36754619, "comment_id": 61090730, "body": "The package basically runs some path finding algorithms and has to answer with the paths. Therefore the variables are mainly priority queues implementing the container/heap interface and maps of open/closed vertices and so on, and of course a Graph struct..."}], "answers": [{"comments": [{"owner": {"reputation": 155, "user_id": 2048713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5561e3a9aaad516ea652edd59ae2b55e?s=128&d=identicon&r=PG", "display_name": "jcasado94", "link": "https://stackoverflow.com/users/2048713/jcasado94"}, "edited": false, "score": 1, "creation_date": 1461187832, "post_id": 36755531, "comment_id": 61091311, "body": "That&#39;s exactly what I was missing. Handlers as structs encapsulating variables. Thanks, gotta work on it now! ;)"}, {"owner": {"reputation": 155, "user_id": 2048713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5561e3a9aaad516ea652edd59ae2b55e?s=128&d=identicon&r=PG", "display_name": "jcasado94", "link": "https://stackoverflow.com/users/2048713/jcasado94"}, "edited": false, "score": 0, "creation_date": 1461190974, "post_id": 36755531, "comment_id": 61092556, "body": "Sorry, quick question. I&#39;ve managed to add to the struct all the functions to implement a container/heap priority queue inside it (Len, Push, Pop,...), and it works well for one. But what if I need to implement two or more container/heap objects inside the same struct? How can I define those functions for all of them? Thanks."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1461212936, "post_id": 36755531, "comment_id": 61098462, "body": "Embed a struct inside another struct."}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1559613483, "post_id": 36755531, "comment_id": 99466931, "body": "Very good answer and examples! However, in my go1.12.5 it gives the error <i>&quot;cannot use &amp;specificHandler literal (type *specificHandler) as type func(http.ResponseWriter, *http.Request) in argument to http.HandleFunc&quot;</i>. How to make it working again?"}, {"owner": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "edited": false, "score": 0, "creation_date": 1559614867, "post_id": 36755531, "comment_id": 99467167, "body": "Use <code>http.Handle</code> instead of <code>http.HandleFunc</code> if you are providing a struct that implements <code>http.Handler</code>."}], "tags": [], "owner": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "is_accepted": true, "score": 15, "last_activity_date": 1530916047, "last_edit_date": 1530916047, "creation_date": 1461187653, "answer_id": 36755531, "question_id": 36754619, "link": "https://stackoverflow.com/questions/36754619/usage-of-global-variables-with-http-handlers-in-golang/36755531#36755531", "title": "Usage of global variables with Http handlers in Golang", "body": "<p>When your handler needs a variable, usually that means you should implement the <code>Handler</code> interface instead of providing a <code>HandlerFunc</code> function.</p>\n\n<p>Here is a BAD example (using global variables):</p>\n\n<pre><code>var globalThing string\n\nfunc specificHandler(w http.ResponseWriter, r *http.Request) {\n    w.Write(globalConfigThing)\n}\n\nfunc main() {\n    globalThing = \"Hello world!\"\n    http.HandleFunc(\"/something\", specificHandler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>Here is a BETTER example (not using global variables):</p>\n\n<pre><code>type specificHandler struct {\n    Thing string\n}\n\nfunc (h *specificHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    w.Write(h.Thing)\n}\n\nfunc main() {\n    http.Handle(\"/something\", &amp;specificHandler{Thing: \"Hello world!\"})\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>As you can see, a <code>Handler</code> can encapsulate variables.</p>\n\n<hr>\n\n<p>For completeness, the other approach is to use a function closure. This works well for once-off handlers but is not re-usable and is harder to write unit tests for.</p>\n\n<pre><code>func main() {\n    scopedThing := \"Hello world!\"\n    http.HandleFunc(\"/something\", func (w http.ResponseWriter, r *http.Request) {\n        w.Write(scopedThing)\n    })\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<hr>\n\n<p>Done correctly, you can now avoid global variables in your package <code>somepackage</code> by passing them as arguments, etc.</p>\n\n<p><strong>EDIT:</strong> For example, you can define your handler struct with several <code>PriorityQueueAStar</code> fields from the <code>somepackage</code> package:</p>\n\n<pre><code>type specificHandler struct {\n    QueueA somepackage.PriorityQueueAStar\n    QueueB somepackage.PriorityQueueAStar\n    QueueC somepackage.PriorityQueueAStar\n}\n\nfunc (h *specificHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    h.QueueA.Push(h.QueueB.Pop)\n    h.QueueB.Push(h.QueueC.Pop)\n    w.Write([]byte(\"Queues pushed and popped\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 155, "user_id": 2048713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5561e3a9aaad516ea652edd59ae2b55e?s=128&d=identicon&r=PG", "display_name": "jcasado94", "link": "https://stackoverflow.com/users/2048713/jcasado94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7618, "favorite_count": 4, "accepted_answer_id": 36755531, "answer_count": 1, "score": 10, "last_activity_date": 1530916047, "creation_date": 1461184443, "last_edit_date": 1461187655, "question_id": 36754619, "link": "https://stackoverflow.com/questions/36754619/usage-of-global-variables-with-http-handlers-in-golang", "title": "Usage of global variables with Http handlers in Golang", "body": "<p>I know there are some questions and posts/articles regarding this question, but from my newbie view, not exactly.\nThe thing is, I've got a main program listening to a port and redirecting the calls to a specific handler. The typical structure:</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/something\", specificHandler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>With the handler being something like:</p>\n\n<pre><code>func specificHandler(w http.ResponseWriter, r *http.Request) {\n    somepackage.foo()\n}\n</code></pre>\n\n<p>Then <strong>somepackage</strong>, which contains the function <strong>foo</strong>, has some global variables, basically because they're needed for functions to share (e.g., when using a priority queue implemented with a container/heap, which will get the priorities in the Swap function from a global matrix of distances which is of course changable). And many other examples. In summary, global variables...</p>\n\n<p>The problem is, as you might see, that those variables are shared among all the calls to the handler. And that's bad.</p>\n\n<p>How can I actually solve this? There must be an easy to way to do it that I haven't got to yet, because it looks like something so usual...</p>\n\n<p>Thanks in advance.</p>\n\n<hr>\n\n<p>EDIT</p>\n\n<p>To make it clearer. For example, in my A* package, I've got the following global variables:</p>\n\n<pre><code>var openVerticesAS PriorityQueueAStar\n\n// which vertices are closed\nvar closedVertices map[int]bool\n\n// which vertices are currently open\nvar openVertices map[int]bool\n\n// cost from start to node\nvar gScore map[int]float64\n\n// cost from start to end, passing by node i (g+h)\nvar fScore map[int]float64\n</code></pre>\n\n<p>Then, <strong>PriorityQueueAStar</strong> is implemented as follows:</p>\n\n<pre><code>type PriorityQueueAStar []int // rel id\n\nfunc (pq PriorityQueueAStar) Len() int { return len(pq) }\n\nfunc (pq PriorityQueueAStar) Empty() bool { return len(pq) == 0 }\n\nfunc (pq PriorityQueueAStar) Less(i, j int) bool {\n    return fScore[pq[i]] &lt; fScore[pq[j]]\n}\n\nfunc (pq PriorityQueueAStar) Swap(i, j int) {\n    pq[i], pq[j] = pq[j], pq[i]\n}\n\nfunc (pq *PriorityQueueAStar) Push(x interface{}) {\n    *pq = append(*pq, x.(int))\n}\n\nfunc (pq *PriorityQueueAStar) Pop() interface{} {\n    old := *pq\n    n := len(old)\n    rel := old[n-1]\n    *pq = old[0 : n-1]\n    return rel\n}\n\nfunc (pq PriorityQueueAStar) Top() interface{} {\n    return pq[0]\n}\n</code></pre>\n\n<p>The question then, is, how do I keep doing this without having all those maps as global variables? If they are part of the struct, how do I access the struct from the priority queue functions?</p>\n"}, {"tags": ["go", "error-handling"], "comments": [{"owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 0, "creation_date": 1461179108, "post_id": 36752643, "comment_id": 61086055, "body": "I&#39;ve thought about that. The problem as I see it is that in the first example above you circumvent logging/handle errors. But if you&#39;re just planning on panicking and exiting the program at that point then maybe it doesn&#39;t matter all that much."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1461179609, "post_id": 36752643, "comment_id": 61086394, "body": "It really depends on the nature of the error. Go encourages prompt error handling unlike say Java where people frequently nest try/catches and let exceptions bubble up the call stack quite a bit before handling them. That being said, if it is a fatal error (like the program will not be able to recover) then you should probably panic. If it&#39;s an error you can anticipate and mitigate then you shouldn&#39;t panic. Using panic/recover as a sort of catch all for unanticipated errors is fairly common and I would reserve the use of panic for those types of circumstances."}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461180449, "post_id": 36752643, "comment_id": 61086921, "body": "Updated answer with your use case"}], "answers": [{"tags": [], "owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "is_accepted": true, "score": 3, "last_activity_date": 1461184308, "last_edit_date": 1461184308, "creation_date": 1461178898, "answer_id": 36752867, "question_id": 36752643, "link": "https://stackoverflow.com/questions/36752643/return-if-there-is-no-error-golang/36752867#36752867", "title": "Return if there is no error Golang", "body": "<p>A panic is similar to an exception, but doesn't get passed to the caller (aka when you call panic, it happens then and there; you don't get to wait). You should go with the first sample of your code, where you can attempt an action, fail, and continue.</p>\n\n<pre><code>func main() {\n    s1 := rand.NewSource(time.Now().UnixNano())\n    r1 := rand.New(s1)\n\n    // Generate some random numbers, and call into add()\n    for i := 0; i &lt; 10; i++ {\n        s, err := add(r1.Intn(100), r1.Intn(100))\n        if err != nil {\n            fmt.Println(err)\n            continue\n        }\n        fmt.Println(s)\n    }\n}\n\n// Error if we get a sum over 100\nfunc add(a int, b int) (int, error) {\n    s := a + b\n    if s &gt; 100 {\n        return s, errors.New(\"Hey doofus, error!\")\n    }\n    return s, nil\n}\n</code></pre>\n\n<p>If you were to panic in this example, you'd be done (try it-- instead of returning an error do panic(\"Some error\"). But instead, we determine there's an error, and we can try to generate another random number.</p>\n\n<p>Like others have said, if you have a use case where you just <em>can't</em> recover (say you were trying to read from a file, but the file isn't there), you might decide it's better to panic. But if you have a long running process (like an API), you'll want to keep churning, despite any errors.</p>\n\n<p>GoPlay here: <a href=\"http://play.golang.org/p/ThXTxVfM6R\" rel=\"nofollow\">http://play.golang.org/p/ThXTxVfM6R</a></p>\n\n<p>OP has update his post with a use case-- he's trying to convert to a type. If you were to panic in this function, you would be dead in the water. Instead, we want to return an error, and let the caller decide what to do with the error. Take this as an example:</p>\n\n<pre><code>func interfaceToString(i interface{}) (string, error) {\n    if i == nil {\n        return \"\", errors.New(\"nil interface\")\n    }\n\n    switch i.(type) {\n    case string:\n        return i.(string), nil\n    case float64:\n        return strconv.Itoa(int(i.(float64))), nil\n    case int:\n        return strconv.Itoa(i.(int)), nil\n    }\n\n    return \"\", errors.New(fmt.Sprintf(\"Unable to convert %v\", i))\n}\n</code></pre>\n\n<p>GoPlay here: <a href=\"http://play.golang.org/p/7y7v151EH4\" rel=\"nofollow\">http://play.golang.org/p/7y7v151EH4</a></p>\n"}], "owner": {"reputation": 259, "user_id": 6232007, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/3241e0eedf4475d6e31b29497c1af8ed?s=128&d=identicon&r=PG&f=1", "display_name": "Pete", "link": "https://stackoverflow.com/users/6232007/pete"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3393, "favorite_count": 1, "accepted_answer_id": 36752867, "answer_count": 1, "score": 4, "last_activity_date": 1461184308, "creation_date": 1461178307, "last_edit_date": 1461180056, "question_id": 36752643, "link": "https://stackoverflow.com/questions/36752643/return-if-there-is-no-error-golang", "title": "Return if there is no error Golang", "body": "<p>In Golang, is it ok to run the function</p>\n\n<pre><code>err, value := function()\nif err == nil {\n  return value\n}\n</code></pre>\n\n<p>instead of doing this:</p>\n\n<pre><code>err, value := function()\nif err != nil {\n  panic(err)\n}\nreturn err\n</code></pre>\n\n<p>If so, is there any time advantages / bonuses?</p>\n\n<p>This is not a non-fatal error. I am trying to convert something to different types, and i'm not sure which I should use.</p>\n"}, {"tags": ["json", "csv", "go"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1461177204, "post_id": 36752050, "comment_id": 61084908, "body": "Can you show us the expected output?"}, {"owner": {"reputation": 977, "user_id": 5227724, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d8e7291331d1d6448748bfdef7aa5244?s=128&d=identicon&r=PG&f=1", "display_name": "Nighthee", "link": "https://stackoverflow.com/users/5227724/nighthee"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1461177735, "post_id": 36752050, "comment_id": 61085211, "body": "I don&#39;t really have an expected output, but want to see what it would look like with a nested json"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1461177815, "post_id": 36752050, "comment_id": 61085260, "body": "You have written the nested JSON there, so I guess that&#39;s your answer? You seem to want to &quot;convert JSON to csv&quot; but that&#39;s not descriptive enough. How do you want your own simple example to look as a csv?"}], "answers": [{"comments": [{"owner": {"reputation": 977, "user_id": 5227724, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d8e7291331d1d6448748bfdef7aa5244?s=128&d=identicon&r=PG&f=1", "display_name": "Nighthee", "link": "https://stackoverflow.com/users/5227724/nighthee"}, "edited": false, "score": 0, "creation_date": 1461180185, "post_id": 36753193, "comment_id": 61086767, "body": "AH I see! Thank you, this is very informative! Yeah, I wasn&#39;t sure how to handle a nested object."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 7, "last_activity_date": 1461179950, "creation_date": 1461179950, "answer_id": 36753193, "question_id": 36752050, "link": "https://stackoverflow.com/questions/36752050/converting-nested-json-to-csv-in-go/36753193#36753193", "title": "Converting nested JSON to csv in GO", "body": "<p>A working example is below:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"strconv\"\n)\n\nfunc decodeJson(m map[string]interface{}) []string {\n    values := make([]string, 0, len(m))\n    for _, v := range m {\n        switch vv := v.(type) {\n        case map[string]interface{}:\n            for _, value := range decodeJson(vv) {\n                values = append(values, value)\n            }\n        case string:\n            values = append(values, vv)\n        case float64:\n            values = append(values, strconv.FormatFloat(vv, 'f', -1, 64))\n        case []interface{}:\n            // Arrays aren't currently handled, since you haven't indicated that we should\n            // and it's non-trivial to do so.\n        case bool:\n            values = append(values, strconv.FormatBool(vv))\n        case nil:\n            values = append(values, \"nil\")\n        }\n    }\n    return values\n}\n\nfunc main() {\n    var d interface{}\n    err := json.Unmarshal(exampleJSON, &amp;d)\n    if err != nil {\n        log.Fatal(\"Failed to unmarshal\")\n    }\n    values := decodeJson(d.(map[string]interface{}))\n    fmt.Println(values)\n\n    f, err := os.Create(\"outputfile.csv\")\n    if err != nil {\n        log.Fatal(\"Failed to create outputfile.csv\")\n    }\n    defer f.Close()\n    w := csv.NewWriter(f)\n    if err := w.Write(values); err != nil {\n        log.Fatal(\"Failed to write to file\")\n    }\n    w.Flush()\n    if err := w.Error(); err != nil {\n        log.Fatal(\"Failed to flush outputfile.csv\")\n    }\n}\n\nvar exampleJSON []byte = []byte(`{\n  \"name\":\"Name1\",\n  \"id\": 2,\n  \"jobs\":{\n      \"job1\":\"somejob\",\n      \"job2\":\"somejob2\"\n   },\n  \"prevIds\":{\n      \"id1\": 100,\n      \"id2\": 102\n  }\n}`)\n</code></pre>\n\n<p>This works by decoding the arbitrary JSON as shown in <a href=\"http://blog.golang.org/json-and-go\" rel=\"noreferrer\">this goblog post</a> then iterating and handling each possible type by converting it to string in the usual way. If you come across a <code>map[string]interface{}</code>, then you're recursing to get the next set of data.</p>\n\n<p>Once you've got a <code>[]string</code>, you can pass it to your <code>csv.Writer</code> to write out however you like. In this case the output is</p>\n\n<pre><code>Name1,2,somejob,somejob2,100,102\n</code></pre>\n"}], "owner": {"reputation": 977, "user_id": 5227724, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d8e7291331d1d6448748bfdef7aa5244?s=128&d=identicon&r=PG&f=1", "display_name": "Nighthee", "link": "https://stackoverflow.com/users/5227724/nighthee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1735, "favorite_count": 1, "accepted_answer_id": 36753193, "answer_count": 1, "score": 2, "last_activity_date": 1461179950, "creation_date": 1461176474, "question_id": 36752050, "link": "https://stackoverflow.com/questions/36752050/converting-nested-json-to-csv-in-go", "title": "Converting nested JSON to csv in GO", "body": "<p>I have an example json, the field names aren't really important but the nested values and the data types of some fields are. I understand that in go you have to make sure that when you write to a csv, the data is a string data type when you use csv.Writer. My question is, whats the proper way of writing the nested values, and is there an efficient way to convert all non-string values by iterating through the overall json?</p>\n\n<pre><code>`{\n  \"name\":\"Name1\",\n  \"id\": 2,\n  \"jobs\":{\n      \"job1\":\"somejob\",\n      \"job2\":\"somejob2\"\n   },\n  \"prevIds\":{\n      \"id1\": 100,\n      \"id2\": 102\n  }\n}`\n</code></pre>\n\n<p>Is the example json</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1461176615, "post_id": 36751815, "comment_id": 61084550, "body": "There&#39;s no point in setting GOOS with <code>go run</code>, because <code>go run</code> is meant to execute immediately on the host OS."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1461177518, "post_id": 36751815, "comment_id": 61085098, "body": "Or maybe you&#39;re confused about &quot;build constraints&quot;? <code>go run</code> doesn&#39;t follow build constraints, because you&#39;re already explicitly listing the files to build as arguments. You shouldn&#39;t be using <code>go run</code> for more than simple testing, and you have <code>go install</code> and <code>go build</code> for working with complete packages."}], "answers": [{"comments": [{"owner": {"reputation": 439, "user_id": 6317997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c44504b4c4236159cd260c8790ca722?s=128&d=identicon&r=PG&f=1", "display_name": "bi4nchi", "link": "https://stackoverflow.com/users/6317997/bi4nchi"}, "edited": false, "score": 0, "creation_date": 1519691525, "post_id": 36752156, "comment_id": 85003893, "body": "Using this for building a docker image and it works great. I was getting: exec user process caused &quot;exec format error&quot; when trying to run my built docker image. The environments didn&#39;t match, so this seemed to work for building the Golang binary for a linux environment. Thanks"}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": true, "score": 1, "last_activity_date": 1461177326, "last_edit_date": 1461177326, "creation_date": 1461176779, "answer_id": 36752156, "question_id": 36751815, "link": "https://stackoverflow.com/questions/36751815/setting-goos-with-go-run/36752156#36752156", "title": "Setting GOOS with go run", "body": "<p><code>GOOS=darwin go run *.go</code> will set the env for Mac OSX. Though, like JimB said, there isn't much of a point. Doing <code>GOOS=darwin go build *.go</code> is a good way to cross compile though</p>\n"}], "owner": {"reputation": 72, "user_id": 701558, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d3a11c40cedce23da24e5ef7f60ee11?s=128&d=identicon&r=PG", "display_name": "MCBrandenburg", "link": "https://stackoverflow.com/users/701558/mcbrandenburg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 674, "favorite_count": 0, "accepted_answer_id": 36752156, "answer_count": 1, "score": 0, "last_activity_date": 1461177326, "creation_date": 1461175658, "question_id": 36751815, "link": "https://stackoverflow.com/questions/36751815/setting-goos-with-go-run", "title": "Setting GOOS with go run", "body": "<p>I'm currently developing a service that can be built as windows service or run as OSX/linux executable.</p>\n\n<p>I'm using build tags on windows files, including the one with a main method</p>\n\n<pre><code>// +build windows\n</code></pre>\n\n<p>And on the other file containing a main method</p>\n\n<pre><code>// +build !windows\n</code></pre>\n\n<p>When I execute <code>go run *.go</code> on the mac side, I get the following error</p>\n\n<pre><code>mainDOS.go:10:2: no buildable Go source files in /Users/michaelbrandenburg/Documents/git-repo/goCode/src/golang.org/x/sys/windows/svc\nwindowsService.go:15:2: no buildable Go source files in /Users/michaelbrandenburg/Documents/git-repo/goCode/src/golang.org/x/sys/windows/svc/debug\ninstall.go:14:2: no buildable Go source files in /Users/michaelbrandenburg/Documents/git-repo/goCode/src/golang.org/x/sys/windows/svc/eventlog\ninstall.go:15:2: no buildable Go source files in /Users/michaelbrandenburg/Documents/git-repo/goCode/src/golang.org/x/sys/windows/svc/mgr\n</code></pre>\n\n<p>Is there a way to run <code>go run</code> and target the architecture I want to run? I can build the executables with no problem.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1461169224, "post_id": 36749542, "comment_id": 61080090, "body": "unless you have a specific need for a doubly-linked-list, you almost always want a <code>[]string</code> slice instead."}, {"owner": {"reputation": 1948, "user_id": 1924657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gumlg.jpg?s=128&g=1", "display_name": "Bryce", "link": "https://stackoverflow.com/users/1924657/bryce"}, "edited": false, "score": 0, "creation_date": 1470305572, "post_id": 36749542, "comment_id": 64900580, "body": "Use slice instead. Or put some code."}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 5739130, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f019a2cde05dc1b7585530a341841f80?s=128&d=identicon&r=PG&f=1", "display_name": "dbaus", "link": "https://stackoverflow.com/users/5739130/dbaus"}, "edited": false, "score": 0, "creation_date": 1461169324, "post_id": 36749587, "comment_id": 61080156, "body": "Solved. Thanks a lot."}], "tags": [], "owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "is_accepted": false, "score": 2, "last_activity_date": 1461168892, "creation_date": 1461168892, "answer_id": 36749587, "question_id": 36749542, "link": "https://stackoverflow.com/questions/36749542/list-of-strings-golang/36749587#36749587", "title": "List of Strings - golang", "body": "<p>Modifying the exact example you linked, and changing the ints to strings works for me:</p>\n\n<pre><code>package main\n\nimport (\n    \"container/list\"\n    \"fmt\"\n)\n\nfunc main() {\n    // Create a new list and put some numbers in it.\n    l := list.New()\n    e4 := l.PushBack(\"4\")\n    e1 := l.PushFront(\"1\")\n    l.InsertBefore(\"3\", e4)\n    l.InsertAfter(\"2\", e1)\n\n    // Iterate through list and print its contents.\n    for e := l.Front(); e != nil; e = e.Next() {\n        fmt.Println(e.Value)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 84, "user_id": 6217412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RV40w.png?s=128&g=1", "display_name": "Jon Laing", "link": "https://stackoverflow.com/users/6217412/jon-laing"}, "is_accepted": true, "score": 1, "last_activity_date": 1461169983, "creation_date": 1461169983, "answer_id": 36749949, "question_id": 36749542, "link": "https://stackoverflow.com/questions/36749542/list-of-strings-golang/36749949#36749949", "title": "List of Strings - golang", "body": "<p>If you take a look at the source code to the package you linked, it seems that the <code>List</code> type holds a list of <code>Element</code>s. Looking at <code>Element</code> you'll see that it has one exported field called <code>Value</code> which is an <code>interface{}</code> type, meaning it could be literally anything: <code>string</code>, <code>int</code>, <code>float64</code>, <code>io.Reader</code>, etc.</p>\n\n<p>To answer your second question, you'll see that <code>List</code> has a method called <code>Remove(e *Element)</code>. You can use it like this:</p>\n\n<pre><code>fmt.Println(l.Len()) // prints: 4\n\n// Iterate through list and print its contents.\nfor e := l.Front(); e != nil; e = e.Next() {\n    if e.Value == \"4\" {\n        l.Remove(e) // remove \"4\"\n    } else {\n        fmt.Println(e.Value)\n    }\n}\n\nfmt.Println(l.Len()) // prints: 3\n</code></pre>\n\n<p>By and large, Golang documentation is usually pretty solid, so you should always check there first.</p>\n\n<p><a href=\"https://golang.org/pkg/container/list/#Element\" rel=\"nofollow\">https://golang.org/pkg/container/list/#Element</a></p>\n"}], "owner": {"reputation": 75, "user_id": 5739130, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f019a2cde05dc1b7585530a341841f80?s=128&d=identicon&r=PG&f=1", "display_name": "dbaus", "link": "https://stackoverflow.com/users/5739130/dbaus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5016, "favorite_count": 0, "accepted_answer_id": 36749949, "answer_count": 2, "score": 0, "last_activity_date": 1461180355, "creation_date": 1461168783, "last_edit_date": 1461180355, "question_id": 36749542, "link": "https://stackoverflow.com/questions/36749542/list-of-strings-golang", "title": "List of Strings - golang", "body": "<p>I'm trying to make a list of Strings in golang. I'm looking up the package <a href=\"https://golang.org/pkg/container/list/#example_\" rel=\"nofollow\">container/list</a> but I don't know how to put in a string. I tried several times, but 0 result.</p>\n\n<p>Should I use another thing instead of lists?\nThanks in advance. </p>\n\n<p>edit: Don't know why are you rating this question with negatives votes...</p>\n"}, {"tags": ["memory-management", "go", "garbage-collection"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1461165225, "post_id": 36747776, "comment_id": 61077097, "body": "The GC collects all memory that is unreachable. Both maps, and the deleted values from maps are collected. The map structure may or may not be compacted, but that&#39;s separate from the values being collected."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1461165446, "post_id": 36747776, "comment_id": 61077252, "body": "I&#39;m not sure exactly what you&#39;re asking. The garbage collector won&#39;t get rid of entries in your map because they&#39;re referenced by the map (assuming that the map itself is reachable). If you have entries in the map that you  don&#39;t need anymore, you should delete them. If you set the value for a particular key in the map to nil, the struct that that map entry pointed to will be garbage collected, assuming that it&#39;s not reachable in some other way."}, {"owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "edited": false, "score": 0, "creation_date": 1461165857, "post_id": 36747776, "comment_id": 61077570, "body": "So what verran suggests about delete not freeing up memory in <a href=\"http://stackoverflow.com/questions/36747776/do-i-need-to-set-a-map-to-nil-in-order-for-it-to-be-garbage-collected\" title=\"do i need to set a map to nil in order for it to be garbage collected\">stackoverflow.com/questions/36747776/&hellip;</a> is not true?"}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1461166434, "post_id": 36747776, "comment_id": 61078014, "body": "@siebertschoutteten you just linked back to this question."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 1, "creation_date": 1461167214, "post_id": 36747776, "comment_id": 61078644, "body": "I think you&#39;re referring to <a href=\"http://stackoverflow.com/a/23231539/152948\">stackoverflow.com/a/23231539/152948</a> \u2014 and the answer is yes and no. The <i>bucket</i> is never cleaned up. If the map is storing a value type (like <code>int</code>), the storage for that <code>int</code> is inside the bucket, so it will also never be cleaned up unless you nil out the map. But if the map is storing pointers, then that means the <i>storage for the pointer</i> will persist, but the pointed-to value will be GC&#39;d provided nothing is pointing to it."}, {"owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "edited": false, "score": 0, "creation_date": 1461167473, "post_id": 36747776, "comment_id": 61078874, "body": "Yeah i wanted to refer to that particular answer, my bad! If the storage for the pointers persists, will memory be freed up if I actually set my map to nil? Or will this have the same effect as just deleting them?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1461167902, "post_id": 36747776, "comment_id": 61079204, "body": "@hobbs: even though buckets aren&#39;t currently compacted, the memory for large values is still reclaimed. Currently anything over 128 bytes is stored via a pointer even if it&#39;s a value type."}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1461170479, "post_id": 36747776, "comment_id": 61080867, "body": "@siebertschoutteten, yes (as Verran mentioned in his answer) setting the map to nil will allow the GC to reclaim everything."}], "answers": [{"comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1461167331, "post_id": 36748429, "comment_id": 61078750, "body": "The code for deletion hasn&#39;t really changed since that time, other than being translated from C to Go. Which is a big deal, but it still doesn&#39;t consolidate buckets. I think Verran was speaking a little bit imprecisely but is still fundamentally correct."}, {"owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "edited": false, "score": 0, "creation_date": 1461167418, "post_id": 36748429, "comment_id": 61078832, "body": "It may be referencing some old code but I can&#39;t find any source to prove what you are saying is true? When did they change it? I quickly read the go 1.5 and 1.6 release notes and could&#39;nt find anything about it."}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1461170506, "post_id": 36748429, "comment_id": 61080885, "body": "I&#39;m pretty sure memclr in  <a href=\"https://github.com/golang/go/blob/master/src/runtime/hashmap.go#L587\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/runtime/hashmap.go#L587</a> will reclaim the memory for values. I think Verran&#39;s information is accurate about the keys, but not about the values"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1461179242, "post_id": 36748429, "comment_id": 61086146, "body": "@matt.s: <code>memclr</code> zeros the bytes for a region of memory, it doesn&#39;t reclaim the space for that value. Run this <a href=\"http://play.golang.org/p/6NcaMtFaHy\" rel=\"nofollow noreferrer\">play.golang.org/p/6NcaMtFaHy</a> with <code>GODEBUG=gctrace=1</code>, and you will see that the collection after deleting all keys does nothing, and the heap isn&#39;t completely freed until the map value itself can be collected."}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1461181531, "post_id": 36748429, "comment_id": 61087586, "body": "@JimB, I&#39;m not sure about that. If you give the GC time/need to work, it looks like it reclaims most of that.  If you look at this example  <a href=\"http://play.golang.org/p/VanBaBR55K\" rel=\"nofollow noreferrer\">play.golang.org/p/VanBaBR55K</a>, why does the memory go down?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1461182417, "post_id": 36748429, "comment_id": 61088189, "body": "@matt.s: when you make the <code>valueSize</code> larger than 128, it&#39;s stored in the hash bucket as a pointer, so the actual value can be GC&#39;ed."}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1461182640, "post_id": 36748429, "comment_id": 61088335, "body": "@JimB, that&#39;s what I was saying; the values can be collected (not necessarily the keys). I&#39;ll make that clearer in my answer."}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1461182743, "last_edit_date": 1461182743, "creation_date": 1461165853, "answer_id": 36748429, "question_id": 36747776, "link": "https://stackoverflow.com/questions/36747776/do-i-need-to-set-a-map-to-nil-in-order-for-it-to-be-garbage-collected/36748429#36748429", "title": "Do I need to set a map to nil in order for it to be garbage collected?", "body": "<p>You can <code>delete()</code> individual entries from the map, even while iterating over it. If the entry's value is unreachable from anything else (and it is big enough), they will be GC'ed.</p>\n\n<p>The question you looked at referenced some old code (you can look at the source yourself), memory should be emptied after objects are removed from the map.</p>\n"}, {"comments": [{"owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "edited": false, "score": 0, "creation_date": 1461227640, "post_id": 36753643, "comment_id": 61106358, "body": "So let me get this right. It will definitely affect my memory usage in a good way if I copy my remaining values to a new map (we are talking milions of entries here) in stead of doing nothing or deleting the entries who are no longer needed?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "edited": false, "score": 0, "creation_date": 1461243038, "post_id": 36753643, "comment_id": 61117660, "body": "@siebertschoutteten: if the time trade-off is worth it for you, then yes. The best way to answer that question is to simply test it out and see."}, {"owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "edited": false, "score": 0, "creation_date": 1461251013, "post_id": 36753643, "comment_id": 61124030, "body": "That&#39;s what I needed to know!"}, {"owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "edited": false, "score": 0, "creation_date": 1564124277, "post_id": 36753643, "comment_id": 100934348, "body": "You say that &quot;the internal structure of a map is not compacted&quot;. I suppose that means that the memory blocks previously used by now deleted entries are kept around. Are these then reused for new items added to the map? If so, then in most cases it&#39;s not going to be a problem to still have them around. Actually, if anything, it&#39;s likely to accelerate new insertions since these blocks of memory are readily available."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1461182289, "last_edit_date": 1461182289, "creation_date": 1461181310, "answer_id": 36753643, "question_id": 36747776, "link": "https://stackoverflow.com/questions/36747776/do-i-need-to-set-a-map-to-nil-in-order-for-it-to-be-garbage-collected/36753643#36753643", "title": "Do I need to set a map to nil in order for it to be garbage collected?", "body": "<p>To try and answer this fully, we need to figure out what the question is exactly.</p>\n\n<p>For the title question:</p>\n\n<blockquote>\n  <p>Do I need to set a map to nil in order for it to be garbage collected?</p>\n</blockquote>\n\n<p>No, once the map value is out of scope, it will be garbage collected like any other value.</p>\n\n<blockquote>\n  <p>I populate this [<code>map[string]*stuct</code>] map with a lot of different values and a lot of these values will never be used again after a certain period of time.</p>\n</blockquote>\n\n<p>This example map you show contains pointer values, and for as long as they are contained in the map, the values to which they point will never be collected. Deleting the values from the map (using <code>delete</code> or setting the key to another value) will allow the memory referenced by the pointers to be collected. There is no special handling that needs to be done around a map to ensure garbage collection.</p>\n\n<p>Now, the internal structures of a map are not currently compacted, and small values (including pointers, and anything under 128 bytes) are stored directly in the hash buckets. A map with millions of entries isn't going to get smaller immediately after deleting those entries, so if you need to free that memory it's best to copy the remaining values you want to a new map. This is analogous to having a large slice that's no longer needed except for a few values, where you need to copy the remaining values to a new slice to free the original backing array.</p>\n"}], "owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4289, "favorite_count": 1, "accepted_answer_id": 36753643, "answer_count": 2, "score": 4, "last_activity_date": 1461182743, "creation_date": 1461164382, "last_edit_date": 1495541298, "question_id": 36747776, "link": "https://stackoverflow.com/questions/36747776/do-i-need-to-set-a-map-to-nil-in-order-for-it-to-be-garbage-collected", "title": "Do I need to set a map to nil in order for it to be garbage collected?", "body": "<p>Let's say I have a simple map with string as keytype and a self-defined struct as valuetype. Like this: <code>map[string]*struct</code></p>\n\n<p>I populate this map with a lot of different values and a lot of these values will never be used again after a certain period of time. </p>\n\n<p>So I wasn't sure whether the golang garbage collector will clean up my map for me or I need to do it myself. Then I came across this answer on a different question: <a href=\"https://stackoverflow.com/questions/23229975/is-it-safe-to-remove-selected-keys-from-golang-map-within-a-range-loop/23231539#23231539\">Is it safe to remove selected keys from Golang map within a range loop?</a> </p>\n\n<p>This makes it look like the garbage collector won't do it for me and my only solution is to set my map to nil if i want to free up some memory every now and then.</p>\n\n<p>Is this true? Or is there another way to do it without losing values in my map that are not 'inactive'?</p>\n"}, {"tags": ["go", "apache-kafka"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1461162608, "post_id": 36746256, "comment_id": 61074959, "body": "You&#39;re calling a single <code>producer.SendMessage</code> concurrently in separate goroutines. Is that documented as safe for concurrent use?"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1461163989, "post_id": 36746256, "comment_id": 61076048, "body": "Nothing about that in the <a href=\"https://godoc.org/github.com/Shopify/sarama#SyncProducer\" rel=\"nofollow noreferrer\">docs</a> but that would also be my first suspicion. @r3dlight: try creating workers that each have their own instance of syncproducer to eliminate any concurrency problems on it."}, {"owner": {"reputation": 101, "user_id": 3327477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0d7926b947286bc9d044a0702192fb?s=128&d=identicon&r=PG&f=1", "display_name": "r3dlight", "link": "https://stackoverflow.com/users/3327477/r3dlight"}, "edited": false, "score": 0, "creation_date": 1461164768, "post_id": 36746256, "comment_id": 61076733, "body": "Ok, I&#39;ll answer my question so I&#39;ll able to paste the modified code"}], "owner": {"reputation": 101, "user_id": 3327477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0d7926b947286bc9d044a0702192fb?s=128&d=identicon&r=PG&f=1", "display_name": "r3dlight", "link": "https://stackoverflow.com/users/3327477/r3dlight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 510, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1461494955, "creation_date": 1461160953, "last_edit_date": 1461494955, "question_id": 36746256, "link": "https://stackoverflow.com/questions/36746256/tail-f-several-logs-and-send-every-new-line-to-kafka-using-sarama", "title": "tail -f several logs and send every new line to kafka using sarama", "body": "<p>I'd like to tail -f several log files in /var/log (I thing one goroutine per log would be fine) and every goroutine will keep on \"watching\" forever on log and send every new line with kafka client sarama.\nHere is my code (does not work) :</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"github.com/Shopify/sarama\"\n    \"log\"\n    \"os\"\n    \"fmt\"\n    \"strings\"\n    \"github.com/hpcloud/tail\"\n    \"github.com/spf13/viper\"\n    //\"io/ioutil\"\n    \"reflect\"\n)\n\n\n\nfunc produce(producer sarama.SyncProducer, cfg *sarama.Config, brokers *string, topic string, logger *log.Logger, log string, t *tail.Tail){\n    logger.Printf(\"Entering produce\")\n    logger.Println(strings.Split(*brokers, \",\"))\n    logger.Println(reflect.TypeOf(strings.Split(*brokers, \",\")))\n    logger.Println(log)\n    /*t, err := tail.TailFile(log, tail.Config{Follow: true, ReOpen: true})\n    if err != nil {\n        fmt.Println(fmt.Errorf(\"Error with tail: %v\\n\", err.Error()))\n    }*/\n    for line := range t.Lines {\n        //logger.Println(line)\n        //logger.Println(line.Text)\n        msg := &amp;sarama.ProducerMessage{Topic: topic, Value: sarama.StringEncoder(line.Text)}\n        _, _, err := producer.SendMessage(msg)\n        if err != nil {\n            logger.Printf(\"FAILED to send message: %s\\n\", err)\n        }\n    }\n\n}\n\n\nfunc main() {\n    //Getting config file params\n    viper.SetConfigName(\"config\") \n    viper.AddConfigPath(\"/root/work/src/linux2kafka/\")\n    err := viper.ReadInConfig()\n    if err != nil {\n        panic(err)\n    }\n    viper.WatchConfig()\n    logList := viper.Get(\"log_list\")\n    //logListString, err := ioutil.ReadFile(logList.(string))\n    //fmt.Println(logList)\n    //fmt.Println(reflect.TypeOf(logList))\n    logsConfig := strings.Split(logList.(string),\",\")\n    // print logs to watch\n    /*for i := range logsConfig {\n        fmt.Println(logsConfig[i])\n    }*/\n    brokerList := viper.Get(\"brokerList\")\n    brokers := flag.String(\"brokers\", brokerList.(string), \"Comma separated kafka brokers list\") //must be set in config.toml\n    topic := flag.String(\"topic\", \"test0\", \"Kafka topic to send messages to\")\n    flag.Parse()\n    logger := log.New(os.Stdout, \"producer \", log.Lmicroseconds)\n    cfg := sarama.NewConfig()\n    //Wait for replication\n    cfg.Producer.RequiredAcks = -1\n    cfg.Producer.Flush.Frequency = 333\n    cfg.Producer.Flush.Messages = 1000\n    cfg.Producer.Flush.MaxMessages = 3000\n    producer, err := sarama.NewSyncProducer(strings.Split(*brokers, \",\"), cfg)\n    if err != nil {\n        logger.Fatalln(err)\n    }\n\n    defer func() {\n        if err := producer.Close(); err != nil {\n            logger.Fatalln(err)\n        }\n    }()\n    for i := range logsConfig {\n        fmt.Println(\"go\")\n        t, err := tail.TailFile(logsConfig[i], tail.Config{Follow: true, ReOpen: true})\n        if err != nil {\n            fmt.Println(fmt.Errorf(\"Error with tail: %v\\n\", err.Error()))\n        }\n        go produce(producer, cfg, brokers, *topic, logger, logsConfig[i], t)\n        }\n}\n</code></pre>\n\n<p>And here are my errors (nothing is received by the consumer):</p>\n\n<pre><code>root@home:~/work/src/linux2kafka# go run main.go\ngo\nproducer 15:54:44.297745 Entering produce\nroot@home:~/work/src/linux2kafka# go run main.go\ngo\nroot@home:~/work/src/linux2kafka# go run main.go\ngo\nroot@home:~/work/src/linux2kafka# go run main.go\ngo\nproducer 15:55:01.951155 Entering produce\nproducer 15:55:01.951193 [localhost:9092 localhost:9092]\nproducer 15:55:01.951205 []string\nproducer 15:55:01.951214 /root/work/src/linux2kafka/test/log\npanic: send on closed channel\n\ngoroutine 56 [running]:\npanic(0x756440, 0xc820164290)\n    /usr/local/go/src/runtime/panic.go:464 +0x3e6\ngithub.com/Shopify/sarama.(*syncProducer).SendMessage(0xc8201742a0, 0xc820176300, 0x0, 0x0, 0x0, 0x0)\n    /root/work/src/github.com/Shopify/sarama/sync_producer.go:66 +0x156\nmain.produce(0x7f65528661b8, 0xc8201742a0, 0xc82008ea20, 0xc82000b230, 0x8855c0, 0x5, 0xc8200789b0, 0xc820011320, 0x23, 0xc82017e000)\n    /root/work/src/linux2kafka/main.go:31 +0x5d2\ncreated by main.main\n    /root/work/src/linux2kafka/main.go:85 +0x9f7\nexit status 2\n</code></pre>\n\n<p>I cannot understand what I'm doing wrong. thx</p>\n\n<p>Here is the modified code, is that ok ? :</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"github.com/Shopify/sarama\"\n    \"log\"\n    \"os\"\n    \"fmt\"\n    \"strings\"\n    \"github.com/hpcloud/tail\"\n    \"github.com/spf13/viper\"\n    //\"io/ioutil\"\n    //\"reflect\"\n)\n\n\n\n//func produce(producer sarama.SyncProducer, cfg *sarama.Config, brokers *string, topic string, logger *log.Logger, log string, t *tail.Tail){\nfunc produce(cfg *sarama.Config, brokers *string, topic string, logger *log.Logger, log string, t *tail.Tail){\n    logger.Println(\"Entering produce\")\n    /*logger.Println(strings.Split(*brokers, \",\"))\n    logger.Println(reflect.TypeOf(strings.Split(*brokers, \",\")))\n    logger.Println(log)*/\n    logger.Printf(\"sarama.NewSyncProducer\")\n    producer, err := sarama.NewSyncProducer(strings.Split(*brokers, \",\"), cfg)\n    if err != nil {\n        logger.Fatalln(err)\n    }\n    defer func() {\n        if err := producer.Close(); err != nil {\n            logger.Fatalln(err)\n        }\n    }()\n\n    /*t, err := tail.TailFile(log, tail.Config{Follow: true, ReOpen: true})\n    if err != nil {\n        fmt.Println(fmt.Errorf(\"Error with tail: %v\\n\", err.Error()))\n    }*/\n    for line := range t.Lines {\n        //logger.Println(line)\n        //logger.Println(line.Text)\n        logger.Printf(\"ProduceMessage\")\n        msg := &amp;sarama.ProducerMessage{Topic: topic, Value: sarama.StringEncoder(line.Text)}\n        _, _, err := producer.SendMessage(msg)\n        if err != nil {\n            logger.Printf(\"FAILED to send message: %s\\n\", err)\n        }\n    }\n\n}\n\n\nfunc main() {\n    //Getting config file params\n    viper.SetConfigName(\"config\") \n    viper.AddConfigPath(\"/root/work/src/linux2kafka/\")\n    err := viper.ReadInConfig()\n    if err != nil {\n        panic(err)\n    }\n    viper.WatchConfig()\n    logList := viper.Get(\"log_list\")\n    //logListString, err := ioutil.ReadFile(logList.(string))\n    //fmt.Println(logList)\n    //fmt.Println(reflect.TypeOf(logList))\n    logsConfig := strings.Split(logList.(string),\",\")\n    // print logs to watch\n    /*for i := range logsConfig {\n        fmt.Println(logsConfig[i])\n    }*/\n    brokerList := viper.Get(\"brokerList\")\n    brokers := flag.String(\"brokers\", brokerList.(string), \"Comma separated kafka brokers list\") //must be set in config.toml\n    topic := flag.String(\"topic\", \"test0\", \"Kafka topic to send messages to\")\n    flag.Parse()\n    logger := log.New(os.Stdout, \"producer \", log.Lmicroseconds)\n    cfg := sarama.NewConfig()\n    //Wait for replication\n    cfg.Producer.RequiredAcks = -1\n    cfg.Producer.Flush.Frequency = 333\n    cfg.Producer.Flush.Messages = 1000\n    cfg.Producer.Flush.MaxMessages = 3000\n    for i := range logsConfig {\n        fmt.Println(\"go\")\n        t, err := tail.TailFile(logsConfig[i], tail.Config{Follow: true, ReOpen: true})\n        if err != nil {\n            fmt.Println(fmt.Errorf(\"Error with tail: %v\\n\", err.Error()))\n        }\n        go produce(cfg, brokers, *topic, logger, logsConfig[i], t)\n        }\n}\n</code></pre>\n\n<p>But still not working... it's not printing the first Println </p>\n\n<pre><code>root@home:~/work/src/linux2kafka# go run main.go\ngo\nroot@home:~/work/src/linux2kafka# go run main.go\ngo\nroot@home:~/work/src/linux2kafka# go run main.go\ngo\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "answers": [{"comments": [{"owner": {"reputation": 181, "user_id": 3879300, "user_type": "registered", "accept_rate": 18, "profile_image": "https://www.gravatar.com/avatar/036ab4e24d4109007a06bf11b8301112?s=128&d=identicon&r=PG&f=1", "display_name": "Baber", "link": "https://stackoverflow.com/users/3879300/baber"}, "edited": false, "score": 0, "creation_date": 1461164090, "post_id": 36746380, "comment_id": 61076124, "body": "have you tried creating the bucket using the parameters that you have mentioned above? I think these are not the actual values of these tags, these are just sample values. The API is throwing &quot;invalid argument format&quot; exception when using these values."}, {"owner": {"reputation": 44774, "user_id": 4296747, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-muYS9LV5AoA/AAAAAAAAAAI/AAAAAAAACG4/KcTmlFyGWRI/photo.jpg?sz=128", "display_name": "Frederic Henri", "link": "https://stackoverflow.com/users/4296747/frederic-henri"}, "reply_to_user": {"reputation": 181, "user_id": 3879300, "user_type": "registered", "accept_rate": 18, "profile_image": "https://www.gravatar.com/avatar/036ab4e24d4109007a06bf11b8301112?s=128&d=identicon&r=PG&f=1", "display_name": "Baber", "link": "https://stackoverflow.com/users/3879300/baber"}, "edited": false, "score": 0, "creation_date": 1461164732, "post_id": 36746380, "comment_id": 61076696, "body": "right, I point to the doc and thought it would work (as you did not indicate yourself you&#39;ve been trying it) - seems other struggle with that <a href=\"https://github.com/aws/aws-sdk-go/issues/491\" rel=\"nofollow noreferrer\">github.com/aws/aws-sdk-go/issues/491</a> and propose to use ACL policies directly"}, {"owner": {"reputation": 181, "user_id": 3879300, "user_type": "registered", "accept_rate": 18, "profile_image": "https://www.gravatar.com/avatar/036ab4e24d4109007a06bf11b8301112?s=128&d=identicon&r=PG&f=1", "display_name": "Baber", "link": "https://stackoverflow.com/users/3879300/baber"}, "edited": false, "score": 0, "creation_date": 1461165173, "post_id": 36746380, "comment_id": 61077047, "body": "Thank you. I already tried with ACL, it&#39;s working fine. But my requirement isn&#39;t being fulfilled by ACL and I need ACP Permissions. I appreciate that you spare time to answer the Question."}], "tags": [], "owner": {"reputation": 44774, "user_id": 4296747, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-muYS9LV5AoA/AAAAAAAAAAI/AAAAAAAACG4/KcTmlFyGWRI/photo.jpg?sz=128", "display_name": "Frederic Henri", "link": "https://stackoverflow.com/users/4296747/frederic-henri"}, "is_accepted": false, "score": 0, "last_activity_date": 1461164965, "last_edit_date": 1461164965, "creation_date": 1461161222, "answer_id": 36746380, "question_id": 36745327, "link": "https://stackoverflow.com/questions/36745327/how-to-set-permissions-on-s3-bucket-while-creating-it-through-golang-api/36746380#36746380", "title": "How to set permissions on S3 Bucket while creating it through GoLang API?", "body": "<p>you can review the <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/S3.html#CreateBucket-instance_method\" rel=\"nofollow\">doc</a> for the <code>CreateBucket</code> method which takes policy arguments you mention</p>\n\n<pre><code>    // set your s3 client before and define your bucket as bucketName\n\n    params := &amp;s3.CreateBucketInput{\n             Bucket: aws.String(bucketName),\n\n             GrantRead:        aws.String(\"GrantRead\"),\n             GrantReadACP:     aws.String(\"GrantReadACP\"),\n             GrantWrite:       aws.String(\"GrantWrite\"),\n             // GrantFullControl and others available\n     }\n\n     result, err := s3client.CreateBucket(params)\n</code></pre>\n\n<p>as <a href=\"https://github.com/aws/aws-sdk-go/issues/491\" rel=\"nofollow\">the issue points out</a> it might not work so using the ACL directly as something like</p>\n\n<pre><code>    // set your s3 client before and define your bucket as bucketName\n\n    params := &amp;s3.CreateBucketInput{\n             Bucket: aws.String(bucketName),\n\n             ACL: aws.String(\"public-read | public-read-write\")\n     }\n\n     result, err := s3client.CreateBucket(params)\n</code></pre>\n\n<p>see <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/dev/acl-overview.html#canned-acl\" rel=\"nofollow\">canned ACL doc</a> for possible values</p>\n"}], "owner": {"reputation": 181, "user_id": 3879300, "user_type": "registered", "accept_rate": 18, "profile_image": "https://www.gravatar.com/avatar/036ab4e24d4109007a06bf11b8301112?s=128&d=identicon&r=PG&f=1", "display_name": "Baber", "link": "https://stackoverflow.com/users/3879300/baber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1302, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1461164965, "creation_date": 1461158763, "question_id": 36745327, "link": "https://stackoverflow.com/questions/36745327/how-to-set-permissions-on-s3-bucket-while-creating-it-through-golang-api", "title": "How to set permissions on S3 Bucket while creating it through GoLang API?", "body": "<p>I am creating an S3 Bucket for AWS Billing reports. I want to set GrantRead, GrantWrite and GrandReadACP permissions on S3 Bucket while creating it through GoLang API. Which value do I need to pass to these tags to set these three permissions for authenticated AWS users?</p>\n"}, {"tags": ["elasticsearch", "go", "fluentd"], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 2514007, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/1dbdb537b79e8f0c15f535741539c500?s=128&d=identicon&r=PG", "display_name": "Mahesh Jadhav", "link": "https://stackoverflow.com/users/2514007/mahesh-jadhav"}, "edited": false, "score": 0, "creation_date": 1461229743, "post_id": 36755088, "comment_id": 61107899, "body": "Yes, I am also using docker containers for my application. And for now I am looking into the usage of fluentd-logger driver for docker. Hope it does the work I am looking for. Thanks for your comment."}], "tags": [], "owner": {"reputation": 678, "user_id": 595362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sx7ju.png?s=128&g=1", "display_name": "noisewaterphd", "link": "https://stackoverflow.com/users/595362/noisewaterphd"}, "is_accepted": false, "score": 0, "last_activity_date": 1461186029, "last_edit_date": 1495542671, "creation_date": 1461186029, "answer_id": 36755088, "question_id": 36744360, "link": "https://stackoverflow.com/questions/36744360/capture-my-go-application-logs-into-fluentd/36755088#36755088", "title": "Capture my Go application logs into fluentd", "body": "<p>Ideally (at least in my opinion), you would essentially just pipe stdout to Fluentd.</p>\n\n<p>If you happen to be also using Docker for your application you can do this easily using the built in logging drivers: </p>\n\n<p><a href=\"https://docs.docker.com/engine/admin/logging/overview/\" rel=\"nofollow noreferrer\">https://docs.docker.com/engine/admin/logging/overview/</a></p>\n\n<p>Otherwise, there seem to be a few options to help get stdout to Fluentd:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/28730462/12factor-app-capturing-stdout-stderr-logs-with-fluentd\">12Factor App: Capturing stdout/stderr logs with Fluentd</a></p>\n"}], "owner": {"reputation": 59, "user_id": 2514007, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/1dbdb537b79e8f0c15f535741539c500?s=128&d=identicon&r=PG", "display_name": "Mahesh Jadhav", "link": "https://stackoverflow.com/users/2514007/mahesh-jadhav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 856, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1461186029, "creation_date": 1461156599, "question_id": 36744360, "link": "https://stackoverflow.com/questions/36744360/capture-my-go-application-logs-into-fluentd", "title": "Capture my Go application logs into fluentd", "body": "<p>Currently I have a go web application containing over 50 .go files. Each file writes logs on STDOUT for now. \nI want to use fluentd to capture these logs and then send them to elasticsearch/kibana.</p>\n\n<p>I search on internet for solution to this. There is one package <a href=\"https://github.com/fluent/fluent-logger-golang\" rel=\"nofollow\">https://github.com/fluent/fluent-logger-golang</a> . \n To use this I would need to change my whole logging related code in each go file. \nAnd there would be many data structures that I would need to Post to fluentd.\nShortly speaking I dont want to use this approach.</p>\n\n<p>Please let me know if there are any other ways to do this.</p>\n\n<p>Thank you</p>\n"}, {"tags": ["jquery", "ajax", "go", "beego"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1461156669, "post_id": 36743844, "comment_id": 61069837, "body": "What do you mean by &quot;been blocked by the jquery&quot;?"}, {"owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "reply_to_user": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1461156984, "post_id": 36743844, "comment_id": 61070100, "body": "The page redirect is now only allowed through ajax success block. I need to redirect it from golang code."}, {"owner": {"reputation": 571, "user_id": 1049413, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9dd09ead92e1b1d21895b9318f316595?s=128&d=identicon&r=PG", "display_name": "ameykpatil", "link": "https://stackoverflow.com/users/1049413/ameykpatil"}, "edited": false, "score": 0, "creation_date": 1467657168, "post_id": 36743844, "comment_id": 63806496, "body": "@ArjunAjith Did you solve this issue? I am stuck with the same issue but couldn&#39;t find an answer here."}, {"owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "reply_to_user": {"reputation": 571, "user_id": 1049413, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9dd09ead92e1b1d21895b9318f316595?s=128&d=identicon&r=PG", "display_name": "ameykpatil", "link": "https://stackoverflow.com/users/1049413/ameykpatil"}, "edited": false, "score": 0, "creation_date": 1467696263, "post_id": 36743844, "comment_id": 63816187, "body": "@ameykpatil I added my solution as an answer. Please go through it. It is not the best way. I was not successful in finding a way to redirect from the back-end itself. But hoping this will solve your problem too."}], "answers": [{"comments": [{"owner": {"reputation": 2091, "user_id": 2658816, "user_type": "registered", "profile_image": "https://graph.facebook.com/675659038/picture?type=large", "display_name": "TravisEz13", "link": "https://stackoverflow.com/users/2658816/travisez13"}, "edited": false, "score": 0, "creation_date": 1465676232, "post_id": 37767958, "comment_id": 63004742, "body": "This seems like a suggestion/comment rather than an answer.  See <a href=\"http://stackoverflow.com/help/how-to-answer\">How to write a good answer</a>"}], "tags": [], "owner": {"reputation": 249, "user_id": 6434572, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-vdIwfuyofuk/AAAAAAAAAAI/AAAAAAAAEFY/jtSubKpYTKU/photo.jpg?sz=128", "display_name": "Ivan Tsenov", "link": "https://stackoverflow.com/users/6434572/ivan-tsenov"}, "is_accepted": false, "score": -1, "last_activity_date": 1465674696, "creation_date": 1465674696, "answer_id": 37767958, "question_id": 36743844, "link": "https://stackoverflow.com/questions/36743844/how-to-redirect-to-another-template-from-golang-while-using-jquery-form-submit/37767958#37767958", "title": "How to redirect to another template from golang while using jquery form submit?", "body": "<p>Can't you redirect to a completely new controller with c.Redirect(redirectURL, 302), where 'c' is your controller ?</p>\n\n<p>I basically use different controllers for \"/\", \"/register\" etc.</p>\n"}, {"tags": [], "owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "is_accepted": false, "score": 0, "last_activity_date": 1467696728, "last_edit_date": 1467696728, "creation_date": 1467696072, "answer_id": 38195665, "question_id": 36743844, "link": "https://stackoverflow.com/questions/36743844/how-to-redirect-to-another-template-from-golang-while-using-jquery-form-submit/38195665#38195665", "title": "How to redirect to another template from golang while using jquery form submit?", "body": "<p>What I ended up doing is not a perfect way. But it solved my problem. So I am sharing it. I welcome all suggestions and any other solutions for this problem. </p>\n\n<pre><code>switch dbStatus {\n    case 0://db Error\n        dataToClient = \"Server Connection Error\"\n        this.Ctx.ResponseWriter.Write([]byte(dataToClient)) //Error_msg_1\n    case 1://Email already in use\n        dataToClient = \"EmailError\"\n        this.Ctx.ResponseWriter.Write([]byte(dataToClient)) //Error_msg_2\n    case 2://UserName already in use\n        dataToClient = \"UserNameError\"\n        this.Ctx.ResponseWriter.Write([]byte(dataToClient)) //Error_msg_3\n    case 3://Everything is fine\n        if user.UserType == 0 { //Choosing the url\n            dataToClient = \"/admin_home\" //url_1\n            this.Ctx.ResponseWriter.Write([]byte(dataToClient))\n        } else {\n            dataToClient = \"/user_home\" //url_2\n            this.Ctx.ResponseWriter.Write([]byte(dataToClient))\n        }\n    }\n</code></pre>\n\n<p>I was not successful in finding out a method to redirect from the back-end. So I coded to choose the url path from the back-end and send it to the front-end with <code>this.Ctx.ResponseWriter.Write([]byte(dataToClient))</code></p>\n\n<p>Now in front-end I did the following:</p>\n\n<pre><code>$(\"#signupForm\").validate({\n            rules: {\n                fullName: \"required\"\n            },\n            messages: {\n                fullName: \"Please enter your full name\"\n            },\n            submitHandler: function(form){\n                $(form).ajaxSubmit({\n                        url: '/add_user',\n                        type: 'POST',\n                        dataType: 'html',\n                        data : $( \"#signupForm\" ).serialize(),\n                        success : function(data) {\n                            //Checking whether the data from back-end is an url or not... \n                            if (data.charAt(0) === '/'){ // if url\n                                window.location.href = data;\n                            }else{ //else error message\n                                document.getElementById('regError').innerHTML = data;\n                            }\n\n                        }\n                });\n                return false\n            }\n        });\n    });\n</code></pre>\n"}], "owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1032, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1467696728, "creation_date": 1461155360, "question_id": 36743844, "link": "https://stackoverflow.com/questions/36743844/how-to-redirect-to-another-template-from-golang-while-using-jquery-form-submit", "title": "How to redirect to another template from golang while using jquery form submit?", "body": "<p>I am using form submit jquery to a html page. Data is successfully delivered to my backend beego(golang framework) controller. After running some functions the controller had to decide where to redirect next. But this is been blocked by the jquery. How can I override jquery and redirect using go code?</p>\n\n<p>My script</p>\n\n<pre><code>$().ready(function() {\n    $(\"#signupForm\").validate({\n        rules: {\n            fullname: \"required\"                \n        },\n        messages: {\n            fullname: \"Please enter your full name\"\n        },\n        submitHandler: function(form){\n            $(form).ajaxSubmit({\n                    url: '/add_user',\n                    type: 'POST',\n                    dataType: 'html',\n                    data : $( \"#signupForm\" ).serialize(),\n                    success : function(data) {\n\n                    }\n            });\n            return false\n        }\n    });\n});\n</code></pre>\n\n<p>My code</p>\n\n<pre><code>status := user.AddUserAndCompany(company)\nswitch status {\ncase true:\n    this.Data[\"Website\"] = \"beego.me\"\n    this.Data[\"Email\"] = \"astaxie@gmail.com\"\n    this.TplName = \"index.tpl\"\ncase false:\n    this.Data[\"ErrorMessage\"] = \"ServerConnectionError\"\n    this.Layout = \"layouts/header_logout.html\"\n    this.TplName = \"templates/registration.html\"\n}\n</code></pre>\n"}, {"tags": ["go", "connection", "amqp"], "answers": [{"comments": [{"owner": {"reputation": 1039, "user_id": 8294118, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8cd5c198656aa0d0075eaadd22c0c316?s=128&d=identicon&r=PG&f=1", "display_name": "user666", "link": "https://stackoverflow.com/users/8294118/user666"}, "edited": false, "score": 0, "creation_date": 1594098391, "post_id": 36742821, "comment_id": 110998959, "body": "how can I configure two rabbit mq hosts for connection failover? (configure primary and secondary hosts)"}], "tags": [], "owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "is_accepted": true, "score": 0, "last_activity_date": 1461152823, "creation_date": 1461152823, "answer_id": 36742821, "question_id": 36740066, "link": "https://stackoverflow.com/questions/36740066/golang-amqp-reconnect/36742821#36742821", "title": "Golang amqp reconnect", "body": "<p>You should put channel in confirm mode. by calling the <a href=\"https://godoc.org/github.com/streadway/amqp#Channel.Confirm\" rel=\"nofollow\">channel.Confirm()</a> method. \nAfter closing the connection and even after getting new channel on the same connection, you should call Confirm() method again, since the channel is different from the old channel, and the default for all new channel is not to send confirm. </p>\n"}], "owner": {"reputation": 3, "user_id": 2729744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1de2b2fde52e5d4c32f4b8be3c9c3f21?s=128&d=identicon&r=PG&f=1", "display_name": "oke11o", "link": "https://stackoverflow.com/users/2729744/oke11o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3903, "favorite_count": 0, "accepted_answer_id": 36742821, "answer_count": 1, "score": 0, "last_activity_date": 1463133623, "creation_date": 1461145942, "last_edit_date": 1463133623, "question_id": 36740066, "link": "https://stackoverflow.com/questions/36740066/golang-amqp-reconnect", "title": "Golang amqp reconnect", "body": "<p>I want to test the restart connection to the <code>rabbitmq</code> server. \nOn wrote small script to test.\n<a href=\"http://play.golang.org/p/l3ZWzG0Qqb\" rel=\"nofollow\">http://play.golang.org/p/l3ZWzG0Qqb</a>\nBut it's not working.</p>\n\n<p>In step 10, I close the channel and connection. And open them again. And re-create chan amqp.Confirmation ( :75) . And continue the cycle.\nBut after that, from the chan confirms nothing return.</p>\n\n<p>UPD: code here.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/streadway/amqp\"\n    \"log\"\n    \"os\"\n    \"time\"\n)\n\nconst SERVER = \"amqp://user:pass@localhost:5672/\"\nconst EXCHANGE_NAME = \"publisher.test.1\"\nconst EXCHANGE_TYPE = \"direct\"\nconst ROUTING_KEY = \"publisher.test\"\n\nvar Connection *amqp.Connection\nvar Channel *amqp.Channel\n\nfunc setup(url string) (*amqp.Connection, *amqp.Channel, error) {\n    conn, err := amqp.Dial(url)\n    if err != nil {\n        return nil, nil, err\n    }\n\n    ch, err := conn.Channel()\n    if err != nil {\n        return nil, nil, err\n    }\n\n    return conn, ch, nil\n}\n\nfunc main() {\n    url := SERVER\n\n    Connection, Channel, err := setup(url)\n    if err != nil {\n        fmt.Println(\"err publisher setup:\", err)\n        return\n    }\n\n    confirms := Channel.NotifyPublish(make(chan amqp.Confirmation, 1))\n    if err := Channel.Confirm(false); err != nil {\n        log.Fatalf(\"confirm.select destination: %s\", err)\n    }\n\n    for i := 1; i &lt;= 3000000; i++ {\n        log.Println(i)\n\n        if err != nil {\n            fmt.Println(\"err consume:\", err)\n            return\n        }\n\n        if err := Channel.Publish(EXCHANGE_NAME, ROUTING_KEY, false, false, amqp.Publishing{\n            Body: []byte(fmt.Sprintf(\"%d\", i)),\n        }); err != nil {\n            fmt.Println(\"err publish:\", err)\n            log.Printf(\"%+v\", err)\n            os.Exit(1)\n            return\n        }\n\n        // only ack the source delivery when the destination acks the publishing\n        confirmed := &lt;-confirms\n        if confirmed.Ack {\n            log.Printf(\"confirmed delivery with delivery tag: %d\", confirmed.DeliveryTag)\n        } else {\n            log.Printf(\"failed delivery of delivery tag: %d\", confirmed.DeliveryTag)\n            // TODO. Reconnect will be here\n        }\n\n        if i == 10 {\n            Channel.Close()\n            Connection.Close()\n            while := true\n            for while {\n                log.Println(\"while\")\n                time.Sleep(time.Second * 1)\n                Connection, Channel, err = setup(url)\n                if err == nil {\n                    while = false\n                    confirms = Channel.NotifyPublish(make(chan amqp.Confirmation, 1))\n                    log.Printf(\"%+v\", confirms)\n                }\n            }\n        }\n        time.Sleep(time.Millisecond * 300)\n    }\n\n    os.Exit(1)\n}\n</code></pre>\n"}, {"tags": ["go", "oauth-2.0", "angular"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1461153958, "post_id": 36739718, "comment_id": 61067780, "body": "<a href=\"https://godoc.org/golang.org/x/oauth2\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/oauth2</a>"}], "owner": {"reputation": 135, "user_id": 2717619, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/8e2fab3cc45180b5164d5d035220a3d0?s=128&d=identicon&r=PG&f=1", "display_name": "user2717619", "link": "https://stackoverflow.com/users/2717619/user2717619"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 361, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1461145106, "creation_date": 1461145106, "question_id": 36739718, "link": "https://stackoverflow.com/questions/36739718/angular-2-front-end-oauth2-go-rest", "title": "Angular 2 Front End + oAuth2 + Go REST", "body": "<p>I am struggling to understand how to integrate oAuth2 with Angular 2 as Front end and REST API in Go.</p>\n\n<p>Basically i want user to login using their Facebook, LinkedIn, google+. I want my WEB API in GO to secure requests using some kind of token authentication.</p>\n\n<p>Can anyone please point me in right direction how to do using all these 3 (Angular 2, 0Auth2 and Go as REST</p>\n\n<p>Thanks</p>\n"}, {"tags": ["rest", "http", "go", "timeout", "mutex"], "comments": [{"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 1, "creation_date": 1461143515, "post_id": 36738688, "comment_id": 61060369, "body": "Try replacing sync.Mutex() with sync.Mutex{}"}, {"owner": {"reputation": 5926, "user_id": 3128156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/h3FIS.jpg?s=128&g=1", "display_name": "Sahand", "link": "https://stackoverflow.com/users/3128156/sahand"}, "reply_to_user": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1461143787, "post_id": 36738688, "comment_id": 61060563, "body": "That solved some things... thx"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1461143923, "post_id": 36738688, "comment_id": 61060645, "body": "This seems all wrong and even more racy than the old code. Don&#39;t put the mutex inside your struct, keep it in Read and synchronize access to <code>res</code>. Maybe even better: get rid of the named return parameter and return either the value from Get or your error sentinel. Maybe even better: Transfer the response from Get to read via a channel."}, {"owner": {"reputation": 5926, "user_id": 3128156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/h3FIS.jpg?s=128&g=1", "display_name": "Sahand", "link": "https://stackoverflow.com/users/3128156/sahand"}, "edited": false, "score": 0, "creation_date": 1461144598, "post_id": 36738688, "comment_id": 61061181, "body": "Thx Volker. How is it wrong? As far as I can see there can be no data race now."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1461144775, "post_id": 36738688, "comment_id": 61061328, "body": "Access to the named return <code>res</code> is unsynchronised, thus racy."}, {"owner": {"reputation": 5926, "user_id": 3128156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/h3FIS.jpg?s=128&g=1", "display_name": "Sahand", "link": "https://stackoverflow.com/users/3128156/sahand"}, "edited": false, "score": 0, "creation_date": 1461145389, "post_id": 36738688, "comment_id": 61061808, "body": "How can it be? I locked it in <code>select{}</code>. And the go-routine is started AFTER I have initialized the res."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1461148022, "post_id": 36738688, "comment_id": 61063772, "body": "Writing to res in the go routine is unsynchronized."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1461156403, "post_id": 36738688, "comment_id": 61069626, "body": "Even after getting this sorted out, this is the wrong way to timeout an http request. Set the http <code>Client.Timeout</code>. You&#39;re not providing any way to cancel an in-flight request, which may never release its resources."}], "answers": [{"tags": [], "owner": {"reputation": 5926, "user_id": 3128156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/h3FIS.jpg?s=128&g=1", "display_name": "Sahand", "link": "https://stackoverflow.com/users/3128156/sahand"}, "is_accepted": false, "score": 1, "last_activity_date": 1461146993, "creation_date": 1461146993, "answer_id": 36740524, "question_id": 36738688, "link": "https://stackoverflow.com/questions/36738688/how-to-create-elements-of-a-struct-with-a-mutex-field/36740524#36740524", "title": "How to create elements of a struct with a Mutex field", "body": "<p>I followed Volker's suggestion and used a channel to solve the problem.</p>\n\n<pre><code>func Read(url string, timeout time.Duration) (res *Response) { \n    done := make(chan bool) // A channel\n    resChan := make(chan *Response)\n\n    go func() { \n        resChan &lt;- Get(url) \n        done &lt;- true    \n    }()     \n    select {    \n        case &lt;-done:\n            res = &amp;Response{}    \n        case &lt;-time.After(timeout):\n            res = &amp;Response{\"Gateway timeout\\n\", 504} \n    }\n    return\n}\n</code></pre>\n\n<p>Now, there can be no simultaneous writes to res. It's going to be either the timeout or the returned value of <code>Get(url)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 2, "last_activity_date": 1461155163, "creation_date": 1461155163, "answer_id": 36743767, "question_id": 36738688, "link": "https://stackoverflow.com/questions/36738688/how-to-create-elements-of-a-struct-with-a-mutex-field/36743767#36743767", "title": "How to create elements of a struct with a Mutex field", "body": "<p>While your answer with Volker's guidance is good, you might want to consider using a non default <code>http.Client</code> so that you can set a <code>Timeout</code> on the client making the request (then you don't have to worry about handling the timeouts yourself).</p>\n"}], "owner": {"reputation": 5926, "user_id": 3128156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/h3FIS.jpg?s=128&g=1", "display_name": "Sahand", "link": "https://stackoverflow.com/users/3128156/sahand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1461155163, "creation_date": 1461142705, "last_edit_date": 1461143869, "question_id": 36738688, "link": "https://stackoverflow.com/questions/36738688/how-to-create-elements-of-a-struct-with-a-mutex-field", "title": "How to create elements of a struct with a Mutex field", "body": "<p>I have a <code>Get()</code> function:</p>\n\n<pre><code>func Get(url string) *Response {\n    res, err := http.Get(url)\n    if err != nil {\n        return &amp;Response{}\n    }\n    // res.Body != nil when err == nil\n    defer res.Body.Close()\n    body, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        log.Fatalf(\"ReadAll: %v\", err)\n    }\n    reflect.TypeOf(body)\n    return &amp;Response{sync.Mutex(),string(body), res.StatusCode}\n}\n</code></pre>\n\n<p>as well as a <code>Read()</code> function:</p>\n\n<pre><code>func Read(url string, timeout time.Duration) (res *Response) { \n    done := make(chan bool) \n\n    go func() {\n        res = Get(url)      \n        done &lt;- true        \n    }()     \n        select {    // As soon as either\n    case &lt;-done:    // done is sent on the channel or \n    case &lt;-time.After(timeout): // timeout\n        res = &amp;Response{\"Gateway timeout\\n\", 504}\n\n    }\n    return\n}\n</code></pre>\n\n<p>the <code>Response</code> type returned by the functions is defined as:</p>\n\n<pre><code>type Response struct {\n    Body       string\n    StatusCode int\n}\n</code></pre>\n\n<p>This read function makes use of the <code>Get()</code> function and also implements a timeout. The problem is that a data race can occur if the timeout occurs and the <code>Get()</code> response is written to <code>res</code> at the same time in <code>Read()</code>. </p>\n\n<p>I have a plan for how to solve this. It is to use Mutex. To do this, I would add a field to the <code>Response</code> struct:</p>\n\n<pre><code>type Response struct {\n    mu         sync.Mutex\n    Body       string\n    StatusCode int\n}\n</code></pre>\n\n<p>so that the <code>Response</code> can be locked. However, I'm not sure how to fix this in the other parts of the code.</p>\n\n<p>My attempt looks like this, for the Get():</p>\n\n<pre><code>func Get(url string) *Response {\n    res, err := http.Get(url)\n    if err != nil {\n        return &amp;Response{}\n    }\n    // res.Body != nil when err == nil\n    defer res.Body.Close()\n    body, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        log.Fatalf(\"ReadAll: %v\", err)\n    }\n    reflect.TypeOf(body)\n    return &amp;Response{sync.Mutex(),string(body), res.StatusCode} // This line is changed.\n}\n</code></pre>\n\n<p>and for the <code>Read()</code>:</p>\n\n<pre><code>func Read(url string, timeout time.Duration) (res *Response) { \n    done := make(chan bool) \n    res = &amp;Response{sync.Mutex()} // this line has been added\n\n    go func() { \n        res = Get(url)      \n        done &lt;- true        \n    }()     \n        select {    \n    case &lt;-done:    \n    case &lt;-time.After(timeout):\n        res.mu.Lock()\n        res = &amp;Response{sync.Mutex(), \"Gateway timeout\\n\", 504} // And mutex was added here.\n\n    }\n    defer res.mu.Unlock()\n    return\n}\n</code></pre>\n\n<p>This \"solution\" generates these errors:</p>\n\n<pre><code>./client.go:54: missing argument to conversion to sync.Mutex: sync.Mutex()\n./client.go:63: missing argument to conversion to sync.Mutex: sync.Mutex()\n./client.go:63: too few values in struct initializer\n./client.go:73: missing argument to conversion to sync.Mutex: sync.Mutex()\n./client.go:95: cannot use \"Service unavailable\\n\" (type string) as type sync.Mutex in field value\n./client.go:95: cannot use 503 (type int) as type string in field value\n./client.go:95: too few values in struct initializer\n</code></pre>\n\n<p>What is the correct way of using Mutex in this case?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 1, "creation_date": 1461143649, "post_id": 36738522, "comment_id": 61060455, "body": "<code>func (this *MyObj)func2(myval string) string{}</code> and in the map <code>&quot;func2&quot;:myobj.func2</code>"}, {"owner": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1461144277, "post_id": 36738522, "comment_id": 61060894, "body": "Thanks a lot @JiangYD!"}, {"owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "edited": false, "score": 0, "creation_date": 1461153085, "post_id": 36738522, "comment_id": 61067128, "body": "also :<code>template.FuncMap{ &quot;func2&quot; : func(myval string) string { return origFunc(myval, othervar, anotherVar) } }</code>  the othevar and anothervar are available in this context (a global var, a local var in this scope or ...)"}], "answers": [{"tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1461155404, "creation_date": 1461155404, "answer_id": 36743862, "question_id": 36738522, "link": "https://stackoverflow.com/questions/36738522/pass-separate-value-into-template-function/36743862#36743862", "title": "Pass separate value into template function", "body": "<p>Credit to @JiangYD</p>\n\n<pre><code>func (o *MyObj)func2(myval string) string{}`\n\nfunc (o *MyObj) run() error{\n  funcMap := template.FuncMap{\n    \"func1\": func1,\n    \"func2\": o.func2,\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1461771111, "creation_date": 1461142297, "last_edit_date": 1461771111, "question_id": 36738522, "link": "https://stackoverflow.com/questions/36738522/pass-separate-value-into-template-function", "title": "Pass separate value into template function", "body": "<p>I am trying to find a way to pass value into go template function.\nWhat i mean. I have template functions list defined in struct method:</p>\n\n<pre><code>func (o *MyObj) run() error{\n  funcMap := template.FuncMap{\n    \"func1\": func1,\n    \"func2\": func2,\n    }\n}\n</code></pre>\n\n<p>Function1 signature is <code>func func1(myval string) string{...}</code>, but for Function2 id need to have access to one of MyObj struct field. \nMean:</p>\n\n<pre><code>func func2(myval string) string{\n//MyObj.field would need to be used here.. How can i do it?\n}\n</code></pre>\n"}, {"tags": ["debugging", "intellij-idea", "go"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1461135524, "post_id": 36735860, "comment_id": 61054819, "body": "make sure run to the breakpoints by adding log firstly."}, {"owner": {"reputation": 1458, "user_id": 4258041, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Uqg94.jpg?s=128&g=1", "display_name": "Yan Yang", "link": "https://stackoverflow.com/users/4258041/yan-yang"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1461137240, "post_id": 36735860, "comment_id": 61055922, "body": "@JiangYD What kind of log should be added firstly?"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1461143257, "post_id": 36735860, "comment_id": 61060186, "body": "any print to stdout, to make sure the breakpoint is reached."}], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 3, "last_activity_date": 1469181745, "last_edit_date": 1469181745, "creation_date": 1461143633, "answer_id": 36739052, "question_id": 36735860, "link": "https://stackoverflow.com/questions/36735860/golang-breakpoints-not-work-in-intellij-idea-2016-1-1/36739052#36739052", "title": "golang breakpoints not work in intellij idea 2016.1.1", "body": "<p>Update, this has been fixed in the latest release of the plugin, please <a href=\"http://go-ide.com/releases/0.11.1725/\" rel=\"nofollow\">check it out</a></p>\n\n<p>This is a well known problem and it lies in delve not the plugin itself. Please see this <a href=\"https://github.com/go-lang-plugin-org/go-lang-idea-plugin/issues/2360\" rel=\"nofollow\">this issue</a> for further reference.</p>\n"}], "owner": {"reputation": 1458, "user_id": 4258041, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Uqg94.jpg?s=128&g=1", "display_name": "Yan Yang", "link": "https://stackoverflow.com/users/4258041/yan-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2059, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1469181745, "creation_date": 1461134845, "question_id": 36735860, "link": "https://stackoverflow.com/questions/36735860/golang-breakpoints-not-work-in-intellij-idea-2016-1-1", "title": "golang breakpoints not work in intellij idea 2016.1.1", "body": "<p>I was debugging a GoLang program. I set break points and run the debugger. But the break points only works the first time I run the debugger and failed in the second, the third, and all following debugging whatever I do. I cancelled them and reset them, I close the debugging window and open a new one, I change the settings in the \"Breakpoints\" tool window. All these didn't work at all.\nWhat's the problem?</p>\n"}, {"tags": ["go", "rethinkdb"], "answers": [{"tags": [], "owner": {"reputation": 3916, "user_id": 6171361, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6HzJh.jpg?s=128&g=1", "display_name": "sel-fish", "link": "https://stackoverflow.com/users/6171361/sel-fish"}, "is_accepted": true, "score": 2, "last_activity_date": 1461521093, "creation_date": 1461521093, "answer_id": 36826936, "question_id": 36734721, "link": "https://stackoverflow.com/questions/36734721/how-to-rename-result-field-in-golang-rethinkdb-driver-gorethink/36826936#36826936", "title": "How to rename result field in golang rethinkdb driver gorethink?", "body": "<p>I just port your node.js code (in your former version) to golang :</p>\n\n<pre><code>  session, err := r.Connect(r.ConnectOpts{\n    Address: \"localhost:28015\",\n  })\n  if err != nil {\n    return\n  }\n\n  res, err := table.ConcatMap(func(customer r.Term) interface{} {\n    return customer.Field(\"purchases\").Map(func(purchase r.Term) interface{} {\n      return map[string]interface{}{\n        \"zip\":     customer.Field(\"address\").Field(\"zip\"),\n        \"product\": purchase.Field(\"name\"),\n      }\n    })\n  }).Run(session)\n\n  if err != nil {\n    return\n  }\n\n  defer res.Close()\n\n  var response interface{}\n  for res.Next(&amp;response) {\n    fmt.Println(response)\n  }\n</code></pre>\n"}], "owner": {"reputation": 8597, "user_id": 1039481, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/a10ec3de7bec751e1633eba0ef28d4cb?s=128&d=identicon&r=PG", "display_name": "Akhil Thayyil", "link": "https://stackoverflow.com/users/1039481/akhil-thayyil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 36826936, "answer_count": 1, "score": 0, "last_activity_date": 1461521093, "creation_date": 1461130789, "last_edit_date": 1461131258, "question_id": 36734721, "link": "https://stackoverflow.com/questions/36734721/how-to-rename-result-field-in-golang-rethinkdb-driver-gorethink", "title": "How to rename result field in golang rethinkdb driver gorethink?", "body": "<pre><code>r.table('customers')\n  .map(function(purchase) {\n      return {zip:customer('address')('zip'), product:purchase('name')};\n    })      \n .run(...)\n</code></pre>\n\n<p>How can i represent <code>map({\"new_column_name\":Row.Field(\"original_column_name\")})</code> in \n<a href=\"https://github.com/dancannon/gorethink\" rel=\"nofollow\">gorethink</a></p>\n\n<p>Any help is appreciated...</p>\n"}, {"tags": ["go", "concurrency"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 1, "last_activity_date": 1461122613, "creation_date": 1461122613, "answer_id": 36733250, "question_id": 36733182, "link": "https://stackoverflow.com/questions/36733182/why-i-can-not-see-output-when-received-value-by-channel/36733250#36733250", "title": "why I can not see output when received value by channel", "body": "<p>Because the program exits when it reaches the end of <code>func main</code>, regardless of whether any other goroutines are running. As soon as the second function receives from the <code>end</code> channel, main's send on that channel is unblocked and the program finishes, before the received value gets a chance to be passed to <code>Println</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 0, "last_activity_date": 1461133055, "creation_date": 1461133055, "answer_id": 36735305, "question_id": 36733182, "link": "https://stackoverflow.com/questions/36733182/why-i-can-not-see-output-when-received-value-by-channel/36735305#36735305", "title": "why I can not see output when received value by channel", "body": "<p>The end value is not printed because as soon as the <code>main</code> goroutine (the <code>main</code> function is actually a goroutine) is finished (in other terms get unblocked) the other non-main goroutines does not have the chance to get completed. </p>\n\n<p><em>When the function main() returns, the program exits.</em> Moreover goroutines are independent units of execution and when a number of them starts one after the other you cannot depend on when a goroutine will actually be started. The logic of your code must be independent of the order in which goroutines are invoked.</p>\n\n<p>One way to solve your problem (and the easiest one in your case) is to put a <code>time.Sleep</code> at the end of your <code>main()</code> function.</p>\n\n<pre><code>time.Sleep(1e9)\n</code></pre>\n\n<p>This will guarantee that the main goroutine will not unblock and the other goroutines will have a change to get executed.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    start := make(chan int)\n    end := make(chan int)\n\n    go func() {\n        fmt.Println(\"Start\")\n        fmt.Println(&lt;-start)\n    }()\n\n    go func() {\n        fmt.Println(\"End\")\n        fmt.Println(&lt;-end)\n    }()\n\n    start &lt;- 1\n    end &lt;- 2\n\n    time.Sleep(1e9)\n}\n</code></pre>\n\n<p>Another solution as you mentioned is to use <code>waitgroup</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 116, "user_id": 6559048, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd934e39469f78fbf51808f698c75917?s=128&d=identicon&r=PG&f=1", "display_name": "ganesh kumar", "link": "https://stackoverflow.com/users/6559048/ganesh-kumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1474273928, "creation_date": 1474273928, "answer_id": 39568643, "question_id": 36733182, "link": "https://stackoverflow.com/questions/36733182/why-i-can-not-see-output-when-received-value-by-channel/39568643#39568643", "title": "why I can not see output when received value by channel", "body": "<p>Apart from sleep where you have to specify the time, you can use waitgroup to make you program wait until the goroutine completes execution.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"sync\"\n\nvar wg sync.WaitGroup\n\nfunc main() {\n    start := make(chan int)\n    end := make(chan int)\n\n    wg.Add(2)\n    go func() {\n        defer wg.Done()\n        fmt.Println(\"Start\")\n        fmt.Println(&lt;-start)\n    }()\n\n    go func() {\n        defer wg.Done()\n        fmt.Println(\"End\")\n        fmt.Println(&lt;-end)\n    }()\n\n    start &lt;- 1\n    end &lt;- 2\n    wg.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 5695670, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dd079a335a1ef8e7b26cab86b88a6a63?s=128&d=identicon&r=PG&f=1", "display_name": "Unknown", "link": "https://stackoverflow.com/users/5695670/unknown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 36733250, "answer_count": 3, "score": 1, "last_activity_date": 1474273928, "creation_date": 1461122147, "question_id": 36733182, "link": "https://stackoverflow.com/questions/36733182/why-i-can-not-see-output-when-received-value-by-channel", "title": "why I can not see output when received value by channel", "body": "<p>in the next example, I don't understand why end value not printed when received</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    start := make(chan int)\n    end := make(chan int)\n\n    go func() {\n        fmt.Println(\"Start\")\n        fmt.Println(&lt;-start)\n    }()\n\n    go func() {\n        fmt.Println(\"End\")\n        fmt.Println(&lt;-end)\n    }()\n\n    start &lt;- 1\n    end &lt;- 2\n}\n</code></pre>\n\n<p>I know sync.WaitGroup can solve this problem. </p>\n"}, {"tags": ["regex", "go", "wikipedia"], "comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 3, "creation_date": 1461137642, "post_id": 36732212, "comment_id": 61056221, "body": "Parsing the structures of such complexity with regular expressions is not a good idea. It is better to write a proper parser."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1461168317, "post_id": 36732212, "comment_id": 61079487, "body": "@Grzegorz\u017bur If there&#39;s a way to get the info from the API that is fine but I couldn&#39;t find anything....I can only seem to get just the infobox and not the individual pieces"}, {"owner": {"reputation": 17526, "user_id": 711902, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/36a9e6931ec4828c293156c50ac339ec?s=128&d=identicon&r=PG", "display_name": "Trevor Dixon", "link": "https://stackoverflow.com/users/711902/trevor-dixon"}, "edited": false, "score": 0, "creation_date": 1461169122, "post_id": 36732212, "comment_id": 61080015, "body": "<a href=\"https://www.mediawiki.org/wiki/API:Parsing_wikitext\" rel=\"nofollow noreferrer\">mediawiki.org/wiki/API:Parsing_wikitext</a> might help."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 17526, "user_id": 711902, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/36a9e6931ec4828c293156c50ac339ec?s=128&d=identicon&r=PG", "display_name": "Trevor Dixon", "link": "https://stackoverflow.com/users/711902/trevor-dixon"}, "edited": false, "score": 0, "creation_date": 1461169646, "post_id": 36732212, "comment_id": 61080352, "body": "@TrevorDixon I&#39;ve read that but couldn&#39;t find a way to extract the info w/in the infobox...maybe I&#39;m just being stupid"}], "answers": [{"tags": [], "owner": {"reputation": 5492, "user_id": 6083675, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/D2CgS.png?s=128&g=1", "display_name": "Laurel", "link": "https://stackoverflow.com/users/6083675/laurel"}, "is_accepted": true, "score": 0, "last_activity_date": 1461256860, "creation_date": 1461256860, "answer_id": 36775769, "question_id": 36732212, "link": "https://stackoverflow.com/questions/36732212/parse-wikipedia-infobox-with-go/36775769#36775769", "title": "Parse Wikipedia Infobox with Go?", "body": "<p>I made a regex that might work for you:</p>\n\n<p><code>^\\s*\\|\\s*([^\\s]+)\\s*=\\s*(\\{\\{Plainlist\\|(?:\\n\\s*\\*.*)*|.*)</code></p>\n\n<h1>Explanation</h1>\n\n<ul>\n<li><p>This part: <code>^\\s*\\|\\s*([^\\s]+)\\s*=\\s*</code> matches the start of lines like:</p>\n\n<pre><code>    | &lt;the_label&gt; = \n</code></pre></li>\n<li><p>Continuing on the same line, this part: <code>(\\{\\{Plainlist\\|(?:\\n\\s*\\*.*)*|.*)</code> will match lists:</p>\n\n<pre><code>                     {{Plainlist|\n* [[Ernst G. Straus]]\n* [[Nathan Rosen]]\n* [[Le\u00f3 Szil\u00e1rd]]\n</code></pre></li>\n</ul>\n\n<p>(Note that it may omit the final <code>}}</code>. Oh well.)</p>\n\n<ul>\n<li>If there is no list, it matches until the end of the line.</li>\n</ul>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 36775769, "answer_count": 1, "score": 1, "last_activity_date": 1461256860, "creation_date": 1461115225, "last_edit_date": 1495542671, "question_id": 36732212, "link": "https://stackoverflow.com/questions/36732212/parse-wikipedia-infobox-with-go", "title": "Parse Wikipedia Infobox with Go?", "body": "<p>I am trying to parse the Infobox for some wikipedia articles and cannot seem to figure it out. I have downloaded the files and for Albert Einstein and my attempt to parse the Infobox <a href=\"http://play.golang.org/p/JMmEli2lNn\" rel=\"nofollow noreferrer\">looks like this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"regexp\"\n)\n\nfunc main() {\n    st := `{{redirect|Einstein|other uses|Albert Einstein (disambiguation)|and|Einstein (disambiguation)}}\n        {{pp-semi-indef}}\n        {{pp-move-indef}}\n        {{Good article}}\n        {{Infobox scientist\n        | name       = Albert Einstein\n        | image       = Einstein 1921 by F Schmutzer - restoration.jpg\n        | caption     = Albert Einstein in 1921\n        | birth_date  = {{Birth date|df=yes|1879|3|14}}\n        | birth_place = [[Ulm]], [[Kingdom of W\u00fcrttemberg]], [[German Empire]]\n        | death_date  = {{Death date and age|df=yes|1955|4|18|1879|3|14}}\n        | death_place = {{nowrap|[[Princeton, New Jersey]], U.S.}}\n        | children    = [[Lieserl Einstein|\"Lieserl\"]] (1902\u20131903?)&lt;br /&gt;[[Hans Albert Einstein|Hans Albert]] (1904\u20131973)&lt;br /&gt;[[Eduard Einstein|Eduard \"Tete\"]] (1910\u20131965)\n        | spouse      = [[Mileva Mari\u0107]]&amp;nbsp;(1903\u20131919)&lt;br /&gt;{{nowrap|[[Elsa L\u00f6wenthal]]&amp;nbsp;(1919\u20131936)}}\n        | residence   = Germany, Italy, Switzerland, Austria (today: [[Czech Republic]]), Belgium, United States\n        | citizenship = {{Plainlist|\n        * [[Kingdom of W\u00fcrttemberg]] (1879\u20131896)\n        * [[Statelessness|Stateless]] (1896\u20131901)\n        * [[Switzerland]] (1901\u20131955)\n        * Austria of the [[Austro-Hungarian Empire]] (1911\u20131912)\n        * Germany (1914\u20131933)\n        * United States (1940\u20131955)\n        }}\n        | ethnicity  = Jewish\n        | fields    = [[Physics]], [[philosophy]]\n        | workplaces = {{Plainlist|\n        * [[Swiss Patent Office]] ([[Bern]]) (1902\u20131909)\n        * [[University of Bern]] (1908\u20131909)\n        * [[University of Zurich]] (1909\u20131911)\n        * [[Karl-Ferdinands-Universit\u00e4t|Charles University in Prague]] (1911\u20131912)\n        * [[ETH Zurich]] (1912\u20131914)\n        * [[Prussian Academy of Sciences]] (1914\u20131933)\n        * [[Humboldt University of Berlin]] (1914\u20131917)\n        * [[Kaiser Wilhelm Institute]] (director, 1917\u20131933)\n        * [[German Physical Society]] (president, 1916\u20131918)\n        * [[Leiden University]] (visits, 1920\u2013)\n        * [[Institute for Advanced Study]] (1933\u20131955)\n        * [[Caltech]] (visits, 1931\u20131933)\n        }}\n        | alma_mater = {{Plainlist|\n        * [[ETH Zurich|Swiss Federal Polytechnic]] (1896\u20131900; B.A., 1900)\n        * [[University of Zurich]] (Ph.D., 1905)\n        }}\n        | doctoral_advisor  = [[Alfred Kleiner]]\n        | thesis_title      = Eine neue Bestimmung der Molek\u00fcldimensionen (A New Determination of Molecular Dimensions)\n        | thesis_url        = http://e-collection.library.ethz.ch/eserv/eth:30378/eth-30378-01.pdf\n        | thesis_year       = 1905\n        | academic_advisors = [[Heinrich Friedrich Weber]]\n        | influenced  = {{Plainlist|\n        * [[Ernst G. Straus]]\n        * [[Nathan Rosen]]\n        * [[Le\u00f3 Szil\u00e1rd]]\n        }}\n        | known_for = {{Plainlist|\n        * [[General relativity]] and [[special relativity]]\n        * [[Photoelectric effect]]\n        * ''[[Mass\u2013energy equivalence|E=mc&lt;sup&gt;2&lt;/sup&gt;]]''\n        * Theory of [[Brownian motion]]\n        * [[Einstein field equations]]\n        * [[Bose\u2013Einstein statistics]]\n        * [[Bose\u2013Einstein condensate]]\n        * [[Gravitational wave]]\n        * [[Cosmological constant]]\n        * [[Classical unified field theories|Unified field theory]]\n        * [[EPR paradox]]\n        }}\n        | awards = {{Plainlist|\n        * [[Barnard Medal for Meritorious Service to Science|Barnard Medal]] (1920)\n        * [[Nobel Prize in Physics]] (1921)\n        * [[Matteucci Medal]] (1921)\n        * [[ForMemRS]] (1921)&lt;ref name=\"frs\" /&gt;\n        * [[Copley Medal]] (1925)&lt;ref name=\"frs\" /&gt;\n        * [[Max Planck Medal]] (1929)\n        * [[Time 100: The Most Important People of the Century|''Time'' Person of the Century]] (1999)\n        }}\n        | signature = Albert Einstein signature 1934.svg\n    }}\n    '''Albert Einstein''' ({{IPAc-en|\u02c8|a\u026a|n|s|t|a\u026a|n}};&lt;ref&gt;{{cite book|last=Wells|first=John|authorlink=John C. Wells|title=Longman Pronunciation Dictionary|publisher=Pearson Longman|edition=3rd|date=April 3, 2008|isbn=1-4058-8118-6}}&lt;/ref&gt; {{IPA-de|\u02c8alb\u025b\u0250\u032ft \u02c8a\u026an\u0283ta\u026an|lang|Albert Einstein german.ogg}}; 14 March 1879&amp;nbsp;\u2013 18 April 1955) was a German-born&lt;!-- Please do not change this\u2014see talk page and its many archives.--&gt;\n     [[theoretical physicist]]. He developed the [[general theory of relativity]], one of the two pillars of [[modern physics]] (alongside [[quantum mechanics]]).&lt;ref name=frs&gt;{{cite journal | last1 = Whittaker | first1 = E. | authorlink = E. T. Whittaker| doi = 10.1098/rsbm.1955.0005 | title = Albert Einstein. 1879\u20131955 | journal = [[Biographical Memoirs of Fellows of the Royal Society]] | volume = 1 | pages = 37\u201367 | date = 1 November 1955| jstor = 769242}}&lt;/ref&gt;&lt;ref name=\"YangHamilton2010\"&gt;{{cite book|author1=Fujia Yang|author2=Joseph H. Hamilton|title=Modern Atomic and Nuclear Physics|date=2010|publisher=World Scientific|isbn=978-981-4277-16-7}}&lt;/ref&gt;{{rp|274}} Einstein's work is also known for its influence on the [[philosophy of science]].&lt;ref&gt;{{Citation |title=Einstein's Philosophy of Science |url=http://plato.stanford.edu/entries/einstein-philscience/#IntWasEinEpiOpp |we......\n    `\n\n    re := regexp.MustCompile(`{{Infobox(?s:.*?)}}`)\n    log.Println(re.FindAllStringSubmatch(st, -1))\n\n}\n</code></pre>\n\n<p>I am trying to put each of the items from the infobox into a struct or a map:</p>\n\n<pre><code>m[\"name\"] = \"Albert Einstein\"\nm[\"image\"] = \"Einstein....\"\n...\n...\nm[\"death_date\"] = \"{{Death date and age|df=yes|1955|4|18|1879|3|14}}\"\n...\n...\n</code></pre>\n\n<p>I can't even seem to isolate the infobox. I get:</p>\n\n<pre><code>[[{{Infobox scientist\n        | name       = Albert Einstein\n        | image       = Einstein 1921 by F Schmutzer - restoration.jpg\n        | caption     = Albert Einstein in 1921\n        | birth_date  = {{Birth date|df=yes|1879|3|14}}]]\n</code></pre>\n\n<p>The Albert Einstein entry in the API can be found at:</p>\n\n<pre><code>https://en.wikipedia.org/w/api.php?action=query&amp;titles=Albert%20Einstein&amp;prop=revisions&amp;rvprop=content&amp;format=json\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>Based on the accepted answer <a href=\"https://stackoverflow.com/questions/21228760/regex-needed-for-wikipedia-infobox?rq=1\">to this question</a> the I tried the following regex:</p>\n\n<pre><code>(?=\\{Infobox)(\\{([^{}]|(?1))*\\})\n</code></pre>\n\n<p>but get:</p>\n\n<pre><code>panic: regexp: Compile(`(?=\\{Infobox)(\\{([^{}]|(?1))*\\})`): error parsing regexp: invalid or unsupported Perl syntax: `(?=`\n</code></pre>\n\n<p>EDIT #2:\nIf there's a way to extract the information via their API then I'll take that....I've been reading through the docs and can't find it.</p>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1461112766, "post_id": 36731843, "comment_id": 61047333, "body": "This gives: ` missing len argument to make([]Cats)`"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1461113203, "post_id": 36731843, "comment_id": 61047454, "body": "<code>results := make([]Cats, 0)</code> yields error: <code>cannot use results (type []Cats) as type Cats in append</code>"}, {"owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1461113313, "post_id": 36731843, "comment_id": 61047492, "body": "<code>results = append(results, result)</code>  @Karlom"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1461113476, "post_id": 36731843, "comment_id": 61047541, "body": "<code>results = append(results, result)</code> is already there, but the error occures at the <code>results</code> declaration, not the append line above."}, {"owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1461113536, "post_id": 36731843, "comment_id": 61047559, "body": "be careful with the second argument in <code>append</code>, it should be <code>result</code> not <code>results</code> @Karlom"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1461114061, "post_id": 36731843, "comment_id": 61047679, "body": "Thanks siomon. I corrected the typo. but it did not cause the error."}], "tags": [], "owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "is_accepted": false, "score": 2, "last_activity_date": 1461136352, "last_edit_date": 1461136352, "creation_date": 1461112696, "answer_id": 36731843, "question_id": 36731805, "link": "https://stackoverflow.com/questions/36731805/how-to-append-objects-to-a-slice/36731843#36731843", "title": "How to append objects to a slice?", "body": "<p>You can use <code>results := make([]Cats, len)</code> instead, where <code>len</code> is the initial length of slice. </p>\n\n<p><code>results := []Cats{}</code> will also work.</p>\n\n<p>If you use <code>var results []Cats</code>, its initial value is <code>nil</code> so you'd need to initialize it before using <code>append</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1461113116, "post_id": 36731857, "comment_id": 61047429, "body": "<code>results := []Cats{}</code> cause this error: <code>cannot use results (type []Cats) as type Cats in append</code>"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1461113341, "post_id": 36731857, "comment_id": 61047502, "body": "<code>results := make([]Cats)</code> gives error: <code>missing len argument to make([]Cats)</code>"}, {"owner": {"reputation": 453, "user_id": 6083111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bba01cf3ef98244da8d16027dc3eb8a9?s=128&d=identicon&r=PG", "display_name": "user161778", "link": "https://stackoverflow.com/users/6083111/user161778"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1461113740, "post_id": 36731857, "comment_id": 61047611, "body": "@Karlom, for your append issue, it sounds like you&#39;re trying to append a slice to a slice, if so add <code>...</code> to the end like <code>slice1 = append(slice1, slice2...)</code>"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 453, "user_id": 6083111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bba01cf3ef98244da8d16027dc3eb8a9?s=128&d=identicon&r=PG", "display_name": "user161778", "link": "https://stackoverflow.com/users/6083111/user161778"}, "edited": false, "score": 0, "creation_date": 1461113876, "post_id": 36731857, "comment_id": 61047643, "body": "@user161778, no, using Python vocabulary,  I&#39;m trying to append an object to a list of objects."}, {"owner": {"reputation": 453, "user_id": 6083111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bba01cf3ef98244da8d16027dc3eb8a9?s=128&d=identicon&r=PG", "display_name": "user161778", "link": "https://stackoverflow.com/users/6083111/user161778"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 1, "creation_date": 1461113999, "post_id": 36731857, "comment_id": 61047663, "body": "@Karlom, then use append. You have a typo with <code>append(results, results)</code> should be <code>append(results, result)</code>"}], "tags": [], "owner": {"reputation": 52116, "user_id": 197788, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/851acbab08553d1f7aa3eecad17f6aa9?s=128&d=identicon&r=PG", "display_name": "Ken Bloom", "link": "https://stackoverflow.com/users/197788/ken-bloom"}, "is_accepted": false, "score": 5, "last_activity_date": 1461281765, "last_edit_date": 1461281765, "creation_date": 1461112806, "answer_id": 36731857, "question_id": 36731805, "link": "https://stackoverflow.com/questions/36731805/how-to-append-objects-to-a-slice/36731857#36731857", "title": "How to append objects to a slice?", "body": "<p>You can say</p>\n\n<pre><code>results := make([]Cats, 0)\n</code></pre>\n\n<p>or </p>\n\n<pre><code>var results []Cats\n</code></pre>\n\n<p>or </p>\n\n<pre><code>results := []Cats{}\n</code></pre>\n\n<p>instead.</p>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1842, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1461281765, "creation_date": 1461112488, "last_edit_date": 1461114084, "question_id": 36731805, "link": "https://stackoverflow.com/questions/36731805/how-to-append-objects-to-a-slice", "title": "How to append objects to a slice?", "body": "<p>I am new to golang and I'd like to aggregaet query results into a <code>results</code> slice to be pushed to the browser. Here is the code:</p>\n\n<pre><code>type Category struct {\n    Id          bson.ObjectId `bson:\"_id,omitempty\"`\n    Name        string\n    Description string\n    Tasks       []Task\n}\n\n\ntype Cats struct {\n    category Category\n} \n\nfunc CategoriesCtrl(w http.ResponseWriter, req *http.Request) {\n    session, err := mgo.Dial(\"localhost\")\n    if err != nil {\n        panic(err)\n    }\n    defer session.Close()\n    session.SetMode(mgo.Monotonic, true)\n    c := session.DB(\"taskdb\").C(\"categories\")\n\n    iter := c.Find(nil).Iter()\n    result := Category{}\n    results := []Cats //Here is the problem\n\n    for iter.Next(&amp;result) {\n        results = append(results, result)\n        fmt.Printf(\"Category:%s, Description:%s\\n\", result.Name, result.Description)\n        tasks := result.Tasks\n        for _, v := range tasks {\n            fmt.Printf(\"Task:%s Due:%v\\n\", v.Description, v.Due)\n        }\n    }\n    if err = iter.Close(); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Fprint(w, results)    \n}\n</code></pre>\n\n<p>But instead I get </p>\n\n<blockquote>\n  <p>type []Cats is not an expression</p>\n</blockquote>\n\n<p>How can I fix this?</p>\n"}, {"tags": ["heroku", "go"], "answers": [{"tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": true, "score": 1, "last_activity_date": 1461162690, "creation_date": 1461162690, "answer_id": 36747069, "question_id": 36730686, "link": "https://stackoverflow.com/questions/36730686/heroku-go-getting-started-not-running-localy/36747069#36747069", "title": "Heroku go-getting-started not running localy", "body": "<p>According to the <a href=\"https://devcenter.heroku.com/articles/getting-started-with-go#run-the-app-locally\" rel=\"nofollow\">Heroku Dev Center</a>:</p>\n\n<blockquote>\n  <p>If you see an error about an unrecognized command or \u201ccommand not found\u201d, then $GOPATH/bin is likely not in your $PATH or the trailing ... was missing from the go get github.com/heroku/go-getting-started/.... command used during \u201cPrepare the App\u201d.</p>\n</blockquote>\n\n<p>Make sure <code>$GOPATH/bin</code> (in your case, <code>C:\\Users\\XXXX\\gocode\\bin</code>) is in your <code>$PATH</code> variable. The server binary, <code>go-getting-started</code>, is already there, you just need to make it available to the command line.</p>\n"}], "owner": {"reputation": 2258, "user_id": 466750, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/1tgEA.jpg?s=128&g=1", "display_name": "Madu Alikor", "link": "https://stackoverflow.com/users/466750/madu-alikor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 472, "favorite_count": 0, "accepted_answer_id": 36747069, "answer_count": 1, "score": 1, "last_activity_date": 1461162690, "creation_date": 1461105253, "question_id": 36730686, "link": "https://stackoverflow.com/questions/36730686/heroku-go-getting-started-not-running-localy", "title": "Heroku go-getting-started not running localy", "body": "<p>Does anyone know why i'm unable to run the go-getting-started application localy?</p>\n\n<pre><code>go get github.com/heroku/go-getting-started/cmd/...\ncd $env:GOPATH/src/github.com/heroku/go-getting-started\n\nPS C:\\Users\\XXXX\\gocode\\src\\github.com\\heroku\\go-getting-started&gt; heroku  local\n[OKAY] Loaded ENV .env File as KEY=VALUE Format\n[OKAY] Trimming display Output to 107 Columns\n11:28:05 PM web.1 |  'go-getting-started' is not recognized as an internal or external command,\n11:28:05 PM web.1 |  operable program or batch file.\n[DONE] Killing all processes with signal  null\n11:28:05 PM web.1 Exited Abnormally\nPS C:\\Users\\XXXX\\gocode\\src\\github.com\\heroku\\go-getting-started&gt; code .\n</code></pre>\n"}, {"tags": ["parsing", "datetime", "go"], "answers": [{"comments": [{"owner": {"reputation": 307, "user_id": 1503786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cd9bdefe988688b78e5250815a45afe?s=128&d=identicon&r=PG", "display_name": "Muhammad Umer", "link": "https://stackoverflow.com/users/1503786/muhammad-umer"}, "edited": false, "score": 0, "creation_date": 1461099626, "post_id": 36729325, "comment_id": 61042653, "body": "I am getting this date from somewhere and in the year factor, I am getting &quot;0000&quot;. How can I parse it so that &quot;0000&quot; becomes &quot;2016&quot;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 307, "user_id": 1503786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cd9bdefe988688b78e5250815a45afe?s=128&d=identicon&r=PG", "display_name": "Muhammad Umer", "link": "https://stackoverflow.com/users/1503786/muhammad-umer"}, "edited": false, "score": 0, "creation_date": 1461100026, "post_id": 36729325, "comment_id": 61042868, "body": "@MuhammadUmer: there&#39;s no year in your date, so it&#39;s set to 0. You could add the current year after with <code>d.AddDate(time.Now().Year(), 0, 0)</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 307, "user_id": 1503786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cd9bdefe988688b78e5250815a45afe?s=128&d=identicon&r=PG", "display_name": "Muhammad Umer", "link": "https://stackoverflow.com/users/1503786/muhammad-umer"}, "edited": false, "score": 0, "creation_date": 1461100913, "post_id": 36729325, "comment_id": 61043285, "body": "@MuhammadUmer: it does work, please show what you&#39;ve tried."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 307, "user_id": 1503786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cd9bdefe988688b78e5250815a45afe?s=128&d=identicon&r=PG", "display_name": "Muhammad Umer", "link": "https://stackoverflow.com/users/1503786/muhammad-umer"}, "edited": false, "score": 2, "creation_date": 1461101155, "post_id": 36729325, "comment_id": 61043387, "body": "@MuhammadUmer: you didn&#39;t assign the new date anywhere: <a href=\"http://play.golang.org/p/egz1bY-gLi\" rel=\"nofollow noreferrer\">play.golang.org/p/egz1bY-gLi</a>"}, {"owner": {"reputation": 307, "user_id": 1503786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cd9bdefe988688b78e5250815a45afe?s=128&d=identicon&r=PG", "display_name": "Muhammad Umer", "link": "https://stackoverflow.com/users/1503786/muhammad-umer"}, "edited": false, "score": 0, "creation_date": 1461101227, "post_id": 36729325, "comment_id": 61043421, "body": "Ohh! So stupid of me. Thank a lot kind sir. I really appreciate it! :)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1461099437, "creation_date": 1461099437, "answer_id": 36729325, "question_id": 36729147, "link": "https://stackoverflow.com/questions/36729147/how-can-i-parse-this-date-in-golang/36729325#36729325", "title": "How can I parse this date in Golang?", "body": "<p>The 3 letter month constant is <code>Jan</code></p>\n\n<pre><code>date := \"APR 19, 3:15p ET\"\nd, err := time.Parse(\"Jan 02, 3:04p ET\", date)\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/LkeQOtc1Hd\" rel=\"nofollow\">http://play.golang.org/p/LkeQOtc1Hd</a></p>\n"}], "owner": {"reputation": 307, "user_id": 1503786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cd9bdefe988688b78e5250815a45afe?s=128&d=identicon&r=PG", "display_name": "Muhammad Umer", "link": "https://stackoverflow.com/users/1503786/muhammad-umer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 36729325, "answer_count": 1, "score": 0, "last_activity_date": 1461099437, "creation_date": 1461098834, "question_id": 36729147, "link": "https://stackoverflow.com/questions/36729147/how-can-i-parse-this-date-in-golang", "title": "How can I parse this date in Golang?", "body": "<p>I am having some trouble in parsing this date (<strong>\"APR 19, 3:15p ET\"</strong>), can anyone please help me in this regard?</p>\n\n<p>This is the code which I have written.</p>\n\n<pre><code>d, err := time.Parse(\"JAN 02, 3:04p ET\", date)\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461097314, "post_id": 36728612, "comment_id": 61041271, "body": "Wasn&#39;t recover() called from a deferred function though (rec was deferred in main)? I believe you, I&#39;m just not quite understanding :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 2, "creation_date": 1461097542, "post_id": 36728612, "comment_id": 61041412, "body": "@william.taylor.09: No, the deferred function here is <code>rec</code>, and <code>rec</code> is only <i>directly</i> calling <code>rec2</code>; <code>rec2</code> is what calls <code>recover()</code>. Changing the defer to <code>rec2()</code> will catch the panic."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1461097113, "creation_date": 1461097113, "answer_id": 36728612, "question_id": 36728419, "link": "https://stackoverflow.com/questions/36728419/does-calling-a-function-break-recover/36728612#36728612", "title": "Does calling a function break recover()?", "body": "<p><code>recover</code> must be called directly by a deferred function. </p>\n\n<p>from the <a href=\"https://golang.org/ref/spec#Handling_panics\" rel=\"nofollow\">language spec</a>:</p>\n\n<blockquote>\n  <p>The return value of recover is nil if any of the following conditions\n  holds:</p>\n  \n  <ul>\n  <li>panic's argument was nil;</li>\n  <li>the goroutine is not panicking;</li>\n  <li>recover was not called directly by a deferred function.</li>\n  </ul>\n</blockquote>\n"}], "owner": {"reputation": 8373, "user_id": 58109, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/f644c55ff071f7a87f335fe5624b5c8f?s=128&d=identicon&r=PG", "display_name": "Sam Lee", "link": "https://stackoverflow.com/users/58109/sam-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 36728612, "answer_count": 1, "score": 2, "last_activity_date": 1461097113, "creation_date": 1461096479, "question_id": 36728419, "link": "https://stackoverflow.com/questions/36728419/does-calling-a-function-break-recover", "title": "Does calling a function break recover()?", "body": "<p>I was using a library which <code>recover()</code>s from panics, and it was using code that simplifies to the following:</p>\n\n<pre><code>func main() {\n    defer rec()\n    panic(\"X\")\n}\n\nfunc rec() {\n    rec2()\n}\n\nfunc rec2() {\n    fmt.Printf(\"recovered: %v\\n\", recover())\n}\n</code></pre>\n\n<p>The output of this is:</p>\n\n<pre><code>recovered: &lt;nil&gt;\npanic: X\n... more panic output ...\n</code></pre>\n\n<p>Notably, <code>recover()</code> returns <code>nil</code> instead of the error. Is this intended behavior? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1461095582, "post_id": 36727901, "comment_id": 61040298, "body": "If the types are valid for map keys, you can check their existence in a <code>map[T1]bool</code>, but in that case you could also just use the <code>==</code> operator. Otherwise you&#39;re going to have to define some sort of serialization method for your types."}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1461096115, "post_id": 36727901, "comment_id": 61040582, "body": "To echo off @JimB, you could use encoding/gob&amp;base64 to serialize your struct."}, {"owner": {"reputation": 3699, "user_id": 4816175, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/697df6176ef55a7ea25f159e0fcdec38?s=128&d=identicon&r=PG", "display_name": "cool breeze", "link": "https://stackoverflow.com/users/4816175/cool-breeze"}, "edited": false, "score": 0, "creation_date": 1461097616, "post_id": 36727901, "comment_id": 61041447, "body": "I don&#39;t want to serialize it, I want a hash value that is based off of the values of the fields."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1461098554, "post_id": 36727901, "comment_id": 61042006, "body": "@coolbreeze: you need to serialize those values <i>somehow</i> in order to generate a hash, i.e. the raw bytes need to be read by the hashing function in a consistent manner.  You can either take the path of least resistance and use a predefined encoding like <code>gob</code>, or generate your own functions/methods for writing the values to a hash function. If you want choose the latter approach, what are your goals? Hash speed, comparison speed, hash size, collision resistance, randomness?"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 2, "creation_date": 1461112079, "post_id": 36727901, "comment_id": 61047174, "body": "First of all two different values can have the same hash, so to reliably determine if two values are different it is not enough to compare their hashes. And to calculate hash you need to read all fields of the struct  and do some calculations, comparison using <code>==</code> will be most likely faster."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1461118633, "post_id": 36727901, "comment_id": 61048852, "body": "if you need control the hash generation of the map, I suggest use a custom map, other than golang native map."}], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 0, "last_activity_date": 1461153409, "creation_date": 1461153409, "answer_id": 36743034, "question_id": 36727901, "link": "https://stackoverflow.com/questions/36727901/how-to-create-a-custom-hashcode-to-determine-if-data-has-mutated/36743034#36743034", "title": "How to create a custom hashcode to determine if data has mutated", "body": "<p>You can use something like:</p>\n\n<pre><code>func (t *T1) Hash() uint64 {\n    hb := make([]byte, 8+8+1+8+8+1)\n    binary.BigEndian.PutUint64(hb, uint64(t.f1))\n    binary.BigEndian.PutUint64(hb[8:], uint64(t.f2))\n    if t.f3 {\n        hb[16] = 1\n    }\n    binary.BigEndian.PutUint64(hb[17:], uint64(t.T2.f4))\n    binary.BigEndian.PutUint64(hb[25:], uint64(t.T2.f5))\n    if t.T2.f6 {\n        hb[33] = 1\n    }\n    f := fnv.New64a()\n    f.Write(hb)\n    return f.Sum64()\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/xQs7wYCzfj\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n\n<p>Although if you are using it as a map key, it's better to just directly use the struct as the key and let go handle it.</p>\n"}], "owner": {"reputation": 3699, "user_id": 4816175, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/697df6176ef55a7ea25f159e0fcdec38?s=128&d=identicon&r=PG", "display_name": "cool breeze", "link": "https://stackoverflow.com/users/4816175/cool-breeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1461153409, "creation_date": 1461094748, "question_id": 36727901, "link": "https://stackoverflow.com/questions/36727901/how-to-create-a-custom-hashcode-to-determine-if-data-has-mutated", "title": "How to create a custom hashcode to determine if data has mutated", "body": "<p>Say I have a struct type that has int64 and bools, along with embedded types that have more int64 and bool type fields.</p>\n\n<pre><code>type T1 struct {\n   f1 int64\n   f2 int64\n   f3 bool\n   T2 T2\n}\n\ntype T2 struct {\n   f4 int64\n   f5 int64\n   f6 bool\n}\n</code></pre>\n\n<p>Now using all the structs fields/properties, I want to generate a hashcode.</p>\n\n<p>The aim of this is so I can determine if the contents of the instance has changed but comparing the before/after hashcode value.</p>\n\n<p>So if T1 instance has changed i.e. any of its own properties Then the value of the hash should be different.</p>\n"}, {"tags": ["http", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461094825, "post_id": 36727844, "comment_id": 61039765, "body": "What&#39;s the error message you&#39;re receiving?"}, {"owner": {"reputation": 307, "user_id": 1503786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cd9bdefe988688b78e5250815a45afe?s=128&d=identicon&r=PG", "display_name": "Muhammad Umer", "link": "https://stackoverflow.com/users/1503786/muhammad-umer"}, "reply_to_user": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461094887, "post_id": 36727844, "comment_id": 61039807, "body": "error=&quot;json: cannot unmarshal array into Go value of type struct { Content []struct"}], "answers": [{"tags": [], "owner": {"reputation": 69, "user_id": 2553485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6758333928dc4670aaf09524618f381?s=128&d=identicon&r=PG", "display_name": "tisov", "link": "https://stackoverflow.com/users/2553485/tisov"}, "is_accepted": false, "score": 0, "last_activity_date": 1461094912, "creation_date": 1461094912, "answer_id": 36727962, "question_id": 36727844, "link": "https://stackoverflow.com/questions/36727844/unable-to-unmarshal-json-array-in-golang/36727962#36727962", "title": "Unable to unmarshal JSON array in Golang", "body": "<p>Change it</p>\n\n<pre><code>var data struct {\n    Content []struct {\n        Title           string   `json:\"title\"`\n        Author          string   `json:\"author\"`\n        Tags            map[string]string   `json:\"tags\"`\n    } }\n</code></pre>\n\n<p>to this</p>\n\n<pre><code>type Content struct {\n        Title           string   `json:\"title\"`\n        Author          string   `json:\"author\"`\n        Tags            map[string]string   `json:\"tags\"`\n\n}\nvar data []Content\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "is_accepted": false, "score": 0, "last_activity_date": 1461095423, "last_edit_date": 1461095423, "creation_date": 1461095117, "answer_id": 36728029, "question_id": 36727844, "link": "https://stackoverflow.com/questions/36727844/unable-to-unmarshal-json-array-in-golang/36728029#36728029", "title": "Unable to unmarshal JSON array in Golang", "body": "<p>Consider unmarshalling it into a slice of Content:</p>\n\n<pre><code>type Content struct {\n    Title  string            `json:\"title\"`\n    Author string            `json:\"author\"`\n    Tags   map[string]string `json:\"tags\"`\n}\n\n// Send in your json\nfunc convertToContent(msg string) ([]Content, error) {\n    content := make([]Content, 0, 10)\n\n    buf := bytes.NewBufferString(msg)\n    decoder := json.NewDecoder(buf)\n\n    err := decoder.Decode(&amp;content)\n    return content, err\n}\n</code></pre>\n\n<p>Check out an example with your use case here: <a href=\"http://play.golang.org/p/TNjb85XjpP\" rel=\"nofollow\">http://play.golang.org/p/TNjb85XjpP</a></p>\n"}, {"tags": [], "owner": {"reputation": 307, "user_id": 1503786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cd9bdefe988688b78e5250815a45afe?s=128&d=identicon&r=PG", "display_name": "Muhammad Umer", "link": "https://stackoverflow.com/users/1503786/muhammad-umer"}, "is_accepted": false, "score": 0, "last_activity_date": 1461098540, "creation_date": 1461098540, "answer_id": 36729044, "question_id": 36727844, "link": "https://stackoverflow.com/questions/36727844/unable-to-unmarshal-json-array-in-golang/36729044#36729044", "title": "Unable to unmarshal JSON array in Golang", "body": "<p>I was able to sort out this issue by doing a simple amendment in the above code.</p>\n\n<pre><code>var Content []struct {\n    Title           string   `json:\"title\"`\n    Author          string   `json:\"author\"`\n    Tags            map[string]string   `json:\"tags\"`\n}\n</code></pre>\n\n<p>Thanks for all your responses.</p>\n"}], "owner": {"reputation": 307, "user_id": 1503786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cd9bdefe988688b78e5250815a45afe?s=128&d=identicon&r=PG", "display_name": "Muhammad Umer", "link": "https://stackoverflow.com/users/1503786/muhammad-umer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1055, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1461098540, "creation_date": 1461094527, "question_id": 36727844, "link": "https://stackoverflow.com/questions/36727844/unable-to-unmarshal-json-array-in-golang", "title": "Unable to unmarshal JSON array in Golang", "body": "<p>I am getting the below response in a URL and I want to unmarshal it, but I am unable to do so.\nThis is the kind of response that I'd like to unmarshal.</p>\n\n<pre><code>[\n  {\"title\": \"Angels And Demons\", \"author\":\"Dan Brown\", \"tags\":[{\"tagtitle\":\"Demigod\", \"tagURl\": \"/angelDemon}] }\n  {\"title\": \"The Kite Runner\", \"author\":\"Khalid Hosseinei\", \"tags\":[{\"tagtitle\":\"Kite\", \"tagURl\": \"/kiteRunner\"}] }\n  {\"title\": \"Dance of the dragons\", \"author\":\"RR Martin\", \"tags\":[{\"tagtitle\":\"IronThrone\", \"tagURl\": \"/got\"}] }\n]\n</code></pre>\n\n<p>I am trying to unmarshal this sort of response but not being able to do so. This is the code that I am trying to write.</p>\n\n<pre><code>res, err := http.Get(url)\nif err != nil {\n    log.WithFields(log.Fields{\n        \"error\": err,\n    }).Fatal(\"Couldn't get the html response\")\n}\ndefer res.Body.Close()\nb, err := ioutil.ReadAll(res.Body)\nif err != nil {\n    log.WithFields(log.Fields{\n        \"error\": err,\n    }).Fatal(\"Couldn't read the response\")\n}\n\ns := string(b)\n\nvar data struct {\n    Content []struct {\n        Title           string   `json:\"title\"`\n        Author          string   `json:\"author\"`\n        Tags            map[string]string   `json:\"tags\"`\n    }\n}\n\nif err := json.Unmarshal([]byte(s), &amp;data); err != nil {\n    log.WithFields(log.Fields{\n        \"error\": err,\n    }).Error(\"Un-marshalling could not be done.\")\n}\n\nfmt.Println(data.Content)\n</code></pre>\n\n<p>Can anyone please help me in this regard?\nThanks in advance.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 1, "creation_date": 1461099206, "post_id": 36728885, "comment_id": 61042416, "body": "when I call <code>go build -ldflags -Hwindowsgui guionly.go</code> I get <code>flag provided but not defined: -Hwindowsgui</code>"}, {"owner": {"reputation": 2113, "user_id": 4433546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fp46R.jpg?s=128&g=1", "display_name": "TriskalJM", "link": "https://stackoverflow.com/users/4433546/triskaljm"}, "reply_to_user": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 1, "creation_date": 1461099925, "post_id": 36728885, "comment_id": 61042827, "body": "Looks like I forgot the <code>=</code> sign there. See edited answer."}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 2, "creation_date": 1461122152, "post_id": 36728885, "comment_id": 61049741, "body": "Thanks a lot, I didn&#39;t see the missing <code>=</code>. And what&#39;s even worse: <i>now</i> I was able to find a similar question that was asked before ;-) <a href=\"http://stackoverflow.com/questions/23250505/how-do-i-create-an-executable-from-golang-that-doesnt-open-a-command-cmd-wind\" title=\"how do i create an executable from golang that doesnt open a command cmd wind\">stackoverflow.com/questions/23250505/&hellip;</a>"}, {"owner": {"reputation": 157, "user_id": 4039207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ed35267961546abaae338b80f713747?s=128&d=identicon&r=PG&f=1", "display_name": "user259819", "link": "https://stackoverflow.com/users/4039207/user259819"}, "edited": false, "score": 0, "creation_date": 1615636448, "post_id": 36728885, "comment_id": 117755731, "body": "this works for <a href=\"https://github.com/inkyblackness/imgui-go-examples\" rel=\"nofollow noreferrer\">github.com/inkyblackness/imgui-go-examples</a>, too"}], "tags": [], "owner": {"reputation": 2113, "user_id": 4433546, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fp46R.jpg?s=128&g=1", "display_name": "TriskalJM", "link": "https://stackoverflow.com/users/4433546/triskaljm"}, "is_accepted": true, "score": 51, "last_activity_date": 1512423808, "last_edit_date": 1512423808, "creation_date": 1461097983, "answer_id": 36728885, "question_id": 36727740, "link": "https://stackoverflow.com/questions/36727740/how-to-hide-console-window-of-a-go-program-on-windows/36728885#36728885", "title": "How to hide console window of a Go program on Windows", "body": "<p>Add <code>-ldflags -H=windowsgui</code> to your go build/install command line. You'll see that the console window is absent:</p>\n\n<p><a href=\"https://i.stack.imgur.com/UTCv1.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/UTCv1.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13064, "favorite_count": 8, "closed_date": 1461158758, "accepted_answer_id": 36728885, "answer_count": 1, "score": 26, "last_activity_date": 1512423808, "creation_date": 1461094237, "last_edit_date": 1495540002, "question_id": 36727740, "link": "https://stackoverflow.com/questions/36727740/how-to-hide-console-window-of-a-go-program-on-windows", "closed_reason": "Duplicate", "title": "How to hide console window of a Go program on Windows", "body": "<p>I tried various ways of creating a Go program that only displays either a <code>MessageBox</code> or a standalone GUI window.\nIf I were to write this in C / C++ I would just define a <a href=\"https://stackoverflow.com/questions/13871617/winmain-and-main-in-c-extended\"><code>WinMain</code></a>, leave out the main and I would be good to go.\nIt seems to me that as soon as I define a <code>main</code> function a console window is created automatically. And the main function is compulsory.</p>\n\n<pre><code>package main\nfunc main() {\n...\n}\n</code></pre>\n\n<p>To avoid this I tried an <a href=\"https://github.com/ohisama/win/blob/master/win.go\" rel=\"noreferrer\">example</a> which creates a WinMain</p>\n\n<pre><code>func WinMain(wproc uintptr) {\n    hInstance := GetModuleHandle(nil)\n    ...\n}\n</code></pre>\n\n<p>But the effect is the same: an empty console window <em>and</em> a GUI window:\n<a href=\"https://i.stack.imgur.com/O8ZTf.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/O8ZTf.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["multithreading", "go", "concurrency", "goroutine", "starvation"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1461089369, "post_id": 36726151, "comment_id": 61036318, "body": "Show the code that receives from <code>receiverToHandler</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1461089374, "post_id": 36726151, "comment_id": 61036320, "body": "You&#39;re creating a new <code>bufio.Reader</code> for every message, though each previous <code>bufio.Reader</code> may have already read more than you expect from the conn."}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 1, "creation_date": 1461089437, "post_id": 36726151, "comment_id": 61036369, "body": "I would be interested to see a debug message right after you read the string. ReadString will continue reading until it sees the delimiter; let&#39;s be sure that the delimiter is actually working."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3835277"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1461089917, "post_id": 36726151, "comment_id": 61036720, "body": "@JimB Apparently that&#39;s not the issue. Good catch, but I am still experiencing the same problems."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3835277"}, "reply_to_user": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461089970, "post_id": 36726151, "comment_id": 61036751, "body": "@william.taylor.09 If the delimiter wasn&#39;t working, then <code>ReadString</code> would  block forever, so the debug message would never be printed."}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461093570, "post_id": 36726151, "comment_id": 61038979, "body": "That&#39;s exactly my point. You already verified that your goroutine was being called. Now you need to see where it&#39;s getting stuck. Put a debug message before and after ReadString, and I bet you&#39;ll find that you&#39;ll only get one of those messages being printed."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1461093619, "post_id": 36726151, "comment_id": 61038998, "body": "@gragas: still, printing the received message in the main receive loop will show you if you aren&#39;t receiving what you expect, or you&#39;re having trouble coordinating the channel and goroutines. Your <code>handleMessage </code> only recieves once, and of you were to wrap that in a for loop, you turn it into a busy loop wich will cause other problems. Please show an example that can reproduce your problem."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3835277"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1461095830, "post_id": 36726151, "comment_id": 61040419, "body": "@JimB @william.taylor.09 sorry, my program is quite large. <code>handleMessage</code> is called every iteration in the infinite loop of the main thread."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1461100447, "post_id": 36726151, "comment_id": 61043070, "body": "If your program is blocked, look at the stack trace to see where each goroutine is waiting, or add more debug statements to see what is progressing. We can&#39;t troubleshoot this without a way to reproduce your error."}], "owner": {"user_type": "does_not_exist", "display_name": "user3835277"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 897, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1461089606, "creation_date": 1461089098, "last_edit_date": 1461089606, "question_id": 36726151, "link": "https://stackoverflow.com/questions/36726151/why-is-my-goroutine-starving", "title": "Why is my goroutine starving?", "body": "<h2>Overview</h2>\n\n<p>I am writing a program where a server is launched in one goroutine. The <strong>server</strong> has a few different goroutines:</p>\n\n<ol>\n<li><strong>The main goroutine</strong>: This handles initialization, launches a second goroutine which listens for new connections (2), and then goes into an infinite loop to act on the data received from connections (i.e., clients).</li>\n<li><strong>The listen goroutine</strong>: This goroutine goes into an infinite loop, constantly listening for new connections. If a new connection is accepted, another goroutine is launched which listens for messages from the connection until it is closed.</li>\n</ol>\n\n<p>The server seems to work well. I can successfully add many new connections, and I can also send data on these new connections after they are initially accepted by the server.</p>\n\n<p>My <strong>client</strong> is fairly simple. There are two goroutines as well:</p>\n\n<ol>\n<li><strong>The main goroutine</strong>: This handles intialization, registers the client with a server, launches a second goroutine to read data from the server (2), and then goes into an infinite loop to act on the data received from the server.</li>\n<li><strong>The second goroutine</strong>: This goroutine constantly tries to read data from the server until the connection is closed.</li>\n</ol>\n\n<h1>Starvation</h1>\n\n<p>I'm having a huge issue with goroutine starvation on the client. Specifically, the second goroutine of the client always starves. Here's the source of the goroutine that's starving:</p>\n\n<pre><code>func receiver() {\n    for {\n        msg, err := bufio.NewReader(conn).ReadString(byte(protocol.EndOfMessage))\n        if err != nil {\n            fmt.Printf(\"Disconnected from server %v.\\n\", conn.RemoteAddr())\n            return\n        }\n        if len(msg) &lt; 2 {\n            continue\n        }\n        receiverToHandler &lt;- msg[1 : len(msg)-1]\n    }\n}\n</code></pre>\n\n<p>I am certain that a message is being sent from the server to the client. I am also sure that the message being sent ends in <code>protocol.EndOfMessage</code>. I am also certain that my method of getting data from the server is correct since I use the same code to register the client, only instead of running it in an infinite loop I allow it a prespecified number of attempts.</p>\n\n<p>For some reason, my client will not receive data.</p>\n\n<p>To be certain that I am not misunderstanding the nature of goroutines, if I replace the above code with this:</p>\n\n<pre><code>func receiver() {\n    for {\n        fmt.Println(\"In the receiver goroutine!\")\n    }\n}\n</code></pre>\n\n<p>The goroutine works exactly as expected: everything functions exactly as before, but \"In the receiver goroutine!\" is constantly printed. So the routine is certainly executing correctly in this case.</p>\n\n<h3>My handler</h3>\n\n<pre><code>func handleMessage(debug bool) {\n    select {\n    case msg := &lt;-receiverToHandler:\n        update(msg, debug)\n    default:\n        /* if debug {\n         *     fmt.Printf(\"Nothing received!\\n\")\n         * }\n         */\n    }\n}\n</code></pre>\n\n<p>Right now, <code>update(msg, debug)</code> just calls <code>fmt.Println(msg)</code>.</p>\n\n<p>Is there anything I can do to cleanly solve this problem? I feel like giving away priority / forcing the scheduler to run is a hacky solution to this problem.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 31798, "user_id": 1063716, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/594dfa12a4f922652c182c46b6bc2de3?s=128&d=identicon&r=PG", "display_name": "Steve Chambers", "link": "https://stackoverflow.com/users/1063716/steve-chambers"}, "edited": false, "score": 1, "creation_date": 1461265140, "post_id": 36725194, "comment_id": 61132857, "body": "Would you consider using a <a href=\"https://golanglibs.com/top?q=shim\" rel=\"nofollow noreferrer\">shim</a> - namely <a href=\"https://github.com/glenn-brown/golang-pkg-pcre\" rel=\"nofollow noreferrer\">golang-pkg-pcre</a>?"}], "answers": [{"comments": [{"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1461125378, "post_id": 36727379, "comment_id": 61050571, "body": "Thanks, but it does not work the way I expected. Try this example: <a href=\"https://play.golang.org/p/hYmbMP7ifl\" rel=\"nofollow noreferrer\">play.golang.org/p/hYmbMP7ifl</a>"}, {"owner": {"reputation": 69, "user_id": 2553485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6758333928dc4670aaf09524618f381?s=128&d=identicon&r=PG", "display_name": "tisov", "link": "https://stackoverflow.com/users/2553485/tisov"}, "reply_to_user": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1461129514, "post_id": 36727379, "comment_id": 61051931, "body": "This work: <a href=\"https://play.golang.org/p/wl6PZorFGG\" rel=\"nofollow noreferrer\">play.golang.org/p/wl6PZorFGG</a>. Also i changed the example above"}, {"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1461132695, "post_id": 36727379, "comment_id": 61053276, "body": "No, it&#39;s not what expected. When the comments are quoted, I&#39;m hoping they will not be removed. Quoted comments are part of the quoted string."}], "tags": [], "owner": {"reputation": 69, "user_id": 2553485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6758333928dc4670aaf09524618f381?s=128&d=identicon&r=PG", "display_name": "tisov", "link": "https://stackoverflow.com/users/2553485/tisov"}, "is_accepted": false, "score": 0, "last_activity_date": 1461129578, "last_edit_date": 1461129578, "creation_date": 1461093080, "answer_id": 36727379, "question_id": 36725194, "link": "https://stackoverflow.com/questions/36725194/golang-regex-replace-excluding-quoted-strings/36727379#36727379", "title": "Golang regex replace excluding quoted strings", "body": "<p>Try this example..</p>\n\n<p><a href=\"https://play.golang.org/p/wl6PZorFGG\" rel=\"nofollow\">play golang</a></p>\n"}, {"comments": [{"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1461266325, "post_id": 36778455, "comment_id": 61133508, "body": "Thanks @Laurel. It seems to work as expected. Would you please explain a bit more about the regular expression? Reading it really hurt my brain."}, {"owner": {"reputation": 5492, "user_id": 6083675, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/D2CgS.png?s=128&g=1", "display_name": "Laurel", "link": "https://stackoverflow.com/users/6083675/laurel"}, "reply_to_user": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 2, "creation_date": 1461269158, "post_id": 36778455, "comment_id": 61135143, "body": "@ElgsQianChen I&#39;ve added an explanation. And more regex!"}], "tags": [], "owner": {"reputation": 5492, "user_id": 6083675, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/D2CgS.png?s=128&g=1", "display_name": "Laurel", "link": "https://stackoverflow.com/users/6083675/laurel"}, "is_accepted": false, "score": 2, "last_activity_date": 1461269059, "last_edit_date": 1461269059, "creation_date": 1461265798, "answer_id": 36778455, "question_id": 36725194, "link": "https://stackoverflow.com/questions/36725194/golang-regex-replace-excluding-quoted-strings/36778455#36778455", "title": "Golang regex replace excluding quoted strings", "body": "<p>I've never read/written anything in Go, so bear with me. Fortunately, I know regex. I did a little research on Go regexes, and it would seem that they lack most modern features (such as references).</p>\n\n<p>Despite that, I've developed a regex that seems to be what you're looking for. I'm assuming that all strings are single line. Here it is:</p>\n\n<pre><code>reg := regexp.MustCompile(`(?m)^([^\"\\n]*)/\\*([^*]+|(\\*+[^/]))*\\*+/`)\n\ntxt := `random text\n        /* removable comment */\n            \"but /* never remove this */ one\"\n        more random *text*`\n\nfmt.Println(reg.ReplaceAllString(txt, \"${1}\"))\n</code></pre>\n\n<hr>\n\n<p>Variation: The version above will not remove comments that happen after quotation marks. This version will, but it may need to be run multiple times.</p>\n\n<pre><code>reg := regexp.MustCompile(\n   `(?m)^(([^\"\\n]*|(\"[^\"\\n]*\"))*)/\\*([^*]+|(\\*+[^/]))*\\*+/`\n)\ntxt := `\n   random text\n   what /* removable comment */\n   hi \"but /* never remove this */ one\" then /*whats here*/ i don't know /*what*/\n   more random *text*\n`\nnewtxt := reg.ReplaceAllString(txt, \"${1}\")\nfmt.Println(newtxt)\nnewtxt = reg.ReplaceAllString(newtxt, \"${1}\")\nfmt.Println(newtxt)\n</code></pre>\n\n<hr>\n\n<h1>Explanation</h1>\n\n<ul>\n<li><p><code>(?m)</code> means multiline mode. Regex101 gives a nice explanation of this:</p>\n\n<blockquote>\n  <p>The ^ and $ anchors now match at the beginning/end of each line respectively, instead of beginning/end of the entire string.</p>\n</blockquote>\n\n<p>It needs to be anchored to the beginning of each line (with <code>^</code>) to ensure a quote hasn't started.</p></li>\n<li><p>The first regex has this: <code>[^\"\\n]*</code>. Essentially, it's matching everything that's not <code>\"</code> or <code>\\n</code>. I've added parenthesis because this stuff isn't comments, so it needs to be put back.</p></li>\n<li><p>The second regex has this: <code>(([^\"\\n]*|(\"[^\"\\n]*\"))*)</code>. The regex, with this statement can either match <code>[^\"\\n]*</code> (like the first regex does), or (<code>|</code>) it can match a pair of quotes (and the content between them) with <code>\"[^\"\\n]*\"</code>. It's repeating so it works when there are more than one quote pair, for example. Note that, like the simpler regex, this non-comment stuff is being captured.</p></li>\n<li><p>Both regexes use this: <code>/\\*([^*]+|(\\*+[^/]))*\\*+/</code>.  It matches <code>/*</code> followed by any amount of either:</p>\n\n<ul>\n<li><code>[^*]+</code> Non <code>*</code> chars</li>\n</ul>\n\n<p>or</p>\n\n<ul>\n<li><code>\\*+[^/]</code> One or more <code>*</code>s that are not followed by <code>/</code>.</li>\n</ul></li>\n<li><p>And then it matches the closing <code>*/</code></p></li>\n<li><p>During replacement, the <code>${1}</code> refers to the non-comment things that were captured, so they're reinserted into the string.</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1461271292, "post_id": 36779403, "comment_id": 61136353, "body": "I think I have added all I wanted. If there is anything missing, please let me know."}, {"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1461397258, "post_id": 36779403, "comment_id": 61189386, "body": "Thanks it works and even works with multiline comments nicely."}, {"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 1, "creation_date": 1461398439, "post_id": 36779403, "comment_id": 61189671, "body": "Thanks for the Best Regex Trick Ever. Super awesome!"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1461402847, "post_id": 36779403, "comment_id": 61190759, "body": "Could you please let me know why sln answer is accepted?"}, {"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1461405056, "post_id": 36779403, "comment_id": 61191386, "body": "It&#39;s hard decision. I think your answer and sln&#39;s answer are both great. Initially I accepted your answer and gave the bounties to you. After reading sln&#39;s answer, I thought his answer also deserves the credit. I understand it&#39;s not most appropriate. Do you feel it&#39;s really bad for me to do so?"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1461411017, "post_id": 36779403, "comment_id": 61193299, "body": "It is your decision, I do not want to interefere with it, I just wanted to know what my answer lacks so that I could improve it."}, {"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1461411205, "post_id": 36779403, "comment_id": 61193363, "body": "Your answer lacks nothing. Your answer is even very nicely formatted for readability. I really appreciate that. The reason I did this is only a balance of two perfect answers. I feel really sorry."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1461411291, "post_id": 36779403, "comment_id": 61193405, "body": "Thank you for the feedback. No need to feel sorry."}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": false, "score": 3, "last_activity_date": 1461271268, "last_edit_date": 1592644375, "creation_date": 1461269091, "answer_id": 36779403, "question_id": 36725194, "link": "https://stackoverflow.com/questions/36725194/golang-regex-replace-excluding-quoted-strings/36779403#36779403", "title": "Golang regex replace excluding quoted strings", "body": "<h1>BACKGROUND</h1>\n<p>The correct way to do the task is to match and capture quoted strings (bearing in mind there can be escaped entities inside) and then matching the multiline comments.</p>\n<h1>REGEX IN-CODE DEMO</h1>\n<p>Here is the code to deal with that:</p>\n<pre><code>package main\nimport (\n    &quot;fmt&quot;\n    &quot;regexp&quot;\n)\nfunc main() {\n    reg := regexp.MustCompile(`(&quot;[^&quot;\\\\]*(?:\\\\.[^&quot;\\\\]*)*&quot;)|/\\*[^*]*\\*+(?:[^/*][^*]*\\*+)*/`)\n        txt := `random text\n            /* removable comment */\n            &quot;but /* never remove this */ one&quot;\n             more random *text*`\n        fmt.Println(reg.ReplaceAllString(txt, &quot;$1&quot;))\n}\n</code></pre>\n<p>See the <a href=\"https://play.golang.org/p/pcDvc8Hraf\" rel=\"nofollow noreferrer\">Playground demo</a></p>\n<h1>EXPLANATION</h1>\n<p>The regex I suggest is written with the <a href=\"http://www.rexegg.com/regex-best-trick.html#thetrick\" rel=\"nofollow noreferrer\"><strong>Best Regex Trick Ever</strong></a> concept in mind and consists of 2 alternatives:</p>\n<ul>\n<li><code>(&quot;[^&quot;\\\\]*(?:\\\\.[^&quot;\\\\]*)*&quot;)</code> - <strong>Double quoted string literal regex</strong> - Group 1 (see the <a href=\"http://www.regular-expressions.info/brackets.html\" rel=\"nofollow noreferrer\"><strong>capturing group</strong></a> formed with the outer pair of unescaped parentheses and later accessible via <a href=\"http://www.regular-expressions.info/replacebackref.html\" rel=\"nofollow noreferrer\"><strong>replacement backreferences</strong></a>) matching double quoted string literals that can contain escaped sequences. This part matches:\n<ul>\n<li><code>&quot;</code> - a leading double quote</li>\n<li><code>[^&quot;\\\\]*</code> - 0+ characters other than <code>&quot;</code> and <code>\\</code> (as <code>[^...]</code> construct is a <a href=\"http://www.regular-expressions.info/charclass.html#negated\" rel=\"nofollow noreferrer\"><strong>negated character class</strong></a> that matches any characters but those defined inside it) (the <code>*</code> is a <em>zero or more</em> occurrences matching <a href=\"http://www.regular-expressions.info/repeat.html\" rel=\"nofollow noreferrer\"><strong>quantifier</strong></a>)</li>\n<li><code>(?:\\\\.[^&quot;\\\\]*)*&quot;</code> - 0+ sequences (see the last <code>*</code> and the <a href=\"http://www.regular-expressions.info/brackets.html#noncap\" rel=\"nofollow noreferrer\"><strong>non-capturing group</strong></a> used only to <em>group</em> subpatterns without forming a capture) of an escaped sequence (the <code>\\\\.</code> matches a literal <code>\\</code> followed with any character) followed with 0+\ncharacters other than <code>&quot;</code> and <code>\\</code></li>\n</ul>\n</li>\n<li><code>|</code> - or</li>\n<li><code>/\\*[^*]*\\*+(?:[^/*][^*]*\\*+)*/</code> - <strong>multiline comment regex</strong> part matches *without forming a capture group (thus, unavailable from the replacement pattern via backreferences) and matches\n<ul>\n<li><code>/</code> - the <code>/</code> literal slash</li>\n<li><code>\\*</code> - the literal asterisk</li>\n<li><code>[^*]*</code> - zero or more characters other than an asterisk</li>\n<li><code>\\*+</code> - 1 or more (the <code>+</code> is a <em>one or more occurrences matching quantifier</em>) asterisks</li>\n<li><code>(?:[^/*][^*]*\\*+)*</code> - 0+ sequences (non-capturing, we do not use it later) of any character but a <code>/</code> or <code>*</code> (see <code>[^/*]</code>), followed with 0+ characters other than an asterisk (see <code>[^*]*</code>) and then followed with 1+ asterisks (see <code>\\*+</code>).</li>\n<li><code>/</code> - a literal (trailing, closing) slash.</li>\n</ul>\n</li>\n</ul>\n<p><em><strong>NOTE</strong></em>: <strong>This multiline comment regex is the fastest I have ever tested.</strong> Same goes for the double quoted literal regex as <code>&quot;[^&quot;\\\\]*(?:\\\\.[^&quot;\\\\]*)*&quot;</code>  is written with the <a href=\"http://www.softec.lu/site/RegularExpressions/UnrollingTheLoop\" rel=\"nofollow noreferrer\"><strong>unroll-the-loop technique</strong></a> in mind: no alternations, only character classes with <code>*</code> and <code>+</code> quantifiers are used in a specific order to allow the fastest matching.</p>\n<h1>NOTES ON PATTERN ENHANCEMENTS</h1>\n<p>If you plan to extend to matching single quoted literals, there is nothing easier, just add another alternative into the 1st capture group by re-using the double quoted string literal regex and replacing the double quotes with single ones:</p>\n<pre><code>reg := regexp.MustCompile(`(&quot;[^&quot;\\\\]*(?:\\\\.[^&quot;\\\\]*)*&quot;|'[^'\\\\]*(?:\\\\.[^'\\\\]*)*')|/\\*[^*]*\\*+(?:[^/*][^*]*\\*+)*/`)\n                                                    ^-------------------------^\n</code></pre>\n<p>Here is the <a href=\"https://regex101.com/r/fE5cV0/1\" rel=\"nofollow noreferrer\"><em>single- and double-quoted literal supporting regex demo removing the miltiline comments</em></a></p>\n<p>Adding a single line comment support is similar: just add <code>//[^\\n\\r]*</code> alternative to the end:</p>\n<pre><code>reg := regexp.MustCompile(`(&quot;[^&quot;\\\\]*(?:\\\\.[^&quot;\\\\]*)*&quot;|'[^'\\\\]*(?:\\\\.[^'\\\\]*)*')|/\\*[^*]*\\*+(?:[^/*][^*]*\\*+)*/|//.*[\\r\\n]*`)\n                                                                                                              ^-----------^\n</code></pre>\n<p>Here is <a href=\"https://regex101.com/r/gW5nS5/2\" rel=\"nofollow noreferrer\"><em>single- and double-quoted literal supporting regex demo removing the miltiline <strong>and singleline</strong> comments</em></a></p>\n"}, {"tags": [], "owner": {"reputation": 31798, "user_id": 1063716, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/594dfa12a4f922652c182c46b6bc2de3?s=128&d=identicon&r=PG", "display_name": "Steve Chambers", "link": "https://stackoverflow.com/users/1063716/steve-chambers"}, "is_accepted": false, "score": 1, "last_activity_date": 1461275181, "creation_date": 1461275181, "answer_id": 36781054, "question_id": 36725194, "link": "https://stackoverflow.com/questions/36725194/golang-regex-replace-excluding-quoted-strings/36781054#36781054", "title": "Golang regex replace excluding quoted strings", "body": "<h1>Demo</h1>\n\n<p><a href=\"https://play.golang.org/p/b5ihnDmbLF\" rel=\"nofollow\">Play golang demo</a></p>\n\n<p>(The workings at each stage are output and the end result can be seen by scrolling down.)</p>\n\n<h1>Method</h1>\n\n<p>A few \"tricks\" are used to work around Golang's <a href=\"https://swtch.com/~rsc/regexp/regexp3.html\" rel=\"nofollow\">somewhat limited</a> <a href=\"https://golang.org/pkg/regexp/\" rel=\"nofollow\">regex syntax</a>: </p>\n\n<ol>\n<li>Replace start quotes and end quotes with a unique character. Crucially, the characters used to identify start and end quotes must be different from each other and extremely unlikely to appear in the text being processed.</li>\n<li>Replace all comment starters (<code>/*</code>) that are <em>not</em> preceeded by an unterminated start quote with a unique sequence of one or more characters.</li>\n<li>Similarly, replace all comment enders (<code>*/</code>) that are <em>not</em> succeeded by an end quote that does not have a start quote before it with a different unique sequence of one or more characters.</li>\n<li>Remove all remaining <code>/*...*/</code> comment sequences.</li>\n<li>Unmask the previously \"masked\" comment starters/enders by reversing the replacements made in steps 2 and 3 above.</li>\n</ol>\n\n<h1>Limitations</h1>\n\n<p>The current demo doesn't address the possibility of a double quote appearing within a comment, e.g. <code>/* Not expected: \" */</code>. <em>Note: My feeling is this could be handled - just haven't put the effort in yet - so let me know if you think it could be an issue and I'll look into it.</em></p>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 2, "last_activity_date": 1461342314, "last_edit_date": 1461342314, "creation_date": 1461341526, "answer_id": 36798678, "question_id": 36725194, "link": "https://stackoverflow.com/questions/36725194/golang-regex-replace-excluding-quoted-strings/36798678#36798678", "title": "Golang regex replace excluding quoted strings", "body": "<p>Just for fun another approach, minimal lexer implemented as state machine, inspired by and well described in Rob Pike talk <a href=\"http://cuddle.googlecode.com/hg/talk/lex.html\" rel=\"nofollow\">http://cuddle.googlecode.com/hg/talk/lex.html</a>. Code is more verbose but more readable, understandable and hackable then regexp. Also it can work with any Reader and Writer, not strings only so don't consumes RAM and should even be faster.</p>\n\n<pre><code>type stateFn func(*lexer) stateFn\n\nfunc run(l *lexer) {\n    for state := lexText; state != nil; {\n        state = state(l)\n    }\n}\n\ntype lexer struct {\n    io.RuneReader\n    io.Writer\n}\nfunc lexText(l *lexer) stateFn {\n    for r, _, err := l.ReadRune(); err != io.EOF; r, _, err = l.ReadRune() {\n        switch r {\n        case '\"':\n            l.Write([]byte(string(r)))\n            return lexQuoted\n        case '/':\n            r, _, err = l.ReadRune()\n            if r == '*' {\n                return lexComment\n            } else {\n                l.Write([]byte(\"/\"))\n                l.Write([]byte(string(r)))\n            }\n        default:\n            l.Write([]byte(string(r)))\n        }\n    }\n    return nil\n}\nfunc lexQuoted(l *lexer) stateFn {\n    for r, _, err := l.ReadRune(); err != io.EOF; r, _, err = l.ReadRune() {\n        if r == '\"' {\n            l.Write([]byte(string(r)))\n            return lexText\n        }\n        l.Write([]byte(string(r)))\n    }\n\n    return nil\n}\n\nfunc lexComment(l *lexer) stateFn {\n    for r, _, err := l.ReadRune(); err != io.EOF; r, _, err = l.ReadRune() {\n        if r == '*' {\n            r, _, err = l.ReadRune()\n            if r == '/' {\n                return lexText\n            }\n        }\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>You can see it works <a href=\"http://play.golang.org/p/HyvEeANs1u\" rel=\"nofollow\">http://play.golang.org/p/HyvEeANs1u</a></p>\n"}, {"comments": [{"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1461397855, "post_id": 36804325, "comment_id": 61189526, "body": "Thank you for the great answer!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "reply_to_user": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1461621408, "post_id": 36804325, "comment_id": 61272552, "body": "@ElgsQianChen - No problem. This is the defacto-standard answer for parsing comments in all C-style languages. The original was gleaned from a Perl newsgroup from years ago (not written by me) and then I made some major modifications. Info is for anyone else who gets to this question/answer."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "is_accepted": true, "score": 2, "last_activity_date": 1461364502, "creation_date": 1461364502, "answer_id": 36804325, "question_id": 36725194, "link": "https://stackoverflow.com/questions/36725194/golang-regex-replace-excluding-quoted-strings/36804325#36804325", "title": "Golang regex replace excluding quoted strings", "body": "<p><em>These do not preserve formatting</em>  </p>\n\n<hr>\n\n<p>Preferred way (produces a NULL if group 1 is not matched)<br>\nworks in golang playground -  </p>\n\n<pre><code>     # https://play.golang.org/p/yKtPk5QCQV\n     # fmt.Println(reg.ReplaceAllString(txt, \"$1\"))\n     # (?:/\\*[^*]*\\*+(?:[^/*][^*]*\\*+)*/|//[^\\n]*(?:\\n|$))|(\"[^\"\\\\]*(?:\\\\[\\S\\s][^\"\\\\]*)*\"|'[^'\\\\]*(?:\\\\[\\S\\s][^'\\\\]*)*'|[\\S\\s][^/\"'\\\\]*)\n\n     (?:                              # Comments \n          /\\*                              # Start /* .. */ comment\n          [^*]* \\*+\n          (?: [^/*] [^*]* \\*+ )*\n          /                                # End /* .. */ comment\n       |  \n          //  [^\\n]*                       # Start // comment\n          (?: \\n | $ )                     # End // comment\n     )\n  |  \n     (                                # (1 start), Non - comments \n          \"\n          [^\"\\\\]*                          # Double quoted text\n          (?: \\\\ [\\S\\s] [^\"\\\\]* )*\n          \"\n       |  \n          '\n          [^'\\\\]*                          # Single quoted text\n          (?: \\\\ [\\S\\s] [^'\\\\]* )*\n          ' \n       |  [\\S\\s]                           # Any other char\n          [^/\"'\\\\]*                        # Chars which doesn't start a comment, string, escape, or line continuation (escape + newline)\n     )                                # (1 end)\n</code></pre>\n\n<p>Alternative way (group 1 is always matched, but could be empty)<br>\nworks in golang playground -  </p>\n\n<pre><code> # https://play.golang.org/p/7FDGZSmMtP\n # fmt.Println(reg.ReplaceAllString(txt, \"$1\"))\n # (?:/\\*[^*]*\\*+(?:[^/*][^*]*\\*+)*/|//[^\\n]*(?:\\n|$))?((?:\"[^\"\\\\]*(?:\\\\[\\S\\s][^\"\\\\]*)*\"|'[^'\\\\]*(?:\\\\[\\S\\s][^'\\\\]*)*'|[\\S\\s][^/\"'\\\\]*)?)     \n\n (?:                              # Comments \n      /\\*                              # Start /* .. */ comment\n      [^*]* \\*+\n      (?: [^/*] [^*]* \\*+ )*\n      /                                # End /* .. */ comment\n   |  \n      //  [^\\n]*                       # Start // comment\n      (?: \\n | $ )                     # End // comment\n )?\n (                                # (1 start), Non - comments \n      (?:\n           \"\n           [^\"\\\\]*                          # Double quoted text\n           (?: \\\\ [\\S\\s] [^\"\\\\]* )*\n           \"\n        |  \n           '\n           [^'\\\\]*                          # Single quoted text\n           (?: \\\\ [\\S\\s] [^'\\\\]* )*\n           ' \n        |  [\\S\\s]                           # Any other char\n           [^/\"'\\\\]*                        # Chars which doesn't start a comment, string, escape, or line continuation (escape + newline)\n      )?\n )                                # (1 end)\n</code></pre>\n\n<hr>\n\n<p><em>The Cadilac - Preserves Formatting</em>  </p>\n\n<p>(Unfortunately, this can't be done in Golang because Golang cannot do Assertions)<br>\nPosted incase you move to a different regex engine.  </p>\n\n<pre><code>     # raw:   ((?:(?:^[ \\t]*)?(?:/\\*[^*]*\\*+(?:[^/*][^*]*\\*+)*/(?:[ \\t]*\\r?\\n(?=[ \\t]*(?:\\r?\\n|/\\*|//)))?|//(?:[^\\\\]|\\\\(?:\\r?\\n)?)*?(?:\\r?\\n(?=[ \\t]*(?:\\r?\\n|/\\*|//))|(?=\\r?\\n))))+)|(\"[^\"\\\\]*(?:\\\\[\\S\\s][^\"\\\\]*)*\"|'[^'\\\\]*(?:\\\\[\\S\\s][^'\\\\]*)*'|(?:\\r?\\n|[\\S\\s])[^/\"'\\\\\\s]*)\n     # delimited:  /((?:(?:^[ \\t]*)?(?:\\/\\*[^*]*\\*+(?:[^\\/*][^*]*\\*+)*\\/(?:[ \\t]*\\r?\\n(?=[ \\t]*(?:\\r?\\n|\\/\\*|\\/\\/)))?|\\/\\/(?:[^\\\\]|\\\\(?:\\r?\\n)?)*?(?:\\r?\\n(?=[ \\t]*(?:\\r?\\n|\\/\\*|\\/\\/))|(?=\\r?\\n))))+)|(\"[^\"\\\\]*(?:\\\\[\\S\\s][^\"\\\\]*)*\"|'[^'\\\\]*(?:\\\\[\\S\\s][^'\\\\]*)*'|(?:\\r?\\n|[\\S\\s])[^\\/\"'\\\\\\s]*)/\n\n     (                                # (1 start), Comments \n          (?:\n               (?: ^ [ \\t]* )?                  # &lt;- To preserve formatting\n               (?:\n                    /\\*                              # Start /* .. */ comment\n                    [^*]* \\*+\n                    (?: [^/*] [^*]* \\*+ )*\n                    /                                # End /* .. */ comment\n                    (?:                              # &lt;- To preserve formatting \n                         [ \\t]* \\r? \\n                                      \n                         (?=\n                              [ \\t]*                  \n                              (?: \\r? \\n | /\\* | // )\n                         )\n                    )?\n                 |  \n                    //                               # Start // comment\n                    (?:                              # Possible line-continuation\n                         [^\\\\] \n                      |  \\\\ \n                         (?: \\r? \\n )?\n                    )*?\n                    (?:                              # End // comment\n                         \\r? \\n                               \n                         (?=                              # &lt;- To preserve formatting\n                              [ \\t]*                          \n                              (?: \\r? \\n | /\\* | // )\n                         )\n                      |  (?= \\r? \\n )\n                    )\n               )\n          )+                               # Grab multiple comment blocks if need be\n     )                                # (1 end)\n\n  |                                 ## OR\n\n     (                                # (2 start), Non - comments \n          \"\n          [^\"\\\\]*                          # Double quoted text\n          (?: \\\\ [\\S\\s] [^\"\\\\]* )*\n          \"\n       |  \n          '\n          [^'\\\\]*                          # Single quoted text\n          (?: \\\\ [\\S\\s] [^'\\\\]* )*\n          ' \n       |  \n          (?: \\r? \\n | [\\S\\s] )            # Linebreak or Any other char\n          [^/\"'\\\\\\s]*                      # Chars which doesn't start a comment, string, escape,\n                                           # or line continuation (escape + newline)\n     )                                # (2 end)\n</code></pre>\n"}], "owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4056, "favorite_count": 1, "accepted_answer_id": 36804325, "answer_count": 6, "score": 6, "last_activity_date": 1461364502, "creation_date": 1461086212, "question_id": 36725194, "link": "https://stackoverflow.com/questions/36725194/golang-regex-replace-excluding-quoted-strings", "title": "Golang regex replace excluding quoted strings", "body": "<p>I'm trying to implement the <code>removeComments</code> function in Golang from  <a href=\"https://github.com/elgs/JSONx-js/blob/master/jsonx.js\">this Javascript implementation</a>. I'm hoping to remove any comments from the text. For example:</p>\n\n<pre><code>/* this is comments, and should be removed */\n\nHowever, \"/* this is quoted, so it should not be removed*/\"\n</code></pre>\n\n<p>In the Javascript implementation, quoted matching are not captured in groups, so I can easily filter them out. However, in Golang, it seems it's not easy to tell whether the matched part is captured in a group or not. So how can I implement the same <code>removeComments</code> logic in Golang as the same in the Javascript version?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1461086184, "post_id": 36725098, "comment_id": 61034461, "body": "if all you need is a lock, what are you going to use goroutines for?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1461086263, "post_id": 36725098, "comment_id": 61034510, "body": "A lock is usually the best approach for synchronizing simple map access."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1461086382, "post_id": 36725098, "comment_id": 61034581, "body": "Also see <a href=\"http://stackoverflow.com/questions/34631561/should-goroutine-channel-based-mechanism-replace-a-concurrent-map\" title=\"should goroutine channel based mechanism replace a concurrent map\">stackoverflow.com/questions/34631561/&hellip;</a>, <a href=\"http://stackoverflow.com/questions/11063473/map-with-concurrent-access\" title=\"map with concurrent access\">stackoverflow.com/questions/11063473/map-with-concurrent-acc&zwnj;&#8203;ess</a>, <a href=\"http://stackoverflow.com/questions/36725098/creating-a-concurrent-safe-map-lock-or-goroutine\" title=\"creating a concurrent safe map lock or goroutine\">stackoverflow.com/questions/36725098/&hellip;</a>, <a href=\"http://stackoverflow.com/questions/18192173/nice-go-idiomatic-way-of-using-a-shared-map\" title=\"nice go idiomatic way of using a shared map\">stackoverflow.com/questions/18192173/&hellip;</a>, etc"}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461086520, "post_id": 36725098, "comment_id": 61034646, "body": "To directly answer your question-- yes, that would work with goroutines. But you should really think about your design, and whether or not your design needs to include goroutines (since you asked if you <i>should</i> be using them), or if you can get away without using them."}], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 1, "last_activity_date": 1519112214, "creation_date": 1519112214, "answer_id": 48880002, "question_id": 36725098, "link": "https://stackoverflow.com/questions/36725098/creating-a-concurrent-safe-map-lock-or-goroutine/48880002#48880002", "title": "Creating a concurrent safe map, lock or goroutine?", "body": "<p>This is no longer necessary in Go 1.9 and later. There is already a map implementation for concurrent use <a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\"><code>sync.Map</code></a>.</p>\n"}], "owner": {"reputation": 3699, "user_id": 4816175, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/697df6176ef55a7ea25f159e0fcdec38?s=128&d=identicon&r=PG", "display_name": "cool breeze", "link": "https://stackoverflow.com/users/4816175/cool-breeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1519112214, "creation_date": 1461085947, "question_id": 36725098, "link": "https://stackoverflow.com/questions/36725098/creating-a-concurrent-safe-map-lock-or-goroutine", "title": "Creating a concurrent safe map, lock or goroutine?", "body": "<p>I created a map that is safe for concurrent access, in each of the operations (or compound operations) I wrapped the operation with a lock.</p>\n\n<pre><code>func .. {\n  mu.Lock()\n  defer mu.Unlock()\n  ..\n}\n</code></pre>\n\n<p>Could I use goroutines for this also?  Should I be using goroutines?</p>\n"}, {"tags": ["function", "methods", "go"], "comments": [{"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461084018, "post_id": 36724389, "comment_id": 61033243, "body": "Because Title is a function inside of the strings package, and isn&#39;t available on strings natively. You&#39;re trying to do &lt;somestring&gt;.Title(), which isn&#39;t available. You would need to do strings.&lt;somestring&gt;.Title()."}, {"owner": {"reputation": 3902, "user_id": 4664382, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/199793134126c6e53309c85f04f30242?s=128&d=identicon&r=PG&f=1", "display_name": "Apswak", "link": "https://stackoverflow.com/users/4664382/apswak"}, "reply_to_user": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461084425, "post_id": 36724389, "comment_id": 61033479, "body": "But when i write only s1 = strings.Title(s1) it caps&#39;s the first letter?"}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461084510, "post_id": 36724389, "comment_id": 61033530, "body": "What is the output you&#39;re expecting? Is it &quot;Melvin THEMELVINATOR&quot;?"}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1461086630, "post_id": 36724389, "comment_id": 61034721, "body": "I have provided you a couple of solutions as answers."}], "answers": [{"comments": [{"owner": {"reputation": 3902, "user_id": 4664382, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/199793134126c6e53309c85f04f30242?s=128&d=identicon&r=PG&f=1", "display_name": "Apswak", "link": "https://stackoverflow.com/users/4664382/apswak"}, "edited": false, "score": 0, "creation_date": 1461098669, "post_id": 36724607, "comment_id": 61042069, "body": "Thanks for the answers, I think i&#39;ll stick with just doing it twice without chaining as I&#39;m new to Go. Thanks again!"}], "tags": [], "owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "is_accepted": true, "score": 2, "last_activity_date": 1461084748, "last_edit_date": 1461084748, "creation_date": 1461084446, "answer_id": 36724607, "question_id": 36724389, "link": "https://stackoverflow.com/questions/36724389/golang-stack-multiple-method-calls-on-one-line/36724607#36724607", "title": "Golang: Stack multiple method calls on one line", "body": "<p>You could try to do something like this (modify for your use case, I'm not entirely sure the output you're trying to get):</p>\n\n<pre><code>type myString string\n\nfunc main() {\n    firstName := \"mElVIn\"\n    lastName := \"themelvINATor\"\n    fmt.Println(nameCap(firstName, lastName))\n}\n\nfunc (s myString) Title(ss string) string {\n    return strings.Title(ss)\n}\n\nfunc nameCap(s1, s2 string) (str1, str2 string) {\n    s1 = myString(strings.ToLower(s1)).Title(s1)\n    s2 = strings.ToUpper(s2)\n\n    return s1, s2\n}\n</code></pre>\n\n<p>FWIW, there's nothing wrong with doing it without chaining:</p>\n\n<pre><code>func nameCap(s1, s2 string) (str1, str2 string) {\n    s1 = strings.ToLower(s1)\n    s1 = strings.Title(s1)\n    s2 = strings.ToUpper(s2)\n\n    return s1, s2\n}\n</code></pre>\n\n<p>GoPlay: <a href=\"http://play.golang.org/p/BcJTuBRqbx\" rel=\"nofollow\">http://play.golang.org/p/BcJTuBRqbx</a></p>\n"}], "owner": {"reputation": 3902, "user_id": 4664382, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/199793134126c6e53309c85f04f30242?s=128&d=identicon&r=PG&f=1", "display_name": "Apswak", "link": "https://stackoverflow.com/users/4664382/apswak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 989, "favorite_count": 0, "accepted_answer_id": 36724607, "answer_count": 1, "score": 0, "last_activity_date": 1461084748, "creation_date": 1461083814, "question_id": 36724389, "link": "https://stackoverflow.com/questions/36724389/golang-stack-multiple-method-calls-on-one-line", "title": "Golang: Stack multiple method calls on one line", "body": "<p>Getting started with Go.\nI'm trying to write a function that title cases a first name then caps the second.\nWhy can't I stack method calls as below?</p>\n\n<p>(The reason why I want to put a .ToLower before is because the .Title only caps the first letter leaving the rest unchanged)</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"strings\"\n)\n\nfunc main() {\n  firstName := \"mElVIn\"\n  lastName := \"themelvINATor\"\n  fmt.Println(nameCap(firstName, lastName))\n}\n\nfunc nameCap(s1, s2 string) (str1, str2 string) {\n  s1 = strings.ToLower(s1).Title(s1)\n  s2 = strings.ToUpper(s2)\n\n  return s1, s2\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2809, "user_id": 835058, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/bkxta.jpg?s=128&g=1", "display_name": "mogronalol", "link": "https://stackoverflow.com/users/835058/mogronalol"}, "is_accepted": true, "score": 6, "last_activity_date": 1461075591, "creation_date": 1461075591, "answer_id": 36721134, "question_id": 36720749, "link": "https://stackoverflow.com/questions/36720749/why-is-the-go-compiler-saying-a-struct-does-not-satisfy-an-interface-when-it-doe/36721134#36721134", "title": "Why is the go compiler saying a struct does not satisfy an interface when it does?", "body": "<p>It turns out that <code>func (e *SyntaxError) Error() string { return e.msg }</code> is a method for the pointer, whereas I am looking for the method on a value.  I've managed to solve the problem by doing <code>*json.SyntaxError</code> to refer to a pointer.</p>\n"}], "owner": {"reputation": 2809, "user_id": 835058, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/bkxta.jpg?s=128&g=1", "display_name": "mogronalol", "link": "https://stackoverflow.com/users/835058/mogronalol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 36721134, "answer_count": 1, "score": 2, "last_activity_date": 1461075591, "creation_date": 1461074651, "question_id": 36720749, "link": "https://stackoverflow.com/questions/36720749/why-is-the-go-compiler-saying-a-struct-does-not-satisfy-an-interface-when-it-doe", "title": "Why is the go compiler saying a struct does not satisfy an interface when it does?", "body": "<p>I can see in <code>scanner.go</code> that the struct has an <code>error</code> method.</p>\n\n<pre><code>// A SyntaxError is a description of a JSON syntax error.\ntype SyntaxError struct {\n    msg    string // description of error\n    Offset int64  // error occurred after reading Offset bytes\n}\n\nfunc (e *SyntaxError) Error() string { return e.msg }\n</code></pre>\n\n<p>But the compiler tells me this:</p>\n\n<p><code>api/errors.go:24: impossible type switch case: err (type error) cannot have dynamic type json.SyntaxError (missing Error method)</code> when trying to do a switch case on type</p>\n\n<pre><code>func myFunction(err error) {\n    switch err.(type) {\n        case validator.ErrorMap, json.SyntaxError:\n        response.WriteErrorString(http.StatusBadRequest, \"400: Bad Request\")\n//etc       \n</code></pre>\n\n<p>Why does this not compile?  Because the struct has the <code>Error</code> method.</p>\n"}, {"tags": ["string", "pointers", "go", "immutability"], "comments": [{"owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "edited": false, "score": 0, "creation_date": 1461074818, "post_id": 36720693, "comment_id": 61026512, "body": "because <code>c1</code> is a unique instance, and its address will not be changed, you can only change its value"}, {"owner": {"reputation": 834, "user_id": 2414102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ad387b4517de3a8f602ec987e1ea71f1?s=128&d=identicon&r=PG", "display_name": "camabeh", "link": "https://stackoverflow.com/users/2414102/camabeh"}, "reply_to_user": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "edited": false, "score": 0, "creation_date": 1461075528, "post_id": 36720693, "comment_id": 61027061, "body": "yes, <code>c1</code> is not being changed, but it&#39;s field <code>name</code> is immutable, right? So when I change <code>name</code> it should have new address. What If I want store extremly large string, how does the compiler store it, when it still uses same address?"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1461078189, "post_id": 36721452, "comment_id": 61029049, "body": "There is also the <a href=\"https://golang.org/pkg/reflect/#StringHeader\" rel=\"nofollow noreferrer\">StringHeader</a> in the reflect package, which reflects the actual string struct layout in <a href=\"https://golang.org/src/runtime/string.go#L215\" rel=\"nofollow noreferrer\">runtime/string.go</a>"}, {"owner": {"reputation": 834, "user_id": 2414102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ad387b4517de3a8f602ec987e1ea71f1?s=128&d=identicon&r=PG", "display_name": "camabeh", "link": "https://stackoverflow.com/users/2414102/camabeh"}, "edited": false, "score": 0, "creation_date": 1461079021, "post_id": 36721452, "comment_id": 61029711, "body": "Thank you. It all makes sense now."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 10, "last_activity_date": 1461078330, "last_edit_date": 1461078330, "creation_date": 1461076313, "answer_id": 36721452, "question_id": 36720693, "link": "https://stackoverflow.com/questions/36720693/immutable-strings-in-go/36721452#36721452", "title": "Immutable strings in Go", "body": "<p>The immutability of strings is not the same as immutability of variables.</p>\n\n<p>Immutability of strings means that the characters in the string cannot be changed. This holds true for Go. Go makes use of it when slicing strings as shown in the example below.</p>\n\n<p>Variables in Go are always mutable. When a string variable is changed, the internal fields of the variable (pointer and length) are changed. The address of variable never changes.</p>\n\n<p>The example below presents the internals of Go string variable. The first integer is an address to the array of characters and the second is the length.</p>\n\n<p>See the article on internals of string in Go <a href=\"http://research.swtch.com/godata\">http://research.swtch.com/godata</a>.</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"reflect\"\n        \"unsafe\"\n)\n\nfunc main() {\n    var x string = \"abc\"\n    fmt.Println(x, &amp;x, (*reflect.StringHeader)(unsafe.Pointer(&amp;x)))\n    x = \"cde\"\n    fmt.Println(x, &amp;x, (*reflect.StringHeader)(unsafe.Pointer(&amp;x)))\n    x = x[1:]\n    fmt.Println(x, &amp;x, (*reflect.StringHeader)(unsafe.Pointer(&amp;x)))\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/a_uAw6qt_h\"><kbd>Playground</kbd></a></p>\n"}], "owner": {"reputation": 834, "user_id": 2414102, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ad387b4517de3a8f602ec987e1ea71f1?s=128&d=identicon&r=PG", "display_name": "camabeh", "link": "https://stackoverflow.com/users/2414102/camabeh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1624, "favorite_count": 0, "accepted_answer_id": 36721452, "answer_count": 1, "score": 3, "last_activity_date": 1611662470, "creation_date": 1461074530, "question_id": 36720693, "link": "https://stackoverflow.com/questions/36720693/immutable-strings-in-go", "title": "Immutable strings in Go", "body": "<p>is anyone able to explain me why the address of <code>&amp;c1.name</code> is the same after being changed in function <code>changeMe()</code>. I thought strings are immutable in Go.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype customer struct {\n    name string\n    age  int\n}\n\nfunc main() {\n    c1 := customer{\"Todd\", 44}\n    fmt.Println(&amp;c1.name) // 0x8201e4120\n\n    changeMe(&amp;c1)\n\n    fmt.Println(c1)       // {Rocky 44}\n    fmt.Println(&amp;c1.name) // 0x8201e4120\n}\n\nfunc changeMe(z *customer) {\n    fmt.Println(z)       // &amp;{Todd 44}\n    fmt.Println(&amp;z.name) // 0x8201e4120\n    z.name = \"Rocky\"\n    fmt.Println(z)       // &amp;{Rocky 44}\n    fmt.Println(&amp;z.name) // 0x8201e4120\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo", "ttl", "mongodb-indexes"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1461113315, "post_id": 36720669, "comment_id": 61047495, "body": "I could be wrong, but off the top of my head I think the <code>expireAfterSeconds: 0</code> would actually be ignored with a <code>0</code> value anyway, since I &quot;believe&quot; it needs to be a positive value. TTL cleanup processes run at most every minute anyway, so any expiry less than 60 seconds is going to be around for at least a minute longer. As to the rest, I&#39;m not saying you &quot;cannot&quot; do it, but you might want to reconsider the utility of defining an index in your Go code. Indexes only need definition once, and are therefore best implemented in &quot;deployment scripts&quot;, rather than be part of the general code."}, {"owner": {"reputation": 2103, "user_id": 3119050, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/mZahs.jpg?s=128&g=1", "display_name": "fredmaggiowski", "link": "https://stackoverflow.com/users/3119050/fredmaggiowski"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1461127833, "post_id": 36720669, "comment_id": 61051277, "body": "The doc itself specify tu use <code>expireAfterSeconds: 0</code> when you want the index to expire on another date key. For what regards where the index is created, yeah, you&#39;re right it actually is in a deployment script right now."}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1461128708, "post_id": 36720669, "comment_id": 61051595, "body": "Why would you think you are informing me something about the documentation? That is not what it says at all and the &quot;only&quot; key you can use is the &quot;singular&quot; data specified in the index. And &quot;that&quot; is exactly what the documentation says. Honestly, there are links to user profiles on every single comment. If you spent a moment to look, then you might understand that the person you want to &quot;inform&quot; has a much better concept than yourself, and was therefore &quot;giving you some good advice&quot;."}, {"owner": {"reputation": 2103, "user_id": 3119050, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/mZahs.jpg?s=128&g=1", "display_name": "fredmaggiowski", "link": "https://stackoverflow.com/users/3119050/fredmaggiowski"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1461129025, "post_id": 36720669, "comment_id": 61051728, "body": "I wasn&#39;t meaning to inform you on something apart from what I honestly have understood reading it, i wasn&#39;t trying to inform you on anything (i checked out your profile too before replying) and i&#39;m sorry if I might have expressed myself in a bad way."}, {"owner": {"reputation": 2103, "user_id": 3119050, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/mZahs.jpg?s=128&g=1", "display_name": "fredmaggiowski", "link": "https://stackoverflow.com/users/3119050/fredmaggiowski"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1461129173, "post_id": 36720669, "comment_id": 61051788, "body": "By saying <code>the &quot;only&quot; key you can use is the &quot;singular&quot; data specified in the index</code> are you referring to the mgo <code>Index.Key</code> or to the <code>ExpireAfter</code>?"}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1461129700, "post_id": 36720669, "comment_id": 61052006, "body": "One field and &quot;only&quot; one field, which &quot;must&quot; be a BSON Date. And the expireAfterSeconds &quot;must&quot; be a positive value. Simple well documented concepts. The other point here is writing this in Go is overkill as there are far more simplistic deployment methods. So you two problems have simple solutions. 1. use a &quot;valid&quot; value for expiry. 2. use a simple method for index creation, rather than trying to work out how to apply to a typed language like Go. Good advice to save you lots of time."}, {"owner": {"reputation": 2103, "user_id": 3119050, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/mZahs.jpg?s=128&g=1", "display_name": "fredmaggiowski", "link": "https://stackoverflow.com/users/3119050/fredmaggiowski"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1461131343, "post_id": 36720669, "comment_id": 61052662, "body": "For the first point OK i&#39;ll try it out, setting my expire date to a valid date and the index expireafterseconds to a positive amount. for the second one there&#39;s nothing I can do since the indexes and databases are created by a configuration rest service written in Go.."}, {"owner": {"reputation": 2103, "user_id": 3119050, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/mZahs.jpg?s=128&g=1", "display_name": "fredmaggiowski", "link": "https://stackoverflow.com/users/3119050/fredmaggiowski"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1461131559, "post_id": 36720669, "comment_id": 61052749, "body": "There&#39;s still something that&#39;s bugging me, thought... Doing this way is it still possible to make some documents to not expire at all? Since this is the behaviour I&#39;m looking forward to obtain a collection where some documents do expire while other remain persistent"}], "answers": [{"comments": [{"owner": {"reputation": 2103, "user_id": 3119050, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/mZahs.jpg?s=128&g=1", "display_name": "fredmaggiowski", "link": "https://stackoverflow.com/users/3119050/fredmaggiowski"}, "edited": false, "score": 0, "creation_date": 1503576605, "post_id": 45343527, "comment_id": 78680437, "body": "Thank you @Wan for the answer, it passed more than a year since I had this problem so right now I can&#39;t test it to verify the solution; anyway it seems to be the perfect one. I didn&#39;t though about the Gob <code>omitempty</code> keyword. The thing is that it avoids the insertion of the 0-valued Time resulting in the &quot;deactivation&quot; of the index for that document. Did I got it right? For now I&#39;m upvoting the answer, I&#39;ll test it ASAP to accept it! :)"}], "tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 3, "last_activity_date": 1501138878, "creation_date": 1501138878, "answer_id": 45343527, "question_id": 36720669, "link": "https://stackoverflow.com/questions/36720669/mgo-ttl-indexes-creation-to-selectively-delete-documents/45343527#45343527", "title": "MGO TTL indexes creation to selectively delete documents", "body": "<blockquote>\n  <p>How can I set the index thus that it'll delete the document IF the expireAt key is valid? </p>\n</blockquote>\n\n<p>An example to set a TTL index using <a href=\"http://godoc.org/gopkg.in/mgo.v2\" rel=\"nofollow noreferrer\">mgo.v2</a> is as below: </p>\n\n<pre><code>index := mgo.Index{\n    Key:         []string{\"expireAt\"},\n    ExpireAfter: time.Second * 120, \n}\nerr = coll.EnsureIndex(index)\n</code></pre>\n\n<p>Where the above example sets to 120 seconds of expiration. See also <a href=\"https://docs.mongodb.com/manual/tutorial/expire-data/\" rel=\"nofollow noreferrer\">Expire Data from Collections by Setting TTL</a>. </p>\n\n<blockquote>\n  <p>Is it still possible to make some documents to not expire at all? Since this is the behaviour I'm looking forward to obtain a collection where some documents do expire while other remain persistent</p>\n</blockquote>\n\n<p>You can specify <code>omitempty</code> flag for <code>ExpireAt</code> struct field as below: </p>\n\n<pre><code>type Filter struct {\n    Timestamp time.Time `bson:\"createdAt\"`\n    Body      string    `bson:\"body\"`\n    ExpireAt  time.Time `bson:\"expireAt,omitempty\"`\n}\n</code></pre>\n\n<p>Which essentially only include the field if it's not set to a zero value. See more info <a href=\"http://godoc.org/launchpad.net/mgo/v2/bson#Marshal\" rel=\"nofollow noreferrer\">mgo.v2 bson.Marshal</a></p>\n\n<p>Now, for example you can insert two documents where one would expire and the other persists. Code example: </p>\n\n<pre><code>var foo Filter\nfoo.Timestamp = timestamp\nfoo.Body = \"Will be deleted per TTL index\"\nfoo.ExpireAt = time.Now()\ncollection.Insert(foo)\n\nvar bar Filter\nbar.Timestamp = timestamp\nbar.Body = \"Persists until expireAt value is set\"\ncollection.Insert(bar)\n</code></pre>\n\n<p>Later on, you can set the <code>expireAt</code> field with an <a href=\"http://godoc.org/gopkg.in/mgo.v2#Collection.Update\" rel=\"nofollow noreferrer\">Update()</a>, as an example: </p>\n\n<pre><code>newValue := bson.M{\"$set\": bson.M{\"expireAt\": time.Now()}}\nerr = collection.Update(queryFilter, newValue)\n</code></pre>\n\n<p>Setting a valid time value for <code>expireAt</code> field, would make it qualify for the TTL index. i.e. no longer persists. </p>\n\n<p>Depending on your use case, alternatively you may as well <a href=\"http://godoc.org/gopkg.in/mgo.v2#Collection.Remove\" rel=\"nofollow noreferrer\">Remove()</a> the document instead of updating and relying on TTL index. </p>\n"}], "owner": {"reputation": 2103, "user_id": 3119050, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/mZahs.jpg?s=128&g=1", "display_name": "fredmaggiowski", "link": "https://stackoverflow.com/users/3119050/fredmaggiowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1606, "favorite_count": 1, "accepted_answer_id": 45343527, "answer_count": 1, "score": 3, "last_activity_date": 1501138878, "creation_date": 1461074451, "last_edit_date": 1461074840, "question_id": 36720669, "link": "https://stackoverflow.com/questions/36720669/mgo-ttl-indexes-creation-to-selectively-delete-documents", "title": "MGO TTL indexes creation to selectively delete documents", "body": "<p>I'm working with Golang and MongoDB. I have a collection which needs to keep a document which can be persistent or volatile. Hence, if it's set an expire date (as the example <code>expireAt</code>) the document is considered volatile and deleted otherwise it'll be kept in the collection unless it'll be manually deleted.</p>\n\n<p>Reading <a href=\"https://docs.mongodb.org/v2.4/tutorial/expire-data/\" rel=\"nofollow\">this doc</a> I've found an index that might work as I need it to.</p>\n\n<p>Basically I need to replicate this kind of index in mgo:</p>\n\n<pre><code>db.log_events.createIndex( { \"expireAt\": 1 }, { expireAfterSeconds: 0 } )\n\ndb.log_events.insert( {\n  \"expireAt\": new Date('July 22, 2013 14:00:00'),\n  \"logEvent\": 2,\n  \"logMessage\": \"Success!\"\n} )\n</code></pre>\n\n<p>I've read (I'm searching back for the source of this information) that if the <code>expireAt</code> is not a valid date the deletion won't be trigger. Thus I think that all I need to do is to set the expireDate to a valid date when I need it, otherwise I'll leave it to the Go <code>time.Time</code> zero value.</p>\n\n<p>This is my codebase</p>\n\n<pre><code>type Filter struct {\n    Timestamp time.Time     `bson:\"createdAt\"`\n    ExpireAt  time.Time     `bson:\"expireAt\"`\n    Body      string        `bson:\"body\"`\n}\n\n// Create filter from data received via REST API.\nvar filter Filter\ntimestamp := time.Now()\n\nif theUserAction == \"share\" { // This is action will set the document as volatile\n    filter.ExpireAt = time.Now().Add(24 * time.Hour * 14)\n}\n\nfilter.Timestamp = timestamp\nfilter.Body = \"A BODY\"\n\n// Store filter in database\nsession, err := mdb.GetMgoSession() // This is a wrapping method that returns a valid mgo session\nif err != nil {\n    return NewErrorInternal(\"Error connecting to database\", err)\n}\ndefer session.Close()\n\n\n// Get db with global data for legent\ncollection := session.DB(database).C(filtersCollection)\n</code></pre>\n\n<p>My question is: how can I set the index thus that it'll delete the document IF the <code>expireAt</code> key is valid?\nReading the <a href=\"https://godoc.org/labix.org/v2/mgo#Index\" rel=\"nofollow\">mgo documentation about Index Type</a> it doesn't seems like there's a way to replicate the previously stated index, since the library only provides the <code>ExpireAfter</code> field..</p>\n\n<p>Also, it's valid to assume that a zerovalue could be interpreted by mongodb as an invalid date? </p>\n\n<p>From the docs it is <code>January 1, year 1, 00:00:00.000000000 UTC</code>\u00a0which actually seems like a valid date..</p>\n\n<p>What I've thought so far is doing something like this:</p>\n\n<pre><code>filtIdx := mgo.Index{\n    Key:        []string{\"expireAt\"},\n    Unique:     false,\n    Background: true,\n    Sparse:     false,\n    ExpireAfter: 0,\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1461073757, "post_id": 36720216, "comment_id": 61025730, "body": "You can also add these three quotes from the spec to explain why the two anonymous structs can be compared: &quot;In any comparison, the first operand must be assignable to the type of the second operand&quot;, &quot;A value x is assignable to a variable of type T (&quot;x is assignable to T&quot;) in any of these cases:  x&#39;s type is identical to T.&quot;, &quot;Two struct types are identical if they have the same sequence of fields, and if corresponding fields have the same names, and identical types, and identical tags.&quot;"}], "tags": [], "owner": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "is_accepted": false, "score": 5, "last_activity_date": 1461073266, "creation_date": 1461073266, "answer_id": 36720216, "question_id": 36719925, "link": "https://stackoverflow.com/questions/36719925/go-comparing-anonymous-structs/36720216#36720216", "title": "Go: comparing anonymous structs", "body": "<blockquote>\n  <p>Why does x == y yields true?</p>\n</blockquote>\n\n<p>From the <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"noreferrer\">Go language specification</a>:</p>\n\n<blockquote>\n  <p>Struct values are comparable if all their fields are comparable. Two struct values are equal if their corresponding non-blank fields are equal.</p>\n</blockquote>\n\n<p>The zero-value for a <code>string</code> is <code>\"\"</code>, so <code>x.bar</code> and <code>y.bar</code> are equal, and therefore <code>x</code> and <code>y</code> are equal.</p>\n\n<hr>\n\n<blockquote>\n  <p>why casting them to interface{} makes them unequal?</p>\n</blockquote>\n\n<p>Again, from the same page in the language specification:</p>\n\n<blockquote>\n  <p>Interface values are comparable. Two interface values are equal if they have identical dynamic types and equal dynamic values or if both have value nil.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 2, "last_activity_date": 1461073466, "creation_date": 1461073466, "answer_id": 36720297, "question_id": 36719925, "link": "https://stackoverflow.com/questions/36719925/go-comparing-anonymous-structs/36720297#36720297", "title": "Go: comparing anonymous structs", "body": "<p>They have a different type but are comparable since the structs have the same field names/types.  If you try renaming the field, it won't compile.</p>\n\n<p>They are comparable as interface{} values, but their dynamic types are different - You can check this with the fmt <code>%T</code> verb</p>\n\n<p><a href=\"http://play.golang.org/p/x0w30RIb5a\" rel=\"nofollow\">http://play.golang.org/p/x0w30RIb5a</a></p>\n"}], "owner": {"reputation": 1695, "user_id": 617556, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6136180203540c5248e37d1124ac7999?s=128&d=identicon&r=PG", "display_name": "Paperback Writer", "link": "https://stackoverflow.com/users/617556/paperback-writer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1461073466, "creation_date": 1461072524, "question_id": 36719925, "link": "https://stackoverflow.com/questions/36719925/go-comparing-anonymous-structs", "title": "Go: comparing anonymous structs", "body": "<p>I don't understand how <code>go</code> compares anonymous structures. I am trying to understand this piece of code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype foo struct {\n    bar string\n}\n\nfunc main() {\n    var x struct {\n        bar string\n    }\n    var y foo\n    fmt.Println(x == y) // this prints true\n    equals(x, y) // this prints false\n\n}\n\n\nfunc equals(a, b interface{}) {\n    fmt.Println(a == b)\n}\n</code></pre>\n\n<p>Why does <code>x == y</code> yields <code>true</code>? They have a different type, so I would expect that they cannot be compared. </p>\n\n<p>And, as they are equal, why casting them to <code>interface{}</code> makes them unequal? </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": true, "score": 3, "last_activity_date": 1461072725, "creation_date": 1461072725, "answer_id": 36720012, "question_id": 36719661, "link": "https://stackoverflow.com/questions/36719661/running-go-tests-from-root-project-folder/36720012#36720012", "title": "Running go tests from root project folder", "body": "<p>You can use the <code>...</code> (<em>ellipsis</em>) operator to test all subpackages of the current package. Like that: <code>go test ./...</code>.</p>\n\n<p>There are other solutions that you might want to try later if you do something more sophisticated, like using the <code>list</code> tool. Like that (for example): <code>go test $(go list ./... | grep [regex])</code>. That's useful to exclude the <code>vendor</code> directory from your tests.</p>\n\n<p>Another thing you may want to know about is the <code>gt</code> command that can be found here <a href=\"https://godoc.org/rsc.io/gt\" rel=\"nofollow\">https://godoc.org/rsc.io/gt</a> and add caching to the <code>go test</code> command.</p>\n\n<p>Finally, don't hesitate to read <a href=\"https://blog.golang.org/cover\" rel=\"nofollow\">https://blog.golang.org/cover</a> to get informations about code-coverage analysis in golang.</p>\n"}, {"tags": [], "owner": {"reputation": 548, "user_id": 5345652, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZdgGaohbRX0/AAAAAAAAAAI/AAAAAAAAAAA/65laXilEcK8/photo.jpg?sz=128", "display_name": "Sharon Katz", "link": "https://stackoverflow.com/users/5345652/sharon-katz"}, "is_accepted": false, "score": 0, "last_activity_date": 1575911229, "creation_date": 1575911229, "answer_id": 59253526, "question_id": 36719661, "link": "https://stackoverflow.com/questions/36719661/running-go-tests-from-root-project-folder/59253526#59253526", "title": "Running go tests from root project folder", "body": "<p>just running <code>sudo go test -v ./...</code> will probably fail because you probably do not have your root environment setup for GO just like you set the non-root env.</p>\n\n<p>You can go and reset everything in the root, or do this easy step:</p>\n\n<pre><code>sudo -E go test -v ./...\n</code></pre>\n\n<p>This will run as root but keep your env settings.</p>\n"}, {"tags": [], "owner": {"reputation": 4278, "user_id": 288644, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0309e362d8d8e22a1572de05d41f0d9a?s=128&d=identicon&r=PG", "display_name": "Daith&#237;", "link": "https://stackoverflow.com/users/288644/daith%c3%ad"}, "is_accepted": false, "score": 0, "last_activity_date": 1613042414, "creation_date": 1613042414, "answer_id": 66153733, "question_id": 36719661, "link": "https://stackoverflow.com/questions/36719661/running-go-tests-from-root-project-folder/66153733#66153733", "title": "Running go tests from root project folder", "body": "<p>I find this irritating that <code>go test ./...</code> when run from project root will actually run from <code>pkg/pkg_name/</code> folder. There is a way you can set the tests to project root by setting <code>cwd</code> in the <code>init()</code> helper function.</p>\n<p>I found the solution <a href=\"https://brandur.org/fragments/testing-go-project-root\" rel=\"nofollow noreferrer\">here</a> You could try the following snippet in your _file:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func init() {\n    _, filename, _, _ := runtime.Caller(0)\n    dir := path.Join(path.Dir(filename), &quot;../..&quot;) // change to suit test file location\n    err := os.Chdir(dir)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n<p>This snippet above works for my tests in <code>pkg/$name/$name_test.go</code>.</p>\n"}], "owner": {"reputation": 584, "user_id": 3660618, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/cf9482a9f5ee2aeb70476daf65c42a49?s=128&d=identicon&r=PG&f=1", "display_name": "pezpezpez", "link": "https://stackoverflow.com/users/3660618/pezpezpez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2560, "favorite_count": 0, "accepted_answer_id": 36720012, "answer_count": 3, "score": 2, "last_activity_date": 1613042414, "creation_date": 1461071884, "last_edit_date": 1461072230, "question_id": 36719661, "link": "https://stackoverflow.com/questions/36719661/running-go-tests-from-root-project-folder", "title": "Running go tests from root project folder", "body": "<p>I have to take over a go project from a colleague and I've never touched Go before and it doesn't have tests so I've started to add them but I cannot run them.</p>\n\n<p>The go command for running tests is <code>go test</code> but it doesn't seem to run at the root level.</p>\n\n<p>My project structure is:</p>\n\n<pre><code>/project/main.go\n/project/engine/*.go\n/project/api/*.go\n</code></pre>\n\n<p>If I <code>cd</code> into either <code>engine</code> or <code>api</code>, and run <code>go test</code> it works but not in the root folder.</p>\n\n<pre><code>cd /project\ngo test\n\n ?      /project    [no test files]\n</code></pre>\n\n<p>Is there anyway to run all tests from the root? </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 66, "last_activity_date": 1461071730, "creation_date": 1461071730, "answer_id": 36719588, "question_id": 36719525, "link": "https://stackoverflow.com/questions/36719525/how-to-log-messages-to-the-console-and-a-file-both-in-golang/36719588#36719588", "title": "How to log messages to the console and a file both in golang?", "body": "<p>Use an <a href=\"https://golang.org/pkg/io/#MultiWriter\"><code>io.MultiWriter</code></a></p>\n\n<blockquote>\n  <p>MultiWriter creates a writer that duplicates its writes to all the provided writers, similar to the Unix tee(1) command</p>\n</blockquote>\n\n<pre><code>mw := io.MultiWriter(os.Stdout, logFile)\nlog.SetOutput(mw)\n</code></pre>\n"}], "owner": {"reputation": 1168, "user_id": 6151836, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-ML9D75lbE3g/AAAAAAAAAAI/AAAAAAAAABk/pLJaDy3wdbE/photo.jpg?sz=128", "display_name": "Serge Nikitin", "link": "https://stackoverflow.com/users/6151836/serge-nikitin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11078, "favorite_count": 8, "accepted_answer_id": 36719588, "answer_count": 1, "score": 21, "last_activity_date": 1461071730, "creation_date": 1461071584, "question_id": 36719525, "link": "https://stackoverflow.com/questions/36719525/how-to-log-messages-to-the-console-and-a-file-both-in-golang", "title": "How to log messages to the console and a file both in golang?", "body": "<p>I can direct all messages to log.txt file:</p>\n\n<pre><code>logFile, err := os.OpenFile(\"log.txt\", os.O_CREATE | os.O_APPEND | os.O_RDWR, 0666)\nif err != nil {\n    panic(err)\n}\nlog.SetOutput(logFile)\n</code></pre>\n\n<p>But how can I get log messages in console too?</p>\n"}, {"tags": ["regex", "string", "go", "iteration", "tolower"], "comments": [{"owner": {"reputation": 1413, "user_id": 3008506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ErOCN.jpg?s=128&g=1", "display_name": "Lucas Araujo", "link": "https://stackoverflow.com/users/3008506/lucas-araujo"}, "edited": false, "score": 0, "creation_date": 1461066136, "post_id": 36717201, "comment_id": 61019896, "body": "what about this regex: <a href=\"https://regex101.com/r/wN1oF4/1\" rel=\"nofollow noreferrer\">Regex Demo</a>"}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "reply_to_user": {"reputation": 1413, "user_id": 3008506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ErOCN.jpg?s=128&g=1", "display_name": "Lucas Araujo", "link": "https://stackoverflow.com/users/3008506/lucas-araujo"}, "edited": false, "score": 0, "creation_date": 1461066515, "post_id": 36717201, "comment_id": 61020151, "body": "Thank you @lbarros, I could get that match with <code>([A-Z]{2})=.+,([A-Z]{2})=.+,([A-Z]{2})=.+</code> but the number of fields could be varying, if an <code>OU</code> comes in between. It varies based on the returned entry."}], "answers": [{"comments": [{"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 0, "creation_date": 1461067034, "post_id": 36717588, "comment_id": 61020551, "body": "The realm part could be anything, and any number, based on the return value."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1461066775, "creation_date": 1461066775, "answer_id": 36717588, "question_id": 36717201, "link": "https://stackoverflow.com/questions/36717201/golang-selective-conversion-of-string-to-lower-case/36717588#36717588", "title": "golang selective conversion of string to lower case", "body": "<p>Doesn't</p>\n\n<pre><code>strings.Replace(results, \"CN\", \"cn\", -1)\n</code></pre>\n\n<p>can help? <a href=\"https://golang.org/pkg/strings/#Replace\" rel=\"nofollow\">https://golang.org/pkg/strings/#Replace</a></p>\n"}, {"comments": [{"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "edited": false, "score": 1, "creation_date": 1461066983, "post_id": 36717597, "comment_id": 61020509, "body": "Nice and clean. The regex part is converted whereas the other parts, whether upper or lower, remains same. Thank you."}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 5, "last_activity_date": 1461066816, "creation_date": 1461066816, "answer_id": 36717597, "question_id": 36717201, "link": "https://stackoverflow.com/questions/36717201/golang-selective-conversion-of-string-to-lower-case/36717597#36717597", "title": "golang selective conversion of string to lower case", "body": "<p>Here is a regex way to make all uppercase chunks of text followed with a <code>=</code> tp lower case:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"strings\"\n        \"regexp\"\n)\n\nfunc main() {\n        input := \"CN=bob,DC=example,DC=com\"\n        r := regexp.MustCompile(`[A-Z]+=`)\n        fmt.Println(r.ReplaceAllStringFunc(input, func(m string) string {\n                return strings.ToLower(m)\n        }))\n}\n</code></pre>\n\n<p>See the <a href=\"https://play.golang.org/p/62656ElRgh\" rel=\"noreferrer\">Playground demo</a></p>\n\n<p>The regex - <code>[A-Z]+=</code> - matches 1 or more uppercase ASCII letters and a <code>=</code> after them. Then, inside the <a href=\"https://golang.org/pkg/regexp/#Regexp.ReplaceAllStringFunc\" rel=\"noreferrer\"><code>ReplaceAllStringFunc</code></a>, we can use an \"anonymous function\" to return a modified match value.</p>\n"}], "owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1300, "favorite_count": 0, "accepted_answer_id": 36717597, "answer_count": 2, "score": 3, "last_activity_date": 1461066816, "creation_date": 1461065704, "question_id": 36717201, "link": "https://stackoverflow.com/questions/36717201/golang-selective-conversion-of-string-to-lower-case", "title": "golang selective conversion of string to lower case", "body": "<p>I am working with an ldap object where I am retrieving some entries from Activedirectory. The results are in such a way that the realm is returned in uppercase, like <code>CN=bob,DC=example,DC=com</code> instead of <code>cn=bob,dc=example,dc=com</code>. Is there a way to selectively convert the <code>CN</code> and <code>DC</code> substrings to lowercase? Sofar, I was using <code>strings.split</code> multiple times (using \",\" first and then iterating again using \"=\") to get to the point where I can get CN, DC, etc. into a list, and then using strings.ToLower on them. Is there a better and smarter way to get this done, possibly using regex so that I can possibly avoid two iterations?</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1461132006, "last_edit_date": 1495541770, "creation_date": 1461067072, "answer_id": 36717673, "question_id": 36717098, "link": "https://stackoverflow.com/questions/36717098/correct-way-to-read-file-in-go-appengine/36717673#36717673", "title": "Correct way to read file in Go AppEngine", "body": "<p>You can read from files on App Engine the same way you can read from files in a Go app running on your computer.</p>\n\n<p>Some things to keep in mind:</p>\n\n<ul>\n<li><p>You should use <em>relative</em> file paths instead of absolute. The working directory is the root folder of your app (where the <code>app.yaml</code> file resides).</p></li>\n<li><p>Only files that are <em>application</em> files can be read by Go code, so if you want to read a file from Go code, the file must not be matched by a static file pattern (or if it must be available as a static file too, <code>application_readable</code> option must be specified at the static file handler which includes/applies to the file, <a href=\"https://stackoverflow.com/a/29288854/1705598\">details</a>).</p></li>\n</ul>\n\n<p>The latter is detailed on the <a href=\"https://cloud.google.com/appengine/docs/go/config/appconfig\" rel=\"nofollow noreferrer\">Application configuration</a> page, Section <a href=\"https://cloud.google.com/appengine/docs/go/config/appconfig#Go_app_yaml_Static_file_handlers\" rel=\"nofollow noreferrer\">Static file handlers</a>. Quoting the relevant part:</p>\n\n<blockquote>\n  <p>For efficiency, App Engine stores and serves static files separately from application files. Static files are not available in the application's file system. If you have data files that need to be read by the application code, the data files must be application files, and must not be matched by a static file pattern.</p>\n</blockquote>\n\n<p>So let's say you have a folder <code>data</code> in your app's root (next to <code>app.yaml</code>), and a file <code>list.txt</code> in it. You may read its content like this:</p>\n\n<pre><code>if content, err := ioutil.Readfile(\"data/list.txt\"); err != nil {\n    // Failed to read file, handle error\n} else {\n    // Success, do something with content\n}\n</code></pre>\n\n<p>Or if you want / need an <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\">io.Reader</a> (<a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>os.File</code></a> implements <code>io.Reader</code> along with many other):</p>\n\n<pre><code>f, err := os.Open(\"data/list.txt\") // For read access.\nif err != nil {\n    // Failed to open file, log / handle error\n    return\n}\ndefer f.Close()\n// Here you may read from f\n</code></pre>\n\n<p><strong>Related questions:</strong></p>\n\n<p><a href=\"https://stackoverflow.com/questions/29285670/google-app-engine-golang-no-such-file-or-directory\">Google App Engine Golang no such file or directory</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/35638518/static-pages-return-404-in-google-app-engine\">Static pages return 404 in Google App Engine</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/34629056/how-do-i-store-the-private-key-of-my-server-in-google-app-engine\">How do I store the private key of my server in google app engine?</a></p>\n"}], "owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1303, "favorite_count": 0, "accepted_answer_id": 36717673, "answer_count": 1, "score": 3, "last_activity_date": 1461132006, "creation_date": 1461065378, "question_id": 36717098, "link": "https://stackoverflow.com/questions/36717098/correct-way-to-read-file-in-go-appengine", "title": "Correct way to read file in Go AppEngine", "body": "<p>What's the correct way to read a file using Google AppEngine (<a href=\"https://cloud.google.com/appengine/docs/go\" rel=\"nofollow\">Go</a>)?</p>\n\n<p>In Java I read there are <code>context.getResourceAsStream</code>, is there any equivalent function for that?</p>\n"}, {"tags": ["heroku", "go"], "answers": [{"tags": [], "owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "is_accepted": true, "score": 4, "last_activity_date": 1461078202, "creation_date": 1461078202, "answer_id": 36722262, "question_id": 36716699, "link": "https://stackoverflow.com/questions/36716699/is-it-possible-to-dump-golang-db-query-output-to-a-string/36722262#36722262", "title": "Is it possible to dump golang db.Query() output to a string?", "body": "<p>Pretty much: No.</p>\n\n<p>The Query method is going to return a pointer to a Rows struct:</p>\n\n<pre><code>func (db *DB) Query(query string, args ...interface{}) (*Rows, error)\n</code></pre>\n\n<p>If you print that (<code>fmt.Printf(\"%#v\\n\", rows)</code>) you'll see something such as:</p>\n\n<p><code>&amp;sql.Rows{dc:(*sql.driverConn)(0xc8201225a0), releaseConn:(func(error)(0x4802c0), rowsi:(*pq.rows)(0xc820166700), closed:false, lastcols:[]driver.Value(nil), lasterr:error(nil), closeStmt:driver.Stmt(nil)}</code></p>\n\n<p>...probably not what you want.</p>\n\n<p>Those correspond to the Rows struct from the <a href=\"https://golang.org/src/database/sql/sql.go?s=44282:44598#L1733\" rel=\"nofollow\">sql package</a> (you'll notice the fields are not exported):</p>\n\n<pre><code>type Rows struct {\n    dc          *driverConn // owned; must call releaseConn when closed to release\n    releaseConn func(error)\n    rowsi       driver.Rows\n\n    closed    bool\n    lastcols  []driver.Value\n    lasterr   error       // non-nil only if closed is true\n    closeStmt driver.Stmt // if non-nil, statement to Close on close\n    }\n</code></pre>\n\n<p>You'll see  <code>[]driver.Value</code> (an interface from the driver package), that looks like where we can expect to find some useful, maybe even human readable data. But when directly printed it doesn't appear useful, it's even empty... So you have to somehow get at the underlying information. The sql package gives us the Next method to start with:</p>\n\n<blockquote>\n  <p>Next prepares the next result row for reading with the Scan method. \n  It returns true on success, or false if there is no next\n  result row or an error happened while preparing it.  Err\n  should be consulted to distinguish between the two cases.</p>\n  \n  <p>Every call to Scan, even the first one, must be preceded by a call to Next.</p>\n</blockquote>\n\n<p>Next is going to make a []driver.Value the same size as the number of columns I have, which is accessible (within the sql package) through driver.Rows (the rowsi field) and populate it with values from the query.</p>\n\n<p>After calling rows.Next() if you did the same <code>fmt.Printf(\"%#v\\n\", rows)</code>  you should now see that []diver.Value is no longer empty but it's still not going to be anything that you can read, more likely something resembling:<code>[]diver.Value{[]uint8{0x47, 0x65...</code></p>\n\n<p>And since the field isn't exported you can't even try and convert it to something more meaningful. But the sql package gives us a means to do something with the data, which is Scan.</p>\n\n<p>The Scan method is pretty concise, with lengthy comments that I won't paste here, but the really important bit is that it ranges over the columns in the current row you get from the Next method and calls <code>convertAssign(dest[i], sv)</code>, which you can see here:\n<a href=\"https://golang.org/src/database/sql/convert.go\" rel=\"nofollow\">https://golang.org/src/database/sql/convert.go</a></p>\n\n<p>It's pretty long but actually relatively simple, it essentially switches on the type of the source and destination and converts where it can, and copies from source to destination; the function comments tell us:</p>\n\n<blockquote>\n  <p>convertAssign copies to dest the value in src, converting it if possible. An error is returned if the copy would result in loss of information. dest should be a pointer type.</p>\n</blockquote>\n\n<p>So now you have a method (Scan) which you can call directly and which hands you back converted values. Your code sample above is fine (except maybe the call to Fatal() on a Scan error). </p>\n\n<p>It's important to realize that the sql package has to work with a specific driver, which is in turn implemented for specific database software, so there is quite some work going on behind the scenes.</p>\n\n<p>I think your best bet if you want to hide/generalize the whole Query() ---> Next() ---> Scan() idiom is to drop it into another function which does it behind the scenes... write a package in which you abstract away that higher level implementation, as the sql package abstracts away some of the driver-specific details, the converting and copying, populating the Rows, etc.</p>\n"}], "owner": {"reputation": 918, "user_id": 2135548, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/fM5xR.png?s=128&g=1", "display_name": "Mandar", "link": "https://stackoverflow.com/users/2135548/mandar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4345, "favorite_count": 1, "accepted_answer_id": 36722262, "answer_count": 1, "score": 2, "last_activity_date": 1461078202, "creation_date": 1461064336, "question_id": 36716699, "link": "https://stackoverflow.com/questions/36716699/is-it-possible-to-dump-golang-db-query-output-to-a-string", "title": "Is it possible to dump golang db.Query() output to a string?", "body": "<p>I have a small Heroku app in which i print out name and age from each rows after query execution.</p>\n\n<p>I want to avoid looping rows.Next(),Scan().. and just want to show what database returned after query execution which may be some data or error.</p>\n\n<p>Can we directly dump data to a string for printing? </p>\n\n<pre><code>rows, err := db.Query(\"SELECT name FROM users WHERE age = $1\", age)\n\nif err != nil {\n    log.Fatal(err)\n}\nfor rows.Next() {\n    var name string\n    if err := rows.Scan(&amp;name); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"%s is %d\\n\", name, age)\n}\nif err := rows.Err(); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}, {"tags": ["android", "google-app-engine", "go", "oauth", "google-client"], "answers": [{"comments": [{"owner": {"reputation": 633, "user_id": 1902969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/303ccdcc2f1d211ec4665f18f4bf5d39?s=128&d=identicon&r=PG", "display_name": "Ook", "link": "https://stackoverflow.com/users/1902969/ook"}, "edited": false, "score": 0, "creation_date": 1461074759, "post_id": 36717411, "comment_id": 61026470, "body": "It seems like  we need to call oauth2/v3 not /v2 and if we still need to call to that url, how would it avoid the latency and network problem?"}, {"owner": {"reputation": 436, "user_id": 1276653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a605575ce753df89612bdf316e0c714c?s=128&d=identicon&r=PG", "display_name": "AlexCV", "link": "https://stackoverflow.com/users/1276653/alexcv"}, "reply_to_user": {"reputation": 633, "user_id": 1902969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/303ccdcc2f1d211ec4665f18f4bf5d39?s=128&d=identicon&r=PG", "display_name": "Ook", "link": "https://stackoverflow.com/users/1902969/ook"}, "edited": false, "score": 0, "creation_date": 1461080043, "post_id": 36717411, "comment_id": 61030529, "body": "google-api-go-client doesn&#39;t have oauth2/v3, but v2 works well. I don&#39;t know if you can avoid the http call."}, {"owner": {"reputation": 1583, "user_id": 461712, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/2a5e0ca41228f24afb74190375cc01ff?s=128&d=identicon&r=PG", "display_name": "Etienne Marais", "link": "https://stackoverflow.com/users/461712/etienne-marais"}, "edited": false, "score": 0, "creation_date": 1598442903, "post_id": 36717411, "comment_id": 112459406, "body": "<code>oauth2.New(httpClient)</code> seems like it&#39;s marked as deprecated in favour of <code>oauth2.NewService(ctx, ClientOption)</code>"}, {"owner": {"reputation": 926, "user_id": 7589640, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71e5881c5035ff83dd9c044888b4c419?s=128&d=identicon&r=PG&f=1", "display_name": "Gooz", "link": "https://stackoverflow.com/users/7589640/gooz"}, "edited": false, "score": 2, "creation_date": 1616114884, "post_id": 36717411, "comment_id": 117909010, "body": "<a href=\"https://github.com/googleapis/google-api-go-client/issues/403#issuecomment-647806150\" rel=\"nofollow noreferrer\">This issue</a> suggests that you should actually use the <a href=\"https://github.com/googleapis/google-api-go-client/tree/master/idtoken\" rel=\"nofollow noreferrer\">idtoken</a> package instead."}], "tags": [], "owner": {"reputation": 436, "user_id": 1276653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a605575ce753df89612bdf316e0c714c?s=128&d=identicon&r=PG", "display_name": "AlexCV", "link": "https://stackoverflow.com/users/1276653/alexcv"}, "is_accepted": true, "score": 25, "last_activity_date": 1461066659, "last_edit_date": 1461066659, "creation_date": 1461066297, "answer_id": 36717411, "question_id": 36716117, "link": "https://stackoverflow.com/questions/36716117/validating-google-sign-in-id-token-in-go/36717411#36717411", "title": "Validating Google sign in ID token in Go", "body": "<p>This is how I've done it using <a href=\"https://github.com/google/google-api-go-client\" rel=\"noreferrer\">https://github.com/google/google-api-go-client</a> library:</p>\n\n<pre><code>import (\n    \"google.golang.org/api/oauth2/v2\"\n    \"net/http\"\n)\n\nvar httpClient = &amp;http.Client{}\n\nfunc verifyIdToken(idToken string) (*oauth2.Tokeninfo, error) {\n    oauth2Service, err := oauth2.New(httpClient)\n    tokenInfoCall := oauth2Service.Tokeninfo()\n    tokenInfoCall.IdToken(idToken)\n    tokenInfo, err := tokenInfoCall.Do()\n    if err != nil {\n        return nil, err\n    }\n    return tokenInfo, nil\n}\n</code></pre>\n\n<p>oauth2.Tokeninfo object has info about the user.\nNote that this makes a call to <a href=\"https://www.googleapis.com/oauth2/v2/tokeninfo\" rel=\"noreferrer\">https://www.googleapis.com/oauth2/v2/tokeninfo</a> and I think that all Google API Client Libraries make this http call under the hood.</p>\n"}, {"tags": [], "owner": {"reputation": 231, "user_id": 2930391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4428a8299472ce1879392d3b615e84fd?s=128&d=identicon&r=PG", "display_name": "Zeno Zeng", "link": "https://stackoverflow.com/users/2930391/zeno-zeng"}, "is_accepted": false, "score": 8, "last_activity_date": 1489241314, "creation_date": 1489241314, "answer_id": 42736185, "question_id": 36716117, "link": "https://stackoverflow.com/questions/36716117/validating-google-sign-in-id-token-in-go/42736185#42736185", "title": "Validating Google sign in ID token in Go", "body": "<p>Google's idToken is actually in JWT format, which is compact and self-contained JSON with signature.</p>\n\n<p>See also: <a href=\"https://jwt.io/introduction/\" rel=\"noreferrer\">https://jwt.io/introduction/</a></p>\n\n<p>google-auth-library-nodejs's OAuth2Client.prototype.verifyIdToken verify the idtoken using Google's public key and extract ClaimSet from the idtoken without calling the tokeninfo endpoint. </p>\n\n<p>I just ported the verifyIdToken function from google-auth-library-nodejs, and created a library for this: <a href=\"https://github.com/futurenda/google-auth-id-token-verifier\" rel=\"noreferrer\">https://github.com/futurenda/google-auth-id-token-verifier</a>.</p>\n\n<p>Usage:</p>\n\n<pre><code>import (\n     \"github.com/futurenda/google-auth-id-token-verifier\"\n)\n\nv := googleAuthIDTokenVerifier.Verifier{}\naud := \"xxxxxx-yyyyyyy.apps.googleusercontent.com\"\nerr := v.VerifyIDToken(TOKEN, []string{\n    aud,\n})\nif err == nil {\n    claimSet, err := googleAuthIDTokenVerifier.Decode(TOKEN)\n    // claimSet.Iss,claimSet.Email ... (See claimset.go)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 311, "user_id": 3315934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e372beba07029914e8a5ee18510eb011?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/3315934/anton"}, "edited": false, "score": 1, "creation_date": 1610213103, "post_id": 62984078, "comment_id": 116063699, "body": "Before creating NewValidator, it expects that GOOGLE_APPLICATION_CREDENTIALS env variable is set to the json file downloaded from the console. Otherwise, idtoken.NewValidator fails as it expects some credentials.  I can&#39;t get it to work with idtoken.Validate. I get this error: Get &quot;<a href=\"https://www.googleapis.com/oauth2/v3/certs\" rel=\"nofollow noreferrer\">googleapis.com/oauth2/v3/certs</a>&quot;: private key should be a PEM or plain PKCS1 or PKCS8; parse error: asn1: syntax error: sequence truncated. Any idea?"}], "tags": [], "owner": {"reputation": 990, "user_id": 2678741, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-iNrXywpt3Vk/AAAAAAAAAAI/AAAAAAAAABA/rKiRLAi5xLA/photo.jpg?sz=128", "display_name": "Guy", "link": "https://stackoverflow.com/users/2678741/guy"}, "is_accepted": false, "score": 2, "last_activity_date": 1595182889, "creation_date": 1595182889, "answer_id": 62984078, "question_id": 36716117, "link": "https://stackoverflow.com/questions/36716117/validating-google-sign-in-id-token-in-go/62984078#62984078", "title": "Validating Google sign in ID token in Go", "body": "<pre><code>import (\n    &quot;google.golang.org/api/idtoken&quot;\n)\n\nvar token string           // this comes from your web or mobile app maybe\nconst googleClientId = &quot;&quot;  // from credentials in the Google dev console\n\ntokenValidator, err := idtoken.NewValidator(context.Background())\nif err != nil {\n    // handle error, stop execution\n}\n\npayload, err := tokenValidator.Validate(context.Background(), token, googleClientId)\nif err != nil {\n    // handle error, stop execution\n}\n\nemail := payload.Claims[&quot;email&quot;]\nname  := payload.Claims[&quot;name&quot;]\n// and so on...\n</code></pre>\n<p>You may need to provide your Google credentials to your application:\n<a href=\"https://cloud.google.com/docs/authentication/production\" rel=\"nofollow noreferrer\">https://cloud.google.com/docs/authentication/production</a></p>\n"}, {"tags": [], "owner": {"reputation": 908, "user_id": 8084731, "user_type": "registered", "profile_image": "https://graph.facebook.com/1653815704646436/picture?type=large", "display_name": "princebillyGK", "link": "https://stackoverflow.com/users/8084731/princebillygk"}, "is_accepted": false, "score": 0, "last_activity_date": 1618509440, "last_edit_date": 1618509440, "creation_date": 1618506902, "answer_id": 67113050, "question_id": 36716117, "link": "https://stackoverflow.com/questions/36716117/validating-google-sign-in-id-token-in-go/67113050#67113050", "title": "Validating Google sign in ID token in Go", "body": "<p>It's very easy and has a one-liner solution. Just use the Official library:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>go get google.golang.org/api/idtoken&quot;\n</code></pre>\n<p>and then write this code:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>payload, err := idtoken.Validate(context.Background(), request.IdToken, &quot;your id token&quot;)\nif err != nil {\n    panic(err)\n}\nfmt.Print(payload.Claims)\n</code></pre>\n<p>Then you will get this output:</p>\n<pre><code>map[\n    aud:&lt;Your web application client id&gt;\n    azp:&lt;Your android application client id&gt;\n    email:&lt;Authenticated user email&gt; \n    email_verified:true\n    exp:&lt;expire at&gt;\n    family_name:&lt;Authenticated user lastname&gt;\n    given_name:&lt;Authenticated user firstname&gt;\n    iat:&lt;issued at&gt;\n    iss: &lt;accounts.google.com or https://accounts.google.com&gt;\n    locale:en\n    name:&lt;Authenticated User fullname&gt;\n    picture:&lt;Authenticated User Photo URL&gt;\n    sub: &lt;Google Account ID [Use this to identify a id uniquely]&gt;\n]\n\n</code></pre>\n"}], "owner": {"reputation": 633, "user_id": 1902969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/303ccdcc2f1d211ec4665f18f4bf5d39?s=128&d=identicon&r=PG", "display_name": "Ook", "link": "https://stackoverflow.com/users/1902969/ook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12805, "favorite_count": 4, "accepted_answer_id": 36717411, "answer_count": 4, "score": 9, "last_activity_date": 1618509440, "creation_date": 1461062820, "last_edit_date": 1461064092, "question_id": 36716117, "link": "https://stackoverflow.com/questions/36716117/validating-google-sign-in-id-token-in-go", "title": "Validating Google sign in ID token in Go", "body": "<p>I am finding the way to validate ID token for Google sign-in for Android with a Go backend server project. </p>\n\n<p>What is the equivalent function for validating ID tokens by using a Google API Client Library in Go?</p>\n\n<p>From this page on <em>Using a Google API Client Library</em> section</p>\n\n<p><a href=\"https://developers.google.com/identity/sign-in/android/backend-auth#using-a-google-api-client-library\" rel=\"noreferrer\">https://developers.google.com/identity/sign-in/android/backend-auth#using-a-google-api-client-library</a></p>\n\n<p>There are Java and Python examples and there are links for verify ID tokens with the Google API Client Library for PHP, Node.js, and other languages. I checked for my target language; Go here</p>\n\n<p><a href=\"https://github.com/google/google-api-go-client/blob/master/GettingStarted.md\" rel=\"noreferrer\">https://github.com/google/google-api-go-client/blob/master/GettingStarted.md</a></p>\n\n<p>However, I found not equivalent function for validating token like in Java and Python example. Is there any function in Go for doing such thing?</p>\n\n<p>I don't want to use token info endpoint</p>\n\n<p><a href=\"https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=XYZ123\" rel=\"noreferrer\">https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=XYZ123</a></p>\n\n<p>since it introduces possible latency and network error. I wish to use Google API Client Library. Please guide me where should I look into.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1461056326, "post_id": 36713248, "comment_id": 61013012, "body": "why not return an error and make the walk stop? you can return <code>io.EOF</code> to make sure there was no other error."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1461056748, "post_id": 36713248, "comment_id": 61013353, "body": "expanding as an answer..."}], "answers": [{"comments": [{"owner": {"reputation": 11590, "user_id": 774395, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/468lE.jpg?s=128&g=1", "display_name": "EngineerBetter_DJ", "link": "https://stackoverflow.com/users/774395/engineerbetter-dj"}, "edited": false, "score": 2, "creation_date": 1461057793, "post_id": 36713726, "comment_id": 61014075, "body": "Thanks for answering. I discovered <code>filepath.SkipDir()</code> after posting, which the docs mention. Do you know if there&#39;s any difference between returning <code>io.EOF</code> and <code>SkipDir()</code>?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 11590, "user_id": 774395, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/468lE.jpg?s=128&g=1", "display_name": "EngineerBetter_DJ", "link": "https://stackoverflow.com/users/774395/engineerbetter-dj"}, "edited": false, "score": 2, "creation_date": 1461059089, "post_id": 36713726, "comment_id": 61015014, "body": "SkipDir() will not stop the walk, but will jump to the next directory. If it&#39;s not a recursive walk the effect will be the same, but I think it&#39;s better to return another error. from TFM: <code>If an error is returned, processing stops. The sole exception is when the function returns the special value SkipDir. If the function returns SkipDir when invoked on a directory, Walk skips the directory&#39;s contents entirely. If the function returns SkipDir when invoked on a non-directory file, Walk skips the remaining files in the containing directory</code>"}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 12, "last_activity_date": 1461056838, "creation_date": 1461056838, "answer_id": 36713726, "question_id": 36713248, "link": "https://stackoverflow.com/questions/36713248/how-to-terminate-early-in-golang-walk/36713726#36713726", "title": "How to terminate early in Golang Walk?", "body": "<p>You should return an error from your walkfunc. To make sure no real error has been returned, you can just use a known error, like <code>io.EOF</code>.</p>\n\n<pre><code>func Find(needle string, haystack string) (result string, err error) {\n\n    err = filepath.Walk(haystack, \n      filepath.WalkFunc(func(path string, fi os.FileInfo, errIn error) error {\n        fmt.Println(path)\n\n        if fi.Name() == needle {\n            fmt.Println(\"Found \" + path)\n            result = path\n            return io.EOF\n        }\n\n        return nil\n    }))\n\n    if err == io.EOF {\n        err = nil\n    }\n\n    return\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1611014623, "last_edit_date": 1611014623, "creation_date": 1611002120, "answer_id": 65781707, "question_id": 36713248, "link": "https://stackoverflow.com/questions/36713248/how-to-terminate-early-in-golang-walk/65781707#65781707", "title": "How to terminate early in Golang Walk?", "body": "<p>You can use <a href=\"//golang.org/pkg/errors#New\" rel=\"nofollow noreferrer\">errors.New</a> to define your own error:</p>\n<pre><code>import (\n   &quot;errors&quot;\n   &quot;os&quot;\n   &quot;path/filepath&quot;\n)\n\nvar stopWalk = errors.New(&quot;stop walking&quot;)\n\nfunc find(name, root string) (string, error) {\n   var spath string\n   e := filepath.Walk(root, func (path string, info os.FileInfo, e error) error {\n      if info.Name() == name {\n         spath = path\n         return stopWalk\n      }\n      return e\n   })\n   if e == stopWalk {\n      return spath, nil\n   }\n   return &quot;&quot;, e\n}\n</code></pre>\n<p>Or you can use <a href=\"//golang.org/pkg/path/filepath#Glob\" rel=\"nofollow noreferrer\">filepath.Glob</a>:</p>\n<pre><code>import &quot;path/filepath&quot;\n\nfunc find(pattern string) (string, error) {\n   paths, e := filepath.Glob(pattern)\n   if len(paths) == 0 {\n      return &quot;&quot;, e\n   }\n   return paths[0], nil\n}\n</code></pre>\n"}], "owner": {"reputation": 11590, "user_id": 774395, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/468lE.jpg?s=128&g=1", "display_name": "EngineerBetter_DJ", "link": "https://stackoverflow.com/users/774395/engineerbetter-dj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2798, "favorite_count": 0, "accepted_answer_id": 36713726, "answer_count": 2, "score": 8, "last_activity_date": 1611014623, "creation_date": 1461055724, "question_id": 36713248, "link": "https://stackoverflow.com/questions/36713248/how-to-terminate-early-in-golang-walk", "title": "How to terminate early in Golang Walk?", "body": "<p>What's the idiomatic way, if possible, of having Go's <code>filepath.Walk</code> return early?</p>\n\n<p>I'm writing a function to find a nested directory of a given name. Using <code>filepath.Walk</code> I can't see a way of terminating the tree-walking as soon as I find the first match.</p>\n\n<pre><code>func (*RecursiveFinder) Find(needle string, haystack string) (result string, err error) {\n    filepath.Walk(haystack, func(path string, fi os.FileInfo, errIn error) (errOut error) {\n        fmt.Println(path)\n\n        if fi.Name() == needle {\n            fmt.Println(\"Found \" + path)\n            result = path\n            return nil\n        }\n\n        return\n    })\n\n    return\n}\n</code></pre>\n"}, {"tags": ["mysql", "go", "slice", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "edited": false, "score": 0, "creation_date": 1461082172, "post_id": 36714856, "comment_id": 61032056, "body": "This is exactly the workaround that I already did (many thanks), however I thought that I may be doing something wrong given that the library shows quite clearly that it allows you to do <code>NOT IN (?)</code>."}, {"owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "edited": false, "score": 0, "creation_date": 1461082552, "post_id": 36714856, "comment_id": 61032319, "body": "Also, see their tests: <a href=\"https://github.com/jinzhu/gorm/blob/021d7b33143de37b743d1cf660974e9c8d3f80ea/main_test.go#L481\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm/blob/&hellip;</a> and <a href=\"https://github.com/jinzhu/gorm/blob/021d7b33143de37b743d1cf660974e9c8d3f80ea/main_test.go#L449\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm/blob/&hellip;</a> as example usage"}, {"owner": {"reputation": 1017, "user_id": 2601733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AFDjZ.jpg?s=128&g=1", "display_name": "Andy Xu", "link": "https://stackoverflow.com/users/2601733/andy-xu"}, "reply_to_user": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "edited": false, "score": 0, "creation_date": 1461085913, "post_id": 36714856, "comment_id": 61034344, "body": "@Gravy Aha, I see. Are you sure that you are importing the library correctly? It seems to me that you are using the Go&#39;s official sql library but not the <code>gorm</code> one, they have the same method but different implementation."}, {"owner": {"reputation": 1017, "user_id": 2601733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AFDjZ.jpg?s=128&g=1", "display_name": "Andy Xu", "link": "https://stackoverflow.com/users/2601733/andy-xu"}, "reply_to_user": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "edited": false, "score": 0, "creation_date": 1461086219, "post_id": 36714856, "comment_id": 61034486, "body": "In <code>gorm</code>&#39;s source code (<a href=\"https://github.com/jinzhu/gorm/blob/5174cc5c242a728b435ea2be8a2f7f998e15429b/scope.go#L501\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm/blob/&hellip;</a>), they have different implementation of the <code>db.Exec</code> method, which it didn&#39;t use prepare functionality to pre-analyze query on the database side, but it concatenates arguments in the code."}, {"owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "edited": false, "score": 0, "creation_date": 1461135490, "post_id": 36714856, "comment_id": 61054802, "body": "Problem solved. Was me being silly - I had an extra parameter in my actual code than I should have. Just didnt translate it for stack overflow correctly. My bad. Thanks for your help."}], "tags": [], "owner": {"reputation": 1017, "user_id": 2601733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AFDjZ.jpg?s=128&g=1", "display_name": "Andy Xu", "link": "https://stackoverflow.com/users/2601733/andy-xu"}, "is_accepted": false, "score": 1, "last_activity_date": 1461086606, "last_edit_date": 1495541770, "creation_date": 1461059568, "answer_id": 36714856, "question_id": 36711086, "link": "https://stackoverflow.com/questions/36711086/how-to-use-where-in-with-slice-of-ints/36714856#36714856", "title": "How to use `where in` with slice of ints", "body": "<p>The natural of <code>prepare</code> functionality prevents you from passing a slice as an argument.</p>\n\n<p>The implementation of <code>db.Exec</code> in Go is to first <code>prepare</code> the query (including the variable placeholders) and then send the arguments.</p>\n\n<p>If you wonder why <code>prepare</code> prevents you from passing a slice, read <a href=\"https://stackoverflow.com/a/20663243/2601733\">this answer</a>.</p>\n\n<p>As a workaround, the same amount of placeholders as the size of your slice need to be concatenated in your program, which should be generating a query like this:</p>\n\n<pre><code>... WHERE supplier_id = ? AND sku NOT IN (?, ?, ?, ?)\n</code></pre>\n\n<p>Example code:</p>\n\n<pre><code>Ids := []int{1, 2, 3}\nquery := \"... WHERE supplier_id = ? AND sku NOT IN (\" + genVar(len(Ids)) + \")\"\ndb.Exec(query, 3, Ids)\n</code></pre>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>It turns <code>Gorm</code>'s implementation of <code>db.Exec</code> method is not using prepare functionality from DBMS, but it concatenate strings in the driver. </p>\n\n<p>My diagnosis now is that there might be something wrong in the dependencies.</p>\n\n<p>Are you importing <code>Gorm</code> like it shows in <a href=\"http://jinzhu.me/gorm/\" rel=\"nofollow noreferrer\">http://jinzhu.me/gorm/</a> ?</p>\n"}], "owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10134, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1608032780, "creation_date": 1461050033, "last_edit_date": 1608032780, "question_id": 36711086, "link": "https://stackoverflow.com/questions/36711086/how-to-use-where-in-with-slice-of-ints", "title": "How to use `where in` with slice of ints", "body": "<p>From <a href=\"http://jinzhu.me/gorm/advanced.html#sql-builder\" rel=\"nofollow\">http://jinzhu.me/gorm/advanced.html#sql-builder</a>, I should be able to update multiple rows using WHERE IN with a single <code>(?)</code> and passing a slice to the single <code>?</code> as opposed to <code>WHERE IN (?,?,?,?)</code>. </p>\n\n<p>Example from jinzhu.me as follows: <code>db.Exec(\"UPDATE orders SET shipped_at=? WHERE id IN (?)\", time.Now, []int64{11,22,33})</code>. Here is an example of gorm's tests showing it working. <a href=\"https://github.com/jinzhu/gorm/blob/021d7b33143de37b743d1cf660974e9c8d3f80ea/main_test.go#L449\" rel=\"nofollow\">https://github.com/jinzhu/gorm/blob/021d7b33143de37b743d1cf660974e9c8d3f80ea/main_test.go#L449</a></p>\n\n<p>This doesnt work for me however: </p>\n\n<pre><code>var availableIds []int\nfor _, p := range v.Products {\n    availableIds = append(availableIds, p.Id)\n}\n\nlog.Println(availableIds)\n\ndb.Exec(\"UPDATE product_supplier SET deleted_at=? WHERE supplier_id = ? AND sku NOT IN (?)\", time.Now(), 3, availableIds)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2016/04/19 07:48:44 [336 338 337 306 329 94 79 43 57 313 108 122 126 127 124 125 123 221 93 330 335 333 312]\n\n(sql: expected 2 arguments, got 25)\n</code></pre>\n\n<p>When I try hardcoding, I get the same issue:</p>\n\n<pre><code>db.Exec(\"UPDATE product_supplier SET deleted_at=? WHERE supplier_id = ? AND sku NOT IN (?)\", time.Now(), 3, []int{313, 108})\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>(sql: expected 2 arguments, got 4)\n</code></pre>\n\n<p><strong>Solution:</strong></p>\n\n<p>The code is not actually bugged at all. Was me being silly - I had an extra parameter in my actual code than I should have. I just didn't translate it for stack overflow correctly. My bad.</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 787, "user_id": 1257949, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/e69a372431fc6de4d70d10760f28968e?s=128&d=identicon&r=PG", "display_name": "rahules", "link": "https://stackoverflow.com/users/1257949/rahules"}, "is_accepted": true, "score": 2, "last_activity_date": 1461578193, "creation_date": 1461578193, "answer_id": 36837308, "question_id": 36710562, "link": "https://stackoverflow.com/questions/36710562/rendering-template-in-golang/36837308#36837308", "title": "Rendering template in golang", "body": "<p>Managed to solve this. This page <a href=\"https://elithrar.github.io/article/approximating-html-template-inheritance/\" rel=\"nofollow\">https://elithrar.github.io/article/approximating-html-template-inheritance/</a> helped.\nBasically, I had to change the code with which I parsed the templates to:</p>\n\n<pre><code>tpls, err := filepath.Glob(\"views/user/*\")\nif err != nil {\n    log.Fatal(err)\n}\n\nlayouts, err := filepath.Glob(\"views/layouts/*\")\nif err != nil {\n    log.Fatal(err)\n}\n\nfor _, layout := range layouts {\n    files := append(layouts, tpls)\n    t.templates = template.Must(template.ParseFiles(files...))\n}\n</code></pre>\n"}], "owner": {"reputation": 787, "user_id": 1257949, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/e69a372431fc6de4d70d10760f28968e?s=128&d=identicon&r=PG", "display_name": "rahules", "link": "https://stackoverflow.com/users/1257949/rahules"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1921, "favorite_count": 0, "accepted_answer_id": 36837308, "answer_count": 1, "score": 0, "last_activity_date": 1461578193, "creation_date": 1461048531, "question_id": 36710562, "link": "https://stackoverflow.com/questions/36710562/rendering-template-in-golang", "title": "Rendering template in golang", "body": "<p>I am using the echo framework in Go to create a web app. I have a directory called <code>templates</code> inside which I have two directories <code>layouts</code> and <code>users</code>. The directory tree is as follows:</p>\n\n<pre><code>layouts\n|--------default.tmpl\n|--------footer.tmpl\n|--------header.tmpl\n|--------sidebar.tmpl\n\nusers\n|--------index.tmpl\n</code></pre>\n\n<p>The code for header, footer, and sidebar are similar with:</p>\n\n<pre><code>{{define \"header\"}}\n&lt;!-- some html here --&gt;\n{{ end }} \n....\n</code></pre>\n\n<p><code>default.tmpl</code> is as follows:</p>\n\n<pre><code>{{ define \"default\" }}\n{{ template \"header\" }}\n\n{{ template \"sidebar\" }}\n\n&lt;div class=\"content-wrapper\"&gt;\n    &lt;div class=\"container-fluid\"&gt;\n\n        &lt;div class=\"row\"&gt;\n            &lt;div class=\"col-md-12\"&gt;\n                &lt;h2 class=\"page-title\"&gt;Dashboard&lt;/h2&gt;\n                {{ template \"content\" .}}\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n\n{{ template \"footer\" }}\n{{ end }}\n</code></pre>\n\n<p>And <code>users\\index.tmpl</code></p>\n\n<pre><code>{{define \"index\"}}\n    {{template \"default\"}}\n{{end}}\n\n{{define \"content\"}}\n&lt;p&gt;Hello world&lt;/p&gt;\n{{end}}\n</code></pre>\n\n<p>Now, I parse the files using</p>\n\n<pre><code>t := &amp;Template{}\nt.templates = template.Must(template.ParseGlob(\"views/layouts/*\"))\nt.templates = template.Must(template.ParseGlob(\"views/user/*\"))\n</code></pre>\n\n<p>And try to render it </p>\n\n<pre><code>func User(c echo.Context) error {\n    return c.Render(http.StatusOK, \"index\", nil)\n}\n</code></pre>\n\n<p>But I only get an internal server error. I don't know how to debug the templates either. The code works if the <code>users\\index.tmpl</code> does not contain other template tags inside it. But when I try to include the main template in it, the error returns. What am I doing wrong here?</p>\n"}, {"tags": ["oop", "go", "interface", "composition", "embedding"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1461049285, "post_id": 36710259, "comment_id": 61008428, "body": "why <code>FooLinkerEntity doesn&#39;t implement Entity</code>? seems <code>FooLinkerEntity</code> is a subtype of <code>Entity</code>"}, {"owner": {"reputation": 23513, "user_id": 1029936, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BZUZK.png?s=128&g=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/1029936/bill"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1461049750, "post_id": 36710259, "comment_id": 61008699, "body": "Enitty is an interface which FooLinkerEntity doesn&#39;t directly implement (or if it does, I end up with the ambiguity error)."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1461049966, "post_id": 36710259, "comment_id": 61008826, "body": "I know it not implement now, but I mean, as you said <code>All entities implement this(Entity ) interface</code>, why not make it implement <code>Entity</code> interface? or could you post a complete code to make thinning clearer."}, {"owner": {"reputation": 23513, "user_id": 1029936, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BZUZK.png?s=128&g=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/1029936/bill"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1461050153, "post_id": 36710259, "comment_id": 61008932, "body": "That&#39;s the whole problem.  Take a look at the Baz struct above.  If I have FooLinkerEntity and BarLinkerEntity implement the Entity interface I can no longer embed them into other entities without creating an ambiguity issue.  FooLinkerEntity will never be used on its own, I&#39;m just using it to encapsulate functionality that can be embedded in other entities."}], "answers": [{"comments": [{"owner": {"reputation": 23513, "user_id": 1029936, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BZUZK.png?s=128&g=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/1029936/bill"}, "edited": false, "score": 0, "creation_date": 1461052355, "post_id": 36711554, "comment_id": 61010391, "body": "This is the ugly part <code>x := FooBarEntityImpl{e, FooImpl{e}, BarImpl{e}}</code> that I&#39;m trying to get around.  I only want FooBarEntityImpl to have one id, not three different ones that all need to be initialized.  Composition doesn&#39;t seem to work if the combosable parts depend on shared properties."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 23513, "user_id": 1029936, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BZUZK.png?s=128&g=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/1029936/bill"}, "edited": false, "score": 0, "creation_date": 1461052556, "post_id": 36711554, "comment_id": 61010512, "body": "@Bill The ugly part isn&#39;t that ugly: <code>FooBarEntityImpl</code> only has <b>one</b> id which is in <code>e</code>. Initialization just passes the <b>same</b> <code>e</code> to all the implementations that need / use an <code>Entity</code>: <i>reference</i>, not duplication / copy. And this you cannot avoid as there is no inheritance."}, {"owner": {"reputation": 23513, "user_id": 1029936, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BZUZK.png?s=128&g=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/1029936/bill"}, "edited": false, "score": 0, "creation_date": 1461053311, "post_id": 36711554, "comment_id": 61011004, "body": "It unfortunately makes it so that you need to know the internals of FooBarEntityImpl in order to do serialization since you need to initialize the  compositions.  I really just want access to the parent entity which isn&#39;t possible.So I guess I need to do a hundred cut and pastes so that each entity implements SayFoo and SayBar directly instead of trying to use composition.  This way they will have access to Id() since the parent element correctly implements it."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 23513, "user_id": 1029936, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BZUZK.png?s=128&g=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/1029936/bill"}, "edited": false, "score": 0, "creation_date": 1461053543, "post_id": 36711554, "comment_id": 61011133, "body": "@Bill Please see edited answer about <code>FooBarEntity</code> creation. Also: <i>&quot;I ... want to access to the parent entity&quot;</i> - there is no inheritance (and therefore no parent) in Go, try to think differently."}, {"owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "reply_to_user": {"reputation": 23513, "user_id": 1029936, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BZUZK.png?s=128&g=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/1029936/bill"}, "edited": false, "score": 0, "creation_date": 1461111715, "post_id": 36711554, "comment_id": 61047090, "body": "@Bill Another way to avoid all this inheritance and composition, is to have a function that takes any number of parameters in this case the <code>Entity</code> interfaces and returns a serialized string by calling respective interface methods. This avoids the relationships and also gives a little more clarity. If the pure intention is serializing, composition and inheritance relationships seems to be an overkill (regardless whether its Go or something like Java with inheritance)."}, {"owner": {"reputation": 3381, "user_id": 4479004, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/56fWH.png?s=128&g=1", "display_name": "xdevs23", "link": "https://stackoverflow.com/users/4479004/xdevs23"}, "edited": false, "score": 0, "creation_date": 1517168653, "post_id": 36711554, "comment_id": 83974127, "body": "Wow you helped me understand how it works... It&#39;s really unclear for a Go beginner to know what&#39;s going on if you don&#39;t know how to use it."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1519388710, "last_edit_date": 1519388710, "creation_date": 1461051285, "answer_id": 36711554, "question_id": 36710259, "link": "https://stackoverflow.com/questions/36710259/ensuring-embedded-structs-implement-interface-without-introducing-ambiguity/36711554#36711554", "title": "Ensuring embedded structs implement interface without introducing ambiguity", "body": "<p>Go is <a href=\"http://golang.org/doc/faq#Is_Go_an_object-oriented_language\" rel=\"nofollow noreferrer\">not (quite) an object oriented language</a>: it does not have classes and it <a href=\"http://golang.org/doc/faq#inheritance\" rel=\"nofollow noreferrer\">does not have type inheritance</a>; but it supports a similar construct called <em>embedding</em> both on <code>struct</code> level and on <code>interface</code> level, and it does have <a href=\"http://golang.org/ref/spec#Method_declarations\" rel=\"nofollow noreferrer\">methods</a>.</p>\n\n<p>So you should stop thinking in OOP and start thinking in <em>composition</em>. Since you said in your comments that <code>FooLinkerEntity</code> will never be used on its own, that helps us achieve what you want in a clean way.</p>\n\n<p>I will use new names and less functionality to concentrate on the problem and solution, which results in shorter code and which is also easier to understand.</p>\n\n<p>The full code can be viewed and tested on the <a href=\"http://play.golang.org/p/1EsNuTfstU\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h3>Entity</h3>\n\n<p>The simple <code>Entity</code> and its implementation will look like this:</p>\n\n<pre><code>type Entity interface {\n    Id() int\n}\n\ntype EntityImpl struct{ id int }\n\nfunc (e *EntityImpl) Id() int { return e.id }\n</code></pre>\n\n<h3>Foo and Bar</h3>\n\n<p>In your example <code>FooLinkerEntity</code> and <code>BarLinkerEntity</code> are just <em>decorators</em>, so they don't need to embed (<em>extend</em> in OOP) <code>Entity</code>, and their implementations don't need to embed <code>EntityImpl</code>. However, since we want to use the <code>Entity.Id()</code> method, we need an <code>Entity</code> value, which may or may not be <code>EntityImpl</code>, but let's not restrict their implementation. Also we may choose to embed it or make it a \"regular\" struct field, it doesn't matter (both works):</p>\n\n<pre><code>type Foo interface {\n    SayFoo()\n}\n\ntype FooImpl struct {\n    Entity\n}\n\nfunc (f *FooImpl) SayFoo() { fmt.Println(\"Foo\", f.Id()) }\n\ntype Bar interface {\n    SayBar()\n}\n\ntype BarImpl struct {\n    Entity\n}\n\nfunc (b *BarImpl) SayBar() { fmt.Println(\"Bar\", b.Id()) }\n</code></pre>\n\n<p>Using <code>Foo</code> and <code>Bar</code>:</p>\n\n<pre><code>f := FooImpl{&amp;EntityImpl{1}}\nf.SayFoo()\nb := BarImpl{&amp;EntityImpl{2}}\nb.SayBar()\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Foo 1\nBar 2\n</code></pre>\n\n<h3>FooBarEntity</h3>\n\n<p>Now let's see a \"real\" entity which is an <code>Entity</code> (implements <code>Entity</code>) and has both the features provided by <code>Foo</code> and <code>Bar</code>:</p>\n\n<pre><code>type FooBarEntity interface {\n    Entity\n    Foo\n    Bar\n    SayFooBar()\n}\n\ntype FooBarEntityImpl struct {\n    *EntityImpl\n    FooImpl\n    BarImpl\n}\n\nfunc (x *FooBarEntityImpl) SayFooBar() {\n    fmt.Println(\"FooBar\", x.Id(), x.FooImpl.Id(), x.BarImpl.Id())\n}\n</code></pre>\n\n<p>Using <code>FooBarEntity</code>:</p>\n\n<pre><code>e := &amp;EntityImpl{3}\nx := FooBarEntityImpl{e, FooImpl{e}, BarImpl{e}}\nx.SayFoo()\nx.SayBar()\nx.SayFooBar()\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Foo 3\nBar 3\nFooBar 3 3 3\n</code></pre>\n\n<h3>FooBarEntity round #2</h3>\n\n<p>If the <code>FooBarEntityImpl</code> does not need to know (does not use) the internals of the <code>Entity</code>, <code>Foo</code> and <code>Bar</code> implementations (<code>EntityImpl</code>, <code>FooImpl</code> and <code>BarImpl</code> in our cases), we may choose to embed only the interfaces and not the implementations (but in this case we can't call <code>x.FooImpl.Id()</code> because <code>Foo</code> does not implement <code>Entity</code> - that is an implementation detail which was our initial statement that we don't need / use it):</p>\n\n<pre><code>type FooBarEntityImpl struct {\n    Entity\n    Foo\n    Bar\n}\n\nfunc (x *FooBarEntityImpl) SayFooBar() { fmt.Println(\"FooBar\", x.Id()) }\n</code></pre>\n\n<p>Its usage is the same:</p>\n\n<pre><code>e := &amp;EntityImpl{3}\nx := FooBarEntityImpl{e, &amp;FooImpl{e}, &amp;BarImpl{e}}\nx.SayFoo()\nx.SayBar()\nx.SayFooBar()\n</code></pre>\n\n<p>Its output:</p>\n\n<pre><code>Foo 3\nBar 3\nFooBar 3\n</code></pre>\n\n<p>Try this variant on the <a href=\"http://play.golang.org/p/vtiQb6TOrP\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h3>FooBarEntity creation</h3>\n\n<p>Note that when creating <code>FooBarEntityImpl</code>, a value of <code>Entity</code> is to be used in multiple composite literals. Since we created only one <code>Entity</code> (<code>EntityImpl</code>) and we used this in all places, there is only <strong>one</strong> id used in different implementation classes, only a \"reference\" is passed to each structs, not a duplicate / copy. This is also the intended / required usage.</p>\n\n<p>Since <code>FooBarEntityImpl</code> creation is non-trivial and error-prone, it is recommended to create a constructor-like function:</p>\n\n<pre><code>func NewFooBarEntity(id int) FooBarEntity {\n    e := &amp;EntityImpl{id}\n    return &amp;FooBarEntityImpl{e, &amp;FooImpl{e}, &amp;BarImpl{e}}\n}\n</code></pre>\n\n<p>Note that the factory function <code>NewFooBarEntity()</code> returns a value of interface type and not the implementation type (good practice to be followed).</p>\n\n<p>It is also a good practice to make the implementation types un-exported, and only export the interfaces, so implementation names would be <code>entityImpl</code>, <code>fooImpl</code>, <code>barImpl</code>, <code>fooBarEntityImpl</code>.</p>\n\n<hr>\n\n<p><strong>Some related questions worth checking out</strong></p>\n\n<p><a href=\"https://stackoverflow.com/questions/29144622/what-is-the-idiomatic-way-in-go-to-create-a-complex-hierarchy-of-structs\">What is the idiomatic way in Go to create a complex hierarchy of structs?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/21251242/is-it-possible-to-call-overridden-method-from-parent-struct-in-golang\">is it possible to call overridden method from parent struct in golang?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/30622605/can-embedded-struct-method-have-knowledge-of-parent-child\">Can embedded struct method have knowledge of parent/child?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/29390736/go-embedded-struct-call-child-method-instead-parent-method\">Go embedded struct call child method instead parent method</a></p>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1461071146, "creation_date": 1461071146, "answer_id": 36719351, "question_id": 36710259, "link": "https://stackoverflow.com/questions/36710259/ensuring-embedded-structs-implement-interface-without-introducing-ambiguity/36719351#36719351", "title": "Ensuring embedded structs implement interface without introducing ambiguity", "body": "<p>Seems to me having three ID in one structure with methods relying on them is even semantically incorrect. To not be ambiguous you should write some more code to my mind. For example something like this</p>\n\n<pre><code>type Baz struct {\n    EntityModel\n    Foo []*Foo\n    Bar []*Bar\n}\nfunc (b Baz) LinkFoo() {\n    (&amp;FooLinkerEntity{b.EntityModel, b.Foo}).LinkFoo()\n}\nfunc (b Baz) LinkBar() {\n    (&amp;BarLinkerEntity{b.EntityModel, b.Bar}).LinkBar()\n}\n</code></pre>\n"}], "owner": {"reputation": 23513, "user_id": 1029936, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BZUZK.png?s=128&g=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/1029936/bill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2210, "favorite_count": 4, "answer_count": 2, "score": 2, "last_activity_date": 1537518445, "creation_date": 1461047443, "last_edit_date": 1537518445, "question_id": 36710259, "link": "https://stackoverflow.com/questions/36710259/ensuring-embedded-structs-implement-interface-without-introducing-ambiguity", "title": "Ensuring embedded structs implement interface without introducing ambiguity", "body": "<p>I'm trying to clean up my code base by doing a better job defining interfaces and using embedded structs to reuse functionality.  In my case I have many entity types that can be linked to various objects. I want to define interfaces that capture the requirements and structs that implement the interfaces which can then be embedded into the entities.</p>\n\n<pre><code>// All entities implement this interface\ntype Entity interface {\n  Identifier()\n  Type()\n}\n\n// Interface for entities that can link Foos\ntype FooLinker interface {\n  LinkFoo()\n}\n\ntype FooLinkerEntity struct {\n  Foo []*Foo\n}\n\nfunc (f *FooLinkerEntity) LinkFoo() {\n  // Issue: Need to access Identifier() and Type() here\n  // but FooLinkerEntity doesn't implement Entity\n}\n\n// Interface for entities that can link Bars\ntype BarLinker interface {\n  LinkBar()\n}\n\ntype BarLinkerEntity struct {\n  Bar []*Bar\n}\n\nfunc (b *BarLinkerEntity) LinkBar() {\n  // Issues: Need to access Identifier() and Type() here\n  // but BarLinkerEntity doesn't implement Entity\n}\n</code></pre>\n\n<p>So my first thought was to have FooLinkerEntity and BarLinkerEntity just implement the Entity interface.</p>\n\n<pre><code>// Implementation of Entity interface\ntype EntityModel struct {\n    Id string\n    Object string\n}\n\nfunc (e *EntityModel) Identifier() { return e.Id }\nfunc (e *EntityModel) Type() { return e.Type }\n\ntype FooLinkerEntity struct {\n  EntityModel\n  Foo []*Foo\n}\n\ntype BarLinkerEntity struct {\n  EntityModel\n  Bar []*Bar\n}\n</code></pre>\n\n<p>However, this ends up with an ambiguity error for any types that can link both Foos and Bars.</p>\n\n<pre><code>// Baz.Identifier() is ambiguous between EntityModel, FooLinkerEntity,\n// and BarLinkerEntity.\ntype Baz struct {\n    EntityModel\n    FooLinkerEntity\n    BarLinkerEntity\n}\n</code></pre>\n\n<p>What's the correct Go way to structure this type of code?  Do I just do a type assertion in <code>LinkFoo()</code> and <code>LinkBar()</code> to get to <code>Identifier()</code> and <code>Type()</code>? Is there any way to get this check at compile time instead of runtime?</p>\n"}, {"tags": ["go", "compression"], "comments": [{"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 2, "creation_date": 1461038363, "post_id": 36707746, "comment_id": 61004006, "body": "b.Len() will return the number of bytes after compression. len([]byte(&quot;YourDataHere&quot;)) returns the input data (uncompressed) length. Also &quot;n, err := gz.Write([]byte(&quot;YourDataHere&quot;))&quot; will set n as the number of bytes sent to gzip writer (i.e. size of input)"}], "answers": [{"comments": [{"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 1, "creation_date": 1461039706, "post_id": 36708474, "comment_id": 61004366, "body": "We should do a gz.Flush() before getting the time taken and size of output."}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 1, "last_activity_date": 1461049582, "last_edit_date": 1461049582, "creation_date": 1461039547, "answer_id": 36708474, "question_id": 36707746, "link": "https://stackoverflow.com/questions/36707746/how-to-measure-both-before-and-after-byte-size-and-time-to-compress/36708474#36708474", "title": "How to measure both before and after byte size and time to compress", "body": "<p>You can calculate the size as per Nipun Talukdar's comment.</p>\n\n<p><code>len([]byte(\"YourDataHere\"))\nb.Len()</code></p>\n\n<p>And use <code>time.Now()</code> and <code>time.Since()</code> to get the time taken.</p>\n\n<pre><code>var b bytes.Buffer\ninput := []byte(\"YourDataHere\")\n\nfmt.Println(\"Input size : \", len(input))\n\ngz := gzip.NewWriter(&amp;b)\n\n\nstart := time.Now() \n\ngz.Write(input)\nif _, err := gz.Flush(); err != nil {\n        panic(err)\n}\n\n\ntotalTime := time.Since(start) \n\nfmt.Println(\"Compressed size : \", b.Len(), \"\\nTime taken : \", totalTime)\ngz.Close()\n</code></pre>\n\n<p>Same method can be applied with unzipping. \nYou can also create a support function that can do the timing.</p>\n\n<pre><code>func timer(startTime time.Time) {\n\ntotalTime := time.Since(startTime)\nlog.Println(\"Time taken : \",totalTime)\n\n}\n</code></pre>\n\n<p>Usage : <code>defer timer(time.Now())</code> at the start of the function.</p>\n"}, {"tags": [], "owner": {"reputation": 10563, "user_id": 1104328, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/df0790774838286ad0d93567ae1fcf56?s=128&d=identicon&r=PG&f=1", "display_name": "Harry", "link": "https://stackoverflow.com/users/1104328/harry"}, "is_accepted": false, "score": 0, "last_activity_date": 1461041962, "creation_date": 1461041962, "answer_id": 36708934, "question_id": 36707746, "link": "https://stackoverflow.com/questions/36707746/how-to-measure-both-before-and-after-byte-size-and-time-to-compress/36708934#36708934", "title": "How to measure both before and after byte size and time to compress", "body": "<p>There are examples of how to do this in Go here</p>\n\n<p><a href=\"https://golang.org/test/bench/go1/gzip_test.go\" rel=\"nofollow\">https://golang.org/test/bench/go1/gzip_test.go</a></p>\n\n<p>Thankfully it's BSD licensed...</p>\n\n<pre><code>// Copyright 2011 The Go Authors.  All rights reserved.\n// Use of this source code is governed by a BSD-style\n// license that can be found in the LICENSE file.\n\n// This benchmark tests gzip and gunzip performance.\n\npackage go1 \n\nimport (\n  \"bytes\"\n  gz \"compress/gzip\"\n  \"io\"\n  \"io/ioutil\"\n  \"testing\"\n)\n\nvar (\n  jsongunz = bytes.Repeat(jsonbytes, 10) \n  jsongz   []byte\n)\n\nfunc init() {\n  var buf bytes.Buffer\n  c := gz.NewWriter(&amp;buf)\n  c.Write(jsongunz)\n  c.Close()\n  jsongz = buf.Bytes()\n}\n\nfunc gzip() {\n  c := gz.NewWriter(ioutil.Discard)\n  if _, err := c.Write(jsongunz); err != nil {\n    panic(err)\n  }\n  if err := c.Close(); err != nil {\n    panic(err)\n  }\n}\n\nfunc gunzip() {\n  r, err := gz.NewReader(bytes.NewBuffer(jsongz))\n  if err != nil {\n    panic(err)\n  }\n  if _, err := io.Copy(ioutil.Discard, r); err != nil {\n    panic(err)\n  }\n  r.Close()\n}\n\nfunc BenchmarkGzip(b *testing.B) {\n  b.SetBytes(int64(len(jsongunz)))\n  for i := 0; i &lt; b.N; i++ {\n    gzip()\n  }\n}\n\nfunc BenchmarkGunzip(b *testing.B) {\n  b.SetBytes(int64(len(jsongunz)))\n  for i := 0; i &lt; b.N; i++ {\n    gunzip()\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 668, "favorite_count": 0, "accepted_answer_id": 36708474, "answer_count": 2, "score": 1, "last_activity_date": 1461049582, "creation_date": 1461034810, "question_id": 36707746, "link": "https://stackoverflow.com/questions/36707746/how-to-measure-both-before-and-after-byte-size-and-time-to-compress", "title": "How to measure both before and after byte size and time to compress", "body": "<p>I want to gzip a string (it is actually a JSON response)</p>\n\n<pre><code>var b bytes.Buffer\ngz := gzip.NewWriter(&amp;b)\nif _, err := gz.Write([]byte(\"YourDataHere\")); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>How can I easily output the size of bytes before and after compression and more importantly how can I time it takes to compress and decompress back to a string?</p>\n"}, {"tags": ["arrays", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 4, "creation_date": 1461044389, "post_id": 36707413, "comment_id": 61006000, "body": "Worth noting that the <code>Data</code> might not point to the start of the backing array: just to the 0-th element of the slice. So, in the case <code>numSlice := nums[1:]</code> it would actually end up pointing to the second element of the Array. <a href=\"http://play.golang.org/p/8fCCz9d7rG\" rel=\"nofollow noreferrer\">Example</a>"}, {"owner": {"reputation": 1803, "user_id": 167408, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/slHOv.png?s=128&g=1", "display_name": "Highstead", "link": "https://stackoverflow.com/users/167408/highstead"}, "edited": false, "score": 1, "creation_date": 1493910989, "post_id": 36707413, "comment_id": 74614014, "body": "As a perhaps stupid question, what would the performance be on this?"}], "tags": [], "owner": {"reputation": 26843, "user_id": 208997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/250e219125d8bff1f03e6faea950f218?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/208997/simon"}, "is_accepted": true, "score": 24, "last_activity_date": 1461032501, "creation_date": 1461032501, "answer_id": 36707413, "question_id": 36706843, "link": "https://stackoverflow.com/questions/36706843/how-to-get-the-underlying-array-of-a-slice-in-go/36707413#36707413", "title": "How to get the underlying array of a slice in Go?", "body": "<p>First, if you haven't already, you should read <a href=\"https://blog.golang.org/go-slices-usage-and-internals\">this official blog post about slice internals</a>. That should clear up everything.</p>\n\n<p>Now to access the underlying array, you can use a combination of <a href=\"https://golang.org/pkg/reflect\"><code>reflect</code></a> and <a href=\"https://golang.org/pkg/unsafe\"><code>unsafe</code></a>. In particular, <a href=\"https://golang.org/pkg/reflect/#SliceHeader\"><code>reflect.SliceHeader</code></a>  contains a <code>Data</code> field which contains a pointer to the underlying array of a slice.</p>\n\n<p>Example adapted from the documentation of the <code>unsafe</code> package:</p>\n\n<pre><code>s := []int{1, 2, 3, 4}\nhdr := (*reflect.SliceHeader)(unsafe.Pointer(&amp;s))\ndata := *(*[4]int)(unsafe.Pointer(hdr.Data))\n</code></pre>\n"}], "owner": {"reputation": 1465, "user_id": 4403257, "user_type": "registered", "accept_rate": 26, "profile_image": "https://lh4.googleusercontent.com/-XSHOss9luI4/AAAAAAAAAAI/AAAAAAAAADY/iPL641wt7TQ/photo.jpg?sz=128", "display_name": "Jimmy Gong", "link": "https://stackoverflow.com/users/4403257/jimmy-gong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6046, "favorite_count": 7, "accepted_answer_id": 36707413, "answer_count": 1, "score": 19, "last_activity_date": 1461032501, "creation_date": 1461028602, "question_id": 36706843, "link": "https://stackoverflow.com/questions/36706843/how-to-get-the-underlying-array-of-a-slice-in-go", "title": "How to get the underlying array of a slice in Go?", "body": "<p>Let's say I have the following array of ints of length 3:</p>\n\n<p><code>nums := [3]int{1,2,3}</code></p>\n\n<p>Then I grab the slice of just the first two items</p>\n\n<p><code>numSlice := nums[:2]</code></p>\n\n<p>Invoking <code>cap</code> on numSlice and nums yields 3 in both cases, and <code>len</code> yields 2 and 3 respectively.</p>\n\n<p>If I then append to that slice (<code>numSlice = append(numSlice, 10)</code>), the underlying array (<code>nums</code>) is now <code>[1 2 10]</code>. <code>cap</code> remains at 3 for both, as the underlying array of the slice is the same, and len for the slice is now 3.</p>\n\n<p>However, if I append to that slice again (<code>numSlice = append(numSlice, 20)</code>), the underlying array of the slice must change - we see this is the case when <code>cap</code> now has doubled for numSlice and len is now 4. </p>\n\n<p>Sorry for the overwrought explanation, just walking myself through it, but can someone explain to me what happens under the hood to the underlying array and how to get the reference to the new array? </p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1461027369, "post_id": 36706563, "comment_id": 61001157, "body": "Wrap the table name with backticks: <code>request := &quot;CREATE TABLE `&quot; + *tablename + &quot;` (</code>  ..."}, {"owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1461034528, "post_id": 36706563, "comment_id": 61003049, "body": "Ah! Thank you! I&#39;ve been thinking I had to escape the backticks with a backslash for that to work."}], "owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1461028473, "creation_date": 1461026386, "last_edit_date": 1461028473, "question_id": 36706563, "link": "https://stackoverflow.com/questions/36706563/go-create-a-mysql-table-with-dash-in-it-edc-3islvuo", "title": "Go: create a mysql table with dash in it (&quot;EDC-3Islvuo&quot;)", "body": "<p>I'm trying to make a table with Go and the \"github.com/go-sql-driver/mysql\" driver package and want to makes tables from the IDs that are preconfigured (like <code>rte-432343</code>). It throws an error when there is a dash in the name. Is there a way around the error: <code>Error 1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '-432343'</code></p>\n\n<pre><code>request := \"CREATE TABLE \" + *tablename + \" ( dbid int(11) NOT NULL AUTO_INCREMENT, name text, PRIMARY KEY (dbid)) ENGINE=InnoDB DEFAULT CHARSET=latin1\"\n_, err := db.Exec(request)\nif err != nil {\n    fmt.Println(\"error creating database table\", *tablename, err)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1461037751, "post_id": 36706033, "comment_id": 61003853, "body": "Do you need to log the entire response? Are just the headers OK?"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user827329"}, "edited": false, "score": 0, "creation_date": 1461023313, "post_id": 36706128, "comment_id": 61000136, "body": "The problem with this approach is that it doesn&#39;t scale. I have hundreds of handler functions, so I don&#39;t want to keep doing the same thing in each. I&#39;d rather do it in a central place.."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1461023719, "post_id": 36706128, "comment_id": 61000233, "body": "@SFO You are right. I added an example of how I have resolved this issue before. Is not as good as it could be but is a start."}], "tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": false, "score": 1, "last_activity_date": 1461024809, "last_edit_date": 1461024809, "creation_date": 1461023004, "answer_id": 36706128, "question_id": 36706033, "link": "https://stackoverflow.com/questions/36706033/go-http-listenandserve-logging-response/36706128#36706128", "title": "Go HTTP ListenAndServe logging response", "body": "<p>You can't because the response technically doesn't exist until you write it to the <code>ResponseWriter</code>. </p>\n\n<p>But in the <code>response</code> is just the <code>header</code>, <code>body</code> and <code>response code</code> so in the handler function you can use method <code>Header()</code> on the <code>ResponseWriter</code> to get the header and then you can log the <code>response code</code> and the <code>body</code> before you write it to the <code>ResponseWriter</code>.</p>\n\n<p>If you provide an example of what you are trying to do, I can elaborate on how to do it.</p>\n\n<p>This is what I did to fix this for a small project:\nI use this in all my handlers:</p>\n\n<pre><code>type transaction struct {\n    res Response // Create this type also\n    req Request // Create this type also\n}\n\nfunc NewTransaction(w http.ResponseWriter, req *http.Request) *transaction{}\n\nLog := make(chan transaction, 100)\ngo func{\n    // Read from channel and log the info however you want.\n}()\n\nfunc indexHandler(w http.ResponseWriter, req *http.Request) {\n    tx := NewTransaction(w, req) // Struct with the request and response\n    defer func() {\n        Log &lt;- tx\n    }()\n\n    /*\n    Handle request here\n    */\n\n    // Update request and response\n    Request.Body = body\n}\n</code></pre>\n\n<p>And at the end of the handler function, after having served the requested data, I update the values for the request and the response.</p>\n\n<p>And have a goroutine listening to the channel Log and doing all your logging.</p>\n\n<p>Also you can write a wrapper function that serves the file and returns the response.</p>\n"}, {"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 5, "last_activity_date": 1552652916, "last_edit_date": 1552652916, "creation_date": 1461043333, "answer_id": 36709240, "question_id": 36706033, "link": "https://stackoverflow.com/questions/36706033/go-http-listenandserve-logging-response/36709240#36709240", "title": "Go HTTP ListenAndServe logging response", "body": "<p>http.ResponseWriter is an interface. You can use embedding to extend it for logging as follows.</p>\n\n<pre><code>package main\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc sampleHandler(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(http.StatusOK)\n    response := []byte(\"Sample Response\")\n    w.Write(response)\n}\n\ntype loggingResponseWriter struct {\n    status int\n    body   string\n    http.ResponseWriter\n}\n\nfunc (w *loggingResponseWriter) WriteHeader(code int) {\n    w.status = code\n    w.ResponseWriter.WriteHeader(code)\n}\n\nfunc (w *loggingResponseWriter) Write(body []byte) (int, error) {\n    w.body = string(body)\n    return w.ResponseWriter.Write(body)\n}\n\nfunc responseLogger(h http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        loggingRW := &amp;loggingResponseWriter{\n            ResponseWriter: w,\n        }\n        h.ServeHTTP(loggingRW, r)\n        log.Println(\"Status : \", loggingRW.status, \"Response : \", loggingRW.body)\n    })\n}\n\nfunc main() {\n    http.Handle(\"/\", responseLogger(http.HandlerFunc(sampleHandler)))\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>You can wrap the handler functions that you want to log responses for with responseLogger.</p>\n"}, {"comments": [{"owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "edited": false, "score": 0, "creation_date": 1575020540, "post_id": 36972908, "comment_id": 104436760, "body": "You should provide some code example, such as how a http handler would be written using <code>fasthttp</code> such that it would log the response, if you want the answer to be useful."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user827329"}, "is_accepted": false, "score": -1, "last_activity_date": 1462143331, "creation_date": 1462143331, "answer_id": 36972908, "question_id": 36706033, "link": "https://stackoverflow.com/questions/36706033/go-http-listenandserve-logging-response/36972908#36972908", "title": "Go HTTP ListenAndServe logging response", "body": "<p>As an alternative, one can use fasthttp.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user827329"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1680, "favorite_count": 0, "accepted_answer_id": 36709240, "answer_count": 3, "score": 5, "last_activity_date": 1552652916, "creation_date": 1461022350, "last_edit_date": 1461022655, "question_id": 36706033, "link": "https://stackoverflow.com/questions/36706033/go-http-listenandserve-logging-response", "title": "Go HTTP ListenAndServe logging response", "body": "<p>I was wondering if there is a way to log the responses when using ListenAndServe.</p>\n\n<p>As far as I can tell, the handler doesn't have access to a \"Response\" object. Just a ResponseWriter, so I cannot call httputil.DumpResponse.</p>\n"}, {"tags": ["go", "goroutine", "go-playground"], "answers": [{"tags": [], "owner": {"reputation": 5038, "user_id": 436754, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/40s9Q.jpg?s=128&g=1", "display_name": "Pawe\u0142 Szczur", "link": "https://stackoverflow.com/users/436754/pawe%c5%82-szczur"}, "is_accepted": false, "score": 0, "last_activity_date": 1461021189, "creation_date": 1461021189, "answer_id": 36705865, "question_id": 36705801, "link": "https://stackoverflow.com/questions/36705801/discrepancies-between-go-playground-and-go-on-my-machine/36705865#36705865", "title": "Discrepancies between Go Playground and Go on my machine?", "body": "<p>What you will see on screen is nondeterministic. Or more precisely if by any chance the <code>true</code> value you pass to channel is delayed you would see some \"Here\".</p>\n\n<p>But usually the Stdout is buffered, it means it's not printed instantaneously but the data gets accumulated and after it gets to maximum buffer size it's printed. In your case before the \"here\" is printed the main function is already finished thus the process finishes.</p>\n\n<p>The rule of thumb is: main function must be alive otherwise all other goroutines gets killed.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1474022513, "last_edit_date": 1474022513, "creation_date": 1461025862, "answer_id": 36706499, "question_id": 36705801, "link": "https://stackoverflow.com/questions/36705801/discrepancies-between-go-playground-and-go-on-my-machine/36706499#36706499", "title": "Discrepancies between Go Playground and Go on my machine?", "body": "<h3>Explanation of what you see:</h3>\n\n<p>On the Go Playground, <a href=\"https://golang.org/pkg/runtime/#GOMAXPROCS\" rel=\"nofollow\">GOMAXPROCS</a> is <code>1</code> (<a href=\"http://play.golang.org/p/GIIyXQb643\" rel=\"nofollow\">proof</a>).</p>\n\n<p>This means one goroutine is executed at a time, and if that goroutine does not block, the scheduler is not forced to switch to other goroutines.</p>\n\n<p>Your code (like every Go app) starts with a goroutine executing the <code>main()</code> function (the main goroutine). It starts another goroutine that executes the <code>other()</code> function, then it receives from the <code>done</code> channel - which blocks. So the scheduler must switch to the other goroutine (executing <code>other()</code> function).</p>\n\n<p>In your <code>other()</code> function when you send a value on the <code>done</code> channel, that makes both the current (<code>other()</code>) and the <code>main</code> goroutine runnable. The scheduler chooses to continue to run <code>other()</code>, and since <code>GOMAXPROCS=1</code>, <code>main()</code> is not continued. Now <code>other()</code> launches another goroutine executing an endless loop. The scheduler chooses to execute this goroutine which takes forever to get to a blocked state, so <code>main()</code> is not continued.</p>\n\n<p>And then the timeout of the Go Playground's sandbox comes as an absolution:</p>\n\n<blockquote>\n  <p>process took too long</p>\n</blockquote>\n\n<p>Note that the <a href=\"http://golang.org/ref/mem\" rel=\"nofollow\"><strong>Go Memory Model</strong></a> only guarantees that certain events happen before other events, you have no guarantee how 2 concurrent goroutines are executed. Which makes the output non-deterministic.</p>\n\n<p>You are not to question any execution order that does not violate the Go Memory Model. If you want the execution to reach certain points in your code (to execute certain statements), you need explicit synchronization (you need to synchronize your goroutines).</p>\n\n<p>Also note that the output on the Go Playground is cached, so if you run the app again, it won't be run again, but instead the cached output will be presented immediately. If you change anything in the code (e.g. insert a space or a comment) and then you run it again, it then will be compiled and run again. You will notice it by the increased response time. Using the current version (<a href=\"http://play.golang.org/p/1VcPUlPk_3\" rel=\"nofollow\">Go 1.6</a>) you will see the same output every time though.</p>\n\n<h3>Running locally (on your machine):</h3>\n\n<p>When you run it locally, most likely <code>GOMAXPROCS</code> will be greater than <code>1</code> as it defaults to the number of CPU cores available (since Go 1.5). So it doesn't matter if you have a goroutine executing an endless loop, another goroutine will be executed simultaneously, which will be the <code>main()</code>, and when <code>main()</code> returns, your program terminates; it does not wait for other non-<code>main</code> goroutines to complete (see <a href=\"https://golang.org/ref/spec#Program_execution\" rel=\"nofollow\">Spec: Program execution</a>).</p>\n\n<p>Also note that even if you set <code>GOMAXPROCS</code> to <code>1</code>, your app will most likely exit in a \"short\" time as the scheduler imlementation will switch to other goroutines and not just execute the endless loop forever (however, as stated above, this is non-deterministic). And when it does, it will be the <code>main()</code> goroutine, and so when <code>main()</code> finishes and returns, your app terminates.</p>\n\n<h3>Playing with your app on the Go Playground:</h3>\n\n<p>As mentioned, by default <code>GOMAXPROCS</code> is <code>1</code> on the Go Playground. However it is allowed to set it to a higher value, e.g.:</p>\n\n<pre><code>runtime.GOMAXPROCS(2)\n</code></pre>\n\n<p>Without explicit synchronization, execution still remains non-deterministic, however you will observe a different execution order and a termination without running into a timeout:</p>\n\n<pre><code>Hello, playground\nHere\nHere\nHere\n...\n&lt;Here is printed 996 times, then:&gt;\nFinished.\n</code></pre>\n\n<p>Try this variant on the <a href=\"https://play.golang.org/p/H_bRXzSnSM\" rel=\"nofollow\">Go Playground</a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3835277"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 1, "accepted_answer_id": 36706499, "answer_count": 2, "score": 2, "last_activity_date": 1474022513, "creation_date": 1461020773, "last_edit_date": 1461021640, "question_id": 36705801, "link": "https://stackoverflow.com/questions/36705801/discrepancies-between-go-playground-and-go-on-my-machine", "title": "Discrepancies between Go Playground and Go on my machine?", "body": "<p>To settle some misunderstandings I have about goroutines, I went to the Go playground and ran <a href=\"https://play.golang.org/p/2oEy6GKPDu\" rel=\"nofollow\">this code</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc other(done chan bool) {\n    done &lt;- true\n    go func() {\n        for {\n            fmt.Println(\"Here\")\n        }\n    }()\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    done := make(chan bool)\n    go other(done)\n    &lt;-done\n    fmt.Println(\"Finished.\")\n}\n</code></pre>\n\n<p>As I expected, Go playground came back with an error: <em>Process took too long</em>.</p>\n\n<p>This seems to imply that the goroutine created within <code>other</code> runs forever.</p>\n\n<p>But when I run the same code on my own machine, I get this output almost instantaneously:</p>\n\n<pre><code>Hello, playground.\nFinished.\n</code></pre>\n\n<p>This seems to imply that the goroutine within <code>other</code> exits when the main goroutine finishes. <strong>Is this true? Or does the main goroutine finish, while the other goroutine continues to run in the background?</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 3, "creation_date": 1461068786, "post_id": 36704522, "comment_id": 61021812, "body": "Can someone please explain why this was down voted? I&#39;ve asked this same question 3 different ways now on SO and every time it&#39;s not answered and there&#39;s no helpful comments."}], "answers": [{"comments": [{"owner": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 0, "creation_date": 1461068848, "post_id": 36706189, "comment_id": 61021861, "body": "I simplified the question. It has nothing to do with inheritance."}, {"owner": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 0, "creation_date": 1461070395, "post_id": 36706189, "comment_id": 61023081, "body": "Also for what&#39;s it worth - I&#39;ve seen far &quot;stupider&quot; questions on SO for more established languages that are still at least answered and not heavily downvoted. This has made a strong impression on me that the go community doesn&#39;t want to help newcomers."}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "reply_to_user": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 0, "creation_date": 1461072316, "post_id": 36706189, "comment_id": 61024664, "body": "@Charlie, I&#39;m sorry you feel that way. I didn&#39;t think your question was &quot;stupid&quot; or downvote-worthy. The SO Go community seems different than on the Golang Forum or Slack Channel or Go-Nuts mailing list.  A question about why/style might get a better response there.  Hopefully my answer helped you out."}, {"owner": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 0, "creation_date": 1461078993, "post_id": 36706189, "comment_id": 61029689, "body": "Thanks for pointing out the mutex case - that makes sense but seem like an edge case. As for the something like io.ReadWriter I thought that best practice would be &quot;decorate&quot; in which case you would want to promote methods so you could call something like o.save() which would then be implemented using something like io.Write(). Any thoughts on that? <a href=\"https://www.javacodegeeks.com/2014/09/oop-alternative-to-utility-classes.html\" rel=\"nofollow noreferrer\">javacodegeeks.com/2014/09/&hellip;</a>"}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "reply_to_user": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 0, "creation_date": 1461080175, "post_id": 36706189, "comment_id": 61030642, "body": "I&#39;ve had to use the mutex for a map that would be accessed by multiple goroutines. Embedding isn&#39;t used that often, but can be really handy like <a href=\"https://golang.org/src/bufio/bufio.go?s=17449:17493#L712\" rel=\"nofollow noreferrer\">in bufio.ReadWriter</a>"}, {"owner": {"reputation": 453, "user_id": 6083111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bba01cf3ef98244da8d16027dc3eb8a9?s=128&d=identicon&r=PG", "display_name": "user161778", "link": "https://stackoverflow.com/users/6083111/user161778"}, "reply_to_user": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 0, "creation_date": 1461117653, "post_id": 36706189, "comment_id": 61048611, "body": "@Charlie, on a client/server I&#39;m developing, I have a limited struct in a library, then I extend it differently on the client/server. It&#39;s proven extremely useful when working with similar data or structs that embed the same data."}, {"owner": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "reply_to_user": {"reputation": 453, "user_id": 6083111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bba01cf3ef98244da8d16027dc3eb8a9?s=128&d=identicon&r=PG", "display_name": "user161778", "link": "https://stackoverflow.com/users/6083111/user161778"}, "edited": false, "score": 0, "creation_date": 1461155825, "post_id": 36706189, "comment_id": 61069203, "body": "@user161778 that makes sense but that&#39;s an example of embedding NOT composition."}, {"owner": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "reply_to_user": {"reputation": 453, "user_id": 6083111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bba01cf3ef98244da8d16027dc3eb8a9?s=128&d=identicon&r=PG", "display_name": "user161778", "link": "https://stackoverflow.com/users/6083111/user161778"}, "edited": false, "score": 0, "creation_date": 1461157724, "post_id": 36706189, "comment_id": 61070751, "body": "@user161778 it wasn&#39;t unclear - I understand the value of embedding - it&#39;s the closest thing go has to &quot;inheritance.&quot; But this question is about composition where you intentionally prevent methods from being &quot;promoted.&quot; Is that what you&#39;re doing? If so I&#39;d love to see the code if you&#39;re willing to share :)"}, {"owner": {"reputation": 453, "user_id": 6083111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bba01cf3ef98244da8d16027dc3eb8a9?s=128&d=identicon&r=PG", "display_name": "user161778", "link": "https://stackoverflow.com/users/6083111/user161778"}, "reply_to_user": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 0, "creation_date": 1461158410, "post_id": 36706189, "comment_id": 61071329, "body": "@Charlie, I&#39;m a bit confused on your wording. Now reading your question carefully &quot;Why would you want to use <i>composition</i>?&quot;, a couple simple answers are: Clarity (you can name the field) and functionality (other structs may share conflicting methods/fields, and you want to include them). I&#39;ll see if I can write a full answer. The accepted answer confused me to the scope of the question because it&#39;s about embedding :)."}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "reply_to_user": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 1, "creation_date": 1461158656, "post_id": 36706189, "comment_id": 61071527, "body": "@Charlie embedding is a helpful wrapper of composition.  Composition is including the functionality/fields of smaller pieces in a larger vs inheritance, which is getting the functionality/fields by a relation to another class/object."}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": true, "score": 10, "last_activity_date": 1461070212, "last_edit_date": 1461070212, "creation_date": 1461023436, "answer_id": 36706189, "question_id": 36704522, "link": "https://stackoverflow.com/questions/36704522/why-would-you-want-to-use-composition-in-golang/36706189#36706189", "title": "Why would you want to use composition in golang?", "body": "<p>It is worth going over the section on Embedding in <a href=\"https://golang.org/doc/effective_go.html\" rel=\"noreferrer\">Effective Go</a>.</p>\n\n<p>A common example is having a struct/map with a Mutex.</p>\n\n<pre><code>type SafeStruct struct {\n    SomeField string \n    *sync.Mutex\n}\n</code></pre>\n\n<p>It is much easier to type </p>\n\n<pre><code>safe := SafeStruct{SomeField: \"init value\"}\n\nsafe.Lock()\ndefer safe.Unlock()\nsafe.SomeField = \"new value\"\n</code></pre>\n\n<p>than having to either write appropriate wrapper functions (which are repetitive) or have the stutter of </p>\n\n<pre><code>safe.mutex.Unlock()\n</code></pre>\n\n<p>when the only thing you would ever do with the mutex field is access the methods (<code>Lock()</code> and <code>Unlock()</code> in this case)</p>\n\n<p>This becomes even more helpful when you are trying to use multiple functions on the embedded field (that implemement an interface like <code>io.ReadWriter</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 1491, "user_id": 6696684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0ATU9.jpg?s=128&g=1", "display_name": "Sumer", "link": "https://stackoverflow.com/users/6696684/sumer"}, "is_accepted": false, "score": 0, "last_activity_date": 1599910815, "last_edit_date": 1599910815, "creation_date": 1599903878, "answer_id": 63858974, "question_id": 36704522, "link": "https://stackoverflow.com/questions/36704522/why-would-you-want-to-use-composition-in-golang/63858974#63858974", "title": "Why would you want to use composition in golang?", "body": "<p>One more point I want to cover for first case in your example.\nIf <code>obj1Inherited</code> and <code>obj2</code> have a same name method then that method call (from <code>obj1Inherited</code> instance) will always execute <code>obj1Inherited</code> method.</p>\n<p>To call <code>obj2</code> method you can use the other approach of not promoting</p>\n"}, {"tags": [], "owner": {"reputation": 1268, "user_id": 3341358, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/8640902fd051be3d51a6ff091d3c1dba?s=128&d=identicon&r=PG&f=1", "display_name": "Dheerendra", "link": "https://stackoverflow.com/users/3341358/dheerendra"}, "is_accepted": false, "score": 0, "last_activity_date": 1611861478, "creation_date": 1611861478, "answer_id": 65943843, "question_id": 36704522, "link": "https://stackoverflow.com/questions/36704522/why-would-you-want-to-use-composition-in-golang/65943843#65943843", "title": "Why would you want to use composition in golang?", "body": "<p>I'll try to answer original question - sometimes people use &quot;composition&quot; instead of embedding to hide functionality of embedded struct. Not a great use case - but people prefer it sometimes.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>type Obj1composed struct {\n  notExportedObj1 obj1\n}\n\nfunc NewObj1Composed(someParam Params) Obj1composed {\n...\n}\n\nfunc (o Obj1Composed) Print() {\n  // Some heavy calculations here. Make Dozens of API calls\n  // print some data\n}\n</code></pre>\n"}], "owner": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5390, "favorite_count": 0, "accepted_answer_id": 36706189, "answer_count": 3, "score": 8, "last_activity_date": 1611861478, "creation_date": 1461014571, "last_edit_date": 1461068722, "question_id": 36704522, "link": "https://stackoverflow.com/questions/36704522/why-would-you-want-to-use-composition-in-golang", "title": "Why would you want to use composition in golang?", "body": "<p>In the following code I show what I think is the difference between embedding (where methods get promoted) and composition (where methods are not promoted) in golang.</p>\n\n<p>Why would you ever want to use composition in golang?</p>\n\n<pre><code>type obj1Inherited struct {\n    obj2\n}\n\ntype obj1Composed struct {\n    someobj obj2\n}\n\ntype obj2 struct {\n}\n\nfunc (o obj2) printTest() {\n    fmt.Println(\"obj2\")\n}\n\nfunc main() {\n    o := obj1Inherited{}\n    o.printTest() //fine - printTest is promoted\n\n    obj1Composed := obj1Composed{}\n    obj1Composed.selector.printTest() //fine because I'm using the composed obj\n    obj1Composed.printTest() //not fine - printTest is NOT promoted\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 30, "last_activity_date": 1461015493, "creation_date": 1461015493, "answer_id": 36704754, "question_id": 36703867, "link": "https://stackoverflow.com/questions/36703867/golang-preprocessor-like-c-style-compile-switch/36704754#36704754", "title": "Golang Preprocessor like C-style compile switch", "body": "<p>The closest way to achieve this is by using <a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\">build constraints</a>. Example:</p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nfunc main() {\n    println(\"main()\")\n    conditionalFunction()\n}\n</code></pre>\n\n<p>a.go</p>\n\n<pre><code>// +build COMPILE_OPTION\n\npackage main\n\nfunc conditionalFunction() {\n    println(\"conditionalFunction\")\n}\n</code></pre>\n\n<p>b.go</p>\n\n<pre><code>// +build !COMPILE_OPTION\n\npackage main\n\nfunc conditionalFunction() {\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>% go build -o example ; ./example\nmain()\n\n% go build -o example -tags COMPILE_OPTION ; ./example\nmain()\nconditionalFunction\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 693, "user_id": 1802697, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eH3MJ.jpg?s=128&g=1", "display_name": "Igor Maznitsa", "link": "https://stackoverflow.com/users/1802697/igor-maznitsa"}, "is_accepted": false, "score": 2, "last_activity_date": 1482876245, "creation_date": 1482876245, "answer_id": 41352747, "question_id": 36703867, "link": "https://stackoverflow.com/questions/36703867/golang-preprocessor-like-c-style-compile-switch/41352747#41352747", "title": "Golang Preprocessor like C-style compile switch", "body": "<p>potentially it is possible to use <a href=\"https://github.com/raydac/java-comment-preprocessor\" rel=\"nofollow noreferrer\">Java Comment Preprocessor</a> + <a href=\"https://github.com/raydac/mvn-golang\" rel=\"nofollow noreferrer\">maven golang plugin</a> and get some similar behavior, in the case golang code will look like </p>\n\n<pre><code>//#if COMPILE_OPTION\n fmt.Println(\"Ok\")\n//#else\n fmt.Println(\"No\")\n//#endif\n</code></pre>\n\n<p>some example has been placed here <a href=\"https://github.com/raydac/mvn-golang/tree/master/mvn-golang-examples/mvn-golang-examples-preprocessing\" rel=\"nofollow noreferrer\">https://github.com/raydac/mvn-golang/tree/master/mvn-golang-examples/mvn-golang-examples-preprocessing</a></p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 5720535, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CVG2Bx3rsIg/AAAAAAAAAAI/AAAAAAAAAWY/eARZ2mPtSAI/photo.jpg?sz=128", "display_name": "Donovan Baarda", "link": "https://stackoverflow.com/users/5720535/donovan-baarda"}, "is_accepted": false, "score": 0, "last_activity_date": 1589156567, "creation_date": 1589156567, "answer_id": 61720476, "question_id": 36703867, "link": "https://stackoverflow.com/questions/36703867/golang-preprocessor-like-c-style-compile-switch/61720476#61720476", "title": "Golang Preprocessor like C-style compile switch", "body": "<p>Note that it's possible to use any macro language as a preprocessor for go. An example would be GNU's m4 macro language.</p>\n\n<p>You can then write your code in *.go.m4 files, use your build system to feed them through m4 to turn them into generated *.go files, and then compile them.</p>\n\n<p>This can also be handy for writing generics.</p>\n"}], "owner": {"reputation": 411, "user_id": 6205397, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ff2a90faa5b27c204ced0d63900e8ece?s=128&d=identicon&r=PG&f=1", "display_name": "GoGo", "link": "https://stackoverflow.com/users/6205397/gogo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8039, "favorite_count": 4, "answer_count": 3, "score": 18, "last_activity_date": 1589156567, "creation_date": 1461011965, "question_id": 36703867, "link": "https://stackoverflow.com/questions/36703867/golang-preprocessor-like-c-style-compile-switch", "title": "Golang Preprocessor like C-style compile switch", "body": "<p>Does GO language have a preprocessor? When I looked up internet, there was few approaches which *.pgo convert to *.go. And, I wonder if it is doable in Go</p>\n\n<pre><code>#ifdef COMPILE_OPTION\n  {compile this code ... }\n#elif \n  {compile another code ...}\n</code></pre>\n\n<p>or, \n<code>#undef in c</code></p>\n"}, {"tags": ["logging", "go", "production-environment"], "comments": [{"owner": {"reputation": 3699, "user_id": 4816175, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/697df6176ef55a7ea25f159e0fcdec38?s=128&d=identicon&r=PG", "display_name": "cool breeze", "link": "https://stackoverflow.com/users/4816175/cool-breeze"}, "edited": false, "score": 0, "creation_date": 1461000538, "post_id": 36700549, "comment_id": 60988865, "body": "Not sure why code formatting isn&#39;t working, I tried to fix it a few times."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1461000831, "post_id": 36700549, "comment_id": 60989025, "body": "It&#39;s difficult to answer this without knowing more about your application. The code above is acceptable in some situations and not in others."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1461005123, "post_id": 36700549, "comment_id": 60991494, "body": "Note that the sequence &quot;print and exit&quot; is nicely done using the <code>log.Fatal*()</code> set of functions."}, {"owner": {"reputation": 453, "user_id": 6083111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bba01cf3ef98244da8d16027dc3eb8a9?s=128&d=identicon&r=PG", "display_name": "user161778", "link": "https://stackoverflow.com/users/6083111/user161778"}, "edited": false, "score": 0, "creation_date": 1461161737, "post_id": 36700549, "comment_id": 61074243, "body": "I don&#39;t think there&#39;s any issue with using the <code>fmt</code> package in production code. Unless there&#39;s an issue with <code>fmt.Sprintf</code> I&#39;m unaware of."}], "answers": [{"tags": [], "owner": {"reputation": 2103, "user_id": 3119050, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/mZahs.jpg?s=128&g=1", "display_name": "fredmaggiowski", "link": "https://stackoverflow.com/users/3119050/fredmaggiowski"}, "is_accepted": false, "score": 0, "last_activity_date": 1461002769, "last_edit_date": 1461002769, "creation_date": 1461001013, "answer_id": 36700719, "question_id": 36700549, "link": "https://stackoverflow.com/questions/36700549/should-i-be-using-fmt-in-production-code/36700719#36700719", "title": "Should I be using fmt in production code?", "body": "<p>Thought it's acceptable to use <code>printf</code>s in some situation. It's better, in production environment to use different logging strategies.</p>\n\n<p>For instance if your application is a daemon running in background you are going to miss all of your <code>fmt.Printf</code> unless you don't pipe them in a file.</p>\n\n<p>A good way to do looging is to use log rotation (since you don't want to have incredibly huge files) instead of reinvent your own logrotate you can use standard packages or external packages based on your needs.</p>\n\n<p>Golang provides a <a href=\"https://golang.org/pkg/log/\" rel=\"nofollow\">log</a> package <a href=\"https://golang.org/pkg/log/syslog/\" rel=\"nofollow\">syslog</a> subpackage that are optimal solution to do simple logging relying on the OS syslog.</p>\n"}, {"tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1461001062, "creation_date": 1461001062, "answer_id": 36700735, "question_id": 36700549, "link": "https://stackoverflow.com/questions/36700549/should-i-be-using-fmt-in-production-code/36700735#36700735", "title": "Should I be using fmt in production code?", "body": "<p><code>fmt.Printf()</code> is good for starting to sketch out your program, but you should probably either delete them or replace with real logging statements. </p>\n\n<p>I have had good luck with the standard <a href=\"http://golang.org/pkg/log\" rel=\"nofollow\">log</a> and <a href=\"http://github.com/Sirupsen/logrus\" rel=\"nofollow\">logrus</a> if I need more.</p>\n\n<p>All logging depends on other ops related concerns, so who/what is processing/looking at the logs matters a lot.</p>\n"}, {"tags": [], "owner": {"reputation": 417, "user_id": 3049386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/754afefdb87c446066459a9857d9a0cf?s=128&d=identicon&r=PG&f=1", "display_name": "Bestbug", "link": "https://stackoverflow.com/users/3049386/bestbug"}, "is_accepted": false, "score": 0, "last_activity_date": 1461021928, "last_edit_date": 1461021928, "creation_date": 1461005064, "answer_id": 36701915, "question_id": 36700549, "link": "https://stackoverflow.com/questions/36700549/should-i-be-using-fmt-in-production-code/36701915#36701915", "title": "Should I be using fmt in production code?", "body": "<p>I think the best way is to prepare your code for easy switch from develop environment to production environment maybe using an input parameter when you launch your go application. </p>\n\n<p>You can create a variuos level of logs: </p>\n\n<p><strong>\"Always\" log level</strong></p>\n\n<p>This log level is always enabled, gives important information about the status of your application (if need). Also report crash messages.</p>\n\n<p><strong>\"testing\" log level</strong></p>\n\n<p>This log level contain useful informations when your code is finished but you have to check some information no longer useful when the code is on production</p>\n\n<p><strong>\"Debug\" log level</strong></p>\n\n<p>This log level contains useful information when you are in development environment developing new features or optimising already existent code</p>\n\n<p>The best way to do this, in my opinion, is by using <em>chan</em>s which allow you create an async daemon and log wherever you want whatever you want. </p>\n\n<p>You can read some information about chan <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow\">here</a>. </p>\n\n<p>An example of daemon could be:</p>\n\n<pre><code>func daemonLogging(importantMessage chan error, testingMessage chan error,debugMessage chan error){\n    for{\n\n        if globalDebugFlag == true{\n            // Log debug message\n        }\n\n        if globalTestingMessage == true{\n            // Log Testing message\n        }\n\n        // Log important message\n    }\n}\n</code></pre>\n\n<p>Remember to call this function with the <code>go</code> keyword</p>\n\n<p>I think it is not important <em>what</em> package you use (if you have not any need) but it is important <em>how</em> you decide to log your messages</p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1461005356, "creation_date": 1461005356, "answer_id": 36702005, "question_id": 36700549, "link": "https://stackoverflow.com/questions/36700549/should-i-be-using-fmt-in-production-code/36702005#36702005", "title": "Should I be using fmt in production code?", "body": "<p>My take on this is that for relatively simple \"service-like\" solutions (a long-running program servicing user requests) this approach works quite OK provided you either switch to <code>log.Fatal*()</code> which adds a timestamp to each message output or run your service under some sensible supervisor (<code>systemd</code>, <code>daemon</code>, <code>runit</code> etc) which would forward what your program outputs into approptiate system log sink(s).</p>\n\n<p>An approach to logging also highly depends on the nature of the program.\nSay, for command-line applications which do one-off actions (<code>curl</code> or <code>wget</code> is a good example of such a program&mdash;in the spirit of your code example) logging to their standard error stream and exiting is the only sane mode of operation.  Daemons (services) are expected to run unattended, and hence you have to make sure what they log gets sent and stored somewhere, timestamped.</p>\n\n<p>A minor note: a well-behaving program is supposed to output error messages to its standard error stream, so if you don't want to use <code>log.Fatal*()</code> for some reaseon, at least do <code>fmt.Fprint*(os.Stderr, ...</code>).</p>\n"}], "owner": {"reputation": 3699, "user_id": 4816175, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/697df6176ef55a7ea25f159e0fcdec38?s=128&d=identicon&r=PG", "display_name": "cool breeze", "link": "https://stackoverflow.com/users/4816175/cool-breeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 447, "favorite_count": 0, "answer_count": 4, "score": 0, "last_activity_date": 1461021928, "creation_date": 1461000474, "last_edit_date": 1461003929, "question_id": 36700549, "link": "https://stackoverflow.com/questions/36700549/should-i-be-using-fmt-in-production-code", "title": "Should I be using fmt in production code?", "body": "<p>I see a lot of <code>Go</code> code that looks like this:</p>\n\n<pre><code>func main() {\n    response, _, err := http.Get(\"http://golang.org/\")\n    if err != nil {\n        fmt.Printf(\"%s\", err)\n        os.Exit(1)\n    }\n\n    defer response.Body.Close()\n    contents, err := ioutil.ReadAll(response.Body)\n    if err != nil {\n        fmt.Printf(\"%s\", err)\n        os.Exit(1)\n    }\n\n    fmt.Printf(\"%s\\n\", string(contents))\n}\n</code></pre>\n\n<p>My questions are:</p>\n\n<ol>\n<li><p>In production, should I keep these <code>fmt.Printf</code> statements?  Silly question I am sure but just checking</p></li>\n<li><p>What logging options do you recommend for production code and also dev?</p></li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3262, "user_id": 1900537, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/I7rTU.jpg?s=128&g=1", "display_name": "romants", "link": "https://stackoverflow.com/users/1900537/romants"}, "edited": false, "score": 0, "creation_date": 1461000047, "post_id": 36700291, "comment_id": 60988601, "body": "Try <code>%d</code> in <code>test</code> instead of <code>%v</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3262, "user_id": 1900537, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/I7rTU.jpg?s=128&g=1", "display_name": "romants", "link": "https://stackoverflow.com/users/1900537/romants"}, "edited": false, "score": 0, "creation_date": 1461000194, "post_id": 36700438, "comment_id": 60988689, "body": "Any idea why <code>%v</code> doesn&#39;t work? On <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">golang.org/pkg/fmt</a> <code>%v</code> should result in the value in default format"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1461000662, "last_edit_date": 1461000662, "creation_date": 1461000089, "answer_id": 36700438, "question_id": 36700291, "link": "https://stackoverflow.com/questions/36700291/how-to-do-interpolation-on-url-in-golang/36700438#36700438", "title": "How to do interpolation on URL in Golang", "body": "<p>The <code>%</code> characters that are not part of a format verb should be escaped as <code>%%</code>:</p>\n\n<pre><code>test := \"https://www.googleapis.com/customsearch/v1?start=%d&amp;cx=001106611627702700888%%3Aaonktv-oz_w&amp;q=bells%%20palsy%%20mouth&amp;exactTerms=palsy&amp;fileType=png&amp;imgColorType=color&amp;imgType=face&amp;searchType=image&amp;key=AIzaSyAYqQ4IxUHnF7rfvzSvnczxQ-u93AbkC8k\"\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/E8UV48dg8W\" rel=\"nofollow\">playground example</a></p>\n\n<p>If the <code>%</code> are not escaped, then fmt expects to find a corresponding argument and complains with the output <code>(MISSING)</code> when the argument is not found.</p>\n"}], "owner": {"reputation": 2659, "user_id": 2484238, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/RVQ1a.jpg?s=128&g=1", "display_name": "Bun", "link": "https://stackoverflow.com/users/2484238/bun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 0, "accepted_answer_id": 36700438, "answer_count": 1, "score": 0, "last_activity_date": 1461000662, "creation_date": 1460999628, "last_edit_date": 1461000286, "question_id": 36700291, "link": "https://stackoverflow.com/questions/36700291/how-to-do-interpolation-on-url-in-golang", "title": "How to do interpolation on URL in Golang", "body": "<p>I have the follow URL and I want to change the value of <code>start</code> for each iteration. Is there a better way to do it? </p>\n\n<pre><code>    test := \"https://www.googleapis.com/customsearch/v1?start=%d&amp;cx=001106611627702700888%3Aaonktv-oz_w&amp;q=bells%20palsy%20mouth&amp;exactTerms=palsy&amp;fileType=png&amp;imgColorType=color&amp;imgType=face&amp;searchType=image&amp;key=AIzaSyAYqQ4IxUHnF7rfvzSvnczxQ-u93AbkC8k\"\n\nfor v := 1; v &lt; 100; v += 10 {\n    val := fmt.Sprintf(test, v)\n    fmt.Println(val)\n}\n</code></pre>\n\n<p>Output now:\n<code>\nhttps://www.googleapis.com/customsearch/v1?start=1&amp;cx=001106611627702700888%!A(MISSING)aonktv-oz_w&amp;q=bells%!p(MISSING)alsy%!m(MISSING)outh&amp;exactTerms=palsy&amp;fileType=png&amp;imgColorType=color&amp;imgType=face&amp;searchType=image&amp;key=AIzaSyAYqQ4IxUHnF7rfvzSvnczxQ-u93AbkC8k\n</code></p>\n\n<p>Expected Output should be:\n<code>\nhttps://www.googleapis.com/customsearch/v1?startindex=1&amp;q=bells%20palsy%20mouth\nhttps://www.googleapis.com/customsearch/v1?startindex=11&amp;q=bells%20palsy%20mouth\n</code></p>\n\n<p>....etc.</p>\n\n<p>Why <code>Sprintf</code> gives me <code>(MISSING)</code> and a couple of random characters?</p>\n"}, {"tags": ["ssl", "go", "ssl-certificate", "tls1.2"], "comments": [{"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1461047419, "post_id": 36699985, "comment_id": 61007366, "body": "As @Steffen answered, it will work if you concatenate the cert and intermediate cert files into a single file."}], "answers": [{"tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 3, "last_activity_date": 1460999390, "last_edit_date": 1495541257, "creation_date": 1460999390, "answer_id": 36700223, "question_id": 36699985, "link": "https://stackoverflow.com/questions/36699985/intermediate-certificate-doesnt-match-private-key-with-go/36700223#36700223", "title": "Intermediate certificate doesn&#39;t match private key with Go", "body": "<p>You don't have a key for the intermediate certificate, only for the server certificate. Note that I don't know much about Go, but according to <a href=\"https://stackoverflow.com/questions/28898723/golang-ssl-tcp-socket-certificate-configuration\">Golang SSL TCP socket certificate configuration</a> you simply include the intermediate certificate into the same PEM file as the server certificate.</p>\n"}], "owner": {"reputation": 2752, "user_id": 109534, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/4ae977f4e7623db44d04afa60e55c92e?s=128&d=identicon&r=PG", "display_name": "Ghassan Karwchan", "link": "https://stackoverflow.com/users/109534/ghassan-karwchan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 723, "favorite_count": 0, "accepted_answer_id": 36700223, "answer_count": 1, "score": 0, "last_activity_date": 1460999390, "creation_date": 1460998657, "question_id": 36699985, "link": "https://stackoverflow.com/questions/36699985/intermediate-certificate-doesnt-match-private-key-with-go", "title": "Intermediate certificate doesn&#39;t match private key with Go", "body": "<p>I am trying to build a Go (golang) program that will run https application.</p>\n\n<p>I am really having trouble with SSL intermediate certificate and don't know where the problem, is it from my certificate or from Go language application.</p>\n\n<p>So, I have from my SSL CA providers two certificate files : the server certificate, and intermediate certificate.</p>\n\n<p>So, I am trying to load these certificates from my go code like this:</p>\n\n<pre><code>tlsConfig := &amp;tls.Config{}\ntlsConfig.Certificates = make([]tls.Certificate, 2)\nvar err error\ntlsConfig.Certificates[0], err = tls.LoadX509KeyPair(serverCertificate, privateKey)\nif err != nil {\n    log.Fatal(err)\n}\ntlsConfig.Certificates[1], err = tls.LoadX509KeyPair(intermeddiateCertificate, privateKey)\nif err != nil {\n    log.Fatal(err)\n}\ntlsConfig.BuildNameToCertificate()\n\nserver := &amp;http.Server{\n    ReadTimeout:    10 * time.Second,\n    WriteTimeout:   10 * time.Second,\n    MaxHeaderBytes: 1 &lt;&lt; 20,\n    TLSConfig:      tlsConfig,\n    Addr:           \":443,\n}\n\n   app.RunServer(server)\n</code></pre>\n\n<p>the code fails on the second load of certificate on this line</p>\n\n<pre><code>tls.LoadX509KeyPair(intermeddiateCertificate, privateKey)\n</code></pre>\n\n<p>The error is the certificate doesn't match the private key.</p>\n\n<p>Does the intermediate certificate should match the private key in SSL/TLS world?</p>\n\n<p>or it doesn't have to.\nAnd in case doesn't have to, then how to load the certificate without a private key?</p>\n\n<p>should I return back to my CA and tell them how come the intermediate certifcate doesn't match the private key?</p>\n"}, {"tags": ["json", "dictionary", "go", "struct", "marshalling"], "comments": [{"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1460994100, "post_id": 36698065, "comment_id": 60984987, "body": "Those who voted down this answer please leave your reason in the comment. I don&#39;t see why this question isn&#39;t legit."}], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 5, "last_activity_date": 1460994313, "last_edit_date": 1460994313, "creation_date": 1460993485, "answer_id": 36698390, "question_id": 36698065, "link": "https://stackoverflow.com/questions/36698065/ordering-difference-in-json-marshaled-from-map-and-struct/36698390#36698390", "title": "Ordering Difference in JSON Marshaled from Map and Struct", "body": "<p>The order of elements in maps is not defined as Go uses a <a href=\"https://golang.org/src/runtime/hashmap.go\" rel=\"nofollow\">hash table</a> to implement them. You should expect the elements to be marshalled in any order.</p>\n\n<p>When marshalling a structure, the order of JSON fields should match the order of fields in structure. This is a side effect of accessing fields through reflection. Still you should not rely on this side effect.</p>\n\n<p>The order of elements is not significant in JSON. The problem of comparing JSON structures is the same as the problem of comparing trees with unordered child nodes.</p>\n"}, {"comments": [{"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1460999378, "post_id": 36700115, "comment_id": 60988214, "body": "Thanks that was very useful!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1460999819, "last_edit_date": 1460999819, "creation_date": 1460999066, "answer_id": 36700115, "question_id": 36698065, "link": "https://stackoverflow.com/questions/36698065/ordering-difference-in-json-marshaled-from-map-and-struct/36700115#36700115", "title": "Ordering Difference in JSON Marshaled from Map and Struct", "body": "<p>The encoding/json package marshals maps in <a href=\"https://github.com/golang/go/blob/f60fcca5f1e7b7a33e219ec45d4bd9dc58dd2552/src/encoding/json/encode.go#L624\" rel=\"noreferrer\">sorted key order</a> and structs in the order that the fields are declared. </p>\n\n<p>Although the order used by the encoding/json package is not documented, it's safe to assume that maps are marshaled in sorted key order and structs are marshaled in field declaration order. There are many tests in the standard library and elsewhere that depend on these orders.</p>\n"}], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1274, "favorite_count": 1, "accepted_answer_id": 36700115, "answer_count": 2, "score": 6, "last_activity_date": 1460999819, "creation_date": 1460992588, "last_edit_date": 1460994056, "question_id": 36698065, "link": "https://stackoverflow.com/questions/36698065/ordering-difference-in-json-marshaled-from-map-and-struct", "title": "Ordering Difference in JSON Marshaled from Map and Struct", "body": "<p>When marshaling from a <code>map[string]interface{}</code> and an equivalent <code>struct</code>, the JSON returned are similar but different in the internal order of the keys likewise:</p>\n\n<pre><code>var arg1 = map[string]interface{}{\n    \"foo\": \"bar\",\n    \"baz\": map[string]interface{}{\n        \"bee\": \"boo\",\n    },\n}\n\ntype Arg struct {\n    Foo string                 `json:\"foo\"`\n    Baz map[string]interface{} `json:\"baz\"`\n}\n\nvar arg2 = &amp;Arg{\n    Foo: \"bar\",\n    Baz: map[string]interface{}{\n        \"bee\": \"boo\",\n    },\n}\n\nfunc main() {\n    result1, _ := json.Marshal(arg1)\n    result2, _ := json.Marshal(arg2)\n\n    fmt.Println(reflect.DeepEqual(result1, result2)\n    fmt.Println(string(result1))\n    fmt.Println(string(result2))\n\n    // false\n    // {\"baz\":{\"bee\":\"boo\"},\"foo\":\"bar\"}\n    // {\"foo\":\"bar\",\"baz\":{\"bee\":\"boo\"}}\n\n}\n</code></pre>\n\n<p>Check the <a href=\"https://play.golang.org/p/C8KfDWRmsY\" rel=\"noreferrer\">playground here</a>. </p>\n\n<p>Although in JSON the order doesn't matter, I'd like to know why are the results ordered differently?</p>\n"}, {"tags": ["loops", "go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": 4, "last_activity_date": 1460994556, "last_edit_date": 1460994556, "creation_date": 1460992957, "answer_id": 36698191, "question_id": 36697796, "link": "https://stackoverflow.com/questions/36697796/about-golang-interface-loop/36698191#36698191", "title": "about golang interface loop", "body": "<p>You must type assert each <code>interface{}</code> level first, in this case, use a <strong>type assertion</strong> at <code>map[string]interface{}</code> level since we know a definite type, and a <strong>type switch</strong> to check anticipated types for each nested value in the next level.</p>\n\n<pre><code>initData := []interface{}{\n        map[string]interface{}{\n            \"name\": \"k1\",\n            \"type\": \"line\",\n            \"data\": []int{1, 2, 3, 4},\n        },\n\n        map[string]interface{}{\n            \"name\": \"k2\",\n            \"type\": \"circle\",\n            \"data\": []int{11, 12, 13, 14},\n        },\n    }\n\n    for _, data := range initData {\n        for _, v := range data.(map[string]interface{}) {\n            switch t := v.(type) {\n            case string, []int:\n                fmt.Println(t)\n            default:\n                fmt.Println(\"wrong type\")           \n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Run playground <a href=\"https://play.golang.org/p/62gPC0XJ0U\" rel=\"nofollow\">here</a>.</p>\n"}], "owner": {"reputation": 228, "user_id": 746881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/418b1231589a3b64f2b3def40be8f81a?s=128&d=identicon&r=PG&f=1", "display_name": "Kewin", "link": "https://stackoverflow.com/users/746881/kewin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6845, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1460994556, "creation_date": 1460991950, "question_id": 36697796, "link": "https://stackoverflow.com/questions/36697796/about-golang-interface-loop", "title": "about golang interface loop", "body": "<p>I wanto print a complicate dataset like bellowing </p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    // \"reflect\"\n)\n\nfunc main() {\n\n    var initData []interface{}\n    initData[0] = map[string]interface{}{\n        \"name\": \"k1\",\n        \"type\": \"line\",\n        \"data\": []int{1, 2, 3, 4},\n    }\n\n    initData[1] = map[string]interface{}{\n        \"name\": \"k2\",\n        \"type\": \"circle\",\n        \"data\": []int{11, 12, 13, 14},\n    }\n\n    for _, data := range initData {\n        for k, v := range data {\n            fmt.Println(k)\n            for _, sv := range v {\n                fmt.Println(\"  \" + sv)\n            }\n        }\n\n    }\n\n}\n</code></pre>\n\n<p>but get an error </p>\n\n<pre><code>./maps-in-maps.go:56: cannot range over data (type interface {})\n</code></pre>\n\n<p>any help? to try to concert the interface typed dataset to interable like arry or slice </p>\n"}, {"tags": ["arrays", "go", "gzip", "zlib"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1460986389, "post_id": 36695470, "comment_id": 60979052, "body": "You really should get into the habit of checking errors. Are you sure your code hangs and not just your terminal isn&#39;t refreshed?"}, {"owner": {"reputation": 41, "user_id": 6219936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1e1ce1cc4880d21856dbe91ea970fb2?s=128&d=identicon&r=PG", "display_name": "Manuel", "link": "https://stackoverflow.com/users/6219936/manuel"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1460987068, "post_id": 36695470, "comment_id": 60979582, "body": "@icza: I&#39;ve added a print statement after each line to check. Sometimes it will only print the statement immediately following <code>compr := gzip.NewWriter(&amp;buf)</code>. The terminal is not hanging; the cursor will blink eagerly until I press Enter, which happens to be fed into the next function that expects user input. Is there any other way to check for errors in this particular case?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1460987952, "post_id": 36695470, "comment_id": 60980268, "body": "Can you please provide an <a href=\"http://stackoverflow.com/help/mcve\">MCVE</a> that still produces your issue?"}, {"owner": {"reputation": 41, "user_id": 6219936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1e1ce1cc4880d21856dbe91ea970fb2?s=128&d=identicon&r=PG", "display_name": "Manuel", "link": "https://stackoverflow.com/users/6219936/manuel"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1460988914, "post_id": 36695470, "comment_id": 60981031, "body": "@icza: not needed. You pointed me into the right direction. Using a different terminal emulator (konsole), I could not reproduce the error. The erroneous terminal is terminator. Your first guess happened to be the right one. - Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 6219936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1e1ce1cc4880d21856dbe91ea970fb2?s=128&d=identicon&r=PG", "display_name": "Manuel", "link": "https://stackoverflow.com/users/6219936/manuel"}, "is_accepted": true, "score": 2, "last_activity_date": 1460989121, "creation_date": 1460989121, "answer_id": 36696633, "question_id": 36695470, "link": "https://stackoverflow.com/questions/36695470/golang-gzip-or-zlib-compression-of-byte-array-sporadically-hangs/36696633#36696633", "title": "golang: gzip or zlib compression of byte array sporadically hangs", "body": "<p>It was not the code's or golang's fault. The terminal emulator I used (terminator) did not refresh properly, it seems. Using a different terminal emulator I could not reproduce the error.</p>\n"}], "owner": {"reputation": 41, "user_id": 6219936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1e1ce1cc4880d21856dbe91ea970fb2?s=128&d=identicon&r=PG", "display_name": "Manuel", "link": "https://stackoverflow.com/users/6219936/manuel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 870, "favorite_count": 0, "accepted_answer_id": 36696633, "answer_count": 1, "score": 2, "last_activity_date": 1460989121, "creation_date": 1460986228, "question_id": 36695470, "link": "https://stackoverflow.com/questions/36695470/golang-gzip-or-zlib-compression-of-byte-array-sporadically-hangs", "title": "golang: gzip or zlib compression of byte array sporadically hangs", "body": "<p>I have the following function to compress a byte array:</p>\n\n<pre><code>func compress(input []byte) []byte {\n        var buf bytes.Buffer\n        compr := gzip.NewWriter(&amp;buf)\n        compr.Write(input) // here it appears to hang until\n                           // Enter is pressed\n        compr.Close()\n        output := buf.Bytes()\n\n        return output\n}\n</code></pre>\n\n<p>Sporadically the function will hang. When I press [Enter] the function will continue and return the expected result. Am I missing something here?</p>\n\n<p>It will hang about one times out of five, even when the same input is given. Whether I use gzip or zlib, it doesn't matter.</p>\n\n<p>I am using go 1.6 on Linux x86_64 </p>\n"}, {"tags": ["reflection", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1463542371, "post_id": 36692277, "comment_id": 62103990, "body": "Can you provide a reference?"}], "tags": [], "owner": {"reputation": 2456, "user_id": 257321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53ca8b33c85cdba2f4e1096593b01531?s=128&d=identicon&r=PG", "display_name": "Jessta", "link": "https://stackoverflow.com/users/257321/jessta"}, "is_accepted": false, "score": 4, "last_activity_date": 1460977759, "creation_date": 1460977759, "answer_id": 36692277, "question_id": 36692030, "link": "https://stackoverflow.com/questions/36692030/what-alternative-to-reflect-structof-exists-prior-to-its-addition-to-in-633ab74/36692277#36692277", "title": "What alternative to reflect.StructOf exists, prior to its addition to in 633ab74?", "body": "<p>There was no way to create a new struct type at runtime prior to the addition of reflect.StructOf.</p>\n"}], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1460977759, "creation_date": 1460977057, "question_id": 36692030, "link": "https://stackoverflow.com/questions/36692030/what-alternative-to-reflect-structof-exists-prior-to-its-addition-to-in-633ab74", "title": "What alternative to reflect.StructOf exists, prior to its addition to in 633ab74?", "body": "<p>I have some code that makes use of <a href=\"http://tip.golang.org/pkg/reflect/#StructOf\" rel=\"nofollow\"><code>reflect.StructOf</code></a>, which will presumably land in go1.7. Little did I know, that this wasn't available until only about 2 weeks ago, and only in current <code>master</code>. How does one create custom structs at runtime prior to this method being added?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "edited": false, "score": 0, "creation_date": 1460972666, "post_id": 36690379, "comment_id": 60969366, "body": "I can&#39;t change the int to a string as this would be invalid on the request side so it has to stay an int."}, {"owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "edited": false, "score": 0, "creation_date": 1460972776, "post_id": 36690379, "comment_id": 60969450, "body": "If I do the interface version:  mapD := map[string]interface{&quot;deploy_status&quot;: &quot;public&quot;, &quot;status&quot;: &quot;live&quot;, &quot;version&quot;: 2} mapB, _ := json.Marshal(mapD) fmt.Println(string(mapB))  I get the error of: syntax error: unexpected string literal"}, {"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "reply_to_user": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "edited": false, "score": 0, "creation_date": 1460975559, "post_id": 36690379, "comment_id": 60971258, "body": "Yes, because you&#39;re not initializing the interface correctly.You should use <code>map[string]interface{}{...}</code>"}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 1, "last_activity_date": 1460972448, "creation_date": 1460972448, "answer_id": 36690379, "question_id": 36689892, "link": "https://stackoverflow.com/questions/36689892/golang-convert-array-map-to-json/36690379#36690379", "title": "Golang - convert array / map to JSON", "body": "<p>You are trying to use a value of type <code>int</code> as a string, but your map is defined as <code>[string]string</code>. You have to modify the first line as:</p>\n\n<pre><code>mapD := map[string]string{\"deploy_status\": \"public\", \"status\": \"live\", \"version\": \"2\"}\n</code></pre>\n\n<p>If you do not know the type of the values, you can use <code>interface{}</code> instead.</p>\n"}, {"comments": [{"owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "edited": false, "score": 0, "creation_date": 1460973431, "post_id": 36690579, "comment_id": 60969895, "body": "Thanks I was missing the {} before then opening the {} again :)"}], "tags": [], "owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "is_accepted": true, "score": 5, "last_activity_date": 1460973008, "creation_date": 1460973008, "answer_id": 36690579, "question_id": 36689892, "link": "https://stackoverflow.com/questions/36689892/golang-convert-array-map-to-json/36690579#36690579", "title": "Golang - convert array / map to JSON", "body": "<p>Use map[string]interface{} : </p>\n\n<pre><code>mapD := map[string]interface{}{\"deploy_status\": \"public\", \"status\": \"live\", \"version\": 2}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/G47FWxGILk\" rel=\"noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9282, "favorite_count": 1, "accepted_answer_id": 36690579, "answer_count": 2, "score": 1, "last_activity_date": 1460973008, "creation_date": 1460971036, "question_id": 36689892, "link": "https://stackoverflow.com/questions/36689892/golang-convert-array-map-to-json", "title": "Golang - convert array / map to JSON", "body": "<p>I am trying to convert a map[] to JSON so I can post it as part of a request. But my map[] has various types including strings / ints.</p>\n\n<p>I currently have:</p>\n\n<pre><code>mapD := map[string]string{\"deploy_status\": \"public\", \"status\": \"live\", \"version\": 2}\nmapB, _ := json.Marshal(mapD)\nfmt.Println(string(mapB))\n\n//output\nprog.go:17: cannot use 2 (type int) as type string in map value\n</code></pre>\n\n<p>How do I make it so that I can include strings and ints within the same map?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "ticker"], "comments": [{"owner": {"reputation": 6120, "user_id": 1309352, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/8ff1bfcff680fcc6dcd170ba54194ecb?s=128&d=identicon&r=PG", "display_name": "Bleeding Fingers", "link": "https://stackoverflow.com/users/1309352/bleeding-fingers"}, "edited": false, "score": 0, "creation_date": 1460971314, "post_id": 36689774, "comment_id": 60968405, "body": "The code has data race"}, {"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1460972219, "post_id": 36689774, "comment_id": 60969054, "body": "Because the for loop is still using the channel from the old ticker object and not using the channels from the new ticker objects."}, {"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "reply_to_user": {"reputation": 6120, "user_id": 1309352, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/8ff1bfcff680fcc6dcd170ba54194ecb?s=128&d=identicon&r=PG", "display_name": "Bleeding Fingers", "link": "https://stackoverflow.com/users/1309352/bleeding-fingers"}, "edited": false, "score": 0, "creation_date": 1460972523, "post_id": 36689774, "comment_id": 60969247, "body": "Thanks for your feedbacks. @BleedingFingers I see the data race (on the ticker var), but in this case shouldn&#39;t get a panic? Otherwise the pointer should be replaced with the new one.   @ NipunTalukdar I have thought the same too, if this is right - then means that the ticker pointer is &quot;cached&quot; in the range-loop and overriding is not possible. I will try this with another example."}, {"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "reply_to_user": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1460974683, "post_id": 36689774, "comment_id": 60970707, "body": "Yep, @NipunTalukdar, I guess that the <code>range</code> method caches the variable to be looped, then I think that overidding of the ticker like I suggested (using <code>range</code>) is not possible - <a href=\"http://play.golang.org/p/yZvrgURz4o\" rel=\"nofollow noreferrer\">play.golang.org/p/yZvrgURz4o</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "edited": false, "score": 0, "creation_date": 1460974462, "post_id": 36690829, "comment_id": 60970560, "body": "Thanks for your answer. Yep, I thought too that using <code>for</code>-loop instead <code>range</code>-loop can solve the issue. Just pay attention that when using <code>for</code>-loop you should manage the incoming channel with a <code>select</code>-catcher. To avoid confusing other developers - I will accept your answer if you edit the <code>for</code>-code using the correctly <code>select</code>-cases."}, {"owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "reply_to_user": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "edited": false, "score": 0, "creation_date": 1460976161, "post_id": 36690829, "comment_id": 60971617, "body": "The select is not doing anything special when the case is single. but I get the idea and the code is updated."}, {"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "edited": false, "score": 0, "creation_date": 1460977861, "post_id": 36690829, "comment_id": 60972785, "body": "my feedback was related to the &quot;exit&quot; function - to release all the variables used in the goroutines the <code>for</code>-loop should return. This happens even in single-case.  Btw it was not asked, want just to be more precise ;-)"}, {"owner": {"reputation": 4171, "user_id": 3258698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68f432d577e5550e36ec267b85884364?s=128&d=identicon&r=PG", "display_name": "hbejgel", "link": "https://stackoverflow.com/users/3258698/hbejgel"}, "edited": false, "score": 2, "creation_date": 1461008372, "post_id": 36690829, "comment_id": 60993524, "body": "It is worth noticing that when you call ticker.Stop() you don&#39;t actually close its channel, so the <code>log.Println(&quot;stopped&quot;)</code> line will never be reached. You should keep a secondary channel to signal when you&#39;re done and then <code>select</code> between the ticker and the secondary channel. You should also be stopping every old ticker before creating a new one."}, {"owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "reply_to_user": {"reputation": 4171, "user_id": 3258698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68f432d577e5550e36ec267b85884364?s=128&d=identicon&r=PG", "display_name": "hbejgel", "link": "https://stackoverflow.com/users/3258698/hbejgel"}, "edited": false, "score": 0, "creation_date": 1461039358, "post_id": 36690829, "comment_id": 61004258, "body": "@hbejgel the ticker.C is a receive-only channel. you can not close a receive-only channel. the owner of channel who has the whole ref to it can close it. see <a href=\"https://golang.org/pkg/time/#Ticker\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Ticker</a>"}, {"owner": {"reputation": 4171, "user_id": 3258698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68f432d577e5550e36ec267b85884364?s=128&d=identicon&r=PG", "display_name": "hbejgel", "link": "https://stackoverflow.com/users/3258698/hbejgel"}, "edited": false, "score": 0, "creation_date": 1461092948, "post_id": 36690829, "comment_id": 61038621, "body": "I am aware of this, and because of that you will never escape the <code>for</code> loop inside the goroutine. Therefore the goroutine will never print the expected line <code>stopped</code>"}], "tags": [], "owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "is_accepted": false, "score": 1, "last_activity_date": 1460976111, "last_edit_date": 1460976111, "creation_date": 1460973690, "answer_id": 36690829, "question_id": 36689774, "link": "https://stackoverflow.com/questions/36689774/dynamically-change-ticker-interval/36690829#36690829", "title": "dynamically change ticker interval", "body": "<p>As Nipun Talukdar mentioned, the \"for\" capture the channel and use the same reference for iterate. it fixed if you use it like this : </p>\n\n<p><a href=\"http://play.golang.org/p/AEygFsb-7W\" rel=\"nofollow\">playground</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n    interval := float64(1000)\n\n    ticker := time.NewTicker(time.Duration(interval) * time.Millisecond)\n    go func() {\n        counter := 1.0\n        for {\n            select {\n            case &lt;-ticker.C:\n                log.Println(\"ticker accelerating to \" + fmt.Sprint(interval/counter) + \" ms\")\n                ticker = time.NewTicker(time.Duration(interval/counter) * time.Millisecond)\n                counter++\n            }\n        }\n        log.Println(\"stopped\")\n    }()\n    time.Sleep(5 * time.Second)\n    log.Println(\"stopping ticker\")\n    ticker.Stop()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 135, "user_id": 405407, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e717c3a27e45887c4578f649f4e6c86e?s=128&d=identicon&r=PG", "display_name": "chinuy", "link": "https://stackoverflow.com/users/405407/chinuy"}, "edited": false, "score": 1, "creation_date": 1519156262, "post_id": 36709984, "comment_id": 84791847, "body": "Will creating new <code>time.NewTicker</code> increase overhead of the garbage collection?"}, {"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "reply_to_user": {"reputation": 135, "user_id": 405407, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e717c3a27e45887c4578f649f4e6c86e?s=128&d=identicon&r=PG", "display_name": "chinuy", "link": "https://stackoverflow.com/users/405407/chinuy"}, "edited": false, "score": 1, "creation_date": 1519161405, "post_id": 36709984, "comment_id": 84794517, "body": "good question @chinuy - I would say that GC is needed there even if I am doing a replacement of the var <code>ticker</code>. If you look at the code of <code>time.NewTicker</code> <a href=\"https://golang.org/src/time/tick.go?s=706:740#L11\" rel=\"nofollow noreferrer\">HERE</a> you can see that it creates some local structs that need to be collected at some point by the garbage collector. In conclusion: yes, it increase the overhead of GC"}], "tags": [], "owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "is_accepted": true, "score": 8, "last_activity_date": 1461082090, "last_edit_date": 1461082090, "creation_date": 1461046443, "answer_id": 36709984, "question_id": 36689774, "link": "https://stackoverflow.com/questions/36689774/dynamically-change-ticker-interval/36709984#36709984", "title": "dynamically change ticker interval", "body": "<p>Following the answer to @fzerorubigd but a little more complete. </p>\n\n<p>As said before, we can't use the <code>range</code> for this case, because the <code>range</code> loop caches the variable to be lopped and then it can't be overwritten (example here: <a href=\"http://play.golang.org/p/yZvrgURz4o\" rel=\"noreferrer\">http://play.golang.org/p/yZvrgURz4o</a> )</p>\n\n<p>Then, we should use a <code>for</code>-<code>select</code> combination loop. Hereafter the working solution:</p>\n\n<p><a href=\"http://play.golang.org/p/3uJrAIhnTQ\" rel=\"noreferrer\">http://play.golang.org/p/3uJrAIhnTQ</a></p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"log\"\n    \"fmt\"\n)\n\nfunc main() {\n    start_interval := float64(1000)\n    quit := make(chan bool)\n\n    go func(){\n        ticker := time.NewTicker(time.Duration(start_interval) * time.Millisecond)\n        counter := 1.0\n\n        for {\n            select {\n            case &lt;-ticker.C:\n                log.Println(\"ticker accelerating to \" + fmt.Sprint(start_interval/counter) + \" ms\")\n                ticker.Stop()\n                ticker = time.NewTicker(time.Duration(start_interval/counter) * time.Millisecond)\n                counter++\n            case &lt;-quit:\n                ticker.Stop()\n                log.Println(\"..ticker stopped!\")\n                return\n            }\n        }\n    }()\n\n    time.Sleep(5 * time.Second)\n\n    log.Println(\"stopping ticker...\")\n    quit&lt;-true\n\n    time.Sleep(500 * time.Millisecond) // just to see quit messages\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "is_accepted": false, "score": 0, "last_activity_date": 1565720224, "creation_date": 1565720224, "answer_id": 57483344, "question_id": 36689774, "link": "https://stackoverflow.com/questions/36689774/dynamically-change-ticker-interval/57483344#57483344", "title": "dynamically change ticker interval", "body": "<p>What about this code:</p>\n\n<p><a href=\"https://play.golang.org/p/wyOTVxUW5Xj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wyOTVxUW5Xj</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n    startInterval := float64(1000)\n    quit := make(chan bool)\n\n    go func() {\n        counter := 1.0\n        for {\n            select {\n            case &lt;-time.After(time.Duration(startInterval/counter) * time.Millisecond):\n                log.Println(\"ticker accelerating to \" + fmt.Sprint(startInterval/counter) + \" ms\")\n                counter++\n            case &lt;-quit:\n                log.Println(\"..ticker stopped!\")\n                return\n            }\n        }\n    }()\n\n    time.Sleep(5 * time.Second)\n    log.Println(\"stopping ticker...\")\n    quit &lt;- true\n    time.Sleep(500 * time.Millisecond) // just to see quit messages\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "edited": false, "score": 0, "creation_date": 1603569308, "post_id": 64433276, "comment_id": 114081162, "body": "Although reset does work, the <a href=\"https://golang.org/pkg/time/#Timer.Reset\" rel=\"nofollow noreferrer\">documentation</a> states <code>Reset should be invoked only on stopped or expired timers with drained channels.</code> So I wouldn&#39;t suggest resetting an active ticker."}, {"owner": {"reputation": 573, "user_id": 9100468, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CmkMNlW2J6k/AAAAAAAAAAI/AAAAAAAAYbA/S66MIb_UIX0/photo.jpg?sz=128", "display_name": "Isaac Weingarten", "link": "https://stackoverflow.com/users/9100468/isaac-weingarten"}, "reply_to_user": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "edited": false, "score": 1, "creation_date": 1603668876, "post_id": 64433276, "comment_id": 114102054, "body": "you confusing it with <code>time.timer{}.Reset()</code> on <code>time.tiker{}.Reset()</code> dosn&#39;t have this worning, here is the <a href=\"https://golang.org/pkg/time/#Ticker.Reset\" rel=\"nofollow noreferrer\">documentation</a> for it"}, {"owner": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "edited": false, "score": 0, "creation_date": 1604044052, "post_id": 64433276, "comment_id": 114232148, "body": "It&#39;s worth noting <code>ticker.Reset</code> method is available from go1.15."}, {"owner": {"reputation": 573, "user_id": 9100468, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CmkMNlW2J6k/AAAAAAAAAAI/AAAAAAAAYbA/S66MIb_UIX0/photo.jpg?sz=128", "display_name": "Isaac Weingarten", "link": "https://stackoverflow.com/users/9100468/isaac-weingarten"}, "reply_to_user": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "edited": false, "score": 0, "creation_date": 1604270572, "post_id": 64433276, "comment_id": 114289242, "body": "Please explain what\u2019s your problem with go1.15? The compiler will work with older code"}, {"owner": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "edited": false, "score": 0, "creation_date": 1604414286, "post_id": 64433276, "comment_id": 114336599, "body": "@Issac it&#39;s not a problem, but worth noting. I used earlier version (1.14) and it didn&#39; work."}], "tags": [], "owner": {"reputation": 573, "user_id": 9100468, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CmkMNlW2J6k/AAAAAAAAAAI/AAAAAAAAYbA/S66MIb_UIX0/photo.jpg?sz=128", "display_name": "Isaac Weingarten", "link": "https://stackoverflow.com/users/9100468/isaac-weingarten"}, "is_accepted": false, "score": 0, "last_activity_date": 1603674743, "last_edit_date": 1603674743, "creation_date": 1603132532, "answer_id": 64433276, "question_id": 36689774, "link": "https://stackoverflow.com/questions/36689774/dynamically-change-ticker-interval/64433276#64433276", "title": "dynamically change ticker interval", "body": "<p>that why in go1.15 <code>ticker.Reset</code> is created, you don't need to create a new ticker update the existing tickers duration with <code>ticker.Reset(&quot;new duration&quot;)</code>, and now you will not have any cache issues</p>\n<p><a href=\"https://play.golang.org/p/elV-eafPRzV\" rel=\"nofollow noreferrer\">Go playground</a></p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;log&quot;\n    &quot;time&quot;\n)\n\nfunc main() {\n    interval := float64(1000)\n\n    ticker := time.NewTicker(time.Duration(interval) * time.Millisecond)\n    go func(){\n        counter := 1.0\n        for range ticker.C {\n            log.Println(&quot;ticker accelerating to &quot; + fmt.Sprint(interval/counter) + &quot; ms&quot;)\n            ticker.Reset(time.Duration(interval/counter) * time.Millisecond)\n            counter++\n        }\n        log.Println(&quot;stopped&quot;)\n    }()\n    time.Sleep(5 * time.Second)\n    log.Println(&quot;stopping ticker&quot;)\n    ticker.Stop()\n}\n</code></pre>\n<p>The reason your example have a cache issue is that when you reassign the <code>ticker</code> variable with a <code>*time.ticker</code> struct you just unlink the original <code>*time.ticker</code> struct from the <code>ticker</code> variable but the loop is still tide to the original ticker channel you need to reassin a new loop to the new <code>time.ticker.c</code></p>\n"}], "owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8190, "favorite_count": 1, "accepted_answer_id": 36709984, "answer_count": 4, "score": 10, "last_activity_date": 1603674743, "creation_date": 1460970685, "last_edit_date": 1460970996, "question_id": 36689774, "link": "https://stackoverflow.com/questions/36689774/dynamically-change-ticker-interval", "title": "dynamically change ticker interval", "body": "<p>I would like to change my ticker interval dynamically. </p>\n\n<p>I've written down an example to show you how I did. My use case is something else than an \"accelerometer\" but I hope that it gives you an idea. </p>\n\n<p><a href=\"http://play.golang.org/p/6ANFnoE6pA\" rel=\"noreferrer\">http://play.golang.org/p/6ANFnoE6pA</a></p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"log\"\n    \"fmt\"\n)\n\nfunc main() {\n    interval := float64(1000)\n\n    ticker := time.NewTicker(time.Duration(interval) * time.Millisecond)\n    go func(){\n        counter := 1.0\n        for range ticker.C {\n            log.Println(\"ticker accelerating to \" + fmt.Sprint(interval/counter) + \" ms\")\n            ticker = time.NewTicker(time.Duration(interval/counter) * time.Millisecond)\n            counter++\n        }\n        log.Println(\"stopped\")\n    }()\n    time.Sleep(5 * time.Second)\n    log.Println(\"stopping ticker\")\n    ticker.Stop()\n}\n</code></pre>\n\n<p>What is wrong is that the ticker will always \"tick\" every seconds and it doesn't accelerate... Any idea?</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1460980899, "post_id": 36688872, "comment_id": 60974967, "body": "When you say mock functions inside the tested function, what do you mean exactly?"}, {"owner": {"reputation": 186, "user_id": 1654618, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/74e72c47440e4a4e2477ef53de506cc5?s=128&d=identicon&r=PG", "display_name": "Ciack404", "link": "https://stackoverflow.com/users/1654618/ciack404"}, "reply_to_user": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1460982574, "post_id": 36688872, "comment_id": 60976177, "body": "Updated the question with an example. I hope it&#39;s clearer. I&#39;m quite new to tests and I am not 100% sure even how to ask"}, {"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1460982906, "post_id": 36688872, "comment_id": 60976429, "body": "You need to clarify more. Are these functions in the package you are testing?"}, {"owner": {"reputation": 186, "user_id": 1654618, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/74e72c47440e4a4e2477ef53de506cc5?s=128&d=identicon&r=PG", "display_name": "Ciack404", "link": "https://stackoverflow.com/users/1654618/ciack404"}, "reply_to_user": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1460983066, "post_id": 36688872, "comment_id": 60976558, "body": "f1 and f2 aren&#39;t in the tested package, f3 is (but in the actual code f2 is called in another function inside the tested package, so there is one more layer)"}], "answers": [{"comments": [{"owner": {"reputation": 186, "user_id": 1654618, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/74e72c47440e4a4e2477ef53de506cc5?s=128&d=identicon&r=PG", "display_name": "Ciack404", "link": "https://stackoverflow.com/users/1654618/ciack404"}, "edited": false, "score": 0, "creation_date": 1460995496, "post_id": 36696853, "comment_id": 60985913, "body": "Hi, thanks for the answer. The problem is that the interface I need to use isn&#39;t in the same package I need to test. Is it possible to implement an interface in a different package? I am looking but can&#39;t find an example"}, {"owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "reply_to_user": {"reputation": 186, "user_id": 1654618, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/74e72c47440e4a4e2477ef53de506cc5?s=128&d=identicon&r=PG", "display_name": "Ciack404", "link": "https://stackoverflow.com/users/1654618/ciack404"}, "edited": false, "score": 0, "creation_date": 1460999396, "post_id": 36696853, "comment_id": 60988222, "body": "Yes, you can still implement another interface in another package. Go is unlike Java in that it doesn&#39;t require an explicit &quot;implements&quot; to adhere to an interface, instead its actually more like duck typing in dynamic languages. All you have to do is have the same methods for the particular struct and that struct can be used to satisfy the interface that the function expects."}, {"owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "reply_to_user": {"reputation": 186, "user_id": 1654618, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/74e72c47440e4a4e2477ef53de506cc5?s=128&d=identicon&r=PG", "display_name": "Ciack404", "link": "https://stackoverflow.com/users/1654618/ciack404"}, "edited": false, "score": 0, "creation_date": 1461000508, "post_id": 36696853, "comment_id": 60988849, "body": "@Ciack404 I updated the code sample to template the interface code that may be of interest. Let me know if that helps."}], "tags": [], "owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "is_accepted": true, "score": 5, "last_activity_date": 1461000484, "last_edit_date": 1461000484, "creation_date": 1460989724, "answer_id": 36696853, "question_id": 36688872, "link": "https://stackoverflow.com/questions/36688872/golang-test-mock-functions-best-practices/36696853#36696853", "title": "Golang test mock functions best practices", "body": "<p>As a general guideline, functions aren't very mockable so its in our best interests to mock structs that implement a certain interface that may be passed into functions to test the different branches of code. See below for a basic example.</p>\n\n<pre><code>package a\n\ntype DoSomethingInterface interface {\n    DoSomething() error\n}\n\n\nfunc DoSomething(a DoSomethingInterface) {\n    if err := a.DoSomething(); err != nil {\n        fmt.Println(\"error occurred\")\n        return\n    }\n    fmt.Println(\"no error occurred\")\n    return\n}\n\npackage a_test\n\nimport (\n    \"testing\"\n    \"&lt;path to a&gt;/a\"\n)\n\ntype simpleMock struct {\n    err error\n}\n\nfunc (m *simpleMock) DoSomething() error {\n    return m.err\n}\n\nfunc TestDoSomething(t *testing.T) {\n    errorMock := &amp;simpleMock{errors.New(\"some error\")}\n    a.DoSomething(errorMock)\n    // test that \"an error occurred\" is logged\n\n    regularMock := &amp;simpleMock{}\n    a.DoSomething(regularMock)\n    // test \"no error occurred\" is logged\n}\n</code></pre>\n\n<p>In the above example, you would test the <code>DoSomething</code> function and the branches that happens eg. you would create an instance of the mock with an error for one test case and create another instance of the mock without the error to test the other case. The respective cases are to test a certain string has been logged to standard out; in this case it would be <code>\"error occurred\"</code> when <code>simpleMock</code> is instantiated with an error and <code>\"no error occurred\"</code> when there <code>simpleMock</code> is not instantiated with an error. </p>\n\n<p>This can of course be expanded to other cases eg. the <code>DoSomething</code> function actually returns some kind of value and you want to make an <code>assertion</code> on the value. </p>\n\n<p><strong>Edit:</strong></p>\n\n<p>I updated the code with the concern that the interface lives in another package. Note that the new updated code has a package <code>a</code> that contains the interface and the function under test and a package <code>a_test</code> that is merely a template of how to approach testing <code>a.DoSomething</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 186, "user_id": 1654618, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/74e72c47440e4a4e2477ef53de506cc5?s=128&d=identicon&r=PG", "display_name": "Ciack404", "link": "https://stackoverflow.com/users/1654618/ciack404"}, "edited": false, "score": 0, "creation_date": 1460995700, "post_id": 36697143, "comment_id": 60986031, "body": "Hi, thanks for the reply. But what happens if a function in package2 is using a function (interface) from package1 that I need to mock? If I get it right in your example you test all functions in the same package, correct?"}, {"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "reply_to_user": {"reputation": 186, "user_id": 1654618, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/74e72c47440e4a4e2477ef53de506cc5?s=128&d=identicon&r=PG", "display_name": "Ciack404", "link": "https://stackoverflow.com/users/1654618/ciack404"}, "edited": false, "score": 0, "creation_date": 1460997077, "post_id": 36697143, "comment_id": 60986866, "body": "so you need to call a function from pack1? Do this:   `  import pack1; pack1.Function() // calls the function  The function needs to be public though (begins with a uppercase letter)."}], "tags": [], "owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "is_accepted": false, "score": 0, "last_activity_date": 1460990417, "creation_date": 1460990417, "answer_id": 36697143, "question_id": 36688872, "link": "https://stackoverflow.com/questions/36688872/golang-test-mock-functions-best-practices/36697143#36697143", "title": "Golang test mock functions best practices", "body": "<p>I'm not sure what you're trying to do here but I'll explain how testing should be done in Go. </p>\n\n<p>Lets say we have an application with the following directory hierarchy:</p>\n\n<pre><code>root/\n  pack1/\n    pack1.go\n    pack1_test.go\n  pack2/\n    pack2.go\n    pack2_test.go\n  main.go\n  main_test.go\n</code></pre>\n\n<p>We'll assume that <code>pack2.go</code> has the functions you want to test:</p>\n\n<pre><code>package pack2 \n\nfunc f1() error {\n  ... //some API call\n}\n\nfunc (s *SomeStruct) f2() error {\n  return f1\n}\n\nfunc f3() error {\n  return nil\n}\n\nfunc f4() error {\n  ...\n  err = obj.f2()\n  ...\n  err = f3()\n  ...\n}\n</code></pre>\n\n<p>Looks good so far. Now if you want to test the functions in pack2, you would create a file called <code>pack2_test.go</code>. All test files in go are named similarly (packagename_test.go). Now lets see the inside of a typical test for a package (pack2_test.go in this example):</p>\n\n<pre><code>package pack2\n\nimport (\n  \"testing\"\n  \"fmt\"\n)\n\nTestF1(*testing.T) {\n  x := \"something for testing\"\n  f1() // This tests f1 from the package \"pact2.go\"\n}\n\n\nTestF2(*testing.T) {\n    y := new(somestruct) \n    y.f2() // tests f2 from package \"pact2.go\"\n}\n\n\nTestF3(*testing.T) {\n   /// some code\n   f3() // tests f3\n}\n\n\nTestF4(*testing.T) {\n    /// code\n    f3() // you get the gist\n}\n</code></pre>\n\n<p>Let me explain. Notice how in pack2_test.go, the first line says that the package is <code>pack2</code>. In a nutshell, this means that we're in the \"scope\" of the package <code>pack2</code> and thus all the functions found in <code>pack2</code> can be called as if you're within <code>pack2</code>. Thats why, within the Testf* functions, we could've called the functions from <code>pack2</code>. Another thing to note is the imported package \"testing\". This helps with two things:</p>\n\n<p>First, it provides some functionality for running tests. I won't go into that.\nSecond, it helps identify the functions that <code>go test</code> should run. </p>\n\n<p>Now to the functions. Any function within a test package that has the prefix \"Test\" and the parameters \"t *testing.T\" (you can use \"*testing.T\" when you don't need to use the testing functionality) will be executed when you run  <code>go test</code>. You use the variable <code>t</code> to reference the testing functionality I mentioned. You can also declare functions without the prefix and call them within the prefixed functions.</p>\n\n<p>So, if I go to my terminal and run <code>go test</code>, it will execute the functions you want to test, specified in <code>pack2_test.go</code></p>\n\n<p>You can learn more about testing <a href=\"https://www.golang-book.com/books/intro/12\" rel=\"nofollow\">here</a> and <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow\">here</a></p>\n"}], "owner": {"reputation": 186, "user_id": 1654618, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/74e72c47440e4a4e2477ef53de506cc5?s=128&d=identicon&r=PG", "display_name": "Ciack404", "link": "https://stackoverflow.com/users/1654618/ciack404"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9210, "favorite_count": 2, "accepted_answer_id": 36696853, "answer_count": 2, "score": 3, "last_activity_date": 1461000484, "creation_date": 1460967990, "last_edit_date": 1460982459, "question_id": 36688872, "link": "https://stackoverflow.com/questions/36688872/golang-test-mock-functions-best-practices", "title": "Golang test mock functions best practices", "body": "<p>I am developing some tests for my code (using the <em>testing</em> package), and I am wondering what's the best way to mock functions inside the tested function:</p>\n\n<p>Should I pass the function as parameter?\nIn that case, what if that function calls another function? Should I pass both the first and second function as parameters in the tested one?</p>\n\n<p>Note: some of the functions are called on objects (i.e. someObj.Create()) and use HTTP API calls.</p>\n\n<p>UPDATE for clarification:</p>\n\n<p>Example: functions</p>\n\n<pre><code>func f1() error {\n  ... //some API call\n}\n\nfunc (s *SomeStruct) f2() error {\n  return f1\n}\n\nfunc f3() error {\n  return nil\n}\n\nfunc f4() error {\n  ...\n  err = obj.f2()\n  ...\n  err = f3()\n  ...\n}\n</code></pre>\n\n<p>For the above: if I want to test f4, what's the best way to mock f2 and f3?</p>\n\n<p>If I pass f2 and f3 to f4 as parameters it would work, but then what for the f2 test? Should I pass f1 to f2 as parameter?</p>\n\n<p>And if that's it, should then f4 have f1 as well in the parameters?</p>\n"}, {"tags": ["go", "garbage-collection"], "answers": [{"comments": [{"owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "edited": false, "score": 0, "creation_date": 1460974106, "post_id": 36688970, "comment_id": 60970342, "body": "The client dose not need any special function call, but if the response.Body is used (the result of calling Do, or Get/Post/... functions) , you must close it with <code>resp.Body.Close()</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "edited": false, "score": 0, "creation_date": 1460974535, "post_id": 36688970, "comment_id": 60970611, "body": "@fzerorubigd But that is not a method of <code>http.Client</code>, and it has nothing to do with <code>http.Client</code>. It does not free any resources related to <code>http.Client</code> but resources related to the connection."}, {"owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "edited": false, "score": 3, "creation_date": 1460975635, "post_id": 36688970, "comment_id": 60971307, "body": "I know. and I said that. but this is the common pitfall in using http.Client anyway (done this once) and I think it&#39;s not a bad idea to mention it here :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 17, "last_activity_date": 1460978608, "last_edit_date": 1592644375, "creation_date": 1460968312, "answer_id": 36688970, "question_id": 36688633, "link": "https://stackoverflow.com/questions/36688633/how-to-release-http-client-in-go/36688970#36688970", "title": "How to release http.Client in Go?", "body": "<p><a href=\"https://golang.org/pkg/net/http/#Client\" rel=\"noreferrer\"><code>http.Client</code></a> does not require any special way to free &quot;used&quot; resources. When it becomes unreachable, memory used by it will be reclaimed by the garbage collector.</p>\n<p><code>http.Client</code> does not store connection or state information. The documentation even states that <code>http.Client</code> should be reused:</p>\n<blockquote>\n<p>The Client's Transport typically has internal state (cached TCP connections), so Clients should be reused instead of created as needed. Clients are safe for concurrent use by multiple goroutines.</p>\n</blockquote>\n<p>If you build your own client using (e.g. embedding) <code>http.Client</code> and you allocate resources that must be released explicitly, provide your own <code>Close()</code> method on it and document that anyone who uses your own implementation must call <code>Close()</code> if it is not needed anymore.</p>\n<p><strong>Note:</strong></p>\n<p>What you might confuse it with is that if you use an <code>http.Client</code> to do HTTP operations (like <a href=\"https://golang.org/pkg/net/http/#Client.Do\" rel=\"noreferrer\"><code>Client.Do()</code></a>, <a href=\"https://golang.org/pkg/net/http/#Client.Get\" rel=\"noreferrer\"><code>Client.Get()</code></a>, <a href=\"https://golang.org/pkg/net/http/#Client.Post\" rel=\"noreferrer\"><code>Client.Post()</code></a> etc.), they return a value of <a href=\"https://golang.org/pkg/net/http/#Response\" rel=\"noreferrer\"><code>*http.Response</code></a>, and that response does hold a connection, state and other resources, which <strong>does</strong> need to be freed, typically via <code>Response.Body.Close()</code>. Quoting from the package doc of <code>http</code>:</p>\n<blockquote>\n<p>The client must close the response body when finished with it:</p>\n<pre><code>resp, err := http.Get(&quot;http://example.com/&quot;)\nif err != nil {\n  // handle error\n}\ndefer resp.Body.Close()\nbody, err := ioutil.ReadAll(resp.Body)\n// ...\n</code></pre>\n</blockquote>\n<p>It is also documented at <code>Client.Get()</code>:</p>\n<blockquote>\n<p>When err is nil, resp always contains a non-nil resp.Body. Caller should close resp.Body when done reading from it.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "is_accepted": false, "score": 1, "last_activity_date": 1572887434, "creation_date": 1572887434, "answer_id": 58698122, "question_id": 36688633, "link": "https://stackoverflow.com/questions/36688633/how-to-release-http-client-in-go/58698122#58698122", "title": "How to release http.Client in Go?", "body": "<p>The <code>CloseIdleConnections()</code> method was added in Go 1.12. </p>\n\n<p><a href=\"https://golang.org/pkg/net/http/#Client.CloseIdleConnections\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Client.CloseIdleConnections</a></p>\n\n<blockquote>\n  <p>CloseIdleConnections closes any connections on its Transport which were previously connected from previous requests but are now sitting idle in a \"keep-alive\" state. It does not interrupt any connections currently in use.</p>\n</blockquote>\n"}], "owner": {"reputation": 15493, "user_id": 380774, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3772ea86cd39ce7e63280ecfffb6512c?s=128&d=identicon&r=PG", "display_name": "fannheyward", "link": "https://stackoverflow.com/users/380774/fannheyward"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8108, "favorite_count": 3, "accepted_answer_id": 36688970, "answer_count": 2, "score": 6, "last_activity_date": 1589319881, "creation_date": 1460967326, "last_edit_date": 1589319881, "question_id": 36688633, "link": "https://stackoverflow.com/questions/36688633/how-to-release-http-client-in-go", "title": "How to release http.Client in Go?", "body": "<p>I built a <code>http.Client</code> for HTTP2 connection, what do I need to do to release the client and resource used?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1460969407, "post_id": 36688577, "comment_id": 60967135, "body": "Do what &quot;Set $GOROOT_BOOTSTRAP to a working Go tree &gt;= Go 1.4&quot; tells you to do."}], "answers": [{"tags": [], "owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "is_accepted": true, "score": 1, "last_activity_date": 1460968977, "creation_date": 1460968977, "answer_id": 36689186, "question_id": 36688577, "link": "https://stackoverflow.com/questions/36688577/error-while-installing-go-from-source/36689186#36689186", "title": "error while installing go from source", "body": "<p>You need to have an installed Go version 1.4 or newer to build the recent Go releases. The build script defaults to some path but if it's not there you need to set GOROOT_BOOTSTRAP environment variable to point to a previous working Go installation.</p>\n"}, {"comments": [{"owner": {"reputation": 787, "user_id": 1589669, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/G02Bx.jpg?s=128&g=1", "display_name": "eapo", "link": "https://stackoverflow.com/users/1589669/eapo"}, "edited": false, "score": 1, "creation_date": 1504886838, "post_id": 43379321, "comment_id": 79203648, "body": "on raspberry i have this error after running <code>sudo update-alternatives --set go &#47;usr&#47;bin&#47;go-5</code> please help to understand: <code>update-alternatives: error: no alternatives for go</code>"}, {"owner": {"reputation": 190, "user_id": 3936509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd6c3d893542310a77fe4dda99523683?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3936509/alex"}, "reply_to_user": {"reputation": 787, "user_id": 1589669, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/G02Bx.jpg?s=128&g=1", "display_name": "eapo", "link": "https://stackoverflow.com/users/1589669/eapo"}, "edited": false, "score": 0, "creation_date": 1504890921, "post_id": 43379321, "comment_id": 79205674, "body": "please look at this <a href=\"https://askubuntu.com/a/372280\">post</a>, you probably have to install your alternative before setting it"}], "tags": [], "owner": {"reputation": 190, "user_id": 3936509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd6c3d893542310a77fe4dda99523683?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3936509/alex"}, "is_accepted": false, "score": 3, "last_activity_date": 1492029843, "creation_date": 1492029843, "answer_id": 43379321, "question_id": 36688577, "link": "https://stackoverflow.com/questions/36688577/error-while-installing-go-from-source/43379321#43379321", "title": "error while installing go from source", "body": "<p>Go is written in Go (starting from version 1.5) so you have to install Go1.4 first. Just get Go Version Manager and run:</p>\n\n<pre><code>$ gvm install go1.4 \n$ gvm use go1.4 \n$ export GOROOT_BOOTSTRAP=$GOROOT\n</code></pre>\n\n<p>Another approach is about to install gcc go frontend:</p>\n\n<pre><code>$ sudo apt-get install gccgo-5\n$ sudo update-alternatives --set go /usr/bin/go-5\n$ export GOROOT_BOOTSTRAP=/usr\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2904, "user_id": 5832720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb8ed71cd77d9da995685ca872b303e7?s=128&d=identicon&r=PG", "display_name": "Nikhita Raghunath", "link": "https://stackoverflow.com/users/5832720/nikhita-raghunath"}, "is_accepted": false, "score": 0, "last_activity_date": 1498405441, "creation_date": 1498405441, "answer_id": 44747952, "question_id": 36688577, "link": "https://stackoverflow.com/questions/36688577/error-while-installing-go-from-source/44747952#44747952", "title": "error while installing go from source", "body": "<p>If you are not using gvm and are on Linux, your go binary is mostly installed at <code>/usr/local/go/bin/go</code>. You need to set <code>/usr/local/go</code> as your <code>GOROOT_BOOTSTRAP</code> by:</p>\n\n<pre><code>$ export GOROOT_BOOTSTRAP=/usr/local/go\n</code></pre>\n"}], "owner": {"reputation": 1044, "user_id": 2931666, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/5gBzA.jpg?s=128&g=1", "display_name": "Abhi Adr", "link": "https://stackoverflow.com/users/2931666/abhi-adr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7727, "favorite_count": 1, "accepted_answer_id": 36689186, "answer_count": 3, "score": 6, "last_activity_date": 1498405441, "creation_date": 1460967127, "question_id": 36688577, "link": "https://stackoverflow.com/questions/36688577/error-while-installing-go-from-source", "title": "error while installing go from source", "body": "<p>i am trying to install go from source </p>\n\n<p>i follow this steps </p>\n\n<pre><code>git clone https://go.googlesource.com/go\ncd go\ngit checkout go1.6.1\n\ncd src\n./all.bash\n</code></pre>\n\n<p>now it gives me the error saying </p>\n\n<pre><code>##### Building Go bootstrap tool.\ncmd/dist\nERROR: Cannot find /root/go1.4/bin/go.\nSet $GOROOT_BOOTSTRAP to a working Go tree &gt;= Go 1.4.\n</code></pre>\n\n<p>any idea how can i fix this do i just need to set env variable or any other installation is needed ?</p>\n"}, {"tags": ["go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1460970060, "last_edit_date": 1460970060, "creation_date": 1460966752, "answer_id": 36688464, "question_id": 36688359, "link": "https://stackoverflow.com/questions/36688359/how-to-find-out-diagonal-difference-in-go-programming/36688464#36688464", "title": "How to find out diagonal difference in go programming?", "body": "<p>This line:</p>\n\n<pre><code>s := make([][]int, n)\n</code></pre>\n\n<p>Creates a slice of slices, a slice whose elements are of type <code>[]int</code>. It creates a slice with <code>n</code> elements, but the elements of the outer slice are initialized with the zero value of the element type, and zero value of type <code>[]int</code> is <code>nil</code> (just like for any slice type).</p>\n\n<p>You get <code>index out of range</code> panic because any element of the outer slice <code>s</code> has zero length (because they are not initialized to a non-<code>nil</code> slice), so <code>s[i][j]</code> panics for any <code>j</code> value.</p>\n\n<p>If you want to assign elements to the \"inner\" slices, you also have to initialize them:</p>\n\n<pre><code>for i := 0; i &lt; n; i++ {\n    s[i] = make([]int, n) // YOU ARE MISSING THIS LINE\n    for j := 0; j &lt; n; j++ {\n        fmt.Scanf(\"%d %d\", &amp;s[i][j])\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 6218604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ddc9aee7dbe6aaef1d605e656db5e59?s=128&d=identicon&r=PG&f=1", "display_name": "S.Mastud", "link": "https://stackoverflow.com/users/6218604/s-mastud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 36688464, "answer_count": 1, "score": 1, "last_activity_date": 1460970060, "creation_date": 1460966378, "last_edit_date": 1460966988, "question_id": 36688359, "link": "https://stackoverflow.com/questions/36688359/how-to-find-out-diagonal-difference-in-go-programming", "title": "How to find out diagonal difference in go programming?", "body": "<p>My code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var n int\n    fmt.Scan(&amp;n)\n    s := make([][]int, n)\n    for i := 0; i &lt; n; i++ {\n        for j := 0; j &lt; n; j++ {\n            fmt.Scanf(\"%d %d\", &amp;s[i][j])\n        }\n    }\n    s1 := 0\n    s2 := 0\n    for i := 0; i &lt; n; i++ {\n        for j := 0; j &lt; n; j++ {\n            if i == j {\n                s1 += s[i][j]\n            }\n            if i+j == n-1 {\n                s2 += s[i][j]\n            }\n        }\n        fmt.Println(s1 - s2)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>panic: runtime error: index out of range\n</code></pre>\n\n<p>I tried but get panic. I want to know proper solution to this problem.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 374, "user_id": 2191327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e2d23ec4edc6915a63ad495cc6b2ac?s=128&d=identicon&r=PG", "display_name": "user2191327", "link": "https://stackoverflow.com/users/2191327/user2191327"}, "edited": false, "score": 0, "creation_date": 1460968693, "post_id": 36688610, "comment_id": 60966691, "body": "thanks for reply, but i can&#39;t do this: connpool package do not contain that interface, by adding it we will change nothing, it will become pool.ConnInterface in main packege, not ConnInterface, so we will still have  the leaky dependency"}, {"owner": {"reputation": 271, "user_id": 4621159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2074b013614ff775ea6b0368b0f8e6?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Gustafsson", "link": "https://stackoverflow.com/users/4621159/tobias-gustafsson"}, "reply_to_user": {"reputation": 374, "user_id": 2191327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e2d23ec4edc6915a63ad495cc6b2ac?s=128&d=identicon&r=PG", "display_name": "user2191327", "link": "https://stackoverflow.com/users/2191327/user2191327"}, "edited": false, "score": 0, "creation_date": 1460969430, "post_id": 36688610, "comment_id": 60967146, "body": "To me it appears that the right way to do it would be to put the interfaces in the same package that the original implementation is located (<code>connpool</code>). Or are you unable to modify the <code>connpool</code> package? I don&#39;t really understand what you mean by leaky dependency in this case. If you have something against mixing implementation and interface in the same package you can put the interfaces in their own packages. I don&#39;t really see the point in that though."}, {"owner": {"reputation": 374, "user_id": 2191327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e2d23ec4edc6915a63ad495cc6b2ac?s=128&d=identicon&r=PG", "display_name": "user2191327", "link": "https://stackoverflow.com/users/2191327/user2191327"}, "edited": false, "score": 0, "creation_date": 1460972932, "post_id": 36688610, "comment_id": 60969566, "body": "well, i&#39;m not very eloquent, i just added new info into the question with test example, hope it will explain why i want declare interfaces in main package, thanks for you attention"}, {"owner": {"reputation": 271, "user_id": 4621159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2074b013614ff775ea6b0368b0f8e6?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Gustafsson", "link": "https://stackoverflow.com/users/4621159/tobias-gustafsson"}, "reply_to_user": {"reputation": 374, "user_id": 2191327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e2d23ec4edc6915a63ad495cc6b2ac?s=128&d=identicon&r=PG", "display_name": "user2191327", "link": "https://stackoverflow.com/users/2191327/user2191327"}, "edited": false, "score": 0, "creation_date": 1460997001, "post_id": 36688610, "comment_id": 60986819, "body": "Sorry, I don&#39;t really think I understand your problem. If you are going to mock the interfaces you&#39;ll have to implement them. Right? I might understand what you want to do though. You want all of your methods on the connection pools to take and return concrete types of connections while still implementing the <code>ConnPoolInterface</code>. Is that right? I don&#39;t think that&#39;s possible. I still think that having the interfaces in  connpool is the right thing to do. After all you probably don&#39;t want to have everything in <code>main</code> as your program grows."}, {"owner": {"reputation": 271, "user_id": 4621159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2074b013614ff775ea6b0368b0f8e6?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Gustafsson", "link": "https://stackoverflow.com/users/4621159/tobias-gustafsson"}, "reply_to_user": {"reputation": 374, "user_id": 2191327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e2d23ec4edc6915a63ad495cc6b2ac?s=128&d=identicon&r=PG", "display_name": "user2191327", "link": "https://stackoverflow.com/users/2191327/user2191327"}, "edited": false, "score": 0, "creation_date": 1460997109, "post_id": 36688610, "comment_id": 60986878, "body": "For the tests you can add a couple of helper functions and structs to create mock connection pools and connections. These can then be used across tests to reduce duplication."}], "tags": [], "owner": {"reputation": 271, "user_id": 4621159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2074b013614ff775ea6b0368b0f8e6?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Gustafsson", "link": "https://stackoverflow.com/users/4621159/tobias-gustafsson"}, "is_accepted": false, "score": 0, "last_activity_date": 1460967237, "creation_date": 1460967237, "answer_id": 36688610, "question_id": 36688071, "link": "https://stackoverflow.com/questions/36688071/issue-with-dependency-injection-with-interface/36688610#36688610", "title": "issue with dependency injection with interface", "body": "<p>As a first step just change your declaration of <code>GetConn</code> slightly to the following:</p>\n\n<pre><code>func (pool *ConnPool) GetConn() ConnInterface {  // Conn -&gt; ConnInterface\n    return Conn{}\n}\n</code></pre>\n\n<p>That should fulfill the interface of <code>ConnPoolInterface</code>. You would probably have to rearrange your code slightly to avoid circular dependencies after that.</p>\n"}], "owner": {"reputation": 374, "user_id": 2191327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3e2d23ec4edc6915a63ad495cc6b2ac?s=128&d=identicon&r=PG", "display_name": "user2191327", "link": "https://stackoverflow.com/users/2191327/user2191327"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1460979748, "creation_date": 1460965407, "last_edit_date": 1460979748, "question_id": 36688071, "link": "https://stackoverflow.com/questions/36688071/issue-with-dependency-injection-with-interface", "title": "issue with dependency injection with interface", "body": "<p>I have the package that provides some work with tcp connections, basically something like:</p>\n\n<pre><code>package connpool\n\nimport (\n    \"io/ioutil\"\n    \"net/http\"\n)\n\ntype ConnPool struct{}\n\nfunc (pool *ConnPool) GetConn() Conn {\n    return Conn{}\n}\n\nfunc (pool *ConnPool) ReleaseConnection(conn Conn)  {\n\n}\n\ntype Conn struct{}\n\nfunc (c Conn) FetchUrl(url string) ([]byte, error) {\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        return []byte{}, err\n    }\n    client := &amp;http.Client{}\n    resp, _ := client.Do(req)\n    defer resp.Body.Close()\n    body, _ := ioutil.ReadAll(resp.Body)\n    return body, nil\n}\n</code></pre>\n\n<p>then i try to use it in another package, but wrapping it by interface, because i want substitute this package in test environment with fake connpool</p>\n\n<pre><code>package main\n\nimport (\n    \"connpool\"\n    \"fmt\"\n)\n\nfunc onlyDependencyOnConnPool() *connpool.ConnPool {\n    return &amp;connpool.ConnPool{}\n}\n\ntype ConnPoolInterface interface {\n    GetConn() ConnInterface\n    ReleaseConnection(ConnInterface)\n}\n\ntype ConnInterface interface {\n    FetchUrl(string) ([]byte, error)\n}\n\ntype Fetcher struct{}\n\nfunc (f Fetcher) Fetch(cPool ConnPoolInterface) error {\n    conn := cPool.GetConn()\n    defer cPool.ReleaseConnection(conn)\n    body, err := conn.FetchUrl(\"http://localhost:9200\")\n    fmt.Println(\"body: \", string(body))\n    return err\n}\n\nfunc main() {\n    pool := onlyDependencyOnConnPool()\n    f := Fetcher{}\n    f.Fetch(pool)\n}\n</code></pre>\n\n<p>but it will return error on compile: </p>\n\n<pre><code>./main.go:34: cannot use pool (type *connpool.ConnPool) as type ConnPoolInterface in argument to f.Fetch:\n    *connpool.ConnPool does not implement ConnPoolInterface (wrong type for GetConn method)\n        have GetConn() connpool.Conn\n        want GetConn() ConnInterface\n</code></pre>\n\n<p>Is the any way to wrap this dependency by interface without connpool import in every file?</p>\n\n<p>I need it just to mock the http requests in my test environment, something like this(if i will implement interfaces in the connpool package i will have to implement every mock struct in it, it look like some kind of mess):</p>\n\n<pre><code>package main\n\nimport(\n  \"testing\"\n)\n\ntype FakeConnPool struct{}\n\nfunc (pool *FakeConnPool) GetConn() FakeConn {\n    return FakeConn{}\n}\n\nfunc (pool *FakeConnPool) ReleaseConnection(conn FakeConn)  {\n}\n\ntype FakeConn struct{}\n\nfunc (c FakeConn) FetchUrl(url string) ([]byte, error) {\n  println(url)\n  body := []byte(`{\"status\" : 200}`)\n    return body, nil\n}\n\nfunc changeDependency() ConnPoolInterface {\n  return &amp;FakeConnPool{}\n}\nfunc TestBaz(t *testing.T)  {\n  pool := changeDependency()\n    f := Fetcher{}\n    err := f.Fetch(pool)\n  if err != nil {\n    t.Errorf(\"error\")\n  }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 1, "creation_date": 1460965931, "post_id": 36688008, "comment_id": 60965068, "body": "Might it help to identify User struct field as pointers to those values where NULL is possible? I mean:  <code>stype User struct{user_name *string}</code> and so on..?"}], "answers": [{"comments": [{"owner": {"reputation": 447, "user_id": 3116634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ATBrw.jpg?s=128&g=1", "display_name": "Avinash", "link": "https://stackoverflow.com/users/3116634/avinash"}, "edited": false, "score": 0, "creation_date": 1489758485, "post_id": 36691455, "comment_id": 72824545, "body": "Could you please demonstrate &quot;The long one&quot; with an example?"}, {"owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "reply_to_user": {"reputation": 447, "user_id": 3116634, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/ATBrw.jpg?s=128&g=1", "display_name": "Avinash", "link": "https://stackoverflow.com/users/3116634/avinash"}, "edited": false, "score": 0, "creation_date": 1490453522, "post_id": 36691455, "comment_id": 73123768, "body": "@Avinash add an example for postgresql JSONB/JSON"}], "tags": [], "owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "is_accepted": true, "score": 4, "last_activity_date": 1490453478, "last_edit_date": 1490453478, "creation_date": 1460975490, "answer_id": 36691455, "question_id": 36688008, "link": "https://stackoverflow.com/questions/36688008/couldt-convert-nil-into-type/36691455#36691455", "title": "Could&#39;t convert &lt;nil&gt; into type ...?", "body": "<p><strong>First the short answer :</strong> There is some types in sql package for example <a href=\"https://golang.org/pkg/database/sql/#NullString\" rel=\"nofollow noreferrer\">sql.NullString</a> (for nullable string in your table and guess <a href=\"https://golang.org/pkg/database/sql/#NullInt64\" rel=\"nofollow noreferrer\">Nullint64</a> and <a href=\"https://golang.org/pkg/database/sql/#NullBool\" rel=\"nofollow noreferrer\">NullBool</a> and ... usage :) ) and you should use them in your struct. </p>\n\n<p><strong>The long one :</strong> There is two interface for this available in go , first is <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"nofollow noreferrer\">Scanner</a> and the other is <a href=\"https://golang.org/pkg/database/sql/driver/#Valuer\" rel=\"nofollow noreferrer\">Valuer</a> for any special type in database, (for example,I use this mostly with JSONB in postgres) you need to create a type, and implement this two(or one of them) interface on that type. </p>\n\n<p>the scanner is used when you call <code>Scan</code> function. the data from the database driver, normally in <code>[]byte</code> is the input and you are responsible for handling it. the other one, is used when the value is used as input in query. the result \"normally\" is a slice of byte (and an error) if you need to only read data, Scanner is enough, and vice-versa, if you need to write parameter in query the Valuer is  enough</p>\n\n<p>for an example of implementation, I recommend to see the types in <a href=\"https://golang.org/pkg/database/sql/\" rel=\"nofollow noreferrer\">sql</a> package. </p>\n\n<p>Also there is an example of a type to use with JSONB/JSON type in postgresql </p>\n\n<pre><code>// GenericJSONField is used to handle generic json data in postgres\ntype GenericJSONField map[string]interface{}\n\n\n// Scan convert the json field into our type\nfunc (v *GenericJSONField) Scan(src interface{}) error {\n    var b []byte\n    switch src.(type) {\n    case []byte:\n        b = src.([]byte)\n    case string:\n        b = []byte(src.(string))\n    case nil:\n        b = make([]byte, 0)\n    default:\n        return errors.New(\"unsupported type\")\n    }\n\n    return json.Unmarshal(b, v)\n}\n\n// Value try to get the string slice representation in database\nfunc (v GenericJSONField) Value() (driver.Value, error) {\n    return json.Marshal(v)\n}\n</code></pre>\n\n<p>driver value is often <code>[]byte</code> but <code>string</code> and <code>nil</code> is acceptable. so this could handle null-able fields too. </p>\n"}], "owner": {"reputation": 411, "user_id": 4737876, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tygIZ.jpg?s=128&g=1", "display_name": "Muge", "link": "https://stackoverflow.com/users/4737876/muge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3543, "favorite_count": 1, "accepted_answer_id": 36691455, "answer_count": 1, "score": 0, "last_activity_date": 1490453478, "creation_date": 1460965186, "last_edit_date": 1460966536, "question_id": 36688008, "link": "https://stackoverflow.com/questions/36688008/couldt-convert-nil-into-type", "title": "Could&#39;t convert &lt;nil&gt; into type ...?", "body": "<p>I tried to using database/sql for query database row into a Go type, my codes snippet following:</p>\n\n<pre><code>type User struct {\n    user_id     int64\n    user_name   string\n    user_mobile string\n    password    string\n    email       interface{}\n    nickname    string\n    level       byte\n    locked      bool\n    create_time string\n    comment     string  // convert &lt;nil&gt; to *string error \n}\n\nfunc TestQueryUser(t *testing.T) {\n    db := QueryUser(driverName, dataSourceName)\n\n    stmtResults, err := db.Prepare(queryAll)\n    defer stmtResults.Close()\n\n    var r *User = new(User)\n\n    arr := []interface{}{\n        &amp;r.user_id, &amp;r.user_name, &amp;r.user_mobile, &amp;r.password, &amp;r.email,\n        &amp;r.nickname, &amp;r.level, &amp;r.locked, &amp;r.create_time, &amp;r.comment,\n    }\n\n    err = stmtResults.QueryRow(username).Scan(arr...)\n\n    if err != nil {\n        t.Error(err.Error())\n    }\n\n    fmt.Println(r.email)\n\n}\n</code></pre>\n\n<p>MySQL:\n<a href=\"https://i.stack.imgur.com/tlSQg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/tlSQg.png\" alt=\"enter image description here\"></a></p>\n\n<p>As your see, some fields that has <code>NULL</code> value, so I have to set <code>interface{}</code> type into User struct of Go, which convert <code>NULL</code> to <code>nil</code>.</p>\n\n<pre><code>--- FAIL: TestQueryUser (0.00s)\n        user_test.go:48: sql: Scan error on column index 9: unsupported Scan, storing driver.Value type &lt;nil&gt; into type *string\n</code></pre>\n\n<p>Somebody has a better way\uff1f or I must change the MySQL field and set its <code>DEFAULT ' '</code></p>\n"}, {"tags": ["go", "shared-libraries"], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": -1, "last_activity_date": 1461048585, "creation_date": 1461048585, "answer_id": 36710583, "question_id": 36687306, "link": "https://stackoverflow.com/questions/36687306/exposing-a-function-with-2d-slice-as-a-parameter-in-a-c-shared-library-to-be-us/36710583#36710583", "title": "exposing a function with 2D slice as a parameter in a c-shared library (to be used in Java via JNA and C)", "body": "<p>I think the key point is to have a look to the c bindings of <code>slice,string and int</code> generated by <code>go build</code> tool. I not tried 2D slice, but it should no different to 1D slice with <code>unsafe</code> pointer converter, maybe just be one more time allocation and convertion.</p>\n\n<p>I'm not sure it's the best way, but here's the example for 1D slice:</p>\n\n<p>the go part:</p>\n\n<pre><code>import \"C\"\n//export CFoo\nfunc CFoo(content []byte) string{\n    var ret []byte\n    //blablabla to get ret\n    cbuf := unsafe.Pointer(C.malloc(C.size_t(len(ret))))\n    C.memcpy(cbuf, unsafe.Pointer(&amp;ret[0]), C.size_t(len(ret)))\n    var finalString string\n    hdr := (*reflect.StringHeader)(unsafe.Pointer(&amp;finalString))\n    hdr.Data = uintptr(unsafe.Pointer(cbuf))\n    hdr.Len = len(ret)\n    return finalString\n}\n</code></pre>\n\n<p>compile with <code>-buildmode=c-shared</code>, to get <code>libmygo.so</code>.</p>\n\n<p>I not know JNA, expecting it like JNI. the JNI part as well as pure C part:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;jni.h&gt;\n#include &lt;string.h&gt;\n\ntypedef signed char GoInt8;\ntypedef unsigned char GoUint8;\ntypedef short GoInt16;\ntypedef unsigned short GoUint16;\ntypedef int GoInt32;\ntypedef unsigned int GoUint32;\ntypedef long long GoInt64;\ntypedef unsigned long long GoUint64;\ntypedef GoInt32 GoInt;\ntypedef GoUint32 GoUint;\ntypedef __SIZE_TYPE__ GoUintptr;\ntypedef float GoFloat32;\ntypedef double GoFloat64;\ntypedef float _Complex GoComplex64;\ntypedef double _Complex GoComplex128;\n\ntypedef struct { const char *p; GoInt n; } GoString;\ntypedef void *GoMap;\ntypedef void *GoChan;\ntypedef struct { void *t; void *v; } GoInterface;\ntypedef struct { void *data; GoInt len; GoInt cap; } GoSlice;\n\nJNIEXPORT JNICALL jbyteArray Java_com_mynextev_infotainment_app_myev_Native_foo(JNIEnv* env, jobject obj,jbyteArray content){\n    JNIEnv ienv = *env;\n\n    void * Ccontent = ienv-&gt;GetByteArrayElements(env, content, 0); \n    int Lcontent = ienv-&gt;GetArrayLength(env, content);\n    GoSlice Gcontent = {Ccontent, Lcontent, Lcontent};\n    if(!gret.n){\n        printf(\"jni CDoAESEnc\");\n        return NULL;\n    }\n    jbyteArray ret = ienv-&gt;NewByteArray(env, gret.n);\n    ienv-&gt;SetByteArrayRegion(env, ret, 0, gret.n, gret.p);\n    free((void*)gret.p);\n    ienv-&gt;ReleaseByteArrayElements(env, content, Ccontent, JNI_ABORT);\n    return ret;\n}\n</code></pre>\n\n<p>build it with <code>libmygo.so</code>.</p>\n\n<p>finally you get two <code>so</code> files. one for C which can be used standalone; one for Java which must be used with <code>libmygo.so</code> together.</p>\n"}], "owner": {"reputation": 963, "user_id": 385280, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/82d083ee140420fe7acde11d5109a311?s=128&d=identicon&r=PG", "display_name": "Venkat", "link": "https://stackoverflow.com/users/385280/venkat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1461048585, "creation_date": 1460962789, "last_edit_date": 1460986950, "question_id": 36687306, "link": "https://stackoverflow.com/questions/36687306/exposing-a-function-with-2d-slice-as-a-parameter-in-a-c-shared-library-to-be-us", "title": "exposing a function with 2D slice as a parameter in a c-shared library (to be used in Java via JNA and C)", "body": "<p>I am trying to write a simple matrix operations API using <code>go</code> and expose the APIs as a shared library. This shared library will be used from Java(using JNA) and from C.\nThe documentation is very sparse about using any data type beyond simple <code>int</code> or <code>string</code> as function parameters.\nMy requirement is to expose functions with 1 or more 2D slices as parameters AND also as return types. I am not able to figure out if such a thing is supported.\nIs this possible? Are there any examples for this?</p>\n"}, {"tags": ["json", "go", "time", "go-gorm"], "comments": [{"owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "edited": false, "score": 0, "creation_date": 1460977046, "post_id": 36686400, "comment_id": 60972226, "body": "This is not RFC3339, its RFC3339Nano, see this <a href=\"http://play.golang.org/p/7oJ_-7FmB-\" rel=\"nofollow noreferrer\">play.golang.org/p/7oJ_-7FmB-</a> (run it localy, the time in playground is limited) and can you show when you get the first one and when the others?"}, {"owner": {"reputation": 671, "user_id": 3138917, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d9446840a6d0781d2b7dcdfa9e90e230?s=128&d=identicon&r=PG&f=1", "display_name": "AttilaTheFun", "link": "https://stackoverflow.com/users/3138917/attilathefun"}, "reply_to_user": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "edited": false, "score": 0, "creation_date": 1461019102, "post_id": 36686400, "comment_id": 60998821, "body": "@fzerorubigd I&#39;m getting  2016-04-18T18:35:39-04:00 2016-04-18T18:35:39.524444112-04:00 When I run that locally. Neither of those matches the schema of the dates i&#39;m getting from Go&#39;s json parser. Any ideas?"}], "answers": [{"tags": [], "owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "is_accepted": false, "score": 0, "last_activity_date": 1461040403, "last_edit_date": 1495539920, "creation_date": 1461040403, "answer_id": 36708615, "question_id": 36686400, "link": "https://stackoverflow.com/questions/36686400/variable-number-of-sub-seconds-in-json-encoded-time/36708615#36708615", "title": "Variable number of sub seconds in json encoded time", "body": "<p>The best way to control the output, is writing your own type. say <code>type MyTime time.Time</code> and implement <a href=\"http://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\">Marshaller</a> and <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">Unmarshaller</a> for it with your formatting. see <a href=\"https://golang.org/pkg/time/#Time.MarshalJSON\" rel=\"nofollow noreferrer\">time.MarshalJSON</a> and <a href=\"https://golang.org/pkg/time/#Time.UnmarshalJSON\" rel=\"nofollow noreferrer\">time.UnmarshalJSON</a> for hint. if you need this in a database column, implement the <code>Scanner</code> and <code>Valuer</code> on that too (<a href=\"https://stackoverflow.com/questions/36688008/couldt-convert-nil-into-type/36691455#36691455\">see this answer</a>). for other Marshaller/Unmarshaller you need to implement their interfaces (for example yaml/gob/...)</p>\n"}], "owner": {"reputation": 671, "user_id": 3138917, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d9446840a6d0781d2b7dcdfa9e90e230?s=128&d=identicon&r=PG&f=1", "display_name": "AttilaTheFun", "link": "https://stackoverflow.com/users/3138917/attilathefun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1461040403, "creation_date": 1460958939, "last_edit_date": 1461000645, "question_id": 36686400, "link": "https://stackoverflow.com/questions/36686400/variable-number-of-sub-seconds-in-json-encoded-time", "title": "Variable number of sub seconds in json encoded time", "body": "<p>So I have numerous structs which extend the gorm Model meaning they have createdAt, updatedAt and deletedAt time.Time fields. When I go to marshal these into JSON, the formats of the dates I receive vary. The proper RFC3339 timestamps it should produce look like:</p>\n\n<p>2016-04-18T00:03:20Z</p>\n\n<p>However, I am only getting dates formatted this way about 20% of the time. The remainder of the timestamps have a variable number of subseconds. I have received the following formats:</p>\n\n<p>2016-04-18T05:51:11.54772087Z</p>\n\n<p>2016-04-18T05:51:11.543835101Z</p>\n\n<p>2016-04-18T05:53:20.1674444Z</p>\n\n<p>Is there any way I can coerce Go into to giving me consistent timestamps? Thanks in advance!</p>\n"}, {"tags": ["go", "go-interface"], "comments": [{"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1460948089, "post_id": 36684651, "comment_id": 60958650, "body": "Not sure why you&#39;d want to do something like this, but if you&#39;re not planning on reusing <code>interfaceMap</code> elsewhere, then a bunch of <code>if</code>s is probably a simpler way to implement this: <a href=\"http://play.golang.org/p/eSUf2xSqI7\" rel=\"nofollow noreferrer\">play.golang.org/p/eSUf2xSqI7</a>."}, {"owner": {"reputation": 1117, "user_id": 1667156, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f6c59ac66c560652cbdcee3f09865caa?s=128&d=identicon&r=PG", "display_name": "estobbart", "link": "https://stackoverflow.com/users/1667156/estobbart"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1460948211, "post_id": 36684651, "comment_id": 60958675, "body": "Not sure I&#39;d really reuse it, it&#39;s just a example of what I&#39;m aiming for."}], "answers": [{"comments": [{"owner": {"reputation": 1117, "user_id": 1667156, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f6c59ac66c560652cbdcee3f09865caa?s=128&d=identicon&r=PG", "display_name": "estobbart", "link": "https://stackoverflow.com/users/1667156/estobbart"}, "edited": false, "score": 0, "creation_date": 1460948581, "post_id": 36684762, "comment_id": 60958748, "body": "This looks exactly like what I want, whats the difference between reflect.TypeOf((*InterOne)(nil)) and reflect.TypeOf((*InterOne)(nil)).Elem(), both are reflect.Type right?"}, {"owner": {"reputation": 1117, "user_id": 1667156, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f6c59ac66c560652cbdcee3f09865caa?s=128&d=identicon&r=PG", "display_name": "estobbart", "link": "https://stackoverflow.com/users/1667156/estobbart"}, "edited": false, "score": 0, "creation_date": 1460949019, "post_id": 36684762, "comment_id": 60958844, "body": "Is it also possible to call the InterOneMethod on any? Normally I&#39;d do a type assertion first."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 1117, "user_id": 1667156, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f6c59ac66c560652cbdcee3f09865caa?s=128&d=identicon&r=PG", "display_name": "estobbart", "link": "https://stackoverflow.com/users/1667156/estobbart"}, "edited": false, "score": 0, "creation_date": 1460950076, "post_id": 36684762, "comment_id": 60959063, "body": "<code>reflect.TypeOf((*InterOne)(nil))</code> returns a pointer to the interface, which is pretty much not valid. you can call InterOneMethod using reflect.ValuOf(any).MethodByName but calling functions like that is extremely slow."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 2, "last_activity_date": 1460948190, "creation_date": 1460948190, "answer_id": 36684762, "question_id": 36684651, "link": "https://stackoverflow.com/questions/36684651/is-it-possible-to-store-a-go-type/36684762#36684762", "title": "Is it possible to store a Go type", "body": "<p>You can use reflect, notice that to get the type of an interface the only way is to use <code>reflect.TypeOf((*INTERFACE)(nil)).Elem()</code>, here's a working example:</p>\n\n<pre><code>var interfaceMap = map[string]reflect.Type{\n    \"One\": reflect.TypeOf((*InterOne)(nil)).Elem(),\n....\n}\n\nfunc doesHandle(any interface{}) []string {\n    t := reflect.TypeOf(any)\n    var handles []string\n    for k, v := range interfaceMap {\n        if t.Implements(v) {\n            handles = append(handles, k)\n        }\n    }\n    return handles\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/zsDFMlgskO\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}], "owner": {"reputation": 1117, "user_id": 1667156, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f6c59ac66c560652cbdcee3f09865caa?s=128&d=identicon&r=PG", "display_name": "estobbart", "link": "https://stackoverflow.com/users/1667156/estobbart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 1, "accepted_answer_id": 36684762, "answer_count": 1, "score": 1, "last_activity_date": 1461001181, "creation_date": 1460947366, "last_edit_date": 1461001181, "question_id": 36684651, "link": "https://stackoverflow.com/questions/36684651/is-it-possible-to-store-a-go-type", "title": "Is it possible to store a Go type", "body": "<p>I've got a handful of interfaces, and n number of structs that arbitrarily implement these interfaces. I'd like to keep an array of types and be able to run a loop over them to see which ones are implemented. Is it possible to store a type like this? I spent a little bit of time with the reflect package, but couldn't really find what I was looking for, I understand if maybe this isn't best practice. Trying to do something similar to this.. without a giant type switch, fallthrough, or if.. if... if.</p>\n\n<pre><code>type InterOne interface {\n    InterOneMethod() string\n}\n\nvar interfaceMap = map[string]type {\n    \"One\": InterOne,\n    ...\n}\n\nfunc doesHandle(any interface{}) []string {\n    var handles []string\n    for k, v := range interfaceMap {\n      if _, ok := any.(v); ok {\n          handles = append(handles, k)\n      }\n    }\n    return handles\n}\n</code></pre>\n\n<p>EDIT: The answer marked as correct is technically right. I found that due to the comment about the method calling &amp; the overuse of reflection, that this approach was a bad idea. Instead I went with a type switch to check for a single interface because fallthrough is not supported on type switch, and a large if.. if.. if.. with type assertions to be able to make the appropriate calls.</p>\n"}, {"tags": ["file", "go", "io"], "answers": [{"tags": [], "owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "is_accepted": false, "score": 0, "last_activity_date": 1460943074, "last_edit_date": 1460943074, "creation_date": 1460942742, "answer_id": 36684107, "question_id": 36684061, "link": "https://stackoverflow.com/questions/36684061/how-to-verify-if-file-has-contents-to-marshal-from-ioutil-readfile-in-go/36684107#36684107", "title": "How to verify if file has contents to marshal from ioutil.ReadFile in Go", "body": "<p>you can use <a href=\"https://golang.org/pkg/os/#File.Stat\" rel=\"nofollow\">(*os.File).Stat()</a> to get a file's <a href=\"https://golang.org/pkg/os/#FileInfo\" rel=\"nofollow\">FileInfo</a> which contain its size</p>\n\n<pre><code>   file, err := os.Open( filepath ) \n    if err != nil {\n        // handle error\n    }\n\n    fi, err := file.Stat()\n    if err != nil {\n      // handle error\n    }\n\n   s := fi.Size()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 1, "last_activity_date": 1460944744, "creation_date": 1460944744, "answer_id": 36684345, "question_id": 36684061, "link": "https://stackoverflow.com/questions/36684061/how-to-verify-if-file-has-contents-to-marshal-from-ioutil-readfile-in-go/36684345#36684345", "title": "How to verify if file has contents to marshal from ioutil.ReadFile in Go", "body": "<p>There is no way for the server to ever reach <code>defer writeDB()</code>.</p>\n\n<p>http.ListenAndServe blocks, and if it did return anything, you log.Fatal that, which exits your app at that point.</p>\n\n<p>You can't intercept all ways an app can exit, getting SIGKILL, machine loss of power, etc.</p>\n\n<p>I'm assuming you really just want to write some code, bounce the server, repeat </p>\n\n<p>If that's the case, then Ctrl-C is good enough.</p>\n\n<p>If you want to write your file on Ctrl-C, look at the <a href=\"https://golang.org/pkg/os/signal/\" rel=\"nofollow\">signal</a> package.</p>\n\n<p>Also, defer on the last line of a function really has no purpose as defer basically means \"do this last\".  </p>\n"}], "owner": {"reputation": 1, "user_id": 6217607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65e4707fffe9104fb4ff8c327af3532d?s=128&d=identicon&r=PG&f=1", "display_name": "S Faulk", "link": "https://stackoverflow.com/users/6217607/s-faulk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1460944744, "creation_date": 1460942380, "question_id": 36684061, "link": "https://stackoverflow.com/questions/36684061/how-to-verify-if-file-has-contents-to-marshal-from-ioutil-readfile-in-go", "title": "How to verify if file has contents to marshal from ioutil.ReadFile in Go", "body": "<p>I am trying to use a file instead of a DB to get a prototype up and running. I have a program that (1) reads existing content from the file to a map, (2) takes JSON POSTs that add content to the map, (3) on exit, writes to the file.</p>\n\n<p>First, the file is not being created. Then I created an empty file. It is not being written to. \nI am trying to read the file, determine if there is existing content. If there is not existing content, create a blank map. If there is existing content, unmarshal it into a new map. </p>\n\n<pre><code>  func writeDB() {\n    eventDBJSON, err := json.Marshal(eventDB)\n    if err != nil {\n        panic(err)\n    }\n\n    err2 := ioutil.WriteFile(\"/Users/sarah/go/dat.txt\", eventDBJSON, 0777)\n    if err2 != nil {\n        panic(err2)\n    }\n}\n\nfunc main() {\n\n    dat, err := ioutil.ReadFile(\"/Users/sarah/go/dat.txt\")\n    if err != nil {\n        panic(err)\n    }\n    if dat == nil {\n        eventDB = DB{\n            events: map[string]event{},\n        }\n    } else {\n        if err2 := json.Unmarshal(dat, &amp;eventDB); err2 != nil {\n            panic(err2)\n        }\n    }\n\n    router := httprouter.New()\n    router.POST(\"/join\", JoinEvent)\n    router.POST(\"/create\", CreateEvent)\n\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n\n    defer writeDB()\n\n}\n</code></pre>\n"}, {"tags": ["networking", "go", "tcp", "chat", "port"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 3369414, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cadc133aebe5ea780b1d365fbd1b3b47?s=128&d=identicon&r=PG&f=1", "display_name": "user3369414", "link": "https://stackoverflow.com/users/3369414/user3369414"}, "edited": false, "score": 0, "creation_date": 1461104627, "post_id": 36686794, "comment_id": 61044845, "body": "This is just what I needed!  It seems I made this way more complicated than it needed to be.  Thank you!"}], "tags": [], "owner": {"reputation": 38, "user_id": 2693973, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bkPYm.png?s=128&g=1", "display_name": "Justin", "link": "https://stackoverflow.com/users/2693973/justin"}, "is_accepted": true, "score": 0, "last_activity_date": 1460960697, "creation_date": 1460960697, "answer_id": 36686794, "question_id": 36683960, "link": "https://stackoverflow.com/questions/36683960/sending-a-message-from-one-port-to-another/36686794#36686794", "title": "Sending a message from one port to another", "body": "<p>your logic seems to have flaws, where acceptloop calls for listenconnection, it creates an infinite loop inside an infinite loop. I think you need to reconstruct the system with <strong>use cases</strong> and <strong>scenarios</strong>. </p>\n\n<p>If my understanding is right, you like to have a server waiting for clients to connect. First, client1 comes in, sends some data. The server accepts this connection, and it only needs to accept once for each client. At this point, if the client2 is online, send data to client2. All of this happens in an infinite loop.</p>\n\n<p>Checkout this code\n<a href=\"https://play.golang.org/p/_5AREG3jnG\" rel=\"nofollow\">https://play.golang.org/p/_5AREG3jnG</a></p>\n"}], "owner": {"reputation": 13, "user_id": 3369414, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cadc133aebe5ea780b1d365fbd1b3b47?s=128&d=identicon&r=PG&f=1", "display_name": "user3369414", "link": "https://stackoverflow.com/users/3369414/user3369414"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 0, "accepted_answer_id": 36686794, "answer_count": 1, "score": 1, "last_activity_date": 1460960697, "creation_date": 1460941532, "question_id": 36683960, "link": "https://stackoverflow.com/questions/36683960/sending-a-message-from-one-port-to-another", "title": "Sending a message from one port to another", "body": "<p>I have a server and 2 clients each using their own port.  When a client sends a message to the server, the server echoes it back to the sender.  Then, the server is supposed to send the message to the other client as well.  This is where I'm having issues.</p>\n\n<p>I believe I may be setting up the connection wrong in writeMessage(), but I am not entirely sure.  At the moment, I have the function just trying to write to client 2 on port 8080 for debugging purposes.</p>\n\n<p>Server:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net\"\n)\n\nvar message string = \"\"\n\nfunc main() {\n    fmt.Println(\"The server is listening on Port 3000 and 8080\")\n    listener, err := net.Listen(\"tcp\", \"localhost:3000\")\n    if err != nil {\n        log.Fatal(err) \n    }\n\n    listener2, err := net.Listen(\"tcp\", \"localhost:8080\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    go acceptLoop(listener)\n    acceptLoop(listener2)\n\n\n}\n\nfunc acceptLoop(l net.Listener) {\n    defer l.Close()\n    for {\n            c, err := l.Accept()\n            if err != nil {\n                log.Fatal(err)\n            }\n            fmt.Println(\"New connection found!\")\n            listenConnection(c)\n    }\n}\n\nfunc listenConnection(conn net.Conn) {\n        for {\n                buffer := make([]byte, 1400)\n                dataSize, err := conn.Read(buffer)\n                if err != nil {\n                    fmt.Println(\"Connection has closed\")\n                    return\n                }\n\n                //This is the message you received\n                data := buffer[:dataSize]\n                fmt.Print(string(data))\n                conn.Write(data)\n                message = string(data)\n                writeMessage()\n        }\n}\n\nfunc writeMessage(){\n    conn2, e := net.Dial(\"tcp\", \"localhost:8080\")\n    if e != nil {\n        log.Fatalln(e)\n    }\n    defer conn2.Close()\n    conn2.Write([]byte(message))\n}\n</code></pre>\n\n<p>Client 1:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"log\"\n        \"net\"\n        \"bufio\"\n        \"os\"\n)\n\nfunc main() {\n        conn, err := net.Dial(\"tcp\", \"localhost:3000\")\n        if err != nil {\n                log.Fatalln(err)\n        }\n\n        go listenConnection(conn, err)\n        writeMessage(conn, err)\n\n}\n\nfunc listenConnection(conn net.Conn, err error){\n    for {\n                buffer := make([]byte, 1400)\n                dataSize, err := conn.Read(buffer)\n                if err != nil {\n                        fmt.Println(\"connection closed\")\n                        return\n                }\n\n                data := buffer[:dataSize]\n                fmt.Print(\"Server: \", string(data))\n        }\n}\n\nfunc writeMessage(conn net.Conn, err error){\n    for {\n        reader := bufio.NewReader(os.Stdin)\n        //fmt.Print(\"Enter message: \")\n        text, _ := reader.ReadString('\\n')\n        text = \"3000: \" + text\n\n        _, err = conn.Write([]byte(text))\n        if err != nil {\n                log.Fatalln(err)\n        }\n    }\n}\n</code></pre>\n\n<p>(My second client is the same as my first except port 3000 is replaced with 8080.)</p>\n\n<p>In order to replicate the problem, the user has to run the server code and then both of the clients.  The clients can then send messages to the server.</p>\n\n<p>Any help with this would be greatly appreciated.  I cannot figure this out at all.  Hopefully some more experienced Go users will be able to help!</p>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 3, "creation_date": 1460942425, "post_id": 36683911, "comment_id": 60957545, "body": "You might find the following article useful: <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">blog.golang.org/slices</a>"}, {"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 12, "creation_date": 1460949491, "post_id": 36683911, "comment_id": 60958942, "body": "For your last question: capacity, is the number of elements between the first element that a slice can access and the last element of the underlying array. First element that slice <code>d</code> can access is 2nd element in the underlying array, hence capacity is 3."}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "edited": false, "score": 1, "creation_date": 1491917108, "post_id": 36683911, "comment_id": 73757733, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/43294449/decreasing-slice-capacity\">Decreasing slice capacity</a>"}, {"owner": {"reputation": 1933, "user_id": 4424698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh5.googleusercontent.com/-Rpp-wUKIk-o/AAAAAAAAAAI/AAAAAAAABCc/2my33oV6DDs/photo.jpg?sz=128", "display_name": "Hrvoje T", "link": "https://stackoverflow.com/users/4424698/hrvoje-t"}, "edited": false, "score": 0, "creation_date": 1546178714, "post_id": 36683911, "comment_id": 94793962, "body": "And how undelying array for <code>d</code> look?"}, {"owner": {"reputation": 467, "user_id": 9817778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vyGWg.jpg?s=128&g=1", "display_name": "Time Killer", "link": "https://stackoverflow.com/users/9817778/time-killer"}, "edited": false, "score": 0, "creation_date": 1591595110, "post_id": 36683911, "comment_id": 110104191, "body": "<code>slice2 = slice1[start:len:cap]</code>, the change of <code>len</code> is reversible, and the change of <code>cap</code> is irreversible."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 16, "last_activity_date": 1460978862, "last_edit_date": 1460978862, "creation_date": 1460970940, "answer_id": 36689864, "question_id": 36683911, "link": "https://stackoverflow.com/questions/36683911/go-slices-capacity-length/36689864#36689864", "title": "Go slices - capacity/length?", "body": "<p>All your variables have a <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"noreferrer\">slice type</a>. Slices have a backing <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"noreferrer\">array</a>. In Go you can't access uninitialized variables. If you don't explicitly provide a value when you create a new variable, they will be initialized with the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\">zero value</a> of the variable's type.</p>\n\n<p>This means when you create a slice with <code>make([]int, 0, 5)</code>, it also creates a backing array, the backing array will be initialized with its zero value, and this zeroed array will be <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"noreferrer\">sliced</a>. The zero value of an array type is an array having the zero value of element type for each of its elements.</p>\n\n<p>So even though you didn't explicitly set every elements of the backing array to <code>0</code>, they will be zeroed automatically. So when you do <code>c := b[:2]</code>, it will slice the <code>b</code> slice, and <code>c</code> will have a length of 2, and those 2 elements will be <code>0</code>.</p>\n\n<p>And when you do <code>d := c[2:5]</code> that slices the <code>c</code> slice, its length will be <code>5-2 = 3</code>, and its capacity will also be <code>5-2 = 3</code> because slicing a slice will result in a new slice which <em>shares the same backing array</em>, and the capacity will be the first element till the last of the backing array (unless you use a <em>full slice expression</em> which also controls the resulting slice's capacity).</p>\n\n<p>Must-read blog posts for newcomers who want to understand slices and arrays:</p>\n\n<p><a href=\"http://blog.golang.org/go-slices-usage-and-internals\" rel=\"noreferrer\"><strong>The Go Blog: Go Slices: usage and internals</strong></a></p>\n\n<p><a href=\"http://blog.golang.org/slices\" rel=\"noreferrer\"><strong>The Go Blog: Arrays, slices (and strings): The mechanics of 'append'</strong></a></p>\n"}, {"tags": [], "owner": {"reputation": 1203, "user_id": 4693568, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H7pQG.jpg?s=128&g=1", "display_name": "Ja8zyjits", "link": "https://stackoverflow.com/users/4693568/ja8zyjits"}, "is_accepted": false, "score": 0, "last_activity_date": 1593437894, "last_edit_date": 1593437894, "creation_date": 1593435741, "answer_id": 62638755, "question_id": 36683911, "link": "https://stackoverflow.com/questions/36683911/go-slices-capacity-length/62638755#62638755", "title": "Go slices - capacity/length?", "body": "<p>The official docs mentions that.</p>\n<blockquote>\n<p>The length of a slice is the number of elements it contains.</p>\n</blockquote>\n<blockquote>\n<p>The capacity of a slice is the number of elements in the underlying array, counting from the first element in the slice.</p>\n</blockquote>\n<p>So for your 1st q:</p>\n<blockquote>\n<p>Why does c look like [0,0] and have length 2?</p>\n</blockquote>\n<p>Your slice <code>c</code> was created with <code> b[:2]</code> which means it has elements from 0th to 1st position of the slice <code>b</code>. Hence it has only 2 elements so length is 2.</p>\n<blockquote>\n<p>So does setting <code>c</code> to <code>b[:2]</code> zero out the first two elements?(since <code>b was </code>[]`)</p>\n</blockquote>\n<p>Now as @icza mentioned <code>go</code> initializes them to 0 by default. By setting <code>c:=b[:2]</code> you initialized b to have 2 elements out of its capacity 5.</p>\n<p>For your 2nd q:</p>\n<blockquote>\n<p>why is the capacity of <code>d</code> 3</p>\n</blockquote>\n<p>As one of the commenters @Akavall mentioned.</p>\n<blockquote>\n<p>capacity, is the number of elements between the first element that a slice can access and the last element of the underlying array.</p>\n</blockquote>\n<p>So in your case the 1st element your slice <code>d</code> can access is the 2nd possition element of the array and the last element of underlying array is position 5th. So 5-2 is 3.</p>\n<p>I have hereby attached the official diagrammatic representation of slice accessing the array.\n<a href=\"https://i.stack.imgur.com/Bhzw9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Bhzw9.png\" alt=\"enter image description here\" /></a></p>\n<p>More examples of initialization and creation of slices are available further in official documentation.\n<a href=\"https://tour.golang.org/moretypes/13\" rel=\"nofollow noreferrer\">https://tour.golang.org/moretypes/13</a></p>\n"}], "owner": {"reputation": 2903, "user_id": 1363968, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/aead7eb0767fb1643bb7701a5f1c3282?s=128&d=identicon&r=PG&f=1", "display_name": "r123454321", "link": "https://stackoverflow.com/users/1363968/r123454321"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8300, "favorite_count": 6, "answer_count": 2, "score": 21, "last_activity_date": 1593437894, "creation_date": 1460941018, "last_edit_date": 1460971169, "question_id": 36683911, "link": "https://stackoverflow.com/questions/36683911/go-slices-capacity-length", "title": "Go slices - capacity/length?", "body": "<p>Trying to learn Go from the tutorial right now, and have a pretty basic question:</p>\n\n<pre><code> func main() {\n  a := make([]int, 5)\n  // [0,0,0,0,0] len=5 cap=5\n\n  b := make([]int, 0, 5)\n  // [] len=0 cap=5\n\n  c := b[:2]\n  // [0,0] len=2 cap=5\n\n  d := c[2:5]\n  // [0,0,0] len=3 cap=3\n}\n</code></pre>\n\n<p>Why does <code>c</code> look like <code>[0,0]</code> and have length 2? <code>b</code> was not originally zero'ed hence it being <code>[]</code>. So does setting <code>c</code> to <code>b[:2]</code> zero out the first two elements?</p>\n\n<p>Also, why is the capacity of <code>d</code> 3? Very confused.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["elasticsearch", "go", "logstash", "elastic-stack", "filebeat"], "answers": [{"tags": [], "owner": {"reputation": 3719, "user_id": 5216668, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UUnxO.jpg?s=128&g=1", "display_name": "Will Barnwell", "link": "https://stackoverflow.com/users/5216668/will-barnwell"}, "is_accepted": false, "score": 1, "last_activity_date": 1461015984, "creation_date": 1461015984, "answer_id": 36704866, "question_id": 36682714, "link": "https://stackoverflow.com/questions/36682714/how-filebeat-checks-for-new-content-in-a-file/36704866#36704866", "title": "How filebeat checks for new content in a file?", "body": "<p>Since filebeat is open source, you can always <a href=\"https://github.com/elastic/beats/blob/master/filebeat/crawler/prospector_log.go\" rel=\"nofollow\">go look yourself</a></p>\n\n<p>Here's the go code from the above linked file which checks if a file has been updated.</p>\n\n<p>I've heavily abridged this code, anywhere you see <code>...</code> is a code block that was not exactly relevant, I encourage anybody reading this too go look at the entire file, its some pretty well written go.</p>\n\n<pre><code> // Scan starts a scanGlob for each provided path/glob\nfunc (p *ProspectorLog) scan() {\n\n    newlastscan := time.Now()\n\n    // Now let's do one quick scan to pick up new files\n    for _, path := range p.config.Paths {\n        p.scanGlob(path)\n    }\n    p.lastscan = newlastscan\n}\n</code></pre>\n\n<p>The above function gets called every <code>n</code>-length time block where <code>n</code> is specified in the configuration. ScanGlob gets called, and is shown below.</p>\n\n<pre><code>// Scans the specific path which can be a glob (/**/**/*.log)\n// For all found files it is checked if a harvester should be started\nfunc (p *ProspectorLog) scanGlob(glob string) {\n\n    ...\n\n    // Evaluate the path as a wildcards/shell glob\n    matches, err := filepath.Glob(glob)\n    ...\n\n    // Check any matched files to see if we need to start a harvester\n    for _, file := range matches {\n        ...\n</code></pre>\n\n<p>For all files which matched the glob, check the statistics on the file using the OS specific call, for linux this would be <code>stat &lt;file&gt;</code> </p>\n\n<pre><code>        // Stat the file, following any symlinks.\n        fileinfo, err := os.Stat(file)\n        ...\n</code></pre>\n\n<p>Based on the stat call, it is decided if a harvester, the part of this go application which reads the files, needs to be started.</p>\n\n<pre><code>        // Conditions for starting a new harvester:\n        // - file path hasn't been seen before\n        // - the file's inode or device changed\n        if !isKnown {\n            p.checkNewFile(h)\n        } else {\n            h.Stat.Continue(&amp;lastinfo)\n            p.checkExistingFile(h, &amp;newFile, &amp;oldFile)\n        }\n\n        // Track the stat data for this file for later comparison to check for\n        // rotation/etc\n        p.prospectorList[h.Path] = *h.Stat\n    }\n}\n</code></pre>\n\n<p>TL;DR: Filebeat used the files statistics reported by the OS to see if the file has been updated since the last time it harvested the file.</p>\n"}], "owner": {"reputation": 395, "user_id": 1526342, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/JGPSA.jpg?s=128&g=1", "display_name": "droidlabour", "link": "https://stackoverflow.com/users/1526342/droidlabour"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1461021711, "creation_date": 1460930475, "last_edit_date": 1461021711, "question_id": 36682714, "link": "https://stackoverflow.com/questions/36682714/how-filebeat-checks-for-new-content-in-a-file", "title": "How filebeat checks for new content in a file?", "body": "<p>Does filebeat uses tail -f to check for new contents in a file and then flushes it over to the desired output? Or is there any other way it checks for new contents in a file?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1460935552, "post_id": 36682307, "comment_id": 60956214, "body": "a minor optimization would be <code>if len(line) &gt; 0 &amp;&amp; line[0] != &#39;#&#39; { ... }</code>"}], "tags": [], "owner": {"reputation": 23287, "user_id": 5981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ab183bb240ffd3a3966d5a615b4bdeb?s=128&d=identicon&r=PG", "display_name": "Phil Ross", "link": "https://stackoverflow.com/users/5981/phil-ross"}, "is_accepted": true, "score": 2, "last_activity_date": 1460927610, "creation_date": 1460927610, "answer_id": 36682307, "question_id": 36682205, "link": "https://stackoverflow.com/questions/36682205/parsing-file-ignoring-comments-and-blank-lines/36682307#36682307", "title": "Parsing file, ignoring comments and blank lines", "body": "<p><code>len(line) &gt; 0</code> will be true for the <code>\"# Hello\"</code> line, so it will get added to <code>output</code>.</p>\n\n<p>Currently, you are adding lines that either don't start with a # <em>or</em> are not empty. You need to only add lines that satisfy both conditions:</p>\n\n<pre><code>if !strings.HasPrefix(line, \"#\") &amp;&amp; len(line) &gt; 0 {\n    output[line] = true\n}\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 5225069, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gI2YZVdlwBE/AAAAAAAAAAI/AAAAAAAAAMI/DF-LtOoKmhM/photo.jpg?sz=128", "display_name": "tslnc04", "link": "https://stackoverflow.com/users/5225069/tslnc04"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 576, "favorite_count": 0, "accepted_answer_id": 36682307, "answer_count": 1, "score": 0, "last_activity_date": 1460927610, "creation_date": 1460927015, "question_id": 36682205, "link": "https://stackoverflow.com/questions/36682205/parsing-file-ignoring-comments-and-blank-lines", "title": "Parsing file, ignoring comments and blank lines", "body": "<p>As the title says, I am trying to parse a file but ignore comments (started with <code>#</code>) or blank lines. I have tried to make a system for this, yet it always seems to ignore that it should be ignoring comments and/or blank lines.</p>\n\n<pre><code>lines := strings.Split(d, \"\\n\")\nvar output map[string]bool = make(map[string]bool)\n\nfor _, line := range lines {\n    if strings.HasPrefix(line, \"#\") != true {\n        output[line] = true\n    } else if len(line) &gt; 0 {\n        output[line] = true\n    }\n}\n</code></pre>\n\n<p>When run (this is part of a function), it outputs the following</p>\n\n<pre><code>This is the input ('d' variable):\nMinecraft\nZerg Rush\nPokemon\n\n# Hello\n\nThis is the output when printed ('output' variable):\n\nmap[Minecraft:true Zerg Rush:true Pokemon:true :true # Hello:true]\n</code></pre>\n\n<p>My issue here is that it still keeps the \"\" and \"# Hello\" values, meaning that something failed, something I haven't been able to figure out.</p>\n\n<p>So, what am I doing wrong that this keeps the improper values?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1460921062, "post_id": 36681089, "comment_id": 60952054, "body": "Your source files should be under <code>$GOPATH&#47;src</code> directory, not directly under <code>$GOPATH</code>"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1460921210, "post_id": 36681089, "comment_id": 60952112, "body": "Unfortunately it will likely be hard to tell you exactly what the problem is without seeing your actual code.  One thing to check (after moving everything under <code>src</code> directory) is what package name you are setting in home.go.  home.go is not in main - it is in package <code>viewmodels</code>.  You would import it into <code>main.go</code> with <code>import myweb&#47;viewmodels</code>"}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1460921578, "post_id": 36681089, "comment_id": 60952268, "body": "@sberry they are under src, i updated my question."}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1460921747, "post_id": 36681089, "comment_id": 60952329, "body": "@sberry when  changed the package name in home.go to viewmodels, I get this error:  <code>main.go:9:2: cannot find package &quot;myweb&#47;viewmodels&quot; in any of: \t&#47;usr&#47;local&#47;Cellar&#47;go&#47;1.4.1&#47;libexec&#47;src&#47;myweb&#47;viewmodels (from $GOROOT) \t&#47;dev&#47;golang&#47;src&#47;myweb&#47;viewmodels (from $GOPATH)</code>"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 1, "creation_date": 1460921798, "post_id": 36681089, "comment_id": 60952342, "body": "Oh, sorry, didn&#39;t notice the <code>example.com</code> before.  Your import would be <code>import example.com&#47;myweb&#47;viewmodels</code>"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1460921853, "post_id": 36681089, "comment_id": 60952370, "body": "And your package declaration in <code>home.go</code> would be <code>package viewmodels</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1809, "user_id": 638217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4685d20d4efcbbcf604c73be727f230f?s=128&d=identicon&r=PG", "display_name": "Andreas Koch", "link": "https://stackoverflow.com/users/638217/andreas-koch"}, "is_accepted": false, "score": 1, "last_activity_date": 1460973804, "last_edit_date": 1460973804, "creation_date": 1460972914, "answer_id": 36690545, "question_id": 36681089, "link": "https://stackoverflow.com/questions/36681089/using-package-main-for-all-files-still-says-undefined/36690545#36690545", "title": "Using package main for all files, still says undefined", "body": "<p>You cannot mix two different packages in one directory. Each directory is its own package.</p>\n\n<p>The go documentation (see: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a>) states the following about packages that is relevant to your situation:</p>\n\n<blockquote>\n  <ul>\n  <li>Each package consists of one or more Go source files in a single directory.</li>\n  <li>The path to a package's directory determines its import path.</li>\n  </ul>\n</blockquote>\n\n<p>The solution to your problem is:</p>\n\n<ol>\n<li>Use <code>package viewmodels</code> for <code>$GOPATH/src/example.com/myweb/viewmodels/home.go</code></li>\n<li>Use <code>package main</code> for <code>$GOPATH/src/example.com/myweb/main.go</code> and <code>$GOPATH/src/example.com/myweb/api.go</code></li>\n<li>Add <code>import \"example.com/myweb/viewmodels\"</code> to the files using the <code>viewmodels</code> package (e.g. main.go, api.go)</li>\n</ol>\n\n<p>Your project would look something like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/CFrAE.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CFrAE.png\" alt=\"Screenshot of the possible project structure with a main package and a viewmodels package in a sub-directory\"></a></p>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1460973804, "creation_date": 1460920814, "last_edit_date": 1460921564, "question_id": 36681089, "link": "https://stackoverflow.com/questions/36681089/using-package-main-for-all-files-still-says-undefined", "title": "Using package main for all files, still says undefined", "body": "<p>I have 3 files currently, they all have <code>package main</code> at the top.</p>\n\n<pre><code>GOPATH/src/example.com/myweb/main.go\nGOPATH/src/example.com/myweb/api.go\nGOPATH/src/example.com/myweb/viewmodels/home.go\n</code></pre>\n\n<p>When I compile I get the error:</p>\n\n<pre><code>./main.go:21: undefined: Home\n./main.go:39: api.Home undefined (type API has no field or method Home)\n</code></pre>\n\n<p>I am compiling using:</p>\n\n<pre><code>go build\n</code></pre>\n\n<p>If I do this: </p>\n\n<pre><code>go build main.go api.go viewmodels/home.go\n</code></pre>\n\n<p>It says no such file or directory and then a path to a file that doesnt' exist:</p>\n\n<pre><code>GOPATH/src/example.com/myweb/viewmodels.main.go\n</code></pre>\n\n<p>If I am using package main, should this just work with go build ?</p>\n"}, {"tags": ["audio", "go"], "comments": [{"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1460919832, "post_id": 36680524, "comment_id": 60951561, "body": "Just an idea but wouldn&#39;t be better to let the front-end Javascript to play the sound data from the Go server using libraries like <a href=\"http://mohayonao.github.io/timbre.js/\" rel=\"nofollow noreferrer\">timbre.js</a> or <a href=\"https://github.com/colinbdclark/osc.js?files=1\" rel=\"nofollow noreferrer\">osc.js</a> since it doesn&#39;t seem like the server&#39;s task to interface with the audio hardware directly?"}, {"owner": {"reputation": 2777, "user_id": 4852094, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10102767534136292/picture?type=large", "display_name": "Rob", "link": "https://stackoverflow.com/users/4852094/rob"}, "reply_to_user": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1460924644, "post_id": 36680524, "comment_id": 60953341, "body": "Ya that helps.  It&#39;s just for a demo of a load balancer I&#39;m working on"}], "answers": [{"tags": [], "owner": {"reputation": 1809, "user_id": 638217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4685d20d4efcbbcf604c73be727f230f?s=128&d=identicon&r=PG", "display_name": "Andreas Koch", "link": "https://stackoverflow.com/users/638217/andreas-koch"}, "is_accepted": false, "score": 1, "last_activity_date": 1460974947, "creation_date": 1460974947, "answer_id": 36691245, "question_id": 36680524, "link": "https://stackoverflow.com/questions/36680524/how-to-make-server-play-sound-when-receiving-request/36691245#36691245", "title": "How to make server play sound when receiving request", "body": "<p>It depends on which operating system you want the code to work. Afaik there is no generic cross-platform solution for playing sound from go:</p>\n\n<ul>\n<li>On Linux you might need to rely on Pulse Audio with a package such as <a href=\"https://github.com/mesilliac/pulse-simple\" rel=\"nofollow\">github.com/mesilliac/pulse-simple</a></li>\n<li>On Windows and Mac you could use PortAudio with a package such as <a href=\"https://github.com/gordonklaus/portaudio\" rel=\"nofollow\">github.com/gordonklaus/portaudio</a></li>\n</ul>\n\n<p>If you want a practical example there is a go-based multi-source music player project called \"moggio\" at <a href=\"https://github.com/mjibson/moggio\" rel=\"nofollow\">github.com/mjibson/moggio</a> that plays audio from multiple sources on Linux, Mac and Windows.</p>\n\n<p>You can have a look at the <a href=\"https://github.com/mjibson/moggio/tree/master/output\" rel=\"nofollow\">github.com/mjibson/moggio/output</a> package. There you will find the code that moggio used to play music on Linux, Windows and Mac.</p>\n"}], "owner": {"reputation": 2777, "user_id": 4852094, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10102767534136292/picture?type=large", "display_name": "Rob", "link": "https://stackoverflow.com/users/4852094/rob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1460974947, "creation_date": 1460917861, "question_id": 36680524, "link": "https://stackoverflow.com/questions/36680524/how-to-make-server-play-sound-when-receiving-request", "title": "How to make server play sound when receiving request", "body": "<p>I want to make a server play a soundbyte every time it receives a request.  Is there  a way to do this if I'm using a Go based server?  The idea would be the server is hosting a browser window, it receives a request and the browser goes 'ping!'.</p>\n"}, {"tags": ["go", "ncurses"], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 4254375, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-6W5lSlfZRz8/AAAAAAAAAAI/AAAAAAAAAHk/M40Tcb1ioqw/photo.jpg?sz=128", "display_name": "Justin Flowers", "link": "https://stackoverflow.com/users/4254375/justin-flowers"}, "edited": false, "score": 0, "creation_date": 1460939340, "post_id": 36680769, "comment_id": 60956947, "body": "Yup, that was exactly it. Thanks so much!"}], "tags": [], "owner": {"reputation": 42737, "user_id": 4518274, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UPurS.png?s=128&g=1", "display_name": "Thomas Dickey", "link": "https://stackoverflow.com/users/4518274/thomas-dickey"}, "is_accepted": true, "score": 3, "last_activity_date": 1460919073, "creation_date": 1460919073, "answer_id": 36680769, "question_id": 36679535, "link": "https://stackoverflow.com/questions/36679535/accepting-only-alphanumerics-in-golang-and-ncurses/36680769#36680769", "title": "Accepting only alphanumerics in Golang and ncurses", "body": "<p>If you do not enable the <em>keypad</em> mode, (n)curses will return the individual bytes which make up a special key.</p>\n\n<p>To fix, add this to your program's initialization:</p>\n\n<pre><code>stdscr.Keypad(true)   // allow keypad input\n</code></pre>\n\n<p>which will return special keys such as right-arrow as values above 255.  goncurses has symbols defined for those, e.g., <code>KEY_RIGHT</code>.</p>\n"}], "owner": {"reputation": 135, "user_id": 4254375, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-6W5lSlfZRz8/AAAAAAAAAAI/AAAAAAAAAHk/M40Tcb1ioqw/photo.jpg?sz=128", "display_name": "Justin Flowers", "link": "https://stackoverflow.com/users/4254375/justin-flowers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 36680769, "answer_count": 1, "score": 0, "last_activity_date": 1460919073, "creation_date": 1460912571, "last_edit_date": 1460913237, "question_id": 36679535, "link": "https://stackoverflow.com/questions/36679535/accepting-only-alphanumerics-in-golang-and-ncurses", "title": "Accepting only alphanumerics in Golang and ncurses", "body": "<p>So, I'm teaching myself some Golang by making a simple resource management game with ncurses. I'm using <a href=\"https://github.com/rthornton128/goncurses\" rel=\"nofollow\" title=\"this library\">this library</a> to connect Golang to ncurses.</p>\n\n<p>I've made a simple text input panel that takes in one character at a time, displays it, and then adds it to a string composing the user's response. Here's what it looks like:</p>\n\n<pre><code>// Accept characters, printing them until end\nch := window.GetChar()\nkstr := gc.KeyString(ch)\nresponse := \"\"\ncur := 0\nfor kstr != \"enter\" {\n    // Diagnostic print to get key code of current character \n    window.Move(0,0)\n    window.ClearToEOL()\n    window.MovePrint(0, 0, ch)\n\n    // If its a backspace or delete, remove a character\n    // Otherwise as long as its a regular character add it\n    if ((ch == 127 || ch == 8) &amp;&amp; cur != 0){\n        cur--\n        response = response[:len(response)-1] \n        window.MovePrint(y, (x + cur), \" \")\n    } else if (ch &gt;= 33 &amp;&amp; ch &lt;= 122  &amp;&amp; cur &lt;= 52) {\n        window.MovePrint(y, (x + cur), kstr)\n        response = response + kstr\n        cur++\n    }\n\n    // Get next character\n    ch = window.GetChar()\n    kstr = gc.KeyString(ch)\n}\n</code></pre>\n\n<p>However, the arrow and function keys seem to be coming up as keycodes already associated with the normal a-zA-Z characters. For example, right-arrow comes up as 67 and F1 as 80. Any ideas what I'm doing wrong here, or if there's a better approach to taking in alphanumerics through ncurses? I'd like to avoid ncurses fields and classes as much as possible, because the point here is to learn Golang, not ncurses. Thanks!</p>\n"}, {"tags": ["android", "google-app-engine", "go", "oauth", "google-signin"], "comments": [{"owner": {"reputation": 1809, "user_id": 638217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4685d20d4efcbbcf604c73be727f230f?s=128&d=identicon&r=PG", "display_name": "Andreas Koch", "link": "https://stackoverflow.com/users/638217/andreas-koch"}, "edited": false, "score": 0, "creation_date": 1460976856, "post_id": 36677658, "comment_id": 60972090, "body": "Which Google API do you want to use?"}, {"owner": {"reputation": 633, "user_id": 1902969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/303ccdcc2f1d211ec4665f18f4bf5d39?s=128&d=identicon&r=PG", "display_name": "Ook", "link": "https://stackoverflow.com/users/1902969/ook"}, "reply_to_user": {"reputation": 1809, "user_id": 638217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4685d20d4efcbbcf604c73be727f230f?s=128&d=identicon&r=PG", "display_name": "Andreas Koch", "link": "https://stackoverflow.com/users/638217/andreas-koch"}, "edited": false, "score": 0, "creation_date": 1460980851, "post_id": 36677658, "comment_id": 60974935, "body": "I want to use Google sign in api. I just want to verify to token sent from Android app. User signs in from the app and the app sends a token to my backend server."}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1461564377, "post_id": 36677658, "comment_id": 61236734, "body": "You wrote: &quot;I just want to verify to token sent from Android app&quot;. That sentence doesn&#39;t make too much sense. You want to do the auth in go server side or do you want to do it on Android? Please clarify."}, {"owner": {"reputation": 633, "user_id": 1902969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/303ccdcc2f1d211ec4665f18f4bf5d39?s=128&d=identicon&r=PG", "display_name": "Ook", "link": "https://stackoverflow.com/users/1902969/ook"}, "edited": false, "score": 0, "creation_date": 1461568145, "post_id": 36677658, "comment_id": 61238642, "body": "Users will log on to the system on their mobile running an android app by using Google Sign-in. Then the android app will send the token to an web application written in Go. The web app will verify the token and check for the existing Google user ID in Google App Engine Datastore. The users can retrieve their private data from the web app to the android app only if the token is verified as valid on the web application side ."}, {"owner": {"reputation": 4649, "user_id": 681679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ba1bdfa6ba08225903a74383be42b06?s=128&d=identicon&r=PG", "display_name": "photoionized", "link": "https://stackoverflow.com/users/681679/photoionized"}, "edited": false, "score": 1, "creation_date": 1461698688, "post_id": 36677658, "comment_id": 61314617, "body": "The &quot;issue about latency and potential network errors warned on google sign-in integration guiding page&quot; is fairly silly. What the docs are pointing out is the obvious point that an additional API request is actually an additional network request that takes time. There&#39;s no reason not to use the original API endpoint. Just consider the additional API request as part of the time taken to actually authorize the user&#39;s google account."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 4649, "user_id": 681679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ba1bdfa6ba08225903a74383be42b06?s=128&d=identicon&r=PG", "display_name": "photoionized", "link": "https://stackoverflow.com/users/681679/photoionized"}, "edited": false, "score": 0, "creation_date": 1461931884, "post_id": 36677658, "comment_id": 61435135, "body": "@photoionized I believe you can post your comment as an answer - I would upvote it."}, {"owner": {"reputation": 990, "user_id": 2678741, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-iNrXywpt3Vk/AAAAAAAAAAI/AAAAAAAAABA/rKiRLAi5xLA/photo.jpg?sz=128", "display_name": "Guy", "link": "https://stackoverflow.com/users/2678741/guy"}, "edited": false, "score": 0, "creation_date": 1595183179, "post_id": 36677658, "comment_id": 111379652, "body": "Answered here: <a href=\"https://stackoverflow.com/a/62984078/2678741\">stackoverflow.com/a/62984078/2678741</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "is_accepted": true, "score": 14, "last_activity_date": 1461986440, "last_edit_date": 1461986440, "creation_date": 1461985743, "answer_id": 36950258, "question_id": 36677658, "link": "https://stackoverflow.com/questions/36677658/package-for-verifying-google-sign-in-token-in-go-running-on-gae/36950258#36950258", "title": "Package for verifying Google sign-in token in Go running on GAE", "body": "<p>I too recently faced this issue and found two solutions.</p>\n\n<p>But before that you need to understand what python(or other recommended client libraries)'s library does.</p>\n\n<ol>\n<li>It hit <a href=\"https://www.googleapis.com/oauth2/v2/certs\">https://www.googleapis.com/oauth2/v2/certs</a> to get array of rsa public keys.</li>\n<li>Decode token.</li>\n<li>Uses \"kid\" (key id) field from decoded token to generate pem key for matching RSA public key.</li>\n<li>Verify the signature of token (which is after 2nd dot in a jwt token) using pem key.</li>\n</ol>\n\n<p>Now two solutions:</p>\n\n<ol>\n<li><p>Using official oauth library  \"google.golang.org/api/oauth2/v2\"</p>\n\n<pre><code>func getTokenInfo(idToken string) (*oauth2.Tokeninfo, error) {\noauth2Service, err := oauth2.New(&amp;http.Client{})\nif err != nil {\n    return nil, err\n}\ntokenInfoCall := oauth2Service.Tokeninfo()\ntokenInfoCall.IdToken(idToken)\nreturn tokenInfoCall.Do()\n}\n</code></pre>\n\n<p>From Tokeninfo you can verify that audience (tokenInfo.Audience) and issued to(tokenInfo.IssuedTo) are valid. And other parameters that you want to check. But golang's official library doesn't follow the process that I mentioned earlier. It hits the www.googleapis.com/oauth2/v2/tokeninfo for generating tokeninfo\n(not www.googleapis.com/oauth2/v3/tokeninfo. v2 doesn't give some field like \"name\" but every field including email that you need to verify the token.).</p></li>\n<li><p>Using <a href=\"https://github.com/GoogleIdTokenVerifier/GoogleIdTokenVerifier\">GoogleIdTokenVerifier</a> library which is a port of python's library.</p></li>\n</ol>\n\n<p>What you can do to improve efficiency of process is to cache the certs and pem. Unless a token with new \"kid\" comes, don't hit the url.</p>\n\n<p>Do benchmark and check which approach is faster. That thing about latency can be wrong as you are using network to get certs.</p>\n"}], "owner": {"reputation": 633, "user_id": 1902969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/303ccdcc2f1d211ec4665f18f4bf5d39?s=128&d=identicon&r=PG", "display_name": "Ook", "link": "https://stackoverflow.com/users/1902969/ook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1524, "favorite_count": 4, "accepted_answer_id": 36950258, "answer_count": 1, "score": 18, "last_activity_date": 1527125488, "creation_date": 1460902474, "last_edit_date": 1527125488, "question_id": 36677658, "link": "https://stackoverflow.com/questions/36677658/package-for-verifying-google-sign-in-token-in-go-running-on-gae", "title": "Package for verifying Google sign-in token in Go running on GAE", "body": "<p>I have successfully received google sign-in token from my Android app on my web server written in Go running on GAE. I do not wish to use the </p>\n\n<pre><code>https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=XYZ123\n</code></pre>\n\n<p>because it has the issue about latency and potential network errors warned on google sign-in integration guiding page. So I am finding the way to use Google API Client Library for Go and I found this</p>\n\n<pre><code>https://github.com/google/google-api-go-client/blob/master/GettingStarted.md\n</code></pre>\n\n<p>I found that it was more complicated than the Java and Python Google API Client Library that I would need to just call the GoogleIdTokenVerifier method or verify_id_token function to get the information of the google user that has signed in on the Android app. I am not sure I am going to the right direction. Please guide me on how to verify the google sign-in token received from Android app.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1460913872, "post_id": 36677614, "comment_id": 60949310, "body": "<a href=\"https://gobyexample.com/goroutines\" rel=\"nofollow noreferrer\">gobyexample.com/goroutines</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "is_accepted": false, "score": 1, "last_activity_date": 1460910562, "last_edit_date": 1460910562, "creation_date": 1460902591, "answer_id": 36677681, "question_id": 36677614, "link": "https://stackoverflow.com/questions/36677614/trying-to-understand-goroutines/36677681#36677681", "title": "Trying to understand goroutines", "body": "<p>It is because the main function has been exited.</p>\n\n<p>When main function return, all goroutines are abruptly terminated, then program exits.</p>\n\n<p>You add a statment:</p>\n\n<pre><code>time.Sleep(100 * time.Second)\n</code></pre>\n\n<p>before main function return, and everything goes well.</p>\n\n<p>But a good practice in Go is to use channel, which is used to communicate between goroutines. You can use it to let main function wait for background goroutines to finish. </p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1460903214, "last_edit_date": 1460903214, "creation_date": 1460902662, "answer_id": 36677694, "question_id": 36677614, "link": "https://stackoverflow.com/questions/36677614/trying-to-understand-goroutines/36677694#36677694", "title": "Trying to understand goroutines", "body": "<p>In the case of </p>\n\n<pre><code> say(\"world\")\n go say(\"hello\")\n</code></pre>\n\n<p>The \"world\" call must complete before the \"hello\" goroutine is started.  The \"hello\" goroutine does not run or complete <a href=\"https://golang.org/ref/spec#Program_execution\">because main returns</a>.</p>\n\n<p>For </p>\n\n<pre><code>go say(\"world\")\ngo say(\"hello\")\n</code></pre>\n\n<p>the goroutines do not run or complete because main returns.</p>\n\n<p>Use <a href=\"http://godoc.org/sync#WaitGroup\">sync.WaitGroup</a> to prevent main from exiting before the goroutines complete:</p>\n\n<pre><code>func say(wg *sync.WaitGroup, s string) {\n  defer wg.Done()\n  for i := 0; i &lt; 5; i++ {\n    time.Sleep(100 * time.Millisecond)\n    fmt.Println(s)\n  }\n}\n\nfunc main() {\n  var wg sync.WaitGroup\n  wg.Add(2)\n  go say(&amp;wg, \"world\")\n  go say(&amp;wg, \"hello\")\n  wg.Wait()\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/8QpZgja1J4\">playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 44, "user_id": 4177293, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67be864b19b1a1f67fd5d6769e926fc8?s=128&d=identicon&r=PG&f=1", "display_name": "ER H", "link": "https://stackoverflow.com/users/4177293/er-h"}, "is_accepted": false, "score": 0, "last_activity_date": 1460902996, "creation_date": 1460902996, "answer_id": 36677744, "question_id": 36677614, "link": "https://stackoverflow.com/questions/36677614/trying-to-understand-goroutines/36677744#36677744", "title": "Trying to understand goroutines", "body": "<p>With </p>\n\n<p><code>func main() {\n    go say(\"world\")\n    say(\"hello\")\n}</code></p>\n\n<p>You are creating two separate goroutines, one is the main functions goroutine and one is the go say(\"world\"). Normally when functions are executed the programs jumps to that function, execute all code inside and then jumps to the line after where the function was called from.</p>\n\n<p>With goroutines you are not jumping inside the function but you are starting the goroutine in a separate thread and continuing to execute the line just after the call without waiting for it. </p>\n\n<p>Therefore the goroutine will not have time to finish before the main goroutine is done. </p>\n"}, {"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": 3, "last_activity_date": 1460910322, "last_edit_date": 1460910322, "creation_date": 1460909671, "answer_id": 36678982, "question_id": 36677614, "link": "https://stackoverflow.com/questions/36677614/trying-to-understand-goroutines/36678982#36678982", "title": "Trying to understand goroutines", "body": "<p>Congratulations for learning Go. As someone new, it is nice to understand concurrency and how it is different from parallelism.</p>\n\n<p><strong>Concurrency</strong><br>\nConcurrency is like a juggler juggling several balls in the air with one hand. No matter how many balls he is juggling, only one ball touch his hand at any moment.</p>\n\n<p><strong>Parallelism</strong><br>\nWhen the juggler starts juggling more balls with another hand in parallel, we have two concurrent <em>processes</em> running at the same time. </p>\n\n<p>Goroutines are great because they're both <em>concurrent</em> and <em>auto-parallel</em>, depending on the computing cores available and the <code>GOMAXPROCS</code> variable being set.</p>\n\n<p><strong>The One-handed Juggler</strong><br>\nBack to the one-handed, single-cored, concurrent juggler. Imagine him juggling three balls named \"hello\", \"world\", and  \"mars\" respectively with the hand being the <code>main</code> routine.</p>\n\n<pre><code>var balls = []string{\"hello\", \"world\", \"mars\"}\n\nfunc main() {\n        go say(balls[0])\n        go say(balls[1])\n        go say(balls[2])\n}\n</code></pre>\n\n<p>Or more appropriately,</p>\n\n<pre><code>func main() {\n        for _, ball := range balls {\n                go say(ball)\n        }\n}\n</code></pre>\n\n<p>Once the three balls are thrown up into the air sequentially, the juggler simply retreats his hand right away. That is, the <code>main</code> routine exits before the first ball thrown can even land on his hand. Shame, the balls just drop to the ground. Bad show.</p>\n\n<p>In order to get the balls back in his hand, the juggler has to make sure he <strong>waits</strong> for them. This means his hand needs to be able to keep track of and count the balls he threw and learn when each is landing.</p>\n\n<p>The most straightforward way is to use <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow\">sync.WaitGroup</a>:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"time\"\n    \"sync\"\n)\n\nvar balls = []string{\"hello\", \"world\", \"mars\"}\nvar wg sync.WaitGroup\n\nfunc main() {\n        for _, ball := range balls {\n                // One ball thrown\n                wg.Add(1)\n                go func(b string) {\n                        // Signals the group that this routine is done.\n                        defer wg.Done()\n                        // each ball hovers for 1 second\n                        time.Sleep(time.Duration(1) * time.Second)\n                        fmt.Println(b)\n                        // wg.Done() is called before goroutine exits\n                }(ball)\n        }\n\n        // The juggler can do whatever he pleases while the \n        // balls are hanging in the air.\n\n        // This hand will come back to grab the balls after 1s.\n        wg.Wait()\n}\n</code></pre>\n\n<p><code>WaitGroup</code> is simple. When a goroutine is spawned, one adds to a \"backlog counter\" with <code>WaitGroup.Add(1)</code> and call <code>WaitGroup.Done()</code> to decrease the counter. Once the backlog becomes 0, it means that all goroutines are done and <code>WaitGroup</code> should stop waiting (and grab the balls!).</p>\n\n<p>While using channel(s) for synchronization is fine, it is encouraged to use available concurrent tools as appropriate especially when the use of channels make the code more complex and hard to comprehend.</p>\n"}], "owner": {"reputation": 4333, "user_id": 197221, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/7f9uz.jpg?s=128&g=1", "display_name": "chessweb", "link": "https://stackoverflow.com/users/197221/chessweb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 1, "accepted_answer_id": 36677694, "answer_count": 4, "score": 3, "last_activity_date": 1460910562, "creation_date": 1460902262, "question_id": 36677614, "link": "https://stackoverflow.com/questions/36677614/trying-to-understand-goroutines", "title": "Trying to understand goroutines", "body": "<p>I've been playing around with the following code from <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow\">A Tour of Go</a>, but I don't understand what is going on when I apply some minor changes. The original code is this</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc say(s string) {\n    for i := 0; i &lt; 5; i++ {\n        time.Sleep(100 * time.Millisecond)\n        fmt.Println(s)\n    }\n}\n\nfunc main() {\n    go say(\"world\")\n    say(\"hello\")\n}\n</code></pre>\n\n<p>and it produces this</p>\n\n<pre><code>world\nhello\nhello\nworld\nworld\nhello\nhello\nworld\nworld\nhello\n</code></pre>\n\n<p>which is OK: five times hello, five times world. I starts to get strange when I call </p>\n\n<pre><code>say(\"world\")\ngo say(\"hello\")\n</code></pre>\n\n<p>Now the output is just </p>\n\n<pre><code>world\nworld\nworld\nworld\nworld\n</code></pre>\n\n<p>No hello whatsoever. It gets even weirder with two goroutines </p>\n\n<pre><code>go say(\"world\")\ngo say(\"hello\")\n</code></pre>\n\n<p>Now there is no output at all. When I change <code>i &lt; 5</code> to <code>i &lt; 2</code> and call </p>\n\n<pre><code>go say(\"world\")\nsay(\"hello\")\n</code></pre>\n\n<p>I get </p>\n\n<pre><code>world\nhello\nhello\n</code></pre>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 8, "last_activity_date": 1460902452, "creation_date": 1460902452, "answer_id": 36677656, "question_id": 36677578, "link": "https://stackoverflow.com/questions/36677578/go-text-template-with-tabwriter/36677656#36677656", "title": "go text/template with tabwriter", "body": "<p>Replace </p>\n\n<pre><code>t.Execute(os.Stdout, data)\n</code></pre>\n\n<p>with</p>\n\n<pre><code>w := tabwriter.NewWriter(os.Stdout, 8, 8, 8, ' ', 0)\nif err := t.Execute(w, data); err != nil {\n    // handle error\n}\nw.Flush()\n</code></pre>\n\n<p>Also, add tabs to the template where you want the column breaks.</p>\n\n<p><a href=\"http://play.golang.org/p/oQE0qIzSAI\" rel=\"noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 67, "user_id": 6216060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59cda67b2d33dd3dbf64ed3d1c89153e?s=128&d=identicon&r=PG&f=1", "display_name": "guillaume0811", "link": "https://stackoverflow.com/users/6216060/guillaume0811"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1999, "favorite_count": 1, "accepted_answer_id": 36677656, "answer_count": 1, "score": 2, "last_activity_date": 1460904768, "creation_date": 1460902040, "last_edit_date": 1460904768, "question_id": 36677578, "link": "https://stackoverflow.com/questions/36677578/go-text-template-with-tabwriter", "title": "go text/template with tabwriter", "body": "<p>I try to have a pretty table with text/template but the columns are not aligned.\ntext/tabwriter work but text/template make a cleaner code.</p>\n\n<p>How can I use text/template with text/tabwriter?</p>\n\n<p>This is my test : </p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"text/template\"\n)\n\ntype a struct {\n    Title string\n    Items []items\n}\n\ntype items struct {\n    Title string\n    Body  string\n}\n\nconst templ = `{{.Title}}{{range .Items}}\n{{.Title}}  {{.Body}}{{end}}\n`\n\nfunc main() {\n    data := a{\n        Title: \"title1\",\n        Items: []items{\n            {\"item1\", \"body1\"},\n            {\"item2\", \"body2\"},\n            {\"verylongitem3\", \"body3\"}},\n    }\n    t := template.New(\"test\")\n    t, _ = t.Parse(templ)\n    t.Execute(os.Stdout, data)\n}\n</code></pre>\n\n<p>Output : </p>\n\n<pre><code>title1\nitem1   body1\nitem2   body2\nverylongitem3   body3\n</code></pre>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 1, "creation_date": 1460901793, "post_id": 36676834, "comment_id": 60944921, "body": "FYI, if you are expecting to close a channel, the idomatic way of reading a channel is <code>for v := range c {</code> as you don&#39;t need to check OK - the for loop will exit when the channel is closed. and if u don&#39;t expect a channel to close, use a <code>for { select { case v := &lt;- c: ... </code>. that way you can have additional <code>case</code> conditions such as timeouts, monitoring cancel tokens, etc and break out the for loop when an exit condition is detected."}], "answers": [{"comments": [{"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 0, "creation_date": 1460898998, "post_id": 36677013, "comment_id": 60943962, "body": "I know, that&#39;s also on purpose, to leave one &quot;element&quot; of channel&#39;s capacity empty."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 0, "creation_date": 1460899150, "post_id": 36677013, "comment_id": 60944006, "body": "But it cause a deadlock. In main you wait for n&#39;s message in channel forever because you don&#39;t send it."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1460898912, "creation_date": 1460898912, "answer_id": 36677013, "question_id": 36676834, "link": "https://stackoverflow.com/questions/36676834/closing-channels-in-go/36677013#36677013", "title": "Closing channels in Go", "body": "<p>For loop in main expect n communication in channel, but you produce only n-1 in func fibonacci</p>\n\n<pre><code>func fibonacci(n int, c chan int) {\n    x, y := 0, 1\n    for i := 0; i &lt; n; i++ { //here\n        c &lt;- x\n        x, y = y, x+y\n\n    }\n    // close(c) // It's commented out on purpose\n}\n</code></pre>\n\n<p>should work\n<a href=\"http://play.golang.org/p/zdRuy14f9x\" rel=\"nofollow\">http://play.golang.org/p/zdRuy14f9x</a></p>\n"}, {"tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": true, "score": 5, "last_activity_date": 1460899282, "last_edit_date": 1460899282, "creation_date": 1460898934, "answer_id": 36677018, "question_id": 36676834, "link": "https://stackoverflow.com/questions/36676834/closing-channels-in-go/36677018#36677018", "title": "Closing channels in Go", "body": "<p>You're writing <em>n</em> values into the channel (from 0 to <em>n-1</em>), but are trying to read <em>n+1</em> values from the channel (from 0 to <em>n</em>).  Without explicitly closing the channel, the <code>main</code> function will wait forever for this last value.</p>\n\n<blockquote>\n  <p>What exactly is causing the deadlock?</p>\n</blockquote>\n\n<p>After <em>n</em> iterations, the goroutine running the <code>fibonacci</code> function will exit. After this goroutine has exited, the only remaining goroutine in your program is the <code>main</code> goroutine, and this goroutine is waiting for some data to be written to the <code>c</code> channel -- and since there is no other goroutine left that might ever write data into this channel, it will wait forever. This is exactly what the error message is trying to tell you: <em>\"all goroutines</em> (\"all\" is just \"one\", here) <em>are asleep\"</em>.</p>\n\n<p>The <code>_, ok := &lt;- c</code> call in the <code>main</code> function will only stop blocking as soon as the <code>c</code> channel is closed (as reading from a channel is blocking, this needs to be done from another goroutine). When the channel is closed, the <code>main</code> function will read remaining data from the channel (when it's a buffered channel)</p>\n"}], "owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1489, "favorite_count": 0, "accepted_answer_id": 36677018, "answer_count": 2, "score": 0, "last_activity_date": 1460899282, "creation_date": 1460897986, "question_id": 36676834, "link": "https://stackoverflow.com/questions/36676834/closing-channels-in-go", "title": "Closing channels in Go", "body": "<p>I am learning how channels work in Go and have stumbled upon a problem with closing the channels. This is a modified example from <em>A Tour of Go</em>, which generates n-1 fibonacci numbers and sends them through the channels, leaving the last \"element\" of the channel capacity unused.</p>\n\n<pre><code>func fibonacci(n int, c chan int) {\n    x, y := 0, 1\n    for i := 0; i &lt; n-1; i++ {\n        c &lt;- x\n        x, y = y, x+y\n\n    }\n    // close(c) // It's commented out on purpose\n}\n\nfunc main() {\n    n := 10\n    c := make(chan int, n)\n    go fibonacci(n, c)\n\n    for i := 0; i &lt; n; i++ {\n        _, ok := &lt;-c\n        fmt.Println(ok)\n    }\n}\n</code></pre>\n\n<p>The problem is that I get:</p>\n\n<blockquote>\n  <p>fatal error: all goroutines are asleep - deadlock!</p>\n</blockquote>\n\n<p>when I do not close the channel. What exactly is causing the deadlock? Why  can't I receive from the channel in its capacity boundaries when I don't close it?</p>\n"}, {"tags": ["go", "dependency-injection"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1460907380, "post_id": 36676691, "comment_id": 60946952, "body": "<a href=\"https://robots.thoughtbot.com/interface-with-your-database-in-go\" rel=\"nofollow noreferrer\">robots.thoughtbot.com/interface-with-your-database-in-go</a> + <a href=\"http://www.alexedwards.net/blog/organising-database-access#using-an-interface\" rel=\"nofollow noreferrer\">alexedwards.net/blog/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1460906617, "post_id": 36677378, "comment_id": 60946660, "body": "I don&#39;t define interface more precisely because the <code>mongoDao</code> implementation is the same for any entity... so why should I repeat the same code many and many time?"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1460900856, "creation_date": 1460900856, "answer_id": 36677378, "question_id": 36676691, "link": "https://stackoverflow.com/questions/36676691/how-to-implement-dependency-injection-in-go/36677378#36677378", "title": "How to implement dependency injection in Go", "body": "<p>This generalization</p>\n\n<pre><code>DAO interface {\n    Insert(entity interface{}) error\n</code></pre>\n\n<p>looks over-helming\nYou both assert to  <code>*models.User</code> for mongo </p>\n\n<pre><code>doc := entity.(*models.User)\n</code></pre>\n\n<p>and do</p>\n\n<pre><code>user := &amp;models.User{}\nuserController.dao.Insert(user)\n</code></pre>\n\n<p>when use your generic DAO interface.\nWhy don't you just define interface more precisely?</p>\n\n<pre><code>DAO interface {\n    Insert(entity *models.User) error\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1461088132, "post_id": 36687020, "comment_id": 61035565, "body": "Nice solution... but the problems is that there is no way to cast-down the input <code>Entity</code> to a <code>User</code> (in the end I&#39;ll generate JSON to be stored in MongoDB)."}, {"owner": {"reputation": 271, "user_id": 4621159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2074b013614ff775ea6b0368b0f8e6?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Gustafsson", "link": "https://stackoverflow.com/users/4621159/tobias-gustafsson"}, "reply_to_user": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1461103333, "post_id": 36687020, "comment_id": 61044314, "body": "There may be something I don&#39;t understand here but why do you need to down cast it to User? Marshaling is done using reflection. Here&#39;s an updated example that also does JSON: <a href=\"http://play.golang.org/p/gVfZ_Zm1oA\" rel=\"nofollow noreferrer\">play.golang.org/p/gVfZ_Zm1oA</a>,"}], "tags": [], "owner": {"reputation": 271, "user_id": 4621159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a2074b013614ff775ea6b0368b0f8e6?s=128&d=identicon&r=PG&f=1", "display_name": "Tobias Gustafsson", "link": "https://stackoverflow.com/users/4621159/tobias-gustafsson"}, "is_accepted": true, "score": 1, "last_activity_date": 1460961656, "creation_date": 1460961656, "answer_id": 36687020, "question_id": 36676691, "link": "https://stackoverflow.com/questions/36676691/how-to-implement-dependency-injection-in-go/36687020#36687020", "title": "How to implement dependency injection in Go", "body": "<p>How about creating an interface that you implement for the Entity struct?</p>\n\n<pre><code>type Entitier interface {\n    GetEntity() *Entity\n}\n</code></pre>\n\n<p>The implementation would simply return a pointer to itself that you can now use in the <code>Insert</code> and <code>Update</code> methods of your DAO. This would also have the added benefit of letting you be more specific in the declarations of your DAO methods. Instead of simply stating that they take an arbitrary <code>interface{}</code> as argument you could now say that they take an <code>Entitier</code>.</p>\n\n<p>Like so:</p>\n\n<pre><code>func (dao *mongoDAO) Update(id string, update Entitier) error\n</code></pre>\n\n<p>Here's a minimal complete example of what I mean:</p>\n\n<p><a href=\"http://play.golang.org/p/lpVs_61mfM\" rel=\"nofollow\">http://play.golang.org/p/lpVs_61mfM</a></p>\n\n<p>Hope this gives you some ideas! You might want to adjust naming of <code>Entity</code>/<code>Entitier</code>/<code>GetEntity</code> for style and clarity once you've settled on the pattern to use.</p>\n"}], "owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 611, "favorite_count": 0, "accepted_answer_id": 36687020, "answer_count": 2, "score": 0, "last_activity_date": 1460961656, "creation_date": 1460897218, "question_id": 36676691, "link": "https://stackoverflow.com/questions/36676691/how-to-implement-dependency-injection-in-go", "title": "How to implement dependency injection in Go", "body": "<p>I'm porting an app from <code>Play</code> (Scala) to <code>Go</code> and wondering how to implement dependency injection. In Scala I used the cake pattern, while in <code>Go</code> I implemented a <code>DAO</code> interface along with an implementation for Mongo.</p>\n\n<p>Here below is how I tried to implement a pattern that let me change the <code>DAO</code> implementation as needed (e.g. test, different DB, etc.):</p>\n\n<p><strong>1. entity.go</strong></p>\n\n<pre><code>package models\n\nimport (\n    \"time\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype (\n    Entity struct {\n        Id        bson.ObjectId `json:\"id,omitempty\" bson:\"_id,omitempty\"`\n        CreatedAt time.Time     `json:\"createdAt,omitempty\" bson:\"createdAt,omitempty\"`\n        LastUpdate time.Time    `json:\"lastUpdate,omitempty\" bson:\"lastUpdate,omitempty\"`\n    }\n)\n</code></pre>\n\n<p><strong>2. user.go</strong></p>\n\n<pre><code>package models\n\nimport (\n    \"time\"\n)\n\ntype (\n    User struct {\n        Entity                  `bson:\",inline\"`\n        Name      string        `json:\"name,omitempty\" bson:\"name,omitempty\"`\n        BirthDate time.Time     `json:\"birthDate,omitempty\" bson:\"birthDate,omitempty\"`\n    }\n)\n</code></pre>\n\n<p><strong>3. dao.go</strong></p>\n\n<pre><code>package persistence\n\ntype (\n    DAO interface {\n        Insert(entity interface{}) error\n        List(result interface{}, sort string) error\n        Find(id string, result interface{}) error\n        Update(id string, update interface{}) error\n        Remove(id string) error\n        Close()\n    }\n\n    daoFactory func() DAO\n)\n\nvar (\n    New daoFactory\n)\n</code></pre>\n\n<p><strong>4. mongoDao.go</strong> (DB info and collection name are hard-coded since it's just an example)</p>\n\n<pre><code>package persistence\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"errors\"\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n    \"github.com/fatih/structs\"\n\n    \"cmd/server/models\"\n)\n\ntype (\n    mongoDAO struct{\n        session *mgo.Session\n    }\n)\n\nfunc NewMongoDAO() DAO {\n    dialInfo := &amp;mgo.DialInfo{\n        Addrs:      []string{\"localhost:27017\"},\n        Timeout:    60 * time.Second,\n        Database:   \"test\",\n    }\n\n    session, err := mgo.DialWithInfo(dialInfo)\n\n    if err != nil {\n        panic(err)\n    }\n\n    session.SetMode(mgo.Monotonic, true)\n\n    return &amp;mongoDAO{session}\n}\n\nfunc (dao *mongoDAO) Insert(entity interface{}) error {\n\n    doc := entity.(*models.User)\n    doc.Id = bson.NewObjectId()\n    doc.CreatedAt = time.Now().UTC()\n    doc.LastUpdate = time.Now().UTC()\n\n    return dao.session.DB(\"test\").C(\"users\").Insert(doc)\n}\n\nfunc (dao *mongoDAO) List(result interface{}, sort string) error {\n    return dao.session.DB(\"test\").C(\"users\").Find(nil).Sort(sort).All(result)\n}\n\nfunc (dao *mongoDAO) Find(id string, result interface{}) error {\n    if !bson.IsObjectIdHex(id) {\n        return errors.New(fmt.Sprintf(\"%s is not a valid hex id\", id))\n    }\n\n    oid := bson.ObjectIdHex(id)\n\n    return dao.session.DB(\"test\").C(\"users\").FindId(oid).One(result)\n}\n\nfunc (dao *mongoDAO) Update(id string, update interface{}) error {\n    if !bson.IsObjectIdHex(id) {\n        return errors.New(fmt.Sprintf(\"%s is not a valid hex id\", id))\n    }\n\n    oid := bson.ObjectIdHex(id)\n\n    doc := update.(*models.User)\n    doc.LastUpdate = time.Now().UTC()\n\n    return dao.session.DB(\"test\").C(\"users\").Update(oid, bson.M{\"$set\": structs.Map(update)})\n}\n\nfunc (dao *mongoDAO) Remove(id string) error {\n    if !bson.IsObjectIdHex(id) {\n        return errors.New(fmt.Sprintf(\"%s is not a valid hex id\", id))\n    }\n\n    oid := bson.ObjectIdHex(id)\n\n    return dao.session.DB(\"test\").C(\"users\").RemoveId(oid)\n}\n\nfunc (dao *mongoDAO) Close() {\n    dao.session.Close()\n}\n\nfunc init() {\n    New = NewMongoDAO\n}\n</code></pre>\n\n<p>Finally, here is how I use the types above:</p>\n\n<p><strong>5. userController.go</strong></p>\n\n<pre><code>package controllers\n\nimport (\n    \"net/http\"\n    \"github.com/labstack/echo\"\n\n    \"cmd/server/models\"\n    \"cmd/server/persistence\"\n)\n\ntype (\n    UserController struct {\n        dao persistence.DAO\n    }\n)\n\nfunc NewUserController(dao persistence.DAO) *UserController {\n    return &amp;UserController{dao}\n}\n\nfunc (userController *UserController) CreateUser() echo.HandlerFunc {\n    return func(context echo.Context) error {\n        user := &amp;models.User{}\n\n        if err := context.Bind(user); err != nil {\n            return err\n        }\n\n        if err := userController.dao.Insert(user); err != nil {\n            return err\n        }\n\n        return context.JSON(http.StatusCreated, user)\n    }\n}\n\nfunc (userController *UserController) UpdateUser() echo.HandlerFunc {\n    return func(context echo.Context) error {\n        user := &amp;models.User{}\n\n        if err := context.Bind(user); err != nil {\n            return err\n        }\n\n        id := context.Param(\"id\")\n        if err := userController.dao.Update(id, user); err != nil {\n            return err\n        }\n\n        return context.JSON(http.StatusOK, user)\n    }\n}\n\n....\n</code></pre>\n\n<p>The code above is 90% fine... I've just a problem in <code>mongoDao.go</code> with methods <code>Insert</code> and <code>Update</code> where the compiler forces me to cast input <code>entity</code> to a specific type (<code>*models.User</code>), but this prevents me from having a generic <code>DAO</code> component that works for all types. How do I fix this issue?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 0, "creation_date": 1460955469, "post_id": 36676413, "comment_id": 60960306, "body": "backtick located above of your tab key on your keyboard"}, {"owner": {"reputation": 311, "user_id": 692913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99374f68ba2909a1e694227ecff3e23d?s=128&d=identicon&r=PG", "display_name": "mlecar", "link": "https://stackoverflow.com/users/692913/mlecar"}, "edited": false, "score": 0, "creation_date": 1477346571, "post_id": 36676413, "comment_id": 67719752, "body": "Not above every keyboard, but I got the point. This question and the answer helped me a lot! Thank you all!"}], "answers": [{"comments": [{"owner": {"reputation": 411, "user_id": 6205397, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ff2a90faa5b27c204ced0d63900e8ece?s=128&d=identicon&r=PG&f=1", "display_name": "GoGo", "link": "https://stackoverflow.com/users/6205397/gogo"}, "edited": false, "score": 0, "creation_date": 1460898343, "post_id": 36676460, "comment_id": 60943720, "body": "Oh, GoLang uses backtick. Thank you ma_il."}], "tags": [], "owner": {"reputation": 5437, "user_id": 1257094, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Ob6MH.jpg?s=128&g=1", "display_name": "milgner", "link": "https://stackoverflow.com/users/1257094/milgner"}, "is_accepted": false, "score": 2, "last_activity_date": 1460948537, "last_edit_date": 1490005096, "creation_date": 1460896028, "answer_id": 36676460, "question_id": 36676413, "link": "https://stackoverflow.com/questions/36676413/syntax-error-unexpected-son-expecting-semicolon-newline-or/36676460#36676460", "title": "syntax error: unexpected son, expecting semicolon, newline, or }", "body": "<p>These two are distinct characters: the apostrophe (') and backtick (`). The Go language uses backticks for struct type annotations, also called struct tags. In your example, they were used to annotate JSON key names for the <code>encoding/json</code> package to use. See <a href=\"https://superuser.com/questions/254076/how-do-i-type-the-tick-and-backtick-characters-on-windows#254077\">this question</a> on how to input them.</p>\n"}], "owner": {"reputation": 411, "user_id": 6205397, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ff2a90faa5b27c204ced0d63900e8ece?s=128&d=identicon&r=PG&f=1", "display_name": "GoGo", "link": "https://stackoverflow.com/users/6205397/gogo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1438, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1460948537, "creation_date": 1460895712, "question_id": 36676413, "link": "https://stackoverflow.com/questions/36676413/syntax-error-unexpected-son-expecting-semicolon-newline-or", "title": "syntax error: unexpected son, expecting semicolon, newline, or }", "body": "<p>I got this error when I used normal keyboard for <code>'</code> in json format as below.</p>\n\n<pre><code>type Movie struct {\nTitle   string\nYear    int     'json:\"released\"'\nColor   bool    'json:\"color,omitempty\"'\nActors  []string}\n\n`-go run * ----&gt; :syntax error: unexpected son, expecting semicolon, newline, or }\n</code></pre>\n\n<p>and, then, I copied \" ` \" from stackOverflow and replaced with the original ones as below </p>\n\n<pre><code>type Movie struct {\nTitle   string\nYear    int     `json:\"released\"`\nColor   bool    `json:\"color,omitempty\"`\nActors  []string}    \n</code></pre>\n\n<p>and, then, the syntax is gone :(\ndoes GO file expect ' as unicode or is there any setting for that?</p>\n"}, {"tags": ["facebook", "go", "oauth-2.0", "google-oauth"], "answers": [{"tags": [], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "is_accepted": true, "score": 1, "last_activity_date": 1460864092, "last_edit_date": 1460864092, "creation_date": 1460863678, "answer_id": 36672360, "question_id": 36672107, "link": "https://stackoverflow.com/questions/36672107/unable-to-use-package-golang-org-x-oauth2-to-authenticate-with-facebook-miss/36672360#36672360", "title": "Unable to use package &quot;golang.org/x/oauth2&quot; to authenticate with facebook: &quot;Missing redirect_uri parameter&quot;", "body": "<p>I found out what was missing. I apparently need to add the <code>RedirectURL</code>field in the <code>oauthConfig</code> struct to get <code>Exchange()</code> to work properly. This is not the case for Slack or GitHub but apparently FB is slightly more picky.</p>\n\n<pre><code>var oauthConf = &amp;oauth2.Config{\n        ClientID:     \"YOUR_CLIENT_ID\",\n        ClientSecret: \"YOUR_CLIENT_SECRET\",\n        RedirectURL:  \"http://localhost:9090/oauth2callback\", /* Fixed! */\n        Scopes:       []string{\"public_profile\"},\n        Endpoint:     facebook.Endpoint,\n    }\n</code></pre>\n"}], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 0, "accepted_answer_id": 36672360, "answer_count": 1, "score": 3, "last_activity_date": 1460864154, "creation_date": 1460860733, "last_edit_date": 1460864154, "question_id": 36672107, "link": "https://stackoverflow.com/questions/36672107/unable-to-use-package-golang-org-x-oauth2-to-authenticate-with-facebook-miss", "title": "Unable to use package &quot;golang.org/x/oauth2&quot; to authenticate with facebook: &quot;Missing redirect_uri parameter&quot;", "body": "<p>This code works:</p>\n\n<pre><code>func handleFacebookCallback(w http.ResponseWriter, r *http.Request) {\n    state := r.FormValue(\"state\")\n    if state != oauthStateString {\n        fmt.Printf(\"invalid oauth state, expected '%s', got '%s'\\n\", oauthStateString, state)\n        http.Redirect(w, r, \"/\", http.StatusTemporaryRedirect)\n        return\n    }\n\n    code := r.FormValue(\"code\")\n\n////////////////////////////////////////////////////    \n    Url, err := url.Parse(oauthConf.Endpoint.TokenURL)\n    if err != nil {\n        log.Fatal(\"Parse: \", err)\n    }\n    parameters := url.Values{}\n    parameters.Add(\"client_id\", oauthConf.ClientID)\n    parameters.Add(\"client_secret\", oauthConf.ClientSecret)\n    parameters.Add(\"redirect_uri\", \"http://localhost:9090/oauth2callback\")\n    parameters.Add(\"code\", code)\n    Url.RawQuery = parameters.Encode()\n    resp, err := http.Get(Url.String())\n\n    if err != nil {\n        fmt.Printf(\"Get: %s\\n\", err)\n        http.Redirect(w, r, \"/\", http.StatusTemporaryRedirect)\n        return\n    }\n    defer resp.Body.Close()\n</code></pre>\n\n<p>But when I replace the part below the marker <code>//////...</code> with:</p>\n\n<pre><code>    token, err := oauthConf.Exchange(oauth2.NoContext, code)\n    if err != nil {\n        fmt.Printf(\"oauthConf.Exchange() failed with '%s'\\n\", err)\n        http.Redirect(w, r, \"/\", http.StatusTemporaryRedirect)\n        return\n    }\n</code></pre>\n\n<p>I get:</p>\n\n<blockquote>\n  <p>oauthConf.Exchange() failed with 'oauth2: cannot fetch token: 400 Bad\n  Request Response: {\"error\":{\"message\":\"Missing redirect_uri\n  parameter.\",\"type\":\"OAuthException\",\"code\":191,\"fbtrace_id\":\"XXXX\"}}'</p>\n</blockquote>\n\n<p>Is the package <code>golang.org/x/oauth2</code> unable to exchange a <code>code</code> for a <code>token</code>?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1460859504, "post_id": 36671997, "comment_id": 60935098, "body": "check the error from <code>Decode</code>."}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1460860037, "post_id": 36671997, "comment_id": 60935182, "body": "@hobbs I updated my question with the error code, I don&#39;t see any output."}], "answers": [{"comments": [{"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1460861773, "post_id": 36672169, "comment_id": 60935433, "body": "thanks!  btw, any links to a production example of a API client that I should look at?"}, {"owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "reply_to_user": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1460862142, "post_id": 36672169, "comment_id": 60935489, "body": "No problem! I tend to just use the <code>http.Client</code> and add another layer of abstraction if I need something more domain specific. Not sure if that helps."}], "tags": [], "owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "is_accepted": false, "score": 2, "last_activity_date": 1460861407, "creation_date": 1460861407, "answer_id": 36672169, "question_id": 36671997, "link": "https://stackoverflow.com/questions/36671997/json-in-api-call-is-not-decoding-correctly-i-am-getting-a-blank-struct/36672169#36672169", "title": "JSON in API call is not decoding correctly, I am getting a blank struct", "body": "<p>Its because you have too many levels of nesting with the <code>map</code> > <code>Company</code> > <code>Website</code>. The <code>map</code> effectively builds another layer on top of it so its expecting three levels of JavaScript objects nested. In actuality, the JSON you provided only has two with <code>Company</code> > <code>Website</code>. </p>\n\n<p>So there are a couple of ways to get it to work; choose the one that works best for you.</p>\n\n<p>You can do:</p>\n\n<pre><code>r := map[string]Website{}\njson.NewDecoder(res).Decode(&amp;r)\n</code></pre>\n\n<p>Or you can do:</p>\n\n<pre><code>r := Company{}\njson.NewDecoder(res).Decode(&amp;r)\n</code></pre>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1460861407, "creation_date": 1460859438, "last_edit_date": 1460860017, "question_id": 36671997, "link": "https://stackoverflow.com/questions/36671997/json-in-api-call-is-not-decoding-correctly-i-am-getting-a-blank-struct", "title": "JSON in API call is not decoding correctly, I am getting a blank struct", "body": "<p>My JSON looks like this:</p>\n\n<pre><code>{\n  \"website\": {\n    \"id\": 8,\n    \"account_id\": 9,\n    \"name\": \"max\",\n    \"website_url\": \"\",\n    \"subscription_status\": \"trial\",\n    \"created_at\": \"2016-01-24T01:43:41.693Z\",\n    \"updated_at\": \"2016-02-21T01:17:53.129Z\",\n  }\n}\n</code></pre>\n\n<p>My Website struct looks like this:</p>\n\n<pre><code>type Website struct {\n    Id                    int64     `json:\"id\"`\n    AccountId             int64     `json:\"account_id\"`\n    Name                  string    `json:\"name\"`\n    WebsiteUrl            string    `json:\"website_url\"`\n    SubscriptionStatus    string     `json:\"subscription_status\"`\n    CreatedAt             time.Time `json:\"created_at\"`\n    UpdatedAt             time.Time `json:\"updated_at\"`\n}\n</code></pre>\n\n<p>I then have a Company struct like:</p>\n\n<pre><code>type Company struct {\n  Website Website\n  api *API\n}\n</code></pre>\n\n<p>So in my API client code I have this:</p>\n\n<pre><code>res, status, err := api.request(endpoint, \"GET\", nil, nil)\n\nif err != nil {\n        return nil, err\n    }\nif status != 200 {\n    return nil, fmt.Errorf(\"Status returned: %d\", status)\n}\n\nr := map[string]Company{}\nerr = json.NewDecoder(res).Decode(&amp;r)\n\nfmt.Printf(\"things are: %v\\n\\n\", r)\n</code></pre>\n\n<p>The output I am getting is this:</p>\n\n<pre><code>things are: map[website:{{0 0          0001-01-01 00:00:00 +0000 UTC 0001-01-01 00:00:00 +0000 UTC} &lt;nil&gt;}]\n</code></pre>\n\n<p>How can I debug this, I am not sure why it is not setting the Website struct with correct values.</p>\n\n<p><strong>Update</strong></p>\n\n<p>I added this, I don't see any output:</p>\n\n<pre><code>if err != nil {\n        fmt.Printf(\"error is not nillllllll!!!:\")\n        fmt.Println(err)\n        return nil, err\n    }\n</code></pre>\n"}, {"tags": ["go", "oauth-2.0", "google-oauth", "oauth2"], "answers": [{"tags": [], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "is_accepted": true, "score": 0, "last_activity_date": 1482611197, "creation_date": 1482611197, "answer_id": 41316619, "question_id": 36671719, "link": "https://stackoverflow.com/questions/36671719/authenticating-with-oauth2-using-package-golang-org-x-oauth2/41316619#41316619", "title": "Authenticating with oauth2 using package &quot;golang.org/x/oauth2&quot;", "body": "<p>Follow up: I've used it and tweaked it several times and it does the job. </p>\n"}], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 437, "favorite_count": 1, "accepted_answer_id": 41316619, "answer_count": 1, "score": 3, "last_activity_date": 1482611197, "creation_date": 1460856450, "question_id": 36671719, "link": "https://stackoverflow.com/questions/36671719/authenticating-with-oauth2-using-package-golang-org-x-oauth2", "title": "Authenticating with oauth2 using package &quot;golang.org/x/oauth2&quot;", "body": "<p>I am trying to figure out how I can use the package <code>golang.org/x/oauth2</code> to authenticate on a site supporting oauth2. </p>\n\n<p>The code I wrote below works, I am just curious if this is the right approach, using this particular library, to obtain an *http.Client:</p>\n\n<pre><code>func handleCallback(w http.ResponseWriter, r *http.Request) {\n    state := r.FormValue(\"state\")\n    if state != oauthStateString {\n        fmt.Printf(\"invalid oauth state, expected '%s', got '%s'\\n\", oauthStateString, state)\n        http.Redirect(w, r, \"/\", http.StatusTemporaryRedirect)\n        return\n    }\n\n    code := r.FormValue(\"code\")\n    token, err := oauthConf.Exchange(oauth2.NoContext, code)\n    if err != nil {\n        fmt.Printf(\"oauthConf.Exchange() failed with '%s'\\n\", err)\n        http.Redirect(w, r, \"/\", http.StatusTemporaryRedirect)\n        return\n    }\n\n    ts := oauth2.StaticTokenSource(\n        &amp;oauth2.Token{AccessToken: token.AccessToken},\n    )\n\n    tc := oauth2.NewClient(oauth2.NoContext, ts) // got *http.Client\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 3, "creation_date": 1460854961, "post_id": 36671520, "comment_id": 60934313, "body": "go run main.go api.go"}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1460857443, "post_id": 36671520, "comment_id": 60934753, "body": "@Uvelichitel is there a better way?  If I keep adding files it will be a pain to keep typing all the filenames like that."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1460858683, "post_id": 36671520, "comment_id": 60934982, "body": "Yes, you should be using <code>go install</code> or <code>go build</code>"}], "answers": [{"tags": [], "owner": {"reputation": 37873, "user_id": 1202421, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f9ecf725ab72554a6fb27e979e3cd0a6?s=128&d=identicon&r=PG", "display_name": "Pedro Werneck", "link": "https://stackoverflow.com/users/1202421/pedro-werneck"}, "is_accepted": false, "score": 2, "last_activity_date": 1460858203, "creation_date": 1460858203, "answer_id": 36671881, "question_id": 36671520, "link": "https://stackoverflow.com/questions/36671520/my-main-go-file-cannot-see-other-files/36671881#36671881", "title": "My main.go file cannot see other files", "body": "<p>You're compiling only the main.go file. You should use:</p>\n\n<pre><code>go run main.go api.go\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>go run *.go\n</code></pre>\n\n<p>If you're writing a complex application, you might add everything to packages in subdirectories and have a single main.go file. For instance, <a href=\"https://github.com/coreos/etcd\" rel=\"nofollow\">etcd</a> has an <code>etcdmain</code> subdirectory/package along with other subdirectories/packages. Something like:</p>\n\n<pre><code>/alarm    \n/auth\n/cmd\n/etcdmain\n...\n</code></pre>\n\n<p>And the main.go file is simply:</p>\n\n<pre><code>package main\n\nimport \"github.com/coreos/etcd/etcdmain\"\n\nfunc main() {\n    etcdmain.Main()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "is_accepted": false, "score": 1, "last_activity_date": 1460884132, "creation_date": 1460884132, "answer_id": 36674631, "question_id": 36671520, "link": "https://stackoverflow.com/questions/36671520/my-main-go-file-cannot-see-other-files/36674631#36674631", "title": "My main.go file cannot see other files", "body": "<p>You are using golang workspace project, which is good for the structure for your application and it also standardize.</p>\n\n<p>When we use the golang workspace, you can not run single go file. You need to call go build / go install.</p>\n\n<p><strong>Install</strong></p>\n\n<pre><code>go install example.com/myweb\n</code></pre>\n\n<p>The command above will compile your main package on example.com/myweb. And the myweb executable binary will be placed on the GOPATH/bin. And you can run it manually.</p>\n\n<p><strong>Build</strong></p>\n\n<pre><code>go build example.com/myweb\n</code></pre>\n\n<p>The command is similar to go install but the binary executable file will be placed on the current directory when you call the command, instead of on GOPATH/bin (unless your current directory is GOPATH/bin).</p>\n\n<p>For more information please check <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow\">this link</a>.</p>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1499, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1460884132, "creation_date": 1460854656, "question_id": 36671520, "link": "https://stackoverflow.com/questions/36671520/my-main-go-file-cannot-see-other-files", "title": "My main.go file cannot see other files", "body": "<p>I need some help understanding what is wrong with my file layout in a simple web application.</p>\n\n<pre><code>$GOPATH/src/example.com/myweb\n</code></pre>\n\n<p>I then have 2 files:</p>\n\n<pre><code>$GOPATH/src/example.com/myweb/main.go\n$GOPATH/src/example.com/myweb/api.go\n</code></pre>\n\n<p>Both files have:</p>\n\n<p>package main</p>\n\n<p>The api.go file looks like:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"time\"\n)\n\ntype API struct {\n    URI   string\n    Token  string\n    Secret string\n    client *http.Client\n}\n\n...\n</code></pre>\n\n<p>My main.go file looks like:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gorilla/mux\"\n    \"html/template\"\n    \"net/http\"\n)\n\nvar (\n    templates = template.Must(template.ParseFiles(\"views/home.html\", \"views/history.html\", \"views/incident.html\"))\n    api = API{\n        URI: \"http://localhost:3000\",\n        Token: \"abc\",\n        Secret: \"123\",\n    }\n)\n\nfunc renderTemplate(w http.ResponseWriter, tmpl string, hp *HomePage) {\n..\n..\n}\n\nfunc WelcomeHandler(w http.ResponseWriter, r *http.Request) {\n..\n..\n}\n\nfunc main() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", WelcomeHandler)\n    r.PathPrefix(\"/assets/\").Handler(\n        http.StripPrefix(\"/assets/\", http.FileServer(http.Dir(\"assets/\"))))\n\n    http.ListenAndServe(\":9000\", r)\n}\n</code></pre>\n\n<p>In the code I excluded, I basically use structs that are defined in my api.go file, and I get this error when doing:</p>\n\n<pre><code>go run main.go\n# command-line-arguments\n./main.go:16: undefined: API\n./main.go:23: undefined: User\n</code></pre>\n\n<p>What exactly am I doing wrong here?</p>\n\n<p>I tried changing the package name in api.go to myweb but that didn't help.</p>\n\n<p><strong>Am I suppose to use the package name myweb?  Is just 1 file suppose to have main?</strong></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 411, "user_id": 6205397, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ff2a90faa5b27c204ced0d63900e8ece?s=128&d=identicon&r=PG&f=1", "display_name": "GoGo", "link": "https://stackoverflow.com/users/6205397/gogo"}, "edited": false, "score": 0, "creation_date": 1460853828, "post_id": 36671158, "comment_id": 60934101, "body": "thanks matt.s. However, why they are different and that sounds like <code>type mystringtype string</code> is different from string? interestingly, below code has no problem <code>type mystringtype string     type Friends struct { Name mystringtype}</code>"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 1, "creation_date": 1460854177, "post_id": 36671158, "comment_id": 60934159, "body": "That&#39;s because literals will match any compatible type.  time.Now() isn&#39;t a literal.  &quot;John&quot; is."}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1460850758, "creation_date": 1460850758, "answer_id": 36671158, "question_id": 36671075, "link": "https://stackoverflow.com/questions/36671075/regarding-cannot-use-time-now-type-time-time-as-type/36671158#36671158", "title": "Regarding &quot;cannot use time.Now() (type time.Time) as type &quot;", "body": "<p>time.Time and typetime are different types (though they have the same underlying representations) so you need to convert the type.</p>\n\n<pre><code>John := Friends{Name: \"John\", Birthday: typetime(time.Now())}\n</code></pre>\n"}], "owner": {"reputation": 411, "user_id": 6205397, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ff2a90faa5b27c204ced0d63900e8ece?s=128&d=identicon&r=PG&f=1", "display_name": "GoGo", "link": "https://stackoverflow.com/users/6205397/gogo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 5481, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1460850758, "creation_date": 1460850144, "question_id": 36671075, "link": "https://stackoverflow.com/questions/36671075/regarding-cannot-use-time-now-type-time-time-as-type", "title": "Regarding &quot;cannot use time.Now() (type time.Time) as type &quot;", "body": "<p>Get \"cannot use time.Now() (type time.Time) as type typetime in field value\" with below type definition</p>\n\n<pre><code>import (\"time\")\n\ntype typetime time.Time \ntype Friends struct {\n   Name string\n   Birthday typetime\n}\n\nJohn := Friends{Name:\"John\", Birthday:time.Now()}\n</code></pre>\n\n<p>If I replace typetime with direct type form (time.Time), there is no problem. what is GO's rule behind?? :></p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1460848978, "post_id": 36670906, "comment_id": 60933156, "body": "There&#39;s nothing innately wrong with doing that: you&#39;re going to re-use it across requests, you can extend it, the structure is clear, etc. If anything, you should make sure to handle the error from <code>Encode</code>."}, {"owner": {"reputation": 3983, "user_id": 3314701, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/3KCcC.jpg?s=128&g=1", "display_name": "markthethomas", "link": "https://stackoverflow.com/users/3314701/markthethomas"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1460849148, "post_id": 36670906, "comment_id": 60933187, "body": "Cool! Just felt weird, but it seems like being explicit like that is more characteristic of a strongly-typed language, so I&#39;m sure I&#39;ll get used to it. What would be the best way to handle the encode error? panic?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1460849952, "post_id": 36670906, "comment_id": 60933347, "body": "Only panic in exceptional cases. Just catch the error and log it (because it&#39;s too late to do anything once you&#39;ve started writing to the response), or write to a temporary buffer (<code>bytes.Buffer</code>) first, and if there are no errors, <code>io.Copy(buf, w)</code> to write it out. Probably overkill for a simple data structure like this, but useful when dealing with more complex data (e.g. large structures from a DB -&gt; JSON)."}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1460851190, "post_id": 36670906, "comment_id": 60933596, "body": "Technically, that version parameter in that json json will not parse to anything (not a double cause it&#39;s invalid, not a string because it isn&#39;t in quotes, etc).  you&#39;ll want to put it into quotes before send it across the wire.  there are custom marshallers you can implement, but easier just to put it in quotes for proper json."}, {"owner": {"reputation": 3983, "user_id": 3314701, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/3KCcC.jpg?s=128&g=1", "display_name": "markthethomas", "link": "https://stackoverflow.com/users/3314701/markthethomas"}, "reply_to_user": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1460851313, "post_id": 36670906, "comment_id": 60933616, "body": "@eduncan911 thanks for pointing that out, that was an oversight on my part :) updated question"}], "answers": [{"comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1599551056, "post_id": 36671073, "comment_id": 112800147, "body": "It hadn&#39;t occurred to me that <code>struct</code> could be lexically lexically scoped using blocks +1."}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": true, "score": 2, "last_activity_date": 1460850137, "creation_date": 1460850137, "answer_id": 36671073, "question_id": 36670906, "link": "https://stackoverflow.com/questions/36670906/data-structures-in-golang/36671073#36671073", "title": "Data Structures in Golang", "body": "<p>Looks pretty good. Don't be afraid to make types for that will add to the meaning.</p>\n\n<pre><code>type Version string  \n</code></pre>\n\n<p>You can then have logic for what a version looks like that will be tied to the type</p>\n\n<p>Or you might want to check out <a href=\"https://godoc.org/github.com/juju/version\" rel=\"nofollow\">juju's version package</a>. </p>\n\n<p>If you really have a struct that is a one off, you can do an anonymous struct with a literal.</p>\n\n<pre><code>health := struct{ \n    Health bool\n    Version string\n}{\n    true,\n    \"1.2.3\",\n}\n</code></pre>\n"}], "owner": {"reputation": 3983, "user_id": 3314701, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/3KCcC.jpg?s=128&g=1", "display_name": "markthethomas", "link": "https://stackoverflow.com/users/3314701/markthethomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "accepted_answer_id": 36671073, "answer_count": 1, "score": 0, "last_activity_date": 1589031374, "creation_date": 1460848682, "last_edit_date": 1460851263, "question_id": 36670906, "link": "https://stackoverflow.com/questions/36670906/data-structures-in-golang", "title": "Data Structures in Golang", "body": "<p>Asking a Golang question as someone coming from the Ruby &amp; JS worlds, so bear with me if this is a rather simple Go question :) </p>\n\n<p>Working with the <a href=\"https://github.com/gorilla\" rel=\"nofollow\">Gorilla toolkit</a> on an API, and I'm not sure if my thinking is totally correct on something. I've been reading through the thoroughly-excellent <a href=\"http://www.gopl.io/\" rel=\"nofollow\">The Go Programming Language</a>, but am decidedly not expert at Go yet. When sending back a JSON response, I've been doing something like the below to send back an object like this:</p>\n\n<pre><code>{ \"healthy\": true, \"version\": \"0.0.1\" }\n</code></pre>\n\n<p>But I'm not sure if it's a best practice or idiomatic to go to be creating one-off structures like <code>appHealth</code> or if I'm thinking too-much like I would in JS, where I'd just throw up an object literal and return the JSON-ified version of that to the client. Teach me, wise gophers.</p>\n\n<p>Thank you!</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n    \"github.com/gorilla/mux\"\n)\n\ntype appHealth struct {\n    Healthy bool\n    Version string\n}\n\nfunc health(w http.ResponseWriter, r *http.Request) {\n    health := appHealth{true, \"0.0.1\"}\n    json.NewEncoder(w).Encode(health)\n}\n\nfunc main() {\n    port := os.Getenv(\"PORT\")\n    router := mux.NewRouter().StrictSlash(false)\n    router.HandleFunc(\"/health\", health)\n    log.Fatal(http.ListenAndServe(\":\"+port, router))\n}\n</code></pre>\n"}, {"tags": ["c", "go", "libgit2"], "answers": [{"comments": [{"owner": {"reputation": 5437, "user_id": 1257094, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Ob6MH.jpg?s=128&g=1", "display_name": "milgner", "link": "https://stackoverflow.com/users/1257094/milgner"}, "edited": false, "score": 0, "creation_date": 1460986463, "post_id": 36691889, "comment_id": 60979116, "body": "Thanks a lot! I&#39;ll try to implement the first approach. It&#39;s primarily a learning project and I&#39;ll probably learn the most from that :) I wonder whether anyone uses the current ODB code at all? I tried a couple of things and could not get it to compile."}, {"owner": {"reputation": 5037, "user_id": 1370215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e1295851b018af03706f391b76931?s=128&d=identicon&r=PG", "display_name": "Carlos Mart&#237;n Nieto", "link": "https://stackoverflow.com/users/1370215/carlos-mart%c3%adn-nieto"}, "reply_to_user": {"reputation": 5437, "user_id": 1257094, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Ob6MH.jpg?s=128&g=1", "display_name": "milgner", "link": "https://stackoverflow.com/users/1257094/milgner"}, "edited": false, "score": 0, "creation_date": 1461014759, "post_id": 36691889, "comment_id": 60997108, "body": "libgit2 uses <code>git_odb</code> itself, it&#39;s all the same interface. You might have to write a bunch of this in C since Go itself will not do some of the things which are useful in C."}], "tags": [], "owner": {"reputation": 5037, "user_id": 1370215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e1295851b018af03706f391b76931?s=128&d=identicon&r=PG", "display_name": "Carlos Mart&#237;n Nieto", "link": "https://stackoverflow.com/users/1370215/carlos-mart%c3%adn-nieto"}, "is_accepted": true, "score": 2, "last_activity_date": 1460976698, "creation_date": 1460976698, "answer_id": 36691889, "question_id": 36670761, "link": "https://stackoverflow.com/questions/36670761/go-conflicting-types-between-import-and-c-library/36691889#36691889", "title": "Go: conflicting types between import and C library", "body": "<p>I had the same issue when trying to split git2go into sub-packages. As far as I can tell, this is the Go compiler trying to use Go scoping rules to C code. I see two ways to work around this:</p>\n\n<ol>\n<li>Implement the <code>git_odb</code> interface in git2go so you can run arbitrary Go code; or</li>\n<li>Write the code that adds the backend in C and call that from your Go code</li>\n</ol>\n"}], "owner": {"reputation": 5437, "user_id": 1257094, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Ob6MH.jpg?s=128&g=1", "display_name": "milgner", "link": "https://stackoverflow.com/users/1257094/milgner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 36691889, "answer_count": 1, "score": 1, "last_activity_date": 1460976698, "creation_date": 1460847559, "last_edit_date": 1460882129, "question_id": 36670761, "link": "https://stackoverflow.com/questions/36670761/go-conflicting-types-between-import-and-c-library", "title": "Go: conflicting types between import and C library", "body": "<p>Trying to get acquainted with Go/C interop, I want to use git2go/libgit2 to read data of a git repository using a <a href=\"https://github.com/libgit2/libgit2-backends/blob/master/redis/hiredis.c\" rel=\"nofollow\">Redis backend</a>.</p>\n\n<p>So I came up with this code (stripped of error handling etc), which outputs a compile error that I cannot place:</p>\n\n<p><code>./git.go:30: cannot use odbBackendC (type *C.struct_git_odb_backend) as type *git.C.struct_git_odb_backend in argument to git.NewOdbBackendFromC\n</code></p>\n\n<p>Apparently the compiler thinks that <code>git.C.struct_git_odb_backend</code> and <code>C.struct_git_odb_backend</code> are different types although they're the same - only one libgit2 on the system after all. What can I do to resolve this?</p>\n\n<p>Here's the full listing:</p>\n\n<pre><code>package main\n\n/*\n#cgo LDFLAGS: -L ./libgit2-backends/redis -lgit2 -lhiredis -lgit2-redis\n\n#include &lt;git2.h&gt;\n\nextern int git_odb_backend_hiredis(git_odb_backend **backend_out, const char* prefix, const char* path, const char *host, int port, char* password);\nextern int git_refdb_backend_hiredis(git_refdb_backend **backend_out, const char* prefix, const char* path, const char *host, int port, char* password);\n\n*/\nimport \"C\"\n\nimport (\n  git \"gopkg.in/libgit2/git2go.v23\"\n)\n\nfunc ImportRepo(url string) {\n  odb, err := git.NewOdb();\n\n  var odbBackendC *C.git_odb_backend = nil\n  C.git_odb_backend_hiredis(&amp;odbBackendC, C.CString(\"prefix_\"), C.CString(\"path\"), C.CString(\"localhost\"), 6379, C.CString(\"\"))\n  backend := git.NewOdbBackendFromC(odbBackendC)\n  odb.AddBackend(backend)\n}\n</code></pre>\n"}, {"tags": ["go", "youtube-api", "youtube-data-api"], "answers": [{"tags": [], "owner": {"reputation": 4382, "user_id": 5632969, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D0Ioa.jpg?s=128&g=1", "display_name": "Android Enthusiast", "link": "https://stackoverflow.com/users/5632969/android-enthusiast"}, "is_accepted": false, "score": 0, "last_activity_date": 1460971884, "creation_date": 1460971884, "answer_id": 36690172, "question_id": 36668829, "link": "https://stackoverflow.com/questions/36668829/youtube-api-go-client-cant-change-playlist-item-position/36690172#36690172", "title": "Youtube API: Go client: can&#39;t change playlist item position", "body": "<p>Based on the  <a href=\"https://developers.google.com/youtube/v3/docs/errors#youtube.api.RequestContextError\" rel=\"nofollow\">Official Google Docs</a>, <code>400 unexpectedPart</code> the request could not be understood by the server due to request's part parameter specifies an unexpected value or due to invalid value. Do check your value parameter being request to the server.</p>\n"}], "owner": {"reputation": 1107, "user_id": 2579309, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/37f47fd5ebdaa3c4b2eb0b90522e6d1a?s=128&d=identicon&r=PG", "display_name": "Mullefa", "link": "https://stackoverflow.com/users/2579309/mullefa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1460971884, "creation_date": 1460835603, "question_id": 36668829, "link": "https://stackoverflow.com/questions/36668829/youtube-api-go-client-cant-change-playlist-item-position", "title": "Youtube API: Go client: can&#39;t change playlist item position", "body": "<p>Here is a function I have written to change the position of a playlist item:</p>\n\n<pre><code>var service *youtube.Service\n\nfunc setPlaylistItemPosition(item *youtube.PlaylistItem, i int64) error {\n    if item.Snippet == nil {\n        return errors.New(\"playlist item snippet is null\")\n    }\n\n    item.Snippet.Position = i\n    response, err := service.PlaylistItems.Update(\"snippet\", item).Do()\n    if err != nil {\n        return err\n    }\n\n    if response.Snippet.Position != i {\n        return errors.New(\"failed to set playlist items position\")\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>However, when I call this function, I get the following error: </p>\n\n<pre><code>googleapi: Error 400: {0}, unexpectedPart\n</code></pre>\n\n<p>Even though the <a href=\"https://developers.google.com/youtube/v3/docs/playlistItems/insert#parameters\" rel=\"nofollow\">documentation</a> says <code>\"snippet\"</code> is a valid part.</p>\n\n<p>Any help appreciated. Cheers.</p>\n"}, {"tags": ["go", "typescript", "angular", "jwt"], "comments": [{"owner": {"reputation": 25995, "user_id": 5152732, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eL0xfQom3xQ/AAAAAAAAAAI/AAAAAAAAB1E/j1B2Mcgvt6M/photo.jpg?sz=128", "display_name": "toskv", "link": "https://stackoverflow.com/users/5152732/toskv"}, "edited": false, "score": 0, "creation_date": 1460828522, "post_id": 36667233, "comment_id": 60926915, "body": "if it&#39;s the headers of the first request (the one that opens your page) you are looking for you won&#39;t be able to find them. See this issue here for more info. <a href=\"http://stackoverflow.com/questions/220231/accessing-the-web-pages-http-headers-in-javascript\" title=\"accessing the web pages http headers in javascript\">stackoverflow.com/questions/220231/&hellip;</a>"}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 25995, "user_id": 5152732, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eL0xfQom3xQ/AAAAAAAAAAI/AAAAAAAAB1E/j1B2Mcgvt6M/photo.jpg?sz=128", "display_name": "toskv", "link": "https://stackoverflow.com/users/5152732/toskv"}, "edited": false, "score": 0, "creation_date": 1460828694, "post_id": 36667233, "comment_id": 60926988, "body": "i want the header from the redirect I have just issued. Is this the same? @toskv"}, {"owner": {"reputation": 25995, "user_id": 5152732, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eL0xfQom3xQ/AAAAAAAAAAI/AAAAAAAAB1E/j1B2Mcgvt6M/photo.jpg?sz=128", "display_name": "toskv", "link": "https://stackoverflow.com/users/5152732/toskv"}, "edited": false, "score": 0, "creation_date": 1460828822, "post_id": 36667233, "comment_id": 60927048, "body": "is the request being redirected done via javascript or the browser?"}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 25995, "user_id": 5152732, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eL0xfQom3xQ/AAAAAAAAAAI/AAAAAAAAB1E/j1B2Mcgvt6M/photo.jpg?sz=128", "display_name": "toskv", "link": "https://stackoverflow.com/users/5152732/toskv"}, "edited": false, "score": 0, "creation_date": 1460828901, "post_id": 36667233, "comment_id": 60927074, "body": "via my golang backend. the lines are at the top"}, {"owner": {"reputation": 25995, "user_id": 5152732, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eL0xfQom3xQ/AAAAAAAAAAI/AAAAAAAAB1E/j1B2Mcgvt6M/photo.jpg?sz=128", "display_name": "toskv", "link": "https://stackoverflow.com/users/5152732/toskv"}, "edited": false, "score": 0, "creation_date": 1460829109, "post_id": 36667233, "comment_id": 60927145, "body": "The backend redirects a request, where that request comes from matters. If the request is from the browser (navigation by user for example) then you can&#39;t access it. If it&#39;s from js you might be able to. Looking at the TypeScript code though it looks it&#39;s the request that starts up your application, thus it is not possible to access it&#39;s headers."}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 25995, "user_id": 5152732, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eL0xfQom3xQ/AAAAAAAAAAI/AAAAAAAAB1E/j1B2Mcgvt6M/photo.jpg?sz=128", "display_name": "toskv", "link": "https://stackoverflow.com/users/5152732/toskv"}, "edited": false, "score": 0, "creation_date": 1460829214, "post_id": 36667233, "comment_id": 60927178, "body": "got you. will update my question. but I do it with angular2 too."}, {"owner": {"reputation": 25995, "user_id": 5152732, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eL0xfQom3xQ/AAAAAAAAAAI/AAAAAAAAB1E/j1B2Mcgvt6M/photo.jpg?sz=128", "display_name": "toskv", "link": "https://stackoverflow.com/users/5152732/toskv"}, "edited": false, "score": 0, "creation_date": 1460829264, "post_id": 36667233, "comment_id": 60927191, "body": "the thing is, you need to have an ajax request to be able to access the response headers, if it&#39;s done by the browser it&#39;s just not possible."}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 25995, "user_id": 5152732, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eL0xfQom3xQ/AAAAAAAAAAI/AAAAAAAAB1E/j1B2Mcgvt6M/photo.jpg?sz=128", "display_name": "toskv", "link": "https://stackoverflow.com/users/5152732/toskv"}, "edited": false, "score": 0, "creation_date": 1460829393, "post_id": 36667233, "comment_id": 60927241, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/109335/discussion-between-cesco-and-toskv\">continue this discussion in chat</a>."}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 25995, "user_id": 5152732, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eL0xfQom3xQ/AAAAAAAAAAI/AAAAAAAAB1E/j1B2Mcgvt6M/photo.jpg?sz=128", "display_name": "toskv", "link": "https://stackoverflow.com/users/5152732/toskv"}, "edited": false, "score": 0, "creation_date": 1460877452, "post_id": 36667233, "comment_id": 60938021, "body": "@toskv See my answer. Think I got it now"}], "answers": [{"tags": [], "owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "is_accepted": false, "score": 1, "last_activity_date": 1460901730, "last_edit_date": 1495535453, "creation_date": 1460877410, "answer_id": 36673730, "question_id": 36667233, "link": "https://stackoverflow.com/questions/36667233/how-to-access-request-header-with-angular2/36673730#36673730", "title": "How to access request header with Angular2?", "body": "<p>First I create a pop up window/tab.</p>\n\n<pre><code>    var url = \"https://accounts.google.com/o/oauth2/auth?client_id=\"\n                    + clientid + \"&amp;redirect_uri=\"\n                    + redirect_url + \"&amp;response_type=code&amp;scope=\"\n                    + scope;\n    window.open(url);\n</code></pre>\n\n<p>This goes to google and hit my server on the way back,at the redirect url. \nWhich serves the script tag below inside this popup. It actually just run a command on the windows that created this popup , in this case my SPA, with my application token as a parameter and then closes it.</p>\n\n<pre><code>w.Write([]byte(`\n                    &lt;script&gt;\n                        var token=\"` + token + `\";\n                        function CloseMySelf() {\n                            try {\n                                window.opener.angularComponentRef.runThisFunctionFromOutside(token);\n                            }\n                            catch (err) {}\n                            window.close();\n                            return false;\n                        }\n                        CloseMySelf();\n                    &lt;/script&gt;\n\n    `))\n</code></pre>\n\n<p>This is the function that it call. This method needs to be made public like this <a href=\"https://stackoverflow.com/questions/35296704/angular2-how-to-call-component-function-from-outside-the-app\">question</a> shows.</p>\n\n<pre><code>runThisFunctionFromOutside(token) {\n    localStorage.setItem('jwt', token);\n    location.href = \"../dashboard\";\n}\n</code></pre>\n"}], "owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 753, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1460901730, "creation_date": 1460827025, "last_edit_date": 1460829344, "question_id": 36667233, "link": "https://stackoverflow.com/questions/36667233/how-to-access-request-header-with-angular2", "title": "How to access request header with Angular2?", "body": "<p>ON my golang backend after a success oauth2 request for facebook I redirect whe user to my app's dashboard like so:</p>\n\n<pre><code>w.Header().Set(\"Authorization\", fmt.Sprintf(\"Bearer %s\", tokenString))\nhttp.Redirect(w, r, \"http://\" + r.Host + \"/dashboard?jwt=\" + tokenString, http.StatusFound)\n</code></pre>\n\n<p>Then on the dashboard initialization I do somenthing like:</p>\n\n<pre><code>params:RouteParams;\n\n\nconstructor(private _router:Router, private _jwt:JWTService, private _params:RouteParams, private location:Location) {\n    this.params = _params;\n\n\n}\n\n\nconsol() {\n    var redirect_url = encodeURIComponent(\"http://localhost:9000/api/facebook/\");\n    var url = \"https://www.facebook.com/dialog/oauth?client_id=xxxx&amp;redirect_uri=\"+ redirect_url + \"&amp;response_type=code&amp;scope=email+user_location+user_about_me\"\n    window.location.href=url;\n}\n\nngOnInit() {\n    this.token = '';\n    console.log(this.params);\n    if (this.params.params['jwt'] != null) {\n        console.log(this.params);\n        localStorage.setItem('jwt', this.params.params['jwt']);\n        this.location.replaceState('/dashboard')\n    }\n    this.Bouncer();\n}\n</code></pre>\n\n<p>I want to avoid making my url dirty, not even for a few seconds. I wish I could inspect the request headers, because I am sending the jwt through that as well.</p>\n\n<h3>Updated</h3>\n\n<p>The original request is done through a angular2-material button</p>\n\n<pre><code> &lt;div md-raised-button color=\"warn\" (click)=\"consol()\"&gt;Login to FACEBOOK&lt;/div&gt;\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 158803, "user_id": 246342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8ba0aea3f521082f18dd7c186e7d4c3?s=128&d=identicon&r=PG", "display_name": "Alex K.", "link": "https://stackoverflow.com/users/246342/alex-k"}, "edited": false, "score": 5, "creation_date": 1460820917, "post_id": 36666112, "comment_id": 60923996, "body": "<a href=\"http://programmers.stackexchange.com/questions/307417/what-was-the-reason-behind-using-quotes-in-gos-import-statements\">What was the reason behind using quotes in Go&#39;s import statements?</a>"}, {"owner": {"reputation": 11221, "user_id": 436559, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8d6b535e4fadefca3e9cab9b6b1ee49b?s=128&d=identicon&r=PG", "display_name": "fluter", "link": "https://stackoverflow.com/users/436559/fluter"}, "reply_to_user": {"reputation": 158803, "user_id": 246342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8ba0aea3f521082f18dd7c186e7d4c3?s=128&d=identicon&r=PG", "display_name": "Alex K.", "link": "https://stackoverflow.com/users/246342/alex-k"}, "edited": false, "score": 0, "creation_date": 1460821974, "post_id": 36666112, "comment_id": 60924397, "body": "Oh, so it was reserved for the potential of other implementations of the language?"}, {"owner": {"reputation": 158803, "user_id": 246342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8ba0aea3f521082f18dd7c186e7d4c3?s=128&d=identicon&r=PG", "display_name": "Alex K.", "link": "https://stackoverflow.com/users/246342/alex-k"}, "edited": false, "score": 0, "creation_date": 1460822110, "post_id": 36666112, "comment_id": 60924449, "body": "That appears to be the consensus in that thread."}], "answers": [{"comments": [{"owner": {"reputation": 11221, "user_id": 436559, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8d6b535e4fadefca3e9cab9b6b1ee49b?s=128&d=identicon&r=PG", "display_name": "fluter", "link": "https://stackoverflow.com/users/436559/fluter"}, "edited": false, "score": 0, "creation_date": 1460874322, "post_id": 36671419, "comment_id": 60937343, "body": "The import path cannot be just arbitrary file system path, because the parts in the path is exactly the identifier defined in package clause. The only char that is not allowed in identifier in the path would be the separator &#39;/&#39;."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "reply_to_user": {"reputation": 11221, "user_id": 436559, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8d6b535e4fadefca3e9cab9b6b1ee49b?s=128&d=identicon&r=PG", "display_name": "fluter", "link": "https://stackoverflow.com/users/436559/fluter"}, "edited": false, "score": 0, "creation_date": 1460875043, "post_id": 36671419, "comment_id": 60937496, "body": "@fluter I&#39;m not sure what you&#39;re saying. What do you mean by &quot;the parts in the path is exactly the identifier defined in package clause&quot;? The parts in <code>golang.org&#47;x&#47;exp&#47;shiny&#47;vendor&#47;github.com&#47;BurntSushi&#47;xgb&#47;rend&zwnj;&#8203;er</code> are <code>golang.org</code>, <code>x</code>, <code>exp</code>, ... <code>render</code> and only the latter part (<code>render</code>) is the package name, and for example <code>golang.org</code> and <code>github.com</code> are parts of path but valid identifiers in go."}, {"owner": {"reputation": 11221, "user_id": 436559, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8d6b535e4fadefca3e9cab9b6b1ee49b?s=128&d=identicon&r=PG", "display_name": "fluter", "link": "https://stackoverflow.com/users/436559/fluter"}, "edited": false, "score": 0, "creation_date": 1460875448, "post_id": 36671419, "comment_id": 60937567, "body": "You are right, import path is defined as <code>ImportPath       = string_lit .</code> in the language spec. Thanks."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 6, "last_activity_date": 1460854007, "last_edit_date": 1460854007, "creation_date": 1460853622, "answer_id": 36671419, "question_id": 36666112, "link": "https://stackoverflow.com/questions/36666112/why-go-requires-double-quoted-import-declaration/36671419#36671419", "title": "Why go requires double quoted import declaration", "body": "<p>A path <code>a/b/foo</code> is more like a string than an identifier: identifiers don't have separators, and paths may contain characters that aren't allowed in identifiers. You say package names can't contain spaces, which is true, but paths can, just as package names can't contain periods (<code>.</code>), but paths can. For example:</p>\n\n<pre><code>import \"golang.org/x/exp/shiny/vendor/github.com/BurntSushi/xgb/render\"`\n</code></pre>\n\n<p>This is mostly the same as C, which is listed in the question as not using strings to specify <code>#include</code> paths, but shares similarities with the go import statement. The two forms are both string-like: <code>#include &lt;a/b/foo.h&gt;</code> and <code>#include \"a/b/foo.h\"</code> although one uses <code>&lt;&gt;</code> rather than quotes to delimit the string.</p>\n"}], "owner": {"reputation": 11221, "user_id": 436559, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/8d6b535e4fadefca3e9cab9b6b1ee49b?s=128&d=identicon&r=PG", "display_name": "fluter", "link": "https://stackoverflow.com/users/436559/fluter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 427, "favorite_count": 1, "accepted_answer_id": 36671419, "answer_count": 1, "score": 6, "last_activity_date": 1460854007, "creation_date": 1460820776, "question_id": 36666112, "link": "https://stackoverflow.com/questions/36666112/why-go-requires-double-quoted-import-declaration", "title": "Why go requires double quoted import declaration", "body": "<p>As a go beginner this always gets me whenever I start a new source file. So go's package clause defines the package name, <strong>without</strong> double quotes, since the package name must be an identifier, it cannot contains invalid chars like space or something. However, when it comes to import declarations, the package name must be double quoted, as the package name is exactly the one used in package clause, it must be identifier too(of course / is allowed as separator). It looks to me that would only add more key strokes without other benefits. I wonder why it is designed this way that imports must be double quoted strings.</p>\n\n<p>Also, if we look at other languages, <code>#include &lt;foo.h&gt;</code>, <code>using System.Bar</code>, <code>import java.lang.moo</code> none of them requires imports to be strings.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1635, "user_id": 1381241, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6464fd26eb57b7c8cd28694a30a19adb?s=128&d=identicon&r=PG", "display_name": "Sumit", "link": "https://stackoverflow.com/users/1381241/sumit"}, "edited": false, "score": 3, "creation_date": 1532687695, "post_id": 36666017, "comment_id": 90078885, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/9952061/git-ignore-compiled-google-go\">Git: Ignore compiled Google Go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 6057672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08987bd7137e79161e0db880d230b336?s=128&d=identicon&r=PG&f=1", "display_name": "jagadeesh m", "link": "https://stackoverflow.com/users/6057672/jagadeesh-m"}, "edited": false, "score": 0, "creation_date": 1460830105, "post_id": 36666150, "comment_id": 83078756, "body": "Add to above answer, use &#39;go run _.go&#39; during development to avoid generating executable binary in your source code path."}], "tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": false, "score": 1, "last_activity_date": 1460820994, "creation_date": 1460820994, "answer_id": 36666150, "question_id": 36666017, "link": "https://stackoverflow.com/questions/36666017/how-to-compile-go-file-to-specific-directory-or-to-gitignore-the-binaries/36666150#36666150", "title": "How to compile .go file to specific directory, or to gitignore the binaries?", "body": "<p>Instead of using <code>go build *.go</code>, you can do following:</p>\n\n<ol>\n<li>Setup <code>Go workspace</code>, using this official go resource: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow\">How to write go code</a></li>\n<li>Define <code>GOBIN</code> and <code>GOPATH</code> environment variable.<code>GOBIN</code> environment variable will point to the directory where you want to store your executables.<code>GOPATH</code> environment variable will point to the directory, where you've setup <code>go workspace</code>.</li>\n</ol>\n\n<p>Now, instead of doing <code>go build *.go</code>, you can use <code>go install {YourCodePath}</code>, where <code>{YourCodePath}</code>, is relative path of your code in go workspace. And if the build is successful, you can find your executable in directory, pointed by <code>GOBIN</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 2186, "user_id": 6515647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2cec9665b47aae5620d387bf95d2f15?s=128&d=identicon&r=PG&f=1", "display_name": "Dave Fort", "link": "https://stackoverflow.com/users/6515647/dave-fort"}, "edited": false, "score": 1, "creation_date": 1575573474, "post_id": 52717859, "comment_id": 104621593, "body": "It&#39;s also possible to do this the other way (which does not require the -o flag):  1. cd to the directory where you want to store the binary  2. <code>$go build &#47;path&#47;to&#47;source&#47;file.go</code>"}], "tags": [], "owner": {"reputation": 6113, "user_id": 4418897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23fff1ff90d8926cf3a82823f66943c5?s=128&d=identicon&r=PG&f=1", "display_name": "Santosh Pillai", "link": "https://stackoverflow.com/users/4418897/santosh-pillai"}, "is_accepted": false, "score": 14, "last_activity_date": 1593793961, "last_edit_date": 1593793961, "creation_date": 1539077997, "answer_id": 52717859, "question_id": 36666017, "link": "https://stackoverflow.com/questions/36666017/how-to-compile-go-file-to-specific-directory-or-to-gitignore-the-binaries/52717859#52717859", "title": "How to compile .go file to specific directory, or to gitignore the binaries?", "body": "<p>you can use the <code>-o</code> flag.</p>\n<ol>\n<li><p><code>cd</code> to the directory where you have the <code>main.go</code> file.</p>\n</li>\n<li><p>use this command - <code>go build -o DirectoryPath</code></p>\n</li>\n</ol>\n<p>Where <code>DirectoryPath</code> is the location where you want to create the binary file to.</p>\n"}], "owner": {"reputation": 1465, "user_id": 4403257, "user_type": "registered", "accept_rate": 26, "profile_image": "https://lh4.googleusercontent.com/-XSHOss9luI4/AAAAAAAAAAI/AAAAAAAAADY/iPL641wt7TQ/photo.jpg?sz=128", "display_name": "Jimmy Gong", "link": "https://stackoverflow.com/users/4403257/jimmy-gong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13020, "favorite_count": 1, "answer_count": 2, "score": 10, "last_activity_date": 1593793961, "creation_date": 1460820336, "question_id": 36666017, "link": "https://stackoverflow.com/questions/36666017/how-to-compile-go-file-to-specific-directory-or-to-gitignore-the-binaries", "title": "How to compile .go file to specific directory, or to gitignore the binaries?", "body": "<p>Right now I'll just run <code>go build __.go</code>, but I'm wondering if it's possible to have that file built in a subdirectory (e.g. a <code>/bin</code> folder). It would just make gitignoring the binary files a lot cleaner, and right now I'm not really sure what else is a good approach as I'm also struggling to create a working gitignore exception rule that isn't just \"Ignore all files, except .go files\".</p>\n\n<p>My current solution is naming the binary files every time I build them (e.g. <code>go build -o hello.bin hello.go</code>), but this seems laborious.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 3938717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26b9640bc26a8a7106d9d8f83734b7d7?s=128&d=identicon&r=PG&f=1", "display_name": "Bill Hathaway", "link": "https://stackoverflow.com/users/3938717/bill-hathaway"}, "is_accepted": false, "score": 2, "last_activity_date": 1460823339, "creation_date": 1460823339, "answer_id": 36666573, "question_id": 36665634, "link": "https://stackoverflow.com/questions/36665634/how-to-get-rid-of-spaces-between-logs-when-using-logrus-package/36666573#36666573", "title": "How to get rid of Spaces between logs when using &#39;logrus&#39; package", "body": "<p>Are you sure you aren't accidentally including new lines in some of the messages you are sending to your logger package?</p>\n"}, {"comments": [{"owner": {"reputation": 1700, "user_id": 5674583, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/8WOaR.png?s=128&g=1", "display_name": "Blue Bot", "link": "https://stackoverflow.com/users/5674583/blue-bot"}, "edited": false, "score": 0, "creation_date": 1460877765, "post_id": 36666922, "comment_id": 60938099, "body": "I do @Stantonnet. as I used original go &quot;log&quot; package and all of my logs ended with <code>\\n</code> for example: <code>log.Printf(&quot;Failed do somthing with error: %s\\n&quot;, err)</code> did not realized logrus is taking care of new lines by it self. Thank you"}], "tags": [], "owner": {"reputation": 56, "user_id": 2697560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b2ab3032acd1ba9f280fe9d087abfc?s=128&d=identicon&r=PG&f=1", "display_name": "Stantonnet", "link": "https://stackoverflow.com/users/2697560/stantonnet"}, "is_accepted": true, "score": 3, "last_activity_date": 1460825258, "creation_date": 1460825258, "answer_id": 36666922, "question_id": 36665634, "link": "https://stackoverflow.com/questions/36665634/how-to-get-rid-of-spaces-between-logs-when-using-logrus-package/36666922#36666922", "title": "How to get rid of Spaces between logs when using &#39;logrus&#39; package", "body": "<p>Seems like you are passing newlines when you pass your string formatting. </p>\n\n<pre><code>func main() {\n\n  x := 0\n  logger.InitLogger()\n\n  logger.Printf(\"%s\", \"TEST1\")\n  logger.Printf(\"%s\", \"TEST2\")\n\n  if x == 0 {\n      logger.Printf(\"%s\", \"TEST3\")\n      logger.Printf(\"%s\", \"TEST4\")\n      logger.Printf(\"%s\", \"TEST5\")\n  }\n}\n</code></pre>\n\n<p>Returns:</p>\n\n<pre><code>go run main.go\nINFO[2016-04-16 12:40:30] TEST1\nINFO[2016-04-16 12:40:30] TEST2\nINFO[2016-04-16 12:40:30] TEST3\nINFO[2016-04-16 12:40:30] TEST4\nINFO[2016-04-16 12:40:30] TEST5\n</code></pre>\n"}], "owner": {"reputation": 1700, "user_id": 5674583, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/8WOaR.png?s=128&g=1", "display_name": "Blue Bot", "link": "https://stackoverflow.com/users/5674583/blue-bot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 829, "favorite_count": 0, "accepted_answer_id": 36666922, "answer_count": 2, "score": 0, "last_activity_date": 1460825258, "creation_date": 1460818197, "question_id": 36665634, "link": "https://stackoverflow.com/questions/36665634/how-to-get-rid-of-spaces-between-logs-when-using-logrus-package", "title": "How to get rid of Spaces between logs when using &#39;logrus&#39; package", "body": "<p>So I started using 'logrus'.\nI set it in my own logger package which looks like this:</p>\n\n<pre><code>    package logger\n\nimport(\n     log \"github.com/Sirupsen/logrus\"\n\n)\n\n\nfunc InitLogger() {\n    var textFormatter = new(log.TextFormatter)\n    textFormatter.TimestampFormat = \"2006-01-02 15:04:05\"\n    textFormatter.ForceColors = true\n    textFormatter.FullTimestamp = true\n\n    log.SetFormatter(textFormatter)\n}\n\n\nfunc Printf(format string, v ...interface{}) {\n    log.Printf(format, v...)\n}\n\nfunc Fatalf(format string, v ...interface{}) {\n    log.Fatalf(format, v...)\n}\n\nfunc Panicf(format string, v ...interface{}) {\n    log.Panicf(format, v...)\n}\n\nfunc Debugf(format string, v ...interface{}) {\n    log.Debugf(format, v...)\n</code></pre>\n\n<p>(it goes like this for all logrus log functions, dont see the \n   point of pasting all of them here, but you get the idea...)</p>\n\n<p>Use it across my project as:</p>\n\n<pre><code>import(\n    log \"logger\"\n)\n</code></pre>\n\n<p>And everything is peachy except logs being printed with line spaces between them:</p>\n\n<pre><code>INFO[2016-04-16 17:32:51] pathPrefix: /app/\npathValue: {js ./app/}\n\nINFO[2016-04-16 17:32:51] pathPrefix: /node_modules/\npathValue: {js ./node_modules/}\n\nINFO[2016-04-16 17:32:51] Listening for HTTP on tcp (0.0.0.0:8080)     \nINFO[2016-04-16 17:38:02] Starting HomeHandler                         \nINFO[2016-04-16 17:38:02] GET / Index 4.769735ms\n\nINFO[2016-04-16 17:38:02] Starting AuthCheckHandler                    \nERRO[2016-04-16 17:38:02] Failed getting cookie from user: http: named cookie not present\n\nINFO[2016-04-16 17:38:02] GET /auth AuthCheckHandler 67.79\u00b5s\n\nINFO[2016-04-16 17:38:02] Starting AuthCheckHandler                    \nERRO[2016-04-16 17:38:02] Failed getting cookie from user: http: named cookie not present\n\nINFO[2016-04-16 17:38:02] GET /auth AuthCheckHandler 82.195\u00b5s\n</code></pre>\n\n<p>How can I get rid of those spaces? \nCouldn't find any solution in documentation/google nor here\nso I assume its something very silly that I am missing...</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 543, "user_id": 4684773, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/00de4428845a1e47d74fea26169a19cd?s=128&d=identicon&r=PG", "display_name": "Tom Hanson", "link": "https://stackoverflow.com/users/4684773/tom-hanson"}, "edited": false, "score": 0, "creation_date": 1461316216, "post_id": 36665707, "comment_id": 61154018, "body": "Thanks, that worked brilliantly. If I wanted to print out how many pixels could be processed in 60 seconds, how would I go about doing that?"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 0, "last_activity_date": 1460818652, "creation_date": 1460818652, "answer_id": 36665707, "question_id": 36665591, "link": "https://stackoverflow.com/questions/36665591/golang-duration-for-individual-operation/36665707#36665707", "title": "Golang - Duration for individual operation", "body": "<p>Try convert type</p>\n\n<pre><code>elapsed/time.Duration(totalPixels)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>int(elapsed)/totalPixels\n</code></pre>\n"}], "owner": {"reputation": 543, "user_id": 4684773, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/00de4428845a1e47d74fea26169a19cd?s=128&d=identicon&r=PG", "display_name": "Tom Hanson", "link": "https://stackoverflow.com/users/4684773/tom-hanson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 36665707, "answer_count": 1, "score": 0, "last_activity_date": 1460818652, "creation_date": 1460817923, "question_id": 36665591, "link": "https://stackoverflow.com/questions/36665591/golang-duration-for-individual-operation", "title": "Golang - Duration for individual operation", "body": "<p>I have an algorithm that performs a mathematical operation on a pixel within a PNG image, it then draws a new image from the result. I'm wanting to show the duration time for the entire process and then be more specific and show the time time taken for each individual pixel.</p>\n\n<p>The result of the algorithm is shown in the terminal:</p>\n\n<pre><code>&gt;&gt; image pixels:  921600  -- width x height: 960 - 960\n&gt;&gt; time elapsed (m-seconds) :  165.913052ms\n</code></pre>\n\n<p>My initial thinking was to output the result of <code>elapsed / totalPixels</code> however this results in an error due to incorrect types. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "edited": false, "score": 0, "creation_date": 1460863255, "post_id": 36665520, "comment_id": 60935622, "body": "I&#39;ve updated my answer, in response to your edit. Please check."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1460864725, "post_id": 36665520, "comment_id": 60935870, "body": "&quot;Why can&#39;t I call oSelector.printTest()?&quot; Because there isn&#39;t a <code>printTest</code> function for <code>obj1Selector</code> values."}], "answers": [{"tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": true, "score": 2, "last_activity_date": 1460863613, "last_edit_date": 1460863613, "creation_date": 1460817885, "answer_id": 36665579, "question_id": 36665520, "link": "https://stackoverflow.com/questions/36665520/why-isnt-this-method-promoted-in-go/36665579#36665579", "title": "Why isn&#39;t this method promoted in Go?", "body": "<p>It's called <code>embedding</code>.</p>\n\n<p>From Golang specification:</p>\n\n<blockquote>\n  <p>Go does not provide the typical, type-driven notion of subclassing, but it does have the ability to \u201cborrow\u201d pieces of an implementation by embedding types within a struct or interface.</p>\n</blockquote>\n\n<p>In case of <code>obj1</code>, it is <code>embedding</code> type <code>obj2</code>, which means, what <code>obj2</code> can do, <code>obj1</code> can do. So you can invoke <code>printTest</code> directly on <code>obj1</code>.</p>\n\n<p>While in case of <code>obj1Selector</code>, it defines a <strong>new field</strong> called <code>selector</code>, which has type <code>obj2</code>, So you have to invoke <code>printTest</code> on the <code>selector</code>, and not on <code>obj1Selector</code>. </p>\n\n<p>You cannot call it directly on the <code>obj1Selector</code>, because this method belongs to another field in that struct, namely <code>selector</code>. </p>\n\n<p>It is similar to how in java, we can have a class field with type of another class, So If you want to invoke a function defined on that field it will be <code>{InstanceOfThatClass}.{fieldName}.{method}</code>.</p>\n"}], "owner": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 36665579, "answer_count": 1, "score": 0, "last_activity_date": 1460863613, "creation_date": 1460817612, "last_edit_date": 1460826529, "question_id": 36665520, "link": "https://stackoverflow.com/questions/36665520/why-isnt-this-method-promoted-in-go", "title": "Why isn&#39;t this method promoted in Go?", "body": "<p>How does the following code work? My understanding is that obj1 embeds obj2 and therefore printTest is promoted such that we can call obj1.printTest() instead of needing to call it using obj1.obj2.printTest().</p>\n\n<p>What happens with obj1Selector (I'm not sure what the string is even called that's in front of obj2)? Does obj1Selector embed obj2? Someone told me that obj1Selector does not embed obj2 but <strong>implements a field called selector that has the type obj2</strong>, but what does that mean - why isn't it embed? Why can't I call oSelector.printTest()?</p>\n\n<pre><code>type obj1 struct {\n    obj2\n}\n\ntype obj1Selector struct {\n    selector obj2\n}\n\ntype obj2 struct {\n}\n\nfunc (o obj2) printTest() {\n    fmt.Println(\"obj2\")\n}\n\nfunc main() {\n    o := obj1{}\n    o.printTest()\n\n    oSelector := obj1Selector{}\n    oSelector.selector.printTest()\n    //oSelector.printTest() //Doesn't work\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 1, "creation_date": 1460790270, "post_id": 36660943, "comment_id": 60914942, "body": "Not to toot my own horn, but I wrote <a href=\"https://github.com/OneOfOne/cmap\" rel=\"nofollow noreferrer\">cmap</a> just to work around that problem."}, {"owner": {"reputation": 533, "user_id": 1465334, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5bde79b088ad5a840a0a0736db302223?s=128&d=identicon&r=PG&f=1", "display_name": "Tej", "link": "https://stackoverflow.com/users/1465334/tej"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1460792696, "post_id": 36660943, "comment_id": 60915566, "body": "The sharded way of implementation looks good. But I want keys to have expiry also, which is not there in cmap"}], "answers": [{"comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 1, "creation_date": 1460790300, "post_id": 36661182, "comment_id": 60914949, "body": "While this works, it&#39;s even slower than using a <code>sync.RWMutex</code>"}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1461002711, "post_id": 36661182, "comment_id": 60990039, "body": "My experience with channels is that unless you have async tasks with some decent level of networking overhead (or local computation), their usage is not performant enough compared to memory locks. So it&#39;s back to mutex (and the spinlock that goes underneath its implementation.) YMMV. One recommendation I would advocate is to always put the mutex definition above the fields it locks in the struct."}], "tags": [], "owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "is_accepted": false, "score": 0, "last_activity_date": 1460790030, "creation_date": 1460790030, "answer_id": 36661182, "question_id": 36660943, "link": "https://stackoverflow.com/questions/36660943/how-to-implement-efficient-in-memory-key-value-store-in-golang/36661182#36661182", "title": "How to implement efficient in memory key value store in golang", "body": "<p>It is not easy to lock only one entry, but you wanna more efficient, a good practice in Go is to use channel to communicate with a sequential process. In this way, there is no shared variables and locks.</p>\n\n<p>a simple example of this:</p>\n\n<pre><code>type request struct {\n    reqtype string\n    key      string\n    val      interface{}\n    response chan&lt;- result \n}\n\ntype result struct {\n    value interface{}\n    err   error\n}\n\n\ntype Cache struct{ requests chan request }\n\nfunc New() *Cache {\n    cache := &amp;Cache{requests: make(chan request)}\n    go cache.server()\n    return cache\n}\n\nfunc (c *Cache) Get(key string) (interface{}, error) {\n    response := make(chan result)\n    c.requests &lt;- request{key, response}\n    res := &lt;-response\n    return res.value, res.err\n}\n\nfunc (c *Cache) Set(key, val string) {\n    c.requests &lt;- request{\"SET\", key, val, response}\n}\n\nfunc (c *Cache) server() {\n    cache := make(map[string]interface{})\n    for req := range memo.requests {\n        switch req.reqtype {\n            case \"SET\":\n                cache[req.key] = req.val\n            case \"GET\":\n                e := cache[req.key]\n                if e == nil {\n                    req.response &lt;- result{e, errors.New(\"not exist\")}\n                } else {\n                    req.response &lt;- result{e, nil}\n                }\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 533, "user_id": 1465334, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5bde79b088ad5a840a0a0736db302223?s=128&d=identicon&r=PG&f=1", "display_name": "Tej", "link": "https://stackoverflow.com/users/1465334/tej"}, "edited": false, "score": 0, "creation_date": 1460792853, "post_id": 36661188, "comment_id": 60915612, "body": "Good catch!! I didn&#39;t see sharded implementation, But it is in experimental phase only :("}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "reply_to_user": {"reputation": 533, "user_id": 1465334, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5bde79b088ad5a840a0a0736db302223?s=128&d=identicon&r=PG&f=1", "display_name": "Tej", "link": "https://stackoverflow.com/users/1465334/tej"}, "edited": false, "score": 0, "creation_date": 1460808987, "post_id": 36661188, "comment_id": 60920090, "body": "Well, just fork it, export symbols, use it, fix it and submit PR :)"}], "tags": [], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "is_accepted": true, "score": 1, "last_activity_date": 1460790472, "last_edit_date": 1460790472, "creation_date": 1460790106, "answer_id": 36661188, "question_id": 36660943, "link": "https://stackoverflow.com/questions/36660943/how-to-implement-efficient-in-memory-key-value-store-in-golang/36661188#36661188", "title": "How to implement efficient in memory key value store in golang", "body": "<p>From the same repo you linked in your question, there is also an implementation of sharding strategy that should provide you with a lock per partition vs a lock for the whole cache. For example if you decide to partition using 4 caches, you can compute the modulo of some hash for the key and store in the cache at that index. Refining this same method, you could in theory shard using sub-partitions, decomposing the key thru a binary tree to give you the desired caching (and locking) granularity.</p>\n"}], "owner": {"reputation": 533, "user_id": 1465334, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5bde79b088ad5a840a0a0736db302223?s=128&d=identicon&r=PG&f=1", "display_name": "Tej", "link": "https://stackoverflow.com/users/1465334/tej"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5888, "favorite_count": 0, "accepted_answer_id": 36661188, "answer_count": 2, "score": 4, "last_activity_date": 1460790472, "creation_date": 1460788207, "question_id": 36660943, "link": "https://stackoverflow.com/questions/36660943/how-to-implement-efficient-in-memory-key-value-store-in-golang", "title": "How to implement efficient in memory key value store in golang", "body": "<p>I would like to know are there any packages in golang that will have expiry and efficient</p>\n\n<p>I checked a few, Here is one of <a href=\"https://github.com/patrickmn/go-cache\" rel=\"nofollow\">them</a>, But from the implementation perspective it is locking entire cache to write one entry (Check <a href=\"https://github.com/patrickmn/go-cache/blob/master/cache.go#L60\" rel=\"nofollow\">this</a>) which is not needed right?</p>\n\n<p>Is it possible to lock one entry instead of locking entire cache?</p>\n"}, {"tags": ["http", "go", "maps"], "answers": [{"comments": [{"owner": {"reputation": 28653, "user_id": 527288, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/9e175031c4adde62f40456f86a5e91b0?s=128&d=identicon&r=PG", "display_name": "Kurtis Nusbaum", "link": "https://stackoverflow.com/users/527288/kurtis-nusbaum"}, "edited": false, "score": 0, "creation_date": 1460785104, "post_id": 36660358, "comment_id": 60913714, "body": "Thanks for the quick reply. Seems correct. I found this which explained thing in a little more detail. <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/xQUsmdo6oSs\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/xQUsmdo6oSs</a>"}], "tags": [], "owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "is_accepted": true, "score": 4, "last_activity_date": 1460785143, "last_edit_date": 1460785143, "creation_date": 1460783407, "answer_id": 36660358, "question_id": 36660263, "link": "https://stackoverflow.com/questions/36660263/returning-a-value-instead-of-a-pointer-in-go/36660358#36660358", "title": "Returning a value instead of a pointer in Go", "body": "<p>That's because maps and slices are reference types.\nTake a look this code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    m1 := make(map[string]string)\n    var m2 map[string]string\n    m1[\"one\"] = \"this is from m1\"\n    m2 = m1\n    m2[\"two\"] = \"this is from m2\"\n    fmt.Printf(\"%#v\\n\", m1)\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>map[string]string{\"one\":\"this is from m1\", \"two\":\"this is from m2\"}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/0g3e0FuXlp\" rel=\"nofollow\">See/edit in the Go Playground</a>.</p>\n\n<p>This has the same result:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype mymap map[string]string\n\nfunc main() {\n    m1 := make(mymap)\n    var m2 mymap\n    m1[\"one\"] = \"this is from m1\"\n    m2 = m1\n    m2[\"two\"] = \"this is from m2\"\n    fmt.Printf(\"%#v\\n\", m1)\n}\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>main.mymap{\"one\":\"this is from m1\", \"two\":\"this is from m2\"}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/ZbBOtpzFIo\" rel=\"nofollow\">See/edit in the Go Playground</a>.</p>\n"}], "owner": {"reputation": 28653, "user_id": 527288, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/9e175031c4adde62f40456f86a5e91b0?s=128&d=identicon&r=PG", "display_name": "Kurtis Nusbaum", "link": "https://stackoverflow.com/users/527288/kurtis-nusbaum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 36660358, "answer_count": 1, "score": 1, "last_activity_date": 1460785143, "creation_date": 1460782406, "question_id": 36660263, "link": "https://stackoverflow.com/questions/36660263/returning-a-value-instead-of-a-pointer-in-go", "title": "Returning a value instead of a pointer in Go", "body": "<p>In the \"net/http\" package of Go, there is an interface called <code>ResponseWriter</code>. This interface has a method called <code>Header() Header</code>. Since the <code>Header</code> value that <code>Header()</code> returns is a value and not a pointer, I assumed the function would not be returning the actual <code>Header</code> value that is private to the <code>ResponseWriter</code> but rather a copy.</p>\n\n<p>However, this does not appear to be the case. The docs for <code>ResponseWriter</code> show <code>r.Header().Add(\"key\", \"value\")</code> to be the proper way to add a header to your http response.</p>\n\n<p>I dug in a little deeper and found the definition for the <code>Header</code> type. It is <code>type Header map[string][]string</code>. I'm a little confused here. Do you not have to return a pointer in this case in order to modify the value that the <code>ResponseWriter</code> has? If so why?</p>\n"}]